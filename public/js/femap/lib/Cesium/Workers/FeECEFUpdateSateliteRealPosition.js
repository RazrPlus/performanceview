/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
/**
  @license
  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 * A lightweight CommonJS Promises/A and when() implementation
 * when is part of the cujo.js family of libraries (http://cujojs.com/)
 *
 * Licensed under the MIT License at:
 * http://www.opensource.org/licenses/mit-license.php
 *
 * @version 1.7.1
 */

!function(){!function(t){"use strict";t("ThirdParty/when",[],function(){function t(t,s,e,o){return i(t).then(s,e,o)}function i(t){var i,s;return t instanceof e?i=t:h(t)?(s=r(),t.then(function(t){s.resolve(t)},function(t){s.reject(t)},function(t){s.progress(t)}),i=s.promise):i=o(t),i}function s(i){return t(i,n)}function e(t){this.then=t}function o(t){return new e(function(s){try{return i(s?s(t):t)}catch(t){return n(t)}})}function n(t){return new e(function(s,e){try{return e?i(e(t)):n(t)}catch(t){return n(t)}})}function r(){function t(t,i,s){return u(t,i,s)}function s(t){return l(t)}function o(t){return l(n(t))}function h(t){return d(t)}var m,a,_,c,u,d,l;return a=new e(t),m={then:t,resolve:s,reject:o,progress:h,promise:a,resolver:{resolve:s,reject:o,progress:h}},_=[],c=[],u=function(t,i,s){var e,o;return e=r(),o="function"==typeof s?function(t){try{e.progress(s(t))}catch(t){e.progress(t)}}:function(t){e.progress(t)},_.push(function(s){s.then(t,i).then(e.resolve,e.reject,o)}),c.push(o),e.promise},d=function(t){return f(c,t),t},l=function(t){return t=i(t),u=t.then,l=i,d=M,f(_,t),c=_=b,t},m}function h(t){return t&&"function"==typeof t.then}function m(i,s,e,o,n){return p(2,arguments),t(i,function(i){function h(t){f(t)}function m(t){l(t)}var a,_,c,u,d,l,f,p,v,g;if(v=i.length>>>0,a=Math.max(0,Math.min(s,v)),c=[],_=v-a+1,u=[],d=r(),a)for(p=d.progress,f=function(t){u.push(t),--_||(l=f=M,d.reject(u))},l=function(t){c.push(t),--a||(l=f=M,d.resolve(c))},g=0;g<v;++g)g in i&&t(i[g],m,h,p);else d.resolve(c);return d.then(e,o,n)})}function a(t,i,s,e){function o(t){return i?i(t[0]):t[0]}return m(t,1,o,s,e)}function _(t,i,s,e){return p(1,arguments),u(t,v).then(i,s,e)}function c(){return u(arguments,v)}function u(i,s){return t(i,function(i){var e,o,n,h,m,a;if(n=o=i.length>>>0,e=[],a=r(),n)for(h=function(i,o){t(i,s).then(function(t){e[o]=t,--n||a.resolve(e)},a.reject)},m=0;m<o;m++)m in i?h(i[m],m):--n;else a.resolve(e);return a.promise})}function d(i,s){var e=F.call(arguments,1);return t(i,function(i){var o;return o=i.length,e[0]=function(i,e,n){return t(i,function(i){return t(e,function(t){return s(i,t,n,o)})})},g.apply(i,e)})}function l(i,s,e){var o=arguments.length>2;return t(i,function(t){return t=o?e:t,s.resolve(t),t},function(t){return s.reject(t),n(t)},s.progress)}function f(t,i){for(var s,e=0;s=t[e++];)s(i)}function p(t,i){for(var s,e=i.length;e>t;)if(null!=(s=i[--e])&&"function"!=typeof s)throw new Error("arg "+e+" must be a function")}function M(){}function v(t){return t}var g,F,b;return t.defer=r,t.resolve=i,t.reject=s,t.join=c,t.all=_,t.map=u,t.reduce=d,t.any=a,t.some=m,t.chain=l,t.isPromise=h,e.prototype={always:function(t,i){return this.then(t,t,i)},otherwise:function(t){return this.then(b,t)},yield:function(t){return this.then(function(){return t})},spread:function(t){return this.then(function(i){return _(i,function(i){return t.apply(b,i)})})}},F=[].slice,g=[].reduce||function(t){var i,s,e,o,n;if(n=0,i=Object(this),o=i.length>>>0,s=arguments,s.length<=1)for(;;){if(n in i){e=i[n++];break}if(++n>=o)throw new TypeError}else e=s[1];for(;n<o;++n)n in i&&(e=t(e,i[n],n,i));return e},t})}("function"==typeof define&&define.amd?define:function(t){"object"==typeof exports?module.exports=t():this.when=t()}),define("Core/defined",[],function(){"use strict";function t(t){return void 0!==t&&null!==t}return t}),define("Core/freezeObject",["./defined"],function(t){"use strict";var i=Object.freeze;return t(i)||(i=function(t){return t}),i}),define("Core/defaultValue",["./freezeObject"],function(t){"use strict";function i(t,i){return void 0!==t&&null!==t?t:i}return i.EMPTY_OBJECT=t({}),i}),define("Core/formatError",["./defined"],function(t){"use strict";function i(i){var s,e=i.name,o=i.message;s=t(e)&&t(o)?e+": "+o:i.toString();var n=i.stack;return t(n)&&(s+="\n"+n),s}return i}),define("Workers/createTaskProcessorWorker",["../ThirdParty/when","../Core/defaultValue","../Core/defined","../Core/formatError"],function(t,i,s,e){"use strict";function o(i,s,e){try{return i(s,e)}catch(i){return t.reject(i)}}function n(n){var r;return function(h){var m=h.data,a=[],_={id:m.id,result:void 0,error:void 0};return t(o(n,m.parameters,a)).then(function(t){_.result=t}).otherwise(function(t){t instanceof Error?_.error={name:t.name,message:t.message,stack:t.stack}:_.error=t}).always(function(){s(r)||(r=i(self.webkitPostMessage,self.postMessage)),m.canTransferArrayBuffer||(a.length=0);try{r(_,a)}catch(t){_.result=void 0,_.error="postMessage failed with error: "+e(t)+"\n  with responseMessage: "+JSON.stringify(_),r(_)}})}}return n}),define("Workers/FeECEFUpdateSateliteRealPosition",["./createTaskProcessorWorker"],function(t){"use strict";function i(t,i,s,e){void 0===e&&(e=!0),this.m_pos=t,this.m_vel=i,this.m_date=s,this.m_VecUnits=e?M:p}function s(t,i,s){this.satID=t,this.satLine1=i,this.satLine2=s,this.m_Field=new Array,this.m_mapCache=new Map}function e(t){var i,s=parseInt(t),e=1*s,o=s<0;for(o&&(e*=-1);e>=1;)e/=10;o&&(e*=-1);var n=t.substr(6,2);return i=parseInt(n),(e*Math.pow(10,i)).toFixed(9)}function o(t,i,s){switch(i){case F:case b:case y:case O:if(s==q)return t*L}return t}function n(t){this.m_tle=t,this.m_tle.initTLE();var i=parseInt(this.m_tle.getField(v)),s=parseFloat(this.m_tle.getField(g));i+=i<57?2e3:1900,this.m_jdEpoch=r(i,s),this.m_secPeriod=-1;var e=this.m_tle.getField(w),o=e*j/N,n=Math.pow(B/o,k),h=this.m_tle.getField(x),m=this.m_tle.getField(F,q),a=1.5*C*(3*Math.cos(m)*Math.cos(m)-1)/Math.pow(1-h*h,1.5),_=a/(n*n),c=n*(1-_*(1/3+_*(1+134/81*_))),u=a/(c*c);this.m_rmMeanMotionRec=o/(1+u),this.m_aeAxisSemiMajorRec=c/(1-u),this.m_aeAxisSemiMinorRec=this.m_aeAxisSemiMajorRec*Math.sqrt(1-h*h),this.m_kmPerigeeRec=I*(this.m_aeAxisSemiMajorRec*(1-h)-A),this.m_kmApogeeRec=I*(this.m_aeAxisSemiMajorRec*(1+h)-A),j/this.m_rmMeanMotionRec>=225?this.m_pNoradModel=new d(this):this.m_pNoradModel=new l(this)}function r(t,i){t--;var s=parseInt(t/100);return 365.25*t+428.4014+1720994.5+parseInt(2-s+s/4)+i}function h(){}function m(t){var i=(t+.5)%1,s=(t-D-i)/36525,e=24110.54841+s*(8640184.812866+s*(.093104-62e-7*s));return e=(e+U*W*i)%U,e<0&&(e+=U),j*(e/U)}function a(t){this.m_Orbit=t,this.m_a3ovk2=0,this.m_c2=0,this.m_satInc=this.m_Orbit.m_tle.getField(F,q),this.m_satEcc=this.m_Orbit.m_tle.getField(x),this.m_cosio=Math.cos(this.m_satInc),this.m_theta2=this.m_cosio*this.m_cosio,this.m_x3thm1=3*this.m_theta2-1,this.m_eosq=this.m_satEcc*this.m_satEcc,this.m_betao2=1-this.m_eosq,this.m_betao=Math.sqrt(this.m_betao2),this.m_aodp=this.m_Orbit.m_aeAxisSemiMajorRec,this.m_xnodp=this.m_Orbit.m_rmMeanMotionRec,this.m_perigee=I*(this.m_aodp*(1-this.m_satEcc)-A),this.m_s4=V,this.m_qoms24=G,this.m_perigee<156&&(this.m_s4=this.m_perigee-78,this.m_perigee<=98&&(this.m_s4=20),this.m_qoms24=Math.pow((120-this.m_s4)*A/I,4),this.m_s4=this.m_s4/I+A);var i=1/(this.m_aodp*this.m_aodp*this.m_betao2*this.m_betao2);this.m_tsi=1/(this.m_aodp-this.m_s4),this.m_eta=this.m_aodp*this.m_satEcc*this.m_tsi,this.m_etasq=this.m_eta*this.m_eta,this.m_eeta=this.m_satEcc*this.m_eta;var s=Math.abs(1-this.m_etasq);this.m_coef=this.m_qoms24*Math.pow(this.m_tsi,4),this.m_coef1=this.m_coef/Math.pow(s,3.5);var e=this.m_coef1*this.m_xnodp*(this.m_aodp*(1+1.5*this.m_etasq+this.m_eeta*(4+this.m_etasq))+.75*C*this.m_tsi/s*this.m_x3thm1*(8+3*this.m_etasq*(8+this.m_etasq)));this.m_c1=this.m_Orbit.m_tle.getField(P)/A*e,this.m_sinio=Math.sin(this.m_satInc);var o=-S/C*Math.pow(A,3);this.m_c3=this.m_coef*this.m_tsi*o*this.m_xnodp*A*this.m_sinio/this.m_satEcc,this.m_x1mth2=1-this.m_theta2,this.m_c4=2*this.m_xnodp*this.m_coef1*this.m_aodp*this.m_betao2*(this.m_eta*(2+.5*this.m_etasq)+this.m_satEcc*(.5+2*this.m_etasq)-2*C*this.m_tsi/(this.m_aodp*s)*(-3*this.m_x3thm1*(1-2*this.m_eeta+this.m_etasq*(1.5-.5*this.m_eeta))+.75*this.m_x1mth2*(2*this.m_etasq-this.m_eeta*(1+this.m_etasq))*Math.cos(2*this.m_Orbit.m_tle.getField(y,q))));var n=this.m_theta2*this.m_theta2,r=3*C*i*this.m_xnodp,h=r*C*i,m=1.25*T*i*i*this.m_xnodp;this.m_xmdot=this.m_xnodp+.5*r*this.m_betao*this.m_x3thm1+.0625*h*this.m_betao*(13-78*this.m_theta2+137*n);var a=1-5*this.m_theta2;this.m_omgdot=-.5*r*a+.0625*h*(7-114*this.m_theta2+395*n)+m*(3-36*this.m_theta2+49*n);var _=-r*this.m_cosio;this.m_xnodot=_+(.5*h*(4-19*this.m_theta2)+2*m*(3-7*this.m_theta2))*this.m_cosio,this.m_xnodcf=3.5*this.m_betao2*_*this.m_c1,this.m_t2cof=1.5*this.m_c1,this.m_xlcof=.125*o*this.m_sinio*(3+5*this.m_cosio)/(1+this.m_cosio),this.m_aycof=.25*o*this.m_sinio,this.m_x7thm1=7*this.m_theta2-1}function _(t){var i=t%j;return i<0&&(i+=j),i}function c(t,i){return Math.abs(i)<1e-6?t>0?E/2:3*E/2:i>0?Math.atan(t/i):E+Math.atan(t/i)}function u(t,i,s){return Math.sqrt(t*t+i*i+s*s)}function d(t){function i(t,i,s,e,o,n,a,P,E,L,A,k,I){r=i,h=s,u=e,d=o,l=n,f=a,p=P,M=E,v=L,g=A,w=k,j=I;var R=t.m_Orbit.m_jdEpoch;Vt=m(R);var C=t.m_Orbit.m_tle.getField(x),T=1/l;zt=t.m_Orbit.m_tle.getField(F,q);var S=t.m_Orbit.m_tle.getField(O,q),z=w+j,B=Math.sin(t.m_Orbit.m_tle.getField(b,q)),rt=Math.cos(t.m_Orbit.m_tle.getField(b,q));Nt=t.m_Orbit.m_tle.getField(y,q);var ht=R-J;Math.abs(ht-Pi)>1e-6&&(Pi=ht,yi=4.523602-.00092422029*ht,gi=Math.sin(yi),xi=Math.cos(yi),Fi=.91375164-.03568096*xi,Ai=Math.sqrt(1-Fi*Fi),Ei=.089683511*gi/Ai,Li=Math.sqrt(1-Ei*Ei),vi=4.7199672+.2299715*ht,ji=5.8351514+.001944368*ht,wt=_(vi-ji),bi=.39785416*gi/Ai,wi=Li*xi+.91744867*Ei*gi,bi=c(bi,wi)+ji-yi,qi=Math.cos(bi),Oi=Math.sin(bi),N=6.2565837+.017201977*ht,N=_(N)),V=1e20;for(var mt,at,_t,ki,Ii,Ri,Ci,Ti,Si,zi,Vi,Ni,Ui,Wi,Bi,Gi,Ji,Di,Yi,Hi,Ki,Qi,Xi,Zi,$i,ts,is,ss,es,os,ns,rs,hs,ms,as,_s,cs,us=st,ds=it,ls=$,fs=tt,ps=rt,Ms=B,vs=H,gs=Y,Fs=K,bs=1/t.m_xnodp,xs=0,ys=0,Os=0,ws=0,Ps=0,qs=1;qs<=2;qs++)mt=us*ps+ds*ls*Ms,at=-ds*ps+us*ls*Ms,_t=-us*Ms+ds*ls*ps,ki=ds*fs,Ii=ds*Ms+us*ls*ps,Ri=us*fs,Ci=u*_t+h*ki,Ti=u*Ii+h*Ri,Si=-h*_t+u*ki,zi=-h*Ii+u*Ri,Vi=mt*M+Ci*p,Ni=at*M+Ti*p,Ui=-mt*p+Ci*M,Wi=-at*p+Ti*M,Bi=Si*p,Gi=zi*p,Ji=Si*M,Di=zi*M,Yi=12*Vi*Vi-3*Ui*Ui,Hi=24*Vi*Ni-6*Ui*Wi,Ki=12*Ni*Ni-3*Wi*Wi,Qi=3*(mt*mt+Ci*Ci)+Yi*r,Xi=6*(mt*at+Ci*Ti)+Hi*r,Zi=3*(at*at+Ti*Ti)+Ki*r,$i=-6*mt*Si+r*(-24*Vi*Ji-6*Ui*Bi),ts=-6*(mt*zi+at*Si)+r*(-24*(Ni*Ji+Vi*Di)-6*(Ui*Gi+Wi*Bi)),is=-6*at*zi+r*(-24*Ni*Di-6*Wi*Gi),ss=6*Ci*Si+r*(24*Vi*Bi-6*Ui*Ji),es=6*(Ti*Si+Ci*zi)+r*(24*(Ni*Bi+Vi*Gi)-6*(Wi*Ji+Ui*Di)),os=6*Ti*zi+r*(24*Ni*Gi-6*Wi*Di),Qi=Qi+Qi+v*Yi,Xi=Xi+Xi+v*Hi,Zi=Zi+Zi+v*Ki,ns=vs*bs,rs=-.5*ns/d,hs=ns*d,ms=-15*C*hs,as=Vi*Ui+Ni*Wi,_s=Ni*Ui+Vi*Wi,cs=Ni*Wi-Vi*Ui,xs=ms*gs*as,ys=rs*gs*($i+is),Os=-gs*ns*(Qi+Zi-14-6*r),ws=hs*gs*(Yi+Ki-6),Ps=-gs*rs*(ss+os),zt<.052359877&&(Ps=0),Pt=2*ms*_s,qt=2*ms*cs,Et=2*rs*ts,jt=2*rs*(is-$i),Lt=-2*ns*Xi,At=-2*ns*(Zi-Qi),kt=-2*ns*(-21-9*r)*Fs,It=2*hs*Hi,Rt=2*hs*(Ki-Yi),Ct=-18*hs*Fs,Tt=-2*rs*es,St=-2*rs*(os-ss),1==qs&&(Ut=xs,Wt=ys,Bt=Os,Gt=Ps/h,Jt=ws-u*Gt,U=Pt,G=Et,Mt=Lt,Ft=It,yt=Tt,W=qt,D=jt,vt=At,bt=Rt,Ot=St,gt=kt,xt=Ct,us=qi,ds=Oi,ls=Fi,fs=Ai,ps=Li*rt+Ei*B,Ms=B*Li-rt*Ei,gs=Q,vs=X,Fs=Z,wt);Ut+=xs,Wt+=ys,Bt+=Os,Jt=Jt+ws-u/h*Ps,Gt+=Ps/h,pi=!1,Mi=!1;var Es,js,Ls=!0,As=0;if(t.m_xnodp>=.0052359877||t.m_xnodp<=.0034906585)if(t.m_xnodp<.00826||t.m_xnodp>.00924||C<.5)Ls=!1;else{pi=!0;var ks,Is,Rs,Cs,Ts,Ss=C*r,zs=-.306-.44*(C-.64);C<=.65?(ks=3.616-13.247*C+16.29*r,Es=117.39*C-19.302-228.419*r+156.591*Ss,Is=109.7927*C-18.9068-214.6334*r+146.5816*Ss,Rs=242.694*C-41.122-471.094*r+313.953*Ss,Cs=841.88*C-146.407-1629.014*r+1083.435*Ss,Ts=3017.977*C-532.114-5740*r+3708.276*Ss):(ks=331.819*C-72.099-508.738*r+266.724*Ss,Es=1582.851*C-346.844-2415.925*r+1246.113*Ss,Is=1554.908*C-342.585-2366.899*r+1215.972*Ss,Rs=4758.686*C-1052.797-7193.992*r+3651.957*Ss,Cs=16178.11*C-3581.69-24462.77*r+12422.52*Ss,Ts=C<=.715?1464.74-4664.75*C+3763.64*r:29936.92*C-5149.66-54087.36*r+31324.56*Ss);var Vs,Ns,Us;C<.7?(Vs=4988.61*C-919.2277-9064.77*r+5542.21*Ss,Ns=4568.6173*C-822.71072-8491.4146*r+5337.524*Ss,Us=4690.25*C-853.666-8624.77*r+5341.4*Ss):(Vs=161616.52*C-37995.78-229838.2*r+109377.94*Ss,Ns=218913.95*C-51752.104-309468.16*r+146349.42*Ss,Us=170470.89*C-40023.88-242699.48*r+115605.82*Ss);var Ws=h*h;js=.75*(1+2*u+f);var Bs=1.5*Ws,Gs=1.875*h*(1-2*u-3*f),Js=-1.875*h*(1+2*u-3*f),Ds=35*Ws*js,Ys=39.375*Ws*Ws,Hs=9.84375*h*(Ws*(1-2*u-5*f)+.33333333*(4*u-2+6*f)),Ks=h*(4.92187512*Ws*(-2-4*u+10*f)+6.56250012*(1+2*u-3*f)),Qs=29.53125*h*(2-8*u+f*(8*u-12+10*f)),Xs=29.53125*h*(-2-8*u+f*(12+8*u-10*f)),Zs=t.m_xnodp*t.m_xnodp,$s=T*T,te=3*Zs*$s,ie=te*ct;Dt=ie*js*zs,Yt=ie*Bs*ks,te*=T,ie=te*ut,Ht=ie*Gs*Es,Kt=ie*Js*Is,te*=T,ie=2*te*dt,Qt=ie*Ds*Rs,Xt=ie*Ys*Cs,te*=T,ie=te*lt,Zt=ie*Hs*Ts,$t=ie*Ks*Us,ie=2*te*ft,ti=ie*Qs*Ns,ii=ie*Xs*Vs,si=S+t.m_Orbit.m_tle.getField(b,q)+t.m_Orbit.m_tle.getField(b,q)-Vt-Vt,As=g+j+j-pt-pt,As=As+Bt+Gt+Gt}else{pi=!0,Mi=!0;var se=1+r*(.8125*r-2.5);Es=1+2*r;var ee=1+r*(6.60937*r-6);js=.75*(1+u)*(1+u);var oe=.9375*h*h*(1+3*u)-.75*(1+u),ne=1+u;ne*=1.875*ne*ne,ei=3*t.m_xnodp*t.m_xnodp*T*T,oi=2*ei*js*se*et,ni=3*ei*ne*ee*nt*T,ei=ei*oe*Es*ot*T,ri=.13130908,hi=2.8843198,mi=.37448087,si=S+t.m_Orbit.m_tle.getField(b,q)+t.m_Orbit.m_tle.getField(y,q)-Vt,As=g+z-pt,As=As+Bt+Jt+Gt}return Ls&&(ai=As-t.m_xnodp,_i=si,ci=t.m_xnodp,ui=0,di=720,li=-720,fi=259200),{eosq:r,sinio:h,cosio:u,betao:d,aodp:l,theta2:f,sing:p,cosg:M,betao2:v,xmdot:g,omgdot:w,xnodott:j}}function s(t,i,s){if(Mi)t=ei*Math.sin(_i-ri)+oi*Math.sin(2*(_i-hi))+ni*Math.sin(3*(_i-mi)),i=ei*Math.cos(_i-ri)+2*oi*Math.cos(2*(_i-hi))+3*ni*Math.cos(3*(_i-mi));else{var e=Nt+w*ui,o=e+e,n=_i+_i;t=Dt*Math.sin(o+_i-rt)+Yt*Math.sin(_i-rt)+Ht*Math.sin(e+_i-ht)+Kt*Math.sin(-e+_i-ht)+Qt*Math.sin(o+n-mt)+Xt*Math.sin(n-mt)+Zt*Math.sin(e+_i-at)+$t*Math.sin(-e+_i-at)+ti*Math.sin(e+n-_t)+ii*Math.sin(-e+n-_t),i=Dt*Math.cos(o+_i-rt)+Yt*Math.cos(_i-rt)+Ht*Math.cos(e+_i-ht)+Kt*Math.cos(-e+_i-ht)+Zt*Math.cos(e+_i-at)+$t*Math.cos(-e+_i-at)+2*(Qt*Math.cos(o+n-mt)+Xt*Math.cos(n-mt)+ti*Math.cos(e+n-_t)+ii*Math.cos(-e+n-_t))}return s=ci+ai,i*=s,{pxndot:t,pxnddt:i,pxldot:s}}function e(t,i,e,o){var n=s(t,i,e);_i=_i+n.pxldot*o+n.pxndot*fi,ci=ci+n.pxndot*o+n.pxnddt*fi,ui+=o}function o(t,i,o,n,r,h,m,a){L=i,I=o,R=n,S=m,z=a,L+=Bt*z,I+=Jt*z,R+=Gt*z,C=t.m_Orbit.m_tle.getField(x)+Ut*z,(T=t.m_Orbit.m_tle.getField(F,q)+Wt*z)<0&&(T=-T,R+=E,I-=E);var _=0,c=0,u=!1;if(pi){for(;!u;)Math.abs(ui)<1e-6||z>=0&&ui<0||z<0&&ui>=0?(c=z<0?li:di,ui=0,ci=t.m_xnodp,_i=si,u=!0):Math.abs(z)<Math.abs(ui)?(c=di,z>=0&&(c=li),e(0,0,0,c)):(c=li,z>0&&(c=di),u=!0);for(;Math.abs(z-ui)>=di;)e(0,0,0,c);_=z-ui;var d=s(0,0,0);S=ci+d.pxndot*_+d.pxnddt*_*_*.5;var l=_i+d.pxldot*_+d.pxndot*_*_*.5,f=-R+Vt+z*pt;L=l-I+f,Mi||(L=l+f+f)}return{xmdf:L,omgadf:I,xnode:R,emm:C,xincc:T,xnn:S,tsince:z}}function n(t,i,s,e,o){C=t,T=i,I=s,R=e,L=o;var n=Math.sin(T),r=Math.cos(T),m=0,a=0,_=0,d=0,l=0,f=0,p=0;if(Math.abs(V-z)>=30){V=z;var M=N+Y*z,v=M+2*K*Math.sin(M),g=Math.sin(v),F=.5*g*g-.25,b=-.5*g*Math.cos(v),x=U*F+W*b,y=G*F+D*b,O=Mt*F+vt*b+gt*g;m=Ft*F+bt*b+xt*g,a=yt*F+Ot*b,M=wt+Q*z,v=M+2*Z*Math.sin(M),g=Math.sin(v),F=.5*g*g-.25,b=-.5*g*Math.cos(v);var w=Pt*F+qt*b,P=Et*F+jt*b,q=Lt*F+At*b+kt*g;p=It*F+Rt*b+Ct*g,_=Tt*F+St*b,d=x+w,l=y+P,f=O+q}var E=m+p,j=a+_;if(T+=l,C+=d,zt>=.2)j/=h,E-=u*j,I+=E,R+=j,L+=f;else{var A=Math.sin(R),k=Math.cos(R),S=n*A,B=n*k,J=j*k+l*r*A,H=-j*A+l*r*k;S+=J,B+=H;var X=L+I+r*R;X+=f+E-l*R*n,R=c(S,B),L+=f,I=X-L-Math.cos(T)*R}return{e:C,xincc:T,omgadf:I,xnode:R,xmam:L}}a.call(this,t),this.m_Orbit=t,this.m_sing=Math.sin(this.m_Orbit.m_tle.getField(y,q)),this.m_cosg=Math.cos(this.m_Orbit.m_tle.getField(y,q));var r=0,h=0,u=0,d=0,l=0,f=0,p=0,M=0,v=0,g=0,w=0,j=0,L=0,I=0,R=0,C=0,T=0,S=0,z=0,V=0,N=0,U=0,W=0,G=0,D=0,Mt=0,vt=0,gt=0,Ft=0,bt=0,xt=0,yt=0,Ot=0,wt=0,Pt=0,qt=0,Et=0,jt=0,Lt=0,At=0,kt=0,It=0,Rt=0,Ct=0,Tt=0,St=0,zt=0,Vt=0,Nt=0,Ut=0,Wt=0,Bt=0,Gt=0,Jt=0,Dt=0,Yt=0,Ht=0,Kt=0,Qt=0,Xt=0,Zt=0,$t=0,ti=0,ii=0,si=0,ei=0,oi=0,ni=0,ri=0,hi=0,mi=0,ai=0,_i=0,ci=0,ui=0,di=0,li=0,fi=0,pi=!1,Mi=!1,vi=0,gi=0,Fi=0,bi=0,xi=0,yi=0,Oi=0,wi=0,Pi=0,qi=0,Ei=0,ji=0,Li=0,Ai=0;this.getPosition=function(t){var s=i(this,this.m_eosq,this.m_sinio,this.m_cosio,this.m_betao,this.m_aodp,this.m_theta2,this.m_sing,this.m_cosg,this.m_betao2,this.m_xmdot,this.m_omgdot,this.m_xnodot);this.m_eosq=s.eosq,this.m_sinio=s.sinio,this.m_cosio=s.cosio,this.m_betao=s.betao,this.m_aodp=s.aodp,this.m_theta2=s.theta2,this.m_sing=s.sing,this.m_cosg=s.cosg,this.m_betao2=s.betao2,this.m_xmdot=s.xmdot,this.m_omgdot=s.omgdot,this.m_xnodot=s.xnodott;var e,r,h=this.m_Orbit.m_tle.getField(O,q)+this.m_xmdot*t,m=this.m_Orbit.m_tle.getField(y,q)+this.m_omgdot*t,a=this.m_Orbit.m_tle.getField(b,q)+this.m_xnodot*t,_=t*t,c=a+this.m_xnodcf*_,u=1-this.m_c1*t,d=this.m_Orbit.m_tle.getField(P)/A*this.m_c4*t,l=this.m_t2cof*_,f=this.m_xnodp,p=o(this,h,m,c,e,r,f,t);h=p.xmdf,m=p.omgadf,c=p.xnode,e=p.emm,r=p.xincc,f=p.xnn,t=p.tsince;var M=Math.pow(B/f,k)*(u*u),v=e-d,g=h+this.m_xnodp*l,F=n(v,r,m,c,g);v=F.e,r=F.xincc,m=F.omgadf,c=F.xnode,g=F.xmam;var x=g+m+c;return f=B/Math.pow(M,1.5),this.FinalPosition(r,m,v,M,x,c,f,t)}}function l(t){a.call(this,t),this.m_Orbit=t,this.m_c5=2*this.m_coef1*this.m_aodp*this.m_betao2*(1+2.75*(this.m_etasq+this.m_eeta)+this.m_eeta*this.m_etasq),this.m_omgcof=this.m_Orbit.m_tle.getField(P)/A*this.m_c3*Math.cos(this.m_Orbit.m_tle.getField(y,q)),this.m_xmcof=-k*this.m_coef*this.m_Orbit.m_tle.getField(P)/A*A/this.m_eeta,this.m_delmo=Math.pow(1+this.m_eta*Math.cos(this.m_Orbit.m_tle.getField(O,q)),3),this.m_sinmo=Math.sin(this.m_Orbit.m_tle.getField(O,q)),this.getPosition=function(t){var i=!1;this.m_aodp*(1-this.m_satEcc)/A<220/I+A&&(i=!0);var s=0,e=0,o=0,n=0,r=0,h=0;if(!i){var m=this.m_c1*this.m_c1;s=4*this.m_aodp*this.m_tsi*m;var a=s*this.m_tsi*this.m_c1/3;e=(17*this.m_aodp+this.m_s4)*a,o=.5*a*this.m_aodp*this.m_tsi*(221*this.m_aodp+31*this.m_s4)*this.m_c1,n=s+2*m,r=.25*(3*e+this.m_c1*(12*s+10*m)),h=.2*(3*o+12*this.m_c1*e+6*s*s+15*m*(2*s+m))}var _=this.m_Orbit.m_tle.getField(O,q)+this.m_xmdot*t,c=this.m_Orbit.m_tle.getField(y,q)+this.m_omgdot*t,u=this.m_Orbit.m_tle.getField(b,q)+this.m_xnodot*t,d=c,l=_,f=t*t,p=u+this.m_xnodcf*f,M=1-this.m_c1*t,v=this.m_Orbit.m_tle.getField(P)/A*this.m_c4*t,g=this.m_t2cof*f;if(!i){var F=this.m_omgcof*t,x=this.m_xmcof*(Math.pow(1+this.m_eta*Math.cos(_),3)-this.m_delmo),a=F+x;l=_+a,d=c-a;var w=(f*t).toPrecision(19),E=(t*w).toPrecision(26);M=M-s*f-e*w-o*E,v+=this.m_Orbit.m_tle.getField(P)/A*this.m_c5*(Math.sin(l)-this.m_sinmo),g=g+n*w+E*(r+t*h)}var j=this.m_aodp*(M*M),L=this.m_satEcc-v,k=l+d+p+this.m_xnodp*g,R=B/Math.pow(j,1.5);return this.FinalPosition(this.m_satInc,c,L,j,k,p,R,t)}}function f(t,i){var s=t.data;if(void 0!=s){void 0===Mt&&(Mt=new h);for(var e=(s.speed,s.realTime),o=s.satelineInfoArr,n=o.length,r=0,m=0;m<n;++m){var a=o[m],_=a.name,c=a.tle1,u=a.tle2,d=Mt.request_real_time_orbit(_,c,u,e,0);if(void 0!=d){if(a.geoPosition=d,a.requestOrbit){var l=Mt.fillSatellitePoints(_,c,u,e);a.historyOrbitLength=l.historyPositionArr.length/3;var f=l.historyPositionArr.slice(0);f=f.concat(l.futurePositionArr),a.satelinePosArr=f}a.rotate=[0,0,0],r++}else a.geoPosition=void 0,a.satelinePosArr=void 0,a.historyOrbitLength=0,r++}return r===n?s:void 0}}const p=0,M=1,v=3,g=4,F=6,b=7,x=8,y=9,O=10,w=11,P=14,q=0,E=Math.PI,j=2*Math.PI,L=Math.PI/180,A=1,k=2/3,I=6378.135,R=1/298.26,C=.0005413079,T=-3*-165597e-11/8,S=-253881e-11,z=A+120/I,V=A+78/I,N=1440,U=86400,W=1.00273790934,B=Math.sqrt(1434962880/(I*I*I)),G=Math.pow(z-V,4),J=2415020,D=2451545;i.prototype.MulPos=function(t){this.m_pos.x*=t,this.m_pos.y*=t,this.m_pos.z*=t},s.prototype.initTLE=function(){this.m_Field[0]=this.satLine1.substr(2,5),this.m_Field[1]=this.satLine1.substr(9,8),this.m_Field[v]=this.satLine1.substr(18,2),this.m_Field[v]=parseFloat(this.m_Field[v]),this.m_Field[g]=parseFloat(this.satLine1.substr(20,12)),"-"==this.satLine1[33]?this.m_Field[12]="-0":this.m_Field[12]="0",this.m_Field[12]+=this.satLine1.substr(34,10),this.m_Field[12]=parseFloat(this.m_Field[12]),this.m_Field[13]=e(this.satLine1.substr(44,8)),this.m_Field[13]=parseFloat(this.m_Field[13]),this.m_Field[P]=e(this.satLine1.substr(53,8)),this.m_Field[P]=parseFloat(this.m_Field[P]),this.m_Field[2]=this.satLine1.substr(64,4),this.m_Field[2]=parseFloat(this.m_Field[2]),this.m_Field[F]=this.satLine2.substr(8,8),this.m_Field[F]=parseFloat(this.m_Field[F]),this.m_Field[b]=this.satLine2.substr(17,8),this.m_Field[b]=parseFloat(this.m_Field[b]),this.m_Field[x]="0.",this.m_Field[x]+=this.satLine2.substr(26,7),this.m_Field[x]=parseFloat(this.m_Field[x]),this.m_Field[y]=this.satLine2.substr(34,8),this.m_Field[y]=parseFloat(this.m_Field[y]),this.m_Field[O]=this.satLine2.substr(43,8),this.m_Field[O]=parseFloat(this.m_Field[O]),this.m_Field[w]=this.satLine2.substr(52,11),this.m_Field[w]=parseFloat(this.m_Field[w]),this.m_Field[5]=this.satLine2.substr(63,5),this.m_Field[5]=parseFloat(this.m_Field[5])},s.prototype.getField=function(t,i){void 0===i&&(i=2);var s=parseInt(100*i+t);if(this.m_mapCache.has(s))return this.m_mapCache.get(s);var e=this.m_Field[t],n=o(e,t,i);return this.m_mapCache.set(s,n),n},n.prototype.TPlusEpoch=function(t){return(t-this.m_jdEpoch)*U},n.prototype.Period=function(){return this.m_secPeriod<0&&(Math.abs(this.m_rmMeanMotionRec)<1e-6?this.m_secPeriod=0:this.m_secPeriod=j/this.m_rmMeanMotionRec*60),this.m_secPeriod},n.prototype.mnAnomaly=function(t){var i=this.TPlusEpoch(t),s=this.Period();return(this.m_tle.getField(O,q)+j*(i/s))%j},n.prototype.getPosition=function(t){return this.m_pNoradModel.getPosition(t)},h.prototype.request_real_time_orbit=function(t,i,e,o,r){var h=new s(t,i,e),m=new n(h),a=24*o*60,_=24*(m.m_jdEpoch-D)*60;a+=r;var c=a-_,u=m.getPosition(c);if(void 0!=u)return[u[0],u[1],u[2]]},h.prototype.request_orbit=function(t,i,e,o,r,h){var m=t,a=i,_=e,c=new s(m,a,_),u=new n(c),d=24*o*60,l=24*r*60,f=24*(u.m_jdEpoch-D)*60,p=0;if(d<=l){p=parseInt((l-d)/h)+1;for(var M=new Array(3*p),v=0;v<p;++v){var g=d-f,F=u.getPosition(g);void 0!==F&&(M[3*v+0]=F[0],M[3*v+1]=F[1],M[3*v+2]=F[2],d+=h)}return M}},h.prototype.request_onecycle_orbit=function(t,i,e,o,r,h){var m=t,a=i,_=e,c=new s(m,a,_),u=new n(c),d=u.Period();return d=d/60/60/24,{historyPositionArr:this.request_orbit(t,i,e,o-d*h,o,150*r),futurePositionArr:this.request_orbit(t,i,e,o,o+d*(1-h),50*r)}},h.prototype.fillSatellitePoints=function(t,i,s,e){return this.request_onecycle_orbit(t,i,s,e,.1,9.8/10)},i.prototype.MulVel=function(t){this.m_vel.x*=t,this.m_vel.y*=t,this.m_vel.z*=t},i.prototype.ae2km=function(){this.m_VecUnits===M&&(this.MulPos(I/A),this.MulVel(I/A*(N/86400)),this.m_VecUnits=2)},i.prototype.toGeo=function(){this.ae2km();var t=c(this.m_pos.y,this.m_pos.x),i=(t-m(this.m_date))%j;i<0&&(i+=j);var s,e,o=Math.sqrt(this.m_pos.x*this.m_pos.x+this.m_pos.y*this.m_pos.y),n=R*(2-R),r=c(this.m_pos.z,o);do{s=r,e=1/Math.sqrt(1-n*Math.sin(s)*Math.sin(s)),r=c(this.m_pos.z+I*e*n*Math.sin(s),o)}while(Math.abs(r-s)>1e-7);return[i,r,1e3*(o/Math.cos(r)-I*e)]},a.prototype.FinalPosition=function(t,s,e,o,n,r,h,m){if(!(e*e>1)){for(var a=Math.sqrt(1-e*e),d=e*Math.cos(s),l=1/(o*a*a),f=l*this.m_xlcof*d,p=l*this.m_aycof,M=n+f,v=e*Math.sin(s)+p,g=_(M-r),F=g,b=0,x=0,y=0,O=0,w=0,P=0,q=!1,E=1;E<=10&&!q;E++){w=Math.sin(F),P=Math.cos(F),b=d*w,x=v*P,y=d*P,O=v*w;var j=(g-x+b-F)/(1-y-O)+F;Math.abs(j-F)<=1e-6?q=!0:F=j}var L=y+O,k=b-x;l=1-(d*d+v*v);var R=o*l,T=o*(1-L),S=1/T,z=B*Math.sqrt(o)*k*S,V=B*Math.sqrt(R)*S;F=o*S;var U=Math.sqrt(l);b=1/(1+U);var W=F*(P-d+v*k*b),G=F*(w-v-d*k*b),J=c(G,W),D=2*G*W,Y=2*W*W-1;l=1/R,S=C*l,F=S*l;var H=T*(1-1.5*F*U*this.m_x3thm1)+.5*S*this.m_x1mth2*Y,K=J-.25*F*this.m_x7thm1*D,Q=r+1.5*F*this.m_cosio*D,X=t+1.5*F*this.m_cosio*this.m_sinio*Y,Z=z-h*S*this.m_x1mth2*D,$=V+h*S*(this.m_x1mth2*Y+1.5*this.m_x3thm1),tt=Math.sin(K),it=Math.cos(K),st=Math.sin(X),et=Math.cos(X),ot=Math.sin(Q),nt=Math.cos(Q),rt=-ot*et,ht=nt*et,mt=rt*tt+nt*it,at=ht*tt+ot*it,_t=st*tt,ct=rt*it-nt*tt,ut=ht*it-ot*tt,dt=st*it,lt=H*mt,ft=H*at,pt=H*_t,Mt={x:lt,y:ft,z:pt},vt=u(lt,ft,pt),gt=vt*(I/A);if(!(gt<I||gt>84483.784)){var Ft=Z*mt+$*ct,bt=Z*at+$*ut,xt=Z*_t+$*dt,yt={x:Ft,y:bt,z:xt},Ot=this.m_Orbit.m_jdEpoch;Ot+=m/N;return new i(Mt,yt,Ot).toGeo()}}};const Y=119459e-10,H=29864797e-13,K=.01675,Q=.00015835218,X=4.7968065e-7,Z=.0549,$=.91744867,tt=.39785416,it=-.98088458,st=.1945905,et=17891679e-13,ot=21460748e-13,nt=2.2123015e-7,rt=5.7686396,ht=.95240898,mt=1.8014998,at=1.050833,_t=4.4108898,ct=17891679e-13,ut=3.7393792e-7,dt=7.3636953e-9,lt=1.1428639e-7,ft=2.1765803e-9,pt=.0043752691;!function(){var t=function(){};t.prototype=a.prototype,d.prototype=new t}(),function(){var t=function(){};t.prototype=a.prototype,l.prototype=new t}();var Mt=void 0;return t(f)})}();