/**
 * Cesium - https://github.com/AnalyticalGraphicsInc/cesium
 *
 * Copyright 2011-2017 Cesium Contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Columbus View (Pat. Pend.)
 *
 * Portions licensed separately.
 * See https://github.com/AnalyticalGraphicsInc/cesium/blob/master/LICENSE.md for full licensing details.
 */
/*
 almond 0.3.3 Copyright jQuery Foundation and other contributors.
 Released under MIT license, http://github.com/requirejs/almond/LICENSE


 Grauw URI utilities

 See: http://hg.grauw.nl/grauw-lib/file/tip/src/uri.js

 @author Laurens Holst (http://www.grauw.nl/)

   Copyright 2012 Laurens Holst

   Licensed under the Apache License, Version 2.0 (the "License");
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.


  when.js - https://github.com/cujojs/when

  MIT License (c) copyright B Cavalier & J Hann

 A lightweight CommonJS Promises/A and when() implementation
 when is part of the cujo.js family of libraries (http://cujojs.com/)

 Licensed under the MIT License at:
 http://www.opensource.org/licenses/mit-license.php

 @version 1.7.1

mersenne-twister.js - https://gist.github.com/banksean/300494

   Copyright (C) 1997 - 2002, Makoto Matsumoto and Takuji Nishimura,
   All rights reserved.

   Redistribution and use in source and binary forms, with or without
   modification, are permitted provided that the following conditions
   are met:

     1. Redistributions of source code must retain the above copyright
        notice, this list of conditions and the following disclaimer.

     2. Redistributions in binary form must reproduce the above copyright
        notice, this list of conditions and the following disclaimer in the
        documentation and/or other materials provided with the distribution.

     3. The names of its contributors may not be used to endorse or promote
        products derived from this software without specific prior written
        permission.

   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
   "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
   LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
   A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
   CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
   EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
   PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
   PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
   LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
   NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
   SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

sprintf.js from the php.js project - https://github.com/kvz/phpjs
Directly from https://github.com/kvz/phpjs/blob/master/functions/strings/sprintf.js

php.js is copyright 2012 Kevin van Zonneveld.

Portions copyright Brett Zamir (http://brett-zamir.me), Kevin van Zonneveld
(http://kevin.vanzonneveld.net), Onno Marsman, Theriault, Michael White
(http://getsprink.com), Waldo Malqui Silva, Paulo Freitas, Jack, Jonas
Raoni Soares Silva (http://www.jsfromhell.com), Philip Peterson, Legaev
Andrey, Ates Goral (http://magnetiq.com), Alex, Ratheous, Martijn Wieringa,
Rafa? Kukawski (http://blog.kukawski.pl), lmeyrick
(https://sourceforge.net/projects/bcmath-js/), Nate, Philippe Baumann,
Enrique Gonzalez, Webtoolkit.info (http://www.webtoolkit.info/), Carlos R.
L. Rodrigues (http://www.jsfromhell.com), Ash Searle
(http://hexmen.com/blog/), Jani Hartikainen, travc, Ole Vrijenhoek,
Erkekjetter, Michael Grier, Rafa? Kukawski (http://kukawski.pl), Johnny
Mast (http://www.phpvrouwen.nl), T.Wild, d3x,
http://stackoverflow.com/questions/57803/how-to-convert-decimal-to-hex-in-javascript,
Rafa? Kukawski (http://blog.kukawski.pl/), stag019, pilus, WebDevHobo
(http://webdevhobo.blogspot.com/), marrtins, GeekFG
(http://geekfg.blogspot.com), Andrea Giammarchi
(http://webreflection.blogspot.com), Arpad Ray (mailto:arpad@php.net),
gorthaur, Paul Smith, Tim de Koning (http://www.kingsquare.nl), Joris, Oleg
Eremeev, Steve Hilder, majak, gettimeofday, KELAN, Josh Fraser
(http://onlineaspect.com/2007/06/08/auto-detect-a-time-zone-with-javascript/),
Marc Palau, Martin
(http://www.erlenwiese.de/), Breaking Par Consulting Inc
(http://www.breakingpar.com/bkp/home.nsf/0/87256B280015193F87256CFB006C45F7),
Chris, Mirek Slugen, saulius, Alfonso Jimenez
(http://www.alfonsojimenez.com), Diplom@t (http://difane.com/), felix,
Mailfaker (http://www.weedem.fr/), Tyler Akins (http://rumkin.com), Caio
Ariede (http://caioariede.com), Robin, Kankrelune
(http://www.webfaktory.info/), Karol Kowalski, Imgen Tata
(http://www.myipdf.com/), mdsjack (http://www.mdsjack.bo.it), Dreamer,
Felix Geisendoerfer (http://www.debuggable.com/felix), Lars Fischer, AJ,
David, Aman Gupta, Michael White, Public Domain
(http://www.json.org/json2.js), Steven Levithan
(http://blog.stevenlevithan.com), Sakimori, Pellentesque Malesuada,
Thunder.m, Dj (http://phpjs.org/functions/htmlentities:425#comment_134018),
Steve Clay, David James, Francois, class_exists, nobbler, T. Wild, Itsacon
(http://www.itsacon.net/), date, Ole Vrijenhoek (http://www.nervous.nl/),
Fox, Raphael (Ao RUDLER), Marco, noname, Mateusz "loonquawl" Zalega, Frank
Forte, Arno, ger, mktime, john (http://www.jd-tech.net), Nick Kolosov
(http://sammy.ru), marc andreu, Scott Cariss, Douglas Crockford
(http://javascript.crockford.com), madipta, Slawomir Kaniecki,
ReverseSyntax, Nathan, Alex Wilson, kenneth, Bayron Guevara, Adam Wallner
(http://web2.bitbaro.hu/), paulo kuong, jmweb, Lincoln Ramsay, djmix,
Pyerre, Jon Hohle, Thiago Mata (http://thiagomata.blog.com), lmeyrick
(https://sourceforge.net/projects/bcmath-js/this.), Linuxworld, duncan,
Gilbert, Sanjoy Roy, Shingo, sankai, Oskar Larsson H?gfeldt
(http://oskar-lh.name/), Denny Wardhana, 0m3r, Everlasto, Subhasis Deb,
josh, jd, Pier Paolo Ramon (http://www.mastersoup.com/), P, merabi, Soren
Hansen, Eugene Bulkin (http://doubleaw.com/), Der Simon
(http://innerdom.sourceforge.net/), echo is bad, Ozh, XoraX
(http://www.xorax.info), EdorFaus, JB, J A R, Marc Jansen, Francesco, LH,
Stoyan Kyosev (http://www.svest.org/), nord_ua, omid
(http://phpjs.org/functions/380:380#comment_137122), Brad Touesnard, MeEtc
(http://yass.meetcweb.com), Peter-Paul Koch
(http://www.quirksmode.org/js/beat.html), Olivier Louvignes
(http://mg-crea.com/), T0bsn, Tim Wiel, Bryan Elliott, Jalal Berrami,
Martin, JT, David Randall, Thomas Beaucourt (http://www.webapp.fr), taith,
vlado houba, Pierre-Luc Paour, Kristof Coomans (SCK-CEN Belgian Nucleair
Research Centre), Martin Pool, Kirk Strobeck, Rick Waldron, Brant Messenger
(http://www.brantmessenger.com/), Devan Penner-Woelk, Saulo Vallory, Wagner
B. Soares, Artur Tchernychev, Valentina De Rosa, Jason Wong
(http://carrot.org/), Christoph, Daniel Esteban, strftime, Mick@el, rezna,
Simon Willison (http://simonwillison.net), Anton Ongson, Gabriel Paderni,
Marco van Oort, penutbutterjelly, Philipp Lenssen, Bjorn Roesbeke
(http://www.bjornroesbeke.be/), Bug?, Eric Nagel, Tomasz Wesolowski,
Evertjan Garretsen, Bobby Drake, Blues (http://tech.bluesmoon.info/), Luke
Godfrey, Pul, uestla, Alan C, Ulrich, Rafal Kukawski, Yves Sucaet,
sowberry, Norman "zEh" Fuchs, hitwork, Zahlii, johnrembo, Nick Callen,
Steven Levithan (stevenlevithan.com), ejsanders, Scott Baker, Brian Tafoya
(http://www.premasolutions.com/), Philippe Jausions
(http://pear.php.net/user/jausions), Aidan Lister
(http://aidanlister.com/), Rob, e-mike, HKM, ChaosNo1, metjay, strcasecmp,
strcmp, Taras Bogach, jpfle, Alexander Ermolaev
(http://snippets.dzone.com/user/AlexanderErmolaev), DxGx, kilops, Orlando,
dptr1988, Le Torbi, James (http://www.james-bell.co.uk/), Pedro Tainha
(http://www.pedrotainha.com), James, Arnout Kazemier
(http://www.3rd-Eden.com), Chris McMacken, gabriel paderni, Yannoo,
FGFEmperor, baris ozdil, Tod Gentille, Greg Frazier, jakes, 3D-GRAF, Allan
Jensen (http://www.winternet.no), Howard Yeend, Benjamin Lupton, davook,
daniel airton wermann (http://wermann.com.br), Atli T¨®r, Maximusya, Ryan
W Tenney (http://ryan.10e.us), Alexander M Beedie, fearphage
(http://http/my.opera.com/fearphage/), Nathan Sepulveda, Victor, Matteo,
Billy, stensi, Cord, Manish, T.J. Leahy, Riddler
(http://www.frontierwebdev.com/), Rafa? Kukawski, FremyCompany, Matt
Bradley, Tim de Koning, Luis Salazar (http://www.freaky-media.com/), Diogo
Resende, Rival, Andrej Pavlovic, Garagoth, Le Torbi
(http://www.letorbi.de/), Dino, Josep Sanz (http://www.ws3.es/), rem,
Russell Walker (http://www.nbill.co.uk/), Jamie Beck
(http://www.terabit.ca/), setcookie, Michael, YUI Library:
http://developer.yahoo.com/yui/docs/YAHOO.util.DateLocale.html, Blues at
http://hacks.bluesmoon.info/strftime/strftime.js, Ben
(http://benblume.co.uk/), DtTvB
(http://dt.in.th/2008-09-16.string-length-in-bytes.html), Andreas, William,
meo, incidence, Cagri Ekin, Amirouche, Amir Habibi
(http://www.residence-mixte.com/), Luke Smith (http://lucassmith.name),
Kheang Hok Chin (http://www.distantia.ca/), Jay Klehr, Lorenzo Pisani,
Tony, Yen-Wei Liu, Greenseed, mk.keck, Leslie Hoare, dude, booeyOH, Ben
Bryan

Licensed under the MIT (MIT-LICENSE.txt) license.

Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be included
in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL KEVIN VAN ZONNEVELD BE LIABLE FOR ANY CLAIM, DAMAGES
OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.

  fontmetrics.js - https://github.com/Pomax/fontmetrics.js

  Copyright (C) 2011 by Mike "Pomax" Kamermans

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  THE SOFTWARE.

 Copyright (c) 2013 Gildas Lormeau. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions are met:

 1. Redistributions of source code must retain the above copyright notice,
 this list of conditions and the following disclaimer.

 2. Redistributions in binary form must reproduce the above copyright
 notice, this list of conditions and the following disclaimer in
 the documentation and/or other materials provided with the distribution.

 3. The names of the authors may not be used to endorse or promote products
 derived from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED ``AS IS'' AND ANY EXPRESSED OR IMPLIED WARRANTIES,
 INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND
 FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL JCRAFT,
 INC. OR ANY CONTRIBUTORS TO THIS SOFTWARE BE LIABLE FOR ANY DIRECT, INDIRECT,
 INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,
 OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

topojson - https://github.com/mbostock/topojson

Copyright (c) 2012, Michael Bostock
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

 Redistributions of source code must retain the above copyright notice, this
  list of conditions and the following disclaimer.

 Redistributions in binary form must reproduce the above copyright notice,
  this list of conditions and the following disclaimer in the documentation
  and/or other materials provided with the distribution.

 The name Michael Bostock may not be used to endorse or promote products
  derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL MICHAEL BOSTOCK BE LIABLE FOR ANY DIRECT,
INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:
  * Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.
  * Redistributions in binary form must reproduce the above copyright
    notice, this list of conditions and the following disclaimer in the
    documentation and/or other materials provided with the distribution.
  * Neither the name of NVIDIA CORPORATION nor the names of its
    contributors may be used to endorse or promote products derived
    from this software without specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
 EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:

 * Redistributions of source code must retain the above copyright notice,
   this list of conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.
 * Neither the name of the project nor the names of its contributors may be
   used to endorse or promote products derived from this software without
   specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 Modifications made by Analytical Graphics, Inc.

 Copyright (c) 2000-2005, Sean O'Neil (s_p_oneil@hotmail.com)
 All rights reserved.

 Redistribution and use in source and binary forms, with or without
 modification, are permitted provided that the following conditions
 are met:

 * Redistributions of source code must retain the above copyright notice,
   this list of conditions and the following disclaimer.
 * Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.
 * Neither the name of the project nor the names of its contributors may be
   used to endorse or promote products derived from this software without
   specific prior written permission.

 THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE
 FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
 DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
 SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
 CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
 OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

 Modifications made by Analytical Graphics, Inc.

 Knockout ES5 plugin - https://github.com/SteveSanderson/knockout-es5
 Copyright (c) Steve Sanderson
 MIT license

tween.js - https://github.com/sole/tween.js

Copyright (c) 2010-2012 Tween.js authors.

Easing equations Copyright (c) 2001 Robert Penner http://robertpenner.com/easing/

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(Pa,pb,F){if(F.get||F.set)throw new TypeError("ES3 does not support getters and setters.");Pa!=Array.prototype&&Pa!=Object.prototype&&(Pa[pb]=F.value)};$jscomp.getGlobal=function(Pa){return"undefined"!=typeof window&&window===Pa?Pa:"undefined"!=typeof global?global:Pa};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(Pa){return $jscomp.SYMBOL_PREFIX+(Pa||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var Pa=$jscomp.global.Symbol.iterator;Pa||(Pa=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[Pa]&&$jscomp.defineProperty(Array.prototype,Pa,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(Pa){var pb=0;return $jscomp.iteratorPrototype(function(){return pb<Pa.length?{done:!1,value:Pa[pb++]}:{done:!0}})};$jscomp.iteratorPrototype=function(Pa){$jscomp.initSymbolIterator();Pa={next:Pa};Pa[$jscomp.global.Symbol.iterator]=function(){return this};return Pa};$jscomp.makeIterator=function(Pa){$jscomp.initSymbolIterator();var pb=Pa[Symbol.iterator];return pb?pb.call(Pa):$jscomp.arrayIterator(Pa)};$jscomp.arrayFromIterator=function(Pa){for(var pb,F=[];!(pb=Pa.next()).done;)F.push(pb.value);return F};$jscomp.arrayFromIterable=function(Pa){return Pa instanceof Array?Pa:$jscomp.arrayFromIterator($jscomp.makeIterator(Pa))};
(function(){var Pa,pb,F;(function(b){function a(a,b){var d,h,e,f,g,k,l,p,m,q=b&&b.split("/"),u=c.map,y=u&&u["*"]||{};if(a){a=a.split("/");g=a.length-1;c.nodeIdCompat&&z.test(a[g])&&(a[g]=a[g].replace(z,""));"."===a[0].charAt(0)&&q&&(g=q.slice(0,q.length-1),a=g.concat(a));for(g=0;g<a.length;g++)d=a[g],"."===d?(a.splice(g,1),--g):".."===d&&0!==g&&(1!==g||".."!==a[2])&&".."!==a[g-1]&&0<g&&(a.splice(g-1,2),g-=2);a=a.join("/")}if((q||y)&&u){d=a.split("/");for(g=d.length;0<g;--g){h=d.slice(0,g).join("/");if(q)for(m=q.length;0<m;--m)if(e=u[q.slice(0,m).join("/")])if(e=e[h]){f=e;k=g;break}if(f)break;!l&&y&&y[h]&&(l=y[h],p=g)}!f&&l&&(f=l,k=p);f&&(d.splice(0,k,f),a=d.join("/"))}return a}function f(c,a){return function(){var d=A.call(arguments,0);"string"!==typeof d[0]&&1===d.length&&d.push(null);return p.apply(b,d.concat([c,a]))}}function k(c){return function(b){return a(b,c)}}function g(c){return function(a){t[c]=a}}function l(c){if(y.call(r,c)){var a=r[c];delete r[c];u[c]=!0;h.apply(b,a)}if(!y.call(t,c)&&!y.call(u,c))throw Error("No "+c);return t[c]}function m(c){var a,b=c?c.indexOf("!"):-1;-1<b&&(a=c.substring(0,b),c=c.substring(b+1,c.length));return[a,c]}function e(a){return function(){return c&&c.config&&c.config[a]||{}}}var h,p,d,q,t={},r={},c={},u={},y=Object.prototype.hasOwnProperty,A=[].slice,z=/\.js$/;d=function(c,b){var d,h=m(c),e=h[0],f=b[1];c=h[1];e&&(e=a(e,f),d=l(e));e?c=d&&d.normalize?d.normalize(c,k(f)):a(c,f):(c=a(c,f),h=m(c),e=h[0],c=h[1],e&&(d=l(e)));return{f:e?e+"!"+c:c,n:c,pr:e,p:d}};q={require:function(c){return f(c)},exports:function(c){var a=t[c];return"undefined"!==typeof a?a:t[c]={}},module:function(c){return{id:c,uri:"",exports:t[c],config:e(c)}}};h=function(c,a,h,e){var B,k,p,v,z,A=[];k=typeof h;var x;z=(e=e||c)?m(e):[];if("undefined"===k||"function"===k){a=!a.length&&h.length?["require","exports","module"]:a;for(v=0;v<a.length;v+=1)if(p=d(a[v],z),k=p.f,"require"===k)A[v]=q.require(c);else if("exports"===k)A[v]=q.exports(c),x=!0;else if("module"===k)B=A[v]=q.module(c);else if(y.call(t,k)||y.call(r,k)||y.call(u,k))A[v]=l(k);else if(p.p)p.p.load(p.n,f(e,!0),g(k),{}),A[v]=t[k];else throw Error(c+" missing "+k);a=h?h.apply(t[c],A):void 0;c&&(B&&B.exports!==b&&B.exports!==t[c]?t[c]=B.exports:a===b&&x||(t[c]=a))}else c&&(t[c]=h)};Pa=pb=p=function(a,e,f,g,k){if("string"===typeof a)return q[a]?q[a](e):l(d(a,e?m(e):[]).f);if(!a.splice){c=a;c.deps&&p(c.deps,c.callback);if(!e)return;e.splice?(a=e,e=f,f=null):a=b}e=e||function(){};"function"===typeof f&&(f=g,g=k);g?h(b,a,e,f):setTimeout(function(){h(b,a,e,f)},4);return p};p.config=function(c){return p(c)};Pa._defined=t;F=function(c,a,b){if("string"!==typeof c)throw Error("See almond README: incorrect module build, no module name");a.splice||(b=a,a=[]);y.call(t,c)||y.call(r,c)||(r[c]=[c,a,b])};F.amd={jQuery:!0}})();F("Core/appendForwardSlash",[],function(){return function(b){if(0===b.length||"/"!==b[b.length-1])b+="/";return b}});F("Core/defined",[],function(){return function(b){return void 0!==b&&null!==b}});F("Core/DeveloperError",["./defined"],function(b){function a(a){this.name="DeveloperError";this.message=a;try{throw Error();}catch(k){a=k.stack}this.stack=a}b(Object.create)&&(a.prototype=Object.create(Error.prototype),a.prototype.constructor=a);a.prototype.toString=function(){var a=this.name+": "+this.message;b(this.stack)&&(a+="\n"+this.stack.toString());return a};a.throwInstantiationError=function(){throw new a("This function defines an interface and should not be called directly.");};return a});F("ThirdParty/Uri",[],function(){function b(a){a instanceof b?(this.scheme=a.scheme,this.authority=a.authority,this.path=a.path,this.query=a.query,this.fragment=a.fragment):a&&(a=k.exec(a),this.scheme=a[1],this.authority=a[2],this.path=a[3],this.query=a[4],this.fragment=a[5])}function a(a){var b=unescape(a);return l.test(b)?b:a.toUpperCase()}function f(a,b,f,d){return(b||"")+f.toLowerCase()+(d||"")}b.prototype.scheme=null;b.prototype.authority=null;b.prototype.path="";b.prototype.query=null;b.prototype.fragment=null;var k=/^(?:([^:/?#]+):)?(?:\/\/([^/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?$/;b.prototype.getScheme=function(){return this.scheme};b.prototype.getAuthority=function(){return this.authority};b.prototype.getPath=function(){return this.path};b.prototype.getQuery=function(){return this.query};b.prototype.getFragment=function(){return this.fragment};b.prototype.isAbsolute=function(){return!!this.scheme&&!this.fragment};b.prototype.isSameDocumentAs=function(a){return a.scheme==this.scheme&&a.authority==this.authority&&a.path==this.path&&a.query==this.query};b.prototype.equals=function(a){return this.isSameDocumentAs(a)&&a.fragment==this.fragment};b.prototype.normalize=function(){this.removeDotSegments();this.scheme&&(this.scheme=this.scheme.toLowerCase());this.authority&&(this.authority=this.authority.replace(m,f).replace(g,a));this.path&&(this.path=this.path.replace(g,a));this.query&&(this.query=this.query.replace(g,a));this.fragment&&(this.fragment=this.fragment.replace(g,a))};var g=/%[0-9a-z]{2}/gi,l=/[a-zA-Z0-9\-\._~]/,m=/(.*@)?([^@:]*)(:.*)?/;b.prototype.resolve=function(a){var h=new b;this.scheme?(h.scheme=this.scheme,h.authority=this.authority,h.path=this.path,h.query=this.query):(h.scheme=a.scheme,this.authority?(h.authority=this.authority,h.path=this.path,h.query=this.query):(h.authority=a.authority,""==this.path?(h.path=a.path,h.query=this.query||a.query):("/"==this.path.charAt(0)?h.path=this.path:h.path=a.authority&&""==a.path?"/"+this.path:a.path.substring(0,a.path.lastIndexOf("/")+1)+this.path,h.removeDotSegments(),h.query=this.query)));h.fragment=this.fragment;return h};b.prototype.removeDotSegments=function(){var a=this.path.split("/"),b=[],f,d=""==a[0];d&&a.shift();for(""==a[0]&&a.shift();a.length;)f=a.shift(),".."==f?b.pop():"."!=f&&b.push(f);"."!=f&&".."!=f||b.push("");d&&b.unshift("");this.path=b.join("/")};b.prototype.toString=function(){var a="";this.scheme&&(a+=this.scheme+":");this.authority&&(a+="//"+this.authority);a+=this.path;this.query&&(a+="?"+this.query);this.fragment&&(a+="#"+this.fragment);return a};return b});F("Core/freezeObject",["./defined"],function(b){var a=Object.freeze;b(a)||(a=function(a){return a});return a});F("Core/defaultValue",["./freezeObject"],function(b){function a(a,b){return void 0!==a&&null!==a?a:b}a.EMPTY_OBJECT=b({});return a});F("Core/getAbsoluteUri",["../ThirdParty/Uri","./defaultValue","./defined","./DeveloperError"],function(b,a,f,k){function g(a,b){var e;"undefined"!==typeof document&&(e=document);return g._implementation(a,b,e)}g._implementation=function(g,m,e){if(!f(g))throw new k("relative uri is required.");if(!f(m)){if("undefined"===typeof e)return g;m=a(e.baseURI,e.location.href)}m=new b(m);return(new b(g)).resolve(m).toString()};return g});(function(b){b("ThirdParty/when",[],function(){function a(c,a,d,h){return b(c).then(a,d,h)}function b(c){var a;c instanceof k||(e(c)?(a=m(),c.then(function(c){a.resolve(c)},function(c){a.reject(c)},function(c){a.progress(c)}),c=a.promise):c=g(c));return c}function k(c){this.then=c}function g(c){return new k(function(a){try{return b(a?a(c):c)}catch(D){return l(D)}})}function l(c){return new k(function(a,d){try{return d?b(d(c)):l(c)}catch(v){return l(v)}})}function m(){function c(c,a,b){return p(c,a,b)}function a(c){return y(c)}function d(c){return y(l(c))}function h(c){return u(c)}var e,f,g,p,u,y;e=new k(c);e={then:c,resolve:a,reject:d,progress:h,promise:e,resolver:{resolve:a,reject:d,progress:h}};f=[];g=[];p=function(c,a,b){var d,h;d=m();h="function"===typeof b?function(c){try{d.progress(b(c))}catch(O){d.progress(O)}}:function(c){d.progress(c)};f.push(function(b){b.then(c,a).then(d.resolve,d.reject,h)});g.push(h);return d.promise};u=function(c){q(g,c);return c};y=function(c){c=b(c);p=c.then;y=b;u=r;q(f,c);g=f=A;return c};return e}function e(c){return c&&"function"===typeof c.then}function h(c,b,d,h,e){t(2,arguments);return a(c,function(c){function f(c){u(c)}function g(c){q(c)}var B,k,l,p,C,q,u,y,v,z;v=c.length>>>0;B=Math.max(0,Math.min(b,v));l=[];k=v-B+1;p=[];C=m();if(B)for(y=C.progress,u=function(c){p.push(c);--k||(q=u=r,C.reject(p))},q=function(c){l.push(c);--B||(q=u=r,C.resolve(l))},z=0;z<v;++z)z in c&&a(c[z],g,f,y);else C.resolve(l);return C.then(d,h,e)})}function p(a,b,h,e){t(1,arguments);return d(a,c).then(b,h,e)}function d(c,b){return a(c,function(c){var d,h,e,f,g,k;e=h=c.length>>>0;d=[];k=m();if(e)for(f=function(c,h){a(c,b).then(function(c){d[h]=c;--e||k.resolve(d)},k.reject)},g=0;g<h;g++)g in c?f(c[g],g):--e;else k.resolve(d);return k.promise})}function q(c,a){for(var b,d=0;b=c[d++];)b(a)}function t(c,a){for(var b,d=a.length;d>c;)if(b=a[--d],null!=b&&"function"!=typeof b)throw Error("arg "+d+" must be a function");}function r(){}function c(c){return c}var u,y,A;a.defer=m;a.resolve=b;a.reject=function(c){return a(c,l)};a.join=function(){return d(arguments,c)};a.all=p;a.map=d;a.reduce=function(c,b){var d=y.call(arguments,1);return a(c,function(c){var h;h=c.length;d[0]=function(c,d,e){return a(c,function(c){return a(d,function(a){return b(c,a,e,h)})})};return u.apply(c,d)})};a.any=function(c,a,b,d){return h(c,1,function(c){return a?a(c[0]):c[0]},b,d)};a.some=h;a.chain=function(c,b,d){var h=2<arguments.length;return a(c,function(c){c=h?d:c;b.resolve(c);return c},function(c){b.reject(c);return l(c)},b.progress)};a.isPromise=e;k.prototype={always:function(c,a){return this.then(c,c,a)},otherwise:function(c){return this.then(A,c)},yield:function(c){return this.then(function(){return c})},spread:function(c){return this.then(function(a){return p(a,function(a){return c.apply(A,a)})})}};y=[].slice;u=[].reduce||function(c){var a,b,d,h;h=0;a=Object(this);d=a.length>>>0;b=arguments;if(1>=b.length)for(;;){if(h in a){b=a[h++];break}if(++h>=d)throw new TypeError;}else b=b[1];for(;h<d;++h)h in a&&(b=c(b,a[h],h,a));return b};return a})})("function"==typeof F&&F.amd?F:function(b){"object"===typeof exports?module.exports=b():this.when=b()});F("Core/Check",["./defined","./DeveloperError"],function(b,a){function f(a,b,f){return"Expected "+f+" to be typeof "+b+", actual typeof was "+a}var k={typeOf:{},defined:function(f,k){if(!b(k))throw new a(f+" is required, actual value was undefined");}};k.typeOf.func=function(b,k){if("function"!==typeof k)throw new a(f(typeof k,"function",b));};k.typeOf.string=function(b,k){if("string"!==typeof k)throw new a(f(typeof k,"string",b));};k.typeOf.number=function(b,k){if("number"!==typeof k)throw new a(f(typeof k,"number",b));};k.typeOf.number.lessThan=function(b,f,m){k.typeOf.number(b,f);if(f>=m)throw new a("Expected "+b+" to be less than "+m+", actual value was "+f);};k.typeOf.number.lessThanOrEquals=function(b,f,m){k.typeOf.number(b,f);if(f>m)throw new a("Expected "+b+" to be less than or equal to "+m+", actual value was "+f);};k.typeOf.number.greaterThan=function(b,f,m){k.typeOf.number(b,f);if(f<=m)throw new a("Expected "+b+" to be greater than "+m+", actual value was "+f);};k.typeOf.number.greaterThanOrEquals=function(b,f,m){k.typeOf.number(b,f);if(f<m)throw new a("Expected "+b+" to be greater than or equal to"+m+", actual value was "+f);};k.typeOf.object=function(b,k){if("object"!==typeof k)throw new a(f(typeof k,"object",b));};k.typeOf.bool=function(b,k){if("boolean"!==typeof k)throw new a(f(typeof k,"boolean",b));};k.typeOf.number.equals=function(b,f,m,e){k.typeOf.number(b,m);k.typeOf.number(f,e);if(m!==e)throw new a(b+" must be equal to "+f+", the actual values are "+m+" and "+e);};return k});F("Core/clone",["./defaultValue"],function(b){function a(f,k){if(null===f||"object"!==typeof f)return f;k=b(k,!1);var g=new f.constructor,l;for(l in f)if(f.hasOwnProperty(l)){var m=f[l];k&&(m=a(m,k));g[l]=m}return g}return a});F("Core/combine",["./defaultValue","./defined"],function(b,a){function f(k,g,l){l=b(l,!1);var m={},e=a(k),h=a(g),p,d;if(e)for(p in k)k.hasOwnProperty(p)&&(e=k[p],h&&l&&"object"===typeof e&&g.hasOwnProperty(p)?(d=g[p],m[p]="object"===typeof d?f(e,d,l):e):m[p]=e);if(h)for(p in g)g.hasOwnProperty(p)&&!m.hasOwnProperty(p)&&(d=g[p],m[p]=d);return m}return f});F("Core/defineProperties",["./defined"],function(b){var a;try{a="x"in Object.defineProperty({},"x",{})}catch(k){a=!1}var f=Object.defineProperties;a&&b(f)||(f=function(a){return a});return f});F("Core/getBaseUri",["../ThirdParty/Uri","./defined","./DeveloperError"],function(b,a,f){return function(k,g){if(!a(k))throw new f("uri is required.");var l="",m=k.lastIndexOf("/");-1!==m&&(l=k.substring(0,m+1));if(!g)return l;k=new b(k);a(k.query)&&(l+="?"+k.query);a(k.fragment)&&(l+="#"+k.fragment);return l}});F("Core/getExtensionFromUri",["../ThirdParty/Uri","./defined","./DeveloperError"],function(b,a,f){return function(k){if(!a(k))throw new f("uri is required.");k=new b(k);k.normalize();k=k.path;var g=k.lastIndexOf("/");-1!==g&&(k=k.substr(g+1));g=k.lastIndexOf(".");return k=-1===g?"":k.substr(g+1)}});F("Core/isBlobUri",["./Check"],function(b){var a=/^blob:/i;return function(f){b.typeOf.string("uri",f);return a.test(f)}});F("Core/isCrossOriginUrl",["./defined"],function(b){var a;return function(f){b(a)||(a=document.createElement("a"));a.href=window.location.href;var k=a.host,g=a.protocol;a.href=f;a.href=a.href;return g!==a.protocol||k!==a.host}});F("Core/isDataUri",["./Check"],function(b){var a=/^data:/i;return function(f){b.typeOf.string("uri",f);return a.test(f)}});F("Core/loadAndExecuteScript",["../ThirdParty/when"],function(b){return function(a){var f=b.defer(),k=document.createElement("script");k.async=!0;k.src=a;var g=document.getElementsByTagName("head")[0];k.onload=function(){k.onload=void 0;g.removeChild(k);f.resolve()};k.onerror=function(a){f.reject(a)};g.appendChild(k);return f.promise}});F("Core/isArray",["./defined"],function(b){var a=Array.isArray;b(a)||(a=function(a){return"[object Array]"===Object.prototype.toString.call(a)});return a});F("Core/objectToQuery",["./defined","./DeveloperError","./isArray"],function(b,a,f){return function(k){if(!b(k))throw new a("obj is required.");var g="",l;for(l in k)if(k.hasOwnProperty(l)){var m=k[l],e=encodeURIComponent(l)+"\x3d";if(f(m))for(var h=0,p=m.length;h<p;++h)g+=e+encodeURIComponent(m[h])+"\x26";else g+=e+encodeURIComponent(m)+"\x26"}return g=g.slice(0,-1)}});F("Core/queryToObject",["./defined","./DeveloperError","./isArray"],function(b,a,f){return function(k){if(!b(k))throw new a("queryString is required.");var g={};if(""===k)return g;k=k.replace(/\+/g,"%20").split(/[&;]/);for(var l=0,m=k.length;l<m;++l){var e=k[l].split("\x3d"),h=decodeURIComponent(e[0]),e=e[1],e=b(e)?decodeURIComponent(e):"",p=g[h];"string"===typeof p?g[h]=[p,e]:f(p)?p.push(e):g[h]=e}return g}});F("Core/RequestState",["../Core/freezeObject"],function(b){return b({UNISSUED:0,ISSUED:1,ACTIVE:2,RECEIVED:3,CANCELLED:4,FAILED:5})});F("Core/RequestType",["../Core/freezeObject"],function(b){return b({TERRAIN:0,IMAGERY:1,TILES3D:2,OTHER:3})});F("Core/Request",["./defaultValue","./defined","./RequestState","./RequestType"],function(b,a,f,k){function g(a){a=b(a,b.EMPTY_OBJECT);var g=b(a.throttleByServer,!1),e=b(a.throttle,!1);this.url=a.url;this.requestFunction=a.requestFunction;this.cancelFunction=a.cancelFunction;this.priorityFunction=a.priorityFunction;this.priority=b(a.priority,0);this.throttle=e;this.throttleByServer=g;this.type=b(a.type,k.OTHER);this.serverKey=void 0;this.state=f.UNISSUED;this.deferred=void 0;this.cancelled=!1}g.prototype.cancel=function(){this.cancelled=!0};g.prototype.clone=function(b){if(!a(b))return new g(this);b.url=this.url;b.requestFunction=this.requestFunction;b.cancelFunction=this.cancelFunction;b.priorityFunction=this.priorityFunction;b.priority=this.priority;b.throttle=this.throttle;b.throttleByServer=this.throttleByServer;b.type=this.type;b.serverKey=this.serverKey;b.state=this.RequestState.UNISSUED;b.deferred=void 0;b.cancelled=!1;return b};return g});F("Core/parseResponseHeaders",[],function(){return function(b){var a={};if(!b)return a;b=b.split("\r\n");for(var f=0;f<b.length;++f){var k=b[f],g=k.indexOf(": ");if(0<g){var l=k.substring(0,g),k=k.substring(g+2);a[l]=k}}return a}});F("Core/RequestErrorEvent",["./defined","./parseResponseHeaders"],function(b,a){function f(b,f,l){this.statusCode=b;this.response=f;this.responseHeaders=l;"string"===typeof this.responseHeaders&&(this.responseHeaders=a(this.responseHeaders))}f.prototype.toString=function(){var a="Request has failed.";b(this.statusCode)&&(a+=" Status Code: "+this.statusCode);return a};return f});F("Core/Event",["./Check","./defined","./defineProperties"],function(b,a,f){function k(){this._listeners=[];this._scopes=[];this._toRemove=[];this._insideRaiseEvent=!1}function g(a,b){return b-a}f(k.prototype,{numberOfListeners:{get:function(){return this._listeners.length-this._toRemove.length}}});k.prototype.addEventListener=function(a,f){b.typeOf.func("listener",a);this._listeners.push(a);this._scopes.push(f);var e=this;return function(){e.removeEventListener(a,f)}};k.prototype.removeEventListener=function(a,f){b.typeOf.func("listener",a);for(var e=this._listeners,h=this._scopes,g=-1,d=0;d<e.length;d++)if(e[d]===a&&h[d]===f){g=d;break}return-1!==g?(this._insideRaiseEvent?(this._toRemove.push(g),e[g]=void 0,h[g]=void 0):(e.splice(g,1),h.splice(g,1)),!0):!1};k.prototype.raiseEvent=function(){this._insideRaiseEvent=!0;var b,f=this._listeners,e=this._scopes,h=f.length;for(b=0;b<h;b++)a(f[b])&&f[b].apply(e[b],arguments);var k=this._toRemove,h=k.length;if(0<h){k.sort(g);for(b=0;b<h;b++){var d=k[b];f.splice(d,1);e.splice(d,1)}k.length=0}this._insideRaiseEvent=!1};return k});F("Core/Heap",["./Check","./defaultValue","./defined","./defineProperties"],function(b,a,f,k){function g(a){b.typeOf.object("options",a);b.defined("options.comparator",a.comparator);this._comparator=a.comparator;this._array=[];this._length=0;this._maximumLength=void 0}function l(a,b,h){var f=a[b];a[b]=a[h];a[h]=f}k(g.prototype,{length:{get:function(){return this._length}},internalArray:{get:function(){return this._array}},maximumLength:{get:function(){return this._maximumLength},set:function(a){this._maximumLength=a;this._length>a&&0<a&&(this._length=a,this._array.length=a)}},comparator:{get:function(){return this._comparator}}});g.prototype.reserve=function(b){b=a(b,this._length);this._array.length=b};g.prototype.heapify=function(b){b=a(b,0);for(var f=this._length,h=this._comparator,g=this._array,d,k=!0;k;){var m=2*(b+1);d=m-1;d=d<f&&0>h(g[d],g[b])?d:b;m<f&&0>h(g[m],g[d])&&(d=m);d!==b?(l(g,d,b),b=d):k=!1}};g.prototype.resort=function(){for(var a=Math.ceil(this._length/2);0<=a;--a)this.heapify(a)};g.prototype.insert=function(a){b.defined("element",a);var e=this._array,h=this._comparator,g=this._maximumLength,d=this._length++;for(d<e.length?e[d]=a:e.push(a);0!==d;)if(a=Math.floor((d-1)/2),0>h(e[d],e[a]))l(e,d,a),d=a;else break;var k;f(g)&&this._length>g&&(k=e[g],this._length=g);return k};g.prototype.pop=function(f){f=a(f,0);if(0!==this._length){b.typeOf.number.lessThan("index",f,this._length);var e=this._array,h=e[f];l(e,f,--this._length);this.heapify(f);return h}};return g});F("Core/RequestScheduler","../ThirdParty/Uri ../ThirdParty/when ./Check ./defaultValue ./defined ./defineProperties ./Event ./Heap ./isBlobUri ./isDataUri ./RequestState".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(){}function t(c){var a=k(q.requestsByServer[c],q.maximumRequestsPerServer);return B[c]<a}function r(c){c.state===d.UNISSUED&&(c.state=d.ISSUED,c.deferred=a.defer());return c.deferred.promise}function c(c){return function(a){c.state!==d.CANCELLED&&(--z.numberOfActiveRequests,--B[c.serverKey],I.raiseEvent(),c.state=d.RECEIVED,c.deferred.resolve(a))}}function u(c){return function(a){c.state!==d.CANCELLED&&(++z.numberOfFailedRequests,--z.numberOfActiveRequests,--B[c.serverKey],I.raiseEvent(a),c.state=d.FAILED,c.deferred.reject(a))}}function y(a){var b=r(a);a.state=d.ACTIVE;v.push(a);++z.numberOfActiveRequests;++z.numberOfActiveRequestsEver;++B[a.serverKey];a.requestFunction().then(c(a)).otherwise(u(a));return b}function A(c){var a=c.state===d.ACTIVE;c.state=d.CANCELLED;++z.numberOfCancelledRequests;c.deferred.reject();a&&(--z.numberOfActiveRequests,--B[c.serverKey],++z.numberOfCancelledActiveRequests);g(c.cancelFunction)&&c.cancelFunction()}var z={numberOfAttemptedRequests:0,numberOfActiveRequests:0,numberOfCancelledRequests:0,numberOfCancelledActiveRequests:0,numberOfFailedRequests:0,numberOfActiveRequestsEver:0,lastNumberOfActiveRequests:0},x=20,D=new e({comparator:function(c,a){return c.priority-a.priority}});D.maximumLength=x;D.reserve(x);var v=[],B={},C="undefined"!==typeof document?new b(document.location.href):new b,I=new m;q.maximumRequests=50;q.maximumRequestsPerServer=6;q.requestsByServer={"api.cesium.com:443":18,"assets.cesium.com:443":18};q.throttleRequests=!0;q.debugShowStatistics=!1;q.requestCompletedEvent=I;l(q,{statistics:{get:function(){return z}},priorityHeapLength:{get:function(){return x},set:function(c){if(c<x)for(;D.length>c;){var a=D.pop();A(a)}x=c;D.maximumLength=c;D.reserve(c)}}});q.update=function(){var c,a,b=0,h=v.length;for(c=0;c<h;++c)a=v[c],a.cancelled&&A(a),a.state!==d.ACTIVE?++b:0<b&&(v[c-b]=a);v.length-=b;a=D.internalArray;b=D.length;for(c=0;c<b;++c)h=a[c],g(h.priorityFunction)&&(h.priority=h.priorityFunction());D.resort();c=Math.max(q.maximumRequests-v.length,0);for(b=0;b<c&&0<D.length;)a=D.pop(),a.cancelled?A(a):a.throttleByServer&&!t(a.serverKey)?A(a):(y(a),++b);q.debugShowStatistics&&(0===z.numberOfActiveRequests&&0<z.lastNumberOfActiveRequests&&(0<z.numberOfAttemptedRequests&&(console.log("Number of attempted requests: "+z.numberOfAttemptedRequests),z.numberOfAttemptedRequests=0),0<z.numberOfCancelledRequests&&(console.log("Number of cancelled requests: "+z.numberOfCancelledRequests),z.numberOfCancelledRequests=0),0<z.numberOfCancelledActiveRequests&&(console.log("Number of cancelled active requests: "+z.numberOfCancelledActiveRequests),z.numberOfCancelledActiveRequests=0),0<z.numberOfFailedRequests&&(console.log("Number of failed requests: "+z.numberOfFailedRequests),z.numberOfFailedRequests=0)),z.lastNumberOfActiveRequests=z.numberOfActiveRequests)};q.getServerKey=function(c){f.typeOf.string("url",c);c=(new b(c)).resolve(C);c.normalize();var a=c.authority;/:/.test(a)||(a=a+":"+("https"===c.scheme?"443":"80"));g(B[a])||(B[a]=0);return a};q.request=function(c){f.typeOf.object("request",c);f.typeOf.string("request.url",c.url);f.typeOf.func("request.requestFunction",c.requestFunction);if(p(c.url)||h(c.url))return I.raiseEvent(),c.state=d.RECEIVED,c.requestFunction();++z.numberOfAttemptedRequests;g(c.serverKey)||(c.serverKey=q.getServerKey(c.url));if(!c.throttleByServer||t(c.serverKey)){if(!q.throttleRequests||!c.throttle)return y(c);if(!(v.length>=q.maximumRequests)){g(c.priorityFunction)&&(c.priority=c.priorityFunction());var a=D.insert(c);if(g(a)){if(a===c)return;A(a)}return r(c)}}};q.clearForSpecs=function(){for(;0<D.length;){var c=D.pop();A(c)}for(var c=v.length,a=0;a<c;++a)A(v[a]);v.length=0;B={};z.numberOfAttemptedRequests=0;z.numberOfActiveRequests=0;z.numberOfCancelledRequests=0;z.numberOfCancelledActiveRequests=0;z.numberOfFailedRequests=0;z.numberOfActiveRequestsEver=0;z.lastNumberOfActiveRequests=0};q.numberOfActiveRequestsByServer=function(c){return B[c]};q.requestHeap=D;return q});F("Core/RuntimeError",["./defined"],function(b){function a(a){this.name="RuntimeError";this.message=a;try{throw Error();}catch(k){a=k.stack}this.stack=a}b(Object.create)&&(a.prototype=Object.create(Error.prototype),a.prototype.constructor=a);a.prototype.toString=function(){var a=this.name+": "+this.message;b(this.stack)&&(a+="\n"+this.stack.toString());return a};return a});F("Core/TrustedServers",["../ThirdParty/Uri","./defined","./DeveloperError"],function(b,a,f){var k={},g={};k.add=function(b,k){if(!a(b))throw new f("host is required.");if(!a(k)||0>=k)throw new f("port is required to be greater than 0.");var e=b.toLowerCase()+":"+k;a(g[e])||(g[e]=!0)};k.remove=function(b,k){if(!a(b))throw new f("host is required.");if(!a(k)||0>=k)throw new f("port is required to be greater than 0.");var e=b.toLowerCase()+":"+k;a(g[e])&&delete g[e]};k.contains=function(k){if(!a(k))throw new f("url is required.");var l=new b(k);l.normalize();k=l.getAuthority();a(k)?(-1!==k.indexOf("@")&&(k=k.split("@")[1]),-1===k.indexOf(":")&&(l=l.getScheme(),a(l)||(l=window.location.protocol,l=l.substring(0,l.length-1)),k="http"===l?k+":80":"https"===l?k+":443":void 0)):k=void 0;return a(k)&&a(g[k])?!0:!1};k.clear=function(){g={}};return k});F("Core/Resource","../ThirdParty/Uri ../ThirdParty/when ./appendForwardSlash ./Check ./clone ./combine ./defaultValue ./defined ./defineProperties ./DeveloperError ./freezeObject ./getAbsoluteUri ./getBaseUri ./getExtensionFromUri ./isBlobUri ./isCrossOriginUrl ./isDataUri ./loadAndExecuteScript ./objectToQuery ./queryToObject ./Request ./RequestErrorEvent ./RequestScheduler ./RequestState ./RuntimeError ./TrustedServers".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H){function J(c,a,b,d){var h=c.query;if(!e(h)||0===h.length)return{};if(-1===h.indexOf("\x3d")){var f={};f[h]=void 0;h=f}else h=x(h);a._queryParameters=b?L(h,a._queryParameters,d):h;c.query=void 0}function w(c,a){var b=a._queryParameters,d=Object.keys(b);1!==d.length||e(b[d[0]])?c.query=z(b):c.query=d[0]}function G(c,a){return e(c)?e(c.clone)?c.clone():g(c):a}function E(c){if(c.state===C.ISSUED||c.state===C.ACTIVE)throw new I("The Resource is already being fetched.");c.state=C.UNISSUED;c.deferred=void 0}function L(c,a,b){if(!b)return l(c,a);c=g(c,!0);for(var d in a)if(a.hasOwnProperty(d)){b=c[d];var h=a[d];e(b)?(Array.isArray(b)||(b=c[d]=[b]),c[d]=b.concat(h)):c[d]=Array.isArray(h)?h.slice():h}return c}function K(c){c=m(c,m.EMPTY_OBJECT);"string"===typeof c&&(c={url:c});k.typeOf.string("options.url",c.url);this._url=void 0;this._templateValues=G(c.templateValues,{});this._queryParameters=G(c.queryParameters,{});this.headers=G(c.headers,{});this.request=m(c.request,new D);this.proxy=c.proxy;this.retryCallback=c.retryCallback;this.retryAttempts=m(c.retryAttempts,0);this._retryCount=0;c=new b(c.url);J(c,this,!0,!0);c.fragment=void 0;this._url=c.toString()}function P(c){var b=c.resource,d=c.flipY,h=c.preferImageBitmap,f=b.request;f.url=b.url;f.requestFunction=function(){var c=b.url,f=!1;b.isDataUri||b.isBlobUri||(f=b.isCrossOriginUrl);var e=a.defer();K._Implementations.createImage(c,f,e,d,h);return e.promise};c=B.request(f);if(e(c))return c.otherwise(function(c){return f.state!==C.FAILED?a.reject(c):b.retryOnError(c).then(function(e){return e?(f.state=C.UNISSUED,f.deferred=void 0,P({resource:b,flipY:d,preferImageBitmap:h})):a.reject(c)})})}function N(c,b,d){var h={};h[b]=d;c.setQueryParameters(h);var f=c.request;f.url=c.url;f.requestFunction=function(){var b=a.defer();window[d]=function(c){b.resolve(c);try{delete window[d]}catch(ga){window[d]=void 0}};K._Implementations.loadAndExecuteScript(c.url,d,b);return b.promise};h=B.request(f);if(e(h))return h.otherwise(function(h){return f.state!==C.FAILED?a.reject(h):c.retryOnError(h).then(function(e){return e?(f.state=C.UNISSUED,f.deferred=void 0,N(c,b,d)):a.reject(h)})})}function O(c,a){var b=decodeURIComponent(a);return c?atob(b):b}function Z(c,a){for(var b=O(c,a),d=new ArrayBuffer(b.length),h=new Uint8Array(d),f=0;f<b.length;f++)h[f]=b.charCodeAt(f);return d}function aa(c,a){a=m(a,"");var b=c[1],d=!!c[2],h=c[3];switch(a){case "":case "text":return O(d,h);case "arraybuffer":return Z(d,h);case "blob":return d=Z(d,h),new Blob([d],{type:b});case "document":return(new DOMParser).parseFromString(O(d,h),b);case "json":return JSON.parse(O(d,h));default:throw new p("Unhandled responseType: "+a);}}function U(c,a,b){var d=new Image;d.onload=function(){b.resolve(d)};d.onerror=function(c){b.reject(c)};a&&(H.contains(c)?d.crossOrigin="use-credentials":d.crossOrigin="");d.src=c}function W(c,a){switch(a){case "text":return c.toString("utf8");case "json":return JSON.parse(c.toString("utf8"));default:return(new Uint8Array(c)).buffer}}function M(c,a,b,d,h,f,e){d=global.require;c=d("url").parse(c);e="https:"===c.protocol?d("https"):d("http");var g=d("zlib");e.request({protocol:c.protocol,hostname:c.hostname,port:c.port,path:c.path,query:c.query,method:b,headers:h}).on("response",function(c){if(200>c.statusCode||300<=c.statusCode)f.reject(new v(c.statusCode,c,c.headers));else{var b=[];c.on("data",function(c){b.push(c)});c.on("end",function(){var d=Buffer.concat(b);"gzip"===c.headers["content-encoding"]?g.gunzip(d,function(c,b){c?f.reject(new I("Error decompressing response.")):f.resolve(W(b,a))}):f.resolve(W(d,a))})}}).on("error",function(c){f.reject(new v)}).end()}var R=function(){try{var c=new XMLHttpRequest;c.open("GET","#",!0);c.responseType="blob";return"blob"===c.responseType}catch(T){return!1}}();K.createIfNeeded=function(c){return c instanceof K?c.getDerivedResource({request:c.request}):"string"!==typeof c?c:new K({url:c})};var Y;K.supportsImageBitmapOptions=function(){return e(Y)?Y:"function"!==typeof createImageBitmap?Y=a.resolve(!1):Y=K.fetchBlob({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWP4////fwAJ+wP9CNHoHgAAAABJRU5ErkJggg\x3d\x3d"}).then(function(c){return createImageBitmap(c,{imageOrientation:"flipY",premultiplyAlpha:"none"})}).then(function(c){return!0}).otherwise(function(){return!1})};h(K,{isBlobSupported:{get:function(){return R}}});h(K.prototype,{queryParameters:{get:function(){return this._queryParameters}},templateValues:{get:function(){return this._templateValues}},url:{get:function(){return this.getUrlComponent(!0,!0)},set:function(c){c=new b(c);J(c,this,!1);c.fragment=void 0;this._url=c.toString()}},extension:{get:function(){return r(this._url)}},isDataUri:{get:function(){return y(this._url)}},isBlobUri:{get:function(){return c(this._url)}},isCrossOriginUrl:{get:function(){return u(this._url)}},hasHeaders:{get:function(){return 0<Object.keys(this.headers).length}}});K.prototype.getUrlComponent=function(c,a){if(this.isDataUri)return this._url;var d=new b(this._url);c&&w(d,this);var d=d.toString().replace(/%7B/g,"{").replace(/%7D/g,"}"),h=this._templateValues,d=d.replace(/{(.*?)}/g,function(c,a){var b=h[a];return e(b)?encodeURIComponent(b):c});a&&e(this.proxy)&&(d=this.proxy.getURL(d));return d};K.prototype.setQueryParameters=function(c,a){this._queryParameters=a?L(this._queryParameters,c,!1):L(c,this._queryParameters,!1)};K.prototype.appendQueryParameters=function(c){this._queryParameters=L(c,this._queryParameters,!0)};K.prototype.setTemplateValues=function(c,a){this._templateValues=a?l(this._templateValues,c):l(c,this._templateValues)};K.prototype.getDerivedResource=function(c){var a=this.clone();a._retryCount=0;if(e(c.url)){var d=new b(c.url),h=m(c.preserveQueryParameters,!1);J(d,a,!0,h);d.fragment=void 0;a._url=d.resolve(new b(q(this._url))).toString()}e(c.queryParameters)&&(a._queryParameters=l(c.queryParameters,a._queryParameters));e(c.templateValues)&&(a._templateValues=l(c.templateValues,a.templateValues));e(c.headers)&&(a.headers=l(c.headers,a.headers));e(c.proxy)&&(a.proxy=c.proxy);e(c.request)&&(a.request=c.request);e(c.retryCallback)&&(a.retryCallback=c.retryCallback);e(c.retryAttempts)&&(a.retryAttempts=c.retryAttempts);return a};K.prototype.retryOnError=function(c){var b=this.retryCallback;if("function"!==typeof b||this._retryCount>=this.retryAttempts)return a(!1);var d=this;return a(b(this,c)).then(function(c){++d._retryCount;return c})};K.prototype.clone=function(c){e(c)||(c=new K({url:this._url}));c._url=this._url;c._queryParameters=g(this._queryParameters);c._templateValues=g(this._templateValues);c.headers=g(this.headers);c.proxy=this.proxy;c.retryCallback=this.retryCallback;c.retryAttempts=this.retryAttempts;c._retryCount=0;c.request=this.request.clone();return c};K.prototype.getBaseUri=function(c){return t(this.getUrlComponent(c),c)};K.prototype.appendForwardSlash=function(){this._url=f(this._url)};K.prototype.fetchArrayBuffer=function(){return this.fetch({responseType:"arraybuffer"})};K.fetchArrayBuffer=function(c){return(new K(c)).fetchArrayBuffer()};K.prototype.fetchBlob=function(){return this.fetch({responseType:"blob"})};K.fetchBlob=function(c){return(new K(c)).fetchBlob()};K.prototype.fetchImage=function(c){c=m(c,m.EMPTY_OBJECT);var b=m(c.preferImageBitmap,!1),d=m(c.preferBlob,!1),h=m(c.flipY,!1);E(this.request);if(!R||this.isDataUri||this.isBlobUri||!this.hasHeaders&&!d)return P({resource:this,flipY:h,preferImageBitmap:b});var f=this.fetchBlob();if(e(f)){var g,k,B,p;return K.supportsImageBitmapOptions().then(function(c){k=(g=c)&&b;return f}).then(function(c){if(e(c)){p=c;if(k)return K.createImageBitmapFromBlob(c,{flipY:h,premultiplyAlpha:!1});c=window.URL.createObjectURL(c);B=new K({url:c});return P({resource:B,flipY:h,preferImageBitmap:!1})}}).then(function(c){if(e(c)){c.blob=p;if(k)return c;window.URL.revokeObjectURL(B.url);return c}}).otherwise(function(c){e(B)&&window.URL.revokeObjectURL(B.url);c.blob=p;return a.reject(c)})}};K.fetchImage=function(c){return(new K(c)).fetchImage({flipY:c.flipY,preferBlob:c.preferBlob,preferImageBitmap:c.preferImageBitmap})};K.prototype.fetchText=function(){return this.fetch({responseType:"text"})};K.fetchText=function(c){return(new K(c)).fetchText()};K.prototype.fetchJson=function(){var c=this.fetch({responseType:"text",headers:{Accept:"application/json,*/*;q\x3d0.01"}});if(e(c))return c.then(function(c){if(e(c))return JSON.parse(c)})};K.fetchJson=function(c){return(new K(c)).fetchJson()};K.prototype.fetchXML=function(){return this.fetch({responseType:"document",overrideMimeType:"text/xml"})};K.fetchXML=function(c){return(new K(c)).fetchXML()};K.prototype.fetchJsonp=function(c){c=m(c,"callback");E(this.request);var a;do a="loadJsonp"+Math.random().toString().substring(2,8);while(e(window[a]));return N(this,c,a)};K.fetchJsonp=function(c){return(new K(c)).fetchJsonp(c.callbackParameterName)};K.prototype._makeRequest=function(c){var b=this;E(b.request);var d=b.request;d.url=b.url;d.requestFunction=function(){var h=c.responseType,f=l(c.headers,b.headers),g=c.overrideMimeType,k=c.method,B=c.data,p=a.defer(),C=K._Implementations.loadWithXhr(b.url,h,k,B,f,p,g);e(C)&&e(C.abort)&&(d.cancelFunction=function(){C.abort()});return p.promise};var h=B.request(d);if(e(h))return h.then(function(c){return c}).otherwise(function(h){return d.state!==C.FAILED?a.reject(h):b.retryOnError(h).then(function(f){return f?(d.state=C.UNISSUED,d.deferred=void 0,b.fetch(c)):a.reject(h)})})};var Q=/^data:(.*?)(;base64)?,(.*)$/;K.prototype.fetch=function(c){c=G(c,{});c.method="GET";return this._makeRequest(c)};K.fetch=function(c){return(new K(c)).fetch({responseType:c.responseType,overrideMimeType:c.overrideMimeType})};K.prototype["delete"]=function(c){c=G(c,{});c.method="DELETE";return this._makeRequest(c)};K["delete"]=function(c){return(new K(c))["delete"]({responseType:c.responseType,overrideMimeType:c.overrideMimeType,data:c.data})};K.prototype.head=function(c){c=G(c,{});c.method="HEAD";return this._makeRequest(c)};K.head=function(c){return(new K(c)).head({responseType:c.responseType,overrideMimeType:c.overrideMimeType})};K.prototype.options=function(c){c=G(c,{});c.method="OPTIONS";return this._makeRequest(c)};K.options=function(c){return(new K(c)).options({responseType:c.responseType,overrideMimeType:c.overrideMimeType})};K.prototype.post=function(c,a){k.defined("data",c);a=G(a,{});a.method="POST";a.data=c;return this._makeRequest(a)};K.post=function(c){return(new K(c)).post(c.data,{responseType:c.responseType,overrideMimeType:c.overrideMimeType})};K.prototype.put=function(c,a){k.defined("data",c);a=G(a,{});a.method="PUT";a.data=c;return this._makeRequest(a)};K.put=function(c){return(new K(c)).put(c.data,{responseType:c.responseType,overrideMimeType:c.overrideMimeType})};K.prototype.patch=function(c,a){k.defined("data",c);a=G(a,{});a.method="PATCH";a.data=c;return this._makeRequest(a)};K.patch=function(c){return(new K(c)).patch(c.data,{responseType:c.responseType,overrideMimeType:c.overrideMimeType})};K._Implementations={};K._Implementations.createImage=function(c,a,b,d,h){K.supportsImageBitmapOptions().then(function(f){if(f&&h)return K.fetchBlob({url:c}).then(function(a){if(e(a))return K.createImageBitmapFromBlob(a,{flipY:d,premultiplyAlpha:!1});b.reject(new I("Successfully retrieved "+c+" but it contained no content."))}).then(b.resolve);U(c,a,b)}).otherwise(b.reject)};K.createImageBitmapFromBlob=function(c,a){k.defined("options",a);k.typeOf.bool("options.flipY",a.flipY);k.typeOf.bool("options.premultiplyAlpha",a.premultiplyAlpha);return createImageBitmap(c,{imageOrientation:a.flipY?"flipY":"none",premultiplyAlpha:a.premultiplyAlpha?"premultiply":"none"})};var S="undefined"===typeof XMLHttpRequest;K._Implementations.loadWithXhr=function(c,a,b,d,h,f,g){var k=Q.exec(c);if(null!==k)f.resolve(aa(k,a));else if(S)M(c,a,b,d,h,f,g);else{var B=new XMLHttpRequest;H.contains(c)&&(B.withCredentials=!0);B.open(b,c,!0);e(g)&&e(B.overrideMimeType)&&B.overrideMimeType(g);if(e(h))for(var p in h)h.hasOwnProperty(p)&&B.setRequestHeader(p,h[p]);e(a)&&(B.responseType=a);var C=!1;"string"===typeof c&&(C=0===c.indexOf("file://")||"undefined"!==typeof window&&"file://"===window.location.origin);B.onload=function(){if(!(200>B.status||300<=B.status)||C&&0===B.status){var c=B.response,d=B.responseType;if("HEAD"===b||"OPTIONS"===b){var h={};B.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(function(c){c=c.split(": ");var a=c.shift();h[a]=c.join(": ")});f.resolve(h)}else if(204===B.status)f.resolve();else if(!e(c)||e(a)&&d!==a)if("json"===a&&"string"===typeof c)try{f.resolve(JSON.parse(c))}catch(oa){f.reject(oa)}else(""===d||"document"===d)&&e(B.responseXML)&&B.responseXML.hasChildNodes()?f.resolve(B.responseXML):""!==d&&"text"!==d||!e(B.responseText)?f.reject(new I("Invalid XMLHttpRequest response type.")):f.resolve(B.responseText);else f.resolve(c)}else f.reject(new v(B.status,B.response,B.getAllResponseHeaders()))};B.onerror=function(c){f.reject(new v)};B.send(d);return B}};K._Implementations.loadAndExecuteScript=function(c,a,b){return A(c,a).otherwise(b.reject)};K._DefaultImplementations={};K._DefaultImplementations.createImage=K._Implementations.createImage;K._DefaultImplementations.loadWithXhr=K._Implementations.loadWithXhr;K._DefaultImplementations.loadAndExecuteScript=K._Implementations.loadAndExecuteScript;K.DEFAULT=d(new K({url:"undefined"===typeof document?"":document.location.href.split("?")[0]}));return K});F("Core/buildModuleUrl",["./defined","./DeveloperError","./getAbsoluteUri","./Resource","require"],function(b,a,f,k,g){function l(c){if("undefined"===typeof document)return c;b(q)||(q=document.createElement("a"));q.href=c;return q.href=q.href}function m(){if(b(t))return t;var c;if("undefined"!==typeof CESIUM_BASE_URL)c=CESIUM_BASE_URL;else if(b(F.amd)&&!F.amd.toUrlUndefined&&b(g.toUrl))c=f("..",p("Core/buildModuleUrl.js"));else a:{c=document.getElementsByTagName("script");for(var h=0,e=c.length;h<e;++h){var q=c[h].getAttribute("src"),q=d.exec(q);if(null!==q){c=q[1];break a}}c=void 0}if(!b(c))throw new a("Unable to determine Cesium base URL automatically, try defining a global variable called CESIUM_BASE_URL.");t=new k({url:l(c)});t.appendForwardSlash();return t}function e(c){return l(g.toUrl("../"+c))}function h(c){return m().getDerivedResource({url:c}).url}function p(c){b(r)||(r=b(F.amd)&&!F.amd.toUrlUndefined&&b(g.toUrl)?e:h);return r(c)}var d=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i,q,t,r;p._cesiumScriptRegex=d;p._buildModuleUrlFromBaseUrl=h;p._clearBaseResource=function(){t=void 0};p.setBaseUrl=function(c){t=k.DEFAULT.getDerivedResource({url:c})};p.getCesiumBaseUrl=m;return p});F("ThirdParty/mersenne-twister",[],function(){var b=function(a){void 0==a&&(a=(new Date).getTime());this.N=624;this.M=397;this.MATRIX_A=2567483615;this.UPPER_MASK=2147483648;this.LOWER_MASK=2147483647;this.mt=Array(this.N);this.mti=this.N+1;this.init_genrand(a)};b.prototype.init_genrand=function(a){this.mt[0]=a>>>0;for(this.mti=1;this.mti<this.N;this.mti++)a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((a&4294901760)>>>16)<<16)+1812433253*(a&65535)+this.mti,this.mt[this.mti]>>>=0};b.prototype.genrand_int32=function(){var a,b=[0,this.MATRIX_A];if(this.mti>=this.N){var k;this.mti==this.N+1&&this.init_genrand(5489);for(k=0;k<this.N-this.M;k++)a=this.mt[k]&this.UPPER_MASK|this.mt[k+1]&this.LOWER_MASK,this.mt[k]=this.mt[k+this.M]^a>>>1^b[a&1];for(;k<this.N-1;k++)a=this.mt[k]&this.UPPER_MASK|this.mt[k+1]&this.LOWER_MASK,this.mt[k]=this.mt[k+(this.M-this.N)]^a>>>1^b[a&1];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK;this.mt[this.N-1]=this.mt[this.M-1]^a>>>1^b[a&1];this.mti=0}a=this.mt[this.mti++];a^=a>>>11;a^=a<<7&2636928640;a^=a<<15&4022730752;return(a^a>>>18)>>>0};b.prototype.random=function(){return this.genrand_int32()*(1/4294967296)};return b});F("Core/Math",["../ThirdParty/mersenne-twister","./Check","./defaultValue","./defined","./DeveloperError"],function(b,a,f,k,g){var l={EPSILON1:.1,EPSILON2:.01,EPSILON3:.001,EPSILON4:1E-4,EPSILON5:1E-5,EPSILON6:1E-6,EPSILON7:1E-7,EPSILON8:1E-8,EPSILON9:1E-9,EPSILON10:1E-10,EPSILON11:1E-11,EPSILON12:1E-12,EPSILON13:1E-13,EPSILON14:1E-14,EPSILON15:1E-15,EPSILON16:1E-16,EPSILON17:1E-17,EPSILON18:1E-18,EPSILON19:1E-19,EPSILON20:1E-20,EPSILON21:1E-21,GRAVITATIONALPARAMETER:3986004418E5,SOLAR_RADIUS:6955E5,LUNAR_RADIUS:1737400,SIXTY_FOUR_KILOBYTES:65536,FOUR_GIGABYTES:4294967296};l.sign=f(Math.sign,function(a){a=+a;return 0===a||a!==a?a:0<a?1:-1});l.signNotZero=function(a){return 0>a?-1:1};l.toSNorm=function(a,b){b=f(b,255);return Math.round((.5*l.clamp(a,-1,1)+.5)*b)};l.fromSNorm=function(a,b){b=f(b,255);return l.clamp(a,0,b)/b*2-1};l.normalize=function(a,b,d){d=Math.max(d-b,0);return 0===d?0:l.clamp((a-b)/d,0,1)};l.sinh=f(Math.sinh,function(a){return(Math.exp(a)-Math.exp(-a))/2});l.cosh=f(Math.cosh,function(a){return(Math.exp(a)+Math.exp(-a))/2});l.lerp=function(a,b,d){return(1-d)*a+d*b};l.PI=Math.PI;l.ONE_OVER_PI=1/Math.PI;l.PI_OVER_TWO=Math.PI/2;l.PI_OVER_THREE=Math.PI/3;l.PI_OVER_FOUR=Math.PI/4;l.PI_OVER_SIX=Math.PI/6;l.THREE_PI_OVER_TWO=3*Math.PI/2;l.TWO_PI=2*Math.PI;l.ONE_OVER_TWO_PI=1/(2*Math.PI);l.RADIANS_PER_DEGREE=Math.PI/180;l.DEGREES_PER_RADIAN=180/Math.PI;l.RADIANS_PER_ARCSECOND=l.RADIANS_PER_DEGREE/3600;l.toRadians=function(a){if(!k(a))throw new g("degrees is required.");return a*l.RADIANS_PER_DEGREE};l.toDegrees=function(a){if(!k(a))throw new g("radians is required.");return a*l.DEGREES_PER_RADIAN};l.convertLongitudeRange=function(a){if(!k(a))throw new g("angle is required.");var b=l.TWO_PI;a-=Math.floor(a/b)*b;return a<-Math.PI?a+b:a>=Math.PI?a-b:a};l.clampToLatitudeRange=function(a){if(!k(a))throw new g("angle is required.");return l.clamp(a,-1*l.PI_OVER_TWO,l.PI_OVER_TWO)};l.negativePiToPi=function(a){if(!k(a))throw new g("angle is required.");return l.zeroToTwoPi(a+l.PI)-l.PI};l.zeroToTwoPi=function(a){if(!k(a))throw new g("angle is required.");var b=l.mod(a,l.TWO_PI);return Math.abs(b)<l.EPSILON14&&Math.abs(a)>l.EPSILON14?l.TWO_PI:b};l.mod=function(a,b){if(!k(a))throw new g("m is required.");if(!k(b))throw new g("n is required.");return(a%b+b)%b};l.equalsEpsilon=function(a,b,d,e){if(!k(a))throw new g("left is required.");if(!k(b))throw new g("right is required.");if(!k(d))throw new g("relativeEpsilon is required.");e=f(e,d);var h=Math.abs(a-b);return h<=e||h<=d*Math.max(Math.abs(a),Math.abs(b))};l.lessThan=function(a,b,d){if(!k(a))throw new g("first is required.");if(!k(b))throw new g("second is required.");if(!k(d))throw new g("relativeEpsilon is required.");return a-b<-d};l.lessThanOrEquals=function(a,b,d){if(!k(a))throw new g("first is required.");if(!k(b))throw new g("second is required.");if(!k(d))throw new g("relativeEpsilon is required.");return a-b<d};l.greaterThan=function(a,b,d){if(!k(a))throw new g("first is required.");if(!k(b))throw new g("second is required.");if(!k(d))throw new g("relativeEpsilon is required.");return a-b>d};l.greaterThanOrEquals=function(a,b,d){if(!k(a))throw new g("first is required.");if(!k(b))throw new g("second is required.");if(!k(d))throw new g("relativeEpsilon is required.");return a-b>-d};var m=[1];l.factorial=function(a){if("number"!==typeof a||0>a)throw new g("A number greater than or equal to 0 is required.");var b=m.length;if(a>=b)for(var d=m[b-1];b<=a;b++)d*=b,m.push(d);return m[a]};l.incrementWrap=function(a,b,d){d=f(d,0);if(!k(a))throw new g("n is required.");if(b<=d)throw new g("maximumValue must be greater than minimumValue.");++a;a>b&&(a=d);return a};l.isPowerOfTwo=function(a){if("number"!==typeof a||0>a)throw new g("A number greater than or equal to 0 is required.");return 0!==a&&0===(a&a-1)};l.nextPowerOfTwo=function(a){if("number"!==typeof a||0>a)throw new g("A number greater than or equal to 0 is required.");--a;a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;++a;return a};l.clamp=function(a,b,d){if(!k(a))throw new g("value is required");if(!k(b))throw new g("min is required.");if(!k(d))throw new g("max is required.");return a<b?b:a>d?d:a};var e=new b;l.setRandomNumberSeed=function(a){if(!k(a))throw new g("seed is required.");e=new b(a)};l.nextRandomNumber=function(){return e.random()};l.randomBetween=function(a,b){return l.nextRandomNumber()*(b-a)+a};l.acosClamped=function(a){if(!k(a))throw new g("value is required.");return Math.acos(l.clamp(a,-1,1))};l.asinClamped=function(a){if(!k(a))throw new g("value is required.");return Math.asin(l.clamp(a,-1,1))};l.chordLength=function(a,b){if(!k(a))throw new g("angle is required.");if(!k(b))throw new g("radius is required.");return 2*b*Math.sin(.5*a)};l.logBase=function(a,b){if(!k(a))throw new g("number is required.");if(!k(b))throw new g("base is required.");return Math.log(a)/Math.log(b)};l.cbrt=f(Math.cbrt,function(a){var b=Math.pow(Math.abs(a),1/3);return 0>a?-b:b});l.log2=f(Math.log2,function(a){return Math.log(a)*Math.LOG2E});l.fog=function(a,b){var d=a*b;return 1-Math.exp(-(d*d))};l.fastApproximateAtan=function(b){a.typeOf.number("x",b);return b*(-.1784*Math.abs(b)-.0663*b*b+1.0301)};l.fastApproximateAtan2=function(b,f){a.typeOf.number("x",b);a.typeOf.number("y",f);var d,e,h=Math.abs(b);d=Math.abs(f);e=Math.max(h,d);d=Math.min(h,d);d/=e;if(isNaN(d))throw new g("either x or y must be nonzero");h=l.fastApproximateAtan(d);h=Math.abs(f)>Math.abs(b)?l.PI_OVER_TWO-h:h;h=0>b?l.PI-h:h;return 0>f?-h:h};return l});F("Core/Cartesian3","./Check ./defaultValue ./defined ./DeveloperError ./freezeObject ./Math".split(" "),function(b,a,f,k,g,l){function m(c,b,d){this.x=a(c,0);this.y=a(b,0);this.z=a(d,0)}m.fromSpherical=function(c,d){b.typeOf.object("spherical",c);f(d)||(d=new m);var h=c.clock,e=c.cone,g=a(c.magnitude,1),k=g*Math.sin(e);d.x=k*Math.cos(h);d.y=k*Math.sin(h);d.z=g*Math.cos(e);return d};m.fromElements=function(c,a,b,d){if(!f(d))return new m(c,a,b);d.x=c;d.y=a;d.z=b;return d};m.clone=function(c,a){if(f(c)){if(!f(a))return new m(c.x,c.y,c.z);a.x=c.x;a.y=c.y;a.z=c.z;return a}};m.fromCartesian4=m.clone;m.packedLength=3;m.pack=function(c,d,f){b.typeOf.object("value",c);b.defined("array",d);f=a(f,0);d[f++]=c.x;d[f++]=c.y;d[f]=c.z;return d};m.unpack=function(c,d,h){b.defined("array",c);d=a(d,0);f(h)||(h=new m);h.x=c[d++];h.y=c[d++];h.z=c[d];return h};m.packArray=function(c,a){b.defined("array",c);var d=c.length;f(a)?a.length=3*d:a=Array(3*d);for(var h=0;h<d;++h)m.pack(c[h],a,3*h);return a};m.unpackArray=function(c,a){b.defined("array",c);b.typeOf.number.greaterThanOrEquals("array.length",c.length,3);if(0!==c.length%3)throw new k("array length must be a multiple of 3.");var d=c.length;f(a)?a.length=d/3:a=Array(d/3);for(var h=0;h<d;h+=3){var e=h/3;a[e]=m.unpack(c,h,a[e])}return a};m.fromArray=m.unpack;m.maximumComponent=function(c){b.typeOf.object("cartesian",c);return Math.max(c.x,c.y,c.z)};m.minimumComponent=function(c){b.typeOf.object("cartesian",c);return Math.min(c.x,c.y,c.z)};m.minimumByComponent=function(c,a,d){b.typeOf.object("first",c);b.typeOf.object("second",a);b.typeOf.object("result",d);d.x=Math.min(c.x,a.x);d.y=Math.min(c.y,a.y);d.z=Math.min(c.z,a.z);return d};m.maximumByComponent=function(c,a,d){b.typeOf.object("first",c);b.typeOf.object("second",a);b.typeOf.object("result",d);d.x=Math.max(c.x,a.x);d.y=Math.max(c.y,a.y);d.z=Math.max(c.z,a.z);return d};m.magnitudeSquared=function(c){b.typeOf.object("cartesian",c);return c.x*c.x+c.y*c.y+c.z*c.z};m.magnitude=function(c){return Math.sqrt(m.magnitudeSquared(c))};var e=new m;m.distance=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);m.subtract(c,a,e);return m.magnitude(e)};m.distanceSquared=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);m.subtract(c,a,e);return m.magnitudeSquared(e)};m.normalize=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);var d=m.magnitude(c);a.x=c.x/d;a.y=c.y/d;a.z=c.z/d;if(isNaN(a.x)||isNaN(a.y)||isNaN(a.z))throw new k("normalized result is not a number");return a};m.dot=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);return c.x*a.x+c.y*a.y+c.z*a.z};m.multiplyComponents=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x*a.x;d.y=c.y*a.y;d.z=c.z*a.z;return d};m.divideComponents=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x/a.x;d.y=c.y/a.y;d.z=c.z/a.z;return d};m.add=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x+a.x;d.y=c.y+a.y;d.z=c.z+a.z;return d};m.subtract=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x-a.x;d.y=c.y-a.y;d.z=c.z-a.z;return d};m.multiplyByScalar=function(c,a,d){b.typeOf.object("cartesian",c);b.typeOf.number("scalar",a);b.typeOf.object("result",d);d.x=c.x*a;d.y=c.y*a;d.z=c.z*a;return d};m.divideByScalar=function(c,a,d){b.typeOf.object("cartesian",c);b.typeOf.number("scalar",a);b.typeOf.object("result",d);d.x=c.x/a;d.y=c.y/a;d.z=c.z/a;return d};m.negate=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);a.x=-c.x;a.y=-c.y;a.z=-c.z;return a};m.abs=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);a.x=Math.abs(c.x);a.y=Math.abs(c.y);a.z=Math.abs(c.z);return a};var h=new m;m.lerp=function(c,a,d,f){b.typeOf.object("start",c);b.typeOf.object("end",a);b.typeOf.number("t",d);b.typeOf.object("result",f);m.multiplyByScalar(a,d,h);f=m.multiplyByScalar(c,1-d,f);return m.add(h,f,f)};var p=new m,d=new m;m.angleBetween=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);m.normalize(c,p);m.normalize(a,d);var f=m.dot(p,d),h=m.magnitude(m.cross(p,d,p));return Math.atan2(h,f)};var q=new m;m.mostOrthogonalAxis=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);var d=m.normalize(c,q);m.abs(d,d);return a=d.x<=d.y?d.x<=d.z?m.clone(m.UNIT_X,a):m.clone(m.UNIT_Z,a):d.y<=d.z?m.clone(m.UNIT_Y,a):m.clone(m.UNIT_Z,a)};m.projectVector=function(c,a,d){b.defined("a",c);b.defined("b",a);b.defined("result",d);c=m.dot(c,a)/m.dot(a,a);return m.multiplyByScalar(a,c,d)};m.equals=function(c,a){return c===a||f(c)&&f(a)&&c.x===a.x&&c.y===a.y&&c.z===a.z};m.equalsArray=function(c,a,b){return c.x===a[b]&&c.y===a[b+1]&&c.z===a[b+2]};m.equalsEpsilon=function(c,a,b,d){return c===a||f(c)&&f(a)&&l.equalsEpsilon(c.x,a.x,b,d)&&l.equalsEpsilon(c.y,a.y,b,d)&&l.equalsEpsilon(c.z,a.z,b,d)};m.cross=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);var f=c.x,h=c.y;c=c.z;var e=a.x,g=a.y;a=a.z;d.x=h*a-c*g;d.y=c*e-f*a;d.z=f*g-h*e;return d};m.midpoint=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=.5*(c.x+a.x);d.y=.5*(c.y+a.y);d.z=.5*(c.z+a.z);return d};m.fromDegrees=function(c,a,d,f,h){b.typeOf.number("longitude",c);b.typeOf.number("latitude",a);c=l.toRadians(c);a=l.toRadians(a);return m.fromRadians(c,a,d,f,h)};var t=new m,r=new m,c=new m(40680631590769,40680631590769,4.0408299984661445E13);m.fromRadians=function(d,h,e,g,k){b.typeOf.number("longitude",d);b.typeOf.number("latitude",h);e=a(e,0);g=f(g)?g.radiiSquared:c;var l=Math.cos(h);t.x=l*Math.cos(d);t.y=l*Math.sin(d);t.z=Math.sin(h);t=m.normalize(t,t);m.multiplyComponents(g,t,r);d=Math.sqrt(m.dot(t,r));r=m.divideByScalar(r,d,r);t=m.multiplyByScalar(t,e,t);f(k)||(k=new m);return m.add(r,t,k)};m.fromDegreesArray=function(c,a,d){b.defined("coordinates",c);if(2>c.length||0!==c.length%2)throw new k("the number of coordinates must be a multiple of 2 and at least 2");var h=c.length;f(d)?d.length=h/2:d=Array(h/2);for(var e=0;e<h;e+=2){var g=e/2;d[g]=m.fromDegrees(c[e],c[e+1],0,a,d[g])}return d};m.fromRadiansArray=function(c,a,d){b.defined("coordinates",c);if(2>c.length||0!==c.length%2)throw new k("the number of coordinates must be a multiple of 2 and at least 2");var h=c.length;f(d)?d.length=h/2:d=Array(h/2);for(var e=0;e<h;e+=2){var g=e/2;d[g]=m.fromRadians(c[e],c[e+1],0,a,d[g])}return d};m.fromDegreesArrayHeights=function(c,a,d){b.defined("coordinates",c);if(3>c.length||0!==c.length%3)throw new k("the number of coordinates must be a multiple of 3 and at least 3");var h=c.length;f(d)?d.length=h/3:d=Array(h/3);for(var e=0;e<h;e+=3){var g=e/3;d[g]=m.fromDegrees(c[e],c[e+1],c[e+2],a,d[g])}return d};m.fromRadiansArrayHeights=function(c,a,d){b.defined("coordinates",c);if(3>c.length||0!==c.length%3)throw new k("the number of coordinates must be a multiple of 3 and at least 3");var h=c.length;f(d)?d.length=h/3:d=Array(h/3);for(var e=0;e<h;e+=3){var g=e/3;d[g]=m.fromRadians(c[e],c[e+1],c[e+2],a,d[g])}return d};m.ZERO=g(new m(0,0,0));m.UNIT_X=g(new m(1,0,0));m.UNIT_Y=g(new m(0,1,0));m.UNIT_Z=g(new m(0,0,1));m.prototype.clone=function(c){return m.clone(this,c)};m.prototype.equals=function(c){return m.equals(this,c)};m.prototype.equalsEpsilon=function(c,a,b){return m.equalsEpsilon(this,c,a,b)};m.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};return m});F("Core/scaleToGeodeticSurface",["./Cartesian3","./defined","./DeveloperError","./Math"],function(b,a,f,k){var g=new b,l=new b;return function(m,e,h,p,d){if(!a(m))throw new f("cartesian is required.");if(!a(e))throw new f("oneOverRadii is required.");if(!a(h))throw new f("oneOverRadiiSquared is required.");if(!a(p))throw new f("centerToleranceSquared is required.");var q=m.x,t=m.y,r=m.z,c=e.x,u=e.y;e=e.z;c*=q*q*c;u*=t*t*u;e*=r*r*e;var y=c+u+e,A=Math.sqrt(1/y),z=b.multiplyByScalar(m,A,g);if(y<p)return isFinite(A)?b.clone(z,d):void 0;p=h.x;y=h.y;h=h.z;l.x=z.x*p*2;l.y=z.y*y*2;l.z=z.z*h*2;m=(1-A)*b.magnitude(m)/(.5*b.magnitude(l));var x=0,D,v,B,C,I,H;do m-=x,A=1/(1+m*p),z=1/(1+m*y),v=1/(1+m*h),D=A*A,B=z*z,C=v*v,x=D*A,I=B*z,H=C*v,D=c*D+u*B+e*C-1,x=c*x*p+u*I*y+e*H*h,x=D/(-2*x);while(Math.abs(D)>k.EPSILON12);if(!a(d))return new b(q*A,t*z,r*v);d.x=q*A;d.y=t*z;d.z=r*v;return d}});F("Core/Cartographic","./Cartesian3 ./Check ./defaultValue ./defined ./freezeObject ./Math ./scaleToGeodeticSurface".split(" "),function(b,a,f,k,g,l,m){function e(c,a,b){this.longitude=f(c,0);this.latitude=f(a,0);this.height=f(b,0)}e.fromRadians=function(c,b,d,h){a.typeOf.number("longitude",c);a.typeOf.number("latitude",b);d=f(d,0);if(!k(h))return new e(c,b,d);h.longitude=c;h.latitude=b;h.height=d;return h};e.fromDegrees=function(c,b,d,f){a.typeOf.number("longitude",c);a.typeOf.number("latitude",b);c=l.toRadians(c);b=l.toRadians(b);return e.fromRadians(c,b,d,f)};var h=new b,p=new b,d=new b,q=new b(1/6378137,1/6378137,1.573130351105623E-7),t=new b(2.458172257647332E-14,2.458172257647332E-14,2.4747391015697002E-14),r=l.EPSILON1;e.fromCartesian=function(c,a,f){var g=k(a)?a.oneOverRadii:q,y=k(a)?a.oneOverRadiiSquared:t;a=k(a)?a._centerToleranceSquared:r;a=m(c,g,y,a,p);if(k(a)){g=b.multiplyComponents(a,y,h);g=b.normalize(g,g);a=b.subtract(c,a,d);y=Math.atan2(g.y,g.x);g=Math.asin(g.z);c=l.sign(b.dot(a,c))*b.magnitude(a);if(!k(f))return new e(y,g,c);f.longitude=y;f.latitude=g;f.height=c;return f}};e.toCartesian=function(c,d,f){a.defined("cartographic",c);return b.fromRadians(c.longitude,c.latitude,c.height,d,f)};e.clone=function(c,a){if(k(c)){if(!k(a))return new e(c.longitude,c.latitude,c.height);a.longitude=c.longitude;a.latitude=c.latitude;a.height=c.height;return a}};e.equals=function(c,a){return c===a||k(c)&&k(a)&&c.longitude===a.longitude&&c.latitude===a.latitude&&c.height===a.height};e.equalsEpsilon=function(c,b,d){a.typeOf.number("epsilon",d);return c===b||k(c)&&k(b)&&Math.abs(c.longitude-b.longitude)<=d&&Math.abs(c.latitude-b.latitude)<=d&&Math.abs(c.height-b.height)<=d};e.ZERO=g(new e(0,0,0));e.prototype.clone=function(c){return e.clone(this,c)};e.prototype.equals=function(c){return e.equals(this,c)};e.prototype.equalsEpsilon=function(c,a){return e.equalsEpsilon(this,c,a)};e.prototype.toString=function(){return"("+this.longitude+", "+this.latitude+", "+this.height+")"};return e});F("Core/Ellipsoid","./Cartesian3 ./Cartographic ./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./freezeObject ./Math ./scaleToGeodeticSurface".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(c,a,d,e){a=k(a,0);d=k(d,0);e=k(e,0);f.typeOf.number.greaterThanOrEquals("x",a,0);f.typeOf.number.greaterThanOrEquals("y",d,0);f.typeOf.number.greaterThanOrEquals("z",e,0);c._radii=new b(a,d,e);c._radiiSquared=new b(a*a,d*d,e*e);c._radiiToTheFourth=new b(a*a*a*a,d*d*d*d,e*e*e*e);c._oneOverRadii=new b(0===a?0:1/a,0===d?0:1/d,0===e?0:1/e);c._oneOverRadiiSquared=new b(0===a?0:1/(a*a),0===d?0:1/(d*d),0===e?0:1/(e*e));c._minimumRadius=Math.min(a,d,e);c._maximumRadius=Math.max(a,d,e);c._centerToleranceSquared=h.EPSILON1;0!==c._radiiSquared.z&&(c._squaredXOverSquaredZ=c._radiiSquared.x/c._radiiSquared.z)}function q(c,a,b){this._squaredXOverSquaredZ=this._centerToleranceSquared=this._maximumRadius=this._minimumRadius=this._oneOverRadiiSquared=this._oneOverRadii=this._radiiToTheFourth=this._radiiSquared=this._radii=void 0;d(this,c,a,b)}l(q.prototype,{radii:{get:function(){return this._radii}},radiiSquared:{get:function(){return this._radiiSquared}},radiiToTheFourth:{get:function(){return this._radiiToTheFourth}},oneOverRadii:{get:function(){return this._oneOverRadii}},oneOverRadiiSquared:{get:function(){return this._oneOverRadiiSquared}},minimumRadius:{get:function(){return this._minimumRadius}},maximumRadius:{get:function(){return this._maximumRadius}}});q.clone=function(c,a){if(g(c)){var d=c._radii;if(!g(a))return new q(d.x,d.y,d.z);b.clone(d,a._radii);b.clone(c._radiiSquared,a._radiiSquared);b.clone(c._radiiToTheFourth,a._radiiToTheFourth);b.clone(c._oneOverRadii,a._oneOverRadii);b.clone(c._oneOverRadiiSquared,a._oneOverRadiiSquared);a._minimumRadius=c._minimumRadius;a._maximumRadius=c._maximumRadius;a._centerToleranceSquared=c._centerToleranceSquared;return a}};q.fromCartesian3=function(c,a){g(a)||(a=new q);if(!g(c))return a;d(a,c.x,c.y,c.z);return a};q.WGS84=e(new q(6378137,6378137,6356752.314245179));q.UNIT_SPHERE=e(new q(1,1,1));q.MOON=e(new q(h.LUNAR_RADIUS,h.LUNAR_RADIUS,h.LUNAR_RADIUS));q.prototype.clone=function(c){return q.clone(this,c)};q.packedLength=b.packedLength;q.pack=function(c,a,d){f.typeOf.object("value",c);f.defined("array",a);d=k(d,0);b.pack(c._radii,a,d);return a};q.unpack=function(c,a,d){f.defined("array",c);a=k(a,0);c=b.unpack(c,a);return q.fromCartesian3(c,d)};q.prototype.geocentricSurfaceNormal=b.normalize;q.prototype.geodeticSurfaceNormalCartographic=function(c,a){f.typeOf.object("cartographic",c);var d=c.longitude,e=c.latitude,h=Math.cos(e),k=h*Math.cos(d),d=h*Math.sin(d),e=Math.sin(e);g(a)||(a=new b);a.x=k;a.y=d;a.z=e;return b.normalize(a,a)};q.prototype.geodeticSurfaceNormal=function(c,a){g(a)||(a=new b);a=b.multiplyComponents(c,this._oneOverRadiiSquared,a);return b.normalize(a,a)};var t=new b,r=new b;q.prototype.cartographicToCartesian=function(c,a){this.geodeticSurfaceNormalCartographic(c,t);b.multiplyComponents(this._radiiSquared,t,r);var d=Math.sqrt(b.dot(t,r));b.divideByScalar(r,d,r);b.multiplyByScalar(t,c.height,t);g(a)||(a=new b);return b.add(r,t,a)};q.prototype.cartographicArrayToCartesianArray=function(c,a){f.defined("cartographics",c);var b=c.length;g(a)?a.length=b:a=Array(b);for(var d=0;d<b;d++)a[d]=this.cartographicToCartesian(c[d],a[d]);return a};var c=new b,u=new b,y=new b;q.prototype.cartesianToCartographic=function(d,f){var e=this.scaleToGeodeticSurface(d,u);if(g(e)){var k=this.geodeticSurfaceNormal(e,c),l=b.subtract(d,e,y),e=Math.atan2(k.y,k.x),k=Math.asin(k.z),l=h.sign(b.dot(l,d))*b.magnitude(l);if(!g(f))return new a(e,k,l);f.longitude=e;f.latitude=k;f.height=l;return f}};q.prototype.cartesianArrayToCartographicArray=function(c,a){f.defined("cartesians",c);var b=c.length;g(a)?a.length=b:a=Array(b);for(var d=0;d<b;++d)a[d]=this.cartesianToCartographic(c[d],a[d]);return a};q.prototype.scaleToGeodeticSurface=function(c,a){return p(c,this._oneOverRadii,this._oneOverRadiiSquared,this._centerToleranceSquared,a)};q.prototype.scaleToGeocentricSurface=function(c,a){f.typeOf.object("cartesian",c);g(a)||(a=new b);var d=c.x,e=c.y,h=c.z,k=this._oneOverRadiiSquared;return b.multiplyByScalar(c,1/Math.sqrt(d*d*k.x+e*e*k.y+h*h*k.z),a)};q.prototype.transformPositionToScaledSpace=function(c,a){g(a)||(a=new b);return b.multiplyComponents(c,this._oneOverRadii,a)};q.prototype.transformPositionFromScaledSpace=function(c,a){g(a)||(a=new b);return b.multiplyComponents(c,this._radii,a)};q.prototype.equals=function(c){return this===c||g(c)&&b.equals(this._radii,c._radii)};q.prototype.toString=function(){return this._radii.toString()};q.prototype.getSurfaceNormalIntersectionWithZAxis=function(c,a,d){f.typeOf.object("position",c);if(!h.equalsEpsilon(this._radii.x,this._radii.y,h.EPSILON15))throw new m("Ellipsoid must be an ellipsoid of revolution (radii.x \x3d\x3d radii.y)");f.typeOf.number.greaterThan("Ellipsoid.radii.z",this._radii.z,0);a=k(a,0);var e=this._squaredXOverSquaredZ;g(d)||(d=new b);d.x=0;d.y=0;d.z=c.z*(1-e);if(!(Math.abs(d.z)>=this._radii.z-a))return d};return q});F("Core/GeographicProjection","./Cartesian3 ./Cartographic ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid".split(" "),function(b,a,f,k,g,l,m){function e(a){this._ellipsoid=f(a,m.WGS84);this._semimajorAxis=this._ellipsoid.maximumRadius;this._oneOverSemimajorAxis=1/this._semimajorAxis}g(e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});e.prototype.project=function(a,f){var d=this._semimajorAxis,e=a.longitude*d,d=a.latitude*d,h=a.height;if(!k(f))return new b(e,d,h);f.x=e;f.y=d;f.z=h;return f};e.prototype.unproject=function(b,f){if(!k(b))throw new l("cartesian is required");var d=this._oneOverSemimajorAxis,e=b.x*d,d=b.y*d,h=b.z;if(!k(f))return new a(e,d,h);f.longitude=e;f.latitude=d;f.height=h;return f};return e});F("Core/Intersect",["./freezeObject"],function(b){return b({OUTSIDE:-1,INTERSECTING:0,INSIDE:1})});F("Core/Interval",["./defaultValue"],function(b){return function(a,f){this.start=b(a,0);this.stop=b(f,0)}});F("Core/Matrix3","./Cartesian3 ./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./freezeObject ./Math".split(" "),function(b,a,f,k,g,l,m,e){function h(c,a,b,d,e,h,g,k,l){this[0]=f(c,0);this[1]=f(d,0);this[2]=f(g,0);this[3]=f(a,0);this[4]=f(e,0);this[5]=f(k,0);this[6]=f(b,0);this[7]=f(h,0);this[8]=f(l,0)}function p(c){for(var a=0,b=0;3>b;++b)var d=c[h.getElementIndex(r[b],t[b])],a=a+2*d*d;return Math.sqrt(a)}h.packedLength=9;h.pack=function(c,b,d){a.typeOf.object("value",c);a.defined("array",b);d=f(d,0);b[d++]=c[0];b[d++]=c[1];b[d++]=c[2];b[d++]=c[3];b[d++]=c[4];b[d++]=c[5];b[d++]=c[6];b[d++]=c[7];b[d++]=c[8];return b};h.unpack=function(c,b,d){a.defined("array",c);b=f(b,0);k(d)||(d=new h);d[0]=c[b++];d[1]=c[b++];d[2]=c[b++];d[3]=c[b++];d[4]=c[b++];d[5]=c[b++];d[6]=c[b++];d[7]=c[b++];d[8]=c[b++];return d};h.clone=function(c,a){if(k(c)){if(!k(a))return new h(c[0],c[3],c[6],c[1],c[4],c[7],c[2],c[5],c[8]);a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];return a}};h.fromArray=function(c,b,d){a.defined("array",c);b=f(b,0);k(d)||(d=new h);d[0]=c[b];d[1]=c[b+1];d[2]=c[b+2];d[3]=c[b+3];d[4]=c[b+4];d[5]=c[b+5];d[6]=c[b+6];d[7]=c[b+7];d[8]=c[b+8];return d};h.fromColumnMajorArray=function(c,b){a.defined("values",c);return h.clone(c,b)};h.fromRowMajorArray=function(c,b){a.defined("values",c);if(!k(b))return new h(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]);b[0]=c[0];b[1]=c[3];b[2]=c[6];b[3]=c[1];b[4]=c[4];b[5]=c[7];b[6]=c[2];b[7]=c[5];b[8]=c[8];return b};h.fromQuaternion=function(c,b){a.typeOf.object("quaternion",c);var d=c.x*c.x,f=c.x*c.y,e=c.x*c.z,g=c.x*c.w,B=c.y*c.y,l=c.y*c.z,p=c.y*c.w,q=c.z*c.z,m=c.z*c.w,r=c.w*c.w,u=d-B-q+r,y=2*(f-m),t=2*(e+p),f=2*(f+m),m=-d+B-q+r,A=2*(l-g),e=2*(e-p),g=2*(l+g),d=-d-B+q+r;if(!k(b))return new h(u,y,t,f,m,A,e,g,d);b[0]=u;b[1]=f;b[2]=e;b[3]=y;b[4]=m;b[5]=g;b[6]=t;b[7]=A;b[8]=d;return b};h.fromHeadingPitchRoll=function(c,b){a.typeOf.object("headingPitchRoll",c);var d=Math.cos(-c.pitch),f=Math.cos(-c.heading),e=Math.cos(c.roll),g=Math.sin(-c.pitch),B=Math.sin(-c.heading),l=Math.sin(c.roll),p=d*f,q=-e*B+l*g*f,m=l*B+e*g*f,r=d*B,u=e*f+l*g*B,f=-l*f+e*g*B,g=-g,l=l*d,d=e*d;if(!k(b))return new h(p,q,m,r,u,f,g,l,d);b[0]=p;b[1]=r;b[2]=g;b[3]=q;b[4]=u;b[5]=l;b[6]=m;b[7]=f;b[8]=d;return b};h.fromScale=function(c,b){a.typeOf.object("scale",c);if(!k(b))return new h(c.x,0,0,0,c.y,0,0,0,c.z);b[0]=c.x;b[1]=0;b[2]=0;b[3]=0;b[4]=c.y;b[5]=0;b[6]=0;b[7]=0;b[8]=c.z;return b};h.fromUniformScale=function(c,b){a.typeOf.number("scale",c);if(!k(b))return new h(c,0,0,0,c,0,0,0,c);b[0]=c;b[1]=0;b[2]=0;b[3]=0;b[4]=c;b[5]=0;b[6]=0;b[7]=0;b[8]=c;return b};h.fromCrossProduct=function(c,b){a.typeOf.object("vector",c);if(!k(b))return new h(0,-c.z,c.y,c.z,0,-c.x,-c.y,c.x,0);b[0]=0;b[1]=c.z;b[2]=-c.y;b[3]=-c.z;b[4]=0;b[5]=c.x;b[6]=c.y;b[7]=-c.x;b[8]=0;return b};h.fromRotationX=function(c,b){a.typeOf.number("angle",c);var d=Math.cos(c),f=Math.sin(c);if(!k(b))return new h(1,0,0,0,d,-f,0,f,d);b[0]=1;b[1]=0;b[2]=0;b[3]=0;b[4]=d;b[5]=f;b[6]=0;b[7]=-f;b[8]=d;return b};h.fromRotationY=function(c,b){a.typeOf.number("angle",c);var d=Math.cos(c),f=Math.sin(c);if(!k(b))return new h(d,0,f,0,1,0,-f,0,d);b[0]=d;b[1]=0;b[2]=-f;b[3]=0;b[4]=1;b[5]=0;b[6]=f;b[7]=0;b[8]=d;return b};h.fromRotationZ=function(c,b){a.typeOf.number("angle",c);var d=Math.cos(c),f=Math.sin(c);if(!k(b))return new h(d,-f,0,f,d,0,0,0,1);b[0]=d;b[1]=f;b[2]=0;b[3]=-f;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return b};h.toArray=function(c,b){a.typeOf.object("matrix",c);if(!k(b))return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8]];b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=c[3];b[4]=c[4];b[5]=c[5];b[6]=c[6];b[7]=c[7];b[8]=c[8];return b};h.getElementIndex=function(c,b){a.typeOf.number.greaterThanOrEquals("row",b,0);a.typeOf.number.lessThanOrEquals("row",b,2);a.typeOf.number.greaterThanOrEquals("column",c,0);a.typeOf.number.lessThanOrEquals("column",c,2);return 3*c+b};h.getColumn=function(c,b,d){a.typeOf.object("matrix",c);a.typeOf.number.greaterThanOrEquals("index",b,0);a.typeOf.number.lessThanOrEquals("index",b,2);a.typeOf.object("result",d);b*=3;var f=c[b+1],e=c[b+2];d.x=c[b];d.y=f;d.z=e;return d};h.setColumn=function(c,b,d,f){a.typeOf.object("matrix",c);a.typeOf.number.greaterThanOrEquals("index",b,0);a.typeOf.number.lessThanOrEquals("index",b,2);a.typeOf.object("cartesian",d);a.typeOf.object("result",f);f=h.clone(c,f);c=3*b;f[c]=d.x;f[c+1]=d.y;f[c+2]=d.z;return f};h.getRow=function(c,b,d){a.typeOf.object("matrix",c);a.typeOf.number.greaterThanOrEquals("index",b,0);a.typeOf.number.lessThanOrEquals("index",b,2);a.typeOf.object("result",d);var f=c[b+3],e=c[b+6];d.x=c[b];d.y=f;d.z=e;return d};h.setRow=function(c,b,d,f){a.typeOf.object("matrix",c);a.typeOf.number.greaterThanOrEquals("index",b,0);a.typeOf.number.lessThanOrEquals("index",b,2);a.typeOf.object("cartesian",d);a.typeOf.object("result",f);f=h.clone(c,f);f[b]=d.x;f[b+3]=d.y;f[b+6]=d.z;return f};var d=new b;h.getScale=function(c,f){a.typeOf.object("matrix",c);a.typeOf.object("result",f);f.x=b.magnitude(b.fromElements(c[0],c[1],c[2],d));f.y=b.magnitude(b.fromElements(c[3],c[4],c[5],d));f.z=b.magnitude(b.fromElements(c[6],c[7],c[8],d));return f};var q=new b;h.getMaximumScale=function(c){h.getScale(c,q);return b.maximumComponent(q)};h.multiply=function(c,b,d){a.typeOf.object("left",c);a.typeOf.object("right",b);a.typeOf.object("result",d);var f=c[1]*b[0]+c[4]*b[1]+c[7]*b[2],e=c[2]*b[0]+c[5]*b[1]+c[8]*b[2],h=c[0]*b[3]+c[3]*b[4]+c[6]*b[5],g=c[1]*b[3]+c[4]*b[4]+c[7]*b[5],k=c[2]*b[3]+c[5]*b[4]+c[8]*b[5],l=c[0]*b[6]+c[3]*b[7]+c[6]*b[8],p=c[1]*b[6]+c[4]*b[7]+c[7]*b[8],q=c[2]*b[6]+c[5]*b[7]+c[8]*b[8];d[0]=c[0]*b[0]+c[3]*b[1]+c[6]*b[2];d[1]=f;d[2]=e;d[3]=h;d[4]=g;d[5]=k;d[6]=l;d[7]=p;d[8]=q;return d};h.add=function(c,b,d){a.typeOf.object("left",c);a.typeOf.object("right",b);a.typeOf.object("result",d);d[0]=c[0]+b[0];d[1]=c[1]+b[1];d[2]=c[2]+b[2];d[3]=c[3]+b[3];d[4]=c[4]+b[4];d[5]=c[5]+b[5];d[6]=c[6]+b[6];d[7]=c[7]+b[7];d[8]=c[8]+b[8];return d};h.subtract=function(c,b,d){a.typeOf.object("left",c);a.typeOf.object("right",b);a.typeOf.object("result",d);d[0]=c[0]-b[0];d[1]=c[1]-b[1];d[2]=c[2]-b[2];d[3]=c[3]-b[3];d[4]=c[4]-b[4];d[5]=c[5]-b[5];d[6]=c[6]-b[6];d[7]=c[7]-b[7];d[8]=c[8]-b[8];return d};h.multiplyByVector=function(c,b,d){a.typeOf.object("matrix",c);a.typeOf.object("cartesian",b);a.typeOf.object("result",d);var f=b.x,e=b.y;b=b.z;var h=c[1]*f+c[4]*e+c[7]*b,g=c[2]*f+c[5]*e+c[8]*b;d.x=c[0]*f+c[3]*e+c[6]*b;d.y=h;d.z=g;return d};h.multiplyByScalar=function(c,b,d){a.typeOf.object("matrix",c);a.typeOf.number("scalar",b);a.typeOf.object("result",d);d[0]=c[0]*b;d[1]=c[1]*b;d[2]=c[2]*b;d[3]=c[3]*b;d[4]=c[4]*b;d[5]=c[5]*b;d[6]=c[6]*b;d[7]=c[7]*b;d[8]=c[8]*b;return d};h.multiplyByScale=function(c,b,d){a.typeOf.object("matrix",c);a.typeOf.object("scale",b);a.typeOf.object("result",d);d[0]=c[0]*b.x;d[1]=c[1]*b.x;d[2]=c[2]*b.x;d[3]=c[3]*b.y;d[4]=c[4]*b.y;d[5]=c[5]*b.y;d[6]=c[6]*b.z;d[7]=c[7]*b.z;d[8]=c[8]*b.z;return d};h.negate=function(c,b){a.typeOf.object("matrix",c);a.typeOf.object("result",b);b[0]=-c[0];b[1]=-c[1];b[2]=-c[2];b[3]=-c[3];b[4]=-c[4];b[5]=-c[5];b[6]=-c[6];b[7]=-c[7];b[8]=-c[8];return b};h.transpose=function(c,b){a.typeOf.object("matrix",c);a.typeOf.object("result",b);var d=c[3],f=c[6],e=c[1],h=c[4],g=c[7],k=c[2],l=c[5],p=c[8];b[0]=c[0];b[1]=d;b[2]=f;b[3]=e;b[4]=h;b[5]=g;b[6]=k;b[7]=l;b[8]=p;return b};var t=[1,0,0],r=[2,2,1],c=new h,u=new h;h.computeEigenDecomposition=function(b,d){a.typeOf.object("matrix",b);var f=e.EPSILON20,g=0,l=0;k(d)||(d={});for(var q=d.unitary=h.clone(h.IDENTITY,d.unitary),B=d.diagonal=h.clone(b,d.diagonal),C=0,m=0;9>m;++m)var y=B[m],C=C+y*y;for(f*=Math.sqrt(C);10>l&&p(B)>f;){for(var m=B,C=c,A=e.EPSILON15,y=0,w=1,G=0;3>G;++G){var E=Math.abs(m[h.getElementIndex(r[G],t[G])]);E>y&&(w=G,y=E)}G=1;E=0;y=t[w];w=r[w];Math.abs(m[h.getElementIndex(w,y)])>A&&(A=m[h.getElementIndex(w,w)],G=m[h.getElementIndex(y,y)],m=m[h.getElementIndex(w,y)],m=(A-G)/2/m,m=0>m?-1/(-m+Math.sqrt(1+m*m)):1/(m+Math.sqrt(1+m*m)),G=1/Math.sqrt(1+m*m),E=m*G);C=h.clone(h.IDENTITY,C);C[h.getElementIndex(y,y)]=C[h.getElementIndex(w,w)]=G;C[h.getElementIndex(w,y)]=E;C[h.getElementIndex(y,w)]=-E;h.transpose(c,u);h.multiply(B,c,B);h.multiply(u,B,B);h.multiply(q,c,q);2<++g&&(++l,g=0)}return d};h.abs=function(c,b){a.typeOf.object("matrix",c);a.typeOf.object("result",b);b[0]=Math.abs(c[0]);b[1]=Math.abs(c[1]);b[2]=Math.abs(c[2]);b[3]=Math.abs(c[3]);b[4]=Math.abs(c[4]);b[5]=Math.abs(c[5]);b[6]=Math.abs(c[6]);b[7]=Math.abs(c[7]);b[8]=Math.abs(c[8]);return b};h.determinant=function(c){a.typeOf.object("matrix",c);var b=c[3],d=c[6],f=c[4],e=c[7],h=c[5],g=c[8];return c[0]*(f*g-h*e)+c[1]*(h*d-b*g)+c[2]*(b*e-f*d)};h.inverse=function(c,b){a.typeOf.object("matrix",c);a.typeOf.object("result",b);var d=c[0],f=c[1],g=c[2],k=c[3],B=c[4],C=c[5],p=c[6],q=c[7],m=c[8],r=h.determinant(c);if(Math.abs(r)<=e.EPSILON15)throw new l("matrix is not invertible");b[0]=B*m-q*C;b[1]=q*g-f*m;b[2]=f*C-B*g;b[3]=p*C-k*m;b[4]=d*m-p*g;b[5]=k*g-d*C;b[6]=k*q-p*B;b[7]=p*f-d*q;b[8]=d*B-k*f;return h.multiplyByScalar(b,1/r,b)};h.equals=function(c,a){return c===a||k(c)&&k(a)&&c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]};h.equalsEpsilon=function(c,b,d){a.typeOf.number("epsilon",d);return c===b||k(c)&&k(b)&&Math.abs(c[0]-b[0])<=d&&Math.abs(c[1]-b[1])<=d&&Math.abs(c[2]-b[2])<=d&&Math.abs(c[3]-b[3])<=d&&Math.abs(c[4]-b[4])<=d&&Math.abs(c[5]-b[5])<=d&&Math.abs(c[6]-b[6])<=d&&Math.abs(c[7]-b[7])<=d&&Math.abs(c[8]-b[8])<=d};h.IDENTITY=m(new h(1,0,0,0,1,0,0,0,1));h.ZERO=m(new h(0,0,0,0,0,0,0,0,0));h.COLUMN0ROW0=0;h.COLUMN0ROW1=1;h.COLUMN0ROW2=2;h.COLUMN1ROW0=3;h.COLUMN1ROW1=4;h.COLUMN1ROW2=5;h.COLUMN2ROW0=6;h.COLUMN2ROW1=7;h.COLUMN2ROW2=8;g(h.prototype,{length:{get:function(){return h.packedLength}}});h.prototype.clone=function(c){return h.clone(this,c)};h.prototype.equals=function(c){return h.equals(this,c)};h.equalsArray=function(c,a,b){return c[0]===a[b]&&c[1]===a[b+1]&&c[2]===a[b+2]&&c[3]===a[b+3]&&c[4]===a[b+4]&&c[5]===a[b+5]&&c[6]===a[b+6]&&c[7]===a[b+7]&&c[8]===a[b+8]};h.prototype.equalsEpsilon=function(c,a){return h.equalsEpsilon(this,c,a)};h.prototype.toString=function(){return"("+this[0]+", "+this[3]+", "+this[6]+")\n("+this[1]+", "+this[4]+", "+this[7]+")\n("+this[2]+", "+this[5]+", "+this[8]+")"};return h});F("Core/Cartesian4","./Check ./defaultValue ./defined ./DeveloperError ./freezeObject ./Math".split(" "),function(b,a,f,k,g,l){function m(c,b,d,f){this.x=a(c,0);this.y=a(b,0);this.z=a(d,0);this.w=a(f,0)}m.fromElements=function(c,a,b,d,e){if(!f(e))return new m(c,a,b,d);e.x=c;e.y=a;e.z=b;e.w=d;return e};m.fromColor=function(c,a){b.typeOf.object("color",c);if(!f(a))return new m(c.red,c.green,c.blue,c.alpha);a.x=c.red;a.y=c.green;a.z=c.blue;a.w=c.alpha;return a};m.clone=function(c,a){if(f(c)){if(!f(a))return new m(c.x,c.y,c.z,c.w);a.x=c.x;a.y=c.y;a.z=c.z;a.w=c.w;return a}};m.packedLength=4;m.pack=function(c,d,f){b.typeOf.object("value",c);b.defined("array",d);f=a(f,0);d[f++]=c.x;d[f++]=c.y;d[f++]=c.z;d[f]=c.w;return d};m.unpack=function(c,d,e){b.defined("array",c);d=a(d,0);f(e)||(e=new m);e.x=c[d++];e.y=c[d++];e.z=c[d++];e.w=c[d];return e};m.packArray=function(c,a){b.defined("array",c);var d=c.length;f(a)?a.length=4*d:a=Array(4*d);for(var e=0;e<d;++e)m.pack(c[e],a,4*e);return a};m.unpackArray=function(c,a){b.defined("array",c);var d=c.length;f(a)?a.length=d/4:a=Array(d/4);for(var e=0;e<d;e+=4){var h=e/4;a[h]=m.unpack(c,e,a[h])}return a};m.fromArray=m.unpack;m.maximumComponent=function(c){b.typeOf.object("cartesian",c);return Math.max(c.x,c.y,c.z,c.w)};m.minimumComponent=function(c){b.typeOf.object("cartesian",c);return Math.min(c.x,c.y,c.z,c.w)};m.minimumByComponent=function(c,a,d){b.typeOf.object("first",c);b.typeOf.object("second",a);b.typeOf.object("result",d);d.x=Math.min(c.x,a.x);d.y=Math.min(c.y,a.y);d.z=Math.min(c.z,a.z);d.w=Math.min(c.w,a.w);return d};m.maximumByComponent=function(c,a,d){b.typeOf.object("first",c);b.typeOf.object("second",a);b.typeOf.object("result",d);d.x=Math.max(c.x,a.x);d.y=Math.max(c.y,a.y);d.z=Math.max(c.z,a.z);d.w=Math.max(c.w,a.w);return d};m.magnitudeSquared=function(c){b.typeOf.object("cartesian",c);return c.x*c.x+c.y*c.y+c.z*c.z+c.w*c.w};m.magnitude=function(c){return Math.sqrt(m.magnitudeSquared(c))};var e=new m;m.distance=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);m.subtract(c,a,e);return m.magnitude(e)};m.distanceSquared=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);m.subtract(c,a,e);return m.magnitudeSquared(e)};m.normalize=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);var d=m.magnitude(c);a.x=c.x/d;a.y=c.y/d;a.z=c.z/d;a.w=c.w/d;if(isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||isNaN(a.w))throw new k("normalized result is not a number");return a};m.dot=function(c,a){b.typeOf.object("left",c);b.typeOf.object("right",a);return c.x*a.x+c.y*a.y+c.z*a.z+c.w*a.w};m.multiplyComponents=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x*a.x;d.y=c.y*a.y;d.z=c.z*a.z;d.w=c.w*a.w;return d};m.divideComponents=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x/a.x;d.y=c.y/a.y;d.z=c.z/a.z;d.w=c.w/a.w;return d};m.add=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x+a.x;d.y=c.y+a.y;d.z=c.z+a.z;d.w=c.w+a.w;return d};m.subtract=function(c,a,d){b.typeOf.object("left",c);b.typeOf.object("right",a);b.typeOf.object("result",d);d.x=c.x-a.x;d.y=c.y-a.y;d.z=c.z-a.z;d.w=c.w-a.w;return d};m.multiplyByScalar=function(c,a,d){b.typeOf.object("cartesian",c);b.typeOf.number("scalar",a);b.typeOf.object("result",d);d.x=c.x*a;d.y=c.y*a;d.z=c.z*a;d.w=c.w*a;return d};m.divideByScalar=function(c,a,d){b.typeOf.object("cartesian",c);b.typeOf.number("scalar",a);b.typeOf.object("result",d);d.x=c.x/a;d.y=c.y/a;d.z=c.z/a;d.w=c.w/a;return d};m.negate=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);a.x=-c.x;a.y=-c.y;a.z=-c.z;a.w=-c.w;return a};m.abs=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);a.x=Math.abs(c.x);a.y=Math.abs(c.y);a.z=Math.abs(c.z);a.w=Math.abs(c.w);return a};var h=new m;m.lerp=function(c,a,d,f){b.typeOf.object("start",c);b.typeOf.object("end",a);b.typeOf.number("t",d);b.typeOf.object("result",f);m.multiplyByScalar(a,d,h);f=m.multiplyByScalar(c,1-d,f);return m.add(h,f,f)};var p=new m;m.mostOrthogonalAxis=function(c,a){b.typeOf.object("cartesian",c);b.typeOf.object("result",a);var d=m.normalize(c,p);m.abs(d,d);return a=d.x<=d.y?d.x<=d.z?d.x<=d.w?m.clone(m.UNIT_X,a):m.clone(m.UNIT_W,a):d.z<=d.w?m.clone(m.UNIT_Z,a):m.clone(m.UNIT_W,a):d.y<=d.z?d.y<=d.w?m.clone(m.UNIT_Y,a):m.clone(m.UNIT_W,a):d.z<=d.w?m.clone(m.UNIT_Z,a):m.clone(m.UNIT_W,a)};m.equals=function(c,a){return c===a||f(c)&&f(a)&&c.x===a.x&&c.y===a.y&&c.z===a.z&&c.w===a.w};m.equalsArray=function(c,a,b){return c.x===a[b]&&c.y===a[b+1]&&c.z===a[b+2]&&c.w===a[b+3]};m.equalsEpsilon=function(c,a,b,d){return c===a||f(c)&&f(a)&&l.equalsEpsilon(c.x,a.x,b,d)&&l.equalsEpsilon(c.y,a.y,b,d)&&l.equalsEpsilon(c.z,a.z,b,d)&&l.equalsEpsilon(c.w,a.w,b,d)};m.ZERO=g(new m(0,0,0,0));m.UNIT_X=g(new m(1,0,0,0));m.UNIT_Y=g(new m(0,1,0,0));m.UNIT_Z=g(new m(0,0,1,0));m.UNIT_W=g(new m(0,0,0,1));m.prototype.clone=function(c){return m.clone(this,c)};m.prototype.equals=function(c){return m.equals(this,c)};m.prototype.equalsEpsilon=function(c,a,b){return m.equalsEpsilon(this,c,a,b)};m.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};var d=new Float32Array(1),q=1/256,t=1/65536,r=1/16777216;m.packFloat=function(c,a){b.typeOf.number("value",c);f(a)||(a=new m);d[0]=c;c=d[0];if(0===c)return m.clone(m.ZERO,a);var e=0>c?1:0,h;isFinite(c)?(c=Math.abs(c),h=Math.floor(l.logBase(c,10))+1,c/=Math.pow(10,h)):(c=.1,h=38);var g=256*c;a.x=Math.floor(g);g=256*(g-a.x);a.y=Math.floor(g);g=256*(g-a.y);a.z=Math.floor(g);a.w=2*(h+38)+e;return a};m.unpackFloat=function(c){b.typeOf.object("packedFloat",c);var a=c.w/2,d=Math.floor(a),a=2*(a-d),d=d-38,a=-(2*a-1);if(38<=d)return 0>a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY;var f=a*c.x*q,f=f+a*c.y*t,f=f+a*c.z*r;return f*Math.pow(10,d)};return m});F("Core/Matrix4","./Cartesian3 ./Cartesian4 ./Check ./defaultValue ./defined ./defineProperties ./freezeObject ./Math ./Matrix3 ./RuntimeError".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(c,a,b,d,f,e,h,g,l,p,q,m,v,r,u,t){this[0]=k(c,0);this[1]=k(f,0);this[2]=k(l,0);this[3]=k(v,0);this[4]=k(a,0);this[5]=k(e,0);this[6]=k(p,0);this[7]=k(r,0);this[8]=k(b,0);this[9]=k(h,0);this[10]=k(q,0);this[11]=k(u,0);this[12]=k(d,0);this[13]=k(g,0);this[14]=k(m,0);this[15]=k(t,0)}d.packedLength=16;d.pack=function(c,a,b){f.typeOf.object("value",c);f.defined("array",a);b=k(b,0);a[b++]=c[0];a[b++]=c[1];a[b++]=c[2];a[b++]=c[3];a[b++]=c[4];a[b++]=c[5];a[b++]=c[6];a[b++]=c[7];a[b++]=c[8];a[b++]=c[9];a[b++]=c[10];a[b++]=c[11];a[b++]=c[12];a[b++]=c[13];a[b++]=c[14];a[b]=c[15];return a};d.unpack=function(c,a,b){f.defined("array",c);a=k(a,0);g(b)||(b=new d);b[0]=c[a++];b[1]=c[a++];b[2]=c[a++];b[3]=c[a++];b[4]=c[a++];b[5]=c[a++];b[6]=c[a++];b[7]=c[a++];b[8]=c[a++];b[9]=c[a++];b[10]=c[a++];b[11]=c[a++];b[12]=c[a++];b[13]=c[a++];b[14]=c[a++];b[15]=c[a];return b};d.clone=function(c,a){if(g(c)){if(!g(a))return new d(c[0],c[4],c[8],c[12],c[1],c[5],c[9],c[13],c[2],c[6],c[10],c[14],c[3],c[7],c[11],c[15]);a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a}};d.fromArray=d.unpack;d.fromColumnMajorArray=function(c,a){f.defined("values",c);return d.clone(c,a)};d.fromRowMajorArray=function(c,a){f.defined("values",c);if(!g(a))return new d(c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15]);a[0]=c[0];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=c[1];a[5]=c[5];a[6]=c[9];a[7]=c[13];a[8]=c[2];a[9]=c[6];a[10]=c[10];a[11]=c[14];a[12]=c[3];a[13]=c[7];a[14]=c[11];a[15]=c[15];return a};d.fromRotationTranslation=function(c,a,e){f.typeOf.object("rotation",c);a=k(a,b.ZERO);if(!g(e))return new d(c[0],c[3],c[6],a.x,c[1],c[4],c[7],a.y,c[2],c[5],c[8],a.z,0,0,0,1);e[0]=c[0];e[1]=c[1];e[2]=c[2];e[3]=0;e[4]=c[3];e[5]=c[4];e[6]=c[5];e[7]=0;e[8]=c[6];e[9]=c[7];e[10]=c[8];e[11]=0;e[12]=a.x;e[13]=a.y;e[14]=a.z;e[15]=1;return e};d.fromTranslationQuaternionRotationScale=function(c,a,b,e){f.typeOf.object("translation",c);f.typeOf.object("rotation",a);f.typeOf.object("scale",b);g(e)||(e=new d);var h=b.x,k=b.y;b=b.z;var l=a.x*a.x,B=a.x*a.y,p=a.x*a.z,C=a.x*a.w,q=a.y*a.y,m=a.y*a.z,v=a.y*a.w,r=a.z*a.z,u=a.z*a.w;a=a.w*a.w;e[0]=(l-q-r+a)*h;e[1]=2*(B+u)*h;e[2]=2*(p-v)*h;e[3]=0;e[4]=2*(B-u)*k;e[5]=(-l+q-r+a)*k;e[6]=2*(m+C)*k;e[7]=0;e[8]=2*(p+v)*b;e[9]=2*(m-C)*b;e[10]=(-l-q+r+a)*b;e[11]=0;e[12]=c.x;e[13]=c.y;e[14]=c.z;e[15]=1;return e};d.fromTranslationRotationScale=function(c,a){f.typeOf.object("translationRotationScale",c);return d.fromTranslationQuaternionRotationScale(c.translation,c.rotation,c.scale,a)};d.fromTranslation=function(c,a){f.typeOf.object("translation",c);return d.fromRotationTranslation(h.IDENTITY,c,a)};d.fromScale=function(c,a){f.typeOf.object("scale",c);if(!g(a))return new d(c.x,0,0,0,0,c.y,0,0,0,0,c.z,0,0,0,0,1);a[0]=c.x;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c.y;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c.z;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};d.fromUniformScale=function(c,a){f.typeOf.number("scale",c);if(!g(a))return new d(c,0,0,0,0,c,0,0,0,0,c,0,0,0,0,1);a[0]=c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=c;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=c;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};var q=new b,t=new b,r=new b;d.fromCamera=function(c,a){f.typeOf.object("camera",c);var e=c.position,h=c.direction,k=c.up;f.typeOf.object("camera.position",e);f.typeOf.object("camera.direction",h);f.typeOf.object("camera.up",k);b.normalize(h,q);b.normalize(b.cross(q,k,t),t);b.normalize(b.cross(t,q,r),r);var h=t.x,k=t.y,l=t.z,p=q.x,B=q.y,C=q.z,m=r.x,v=r.y,u=r.z,z=e.x,y=e.y,x=e.z,e=h*-z+k*-y+l*-x,D=m*-z+v*-y+u*-x,z=p*z+B*y+C*x;if(!g(a))return new d(h,k,l,e,m,v,u,D,-p,-B,-C,z,0,0,0,1);a[0]=h;a[1]=m;a[2]=-p;a[3]=0;a[4]=k;a[5]=v;a[6]=-B;a[7]=0;a[8]=l;a[9]=u;a[10]=-C;a[11]=0;a[12]=e;a[13]=D;a[14]=z;a[15]=1;return a};d.computePerspectiveFieldOfView=function(c,a,b,d,e){f.typeOf.number.greaterThan("fovY",c,0);f.typeOf.number.lessThan("fovY",c,Math.PI);f.typeOf.number.greaterThan("near",b,0);f.typeOf.number.greaterThan("far",d,0);f.typeOf.object("result",e);c=1/Math.tan(.5*c);e[0]=c/a;e[1]=0;e[2]=0;e[3]=0;e[4]=0;e[5]=c;e[6]=0;e[7]=0;e[8]=0;e[9]=0;e[10]=(d+b)/(b-d);e[11]=-1;e[12]=0;e[13]=0;e[14]=2*d*b/(b-d);e[15]=0;return e};d.computeOrthographicOffCenter=function(c,a,b,d,e,h,g){f.typeOf.number("left",c);f.typeOf.number("right",a);f.typeOf.number("bottom",b);f.typeOf.number("top",d);f.typeOf.number("near",e);f.typeOf.number("far",h);f.typeOf.object("result",g);var k=1/(a-c),l=1/(d-b),p=1/(h-e);g[0]=2*k;g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*l;g[6]=0;g[7]=0;g[8]=0;g[9]=0;g[10]=-2*p;g[11]=0;g[12]=-(a+c)*k;g[13]=-(d+b)*l;g[14]=-(h+e)*p;g[15]=1;return g};d.computePerspectiveOffCenter=function(c,a,b,d,e,h,g){f.typeOf.number("left",c);f.typeOf.number("right",a);f.typeOf.number("bottom",b);f.typeOf.number("top",d);f.typeOf.number("near",e);f.typeOf.number("far",h);f.typeOf.object("result",g);g[0]=2*e/(a-c);g[1]=0;g[2]=0;g[3]=0;g[4]=0;g[5]=2*e/(d-b);g[6]=0;g[7]=0;g[8]=(a+c)/(a-c);g[9]=(d+b)/(d-b);g[10]=-(h+e)/(h-e);g[11]=-1;g[12]=0;g[13]=0;g[14]=-2*h*e/(h-e);g[15]=0;return g};d.computeInfinitePerspectiveOffCenter=function(c,a,b,d,e,h){f.typeOf.number("left",c);f.typeOf.number("right",a);f.typeOf.number("bottom",b);f.typeOf.number("top",d);f.typeOf.number("near",e);f.typeOf.object("result",h);h[0]=2*e/(a-c);h[1]=0;h[2]=0;h[3]=0;h[4]=0;h[5]=2*e/(d-b);h[6]=0;h[7]=0;h[8]=(a+c)/(a-c);h[9]=(d+b)/(d-b);h[10]=-1;h[11]=-1;h[12]=0;h[13]=0;h[14]=-2*e;h[15]=0;return h};d.computeViewportTransformation=function(c,a,b,d){f.typeOf.object("result",d);c=k(c,k.EMPTY_OBJECT);var e=k(c.x,0),h=k(c.y,0),g=k(c.width,0);c=k(c.height,0);a=k(a,0);b=k(b,1);g*=.5;c*=.5;b=.5*(b-a);d[0]=g;d[1]=0;d[2]=0;d[3]=0;d[4]=0;d[5]=c;d[6]=0;d[7]=0;d[8]=0;d[9]=0;d[10]=b;d[11]=0;d[12]=e+g;d[13]=h+c;d[14]=a+b;d[15]=1;return d};d.computeView=function(c,a,d,e,h){f.typeOf.object("position",c);f.typeOf.object("direction",a);f.typeOf.object("up",d);f.typeOf.object("right",e);f.typeOf.object("result",h);h[0]=e.x;h[1]=d.x;h[2]=-a.x;h[3]=0;h[4]=e.y;h[5]=d.y;h[6]=-a.y;h[7]=0;h[8]=e.z;h[9]=d.z;h[10]=-a.z;h[11]=0;h[12]=-b.dot(e,c);h[13]=-b.dot(d,c);h[14]=b.dot(a,c);h[15]=1;return h};d.toArray=function(c,a){f.typeOf.object("matrix",c);if(!g(a))return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15]];a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a};d.getElementIndex=function(c,a){f.typeOf.number.greaterThanOrEquals("row",a,0);f.typeOf.number.lessThanOrEquals("row",a,3);f.typeOf.number.greaterThanOrEquals("column",c,0);f.typeOf.number.lessThanOrEquals("column",c,3);return 4*c+a};d.getColumn=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.number.greaterThanOrEquals("index",a,0);f.typeOf.number.lessThanOrEquals("index",a,3);f.typeOf.object("result",b);a*=4;var d=c[a+1],e=c[a+2],h=c[a+3];b.x=c[a];b.y=d;b.z=e;b.w=h;return b};d.setColumn=function(c,a,b,e){f.typeOf.object("matrix",c);f.typeOf.number.greaterThanOrEquals("index",a,0);f.typeOf.number.lessThanOrEquals("index",a,3);f.typeOf.object("cartesian",b);f.typeOf.object("result",e);e=d.clone(c,e);c=4*a;e[c]=b.x;e[c+1]=b.y;e[c+2]=b.z;e[c+3]=b.w;return e};d.setTranslation=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("translation",a);f.typeOf.object("result",b);b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=c[3];b[4]=c[4];b[5]=c[5];b[6]=c[6];b[7]=c[7];b[8]=c[8];b[9]=c[9];b[10]=c[10];b[11]=c[11];b[12]=a.x;b[13]=a.y;b[14]=a.z;b[15]=c[15];return b};var c=new b;d.setScale=function(a,e,h){f.typeOf.object("matrix",a);f.typeOf.object("scale",e);f.typeOf.object("result",h);var g=d.getScale(a,c);e=b.divideComponents(e,g,c);return d.multiplyByScale(a,e,h)};d.getRow=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.number.greaterThanOrEquals("index",a,0);f.typeOf.number.lessThanOrEquals("index",a,3);f.typeOf.object("result",b);var d=c[a+4],e=c[a+8],h=c[a+12];b.x=c[a];b.y=d;b.z=e;b.w=h;return b};d.setRow=function(c,a,b,e){f.typeOf.object("matrix",c);f.typeOf.number.greaterThanOrEquals("index",a,0);f.typeOf.number.lessThanOrEquals("index",a,3);f.typeOf.object("cartesian",b);f.typeOf.object("result",e);e=d.clone(c,e);e[a]=b.x;e[a+4]=b.y;e[a+8]=b.z;e[a+12]=b.w;return e};var u=new b;d.getScale=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);a.x=b.magnitude(b.fromElements(c[0],c[1],c[2],u));a.y=b.magnitude(b.fromElements(c[4],c[5],c[6],u));a.z=b.magnitude(b.fromElements(c[8],c[9],c[10],u));return a};var y=new b;d.getMaximumScale=function(c){d.getScale(c,y);return b.maximumComponent(y)};d.multiply=function(c,a,b){f.typeOf.object("left",c);f.typeOf.object("right",a);f.typeOf.object("result",b);var d=c[0],e=c[1],h=c[2],g=c[3],k=c[4],l=c[5],p=c[6],q=c[7],B=c[8],m=c[9],C=c[10],v=c[11],r=c[12],u=c[13],t=c[14];c=c[15];var z=a[0],I=a[1],y=a[2],x=a[3],D=a[4],A=a[5],da=a[6],V=a[7],ba=a[8],X=a[9],fa=a[10],ga=a[11],ka=a[12],na=a[13],ia=a[14];a=a[15];b[0]=d*z+k*I+B*y+r*x;b[1]=e*z+l*I+m*y+u*x;b[2]=h*z+p*I+C*y+t*x;b[3]=g*z+q*I+v*y+c*x;b[4]=d*D+k*A+B*da+r*V;b[5]=e*D+l*A+m*da+u*V;b[6]=h*D+p*A+C*da+t*V;b[7]=g*D+q*A+v*da+c*V;b[8]=d*ba+k*X+B*fa+r*ga;b[9]=e*ba+l*X+m*fa+u*ga;b[10]=h*ba+p*X+C*fa+t*ga;b[11]=g*ba+q*X+v*fa+c*ga;b[12]=d*ka+k*na+B*ia+r*a;b[13]=e*ka+l*na+m*ia+u*a;b[14]=h*ka+p*na+C*ia+t*a;b[15]=g*ka+q*na+v*ia+c*a;return b};d.add=function(c,a,b){f.typeOf.object("left",c);f.typeOf.object("right",a);f.typeOf.object("result",b);b[0]=c[0]+a[0];b[1]=c[1]+a[1];b[2]=c[2]+a[2];b[3]=c[3]+a[3];b[4]=c[4]+a[4];b[5]=c[5]+a[5];b[6]=c[6]+a[6];b[7]=c[7]+a[7];b[8]=c[8]+a[8];b[9]=c[9]+a[9];b[10]=c[10]+a[10];b[11]=c[11]+a[11];b[12]=c[12]+a[12];b[13]=c[13]+a[13];b[14]=c[14]+a[14];b[15]=c[15]+a[15];return b};d.subtract=function(c,a,b){f.typeOf.object("left",c);f.typeOf.object("right",a);f.typeOf.object("result",b);b[0]=c[0]-a[0];b[1]=c[1]-a[1];b[2]=c[2]-a[2];b[3]=c[3]-a[3];b[4]=c[4]-a[4];b[5]=c[5]-a[5];b[6]=c[6]-a[6];b[7]=c[7]-a[7];b[8]=c[8]-a[8];b[9]=c[9]-a[9];b[10]=c[10]-a[10];b[11]=c[11]-a[11];b[12]=c[12]-a[12];b[13]=c[13]-a[13];b[14]=c[14]-a[14];b[15]=c[15]-a[15];return b};d.multiplyTransformation=function(c,a,b){f.typeOf.object("left",c);f.typeOf.object("right",a);f.typeOf.object("result",b);var d=c[0],e=c[1],h=c[2],g=c[4],k=c[5],l=c[6],p=c[8],q=c[9],m=c[10],B=c[12],C=c[13];c=c[14];var v=a[0],r=a[1],u=a[2],t=a[4],z=a[5],y=a[6],I=a[8],x=a[9],D=a[10],A=a[12],da=a[13];a=a[14];b[0]=d*v+g*r+p*u;b[1]=e*v+k*r+q*u;b[2]=h*v+l*r+m*u;b[3]=0;b[4]=d*t+g*z+p*y;b[5]=e*t+k*z+q*y;b[6]=h*t+l*z+m*y;b[7]=0;b[8]=d*I+g*x+p*D;b[9]=e*I+k*x+q*D;b[10]=h*I+l*x+m*D;b[11]=0;b[12]=d*A+g*da+p*a+B;b[13]=e*A+k*da+q*a+C;b[14]=h*A+l*da+m*a+c;b[15]=1;return b};d.multiplyByMatrix3=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("rotation",a);f.typeOf.object("result",b);var d=c[0],e=c[1],h=c[2],g=c[4],k=c[5],l=c[6],p=c[8],q=c[9],m=c[10],B=a[0],C=a[1],v=a[2],r=a[3],u=a[4],t=a[5],z=a[6],y=a[7];a=a[8];b[0]=d*B+g*C+p*v;b[1]=e*B+k*C+q*v;b[2]=h*B+l*C+m*v;b[3]=0;b[4]=d*r+g*u+p*t;b[5]=e*r+k*u+q*t;b[6]=h*r+l*u+m*t;b[7]=0;b[8]=d*z+g*y+p*a;b[9]=e*z+k*y+q*a;b[10]=h*z+l*y+m*a;b[11]=0;b[12]=c[12];b[13]=c[13];b[14]=c[14];b[15]=c[15];return b};d.multiplyByTranslation=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("translation",a);f.typeOf.object("result",b);var d=a.x,e=a.y,h=a.z;a=d*c[0]+e*c[4]+h*c[8]+c[12];var g=d*c[1]+e*c[5]+h*c[9]+c[13],d=d*c[2]+e*c[6]+h*c[10]+c[14];b[0]=c[0];b[1]=c[1];b[2]=c[2];b[3]=c[3];b[4]=c[4];b[5]=c[5];b[6]=c[6];b[7]=c[7];b[8]=c[8];b[9]=c[9];b[10]=c[10];b[11]=c[11];b[12]=a;b[13]=g;b[14]=d;b[15]=c[15];return b};var A=new b;d.multiplyByUniformScale=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.number("scale",a);f.typeOf.object("result",b);A.x=a;A.y=a;A.z=a;return d.multiplyByScale(c,A,b)};d.multiplyByScale=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("scale",a);f.typeOf.object("result",b);var e=a.x,h=a.y;a=a.z;if(1===e&&1===h&&1===a)return d.clone(c,b);b[0]=e*c[0];b[1]=e*c[1];b[2]=e*c[2];b[3]=0;b[4]=h*c[4];b[5]=h*c[5];b[6]=h*c[6];b[7]=0;b[8]=a*c[8];b[9]=a*c[9];b[10]=a*c[10];b[11]=0;b[12]=c[12];b[13]=c[13];b[14]=c[14];b[15]=1;return b};d.multiplyByVector=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("cartesian",a);f.typeOf.object("result",b);var d=a.x,e=a.y,h=a.z;a=a.w;var g=c[1]*d+c[5]*e+c[9]*h+c[13]*a,k=c[2]*d+c[6]*e+c[10]*h+c[14]*a,l=c[3]*d+c[7]*e+c[11]*h+c[15]*a;b.x=c[0]*d+c[4]*e+c[8]*h+c[12]*a;b.y=g;b.z=k;b.w=l;return b};d.multiplyByPointAsVector=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("cartesian",a);f.typeOf.object("result",b);var d=a.x,e=a.y;a=a.z;var h=c[1]*d+c[5]*e+c[9]*a,g=c[2]*d+c[6]*e+c[10]*a;b.x=c[0]*d+c[4]*e+c[8]*a;b.y=h;b.z=g;return b};d.multiplyByPoint=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.object("cartesian",a);f.typeOf.object("result",b);var d=a.x,e=a.y;a=a.z;var h=c[1]*d+c[5]*e+c[9]*a+c[13],g=c[2]*d+c[6]*e+c[10]*a+c[14];b.x=c[0]*d+c[4]*e+c[8]*a+c[12];b.y=h;b.z=g;return b};d.multiplyByScalar=function(c,a,b){f.typeOf.object("matrix",c);f.typeOf.number("scalar",a);f.typeOf.object("result",b);b[0]=c[0]*a;b[1]=c[1]*a;b[2]=c[2]*a;b[3]=c[3]*a;b[4]=c[4]*a;b[5]=c[5]*a;b[6]=c[6]*a;b[7]=c[7]*a;b[8]=c[8]*a;b[9]=c[9]*a;b[10]=c[10]*a;b[11]=c[11]*a;b[12]=c[12]*a;b[13]=c[13]*a;b[14]=c[14]*a;b[15]=c[15]*a;return b};d.negate=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);a[0]=-c[0];a[1]=-c[1];a[2]=-c[2];a[3]=-c[3];a[4]=-c[4];a[5]=-c[5];a[6]=-c[6];a[7]=-c[7];a[8]=-c[8];a[9]=-c[9];a[10]=-c[10];a[11]=-c[11];a[12]=-c[12];a[13]=-c[13];a[14]=-c[14];a[15]=-c[15];return a};d.transpose=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);var b=c[1],d=c[2],e=c[3],h=c[6],g=c[7],k=c[11];a[0]=c[0];a[1]=c[4];a[2]=c[8];a[3]=c[12];a[4]=b;a[5]=c[5];a[6]=c[9];a[7]=c[13];a[8]=d;a[9]=h;a[10]=c[10];a[11]=c[14];a[12]=e;a[13]=g;a[14]=k;a[15]=c[15];return a};d.abs=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);a[0]=Math.abs(c[0]);a[1]=Math.abs(c[1]);a[2]=Math.abs(c[2]);a[3]=Math.abs(c[3]);a[4]=Math.abs(c[4]);a[5]=Math.abs(c[5]);a[6]=Math.abs(c[6]);a[7]=Math.abs(c[7]);a[8]=Math.abs(c[8]);a[9]=Math.abs(c[9]);a[10]=Math.abs(c[10]);a[11]=Math.abs(c[11]);a[12]=Math.abs(c[12]);a[13]=Math.abs(c[13]);a[14]=Math.abs(c[14]);a[15]=Math.abs(c[15]);return a};d.equals=function(c,a){return c===a||g(c)&&g(a)&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[3]===a[3]&&c[7]===a[7]&&c[11]===a[11]&&c[15]===a[15]};d.equalsEpsilon=function(c,a,b){f.typeOf.number("epsilon",b);return c===a||g(c)&&g(a)&&Math.abs(c[0]-a[0])<=b&&Math.abs(c[1]-a[1])<=b&&Math.abs(c[2]-a[2])<=b&&Math.abs(c[3]-a[3])<=b&&Math.abs(c[4]-a[4])<=b&&Math.abs(c[5]-a[5])<=b&&Math.abs(c[6]-a[6])<=b&&Math.abs(c[7]-a[7])<=b&&Math.abs(c[8]-a[8])<=b&&Math.abs(c[9]-a[9])<=b&&Math.abs(c[10]-a[10])<=b&&Math.abs(c[11]-a[11])<=b&&Math.abs(c[12]-a[12])<=b&&Math.abs(c[13]-a[13])<=b&&Math.abs(c[14]-a[14])<=b&&Math.abs(c[15]-a[15])<=b};d.getTranslation=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);a.x=c[12];a.y=c[13];a.z=c[14];return a};d.getRotation=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[4];a[4]=c[5];a[5]=c[6];a[6]=c[8];a[7]=c[9];a[8]=c[10];return a};var z=new h,x=new h,D=new a,v=new a(0,0,0,1);d.inverse=function(c,b){f.typeOf.object("matrix",c);f.typeOf.object("result",b);var g=c[0],k=c[4],l=c[8],q=c[12],m=c[1],r=c[5],B=c[9],C=c[13],u=c[2],t=c[6],y=c[10],A=c[14],aa=c[3],U=c[7],W=c[11],M=c[15],R=y*M,Y=A*W,Q=t*M,S=A*U,ca=t*W,T=y*U,da=u*M,V=A*aa,ba=u*W,X=y*aa,fa=u*U,ga=t*aa,ka=R*r+S*B+ca*C-(Y*r+Q*B+T*C),na=Y*m+da*B+X*C-(R*m+V*B+ba*C),ia=Q*m+V*r+fa*C-(S*m+da*r+ga*C),la=T*m+ba*r+ga*B-(ca*m+X*r+fa*B),ha=Y*k+Q*l+T*q-(R*k+S*l+ca*q),pa=R*g+V*l+ba*q-(Y*g+da*l+X*q),oa=S*g+da*k+ga*q-(Q*g+V*k+fa*q),qa=ca*g+X*k+fa*l-(T*g+ba*k+ga*l),R=l*C,Y=q*B,Q=k*C,S=q*r,ca=k*B,T=l*r,da=g*C,V=q*m,ba=g*B,X=l*m,fa=g*r,ga=k*m,m=R*U+S*W+ca*M-(Y*U+Q*W+T*M),r=Y*aa+da*W+X*M-(R*aa+V*W+ba*M),M=Q*aa+V*U+fa*M-(S*aa+da*U+ga*M),aa=T*aa+ba*U+ga*W-(ca*aa+X*U+fa*W),U=Q*y+T*A+Y*t-(ca*A+R*t+S*y),R=ba*A+R*u+V*y-(da*y+X*A+Y*u),A=da*t+ga*A+S*u-(fa*A+Q*u+V*t),u=fa*y+ca*u+X*t-(ba*t+ga*y+T*u),g=g*ka+k*na+l*ia+q*la;if(Math.abs(g)<e.EPSILON21){if(h.equalsEpsilon(d.getRotation(c,z),x,e.EPSILON7)&&a.equals(d.getRow(c,3,D),v))return b[0]=0,b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=0,b[6]=0,b[7]=0,b[8]=0,b[9]=0,b[10]=0,b[11]=0,b[12]=-c[12],b[13]=-c[13],b[14]=-c[14],b[15]=1,b;throw new p("matrix is not invertible because its determinate is zero.");}g=1/g;b[0]=ka*g;b[1]=na*g;b[2]=ia*g;b[3]=la*g;b[4]=ha*g;b[5]=pa*g;b[6]=oa*g;b[7]=qa*g;b[8]=m*g;b[9]=r*g;b[10]=M*g;b[11]=aa*g;b[12]=U*g;b[13]=R*g;b[14]=A*g;b[15]=u*g;return b};d.inverseTransformation=function(c,a){f.typeOf.object("matrix",c);f.typeOf.object("result",a);var b=c[0],d=c[1],e=c[2],h=c[4],g=c[5],k=c[6],l=c[8],p=c[9],q=c[10],m=c[12],v=c[13],r=c[14];a[0]=b;a[1]=h;a[2]=l;a[3]=0;a[4]=d;a[5]=g;a[6]=p;a[7]=0;a[8]=e;a[9]=k;a[10]=q;a[11]=0;a[12]=-b*m-d*v-e*r;a[13]=-h*m-g*v-k*r;a[14]=-l*m-p*v-q*r;a[15]=1;return a};d.IDENTITY=m(new d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1));d.ZERO=m(new d(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0));d.COLUMN0ROW0=0;d.COLUMN0ROW1=1;d.COLUMN0ROW2=2;d.COLUMN0ROW3=3;d.COLUMN1ROW0=4;d.COLUMN1ROW1=5;d.COLUMN1ROW2=6;d.COLUMN1ROW3=7;d.COLUMN2ROW0=8;d.COLUMN2ROW1=9;d.COLUMN2ROW2=10;d.COLUMN2ROW3=11;d.COLUMN3ROW0=12;d.COLUMN3ROW1=13;d.COLUMN3ROW2=14;d.COLUMN3ROW3=15;l(d.prototype,{length:{get:function(){return d.packedLength}}});d.prototype.clone=function(c){return d.clone(this,c)};d.prototype.equals=function(c){return d.equals(this,c)};d.equalsArray=function(c,a,b){return c[0]===a[b]&&c[1]===a[b+1]&&c[2]===a[b+2]&&c[3]===a[b+3]&&c[4]===a[b+4]&&c[5]===a[b+5]&&c[6]===a[b+6]&&c[7]===a[b+7]&&c[8]===a[b+8]&&c[9]===a[b+9]&&c[10]===a[b+10]&&c[11]===a[b+11]&&c[12]===a[b+12]&&c[13]===a[b+13]&&c[14]===a[b+14]&&c[15]===a[b+15]};d.prototype.equalsEpsilon=function(c,a){return d.equalsEpsilon(this,c,a)};d.prototype.toString=function(){return"("+this[0]+", "+this[4]+", "+this[8]+", "+this[12]+")\n("+this[1]+", "+this[5]+", "+this[9]+", "+this[13]+")\n("+this[2]+", "+this[6]+", "+this[10]+", "+this[14]+")\n("+this[3]+", "+this[7]+", "+this[11]+", "+this[15]+")"};return d});F("Core/Rectangle","./Cartographic ./Check ./defaultValue ./defined ./defineProperties ./Ellipsoid ./freezeObject ./Math".split(" "),function(b,a,f,k,g,l,m,e){function h(a,b,e,h){this.west=f(a,0);this.south=f(b,0);this.east=f(e,0);this.north=f(h,0)}g(h.prototype,{width:{get:function(){return h.computeWidth(this)}},height:{get:function(){return h.computeHeight(this)}}});h.packedLength=4;h.pack=function(b,e,h){a.typeOf.object("value",b);a.defined("array",e);h=f(h,0);e[h++]=b.west;e[h++]=b.south;e[h++]=b.east;e[h]=b.north;return e};h.unpack=function(b,e,g){a.defined("array",b);e=f(e,0);k(g)||(g=new h);g.west=b[e++];g.south=b[e++];g.east=b[e++];g.north=b[e];return g};h.computeWidth=function(b){a.typeOf.object("rectangle",b);var d=b.east;b=b.west;d<b&&(d+=e.TWO_PI);return d-b};h.computeHeight=function(b){a.typeOf.object("rectangle",b);return b.north-b.south};h.fromDegrees=function(a,b,g,l,c){a=e.toRadians(f(a,0));b=e.toRadians(f(b,0));g=e.toRadians(f(g,0));l=e.toRadians(f(l,0));if(!k(c))return new h(a,b,g,l);c.west=a;c.south=b;c.east=g;c.north=l;return c};h.fromRadians=function(a,b,e,g,c){if(!k(c))return new h(a,b,e,g);c.west=f(a,0);c.south=f(b,0);c.east=f(e,0);c.north=f(g,0);return c};h.fromCartographicArray=function(b,f){a.defined("cartographics",b);for(var d=Number.MAX_VALUE,g=-Number.MAX_VALUE,c=Number.MAX_VALUE,l=-Number.MAX_VALUE,p=Number.MAX_VALUE,m=-Number.MAX_VALUE,q=0,x=b.length;q<x;q++)var D=b[q],d=Math.min(d,D.longitude),g=Math.max(g,D.longitude),p=Math.min(p,D.latitude),m=Math.max(m,D.latitude),D=0<=D.longitude?D.longitude:D.longitude+e.TWO_PI,c=Math.min(c,D),l=Math.max(l,D);g-d>l-c&&(d=c,g=l,g>e.PI&&(g-=e.TWO_PI),d>e.PI&&(d-=e.TWO_PI));if(!k(f))return new h(d,p,g,m);f.west=d;f.south=p;f.east=g;f.north=m;return f};h.fromCartesianArray=function(b,g,p){a.defined("cartesians",b);g=f(g,l.WGS84);for(var d=Number.MAX_VALUE,c=-Number.MAX_VALUE,m=Number.MAX_VALUE,q=-Number.MAX_VALUE,t=Number.MAX_VALUE,z=-Number.MAX_VALUE,x=0,D=b.length;x<D;x++)var v=g.cartesianToCartographic(b[x]),d=Math.min(d,v.longitude),c=Math.max(c,v.longitude),t=Math.min(t,v.latitude),z=Math.max(z,v.latitude),v=0<=v.longitude?v.longitude:v.longitude+e.TWO_PI,m=Math.min(m,v),q=Math.max(q,v);c-d>q-m&&(d=m,c=q,c>e.PI&&(c-=e.TWO_PI),d>e.PI&&(d-=e.TWO_PI));if(!k(p))return new h(d,t,c,z);p.west=d;p.south=t;p.east=c;p.north=z;return p};h.clone=function(a,b){if(k(a)){if(!k(b))return new h(a.west,a.south,a.east,a.north);b.west=a.west;b.south=a.south;b.east=a.east;b.north=a.north;return b}};h.equalsEpsilon=function(b,e,f){a.typeOf.number("absoluteEpsilon",f);return b===e||k(b)&&k(e)&&Math.abs(b.west-e.west)<=f&&Math.abs(b.south-e.south)<=f&&Math.abs(b.east-e.east)<=f&&Math.abs(b.north-e.north)<=f};h.prototype.clone=function(a){return h.clone(this,a)};h.prototype.equals=function(a){return h.equals(this,a)};h.equals=function(a,b){return a===b||k(a)&&k(b)&&a.west===b.west&&a.south===b.south&&a.east===b.east&&a.north===b.north};h.prototype.equalsEpsilon=function(b,e){a.typeOf.number("epsilon",e);return h.equalsEpsilon(this,b,e)};h.validate=function(b){a.typeOf.object("rectangle",b);var d=b.north;a.typeOf.number.greaterThanOrEquals("north",d,-e.PI_OVER_TWO);a.typeOf.number.lessThanOrEquals("north",d,e.PI_OVER_TWO);d=b.south;a.typeOf.number.greaterThanOrEquals("south",d,-e.PI_OVER_TWO);a.typeOf.number.lessThanOrEquals("south",d,e.PI_OVER_TWO);d=b.west;a.typeOf.number.greaterThanOrEquals("west",d,-Math.PI);a.typeOf.number.lessThanOrEquals("west",d,Math.PI);b=b.east;a.typeOf.number.greaterThanOrEquals("east",b,-Math.PI);a.typeOf.number.lessThanOrEquals("east",b,Math.PI)};h.southwest=function(d,e){a.typeOf.object("rectangle",d);if(!k(e))return new b(d.west,d.south);e.longitude=d.west;e.latitude=d.south;e.height=0;return e};h.northwest=function(d,e){a.typeOf.object("rectangle",d);if(!k(e))return new b(d.west,d.north);e.longitude=d.west;e.latitude=d.north;e.height=0;return e};h.northeast=function(d,e){a.typeOf.object("rectangle",d);if(!k(e))return new b(d.east,d.north);e.longitude=d.east;e.latitude=d.north;e.height=0;return e};h.southeast=function(d,e){a.typeOf.object("rectangle",d);if(!k(e))return new b(d.east,d.south);e.longitude=d.east;e.latitude=d.south;e.height=0;return e};h.center=function(d,f){a.typeOf.object("rectangle",d);var h=d.east,g=d.west;h<g&&(h+=e.TWO_PI);h=e.negativePiToPi(.5*(g+h));g=.5*(d.south+d.north);if(!k(f))return new b(h,g);f.longitude=h;f.latitude=g;f.height=0;return f};h.intersection=function(b,f,g){a.typeOf.object("rectangle",b);a.typeOf.object("otherRectangle",f);var d=b.east,c=b.west,l=f.east,p=f.west;d<c&&0<l?d+=e.TWO_PI:l<p&&0<d&&(l+=e.TWO_PI);d<c&&0>p?p+=e.TWO_PI:l<p&&0>c&&(c+=e.TWO_PI);c=e.negativePiToPi(Math.max(c,p));d=e.negativePiToPi(Math.min(d,l));if(!((b.west<b.east||f.west<f.east)&&d<=c||(l=Math.max(b.south,f.south),b=Math.min(b.north,f.north),l>=b))){if(!k(g))return new h(c,l,d,b);g.west=c;g.south=l;g.east=d;g.north=b;return g}};h.simpleIntersection=function(b,e,f){a.typeOf.object("rectangle",b);a.typeOf.object("otherRectangle",e);var d=Math.max(b.west,e.west),c=Math.max(b.south,e.south),g=Math.min(b.east,e.east);b=Math.min(b.north,e.north);if(!(c>=b||d>=g)){if(!k(f))return new h(d,c,g,b);f.west=d;f.south=c;f.east=g;f.north=b;return f}};h.union=function(b,f,g){a.typeOf.object("rectangle",b);a.typeOf.object("otherRectangle",f);k(g)||(g=new h);var d=b.east,c=b.west,l=f.east,p=f.west;d<c&&0<l?d+=e.TWO_PI:l<p&&0<d&&(l+=e.TWO_PI);d<c&&0>p?p+=e.TWO_PI:l<p&&0>c&&(c+=e.TWO_PI);c=e.convertLongitudeRange(Math.min(c,p));d=e.convertLongitudeRange(Math.max(d,l));g.west=c;g.south=Math.min(b.south,f.south);g.east=d;g.north=Math.max(b.north,f.north);return g};h.expand=function(b,e,f){a.typeOf.object("rectangle",b);a.typeOf.object("cartographic",e);k(f)||(f=new h);f.west=Math.min(b.west,e.longitude);f.south=Math.min(b.south,e.latitude);f.east=Math.max(b.east,e.longitude);f.north=Math.max(b.north,e.latitude);return f};h.contains=function(b,f){a.typeOf.object("rectangle",b);a.typeOf.object("cartographic",f);var d=f.longitude,h=f.latitude,c=b.west,g=b.east;g<c&&(g+=e.TWO_PI,0>d&&(d+=e.TWO_PI));return(d>c||e.equalsEpsilon(d,c,e.EPSILON14))&&(d<g||e.equalsEpsilon(d,g,e.EPSILON14))&&h>=b.south&&h<=b.north};var p=new b;h.subsample=function(b,g,m,r){a.typeOf.object("rectangle",b);g=f(g,l.WGS84);m=f(m,0);k(r)||(r=[]);var c=0,d=b.north,q=b.south,t=b.east,z=b.west;p.height=m;p.longitude=z;p.latitude=d;r[c]=g.cartographicToCartesian(p,r[c]);c++;p.longitude=t;r[c]=g.cartographicToCartesian(p,r[c]);c++;p.latitude=q;r[c]=g.cartographicToCartesian(p,r[c]);c++;p.longitude=z;r[c]=g.cartographicToCartesian(p,r[c]);c++;p.latitude=0>d?d:0<q?q:0;for(m=1;8>m;++m)p.longitude=-Math.PI+m*e.PI_OVER_TWO,h.contains(b,p)&&(r[c]=g.cartographicToCartesian(p,r[c]),c++);0===p.latitude&&(p.longitude=z,r[c]=g.cartographicToCartesian(p,r[c]),c++,p.longitude=t,r[c]=g.cartographicToCartesian(p,r[c]),c++);r.length=c;return r};h.MAX_VALUE=m(new h(-Math.PI,-e.PI_OVER_TWO,Math.PI,e.PI_OVER_TWO));return h});F("Core/BoundingSphere","./Cartesian3 ./Cartographic ./Check ./defaultValue ./defined ./Ellipsoid ./GeographicProjection ./Intersect ./Interval ./Math ./Matrix3 ./Matrix4 ./Rectangle".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(c,a){this.center=b.clone(k(c,b.ZERO));this.radius=k(a,0)}var c=new b,u=new b,y=new b,A=new b,z=new b,x=new b,D=new b,v=new b,B=new b,C=new b,I=new b,H=new b,J=4/3*p.PI;r.fromPoints=function(a,d){g(d)||(d=new r);if(!g(a)||0===a.length)return d.center=b.clone(b.ZERO,d.center),d.radius=0,d;var e=b.clone(a[0],D),f=b.clone(e,c),h=b.clone(e,u),k=b.clone(e,y),l=b.clone(e,A),p=b.clone(e,z),m=b.clone(e,x),q=a.length,w;for(w=1;w<q;w++){b.clone(a[w],e);var t=e.x,E=e.y,G=e.z;t<f.x&&b.clone(e,f);t>l.x&&b.clone(e,l);E<h.y&&b.clone(e,h);E>p.y&&b.clone(e,p);G<k.z&&b.clone(e,k);G>m.z&&b.clone(e,m)}var L=b.magnitudeSquared(b.subtract(l,f,v));w=b.magnitudeSquared(b.subtract(p,h,v));t=b.magnitudeSquared(b.subtract(m,k,v));E=f;G=l;w>L&&(L=w,E=h,G=p);t>L&&(E=k,G=m);B.x=.5*(E.x+G.x);B.y=.5*(E.y+G.y);B.z=.5*(E.z+G.z);t=b.magnitudeSquared(b.subtract(G,B,v));E=Math.sqrt(t);C.x=f.x;C.y=h.y;C.z=k.z;I.x=l.x;I.y=p.y;I.z=m.z;f=b.midpoint(C,I,H);for(w=h=0;w<q;w++)b.clone(a[w],e),k=b.magnitude(b.subtract(e,f,v)),k>h&&(h=k),k=b.magnitudeSquared(b.subtract(e,B,v)),k>t&&(k=Math.sqrt(k),E=.5*(E+k),t=E*E,l=k-E,B.x=(E*B.x+l*e.x)/k,B.y=(E*B.y+l*e.y)/k,B.z=(E*B.z+l*e.z)/k);E<h?(b.clone(B,d.center),d.radius=E):(b.clone(f,d.center),d.radius=h);return d};var w=new m,G=new b,E=new b,L=new a,K=new a;r.fromRectangle2D=function(c,a,b){return r.fromRectangleWithHeights2D(c,a,0,0,b)};r.fromRectangleWithHeights2D=function(c,a,d,e,f){g(f)||(f=new r);if(!g(c))return f.center=b.clone(b.ZERO,f.center),f.radius=0,f;a=k(a,w);t.southwest(c,L);L.height=d;t.northeast(c,K);K.height=e;c=a.project(L,G);e=a.project(K,E);a=e.x-c.x;d=e.y-c.y;e=e.z-c.z;f.radius=.5*Math.sqrt(a*a+d*d+e*e);var h=f.center;h.x=c.x+.5*a;h.y=c.y+.5*d;h.z=c.z+.5*e;return f};var P=[];r.fromRectangle3D=function(c,a,d,e){a=k(a,l.WGS84);d=k(d,0);g(e)||(e=new r);if(!g(c))return e.center=b.clone(b.ZERO,e.center),e.radius=0,e;c=t.subsample(c,a,d,P);return r.fromPoints(c,e)};r.fromVertices=function(a,d,e,h){g(h)||(h=new r);if(!g(a)||0===a.length)return h.center=b.clone(b.ZERO,h.center),h.radius=0,h;d=k(d,b.ZERO);e=k(e,3);f.typeOf.number.greaterThanOrEquals("stride",e,3);D.x=a[0]+d.x;D.y=a[1]+d.y;D.z=a[2]+d.z;var l=b.clone(D,c),p=b.clone(D,u),m=b.clone(D,y),q=b.clone(D,A),w=b.clone(D,z),t=b.clone(D,x),E=a.length,G;for(G=0;G<E;G+=e){var L=a[G]+d.x,K=a[G+1]+d.y,J=a[G+2]+d.z;D.x=L;D.y=K;D.z=J;L<l.x&&b.clone(D,l);L>q.x&&b.clone(D,q);K<p.y&&b.clone(D,p);K>w.y&&b.clone(D,w);J<m.z&&b.clone(D,m);J>t.z&&b.clone(D,t)}var O=b.magnitudeSquared(b.subtract(q,l,v));G=b.magnitudeSquared(b.subtract(w,p,v));L=b.magnitudeSquared(b.subtract(t,m,v));K=l;J=q;G>O&&(O=G,K=p,J=w);L>O&&(K=m,J=t);B.x=.5*(K.x+J.x);B.y=.5*(K.y+J.y);B.z=.5*(K.z+J.z);L=b.magnitudeSquared(b.subtract(J,B,v));K=Math.sqrt(L);C.x=l.x;C.y=p.y;C.z=m.z;I.x=q.x;I.y=w.y;I.z=t.z;l=b.midpoint(C,I,H);for(G=p=0;G<E;G+=e)D.x=a[G]+d.x,D.y=a[G+1]+d.y,D.z=a[G+2]+d.z,m=b.magnitude(b.subtract(D,l,v)),m>p&&(p=m),m=b.magnitudeSquared(b.subtract(D,B,v)),m>L&&(m=Math.sqrt(m),K=.5*(K+m),L=K*K,q=m-K,B.x=(K*B.x+q*D.x)/m,B.y=(K*B.y+q*D.y)/m,B.z=(K*B.z+q*D.z)/m);K<p?(b.clone(B,h.center),h.radius=K):(b.clone(l,h.center),h.radius=p);return h};r.fromEncodedCartesianVertices=function(a,d,e){g(e)||(e=new r);if(!g(a)||!g(d)||a.length!==d.length||0===a.length)return e.center=b.clone(b.ZERO,e.center),e.radius=0,e;D.x=a[0]+d[0];D.y=a[1]+d[1];D.z=a[2]+d[2];var f=b.clone(D,c),h=b.clone(D,u),k=b.clone(D,y),l=b.clone(D,A),p=b.clone(D,z),m=b.clone(D,x),q=a.length,w;for(w=0;w<q;w+=3){var t=a[w]+d[w],E=a[w+1]+d[w+1],G=a[w+2]+d[w+2];D.x=t;D.y=E;D.z=G;t<f.x&&b.clone(D,f);t>l.x&&b.clone(D,l);E<h.y&&b.clone(D,h);E>p.y&&b.clone(D,p);G<k.z&&b.clone(D,k);G>m.z&&b.clone(D,m)}var L=b.magnitudeSquared(b.subtract(l,f,v));w=b.magnitudeSquared(b.subtract(p,h,v));t=b.magnitudeSquared(b.subtract(m,k,v));E=f;G=l;w>L&&(L=w,E=h,G=p);t>L&&(E=k,G=m);B.x=.5*(E.x+G.x);B.y=.5*(E.y+G.y);B.z=.5*(E.z+G.z);t=b.magnitudeSquared(b.subtract(G,B,v));E=Math.sqrt(t);C.x=f.x;C.y=h.y;C.z=k.z;I.x=l.x;I.y=p.y;I.z=m.z;f=b.midpoint(C,I,H);for(w=h=0;w<q;w+=3)D.x=a[w]+d[w],D.y=a[w+1]+d[w+1],D.z=a[w+2]+d[w+2],k=b.magnitude(b.subtract(D,f,v)),k>h&&(h=k),k=b.magnitudeSquared(b.subtract(D,B,v)),k>t&&(k=Math.sqrt(k),E=.5*(E+k),t=E*E,l=k-E,B.x=(E*B.x+l*D.x)/k,B.y=(E*B.y+l*D.y)/k,B.z=(E*B.z+l*D.z)/k);E<h?(b.clone(B,e.center),e.radius=E):(b.clone(f,e.center),e.radius=h);return e};r.fromCornerPoints=function(c,a,d){f.typeOf.object("corner",c);f.typeOf.object("oppositeCorner",a);g(d)||(d=new r);c=b.midpoint(c,a,d.center);d.radius=b.distance(c,a);return d};r.fromEllipsoid=function(c,a){f.typeOf.object("ellipsoid",c);g(a)||(a=new r);b.clone(b.ZERO,a.center);a.radius=c.maximumRadius;return a};var N=new b;r.fromBoundingSpheres=function(c,a){g(a)||(a=new r);if(!g(c)||0===c.length)return a.center=b.clone(b.ZERO,a.center),a.radius=0,a;var d=c.length;if(1===d)return r.clone(c[0],a);if(2===d)return r.union(c[0],c[1],a);var e=[],f;for(f=0;f<d;f++)e.push(c[f].center);a=r.fromPoints(e,a);var e=a.center,h=a.radius;for(f=0;f<d;f++)var k=c[f],h=Math.max(h,b.distance(e,k.center,N)+k.radius);a.radius=h;return a};var O=new b,Z=new b,aa=new b;r.fromOrientedBoundingBox=function(c,a){f.defined("orientedBoundingBox",c);g(a)||(a=new r);var e=c.halfAxes,h=d.getColumn(e,0,O),k=d.getColumn(e,1,Z),e=d.getColumn(e,2,aa);b.add(h,k,h);b.add(h,e,h);a.center=b.clone(c.center,a.center);a.radius=b.magnitude(h);return a};r.clone=function(c,a){if(g(c)){if(!g(a))return new r(c.center,c.radius);a.center=b.clone(c.center,a.center);a.radius=c.radius;return a}};r.packedLength=4;r.pack=function(c,a,b){f.typeOf.object("value",c);f.defined("array",a);b=k(b,0);var d=c.center;a[b++]=d.x;a[b++]=d.y;a[b++]=d.z;a[b]=c.radius;return a};r.unpack=function(c,a,b){f.defined("array",c);a=k(a,0);g(b)||(b=new r);var d=b.center;d.x=c[a++];d.y=c[a++];d.z=c[a++];b.radius=c[a];return b};var U=new b,W=new b;r.union=function(c,a,d){f.typeOf.object("left",c);f.typeOf.object("right",a);g(d)||(d=new r);var e=c.center,h=c.radius,k=a.radius,l=b.subtract(a.center,e,U),p=b.magnitude(l);if(h>=p+k)return c.clone(d),d;if(k>=p+h)return a.clone(d),d;c=.5*(h+p+k);h=b.multiplyByScalar(l,(-h+c)/p,W);b.add(h,e,h);b.clone(h,d.center);d.radius=c;return d};var M=new b;r.expand=function(c,a,d){f.typeOf.object("sphere",c);f.typeOf.object("point",a);d=r.clone(c,d);c=b.magnitude(b.subtract(a,d.center,M));c>d.radius&&(d.radius=c);return d};r.intersectPlane=function(c,a){f.typeOf.object("sphere",c);f.typeOf.object("plane",a);var d=c.radius,h=b.dot(a.normal,c.center)+a.distance;return h<-d?e.OUTSIDE:h<d?e.INTERSECTING:e.INSIDE};r.transform=function(c,a,b){f.typeOf.object("sphere",c);f.typeOf.object("transform",a);g(b)||(b=new r);b.center=q.multiplyByPoint(a,c.center,b.center);b.radius=q.getMaximumScale(a)*c.radius;return b};var R=new b;r.distanceSquaredTo=function(c,a){f.typeOf.object("sphere",c);f.typeOf.object("cartesian",a);var d=b.subtract(c.center,a,R);return b.magnitudeSquared(d)-c.radius*c.radius};r.transformWithoutScale=function(c,a,b){f.typeOf.object("sphere",c);f.typeOf.object("transform",a);g(b)||(b=new r);b.center=q.multiplyByPoint(a,c.center,b.center);b.radius=c.radius;return b};var Y=new b;r.computePlaneDistances=function(c,a,d,e){f.typeOf.object("sphere",c);f.typeOf.object("position",a);f.typeOf.object("direction",d);g(e)||(e=new h);a=b.subtract(c.center,a,Y);d=b.dot(d,a);e.start=d-c.radius;e.stop=d+c.radius;return e};var Q=new b,S=new b,ca=new b,T=new b,da=new b,V=new a,ba=Array(8);for(a=0;8>a;++a)ba[a]=new b;var X=new m;r.projectTo2D=function(c,a,d){f.typeOf.object("sphere",c);a=k(a,X);var e=a.ellipsoid,h=c.center,g=c.radius;c=e.geodeticSurfaceNormal(h,Q);var l=b.cross(b.UNIT_Z,c,S);b.normalize(l,l);var p=b.cross(c,l,ca);b.normalize(p,p);b.multiplyByScalar(c,g,c);b.multiplyByScalar(p,g,p);b.multiplyByScalar(l,g,l);var g=b.negate(p,da),m=b.negate(l,T),q=ba[0];b.add(c,p,q);b.add(q,l,q);q=ba[1];b.add(c,p,q);b.add(q,m,q);q=ba[2];b.add(c,g,q);b.add(q,m,q);q=ba[3];b.add(c,g,q);b.add(q,l,q);b.negate(c,c);q=ba[4];b.add(c,p,q);b.add(q,l,q);q=ba[5];b.add(c,p,q);b.add(q,m,q);q=ba[6];b.add(c,g,q);b.add(q,m,q);q=ba[7];b.add(c,g,q);b.add(q,l,q);c=ba.length;for(l=0;l<c;++l)p=ba[l],b.add(h,p,p),g=e.cartesianToCartographic(p,V),a.project(g,p);d=r.fromPoints(ba,d);h=d.center;a=h.x;e=h.y;h.x=h.z;h.y=a;h.z=e;return d};r.isOccluded=function(c,a){f.typeOf.object("sphere",c);f.typeOf.object("occluder",a);return!a.isBoundingSphereVisible(c)};r.equals=function(c,a){return c===a||g(c)&&g(a)&&b.equals(c.center,a.center)&&c.radius===a.radius};r.prototype.intersectPlane=function(c){return r.intersectPlane(this,c)};r.prototype.distanceSquaredTo=function(c){return r.distanceSquaredTo(this,c)};r.prototype.computePlaneDistances=function(c,a,b){return r.computePlaneDistances(this,c,a,b)};r.prototype.isOccluded=function(c){return r.isOccluded(this,c)};r.prototype.equals=function(c){return r.equals(this,c)};r.prototype.clone=function(c){return r.clone(this,c)};r.prototype.volume=function(){var c=this.radius;return J*c*c*c};return r});F("Core/Cartesian2","./Check ./defaultValue ./defined ./DeveloperError ./freezeObject ./Math".split(" "),function(b,a,f,k,g,l){function m(b,d){this.x=a(b,0);this.y=a(d,0)}m.fromElements=function(a,b,c){if(!f(c))return new m(a,b);c.x=a;c.y=b;return c};m.clone=function(a,b){if(f(a)){if(!f(b))return new m(a.x,a.y);b.x=a.x;b.y=a.y;return b}};m.fromCartesian3=m.clone;m.fromCartesian4=m.clone;m.packedLength=2;m.pack=function(d,e,c){b.typeOf.object("value",d);b.defined("array",e);c=a(c,0);e[c++]=d.x;e[c]=d.y;return e};m.unpack=function(d,e,c){b.defined("array",d);e=a(e,0);f(c)||(c=new m);c.x=d[e++];c.y=d[e];return c};m.packArray=function(a,d){b.defined("array",a);var c=a.length;f(d)?d.length=2*c:d=Array(2*c);for(var e=0;e<c;++e)m.pack(a[e],d,2*e);return d};m.unpackArray=function(a,d){b.defined("array",a);var c=a.length;f(d)?d.length=c/2:d=Array(c/2);for(var e=0;e<c;e+=2){var h=e/2;d[h]=m.unpack(a,e,d[h])}return d};m.fromArray=m.unpack;m.maximumComponent=function(a){b.typeOf.object("cartesian",a);return Math.max(a.x,a.y)};m.minimumComponent=function(a){b.typeOf.object("cartesian",a);return Math.min(a.x,a.y)};m.minimumByComponent=function(a,d,c){b.typeOf.object("first",a);b.typeOf.object("second",d);b.typeOf.object("result",c);c.x=Math.min(a.x,d.x);c.y=Math.min(a.y,d.y);return c};m.maximumByComponent=function(a,d,c){b.typeOf.object("first",a);b.typeOf.object("second",d);b.typeOf.object("result",c);c.x=Math.max(a.x,d.x);c.y=Math.max(a.y,d.y);return c};m.magnitudeSquared=function(a){b.typeOf.object("cartesian",a);return a.x*a.x+a.y*a.y};m.magnitude=function(a){return Math.sqrt(m.magnitudeSquared(a))};var e=new m;m.distance=function(a,d){b.typeOf.object("left",a);b.typeOf.object("right",d);m.subtract(a,d,e);return m.magnitude(e)};m.distanceSquared=function(a,d){b.typeOf.object("left",a);b.typeOf.object("right",d);m.subtract(a,d,e);return m.magnitudeSquared(e)};m.normalize=function(a,d){b.typeOf.object("cartesian",a);b.typeOf.object("result",d);var c=m.magnitude(a);d.x=a.x/c;d.y=a.y/c;if(isNaN(d.x)||isNaN(d.y))throw new k("normalized result is not a number");return d};m.dot=function(a,d){b.typeOf.object("left",a);b.typeOf.object("right",d);return a.x*d.x+a.y*d.y};m.multiplyComponents=function(a,d,c){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",c);c.x=a.x*d.x;c.y=a.y*d.y;return c};m.divideComponents=function(a,d,c){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",c);c.x=a.x/d.x;c.y=a.y/d.y;return c};m.add=function(a,d,c){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",c);c.x=a.x+d.x;c.y=a.y+d.y;return c};m.subtract=function(a,d,c){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",c);c.x=a.x-d.x;c.y=a.y-d.y;return c};m.multiplyByScalar=function(a,d,c){b.typeOf.object("cartesian",a);b.typeOf.number("scalar",d);b.typeOf.object("result",c);c.x=a.x*d;c.y=a.y*d;return c};m.divideByScalar=function(a,d,c){b.typeOf.object("cartesian",a);b.typeOf.number("scalar",d);b.typeOf.object("result",c);c.x=a.x/d;c.y=a.y/d;return c};m.negate=function(a,d){b.typeOf.object("cartesian",a);b.typeOf.object("result",d);d.x=-a.x;d.y=-a.y;return d};m.abs=function(a,d){b.typeOf.object("cartesian",a);b.typeOf.object("result",d);d.x=Math.abs(a.x);d.y=Math.abs(a.y);return d};var h=new m;m.lerp=function(a,d,c,e){b.typeOf.object("start",a);b.typeOf.object("end",d);b.typeOf.number("t",c);b.typeOf.object("result",e);m.multiplyByScalar(d,c,h);e=m.multiplyByScalar(a,1-c,e);return m.add(h,e,e)};var p=new m,d=new m;m.angleBetween=function(a,e){b.typeOf.object("left",a);b.typeOf.object("right",e);m.normalize(a,p);m.normalize(e,d);return l.acosClamped(m.dot(p,d))};var q=new m;m.mostOrthogonalAxis=function(a,d){b.typeOf.object("cartesian",a);b.typeOf.object("result",d);var c=m.normalize(a,q);m.abs(c,c);return d=c.x<=c.y?m.clone(m.UNIT_X,d):m.clone(m.UNIT_Y,d)};m.equals=function(a,b){return a===b||f(a)&&f(b)&&a.x===b.x&&a.y===b.y};m.equalsArray=function(a,b,c){return a.x===b[c]&&a.y===b[c+1]};m.equalsEpsilon=function(a,b,c,d){return a===b||f(a)&&f(b)&&l.equalsEpsilon(a.x,b.x,c,d)&&l.equalsEpsilon(a.y,b.y,c,d)};m.ZERO=g(new m(0,0));m.UNIT_X=g(new m(1,0));m.UNIT_Y=g(new m(0,1));m.prototype.clone=function(a){return m.clone(this,a)};m.prototype.equals=function(a){return m.equals(this,a)};m.prototype.equalsEpsilon=function(a,b,c){return m.equalsEpsilon(this,a,b,c)};m.prototype.toString=function(){return"("+this.x+", "+this.y+")"};return m});F("Core/GeographicTilingScheme","./Cartesian2 ./Check ./defaultValue ./defined ./defineProperties ./Ellipsoid ./GeographicProjection ./Math ./Rectangle".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a){a=f(a,{});this._ellipsoid=f(a.ellipsoid,l.WGS84);this._rectangle=f(a.rectangle,h.MAX_VALUE);this._projection=new m(this._ellipsoid);this._numberOfLevelZeroTilesX=f(a.numberOfLevelZeroTilesX,2);this._numberOfLevelZeroTilesY=f(a.numberOfLevelZeroTilesY,1)}g(p.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}});p.prototype.getNumberOfXTilesAtLevel=function(a){return this._numberOfLevelZeroTilesX<<a};p.prototype.getNumberOfYTilesAtLevel=function(a){return this._numberOfLevelZeroTilesY<<a};p.prototype.rectangleToNativeRectangle=function(b,f){a.defined("rectangle",b);var d=e.toDegrees(b.west),g=e.toDegrees(b.south),c=e.toDegrees(b.east),l=e.toDegrees(b.north);if(!k(f))return new h(d,g,c,l);f.west=d;f.south=g;f.east=c;f.north=l;return f};p.prototype.tileXYToNativeRectangle=function(a,b,f,h){a=this.tileXYToRectangle(a,b,f,h);a.west=e.toDegrees(a.west);a.south=e.toDegrees(a.south);a.east=e.toDegrees(a.east);a.north=e.toDegrees(a.north);return a};p.prototype.tileXYToRectangle=function(a,b,e,f){var c=this._rectangle,d=this.getNumberOfXTilesAtLevel(e);e=this.getNumberOfYTilesAtLevel(e);var g=c.width/d,d=a*g+c.west;a=(a+1)*g+c.west;g=c.height/e;e=c.north-b*g;b=c.north-(b+1)*g;k(f)||(f=new h(d,b,a,e));f.west=d;f.south=b;f.east=a;f.north=e;return f};p.prototype.positionToTileXY=function(a,f,g){var d=this._rectangle;if(h.contains(d,a)){var c=this.getNumberOfXTilesAtLevel(f);f=this.getNumberOfYTilesAtLevel(f);var l=d.width/c,p=d.height/f,m=a.longitude;d.east<d.west&&(m+=e.TWO_PI);l=(m-d.west)/l|0;l>=c&&(l=c-1);a=(d.north-a.latitude)/p|0;a>=f&&(a=f-1);if(!k(g))return new b(l,a);g.x=l;g.y=a;return g}};return p});F("Core/ApproximateTerrainHeights","./buildModuleUrl ./defaultValue ./defined ./defineProperties ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./DeveloperError ./Ellipsoid ./GeographicTilingScheme ./Rectangle ./Resource".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(c){e.fromRadians(c.east,c.north,0,B[0]);e.fromRadians(c.west,c.north,0,B[1]);e.fromRadians(c.east,c.south,0,B[2]);e.fromRadians(c.west,c.south,0,B[3]);var a=c=0,b=0,d=0,f=I._terrainHeightsMaxLevel,h;for(h=0;h<=f;++h){for(var g=!1,k=0;4>k;++k)if(v.positionToTileXY(B[k],h,C),0===k)b=C.x,d=C.y;else if(b!==C.x||d!==C.y){g=!0;break}if(g)break;c=b;a=d}if(0!==h)return{x:c,y:a,level:h>f?f:h-1}}var u=new m,y=new m,A=new e,z=new m,x=new m,D=new g,v=new q,B=[new e,new e,new e,new e],C=new l,I={initialize:function(){var c=I._initPromise;if(f(c))return c;c=r.fetchJson(b("Assets/approximateTerrainHeights.json")).then(function(c){I._terrainHeights=c});return I._initPromise=c},getMinimumMaximumHeights:function(b,e){h.defined("rectangle",b);if(!f(I._terrainHeights))throw new p("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");e=a(e,d.WGS84);var g=c(b),k=I._defaultMinTerrainHeight,l=I._defaultMaxTerrainHeight;f(g)&&(g=I._terrainHeights[g.level+"-"+g.x+"-"+g.y],f(g)&&(k=g[0],l=g[1]),e.cartographicToCartesian(t.northeast(b,A),u),e.cartographicToCartesian(t.southwest(b,A),y),m.midpoint(y,u,z),g=e.scaleToGeodeticSurface(z,x),f(g)?(g=m.distance(z,g),k=Math.min(k,-g)):k=I._defaultMinTerrainHeight);k=Math.max(I._defaultMinTerrainHeight,k);return{minimumTerrainHeight:k,maximumTerrainHeight:l}},getBoundingSphere:function(b,e){h.defined("rectangle",b);if(!f(I._terrainHeights))throw new p("You must call ApproximateTerrainHeights.initialize and wait for the promise to resolve before using this function");e=a(e,d.WGS84);var k=c(b),l=I._defaultMaxTerrainHeight;f(k)&&(k=I._terrainHeights[k.level+"-"+k.x+"-"+k.y],f(k)&&(l=k[1]));k=g.fromRectangle3D(b,e,0);g.fromRectangle3D(b,e,l,D);return g.union(k,D,k)},_terrainHeightsMaxLevel:6,_defaultMaxTerrainHeight:9E3,_defaultMinTerrainHeight:-1E5,_terrainHeights:void 0,_initPromise:void 0};k(I,{initialized:{get:function(){return f(I._terrainHeights)}}});return I});(function(b,a){"function"===typeof F&&F.amd?F("ThirdParty/purify",a):b.DOMPurify=a()})(this,function(){function b(c,a){for(var b=a.length;b--;)"string"===typeof a[b]&&(a[b]=a[b].toLowerCase()),c[a[b]]=!0;return c}function a(c){var a={},b=void 0;for(b in c)Object.prototype.hasOwnProperty.call(c,b)&&(a[b]=c[b]);return a}function f(c){if(Array.isArray(c)){for(var a=0,b=Array(c.length);a<c.length;a++)b[a]=c[a];return b}return Array.from(c)}function k(){var v=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"undefined"===typeof window?null:window,B=function(c){return k(c)};B.version="1.0.8";B.removed=[];if(!v||!v.document||9!==v.document.nodeType)return B.isSupported=!1,B;var C=v.document,I=!1,H=!1,J=v.document,w=v.DocumentFragment,G=v.Node,E=v.NodeFilter,L=v.NamedNodeMap,K=void 0===L?v.NamedNodeMap||v.MozNamedAttrMap:L,P=v.Text,N=v.Comment,O=v.DOMParser;"function"===typeof v.HTMLTemplateElement&&(L=J.createElement("template"),L.content&&L.content.ownerDocument&&(J=L.content.ownerDocument));var L=J,Z=L.implementation,aa=L.createNodeIterator,U=L.getElementsByTagName,W=L.createDocumentFragment,M=C.importNode,R={};B.isSupported=Z&&"undefined"!==typeof Z.createHTMLDocument&&9!==J.documentMode;var Y=r,Q=c,S=u,ca=y,T=z,da=x,V=A,ba=null,X=b({},[].concat(f(g),f(l),f(m),f(e),f(h))),fa=null,ga=b({},[].concat(f(p),f(d),f(q),f(t))),ka=null,na=null,ia=!0,la=!0,ha=!1,pa=!1,oa=!1,qa=!1,F=!1,ta=!1,wa=!1,za=!1,Da=!1,Ba=!0,ra=!0,Ea=!1,Ga={},Ca=b({},"audio head math script style template svg video".split(" ")),ya=b({},["audio","video","img","source","image"]),Aa=b({},"alt class for id label name pattern placeholder summary title value style xmlns".split(" ")),Ua=null,sa=J.createElement("form"),Va=function(c){"object"!==("undefined"===typeof c?"undefined":D(c))&&(c={});ba="ALLOWED_TAGS"in c?b({},c.ALLOWED_TAGS):X;fa="ALLOWED_ATTR"in c?b({},c.ALLOWED_ATTR):ga;ka="FORBID_TAGS"in c?b({},c.FORBID_TAGS):{};na="FORBID_ATTR"in c?b({},c.FORBID_ATTR):{};Ga="USE_PROFILES"in c?c.USE_PROFILES:!1;ia=!1!==c.ALLOW_ARIA_ATTR;la=!1!==c.ALLOW_DATA_ATTR;ha=c.ALLOW_UNKNOWN_PROTOCOLS||!1;pa=c.SAFE_FOR_JQUERY||!1;oa=c.SAFE_FOR_TEMPLATES||!1;qa=c.WHOLE_DOCUMENT||!1;wa=c.RETURN_DOM||!1;za=c.RETURN_DOM_FRAGMENT||!1;Da=c.RETURN_DOM_IMPORT||!1;ta=c.FORCE_BODY||!1;Ba=!1!==c.SANITIZE_DOM;ra=!1!==c.KEEP_CONTENT;Ea=c.IN_PLACE||!1;V=c.ALLOWED_URI_REGEXP||V;oa&&(la=!1);za&&(wa=!0);Ga&&(ba=b({},[].concat(f(h))),fa=[],!0===Ga.html&&(b(ba,g),b(fa,p)),!0===Ga.svg&&(b(ba,l),b(fa,d),b(fa,t)),!0===Ga.svgFilters&&(b(ba,m),b(fa,d),b(fa,t)),!0===Ga.mathMl&&(b(ba,e),b(fa,q),b(fa,t)));c.ADD_TAGS&&(ba===X&&(ba=a(ba)),b(ba,c.ADD_TAGS));c.ADD_ATTR&&(fa===ga&&(fa=a(fa)),b(fa,c.ADD_ATTR));c.ADD_URI_SAFE_ATTR&&b(Aa,c.ADD_URI_SAFE_ATTR);ra&&(ba["#text"]=!0);qa&&b(ba,["html","head","body"]);ba.table&&b(ba,["tbody"]);Object&&"freeze"in Object&&Object.freeze(c);Ua=c},xa=function(c){B.removed.push({element:c});try{c.parentNode.removeChild(c)}catch(Ta){c.outerHTML=""}},Ha=function(c,a){try{B.removed.push({attribute:a.getAttributeNode(c),from:a})}catch(Ka){B.removed.push({attribute:null,from:a})}a.removeAttribute(c)},Ma=function(c){var a=void 0,d=void 0;ta?c="\x3cremove\x3e\x3c/remove\x3e"+c:(d=(d=c.match(/^[\s]+/))&&d[0])&&(c=c.slice(d.length));if(I)try{a=(new O).parseFromString(c,"text/html")}catch(Ra){}H&&b(ka,["title"]);if(!a||!a.documentElement){var a=Z.createHTMLDocument(""),e=a.body;e.parentNode.removeChild(e.parentNode.firstElementChild);e.outerHTML=c}d&&a.body.insertBefore(J.createTextNode(d),a.body.childNodes[0]||null);return U.call(a,qa?"html":"body")[0]};if(B.isSupported){try{Ma('\x3csvg\x3e\x3cp\x3e\x3cstyle\x3e\x3cimg src\x3d"\x3c/style\x3e\x3cimg src\x3dx onerror\x3dalert(1)//"\x3e').querySelector("svg img")&&(I=!0)}catch(Oa){}try{Ma("\x3cx/\x3e\x3ctitle\x3e\x26lt;/title\x26gt;\x26lt;img\x26gt;").querySelector("title").textContent.match(/<\/title/)&&(H=!0)}catch(Oa){}}var Ia=function(c){return aa.call(c.ownerDocument||c,c,E.SHOW_ELEMENT|E.SHOW_COMMENT|E.SHOW_TEXT,function(){return E.FILTER_ACCEPT},!1)},La=function(c){return"object"===("undefined"===typeof G?"undefined":D(G))?c instanceof G:c&&"object"===("undefined"===typeof c?"undefined":D(c))&&"number"===typeof c.nodeType&&"string"===typeof c.nodeName},Fa=function(c,a,b){R[c]&&R[c].forEach(function(c){c.call(B,a,b,Ua)})},Ja=function(c){var a;Fa("beforeSanitizeElements",c,null);a=c instanceof P||c instanceof N?!1:"string"===typeof c.nodeName&&"string"===typeof c.textContent&&"function"===typeof c.removeChild&&c.attributes instanceof K&&"function"===typeof c.removeAttribute&&"function"===typeof c.setAttribute?!1:!0;if(a)return xa(c),!0;a=c.nodeName.toLowerCase();Fa("uponSanitizeElement",c,{tagName:a,allowedTags:ba});if(!ba[a]||ka[a]){if(ra&&!Ca[a]&&"function"===typeof c.insertAdjacentHTML)try{c.insertAdjacentHTML("AfterEnd",c.innerHTML)}catch(Ka){}xa(c);return!0}!pa||c.firstElementChild||c.content&&c.content.firstElementChild||!/</g.test(c.textContent)||(B.removed.push({element:c.cloneNode()}),c.innerHTML=c.innerHTML?c.innerHTML.replace(/</g,"\x26lt;"):c.textContent.replace(/</g,"\x26lt;"));oa&&3===c.nodeType&&(a=c.textContent,a=a.replace(Y," "),a=a.replace(Q," "),c.textContent!==a&&(B.removed.push({element:c.cloneNode()}),c.textContent=a));Fa("afterSanitizeElements",c,null);return!1},Qa=function(c,a,b){if(Ba&&("id"===a||"name"===a)&&(b in J||b in sa))return!1;oa&&(b=b.replace(Y," "),b=b.replace(Q," "));if(!la||!S.test(a))if(!ia||!ca.test(a))if(!fa[a]||na[a]||!(Aa[a]||V.test(b.replace(da,""))||("src"===a||"xlink:href"===a)&&"script"!==c&&0===b.indexOf("data:")&&ya[c]||ha&&!T.test(b.replace(da,"")))&&b)return!1;return!0},va=function(c){var a,b,d,e;Fa("beforeSanitizeAttributes",c,null);var f=c.attributes;if(f){var h={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:fa};for(e=f.length;e--;){var g=a=f[e],k=g.name,g=g.namespaceURI;a=a.value.trim();b=k.toLowerCase();h.attrName=b;h.attrValue=a;h.keepAttr=!0;Fa("uponSanitizeAttribute",c,h);a=h.attrValue;if("name"===b&&"IMG"===c.nodeName&&f.id)d=f.id,f=Array.prototype.slice.apply(f),Ha("id",c),Ha(k,c),f.indexOf(d)>e&&c.setAttribute("id",d.value);else if("INPUT"!==c.nodeName||"type"!==b||"file"!==a||!fa[b]&&na[b])"id"===k&&c.setAttribute(k,""),Ha(k,c);else continue;if(h.keepAttr&&(d=c.nodeName.toLowerCase(),Qa(d,b,a)))try{g?c.setAttributeNS(g,k,a):c.setAttribute(k,a),B.removed.pop()}catch(tb){}}Fa("afterSanitizeAttributes",c,null)}},Sa=function Ta(c){var a,b=Ia(c);for(Fa("beforeSanitizeShadowDOM",c,null);a=b.nextNode();)Fa("uponSanitizeShadowNode",a,null),Ja(a)||(a.content instanceof w&&Ta(a.content),va(a));Fa("afterSanitizeShadowDOM",c,null)};B.sanitize=function(c,a){var b=void 0,d,e=void 0;c||(c="\x3c!--\x3e");if("string"!==typeof c&&!La(c)){if("function"!==typeof c.toString)throw new TypeError("toString is not a function");c=c.toString();if("string"!==typeof c)throw new TypeError("dirty is not a string, aborting");}if(!B.isSupported){if("object"===D(v.toStaticHTML)||"function"===typeof v.toStaticHTML){if("string"===typeof c)return v.toStaticHTML(c);if(La(c))return v.toStaticHTML(c.outerHTML)}return c}F||Va(a);B.removed=[];if(!Ea)if(c instanceof G)b=Ma("\x3c!--\x3e"),d=b.ownerDocument.importNode(c,!0),1===d.nodeType&&"BODY"===d.nodeName?b=d:b.appendChild(d);else{if(!wa&&!qa&&-1===c.indexOf("\x3c"))return c;b=Ma(c);if(!b)return wa?null:""}b&&ta&&xa(b.firstChild);for(var f=Ia(Ea?c:b);d=f.nextNode();)3===d.nodeType&&d===e||Ja(d)||(d.content instanceof w&&Sa(d.content),va(d),e=d);if(Ea)return c;if(wa){if(za)for(e=W.call(b.ownerDocument);b.firstChild;)e.appendChild(b.firstChild);else e=b;Da&&(e=M.call(C,e,!0));return e}return qa?b.outerHTML:b.innerHTML};B.setConfig=function(c){Va(c);F=!0};B.clearConfig=function(){Ua=null;F=!1};B.isValidAttribute=function(c,a,b){Ua||Va({});c=c.toLowerCase();a=a.toLowerCase();return Qa(c,a,b)};B.addHook=function(c,a){"function"===typeof a&&(R[c]=R[c]||[],R[c].push(a))};B.removeHook=function(c){R[c]&&R[c].pop()};B.removeHooks=function(c){R[c]&&(R[c]=[])};B.removeAllHooks=function(){R={}};return B}var g="a abbr acronym address area article aside audio b bdi bdo big blink blockquote body br button canvas caption center cite code col colgroup content data datalist dd decorator del details dfn dir div dl dt element em fieldset figcaption figure font footer form h1 h2 h3 h4 h5 h6 head header hgroup hr html i img input ins kbd label legend li main map mark marquee menu menuitem meter nav nobr ol optgroup option output p pre progress q rp rt ruby s samp section select shadow small source spacer span strike strong style sub summary sup table tbody td template textarea tfoot th thead time tr track tt u ul var video wbr".split(" "),l="svg a altglyph altglyphdef altglyphitem animatecolor animatemotion animatetransform audio canvas circle clippath defs desc ellipse filter font g glyph glyphref hkern image line lineargradient marker mask metadata mpath path pattern polygon polyline radialgradient rect stop style switch symbol text textpath title tref tspan video view vkern".split(" "),m="feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence".split(" "),e="math menclose merror mfenced mfrac mglyph mi mlabeledtr mmuliscripts mn mo mover mpadded mphantom mroot mrow ms mpspace msqrt mystyle msub msup msubsup mtable mtd mtext mtr munder munderover".split(" "),h=["#text"],p="accept action align alt autocomplete background bgcolor border cellpadding cellspacing checked cite class clear color cols colspan coords crossorigin datetime default dir disabled download enctype face for headers height hidden high href hreflang id integrity ismap label lang list loop low max maxlength media method min multiple name noshade novalidate nowrap open optimum pattern placeholder poster preload pubdate radiogroup readonly rel required rev reversed role rows rowspan spellcheck scope selected shape size sizes span srclang start src srcset step style summary tabindex title type usemap valign value width xmlns".split(" "),d="accent-height accumulate additivive alignment-baseline ascent attributename attributetype azimuth basefrequency baseline-shift begin bias by class clip clip-path clip-rule color color-interpolation color-interpolation-filters color-profile color-rendering cx cy d dx dy diffuseconstant direction display divisor dur edgemode elevation end fill fill-opacity fill-rule filter flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight fx fy g1 g2 glyph-name glyphref gradientunits gradienttransform height href id image-rendering in in2 k k1 k2 k3 k4 kerning keypoints keysplines keytimes lang lengthadjust letter-spacing kernelmatrix kernelunitlength lighting-color local marker-end marker-mid marker-start markerheight markerunits markerwidth maskcontentunits maskunits max mask media method mode min name numoctaves offset operator opacity order orient orientation origin overflow paint-order path pathlength patterncontentunits patterntransform patternunits points preservealpha preserveaspectratio r rx ry radius refx refy repeatcount repeatdur restart result rotate scale seed shape-rendering specularconstant specularexponent spreadmethod stddeviation stitchtiles stop-color stop-opacity stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke stroke-width style surfacescale tabindex targetx targety transform text-anchor text-decoration text-rendering textlength type u1 u2 unicode values viewbox visibility vert-adv-y vert-origin-x vert-origin-y width word-spacing wrap writing-mode xchannelselector ychannelselector x x1 x2 xmlns y y1 y2 z zoomandpan".split(" "),q="accent accentunder align bevelled close columnsalign columnlines columnspan denomalign depth dir display displaystyle fence frame height href id largeop length linethickness lspace lquote mathbackground mathcolor mathsize mathvariant maxsize minsize movablelimits notation numalign open rowalign rowlines rowspacing rowspan rspace rquote scriptlevel scriptminsize scriptsizemultiplier selection separator separators stretchy subscriptshift supscriptshift symmetric voffset width xmlns".split(" "),t=["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"],r=/\{\{[\s\S]*|[\s\S]*\}\}/gm,c=/<%[\s\S]*|[\s\S]*%>/gm,u=/^data-[\-\w.\u00B7-\uFFFF]/,y=/^aria-[\-\w]+$/,A=/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i,z=/^(?:\w+script|data):/i,x=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g;$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbolIterator();var D="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(c){return typeof c}:function(c){$jscomp.initSymbol();$jscomp.initSymbol();$jscomp.initSymbol();return c&&"function"===typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?"symbol":typeof c};return k()});F("Core/Credit",["../ThirdParty/purify","./defaultValue","./defined","./defineProperties","./Check"],function(b,a,f,k,g){function l(b,k){g.typeOf.string("html",b);var d;f(e[b])?d=e[b]:(d=m++,e[b]=d);k=a(k,!1);this._id=d;this._html=b;this._showOnScreen=k;this._element=void 0}var m=0,e={};k(l.prototype,{html:{get:function(){return this._html}},id:{get:function(){return this._id}},showOnScreen:{get:function(){return this._showOnScreen}},element:{get:function(){if(!f(this._element)){var a=b.sanitize(this._html),e=document.createElement("div");e._creditId=this._id;e.style.display="inline";e.innerHTML=a;for(var a=e.querySelectorAll("a"),d=0;d<a.length;d++)a[d].setAttribute("target","_blank");this._element=e}return this._element}}});l.equals=function(a,b){return a===b||f(a)&&f(b)&&a._id===b._id};l.prototype.equals=function(a){return l.equals(this,a)};l.getIonCredit=function(a){var b=f(a.collapsible)&&!a.collapsible;a=new l(a.html,b);a._isIon=-1!==a.html.indexOf("ion-credit.png");return a};l.clone=function(a){if(f(a))return new l(a.html,a.showOnScreen)};return l});F("Core/HeightmapEncoding",["./freezeObject"],function(b){return b({NONE:0,LERC:1})});F("Core/AxisAlignedBoundingBox",["./Cartesian3","./Check","./defaultValue","./defined","./Intersect"],function(b,a,f,k,g){function l(a,h,g){this.minimum=b.clone(f(a,b.ZERO));this.maximum=b.clone(f(h,b.ZERO));this.center=g=k(g)?b.clone(g):b.midpoint(this.minimum,this.maximum,new b)}l.fromPoints=function(a,f){k(f)||(f=new l);if(!k(a)||0===a.length)return f.minimum=b.clone(b.ZERO,f.minimum),f.maximum=b.clone(b.ZERO,f.maximum),f.center=b.clone(b.ZERO,f.center),f;for(var e=a[0].x,d=a[0].y,h=a[0].z,g=a[0].x,m=a[0].y,c=a[0].z,u=a.length,y=1;y<u;y++)var A=a[y],z=A.x,x=A.y,A=A.z,e=Math.min(z,e),g=Math.max(z,g),d=Math.min(x,d),m=Math.max(x,m),h=Math.min(A,h),c=Math.max(A,c);u=f.minimum;u.x=e;u.y=d;u.z=h;e=f.maximum;e.x=g;e.y=m;e.z=c;f.center=b.midpoint(u,e,f.center);return f};l.clone=function(a,f){if(k(a)){if(!k(f))return new l(a.minimum,a.maximum,a.center);f.minimum=b.clone(a.minimum,f.minimum);f.maximum=b.clone(a.maximum,f.maximum);f.center=b.clone(a.center,f.center);return f}};l.equals=function(a,f){return a===f||k(a)&&k(f)&&b.equals(a.center,f.center)&&b.equals(a.minimum,f.minimum)&&b.equals(a.maximum,f.maximum)};var m=new b;l.intersectPlane=function(e,f){a.defined("box",e);a.defined("plane",f);m=b.subtract(e.maximum,e.minimum,m);var h=b.multiplyByScalar(m,.5,m),d=f.normal,h=h.x*Math.abs(d.x)+h.y*Math.abs(d.y)+h.z*Math.abs(d.z),d=b.dot(e.center,d)+f.distance;return 0<d-h?g.INSIDE:0>d+h?g.OUTSIDE:g.INTERSECTING};l.prototype.clone=function(a){return l.clone(this,a)};l.prototype.intersectPlane=function(a){return l.intersectPlane(this,a)};l.prototype.equals=function(a){return l.equals(this,a)};return l});F("Core/EllipsoidalOccluder","./BoundingSphere ./Cartesian3 ./Check ./defaultValue ./defined ./defineProperties ./Rectangle".split(" "),function(b,a,f,k,g,l,m){function e(c,b){f.typeOf.object("ellipsoid",c);this._ellipsoid=c;this._cameraPosition=new a;this._cameraPositionInScaledSpace=new a;this._distanceToLimbInScaledSpaceSquared=0;g(b)&&(this.cameraPosition=b)}function h(b,d,e){var f=b.transformPositionToScaledSpace(d,c);b=a.magnitudeSquared(f);d=Math.sqrt(b);var h=a.divideByScalar(f,d,u);b=Math.max(1,b);d=Math.max(1,d);f=a.dot(h,e);e=a.magnitude(a.cross(h,e,h));d=1/d;return 1/(f*d-e*Math.sqrt(b-1)*d)}function p(c,b,d){if(!(0>=b||b===1/0||b!==b))return a.multiplyByScalar(c,b,d)}function d(c,b){if(a.equals(b,a.ZERO))return b;c.transformPositionToScaledSpace(b,y);return a.normalize(y,y)}l(e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cameraPosition:{get:function(){return this._cameraPosition},set:function(c){var b=this._ellipsoid.transformPositionToScaledSpace(c,this._cameraPositionInScaledSpace),d=a.magnitudeSquared(b)-1;a.clone(c,this._cameraPosition);this._cameraPositionInScaledSpace=b;this._distanceToLimbInScaledSpaceSquared=d}}});var q=new a;e.prototype.isPointVisible=function(c){c=this._ellipsoid.transformPositionToScaledSpace(c,q);return this.isScaledSpacePointVisible(c)};e.prototype.isScaledSpacePointVisible=function(c){var b=this._cameraPositionInScaledSpace,d=this._distanceToLimbInScaledSpaceSquared;c=a.subtract(c,b,q);b=-a.dot(c,b);return!(0>d?0<b:b>d&&b*b/a.magnitudeSquared(c)>d)};e.prototype.computeHorizonCullingPoint=function(c,b,e){f.typeOf.object("directionToPoint",c);f.defined("positions",b);g(e)||(e=new a);var k=this._ellipsoid;c=d(k,c);for(var l=0,m=0,q=b.length;m<q;++m)var r=h(k,b[m],c),l=Math.max(l,r);return p(c,l,e)};var t=new a;e.prototype.computeHorizonCullingPointFromVertices=function(c,b,e,l,m){f.typeOf.object("directionToPoint",c);f.defined("vertices",b);f.typeOf.number("stride",e);g(m)||(m=new a);l=k(l,a.ZERO);var q=this._ellipsoid;c=d(q,c);for(var v=0,r=0,u=b.length;r<u;r+=e){t.x=b[r]+l.x;t.y=b[r+1]+l.y;t.z=b[r+2]+l.z;var z=h(q,t,c),v=Math.max(v,z)}return p(c,v,m)};var r=[];e.prototype.computeHorizonCullingPointFromRectangle=function(c,d,e){f.typeOf.object("rectangle",c);c=m.subsample(c,d,0,r);var h=b.fromPoints(c);if(!(a.magnitude(h.center)<.1*d.minimumRadius))return this.computeHorizonCullingPoint(h.center,c,e)};var c=new a,u=new a,y=new a;return e});F("Core/QuadraticRealPolynomial",["./DeveloperError","./Math"],function(b,a){function f(b,f,l){var g=b+f;return a.sign(b)!==a.sign(f)&&Math.abs(g/Math.max(Math.abs(b),Math.abs(f)))<l?0:g}return{computeDiscriminant:function(a,f,l){if("number"!==typeof a)throw new b("a is a required number.");if("number"!==typeof f)throw new b("b is a required number.");if("number"!==typeof l)throw new b("c is a required number.");return f*f-4*a*l},computeRealRoots:function(k,g,l){if("number"!==typeof k)throw new b("a is a required number.");if("number"!==typeof g)throw new b("b is a required number.");if("number"!==typeof l)throw new b("c is a required number.");if(0===k)return 0===g?[]:[-l/g];if(0===g){if(0===l)return[0,0];g=Math.abs(l);var m=Math.abs(k);if(g<m&&g/m<a.EPSILON14)return[0,0];if(g>m&&m/g<a.EPSILON14)return[];k=-l/k;if(0>k)return[];k=Math.sqrt(k);return[-k,k]}if(0===l)return k=-g/k,0>k?[k,0]:[0,k];m=f(g*g,-(4*k*l),a.EPSILON14);if(0>m)return[];m=-.5*f(g,a.sign(g)*Math.sqrt(m),a.EPSILON14);return 0<g?[m/k,l/m]:[l/m,m/k]}}});F("Core/CubicRealPolynomial",["./DeveloperError","./QuadraticRealPolynomial"],function(b,a){function f(a,b,f,m){b/=3;f/=3;var e=a*f,h=b*m,g=b*b,d=f*f,k=a*f-g,l=a*m-b*f,r=b*m-d,c=4*k*r-l*l,u;if(0>c){var y;g*h>=e*d?(y=a,u=k,l=-2*b*k+a*l):(y=m,u=r,l=-m*l+2*f*r);r=-(0>l?-1:1)*Math.abs(y)*Math.sqrt(-c);k=-l+r;c=k/2;c=0>c?-Math.pow(-c,1/3):Math.pow(c,1/3);k=k===r?-c:-u/c;u=0>=u?c+k:-l/(c*c+k*k+u);return g*h>=e*d?[(u-b)/a]:[-m/(u+f)]}g=Math.sqrt(c);d=Math.sqrt(3)/2;c=Math.abs(Math.atan2(a*g,-(-2*b*k+a*l))/3);u=2*Math.sqrt(-k);y=Math.cos(c);k=u*y;u*=-y/2-d*Math.sin(c);h=k+u>2*b?k-b:u-b;e=h/a;c=Math.abs(Math.atan2(m*g,-(-m*l+2*f*r))/3);u=2*Math.sqrt(-r);y=Math.cos(c);k=u*y;u*=-y/2-d*Math.sin(c);m=-m;l=k+u<2*f?k+f:u+f;k=m/l;r=-h*l-a*m;a=(f*r-b*h*m)/(-b*r+f*a*l);return e<=a?e<=k?a<=k?[e,a,k]:[e,k,a]:[k,e,a]:e<=k?[a,e,k]:a<=k?[a,k,e]:[k,a,e]}return{computeDiscriminant:function(a,f,l,m){if("number"!==typeof a)throw new b("a is a required number.");if("number"!==typeof f)throw new b("b is a required number.");if("number"!==typeof l)throw new b("c is a required number.");if("number"!==typeof m)throw new b("d is a required number.");var e=f*f,h=l*l;return 18*a*f*l*m+e*h-27*a*a*m*m-4*(a*h*l+e*f*m)},computeRealRoots:function(k,g,l,m){if("number"!==typeof k)throw new b("a is a required number.");if("number"!==typeof g)throw new b("b is a required number.");if("number"!==typeof l)throw new b("c is a required number.");if("number"!==typeof m)throw new b("d is a required number.");if(0===k)return a.computeRealRoots(g,l,m);if(0===g){if(0===l){if(0===m)return[0,0,0];k=-m/k;k=0>k?-Math.pow(-k,1/3):Math.pow(k,1/3);return[k,k,k]}return 0===m?(k=a.computeRealRoots(k,0,l),0===k.Length?[0]:[k[0],0,k[1]]):f(k,0,l,m)}return 0===l?0===m?(k=-g/k,0>k?[k,0,0]:[0,0,k]):f(k,g,0,m):0===m?(k=a.computeRealRoots(k,g,l),0===k.length?[0]:0>=k[1]?[k[0],k[1],0]:0<=k[0]?[0,k[0],k[1]]:[k[0],0,k[1]]):f(k,g,l,m)}}});F("Core/QuarticRealPolynomial",["./CubicRealPolynomial","./DeveloperError","./Math","./QuadraticRealPolynomial"],function(b,a,f,k){function g(a,e,h,g){var d=a*a,l=e-3*d/8,p=h-e*a/2+d*a/8;e=g-h*a/4+e*d/16-3*d*d/256;h=b.computeRealRoots(1,2*l,l*l-4*e,-p*p);if(0<h.length)if(a=-a/4,h=h[h.length-1],Math.abs(h)<f.EPSILON14){if(p=k.computeRealRoots(1,l,e),2===p.length){l=p[0];p=p[1];if(0<=l&&0<=p)return l=Math.sqrt(l),p=Math.sqrt(p),[a-p,a-l,a+l,a+p];if(0<=l&&0>p)return l=Math.sqrt(l),[a-l,a+l];if(0>l&&0<=p)return l=Math.sqrt(p),[a-l,a+l]}}else if(0<h){e=Math.sqrt(h);g=(l+h+p/e)/2;l=k.computeRealRoots(1,e,(l+h-p/e)/2);p=k.computeRealRoots(1,-e,g);if(0!==l.length)return l[0]+=a,l[1]+=a,0!==p.length?(p[0]+=a,p[1]+=a,l[1]<=p[0]?[l[0],l[1],p[0],p[1]]:p[1]<=l[0]?[p[0],p[1],l[0],l[1]]:l[0]>=p[0]&&l[1]<=p[1]?[p[0],l[0],l[1],p[1]]:p[0]>=l[0]&&p[1]<=l[1]?[l[0],p[0],p[1],l[1]]:l[0]>p[0]&&l[0]<p[1]?[p[0],l[0],p[1],l[1]]:[l[0],p[0],l[1],p[1]]):l;if(0!==p.length)return p[0]+=a,p[1]+=a,p}return[]}function l(a,e,h,g){var d=a*a,l=b.computeRealRoots(1,-2*e,h*a+e*e-4*g,d*g-h*e*a+h*h);if(0<l.length){l=l[0];e-=l;var p=e*e,m=a/2;e/=2;var c=p-4*g,p=p+4*Math.abs(g),u=d-4*l,d=d+4*Math.abs(l);0>l||c*d<u*p?(c=Math.sqrt(u),d=c/2,h=0===c?0:(a*e-h)/c):(c=Math.sqrt(c),d=0===c?0:(a*e-h)/c,h=c/2);0===m&&0===d?a=m=0:f.sign(m)===f.sign(d)?(m+=d,a=l/m):(a=m-d,m=l/a);0===e&&0===h?l=h=0:f.sign(e)===f.sign(h)?(h=e+h,l=g/h):(l=e-h,h=g/l);g=k.computeRealRoots(1,m,h);l=k.computeRealRoots(1,a,l);if(0!==g.length)return 0!==l.length?g[1]<=l[0]?[g[0],g[1],l[0],l[1]]:l[1]<=g[0]?[l[0],l[1],g[0],g[1]]:g[0]>=l[0]&&g[1]<=l[1]?[l[0],g[0],g[1],l[1]]:l[0]>=g[0]&&l[1]<=g[1]?[g[0],l[0],l[1],g[1]]:g[0]>l[0]&&g[0]<l[1]?[l[0],g[0],l[1],g[1]]:[g[0],l[0],g[1],l[1]]:g;if(0!==l.length)return l}return[]}return{computeDiscriminant:function(b,e,f,g,d){if("number"!==typeof b)throw new a("a is a required number.");if("number"!==typeof e)throw new a("b is a required number.");if("number"!==typeof f)throw new a("c is a required number.");if("number"!==typeof g)throw new a("d is a required number.");if("number"!==typeof d)throw new a("e is a required number.");var h=b*b,k=e*e,l=k*e,c=f*f,p=c*f,m=g*g,A=m*g,z=d*d;return k*c*m-4*l*A-4*b*p*m+18*b*e*f*A-27*h*m*m+256*h*b*z*d+d*(18*l*f*g-4*k*p+16*b*c*c-80*b*e*c*g-6*b*k*m+144*h*f*m)+z*(144*b*k*f-27*k*k-128*h*c-192*h*e*g)},computeRealRoots:function(k,e,h,p,d){if("number"!==typeof k)throw new a("a is a required number.");if("number"!==typeof e)throw new a("b is a required number.");if("number"!==typeof h)throw new a("c is a required number.");if("number"!==typeof p)throw new a("d is a required number.");if("number"!==typeof d)throw new a("e is a required number.");if(Math.abs(k)<f.EPSILON15)return b.computeRealRoots(e,h,p,d);e/=k;h/=k;p/=k;k=d/k;d=0>e?1:0;d+=0>h?d+1:d;d+=0>p?d+1:d;switch(d+(0>k?d+1:d)){case 0:return g(e,h,p,k);case 1:return l(e,h,p,k);case 2:return l(e,h,p,k);case 3:return g(e,h,p,k);case 4:return g(e,h,p,k);case 5:return l(e,h,p,k);case 6:return g(e,h,p,k);case 7:return g(e,h,p,k);case 8:return l(e,h,p,k);case 9:return g(e,h,p,k);case 10:return g(e,h,p,k);case 11:return l(e,h,p,k);case 12:return g(e,h,p,k);case 13:return g(e,h,p,k);case 14:return g(e,h,p,k);case 15:return g(e,h,p,k)}}}});F("Core/Ray",["./Cartesian3","./Check","./defaultValue","./defined"],function(b,a,f,k){function g(a,g){g=b.clone(f(g,b.ZERO));b.equals(g,b.ZERO)||b.normalize(g,g);this.origin=b.clone(f(a,b.ZERO));this.direction=g}g.clone=function(a,f){if(k(a)){if(!k(f))return new g(a.origin,a.direction);f.origin=b.clone(a.origin);f.direction=b.clone(a.direction);return f}};g.getPoint=function(f,g,e){a.typeOf.object("ray",f);a.typeOf.number("t",g);k(e)||(e=new b);e=b.multiplyByScalar(f.direction,g,e);return b.add(f.origin,e,e)};return g});F("Core/IntersectionTests","./Cartesian3 ./Cartographic ./defaultValue ./defined ./DeveloperError ./Interval ./Math ./Matrix3 ./QuadraticRealPolynomial ./QuarticRealPolynomial ./Ray".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(c,a,d){k(d)||(d=new l);var e=c.direction,f=a.radius*a.radius;a=b.subtract(c.origin,a.center,y);c=b.dot(e,e);e=2*b.dot(e,a);a=b.magnitudeSquared(a)-f;f=D;a=e*e-4*c*a;if(0>a)e=void 0;else if(0<a){c=1/(2*c);var h=Math.sqrt(a);a=(-e+h)*c;e=(-e-h)*c;a<e?(f.root0=a,f.root1=e):(f.root0=e,f.root1=a);e=f}else e=-e/(2*c),0===e?e=void 0:(f.root0=f.root1=e,e=f);if(k(e))return d.start=e.root0,d.stop=e.root1,d}function t(c,a,b){var d=c+a;return m.sign(c)!==m.sign(a)&&Math.abs(d/Math.max(Math.abs(c),Math.abs(a)))<b?0:d}var r={rayPlane:function(c,a,d){if(!k(c))throw new g("ray is required.");if(!k(a))throw new g("plane is required.");k(d)||(d=new b);var e=c.origin;c=c.direction;var f=a.normal,h=b.dot(f,c);if(!(Math.abs(h)<m.EPSILON15||(a=(-a.distance-b.dot(f,e))/h,0>a)))return d=b.multiplyByScalar(c,a,d),b.add(e,d,d)}},c=new b,u=new b,y=new b,A=new b,z=new b;r.rayTriangleParametric=function(a,d,e,h,l){if(!k(a))throw new g("ray is required.");if(!k(d))throw new g("p0 is required.");if(!k(e))throw new g("p1 is required.");if(!k(h))throw new g("p2 is required.");l=f(l,!1);var p=a.origin;a=a.direction;e=b.subtract(e,d,c);h=b.subtract(h,d,u);var q=b.cross(a,h,y),v=b.dot(e,q);if(l){if(v<m.EPSILON6)return;p=b.subtract(p,d,A);d=b.dot(p,q);if(0>d||d>v)return;p=b.cross(p,e,z);a=b.dot(a,p);if(0>a||d+a>v)return;a=b.dot(h,p)/v}else{if(Math.abs(v)<m.EPSILON6)return;v=1/v;p=b.subtract(p,d,A);d=b.dot(p,q)*v;if(0>d||1<d)return;p=b.cross(p,e,z);a=b.dot(a,p)*v;if(0>a||1<d+a)return;a=b.dot(h,p)*v}return a};r.rayTriangle=function(c,a,d,e,f,h){a=r.rayTriangleParametric(c,a,d,e,f);if(k(a)&&!(0>a))return k(h)||(h=new b),b.multiplyByScalar(c.direction,a,h),b.add(c.origin,h,h)};var x=new d;r.lineSegmentTriangle=function(c,a,d,e,f,h,l){if(!k(c))throw new g("v0 is required.");if(!k(a))throw new g("v1 is required.");if(!k(d))throw new g("p0 is required.");if(!k(e))throw new g("p1 is required.");if(!k(f))throw new g("p2 is required.");b.clone(c,x.origin);b.subtract(a,c,x.direction);b.normalize(x.direction,x.direction);d=r.rayTriangleParametric(x,d,e,f,h);if(!(!k(d)||0>d||d>b.distance(c,a)))return k(l)||(l=new b),b.multiplyByScalar(x.direction,d,l),b.add(x.origin,l,l)};var D={root0:0,root1:0};r.raySphere=function(c,a,b){if(!k(c))throw new g("ray is required.");if(!k(a))throw new g("sphere is required.");b=q(c,a,b);if(k(b)&&!(0>b.stop))return b.start=Math.max(b.start,0),b};var v=new d;r.lineSegmentSphere=function(c,a,d,e){if(!k(c))throw new g("p0 is required.");if(!k(a))throw new g("p1 is required.");if(!k(d))throw new g("sphere is required.");b.clone(c,v.origin);c=b.subtract(a,c,v.direction);a=b.magnitude(c);b.normalize(c,c);e=q(v,d,e);if(!(!k(e)||0>e.stop||e.start>a))return e.start=Math.max(e.start,0),e.stop=Math.min(e.stop,a),e};var B=new b,C=new b;r.rayEllipsoid=function(c,a){if(!k(c))throw new g("ray is required.");if(!k(a))throw new g("ellipsoid is required.");var d=a.oneOverRadii,e=b.multiplyComponents(d,c.origin,B),f=b.multiplyComponents(d,c.direction,C),d=b.magnitudeSquared(e),e=b.dot(e,f),h;if(1<d){if(0<=e)return;var p=e*e,d=d-1,f=b.magnitudeSquared(f);h=f*d;if(p<h)return;if(p>h)return e=-e+Math.sqrt(e*e-h),p=e/f,d/=e,p<d?new l(p,d):{start:d,stop:p};d=Math.sqrt(d/f);return new l(d,d)}if(1>d)return--d,f=b.magnitudeSquared(f),e=-e+Math.sqrt(e*e-f*d),new l(0,e/f);if(0>e)return f=b.magnitudeSquared(f),new l(0,-e/f)};var I=new b,H=new b,J=new b,w=new b,G=new b,E=new e,L=new e,K=new e,P=new e,N=new e,O=new e,Z=new e,aa=new b,U=new b,W=new a;r.grazingAltitudeLocation=function(c,a){if(!k(c))throw new g("ray is required.");if(!k(a))throw new g("ellipsoid is required.");var d=c.origin,f=c.direction;if(!b.equals(d,b.ZERO)){var l=a.geodeticSurfaceNormal(d,I);if(0<=b.dot(f,l))return d}var l=k(this.rayEllipsoid(c,a)),q=a.transformPositionToScaledSpace(f,I),v=b.normalize(q,q),q=b.mostOrthogonalAxis(q,w),q=b.normalize(b.cross(q,v,H),H),B=b.normalize(b.cross(v,q,J),J);E[0]=v.x;E[1]=v.y;E[2]=v.z;E[3]=q.x;E[4]=q.y;E[5]=q.z;E[6]=B.x;E[7]=B.y;E[8]=B.z;q=e.transpose(E,L);v=e.fromScale(a.radii,K);B=e.fromScale(a.oneOverRadii,P);N[0]=0;N[1]=-f.z;N[2]=f.y;N[3]=f.z;N[4]=0;N[5]=-f.x;N[6]=-f.y;N[7]=f.x;N[8]=0;B=e.multiply(e.multiply(q,B,O),N,O);q=e.multiply(e.multiply(B,v,Z),E,Z);B=e.multiplyByVector(B,d,G);var r=b.negate(B,I),B=1*(q[e.COLUMN1ROW1]-q[e.COLUMN2ROW2]),C=1*(0*t(q[e.COLUMN1ROW0],q[e.COLUMN0ROW1],m.EPSILON15)+r.y),u=0*q[e.COLUMN0ROW0]+1*q[e.COLUMN2ROW2]+0*r.x+0,z=1*t(q[e.COLUMN2ROW1],q[e.COLUMN1ROW2],m.EPSILON15),r=1*(0*t(q[e.COLUMN2ROW0],q[e.COLUMN0ROW2])+r.z),y,q=[];if(0===r&&0===z)y=h.computeRealRoots(B,C,u),0!==y.length&&(B=y[0],C=Math.sqrt(Math.max(1-B*B,0)),q.push(new b(0,1*B,1*-C)),q.push(new b(0,1*B,1*C)),2===y.length&&(B=y[1],C=Math.sqrt(Math.max(1-B*B,0)),q.push(new b(0,1*B,1*-C)),q.push(new b(0,1*B,1*C))));else{y=r*r;var x=z*z,D=r*z,A=B*B+x,M=2*(C*B+D),x=2*u*B+C*C-x+y,D=2*(u*C-D);if(0!==A||0!==M||0!==x||0!==D)if(y=p.computeRealRoots(A,M,x,D,u*u-y),A=y.length,0!==A)for(M=0;M<A;++M){var D=y[M],R=D*D,x=Math.sqrt(Math.max(1-R,0)),R=m.sign(B)===m.sign(u)?t(B*R+u,C*D,m.EPSILON12):m.sign(u)===m.sign(C*D)?t(B*R,C*D+u,m.EPSILON12):t(B*R+C*D,u,m.EPSILON12),Y=t(z*D,r,m.EPSILON15),R=R*Y;0>R?q.push(new b(0,1*D,1*x)):0<R?q.push(new b(0,1*D,1*-x)):0!==x?(q.push(new b(0,1*D,1*-x)),q.push(new b(0,1*D,1*x)),++M):q.push(new b(0,1*D,1*x))}}z=q.length;if(0<z){B=b.clone(b.ZERO,U);C=Number.NEGATIVE_INFINITY;for(r=0;r<z;++r)u=e.multiplyByVector(v,e.multiplyByVector(E,q[r],aa),aa),y=b.normalize(b.subtract(u,d,w),w),y=b.dot(y,f),y>C&&(C=y,B=b.clone(u,B));f=a.cartesianToCartographic(B,W);C=m.clamp(C,0,1);d=b.magnitude(b.subtract(B,d,w))*Math.sqrt(1-C*C);f.height=l?-d:d;return a.cartographicToCartesian(f,new b)}};var M=new b;r.lineSegmentPlane=function(c,a,d,e){if(!k(c))throw new g("endPoint0 is required.");if(!k(a))throw new g("endPoint1 is required.");if(!k(d))throw new g("plane is required.");k(e)||(e=new b);a=b.subtract(a,c,M);var f=d.normal,h=b.dot(f,a);if(!(Math.abs(h)<m.EPSILON6||(f=b.dot(f,c),d=-(d.distance+f)/h,0>d||1<d)))return b.multiplyByScalar(a,d,e),b.add(c,e,e),e};r.trianglePlaneIntersection=function(c,a,d,e){if(!(k(c)&&k(a)&&k(d)&&k(e)))throw new g("p0, p1, p2, and plane are required.");var f=e.normal,h=e.distance,l=0>b.dot(f,c)+h,p=0>b.dot(f,a)+h,f=0>b.dot(f,d)+h,h=0+(l?1:0)+(p?1:0)+(f?1:0),m,q;if(1===h||2===h)m=new b,q=new b;if(1===h){if(l)return r.lineSegmentPlane(c,a,e,m),r.lineSegmentPlane(c,d,e,q),{positions:[c,a,d,m,q],indices:[0,3,4,1,2,4,1,4,3]};if(p)return r.lineSegmentPlane(a,d,e,m),r.lineSegmentPlane(a,c,e,q),{positions:[c,a,d,m,q],indices:[1,3,4,2,0,4,2,4,3]};if(f)return r.lineSegmentPlane(d,c,e,m),r.lineSegmentPlane(d,a,e,q),{positions:[c,a,d,m,q],indices:[2,3,4,0,1,4,0,4,3]}}else if(2===h)if(l){if(!p)return r.lineSegmentPlane(d,a,e,m),r.lineSegmentPlane(c,a,e,q),{positions:[c,a,d,m,q],indices:[2,0,4,2,4,3,1,3,4]};if(!f)return r.lineSegmentPlane(c,d,e,m),r.lineSegmentPlane(a,d,e,q),{positions:[c,a,d,m,q],indices:[0,1,4,0,4,3,2,3,4]}}else return r.lineSegmentPlane(a,c,e,m),r.lineSegmentPlane(d,c,e,q),{positions:[c,a,d,m,q],indices:[1,2,4,1,4,3,0,3,4]}};return r});F("Core/Plane","./Cartesian3 ./Check ./defined ./DeveloperError ./freezeObject ./Math ./Matrix4".split(" "),function(b,a,f,k,g,l,m){function e(d,e){a.typeOf.object("normal",d);if(!l.equalsEpsilon(b.magnitude(d),1,l.EPSILON6))throw new k("normal must be normalized.");a.typeOf.number("distance",e);this.normal=b.clone(d);this.distance=e}e.fromPointNormal=function(d,h,g){a.typeOf.object("point",d);a.typeOf.object("normal",h);if(!l.equalsEpsilon(b.magnitude(h),1,l.EPSILON6))throw new k("normal must be normalized.");d=-b.dot(h,d);if(!f(g))return new e(h,d);b.clone(h,g.normal);g.distance=d;return g};var h=new b;e.fromCartesian4=function(d,g){a.typeOf.object("coefficients",d);var p=b.fromCartesian4(d,h),c=d.w;if(!l.equalsEpsilon(b.magnitude(p),1,l.EPSILON6))throw new k("normal must be normalized.");if(!f(g))return new e(p,c);b.clone(p,g.normal);g.distance=c;return g};e.getPointDistance=function(d,e){a.typeOf.object("plane",d);a.typeOf.object("point",e);return b.dot(d.normal,e)+d.distance};var p=new b;e.projectPointOntoPlane=function(d,h,g){a.typeOf.object("plane",d);a.typeOf.object("point",h);f(g)||(g=new b);var c=e.getPointDistance(d,h);d=b.multiplyByScalar(d.normal,c,p);return b.subtract(h,d,g)};var d=new b;e.transform=function(f,g,k){a.typeOf.object("plane",f);a.typeOf.object("transform",g);m.multiplyByPointAsVector(g,f.normal,h);b.normalize(h,h);b.multiplyByScalar(f.normal,-f.distance,d);m.multiplyByPoint(g,d,d);return e.fromPointNormal(d,h,k)};e.clone=function(d,h){a.typeOf.object("plane",d);if(!f(h))return new e(d.normal,d.distance);b.clone(d.normal,h.normal);h.distance=d.distance;return h};e.equals=function(d,e){a.typeOf.object("left",d);a.typeOf.object("right",e);return d.distance===e.distance&&b.equals(d.normal,e.normal)};e.ORIGIN_XY_PLANE=g(new e(b.UNIT_Z,0));e.ORIGIN_YZ_PLANE=g(new e(b.UNIT_X,0));e.ORIGIN_ZX_PLANE=g(new e(b.UNIT_Y,0));return e});F("Core/binarySearch",["./Check"],function(b){return function(a,f,k){b.defined("array",a);b.defined("itemToFind",f);b.defined("comparator",k);for(var g=0,l=a.length-1,m,e;g<=l;)if(m=~~((g+l)/2),e=k(a[m],f),0>e)g=m+1;else if(0<e)l=m-1;else return m;return~(l+1)}});F("Core/EarthOrientationParametersSample",[],function(){return function(b,a,f,k,g){this.xPoleWander=b;this.yPoleWander=a;this.xPoleOffset=f;this.yPoleOffset=k;this.ut1MinusUtc=g}});F("ThirdParty/sprintf",[],function(){return function(){var b=arguments,a=0,f=function(a,b,e,f){e||(e=" ");b=a.length>=b?"":Array(1+b-a.length>>>0).join(e);return f?a+b:b+a},k=function(a,b,e,h,g,d){var k=h-a.length;0<k&&(a=e||!g?f(a,h,d,e):a.slice(0,b.length)+f("",k,"0",!0)+a.slice(b.length));return a},g=function(a,b,e,h,g,d,q){a>>>=0;e=e&&a&&{2:"0b",8:"0",16:"0x"}[b]||"";a=e+f(a.toString(b),d||0,"0",!1);return k(a,e,h,g,q)};return b[a++].replace(/%%|%(\d+\$)?([-+\'#0 ]*)(\*\d+\$|\*|\d+)?(\.(\*\d+\$|\*|\d+))?([scboxXuideEfFgG])/g,function(l,m,e,h,p,d,q){var t,r;if("%%"==l)return"%";var c=!1;r="";var u=p=!1;t=" ";for(var y=e.length,A=0;e&&A<y;A++)switch(e.charAt(A)){case " ":r=" ";break;case "+":r="+";break;case "-":c=!0;break;case "'":t=e.charAt(A+1);break;case "0":p=!0;break;case "#":u=!0}h=h?"*"==h?+b[a++]:"*"==h.charAt(0)?+b[h.slice(1,-1)]:+h:0;0>h&&(h=-h,c=!0);if(!isFinite(h))throw Error("sprintf: (minimum-)width must be finite");d=d?"*"==d?+b[a++]:"*"==d.charAt(0)?+b[d.slice(1,-1)]:+d:-1<"fFeE".indexOf(q)?6:"d"==q?0:void 0;m=m?b[m.slice(0,-1)]:b[a++];switch(q){case "s":return q=String(m),null!=d&&(q=q.slice(0,d)),k(q,"",c,h,p,t);case "c":return q=String.fromCharCode(+m),null!=d&&(q=q.slice(0,d)),k(q,"",c,h,p,void 0);case "b":return g(m,2,u,c,h,d,p);case "o":return g(m,8,u,c,h,d,p);case "x":return g(m,16,u,c,h,d,p);case "X":return g(m,16,u,c,h,d,p).toUpperCase();case "u":return g(m,10,u,c,h,d,p);case "i":case "d":return t=+m||0,t=Math.round(t-t%1),l=0>t?"-":r,m=l+f(String(Math.abs(t)),d,"0",!1),k(m,l,c,h,p);case "e":case "E":case "f":case "F":case "g":case "G":return t=+m,l=0>t?"-":r,r=["toExponential","toFixed","toPrecision"]["efg".indexOf(q.toLowerCase())],q=["toString","toUpperCase"]["eEfFgG".indexOf(q)%2],m=l+Math.abs(t)[r](d),k(m,l,c,h,p)[q]();default:return l}})}});F("Core/GregorianDate",[],function(){return function(b,a,f,k,g,l,m,e){this.year=b;this.month=a;this.day=f;this.hour=k;this.minute=g;this.second=l;this.millisecond=m;this.isLeapSecond=e}});F("Core/isLeapYear",["./DeveloperError"],function(b){return function(a){if(null===a||isNaN(a))throw new b("year is required and must be a number.");return 0===a%4&&0!==a%100||0===a%400}});F("Core/LeapSecond",[],function(){return function(b,a){this.julianDate=b;this.offset=a}});F("Core/TimeConstants",["./freezeObject"],function(b){return b({SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,MINUTES_PER_HOUR:60,HOURS_PER_DAY:24,SECONDS_PER_HOUR:3600,MINUTES_PER_DAY:1440,SECONDS_PER_DAY:86400,DAYS_PER_JULIAN_CENTURY:36525,PICOSECOND:1E-9,MODIFIED_JULIAN_DATE_DIFFERENCE:2400000.5})});F("Core/TimeStandard",["./freezeObject"],function(b){return b({UTC:0,TAI:1})});F("Core/JulianDate","../ThirdParty/sprintf ./binarySearch ./defaultValue ./defined ./DeveloperError ./GregorianDate ./isLeapYear ./LeapSecond ./TimeConstants ./TimeStandard".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(c,a){return u.compare(c.julianDate,a.julianDate)}function q(c){z.julianDate=c;var b=u.leapSeconds,e=a(b,z,d);0>e&&(e=~e);e>=b.length&&(e=b.length-1);var f=b[e].offset;0<e&&u.secondsDifference(b[e].julianDate,c)>f&&(e--,f=b[e].offset);u.addSeconds(c,f,c)}function t(c,b){z.julianDate=c;var e=u.leapSeconds,f=a(e,z,d);0>f&&(f=~f);if(0===f)return u.addSeconds(c,-e[0].offset,b);if(f>=e.length)return u.addSeconds(c,-e[f-1].offset,b);var h=u.secondsDifference(e[f].julianDate,c);if(0===h)return u.addSeconds(c,-e[f].offset,b);if(!(1>=h))return u.addSeconds(c,-e[--f].offset,b)}function r(c,a,b){var d=a/h.SECONDS_PER_DAY|0;c+=d;a-=h.SECONDS_PER_DAY*d;0>a&&(c--,a+=h.SECONDS_PER_DAY);b.dayNumber=c;b.secondsOfDay=a;return b}function c(c,a,b,d,e,f,g){var k=(a-14)/12|0;c=c+4800+k;a=(1461*c/4|0)+(367*(a-2-12*k)/12|0)-(3*((c+100)/100|0)/4|0)+b-32075;d-=12;0>d&&(d+=24);d=f+(d*h.SECONDS_PER_HOUR+e*h.SECONDS_PER_MINUTE+g*h.SECONDS_PER_MILLISECOND);43200<=d&&--a;return[a,d]}function u(c,a,b){this.secondsOfDay=this.dayNumber=void 0;c=f(c,0);a=f(a,0);b=f(b,p.UTC);var d=c|0;a+=(c-d)*h.SECONDS_PER_DAY;r(d,a,this);b===p.UTC&&q(this)}var y=new l,A=[31,28,31,30,31,30,31,31,30,31,30,31],z=new e,x=/^(\d{4})$/,D=/^(\d{4})-(\d{2})$/,v=/^(\d{4})-?(\d{3})$/,B=/^(\d{4})-?W(\d{2})-?(\d{1})?$/,C=/^(\d{4})-?(\d{2})-?(\d{2})$/,I=/([Z+\-])?(\d{2})?:?(\d{2})?$/,H=/^(\d{2})(\.\d+)?/.source+I.source,J=/^(\d{2}):?(\d{2})(\.\d+)?/.source+I.source,w=/^(\d{2}):?(\d{2}):?(\d{2})(\.\d+)?/.source+I.source;u.fromGregorianDate=function(a,b){if(!(a instanceof l))throw new g("date must be a valid GregorianDate.");var d=c(a.year,a.month,a.day,a.hour,a.minute,a.second,a.millisecond);if(!k(b))return new u(d[0],d[1],p.UTC);r(d[0],d[1],b);q(b);return b};u.fromDate=function(a,b){if(!(a instanceof Date)||isNaN(a.getTime()))throw new g("date must be a valid JavaScript Date.");var d=c(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds());if(!k(b))return new u(d[0],d[1],p.UTC);r(d[0],d[1],b);q(b);return b};u.fromIso8601=function(a,b){if("string"!==typeof a)throw new g("Invalid ISO 8601 date.");a=a.replace(",",".");var d=a.split("T"),e,f=1,h=1,l=0,z=0,E=0,y=0,t=d[0],I=d[1];if(!k(t))throw new g("Invalid ISO 8601 date.");var G,d=t.match(C);if(null!==d){G=t.split("-").length-1;if(0<G&&2!==G)throw new g("Invalid ISO 8601 date.");e=+d[1];f=+d[2];h=+d[3]}else if(d=t.match(D),null!==d)e=+d[1],f=+d[2];else if(d=t.match(x),null!==d)e=+d[1];else{d=t.match(v);if(null!==d){if(e=+d[1],f=+d[2],t=m(e),1>f||t&&366<f||!t&&365<f)throw new g("Invalid ISO 8601 date.");}else if(d=t.match(B),null!==d){e=+d[1];f=+d[2];h=+d[3]||0;G=t.split("-").length-1;if(0<G&&(!k(d[3])&&1!==G||k(d[3])&&2!==G))throw new g("Invalid ISO 8601 date.");d=new Date(Date.UTC(e,0,4));f=7*f+h-d.getUTCDay()-3}else throw new g("Invalid ISO 8601 date.");d=new Date(Date.UTC(e,0,1));d.setUTCDate(f);f=d.getUTCMonth()+1;h=d.getUTCDate()}t=m(e);if(1>f||12<f||1>h||(2!==f||!t)&&h>A[f-1]||t&&2===f&&29<h)throw new g("Invalid ISO 8601 date.");if(k(I)){d=I.match(w);if(null!==d){G=I.split(":").length-1;if(0<G&&2!==G&&3!==G)throw new g("Invalid ISO 8601 date.");l=+d[1];z=+d[2];E=+d[3];y=1E3*+(d[4]||0);I=5}else if(d=I.match(J),null!==d){G=I.split(":").length-1;if(2<G)throw new g("Invalid ISO 8601 date.");l=+d[1];z=+d[2];E=60*+(d[3]||0);I=4}else if(d=I.match(H),null!==d)l=+d[1],z=60*+(d[2]||0),I=3;else throw new g("Invalid ISO 8601 date.");if(60<=z||61<=E||24<l||24===l&&(0<z||0<E||0<y))throw new g("Invalid ISO 8601 date.");G=+d[I+1];var L=+(d[I+2]||0);switch(d[I]){case "+":l-=G;z-=L;break;case "-":l+=G;z+=L;break;case "Z":break;default:z+=(new Date(Date.UTC(e,f-1,h,l,z))).getTimezoneOffset()}}for((I=60===E)&&E--;60<=z;)z-=60,l++;for(;24<=l;)l-=24,h++;for(d=t&&2===f?29:A[f-1];h>d;)h-=d,f++,12<f&&(f-=12,e++),d=t&&2===f?29:A[f-1];for(;0>z;)z+=60,l--;for(;0>l;)l+=24,h--;for(;1>h;)f--,1>f&&(f+=12,e--),d=t&&2===f?29:A[f-1],h+=d;e=c(e,f,h,l,z,E,y);k(b)?(r(e[0],e[1],b),q(b)):b=new u(e[0],e[1],p.UTC);I&&u.addSeconds(b,1,b);return b};u.now=function(c){return u.fromDate(new Date,c)};var G=new u(0,0,p.TAI);u.toGregorianDate=function(c,a){if(!k(c))throw new g("julianDate is required.");var b=!1,d=t(c,G);k(d)||(u.addSeconds(c,-1,G),d=t(G,G),b=!0);var e=d.dayNumber,f=d.secondsOfDay;43200<=f&&(e+=1);var p=e+68569|0,m=4*p/146097|0,p=p-((146097*m+3)/4|0)|0,q=4E3*(p+1)/1461001|0,p=p-(1461*q/4|0)+31|0,d=80*p/2447|0,e=p-(2447*d/80|0)|0,p=d/11|0,d=d+2-12*p|0,p=100*(m-49)+q+p|0,m=f/h.SECONDS_PER_HOUR|0,v=f-m*h.SECONDS_PER_HOUR,f=v/h.SECONDS_PER_MINUTE|0,v=v-f*h.SECONDS_PER_MINUTE,q=v|0,v=(v-q)/h.SECONDS_PER_MILLISECOND,m=m+12;23<m&&(m-=24);b&&(q+=1);if(!k(a))return new l(p,d,e,m,f,q,v,b);a.year=p;a.month=d;a.day=e;a.hour=m;a.minute=f;a.second=q;a.millisecond=v;a.isLeapSecond=b;return a};u.toDate=function(c){if(!k(c))throw new g("julianDate is required.");c=u.toGregorianDate(c,y);var a=c.second;c.isLeapSecond&&--a;return new Date(Date.UTC(c.year,c.month-1,c.day,c.hour,c.minute,a,c.millisecond))};u.toIso8601=function(c,a){if(!k(c))throw new g("julianDate is required.");var d=u.toGregorianDate(c,y),e=d.year,f=d.month,h=d.day,l=d.hour,p=d.minute,m=d.second,d=d.millisecond;1E4===e&&1===f&&1===h&&0===l&&0===p&&0===m&&0===d&&(e=9999,f=12,h=31,l=24);if(!k(a)&&0!==d)return d=(.01*d).toString().replace(".",""),b("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",e,f,h,l,p,m,d);if(!k(a)||0===a)return b("%04d-%02d-%02dT%02d:%02d:%02dZ",e,f,h,l,p,m);d=(.01*d).toFixed(a).replace(".","").slice(0,a);return b("%04d-%02d-%02dT%02d:%02d:%02d.%sZ",e,f,h,l,p,m,d)};u.clone=function(c,a){if(k(c)){if(!k(a))return new u(c.dayNumber,c.secondsOfDay,p.TAI);a.dayNumber=c.dayNumber;a.secondsOfDay=c.secondsOfDay;return a}};u.compare=function(c,a){if(!k(c))throw new g("left is required.");if(!k(a))throw new g("right is required.");var b=c.dayNumber-a.dayNumber;return 0!==b?b:c.secondsOfDay-a.secondsOfDay};u.equals=function(c,a){return c===a||k(c)&&k(a)&&c.dayNumber===a.dayNumber&&c.secondsOfDay===a.secondsOfDay};u.equalsEpsilon=function(c,a,b){if(!k(b))throw new g("epsilon is required.");return c===a||k(c)&&k(a)&&Math.abs(u.secondsDifference(c,a))<=b};u.totalDays=function(c){if(!k(c))throw new g("julianDate is required.");return c.dayNumber+c.secondsOfDay/h.SECONDS_PER_DAY};u.secondsDifference=function(c,a){if(!k(c))throw new g("left is required.");if(!k(a))throw new g("right is required.");return(c.dayNumber-a.dayNumber)*h.SECONDS_PER_DAY+(c.secondsOfDay-a.secondsOfDay)};u.daysDifference=function(c,a){if(!k(c))throw new g("left is required.");if(!k(a))throw new g("right is required.");return c.dayNumber-a.dayNumber+(c.secondsOfDay-a.secondsOfDay)/h.SECONDS_PER_DAY};u.computeTaiMinusUtc=function(c){z.julianDate=c;c=u.leapSeconds;var b=a(c,z,d);0>b&&(b=~b,--b,0>b&&(b=0));return c[b].offset};u.addSeconds=function(c,a,b){if(!k(c))throw new g("julianDate is required.");if(!k(a))throw new g("seconds is required.");if(!k(b))throw new g("result is required.");return r(c.dayNumber,c.secondsOfDay+a,b)};u.addMinutes=function(c,a,b){if(!k(c))throw new g("julianDate is required.");if(!k(a))throw new g("minutes is required.");if(!k(b))throw new g("result is required.");return r(c.dayNumber,c.secondsOfDay+a*h.SECONDS_PER_MINUTE,b)};u.addHours=function(c,a,b){if(!k(c))throw new g("julianDate is required.");if(!k(a))throw new g("hours is required.");if(!k(b))throw new g("result is required.");return r(c.dayNumber,c.secondsOfDay+a*h.SECONDS_PER_HOUR,b)};u.addDays=function(c,a,b){if(!k(c))throw new g("julianDate is required.");if(!k(a))throw new g("days is required.");if(!k(b))throw new g("result is required.");return r(c.dayNumber+a,c.secondsOfDay,b)};u.lessThan=function(c,a){return 0>u.compare(c,a)};u.lessThanOrEquals=function(c,a){return 0>=u.compare(c,a)};u.greaterThan=function(c,a){return 0<u.compare(c,a)};u.greaterThanOrEquals=function(c,a){return 0<=u.compare(c,a)};u.prototype.clone=function(c){return u.clone(this,c)};u.prototype.equals=function(c){return u.equals(this,c)};u.prototype.equalsEpsilon=function(c,a){return u.equalsEpsilon(this,c,a)};u.prototype.toString=function(){return u.toIso8601(this)};u.leapSeconds=[new e(new u(2441317,43210,p.TAI),10),new e(new u(2441499,43211,p.TAI),11),new e(new u(2441683,43212,p.TAI),12),new e(new u(2442048,43213,p.TAI),13),new e(new u(2442413,43214,p.TAI),14),new e(new u(2442778,43215,p.TAI),15),new e(new u(2443144,43216,p.TAI),16),new e(new u(2443509,43217,p.TAI),17),new e(new u(2443874,43218,p.TAI),18),new e(new u(2444239,43219,p.TAI),19),new e(new u(2444786,43220,p.TAI),20),new e(new u(2445151,43221,p.TAI),21),new e(new u(2445516,43222,p.TAI),22),new e(new u(2446247,43223,p.TAI),23),new e(new u(2447161,43224,p.TAI),24),new e(new u(2447892,43225,p.TAI),25),new e(new u(2448257,43226,p.TAI),26),new e(new u(2448804,43227,p.TAI),27),new e(new u(2449169,43228,p.TAI),28),new e(new u(2449534,43229,p.TAI),29),new e(new u(2450083,43230,p.TAI),30),new e(new u(2450630,43231,p.TAI),31),new e(new u(2451179,43232,p.TAI),32),new e(new u(2453736,43233,p.TAI),33),new e(new u(2454832,43234,p.TAI),34),new e(new u(2456109,43235,p.TAI),35),new e(new u(2457204,43236,p.TAI),36),new e(new u(2457754,43237,p.TAI),37)];return u});F("Core/EarthOrientationParameters","../ThirdParty/when ./binarySearch ./defaultValue ./defined ./EarthOrientationParametersSample ./freezeObject ./JulianDate ./LeapSecond ./Resource ./RuntimeError ./TimeConstants ./TimeStandard".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(a){a=f(a,f.EMPTY_OBJECT);this._samples=this._dates=void 0;this._taiMinusUtcSecondsColumn=this._yCelestialPoleOffsetRadiansColumn=this._xCelestialPoleOffsetRadiansColumn=this._ut1MinusUtcSecondsColumn=this._yPoleWanderRadiansColumn=this._xPoleWanderRadiansColumn=this._dateColumn=-1;this._columnCount=0;this._lastIndex=-1;this._dataError=this._downloadPromise=void 0;this._addNewLeapSeconds=f(a.addNewLeapSeconds,!0);if(k(a.data))c(this,a.data);else if(k(a.url)){var d=h.createIfNeeded(a.url),e=this;this._downloadPromise=b(d.fetchJson(),function(a){c(e,a)},function(){e._dataError="An error occurred while retrieving the EOP data from the URL "+d.url+"."})}else c(this,{columnNames:"dateIso8601 modifiedJulianDateUtc xPoleWanderRadians yPoleWanderRadians ut1MinusUtcSeconds lengthOfDayCorrectionSeconds xCelestialPoleOffsetRadians yCelestialPoleOffsetRadians taiMinusUtcSeconds".split(" "),samples:[]})}function r(c,a){return m.compare(c.julianDate,a)}function c(c,b){if(k(b.columnNames))if(k(b.samples)){var f=b.columnNames.indexOf("modifiedJulianDateUtc"),h=b.columnNames.indexOf("xPoleWanderRadians"),g=b.columnNames.indexOf("yPoleWanderRadians"),l=b.columnNames.indexOf("ut1MinusUtcSeconds"),p=b.columnNames.indexOf("xCelestialPoleOffsetRadians"),u=b.columnNames.indexOf("yCelestialPoleOffsetRadians"),z=b.columnNames.indexOf("taiMinusUtcSeconds");if(0>f||0>h||0>g||0>l||0>p||0>u||0>z)c._dataError="Error in loaded EOP data: The columnNames property must include modifiedJulianDateUtc, xPoleWanderRadians, yPoleWanderRadians, ut1MinusUtcSeconds, xCelestialPoleOffsetRadians, yCelestialPoleOffsetRadians, and taiMinusUtcSeconds columns";else{var w=c._samples=b.samples,y=c._dates=[];c._dateColumn=f;c._xPoleWanderRadiansColumn=h;c._yPoleWanderRadiansColumn=g;c._ut1MinusUtcSecondsColumn=l;c._xCelestialPoleOffsetRadiansColumn=p;c._yCelestialPoleOffsetRadiansColumn=u;c._taiMinusUtcSecondsColumn=z;c._columnCount=b.columnNames.length;c._lastIndex=void 0;for(var t,h=c._addNewLeapSeconds,g=0,l=w.length;g<l;g+=c._columnCount)if(p=w[g+z],u=new m(w[g+f]+d.MODIFIED_JULIAN_DATE_DIFFERENCE,p,q.TAI),y.push(u),h){if(p!==t&&k(t)){t=m.leapSeconds;var x=a(t,u,r);0>x&&(u=new e(u,p),t.splice(~x,0,u))}t=p}}}else c._dataError="Error in loaded EOP data: The samples property is required.";else c._dataError="Error in loaded EOP data: The columnNames property is required."}function u(c,a,b,d,e){b*=d;e.xPoleWander=a[b+c._xPoleWanderRadiansColumn];e.yPoleWander=a[b+c._yPoleWanderRadiansColumn];e.xPoleOffset=a[b+c._xCelestialPoleOffsetRadiansColumn];e.yPoleOffset=a[b+c._yCelestialPoleOffsetRadiansColumn];e.ut1MinusUtc=a[b+c._ut1MinusUtcSecondsColumn]}function y(c,a,b){return a+c*(b-a)}function A(c,a,b,d,e,f,h){var g=c._columnCount;if(f>a.length-1)return h.xPoleWander=0,h.yPoleWander=0,h.xPoleOffset=0,h.yPoleOffset=0,h.ut1MinusUtc=0,h;var k=a[e];a=a[f];if(k.equals(a)||d.equals(k))return u(c,b,e,g,h),h;if(d.equals(a))return u(c,b,f,g,h),h;k=m.secondsDifference(d,k)/m.secondsDifference(a,k);e*=g;f*=g;var g=b[e+c._ut1MinusUtcSecondsColumn],l=b[f+c._ut1MinusUtcSecondsColumn],p=l-g;if(.5<p||-.5>p){var p=b[e+c._taiMinusUtcSecondsColumn],q=b[f+c._taiMinusUtcSecondsColumn];p!==q&&(a.equals(d)?g=l:l-=q-p)}h.xPoleWander=y(k,b[e+c._xPoleWanderRadiansColumn],b[f+c._xPoleWanderRadiansColumn]);h.yPoleWander=y(k,b[e+c._yPoleWanderRadiansColumn],b[f+c._yPoleWanderRadiansColumn]);h.xPoleOffset=y(k,b[e+c._xCelestialPoleOffsetRadiansColumn],b[f+c._xCelestialPoleOffsetRadiansColumn]);h.yPoleOffset=y(k,b[e+c._yCelestialPoleOffsetRadiansColumn],b[f+c._yCelestialPoleOffsetRadiansColumn]);h.ut1MinusUtc=y(k,g,l);return h}t.NONE=l({getPromiseToLoad:function(){return b()},compute:function(c,a){k(a)?(a.xPoleWander=0,a.yPoleWander=0,a.xPoleOffset=0,a.yPoleOffset=0,a.ut1MinusUtc=0):a=new g(0,0,0,0,0);return a}});t.prototype.getPromiseToLoad=function(){return b(this._downloadPromise)};t.prototype.compute=function(c,b){if(k(this._samples)){k(b)||(b=new g(0,0,0,0,0));if(0===this._samples.length)return b.xPoleWander=0,b.yPoleWander=0,b.xPoleOffset=0,b.yPoleOffset=0,b.ut1MinusUtc=0,b;var d=this._dates,e=this._lastIndex,f;if(k(e)){f=d[e+1];var h=m.lessThanOrEquals(d[e],c),l=!k(f),q=l||m.greaterThanOrEquals(f,c);if(h&&q)return!l&&f.equals(c)&&++e,A(this,d,this._samples,c,e,e+1,b),b}f=a(d,c,m.compare,this._dateColumn);0<=f?(f<d.length-1&&d[f+1].equals(c)&&++f,e=f):(f=~f,e=f-1,0>e&&(e=0));this._lastIndex=e;A(this,d,this._samples,c,e,f,b);return b}if(k(this._dataError))throw new p(this._dataError);};return t});F("Core/HeadingPitchRoll",["./defaultValue","./defined","./DeveloperError","./Math"],function(b,a,f,k){function g(a,f,e){this.heading=b(a,0);this.pitch=b(f,0);this.roll=b(e,0)}g.fromQuaternion=function(b,m){if(!a(b))throw new f("quaternion is required");a(m)||(m=new g);var e=2*(b.w*b.y-b.z*b.x),h=1-2*(b.x*b.x+b.y*b.y),l=2*(b.w*b.x+b.y*b.z);m.heading=-Math.atan2(2*(b.w*b.z+b.x*b.y),1-2*(b.y*b.y+b.z*b.z));m.roll=Math.atan2(l,h);m.pitch=-k.asinClamped(e);return m};g.fromDegrees=function(b,m,e,h){if(!a(b))throw new f("heading is required");if(!a(m))throw new f("pitch is required");if(!a(e))throw new f("roll is required");a(h)||(h=new g);h.heading=b*k.RADIANS_PER_DEGREE;h.pitch=m*k.RADIANS_PER_DEGREE;h.roll=e*k.RADIANS_PER_DEGREE;return h};g.clone=function(b,f){if(a(b)){if(!a(f))return new g(b.heading,b.pitch,b.roll);f.heading=b.heading;f.pitch=b.pitch;f.roll=b.roll;return f}};g.equals=function(b,f){return b===f||a(b)&&a(f)&&b.heading===f.heading&&b.pitch===f.pitch&&b.roll===f.roll};g.equalsEpsilon=function(b,f,e,h){return b===f||a(b)&&a(f)&&k.equalsEpsilon(b.heading,f.heading,e,h)&&k.equalsEpsilon(b.pitch,f.pitch,e,h)&&k.equalsEpsilon(b.roll,f.roll,e,h)};g.prototype.clone=function(a){return g.clone(this,a)};g.prototype.equals=function(a){return g.equals(this,a)};g.prototype.equalsEpsilon=function(a,b,e){return g.equalsEpsilon(this,a,b,e)};g.prototype.toString=function(){return"("+this.heading+", "+this.pitch+", "+this.roll+")"};return g});F("Core/Iau2006XysSample",[],function(){return function(b,a,f){this.x=b;this.y=a;this.s=f}});F("Core/Iau2006XysData","../ThirdParty/when ./buildModuleUrl ./defaultValue ./defined ./Iau2006XysSample ./JulianDate ./Resource ./TimeStandard".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=f(a,f.EMPTY_OBJECT);this._xysFileUrlTemplate=m.createIfNeeded(a.xysFileUrlTemplate);this._interpolationOrder=f(a.interpolationOrder,9);this._sampleZeroJulianEphemerisDate=f(a.sampleZeroJulianEphemerisDate,2442396.5);this._sampleZeroDateTT=new l(this._sampleZeroJulianEphemerisDate,0,e.TAI);this._stepSizeDays=f(a.stepSizeDays,1);this._samplesPerXysFile=f(a.samplesPerXysFile,1E3);this._totalSamples=f(a.totalSamples,27426);this._samples=Array(3*this._totalSamples);this._chunkDownloadsInProgress=[];a=this._interpolationOrder;for(var b=this._denominators=Array(a+1),c=this._xTable=Array(a+1),d=Math.pow(this._stepSizeDays,a),h=0;h<=a;++h){b[h]=d;c[h]=h*this._stepSizeDays;for(var g=0;g<=a;++g)g!==h&&(b[h]*=h-g);b[h]=1/b[h]}this._work=Array(a+1);this._coef=Array(a+1)}function p(a,b,c){var d=q;d.dayNumber=b;d.secondsOfDay=c;return l.daysDifference(d,a._sampleZeroDateTT)}function d(d,e){if(d._chunkDownloadsInProgress[e])return d._chunkDownloadsInProgress[e];var c=b.defer();d._chunkDownloadsInProgress[e]=c;var f;f=d._xysFileUrlTemplate;f=k(f)?f.getDerivedResource({templateValues:{0:e}}):new m({url:a("Assets/IAU2006_XYS/IAU2006_XYS_"+e+".json")});b(f.fetchJson(),function(a){d._chunkDownloadsInProgress[e]=!1;var b=d._samples;a=a.samples;for(var f=e*d._samplesPerXysFile*3,h=0,g=a.length;h<g;++h)b[f+h]=a[h];c.resolve()});return c.promise}var q=new l(0,0,e.TAI);h.prototype.preload=function(a,e,c,f){a=p(this,a,e);f=p(this,c,f);c=a/this._stepSizeDays-this._interpolationOrder/2|0;0>c&&(c=0);f=f/this._stepSizeDays-this._interpolationOrder/2|0+this._interpolationOrder;f>=this._totalSamples&&(f=this._totalSamples-1);f=f/this._samplesPerXysFile|0;a=[];for(c=c/this._samplesPerXysFile|0;c<=f;++c)a.push(d(this,c));return b.all(a)};h.prototype.computeXysRadians=function(a,b,c){var e=p(this,a,b);if(!(0>e||(b=e/this._stepSizeDays|0,b>=this._totalSamples))){a=this._interpolationOrder;b-=a/2|0;0>b&&(b=0);var f=b+a;f>=this._totalSamples&&(f=this._totalSamples-1,b=f-a,0>b&&(b=0));var h=!1,l=this._samples;k(l[3*b])||(d(this,b/this._samplesPerXysFile|0),h=!0);k(l[3*f])||(d(this,f/this._samplesPerXysFile|0),h=!0);if(!h){k(c)?(c.x=0,c.y=0,c.s=0):c=new g(0,0,0);var m=e-b*this._stepSizeDays,e=this._work,f=this._denominators,h=this._coef,q=this._xTable,v;for(v=0;v<=a;++v)e[v]=m-q[v];for(v=0;v<=a;++v){h[v]=1;for(m=0;m<=a;++m)m!==v&&(h[v]*=e[m]);h[v]*=f[v];m=3*(b+v);c.x+=h[v]*l[m++];c.y+=h[v]*l[m++];c.s+=h[v]*l[m]}return c}}};return h});F("Core/Fullscreen",["./defined","./defineProperties"],function(b,a){var f,k=void 0,g=void 0,l=void 0,m=void 0,e=void 0,h=void 0,p={};a(p,{element:{get:function(){if(p.supportsFullscreen())return document[m]}},changeEventName:{get:function(){if(p.supportsFullscreen())return e}},errorEventName:{get:function(){if(p.supportsFullscreen())return h}},enabled:{get:function(){if(p.supportsFullscreen())return document[l]}},fullscreen:{get:function(){if(p.supportsFullscreen())return null!==p.element}}});p.supportsFullscreen=function(){if(b(f))return f;f=!1;var a=document.body;if("function"===typeof a.requestFullscreen)return k="requestFullscreen",g="exitFullscreen",l="fullscreenEnabled",m="fullscreenElement",e="fullscreenchange",h="fullscreenerror",f=!0;for(var p=["webkit","moz","o","ms","khtml"],t,r=0,c=p.length;r<c;++r){var u=p[r];t=u+"RequestFullscreen";"function"===typeof a[t]?(k=t,f=!0):(t=u+"RequestFullScreen","function"===typeof a[t]&&(k=t,f=!0));t=u+"ExitFullscreen";"function"===typeof document[t]?g=t:(t=u+"CancelFullScreen","function"===typeof document[t]&&(g=t));t=u+"FullscreenEnabled";void 0!==document[t]?l=t:(t=u+"FullScreenEnabled",void 0!==document[t]&&(l=t));t=u+"FullscreenElement";void 0!==document[t]?m=t:(t=u+"FullScreenElement",void 0!==document[t]&&(m=t));t=u+"fullscreenchange";void 0!==document["on"+t]&&("ms"===u&&(t="MSFullscreenChange"),e=t);t=u+"fullscreenerror";void 0!==document["on"+t]&&("ms"===u&&(t="MSFullscreenError"),h=t)}return f};p.requestFullscreen=function(a,b){if(p.supportsFullscreen())a[k]({vrDisplay:b})};p.exitFullscreen=function(){if(p.supportsFullscreen())document[g]()};return p});F("Core/FeatureDetection","./defaultValue ./defined ./defineProperties ./DeveloperError ./Fullscreen ../ThirdParty/when".split(" "),function(b,a,f,k,g,l){function m(c){c=c.split(".");for(var a=0,b=c.length;a<b;++a)c[a]=parseInt(c[a],10);return c}function e(){if(!a(y)&&(y=!1,!q())){var c=/ Chrome\/([\.0-9]+)/.exec(u.userAgent);null!==c&&(y=!0,A=m(c[1]))}return y}function h(){if(!a(z)&&(z=!1,!e()&&!q()&&/ Safari\/[\.0-9]+/.test(u.userAgent))){var c=/ Version\/([\.0-9]+)/.exec(u.userAgent);null!==c&&(z=!0,x=m(c[1]))}return z}function p(){if(!a(D)){D=!1;var c=/ AppleWebKit\/([\.0-9]+)(\+?)/.exec(u.userAgent);null!==c&&(D=!0,v=m(c[1]),v.isNightly=!!c[2])}return D}function d(){if(!a(B)){B=!1;var c;"Microsoft Internet Explorer"===u.appName?(c=/MSIE ([0-9]{1,}[\.0-9]{0,})/.exec(u.userAgent),null!==c&&(B=!0,C=m(c[1]))):"Netscape"===u.appName&&(c=/Trident\/.*rv:([0-9]{1,}[\.0-9]{0,})/.exec(u.userAgent),null!==c&&(B=!0,C=m(c[1])))}return B}function q(){if(!a(I)){I=!1;var c=/ Edge\/([\.0-9]+)/.exec(u.userAgent);null!==c&&(I=!0,H=m(c[1]))}return I}function t(){if(!a(J)){J=!1;var c=/Firefox\/([\.0-9]+)/.exec(u.userAgent);null!==c&&(J=!0,w=m(c[1]))}return J}function r(){if(!a(P)){var c=document.createElement("canvas");c.setAttribute("style","image-rendering: -moz-crisp-edges;image-rendering: pixelated;");c=c.style.imageRendering;(P=a(c)&&""!==c)&&(K=c)}return P}function c(){if(!c.initialized)throw new k("You must call FeatureDetection.supportsWebP.initialize and wait for the promise to resolve before calling FeatureDetection.supportsWebP");return c._result}var u;u="undefined"!==typeof navigator?navigator:{};var y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P;c._promise=void 0;c._result=void 0;c.initialize=function(){if(a(c._promise))return c._promise;var b=l.defer();c._promise=b.promise;if(q())return c._result=!1,b.resolve(c._result),b.promise;var d=new Image;d.onload=function(){c._result=0<d.width&&0<d.height;b.resolve(c._result)};d.onerror=function(){c._result=!1;b.resolve(c._result)};d.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA";return b.promise};f(c,{initialized:{get:function(){return a(c._result)}}});f=[];"undefined"!==typeof ArrayBuffer&&(f.push(Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array),"undefined"!==typeof Uint8ClampedArray&&f.push(Uint8ClampedArray),"undefined"!==typeof CanvasPixelArray&&f.push(CanvasPixelArray));var N={isChrome:e,chromeVersion:function(){return e()&&A},isSafari:h,safariVersion:function(){return h()&&x},isWebkit:p,webkitVersion:function(){return p()&&v},isInternetExplorer:d,internetExplorerVersion:function(){return d()&&C},isEdge:q,edgeVersion:function(){return q()&&H},isFirefox:t,firefoxVersion:function(){return t()&&w},isWindows:function(){a(G)||(G=/Windows/i.test(u.appVersion));return G},isLinux:function(){if(!a(E)){var c=u.userAgent.toLowerCase(),b="android"==c.match(/android/i),c="linux"==c.match(/linux/i);E=!b&&c}return E},hardwareConcurrency:b(u.hardwareConcurrency,3),supportsPointerEvents:function(){a(L)||(L=!t()&&"undefined"!==typeof PointerEvent&&(!a(u.pointerEnabled)||u.pointerEnabled));return L},supportsImageRenderingPixelated:r,supportsWebP:c,imageRenderingValue:function(){return r()?K:void 0},typedArrayTypes:f,supportsFullscreen:function(){return g.supportsFullscreen()},supportsTypedArrays:function(){return"undefined"!==typeof ArrayBuffer},supportsWebWorkers:function(){return"undefined"!==typeof Worker},supportsWebAssembly:function(){return"undefined"!==typeof WebAssembly&&!N.isEdge()}};return N});F("Core/Quaternion","./Cartesian3 ./Check ./defaultValue ./defined ./FeatureDetection ./freezeObject ./Math ./Matrix3".split(" "),function(b,a,f,k,g,l,m,e){function h(c,a,b,d){this.x=f(c,0);this.y=f(a,0);this.z=f(b,0);this.w=f(d,0)}var p=new b;h.fromAxisAngle=function(c,d,e){a.typeOf.object("axis",c);a.typeOf.number("angle",d);d/=2;var f=Math.sin(d);p=b.normalize(c,p);c=p.x*f;var g=p.y*f,f=p.z*f;d=Math.cos(d);if(!k(e))return new h(c,g,f,d);e.x=c;e.y=g;e.z=f;e.w=d;return e};var d=[1,2,0],q=Array(3);h.fromRotationMatrix=function(c,b){a.typeOf.object("matrix",c);var f,g,l,p;p=c[e.COLUMN0ROW0];f=c[e.COLUMN1ROW1];l=c[e.COLUMN2ROW2];g=p+f+l;if(0<g)f=Math.sqrt(g+1),p=.5*f,f=.5/f,g=(c[e.COLUMN1ROW2]-c[e.COLUMN2ROW1])*f,l=(c[e.COLUMN2ROW0]-c[e.COLUMN0ROW2])*f,f*=c[e.COLUMN0ROW1]-c[e.COLUMN1ROW0];else{g=0;f>p&&(g=1);l>p&&l>f&&(g=2);l=d[g];var m=d[l];f=Math.sqrt(c[e.getElementIndex(g,g)]-c[e.getElementIndex(l,l)]-c[e.getElementIndex(m,m)]+1);q[g]=.5*f;f=.5/f;p=(c[e.getElementIndex(m,l)]-c[e.getElementIndex(l,m)])*f;q[l]=(c[e.getElementIndex(l,g)]+c[e.getElementIndex(g,l)])*f;q[m]=(c[e.getElementIndex(m,g)]+c[e.getElementIndex(g,m)])*f;g=-q[0];l=-q[1];f=-q[2]}if(!k(b))return new h(g,l,f,p);b.x=g;b.y=l;b.z=f;b.w=p;return b};var t=new h,r=new h,c=new h,u=new h;h.fromHeadingPitchRoll=function(d,e){a.typeOf.object("headingPitchRoll",d);u=h.fromAxisAngle(b.UNIT_X,d.roll,t);c=h.fromAxisAngle(b.UNIT_Y,-d.pitch,e);e=h.multiply(c,u,c);r=h.fromAxisAngle(b.UNIT_Z,-d.heading,t);return h.multiply(r,e,e)};var y=new b,A=new b,z=new h,x=new h,D=new h;h.packedLength=4;h.pack=function(c,b,d){a.typeOf.object("value",c);a.defined("array",b);d=f(d,0);b[d++]=c.x;b[d++]=c.y;b[d++]=c.z;b[d]=c.w;return b};h.unpack=function(c,b,d){a.defined("array",c);b=f(b,0);k(d)||(d=new h);d.x=c[b];d.y=c[b+1];d.z=c[b+2];d.w=c[b+3];return d};h.packedInterpolationLength=3;h.convertPackedArrayForInterpolation=function(c,a,b,d){h.unpack(c,4*b,D);h.conjugate(D,D);var e=0;for(b=b-a+1;e<b;e++){var f=3*e;h.unpack(c,4*(a+e),z);h.multiply(z,D,z);0>z.w&&h.negate(z,z);h.computeAxis(z,y);var g=h.computeAngle(z);d[f]=y.x*g;d[f+1]=y.y*g;d[f+2]=y.z*g}};h.unpackInterpolationResult=function(c,a,d,e,f){k(f)||(f=new h);b.fromArray(c,0,A);c=b.magnitude(A);h.unpack(a,4*e,x);0===c?h.clone(h.IDENTITY,z):h.fromAxisAngle(A,c,z);return h.multiply(z,x,f)};h.clone=function(c,a){if(k(c)){if(!k(a))return new h(c.x,c.y,c.z,c.w);a.x=c.x;a.y=c.y;a.z=c.z;a.w=c.w;return a}};h.conjugate=function(c,b){a.typeOf.object("quaternion",c);a.typeOf.object("result",b);b.x=-c.x;b.y=-c.y;b.z=-c.z;b.w=c.w;return b};h.magnitudeSquared=function(c){a.typeOf.object("quaternion",c);return c.x*c.x+c.y*c.y+c.z*c.z+c.w*c.w};h.magnitude=function(c){return Math.sqrt(h.magnitudeSquared(c))};h.normalize=function(c,b){a.typeOf.object("result",b);var d=1/h.magnitude(c),e=c.y*d,f=c.z*d,g=c.w*d;b.x=c.x*d;b.y=e;b.z=f;b.w=g;return b};h.inverse=function(c,b){a.typeOf.object("result",b);var d=h.magnitudeSquared(c);b=h.conjugate(c,b);return h.multiplyByScalar(b,1/d,b)};h.add=function(c,b,d){a.typeOf.object("left",c);a.typeOf.object("right",b);a.typeOf.object("result",d);d.x=c.x+b.x;d.y=c.y+b.y;d.z=c.z+b.z;d.w=c.w+b.w;return d};h.subtract=function(c,b,d){a.typeOf.object("left",c);a.typeOf.object("right",b);a.typeOf.object("result",d);d.x=c.x-b.x;d.y=c.y-b.y;d.z=c.z-b.z;d.w=c.w-b.w;return d};h.negate=function(c,b){a.typeOf.object("quaternion",c);a.typeOf.object("result",b);b.x=-c.x;b.y=-c.y;b.z=-c.z;b.w=-c.w;return b};h.dot=function(c,b){a.typeOf.object("left",c);a.typeOf.object("right",b);return c.x*b.x+c.y*b.y+c.z*b.z+c.w*b.w};h.multiply=function(c,b,d){a.typeOf.object("left",c);a.typeOf.object("right",b);a.typeOf.object("result",d);var e=c.x,f=c.y,h=c.z;c=c.w;var g=b.x,k=b.y,l=b.z;b=b.w;d.x=c*g+e*b+f*l-h*k;d.y=c*k-e*l+f*b+h*g;d.z=c*l+e*k-f*g+h*b;d.w=c*b-e*g-f*k-h*l;return d};h.multiplyByScalar=function(c,b,d){a.typeOf.object("quaternion",c);a.typeOf.number("scalar",b);a.typeOf.object("result",d);d.x=c.x*b;d.y=c.y*b;d.z=c.z*b;d.w=c.w*b;return d};h.divideByScalar=function(c,b,d){a.typeOf.object("quaternion",c);a.typeOf.number("scalar",b);a.typeOf.object("result",d);d.x=c.x/b;d.y=c.y/b;d.z=c.z/b;d.w=c.w/b;return d};h.computeAxis=function(c,b){a.typeOf.object("quaternion",c);a.typeOf.object("result",b);var d=c.w;if(Math.abs(d-1)<m.EPSILON6)return b.x=b.y=b.z=0,b;d=1/Math.sqrt(1-d*d);b.x=c.x*d;b.y=c.y*d;b.z=c.z*d;return b};h.computeAngle=function(c){a.typeOf.object("quaternion",c);return Math.abs(c.w-1)<m.EPSILON6?0:2*Math.acos(c.w)};var v=new h;h.lerp=function(c,b,d,e){a.typeOf.object("start",c);a.typeOf.object("end",b);a.typeOf.number("t",d);a.typeOf.object("result",e);v=h.multiplyByScalar(b,d,v);e=h.multiplyByScalar(c,1-d,e);return h.add(v,e,e)};var B=new h,C=new h,I=new h;h.slerp=function(c,b,d,e){a.typeOf.object("start",c);a.typeOf.object("end",b);a.typeOf.number("t",d);a.typeOf.object("result",e);var f=h.dot(c,b),g=b;0>f&&(f=-f,g=B=h.negate(b,B));if(1-f<m.EPSILON6)return h.lerp(c,g,d,e);b=Math.acos(f);C=h.multiplyByScalar(c,Math.sin((1-d)*b),C);I=h.multiplyByScalar(g,Math.sin(d*b),I);e=h.add(C,I,e);return h.multiplyByScalar(e,1/Math.sin(b),e)};h.log=function(c,d){a.typeOf.object("quaternion",c);a.typeOf.object("result",d);var e=m.acosClamped(c.w),f=0;0!==e&&(f=e/Math.sin(e));return b.multiplyByScalar(c,f,d)};h.exp=function(c,d){a.typeOf.object("cartesian",c);a.typeOf.object("result",d);var e=b.magnitude(c),f=0;0!==e&&(f=Math.sin(e)/e);d.x=c.x*f;d.y=c.y*f;d.z=c.z*f;d.w=Math.cos(e);return d};var H=new b,J=new b,w=new h,G=new h;h.computeInnerQuadrangle=function(c,d,e,f){a.typeOf.object("q0",c);a.typeOf.object("q1",d);a.typeOf.object("q2",e);a.typeOf.object("result",f);var g=h.conjugate(d,w);h.multiply(g,e,G);e=h.log(G,H);h.multiply(g,c,G);c=h.log(G,J);b.add(e,c,e);b.multiplyByScalar(e,.25,e);b.negate(e,e);h.exp(e,w);return h.multiply(d,w,f)};h.squad=function(c,b,d,e,f,g){a.typeOf.object("q0",c);a.typeOf.object("q1",b);a.typeOf.object("s0",d);a.typeOf.object("s1",e);a.typeOf.number("t",f);a.typeOf.object("result",g);c=h.slerp(c,b,f,w);d=h.slerp(d,e,f,G);return h.slerp(c,d,2*f*(1-f),g)};var E=new h,L=g.supportsTypedArrays()?new Float32Array(8):[],K=g.supportsTypedArrays()?new Float32Array(8):[],P=g.supportsTypedArrays()?new Float32Array(8):[],N=g.supportsTypedArrays()?new Float32Array(8):[];for(g=0;7>g;++g){var O=g+1,Z=2*O+1;L[g]=1/(O*Z);K[g]=O/Z}L[7]=.013978731275862502;K[7]=.8946388016552002;h.fastSlerp=function(c,b,d,e){a.typeOf.object("start",c);a.typeOf.object("end",b);a.typeOf.number("t",d);a.typeOf.object("result",e);var f=h.dot(c,b),g;0<=f?g=1:(g=-1,f=-f);for(var k=f-1,f=1-d,l=d*d,p=f*f,m=7;0<=m;--m)P[m]=(L[m]*l-K[m])*k,N[m]=(L[m]*p-K[m])*k;d=g*d*(1+P[0]*(1+P[1]*(1+P[2]*(1+P[3]*(1+P[4]*(1+P[5]*(1+P[6]*(1+P[7]))))))));c=h.multiplyByScalar(c,f*(1+N[0]*(1+N[1]*(1+N[2]*(1+N[3]*(1+N[4]*(1+N[5]*(1+N[6]*(1+N[7])))))))),E);h.multiplyByScalar(b,d,e);return h.add(c,e,e)};h.fastSquad=function(c,b,d,e,f,g){a.typeOf.object("q0",c);a.typeOf.object("q1",b);a.typeOf.object("s0",d);a.typeOf.object("s1",e);a.typeOf.number("t",f);a.typeOf.object("result",g);c=h.fastSlerp(c,b,f,w);d=h.fastSlerp(d,e,f,G);return h.fastSlerp(c,d,2*f*(1-f),g)};h.equals=function(c,a){return c===a||k(c)&&k(a)&&c.x===a.x&&c.y===a.y&&c.z===a.z&&c.w===a.w};h.equalsEpsilon=function(c,b,d){a.typeOf.number("epsilon",d);return c===b||k(c)&&k(b)&&Math.abs(c.x-b.x)<=d&&Math.abs(c.y-b.y)<=d&&Math.abs(c.z-b.z)<=d&&Math.abs(c.w-b.w)<=d};h.ZERO=l(new h(0,0,0,0));h.IDENTITY=l(new h(0,0,0,1));h.prototype.clone=function(c){return h.clone(this,c)};h.prototype.equals=function(c){return h.equals(this,c)};h.prototype.equalsEpsilon=function(c,a){return h.equalsEpsilon(this,c,a)};h.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};return h});F("Core/Transforms","../ThirdParty/when ./Cartesian2 ./Cartesian3 ./Cartesian4 ./Cartographic ./Check ./defaultValue ./defined ./DeveloperError ./EarthOrientationParameters ./EarthOrientationParametersSample ./Ellipsoid ./HeadingPitchRoll ./Iau2006XysData ./Iau2006XysSample ./JulianDate ./Math ./Matrix3 ./Matrix4 ./Quaternion ./TimeConstants".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){var v={},B={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},C={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},I={},H={east:new f,north:new f,up:new f,west:new f,south:new f,down:new f},J=new f,w=new f,G=new f;v.localFrameToFixedFrameGenerator=function(c,a){if(!B.hasOwnProperty(c)||!B[c].hasOwnProperty(a))throw new h("firstAxis and secondAxis must be east, north, up, west, south or down.");var b=B[c][a],d,g=c+a;e(I[g])?d=I[g]:(d=function(d,g,k){if(!e(d))throw new h("origin is required.");e(k)||(k=new z);if(y.equalsEpsilon(d.x,0,y.EPSILON14)&&y.equalsEpsilon(d.y,0,y.EPSILON14))g=y.sign(d.z),f.unpack(C[c],0,J),"east"!==c&&"west"!==c&&f.multiplyByScalar(J,g,J),f.unpack(C[a],0,w),"east"!==a&&"west"!==a&&f.multiplyByScalar(w,g,w),f.unpack(C[b],0,G),"east"!==b&&"west"!==b&&f.multiplyByScalar(G,g,G);else{g=m(g,q.WGS84);g.geodeticSurfaceNormal(d,H.up);g=H.up;var l=H.east;l.x=-d.y;l.y=d.x;l.z=0;f.normalize(l,H.east);f.cross(g,l,H.north);f.multiplyByScalar(H.up,-1,H.down);f.multiplyByScalar(H.east,-1,H.west);f.multiplyByScalar(H.north,-1,H.south);J=H[c];w=H[a];G=H[b]}k[0]=J.x;k[1]=J.y;k[2]=J.z;k[3]=0;k[4]=w.x;k[5]=w.y;k[6]=w.z;k[7]=0;k[8]=G.x;k[9]=G.y;k[10]=G.z;k[11]=0;k[12]=d.x;k[13]=d.y;k[14]=d.z;k[15]=1;return k},I[g]=d);return d};v.eastNorthUpToFixedFrame=v.localFrameToFixedFrameGenerator("east","north");v.northEastDownToFixedFrame=v.localFrameToFixedFrameGenerator("north","east");v.northUpEastToFixedFrame=v.localFrameToFixedFrameGenerator("north","up");v.northWestUpToFixedFrame=v.localFrameToFixedFrameGenerator("north","west");var E=new x,L=new f(1,1,1),K=new z;v.headingPitchRollToFixedFrame=function(c,a,b,d,e){l.typeOf.object("HeadingPitchRoll",a);d=m(d,v.eastNorthUpToFixedFrame);a=x.fromHeadingPitchRoll(a,E);a=z.fromTranslationQuaternionRotationScale(f.ZERO,a,L,K);e=d(c,b,e);return z.multiply(e,a,e)};var P=new z,N=new A;v.headingPitchRollQuaternion=function(c,a,b,d,e){l.typeOf.object("HeadingPitchRoll",a);c=v.headingPitchRollToFixedFrame(c,a,b,d,P);c=z.getRotation(c,N);return x.fromRotationMatrix(c,e)};var O=new f(1,1,1),Z=new f,aa=new z,U=new z,W=new A,M=new x;v.fixedFrameToHeadingPitchRoll=function(c,a,b,d){l.defined("transform",c);a=m(a,q.WGS84);b=m(b,v.eastNorthUpToFixedFrame);e(d)||(d=new t);var h=z.getTranslation(c,Z);if(f.equals(h,f.ZERO))return d.heading=0,d.pitch=0,d.roll=0,d;a=z.inverseTransformation(b(h,a,aa),aa);c=z.setScale(c,O,U);c=z.setTranslation(c,f.ZERO,c);a=z.multiply(a,c,a);c=x.fromRotationMatrix(z.getRotation(a,W),M);c=x.normalize(c,c);return t.fromQuaternion(c,d)};var R=y.TWO_PI/86400,Y=new u;v.computeTemeToPseudoFixedMatrix=function(c,a){if(!e(c))throw new h("date is required.");Y=u.addSeconds(c,-u.computeTaiMinusUtc(c),Y);var b=Y.dayNumber,d=Y.secondsOfDay,f;f=b-2451545;f=43200<=d?(f+.5)/D.DAYS_PER_JULIAN_CENTURY:(f-.5)/D.DAYS_PER_JULIAN_CENTURY;d=(24110.54841+f*(8640184.812866+f*(.093104+-6.2E-6*f)))*R%y.TWO_PI+(d+.5*D.SECONDS_PER_DAY)%D.SECONDS_PER_DAY*(7.2921158553E-5+1.1772758384668E-19*(b-2451545.5));b=Math.cos(d);d=Math.sin(d);if(!e(a))return new A(b,d,0,-d,b,0,0,0,1);a[0]=b;a[1]=-d;a[2]=0;a[3]=d;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};v.iau2006XysData=new r;v.earthOrientationParameters=p.NONE;v.preloadIcrfFixed=function(c){c=v.iau2006XysData.preload(c.start.dayNumber,c.start.secondsOfDay+32.184,c.stop.dayNumber,c.stop.secondsOfDay+32.184);var a=v.earthOrientationParameters.getPromiseToLoad();return b.all([c,a])};v.computeIcrfToFixedMatrix=function(c,a){if(!e(c))throw new h("date is required.");e(a)||(a=new A);var b=v.computeFixedToIcrfMatrix(c,a);if(e(b))return A.transpose(b,a)};var Q=new c(0,0,0),S=new d(0,0,0,0,0,0),ca=new A,T=new A;v.computeFixedToIcrfMatrix=function(c,a){if(!e(c))throw new h("date is required.");e(a)||(a=new A);var b=v.earthOrientationParameters.compute(c,S);if(e(b)){var d=c.dayNumber,f=c.secondsOfDay+32.184,g=v.iau2006XysData.computeXysRadians(d,f,Q);if(e(g)){var k=g.x+b.xPoleOffset,l=g.y+b.yPoleOffset,p=1/(1+Math.sqrt(1-k*k-l*l));ca[0]=1-p*k*k;ca[3]=-p*k*l;ca[6]=k;ca[1]=-p*k*l;ca[4]=1-p*l*l;ca[7]=l;ca[2]=-k;ca[5]=-l;ca[8]=1-p*(k*k+l*l);g=A.fromRotationZ(-g.s,T);g=A.multiply(ca,g,ca);k=c.dayNumber;l=(c.secondsOfDay-u.computeTaiMinusUtc(c)+b.ut1MinusUtc)/D.SECONDS_PER_DAY;k=(.779057273264+l+.00273781191135448*(k-2451545+l))%1*y.TWO_PI;k=A.fromRotationZ(k,T);g=A.multiply(g,k,ca);k=Math.cos(b.xPoleWander);l=Math.cos(b.yPoleWander);p=Math.sin(b.xPoleWander);b=Math.sin(b.yPoleWander);f=(d-2451545+f/D.SECONDS_PER_DAY)/36525*-4.7E-5*y.RADIANS_PER_DEGREE/3600;d=Math.cos(f);f=Math.sin(f);T[0]=k*d;T[1]=k*f;T[2]=p;T[3]=-l*f+b*p*d;T[4]=l*d+b*p*f;T[5]=-b*k;T[6]=-b*f-l*p*d;T[7]=b*d-l*p*f;T[8]=l*k;return A.multiply(g,T,a)}}};var da=new k;v.pointToWindowCoordinates=function(c,a,b,d){d=v.pointToGLWindowCoordinates(c,a,b,d);d.y=2*a[5]-d.y;return d};v.pointToGLWindowCoordinates=function(c,b,d,f){if(!e(c))throw new h("modelViewProjectionMatrix is required.");if(!e(b))throw new h("viewportTransformation is required.");if(!e(d))throw new h("point is required.");e(f)||(f=new a);z.multiplyByVector(c,k.fromElements(d.x,d.y,d.z,1,da),da);k.multiplyByScalar(da,1/da.w,da);z.multiplyByVector(b,da,da);return a.fromCartesian4(da,f)};var V=new f,ba=new f,X=new f;v.rotationMatrixFromPositionVelocity=function(c,a,b,d){if(!e(c))throw new h("position is required.");if(!e(a))throw new h("velocity is required.");c=m(b,q.WGS84).geodeticSurfaceNormal(c,V);c=f.cross(a,c,ba);f.equalsEpsilon(c,f.ZERO,y.EPSILON6)&&(c=f.clone(f.UNIT_X,c));b=f.cross(c,a,X);f.normalize(b,b);f.cross(a,b,c);f.negate(c,c);f.normalize(c,c);e(d)||(d=new A);d[0]=a.x;d[1]=a.y;d[2]=a.z;d[3]=c.x;d[4]=c.y;d[5]=c.z;d[6]=b.x;d[7]=b.y;d[8]=b.z;return d};var fa=new z(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),ga=new g,ka=new f,F=new f,ia=new A,la=new z,ha=new z;v.basisTo2D=function(c,a,b){if(!e(c))throw new h("projection is required.");if(!e(a))throw new h("matrix is required.");if(!e(b))throw new h("result is required.");var d=z.getTranslation(a,F),g=c.ellipsoid,k=g.cartesianToCartographic(d,ga);c=c.project(k,ka);f.fromElements(c.z,c.x,c.y,c);d=v.eastNorthUpToFixedFrame(d,g,la);d=z.inverseTransformation(d,ha);a=z.getRotation(a,ia);a=z.multiplyByMatrix3(d,a,b);z.multiply(fa,a,b);z.setTranslation(b,c,b);return b};v.wgs84To2DModelMatrix=function(c,a,b){if(!e(c))throw new h("projection is required.");if(!e(a))throw new h("center is required.");if(!e(b))throw new h("result is required.");var d=c.ellipsoid,g=v.eastNorthUpToFixedFrame(a,d,la),g=z.inverseTransformation(g,ha);a=d.cartesianToCartographic(a,ga);c=c.project(a,ka);f.fromElements(c.z,c.x,c.y,c);c=z.fromTranslation(c,la);z.multiply(fa,g,b);z.multiply(c,b,b);return b};return v});F("Core/EllipsoidTangentPlane","./AxisAlignedBoundingBox ./Cartesian2 ./Cartesian3 ./Cartesian4 ./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./IntersectionTests ./Matrix4 ./Plane ./Ray ./Transforms".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(a,b){g.defined("origin",a);b=l(b,p.WGS84);a=b.scaleToGeodeticSurface(a);if(!m(a))throw new h("origin must not be at the center of the ellipsoid.");var d=c.eastNorthUpToFixedFrame(a,b);this._ellipsoid=b;this._origin=a;this._xAxis=f.fromCartesian4(q.getColumn(d,0,y));this._yAxis=f.fromCartesian4(q.getColumn(d,1,y));d=f.fromCartesian4(q.getColumn(d,2,y));this._plane=t.fromPointNormal(a,d)}var y=new k;e(u.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},origin:{get:function(){return this._origin}},plane:{get:function(){return this._plane}},xAxis:{get:function(){return this._xAxis}},yAxis:{get:function(){return this._yAxis}},zAxis:{get:function(){return this._plane.normal}}});var A=new b;u.fromPoints=function(c,a){g.defined("cartesians",c);var d=b.fromPoints(c,A);return new u(d.center,a)};var z=new r,x=new f;u.prototype.projectPointOntoPlane=function(c,b){g.defined("cartesian",c);z.origin=c;f.normalize(c,z.direction);var e=d.rayPlane(z,this._plane,x);m(e)||(f.negate(z.direction,z.direction),e=d.rayPlane(z,this._plane,x));if(m(e)){var h=f.subtract(e,this._origin,e),e=f.dot(this._xAxis,h),h=f.dot(this._yAxis,h);if(!m(b))return new a(e,h);b.x=e;b.y=h;return b}};u.prototype.projectPointsOntoPlane=function(c,a){g.defined("cartesians",c);m(a)||(a=[]);for(var b=0,d=c.length,e=0;e<d;e++){var f=this.projectPointOntoPlane(c[e],a[b]);m(f)&&(a[b]=f,b++)}a.length=b;return a};u.prototype.projectPointToNearestOnPlane=function(c,b){g.defined("cartesian",c);m(b)||(b=new a);z.origin=c;f.clone(this._plane.normal,z.direction);var e=d.rayPlane(z,this._plane,x);m(e)||(f.negate(z.direction,z.direction),e=d.rayPlane(z,this._plane,x));var h=f.subtract(e,this._origin,e),e=f.dot(this._xAxis,h),h=f.dot(this._yAxis,h);b.x=e;b.y=h;return b};u.prototype.projectPointsToNearestOnPlane=function(c,a){g.defined("cartesians",c);m(a)||(a=[]);var b=c.length;a.length=b;for(var d=0;d<b;d++)a[d]=this.projectPointToNearestOnPlane(c[d],a[d]);return a};var D=new f;u.prototype.projectPointOntoEllipsoid=function(c,a){g.defined("cartesian",c);m(a)||(a=new f);var b=this._ellipsoid,d=this._origin,e=this._yAxis;f.multiplyByScalar(this._xAxis,c.x,D);a=f.add(d,D,a);f.multiplyByScalar(e,c.y,D);f.add(a,D,a);b.scaleToGeocentricSurface(a,a);return a};u.prototype.projectPointsOntoEllipsoid=function(c,a){g.defined("cartesians",c);var b=c.length;m(a)?a.length=b:a=Array(b);for(var d=0;d<b;++d)a[d]=this.projectPointOntoEllipsoid(c[d],a[d]);return a};return u});F("Core/OrientedBoundingBox","./BoundingSphere ./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./EllipsoidTangentPlane ./Intersect ./Interval ./Math ./Matrix3 ./Plane ./Rectangle".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(c,a){this.center=f.clone(l(c,f.ZERO));this.halfAxes=r.clone(l(a,r.ZERO))}y.packedLength=f.packedLength+r.packedLength;y.pack=function(c,a,b){g.typeOf.object("value",c);g.defined("array",a);b=l(b,0);f.pack(c.center,a,b);r.pack(c.halfAxes,a,b+f.packedLength);return a};y.unpack=function(c,a,b){g.defined("array",c);a=l(a,0);m(b)||(b=new y);f.unpack(c,a,b.center);r.unpack(c,a+f.packedLength,b.halfAxes);return b};var A=new f,z=new f,x=new f,D=new f,v=new f,B=new f,C=new r,I={unitary:new r,diagonal:new r};y.fromPoints=function(c,a){m(a)||(a=new y);if(!m(c)||0===c.length)return a.halfAxes=r.ZERO,a.center=f.ZERO,a;var b,d=c.length,e=f.clone(c[0],A);for(b=1;b<d;b++)f.add(e,c[b],e);var h=1/d;f.multiplyByScalar(e,h,e);var g=0,k=0,l=0,p=0,q=0,w=0,u;for(b=0;b<d;b++)u=f.subtract(c[b],e,z),g+=u.x*u.x,k+=u.x*u.y,l+=u.x*u.z,p+=u.y*u.y,q+=u.y*u.z,w+=u.z*u.z;k*=h;l*=h;q*=h;C[0]=g*h;C[1]=k;C[2]=l;C[3]=k;C[4]=p*h;C[5]=q;C[6]=l;C[7]=q;C[8]=w*h;b=r.computeEigenDecomposition(C,I);b=r.clone(b.unitary,a.halfAxes);var e=r.getColumn(b,0,D),h=r.getColumn(b,1,v),g=r.getColumn(b,2,B),k=-Number.MAX_VALUE,l=-Number.MAX_VALUE,p=-Number.MAX_VALUE,E=w=q=Number.MAX_VALUE;for(b=0;b<d;b++)u=c[b],k=Math.max(f.dot(e,u),k),l=Math.max(f.dot(h,u),l),p=Math.max(f.dot(g,u),p),q=Math.min(f.dot(e,u),q),w=Math.min(f.dot(h,u),w),E=Math.min(f.dot(g,u),E);e=f.multiplyByScalar(e,.5*(q+k),e);h=f.multiplyByScalar(h,.5*(w+l),h);g=f.multiplyByScalar(g,.5*(E+p),g);d=f.add(e,h,a.center);f.add(d,g,d);x.x=k-q;x.y=l-w;x.z=p-E;f.multiplyByScalar(x,.5,x);r.multiplyByScale(a.halfAxes,x,a.halfAxes);return a};var H=new f,J=new f,w=new k,G=new f,E=[new k,new k,new k,new k,new k,new k,new k,new k],L=[new f,new f,new f,new f,new f,new f,new f,new f],K=[new a,new a,new a,new a,new a,new a,new a,new a];y.fromRectangle=function(a,b,d,g,k){if(!m(a))throw new e("rectangle is required");if(0>a.width||a.width>t.TWO_PI)throw new e("Rectangle width must be between 0 and 2*pi");if(0>a.height||a.height>t.PI)throw new e("Rectangle height must be between 0 and pi");if(m(g)&&!t.equalsEpsilon(g.radii.x,g.radii.y,t.EPSILON15))throw new e("Ellipsoid must be an ellipsoid of revolution (radii.x \x3d\x3d radii.y)");b=l(b,0);d=l(d,0);g=l(g,h.WGS84);var q=u.center(a,w),v=g.cartographicToCartesian(q,G),v=new p(v,g),B=v.plane,C=E[0],z=E[1],D=E[2],x=E[3],I=E[4],A=E[5],O=E[6],P=E[7],N=q.longitude,q=0>a.south&&0<a.north?0:q.latitude;O.latitude=A.latitude=I.latitude=a.south;P.latitude=x.latitude=q;C.latitude=z.latitude=D.latitude=a.north;O.longitude=P.longitude=C.longitude=a.west;A.longitude=z.longitude=N;I.longitude=x.longitude=D.longitude=a.east;D.height=z.height=C.height=P.height=O.height=A.height=I.height=x.height=d;g.cartographicArrayToCartesianArray(E,L);v.projectPointsToNearestOnPlane(L,K);a=Math.min(K[6].x,K[7].x,K[0].x);q=Math.max(K[2].x,K[3].x,K[4].x);z=Math.min(K[4].y,K[5].y,K[6].y);x=Math.max(K[0].y,K[1].y,K[2].y);D.height=C.height=I.height=O.height=b;g.cartographicArrayToCartesianArray(E,L);b=Math.min(c.getPointDistance(B,L[0]),c.getPointDistance(B,L[2]),c.getPointDistance(B,L[4]),c.getPointDistance(B,L[6]));if(!(m(a)&&m(q)&&m(z)&&m(x)&&m(b)&&m(d)))throw new e("all extents (minimum/maximum X/Y/Z) are required.");m(k)||(k=new y);g=k.halfAxes;r.setColumn(g,0,v.xAxis,g);r.setColumn(g,1,v.yAxis,g);r.setColumn(g,2,v.zAxis,g);B=H;B.x=(a+q)/2;B.y=(z+x)/2;B.z=(b+d)/2;J.x=(q-a)/2;J.y=(x-z)/2;J.z=(d-b)/2;d=k.center;B=r.multiplyByVector(g,B,B);f.add(v.origin,B,d);r.multiplyByScale(g,J,g);return k};y.clone=function(c,a){if(m(c)){if(!m(a))return new y(c.center,c.halfAxes);f.clone(c.center,a.center);r.clone(c.halfAxes,a.halfAxes);return a}};y.intersectPlane=function(c,a){if(!m(c))throw new e("box is required.");if(!m(a))throw new e("plane is required.");var b=a.normal,h=c.halfAxes,g=b.x,k=b.y,l=b.z,h=Math.abs(g*h[r.COLUMN0ROW0]+k*h[r.COLUMN0ROW1]+l*h[r.COLUMN0ROW2])+Math.abs(g*h[r.COLUMN1ROW0]+k*h[r.COLUMN1ROW1]+l*h[r.COLUMN1ROW2])+Math.abs(g*h[r.COLUMN2ROW0]+k*h[r.COLUMN2ROW1]+l*h[r.COLUMN2ROW2]),b=f.dot(b,c.center)+a.distance;return b<=-h?d.OUTSIDE:b>=h?d.INSIDE:d.INTERSECTING};var P=new f,N=new f,O=new f,Z=new f;y.distanceSquaredTo=function(c,a){if(!m(c))throw new e("box is required.");if(!m(a))throw new e("cartesian is required.");var b=f.subtract(a,c.center,H),d=c.halfAxes,h=r.getColumn(d,0,P),g=r.getColumn(d,1,N),k=r.getColumn(d,2,O),l=f.magnitude(h),d=f.magnitude(g),p=f.magnitude(k);f.normalize(h,h);f.normalize(g,g);f.normalize(k,k);Z.x=f.dot(b,h);Z.y=f.dot(b,g);Z.z=f.dot(b,k);b=0;Z.x<-l?(h=Z.x+l,b+=h*h):Z.x>l&&(h=Z.x-l,b+=h*h);Z.y<-d?(h=Z.y+d,b+=h*h):Z.y>d&&(h=Z.y-d,b+=h*h);Z.z<-p?(h=Z.z+p,b+=h*h):Z.z>p&&(h=Z.z-p,b+=h*h);return b};var aa=new f,U=new f;y.computePlaneDistances=function(c,a,b,d){if(!m(c))throw new e("box is required.");if(!m(a))throw new e("position is required.");if(!m(b))throw new e("direction is required.");m(d)||(d=new q);var h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,k=c.center,l=c.halfAxes;c=r.getColumn(l,0,P);var p=r.getColumn(l,1,N),l=r.getColumn(l,2,O),v=f.add(c,p,aa);f.add(v,l,v);f.add(v,k,v);var B=f.subtract(v,a,U),w=f.dot(b,B),h=Math.min(w,h),g=Math.max(w,g);f.add(k,c,v);f.add(v,p,v);f.subtract(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);f.add(k,c,v);f.subtract(v,p,v);f.add(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);f.add(k,c,v);f.subtract(v,p,v);f.subtract(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);f.subtract(k,c,v);f.add(v,p,v);f.add(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);f.subtract(k,c,v);f.add(v,p,v);f.subtract(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);f.subtract(k,c,v);f.subtract(v,p,v);f.add(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);f.subtract(k,c,v);f.subtract(v,p,v);f.subtract(v,l,v);f.subtract(v,a,B);w=f.dot(b,B);h=Math.min(w,h);g=Math.max(w,g);d.start=h;d.stop=g;return d};var W=new b;y.isOccluded=function(c,a){if(!m(c))throw new e("box is required.");if(!m(a))throw new e("occluder is required.");var d=b.fromOrientedBoundingBox(c,W);return!a.isBoundingSphereVisible(d)};y.prototype.intersectPlane=function(c){return y.intersectPlane(this,c)};y.prototype.distanceSquaredTo=function(c){return y.distanceSquaredTo(this,c)};y.prototype.computePlaneDistances=function(c,a,b){return y.computePlaneDistances(this,c,a,b)};y.prototype.isOccluded=function(c){return y.isOccluded(this,c)};y.equals=function(c,a){return c===a||m(c)&&m(a)&&f.equals(c.center,a.center)&&r.equals(c.halfAxes,a.halfAxes)};y.prototype.clone=function(c){return y.clone(this,c)};y.prototype.equals=function(c){return y.equals(this,c)};return y});F("Core/AttributeCompression","./Cartesian2 ./Cartesian3 ./Check ./defined ./DeveloperError ./Math".split(" "),function(b,a,f,k,g,l){function m(a){q[0]=a;return q[0]}function e(a){return a>>1^-(a&1)}var h=1/256,p={octEncodeInRange:function(b,c,d){f.defined("vector",b);f.defined("result",d);var e=a.magnitudeSquared(b);if(Math.abs(e-1)>l.EPSILON6)throw new g("vector must be normalized.");d.x=b.x/(Math.abs(b.x)+Math.abs(b.y)+Math.abs(b.z));d.y=b.y/(Math.abs(b.x)+Math.abs(b.y)+Math.abs(b.z));0>b.z&&(b=d.x,e=d.y,d.x=(1-Math.abs(e))*l.signNotZero(b),d.y=(1-Math.abs(b))*l.signNotZero(e));d.x=l.toSNorm(d.x,c);d.y=l.toSNorm(d.y,c);return d},octEncode:function(a,c){return p.octEncodeInRange(a,255,c)}},d=new b,q=new Uint8Array(1);p.octEncodeToCartesian4=function(a,c){p.octEncodeInRange(a,65535,d);c.x=m(d.x*h);c.y=m(d.x);c.z=m(d.y*h);c.w=m(d.y);return c};p.octDecodeInRange=function(b,c,d,e){f.defined("result",e);if(0>b||b>d||0>c||c>d)throw new g("x and y must be unsigned normalized integers between 0 and "+d);e.x=l.fromSNorm(b,d);e.y=l.fromSNorm(c,d);e.z=1-(Math.abs(e.x)+Math.abs(e.y));0>e.z&&(b=e.x,e.x=(1-Math.abs(e.y))*l.signNotZero(b),e.y=(1-Math.abs(b))*l.signNotZero(e.y));return a.normalize(e,e)};p.octDecode=function(a,c,b){return p.octDecodeInRange(a,c,255,b)};p.octDecodeFromCartesian4=function(a,c){f.typeOf.object("encoded",a);f.typeOf.object("result",c);var b=a.x,d=a.y,e=a.z,h=a.w;if(0>b||255<b||0>d||255<d||0>e||255<e||0>h||255<h)throw new g("x, y, z, and w must be unsigned normalized integers between 0 and 255");return p.octDecodeInRange(256*b+d,256*e+h,65535,c)};p.octPackFloat=function(a){f.defined("encoded",a);return 256*a.x+a.y};var t=new b;p.octEncodeFloat=function(a){p.octEncode(a,t);return p.octPackFloat(t)};p.octDecodeFloat=function(a,c){f.defined("value",a);var b=a/256,d=Math.floor(b);return p.octDecode(d,256*(b-d),c)};p.octPack=function(a,c,b,d){f.defined("v1",a);f.defined("v2",c);f.defined("v3",b);f.defined("result",d);a=p.octEncodeFloat(a);c=p.octEncodeFloat(c);b=p.octEncode(b,t);d.x=65536*b.x+a;d.y=65536*b.y+c;return d};p.octUnpack=function(a,c,b,d){f.defined("packed",a);f.defined("v1",c);f.defined("v2",b);f.defined("v3",d);var e=a.x/65536,h=Math.floor(e),g=65536*(e-h),e=a.y/65536;a=Math.floor(e);e=65536*(e-a);p.octDecodeFloat(g,c);p.octDecodeFloat(e,b);p.octDecode(h,a,d)};p.compressTextureCoordinates=function(a){f.defined("textureCoordinates",a);return 4096*(4095*a.x|0)+(4095*a.y|0)};p.decompressTextureCoordinates=function(a,c){f.defined("compressed",a);f.defined("result",c);var b=Math.floor(a/4096);c.x=b/4095;c.y=(a-4096*b)/4095;return c};p.zigZagDeltaDecode=function(a,c,b){f.defined("uBuffer",a);f.defined("vBuffer",c);f.typeOf.number.equals("uBuffer.length","vBuffer.length",a.length,c.length);k(b)&&f.typeOf.number.equals("uBuffer.length","heightBuffer.length",a.length,b.length);for(var d=a.length,h=0,g=0,l=0,p=0;p<d;++p)h+=e(a[p]),g+=e(c[p]),a[p]=h,c[p]=g,k(b)&&(l+=e(b[p]),b[p]=l)};return p});F("Core/WebGLConstants",["./freezeObject"],function(b){return b({DEPTH_BUFFER_BIT:256,STENCIL_BUFFER_BIT:1024,COLOR_BUFFER_BIT:16384,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,ZERO:0,ONE:1,SRC_COLOR:768,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,ONE_MINUS_SRC_ALPHA:771,DST_ALPHA:772,ONE_MINUS_DST_ALPHA:773,DST_COLOR:774,ONE_MINUS_DST_COLOR:775,SRC_ALPHA_SATURATE:776,FUNC_ADD:32774,BLEND_EQUATION:32777,BLEND_EQUATION_RGB:32777,BLEND_EQUATION_ALPHA:34877,FUNC_SUBTRACT:32778,FUNC_REVERSE_SUBTRACT:32779,BLEND_DST_RGB:32968,BLEND_SRC_RGB:32969,BLEND_DST_ALPHA:32970,BLEND_SRC_ALPHA:32971,CONSTANT_COLOR:32769,ONE_MINUS_CONSTANT_COLOR:32770,CONSTANT_ALPHA:32771,ONE_MINUS_CONSTANT_ALPHA:32772,BLEND_COLOR:32773,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,ARRAY_BUFFER_BINDING:34964,ELEMENT_ARRAY_BUFFER_BINDING:34965,STREAM_DRAW:35040,STATIC_DRAW:35044,DYNAMIC_DRAW:35048,BUFFER_SIZE:34660,BUFFER_USAGE:34661,CURRENT_VERTEX_ATTRIB:34342,FRONT:1028,BACK:1029,FRONT_AND_BACK:1032,CULL_FACE:2884,BLEND:3042,DITHER:3024,STENCIL_TEST:2960,DEPTH_TEST:2929,SCISSOR_TEST:3089,POLYGON_OFFSET_FILL:32823,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_COVERAGE:32928,NO_ERROR:0,INVALID_ENUM:1280,INVALID_VALUE:1281,INVALID_OPERATION:1282,OUT_OF_MEMORY:1285,CW:2304,CCW:2305,LINE_WIDTH:2849,ALIASED_POINT_SIZE_RANGE:33901,ALIASED_LINE_WIDTH_RANGE:33902,CULL_FACE_MODE:2885,FRONT_FACE:2886,DEPTH_RANGE:2928,DEPTH_WRITEMASK:2930,DEPTH_CLEAR_VALUE:2931,DEPTH_FUNC:2932,STENCIL_CLEAR_VALUE:2961,STENCIL_FUNC:2962,STENCIL_FAIL:2964,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STENCIL_BACK_FUNC:34816,STENCIL_BACK_FAIL:34817,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,VIEWPORT:2978,SCISSOR_BOX:3088,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,UNPACK_ALIGNMENT:3317,PACK_ALIGNMENT:3333,MAX_TEXTURE_SIZE:3379,MAX_VIEWPORT_DIMS:3386,SUBPIXEL_BITS:3408,RED_BITS:3410,GREEN_BITS:3411,BLUE_BITS:3412,ALPHA_BITS:3413,DEPTH_BITS:3414,STENCIL_BITS:3415,POLYGON_OFFSET_UNITS:10752,POLYGON_OFFSET_FACTOR:32824,TEXTURE_BINDING_2D:32873,SAMPLE_BUFFERS:32936,SAMPLES:32937,SAMPLE_COVERAGE_VALUE:32938,SAMPLE_COVERAGE_INVERT:32939,COMPRESSED_TEXTURE_FORMATS:34467,DONT_CARE:4352,FASTEST:4353,NICEST:4354,GENERATE_MIPMAP_HINT:33170,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DEPTH_COMPONENT:6402,ALPHA:6406,RGB:6407,RGBA:6408,LUMINANCE:6409,LUMINANCE_ALPHA:6410,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,FRAGMENT_SHADER:35632,VERTEX_SHADER:35633,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VARYING_VECTORS:36348,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_FRAGMENT_UNIFORM_VECTORS:36349,SHADER_TYPE:35663,DELETE_STATUS:35712,LINK_STATUS:35714,VALIDATE_STATUS:35715,ATTACHED_SHADERS:35717,ACTIVE_UNIFORMS:35718,ACTIVE_ATTRIBUTES:35721,SHADING_LANGUAGE_VERSION:35724,CURRENT_PROGRAM:35725,NEVER:512,LESS:513,EQUAL:514,LEQUAL:515,GREATER:516,NOTEQUAL:517,GEQUAL:518,ALWAYS:519,KEEP:7680,REPLACE:7681,INCR:7682,DECR:7683,INVERT:5386,INCR_WRAP:34055,DECR_WRAP:34056,VENDOR:7936,RENDERER:7937,VERSION:7938,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TEXTURE_2D:3553,TEXTURE:5890,TEXTURE_CUBE_MAP:34067,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,MAX_CUBE_MAP_TEXTURE_SIZE:34076,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34E3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,ACTIVE_TEXTURE:34016,REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,SAMPLER_2D:35678,SAMPLER_CUBE:35680,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,IMPLEMENTATION_COLOR_READ_TYPE:35738,IMPLEMENTATION_COLOR_READ_FORMAT:35739,COMPILE_STATUS:35713,LOW_FLOAT:36336,MEDIUM_FLOAT:36337,HIGH_FLOAT:36338,LOW_INT:36339,MEDIUM_INT:36340,HIGH_INT:36341,FRAMEBUFFER:36160,RENDERBUFFER:36161,RGBA4:32854,RGB5_A1:32855,RGB565:36194,DEPTH_COMPONENT16:33189,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,DEPTH_STENCIL:34041,RENDERBUFFER_WIDTH:36162,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_STENCIL_SIZE:36181,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,COLOR_ATTACHMENT0:36064,DEPTH_ATTACHMENT:36096,STENCIL_ATTACHMENT:36128,DEPTH_STENCIL_ATTACHMENT:33306,NONE:0,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_UNSUPPORTED:36061,FRAMEBUFFER_BINDING:36006,RENDERBUFFER_BINDING:36007,MAX_RENDERBUFFER_SIZE:34024,INVALID_FRAMEBUFFER_OPERATION:1286,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_EXT:33778,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGB_ETC1_WEBGL:36196,HALF_FLOAT_OES:36193,DOUBLE:5130,READ_BUFFER:3074,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_ROWS:3315,UNPACK_SKIP_PIXELS:3316,PACK_ROW_LENGTH:3330,PACK_SKIP_ROWS:3331,PACK_SKIP_PIXELS:3332,COLOR:6144,DEPTH:6145,STENCIL:6146,RED:6403,RGB8:32849,RGBA8:32856,RGB10_A2:32857,TEXTURE_BINDING_3D:32874,UNPACK_SKIP_IMAGES:32877,UNPACK_IMAGE_HEIGHT:32878,TEXTURE_3D:32879,TEXTURE_WRAP_R:32882,MAX_3D_TEXTURE_SIZE:32883,UNSIGNED_INT_2_10_10_10_REV:33640,MAX_ELEMENTS_VERTICES:33E3,MAX_ELEMENTS_INDICES:33001,TEXTURE_MIN_LOD:33082,TEXTURE_MAX_LOD:33083,TEXTURE_BASE_LEVEL:33084,TEXTURE_MAX_LEVEL:33085,MIN:32775,MAX:32776,DEPTH_COMPONENT24:33190,MAX_TEXTURE_LOD_BIAS:34045,TEXTURE_COMPARE_MODE:34892,TEXTURE_COMPARE_FUNC:34893,CURRENT_QUERY:34917,QUERY_RESULT:34918,QUERY_RESULT_AVAILABLE:34919,STREAM_READ:35041,STREAM_COPY:35042,STATIC_READ:35045,STATIC_COPY:35046,DYNAMIC_READ:35049,DYNAMIC_COPY:35050,MAX_DRAW_BUFFERS:34852,DRAW_BUFFER0:34853,DRAW_BUFFER1:34854,DRAW_BUFFER2:34855,DRAW_BUFFER3:34856,DRAW_BUFFER4:34857,DRAW_BUFFER5:34858,DRAW_BUFFER6:34859,DRAW_BUFFER7:34860,DRAW_BUFFER8:34861,DRAW_BUFFER9:34862,DRAW_BUFFER10:34863,DRAW_BUFFER11:34864,DRAW_BUFFER12:34865,DRAW_BUFFER13:34866,DRAW_BUFFER14:34867,DRAW_BUFFER15:34868,MAX_FRAGMENT_UNIFORM_COMPONENTS:35657,MAX_VERTEX_UNIFORM_COMPONENTS:35658,SAMPLER_3D:35679,SAMPLER_2D_SHADOW:35682,FRAGMENT_SHADER_DERIVATIVE_HINT:35723,PIXEL_PACK_BUFFER:35051,PIXEL_UNPACK_BUFFER:35052,PIXEL_PACK_BUFFER_BINDING:35053,PIXEL_UNPACK_BUFFER_BINDING:35055,FLOAT_MAT2x3:35685,FLOAT_MAT2x4:35686,FLOAT_MAT3x2:35687,FLOAT_MAT3x4:35688,FLOAT_MAT4x2:35689,FLOAT_MAT4x3:35690,SRGB:35904,SRGB8:35905,SRGB8_ALPHA8:35907,COMPARE_REF_TO_TEXTURE:34894,RGBA32F:34836,RGB32F:34837,RGBA16F:34842,RGB16F:34843,VERTEX_ATTRIB_ARRAY_INTEGER:35069,MAX_ARRAY_TEXTURE_LAYERS:35071,MIN_PROGRAM_TEXEL_OFFSET:35076,MAX_PROGRAM_TEXEL_OFFSET:35077,MAX_VARYING_COMPONENTS:35659,TEXTURE_2D_ARRAY:35866,TEXTURE_BINDING_2D_ARRAY:35869,R11F_G11F_B10F:35898,UNSIGNED_INT_10F_11F_11F_REV:35899,RGB9_E5:35901,UNSIGNED_INT_5_9_9_9_REV:35902,TRANSFORM_FEEDBACK_BUFFER_MODE:35967,MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS:35968,TRANSFORM_FEEDBACK_VARYINGS:35971,TRANSFORM_FEEDBACK_BUFFER_START:35972,TRANSFORM_FEEDBACK_BUFFER_SIZE:35973,TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN:35976,RASTERIZER_DISCARD:35977,MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS:35978,MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS:35979,INTERLEAVED_ATTRIBS:35980,SEPARATE_ATTRIBS:35981,TRANSFORM_FEEDBACK_BUFFER:35982,TRANSFORM_FEEDBACK_BUFFER_BINDING:35983,RGBA32UI:36208,RGB32UI:36209,RGBA16UI:36214,RGB16UI:36215,RGBA8UI:36220,RGB8UI:36221,RGBA32I:36226,RGB32I:36227,RGBA16I:36232,RGB16I:36233,RGBA8I:36238,RGB8I:36239,RED_INTEGER:36244,RGB_INTEGER:36248,RGBA_INTEGER:36249,SAMPLER_2D_ARRAY:36289,SAMPLER_2D_ARRAY_SHADOW:36292,SAMPLER_CUBE_SHADOW:36293,UNSIGNED_INT_VEC2:36294,UNSIGNED_INT_VEC3:36295,UNSIGNED_INT_VEC4:36296,INT_SAMPLER_2D:36298,INT_SAMPLER_3D:36299,INT_SAMPLER_CUBE:36300,INT_SAMPLER_2D_ARRAY:36303,UNSIGNED_INT_SAMPLER_2D:36306,UNSIGNED_INT_SAMPLER_3D:36307,UNSIGNED_INT_SAMPLER_CUBE:36308,UNSIGNED_INT_SAMPLER_2D_ARRAY:36311,DEPTH_COMPONENT32F:36012,DEPTH32F_STENCIL8:36013,FLOAT_32_UNSIGNED_INT_24_8_REV:36269,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE:33297,FRAMEBUFFER_ATTACHMENT_RED_SIZE:33298,FRAMEBUFFER_ATTACHMENT_GREEN_SIZE:33299,FRAMEBUFFER_ATTACHMENT_BLUE_SIZE:33300,FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE:33301,FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE:33302,FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE:33303,FRAMEBUFFER_DEFAULT:33304,UNSIGNED_INT_24_8:34042,DEPTH24_STENCIL8:35056,UNSIGNED_NORMALIZED:35863,DRAW_FRAMEBUFFER_BINDING:36006,READ_FRAMEBUFFER:36008,DRAW_FRAMEBUFFER:36009,READ_FRAMEBUFFER_BINDING:36010,RENDERBUFFER_SAMPLES:36011,FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER:36052,MAX_COLOR_ATTACHMENTS:36063,COLOR_ATTACHMENT1:36065,COLOR_ATTACHMENT2:36066,COLOR_ATTACHMENT3:36067,COLOR_ATTACHMENT4:36068,COLOR_ATTACHMENT5:36069,COLOR_ATTACHMENT6:36070,COLOR_ATTACHMENT7:36071,COLOR_ATTACHMENT8:36072,COLOR_ATTACHMENT9:36073,COLOR_ATTACHMENT10:36074,COLOR_ATTACHMENT11:36075,COLOR_ATTACHMENT12:36076,COLOR_ATTACHMENT13:36077,COLOR_ATTACHMENT14:36078,COLOR_ATTACHMENT15:36079,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:36182,MAX_SAMPLES:36183,HALF_FLOAT:5131,RG:33319,RG_INTEGER:33320,R8:33321,RG8:33323,R16F:33325,R32F:33326,RG16F:33327,RG32F:33328,R8I:33329,R8UI:33330,R16I:33331,R16UI:33332,R32I:33333,R32UI:33334,RG8I:33335,RG8UI:33336,RG16I:33337,RG16UI:33338,RG32I:33339,RG32UI:33340,VERTEX_ARRAY_BINDING:34229,R8_SNORM:36756,RG8_SNORM:36757,RGB8_SNORM:36758,RGBA8_SNORM:36759,SIGNED_NORMALIZED:36764,COPY_READ_BUFFER:36662,COPY_WRITE_BUFFER:36663,COPY_READ_BUFFER_BINDING:36662,COPY_WRITE_BUFFER_BINDING:36663,UNIFORM_BUFFER:35345,UNIFORM_BUFFER_BINDING:35368,UNIFORM_BUFFER_START:35369,UNIFORM_BUFFER_SIZE:35370,MAX_VERTEX_UNIFORM_BLOCKS:35371,MAX_FRAGMENT_UNIFORM_BLOCKS:35373,MAX_COMBINED_UNIFORM_BLOCKS:35374,MAX_UNIFORM_BUFFER_BINDINGS:35375,MAX_UNIFORM_BLOCK_SIZE:35376,MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS:35377,MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS:35379,UNIFORM_BUFFER_OFFSET_ALIGNMENT:35380,ACTIVE_UNIFORM_BLOCKS:35382,UNIFORM_TYPE:35383,UNIFORM_SIZE:35384,UNIFORM_BLOCK_INDEX:35386,UNIFORM_OFFSET:35387,UNIFORM_ARRAY_STRIDE:35388,UNIFORM_MATRIX_STRIDE:35389,UNIFORM_IS_ROW_MAJOR:35390,UNIFORM_BLOCK_BINDING:35391,UNIFORM_BLOCK_DATA_SIZE:35392,UNIFORM_BLOCK_ACTIVE_UNIFORMS:35394,UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES:35395,UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER:35396,UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER:35398,INVALID_INDEX:4294967295,MAX_VERTEX_OUTPUT_COMPONENTS:37154,MAX_FRAGMENT_INPUT_COMPONENTS:37157,MAX_SERVER_WAIT_TIMEOUT:37137,OBJECT_TYPE:37138,SYNC_CONDITION:37139,SYNC_STATUS:37140,SYNC_FLAGS:37141,SYNC_FENCE:37142,SYNC_GPU_COMMANDS_COMPLETE:37143,UNSIGNALED:37144,SIGNALED:37145,ALREADY_SIGNALED:37146,TIMEOUT_EXPIRED:37147,CONDITION_SATISFIED:37148,WAIT_FAILED:37149,SYNC_FLUSH_COMMANDS_BIT:1,VERTEX_ATTRIB_ARRAY_DIVISOR:35070,ANY_SAMPLES_PASSED:35887,ANY_SAMPLES_PASSED_CONSERVATIVE:36202,SAMPLER_BINDING:35097,RGB10_A2UI:36975,INT_2_10_10_10_REV:36255,TRANSFORM_FEEDBACK:36386,TRANSFORM_FEEDBACK_PAUSED:36387,TRANSFORM_FEEDBACK_ACTIVE:36388,TRANSFORM_FEEDBACK_BINDING:36389,COMPRESSED_R11_EAC:37488,COMPRESSED_SIGNED_R11_EAC:37489,COMPRESSED_RG11_EAC:37490,COMPRESSED_SIGNED_RG11_EAC:37491,COMPRESSED_RGB8_ETC2:37492,COMPRESSED_SRGB8_ETC2:37493,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:37494,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:37495,COMPRESSED_RGBA8_ETC2_EAC:37496,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:37497,TEXTURE_IMMUTABLE_FORMAT:37167,MAX_ELEMENT_INDEX:36203,TEXTURE_IMMUTABLE_LEVELS:33503,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047})});F("Core/ComponentDatatype","./defaultValue ./defined ./DeveloperError ./FeatureDetection ./freezeObject ./WebGLConstants".split(" "),function(b,a,f,k,g,l){if(!k.supportsTypedArrays())return{};var m={BYTE:l.BYTE,UNSIGNED_BYTE:l.UNSIGNED_BYTE,SHORT:l.SHORT,UNSIGNED_SHORT:l.UNSIGNED_SHORT,INT:l.INT,UNSIGNED_INT:l.UNSIGNED_INT,FLOAT:l.FLOAT,DOUBLE:l.DOUBLE,getSizeInBytes:function(b){if(!a(b))throw new f("value is required.");switch(b){case m.BYTE:return Int8Array.BYTES_PER_ELEMENT;case m.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case m.SHORT:return Int16Array.BYTES_PER_ELEMENT;case m.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case m.INT:return Int32Array.BYTES_PER_ELEMENT;case m.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case m.FLOAT:return Float32Array.BYTES_PER_ELEMENT;case m.DOUBLE:return Float64Array.BYTES_PER_ELEMENT;default:throw new f("componentDatatype is not a valid value.");}},fromTypedArray:function(a){if(a instanceof Int8Array)return m.BYTE;if(a instanceof Uint8Array)return m.UNSIGNED_BYTE;if(a instanceof Int16Array)return m.SHORT;if(a instanceof Uint16Array)return m.UNSIGNED_SHORT;if(a instanceof Int32Array)return m.INT;if(a instanceof Uint32Array)return m.UNSIGNED_INT;if(a instanceof Float32Array)return m.FLOAT;if(a instanceof Float64Array)return m.DOUBLE},validate:function(b){return a(b)&&(b===m.BYTE||b===m.UNSIGNED_BYTE||b===m.SHORT||b===m.UNSIGNED_SHORT||b===m.INT||b===m.UNSIGNED_INT||b===m.FLOAT||b===m.DOUBLE)},createTypedArray:function(b,h){if(!a(b))throw new f("componentDatatype is required.");if(!a(h))throw new f("valuesOrLength is required.");switch(b){case m.BYTE:return new Int8Array(h);case m.UNSIGNED_BYTE:return new Uint8Array(h);case m.SHORT:return new Int16Array(h);case m.UNSIGNED_SHORT:return new Uint16Array(h);case m.INT:return new Int32Array(h);case m.UNSIGNED_INT:return new Uint32Array(h);case m.FLOAT:return new Float32Array(h);case m.DOUBLE:return new Float64Array(h);default:throw new f("componentDatatype is not a valid value.");}},createArrayBufferView:function(e,h,g,d){if(!a(e))throw new f("componentDatatype is required.");if(!a(h))throw new f("buffer is required.");g=b(g,0);d=b(d,(h.byteLength-g)/m.getSizeInBytes(e));switch(e){case m.BYTE:return new Int8Array(h,g,d);case m.UNSIGNED_BYTE:return new Uint8Array(h,g,d);case m.SHORT:return new Int16Array(h,g,d);case m.UNSIGNED_SHORT:return new Uint16Array(h,g,d);case m.INT:return new Int32Array(h,g,d);case m.UNSIGNED_INT:return new Uint32Array(h,g,d);case m.FLOAT:return new Float32Array(h,g,d);case m.DOUBLE:return new Float64Array(h,g,d);default:throw new f("componentDatatype is not a valid value.");}},fromName:function(a){switch(a){case "BYTE":return m.BYTE;case "UNSIGNED_BYTE":return m.UNSIGNED_BYTE;case "SHORT":return m.SHORT;case "UNSIGNED_SHORT":return m.UNSIGNED_SHORT;case "INT":return m.INT;case "UNSIGNED_INT":return m.UNSIGNED_INT;case "FLOAT":return m.FLOAT;case "DOUBLE":return m.DOUBLE;default:throw new f("name is not a valid value.");}}};return g(m)});F("Core/TerrainQuantization",["./freezeObject"],function(b){return b({NONE:0,BITS12:1})});F("Core/TerrainEncoding","./AttributeCompression ./Cartesian2 ./Cartesian3 ./ComponentDatatype ./defaultValue ./defined ./Math ./Matrix4 ./TerrainQuantization".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a,b,k,p,m,C){var v=h.NONE,B,z,w;if(l(a)&&l(b)&&l(k)&&l(p)){var y=a.minimum,E=f.subtract(a.maximum,y,q),v=k-b,v=Math.max(f.maximumComponent(E),v)<u-1?h.BITS12:h.NONE;B=a.center;z=e.inverseTransformation(p,new e);w=f.negate(y,d);e.multiply(e.fromTranslation(w,r),z,z);w=d;w.x=1/E.x;w.y=1/E.y;w.z=1/E.z;e.multiply(e.fromScale(w,r),z,z);w=e.clone(p);e.setTranslation(w,f.ZERO,w);p=e.clone(p,new e);y=e.fromTranslation(y,r);E=e.fromScale(E,c);E=e.multiply(y,E,r);e.multiply(p,E,p);e.multiply(w,E,w)}this.quantization=v;this.minimumHeight=b;this.maximumHeight=k;this.center=B;this.toScaledENU=z;this.fromScaledENU=p;this.matrix=w;this.hasVertexNormals=m;this.hasWebMercatorT=g(C,!1)}var d=new f,q=new f,t=new a,r=new e,c=new e,u=Math.pow(2,12);p.prototype.encode=function(c,g,k,l,p,q,r){var v=l.x;l=l.y;if(this.quantization===h.BITS12){k=e.multiplyByPoint(this.toScaledENU,k,d);k.x=m.clamp(k.x,0,1);k.y=m.clamp(k.y,0,1);k.z=m.clamp(k.z,0,1);var B=m.clamp((p-this.minimumHeight)/(this.maximumHeight-this.minimumHeight),0,1);a.fromElements(k.x,k.y,t);p=b.compressTextureCoordinates(t);a.fromElements(k.z,B,t);k=b.compressTextureCoordinates(t);a.fromElements(v,l,t);v=b.compressTextureCoordinates(t);c[g++]=p;c[g++]=k;c[g++]=v;this.hasWebMercatorT&&(a.fromElements(r,0,t),r=b.compressTextureCoordinates(t),c[g++]=r)}else f.subtract(k,this.center,d),c[g++]=d.x,c[g++]=d.y,c[g++]=d.z,c[g++]=p,c[g++]=v,c[g++]=l,this.hasWebMercatorT&&(c[g++]=r);this.hasVertexNormals&&(c[g++]=b.octPackFloat(q));return g};p.prototype.decodePosition=function(c,a,d){l(d)||(d=new f);a*=this.getStride();if(this.quantization===h.BITS12){var g=b.decompressTextureCoordinates(c[a],t);d.x=g.x;d.y=g.y;c=b.decompressTextureCoordinates(c[a+1],t);d.z=c.x;return e.multiplyByPoint(this.fromScaledENU,d,d)}d.x=c[a];d.y=c[a+1];d.z=c[a+2];return f.add(d,this.center,d)};p.prototype.decodeTextureCoordinates=function(c,d,e){l(e)||(e=new a);d*=this.getStride();return this.quantization===h.BITS12?b.decompressTextureCoordinates(c[d+2],e):a.fromElements(c[d+4],c[d+5],e)};p.prototype.decodeHeight=function(c,a){a*=this.getStride();return this.quantization===h.BITS12?b.decompressTextureCoordinates(c[a+1],t).y*(this.maximumHeight-this.minimumHeight)+this.minimumHeight:c[a+3]};p.prototype.decodeWebMercatorT=function(c,a){a*=this.getStride();return this.quantization===h.BITS12?b.decompressTextureCoordinates(c[a+3],t).x:c[a+6]};p.prototype.getOctEncodedNormal=function(c,b,d){var e=this.getStride();c=c[(b+1)*e-1]/256;b=Math.floor(c);return a.fromElements(b,256*(c-b),d)};p.prototype.getStride=function(){var c;switch(this.quantization){case h.BITS12:c=3;break;default:c=6}this.hasWebMercatorT&&++c;this.hasVertexNormals&&++c;return c};var y={position3DAndHeight:0,textureCoordAndEncodedNormals:1},A={compressed0:0,compressed1:1};p.prototype.getAttributes=function(c){var a=k.FLOAT,b=k.getSizeInBytes(a),d;if(this.quantization===h.NONE){var e=2;this.hasWebMercatorT&&++e;this.hasVertexNormals&&++e;d=(4+e)*b;return[{index:y.position3DAndHeight,vertexBuffer:c,componentDatatype:a,componentsPerAttribute:4,offsetInBytes:0,strideInBytes:d},{index:y.textureCoordAndEncodedNormals,vertexBuffer:c,componentDatatype:a,componentsPerAttribute:e,offsetInBytes:4*b,strideInBytes:d}]}var e=3,f=0;(this.hasWebMercatorT||this.hasVertexNormals)&&++e;return this.hasWebMercatorT&&this.hasVertexNormals?(++f,d=(e+f)*b,[{index:A.compressed0,vertexBuffer:c,componentDatatype:a,componentsPerAttribute:e,offsetInBytes:0,strideInBytes:d},{index:A.compressed1,vertexBuffer:c,componentDatatype:a,componentsPerAttribute:f,offsetInBytes:e*b,strideInBytes:d}]):[{index:A.compressed0,vertexBuffer:c,componentDatatype:a,componentsPerAttribute:e}]};p.prototype.getAttributeLocations=function(){return this.quantization===h.NONE?y:A};p.clone=function(c,a){l(a)||(a=new p);a.quantization=c.quantization;a.minimumHeight=c.minimumHeight;a.maximumHeight=c.maximumHeight;a.center=f.clone(c.center);a.toScaledENU=e.clone(c.toScaledENU);a.fromScaledENU=e.clone(c.fromScaledENU);a.matrix=e.clone(c.matrix);a.hasVertexNormals=c.hasVertexNormals;a.hasWebMercatorT=c.hasWebMercatorT;return a};return p});F("Core/WebMercatorProjection","./Cartesian3 ./Cartographic ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./Math".split(" "),function(b,a,f,k,g,l,m,e){function h(a){this._ellipsoid=f(a,m.WGS84);this._semimajorAxis=this._ellipsoid.maximumRadius;this._oneOverSemimajorAxis=1/this._semimajorAxis}g(h.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});h.mercatorAngleToGeodeticLatitude=function(a){return e.PI_OVER_TWO-2*Math.atan(Math.exp(-a))};h.geodeticLatitudeToMercatorAngle=function(a){a>h.MaximumLatitude?a=h.MaximumLatitude:a<-h.MaximumLatitude&&(a=-h.MaximumLatitude);a=Math.sin(a);return.5*Math.log((1+a)/(1-a))};h.MaximumLatitude=h.mercatorAngleToGeodeticLatitude(Math.PI);h.prototype.project=function(a,d){var e=this._semimajorAxis,f=a.longitude*e,e=h.geodeticLatitudeToMercatorAngle(a.latitude)*e,g=a.height;if(!k(d))return new b(f,e,g);d.x=f;d.y=e;d.z=g;return d};h.prototype.unproject=function(b,d){if(!k(b))throw new l("cartesian is required");var e=this._oneOverSemimajorAxis,f=b.x*e,e=h.mercatorAngleToGeodeticLatitude(b.y*e),g=b.z;if(!k(d))return new a(f,e,g);d.longitude=f;d.latitude=e;d.height=g;return d};return h});F("Core/HeightmapTessellator","./AxisAlignedBoundingBox ./BoundingSphere ./Cartesian2 ./Cartesian3 ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./EllipsoidalOccluder ./freezeObject ./Math ./Matrix4 ./OrientedBoundingBox ./Rectangle ./TerrainEncoding ./Transforms ./WebMercatorProjection".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){var A={};A.DEFAULT_STRUCTURE=p({heightScale:1,heightOffset:0,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1});var z=new k,x=new q,D=new k,v=new k;A.computeVertices=function(p){if(!l(p)||!l(p.heightmap))throw new m("options.heightmap is required.");if(!l(p.width)||!l(p.height))throw new m("options.width and options.height are required.");if(!l(p.nativeRectangle))throw new m("options.nativeRectangle is required.");if(!l(p.skirtHeight))throw new m("options.skirtHeight is required.");var B=Math.cos,I=Math.sin,H=Math.sqrt,J=Math.atan,w=Math.exp,G=d.PI_OVER_TWO,E=d.toRadians,L=p.heightmap,K=p.width,P=p.height,N=p.skirtHeight,O=g(p.isGeographic,!0),Z=g(p.ellipsoid,e.WGS84),aa=1/Z.maximumRadius,U=p.nativeRectangle,W,M,R,Y,Q=p.rectangle;l(Q)?(W=Q.west,M=Q.south,R=Q.east,Y=Q.north):O?(W=E(U.west),M=E(U.south),R=E(U.east),Y=E(U.north)):(W=U.west*aa,M=G-2*J(w(-U.south*aa)),R=U.east*aa,Y=G-2*J(w(-U.north*aa)));var S=p.relativeToCenter,ca=l(S),S=ca?S:k.ZERO,T=g(p.exaggeration,1),da=g(p.includeWebMercatorT,!1);p=g(p.structure,A.DEFAULT_STRUCTURE);var V=g(p.heightScale,A.DEFAULT_STRUCTURE.heightScale),ba=g(p.heightOffset,A.DEFAULT_STRUCTURE.heightOffset),X=g(p.elementsPerHeight,A.DEFAULT_STRUCTURE.elementsPerHeight),fa=g(p.stride,A.DEFAULT_STRUCTURE.stride),ga=g(p.elementMultiplier,A.DEFAULT_STRUCTURE.elementMultiplier),ka=g(p.isBigEndian,A.DEFAULT_STRUCTURE.isBigEndian),F=r.computeWidth(U),ia=r.computeHeight(U),la=F/(K-1),ha=ia/(P-1);O||(F*=aa,ia*=aa);p=Z.radiiSquared;var pa=p.x,oa=p.y,qa=p.z;p=65536;var ua=-65536,ta=u.eastNorthUpToFixedFrame(S,Z),wa=q.inverseTransformation(ta,x),za,Da;da&&(za=y.geodeticLatitudeToMercatorAngle(M),Da=1/(y.geodeticLatitudeToMercatorAngle(Y)-za));D.x=Number.POSITIVE_INFINITY;D.y=Number.POSITIVE_INFINITY;D.z=Number.POSITIVE_INFINITY;v.x=Number.NEGATIVE_INFINITY;v.y=Number.NEGATIVE_INFINITY;v.z=Number.NEGATIVE_INFINITY;var Ba=Number.POSITIVE_INFINITY,ra=K+(0<N?2:0),Ea=P+(0<N?2:0),Ga=ra*Ea,Ca=Array(Ga),ya=Array(Ga),Aa=Array(Ga),Ua=da?Array(Ga):[],sa=0,Va=P,xa=0,Ha=K;0<N&&(--sa,++Va,--xa,++Ha);for(var Ma=0;sa<Va;++sa){var Ia=sa;0>Ia&&(Ia=0);Ia>=P&&(Ia=P-1);var La=U.north-ha*Ia,La=O?E(La):G-2*J(w(-La*aa)),Fa=B(La),Ja=I(La),Qa=qa*Ja,va=(La-M)/(Y-M),va=d.clamp(va,0,1),Sa;da&&(Sa=(y.geodeticLatitudeToMercatorAngle(La)-za)*Da);for(var Oa=xa;Oa<Ha;++Oa){var Ta=Oa;0>Ta&&(Ta=0);Ta>=K&&(Ta=K-1);var Ka=U.west+la*Ta,Ka=O?E(Ka):Ka*aa,Wa=Ia*K*fa+Ta*fa,Ra;if(1===X)Ra=L[Wa];else{Ra=0;var Nb;if(ka)for(Nb=0;Nb<X;++Nb)Ra=Ra*ga+L[Wa+Nb];else for(Nb=X-1;0<=Nb;--Nb)Ra=Ra*ga+L[Wa+Nb]}Ra=(Ra*V+ba)*T;Wa=(Ka-W)/(R-W);Wa=d.clamp(Wa,0,1);Aa[Ma]=new f(Wa,va);ua=Math.max(ua,Ra);p=Math.min(p,Ra);if(Oa!==Ta||sa!==Ia)Fa=1E-5,0===N&&(Fa=0),Ka=0>Oa?Ka-Fa*F:Ka+Fa*F,La=0>sa?La+Fa*ia:La-Fa*ia,Fa=B(La),Ja=I(La),Qa=qa*Ja,Ra-=N;var Ta=Fa*B(Ka),Ka=Fa*I(Ka),Wa=pa*Ta,hb=oa*Ka;Nb=1/H(Wa*Ta+hb*Ka+Qa*Ja);Wa*=Nb;hb*=Nb;Nb*=Qa;var Hb=new k;Hb.x=Wa+Ta*Ra;Hb.y=hb+Ka*Ra;Hb.z=Nb+Ja*Ra;Ca[Ma]=Hb;ya[Ma]=Ra;da&&(Ua[Ma]=Sa);Ma++;q.multiplyByPoint(wa,Hb,z);k.minimumByComponent(z,D,D);k.maximumByComponent(z,v,v);Ba=Math.min(Ba,Ra)}}var B=a.fromPoints(Ca),db;l(Q)&&Q.width<d.PI_OVER_TWO+d.EPSILON5&&(db=t.fromRectangle(Q,p,ua,Z));var tb;ca&&(tb=(new h(Z)).computeHorizonCullingPoint(S,Ca));Z=new b(D,v,S);da=new c(Z,Ba,ua,ta,!1,da);Z=new Float32Array(Ga*da.getStride());for(S=Q=0;S<Ga;++S)Q=da.encode(Z,Q,Ca[S],Aa[S],ya[S],void 0,Ua[S]);if(0<N){Ga=[];N=[];for(Ca=0;Ca<K;++Ca)Ga.push(ra+1+Ca),N.push(ra*(Ea-1)-2-Ca);Ea=[];Ca=[];for(ya=0;ya<P;++ya)Ca.push((ya+1)*ra+K),Ea.push((P-ya)*ra+1)}else{Ga=[];N=[];for(ra=0;ra<K;++ra)Ga.push(ra),N.push(K*P-1-ra);Ea=[];Ca=[];for(ra=0;ra<P;++ra)Ca.push((ra+1)*K-1),Ea.push((P-ra-1)*K)}return{vertices:Z,maximumHeight:ua,minimumHeight:p,encoding:da,boundingSphere3D:B,orientedBoundingBox:db,occludeePointInScaledSpace:tb,westIndicesSouthToNorth:Ea,southIndicesEastToWest:N,eastIndicesNorthToSouth:Ca,northIndicesWestToEast:Ga}};return A});F("Core/destroyObject",["./defaultValue","./DeveloperError"],function(b,a){function f(){return!0}return function(k,g){function l(){throw new a(g);}g=b(g,"This object was destroyed, i.e., destroy() was called.");for(var m in k)"function"===typeof k[m]&&(k[m]=l);k.isDestroyed=f}});F("Core/TaskProcessor","../ThirdParty/when ./buildModuleUrl ./defaultValue ./defined ./destroyObject ./DeveloperError ./Event ./FeatureDetection ./getAbsoluteUri ./isCrossOriginUrl ./Resource ./RuntimeError require".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(){if(!k(z._canTransferArrayBuffer)){var c=new Worker(u("Workers/transferTypedArrayTest.js"));c.postMessage=f(c.webkitPostMessage,c.postMessage);var a=new Int8Array([99]);try{c.postMessage({array:a},[a.buffer])}catch(H){return z._canTransferArrayBuffer=!1,z._canTransferArrayBuffer}var d=b.defer();c.onmessage=function(a){a=a.data.array;a=k(a)&&99===a[0];d.resolve(a);c.terminate();z._canTransferArrayBuffer=a};z._canTransferArrayBuffer=d.promise}return z._canTransferArrayBuffer}function c(c,a){--c._activeTasks;var b=a.id;if(k(b)){var d=c._deferreds,e=d[b];if(k(a.error)){var f=a.error;"RuntimeError"===f.name?(f=new q(a.error.message),f.stack=a.error.stack):"DeveloperError"===f.name&&(f=new l(a.error.message),f.stack=a.error.stack);x.raiseEvent(f);e.reject(f)}else x.raiseEvent(),e.resolve(a.result);delete d[b]}}function u(c){c=a(c);if(p(c)){c='importScripts("'+c+'");';var b;try{b=new Blob([c],{type:"application/javascript"})}catch(I){b=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder),b.append(c),b=b.getBlob("application/javascript")}c=(window.URL||window.webkitURL).createObjectURL(b)}return c}function y(b){var d=Worker;k(D)||(D=u("Workers/cesiumWorkerBootstrapper.js"));d=new d(D);d.postMessage=f(d.webkitPostMessage,d.postMessage);var e={loaderConfig:{},workerModule:z._workerModulePrefix+b._workerName};k(z._loaderConfig)?e.loaderConfig=z._loaderConfig:(k(F.amd)&&!F.amd.toUrlUndefined&&k(t.toUrl)||(e.loaderConfig.paths={Workers:a("Workers")}),e.loaderConfig.baseUrl=a.getCesiumBaseUrl().url);d.postMessage(e);d.onmessage=function(a){c(b,a.data)};return d}function A(c,f){var h={modulePath:void 0,wasmBinaryFile:void 0,wasmBinary:void 0};if(!e.supportsWebAssembly()){if(!k(f.fallbackModulePath))throw new q("This browser does not support Web Assembly, and no backup module was provided for "+c._workerName);h.modulePath=a(f.fallbackModulePath);return b.resolve(h)}h.modulePath=a(f.modulePath);h.wasmBinaryFile=a(f.wasmBinaryFile);return d.fetchArrayBuffer({url:h.wasmBinaryFile}).then(function(c){h.wasmBinary=c;return h})}function z(c,a){this._workerName=c;this._maximumActiveTasks=f(a,5);this._activeTasks=0;this._deferreds={};this._nextID=0}var x=new m,D,v=[];z.prototype.scheduleTask=function(c,a){k(this._worker)||(this._worker=y(this));if(!(this._activeTasks>=this._maximumActiveTasks)){++this._activeTasks;var d=this;return b(r(),function(e){k(a)?e||(a.length=0):a=v;var f=d._nextID++,h=b.defer();d._deferreds[f]=h;d._worker.postMessage({id:f,parameters:c,canTransferArrayBuffer:e},a);return h.promise})}};z.prototype.initWebAssemblyModule=function(a){k(this._worker)||(this._worker=y(this));var d=b.defer(),e=this,f=this._worker;A(this,a).then(function(a){return b(r(),function(b){var h,g=a.wasmBinary;k(g)&&b&&(h=[g]);f.onmessage=function(a){f.onmessage=function(a){c(e,a.data)};d.resolve(a.data)};f.postMessage({webAssemblyConfig:a},h)})});return d};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){k(this._worker)&&this._worker.terminate();return g(this)};z.taskCompletedEvent=x;z._defaultWorkerModulePrefix="Workers/";z._workerModulePrefix=z._defaultWorkerModulePrefix;z._loaderConfig=void 0;z._canTransferArrayBuffer=void 0;return z});F("Core/TerrainMesh",["./Cartesian3","./defaultValue"],function(b,a){return function(b,k,g,l,m,e,h,p,d,q,t,r,c,u,y){this.center=b;this.vertices=k;this.stride=a(p,6);this.indices=g;this.minimumHeight=l;this.maximumHeight=m;this.boundingSphere3D=e;this.occludeePointInScaledSpace=h;this.orientedBoundingBox=d;this.encoding=q;this.exaggeration=t;this.westIndicesSouthToNorth=r;this.southIndicesEastToWest=c;this.eastIndicesNorthToSouth=u;this.northIndicesWestToEast=y}});F("Core/TerrainProvider",["./defined","./defineProperties","./DeveloperError","./Math"],function(b,a,f,k){function g(){f.throwInstantiationError()}a(g.prototype,{errorEvent:{get:f.throwInstantiationError},credit:{get:f.throwInstantiationError},tilingScheme:{get:f.throwInstantiationError},ready:{get:f.throwInstantiationError},readyPromise:{get:f.throwInstantiationError},hasWaterMask:{get:f.throwInstantiationError},hasVertexNormals:{get:f.throwInstantiationError},availability:{get:f.throwInstantiationError}});var l=[];g.getRegularGridIndices=function(a,e){if(a*e>=k.FOUR_GIGABYTES)throw new f("The total number of vertices (width * height) must be less than 4,294,967,295.");var h=l[a];b(h)||(l[a]=h=[]);var g=h[e];if(!b(g))for(var g=a*e<k.SIXTY_FOUR_KILOBYTES?h[e]=new Uint16Array((a-1)*(e-1)*6):h[e]=new Uint32Array((a-1)*(e-1)*6),d=h=0,m=0;m<e-1;++m){for(var t=0;t<a-1;++t){var r=h,c=r+a,u=c+1,y=r+1;g[d++]=r;g[d++]=c;g[d++]=y;g[d++]=y;g[d++]=c;g[d++]=u;++h}++h}return g};g.heightmapTerrainQuality=.25;g.getEstimatedLevelZeroGeometricErrorForAHeightmap=function(a,b,f){return 2*a.maximumRadius*Math.PI*g.heightmapTerrainQuality/(b*f)};g.prototype.requestTileGeometry=f.throwInstantiationError;g.prototype.getLevelMaximumGeometricError=f.throwInstantiationError;g.prototype.getTileDataAvailable=f.throwInstantiationError;g.prototype.loadTileDataAvailability=f.throwInstantiationError;return g});F("Core/HeightmapTerrainData","../ThirdParty/when ./BoundingSphere ./Cartesian3 ./defaultValue ./defined ./defineProperties ./DeveloperError ./GeographicProjection ./HeightmapEncoding ./HeightmapTessellator ./OrientedBoundingBox ./Math ./Rectangle ./TaskProcessor ./TerrainEncoding ./TerrainMesh ./TerrainProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(c){if(!g(c)||!g(c.buffer))throw new m("options.buffer is required.");if(!g(c.width))throw new m("options.width is required.");if(!g(c.height))throw new m("options.height is required.");this._buffer=c.buffer;this._width=c.width;this._height=c.height;this._childTileMask=k(c.childTileMask,15);this._encoding=k(c.encoding,h.NONE);var a=p.DEFAULT_STRUCTURE,b=c.structure;g(b)?b!==a&&(b.heightScale=k(b.heightScale,a.heightScale),b.heightOffset=k(b.heightOffset,a.heightOffset),b.elementsPerHeight=k(b.elementsPerHeight,a.elementsPerHeight),b.stride=k(b.stride,a.stride),b.elementMultiplier=k(b.elementMultiplier,a.elementMultiplier),b.isBigEndian=k(b.isBigEndian,a.isBigEndian)):b=a;this._structure=b;this._createdByUpsampling=k(c.createdByUpsampling,!1);this._waterMask=c.waterMask;this._skirtHeight=void 0;this._bufferType=this._encoding===h.LERC?Float32Array:this._buffer.constructor;this._mesh=void 0}function z(c,a,b,d,e,f,h,g,k,l,p){var m=(k-f.west)*(h-1)/(f.east-f.west),q=(l-f.south)*(g-1)/(f.north-f.south);0<e&&(m+=1,q+=1,h+=2,g+=2);k=m|0;f=k+1;f>=(0<e?h-1:h)&&(f=h-1,k=h-2);var v=q|0;l=v+1;l>=(0<e?g-1:g)&&(l=g-1,v=g-2);e=m-k;m=q-v;v=g-1-v;l=g-1-l;g=(a.decodeHeight(c,v*h+k)/p-b)/d;v=(a.decodeHeight(c,v*h+f)/p-b)/d;k=(a.decodeHeight(c,l*h+k)/p-b)/d;c=(a.decodeHeight(c,l*h+f)/p-b)/d;return m<e?g+e*(v-g)+m*(c-v):g+e*(c-k)+m*(k-g)}function x(c,a,b,d,e,f){f*=d;d=0;if(e)for(e=0;e<a;++e)d=d*b+c[f+e];else for(e=a-1;0<=e;--e)d=d*b+c[f+e];return d}l(A.prototype,{credits:{get:function(){}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}}});var D=new r("createVerticesFromHeightmap");A.prototype.createMesh=function(h,l,p,q,r,z){if(!g(h))throw new m("tilingScheme is required.");if(!g(l))throw new m("x is required.");if(!g(p))throw new m("y is required.");if(!g(q))throw new m("level is required.");var v=h.ellipsoid,B=h.tileXYToNativeRectangle(l,p,q);l=h.tileXYToRectangle(l,p,q);r=k(r,1);var C=v.cartographicToCartesian(t.center(l));p=this._structure;q=y.getEstimatedLevelZeroGeometricErrorForAHeightmap(v,this._width,h.getNumberOfXTilesAtLevel(0))/(1<<q);g(z)&&z?this._skirtHeight=0:this._skirtHeight=Math.min(4*q,1E3);h=D.scheduleTask({heightmap:this._buffer,structure:p,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:B,rectangle:l,relativeToCenter:C,ellipsoid:v,skirtHeight:this._skirtHeight,isGeographic:h.projection instanceof e,exaggeration:r,encoding:this._encoding});if(g(h)){var x=this;return b(h,function(b){x._mesh=new u(C,new Float32Array(b.vertices),y.getRegularGridIndices(b.gridWidth,b.gridHeight),b.minimumHeight,b.maximumHeight,a.clone(b.boundingSphere3D),f.clone(b.occludeePointInScaledSpace),b.numberOfAttributes,d.clone(b.orientedBoundingBox),c.clone(b.encoding),r,b.westIndicesSouthToNorth,b.southIndicesEastToWest,b.eastIndicesNorthToSouth,b.northIndicesWestToEast);x._buffer=void 0;return x._mesh})}};A.prototype._createMeshSync=function(c,a,b,d,f,h){if(!g(c))throw new m("tilingScheme is required.");if(!g(a))throw new m("x is required.");if(!g(b))throw new m("y is required.");if(!g(d))throw new m("level is required.");var l=c.ellipsoid,q=c.tileXYToNativeRectangle(a,b,d);b=c.tileXYToRectangle(a,b,d);f=k(f,1);a=l.cartographicToCartesian(t.center(b));var v=this._structure;d=y.getEstimatedLevelZeroGeometricErrorForAHeightmap(l,this._width,c.getNumberOfXTilesAtLevel(0))/(1<<d);g(h)&&h?this._skirtHeight=0:this._skirtHeight=Math.min(4*d,1E3);c=p.computeVertices({heightmap:this._buffer,structure:v,includeWebMercatorT:!0,width:this._width,height:this._height,nativeRectangle:q,rectangle:b,relativeToCenter:a,ellipsoid:l,skirtHeight:this._skirtHeight,isGeographic:c.projection instanceof e,exaggeration:f});this._buffer=void 0;h=this._width;l=this._height;0<this._skirtHeight&&(h+=2,l+=2);return new u(a,c.vertices,y.getRegularGridIndices(h,l),c.minimumHeight,c.maximumHeight,c.boundingSphere3D,c.occludeePointInScaledSpace,c.encoding.getStride(),c.orientedBoundingBox,c.encoding,f,c.westIndicesSouthToNorth,c.southIndicesEastToWest,c.eastIndicesNorthToSouth,c.northIndicesWestToEast)};A.prototype.interpolateHeight=function(c,a,b){var d=this._width,e=this._height,f=this._structure,h=f.stride,k=f.elementsPerHeight,l=f.elementMultiplier,p=f.isBigEndian,m=f.heightOffset,f=f.heightScale;if(g(this._mesh))m=z(this._mesh.vertices,this._mesh.encoding,m,f,this._skirtHeight,c,d,e,a,b,this._mesh.exaggeration);else{var q=this._buffer;a=(a-c.west)*(d-1)/(c.east-c.west);var v=(b-c.south)*(e-1)/(c.north-c.south),B=a|0;c=B+1;c>=d&&(c=d-1,B=d-2);var r=v|0;b=r+1;b>=e&&(b=e-1,r=e-2);a-=B;v-=r;r=e-1-r;b=e-1-b;e=x(q,k,l,h,p,r*d+B);r=x(q,k,l,h,p,r*d+c);B=x(q,k,l,h,p,b*d+B);d=x(q,k,l,h,p,b*d+c);m=(v<a?e+a*(r-e)+v*(d-r):e+a*(d-B)+v*(B-e))*f+m}return m};A.prototype.upsample=function(c,a,b,d,e,f,h){if(!g(c))throw new m("tilingScheme is required.");if(!g(a))throw new m("thisX is required.");if(!g(b))throw new m("thisY is required.");if(!g(d))throw new m("thisLevel is required.");if(!g(e))throw new m("descendantX is required.");if(!g(f))throw new m("descendantY is required.");if(!g(h))throw new m("descendantLevel is required.");if(1<h-d)throw new m("Upsampling through more than one level at a time is not currently supported.");var k=this._mesh;if(g(k)){var l=this._width,p=this._height,v=this._structure,w=this._skirtHeight,B=v.stride,r=new this._bufferType(l*p*B),u=k.vertices,C=k.encoding;a=c.tileXYToRectangle(a,b,d);c=c.tileXYToRectangle(e,f,h);e=v.heightOffset;f=v.heightScale;k=k.exaggeration;h=v.elementsPerHeight;b=v.elementMultiplier;d=v.isBigEndian;for(var y=Math.pow(b,h-1),t=0;t<p;++t)for(var D=q.lerp(c.north,c.south,t/(p-1)),x=0;x<l;++x){var I=q.lerp(c.west,c.east,x/(l-1)),H=z(u,C,e,f,w,a,l,p,I,D,k),H=H<v.lowestEncodedHeight?v.lowestEncodedHeight:H,H=H>v.highestEncodedHeight?v.highestEncodedHeight:H,I=r,J=h,ca=b,T=y,da=t*l+x,da=da*B,V;if(d)for(V=0;V<J-1;++V)I[da+V]=H/T|0,H-=I[da+V]*T,T/=ca;else for(V=J-1;0<V;--V)I[da+V]=H/T|0,H-=I[da+V]*T,T/=ca;I[da+V]=H}return new A({buffer:r,width:l,height:p,childTileMask:0,structure:this._structure,createdByUpsampling:!0})}};A.prototype.isChildAvailable=function(c,a,b,d){if(!g(c))throw new m("thisX is required.");if(!g(a))throw new m("thisY is required.");if(!g(b))throw new m("childX is required.");if(!g(d))throw new m("childY is required.");var e=2;b!==2*c&&++e;d!==2*a&&(e-=2);return 0!==(this._childTileMask&1<<e)};A.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};return A});F("Core/TileAvailability","./binarySearch ./Cartographic ./defined ./defineProperties ./DeveloperError ./Rectangle".split(" "),function(b,a,f,k,g,l){function m(c,a){this._tilingScheme=c;this._maximumLevel=a;this._rootNodes=[]}function e(c,a,b,d,e){this.tilingScheme=c;this.parent=a;this.level=b;this.x=d;this.y=e;this.extent=c.tileXYToRectangle(d,e,b);this.rectangles=[];this._ne=this._nw=this._se=this._sw=void 0}function h(c,a,b,d,e){this.level=c;this.west=a;this.south=b;this.east=d;this.north=e}function p(c,a){var b=Math.max(c.west,a.west),d=Math.min(c.east,a.east);return Math.max(c.south,a.south)<Math.min(c.north,a.north)&&b<d}function d(c,a){return c.level-a}function q(c,a){return a.west>=c.west&&a.east<=c.east&&a.south>=c.south&&a.north<=c.north}function t(c,a){return a.longitude>=c.west&&a.longitude<=c.east&&a.latitude>=c.south&&a.latitude<=c.north}function r(c,a,b){for(var d=0,e=!1;!e;){var f=a._nw&&t(a._nw.extent,b),h=a._ne&&t(a._ne.extent,b),g=a._sw&&t(a._sw.extent,b),k=a._se&&t(a._se.extent,b);if(1<f+h+g+k){f&&(d=Math.max(d,r(a,a._nw,b)));h&&(d=Math.max(d,r(a,a._ne,b)));g&&(d=Math.max(d,r(a,a._sw,b)));k&&(d=Math.max(d,r(a,a._se,b)));break}else f?a=a._nw:h?a=a._ne:g?a=a._sw:k?a=a._se:e=!0}for(;a!==c;){e=a.rectangles;for(f=e.length-1;0<=f&&e[f].level>d;--f)h=e[f],t(h,b)&&(d=h.level);a=a.parent}return d}function c(a,b,d){if(b){var e,f=!1;for(e=0;e<d.length;++e)f=f||p(b.extent,d[e]);if(f){f=b.rectangles;for(e=0;e<f.length;++e){var h=f[e];a[h.level]||(a[h.level]=d);for(var g=h.level,k=a[h.level],m=[],q=0;q<k.length;++q){var v=k[q];p(v,h)?(v.west<h.west&&m.push(new l(v.west,v.south,h.west,v.north)),v.east>h.east&&m.push(new l(h.east,v.south,v.east,v.north)),v.south<h.south&&m.push(new l(Math.max(h.west,v.west),v.south,Math.min(h.east,v.east),h.south)),v.north>h.north&&m.push(new l(Math.max(h.west,v.west),h.north,Math.min(h.east,v.east),v.north))):m.push(v)}a[g]=m}c(a,b._nw,d);c(a,b._ne,d);c(a,b._sw,d);c(a,b._se,d)}}}var u=new l;m.prototype.addAvailableTileRange=function(c,a,f,g,k){var l=this._tilingScheme,m=this._rootNodes;if(0===c)for(var v=f;v<=k;++v)for(var r=a;r<=g;++r){var B;a:{B=m.length;for(var C=0;C<B;++C){var z=m[C];if(z.x===r&&z.y===v&&z.level===c){B=!0;break a}}B=!1}B||m.push(new e(l,void 0,0,r,v))}l.tileXYToRectangle(a,f,c,u);a=u.west;f=u.north;l.tileXYToRectangle(g,k,c,u);c=new h(c,a,u.south,u.east,f);for(g=0;g<m.length;++g)if(l=m[g],p(l.extent,c)){k=this._maximumLevel;for(a=c;l.level<k;)if(q(l.nw.extent,a))l=l.nw;else if(q(l.ne.extent,a))l=l.ne;else if(q(l.sw.extent,a))l=l.sw;else if(q(l.se.extent,a))l=l.se;else break;0===l.rectangles.length||l.rectangles[l.rectangles.length-1].level<=a.level?l.rectangles.push(a):(k=b(l.rectangles,a.level,d),0>=k&&(k=~k),l.rectangles.splice(k,0,a))}};m.prototype.computeMaximumLevelAtPosition=function(c){for(var a,b=0;b<this._rootNodes.length;++b){var d=this._rootNodes[b];if(t(d.extent,c)){a=d;break}}return f(a)?r(void 0,a,c):-1};var y=[],A=[],z=new l,x=new l;m.prototype.computeBestAvailableLevelOverRectangle=function(a){y.length=0;a.east<a.west?(y.push(l.fromRadians(-Math.PI,a.south,a.east,a.north,z)),y.push(l.fromRadians(a.west,a.south,Math.PI,a.north,x))):y.push(a);for(a=A.length=0;a<this._rootNodes.length;++a)c(A,this._rootNodes[a],y);for(a=A.length-1;0<=a;--a)if(f(A[a])&&0===A[a].length)return a;return 0};var D=new a;m.prototype.isTileAvailable=function(c,a,b){a=this._tilingScheme.tileXYToRectangle(a,b,c,u);l.center(a,D);return this.computeMaximumLevelAtPosition(D)>=c};m.prototype.computeChildMaskForTile=function(c,a,b){c+=1;if(c>=this._maximumLevel)return 0;var d;d=0|(this.isTileAvailable(c,2*a,2*b+1)?1:0);d|=this.isTileAvailable(c,2*a+1,2*b+1)?2:0;d|=this.isTileAvailable(c,2*a,2*b)?4:0;return d|=this.isTileAvailable(c,2*a+1,2*b)?8:0};k(e.prototype,{nw:{get:function(){this._nw||(this._nw=new e(this.tilingScheme,this,this.level+1,2*this.x,2*this.y));return this._nw}},ne:{get:function(){this._ne||(this._ne=new e(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y));return this._ne}},sw:{get:function(){this._sw||(this._sw=new e(this.tilingScheme,this,this.level+1,2*this.x,2*this.y+1));return this._sw}},se:{get:function(){this._se||(this._se=new e(this.tilingScheme,this,this.level+1,2*this.x+1,2*this.y+1));return this._se}}});return m});F("Core/formatError",["./defined"],function(b){return function(a){var f;f=a.name;var k=a.message;f=b(f)&&b(k)?f+": "+k:a.toString();a=a.stack;b(a)&&(f+="\n"+a);return f}});F("Core/TileProviderError",["./defaultValue","./defined","./formatError"],function(b,a,f){function k(a,f,k,e,h,p,d){this.provider=a;this.message=f;this.x=k;this.y=e;this.level=h;this.timesRetried=b(p,0);this.retry=!1;this.error=d}k.handleError=function(b,f,m,e,h,p,d,q,t){var g=b;a(b)?(g.provider=f,g.message=e,g.x=h,g.y=p,g.level=d,g.retry=!1,g.error=t,++g.timesRetried):g=new k(f,e,h,p,d,0,t);0<m.numberOfListeners&&m.raiseEvent(g);g.retry&&a(q)&&q();return g};k.handleSuccess=function(b){a(b)&&(b.timesRetried=-1)};return k});F("Core/WebMercatorTilingScheme","./Cartesian2 ./defaultValue ./defined ./defineProperties ./Ellipsoid ./Rectangle ./WebMercatorProjection".split(" "),function(b,a,f,k,g,l,m){function e(e){e=a(e,{});this._ellipsoid=a(e.ellipsoid,g.WGS84);this._numberOfLevelZeroTilesX=a(e.numberOfLevelZeroTilesX,1);this._numberOfLevelZeroTilesY=a(e.numberOfLevelZeroTilesY,1);this._projection=new m(this._ellipsoid);f(e.rectangleSouthwestInMeters)&&f(e.rectangleNortheastInMeters)?(this._rectangleSouthwestInMeters=e.rectangleSouthwestInMeters,this._rectangleNortheastInMeters=e.rectangleNortheastInMeters):(e=this._ellipsoid.maximumRadius*Math.PI,this._rectangleSouthwestInMeters=new b(-e,-e),this._rectangleNortheastInMeters=new b(e,e));e=this._projection.unproject(this._rectangleSouthwestInMeters);var h=this._projection.unproject(this._rectangleNortheastInMeters);this._rectangle=new l(e.longitude,e.latitude,h.longitude,h.latitude)}k(e.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},rectangle:{get:function(){return this._rectangle}},projection:{get:function(){return this._projection}}});e.prototype.getNumberOfXTilesAtLevel=function(a){return this._numberOfLevelZeroTilesX<<a};e.prototype.getNumberOfYTilesAtLevel=function(a){return this._numberOfLevelZeroTilesY<<a};e.prototype.rectangleToNativeRectangle=function(a,b){var d=this._projection,e=d.project(l.southwest(a)),d=d.project(l.northeast(a));if(!f(b))return new l(e.x,e.y,d.x,d.y);b.west=e.x;b.south=e.y;b.east=d.x;b.north=d.y;return b};e.prototype.tileXYToNativeRectangle=function(a,b,d,e){var h=this.getNumberOfXTilesAtLevel(d);d=this.getNumberOfYTilesAtLevel(d);var g=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/h,h=this._rectangleSouthwestInMeters.x+a*g;a=this._rectangleSouthwestInMeters.x+(a+1)*g;g=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/d;d=this._rectangleNortheastInMeters.y-b*g;b=this._rectangleNortheastInMeters.y-(b+1)*g;if(!f(e))return new l(h,b,a,d);e.west=h;e.south=b;e.east=a;e.north=d;return e};e.prototype.tileXYToRectangle=function(a,e,d,f){a=this.tileXYToNativeRectangle(a,e,d,f);d=this._projection;e=d.unproject(new b(a.west,a.south));d=d.unproject(new b(a.east,a.north));a.west=e.longitude;a.south=e.latitude;a.east=d.longitude;a.north=d.latitude;return a};e.prototype.positionToTileXY=function(a,e,d){if(l.contains(this._rectangle,a)){var h=this.getNumberOfXTilesAtLevel(e);e=this.getNumberOfYTilesAtLevel(e);var g=(this._rectangleNortheastInMeters.x-this._rectangleSouthwestInMeters.x)/h,k=(this._rectangleNortheastInMeters.y-this._rectangleSouthwestInMeters.y)/e,c=this._projection.project(a);a=this._rectangleNortheastInMeters.y-c.y;g=(c.x-this._rectangleSouthwestInMeters.x)/g|0;g>=h&&(g=h-1);h=a/k|0;h>=e&&(h=e-1);if(!f(d))return new b(g,h);d.x=g;d.y=h;return d}};return e});F("Core/ArcGISTiledElevationTerrainProvider","../ThirdParty/when ./Cartesian2 ./Credit ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./Event ./GeographicTilingScheme ./HeightmapEncoding ./HeightmapTerrainData ./Rectangle ./Request ./RequestState ./RequestType ./Resource ./RuntimeError ./TerrainProvider ./TileAvailability ./TileProviderError ./WebMercatorTilingScheme".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v){function B(c){if(!g(c)||!g(c.url))throw new m("options.url is required.");this._terrainDataStructure=this._maxLevel=this._levelZeroMaximumGeometricError=this._tilingScheme=this._credit=this._resource=void 0;this._ready=!1;this._encoding=this._height=this._width=void 0;var l=c.token;this._hasAvailability=!1;this._tilesAvailablityLoaded=this._tilesAvailable=void 0;this._availableCache={};var q=this,w=k(c.ellipsoid,e.WGS84);this._readyPromise=b(c.url).then(function(c){c=y.createIfNeeded(c);c.appendForwardSlash();g(l)&&(c=c.getDerivedResource({queryParameters:{token:l}}));q._resource=c;return c.getDerivedResource({queryParameters:{f:"pjson"}}).fetchJson()}).then(function(c){var e=c.copyrightText;g(e)&&(q._credit=new f(e));var e=c.spatialReference,e=k(e.latestWkid,e.wkid),h=c.extent,l={ellipsoid:w};if(4326===e)l.rectangle=t.fromDegrees(h.xmin,h.ymin,h.xmax,h.ymax),q._tilingScheme=new p(l);else if(3857===e)l.rectangleSouthwestInMeters=new a(h.xmin,h.ymin),l.rectangleNortheastInMeters=new a(h.xmax,h.ymax),q._tilingScheme=new v(l);else return b.reject(new A("Invalid spatial reference"));e=c.tileInfo;if(!g(e))return b.reject(new A("tileInfo is required"));q._width=e.rows+1;q._height=e.cols+1;q._encoding="LERC"===e.format?d.LERC:d.NONE;q._lodCount=e.lods.length-1;if(q._hasAvailability=-1!==c.capabilities.indexOf("Tilemap"))q._tilesAvailable=new x(q._tilingScheme,q._lodCount),q._tilesAvailable.addAvailableTileRange(0,0,0,q._tilingScheme.getNumberOfXTilesAtLevel(0),q._tilingScheme.getNumberOfYTilesAtLevel(0)),q._tilesAvailablityLoaded=new x(q._tilingScheme,q._lodCount);q._levelZeroMaximumGeometricError=z.getEstimatedLevelZeroGeometricErrorForAHeightmap(q._tilingScheme.ellipsoid,q._width,q._tilingScheme.getNumberOfXTilesAtLevel(0));1<c.bandCount&&console.log("ArcGISTiledElevationTerrainProvider: Terrain data has more than 1 band. Using the first one.");q._terrainDataStructure={elementMultiplier:1,lowestEncodedHeight:c.minValues[0],highestEncodedHeight:c.maxValues[0]};return q._ready=!0}).otherwise(function(c){D.handleError(void 0,q,q._errorEvent,"An error occurred while accessing "+q._resource.url+".");return b.reject(c)});this._errorEvent=new h}function C(c,a,b,d){if(c._hasAvailability){var e=c._tilesAvailablityLoaded;if(a>c._lodCount)return!1;if(c._tilesAvailable.isTileAvailable(a,b,d))return!0;if(e.isTileAvailable(a,b,d))return!1}}function I(c,b,d,e){var f=b-1;--d;for(var h=e[c.y*b+c.x],g=[],k={startX:c.x,startY:c.y,endX:0,endY:0},l=new a(c.x+1,c.y+1),p=!1,m=!1;!p||!m;){var q=l.x,v=m?l.y+1:l.y;if(!p){for(var w=c.y;w<v;++w)if(e[w*b+l.x]!==h){p=!0;break}p?(g.push(new a(l.x,c.y)),--l.x,--q,k.endX=l.x):l.x===f?(k.endX=l.x,p=!0):++l.x}if(!m){v=l.y*b;for(w=c.x;w<=q;++w)if(e[v+w]!==h){m=!0;break}m?(g.push(new a(c.x,l.y)),--l.y,k.endY=l.y):l.y===d?(k.endY=l.y,m=!0):++l.y}}return{endingIndices:g,range:k,value:h}}function H(c,b,d,e,f){var h=[];if(f.every(function(c){return c===f[0]}))return 1===f[0]&&h.push({startX:c,startY:b,endX:c+d-1,endY:b+e-1}),h;for(var g=[new a(0,0)];0<g.length;){var k=g.pop(),k=I(k,d,e,f);if(1===k.value){var l=k.range;l.startX+=c;l.endX+=c;l.startY+=b;l.endY+=b;h.push(l)}k=k.endingIndices;0<k.length&&(g=g.concat(k))}return h}function J(c,a,b,d){if(!c._hasAvailability)return{};var e=128*Math.floor(b/128),f=128*Math.floor(d/128),h=Math.min(1<<a,128),k="tilemap/"+a+"/"+f+"/"+e+"/"+h+"/"+h,l=c._availableCache;if(g(l[k]))return l[k];var p=new r({throttle:!0,throttleByServer:!0,type:u.TERRAIN}),m=c._resource.getDerivedResource({url:k,request:p}).fetchJson();if(!g(m))return{};m=m.then(function(g){g=H(e,f,h,h,g.data);c._tilesAvailablityLoaded.addAvailableTileRange(e,f,e+h,f+h);for(var k=c._tilesAvailable,l=0;l<g.length;++l){var p=g[l];k.addAvailableTileRange(a,p.startX,p.startY,p.endX,p.endY)}return C(c,a,b,d)});l[k]={promise:m,request:p};m=m.always(function(c){delete l[k];return c});return{promise:m,request:p}}l(B.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this.ready)throw new m("credit must not be called before ready returns true.");return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new m("tilingScheme must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}});B.prototype.requestTileGeometry=function(a,d,e,f){if(!this._ready)throw new m("requestTileGeometry must not be called before the terrain provider is ready.");var h=this._resource.getDerivedResource({url:"tile/"+e+"/"+d+"/"+a,request:f}),k=this._hasAvailability,l=b.resolve(!0),p;if(k&&!g(C(this,e+1,2*a,2*d))){var v=J(this,e+1,2*a,2*d),l=v.promise;p=v.request}h=h.fetchArrayBuffer();if(g(h)&&g(l)){var w=this,r=this._tilesAvailable;return b.join(h,l).then(function(c){return new q({buffer:c[0],width:w._width,height:w._height,childTileMask:k?r.computeChildMaskForTile(e,a,d):15,structure:w._terrainDataStructure,encoding:w._encoding})}).otherwise(function(a){return g(p)&&p.state===c.CANCELLED?(f.cancel(),f.deferred.promise.always(function(){f.state=c.CANCELLED;return b.reject(a)})):b.reject(a)})}};B.prototype.getLevelMaximumGeometricError=function(c){if(!this.ready)throw new m("getLevelMaximumGeometricError must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<c)};B.prototype.getTileDataAvailable=function(c,a,b){if(this._hasAvailability){var d=C(this,b,c,a);if(g(d))return d;J(this,b,c,a)}};B.prototype.loadTileDataAvailability=function(c,a,b){};return B});F("Core/ArcType",["./freezeObject"],function(b){return b({NONE:0,GEODESIC:1,RHUMB:2})});F("Core/arrayFill",["./Check","./defaultValue","./defined"],function(b,a,f){return function(k,g,l,m){b.defined("array",k);b.defined("value",g);f(l)&&b.typeOf.number("start",l);f(m)&&b.typeOf.number("end",m);if("function"===typeof k.fill)return k.fill(g,l,m);var e=k.length>>>0;l=a(l,0);l=0>l?Math.max(e+l,0):Math.min(l,e);m=a(m,e);for(e=0>m?Math.max(e+m,0):Math.min(m,e);l<e;)k[l]=g,l++;return k}});F("Core/arrayRemoveDuplicates",["./Check","./defaultValue","./defined","./Math"],function(b,a,f,k){var g=k.EPSILON10;return function(k,m,e){b.defined("equalsEpsilon",m);if(f(k)){e=a(e,!1);var h=k.length;if(2>h)return k;var l,d,q;for(l=1;l<h&&(d=k[l-1],q=k[l],!m(d,q,g));++l);if(l===h)return e&&m(k[0],k[k.length-1],g)?k.slice(1):k;for(var t=k.slice(0,l);l<h;++l)q=k[l],m(d,q,g)||(t.push(q),d=q);e&&1<t.length&&m(t[0],t[t.length-1],g)&&t.shift();return t}}});F("Core/arraySlice",["./Check","./defined","./FeatureDetection"],function(b,a,f){return function(k,g,l){b.defined("array",k);a(g)&&b.typeOf.number("begin",g);a(l)&&b.typeOf.number("end",l);if("function"===typeof k.slice)return k.slice(g,l);g=Array.prototype.slice.call(k,g,l);l=f.typedArrayTypes;for(var m=l.length,e=0;e<m;++e)if(k instanceof l[e]){g=new l[e](g);break}return g}});F("Core/AssociativeArray",["./defined","./defineProperties","./DeveloperError"],function(b,a,f){function k(){this._array=[];this._hash={}}a(k.prototype,{length:{get:function(){return this._array.length}},values:{get:function(){return this._array}}});k.prototype.contains=function(a){if("string"!==typeof a&&"number"!==typeof a)throw new f("key is required to be a string or number.");return b(this._hash[a])};k.prototype.set=function(a,b){if("string"!==typeof a&&"number"!==typeof a)throw new f("key is required to be a string or number.");b!==this._hash[a]&&(this.remove(a),this._hash[a]=b,this._array.push(b))};k.prototype.get=function(a){if("string"!==typeof a&&"number"!==typeof a)throw new f("key is required to be a string or number.");return this._hash[a]};k.prototype.remove=function(a){if(b(a)&&"string"!==typeof a&&"number"!==typeof a)throw new f("key is required to be a string or number.");var g=this._hash[a],k=b(g);if(k){var e=this._array;e.splice(e.indexOf(g),1);delete this._hash[a]}return k};k.prototype.removeAll=function(){var a=this._array;0<a.length&&(this._hash={},a.length=0)};return k});F("Core/barycentricCoordinates",["./Cartesian2","./Cartesian3","./Check","./defined","./Math"],function(b,a,f,k,g){var l=new a,m=new a,e=new a;return function(h,p,d,q,t){f.defined("point",h);f.defined("p0",p);f.defined("p1",d);f.defined("p2",q);k(t)||(t=new a);var r,c;if(k(p.z)){if(a.equalsEpsilon(h,p,g.EPSILON14))return a.clone(a.UNIT_X,t);if(a.equalsEpsilon(h,d,g.EPSILON14))return a.clone(a.UNIT_Y,t);if(a.equalsEpsilon(h,q,g.EPSILON14))return a.clone(a.UNIT_Z,t);d=a.subtract(d,p,l);q=a.subtract(q,p,m);r=a.subtract(h,p,e);h=a.dot(d,d);p=a.dot(d,q);d=a.dot(d,r);c=a.dot(q,q);q=a.dot(q,r)}else{if(b.equalsEpsilon(h,p,g.EPSILON14))return a.clone(a.UNIT_X,t);if(b.equalsEpsilon(h,d,g.EPSILON14))return a.clone(a.UNIT_Y,t);if(b.equalsEpsilon(h,q,g.EPSILON14))return a.clone(a.UNIT_Z,t);d=b.subtract(d,p,l);q=b.subtract(q,p,m);r=b.subtract(h,p,e);h=b.dot(d,d);p=b.dot(d,q);d=b.dot(d,r);c=b.dot(q,q);q=b.dot(q,r)}r=1/(h*c-p*p);t.y=(c*d-p*q)*r;t.z=(h*q-p*d)*r;t.x=1-t.y-t.z;return t}});F("Core/BingMapsApi",["./defined"],function(b){var a={defaultKey:void 0,getKey:function(f){return b(f)?f:a.defaultKey}};return a});F("Core/BingMapsGeocoderService","./BingMapsApi ./Check ./defaultValue ./defined ./defineProperties ./Rectangle ./Resource".split(" "),function(b,a,f,k,g,l,m){function e(a){a=f(a,f.EMPTY_OBJECT);this._key=b.getKey(a.key);this._resource=new m({url:"https://dev.virtualearth.net/REST/v1/Locations",queryParameters:{key:this._key}})}g(e.prototype,{url:{get:function(){return"https://dev.virtualearth.net/REST/v1/Locations"}},key:{get:function(){return this._key}}});e.prototype.geocode=function(b){a.typeOf.string("query",b);return this._resource.getDerivedResource({queryParameters:{query:b}}).fetchJsonp("jsonp").then(function(a){return 0===a.resourceSets.length?[]:a.resourceSets[0].resources.map(function(a){var b=a.bbox;return{displayName:a.name,destination:l.fromDegrees(b[1],b[0],b[3],b[2])}})})};return e});F("Core/BoundingRectangle","./Cartesian2 ./Cartographic ./Check ./defaultValue ./defined ./GeographicProjection ./Intersect ./Rectangle".split(" "),function(b,a,f,k,g,l,m,e){function h(a,b,c,d){this.x=k(a,0);this.y=k(b,0);this.width=k(c,0);this.height=k(d,0)}h.packedLength=4;h.pack=function(a,b,c){f.typeOf.object("value",a);f.defined("array",b);c=k(c,0);b[c++]=a.x;b[c++]=a.y;b[c++]=a.width;b[c]=a.height;return b};h.unpack=function(a,b,c){f.defined("array",a);b=k(b,0);g(c)||(c=new h);c.x=a[b++];c.y=a[b++];c.width=a[b++];c.height=a[b];return c};h.fromPoints=function(a,b){g(b)||(b=new h);if(!g(a)||0===a.length)return b.x=0,b.y=0,b.width=0,b.height=0,b;for(var c=a.length,d=a[0].x,e=a[0].y,f=a[0].x,k=a[0].y,l=1;l<c;l++)var p=a[l],m=p.x,p=p.y,d=Math.min(m,d),f=Math.max(m,f),e=Math.min(p,e),k=Math.max(p,k);b.x=d;b.y=e;b.width=f-d;b.height=k-e;return b};var p=new l,d=new a,q=new a;h.fromRectangle=function(a,f,c){g(c)||(c=new h);if(!g(a))return c.x=0,c.y=0,c.width=0,c.height=0,c;f=k(f,p);var l=f.project(e.southwest(a,d));a=f.project(e.northeast(a,q));b.subtract(a,l,a);c.x=l.x;c.y=l.y;c.width=a.x;c.height=a.y;return c};h.clone=function(a,b){if(g(a)){if(!g(b))return new h(a.x,a.y,a.width,a.height);b.x=a.x;b.y=a.y;b.width=a.width;b.height=a.height;return b}};h.union=function(a,b,c){f.typeOf.object("left",a);f.typeOf.object("right",b);g(c)||(c=new h);var d=Math.min(a.x,b.x),e=Math.min(a.y,b.y),k=Math.max(a.x+a.width,b.x+b.width);a=Math.max(a.y+a.height,b.y+b.height);c.x=d;c.y=e;c.width=k-d;c.height=a-e;return c};h.expand=function(a,b,c){f.typeOf.object("rectangle",a);f.typeOf.object("point",b);c=h.clone(a,c);a=b.x-c.x;var d=b.y-c.y;a>c.width?c.width=a:0>a&&(c.width-=a,c.x=b.x);d>c.height?c.height=d:0>d&&(c.height-=d,c.y=b.y);return c};h.intersect=function(a,b){f.typeOf.object("left",a);f.typeOf.object("right",b);var c=a.x,d=a.y,e=b.x,h=b.y;return c>e+b.width||c+a.width<e||d+a.height<h||d>h+b.height?m.OUTSIDE:m.INTERSECTING};h.equals=function(a,b){return a===b||g(a)&&g(b)&&a.x===b.x&&a.y===b.y&&a.width===b.width&&a.height===b.height};h.prototype.clone=function(a){return h.clone(this,a)};h.prototype.intersect=function(a){return h.intersect(this,a)};h.prototype.equals=function(a){return h.equals(this,a)};return h});F("Core/GeometryOffsetAttribute",["../Core/freezeObject"],function(b){return b({NONE:0,TOP:1,ALL:2})});F("Core/GeometryType",["./freezeObject"],function(b){return b({NONE:0,TRIANGLES:1,LINES:2,POLYLINES:3})});F("Core/Matrix2","./Cartesian2 ./Check ./defaultValue ./defined ./defineProperties ./freezeObject".split(" "),function(b,a,f,k,g,l){function m(a,b,e,h){this[0]=f(a,0);this[1]=f(e,0);this[2]=f(b,0);this[3]=f(h,0)}m.packedLength=4;m.pack=function(b,d,e){a.typeOf.object("value",b);a.defined("array",d);e=f(e,0);d[e++]=b[0];d[e++]=b[1];d[e++]=b[2];d[e++]=b[3];return d};m.unpack=function(b,d,e){a.defined("array",b);d=f(d,0);k(e)||(e=new m);e[0]=b[d++];e[1]=b[d++];e[2]=b[d++];e[3]=b[d++];return e};m.clone=function(a,b){if(k(a)){if(!k(b))return new m(a[0],a[2],a[1],a[3]);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b}};m.fromArray=function(b,d,e){a.defined("array",b);d=f(d,0);k(e)||(e=new m);e[0]=b[d];e[1]=b[d+1];e[2]=b[d+2];e[3]=b[d+3];return e};m.fromColumnMajorArray=function(b,d){a.defined("values",b);return m.clone(b,d)};m.fromRowMajorArray=function(b,d){a.defined("values",b);if(!k(d))return new m(b[0],b[1],b[2],b[3]);d[0]=b[0];d[1]=b[2];d[2]=b[1];d[3]=b[3];return d};m.fromScale=function(b,d){a.typeOf.object("scale",b);if(!k(d))return new m(b.x,0,0,b.y);d[0]=b.x;d[1]=0;d[2]=0;d[3]=b.y;return d};m.fromUniformScale=function(b,d){a.typeOf.number("scale",b);if(!k(d))return new m(b,0,0,b);d[0]=b;d[1]=0;d[2]=0;d[3]=b;return d};m.fromRotation=function(b,d){a.typeOf.number("angle",b);var e=Math.cos(b),f=Math.sin(b);if(!k(d))return new m(e,-f,f,e);d[0]=e;d[1]=f;d[2]=-f;d[3]=e;return d};m.toArray=function(b,d){a.typeOf.object("matrix",b);if(!k(d))return[b[0],b[1],b[2],b[3]];d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[3];return d};m.getElementIndex=function(b,d){a.typeOf.number.greaterThanOrEquals("row",d,0);a.typeOf.number.lessThanOrEquals("row",d,1);a.typeOf.number.greaterThanOrEquals("column",b,0);a.typeOf.number.lessThanOrEquals("column",b,1);return 2*b+d};m.getColumn=function(b,d,e){a.typeOf.object("matrix",b);a.typeOf.number.greaterThanOrEquals("index",d,0);a.typeOf.number.lessThanOrEquals("index",d,1);a.typeOf.object("result",e);d*=2;var f=b[d+1];e.x=b[d];e.y=f;return e};m.setColumn=function(b,d,e,f){a.typeOf.object("matrix",b);a.typeOf.number.greaterThanOrEquals("index",d,0);a.typeOf.number.lessThanOrEquals("index",d,1);a.typeOf.object("cartesian",e);a.typeOf.object("result",f);f=m.clone(b,f);b=2*d;f[b]=e.x;f[b+1]=e.y;return f};m.getRow=function(b,d,e){a.typeOf.object("matrix",b);a.typeOf.number.greaterThanOrEquals("index",d,0);a.typeOf.number.lessThanOrEquals("index",d,1);a.typeOf.object("result",e);var f=b[d+2];e.x=b[d];e.y=f;return e};m.setRow=function(b,d,e,f){a.typeOf.object("matrix",b);a.typeOf.number.greaterThanOrEquals("index",d,0);a.typeOf.number.lessThanOrEquals("index",d,1);a.typeOf.object("cartesian",e);a.typeOf.object("result",f);f=m.clone(b,f);f[d]=e.x;f[d+2]=e.y;return f};var e=new b;m.getScale=function(f,d){a.typeOf.object("matrix",f);a.typeOf.object("result",d);d.x=b.magnitude(b.fromElements(f[0],f[1],e));d.y=b.magnitude(b.fromElements(f[2],f[3],e));return d};var h=new b;m.getMaximumScale=function(a){m.getScale(a,h);return b.maximumComponent(h)};m.multiply=function(b,d,e){a.typeOf.object("left",b);a.typeOf.object("right",d);a.typeOf.object("result",e);var f=b[0]*d[2]+b[2]*d[3],h=b[1]*d[0]+b[3]*d[1],c=b[1]*d[2]+b[3]*d[3];e[0]=b[0]*d[0]+b[2]*d[1];e[1]=h;e[2]=f;e[3]=c;return e};m.add=function(b,d,e){a.typeOf.object("left",b);a.typeOf.object("right",d);a.typeOf.object("result",e);e[0]=b[0]+d[0];e[1]=b[1]+d[1];e[2]=b[2]+d[2];e[3]=b[3]+d[3];return e};m.subtract=function(b,d,e){a.typeOf.object("left",b);a.typeOf.object("right",d);a.typeOf.object("result",e);e[0]=b[0]-d[0];e[1]=b[1]-d[1];e[2]=b[2]-d[2];e[3]=b[3]-d[3];return e};m.multiplyByVector=function(b,d,e){a.typeOf.object("matrix",b);a.typeOf.object("cartesian",d);a.typeOf.object("result",e);var f=b[1]*d.x+b[3]*d.y;e.x=b[0]*d.x+b[2]*d.y;e.y=f;return e};m.multiplyByScalar=function(b,d,e){a.typeOf.object("matrix",b);a.typeOf.number("scalar",d);a.typeOf.object("result",e);e[0]=b[0]*d;e[1]=b[1]*d;e[2]=b[2]*d;e[3]=b[3]*d;return e};m.multiplyByScale=function(b,d,e){a.typeOf.object("matrix",b);a.typeOf.object("scale",d);a.typeOf.object("result",e);e[0]=b[0]*d.x;e[1]=b[1]*d.x;e[2]=b[2]*d.y;e[3]=b[3]*d.y;return e};m.negate=function(b,d){a.typeOf.object("matrix",b);a.typeOf.object("result",d);d[0]=-b[0];d[1]=-b[1];d[2]=-b[2];d[3]=-b[3];return d};m.transpose=function(b,d){a.typeOf.object("matrix",b);a.typeOf.object("result",d);var e=b[2],f=b[1],h=b[3];d[0]=b[0];d[1]=e;d[2]=f;d[3]=h;return d};m.abs=function(b,d){a.typeOf.object("matrix",b);a.typeOf.object("result",d);d[0]=Math.abs(b[0]);d[1]=Math.abs(b[1]);d[2]=Math.abs(b[2]);d[3]=Math.abs(b[3]);return d};m.equals=function(a,b){return a===b||k(a)&&k(b)&&a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};m.equalsArray=function(a,b,e){return a[0]===b[e]&&a[1]===b[e+1]&&a[2]===b[e+2]&&a[3]===b[e+3]};m.equalsEpsilon=function(b,d,e){a.typeOf.number("epsilon",e);return b===d||k(b)&&k(d)&&Math.abs(b[0]-d[0])<=e&&Math.abs(b[1]-d[1])<=e&&Math.abs(b[2]-d[2])<=e&&Math.abs(b[3]-d[3])<=e};m.IDENTITY=l(new m(1,0,0,1));m.ZERO=l(new m(0,0,0,0));m.COLUMN0ROW0=0;m.COLUMN0ROW1=1;m.COLUMN1ROW0=2;m.COLUMN1ROW1=3;g(m.prototype,{length:{get:function(){return m.packedLength}}});m.prototype.clone=function(a){return m.clone(this,a)};m.prototype.equals=function(a){return m.equals(this,a)};m.prototype.equalsEpsilon=function(a,b){return m.equalsEpsilon(this,a,b)};m.prototype.toString=function(){return"("+this[0]+", "+this[2]+")\n("+this[1]+", "+this[3]+")"};return m});F("Core/PrimitiveType",["./freezeObject","./WebGLConstants"],function(b,a){var f={POINTS:a.POINTS,LINES:a.LINES,LINE_LOOP:a.LINE_LOOP,LINE_STRIP:a.LINE_STRIP,TRIANGLES:a.TRIANGLES,TRIANGLE_STRIP:a.TRIANGLE_STRIP,TRIANGLE_FAN:a.TRIANGLE_FAN,validate:function(a){return a===f.POINTS||a===f.LINES||a===f.LINE_LOOP||a===f.LINE_STRIP||a===f.TRIANGLES||a===f.TRIANGLE_STRIP||a===f.TRIANGLE_FAN}};return b(f)});F("Core/Geometry","./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./defaultValue ./defined ./DeveloperError ./GeometryOffsetAttribute ./GeometryType ./Matrix2 ./Matrix3 ./Matrix4 ./PrimitiveType ./Quaternion ./Rectangle ./Transforms".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(c){c=g(c,g.EMPTY_OBJECT);k.typeOf.object("options.attributes",c.attributes);this.attributes=c.attributes;this.indices=c.indices;this.primitiveType=g(c.primitiveType,t.TRIANGLES);this.boundingSphere=c.boundingSphere;this.geometryType=g(c.geometryType,h.NONE);this.boundingSphereCV=c.boundingSphereCV;this.offsetAttribute=c.offsetAttribute}y.computeNumberOfVertices=function(c){k.typeOf.object("geometry",c);var a=-1,b;for(b in c.attributes)if(c.attributes.hasOwnProperty(b)&&l(c.attributes[b])&&l(c.attributes[b].values)){var d=c.attributes[b],d=d.values.length/d.componentsPerAttribute;if(a!==d&&-1!==a)throw new m("All attribute lists must have the same number of attributes.");a=d}return a};var A=new f,z=new a,x=new q,D=[new f,new f,new f],v=[new b,new b,new b],B=[new b,new b,new b],C=new a,I=new r,H=new q,J=new p;y._textureCoordinateRotationPoints=function(e,h,g,k){var l=c.center(k,A),l=f.toCartesian(l,g,z),l=u.eastNorthUpToFixedFrame(l,g,x),l=q.inverse(l,x);D[0].longitude=k.west;D[0].latitude=k.south;D[1].longitude=k.west;D[1].latitude=k.north;D[2].longitude=k.east;D[2].latitude=k.south;var m=C;for(k=0;3>k;k++)f.toCartesian(D[k],g,m),m=q.multiplyByPointAsVector(l,m,m),v[k].x=m.x,v[k].y=m.y;k=r.fromAxisAngle(a.UNIT_Z,-h,I);var w=d.fromQuaternion(k,H),y=e.length,E=g=Number.POSITIVE_INFINITY,t=Number.NEGATIVE_INFINITY,G=Number.NEGATIVE_INFINITY;for(k=0;k<y;k++)m=q.multiplyByPointAsVector(l,e[k],m),m=d.multiplyByVector(w,m,m),g=Math.min(g,m.x),E=Math.min(E,m.y),t=Math.max(t,m.x),G=Math.max(G,m.y);e=p.fromRotation(h,J);B[0].x=g;B[0].y=E;B[1].x=g;B[1].y=G;B[2].x=t;B[2].y=E;h=v[0];l=v[2].x-h.x;m=v[1].y-h.y;for(k=0;3>k;k++)g=B[k],p.multiplyByVector(e,g,g),g.x=(g.x-h.x)/l,g.y=(g.y-h.y)/m;e=B[1];h=B[2];k=Array(6);b.pack(B[0],k);b.pack(e,k,2);b.pack(h,k,4);return k};return y});F("Core/GeometryAttribute",["./defaultValue","./defined","./DeveloperError"],function(b,a,f){return function(k){k=b(k,b.EMPTY_OBJECT);if(!a(k.componentDatatype))throw new f("options.componentDatatype is required.");if(!a(k.componentsPerAttribute))throw new f("options.componentsPerAttribute is required.");if(1>k.componentsPerAttribute||4<k.componentsPerAttribute)throw new f("options.componentsPerAttribute must be between 1 and 4.");if(!a(k.values))throw new f("options.values is required.");this.componentDatatype=k.componentDatatype;this.componentsPerAttribute=k.componentsPerAttribute;this.normalize=b(k.normalize,!1);this.values=k.values}});F("Core/GeometryAttributes",["./defaultValue"],function(b){return function(a){a=b(a,b.EMPTY_OBJECT);this.position=a.position;this.normal=a.normal;this.st=a.st;this.bitangent=a.bitangent;this.tangent=a.tangent;this.color=a.color}});F("Core/VertexFormat",["./defaultValue","./defined","./DeveloperError","./freezeObject"],function(b,a,f,k){function g(a){a=b(a,b.EMPTY_OBJECT);this.position=b(a.position,!1);this.normal=b(a.normal,!1);this.st=b(a.st,!1);this.bitangent=b(a.bitangent,!1);this.tangent=b(a.tangent,!1);this.color=b(a.color,!1)}g.POSITION_ONLY=k(new g({position:!0}));g.POSITION_AND_NORMAL=k(new g({position:!0,normal:!0}));g.POSITION_NORMAL_AND_ST=k(new g({position:!0,normal:!0,st:!0}));g.POSITION_AND_ST=k(new g({position:!0,st:!0}));g.POSITION_AND_COLOR=k(new g({position:!0,color:!0}));g.ALL=k(new g({position:!0,normal:!0,st:!0,tangent:!0,bitangent:!0}));g.DEFAULT=g.POSITION_NORMAL_AND_ST;g.packedLength=6;g.pack=function(g,k,e){if(!a(g))throw new f("value is required");if(!a(k))throw new f("array is required");e=b(e,0);k[e++]=g.position?1:0;k[e++]=g.normal?1:0;k[e++]=g.st?1:0;k[e++]=g.tangent?1:0;k[e++]=g.bitangent?1:0;k[e]=g.color?1:0;return k};g.unpack=function(k,m,e){if(!a(k))throw new f("array is required");m=b(m,0);a(e)||(e=new g);e.position=1===k[m++];e.normal=1===k[m++];e.st=1===k[m++];e.tangent=1===k[m++];e.bitangent=1===k[m++];e.color=1===k[m];return e};g.clone=function(b,f){if(a(b))return a(f)||(f=new g),f.position=b.position,f.normal=b.normal,f.st=b.st,f.tangent=b.tangent,f.bitangent=b.bitangent,f.color=b.color,f};return g});F("Core/BoxGeometry","./arrayFill ./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./PrimitiveType ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(c){c=l(c,l.EMPTY_OBJECT);var a=c.minimum,b=c.maximum;k.typeOf.object("min",a);k.typeOf.object("max",b);if(m(c.offsetAttribute)&&c.offsetAttribute===q.TOP)throw new e("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");var d=l(c.vertexFormat,r.DEFAULT);this._minimum=f.clone(a);this._maximum=f.clone(b);this._vertexFormat=d;this._offsetAttribute=c.offsetAttribute;this._workerName="createBoxGeometry"}var u=new f;c.fromDimensions=function(a){a=l(a,l.EMPTY_OBJECT);var b=a.dimensions;k.typeOf.object("dimensions",b);k.typeOf.number.greaterThanOrEquals("dimensions.x",b.x,0);k.typeOf.number.greaterThanOrEquals("dimensions.y",b.y,0);k.typeOf.number.greaterThanOrEquals("dimensions.z",b.z,0);b=f.multiplyByScalar(b,.5,new f);return new c({minimum:f.negate(b,new f),maximum:b,vertexFormat:a.vertexFormat,offsetAttribute:a.offsetAttribute})};c.fromAxisAlignedBoundingBox=function(a){k.typeOf.object("boundingBox",a);return new c({minimum:a.minimum,maximum:a.maximum})};c.packedLength=2*f.packedLength+r.packedLength+1;c.pack=function(c,a,b){k.typeOf.object("value",c);k.defined("array",a);b=l(b,0);f.pack(c._minimum,a,b);f.pack(c._maximum,a,b+f.packedLength);r.pack(c._vertexFormat,a,b+2*f.packedLength);a[b+2*f.packedLength+r.packedLength]=l(c._offsetAttribute,-1);return a};var y=new f,A=new f,z=new r,x={minimum:y,maximum:A,vertexFormat:z,offsetAttribute:void 0};c.unpack=function(a,b,d){k.defined("array",a);b=l(b,0);var e=f.unpack(a,b,y),h=f.unpack(a,b+f.packedLength,A),g=r.unpack(a,b+2*f.packedLength,z);a=a[b+2*f.packedLength+r.packedLength];if(!m(d))return x.offsetAttribute=-1===a?void 0:a,new c(x);d._minimum=f.clone(e,d._minimum);d._maximum=f.clone(h,d._maximum);d._vertexFormat=r.clone(g,d._vertexFormat);d._offsetAttribute=-1===a?void 0:a;return d};c.createGeometry=function(c){var e=c._minimum,k=c._maximum,l=c._vertexFormat;if(!f.equals(e,k)){var v=new d,r;if(l.position&&(l.st||l.normal||l.tangent||l.bitangent)){l.position&&(r=new Float64Array(72),r[0]=e.x,r[1]=e.y,r[2]=k.z,r[3]=k.x,r[4]=e.y,r[5]=k.z,r[6]=k.x,r[7]=k.y,r[8]=k.z,r[9]=e.x,r[10]=k.y,r[11]=k.z,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=k.x,r[16]=e.y,r[17]=e.z,r[18]=k.x,r[19]=k.y,r[20]=e.z,r[21]=e.x,r[22]=k.y,r[23]=e.z,r[24]=k.x,r[25]=e.y,r[26]=e.z,r[27]=k.x,r[28]=k.y,r[29]=e.z,r[30]=k.x,r[31]=k.y,r[32]=k.z,r[33]=k.x,r[34]=e.y,r[35]=k.z,r[36]=e.x,r[37]=e.y,r[38]=e.z,r[39]=e.x,r[40]=k.y,r[41]=e.z,r[42]=e.x,r[43]=k.y,r[44]=k.z,r[45]=e.x,r[46]=e.y,r[47]=k.z,r[48]=e.x,r[49]=k.y,r[50]=e.z,r[51]=k.x,r[52]=k.y,r[53]=e.z,r[54]=k.x,r[55]=k.y,r[56]=k.z,r[57]=e.x,r[58]=k.y,r[59]=k.z,r[60]=e.x,r[61]=e.y,r[62]=e.z,r[63]=k.x,r[64]=e.y,r[65]=e.z,r[66]=k.x,r[67]=e.y,r[68]=k.z,r[69]=e.x,r[70]=e.y,r[71]=k.z,v.position=new p({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:r}));if(l.normal){var w=new Float32Array(72);w[0]=0;w[1]=0;w[2]=1;w[3]=0;w[4]=0;w[5]=1;w[6]=0;w[7]=0;w[8]=1;w[9]=0;w[10]=0;w[11]=1;w[12]=0;w[13]=0;w[14]=-1;w[15]=0;w[16]=0;w[17]=-1;w[18]=0;w[19]=0;w[20]=-1;w[21]=0;w[22]=0;w[23]=-1;w[24]=1;w[25]=0;w[26]=0;w[27]=1;w[28]=0;w[29]=0;w[30]=1;w[31]=0;w[32]=0;w[33]=1;w[34]=0;w[35]=0;w[36]=-1;w[37]=0;w[38]=0;w[39]=-1;w[40]=0;w[41]=0;w[42]=-1;w[43]=0;w[44]=0;w[45]=-1;w[46]=0;w[47]=0;w[48]=0;w[49]=1;w[50]=0;w[51]=0;w[52]=1;w[53]=0;w[54]=0;w[55]=1;w[56]=0;w[57]=0;w[58]=1;w[59]=0;w[60]=0;w[61]=-1;w[62]=0;w[63]=0;w[64]=-1;w[65]=0;w[66]=0;w[67]=-1;w[68]=0;w[69]=0;w[70]=-1;w[71]=0;v.normal=new p({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:w})}l.st&&(w=new Float32Array(48),w[0]=0,w[1]=0,w[2]=1,w[3]=0,w[4]=1,w[5]=1,w[6]=0,w[7]=1,w[8]=1,w[9]=0,w[10]=0,w[11]=0,w[12]=0,w[13]=1,w[14]=1,w[15]=1,w[16]=0,w[17]=0,w[18]=1,w[19]=0,w[20]=1,w[21]=1,w[22]=0,w[23]=1,w[24]=1,w[25]=0,w[26]=0,w[27]=0,w[28]=0,w[29]=1,w[30]=1,w[31]=1,w[32]=1,w[33]=0,w[34]=0,w[35]=0,w[36]=0,w[37]=1,w[38]=1,w[39]=1,w[40]=0,w[41]=0,w[42]=1,w[43]=0,w[44]=1,w[45]=1,w[46]=0,w[47]=1,v.st=new p({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:w}));l.tangent&&(w=new Float32Array(72),w[0]=1,w[1]=0,w[2]=0,w[3]=1,w[4]=0,w[5]=0,w[6]=1,w[7]=0,w[8]=0,w[9]=1,w[10]=0,w[11]=0,w[12]=-1,w[13]=0,w[14]=0,w[15]=-1,w[16]=0,w[17]=0,w[18]=-1,w[19]=0,w[20]=0,w[21]=-1,w[22]=0,w[23]=0,w[24]=0,w[25]=1,w[26]=0,w[27]=0,w[28]=1,w[29]=0,w[30]=0,w[31]=1,w[32]=0,w[33]=0,w[34]=1,w[35]=0,w[36]=0,w[37]=-1,w[38]=0,w[39]=0,w[40]=-1,w[41]=0,w[42]=0,w[43]=-1,w[44]=0,w[45]=0,w[46]=-1,w[47]=0,w[48]=-1,w[49]=0,w[50]=0,w[51]=-1,w[52]=0,w[53]=0,w[54]=-1,w[55]=0,w[56]=0,w[57]=-1,w[58]=0,w[59]=0,w[60]=1,w[61]=0,w[62]=0,w[63]=1,w[64]=0,w[65]=0,w[66]=1,w[67]=0,w[68]=0,w[69]=1,w[70]=0,w[71]=0,v.tangent=new p({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:w}));l.bitangent&&(l=new Float32Array(72),l[0]=0,l[1]=1,l[2]=0,l[3]=0,l[4]=1,l[5]=0,l[6]=0,l[7]=1,l[8]=0,l[9]=0,l[10]=1,l[11]=0,l[12]=0,l[13]=1,l[14]=0,l[15]=0,l[16]=1,l[17]=0,l[18]=0,l[19]=1,l[20]=0,l[21]=0,l[22]=1,l[23]=0,l[24]=0,l[25]=0,l[26]=1,l[27]=0,l[28]=0,l[29]=1,l[30]=0,l[31]=0,l[32]=1,l[33]=0,l[34]=0,l[35]=1,l[36]=0,l[37]=0,l[38]=1,l[39]=0,l[40]=0,l[41]=1,l[42]=0,l[43]=0,l[44]=1,l[45]=0,l[46]=0,l[47]=1,l[48]=0,l[49]=0,l[50]=1,l[51]=0,l[52]=0,l[53]=1,l[54]=0,l[55]=0,l[56]=1,l[57]=0,l[58]=0,l[59]=1,l[60]=0,l[61]=0,l[62]=1,l[63]=0,l[64]=0,l[65]=1,l[66]=0,l[67]=0,l[68]=1,l[69]=0,l[70]=0,l[71]=1,v.bitangent=new p({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:l}));l=new Uint16Array(36);l[0]=0;l[1]=1;l[2]=2;l[3]=0;l[4]=2;l[5]=3;l[6]=6;l[7]=5;l[8]=4;l[9]=7;l[10]=6;l[11]=4;l[12]=8;l[13]=9;l[14]=10;l[15]=8;l[16]=10;l[17]=11;l[18]=14;l[19]=13;l[20]=12;l[21]=15;l[22]=14;l[23]=12;l[24]=18;l[25]=17;l[26]=16;l[27]=19;l[28]=18;l[29]=16;l[30]=20;l[31]=21;l[32]=22;l[33]=20;l[34]=22;l[35]=23}else r=new Float64Array(24),r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=k.x,r[4]=e.y,r[5]=e.z,r[6]=k.x,r[7]=k.y,r[8]=e.z,r[9]=e.x,r[10]=k.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=k.z,r[15]=k.x,r[16]=e.y,r[17]=k.z,r[18]=k.x,r[19]=k.y,r[20]=k.z,r[21]=e.x,r[22]=k.y,r[23]=k.z,v.position=new p({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:r}),l=new Uint16Array(36),l[0]=4,l[1]=5,l[2]=6,l[3]=4,l[4]=6,l[5]=7,l[6]=1,l[7]=0,l[8]=3,l[9]=1,l[10]=3,l[11]=2,l[12]=1,l[13]=6,l[14]=5,l[15]=1,l[16]=2,l[17]=6,l[18]=2,l[19]=3,l[20]=7,l[21]=2,l[22]=7,l[23]=6,l[24]=3,l[25]=0,l[26]=4,l[27]=3,l[28]=4,l[29]=7,l[30]=0,l[31]=1,l[32]=5,l[33]=0,l[34]=5,l[35]=4;e=f.subtract(k,e,u);e=.5*f.magnitude(e);m(c._offsetAttribute)&&(r=new Uint8Array(r.length/3),b(r,c._offsetAttribute===q.NONE?0:1),v.applyOffset=new p({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:1,values:r}));return new h({attributes:v,indices:l,primitiveType:t.TRIANGLES,boundingSphere:new a(f.ZERO,e),offsetAttribute:c._offsetAttribute})}};var D;c.getUnitBox=function(){m(D)||(D=c.createGeometry(c.fromDimensions({dimensions:new f(1,1,1),vertexFormat:r.POSITION_ONLY})));return D};return c});F("Core/BoxOutlineGeometry","./arrayFill ./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(c){c=l(c,l.EMPTY_OBJECT);var a=c.minimum,b=c.maximum;k.typeOf.object("min",a);k.typeOf.object("max",b);if(m(c.offsetAttribute)&&c.offsetAttribute===q.TOP)throw new e("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._min=f.clone(a);this._max=f.clone(b);this._offsetAttribute=c.offsetAttribute;this._workerName="createBoxOutlineGeometry"}var c=new f;r.fromDimensions=function(c){c=l(c,l.EMPTY_OBJECT);var a=c.dimensions;k.typeOf.object("dimensions",a);k.typeOf.number.greaterThanOrEquals("dimensions.x",a.x,0);k.typeOf.number.greaterThanOrEquals("dimensions.y",a.y,0);k.typeOf.number.greaterThanOrEquals("dimensions.z",a.z,0);a=f.multiplyByScalar(a,.5,new f);return new r({minimum:f.negate(a,new f),maximum:a,offsetAttribute:c.offsetAttribute})};r.fromAxisAlignedBoundingBox=function(c){k.typeOf.object("boundindBox",c);return new r({minimum:c.minimum,maximum:c.maximum})};r.packedLength=2*f.packedLength+1;r.pack=function(c,a,b){k.typeOf.object("value",c);k.defined("array",a);b=l(b,0);f.pack(c._min,a,b);f.pack(c._max,a,b+f.packedLength);a[b+2*f.packedLength]=l(c._offsetAttribute,-1);return a};var u=new f,y=new f,A={minimum:u,maximum:y,offsetAttribute:void 0};r.unpack=function(c,a,b){k.defined("array",c);a=l(a,0);var d=f.unpack(c,a,u),e=f.unpack(c,a+f.packedLength,y);c=c[a+2*f.packedLength];if(!m(b))return A.offsetAttribute=-1===c?void 0:c,new r(A);b._min=f.clone(d,b._min);b._max=f.clone(e,b._max);b._offsetAttribute=-1===c?void 0:c;return b};r.createGeometry=function(e){var k=e._min,l=e._max;if(!f.equals(k,l)){var v=new d,r=new Uint16Array(24),u=new Float64Array(24);u[0]=k.x;u[1]=k.y;u[2]=k.z;u[3]=l.x;u[4]=k.y;u[5]=k.z;u[6]=l.x;u[7]=l.y;u[8]=k.z;u[9]=k.x;u[10]=l.y;u[11]=k.z;u[12]=k.x;u[13]=k.y;u[14]=l.z;u[15]=l.x;u[16]=k.y;u[17]=l.z;u[18]=l.x;u[19]=l.y;u[20]=l.z;u[21]=k.x;u[22]=l.y;u[23]=l.z;v.position=new p({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:u});r[0]=4;r[1]=5;r[2]=5;r[3]=6;r[4]=6;r[5]=7;r[6]=7;r[7]=4;r[8]=0;r[9]=1;r[10]=1;r[11]=2;r[12]=2;r[13]=3;r[14]=3;r[15]=0;r[16]=0;r[17]=4;r[18]=1;r[19]=5;r[20]=2;r[21]=6;r[22]=3;r[23]=7;k=f.subtract(l,k,c);k=.5*f.magnitude(k);m(e._offsetAttribute)&&(u=new Uint8Array(u.length/3),b(u,e._offsetAttribute===q.NONE?0:1),v.applyOffset=new p({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:1,values:u}));return new h({attributes:v,indices:r,primitiveType:t.LINES,boundingSphere:new a(f.ZERO,k),offsetAttribute:e._offsetAttribute})}};return r});F("Core/cancelAnimationFrame",["./defined"],function(b){if("undefined"!==typeof window){var a=window.cancelAnimationFrame;(function(){if(!b(a))for(var f=["webkit","moz","ms","o"],k=0,g=f.length;k<g&&!b(a);)a=window[f[k]+"CancelAnimationFrame"],b(a)||(a=window[f[k]+"CancelRequestAnimationFrame"]),++k;b(a)||(a=clearTimeout)})();return function(b){a(b)}}});F("Core/CartographicGeocoderService",["../ThirdParty/when","./Cartesian3","./Check"],function(b,a,f){function k(){}k.prototype.geocode=function(g){f.typeOf.string("query",g);var k=g.match(/[^\s,\n]+/g);if(2===k.length||3===k.length){var m=+k[0],e=+k[1],h=3===k.length?+k[2]:300;if(isNaN(m)&&isNaN(e))for(var p=/^(\d+.?\d*)([nsew])/i,d=0;d<k.length;++d){var q=k[d].match(p);p.test(k[d])&&3===q.length&&(/^[ns]/i.test(q[2])?e=/^[n]/i.test(q[2])?+q[1]:-q[1]:/^[ew]/i.test(q[2])&&(m=/^[e]/i.test(q[2])?+q[1]:-q[1]))}if(!isNaN(m)&&!isNaN(e)&&!isNaN(h))return g={displayName:g,destination:a.fromDegrees(m,e,h)},b.resolve([g])}return b.resolve([])};return k});F("Core/Spline",["./Check","./defaultValue","./defined","./DeveloperError","./Math"],function(b,a,f,k,g){function l(){this.points=this.times=void 0;k.throwInstantiationError()}l.prototype.evaluate=k.throwInstantiationError;l.prototype.findTimeInterval=function(b,e){var h=this.times,g=h.length;if(!f(b))throw new k("time is required.");if(b<h[0]||b>h[g-1])throw new k("time is out of range.");e=a(e,0);if(b>=h[e]){if(e+1<g&&b<h[e+1])return e;if(e+2<g&&b<h[e+2])return e+1}else if(0<=e-1&&b>=h[e-1])return e-1;var d;if(b>h[e])for(d=e;d<g-1&&!(b>=h[d]&&b<h[d+1]);++d);else for(d=e-1;0<=d&&!(b>=h[d]&&b<h[d+1]);--d);d===g-1&&(d=g-2);return d};l.prototype.wrapTime=function(a){b.typeOf.number("time",a);var e=this.times,f=e[e.length-1],g=e[0],e=f-g;a<g&&(g=Math.floor((g-a)/e)+1,a+=g*e);a>f&&(g=Math.floor((a-f)/e)+1,a-=g*e);return a};l.prototype.clampTime=function(a){b.typeOf.number("time",a);var e=this.times;return g.clamp(a,e[0],e[e.length-1])};return l});F("Core/LinearSpline","./Cartesian3 ./defaultValue ./defined ./defineProperties ./DeveloperError ./Spline".split(" "),function(b,a,f,k,g,l){function m(b){b=a(b,a.EMPTY_OBJECT);var e=b.points;b=b.times;if(!f(e)||!f(b))throw new g("points and times are required.");if(2>e.length)throw new g("points.length must be greater than or equal to 2.");if(b.length!==e.length)throw new g("times.length must be equal to points.length.");this._times=b;this._points=e;this._lastTimeIndex=0}k(m.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});m.prototype.findTimeInterval=l.prototype.findTimeInterval;m.prototype.wrapTime=l.prototype.wrapTime;m.prototype.clampTime=l.prototype.clampTime;m.prototype.evaluate=function(a,h){var e=this.points,d=this.times,g=this._lastTimeIndex=this.findTimeInterval(a,this._lastTimeIndex),d=(a-d[g])/(d[g+1]-d[g]);f(h)||(h=new b);return b.lerp(e[g],e[g+1],d,h)};return m});F("Core/TridiagonalSystemSolver",["./Cartesian3","./defined","./DeveloperError"],function(b,a,f){return{solve:function(k,g,l,m){if(!(a(k)&&k instanceof Array))throw new f("The array lower is required.");if(!(a(g)&&g instanceof Array))throw new f("The array diagonal is required.");if(!(a(l)&&l instanceof Array))throw new f("The array upper is required.");if(!(a(m)&&m instanceof Array))throw new f("The array right is required.");if(g.length!==m.length)throw new f("diagonal and right must have the same lengths.");if(k.length!==l.length)throw new f("lower and upper must have the same lengths.");if(k.length!==g.length-1)throw new f("lower and upper must be one less than the length of diagonal.");var e=Array(l.length),h=Array(m.length),p=Array(m.length),d;for(d=0;d<h.length;d++)h[d]=new b,p[d]=new b;e[0]=l[0]/g[0];h[0]=b.multiplyByScalar(m[0],1/g[0],h[0]);var q;for(d=1;d<e.length;++d)q=1/(g[d]-e[d-1]*k[d-1]),e[d]=l[d]*q,h[d]=b.subtract(m[d],b.multiplyByScalar(h[d-1],k[d-1],h[d]),h[d]),h[d]=b.multiplyByScalar(h[d],q,h[d]);q=1/(g[d]-e[d-1]*k[d-1]);h[d]=b.subtract(m[d],b.multiplyByScalar(h[d-1],k[d-1],h[d]),h[d]);h[d]=b.multiplyByScalar(h[d],q,h[d]);p[p.length-1]=h[h.length-1];for(d=p.length-2;0<=d;--d)p[d]=b.subtract(h[d],b.multiplyByScalar(p[d+1],e[d],p[d]),p[d]);return p}}});F("Core/HermiteSpline","./Cartesian3 ./Cartesian4 ./defaultValue ./defined ./defineProperties ./DeveloperError ./LinearSpline ./Matrix4 ./Spline ./TridiagonalSystemSolver".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(c){c=f(c,f.EMPTY_OBJECT);var a=c.points,b=c.times,d=c.inTangents;c=c.outTangents;if(!(k(a)&&k(b)&&k(d)&&k(c)))throw new l("times, points, inTangents, and outTangents are required.");if(2>a.length)throw new l("points.length must be greater than or equal to 2.");if(b.length!==a.length)throw new l("times.length must be equal to points.length.");if(d.length!==c.length||d.length!==a.length-1)throw new l("inTangents and outTangents must have a length equal to points.length - 1.");this._times=b;this._points=a;this._inTangents=d;this._outTangents=c;this._lastTimeIndex=0}var q=[],t=[],r=[],c=[];g(d.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},inTangents:{get:function(){return this._inTangents}},outTangents:{get:function(){return this._outTangents}}});d.createC1=function(c){c=f(c,f.EMPTY_OBJECT);var a=c.times,b=c.points,e=c.tangents;if(!k(b)||!k(a)||!k(e))throw new l("points, times and tangents are required.");if(2>b.length)throw new l("points.length must be greater than or equal to 2.");if(a.length!==b.length||a.length!==e.length)throw new l("times, points and tangents must have the same length.");c=e.slice(0,e.length-1);e=e.slice(1,e.length);return new d({times:a,points:b,inTangents:e,outTangents:c})};d.createNaturalCubic=function(a){a=f(a,f.EMPTY_OBJECT);var e=a.times;a=a.points;if(!k(a)||!k(e))throw new l("points and times are required.");if(2>a.length)throw new l("points.length must be greater than or equal to 2.");if(e.length!==a.length)throw new l("times.length must be equal to points.length.");if(3>a.length)return new m({points:a,times:e});var h;q.length=r.length=a.length-1;t.length=c.length=a.length;var g;q[0]=r[0]=1;t[0]=2;h=c[0];k(h)||(h=c[0]=new b);b.subtract(a[1],a[0],h);b.multiplyByScalar(h,3,h);for(g=1;g<q.length;++g)q[g]=r[g]=1,t[g]=4,h=c[g],k(h)||(h=c[g]=new b),b.subtract(a[g+1],a[g-1],h),b.multiplyByScalar(h,3,h);t[g]=2;h=c[g];k(h)||(h=c[g]=new b);b.subtract(a[g],a[g-1],h);b.multiplyByScalar(h,3,h);h=p.solve(q,t,r,c);g=h.slice(0,h.length-1);h=h.slice(1,h.length);return new d({times:e,points:a,inTangents:h,outTangents:g})};d.createClampedCubic=function(a){a=f(a,f.EMPTY_OBJECT);var e=a.times,h=a.points,g=a.firstTangent;a=a.lastTangent;if(!(k(h)&&k(e)&&k(g)&&k(a)))throw new l("points, times, firstTangent and lastTangent are required.");if(2>h.length)throw new l("points.length must be greater than or equal to 2.");if(e.length!==h.length)throw new l("times.length must be equal to points.length.");if(3>h.length)return new m({points:h,times:e});q.length=r.length=h.length-1;t.length=c.length=h.length;q[0]=t[0]=1;r[0]=0;var v=c[0];k(v)||(v=c[0]=new b);b.clone(g,v);for(g=1;g<q.length-1;++g)q[g]=r[g]=1,t[g]=4,v=c[g],k(v)||(v=c[g]=new b),b.subtract(h[g+1],h[g-1],v),b.multiplyByScalar(v,3,v);q[g]=0;r[g]=1;t[g]=4;v=c[g];k(v)||(v=c[g]=new b);b.subtract(h[g+1],h[g-1],v);b.multiplyByScalar(v,3,v);t[g+1]=1;v=c[g+1];k(v)||(v=c[g+1]=new b);b.clone(a,v);a=p.solve(q,t,r,c);g=a.slice(0,a.length-1);a=a.slice(1,a.length);return new d({times:e,points:h,inTangents:a,outTangents:g})};d.hermiteCoefficientMatrix=new e(2,-3,0,1,-2,3,0,0,1,-2,1,0,1,-1,0,0);d.prototype.findTimeInterval=h.prototype.findTimeInterval;var u=new a,y=new b;d.prototype.wrapTime=h.prototype.wrapTime;d.prototype.clampTime=h.prototype.clampTime;d.prototype.evaluate=function(c,a){k(a)||(a=new b);var f=this.points,h=this.times,g=this.inTangents,l=this.outTangents,p=this._lastTimeIndex=this.findTimeInterval(c,this._lastTimeIndex),h=(c-h[p])/(h[p+1]-h[p]);u.z=h;u.y=h*h;u.x=u.y*h;u.w=1;h=e.multiplyByVector(d.hermiteCoefficientMatrix,u,u);a=b.multiplyByScalar(f[p],h.x,a);b.multiplyByScalar(f[p+1],h.y,y);b.add(a,y,a);b.multiplyByScalar(l[p],h.z,y);b.add(a,y,a);b.multiplyByScalar(g[p],h.w,y);return b.add(a,y,a)};return d});F("Core/CatmullRomSpline","./Cartesian3 ./Cartesian4 ./Check ./defaultValue ./defined ./defineProperties ./HermiteSpline ./Matrix4 ./Spline".split(" "),function(b,a,f,k,g,l,m,e,h){function p(c){var a=c.points,f=c.times;if(3>a.length){var h=f[0],k=1/(f[1]-h),l=a[0],p=a[1];return function(c,a){g(a)||(a=new b);return b.lerp(l,p,(c-h)*k,a)}}return function(h,k){g(k)||(k=new b);var l=c._lastTimeIndex=c.findTimeInterval(h,c._lastTimeIndex),p=(h-f[l])/(f[l+1]-f[l]),v=q;v.z=p;v.y=p*p;v.x=v.y*p;v.w=1;var u,B,C;0===l?(p=a[0],u=a[1],B=c.firstTangent,C=b.subtract(a[2],p,t),b.multiplyByScalar(C,.5,C),l=e.multiplyByVector(m.hermiteCoefficientMatrix,v,v)):l===a.length-2?(p=a[l],u=a[l+1],C=c.lastTangent,B=b.subtract(u,a[l-1],t),b.multiplyByScalar(B,.5,B),l=e.multiplyByVector(m.hermiteCoefficientMatrix,v,v)):(p=a[l-1],u=a[l],B=a[l+1],C=a[l+2],l=e.multiplyByVector(d.catmullRomCoefficientMatrix,v,v));k=b.multiplyByScalar(p,l.x,k);b.multiplyByScalar(u,l.y,r);b.add(k,r,k);b.multiplyByScalar(B,l.z,r);b.add(k,r,k);b.multiplyByScalar(C,l.w,r);return b.add(k,r,k)}}function d(a){a=k(a,k.EMPTY_OBJECT);var d=a.points,e=a.times,h=a.firstTangent;a=a.lastTangent;f.defined("points",d);f.defined("times",e);f.typeOf.number.greaterThanOrEquals("points.length",d.length,2);f.typeOf.number.equals("times.length","points.length",e.length,d.length);if(2<d.length&&(g(h)||(h=c,b.multiplyByScalar(d[1],2,h),b.subtract(h,d[2],h),b.subtract(h,d[0],h),b.multiplyByScalar(h,.5,h)),!g(a))){var l=d.length-1;a=u;b.multiplyByScalar(d[l-1],2,a);b.subtract(d[l],a,a);b.add(a,d[l-2],a);b.multiplyByScalar(a,.5,a)}this._times=e;this._points=d;this._firstTangent=b.clone(h);this._lastTangent=b.clone(a);this._evaluateFunction=p(this);this._lastTimeIndex=0}var q=new a,t=new b,r=new b,c=new b,u=new b;l(d.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}},firstTangent:{get:function(){return this._firstTangent}},lastTangent:{get:function(){return this._lastTangent}}});d.catmullRomCoefficientMatrix=new e(-.5,1,-.5,0,1.5,-2.5,0,1,-1.5,2,.5,0,.5,-.5,0,0);d.prototype.findTimeInterval=h.prototype.findTimeInterval;d.prototype.wrapTime=h.prototype.wrapTime;d.prototype.clampTime=h.prototype.clampTime;d.prototype.evaluate=function(c,a){return this._evaluateFunction(c,a)};return d});F("Core/getStringFromTypedArray",["./defaultValue","./defined","./DeveloperError","./RuntimeError"],function(b,a,f,k){function g(k,m,e){if(!a(k))throw new f("uint8Array is required.");if(0>m)throw new f("byteOffset cannot be negative.");if(0>e)throw new f("byteLength cannot be negative.");if(m+e>k.byteLength)throw new f("sub-region exceeds array bounds.");m=b(m,0);e=b(e,k.byteLength-m);k=k.subarray(m,m+e);return g.decode(k)}g.decodeWithTextDecoder=function(a){return(new TextDecoder("utf-8")).decode(a)};g.decodeWithFromCharCode=function(a){for(var b="",e=0,f=0,g=0,d=128,l=191,t=[],r=a.length,c=0;c<r;++c){var u=a[c];if(0===g){if(0<=u&&127>=u){t.push(u);continue}if(194<=u&&223>=u){g=1;e=u&31;continue}if(224<=u&&239>=u){224===u&&(d=160);237===u&&(l=159);g=2;e=u&15;continue}if(240<=u&&244>=u){240===u&&(d=144);244===u&&(l=143);g=3;e=u&7;continue}throw new k("String decoding failed.");}d<=u&&u<=l?(d=128,l=191,e=e<<6|u&63,++f,f===g&&(t.push(e),e=g=f=0)):(e=g=f=0,d=128,l=191,--c)}a=t.length;for(e=0;e<a;++e)f=t[e],65535>=f?b+=String.fromCharCode(f):(f-=65536,b+=String.fromCharCode((f>>10)+55296,(f&1023)+56320));return b};g.decode="undefined"!==typeof TextDecoder?g.decodeWithTextDecoder:g.decodeWithFromCharCode;return g});F("Core/IndexDatatype",["./defined","./DeveloperError","./freezeObject","./Math","./WebGLConstants"],function(b,a,f,k,g){var l={UNSIGNED_BYTE:g.UNSIGNED_BYTE,UNSIGNED_SHORT:g.UNSIGNED_SHORT,UNSIGNED_INT:g.UNSIGNED_INT,getSizeInBytes:function(b){switch(b){case l.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case l.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case l.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT}throw new a("indexDatatype is required and must be a valid IndexDatatype constant.");},fromSizeInBytes:function(b){switch(b){case 2:return l.UNSIGNED_SHORT;case 4:return l.UNSIGNED_INT;case 1:return l.UNSIGNED_BYTE;default:throw new a("Size in bytes cannot be mapped to an IndexDatatype");}},validate:function(a){return b(a)&&(a===l.UNSIGNED_BYTE||a===l.UNSIGNED_SHORT||a===l.UNSIGNED_INT)},createTypedArray:function(f,e){if(!b(f))throw new a("numberOfVertices is required.");return f>=k.SIXTY_FOUR_KILOBYTES?new Uint32Array(e):new Uint16Array(e)},createTypedArrayFromArrayBuffer:function(f,e,h,g){if(!b(f))throw new a("numberOfVertices is required.");if(!b(e))throw new a("sourceArray is required.");if(!b(h))throw new a("byteOffset is required.");return f>=k.SIXTY_FOUR_KILOBYTES?new Uint32Array(e,h,g):new Uint16Array(e,h,g)}};return f(l)});F("Core/Intersections2D",["./Cartesian2","./Cartesian3","./Check","./defined","./DeveloperError"],function(b,a,f,k,g){return{clipTriangleAtAxisAlignedThreshold:function(a,b,e,f,p,d){if(!k(a))throw new g("threshold is required.");if(!k(b))throw new g("keepAbove is required.");if(!k(e))throw new g("u0 is required.");if(!k(f))throw new g("u1 is required.");if(!k(p))throw new g("u2 is required.");k(d)?d.length=0:d=[];var h,l;b?(b=e<a,h=f<a,l=p<a):(b=e>a,h=f>a,l=p>a);var m=b+h+l;1===m?b?(f=(a-e)/(f-e),e=(a-e)/(p-e),d.push(1),d.push(2),1!==e&&(d.push(-1),d.push(0),d.push(2),d.push(e)),1!==f&&(d.push(-1),d.push(0),d.push(1),d.push(f))):h?(p=(a-f)/(p-f),f=(a-f)/(e-f),d.push(2),d.push(0),1!==f&&(d.push(-1),d.push(1),d.push(0),d.push(f)),1!==p&&(d.push(-1),d.push(1),d.push(2),d.push(p))):l&&(e=(a-p)/(e-p),p=(a-p)/(f-p),d.push(0),d.push(1),1!==p&&(d.push(-1),d.push(2),d.push(1),d.push(p)),1!==e&&(d.push(-1),d.push(2),d.push(0),d.push(e))):2===m?b||e===a?h||f===a?l||p===a||(e=(a-e)/(p-e),p=(a-f)/(p-f),d.push(2),d.push(-1),d.push(0),d.push(2),d.push(e),d.push(-1),d.push(1),d.push(2),d.push(p)):(p=(a-p)/(f-p),f=(a-e)/(f-e),d.push(1),d.push(-1),d.push(2),d.push(1),d.push(p),d.push(-1),d.push(0),d.push(1),d.push(f)):(f=(a-f)/(e-f),e=(a-p)/(e-p),d.push(0),d.push(-1),d.push(1),d.push(0),d.push(f),d.push(-1),d.push(2),d.push(0),d.push(e)):3!==m&&(d.push(0),d.push(1),d.push(2));return d},computeBarycentricCoordinates:function(b,f,e,h,p,d,q,t,r){if(!k(b))throw new g("x is required.");if(!k(f))throw new g("y is required.");if(!k(e))throw new g("x1 is required.");if(!k(h))throw new g("y1 is required.");if(!k(p))throw new g("x2 is required.");if(!k(d))throw new g("y2 is required.");if(!k(q))throw new g("x3 is required.");if(!k(t))throw new g("y3 is required.");e-=q;p=q-p;d-=t;h-=t;var c=1/(d*e+p*h);f-=t;b-=q;q=(d*b+p*f)*c;e=(-h*b+e*f)*c;b=1-q-e;return k(r)?(r.x=q,r.y=e,r.z=b,r):new a(q,e,b)},computeLineSegmentLineSegmentIntersection:function(a,g,e,h,p,d,q,t,r){f.typeOf.number("x00",a);f.typeOf.number("y00",g);f.typeOf.number("x01",e);f.typeOf.number("y01",h);f.typeOf.number("x10",p);f.typeOf.number("y10",d);f.typeOf.number("x11",q);f.typeOf.number("y11",t);var c=(t-d)*(e-a)-(q-p)*(h-g);if(0!==c&&(q=((q-p)*(g-d)-(t-d)*(a-p))/c,p=((e-a)*(g-d)-(h-g)*(a-p))/c,0<=q&&1>=q&&0<=p&&1>=p))return k(r)||(r=new b),r.x=a+q*(e-a),r.y=g+q*(h-g),r}}});F("Core/QuantizedMeshTerrainData","../ThirdParty/when ./BoundingSphere ./Cartesian2 ./Cartesian3 ./defaultValue ./defined ./defineProperties ./DeveloperError ./IndexDatatype ./Intersections2D ./Math ./OrientedBoundingBox ./TaskProcessor ./TerrainEncoding ./TerrainMesh".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(a){function c(a,c){return h[a]-h[c]}function b(a,c){return f[a]-f[c]}if(!l(a)||!l(a.quantizedVertices))throw new e("options.quantizedVertices is required.");if(!l(a.indices))throw new e("options.indices is required.");if(!l(a.minimumHeight))throw new e("options.minimumHeight is required.");if(!l(a.maximumHeight))throw new e("options.maximumHeight is required.");if(!l(a.maximumHeight))throw new e("options.maximumHeight is required.");if(!l(a.boundingSphere))throw new e("options.boundingSphere is required.");if(!l(a.horizonOcclusionPoint))throw new e("options.horizonOcclusionPoint is required.");if(!l(a.westIndices))throw new e("options.westIndices is required.");if(!l(a.southIndices))throw new e("options.southIndices is required.");if(!l(a.eastIndices))throw new e("options.eastIndices is required.");if(!l(a.northIndices))throw new e("options.northIndices is required.");if(!l(a.westSkirtHeight))throw new e("options.westSkirtHeight is required.");if(!l(a.southSkirtHeight))throw new e("options.southSkirtHeight is required.");if(!l(a.eastSkirtHeight))throw new e("options.eastSkirtHeight is required.");if(!l(a.northSkirtHeight))throw new e("options.northSkirtHeight is required.");this._quantizedVertices=a.quantizedVertices;this._encodedNormals=a.encodedNormals;this._indices=a.indices;this._minimumHeight=a.minimumHeight;this._maximumHeight=a.maximumHeight;this._boundingSphere=a.boundingSphere;this._orientedBoundingBox=a.orientedBoundingBox;this._horizonOcclusionPoint=a.horizonOcclusionPoint;this._credits=a.credits;var d=this._quantizedVertices.length/3,f=this._uValues=this._quantizedVertices.subarray(0,d),h=this._vValues=this._quantizedVertices.subarray(d,2*d);this._heightValues=this._quantizedVertices.subarray(2*d,3*d);this._westIndices=y(a.westIndices,c,d);this._southIndices=y(a.southIndices,b,d);this._eastIndices=y(a.eastIndices,c,d);this._northIndices=y(a.northIndices,b,d);this._westSkirtHeight=a.westSkirtHeight;this._southSkirtHeight=a.southSkirtHeight;this._eastSkirtHeight=a.eastSkirtHeight;this._northSkirtHeight=a.northSkirtHeight;this._childTileMask=g(a.childTileMask,15);this._createdByUpsampling=g(a.createdByUpsampling,!1);this._waterMask=a.waterMask;this._mesh=void 0}function y(a,c,b){z.length=a.length;for(var d=!1,e=0,f=a.length;e<f;++e)z[e]=a[e],d=d||0<e&&0<c(a[e-1],a[e]);return d?(z.sort(c),h.createTypedArray(b,z)):a}function A(a,c,b,d,e,f,h,g){var k=Math.max(b,e,h),l=Math.min(d,f,g);d=Math.max(d,f,g);return a>=Math.min(b,e,h)&&a<=k&&c>=l&&c<=d}m(u.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){return this._waterMask}},childTileMask:{get:function(){return this._childTileMask}},canUpsample:{get:function(){return l(this._mesh)}}});var z=[],x=new t("createVerticesFromQuantizedTerrainMesh");u.prototype.createMesh=function(d,f,p,m,v){if(!l(d))throw new e("tilingScheme is required.");if(!l(f))throw new e("x is required.");if(!l(p))throw new e("y is required.");if(!l(m))throw new e("level is required.");var w=d.ellipsoid;d=d.tileXYToRectangle(f,p,m);v=g(v,1);w=x.scheduleTask({minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,quantizedVertices:this._quantizedVertices,octEncodedNormals:this._encodedNormals,includeWebMercatorT:!0,indices:this._indices,westIndices:this._westIndices,southIndices:this._southIndices,eastIndices:this._eastIndices,northIndices:this._northIndices,westSkirtHeight:this._westSkirtHeight,southSkirtHeight:this._southSkirtHeight,eastSkirtHeight:this._eastSkirtHeight,northSkirtHeight:this._northSkirtHeight,rectangle:d,relativeToCenter:this._boundingSphere.center,ellipsoid:w,exaggeration:v});if(l(w)){var u=this;return b(w,function(b){var d=u._quantizedVertices.length/3,d=d+(u._westIndices.length+u._southIndices.length+u._eastIndices.length+u._northIndices.length),d=h.createTypedArray(d,b.indices),e=new Float32Array(b.vertices),f=b.center,l=b.minimumHeight,p=b.maximumHeight,m=g(a.clone(b.boundingSphere),u._boundingSphere),w=g(q.clone(b.orientedBoundingBox),u._orientedBoundingBox),B=k.clone(u._horizonOcclusionPoint),C=b.vertexStride,z=r.clone(b.encoding);u._skirtIndex=b.skirtIndex;u._vertexCountWithoutSkirts=u._quantizedVertices.length/3;u._mesh=new c(f,e,d,l,p,m,B,C,w,z,v,b.westIndicesSouthToNorth,b.southIndicesEastToWest,b.eastIndicesNorthToSouth,b.northIndicesWestToEast);u._quantizedVertices=void 0;u._encodedNormals=void 0;u._indices=void 0;u._uValues=void 0;u._vValues=void 0;u._heightValues=void 0;u._westIndices=void 0;u._southIndices=void 0;u._eastIndices=void 0;u._northIndices=void 0;return u._mesh})}};var D=new t("upsampleQuantizedTerrainMesh");u.prototype.upsample=function(c,d,f,g,p,m,v){if(!l(c))throw new e("tilingScheme is required.");if(!l(d))throw new e("thisX is required.");if(!l(f))throw new e("thisY is required.");if(!l(g))throw new e("thisLevel is required.");if(!l(p))throw new e("descendantX is required.");if(!l(m))throw new e("descendantY is required.");if(!l(v))throw new e("descendantLevel is required.");if(1<v-g)throw new e("Upsampling through more than one level at a time is not currently supported.");g=this._mesh;if(l(this._mesh)){d=2*d!==p;f=2*f===m;var r=c.ellipsoid;c=c.tileXYToRectangle(p,m,v);c=D.scheduleTask({vertices:g.vertices,vertexCountWithoutSkirts:this._vertexCountWithoutSkirts,indices:g.indices,skirtIndex:this._skirtIndex,encoding:g.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:d,isNorthChild:f,childRectangle:c,ellipsoid:r,exaggeration:g.exaggeration});if(l(c)){p=Math.min(this._westSkirtHeight,this._eastSkirtHeight);p=Math.min(p,this._southSkirtHeight);p=Math.min(p,this._northSkirtHeight);var w=d?.5*p:this._westSkirtHeight,B=f?.5*p:this._southSkirtHeight,C=d?this._eastSkirtHeight:.5*p,z=f?this._northSkirtHeight:.5*p,y=this._credits;return b(c).then(function(c){var b=new Uint16Array(c.vertices),d=h.createTypedArray(b.length/3,c.indices),e;l(c.encodedNormals)&&(e=new Uint8Array(c.encodedNormals));return new u({quantizedVertices:b,indices:d,encodedNormals:e,minimumHeight:c.minimumHeight,maximumHeight:c.maximumHeight,boundingSphere:a.clone(c.boundingSphere),orientedBoundingBox:q.clone(c.orientedBoundingBox),horizonOcclusionPoint:k.clone(c.horizonOcclusionPoint),westIndices:c.westIndices,southIndices:c.southIndices,eastIndices:c.eastIndices,northIndices:c.northIndices,westSkirtHeight:w,southSkirtHeight:B,eastSkirtHeight:C,northSkirtHeight:z,childTileMask:0,credits:y,createdByUpsampling:!0})})}}};var v=new k;u.prototype.interpolateHeight=function(a,c,b){c=d.clamp((c-a.west)/a.width,0,1);c*=32767;b=d.clamp((b-a.south)/a.height,0,1);b*=32767;if(!l(this._mesh)){a:{a=c;c=this._uValues;for(var e=this._vValues,f=this._heightValues,h=this._indices,g=0,k=h.length;g<k;g+=3){var m=h[g],q=h[g+1],r=h[g+2],w=c[m],u=c[q],z=c[r],y=e[m],t=e[q],D=e[r];if(A(a,b,w,y,u,t,z,D)&&(w=p.computeBarycentricCoordinates(a,b,w,y,u,t,z,D,v),-1E-15<=w.x&&-1E-15<=w.y&&-1E-15<=w.z)){a=d.lerp(this._minimumHeight,this._maximumHeight,(w.x*f[m]+w.y*f[q]+w.z*f[r])/32767);break a}}a=void 0}return a}a:{f=b;e=this._mesh;a=e.vertices;b=e.encoding;g=e.indices;k=0;for(m=g.length;k<m;k+=3)if(q=g[k],h=g[k+1],e=g[k+2],r=b.decodeTextureCoordinates(a,q,B),w=b.decodeTextureCoordinates(a,h,C),u=b.decodeTextureCoordinates(a,e,I),A(c,f,r.x,r.y,w.x,w.y,u.x,u.y)&&(r=p.computeBarycentricCoordinates(c,f,r.x,r.y,w.x,w.y,u.x,u.y,v),-1E-15<=r.x&&-1E-15<=r.y&&-1E-15<=r.z)){c=b.decodeHeight(a,q);f=b.decodeHeight(a,h);a=b.decodeHeight(a,e);a=r.x*c+r.y*f+r.z*a;break a}a=void 0}return a};var B=new f,C=new f,I=new f;u.prototype.isChildAvailable=function(a,c,b,d){if(!l(a))throw new e("thisX is required.");if(!l(c))throw new e("thisY is required.");if(!l(b))throw new e("childX is required.");if(!l(d))throw new e("childY is required.");var f=2;b!==2*a&&++f;d!==2*c&&(f-=2);return 0!==(this._childTileMask&1<<f)};u.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};return u});F("Core/CesiumTerrainProvider","../ThirdParty/Uri ../ThirdParty/when ./AttributeCompression ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Credit ./defaultValue ./defined ./defineProperties ./DeveloperError ./Event ./GeographicTilingScheme ./getStringFromTypedArray ./HeightmapTerrainData ./IndexDatatype ./Math ./OrientedBoundingBox ./QuantizedMeshTerrainData ./Request ./RequestType ./Resource ./RuntimeError ./TerrainProvider ./TileAvailability ./TileProviderError".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H){function J(a){this.resource=a.resource;this.version=a.version;this.isHeightmap=a.isHeightmap;this.tileUrlTemplates=a.tileUrlTemplates;this.availability=a.availability;this.hasVertexNormals=a.hasVertexNormals;this.hasWaterMask=a.hasWaterMask;this.hasMetadata=a.hasMetadata;this.availabilityLevels=a.availabilityLevels;this.availabilityTilesLoaded=a.availabilityTilesLoaded;this.littleEndianExtensionSize=a.littleEndianExtensionSize;this.availabilityTilesLoaded=a.availabilityTilesLoaded;this.availabilityPromiseCache={}}function w(c){function b(c){var d;if(c.format){if(c.tiles&&0!==c.tiles.length){var e=!1,g=!1,k=!1,p=!0,m=!1;if("heightmap-1.0"===c.format)m=!0,h(w._heightmapStructure)||(w._heightmapStructure={heightScale:.2,heightOffset:-1E3,elementsPerHeight:1,stride:1,elementMultiplier:256,isBigEndian:!1,lowestEncodedHeight:0,highestEncodedHeight:65535}),g=!0,w._requestWaterMask=!0;else if(0!==c.format.indexOf("quantized-mesh-1.")){d='The tile format "'+c.format+'" is invalid or not supported.';z=H.handleError(z,w,w._errorEvent,d,void 0,void 0,void 0,l);return}var q=c.tiles,v=c.maxzoom;x=Math.max(x,v);var r;h(c.extensions)&&-1!==c.extensions.indexOf("octvertexnormals")?e=!0:h(c.extensions)&&-1!==c.extensions.indexOf("vertexnormals")&&(e=!0,p=!1);h(c.extensions)&&-1!==c.extensions.indexOf("watermask")&&(g=!0);h(c.extensions)&&-1!==c.extensions.indexOf("metadata")&&(k=!0);var C=c.metadataAvailability,t=c.available;if(h(t)&&!h(C))for(d=new I(w._tilingScheme,t.length),v=0;v<t.length;++v){var G=t[v],A=w._tilingScheme.getNumberOfYTilesAtLevel(v);h(D[v])||(D[v]=[]);for(var L=0;L<G.length;++L){var K=G[L],O=A-K.endY-1,P=A-K.startY-1;D[v].push([K.startX,O,K.endX,P]);d.addAvailableTileRange(v,K.startX,O,K.endX,P)}}else h(C)&&(r=new I(w._tilingScheme,v),d=new I(w._tilingScheme,v),D[0]=[[0,0,1,0]],d.addAvailableTileRange(0,0,0,1,0));w._hasWaterMask=w._hasWaterMask||g;w._hasVertexNormals=w._hasVertexNormals||e;w._hasMetadata=w._hasMetadata||k;h(c.attribution)&&(0<E.length&&(E+=" "),E+=c.attribution);y.push(new J({resource:u,version:c.version,isHeightmap:m,tileUrlTemplates:q,availability:d,hasVertexNormals:e,hasWaterMask:g,hasMetadata:k,availabilityLevels:C,availabilityTilesLoaded:r,littleEndianExtensionSize:p}));c=c.parentUrl;if(h(c)){if(!h(d))return console.log("A layer.json can't have a parentUrl if it does't have an available array."),a.resolve();u=u.getDerivedResource({url:c});u.appendForwardSlash();B=u.getDerivedResource({url:"layer.json"});d=B.fetchJson();return a(d,b,f)}return a.resolve()}z=H.handleError(z,w,w._errorEvent,"The layer.json file does not specify any tile URL templates.",void 0,void 0,void 0,l)}else z=H.handleError(z,w,w._errorEvent,"The tile format is not specified in the layer.json file.",void 0,void 0,void 0,l)}function f(a){z=H.handleError(z,w,w._errorEvent,"An error occurred while accessing "+B.url+".",void 0,void 0,void 0,l)}function g(a){b(a).then(function(){if(!h(z)){var a=D.length;if(0<a)for(var c=w._availability=new I(w._tilingScheme,x),b=0;b<a;++b)for(var d=D[b],e=0;e<d.length;++e){var f=d[e];c.addAvailableTileRange(b,f[0],f[1],f[2],f[3])}0<E.length&&(a=new m(E),h(w._tileCredits)?w._tileCredits.push(a):w._tileCredits=[a]);w._ready=!0;w._readyPromise.resolve(!0)}})}function k(a){h(a)&&404===a.statusCode?g({tilejson:"2.1.0",format:"heightmap-1.0",version:"1.0.0",scheme:"tms",tiles:["{z}/{x}/{y}.terrain?v\x3d{version}"]}):f(a)}function l(){a(B.fetchJson()).then(g).otherwise(k)}if(!h(c)||!h(c.url))throw new d("options.url is required.");this._tilingScheme=new t({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:1,ellipsoid:c.ellipsoid});this._heightmapWidth=65;this._levelZeroMaximumGeometricError=C.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,this._heightmapWidth,this._tilingScheme.getNumberOfXTilesAtLevel(0));this._heightmapStructure=void 0;this._hasVertexNormals=this._hasWaterMask=!1;this._maxTerrainLevel=e(c.maxTerrainLevel,8);this._mapMaxTerrainTiles=new Map;this._requestVertexNormals=e(c.requestVertexNormals,!1);this._requestWaterMask=e(c.requestWaterMask,!1);this._requestMetadata=e(c.requestMetadata,!0);this._errorEvent=new q;var p=c.credit;"string"===typeof p&&(p=new m(p));this._credit=p;this._availability=void 0;var r=a.defer();this._ready=!1;this._readyPromise=r;this._tileCredits=void 0;var w=this,u,B,z,y=this._layers=[],E="",D=[],x=0;a(c.url).then(function(a){a=v.createIfNeeded(a);a.appendForwardSlash();u=a;B=u.getDerivedResource({url:"layer.json"});w._tileCredits=a.credits;l()}).otherwise(function(a){r.reject(a)})}function G(a){return h(a)&&0!==a.length?{Accept:"application/vnd.quantized-mesh;extensions\x3d"+a.join("-")+",application/octet-stream;q\x3d0.9,*/*;q\x3d0.01"}:{Accept:"application/vnd.quantized-mesh,application/octet-stream;q\x3d0.9,*/*;q\x3d0.01"}}function E(b,d,e,g,p,m){if(!h(p))return a.reject(new B("Terrain tile doesn't exist"));var q=p.tileUrlTemplates;if(0!==q.length){var v=b._tilingScheme.getNumberOfYTilesAtLevel(g)-e-1,w=[];b._requestVertexNormals&&p.hasVertexNormals&&w.push(p.littleEndianExtensionSize?"octvertexnormals":"vertexnormals");b._requestWaterMask&&p.hasWaterMask&&w.push("watermask");b._requestMetadata&&p.hasMetadata&&w.push("metadata");var C,q=q[(d+v+g)%q.length],t=p.resource;h(t._ionEndpoint)&&!h(t._ionEndpoint.externalType)?(0!==w.length&&(C={extensions:w.join("-")}),w=G(void 0)):w=G(w);m=t.getDerivedResource({url:q,templateValues:{version:p.version,z:g,x:d,y:v},queryParameters:C,headers:w,request:m}).fetchArrayBuffer();if(h(m))return m.then(function(a){if(h(b._heightmapStructure)){var m=new Uint16Array(a,0,b._heightmapWidth*b._heightmapWidth);return new c({buffer:m,childTileMask:(new Uint8Array(a,m.byteLength,1))[0],waterMask:new Uint8Array(a,m.byteLength+1,a.byteLength-m.byteLength-1),width:b._heightmapWidth,height:b._heightmapWidth,structure:b._heightmapStructure,credits:b._tileCredits})}var q=p.littleEndianExtensionSize,v=0,w=3*Float64Array.BYTES_PER_ELEMENT,B=4*Float64Array.BYTES_PER_ELEMENT,C=3*Uint16Array.BYTES_PER_ELEMENT,t=Uint16Array.BYTES_PER_ELEMENT,E=3*t,D=new DataView(a),m=new l(D.getFloat64(v,!0),D.getFloat64(v+8,!0),D.getFloat64(v+16,!0)),v=v+w,x=D.getFloat32(v,!0),v=v+Float32Array.BYTES_PER_ELEMENT,G=D.getFloat32(v,!0),v=v+Float32Array.BYTES_PER_ELEMENT,I=new k(new l(D.getFloat64(v,!0),D.getFloat64(v+8,!0),D.getFloat64(v+16,!0)),D.getFloat64(v+w,!0)),v=v+B,B=new l(D.getFloat64(v,!0),D.getFloat64(v+8,!0),D.getFloat64(v+16,!0)),v=v+w,H=D.getUint32(v,!0),v=v+Uint32Array.BYTES_PER_ELEMENT,w=new Uint16Array(a,v,3*H),v=v+H*C;65536<H&&(t=Uint32Array.BYTES_PER_ELEMENT,E=3*t);var C=w.subarray(0,H),L=w.subarray(H,2*H),K=w.subarray(2*H,3*H);f.zigZagDeltaDecode(C,L,K);0!==v%t&&(v+=t-v%t);L=D.getUint32(v,!0);v+=Uint32Array.BYTES_PER_ELEMENT;C=u.createTypedArrayFromArrayBuffer(H,a,v,3*L);v+=L*E;E=0;L=C.length;for(K=0;K<L;++K){var J=C[K];C[K]=E-J;0===J&&++E}for(var L=D.getUint32(v,!0),v=v+Uint32Array.BYTES_PER_ELEMENT,E=u.createTypedArrayFromArrayBuffer(H,a,v,L),v=v+L*t,K=D.getUint32(v,!0),v=v+Uint32Array.BYTES_PER_ELEMENT,L=u.createTypedArrayFromArrayBuffer(H,a,v,K),v=v+K*t,J=D.getUint32(v,!0),v=v+Uint32Array.BYTES_PER_ELEMENT,K=u.createTypedArrayFromArrayBuffer(H,a,v,J),v=v+J*t,O=D.getUint32(v,!0),v=v+Uint32Array.BYTES_PER_ELEMENT,J=u.createTypedArrayFromArrayBuffer(H,a,v,O),v=v+O*t,N,Q;v<D.byteLength;){O=D.getUint8(v,!0);v+=Uint8Array.BYTES_PER_ELEMENT;t=D.getUint32(v,q);v+=Uint32Array.BYTES_PER_ELEMENT;if(O===P.OCT_VERTEX_NORMALS&&b._requestVertexNormals)N=new Uint8Array(a,v,2*H);else if(O===P.WATER_MASK&&b._requestWaterMask)Q=new Uint8Array(a,v,t);else if(O===P.METADATA&&b._requestMetadata){O=D.getUint32(v,!0);if(0<O&&(O=r(new Uint8Array(a),v+Uint32Array.BYTES_PER_ELEMENT,O),O=JSON.parse(O).available,h(O)))for(var M=0;M<O.length;++M)for(var S=g+M+1,R=O[M],ca=b._tilingScheme.getNumberOfYTilesAtLevel(S),aa=0;aa<R.length;++aa){var Y=R[aa],W=ca-Y.endY-1,Z=ca-Y.startY-1;b.availability.addAvailableTileRange(S,Y.startX,W,Y.endX,Z);p.availability.addAvailableTileRange(S,Y.startX,W,Y.endX,Z)}p.availabilityTilesLoaded.addAvailableTileRange(g,d,e,d,e)}v+=t}a=5*b.getLevelMaximumGeometricError(g);var q=b._tilingScheme.tileXYToRectangle(d,e,g),U;q.width<y.PI_OVER_TWO+y.EPSILON5&&(U=A.fromRectangle(q,x,G,b._tilingScheme.ellipsoid));return new z({center:m,minimumHeight:x,maximumHeight:G,boundingSphere:I,orientedBoundingBox:U,horizonOcclusionPoint:B,quantizedVertices:w,encodedNormals:N,indices:C,westIndices:E,southIndices:L,eastIndices:K,northIndices:J,westSkirtHeight:a,southSkirtHeight:a,eastSkirtHeight:a,northSkirtHeight:a,childTileMask:b.availability.computeChildMaskForTile(g,d,e),waterMask:Q,credits:b._tileCredits})})}}function L(a,c,b,d){if(0!==d)return a=a.availabilityLevels,a=0===d%a?d-a:(d/a|0)*a,d=1<<d-a,{level:a,x:c/d|0,y:b/d|0}}function K(a,c,b,d,e,f){if(!h(e.availabilityLevels))return{result:!1};var g,k=function(){delete e.availabilityPromiseCache[g]},l=e.availabilityTilesLoaded,p=e.availability;for(c=L(e,c,b,d);h(c);){if(p.isTileAvailable(c.level,c.x,c.y)&&!l.isTileAvailable(c.level,c.x,c.y)){var m;f||(g=c.level+"-"+c.x+"-"+c.y,m=e.availabilityPromiseCache[g],h(m)||(f=new x({throttle:!0,throttleByServer:!0,type:D.TERRAIN}),m=E(a,c.x,c.y,c.level,e,f),h(m)&&(e.availabilityPromiseCache[g]=m,m.then(k))));return{result:!0,promise:m}}c=L(e,c.x,c.y,c.level)}return{result:!1}}var P={OCT_VERTEX_NORMALS:1,WATER_MASK:2,METADATA:4};w.prototype.requestTileGeometry=function(a,c,b,e){if(!this._ready)throw new d("requestTileGeometry must not be called before the terrain provider is ready.");var f=this._layers,g,k=f.length;if(1===k)g=f[0];else for(var l=0;l<k;++l){var p=f[l];if(!h(p.availability)||p.availability.isTileAvailable(b,a,c)){g=p;break}}return E(this,a,c,b,g,e)};p(w.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new d("credit must not be called before the terrain provider is ready.");return this._credit}},tilingScheme:{get:function(){if(!this._ready)throw new d("tilingScheme must not be called before the terrain provider is ready.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){if(!this._ready)throw new d("hasWaterMask must not be called before the terrain provider is ready.");return this._hasWaterMask&&this._requestWaterMask}},hasVertexNormals:{get:function(){if(!this._ready)throw new d("hasVertexNormals must not be called before the terrain provider is ready.");return this._hasVertexNormals&&this._requestVertexNormals}},hasMetadata:{get:function(){if(!this._ready)throw new d("hasMetadata must not be called before the terrain provider is ready.");return this._hasMetadata&&this._requestMetadata}},requestVertexNormals:{get:function(){return this._requestVertexNormals}},requestWaterMask:{get:function(){return this._requestWaterMask}},requestMetadata:{get:function(){return this._requestMetadata}},availability:{get:function(){if(!this._ready)throw new d("availability must not be called before the terrain provider is ready.");return this._availability}}});w.prototype.getLevelMaximumGeometricError=function(a){return this._levelZeroMaximumGeometricError/(1<<a)};w.prototype.getTileDataAvailable=function(a,c,b){if(h(this._availability)){if(b>this._availability._maximumLevel)return!1;if(this._availability.isTileAvailable(b,a,c))return!0;if(!this._hasMetadata)return!1;for(var d=this._layers,e=d.length,f=0;f<e;++f)if(K(this,a,c,b,d[f],0===f).result)return;return!1}};w.prototype.loadTileDataAvailability=function(a,c,b){if(h(this._availability)&&!(b>this._availability._maximumLevel)&&!this._availability.isTileAvailable(b,a,c)&&this._hasMetadata)for(var d=this._layers,e=d.length,f=0;f<e;++f){var g=K(this,a,c,b,d[f],0===f);if(h(g.promise))return g.promise}};w._getAvailabilityTile=L;return w});F("Core/EllipseGeometryLibrary",["./Cartesian3","./Math","./Matrix3","./Quaternion"],function(b,a,f,k){function g(a,c,d,g,l,q,r,u,y,t){c=a+c;b.multiplyByScalar(g,Math.cos(c),m);b.multiplyByScalar(d,Math.sin(c),e);b.add(m,e,m);d=Math.cos(a);a=Math.sin(a);k.fromAxisAngle(m,q/Math.sqrt(r*d*d+l*a*a)/u,h);f.fromQuaternion(h,p);f.multiplyByVector(p,y,t);b.normalize(t,t);b.multiplyByScalar(t,u,t);return t}var l={},m=new b,e=new b,h=new k,p=new f,d=new b,q=new b,t=new b,r=new b;l.raisePositionsToHeight=function(a,c,e){var f=c.ellipsoid,h=c.height;c=c.extrudedHeight;for(var g=new Float64Array(3*(e?a.length/3*2:a.length/3)),k=a.length,l=e?k:0,p=0;p<k;p+=3){var m=p+1,w=p+2,u=b.fromArray(a,p,d);f.scaleToGeodeticSurface(u,u);var z=b.clone(u,q),y=f.geodeticSurfaceNormal(u,r),x=b.multiplyByScalar(y,h,t);b.add(u,x,u);e&&(b.multiplyByScalar(y,c,x),b.add(z,x,z),g[p+l]=z.x,g[m+l]=z.y,g[w+l]=z.z);g[p]=u.x;g[m]=u.y;g[w]=u.z}return g};var c=new b,u=new b,y=new b;l.computeEllipsePositions=function(e,f,h){var k=e.semiMinorAxis,l=e.semiMajorAxis,p=e.rotation,m=e.center,r=8*e.granularity;e=k*k;var z=l*l,k=l*k,l=b.magnitude(m),x=b.normalize(m,c),m=b.cross(b.UNIT_Z,m,u),m=b.normalize(m,m),w=b.cross(x,m,y),r=1+Math.ceil(a.PI_OVER_TWO/r),G=a.PI_OVER_TWO/(r-1),E=a.PI_OVER_TWO-r*G;0>E&&(r-=Math.ceil(Math.abs(E)/G));var A=f?Array(r*(r+2)*6):void 0,K=0,P=d,N=q,O=12*r,Z=O-1,aa=0,O=h?Array(O):void 0,U,W,M,E=a.PI_OVER_TWO,P=g(E,p,w,m,e,k,z,l,x,P);f&&(A[K++]=P.x,A[K++]=P.y,A[K++]=P.z);h&&(O[Z--]=P.z,O[Z--]=P.y,O[Z--]=P.x);E=a.PI_OVER_TWO-G;for(U=1;U<r+1;++U){P=g(E,p,w,m,e,k,z,l,x,P);N=g(Math.PI-E,p,w,m,e,k,z,l,x,N);if(f){A[K++]=P.x;A[K++]=P.y;A[K++]=P.z;W=2*U+2;for(E=1;E<W-1;++E)M=E/(W-1),M=b.lerp(P,N,M,t),A[K++]=M.x,A[K++]=M.y,A[K++]=M.z;A[K++]=N.x;A[K++]=N.y;A[K++]=N.z}h&&(O[Z--]=P.z,O[Z--]=P.y,O[Z--]=P.x,O[aa++]=N.x,O[aa++]=N.y,O[aa++]=N.z);E=a.PI_OVER_TWO-(U+1)*G}for(U=r;1<U;--U){E=a.PI_OVER_TWO-(U-1)*G;P=g(-E,p,w,m,e,k,z,l,x,P);N=g(E+Math.PI,p,w,m,e,k,z,l,x,N);if(f){A[K++]=P.x;A[K++]=P.y;A[K++]=P.z;W=2*(U-1)+2;for(E=1;E<W-1;++E)M=E/(W-1),M=b.lerp(P,N,M,t),A[K++]=M.x,A[K++]=M.y,A[K++]=M.z;A[K++]=N.x;A[K++]=N.y;A[K++]=N.z}h&&(O[Z--]=P.z,O[Z--]=P.y,O[Z--]=P.x,O[aa++]=N.x,O[aa++]=N.y,O[aa++]=N.z)}E=a.PI_OVER_TWO;P=g(-E,p,w,m,e,k,z,l,x,P);p={};f&&(A[K++]=P.x,A[K++]=P.y,A[K++]=P.z,p.positions=A,p.numPts=r);h&&(O[Z--]=P.z,O[Z--]=P.y,O[Z--]=P.x,p.outerPositions=O);return p};return l});F("Core/GeometryInstance",["./defaultValue","./defined","./DeveloperError","./Matrix4"],function(b,a,f,k){return function(g){g=b(g,b.EMPTY_OBJECT);if(!a(g.geometry))throw new f("options.geometry is required.");this.geometry=g.geometry;this.modelMatrix=k.clone(b(g.modelMatrix,k.IDENTITY));this.id=g.id;this.pickPrimitive=g.pickPrimitive;this.attributes=b(g.attributes,{});this.eastHemisphereGeometry=this.westHemisphereGeometry=void 0}});F("Core/EncodedCartesian3",["./Cartesian3","./Check","./defined"],function(b,a,f){function k(){this.high=b.clone(b.ZERO);this.low=b.clone(b.ZERO)}k.encode=function(b,e){a.typeOf.number("value",b);f(e)||(e={high:0,low:0});var h;0<=b?(h=65536*Math.floor(b/65536),e.high=h,e.low=b-h):(h=65536*Math.floor(-b/65536),e.high=-h,e.low=b+h);return e};var g={high:0,low:0};k.fromCartesian=function(b,e){a.typeOf.object("cartesian",b);f(e)||(e=new k);var h=e.high,l=e.low;k.encode(b.x,g);h.x=g.high;l.x=g.low;k.encode(b.y,g);h.y=g.high;l.y=g.low;k.encode(b.z,g);h.z=g.high;l.z=g.low;return e};var l=new k;k.writeElements=function(b,e,f){a.defined("cartesianArray",e);a.typeOf.number("index",f);a.typeOf.number.greaterThanOrEquals("index",f,0);k.fromCartesian(b,l);b=l.high;var h=l.low;e[f]=b.x;e[f+1]=b.y;e[f+2]=b.z;e[f+3]=h.x;e[f+4]=h.y;e[f+5]=h.z};return k});F("Core/Tipsify",["./defaultValue","./defined","./DeveloperError"],function(b,a,f){return{calculateACMR:function(k){k=b(k,b.EMPTY_OBJECT);var g=k.indices,l=k.maximumIndex;k=b(k.cacheSize,24);if(!a(g))throw new f("indices is required.");var m=g.length;if(3>m||0!==m%3)throw new f("indices length must be a multiple of three.");if(0>=l)throw new f("maximumIndex must be greater than zero.");if(3>k)throw new f("cacheSize must be greater than two.");if(!a(l))for(var e=l=0,h=g[e];e<m;)h>l&&(l=h),++e,h=g[e];e=[];for(h=0;h<l+1;h++)e[h]=0;l=k+1;for(h=0;h<m;++h)l-e[g[h]]>k&&(e[g[h]]=l,++l);return(l-k+1)/(m/3)},tipsify:function(k){k=b(k,b.EMPTY_OBJECT);var g=k.indices,l=k.maximumIndex;k=b(k.cacheSize,24);if(!a(g))throw new f("indices is required.");var m=g.length;if(3>m||0!==m%3)throw new f("indices length must be a multiple of three.");if(0>=l)throw new f("maximumIndex must be greater than zero.");if(3>k)throw new f("cacheSize must be greater than two.");var e=0,h=0,p=g[h];if(a(l))e=l+1;else{for(;h<m;)p>e&&(e=p),++h,p=g[h];if(-1===e)return 0;++e}var p=[],d;for(d=0;d<e;d++)p[d]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};for(var q=h=0;h<m;)p[g[h]].vertexTriangles.push(q),++p[g[h]].numLiveTriangles,p[g[h+1]].vertexTriangles.push(q),++p[g[h+1]].numLiveTriangles,p[g[h+2]].vertexTriangles.push(q),++p[g[h+2]].numLiveTriangles,++q,h+=3;var h=0,t=k+1,l=1,r=[],c,u,y=0,A=[];u=m/3;m=[];for(d=0;d<u;d++)m[d]=!1;for(var z;-1!==h;){d=[];u=p[h];z=u.vertexTriangles.length;for(var x=0;x<z;++x)if(q=u.vertexTriangles[x],!m[q])for(m[q]=!0,h=q+q+q,q=0;3>q;++q)c=g[h],d.push(c),r.push(c),A[y]=c,++y,c=p[c],--c.numLiveTriangles,t-c.timeStamp>k&&(c.timeStamp=t,++t),++h;h=p;u=r;z=e;c=x=-1;for(var D=0;D<d.length;){var v=d[D];h[v].numLiveTriangles&&(q=0,t-h[v].timeStamp+2*h[v].numLiveTriangles<=k&&(q=t-h[v].timeStamp),q>c||-1===c)&&(c=q,x=v);++D}if(-1===x){b:{for(;1<=u.length;)if(d=u[u.length-1],u.splice(u.length-1,1),0<h[d].numLiveTriangles)break b;for(;l<z;){if(0<h[l].numLiveTriangles){++l;d=l-1;break b}++l}d=-1}h=d}else h=x}return A}}});F("Core/GeometryPipeline","./AttributeCompression ./barycentricCoordinates ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Cartesian4 ./Cartographic ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./EncodedCartesian3 ./GeographicProjection ./Geometry ./GeometryAttribute ./GeometryType ./IndexDatatype ./Intersect ./IntersectionTests ./Math ./Matrix3 ./Matrix4 ./Plane ./PrimitiveType ./Tipsify".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I){function H(a,c,b,d,e){a[c++]=b;a[c++]=d;a[c++]=d;a[c++]=e;a[c++]=e;a[c]=b}function J(a){var b={},d;for(d in a)if(a.hasOwnProperty(d)&&p(a[d])&&p(a[d].values)){var e=a[d];b[d]=new c({componentDatatype:e.componentDatatype,componentsPerAttribute:e.componentsPerAttribute,normalize:e.normalize,values:[]})}return b}function w(a,c){if(p(c))for(var b=c.values,d=b.length,e=0;e<d;e+=3)g.unpack(b,e,da),v.multiplyByPoint(a,da,da),g.pack(da,b,e)}function G(a,c){if(p(c))for(var b=c.values,d=b.length,e=0;e<d;e+=3)g.unpack(b,e,da),D.multiplyByVector(a,da,da),da=g.normalize(da,da),g.pack(da,b,e)}function E(a,b){var h=a.length,k,l,m,q,w=a[0].modelMatrix,u=p(a[0][b].indices),B=a[0][b].primitiveType;for(l=1;l<h;++l){if(!v.equals(a[l].modelMatrix,w))throw new d("All instances must have the same modelMatrix.");if(p(a[l][b].indices)!==u)throw new d("All instance geometries must have an indices or not have one.");if(a[l][b].primitiveType!==B)throw new d("All instance geometries must have the same primitiveType.");}l=a.length;w={};m=a[0][b].attributes;for(q in m)if(m.hasOwnProperty(q)&&p(m[q])&&p(m[q].values)){for(var z=m[q],t=z.values.length,E=!0,D=1;D<l;++D){var x=a[D][b].attributes[q];if(!p(x)||z.componentDatatype!==x.componentDatatype||z.componentsPerAttribute!==x.componentsPerAttribute||z.normalize!==x.normalize){E=!1;break}t+=x.values.length}E&&(w[q]=new c({componentDatatype:z.componentDatatype,componentsPerAttribute:z.componentsPerAttribute,normalize:z.normalize,values:e.createTypedArray(z.componentDatatype,t)}))}for(k in w)if(w.hasOwnProperty(k))for(z=w[k].values,l=q=0;l<h;++l)for(t=a[l][b].attributes[k].values,E=t.length,m=0;m<E;++m)z[q++]=t[m];var G;if(u){for(l=G=0;l<h;++l)G+=a[l][b].indices.length;l=r.computeNumberOfVertices(new r({attributes:w,primitiveType:C.POINTS}));G=y.createTypedArray(l,G);for(l=u=k=0;l<h;++l){m=a[l][b].indices;z=m.length;for(q=0;q<z;++q)G[k++]=u+m[q];u+=r.computeNumberOfVertices(a[l][b])}}k=new g;for(l=u=0;l<h;++l){q=a[l][b].boundingSphere;if(!p(q)){k=void 0;break}g.add(q.center,k,k)}if(p(k))for(g.divideByScalar(k,h,k),l=0;l<h;++l)q=a[l][b].boundingSphere,q=g.magnitude(g.subtract(q.center,k,X))+q.radius,q>u&&(u=q);return new r({attributes:w,indices:G,primitiveType:B,boundingSphere:p(k)?new f(k,u):void 0})}function L(a,c){Math.abs(a.y)<x.EPSILON6&&(a.y=c?-x.EPSILON6:x.EPSILON6)}function K(a,c,b,d){g.add(a,g.multiplyByScalar(g.subtract(c,a,wa),a.y/(a.y-c.y),wa),b);g.clone(b,d);L(b,!0);L(d,!1)}function P(a,c){var b=a.attributes;if(0!==b.position.values.length){for(var d in b)if(b.hasOwnProperty(d)&&p(b[d])&&p(b[d].values)){var h=b[d];h.values=e.createTypedArray(h.componentDatatype,h.values)}d=r.computeNumberOfVertices(a);a.indices=y.createTypedArray(d,a.indices);c&&(a.boundingSphere=f.fromVertices(b.position.values));return a}}function N(a){var b=a.attributes,d={},e;for(e in b)if(b.hasOwnProperty(e)&&p(b[e])&&p(b[e].values)){var f=b[e];d[e]=new c({componentDatatype:f.componentDatatype,componentsPerAttribute:f.componentsPerAttribute,normalize:f.normalize,values:[]})}return new r({attributes:d,indices:[],primitiveType:a.primitiveType})}function O(a,c,b){var d=p(a.geometry.boundingSphere);c=P(c,d);b=P(b,d);p(b)&&!p(c)?a.geometry=b:!p(b)&&p(c)?a.geometry=c:(a.westHemisphereGeometry=c,a.eastHemisphereGeometry=b,a.geometry=void 0)}function Z(a,c){var b=new a,d=new a,e=new a;return function(f,h,g,k,l,p,m,q){f=a.fromArray(l,f*c,b);h=a.fromArray(l,h*c,d);g=a.fromArray(l,g*c,e);a.multiplyByScalar(f,k.x,f);a.multiplyByScalar(h,k.y,h);a.multiplyByScalar(g,k.z,g);k=a.add(f,h,f);a.add(k,g,k);q&&a.normalize(k,k);a.pack(k,p,m*c)}}function aa(c,b,d,e,f,h,k,l,m,q,v,r,w,u,B,C){if(p(h)||p(k)||p(l)||p(m)||p(q)||0!==u){var z=g.fromArray(f,3*c,Aa),y=g.fromArray(f,3*b,Ua);f=g.fromArray(f,3*d,sa);e=a(e,z,y,f,Va);p(h)&&Ca(c,b,d,e,h,r.normal.values,C,!0);p(q)&&(h=g.fromArray(q,3*c,Aa),z=g.fromArray(q,3*b,Ua),q=g.fromArray(q,3*d,sa),g.multiplyByScalar(h,e.x,h),g.multiplyByScalar(z,e.y,z),g.multiplyByScalar(q,e.z,q),g.equals(h,g.ZERO)&&g.equals(z,g.ZERO)&&g.equals(q,g.ZERO)?(h=Aa,h.x=0,h.y=0,h.z=0):(h=g.add(h,z,h),g.add(h,q,h),g.normalize(h,h)),g.pack(h,r.extrudeDirection.values,3*C));p(v)&&(r.applyOffset.values[C]=v[c]*e.x+v[b]*e.y+v[d]*e.z>x.EPSILON6?1:0);p(k)&&Ca(c,b,d,e,k,r.tangent.values,C,!0);p(l)&&Ca(c,b,d,e,l,r.bitangent.values,C,!0);p(m)&&ya(c,b,d,e,m,r.st.values,C);if(0<u)for(k=0;k<u;k++)switch(f=w[k],l=c,m=b,v=d,q=e,h=C,z=B[f],y=z.values,f=r[f].values,z.componentsPerAttribute){case 4:Ga(l,m,v,q,y,f,h,!1);break;case 3:Ca(l,m,v,q,y,f,h,!1);break;case 2:ya(l,m,v,q,y,f,h,!1);break;default:f[h]=y[l]*q.x+y[m]*q.y+y[v]*q.z}}}function U(a,c,b,d,e,f){var h=a.position.values.length/3;if(-1!==e){d=d[e];e=b[d];if(-1===e)return b[d]=h,a.position.values.push(f.x,f.y,f.z),c.push(h),h;c.push(e);return e}a.position.values.push(f.x,f.y,f.z);c.push(h);return h}function W(a){var c=a.geometry,b=c.attributes,d=b.position.values,e=p(b.normal)?b.normal.values:void 0,f=p(b.bitangent)?b.bitangent.values:void 0,h=p(b.tangent)?b.tangent.values:void 0,k=p(b.st)?b.st.values:void 0,l=p(b.extrudeDirection)?b.extrudeDirection.values:void 0,m=p(b.applyOffset)?b.applyOffset.values:void 0,q=c.indices,v=[],r;for(r in b)b.hasOwnProperty(r)&&!xa[r]&&p(b[r])&&v.push(r);r=v.length;var w=N(c),c=N(c),u,B,C,z,y,t=[];t.length=d.length/3;var E=[];E.length=d.length/3;for(y=0;y<t.length;++y)t[y]=-1,E[y]=-1;var D=q.length;for(y=0;y<D;y+=3){var G=q[y],A=q[y+1],H=q[y+2],I=g.fromArray(d,3*G),J=g.fromArray(d,3*A),P=g.fromArray(d,3*H);u=I;B=J;C=P;if(0<=u.x||0<=B.x||0<=C.x)u=void 0;else{z=u;var T=B,Q=C;if(0!==z.y&&0!==T.y&&0!==Q.y)L(z,0>z.y),L(T,0>T.y),L(Q,0>Q.y);else{var M=Math.abs(z.y),S=Math.abs(T.y),R=Math.abs(Q.y),M=0>(M>S?M>R?x.sign(z.y):x.sign(Q.y):S>R?x.sign(T.y):x.sign(Q.y));L(z,M);L(T,M);L(Q,M)}T=0>u.y;Q=0>B.y;M=0>C.y;z=0+(T?1:0)+(Q?1:0);z+=M?1:0;S=Ea.indices;1===z?(S[1]=3,S[2]=4,S[5]=6,S[7]=6,S[8]=5,T?(K(u,B,za,Ba),K(u,C,Da,ra),S[0]=0,S[3]=1,S[4]=2,S[6]=1):Q?(K(B,C,za,Ba),K(B,u,Da,ra),S[0]=1,S[3]=2,S[4]=0,S[6]=2):M&&(K(C,u,za,Ba),K(C,B,Da,ra),S[0]=2,S[3]=0,S[4]=1,S[6]=0)):2===z&&((S[2]=4,S[4]=4,S[5]=3,S[7]=5,S[8]=6,T)?Q?M||(K(C,u,za,Ba),K(C,B,Da,ra),S[0]=0,S[1]=1,S[3]=0,S[6]=2):(K(B,C,za,Ba),K(B,u,Da,ra),S[0]=2,S[1]=0,S[3]=2,S[6]=1):(K(u,B,za,Ba),K(u,C,Da,ra),S[0]=1,S[1]=2,S[3]=1,S[6]=0));T=Ea.positions;T[0]=u;T[1]=B;T[2]=C;T.length=3;if(1===z||2===z)T[3]=za,T[4]=Da,T[5]=Ba,T[6]=ra,T.length=7;u=Ea}if(p(u)&&3<u.positions.length)for(I=u.positions,J=u.indices,P=J.length,T=0;T<P;++T)z=J[T],Q=I[z],0>Q.y?(u=c.attributes,B=c.indices,C=t):(u=w.attributes,B=w.indices,C=E),z=U(u,B,C,q,3>z?y+z:-1,Q),aa(G,A,H,Q,d,e,h,f,k,l,m,u,v,r,b,z);else p(u)&&(I=u.positions[0],J=u.positions[1],P=u.positions[2]),0>I.y?(u=c.attributes,B=c.indices,C=t):(u=w.attributes,B=w.indices,C=E),z=U(u,B,C,q,y,I),aa(G,A,H,I,d,e,h,f,k,l,m,u,v,r,b,z),z=U(u,B,C,q,y+1,J),aa(G,A,H,J,d,e,h,f,k,l,m,u,v,r,b,z),z=U(u,B,C,q,y+2,P),aa(G,A,H,P,d,e,h,f,k,l,m,u,v,r,b,z)}O(a,c,w)}function M(a,c,b,d,e,f,h){p(h)&&(d=g.fromArray(d,3*a,Aa),g.equalsEpsilon(d,b,x.EPSILON10)?f.applyOffset.values[e]=h[a]:f.applyOffset.values[e]=h[c])}function R(a){var c=a.geometry,b=c.attributes,d=b.position.values,b=p(b.applyOffset)?b.applyOffset.values:void 0,e=c.indices,f=N(c),c=N(c),h,k=e.length,l=[];l.length=d.length/3;var m=[];m.length=d.length/3;for(h=0;h<l.length;++h)l[h]=-1,m[h]=-1;for(h=0;h<k;h+=2){var q=e[h],v=e[h+1],r=g.fromArray(d,3*q,Aa),w=g.fromArray(d,3*v,Ua),u;Math.abs(r.y)<x.EPSILON6&&(r.y=0>r.y?-x.EPSILON6:x.EPSILON6);Math.abs(w.y)<x.EPSILON6&&(w.y=0>w.y?-x.EPSILON6:x.EPSILON6);var B=f.attributes,C=f.indices,y=m,t=c.attributes,E=c.indices,D=l,G=z.lineSegmentPlane(r,w,Ha,sa);if(p(G)){var A=g.multiplyByScalar(g.UNIT_Y,5*x.EPSILON9,Ma);0>r.y&&(g.negate(A,A),B=c.attributes,C=c.indices,y=l,t=f.attributes,E=f.indices,D=m);var H=g.add(G,A,Ia);u=U(B,C,y,e,h,r);M(q,v,r,d,u,B,b);u=U(B,C,y,e,-1,H);M(q,v,H,d,u,B,b);g.negate(A,A);g.add(G,A,H);u=U(t,E,D,e,-1,H);M(q,v,H,d,u,t,b);u=U(t,E,D,e,h+1,w);M(q,v,w,d,u,t,b)}else 0>r.y?(B=c.attributes,C=c.indices,y=l):(B=f.attributes,C=f.indices,y=m),u=U(B,C,y,e,h,r),M(q,v,r,d,u,B,b),u=U(B,C,y,e,h+1,w),M(q,v,w,d,u,B,b)}O(a,c,f)}function Y(a){var c=a.attributes;a=c.position.values;for(var b=c.prevPosition.values,c=c.nextPosition.values,d=a.length,e=0;e<d;e+=3){var f=g.unpack(a,e,Ja);if(!(0<f.x)){var h=g.unpack(b,e,Qa);if(0>f.y&&0<h.y||0<f.y&&0>h.y)0<e-3?(b[e]=a[e-3],b[e+1]=a[e-2],b[e+2]=a[e-1]):g.pack(f,b,e);h=g.unpack(c,e,va);if(0>f.y&&0<h.y||0<f.y&&0>h.y)e+3<d?(c[e]=a[e+3],c[e+1]=a[e+4],c[e+2]=a[e+5]):g.pack(f,c,e)}}}var Q={toWireframe:function(a){if(!p(a))throw new d("geometry is required.");var c=a.indices;if(p(c)){switch(a.primitiveType){case C.TRIANGLES:for(var b=c.length,e=y.createTypedArray(b,b/3*6),f=0,h=0;h<b;h+=3,f+=6)H(e,f,c[h],c[h+1],c[h+2]);a.indices=e;break;case C.TRIANGLE_STRIP:b=c.length;if(3<=b){e=y.createTypedArray(b,6*(b-2));H(e,0,c[0],c[1],c[2]);f=6;for(h=3;h<b;++h,f+=6)H(e,f,c[h-1],c[h],c[h-2]);c=e}else c=new Uint16Array;a.indices=c;break;case C.TRIANGLE_FAN:if(0<c.length){for(var b=c.length-1,e=y.createTypedArray(b,6*(b-1)),f=c[0],h=0,g=1;g<b;++g,h+=6)H(e,h,f,c[g],c[g+1]);c=e}else c=new Uint16Array;a.indices=c;break;default:throw new d("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.");}a.primitiveType=C.LINES}return a},createLineSegmentsForVectors:function(a,b,g){b=h(b,"normal");if(!p(a))throw new d("geometry is required.");if(!p(a.attributes.position))throw new d("geometry.attributes.position is required.");if(!p(a.attributes[b]))throw new d("geometry.attributes must have an attribute with the same name as the attributeName parameter, "+b+".");g=h(g,1E4);var k=a.attributes.position.values,l=a.attributes[b].values,m=k.length;b=new Float64Array(2*m);for(var q=0,v=0;v<m;v+=3)b[q++]=k[v],b[q++]=k[v+1],b[q++]=k[v+2],b[q++]=k[v]+l[v]*g,b[q++]=k[v+1]+l[v+1]*g,b[q++]=k[v+2]+l[v+2]*g;var w;a=a.boundingSphere;p(a)&&(w=new f(a.center,a.radius+g));return new r({attributes:{position:new c({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:b})},primitiveType:C.LINES,boundingSphere:w})},createAttributeLocations:function(a){if(!p(a))throw new d("geometry is required.");var c="position positionHigh positionLow position3DHigh position3DLow position2DHigh position2DLow pickColor normal st tangent bitangent extrudeDirection compressedAttributes".split(" ");a=a.attributes;var b={},e=0,f,h=c.length;for(f=0;f<h;++f){var g=c[f];p(a[g])&&(b[g]=e++)}for(var k in a)a.hasOwnProperty(k)&&!p(b[k])&&(b[k]=e++);return b},reorderForPreVertexCache:function(a){if(!p(a))throw new d("geometry is required.");var c=r.computeNumberOfVertices(a),b=a.indices;if(p(b)){for(var f=new Int32Array(c),h=0;h<c;h++)f[h]=-1;for(var g=b.length,k=y.createTypedArray(c,g),l=0,m=0,h=0,q;l<g;)q=f[b[l]],-1!==q?k[m]=q:(q=b[l],f[q]=h,k[m]=h,++h),++l,++m;a.indices=k;var b=a.attributes,v;for(v in b)if(b.hasOwnProperty(v)&&p(b[v])&&p(b[v].values)){g=b[v];k=g.values;l=0;m=g.componentsPerAttribute;for(q=e.createTypedArray(g.componentDatatype,h*m);l<c;){var w=f[l];if(-1!==w)for(var u=0;u<m;u++)q[m*w+u]=k[m*l+u];++l}g.values=q}}return a},reorderForPostVertexCache:function(a,c){if(!p(a))throw new d("geometry is required.");var b=a.indices;if(a.primitiveType===C.TRIANGLES&&p(b)){for(var e=b.length,f=0,h=0;h<e;h++)b[h]>f&&(f=b[h]);a.indices=I.tipsify({indices:b,maximumIndex:f,cacheSize:c})}return a},fitToUnsignedShortIndices:function(a){if(!p(a))throw new d("geometry is required.");if(p(a.indices)&&a.primitiveType!==C.TRIANGLES&&a.primitiveType!==C.LINES&&a.primitiveType!==C.POINTS)throw new d("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");var c=[],b=r.computeNumberOfVertices(a);if(p(a.indices)&&b>=x.SIXTY_FOUR_KILOBYTES){var b=[],e=[],f=0,h=J(a.attributes),g=a.indices,k=g.length,l;a.primitiveType===C.TRIANGLES?l=3:a.primitiveType===C.LINES?l=2:a.primitiveType===C.POINTS&&(l=1);for(var m=0;m<k;m+=l){for(var q=0;q<l;++q){var v=g[m+q],w=b[v];if(!p(w)){w=f++;b[v]=w;var u=h,B=a.attributes,z=void 0;for(z in B)if(B.hasOwnProperty(z)&&p(B[z])&&p(B[z].values))for(var y=B[z],t=0;t<y.componentsPerAttribute;++t)u[z].values.push(y.values[v*y.componentsPerAttribute+t])}e.push(w)}f+l>=x.SIXTY_FOUR_KILOBYTES&&(c.push(new r({attributes:h,indices:e,primitiveType:a.primitiveType,boundingSphere:a.boundingSphere,boundingSphereCV:a.boundingSphereCV})),b=[],e=[],f=0,h=J(a.attributes))}0!==e.length&&c.push(new r({attributes:h,indices:e,primitiveType:a.primitiveType,boundingSphere:a.boundingSphere,boundingSphereCV:a.boundingSphereCV}))}else c.push(a);return c}},S=new g,ca=new m;Q.projectTo2D=function(a,b,f,h,k){if(!p(a))throw new d("geometry is required.");if(!p(b))throw new d("attributeName is required.");if(!p(f))throw new d("attributeName3D is required.");if(!p(h))throw new d("attributeName2D is required.");if(!p(a.attributes[b]))throw new d("geometry must have attribute matching the attributeName argument: "+b+".");if(a.attributes[b].componentDatatype!==e.DOUBLE)throw new d("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");var l=a.attributes[b];k=p(k)?k:new t;for(var m=k.ellipsoid,q=l.values,v=new Float64Array(q.length),r=0,w=0;w<q.length;w+=3){var u=g.fromArray(q,w,S),B=m.cartesianToCartographic(u,ca);if(!p(B))throw new d("Could not project point ("+u.x+", "+u.y+", "+u.z+") to 2D.");u=k.project(B,S);v[r++]=u.x;v[r++]=u.y;v[r++]=u.z}a.attributes[f]=l;a.attributes[h]=new c({componentDatatype:e.DOUBLE,componentsPerAttribute:3,values:v});delete a.attributes[b];return a};var T={high:0,low:0};Q.encodeAttribute=function(a,b,f,h){if(!p(a))throw new d("geometry is required.");if(!p(b))throw new d("attributeName is required.");if(!p(f))throw new d("attributeHighName is required.");if(!p(h))throw new d("attributeLowName is required.");if(!p(a.attributes[b]))throw new d("geometry must have attribute matching the attributeName argument: "+b+".");if(a.attributes[b].componentDatatype!==e.DOUBLE)throw new d("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var g=a.attributes[b],k=g.values,l=k.length,m=new Float32Array(l),v=new Float32Array(l),r=0;r<l;++r)q.encode(k[r],T),m[r]=T.high,v[r]=T.low;g=g.componentsPerAttribute;a.attributes[f]=new c({componentDatatype:e.FLOAT,componentsPerAttribute:g,values:m});a.attributes[h]=new c({componentDatatype:e.FLOAT,componentsPerAttribute:g,values:v});delete a.attributes[b];return a};var da=new g,V=new v,ba=new D;Q.transformToWorldCoordinates=function(a){if(!p(a))throw new d("instance is required.");var c=a.modelMatrix;if(v.equals(c,v.IDENTITY))return a;var b=a.geometry.attributes;w(c,b.position);w(c,b.prevPosition);w(c,b.nextPosition);if(p(b.normal)||p(b.tangent)||p(b.bitangent))v.inverse(c,V),v.transpose(V,V),v.getRotation(V,ba),G(ba,b.normal),G(ba,b.tangent),G(ba,b.bitangent);b=a.geometry.boundingSphere;p(b)&&(a.geometry.boundingSphere=f.transform(b,c,b));a.modelMatrix=v.clone(v.IDENTITY);return a};var X=new g;Q.combineInstances=function(a){if(!p(a)||1>a.length)throw new d("instances is required and must have length greater than zero.");for(var c=[],b=[],e=a.length,f=0;f<e;++f){var h=a[f];p(h.geometry)?c.push(h):p(h.westHemisphereGeometry)&&p(h.eastHemisphereGeometry)&&b.push(h)}a=[];0<c.length&&a.push(E(c,"geometry"));0<b.length&&(a.push(E(b,"westHemisphereGeometry")),a.push(E(b,"eastHemisphereGeometry")));return a};var fa=new g,ga=new g,F=new g,na=new g;Q.computeNormal=function(a){if(!p(a))throw new d("geometry is required.");if(!p(a.attributes.position)||!p(a.attributes.position.values))throw new d("geometry.attributes.position.values is required.");if(!p(a.indices))throw new d("geometry.indices is required.");if(2>a.indices.length||0!==a.indices.length%3)throw new d("geometry.indices length must be greater than 0 and be a multiple of 3.");if(a.primitiveType!==C.TRIANGLES)throw new d("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var b=a.indices,f=a.attributes,h=f.position.values,f=f.position.values.length/3,k=b.length,l=Array(f),m=Array(k/3),q=Array(k),v;for(v=0;v<f;v++)l[v]={indexOffset:0,count:0,currentCount:0};var r=0;for(v=0;v<k;v+=3){var w=b[v],u=b[v+1],B=b[v+2],z=3*w,y=3*u,t=3*B;ga.x=h[z];ga.y=h[z+1];ga.z=h[z+2];F.x=h[y];F.y=h[y+1];F.z=h[y+2];na.x=h[t];na.y=h[t+1];na.z=h[t+2];l[w].count++;l[u].count++;l[B].count++;g.subtract(F,ga,F);g.subtract(na,ga,na);m[r]=g.cross(F,na,new g);r++}for(v=r=0;v<f;v++)l[v].indexOffset+=r,r+=l[v].count;for(v=r=0;v<k;v+=3)h=l[b[v]],w=h.indexOffset+h.currentCount,q[w]=r,h.currentCount++,h=l[b[v+1]],w=h.indexOffset+h.currentCount,q[w]=r,h.currentCount++,h=l[b[v+2]],w=h.indexOffset+h.currentCount,q[w]=r,h.currentCount++,r++;b=new Float32Array(3*f);for(v=0;v<f;v++){k=3*v;h=l[v];g.clone(g.ZERO,fa);if(0<h.count){for(r=0;r<h.count;r++)g.add(fa,m[q[h.indexOffset+r]],fa);g.equalsEpsilon(g.ZERO,fa,x.EPSILON10)&&g.clone(m[q[h.indexOffset]],fa)}g.equalsEpsilon(g.ZERO,fa,x.EPSILON10)&&(fa.z=1);g.normalize(fa,fa);b[k]=fa.x;b[k+1]=fa.y;b[k+2]=fa.z}a.attributes.normal=new c({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:b});return a};var ia=new g,la=new g,ha=new g;Q.computeTangentAndBitangent=function(a){if(!p(a))throw new d("geometry is required.");var b=a.attributes,f=a.indices;if(!p(b.position)||!p(b.position.values))throw new d("geometry.attributes.position.values is required.");if(!p(b.normal)||!p(b.normal.values))throw new d("geometry.attributes.normal.values is required.");if(!p(b.st)||!p(b.st.values))throw new d("geometry.attributes.st.values is required.");if(!p(f))throw new d("geometry.indices is required.");if(2>f.length||0!==f.length%3)throw new d("geometry.indices length must be greater than 0 and be a multiple of 3.");if(a.primitiveType!==C.TRIANGLES)throw new d("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var h=a.attributes.position.values,b=a.attributes.normal.values,k=a.attributes.st.values,l=a.attributes.position.values.length/3,m=f.length,q=Array(3*l),v;for(v=0;v<q.length;v++)q[v]=0;var r,w,u;for(v=0;v<m;v+=3){var B=f[v],z=f[v+1],y=f[v+2];r=3*B;w=3*z;u=3*y;var B=2*B,t=2*z,E=2*y,D=h[r],z=h[r+1],y=h[r+2],x=k[B],G=k[B+1],B=k[t+1]-G,G=k[E+1]-G,t=1/((k[t]-x)*G-(k[E]-x)*B),D=(G*(h[w]-D)-B*(h[u]-D))*t,z=(G*(h[w+1]-z)-B*(h[u+1]-z))*t,y=(G*(h[w+2]-y)-B*(h[u+2]-y))*t;q[r]+=D;q[r+1]+=z;q[r+2]+=y;q[w]+=D;q[w+1]+=z;q[w+2]+=y;q[u]+=D;q[u+1]+=z;q[u+2]+=y}f=new Float32Array(3*l);h=new Float32Array(3*l);for(v=0;v<l;v++)r=3*v,w=r+1,u=r+2,k=g.fromArray(b,r,ia),m=g.fromArray(q,r,ha),y=g.dot(k,m),g.multiplyByScalar(k,y,la),g.normalize(g.subtract(m,la,m),m),f[r]=m.x,f[w]=m.y,f[u]=m.z,g.normalize(g.cross(k,m,m),m),h[r]=m.x,h[w]=m.y,h[u]=m.z;a.attributes.tangent=new c({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:f});a.attributes.bitangent=new c({componentDatatype:e.FLOAT,componentsPerAttribute:3,values:h});return a};var pa=new k,oa=new g,qa=new g,ua=new g,ta=new k;Q.compressVertices=function(a){if(!p(a))throw new d("geometry is required.");var f=a.attributes.extrudeDirection,h,l;if(p(f)){var m=f.values;l=m.length/3;var q=new Float32Array(2*l),v=0;for(h=0;h<l;++h)g.fromArray(m,3*h,oa),g.equals(oa,g.ZERO)?v+=2:(ta=b.octEncodeInRange(oa,65535,ta),q[v++]=ta.x,q[v++]=ta.y);a.attributes.compressedAttributes=new c({componentDatatype:e.FLOAT,componentsPerAttribute:2,values:q});delete a.attributes.extrudeDirection;return a}h=a.attributes.normal;l=a.attributes.st;var f=p(h),r=p(l);if(!f&&!r)return a;var w=a.attributes.tangent,u=a.attributes.bitangent,B=p(w),C=p(u),z;f&&(m=h.values);r&&(q=l.values);B&&(v=w.values);C&&(z=u.values);l=(f?m.length:q.length)/(f?3:2);var w=(r&&f?2:1)+(B||C?1:0),u=new Float32Array(l*w),y=0;for(h=0;h<l;++h){r&&(k.fromArray(q,2*h,pa),u[y++]=b.compressTextureCoordinates(pa));var t=3*h;f&&p(v)&&p(z)?(g.fromArray(m,t,oa),g.fromArray(v,t,qa),g.fromArray(z,t,ua),b.octPack(oa,qa,ua,pa),u[y++]=pa.x,u[y++]=pa.y):(f&&(g.fromArray(m,t,oa),u[y++]=b.octEncodeFloat(oa)),B&&(g.fromArray(v,t,oa),u[y++]=b.octEncodeFloat(oa)),C&&(g.fromArray(z,t,oa),u[y++]=b.octEncodeFloat(oa)))}a.attributes.compressedAttributes=new c({componentDatatype:e.FLOAT,componentsPerAttribute:w,values:u});f&&delete a.attributes.normal;r&&delete a.attributes.st;C&&delete a.attributes.bitangent;B&&delete a.attributes.tangent;return a};var wa=new g,za=new g,Da=new g,Ba=new g,ra=new g,Ea={positions:Array(7),indices:Array(9)},Ga=Z(l,4),Ca=Z(g,3),ya=Z(k,2),Aa=new g,Ua=new g,sa=new g,Va=new g,xa={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0},Ha=B.fromPointNormal(g.ZERO,g.UNIT_Y),Ma=new g,Ia=new g,La=new k,Fa=new k,Ja=new g,Qa=new g,va=new g,Sa=new g,Oa=new g,Ta=new g,Ka=new l,Wa=5*x.EPSILON9,Ra=x.EPSILON6;Q.splitLongitude=function(a){if(!p(a))throw new d("instance is required.");var c=a.geometry,b=c.boundingSphere;if(p(b)&&(0<b.center.x-b.radius||f.intersectPlane(b,B.ORIGIN_ZX_PLANE)!==A.INTERSECTING))return a;if(c.geometryType!==u.NONE)switch(c.geometryType){case u.POLYLINES:var e=a.geometry,h=e.attributes,c=h.position.values,b=h.prevPosition.values,m=h.nextPosition.values,q=h.expandAndWidth.values,v=p(h.st)?h.st.values:void 0,h=p(h.color)?h.color.values:void 0,w=N(e),e=N(e),t,E,D,G=!1,H=c.length/3;for(t=0;t<H;t+=4){D=t;var I=t+2,L=g.fromArray(c,3*D,Ja),K=g.fromArray(c,3*I,Qa);if(Math.abs(L.y)<Ra)for(L.y=Ra*(0>K.y?-1:1),c[3*t+1]=L.y,c[3*(t+1)+1]=L.y,E=3*D;E<3*D+12;E+=3)b[E]=c[3*t],b[E+1]=c[3*t+1],b[E+2]=c[3*t+2];if(Math.abs(K.y)<Ra)for(K.y=Ra*(0>L.y?-1:1),c[3*(t+2)+1]=K.y,c[3*(t+3)+1]=K.y,E=3*D;E<3*D+12;E+=3)m[E]=c[3*(t+2)],m[E+1]=c[3*(t+2)+1],m[E+2]=c[3*(t+2)+2];var J=w.attributes,P=w.indices,T=e.attributes,Q=e.indices;E=z.lineSegmentPlane(L,K,Ha,Sa);if(p(E)){var G=!0,M=g.multiplyByScalar(g.UNIT_Y,Wa,Oa);0>L.y&&(g.negate(M,M),J=e.attributes,P=e.indices,T=w.attributes,Q=w.indices);var S=g.add(E,M,Ta);J.position.values.push(L.x,L.y,L.z,L.x,L.y,L.z);J.position.values.push(S.x,S.y,S.z);J.position.values.push(S.x,S.y,S.z);J.prevPosition.values.push(b[3*D],b[3*D+1],b[3*D+2]);J.prevPosition.values.push(b[3*D+3],b[3*D+4],b[3*D+5]);J.prevPosition.values.push(L.x,L.y,L.z,L.x,L.y,L.z);J.nextPosition.values.push(S.x,S.y,S.z);J.nextPosition.values.push(S.x,S.y,S.z);J.nextPosition.values.push(S.x,S.y,S.z);J.nextPosition.values.push(S.x,S.y,S.z);g.negate(M,M);g.add(E,M,S);T.position.values.push(S.x,S.y,S.z);T.position.values.push(S.x,S.y,S.z);T.position.values.push(K.x,K.y,K.z,K.x,K.y,K.z);T.prevPosition.values.push(S.x,S.y,S.z);T.prevPosition.values.push(S.x,S.y,S.z);T.prevPosition.values.push(S.x,S.y,S.z);T.prevPosition.values.push(S.x,S.y,S.z);T.nextPosition.values.push(K.x,K.y,K.z,K.x,K.y,K.z);T.nextPosition.values.push(m[3*I],m[3*I+1],m[3*I+2]);T.nextPosition.values.push(m[3*I+3],m[3*I+4],m[3*I+5]);M=k.fromArray(q,2*D,La);M=Math.abs(M.y);J.expandAndWidth.values.push(-1,M,1,M);J.expandAndWidth.values.push(-1,-M,1,-M);T.expandAndWidth.values.push(-1,M,1,M);T.expandAndWidth.values.push(-1,-M,1,-M);M=g.magnitudeSquared(g.subtract(E,L,va));M/=g.magnitudeSquared(g.subtract(K,L,va));if(p(h)){E=l.fromArray(h,4*D,Ka);var ca=l.fromArray(h,4*I,Ka),L=x.lerp(E.x,ca.x,M),K=x.lerp(E.y,ca.y,M),S=x.lerp(E.z,ca.z,M),ca=x.lerp(E.w,ca.w,M);for(E=4*D;E<4*D+8;++E)J.color.values.push(h[E]);J.color.values.push(L,K,S,ca);J.color.values.push(L,K,S,ca);T.color.values.push(L,K,S,ca);T.color.values.push(L,K,S,ca);for(E=4*I;E<4*I+8;++E)T.color.values.push(h[E])}if(p(v)){L=k.fromArray(v,2*D,La);K=k.fromArray(v,2*(t+3),Fa);M=x.lerp(L.x,K.x,M);for(E=2*D;E<2*D+4;++E)J.st.values.push(v[E]);J.st.values.push(M,L.y);J.st.values.push(M,K.y);T.st.values.push(M,L.y);T.st.values.push(M,K.y);for(E=2*I;E<2*I+4;++E)T.st.values.push(v[E])}D=J.position.values.length/3-4;P.push(D,D+2,D+1);P.push(D+1,D+2,D+3);D=T.position.values.length/3-4;Q.push(D,D+2,D+1);Q.push(D+1,D+2,D+3)}else{0>L.y?(T=e.attributes,P=e.indices):(T=w.attributes,P=w.indices);T.position.values.push(L.x,L.y,L.z);T.position.values.push(L.x,L.y,L.z);T.position.values.push(K.x,K.y,K.z);T.position.values.push(K.x,K.y,K.z);for(E=3*t;E<3*t+12;++E)T.prevPosition.values.push(b[E]),T.nextPosition.values.push(m[E]);for(E=2*t;E<2*t+8;++E)T.expandAndWidth.values.push(q[E]),p(v)&&T.st.values.push(v[E]);if(p(h))for(E=4*t;E<4*t+16;++E)T.color.values.push(h[E]);D=T.position.values.length/3-4;P.push(D,D+2,D+1);P.push(D+1,D+2,D+3)}}G&&(Y(e),Y(w));O(a,e,w);break;case u.TRIANGLES:W(a);break;case u.LINES:R(a)}else{a:switch(c.primitiveType){case C.TRIANGLE_FAN:b=r.computeNumberOfVertices(c);if(3>b)throw new d("The number of vertices must be at least three.");m=y.createTypedArray(b,3*(b-2));m[0]=1;m[1]=0;m[2]=2;for(v=q=3;v<b;++v)m[q++]=v-1,m[q++]=0,m[q++]=v;c.indices=m;c.primitiveType=C.TRIANGLES;break;case C.TRIANGLE_STRIP:b=r.computeNumberOfVertices(c);if(3>b)throw new d("The number of vertices must be at least 3.");m=y.createTypedArray(b,3*(b-2));m[0]=0;m[1]=1;m[2]=2;3<b&&(m[3]=0,m[4]=2,m[5]=3);q=6;for(v=3;v<b-1;v+=2)m[q++]=v,m[q++]=v-1,m[q++]=v+1,v+2<b&&(m[q++]=v,m[q++]=v+1,m[q++]=v+2);c.indices=m;c.primitiveType=C.TRIANGLES;break;case C.TRIANGLES:if(!p(c.indices)){b=r.computeNumberOfVertices(c);if(3>b)throw new d("The number of vertices must be at least three.");if(0!==b%3)throw new d("The number of vertices must be a multiple of three.");m=y.createTypedArray(b,b);for(q=0;q<b;++q)m[q]=q;c.indices=m}break a;case C.LINE_STRIP:b=r.computeNumberOfVertices(c);if(2>b)throw new d("The number of vertices must be at least two.");m=y.createTypedArray(b,2*(b-1));m[0]=0;m[1]=1;for(v=q=2;v<b;++v)m[q++]=v-1,m[q++]=v;c.indices=m;c.primitiveType=C.LINES;break;case C.LINE_LOOP:b=r.computeNumberOfVertices(c);if(2>b)throw new d("The number of vertices must be at least two.");m=y.createTypedArray(b,2*b);m[0]=0;m[1]=1;for(v=q=2;v<b;++v)m[q++]=v-1,m[q++]=v;m[q++]=b-1;m[q]=0;c.indices=m;c.primitiveType=C.LINES;break;case C.LINES:if(!p(c.indices)){b=r.computeNumberOfVertices(c);if(2>b)throw new d("The number of vertices must be at least two.");if(0!==b%2)throw new d("The number of vertices must be a multiple of 2.");m=y.createTypedArray(b,b);for(q=0;q<b;++q)m[q]=q;c.indices=m}}c.primitiveType===C.TRIANGLES?W(a):c.primitiveType===C.LINES&&R(a)}return a};return Q});F("Core/EllipseGeometry","./arrayFill ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./ComponentDatatype ./defaultValue ./defined ./defineProperties ./DeveloperError ./EllipseGeometryLibrary ./Ellipsoid ./GeographicProjection ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryInstance ./GeometryOffsetAttribute ./GeometryPipeline ./IndexDatatype ./Math ./Matrix3 ./PrimitiveType ./Quaternion ./Rectangle ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a,c,d){var e=c.vertexFormat,g=c.center,l=c.semiMajorAxis,p=c.semiMinorAxis,v=c.ellipsoid,w=c.stRotation,C=d?a.length/3*2:a.length/3,t=c.shadowVolume,E=e.st?new Float32Array(2*C):void 0,D=e.normal?new Float32Array(3*C):void 0,G=e.tangent?new Float32Array(3*C):void 0,x=e.bitangent?new Float32Array(3*C):void 0,A=t?new Float32Array(3*C):void 0,H=0,L=M,J=R,O=Y,V=new r(v),da=V.project(v.cartesianToCartographic(g,Q),S),ba=v.scaleToGeodeticSurface(g,K);v.geodeticSurfaceNormal(ba,ba);var g=aa,fa=U;if(0!==w)var X=I.fromAxisAngle(ba,w,W),g=B.fromQuaternion(X,g),X=I.fromAxisAngle(ba,-w,W),fa=B.fromQuaternion(X,fa);else g=B.clone(B.IDENTITY,g),fa=B.clone(B.IDENTITY,fa);for(var w=f.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,ca),ba=f.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,T),X=a.length,ga=d?X:0,la=ga/3*2,ia=0;ia<X;ia+=3){var F=ia+1,ka=ia+2,na=k.fromArray(a,ia,K);if(e.st){var Sa=B.multiplyByVector(g,na,P),Sa=V.project(v.cartesianToCartographic(Sa,Q),N);k.subtract(Sa,da,Sa);Z.x=(Sa.x+l)/(2*l);Z.y=(Sa.y+p)/(2*p);w.x=Math.min(Z.x,w.x);w.y=Math.min(Z.y,w.y);ba.x=Math.max(Z.x,ba.x);ba.y=Math.max(Z.y,ba.y);d&&(E[H+la]=Z.x,E[H+1+la]=Z.y);E[H++]=Z.x;E[H++]=Z.y}if(e.normal||e.tangent||e.bitangent||t)if(L=v.geodeticSurfaceNormal(na,L),t&&(A[ia+ga]=-L.x,A[F+ga]=-L.y,A[ka+ga]=-L.z),e.normal||e.tangent||e.bitangent){if(e.tangent||e.bitangent)J=k.normalize(k.cross(k.UNIT_Z,L,J),J),B.multiplyByVector(fa,J,J);e.normal&&(D[ia]=L.x,D[F]=L.y,D[ka]=L.z,d&&(D[ia+ga]=-L.x,D[F+ga]=-L.y,D[ka+ga]=-L.z));e.tangent&&(G[ia]=J.x,G[F]=J.y,G[ka]=J.z,d&&(G[ia+ga]=-J.x,G[F+ga]=-J.y,G[ka+ga]=-J.z));e.bitangent&&(O=k.normalize(k.cross(L,J,O),O),x[ia]=O.x,x[F]=O.y,x[ka]=O.z,d&&(x[ia+ga]=O.x,x[F+ga]=O.y,x[ka+ga]=O.z))}}if(e.st)for(X=E.length,l=0;l<X;l+=2)E[l]=(E[l]-w.x)/(ba.x-w.x),E[l+1]=(E[l+1]-w.y)/(ba.y-w.y);l=new y;e.position&&(a=q.raisePositionsToHeight(a,c,d),l.position=new u({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:a}));e.st&&(l.st=new u({componentDatatype:m.FLOAT,componentsPerAttribute:2,values:E}));e.normal&&(l.normal=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:D}));e.tangent&&(l.tangent=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:G}));e.bitangent&&(l.bitangent=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:x}));t&&(l.extrudeDirection=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:A}));d&&h(c.offsetAttribute)&&(d=new Uint8Array(C),d=c.offsetAttribute===z.TOP?b(d,1,0,C/2):b(d,c.offsetAttribute===z.NONE?0:1),l.applyOffset=new u({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:d}));return l}function G(a){var c=Array(12*a*(a+1)-6),b=0,d,e,f,h,g;d=0;f=1;for(h=0;3>h;h++)c[b++]=f++,c[b++]=d,c[b++]=f;for(h=2;h<a+1;++h){f=h*(h+1)-1;d=(h-1)*h-1;c[b++]=f++;c[b++]=d;c[b++]=f;e=2*h;for(g=0;g<e-1;++g)c[b++]=f,c[b++]=d++,c[b++]=d,c[b++]=f++,c[b++]=d,c[b++]=f;c[b++]=f++;c[b++]=d;c[b++]=f}e=2*a;++f;++d;for(h=0;h<e-1;++h)c[b++]=f,c[b++]=d++,c[b++]=d,c[b++]=f++,c[b++]=d,c[b++]=f;c[b++]=f;c[b++]=d++;c[b++]=d;c[b++]=f++;c[b++]=d++;c[b++]=d;++d;for(h=a-1;1<h;--h){c[b++]=d++;c[b++]=d;c[b++]=f;e=2*h;for(g=0;g<e-1;++g)c[b++]=f,c[b++]=d++,c[b++]=d,c[b++]=f++,c[b++]=d,c[b++]=f;c[b++]=d++;c[b++]=d++;c[b++]=f++}for(h=0;3>h;h++)c[b++]=d++,c[b++]=d,c[b++]=f;return c}function E(a,c,b,d,e,f,h){a=q.computeEllipsePositions({center:a,semiMajorAxis:c,semiMinorAxis:b,rotation:d,granularity:e},!1,!0).outerPositions;c=a.length/3;b=Array(c);for(d=0;d<c;++d)b[d]=k.fromArray(a,3*d);f=H.fromCartesianArray(b,f,h);f.width>v.PI&&(f.north=0<f.north?v.PI_OVER_TWO-v.EPSILON7:f.north,f.south=0>f.south?v.EPSILON7-v.PI_OVER_TWO:f.south,f.east=v.PI,f.west=-v.PI);return f}function L(a){a=e(a,e.EMPTY_OBJECT);var c=a.center,b=e(a.ellipsoid,t.WGS84),f=a.semiMajorAxis,h=a.semiMinorAxis,g=e(a.granularity,v.RADIANS_PER_DEGREE),p=e(a.vertexFormat,J.DEFAULT);l.defined("options.center",c);l.typeOf.number("options.semiMajorAxis",f);l.typeOf.number("options.semiMinorAxis",h);if(f<h)throw new d("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(0>=g)throw new d("granularity must be greater than zero.");var m=e(a.height,0),q=e(a.extrudedHeight,m);this._center=k.clone(c);this._semiMajorAxis=f;this._semiMinorAxis=h;this._ellipsoid=t.clone(b);this._rotation=e(a.rotation,0);this._stRotation=e(a.stRotation,0);this._height=Math.max(q,m);this._granularity=g;this._vertexFormat=J.clone(p);this._extrudedHeight=Math.min(q,m);this._shadowVolume=e(a.shadowVolume,!1);this._workerName="createEllipseGeometry";this._offsetAttribute=a.offsetAttribute;this._textureCoordinateRotationPoints=this._rectangle=void 0}var K=new k,P=new k,N=new k,O=new k,Z=new f,aa=new B,U=new B,W=new I,M=new k,R=new k,Y=new k,Q=new g,S=new k,ca=new f,T=new f,da=new k,V=new a,ba=new a;L.packedLength=k.packedLength+t.packedLength+J.packedLength+9;L.pack=function(a,c,b){l.defined("value",a);l.defined("array",c);b=e(b,0);k.pack(a._center,c,b);b+=k.packedLength;t.pack(a._ellipsoid,c,b);b+=t.packedLength;J.pack(a._vertexFormat,c,b);b+=J.packedLength;c[b++]=a._semiMajorAxis;c[b++]=a._semiMinorAxis;c[b++]=a._rotation;c[b++]=a._stRotation;c[b++]=a._height;c[b++]=a._granularity;c[b++]=a._extrudedHeight;c[b++]=a._shadowVolume?1:0;c[b]=e(a._offsetAttribute,-1);return c};var X=new k,fa=new t,ga=new J,F={center:X,ellipsoid:fa,vertexFormat:ga,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,stRotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};L.unpack=function(a,c,b){l.defined("array",a);c=e(c,0);var d=k.unpack(a,c,X);c+=k.packedLength;var f=t.unpack(a,c,fa);c+=t.packedLength;var g=J.unpack(a,c,ga);c+=J.packedLength;var p=a[c++],m=a[c++],q=a[c++],v=a[c++],r=a[c++],w=a[c++],u=a[c++],B=1===a[c++];a=a[c];if(!h(b))return F.height=r,F.extrudedHeight=u,F.granularity=w,F.stRotation=v,F.rotation=q,F.semiMajorAxis=p,F.semiMinorAxis=m,F.shadowVolume=B,F.offsetAttribute=-1===a?void 0:a,new L(F);b._center=k.clone(d,b._center);b._ellipsoid=t.clone(f,b._ellipsoid);b._vertexFormat=J.clone(g,b._vertexFormat);b._semiMajorAxis=p;b._semiMinorAxis=m;b._rotation=q;b._stRotation=v;b._height=r;b._granularity=w;b._extrudedHeight=u;b._shadowVolume=B;b._offsetAttribute=-1===a?void 0:a;return b};L.computeRectangle=function(a,c){a=e(a,e.EMPTY_OBJECT);var b=a.center,f=e(a.ellipsoid,t.WGS84),h=a.semiMajorAxis,g=a.semiMinorAxis,k=e(a.granularity,v.RADIANS_PER_DEGREE),p=e(a.rotation,0);l.defined("options.center",b);l.typeOf.number("options.semiMajorAxis",h);l.typeOf.number("options.semiMinorAxis",g);if(h<g)throw new d("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(0>=k)throw new d("granularity must be greater than zero.");return E(b,h,g,p,k,f,c)};L.createGeometry=function(d){var e,g,l;if(!(0>=d._semiMajorAxis||0>=d._semiMinorAxis)){e=d._height;g=d._extrudedHeight;l=!v.equalsEpsilon(e,g,0,v.EPSILON2);d._center=d._ellipsoid.scaleToGeodeticSurface(d._center,d._center);e={center:d._center,semiMajorAxis:d._semiMajorAxis,semiMinorAxis:d._semiMinorAxis,ellipsoid:d._ellipsoid,rotation:d._rotation,height:e,granularity:d._granularity,vertexFormat:d._vertexFormat,stRotation:d._stRotation};if(l){e.extrudedHeight=g;e.shadowVolume=d._shadowVolume;e.offsetAttribute=d._offsetAttribute;g=e.center;l=e.ellipsoid;var p=e.semiMajorAxis,t=k.multiplyByScalar(l.geodeticSurfaceNormal(g,K),e.height,K);V.center=k.add(g,t,V.center);V.radius=p;t=k.multiplyByScalar(l.geodeticSurfaceNormal(g,t),e.extrudedHeight,t);ba.center=k.add(g,t,ba.center);ba.radius=p;g=q.computeEllipsePositions(e,!0,!0);var t=g.positions,E=g.numPts;l=g.outerPositions;g=a.union(V,ba);var p=w(t,e,!0),E=G(E),H=E.length;E.length=2*H;for(var t=t.length/3,L=0;L<H;L+=3)E[L+H]=E[L+2]+t,E[L+1+H]=E[L+1]+t,E[L+2+H]=E[L]+t;var t=D.createTypedArray(2*t/3,E),p=new c({attributes:p,indices:t,primitiveType:C.TRIANGLES}),E=e.vertexFormat,J=e.center,U=e.semiMajorAxis,fa=e.semiMinorAxis,X=e.ellipsoid,ga=e.height,F=e.extrudedHeight,ka=e.stRotation,t=l.length/3*2,H=new Float64Array(3*t),L=E.st?new Float32Array(2*t):void 0,Ca=E.normal?new Float32Array(3*t):void 0,na=E.tangent?new Float32Array(3*t):void 0,Aa=E.bitangent?new Float32Array(3*t):void 0,Ua=e.shadowVolume,sa=Ua?new Float32Array(3*t):void 0,Va=0,xa=M,Ha=R,Ma=Y,Ia=new r(X),La=Ia.project(X.cartesianToCartographic(J,Q),S),J=X.scaleToGeodeticSurface(J,K);X.geodeticSurfaceNormal(J,J);for(var ka=I.fromAxisAngle(J,ka,W),Fa=B.fromQuaternion(ka,aa),ka=f.fromElements(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,ca),J=f.fromElements(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,T),Ja=l.length,Qa=Ja/3*2,va=0;va<Ja;va+=3){var Sa=va+1,Oa=va+2,Ta=k.fromArray(l,va,K),Ka;E.st&&(Ka=B.multiplyByVector(Fa,Ta,P),Ka=Ia.project(X.cartesianToCartographic(Ka,Q),N),k.subtract(Ka,La,Ka),Z.x=(Ka.x+U)/(2*U),Z.y=(Ka.y+fa)/(2*fa),ka.x=Math.min(Z.x,ka.x),ka.y=Math.min(Z.y,ka.y),J.x=Math.max(Z.x,J.x),J.y=Math.max(Z.y,J.y),L[Va+Qa]=Z.x,L[Va+1+Qa]=Z.y,L[Va++]=Z.x,L[Va++]=Z.y);Ta=X.scaleToGeodeticSurface(Ta,Ta);Ka=k.clone(Ta,P);xa=X.geodeticSurfaceNormal(Ta,xa);Ua&&(sa[va+Ja]=-xa.x,sa[Sa+Ja]=-xa.y,sa[Oa+Ja]=-xa.z);var Wa=k.multiplyByScalar(xa,ga,O),Ta=k.add(Ta,Wa,Ta),Wa=k.multiplyByScalar(xa,F,Wa);Ka=k.add(Ka,Wa,Ka);E.position&&(H[va+Ja]=Ka.x,H[Sa+Ja]=Ka.y,H[Oa+Ja]=Ka.z,H[va]=Ta.x,H[Sa]=Ta.y,H[Oa]=Ta.z);if(E.normal||E.tangent||E.bitangent)Ma=k.clone(xa,Ma),Wa=k.fromArray(l,(va+3)%Ja,O),k.subtract(Wa,Ta,Wa),Ta=k.subtract(Ka,Ta,N),xa=k.normalize(k.cross(Ta,Wa,xa),xa),E.normal&&(Ca[va]=xa.x,Ca[Sa]=xa.y,Ca[Oa]=xa.z,Ca[va+Ja]=xa.x,Ca[Sa+Ja]=xa.y,Ca[Oa+Ja]=xa.z),E.tangent&&(Ha=k.normalize(k.cross(Ma,xa,Ha),Ha),na[va]=Ha.x,na[Sa]=Ha.y,na[Oa]=Ha.z,na[va+Ja]=Ha.x,na[va+1+Ja]=Ha.y,na[va+2+Ja]=Ha.z),E.bitangent&&(Aa[va]=Ma.x,Aa[Sa]=Ma.y,Aa[Oa]=Ma.z,Aa[va+Ja]=Ma.x,Aa[Sa+Ja]=Ma.y,Aa[Oa+Ja]=Ma.z)}if(E.st)for(Ja=L.length,U=0;U<Ja;U+=2)L[U]=(L[U]-ka.x)/(J.x-ka.x),L[U+1]=(L[U+1]-ka.y)/(J.y-ka.y);U=new y;E.position&&(U.position=new u({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:H}));E.st&&(U.st=new u({componentDatatype:m.FLOAT,componentsPerAttribute:2,values:L}));E.normal&&(U.normal=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:Ca}));E.tangent&&(U.tangent=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:na}));E.bitangent&&(U.bitangent=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:Aa}));Ua&&(U.extrudeDirection=new u({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:sa}));h(e.offsetAttribute)&&(E=new Uint8Array(t),E=e.offsetAttribute===z.TOP?b(E,1,0,t/2):b(E,e.offsetAttribute===z.NONE?0:1),U.applyOffset=new u({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:E}));e=l.length/3;t=D.createTypedArray(e,6*e);for(H=E=0;H<e;H++)L=H,Ca=H+e,na=(L+1)%e,Aa=na+e,t[E++]=L,t[E++]=Ca,t[E++]=na,t[E++]=na,t[E++]=Ca,t[E++]=Aa;e=D.createTypedArray(2*l.length/3,t);e=new c({attributes:U,indices:e,primitiveType:C.TRIANGLES});l=x.combineInstances([new A({geometry:p}),new A({geometry:e})]);e=g;g=l[0].attributes;l=l[0].indices}else g=e.center,da=k.multiplyByScalar(e.ellipsoid.geodeticSurfaceNormal(g,da),e.height,da),da=k.add(g,da,da),g=new a(da,e.semiMajorAxis),p=q.computeEllipsePositions(e,!0,!1),l=p.positions,t=p.numPts,p=w(l,e,!1),t=G(t),t=D.createTypedArray(l.length/3,t),e=g,g=p,l=t,h(d._offsetAttribute)&&(p=new Uint8Array(g.position.values.length/3),b(p,d._offsetAttribute===z.NONE?0:1),g.applyOffset=new u({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:p}));return new c({attributes:g,indices:l,primitiveType:C.TRIANGLES,boundingSphere:e,offsetAttribute:d._offsetAttribute})}};L.createShadowVolume=function(a,c,b){var d=a._granularity,e=a._ellipsoid;c=c(d,e);b=b(d,e);return new L({center:a._center,semiMajorAxis:a._semiMajorAxis,semiMinorAxis:a._semiMinorAxis,ellipsoid:e,rotation:a._rotation,stRotation:a._stRotation,granularity:d,extrudedHeight:c,height:b,vertexFormat:J.POSITION_ONLY,shadowVolume:!0})};p(L.prototype,{rectangle:{get:function(){h(this._rectangle)||(this._rectangle=E(this._center,this._semiMajorAxis,this._semiMinorAxis,this._rotation,this._granularity,this._ellipsoid));return this._rectangle}},textureCoordinateRotationPoints:{get:function(){if(!h(this._textureCoordinateRotationPoints)){var a;a=-this._stRotation;if(0===a)a=[0,0,0,1,1,0];else{for(var b=q.computeEllipsePositions({center:this._center,semiMajorAxis:this._semiMajorAxis,semiMinorAxis:this._semiMinorAxis,rotation:this._rotation,granularity:this._granularity},!1,!0).outerPositions,d=b.length/3,e=Array(d),f=0;f<d;++f)e[f]=k.fromArray(b,3*f);a=c._textureCoordinateRotationPoints(e,a,this._ellipsoid,this.rectangle)}this._textureCoordinateRotationPoints=a}return this._textureCoordinateRotationPoints}}});return L});F("Core/CircleGeometry","./Cartesian3 ./Check ./defaultValue ./defined ./defineProperties ./EllipseGeometry ./Ellipsoid ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e){function h(b){b=f(b,f.EMPTY_OBJECT);var d=b.radius;a.typeOf.number("radius",d);this._ellipseGeometry=new l({center:b.center,semiMajorAxis:d,semiMinorAxis:d,ellipsoid:b.ellipsoid,height:b.height,extrudedHeight:b.extrudedHeight,granularity:b.granularity,vertexFormat:b.vertexFormat,stRotation:b.stRotation,shadowVolume:b.shadowVolume});this._workerName="createCircleGeometry"}h.packedLength=l.packedLength;h.pack=function(b,d,e){a.typeOf.object("value",b);return l.pack(b._ellipseGeometry,d,e)};var p=new l({center:new b,semiMajorAxis:1,semiMinorAxis:1}),d={center:new b,radius:void 0,ellipsoid:m.clone(m.UNIT_SPHERE),height:void 0,extrudedHeight:void 0,granularity:void 0,vertexFormat:new e,stRotation:void 0,semiMajorAxis:void 0,semiMinorAxis:void 0,shadowVolume:void 0};h.unpack=function(a,f,g){a=l.unpack(a,f,p);d.center=b.clone(a._center,d.center);d.ellipsoid=m.clone(a._ellipsoid,d.ellipsoid);d.height=a._height;d.extrudedHeight=a._extrudedHeight;d.granularity=a._granularity;d.vertexFormat=e.clone(a._vertexFormat,d.vertexFormat);d.stRotation=a._stRotation;d.shadowVolume=a._shadowVolume;if(!k(g))return d.radius=a._semiMajorAxis,new h(d);d.semiMajorAxis=a._semiMajorAxis;d.semiMinorAxis=a._semiMinorAxis;g._ellipseGeometry=new l(d);return g};h.createGeometry=function(a){return l.createGeometry(a._ellipseGeometry)};h.createShadowVolume=function(a,b,d){var c=a._ellipseGeometry._granularity,f=a._ellipseGeometry._ellipsoid;b=b(c,f);d=d(c,f);return new h({center:a._ellipseGeometry._center,radius:a._ellipseGeometry._semiMajorAxis,ellipsoid:f,stRotation:a._ellipseGeometry._stRotation,granularity:c,extrudedHeight:b,height:d,vertexFormat:e.POSITION_ONLY,shadowVolume:!0})};g(h.prototype,{rectangle:{get:function(){return this._ellipseGeometry.rectangle}},textureCoordinateRotationPoints:{get:function(){return this._ellipseGeometry.textureCoordinateRotationPoints}}});return h});F("Core/EllipseOutlineGeometry","./arrayFill ./BoundingSphere ./Cartesian3 ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./EllipseGeometryLibrary ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a){a=g(a,g.EMPTY_OBJECT);var b=a.center,d=g(a.ellipsoid,h.WGS84),e=a.semiMajorAxis,k=a.semiMinorAxis,p=g(a.granularity,c.RADIANS_PER_DEGREE);if(!l(b))throw new m("center is required.");if(!l(e))throw new m("semiMajorAxis is required.");if(!l(k))throw new m("semiMinorAxis is required.");if(e<k)throw new m("semiMajorAxis must be greater than or equal to the semiMinorAxis.");if(0>=p)throw new m("granularity must be greater than zero.");var v=g(a.height,0),q=g(a.extrudedHeight,v);this._center=f.clone(b);this._semiMajorAxis=e;this._semiMinorAxis=k;this._ellipsoid=h.clone(d);this._rotation=g(a.rotation,0);this._height=Math.max(q,v);this._granularity=p;this._extrudedHeight=Math.min(q,v);this._numberOfVerticalLines=Math.max(g(a.numberOfVerticalLines,16),0);this._offsetAttribute=a.offsetAttribute;this._workerName="createEllipseOutlineGeometry"}var A=new f,z=new f,x=new a,D=new a;y.packedLength=f.packedLength+h.packedLength+8;y.pack=function(a,c,b){if(!l(a))throw new m("value is required");if(!l(c))throw new m("array is required");b=g(b,0);f.pack(a._center,c,b);b+=f.packedLength;h.pack(a._ellipsoid,c,b);b+=h.packedLength;c[b++]=a._semiMajorAxis;c[b++]=a._semiMinorAxis;c[b++]=a._rotation;c[b++]=a._height;c[b++]=a._granularity;c[b++]=a._extrudedHeight;c[b++]=a._numberOfVerticalLines;c[b]=g(a._offsetAttribute,-1);return c};var v=new f,B=new h,C={center:v,ellipsoid:B,semiMajorAxis:void 0,semiMinorAxis:void 0,rotation:void 0,height:void 0,granularity:void 0,extrudedHeight:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};y.unpack=function(a,c,b){if(!l(a))throw new m("array is required");c=g(c,0);var d=f.unpack(a,c,v);c+=f.packedLength;var e=h.unpack(a,c,B);c+=h.packedLength;var k=a[c++],p=a[c++],q=a[c++],r=a[c++],u=a[c++],z=a[c++],t=a[c++];a=a[c];if(!l(b))return C.height=r,C.extrudedHeight=z,C.granularity=u,C.rotation=q,C.semiMajorAxis=k,C.semiMinorAxis=p,C.numberOfVerticalLines=t,C.offsetAttribute=-1===a?void 0:a,new y(C);b._center=f.clone(d,b._center);b._ellipsoid=h.clone(e,b._ellipsoid);b._semiMajorAxis=k;b._semiMinorAxis=p;b._rotation=q;b._height=r;b._granularity=u;b._extrudedHeight=z;b._numberOfVerticalLines=t;b._offsetAttribute=-1===a?void 0:a;return b};y.createGeometry=function(h){var m,v,w;if(!(0>=h._semiMajorAxis||0>=h._semiMinorAxis)){w=h._height;v=h._extrudedHeight;m=!c.equalsEpsilon(w,v,0,c.EPSILON2);h._center=h._ellipsoid.scaleToGeodeticSurface(h._center,h._center);w={center:h._center,semiMajorAxis:h._semiMajorAxis,semiMinorAxis:h._semiMinorAxis,ellipsoid:h._ellipsoid,rotation:h._rotation,height:w,granularity:h._granularity,numberOfVerticalLines:h._numberOfVerticalLines};if(m){w.extrudedHeight=v;w.offsetAttribute=h._offsetAttribute;v=w.center;m=w.ellipsoid;var B=w.semiMajorAxis,C=f.multiplyByScalar(m.geodeticSurfaceNormal(v,A),w.height,A);x.center=f.add(v,C,x.center);x.radius=B;C=f.multiplyByScalar(m.geodeticSurfaceNormal(v,C),w.extrudedHeight,C);D.center=f.add(v,C,D.center);D.radius=B;B=e.computeEllipsePositions(w,!1,!0).outerPositions;v=new q({position:new d({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:e.raisePositionsToHeight(B,w,!0)})});B=v.position.values;m=a.union(x,D);B=B.length/3;l(w.offsetAttribute)&&(C=new Uint8Array(B),C=w.offsetAttribute===t.TOP?b(C,1,0,B/2):b(C,w.offsetAttribute===t.NONE?0:1),v.applyOffset=new d({componentDatatype:k.UNSIGNED_BYTE,componentsPerAttribute:1,values:C}));var y=g(w.numberOfVerticalLines,16),y=c.clamp(y,0,B/2);w=r.createTypedArray(B,2*B+2*y);var B=B/2,C=0,I;for(I=0;I<B;++I)w[C++]=I,w[C++]=(I+1)%B,w[C++]=I+B,w[C++]=(I+1)%B+B;var P;if(0<y)for(P=Math.round(B/Math.min(y,B)),y=Math.min(P*y,B),I=0;I<y;I+=P)w[C++]=I,w[C++]=I+B}else{v=w.center;z=f.multiplyByScalar(w.ellipsoid.geodeticSurfaceNormal(v,z),w.height,z);z=f.add(v,z,z);v=new a(z,w.semiMajorAxis);m=e.computeEllipsePositions(w,!1,!0).outerPositions;w=new q({position:new d({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:e.raisePositionsToHeight(m,w,!1)})});m=m.length/3;B=r.createTypedArray(m,2*m);for(I=C=0;I<m;++I)B[C++]=I,B[C++]=(I+1)%m;m=v;v=w;w=B;l(h._offsetAttribute)&&(B=new Uint8Array(v.position.values.length/3),b(B,h._offsetAttribute===t.NONE?0:1),v.applyOffset=new d({componentDatatype:k.UNSIGNED_BYTE,componentsPerAttribute:1,values:B}))}return new p({attributes:v,indices:w,primitiveType:u.LINES,boundingSphere:m,offsetAttribute:h._offsetAttribute})}};return y});F("Core/CircleOutlineGeometry","./Cartesian3 ./Check ./defaultValue ./defined ./EllipseOutlineGeometry ./Ellipsoid".split(" "),function(b,a,f,k,g,l){function m(b){b=f(b,f.EMPTY_OBJECT);var d=b.radius;a.typeOf.number("radius",d);this._ellipseGeometry=new g({center:b.center,semiMajorAxis:d,semiMinorAxis:d,ellipsoid:b.ellipsoid,height:b.height,extrudedHeight:b.extrudedHeight,granularity:b.granularity,numberOfVerticalLines:b.numberOfVerticalLines});this._workerName="createCircleOutlineGeometry"}m.packedLength=g.packedLength;m.pack=function(b,d,e){a.typeOf.object("value",b);return g.pack(b._ellipseGeometry,d,e)};var e=new g({center:new b,semiMajorAxis:1,semiMinorAxis:1}),h={center:new b,radius:void 0,ellipsoid:l.clone(l.UNIT_SPHERE),height:void 0,extrudedHeight:void 0,granularity:void 0,numberOfVerticalLines:void 0,semiMajorAxis:void 0,semiMinorAxis:void 0};m.unpack=function(a,d,f){a=g.unpack(a,d,e);h.center=b.clone(a._center,h.center);h.ellipsoid=l.clone(a._ellipsoid,h.ellipsoid);h.height=a._height;h.extrudedHeight=a._extrudedHeight;h.granularity=a._granularity;h.numberOfVerticalLines=a._numberOfVerticalLines;if(!k(f))return h.radius=a._semiMajorAxis,new m(h);h.semiMajorAxis=a._semiMajorAxis;h.semiMinorAxis=a._semiMinorAxis;f._ellipseGeometry=new g(h);return f};m.createGeometry=function(a){return g.createGeometry(a._ellipseGeometry)};return m});F("Core/ClockRange",["./freezeObject"],function(b){return b({UNBOUNDED:0,CLAMPED:1,LOOP_STOP:2})});F("Core/ClockStep",["./freezeObject"],function(b){return b({TICK_DEPENDENT:0,SYSTEM_CLOCK_MULTIPLIER:1,SYSTEM_CLOCK:2})});F("Core/getTimestamp",[],function(){return"undefined"!==typeof performance&&"function"===typeof performance.now&&isFinite(performance.now())?function(){return performance.now()}:function(){return Date.now()}});F("Core/Clock","./ClockRange ./ClockStep ./defaultValue ./defined ./defineProperties ./DeveloperError ./Event ./getTimestamp ./JulianDate".split(" "),function(b,a,f,k,g,l,m,e,h){function p(d){d=f(d,f.EMPTY_OBJECT);var g=d.currentTime,p=d.startTime,r=d.stopTime,g=k(g)?h.clone(g):k(p)?h.clone(p):k(r)?h.addDays(r,-1,new h):h.now(),p=k(p)?h.clone(p):h.clone(g),r=k(r)?h.clone(r):h.addDays(p,1,new h);if(h.greaterThan(p,r))throw new l("startTime must come before stopTime.");this.startTime=p;this.stopTime=r;this.clockRange=f(d.clockRange,b.UNBOUNDED);this.canAnimate=f(d.canAnimate,!0);this.onTick=new m;this.onStop=new m;this._shouldAnimate=this._clockStep=this._multiplier=this._currentTime=void 0;this._lastSystemTime=e();this.currentTime=g;this.multiplier=f(d.multiplier,1);this.shouldAnimate=f(d.shouldAnimate,!1);this.clockStep=f(d.clockStep,a.SYSTEM_CLOCK_MULTIPLIER)}g(p.prototype,{currentTime:{get:function(){return this._currentTime},set:function(b){h.equals(this._currentTime,b)||(this._clockStep===a.SYSTEM_CLOCK&&(this._clockStep=a.SYSTEM_CLOCK_MULTIPLIER),this._currentTime=b)}},multiplier:{get:function(){return this._multiplier},set:function(b){this._multiplier!==b&&(this._clockStep===a.SYSTEM_CLOCK&&(this._clockStep=a.SYSTEM_CLOCK_MULTIPLIER),this._multiplier=b)}},clockStep:{get:function(){return this._clockStep},set:function(b){b===a.SYSTEM_CLOCK&&(this._multiplier=1,this._shouldAnimate=!0,this._currentTime=h.now());this._clockStep=b}},shouldAnimate:{get:function(){return this._shouldAnimate},set:function(b){this._shouldAnimate!==b&&(this._clockStep===a.SYSTEM_CLOCK&&(this._clockStep=a.SYSTEM_CLOCK_MULTIPLIER),this._shouldAnimate=b)}}});p.prototype.tick=function(){var d=e(),f=h.clone(this._currentTime);if(this.canAnimate&&this._shouldAnimate){var g=this._clockStep;if(g===a.SYSTEM_CLOCK)f=h.now(f);else{var k=this._multiplier,f=g===a.TICK_DEPENDENT?h.addSeconds(f,k,f):h.addSeconds(f,(d-this._lastSystemTime)/1E3*k,f),g=this.clockRange,k=this.startTime,c=this.stopTime;if(g===b.CLAMPED)h.lessThan(f,k)?f=h.clone(k,f):h.greaterThan(f,c)&&(f=h.clone(c,f),this.onStop.raiseEvent(this));else if(g===b.LOOP_STOP)for(h.lessThan(f,k)&&(f=h.clone(k,f));h.greaterThan(f,c);)f=h.addSeconds(k,h.secondsDifference(f,c),f),this.onStop.raiseEvent(this)}}this._currentTime=f;this._lastSystemTime=d;this.onTick.raiseEvent(this);return f};return p});F("Core/Color","./Check ./defaultValue ./defined ./FeatureDetection ./freezeObject ./Math".split(" "),function(b,a,f,k,g,l){function m(a,b,d){0>d&&(d+=1);1<d&&--d;return 1>6*d?a+6*(b-a)*d:1>2*d?b:2>3*d?a+(b-a)*(2/3-d)*6:a}function e(c,b,d,e){this.red=a(c,1);this.green=a(b,1);this.blue=a(d,1);this.alpha=a(e,1)}e.fromCartesian4=function(a,d){b.typeOf.object("cartesian",a);if(!f(d))return new e(a.x,a.y,a.z,a.w);d.red=a.x;d.green=a.y;d.blue=a.z;d.alpha=a.w;return d};e.fromBytes=function(c,b,d,h,g){c=e.byteToFloat(a(c,255));b=e.byteToFloat(a(b,255));d=e.byteToFloat(a(d,255));h=e.byteToFloat(a(h,255));if(!f(g))return new e(c,b,d,h);g.red=c;g.green=b;g.blue=d;g.alpha=h;return g};e.fromAlpha=function(a,d,h){b.typeOf.object("color",a);b.typeOf.number("alpha",d);if(!f(h))return new e(a.red,a.green,a.blue,d);h.red=a.red;h.green=a.green;h.blue=a.blue;h.alpha=d;return h};var h,p;k.supportsTypedArrays()&&(k=new ArrayBuffer(4),h=new Uint32Array(k),p=new Uint8Array(k));e.fromRgba=function(a,b){h[0]=a;return e.fromBytes(p[0],p[1],p[2],p[3],b)};e.fromHsl=function(c,b,d,h,g){c=a(c,0)%1;b=a(b,0);d=a(d,0);h=a(h,1);var k=d,l=d,p=d;0!==b&&(b=.5>d?d*(1+b):d+b-d*b,d=2*d-b,k=m(d,b,c+1/3),l=m(d,b,c),p=m(d,b,c-1/3));if(!f(g))return new e(k,l,p,h);g.red=k;g.green=l;g.blue=p;g.alpha=h;return g};e.fromRandom=function(c,d){c=a(c,a.EMPTY_OBJECT);var h=c.red;if(!f(h)){var h=a(c.minimumRed,0),g=a(c.maximumRed,1);b.typeOf.number.lessThanOrEquals("minimumRed",h,g);h+=l.nextRandomNumber()*(g-h)}g=c.green;if(!f(g)){var g=a(c.minimumGreen,0),k=a(c.maximumGreen,1);b.typeOf.number.lessThanOrEquals("minimumGreen",g,k);g+=l.nextRandomNumber()*(k-g)}k=c.blue;if(!f(k)){var k=a(c.minimumBlue,0),p=a(c.maximumBlue,1);b.typeOf.number.lessThanOrEquals("minimumBlue",k,p);k+=l.nextRandomNumber()*(p-k)}p=c.alpha;if(!f(p)){var p=a(c.minimumAlpha,0),m=a(c.maximumAlpha,1);b.typeOf.number.lessThanOrEquals("minumumAlpha",p,m);p+=l.nextRandomNumber()*(m-p)}if(!f(d))return new e(h,g,k,p);d.red=h;d.green=g;d.blue=k;d.alpha=p;return d};var d=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,q=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i,t=/^rgba?\(\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)\s*,\s*([0-9.]+%?)(?:\s*,\s*([0-9.]+))?\s*\)$/i,r=/^hsla?\(\s*([0-9.]+)\s*,\s*([0-9.]+%)\s*,\s*([0-9.]+%)(?:\s*,\s*([0-9.]+))?\s*\)$/i;e.fromCssColorString=function(c,h){b.typeOf.string("color",c);f(h)||(h=new e);var g=e[c.toUpperCase()];if(f(g))return e.clone(g,h),h;g=d.exec(c);if(null!==g)return h.red=parseInt(g[1],16)/15,h.green=parseInt(g[2],16)/15,h.blue=parseInt(g[3],16)/15,h.alpha=1,h;g=q.exec(c);if(null!==g)return h.red=parseInt(g[1],16)/255,h.green=parseInt(g[2],16)/255,h.blue=parseInt(g[3],16)/255,h.alpha=1,h;g=t.exec(c);if(null!==g)return h.red=parseFloat(g[1])/("%"===g[1].substr(-1)?100:255),h.green=parseFloat(g[2])/("%"===g[2].substr(-1)?100:255),h.blue=parseFloat(g[3])/("%"===g[3].substr(-1)?100:255),h.alpha=parseFloat(a(g[4],"1.0")),h;g=r.exec(c);if(null!==g)return e.fromHsl(parseFloat(g[1])/360,parseFloat(g[2])/100,parseFloat(g[3])/100,parseFloat(a(g[4],"1.0")),h)};e.packedLength=4;e.pack=function(c,d,e){b.typeOf.object("value",c);b.defined("array",d);e=a(e,0);d[e++]=c.red;d[e++]=c.green;d[e++]=c.blue;d[e]=c.alpha;return d};e.unpack=function(c,d,h){b.defined("array",c);d=a(d,0);f(h)||(h=new e);h.red=c[d++];h.green=c[d++];h.blue=c[d++];h.alpha=c[d];return h};e.byteToFloat=function(a){return a/255};e.floatToByte=function(a){return 1===a?255:256*a|0};e.clone=function(a,b){if(f(a)){if(!f(b))return new e(a.red,a.green,a.blue,a.alpha);b.red=a.red;b.green=a.green;b.blue=a.blue;b.alpha=a.alpha;return b}};e.equals=function(a,b){return a===b||f(a)&&f(b)&&a.red===b.red&&a.green===b.green&&a.blue===b.blue&&a.alpha===b.alpha};e.equalsArray=function(a,b,d){return a.red===b[d]&&a.green===b[d+1]&&a.blue===b[d+2]&&a.alpha===b[d+3]};e.prototype.getHSLA=function(){var a,b;a=this.red;var d=this.green,e=this.blue;b=Math.max(a,d,e);var f=Math.min(a,d,e),h,g=b-f;if(b===f)h=0;else{switch(b){case a:h=(d-e)/g+(d<e?6:0);break;case d:h=(e-a)/g+2;break;case e:h=(a-d)/g+4}h/=6}a=0===b?0:g/b;b=[h,a*b/(1>(h=(2-a)*b)?h:2-h)||0,h/2];b.push(this.alpha);return b};e.prototype.clone=function(a){return e.clone(this,a)};e.prototype.equals=function(a){return e.equals(this,a)};e.prototype.equalsEpsilon=function(a,b){return this===a||f(a)&&Math.abs(this.red-a.red)<=b&&Math.abs(this.green-a.green)<=b&&Math.abs(this.blue-a.blue)<=b&&Math.abs(this.alpha-a.alpha)<=b};e.prototype.toString=function(){return"("+this.red+", "+this.green+", "+this.blue+", "+this.alpha+")"};e.prototype.toCssColorString=function(){var a=e.floatToByte(this.red),b=e.floatToByte(this.green),d=e.floatToByte(this.blue);return 1===this.alpha?"rgb("+a+","+b+","+d+")":"rgba("+a+","+b+","+d+","+this.alpha+")"};e.prototype.toBytes=function(a){var c=e.floatToByte(this.red),b=e.floatToByte(this.green),d=e.floatToByte(this.blue),h=e.floatToByte(this.alpha);if(!f(a))return[c,b,d,h];a[0]=c;a[1]=b;a[2]=d;a[3]=h;return a};e.prototype.toRgba=function(){p[0]=e.floatToByte(this.red);p[1]=e.floatToByte(this.green);p[2]=e.floatToByte(this.blue);p[3]=e.floatToByte(this.alpha);return h[0]};e.prototype.brighten=function(a,d){b.typeOf.number("magnitude",a);b.typeOf.number.greaterThanOrEquals("magnitude",a,0);b.typeOf.object("result",d);a=1-a;d.red=1-(1-this.red)*a;d.green=1-(1-this.green)*a;d.blue=1-(1-this.blue)*a;d.alpha=this.alpha;return d};e.prototype.darken=function(a,d){b.typeOf.number("magnitude",a);b.typeOf.number.greaterThanOrEquals("magnitude",a,0);b.typeOf.object("result",d);a=1-a;d.red=this.red*a;d.green=this.green*a;d.blue=this.blue*a;d.alpha=this.alpha;return d};e.prototype.withAlpha=function(a,b){return e.fromAlpha(this,a,b)};e.add=function(a,d,e){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",e);e.red=a.red+d.red;e.green=a.green+d.green;e.blue=a.blue+d.blue;e.alpha=a.alpha+d.alpha;return e};e.subtract=function(a,d,e){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",e);e.red=a.red-d.red;e.green=a.green-d.green;e.blue=a.blue-d.blue;e.alpha=a.alpha-d.alpha;return e};e.multiply=function(a,d,e){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",e);e.red=a.red*d.red;e.green=a.green*d.green;e.blue=a.blue*d.blue;e.alpha=a.alpha*d.alpha;return e};e.divide=function(a,d,e){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",e);e.red=a.red/d.red;e.green=a.green/d.green;e.blue=a.blue/d.blue;e.alpha=a.alpha/d.alpha;return e};e.mod=function(a,d,e){b.typeOf.object("left",a);b.typeOf.object("right",d);b.typeOf.object("result",e);e.red=a.red%d.red;e.green=a.green%d.green;e.blue=a.blue%d.blue;e.alpha=a.alpha%d.alpha;return e};e.multiplyByScalar=function(a,d,e){b.typeOf.object("color",a);b.typeOf.number("scalar",d);b.typeOf.object("result",e);e.red=a.red*d;e.green=a.green*d;e.blue=a.blue*d;e.alpha=a.alpha*d;return e};e.divideByScalar=function(a,d,e){b.typeOf.object("color",a);b.typeOf.number("scalar",d);b.typeOf.object("result",e);e.red=a.red/d;e.green=a.green/d;e.blue=a.blue/d;e.alpha=a.alpha/d;return e};e.ALICEBLUE=g(e.fromCssColorString("#F0F8FF"));e.ANTIQUEWHITE=g(e.fromCssColorString("#FAEBD7"));e.AQUA=g(e.fromCssColorString("#00FFFF"));e.AQUAMARINE=g(e.fromCssColorString("#7FFFD4"));e.AZURE=g(e.fromCssColorString("#F0FFFF"));e.BEIGE=g(e.fromCssColorString("#F5F5DC"));e.BISQUE=g(e.fromCssColorString("#FFE4C4"));e.BLACK=g(e.fromCssColorString("#000000"));e.BLANCHEDALMOND=g(e.fromCssColorString("#FFEBCD"));e.BLUE=g(e.fromCssColorString("#0000FF"));e.BLUEVIOLET=g(e.fromCssColorString("#8A2BE2"));e.BROWN=g(e.fromCssColorString("#A52A2A"));e.BURLYWOOD=g(e.fromCssColorString("#DEB887"));e.CADETBLUE=g(e.fromCssColorString("#5F9EA0"));e.CHARTREUSE=g(e.fromCssColorString("#7FFF00"));e.CHOCOLATE=g(e.fromCssColorString("#D2691E"));e.CORAL=g(e.fromCssColorString("#FF7F50"));e.CORNFLOWERBLUE=g(e.fromCssColorString("#6495ED"));e.CORNSILK=g(e.fromCssColorString("#FFF8DC"));e.CRIMSON=g(e.fromCssColorString("#DC143C"));e.CYAN=g(e.fromCssColorString("#00FFFF"));e.DARKBLUE=g(e.fromCssColorString("#00008B"));e.DARKCYAN=g(e.fromCssColorString("#008B8B"));e.DARKGOLDENROD=g(e.fromCssColorString("#B8860B"));e.DARKGRAY=g(e.fromCssColorString("#A9A9A9"));e.DARKGREEN=g(e.fromCssColorString("#006400"));e.DARKGREY=e.DARKGRAY;e.DARKKHAKI=g(e.fromCssColorString("#BDB76B"));e.DARKMAGENTA=g(e.fromCssColorString("#8B008B"));e.DARKOLIVEGREEN=g(e.fromCssColorString("#556B2F"));e.DARKORANGE=g(e.fromCssColorString("#FF8C00"));e.DARKORCHID=g(e.fromCssColorString("#9932CC"));e.DARKRED=g(e.fromCssColorString("#8B0000"));e.DARKSALMON=g(e.fromCssColorString("#E9967A"));e.DARKSEAGREEN=g(e.fromCssColorString("#8FBC8F"));e.DARKSLATEBLUE=g(e.fromCssColorString("#483D8B"));e.DARKSLATEGRAY=g(e.fromCssColorString("#2F4F4F"));e.DARKSLATEGREY=e.DARKSLATEGRAY;e.DARKTURQUOISE=g(e.fromCssColorString("#00CED1"));e.DARKVIOLET=g(e.fromCssColorString("#9400D3"));e.DEEPPINK=g(e.fromCssColorString("#FF1493"));e.DEEPSKYBLUE=g(e.fromCssColorString("#00BFFF"));e.DIMGRAY=g(e.fromCssColorString("#696969"));e.DIMGREY=e.DIMGRAY;e.DODGERBLUE=g(e.fromCssColorString("#1E90FF"));e.FIREBRICK=g(e.fromCssColorString("#B22222"));e.FLORALWHITE=g(e.fromCssColorString("#FFFAF0"));e.FORESTGREEN=g(e.fromCssColorString("#228B22"));e.FUCHSIA=g(e.fromCssColorString("#FF00FF"));e.GAINSBORO=g(e.fromCssColorString("#DCDCDC"));e.GHOSTWHITE=g(e.fromCssColorString("#F8F8FF"));e.GOLD=g(e.fromCssColorString("#FFD700"));e.GOLDENROD=g(e.fromCssColorString("#DAA520"));e.GRAY=g(e.fromCssColorString("#808080"));e.GREEN=g(e.fromCssColorString("#008000"));e.GREENYELLOW=g(e.fromCssColorString("#ADFF2F"));e.GREY=e.GRAY;e.HONEYDEW=g(e.fromCssColorString("#F0FFF0"));e.HOTPINK=g(e.fromCssColorString("#FF69B4"));e.INDIANRED=g(e.fromCssColorString("#CD5C5C"));e.INDIGO=g(e.fromCssColorString("#4B0082"));e.IVORY=g(e.fromCssColorString("#FFFFF0"));e.KHAKI=g(e.fromCssColorString("#F0E68C"));e.LAVENDER=g(e.fromCssColorString("#E6E6FA"));e.LAVENDAR_BLUSH=g(e.fromCssColorString("#FFF0F5"));e.LAWNGREEN=g(e.fromCssColorString("#7CFC00"));e.LEMONCHIFFON=g(e.fromCssColorString("#FFFACD"));e.LIGHTBLUE=g(e.fromCssColorString("#ADD8E6"));e.LIGHTCORAL=g(e.fromCssColorString("#F08080"));e.LIGHTCYAN=g(e.fromCssColorString("#E0FFFF"));e.LIGHTGOLDENRODYELLOW=g(e.fromCssColorString("#FAFAD2"));e.LIGHTGRAY=g(e.fromCssColorString("#D3D3D3"));e.LIGHTGREEN=g(e.fromCssColorString("#90EE90"));e.LIGHTGREY=e.LIGHTGRAY;e.LIGHTPINK=g(e.fromCssColorString("#FFB6C1"));e.LIGHTSEAGREEN=g(e.fromCssColorString("#20B2AA"));e.LIGHTSKYBLUE=g(e.fromCssColorString("#87CEFA"));e.LIGHTSLATEGRAY=g(e.fromCssColorString("#778899"));e.LIGHTSLATEGREY=e.LIGHTSLATEGRAY;e.LIGHTSTEELBLUE=g(e.fromCssColorString("#B0C4DE"));e.LIGHTYELLOW=g(e.fromCssColorString("#FFFFE0"));e.LIME=g(e.fromCssColorString("#00FF00"));e.LIMEGREEN=g(e.fromCssColorString("#32CD32"));e.LINEN=g(e.fromCssColorString("#FAF0E6"));e.MAGENTA=g(e.fromCssColorString("#FF00FF"));e.MAROON=g(e.fromCssColorString("#800000"));e.MEDIUMAQUAMARINE=g(e.fromCssColorString("#66CDAA"));e.MEDIUMBLUE=g(e.fromCssColorString("#0000CD"));e.MEDIUMORCHID=g(e.fromCssColorString("#BA55D3"));e.MEDIUMPURPLE=g(e.fromCssColorString("#9370DB"));e.MEDIUMSEAGREEN=g(e.fromCssColorString("#3CB371"));e.MEDIUMSLATEBLUE=g(e.fromCssColorString("#7B68EE"));e.MEDIUMSPRINGGREEN=g(e.fromCssColorString("#00FA9A"));e.MEDIUMTURQUOISE=g(e.fromCssColorString("#48D1CC"));e.MEDIUMVIOLETRED=g(e.fromCssColorString("#C71585"));e.MIDNIGHTBLUE=g(e.fromCssColorString("#191970"));e.MINTCREAM=g(e.fromCssColorString("#F5FFFA"));e.MISTYROSE=g(e.fromCssColorString("#FFE4E1"));e.MOCCASIN=g(e.fromCssColorString("#FFE4B5"));e.NAVAJOWHITE=g(e.fromCssColorString("#FFDEAD"));e.NAVY=g(e.fromCssColorString("#000080"));e.OLDLACE=g(e.fromCssColorString("#FDF5E6"));e.OLIVE=g(e.fromCssColorString("#808000"));e.OLIVEDRAB=g(e.fromCssColorString("#6B8E23"));e.ORANGE=g(e.fromCssColorString("#FFA500"));e.ORANGERED=g(e.fromCssColorString("#FF4500"));e.ORCHID=g(e.fromCssColorString("#DA70D6"));e.PALEGOLDENROD=g(e.fromCssColorString("#EEE8AA"));e.PALEGREEN=g(e.fromCssColorString("#98FB98"));e.PALETURQUOISE=g(e.fromCssColorString("#AFEEEE"));e.PALEVIOLETRED=g(e.fromCssColorString("#DB7093"));e.PAPAYAWHIP=g(e.fromCssColorString("#FFEFD5"));e.PEACHPUFF=g(e.fromCssColorString("#FFDAB9"));e.PERU=g(e.fromCssColorString("#CD853F"));e.PINK=g(e.fromCssColorString("#FFC0CB"));e.PLUM=g(e.fromCssColorString("#DDA0DD"));e.POWDERBLUE=g(e.fromCssColorString("#B0E0E6"));e.PURPLE=g(e.fromCssColorString("#800080"));e.RED=g(e.fromCssColorString("#FF0000"));e.ROSYBROWN=g(e.fromCssColorString("#BC8F8F"));e.ROYALBLUE=g(e.fromCssColorString("#4169E1"));e.SADDLEBROWN=g(e.fromCssColorString("#8B4513"));e.SALMON=g(e.fromCssColorString("#FA8072"));e.SANDYBROWN=g(e.fromCssColorString("#F4A460"));e.SEAGREEN=g(e.fromCssColorString("#2E8B57"));e.SEASHELL=g(e.fromCssColorString("#FFF5EE"));e.SIENNA=g(e.fromCssColorString("#A0522D"));e.SILVER=g(e.fromCssColorString("#C0C0C0"));e.SKYBLUE=g(e.fromCssColorString("#87CEEB"));e.SLATEBLUE=g(e.fromCssColorString("#6A5ACD"));e.SLATEGRAY=g(e.fromCssColorString("#708090"));e.SLATEGREY=e.SLATEGRAY;e.SNOW=g(e.fromCssColorString("#FFFAFA"));e.SPRINGGREEN=g(e.fromCssColorString("#00FF7F"));e.STEELBLUE=g(e.fromCssColorString("#4682B4"));e.TAN=g(e.fromCssColorString("#D2B48C"));e.TEAL=g(e.fromCssColorString("#008080"));e.THISTLE=g(e.fromCssColorString("#D8BFD8"));e.TOMATO=g(e.fromCssColorString("#FF6347"));e.TURQUOISE=g(e.fromCssColorString("#40E0D0"));e.VIOLET=g(e.fromCssColorString("#EE82EE"));e.WHEAT=g(e.fromCssColorString("#F5DEB3"));e.WHITE=g(e.fromCssColorString("#FFFFFF"));e.WHITESMOKE=g(e.fromCssColorString("#F5F5F5"));e.YELLOW=g(e.fromCssColorString("#FFFF00"));e.YELLOWGREEN=g(e.fromCssColorString("#9ACD32"));e.TRANSPARENT=g(new e(0,0,0,0));return e});F("Core/ColorGeometryInstanceAttribute","./Color ./ComponentDatatype ./defaultValue ./defined ./defineProperties ./DeveloperError".split(" "),function(b,a,f,k,g,l){function m(a,h,g,d){a=f(a,1);h=f(h,1);g=f(g,1);d=f(d,1);this.value=new Uint8Array([b.floatToByte(a),b.floatToByte(h),b.floatToByte(g),b.floatToByte(d)])}g(m.prototype,{componentDatatype:{get:function(){return a.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 4}},normalize:{get:function(){return!0}}});m.fromColor=function(a){if(!k(a))throw new l("color is required.");return new m(a.red,a.green,a.blue,a.alpha)};m.toValue=function(a,b){if(!k(a))throw new l("color is required.");return k(b)?a.toBytes(b):new Uint8Array(a.toBytes())};m.equals=function(a,b){return a===b||k(a)&&k(b)&&a.value[0]===b.value[0]&&a.value[1]===b.value[1]&&a.value[2]===b.value[2]&&a.value[3]===b.value[3]};return m});F("Core/CompressedTextureBuffer",["./defined","./defineProperties"],function(b,a){function f(a,b,f,m){this._format=a;this._width=b;this._height=f;this._buffer=m}a(f.prototype,{internalFormat:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},bufferView:{get:function(){return this._buffer}}});f.clone=function(a){if(b(a))return new f(a._format,a._width,a._height,a._buffer)};f.prototype.clone=function(){return f.clone(this)};return f});F("Core/CoplanarPolygonGeometryLibrary","./defined ./Cartesian2 ./Cartesian3 ./Check ./IntersectionTests ./Math ./Matrix3 ./OrientedBoundingBox".split(" "),function(b,a,f,k,g,l,m,e){function h(c,b,d,e,h){c=f.subtract(c,b,p);d=f.dot(d,c);e=f.dot(e,c);return a.fromElements(d,e,h)}b={};var p=new f,d=new f,q=new f,t=new f,r=new e;b.validOutline=function(a){k.defined("positions",a);var c=e.fromPoints(a,r).halfAxes,b=m.getColumn(c,0,d);a=m.getColumn(c,1,q);c=m.getColumn(c,2,t);b=f.magnitude(b);a=f.magnitude(a);c=f.magnitude(c);return!(0===b&&(0===a||0===c)||0===a&&0===c)};b.computeProjectTo2DArguments=function(a,b,h,g){k.defined("positions",a);k.defined("centerResult",b);k.defined("planeAxis1Result",h);k.defined("planeAxis2Result",g);a=e.fromPoints(a,r);var c=a.halfAxes,l=m.getColumn(c,0,d),p=m.getColumn(c,1,q),c=m.getColumn(c,2,t),v=f.magnitude(l),B=f.magnitude(p),u=f.magnitude(c),y=Math.min(v,B,u);if(0===v&&(0===B||0===u)||0===B&&0===u)return!1;var A,J;if(y===B||y===u)A=l;y===v?A=p:y===u&&(J=p);if(y===v||y===B)J=c;f.normalize(A,h);f.normalize(J,g);f.clone(a.center,b);return!0};b.createProjectPointsTo2DFunction=function(a,b,d){return function(c){for(var e=Array(c.length),f=0;f<c.length;f++)e[f]=h(c[f],a,b,d);return e}};b.createProjectPointTo2DFunction=function(a,b,d){return function(c,e){return h(c,a,b,d,e)}};return b});F("Core/EllipsoidRhumbLine","./Cartesian3 ./Cartographic ./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./Math".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a,c,b){if(0===a)return c*b;a*=a;var d=a*a,e=d*a,f=e*a,h=f*a,g=h*a;return c*((1-a/4-3*d/64-5*e/256-175*f/16384-441*h/65536-4851*g/1048576)*b-(3*a/8+3*d/32+45*e/1024+105*f/4096+2205*h/131072+6237*g/524288)*Math.sin(2*b)+(15*d/256+45*e/1024+525*f/16384+1575*h/65536+155925*g/8388608)*Math.sin(4*b)-(35*e/3072+175*f/12288+3675*h/262144+13475*g/1048576)*Math.sin(6*b)+(315*f/131072+2205*h/524288+43659*g/8388608)*Math.sin(8*b)-(693*h/1310720+6237*g/5242880)*Math.sin(10*b)+1001*g/8388608*Math.sin(12*b))}function d(a,c){if(0===a)return Math.log(Math.tan(.5*(h.PI_OVER_TWO+c)));var b=a*Math.sin(c);return Math.log(Math.tan(.5*(h.PI_OVER_TWO+c)))-a/2*Math.log((1+b)/(1-b))}function q(e,g,k,l){var m=b.normalize(l.cartographicToCartesian(g,u),c),v=b.normalize(l.cartographicToCartesian(k,u),u);f.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(b.angleBetween(m,v))-Math.PI),.0125);v=l.maximumRadius;m=l.minimumRadius;v*=v;e._ellipticitySquared=(v-m*m)/v;e._ellipticity=Math.sqrt(e._ellipticitySquared);e._start=a.clone(g,e._start);e._start.height=0;e._end=a.clone(k,e._end);e._end.height=0;var m=g.longitude,v=k.longitude,q=k.latitude,r=d(e._ellipticity,g.latitude),q=d(e._ellipticity,q),m=Math.atan2(h.negativePiToPi(v-m),q-r);e._heading=m;m=l.maximumRadius;q=l.minimumRadius;l=g.latitude;v=k.latitude;r=e._heading;g=k.longitude-g.longitude;h.equalsEpsilon(Math.abs(r),h.PI_OVER_TWO,h.EPSILON8)?m===q?g=m*Math.cos(l)*h.negativePiToPi(g):(k=Math.sin(l),g=m*Math.cos(l)*h.negativePiToPi(g)/Math.sqrt(1-e._ellipticitySquared*k*k)):(g=p(e._ellipticity,m,l),g=(p(e._ellipticity,m,v)-g)/Math.cos(r));e._distance=Math.abs(g)}function t(c,b,e,f,k,l){var m=k*k,v;if(Math.abs(h.PI_OVER_TWO-Math.abs(b))>h.EPSILON8){v=(p(k,f,c.latitude)+e*Math.cos(b))/f;if(0!==k){e=v*v;f=e*v;var m=f*v,q=k*k,r=q*q,u=r*q,w=u*q,z=w*q,t=z*q;v=v+v*q/4+7*v*r/64+15*v*u/256+579*v*w/16384+1515*v*z/65536+16837*v*t/1048576+(3*v*r/16+45*v*u/256-v*(32*e-561)*w/4096-v*(232*e-1677)*z/16384+v*(399985-90560*e+512*m)*t/5242880)*Math.cos(2*v)+(21*v*u/256+483*v*w/4096-v*(224*e-1969)*z/16384-v*(33152*e-112599)*t/1048576)*Math.cos(4*v)+(151*v*w/4096+4681*v*z/65536+1479*v*t/16384-453*f*t/32768)*Math.cos(6*v)+(1097*v*z/65536+42783*v*t/1048576)*Math.cos(8*v)+8011*v*t/1048576*Math.cos(10*v)+(3*q/8+3*r/16+213*u/2048-3*e*u/64+255*w/4096-33*e*w/512+20861*z/524288-33*e*z/512+m*z/1024+28273*t/1048576-471*e*t/8192+9*m*t/4096)*Math.sin(2*v)+(21*r/256+21*u/256+533*w/8192-21*e*w/512+197*z/4096-315*e*z/4096+584039*t/16777216-12517*e*t/131072+7*m*t/2048)*Math.sin(4*v)+(151*u/6144+151*w/4096+5019*z/131072-453*e*z/16384+26965*t/786432-8607*e*t/131072)*Math.sin(6*v)+(1097*w/131072+1097*z/65536+225797*t/10485760-1097*e*t/65536)*Math.sin(8*v)+(8011*z/2621440+8011*t/1048576)*Math.sin(10*v)+293393*t/251658240*Math.sin(12*v)}e=d(k,c.latitude);k=d(k,v);k=Math.tan(b)*(k-e);c=h.negativePiToPi(c.longitude+k)}else v=c.latitude,0===k?k=f*Math.cos(c.latitude):(k=Math.sin(c.latitude),k=f*Math.cos(c.latitude)/Math.sqrt(1-m*k*k)),k=e/k,c=0<b?h.negativePiToPi(c.longitude+k):h.negativePiToPi(c.longitude-k);return g(l)?(l.longitude=c,l.latitude=v,l.height=0,l):new a(c,v,0)}function r(c,b,d){this._ellipsoid=d=k(d,e.WGS84);this._start=new a;this._end=new a;this._ellipticitySquared=this._ellipticity=this._distance=this._heading=void 0;g(c)&&g(b)&&q(this,c,b,d)}var c=new b,u=new b;l(r.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){f.defined("distance",this._distance);return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},heading:{get:function(){f.defined("distance",this._distance);return this._heading}}});r.fromStartHeadingDistance=function(a,c,b,d,l){f.defined("start",a);f.defined("heading",c);f.defined("distance",b);f.typeOf.number.greaterThan("distance",b,0);var p=k(d,e.WGS84),m=p.maximumRadius,q=p.minimumRadius,m=m*m,q=Math.sqrt((m-q*q)/m);c=h.negativePiToPi(c);c=t(a,c,b,p.maximumRadius,q);if(!g(l)||g(d)&&!d.equals(l.ellipsoid))return new r(a,c,p);l.setEndPoints(a,c);return l};r.prototype.setEndPoints=function(a,c){f.defined("start",a);f.defined("end",c);q(this,a,c,this._ellipsoid)};r.prototype.interpolateUsingFraction=function(a,c){return this.interpolateUsingSurfaceDistance(a*this._distance,c)};r.prototype.interpolateUsingSurfaceDistance=function(a,c){f.typeOf.number("distance",a);if(!g(this._distance)||0===this._distance)throw new m("EllipsoidRhumbLine must have distinct start and end set.");return t(this._start,this._heading,a,this._ellipsoid.maximumRadius,this._ellipticity,c)};r.prototype.findIntersectionWithLongitude=function(c,b){f.typeOf.number("intersectionLongitude",c);if(!g(this._distance)||0===this._distance)throw new m("EllipsoidRhumbLine must have distinct start and end set.");var d=this._ellipticity,e=this._heading,k=Math.abs(e),l=this._start;c=h.negativePiToPi(c);h.equalsEpsilon(Math.abs(c),Math.PI,h.EPSILON14)&&(c=h.sign(l.longitude)*Math.PI);g(b)||(b=new a);if(Math.abs(h.PI_OVER_TWO-k)<=h.EPSILON8)return b.longitude=c,b.latitude=l.latitude,b.height=0,b;if(h.equalsEpsilon(Math.abs(h.PI_OVER_TWO-k),h.PI_OVER_TWO,h.EPSILON8)){if(h.equalsEpsilon(c,l.longitude,h.EPSILON12))return;b.longitude=c;b.latitude=h.PI_OVER_TWO*h.sign(h.PI_OVER_TWO-e);b.height=0;return b}var p=l.latitude,k=d*Math.sin(p),e=Math.tan(.5*(h.PI_OVER_TWO+p))*Math.exp((c-l.longitude)/Math.tan(e)),k=(1+k)/(1-k),p=l.latitude;do l=p,p=d*Math.sin(l),p=2*Math.atan(e*Math.pow((1+p)/(1-p)/k,d/2))-h.PI_OVER_TWO;while(!h.equalsEpsilon(p,l,h.EPSILON12));b.longitude=c;b.latitude=p;b.height=0;return b};r.prototype.findIntersectionWithLatitude=function(c,b){f.typeOf.number("intersectionLatitude",c);if(!g(this._distance)||0===this._distance)throw new m("EllipsoidRhumbLine must have distinct start and end set.");var e=this._ellipticity,k=this._heading,l=this._start;if(!h.equalsEpsilon(Math.abs(k),h.PI_OVER_TWO,h.EPSILON8)){var p=d(e,l.latitude),e=d(e,c),k=h.negativePiToPi(l.longitude+Math.tan(k)*(e-p));return g(b)?(b.longitude=k,b.latitude=c,b.height=0,b):new a(k,c,0)}};return r});F("ThirdParty/earcut-2.1.1",[],function(){function b(c,b,d){d=d||2;var h=b&&b.length,p=h?b[0]*d:c.length,m=a(c,0,p,d,!0),q=[];if(!m)return q;var u,t,w,z;if(h){var E=d,h=[],y,D,x;z=0;for(y=b.length;z<y;z++)D=b[z]*E,x=z<y-1?b[z+1]*E:c.length,D=a(c,D,x,E,!1),D===D.next&&(D.steiner=!0),h.push(e(D));h.sort(g);for(z=0;z<h.length;z++){b=h[z];E=m;if(E=l(b,E))b=r(E,b),f(b,b.next);m=f(m,m.next)}}if(c.length>80*d){u=w=c[0];t=h=c[1];for(E=d;E<p;E+=d)z=c[E],b=c[E+1],z<u&&(u=z),b<t&&(t=b),z>w&&(w=z),b>h&&(h=b);w=Math.max(w-u,h-t)}k(m,q,d,u,t,w);return q}function a(a,b,e,f,h){var g;if(h===0<A(a,b,e,f))for(h=b;h<e;h+=f)g=c(h,a[h],a[h+1],g);else for(h=e-f;h>=b;h-=f)g=c(h,a[h],a[h+1],g);g&&d(g,g.next)&&(u(g),g=g.next);return g}function f(a,c){if(!a)return a;c||(c=a);var b=a,e;do if(e=!1,b.steiner||!d(b,b.next)&&0!==p(b.prev,b,b.next))b=b.next;else{u(b);b=c=b.prev;if(b===b.next)return null;e=!0}while(e||b!==c);return c}function k(a,c,b,e,g,l,y){if(a){if(!y&&l){var v=a,B=v;do null===B.z&&(B.z=m(B.x,B.y,e,g,l)),B.prevZ=B.prev,B=B.nextZ=B.next;while(B!==v);B.prevZ.nextZ=null;B.prevZ=null;var v=B,w,C,z,D,x,A,I=1;do{B=v;z=v=null;for(D=0;B;){D++;C=B;for(w=x=0;w<I&&(x++,C=C.nextZ,C);w++);for(A=I;0<x||0<A&&C;)0===x?(w=C,C=C.nextZ,A--):0!==A&&C?B.z<=C.z?(w=B,B=B.nextZ,x--):(w=C,C=C.nextZ,A--):(w=B,B=B.nextZ,x--),z?z.nextZ=w:v=w,w.prevZ=z,z=w;B=C}z.nextZ=null;I*=2}while(1<D)}for(v=a;a.prev!==a.next;){B=a.prev;C=a.next;if(l)a:{z=a;A=e;var O=g,Z=l;D=z.prev;x=z;I=z.next;if(0<=p(D,x,I))z=!1;else{var aa=D.x>x.x?D.x>I.x?D.x:I.x:x.x>I.x?x.x:I.x,U=D.y>x.y?D.y>I.y?D.y:I.y:x.y>I.y?x.y:I.y;w=m(D.x<x.x?D.x<I.x?D.x:I.x:x.x<I.x?x.x:I.x,D.y<x.y?D.y<I.y?D.y:I.y:x.y<I.y?x.y:I.y,A,O,Z);A=m(aa,U,A,O,Z);for(O=z.nextZ;O&&O.z<=A;){if(O!==z.prev&&O!==z.next&&h(D.x,D.y,x.x,x.y,I.x,I.y,O.x,O.y)&&0<=p(O.prev,O,O.next)){z=!1;break a}O=O.nextZ}for(O=z.prevZ;O&&O.z>=w;){if(O!==z.prev&&O!==z.next&&h(D.x,D.y,x.x,x.y,I.x,I.y,O.x,O.y)&&0<=p(O.prev,O,O.next)){z=!1;break a}O=O.prevZ}z=!0}}else a:if(z=a,D=z.prev,x=z,I=z.next,0<=p(D,x,I))z=!1;else{for(w=z.next.next;w!==z.prev;){if(h(D.x,D.y,x.x,x.y,I.x,I.y,w.x,w.y)&&0<=p(w.prev,w,w.next)){z=!1;break a}w=w.next}z=!0}if(z)c.push(B.i/b),c.push(a.i/b),c.push(C.i/b),u(a),v=a=C.next;else if(a=C,a===v){if(!y)k(f(a),c,b,e,g,l,1);else if(1===y){y=c;v=b;B=a;do C=B.prev,z=B.next.next,!d(C,z)&&q(C,B,B.next,z)&&t(C,z)&&t(z,C)&&(y.push(C.i/v),y.push(B.i/v),y.push(z.i/v),u(B),u(B.next),B=a=z),B=B.next;while(B!==a);a=B;k(a,c,b,e,g,l,2)}else if(2===y)a:{y=a;do{for(v=y.next.next;v!==y.prev;){if(B=y.i!==v.i){B=y;C=v;if(z=B.next.i!==C.i&&B.prev.i!==C.i){b:{z=B;do{if(z.i!==B.i&&z.next.i!==B.i&&z.i!==C.i&&z.next.i!==C.i&&q(z,z.next,B,C)){z=!0;break b}z=z.next}while(z!==B);z=!1}z=!z}if(z=z&&t(B,C)&&t(C,B)){z=B;D=!1;x=(B.x+C.x)/2;C=(B.y+C.y)/2;do z.y>C!==z.next.y>C&&x<(z.next.x-z.x)*(C-z.y)/(z.next.y-z.y)+z.x&&(D=!D),z=z.next;while(z!==B);z=D}B=z}if(B){a=r(y,v);y=f(y,y.next);a=f(a,a.next);k(y,c,b,e,g,l);k(a,c,b,e,g,l);break a}v=v.next}y=y.next}while(y!==a)}break}}}}function g(a,c){return a.x-c.x}function l(a,c){var b=c,d=a.x,e=a.y,f=-Infinity,g;do{if(e<=b.y&&e>=b.next.y){var k=b.x+(e-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(k<=d&&k>f){f=k;if(k===d){if(e===b.y)return b;if(e===b.next.y)return b.next}g=b.x<b.next.x?b:b.next}}b=b.next}while(b!==c);if(!g)return null;if(d===f)return g.prev;for(var k=g,l=g.x,p=g.y,m=Infinity,q,b=g.next;b!==k;)d>=b.x&&b.x>=l&&h(e<p?d:f,e,l,p,e<p?f:d,e,b.x,b.y)&&(q=Math.abs(e-b.y)/(d-b.x),(q<m||q===m&&b.x>g.x)&&t(b,a)&&(g=b,m=q)),b=b.next;return g}function m(a,c,b,d,e){a=32767*(a-b)/e;c=32767*(c-d)/e;a=(a|a<<8)&16711935;a=(a|a<<4)&252645135;a=(a|a<<2)&858993459;c=(c|c<<8)&16711935;c=(c|c<<4)&252645135;c=(c|c<<2)&858993459;return(a|a<<1)&1431655765|((c|c<<1)&1431655765)<<1}function e(a){var c=a,b=a;do c.x<b.x&&(b=c),c=c.next;while(c!==a);return b}function h(a,c,b,d,e,f,h,g){return 0<=(e-h)*(c-g)-(a-h)*(f-g)&&0<=(a-h)*(d-g)-(b-h)*(c-g)&&0<=(b-h)*(f-g)-(e-h)*(d-g)}function p(a,c,b){return(c.y-a.y)*(b.x-c.x)-(c.x-a.x)*(b.y-c.y)}function d(a,c){return a.x===c.x&&a.y===c.y}function q(a,c,b,e){return d(a,c)&&d(b,e)||d(a,e)&&d(b,c)?!0:0<p(a,c,b)!==0<p(a,c,e)&&0<p(b,e,a)!==0<p(b,e,c)}function t(a,c){return 0>p(a.prev,a,a.next)?0<=p(a,c,a.next)&&0<=p(a,a.prev,c):0>p(a,c,a.prev)||0>p(a,a.next,c)}function r(a,c){var b=new y(a.i,a.x,a.y),d=new y(c.i,c.x,c.y),e=a.next,f=c.prev;a.next=c;c.prev=a;b.next=e;e.prev=b;d.next=b;b.prev=d;f.next=d;d.prev=f;return d}function c(a,c,b,d){a=new y(a,c,b);d?(a.next=d.next,a.prev=d,d.next.prev=a,d.next=a):(a.prev=a,a.next=a);return a}function u(a){a.next.prev=a.prev;a.prev.next=a.next;a.prevZ&&(a.prevZ.nextZ=a.nextZ);a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function y(a,c,b){this.i=a;this.x=c;this.y=b;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function A(a,c,b,d){for(var e=0,f=b-d;c<b;c+=d)e+=(a[f]-a[c])*(a[c+1]+a[f+1]),f=c;return e}b.deviation=function(a,c,b,d){var e=c&&c.length,f=Math.abs(A(a,0,e?c[0]*b:a.length,b));if(e)for(var e=0,h=c.length;e<h;e++)f-=Math.abs(A(a,c[e]*b,e<h-1?c[e+1]*b:a.length,b));for(e=c=0;e<d.length;e+=3){var h=d[e]*b,g=d[e+1]*b,k=d[e+2]*b;c+=Math.abs((a[h]-a[k])*(a[g+1]-a[h+1])-(a[h]-a[g])*(a[k+1]-a[h+1]))}return 0===f&&0===c?0:Math.abs((c-f)/f)};b.flatten=function(a){for(var c=a[0][0].length,b={vertices:[],holes:[],dimensions:c},d=0,e=0;e<a.length;e++){for(var f=0;f<a[e].length;f++)for(var h=0;h<c;h++)b.vertices.push(a[e][f][h]);0<e&&(d+=a[e-1].length,b.holes.push(d))}return b};return b});F("Core/WindingOrder",["./freezeObject","./WebGLConstants"],function(b,a){var f={CLOCKWISE:a.CW,COUNTER_CLOCKWISE:a.CCW,validate:function(a){return a===f.CLOCKWISE||a===f.COUNTER_CLOCKWISE}};return b(f)});F("Core/PolygonPipeline","../ThirdParty/earcut-2.1.1 ./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./ComponentDatatype ./defaultValue ./defined ./Ellipsoid ./EllipsoidRhumbLine ./Geometry ./GeometryAttribute ./Math ./PrimitiveType ./WindingOrder".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){var u=new f,y=new f,A={computeArea2D:function(a){g.defined("positions",a);g.typeOf.number.greaterThanOrEquals("positions.length",a.length,3);for(var c=a.length,b=0,d=c-1,e=0;e<c;d=e++)var d=a[d],f=a[e],b=b+(d.x*f.y-f.x*d.y);return.5*b},computeWindingOrder2D:function(a){return 0<A.computeArea2D(a)?c.COUNTER_CLOCKWISE:c.CLOCKWISE},triangulate:function(c,d){g.defined("positions",c);var e=a.packArray(c);return b(e,d,2)}},z=new f,x=new f,D=new f,v=new f,B=new f,C=new f,I=new f;A.computeSubdivision=function(a,c,b,h){h=m(h,t.RADIANS_PER_DEGREE);g.typeOf.object("ellipsoid",a);g.defined("positions",c);g.defined("indices",b);g.typeOf.number.greaterThanOrEquals("indices.length",b.length,3);g.typeOf.number.equals("indices.length % 3","0",b.length%3,0);g.typeOf.number.greaterThan("granularity",h,0);b=b.slice(0);var k,p=c.length,w=Array(3*p),u=0;for(k=0;k<p;k++){var y=c[k];w[u++]=y.x;w[u++]=y.y;w[u++]=y.z}c=[];p={};a=a.maximumRadius;h=t.chordLength(h,a);for(h*=h;0<b.length;){var u=b.pop(),y=b.pop(),E=b.pop(),G=f.fromArray(w,3*E,z),A=f.fromArray(w,3*y,x),L=f.fromArray(w,3*u,D),H=f.multiplyByScalar(f.normalize(G,v),a,v),K=f.multiplyByScalar(f.normalize(A,B),a,B),J=f.multiplyByScalar(f.normalize(L,C),a,C);k=f.magnitudeSquared(f.subtract(H,K,I));K=f.magnitudeSquared(f.subtract(K,J,I));H=f.magnitudeSquared(f.subtract(J,H,I));J=Math.max(k,K,H);J>h?k===J?(K=Math.min(E,y)+" "+Math.max(E,y),k=p[K],e(k)||(G=f.add(G,A,I),f.multiplyByScalar(G,.5,G),w.push(G.x,G.y,G.z),k=w.length/3-1,p[K]=k),b.push(E,k,u),b.push(k,y,u)):K===J?(K=Math.min(y,u)+" "+Math.max(y,u),k=p[K],e(k)||(G=f.add(A,L,I),f.multiplyByScalar(G,.5,G),w.push(G.x,G.y,G.z),k=w.length/3-1,p[K]=k),b.push(y,k,E),b.push(k,u,E)):H===J&&(K=Math.min(u,E)+" "+Math.max(u,E),k=p[K],e(k)||(G=f.add(L,G,I),f.multiplyByScalar(G,.5,G),w.push(G.x,G.y,G.z),k=w.length/3-1,p[K]=k),b.push(u,k,y),b.push(k,E,y)):(c.push(E),c.push(y),c.push(u))}return new d({attributes:{position:new q({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:w})},indices:c,primitiveType:r.TRIANGLES})};var H=new k,J=new k,w=new k,G=new k;A.computeRhumbLineSubdivision=function(a,c,b,h){h=m(h,t.RADIANS_PER_DEGREE);g.typeOf.object("ellipsoid",a);g.defined("positions",c);g.defined("indices",b);g.typeOf.number.greaterThanOrEquals("indices.length",b.length,3);g.typeOf.number.equals("indices.length % 3","0",b.length%3,0);g.typeOf.number.greaterThan("granularity",h,0);b=b.slice(0);var k,v=c.length,u=Array(3*v),B=0;for(k=0;k<v;k++){var C=c[k];u[B++]=C.x;u[B++]=C.y;u[B++]=C.z}c=[];v={};h=t.chordLength(h,a.maximumRadius);for(var B=new p(void 0,void 0,a),C=new p(void 0,void 0,a),y=new p(void 0,void 0,a);0<b.length;){var E=b.pop(),A=b.pop(),L=b.pop(),K=f.fromArray(u,3*L,z),P=f.fromArray(u,3*A,x);k=f.fromArray(u,3*E,D);var K=a.cartesianToCartographic(K,H),P=a.cartesianToCartographic(P,J),ca=a.cartesianToCartographic(k,w);B.setEndPoints(K,P);k=B.surfaceDistance;C.setEndPoints(P,ca);var T=C.surfaceDistance;y.setEndPoints(ca,K);var da=y.surfaceDistance,V=Math.max(k,T,da);V>h?k===V?(T=Math.min(L,A)+" "+Math.max(L,A),k=v[T],e(k)||(k=B.interpolateUsingFraction(.5,G),K=.5*(K.height+P.height),K=f.fromRadians(k.longitude,k.latitude,K,a,I),u.push(K.x,K.y,K.z),k=u.length/3-1,v[T]=k),b.push(L,k,E),b.push(k,A,E)):T===V?(T=Math.min(A,E)+" "+Math.max(A,E),k=v[T],e(k)||(k=C.interpolateUsingFraction(.5,G),K=.5*(P.height+ca.height),K=f.fromRadians(k.longitude,k.latitude,K,a,I),u.push(K.x,K.y,K.z),k=u.length/3-1,v[T]=k),b.push(A,k,L),b.push(k,E,L)):da===V&&(T=Math.min(E,L)+" "+Math.max(E,L),k=v[T],e(k)||(k=y.interpolateUsingFraction(.5,G),K=.5*(ca.height+K.height),K=f.fromRadians(k.longitude,k.latitude,K,a,I),u.push(K.x,K.y,K.z),k=u.length/3-1,v[T]=k),b.push(E,k,A),b.push(k,L,A)):(c.push(L),c.push(A),c.push(E))}return new d({attributes:{position:new q({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:u})},indices:c,primitiveType:r.TRIANGLES})};A.scaleToGeodeticHeight=function(a,c,b,d){b=m(b,h.WGS84);var g=u,k=y;c=m(c,0);d=m(d,!0);if(e(a))for(var l=a.length,p=0;p<l;p+=3)f.fromArray(a,p,k),d&&(k=b.scaleToGeodeticSurface(k,k)),0!==c&&(g=b.geodeticSurfaceNormal(k,g),f.multiplyByScalar(g,c,g),f.add(k,g,k)),a[p]=k.x,a[p+1]=k.y,a[p+2]=k.z;return a};return A});F("Core/Queue",["./defineProperties"],function(b){function a(){this._array=[];this._length=this._offset=0}b(a.prototype,{length:{get:function(){return this._length}}});a.prototype.enqueue=function(a){this._array.push(a);this._length++};a.prototype.dequeue=function(){if(0!==this._length){var a=this._array,b=this._offset,g=a[b];a[b]=void 0;b++;10<b&&2*b>a.length&&(this._array=a.slice(b),b=0);this._offset=b;this._length--;return g}};a.prototype.peek=function(){if(0!==this._length)return this._array[this._offset]};a.prototype.contains=function(a){return-1!==this._array.indexOf(a)};a.prototype.clear=function(){this._array.length=this._offset=this._length=0};a.prototype.sort=function(a){0<this._offset&&(this._array=this._array.slice(this._offset),this._offset=0);this._array.sort(a)};return a});F("Core/PolygonGeometryLibrary","./ArcType ./arrayRemoveDuplicates ./Cartesian2 ./Cartesian3 ./Cartographic ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./EllipsoidRhumbLine ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryPipeline ./IndexDatatype ./Math ./Matrix3 ./PolygonPipeline ./PrimitiveType ./Quaternion ./Queue ./WindingOrder".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){var C={computeHierarchyPackedLength:function(a){var c=0;for(a=[a];0<a.length;){var b=a.pop();if(e(b)){var c=c+2,d=b.positions,b=b.holes;e(d)&&(c+=d.length*k.packedLength);if(e(b))for(var d=b.length,f=0;f<d;++f)a.push(b[f])}}return c},packPolygonHierarchy:function(a,c,b){for(a=[a];0<a.length;){var d=a.pop();if(e(d)){var f=d.positions,d=d.holes;c[b++]=e(f)?f.length:0;c[b++]=e(d)?d.length:0;if(e(f))for(var h=f.length,g=0;g<h;++g,b+=3)k.pack(f[g],c,b);if(e(d))for(f=d.length,h=0;h<f;++h)a.push(d[h])}}return b},unpackPolygonHierarchy:function(a,c){for(var b=a[c++],d=a[c++],e=Array(b),f=0<d?Array(d):void 0,h=0;h<b;++h,c+=k.packedLength)e[h]=k.unpack(a,c);for(b=0;b<d;++b)f[b]=C.unpackPolygonHierarchy(a,c),c=f[b].startingIndex,delete f[b].startingIndex;return{positions:e,holes:f,startingIndex:c}}},I=new k;C.subdivideLineCount=function(a,c,b){a=k.distance(a,c);b=Math.max(0,Math.ceil(y.log2(a/b)));return Math.pow(2,b)};var H=new g,J=new g,w=new g,G=new k;C.subdivideRhumbLineCount=function(a,c,b,e){c=a.cartesianToCartographic(c,H);b=a.cartesianToCartographic(b,J);a=(new d(c,b,a)).surfaceDistance/e;a=Math.max(0,Math.ceil(y.log2(a)));return Math.pow(2,a)};C.subdivideLine=function(a,c,b,d){b=C.subdivideLineCount(a,c,b);var f=k.distance(a,c),h=f/b;e(d)||(d=[]);d.length=3*b;for(var g=0,l=0;l<b;l++){var p;p=a;var m=l*h,v=f;k.subtract(c,p,I);k.multiplyByScalar(I,m/v,I);k.add(p,I,I);p=[I.x,I.y,I.z];d[g++]=p[0];d[g++]=p[1];d[g++]=p[2]}return d};C.subdivideRhumbLine=function(a,c,b,f,h){c=a.cartesianToCartographic(c,H);b=a.cartesianToCartographic(b,J);b=new d(c,b,a);f=Math.max(0,Math.ceil(y.log2(b.surfaceDistance/f)));f=Math.pow(2,f);c=b.surfaceDistance/f;e(h)||(h=[]);h.length=3*f;for(var g=0,k=0;k<f;k++){var l=b.interpolateUsingSurfaceDistance(k*c,w),l=a.cartographicToCartesian(l,G);h[g++]=l.x;h[g++]=l.y;h[g++]=l.z}return h};var E=new k,L=new k,K=new k,P=new k;C.scaleToGeodeticHeightExtruded=function(a,c,b,d,f){d=m(d,p.WGS84);var h=L,g=P;if(e(a)&&e(a.attributes)&&e(a.attributes.position))for(var l=a.attributes.position.values,v=l.length/2,q=0;q<v;q+=3)k.fromArray(l,q,K),d.geodeticSurfaceNormal(K,E),g=d.scaleToGeodeticSurface(K,g),h=k.multiplyByScalar(E,b,h),h=k.add(g,h,h),l[q+v]=h.x,l[q+1+v]=h.y,l[q+2+v]=h.z,f&&(g=k.clone(K,g)),h=k.multiplyByScalar(E,c,h),h=k.add(g,h,h),l[q]=h.x,l[q+1]=h.y,l[q+2]=h.z;return a};C.polygonOutlinesFromHierarchy=function(c,b,d){var f=[],h=new v;h.enqueue(c);for(var g,l;0!==h.length;){var p=h.dequeue(),m=p.positions;if(b)for(l=m.length,c=0;c<l;c++)d.scaleToGeodeticSurface(m[c],m[c]);m=a(m,k.equalsEpsilon,!0);if(!(3>m.length)){var q=p.holes?p.holes.length:0;for(c=0;c<q;c++){var r=p.holes[c],w=r.positions;if(b)for(l=w.length,g=0;g<l;++g)d.scaleToGeodeticSurface(w[g],w[g]);w=a(w,k.equalsEpsilon,!0);if(!(3>w.length))for(f.push(w),l=0,e(r.holes)&&(l=r.holes.length),g=0;g<l;g++)h.enqueue(r.holes[g])}f.push(m)}}return f};C.polygonsFromHierarchy=function(c,b,d,f){var h=[],g=[],l=new v;for(l.enqueue(c);0!==l.length;){var p=l.dequeue();c=p.positions;var p=p.holes,m,q;if(d)for(q=c.length,m=0;m<q;m++)f.scaleToGeodeticSurface(c[m],c[m]);c=a(c,k.equalsEpsilon,!0);if(!(3>c.length)){var r=b(c);if(e(r)){var w=[],u=z.computeWindingOrder2D(r);u===B.CLOCKWISE&&(r.reverse(),c=c.slice().reverse());var C=c.slice(),t=e(p)?p.length:0,y=[];for(m=0;m<t;m++){var E=p[m],D=E.positions;if(d)for(q=D.length,u=0;u<q;++u)f.scaleToGeodeticSurface(D[u],D[u]);D=a(D,k.equalsEpsilon,!0);if(!(3>D.length)&&(q=b(D),e(q)))for(u=z.computeWindingOrder2D(q),u===B.CLOCKWISE&&(q.reverse(),D=D.slice().reverse()),y.push(D),w.push(C.length),C=C.concat(D),r=r.concat(q),D=0,e(E.holes)&&(D=E.holes.length),u=0;u<D;u++)l.enqueue(E.holes[u])}h.push({outerRing:c,holes:y});g.push({positions:C,positions2D:r,holes:w})}}}return{hierarchy:h,polygons:g}};var N=new f,O=new k,Z=new D,aa=new A;C.computeBoundingRectangle=function(a,c,b,d,f){a=D.fromAxisAngle(a,d,Z);a=A.fromQuaternion(a,aa);d=Number.POSITIVE_INFINITY;for(var h=Number.NEGATIVE_INFINITY,g=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,p=b.length,m=0;m<p;++m){var v=k.clone(b[m],O);A.multiplyByVector(a,v,v);v=c(v,N);e(v)&&(d=Math.min(d,v.x),h=Math.max(h,v.x),g=Math.min(g,v.y),l=Math.max(l,v.y))}f.x=d;f.y=g;f.width=h-d;f.height=l-g;return f};C.createGeometryFromPositions=function(a,d,e,f,h,g){var k=z.triangulate(d.positions2D,d.holes);3>k.length&&(k=[0,1,2]);d=d.positions;if(f){a=d.length;e=Array(3*a);for(g=f=0;g<a;g++){var p=d[g];e[f++]=p.x;e[f++]=p.y;e[f++]=p.z}k=new q({attributes:{position:new t({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:e})},indices:k,primitiveType:x.TRIANGLES});return h.normal?c.computeNormal(k):k}if(g===b.GEODESIC)return z.computeSubdivision(a,d,k,e);if(g===b.RHUMB)return z.computeRhumbLineSubdivision(a,d,k,e)};var U=[],W=new k,M=new k;C.computeWallGeometry=function(a,c,d,e,f){var h,g,p,m=a.length,v=0;if(e)for(h=6*m,e=Array(2*h),d=0;d<m;d++)g=a[d],p=a[(d+1)%m],e[v]=e[v+h]=g.x,++v,e[v]=e[v+h]=g.y,++v,e[v]=e[v+h]=g.z,++v,e[v]=e[v+h]=p.x,++v,e[v]=e[v+h]=p.y,++v,e[v]=e[v+h]=p.z,++v;else{var w=y.chordLength(d,c.maximumRadius);e=0;if(f===b.GEODESIC)for(d=0;d<m;d++)e+=C.subdivideLineCount(a[d],a[(d+1)%m],w);else if(f===b.RHUMB)for(d=0;d<m;d++)e+=C.subdivideRhumbLineCount(c,a[d],a[(d+1)%m],w);h=3*(e+m);e=Array(2*h);for(d=0;d<m;d++){g=a[d];p=a[(d+1)%m];var B;f===b.GEODESIC?B=C.subdivideLine(g,p,w,U):f===b.RHUMB&&(B=C.subdivideRhumbLine(c,g,p,w,U));g=B.length;for(var z=0;z<g;++z,++v)e[v]=B[z],e[v+h]=B[z];e[v]=p.x;e[v+h]=p.x;++v;e[v]=p.y;e[v+h]=p.y;++v;e[v]=p.z;e[v+h]=p.z;++v}}m=e.length;a=u.createTypedArray(m/3,m-6*a.length);c=0;m/=6;for(d=0;d<m;d++)f=d,v=f+1,B=f+m,w=B+1,g=k.fromArray(e,3*f,W),p=k.fromArray(e,3*v,M),k.equalsEpsilon(g,p,y.EPSILON14,y.EPSILON6)||(a[c++]=f,a[c++]=B,a[c++]=v,a[c++]=v,a[c++]=B,a[c++]=w);return new q({attributes:new r({position:new t({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:e})}),indices:a,primitiveType:x.TRIANGLES})};return C});F("Core/CoplanarPolygonGeometry","./arrayRemoveDuplicates ./BoundingRectangle ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Check ./ComponentDatatype ./CoplanarPolygonGeometryLibrary ./defaultValue ./defined ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryInstance ./GeometryPipeline ./IndexDatatype ./Math ./Matrix3 ./PolygonGeometryLibrary ./PolygonPipeline ./PrimitiveType ./Quaternion ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C){function I(a){a=h(a,h.EMPTY_OBJECT);var c=a.polygonHierarchy;l.defined("options.polygonHierarchy",c);var b=h(a.vertexFormat,C.DEFAULT);this._vertexFormat=C.clone(b);this._polygonHierarchy=c;this._stRotation=h(a.stRotation,0);this._ellipsoid=d.clone(h(a.ellipsoid,d.WGS84));this._workerName="createCoplanarPolygonGeometry";this.packedLength=x.computeHierarchyPackedLength(c)+C.packedLength+d.packedLength+2}var H=new g,J=new a,w=new k,G=new k,E=new g,L=new g,K=new g,P=new g,N=new g,O=new g,Z=new B,aa=new z,U=new z,W=new g;I.fromPositions=function(a){a=h(a,h.EMPTY_OBJECT);l.defined("options.positions",a.positions);return new I({polygonHierarchy:{positions:a.positions},vertexFormat:a.vertexFormat,stRotation:a.stRotation,ellipsoid:a.ellipsoid})};I.pack=function(a,c,b){l.typeOf.object("value",a);l.defined("array",c);b=h(b,0);b=x.packPolygonHierarchy(a._polygonHierarchy,c,b);d.pack(a._ellipsoid,c,b);b+=d.packedLength;C.pack(a._vertexFormat,c,b);b+=C.packedLength;c[b++]=a._stRotation;c[b]=a.packedLength;return c};var M=d.clone(d.UNIT_SPHERE),R=new C,Y={polygonHierarchy:{}};I.unpack=function(a,c,b){l.defined("array",a);c=h(c,0);var e=x.unpackPolygonHierarchy(a,c);c=e.startingIndex;delete e.startingIndex;var f=d.unpack(a,c,M);c+=d.packedLength;var g=C.unpack(a,c,R);c+=C.packedLength;var k=a[c++];a=a[c];p(b)||(b=new I(Y));b._polygonHierarchy=e;b._ellipsoid=d.clone(f,b._ellipsoid);b._vertexFormat=C.clone(g,b._vertexFormat);b._stRotation=k;b.packedLength=a;return b};I.createGeometry=function(a){var d=a._vertexFormat,h=a._polygonHierarchy,l=a._stRotation,p=h.positions,p=b(p,g.equalsEpsilon,!0);if(!(3>p.length)){var C=E,I=L,M=K,Q=N;if(e.computeProjectTo2DArguments(p,P,Q,O)&&(C=g.cross(Q,O,C),C=g.normalize(C,C),g.equalsEpsilon(P,g.ZERO,A.EPSILON6)||(a=a._ellipsoid.geodeticSurfaceNormal(P,W),0>g.dot(C,a)&&(C=g.negate(C,C),Q=g.negate(Q,Q))),p=e.createProjectPointsTo2DFunction(P,Q,O),a=e.createProjectPointTo2DFunction(P,Q,O),d.tangent&&(I=g.clone(Q,I)),d.bitangent&&(M=g.clone(O,M)),Q=x.polygonsFromHierarchy(h,p,!1),h=Q.hierarchy,Q=Q.polygons,0!==h.length)){for(var p=h[0].outerRing,h=f.fromPoints(p),p=x.computeBoundingRectangle(C,a,p,l,J),R=[],Y=0;Y<Q.length;Y++){var F,ia=Q[Y];F=d;var la=p,ha=l,pa=a,oa=C,qa=I,ua=M,ta=ia.positions,wa=D.triangulate(ia.positions2D,ia.holes);3>wa.length&&(wa=[0,1,2]);ia=y.createTypedArray(ta.length,wa.length);ia.set(wa);wa=aa;if(0!==ha){var za=B.fromAxisAngle(oa,ha,Z),wa=z.fromQuaternion(za,wa);if(F.tangent||F.bitangent)za=B.fromAxisAngle(oa,-ha,Z),ha=z.fromQuaternion(za,U),qa=g.normalize(z.multiplyByVector(ha,qa,qa),qa),F.bitangent&&(ua=g.normalize(g.cross(oa,qa,ua),ua))}else wa=z.clone(z.IDENTITY,wa);var Da=G;F.st&&(Da.x=la.x,Da.y=la.y);for(var Ba=ta.length,ra=3*Ba,ha=new Float64Array(ra),za=F.normal?new Float32Array(ra):void 0,Ea=F.tangent?new Float32Array(ra):void 0,ra=F.bitangent?new Float32Array(ra):void 0,Ga=F.st?new Float32Array(2*Ba):void 0,Ca=0,ya=0,Aa=0,Ua=0,sa=0,Va=0;Va<Ba;Va++){var xa=ta[Va];ha[Ca++]=xa.x;ha[Ca++]=xa.y;ha[Ca++]=xa.z;if(F.st){var xa=z.multiplyByVector(wa,xa,H),Ha=pa(xa,w);k.subtract(Ha,Da,Ha);xa=A.clamp(Ha.x/la.width,0,1);Ha=A.clamp(Ha.y/la.height,0,1);Ga[sa++]=xa;Ga[sa++]=Ha}F.normal&&(za[ya++]=oa.x,za[ya++]=oa.y,za[ya++]=oa.z);F.tangent&&(Ea[Ua++]=qa.x,Ea[Ua++]=qa.y,Ea[Ua++]=qa.z);F.bitangent&&(ra[Aa++]=ua.x,ra[Aa++]=ua.y,ra[Aa++]=ua.z)}la=new r;F.position&&(la.position=new t({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:ha}));F.normal&&(la.normal=new t({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:za}));F.tangent&&(la.tangent=new t({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:Ea}));F.bitangent&&(la.bitangent=new t({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:ra}));F.st&&(la.st=new t({componentDatatype:m.FLOAT,componentsPerAttribute:2,values:Ga}));F=new q({attributes:la,indices:ia,primitiveType:v.TRIANGLES});F=new c({geometry:F});R.push(F)}l=u.combineInstances(R)[0];l.attributes.position.values=new Float64Array(l.attributes.position.values);l.indices=y.createTypedArray(l.attributes.position.values.length/3,l.indices);C=l.attributes;d.position||delete C.position;return new q({attributes:C,indices:l.indices,primitiveType:l.primitiveType,boundingSphere:h})}}};return I});F("Core/CoplanarPolygonOutlineGeometry","./arrayRemoveDuplicates ./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./CoplanarPolygonGeometryLibrary ./defaultValue ./defined ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryInstance ./GeometryPipeline ./IndexDatatype ./PolygonGeometryLibrary ./PolygonPipeline ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=m(a,m.EMPTY_OBJECT);a=a.polygonHierarchy;k.defined("options.polygonHierarchy",a);this._polygonHierarchy=a;this._workerName="createCoplanarPolygonOutlineGeometry";this.packedLength=c.computeHierarchyPackedLength(a)+1}A.fromPositions=function(a){a=m(a,m.EMPTY_OBJECT);k.defined("options.positions",a.positions);return new A({polygonHierarchy:{positions:a.positions}})};A.pack=function(a,b,d){k.typeOf.object("value",a);k.defined("array",b);d=m(d,0);d=c.packPolygonHierarchy(a._polygonHierarchy,b,d);b[d]=a.packedLength;return b};var z={polygonHierarchy:{}};A.unpack=function(a,b,d){k.defined("array",a);b=m(b,0);var f=c.unpackPolygonHierarchy(a,b);b=f.startingIndex;delete f.startingIndex;a=a[b];e(d)||(d=new A(z));d._polygonHierarchy=f;d.packedLength=a;return d};A.createGeometry=function(e){e=e._polygonHierarchy;var k=e.positions,k=b(k,f.equalsEpsilon,!0);if(!(3>k.length)&&l.validOutline(k)&&(k=c.polygonOutlinesFromHierarchy(e,!1),0!==k.length)){for(var m=[],u=0;u<k.length;u++){var C,z=k[u],A=z.length,x=new Float64Array(3*A);C=r.createTypedArray(A,2*A);for(var w=0,G=0,E=0;E<A;E++){var L=z[E];x[w++]=L.x;x[w++]=L.y;x[w++]=L.z;C[G++]=E;C[G++]=(E+1)%A}z=new d({position:new p({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:x})});C=new h({attributes:z,indices:C,primitiveType:y.LINES});C=new q({geometry:C});m.push(C)}k=t.combineInstances(m)[0];e=a.fromPoints(e.positions);return new h({attributes:k.attributes,indices:k.indices,primitiveType:k.primitiveType,boundingSphere:e})}};return A});F("Core/CornerType",["./freezeObject"],function(b){return b({ROUNDED:0,MITERED:1,BEVELED:2})});F("Core/EllipsoidGeodesic","./Cartesian3 ./Cartographic ./Check ./defaultValue ./defined ./defineProperties ./Ellipsoid ./Math".split(" "),function(b,a,f,k,g,l,m,e){function h(h,g,c,k){var l=b.normalize(k.cartographicToCartesian(g,q),d),p=b.normalize(k.cartographicToCartesian(c,q),q);f.typeOf.number.greaterThanOrEquals("value",Math.abs(Math.abs(b.angleBetween(l,p))-Math.PI),.0125);var m=k.maximumRadius;k=k.minimumRadius;var r=(m-k)/m,u=c.longitude-g.longitude,p=Math.atan((1-r)*Math.tan(g.latitude)),v=Math.atan((1-r)*Math.tan(c.latitude)),l=Math.cos(p),B=Math.sin(p),p=Math.cos(v),C=Math.sin(v),t=l*p,v=l*C,H=B*C,B=B*p,J=u,w,G,E,L,K,P,N;do{C=Math.cos(J);G=Math.sin(J);E=v-B*C;K=Math.sqrt(p*p*G*G+E*E);L=H+t*C;E=Math.atan2(K,L);var O;0===K?(O=0,P=1):(O=t*G/K,P=1-O*O);w=J;N=L-2*H/P;isNaN(N)&&(N=0);var J=r,Z=N,aa=J*P*(4+J*(4-3*P))/16,J=u+(1-aa)*J*O*(E+aa*K*(Z+aa*L*(2*Z*Z-1)))}while(Math.abs(J-w)>e.EPSILON12);m=P*(m*m-k*k)/(k*k);r=m*(256+m*(m*(74-47*m)-128))/1024;u=N*N;p=Math.atan2(p*G,v-B*C);l=Math.atan2(l*G,v*C-B);h._distance=k*(1+m*(4096+m*(m*(320-175*m)-768))/16384)*(E-r*K*(N+r*(L*(2*u-1)-r*N*(4*K*K-3)*(4*u-3)/6)/4));h._startHeading=p;h._endHeading=l;h._uSquared=m;h._start=a.clone(g,h._start);h._end=a.clone(c,h._end);h._start.height=0;h._end.height=0;g=h._ellipsoid.maximumRadius;c=h._ellipsoid.minimumRadius;k=(g-c)/g;l=Math.cos(h._startHeading);p=Math.sin(h._startHeading);v=(1-k)*Math.tan(h._start.latitude);m=1/Math.sqrt(1+v*v);r=Math.atan2(v,l);u=m*p;B=u*u;C=1-B;G=Math.sqrt(C);E=h._uSquared/4;L=E*E;K=L*E;N=L*L;t=1+E-3*L/4+5*K/4-175*N/64;H=1-E+15*L/8-35*K/8;w=1-3*E+35*L/4;P=1-5*E;O=t*r-H*Math.sin(2*r)*E/2-w*Math.sin(4*r)*L/16-P*Math.sin(6*r)*K/48-5*Math.sin(8*r)*N/512;h=h._constants;h.a=g;h.b=c;h.f=k;h.cosineHeading=l;h.sineHeading=p;h.tanU=v;h.cosineU=m;h.sineU=m*v;h.sigma=r;h.sineAlpha=u;h.sineSquaredAlpha=B;h.cosineSquaredAlpha=C;h.cosineAlpha=G;h.u2Over4=E;h.u4Over16=L;h.u6Over64=K;h.u8Over256=N;h.a0=t;h.a1=H;h.a2=w;h.a3=P;h.distanceRatio=O}function p(b,d,c){this._ellipsoid=c=k(c,m.WGS84);this._start=new a;this._end=new a;this._constants={};this._uSquared=this._distance=this._endHeading=this._startHeading=void 0;g(b)&&g(d)&&h(this,b,d,c)}var d=new b,q=new b;l(p.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},surfaceDistance:{get:function(){f.defined("distance",this._distance);return this._distance}},start:{get:function(){return this._start}},end:{get:function(){return this._end}},startHeading:{get:function(){f.defined("distance",this._distance);return this._startHeading}},endHeading:{get:function(){f.defined("distance",this._distance);return this._endHeading}}});p.prototype.setEndPoints=function(a,b){f.defined("start",a);f.defined("end",b);h(this,a,b,this._ellipsoid)};p.prototype.interpolateUsingFraction=function(a,b){return this.interpolateUsingSurfaceDistance(this._distance*a,b)};p.prototype.interpolateUsingSurfaceDistance=function(b,d){f.defined("distance",this._distance);var c=this._constants,e=c.distanceRatio+b/c.b,h=Math.cos(2*e),k=Math.sin(2*e),l=Math.sin(4*e),p=e*e,m=c.u8Over256,v=c.u2Over4,q=c.u6Over64,r=c.u4Over16,h=2*e*p*m*h/3+e*(1-v+7*r/4-15*q/4+579*m/64-(r-15*q/4+187*m/16)*h-(5*q/4-115*m/16)*Math.cos(4*e)-29*m*Math.cos(6*e)/16)+(v/2-r+71*q/32-85*m/16)*k+(5*r/16-5*q/4+383*m/96)*l-p*((q-11*m/2)*k+5*m*l/2)+(29*q/96-29*m/16)*Math.sin(6*e)+539*m*Math.sin(8*e)/1536,e=Math.atan(c.a/c.b*Math.tan(Math.asin(Math.sin(h)*c.cosineAlpha))),h=h-c.sigma,k=Math.sin(h),l=Math.cos(h),p=Math.atan2(k*c.sineHeading,c.cosineU*l-c.sineU*k*c.cosineHeading),m=c.f,v=c.sineAlpha,q=Math.cos(2*c.sigma+h),c=c.cosineSquaredAlpha,c=m*c*(4+m*(4-3*c))/16,c=p-(1-c)*m*v*(h+c*k*(q+c*l*(2*q*q-1)));return g(d)?(d.longitude=this._start.longitude+c,d.latitude=e,d.height=0,d):new a(this._start.longitude+c,e,0)};return p});F("Core/PolylinePipeline","./Cartesian3 ./Cartographic ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./EllipsoidGeodesic ./EllipsoidRhumbLine ./IntersectionTests ./isArray ./Math ./Matrix4 ./Plane".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,c,b){var d=I;d.length=a;if(c===b){for(b=0;b<a;b++)d[b]=c;return d}var e=(b-c)/a;for(b=0;b<a;b++)d[b]=c+b*e;return d}var c={numberOfPoints:function(a,c,d){a=b.distance(a,c);return Math.ceil(a/d)},numberOfPointsRhumbLine:function(a,c,b){return Math.ceil(Math.sqrt((Math.pow(a.longitude-c.longitude,2)+Math.pow(a.latitude-c.latitude,2))/(b*b)))}},u=new a;c.extractHeights=function(a,c){for(var b=a.length,d=Array(b),e=0;e<b;e++)d[e]=c.cartesianToCartographic(a[e],u).height;return d};var y=new q,A=new b,z=new b,x=new t(b.UNIT_X,0),D=new b,v=new t(b.UNIT_X,0),B=new b,C=new b,I=[],H=new a,J=new a,w=new b,G=new b,E=new b,L=new m,K=new e;c.wrapLongitude=function(a,c){var d=[],e=[];if(k(a)&&0<a.length){c=f(c,q.IDENTITY);var g=q.inverseTransformation(c,y),l=q.multiplyByPoint(g,b.ZERO,A),p=b.normalize(q.multiplyByPointAsVector(g,b.UNIT_Y,z),z),m=t.fromPointNormal(l,p,x),g=b.normalize(q.multiplyByPointAsVector(g,b.UNIT_X,D),D),l=t.fromPointNormal(l,g,v),g=1;d.push(b.clone(a[0]));for(var w=d[0],r=a.length,u=1;u<r;++u){var E=a[u];if(0>t.getPointDistance(l,w)||0>t.getPointDistance(l,E)){var G=h.lineSegmentPlane(w,E,m,B);if(k(G)){var L=b.multiplyByScalar(p,5E-9,C);0>t.getPointDistance(m,w)&&b.negate(L,L);d.push(b.add(G,L,new b));e.push(g+1);b.negate(L,L);d.push(b.add(G,L,new b));g=1}}d.push(b.clone(a[u]));g++;w=E}e.push(g)}return{positions:d,lengths:e}};c.generateArc=function(a){k(a)||(a={});var e=a.positions;if(!k(e))throw new g("options.positions is required.");var h=e.length,m=f(a.ellipsoid,l.WGS84),v=f(a.height,0),q=p(v);if(1>h)return[];if(1===h)return h=m.scaleToGeodeticSurface(e[0],G),v=q?v[0]:v,0!==v&&(m=m.geodeticSurfaceNormal(h,w),b.multiplyByScalar(m,v,m),b.add(h,m,h)),[h.x,h.y,h.z];var u=a.minDistance;k(u)||(u=f(a.granularity,d.RADIANS_PER_DEGREE),u=d.chordLength(u,m.maximumRadius));a=0;var B;for(B=0;B<h-1;B++)a+=c.numberOfPoints(e[B],e[B+1],u);a=3*(a+1);var C=Array(a),t=0;for(B=0;B<h-1;B++){var z=e[B],y=e[B+1],D=u,A=m,x=q?v[B]:v,K=q?v[B+1]:v,O=C,P=A.scaleToGeodeticSurface(z,G),N=A.scaleToGeodeticSurface(y,E),z=c.numberOfPoints(z,y,D),y=A.cartesianToCartographic(P,H),N=A.cartesianToCartographic(N,J),K=r(z,x,K);L.setEndPoints(y,N);N=L.surfaceDistance/z;y.height=x;y=A.cartographicToCartesian(y,w);b.pack(y,O,t);t+=3;for(x=1;x<z;x++)y=L.interpolateUsingSurfaceDistance(x*N,J),y.height=K[x],y=A.cartographicToCartesian(y,w),b.pack(y,O,t),t+=3}I.length=0;e=m.cartesianToCartographic(e[h-1],H);e.height=q?v[h-1]:v;v=m.cartographicToCartesian(e,w);b.pack(v,C,a-3);return C};var P=new a,N=new a;c.generateRhumbArc=function(h){k(h)||(h={});var m=h.positions;if(!k(m))throw new g("options.positions is required.");var v=m.length,q=f(h.ellipsoid,l.WGS84),u=f(h.height,0),B=p(u);if(1>v)return[];if(1===v)return v=q.scaleToGeodeticSurface(m[0],G),u=B?u[0]:u,0!==u&&(q=q.geodeticSurfaceNormal(v,w),b.multiplyByScalar(q,u,q),b.add(v,q,v)),[v.x,v.y,v.z];h=f(h.granularity,d.RADIANS_PER_DEGREE);var C=0,t,z=q.cartesianToCartographic(m[0],P),y;for(t=0;t<v-1;t++)y=q.cartesianToCartographic(m[t+1],N),C+=c.numberOfPointsRhumbLine(z,y,h),z=a.clone(y,P);var C=3*(C+1),z=Array(C),D=0;for(t=0;t<v-1;t++){var A=m[t+1],x=h;y=q;var L=B?u[t]:u,O=B?u[t+1]:u,X=z,fa=y.scaleToGeodeticSurface(m[t],G),ga=y.scaleToGeodeticSurface(A,E),A=y.cartesianToCartographic(fa,H),fa=y.cartesianToCartographic(ga,J),x=c.numberOfPointsRhumbLine(A,fa,x),O=r(x,L,O);K.ellipsoid.equals(y)||(K=new e(void 0,void 0,y));K.setEndPoints(A,fa);fa=K.surfaceDistance/x;A.height=L;A=y.cartographicToCartesian(A,w);b.pack(A,X,D);D+=3;for(L=1;L<x;L++)A=K.interpolateUsingSurfaceDistance(L*fa,J),A.height=O[L],A=y.cartographicToCartesian(A,w),b.pack(A,X,D),D+=3}I.length=0;m=q.cartesianToCartographic(m[v-1],H);m.height=B?u[v-1]:u;u=q.cartographicToCartesian(m,w);b.pack(u,z,C-3);return z};c.generateCartesianArc=function(a){a=c.generateArc(a);for(var d=a.length/3,e=Array(d),f=0;f<d;f++)e[f]=b.unpack(a,3*f);return e};c.generateCartesianRhumbArc=function(a){a=c.generateRhumbArc(a);for(var d=a.length/3,e=Array(d),f=0;f<d;f++)e[f]=b.unpack(a,3*f);return e};return c});F("Core/PolylineVolumeGeometryLibrary","./Cartesian2 ./Cartesian3 ./Cartesian4 ./Cartographic ./CornerType ./EllipsoidTangentPlane ./Math ./Matrix3 ./Matrix4 ./PolylinePipeline ./Quaternion ./Transforms".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(c,b,d,e){c=a.angleBetween(c[0],c[1]);e=Math.ceil(c/e);c=Array(e);var f;if(b===d){for(f=0;f<e;f++)c[f]=b;c.push(d);return c}var h=(d-b)/e;for(f=1;f<e;f++)c[f]=b+f*h;c[0]=b;c.push(d);return c}function r(c,d,f,g,k,p,m,v){var w=W,r=M;O=q.eastNorthUpToFixedFrame(c,k,O);var w=h.multiplyByPointAsVector(O,N,w),w=a.normalize(w,w),u=new l(c,k);k=u.projectPointOntoPlane(a.add(c,w,K),K);c=u.projectPointOntoPlane(a.add(c,d,P),P);d=b.angleBetween(k,c);aa=e.fromRotationZ(0<=c.x*k.y-c.y*k.x?-d:d,aa);R.z=p;O=h.multiplyTransformation(O,h.fromRotationTranslation(aa,R,Z),O);p=U;p[0]=m;for(m=0;m<v;m++)for(c=0;c<f.length;c+=3)r=a.fromArray(f,c,r),r=e.multiplyByVector(p,r,r),r=h.multiplyByPoint(O,r,r),g.push(r.x,r.y,r.z);return g}function c(c,b,d,e,f,h,g){for(var k=0;k<c.length;k+=3){var l=a.fromArray(c,k,Y);e=r(l,b,d,e,f,h[k/3],g,1)}return e}function u(a,c){for(var b=a.length,d=Array(3*b),e=0,f=c.x+c.width/2,h=c.y+c.height/2,g=0;g<b;g++)d[e++]=a[g].x-f,d[e++]=0,d[e++]=a[g].y-h;return d}function y(c,b,f,h,k,l,p,v,q,u){var B=a.angleBetween(a.subtract(b,c,w),a.subtract(f,c,G));h=h===g.BEVELED?0:Math.ceil(B/m.toRadians(5));var B=k?e.fromQuaternion(d.fromAxisAngle(a.negate(c,w),B/(h+1),Q),ca):e.fromQuaternion(d.fromAxisAngle(c,B/(h+1),Q),ca),C;b=a.clone(b,S);if(0<h){f=u?2:1;for(var t=0;t<h;t++)b=e.multiplyByVector(B,b,b),u=a.subtract(b,c,w),u=a.normalize(u,u),k||(u=a.negate(u,u)),C=l.scaleToGeodeticSurface(b,G),p=r(C,u,v,p,l,q,1,f)}else u=a.subtract(b,c,w),u=a.normalize(u,u),k||(u=a.negate(u,u)),C=l.scaleToGeodeticSurface(b,G),p=r(C,u,v,p,l,q,1,1),f=a.clone(f,S),u=a.subtract(f,c,w),u=a.normalize(u,u),k||(u=a.negate(u,u)),C=l.scaleToGeodeticSurface(f,G),p=r(C,u,v,p,l,q,1,1);return p}var A=[new a,new a],z=new a,x=new a,D=new a,v=new a,B=new a,C=new a,I=new a,H=new a,J=new a,w=new a,G=new a,E={},L=new k,K=new a,P=new a,N=new a(-1,0,0),O=new h,Z=new h,aa=new e,U=e.IDENTITY.clone(),W=new a,M=new f,R=new a,Y=new a,Q=new d,S=new a,ca=new e;E.removeDuplicatesFromShape=function(a){for(var c=a.length,d=[],e=c-1,f=0;f<c;e=f++){var h=a[f];b.equals(a[e],h)||d.push(h)}return d};E.angleIsGreaterThanPi=function(c,b,d,e){e=new l(d,e);c=e.projectPointOntoPlane(a.add(d,c,K),K);b=e.projectPointOntoPlane(a.add(d,b,P),P);return 0<=b.x*c.y-b.y*c.x};var T=new a,da=new a;E.computePositions=function(b,d,e,f,h){for(var k=f._ellipsoid,l=Array(b.length),q=0;q<b.length;q++){var G=b[q];L=k.cartesianToCartographic(G,L);l[q]=L.height;b[q]=k.scaleToGeodeticSurface(G,G)}q=f._granularity;f=f._cornerType;if(h){var G=d.length,K=Array(6*G),O=0,P=e.x+e.width/2,N=e.y+e.height/2,M=d[0];K[O++]=M.x-P;K[O++]=0;K[O++]=M.y-N;for(var Q=1;Q<G;Q++){var M=d[Q],S=M.x-P,M=M.y-N;K[O++]=S;K[O++]=0;K[O++]=M;K[O++]=S;K[O++]=0;K[O++]=M}M=d[0];K[O++]=M.x-P;K[O++]=0;K[O++]=M.y-N;G=K}else G=u(d,e);d=h?u(d,e):void 0;K=e.height/2;N=e.width/2;e=b.length;var O=[],P=h?[]:void 0,Q=z,S=x,M=D,R=v,ca=B,Y=C,aa=I,W=H,Z=J,U=b[0],V=b[1],R=k.geodeticSurfaceNormal(U,R),Q=a.subtract(V,U,Q),Q=a.normalize(Q,Q),W=a.cross(R,Q,W),W=a.normalize(W,W),ba=l[0],fa=l[1];h&&(P=r(U,W,d,P,k,ba+K,1,1));for(var Z=a.clone(U,Z),U=V,S=a.negate(Q,S),X,ga=1;ga<e-1;ga++){var F=h?2:1,V=b[ga+1],Q=a.subtract(V,U,Q),Q=a.normalize(Q,Q),M=a.add(Q,S,M),M=a.normalize(M,M),R=k.geodeticSurfaceNormal(U,R),Ha=a.multiplyByScalar(R,a.dot(Q,R),T);a.subtract(Q,Ha,Ha);a.normalize(Ha,Ha);var Ma=a.multiplyByScalar(R,a.dot(S,R),da);a.subtract(S,Ma,Ma);a.normalize(Ma,Ma);m.equalsEpsilon(Math.abs(a.dot(Ha,Ma)),1,m.EPSILON7)?(O=r(Z,W,G,O,k,ba+K,1,1),Z=U):(M=a.cross(M,R,M),M=a.cross(R,M,M),M=a.normalize(M,M),Ha=1/Math.max(.25,a.magnitude(a.cross(M,S,w))),(Ma=E.angleIsGreaterThanPi(Q,S,U,k))?(ca=a.add(U,a.multiplyByScalar(M,Ha*N,M),ca),Y=a.add(ca,a.multiplyByScalar(W,N,Y),Y),A[0]=a.clone(Z,A[0]),A[1]=a.clone(Y,A[1]),ba=t(A,ba+K,fa+K,q),X=p.generateArc({positions:A,granularity:q,ellipsoid:k}),O=c(X,W,G,O,k,ba,1),W=a.cross(R,Q,W),W=a.normalize(W,W),aa=a.add(ca,a.multiplyByScalar(W,N,aa),aa),f===g.ROUNDED||f===g.BEVELED?y(ca,Y,aa,f,Ma,k,O,G,fa+K,h):(M=a.negate(M,M),O=r(U,M,G,O,k,fa+K,Ha,F))):(ca=a.add(U,a.multiplyByScalar(M,Ha*N,M),ca),Y=a.add(ca,a.multiplyByScalar(W,-N,Y),Y),A[0]=a.clone(Z,A[0]),A[1]=a.clone(Y,A[1]),ba=t(A,ba+K,fa+K,q),X=p.generateArc({positions:A,granularity:q,ellipsoid:k}),O=c(X,W,G,O,k,ba,1),W=a.cross(R,Q,W),W=a.normalize(W,W),aa=a.add(ca,a.multiplyByScalar(W,-N,aa),aa),f===g.ROUNDED||f===g.BEVELED?y(ca,Y,aa,f,Ma,k,O,G,fa+K,h):O=r(U,M,G,O,k,fa+K,Ha,F)),Z=a.clone(aa,Z),S=a.negate(Q,S));ba=fa;fa=l[ga+1];U=V}A[0]=a.clone(Z,A[0]);A[1]=a.clone(U,A[1]);ba=t(A,ba+K,fa+K,q);X=p.generateArc({positions:A,granularity:q,ellipsoid:k});O=c(X,W,G,O,k,ba,1);h&&(P=r(U,W,d,P,k,fa+K,1,1));e=O.length;b=new Float64Array(h?e+P.length:e);b.set(O);h&&b.set(P,e);return b};return E});F("Core/CorridorGeometryLibrary","./Cartesian3 ./CornerType ./defined ./Math ./Matrix3 ./PolylinePipeline ./PolylineVolumeGeometryLibrary ./Quaternion".split(" "),function(b,a,f,k,g,l,m,e){function h(c,d,f,h,l){var p=b.angleBetween(b.subtract(d,c,t),b.subtract(f,c,r));h=h===a.BEVELED?1:Math.ceil(p/k.toRadians(5))+1;var m=3*h,v=Array(m);v[m-3]=f.x;v[m-2]=f.y;v[m-1]=f.z;c=l?g.fromQuaternion(e.fromAxisAngle(b.negate(c,t),p/h,w),G):g.fromQuaternion(e.fromAxisAngle(c,p/h,w),G);f=0;d=b.clone(d,t);for(l=0;l<h;l++)d=g.multiplyByVector(c,d,d),v[f++]=d.x,v[f++]=d.y,v[f++]=d.z;return v}function p(a,c,d,e){var f=t;e||(c=b.negate(c,c));f=b.add(a,c,f);return[f.x,f.y,f.z,d.x,d.y,d.z]}function d(a,d,e,f){var h=Array(a.length),g=Array(a.length);d=b.multiplyByScalar(d,e,t);e=b.negate(d,r);for(var k=0,l=a.length-1,p=0;p<a.length;p+=3){var m=b.fromArray(a,p,c),v=b.add(m,e,u);h[k++]=v.x;h[k++]=v.y;h[k++]=v.z;m=b.add(m,d,u);g[l--]=m.z;g[l--]=m.y;g[l--]=m.x}f.push(h,g);return f}var q={},t=new b,r=new b,c=new b,u=new b,y=[new b,new b],A=new b,z=new b,x=new b,D=new b,v=new b,B=new b,C=new b,I=new b,H=new b,J=new b,w=new e,G=new g;q.addAttribute=function(a,c,b,d){var e=c.x,h=c.y;c=c.z;f(b)&&(a[b]=e,a[b+1]=h,a[b+2]=c);f(d)&&(a[d]=c,a[d-1]=h,a[d-2]=e)};var E=new b,L=new b;q.computePositions=function(c){var e=c.granularity,f=c.positions,g=c.ellipsoid,q=c.width/2,r=c.cornerType,w=c.saveAttributes,u=A,G=z,K=x,Y=D,Q=v,S=B,ca=C,T=I,da=H,V=J;c=[];var ba=w?[]:void 0,X=w?[]:void 0,fa=f[0],ga=f[1],G=b.normalize(b.subtract(ga,fa,G),G),u=g.geodeticSurfaceNormal(fa,u),Y=b.normalize(b.cross(u,G,Y),Y);w&&(ba.push(Y.x,Y.y,Y.z),X.push(u.x,u.y,u.z));var ca=b.clone(fa,ca),fa=ga,K=b.negate(G,K),F,na=[],ia,la=f.length;for(ia=1;ia<la-1;ia++){var u=g.geodeticSurfaceNormal(fa,u),ga=f[ia+1],G=b.normalize(b.subtract(ga,fa,G),G),Q=b.normalize(b.add(G,K,Q),Q),ha=b.multiplyByScalar(u,b.dot(G,u),E);b.subtract(G,ha,ha);b.normalize(ha,ha);F=b.multiplyByScalar(u,b.dot(K,u),L);b.subtract(K,F,F);b.normalize(F,F);k.equalsEpsilon(Math.abs(b.dot(ha,F)),1,k.EPSILON7)||(Q=b.cross(Q,u,Q),Q=b.cross(u,Q,Q),Q=b.normalize(Q,Q),F=q/Math.max(.25,b.magnitude(b.cross(Q,K,t))),ha=m.angleIsGreaterThanPi(G,K,fa,g),Q=b.multiplyByScalar(Q,F,Q),ha?(T=b.add(fa,Q,T),V=b.add(T,b.multiplyByScalar(Y,q,V),V),da=b.add(T,b.multiplyByScalar(Y,2*q,da),da),y[0]=b.clone(ca,y[0]),y[1]=b.clone(V,y[1]),F=l.generateArc({positions:y,granularity:e,ellipsoid:g}),c=d(F,Y,q,c),w&&(ba.push(Y.x,Y.y,Y.z),X.push(u.x,u.y,u.z)),S=b.clone(da,S),Y=b.normalize(b.cross(u,G,Y),Y),da=b.add(T,b.multiplyByScalar(Y,2*q,da),da),ca=b.add(T,b.multiplyByScalar(Y,q,ca),ca),r===a.ROUNDED||r===a.BEVELED?na.push({leftPositions:h(T,S,da,r,ha)}):na.push({leftPositions:p(fa,b.negate(Q,Q),da,ha)})):(da=b.add(fa,Q,da),V=b.add(da,b.negate(b.multiplyByScalar(Y,q,V),V),V),T=b.add(da,b.negate(b.multiplyByScalar(Y,2*q,T),T),T),y[0]=b.clone(ca,y[0]),y[1]=b.clone(V,y[1]),F=l.generateArc({positions:y,granularity:e,ellipsoid:g}),c=d(F,Y,q,c),w&&(ba.push(Y.x,Y.y,Y.z),X.push(u.x,u.y,u.z)),S=b.clone(T,S),Y=b.normalize(b.cross(u,G,Y),Y),T=b.add(da,b.negate(b.multiplyByScalar(Y,2*q,T),T),T),ca=b.add(da,b.negate(b.multiplyByScalar(Y,q,ca),ca),ca),r===a.ROUNDED||r===a.BEVELED?na.push({rightPositions:h(da,S,T,r,ha)}):na.push({rightPositions:p(fa,Q,T,ha)})),K=b.negate(G,K));fa=ga}u=g.geodeticSurfaceNormal(fa,u);y[0]=b.clone(ca,y[0]);y[1]=b.clone(fa,y[1]);F=l.generateArc({positions:y,granularity:e,ellipsoid:g});c=d(F,Y,q,c);w&&(ba.push(Y.x,Y.y,Y.z),X.push(u.x,u.y,u.z));var pa;r===a.ROUNDED&&(f=c,g=A,q=z,r=x,w=f[1],q=b.fromArray(f[1],w.length-3,q),r=b.fromArray(f[0],0,r),g=b.midpoint(q,r,g),e=h(g,q,r,a.ROUNDED,!1),w=f.length-1,pa=f[w-1],w=f[w],q=b.fromArray(pa,pa.length-3,q),r=b.fromArray(w,0,r),g=b.midpoint(q,r,g),f=h(g,q,r,a.ROUNDED,!1),pa=[e,f]);return{positions:c,corners:na,lefts:ba,normals:X,endPositions:pa}};return q});F("Core/CorridorGeometry","./arrayFill ./arrayRemoveDuplicates ./BoundingSphere ./Cartesian3 ./Cartographic ./Check ./ComponentDatatype ./CornerType ./CorridorGeometryLibrary ./defaultValue ./defined ./defineProperties ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PolygonPipeline ./PrimitiveType ./Rectangle ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a,c){for(var b=0;b<a.length;b++)a[b]=c.scaleToGeodeticSurface(a[b],a[b]);return a}function I(a,c,b,d,e,f){var g=a.normals,l=a.tangents;a=a.bitangents;var p=k.normalize(k.cross(b,c,aa),aa);f.normal&&h.addAttribute(g,c,d,e);f.tangent&&h.addAttribute(l,p,d,e);f.bitangent&&h.addAttribute(a,b,d,e)}function H(a,b,e){var f=a.positions,g=a.corners,l=a.endPositions,p=a.lefts,v=a.normals;a=new u;var q,r=0,w=0,B,C=0,t;for(B=0;B<f.length;B+=2)t=f[B].length-3,r+=t,C+=2*t,w+=f[B+1].length-3;r+=3;w+=3;for(B=0;B<g.length;B++){var y=g[B].leftPositions;d(y)?(t=y.length,r+=t):(t=g[B].rightPositions.length,w+=t);C+=t}var E=d(l),G;E&&(G=l[0].length-3,r+=G,w+=G,G/=3,C+=6*G);var D=r+w,x=new Float64Array(D);B=b.normal?new Float32Array(D):void 0;var y=b.tangent?new Float32Array(D):void 0,H=b.bitangent?new Float32Array(D):void 0,y={normals:B,tangents:y,bitangents:H},H=0,J=D-1,O,T,M,Q,S=L,R=K,ca,da,Y=G/2,C=A.createTypedArray(D/3,C),W=0;if(E)for(da=P,ca=N,q=l[0],S=k.fromArray(v,0,S),R=k.fromArray(p,0,R),B=0;B<Y;B++)da=k.fromArray(q,3*(Y-1-B),da),ca=k.fromArray(q,3*(Y+B),ca),h.addAttribute(x,ca,H),h.addAttribute(x,da,void 0,J),I(y,S,R,H,J,b),T=H/3,Q=T+1,O=(J-2)/3,M=O-1,C[W++]=O,C[W++]=T,C[W++]=M,C[W++]=M,C[W++]=T,C[W++]=Q,H+=3,J-=3;da=ca=0;var V=f[ca++],ba=f[ca++];x.set(V,H);x.set(ba,J-ba.length+1);R=k.fromArray(p,da,R);t=ba.length-3;for(B=0;B<t;B+=3)O=e.geodeticSurfaceNormal(k.fromArray(V,B,aa),aa),T=e.geodeticSurfaceNormal(k.fromArray(ba,t-B,U),U),S=k.normalize(k.add(O,T,S),S),I(y,S,R,H,J,b),T=H/3,Q=T+1,O=(J-2)/3,M=O-1,C[W++]=O,C[W++]=T,C[W++]=M,C[W++]=M,C[W++]=T,C[W++]=Q,H+=3,J-=3;O=e.geodeticSurfaceNormal(k.fromArray(V,t,aa),aa);T=e.geodeticSurfaceNormal(k.fromArray(ba,t,U),U);S=k.normalize(k.add(O,T,S),S);da+=3;for(B=0;B<g.length;B++){q=g[B];O=q.leftPositions;T=q.rightPositions;var ba=Z,fa=P,X=N,S=k.fromArray(v,da,S);if(d(O)){I(y,S,R,void 0,J,b);J-=3;t=Q;V=M;for(q=0;q<O.length/3;q++)ba=k.fromArray(O,3*q,ba),C[W++]=t,C[W++]=V-q-1,C[W++]=V-q,h.addAttribute(x,ba,void 0,J),fa=k.fromArray(x,3*(V-q-1),fa),X=k.fromArray(x,3*t,X),R=k.normalize(k.subtract(fa,X,R),R),I(y,S,R,void 0,J,b),J-=3;ba=k.fromArray(x,3*t,ba);fa=k.subtract(k.fromArray(x,3*V,fa),ba,fa);X=k.subtract(k.fromArray(x,3*(V-q),X),ba,X);R=k.normalize(k.add(fa,X,R),R);I(y,S,R,H,void 0,b);H+=3}else{I(y,S,R,H,void 0,b);H+=3;t=M;V=Q;for(q=0;q<T.length/3;q++)ba=k.fromArray(T,3*q,ba),C[W++]=t,C[W++]=V+q,C[W++]=V+q+1,h.addAttribute(x,ba,H),fa=k.fromArray(x,3*t,fa),X=k.fromArray(x,3*(V+q),X),R=k.normalize(k.subtract(fa,X,R),R),I(y,S,R,H,void 0,b),H+=3;ba=k.fromArray(x,3*t,ba);fa=k.subtract(k.fromArray(x,3*(V+q),fa),ba,fa);X=k.subtract(k.fromArray(x,3*V,X),ba,X);R=k.normalize(k.negate(k.add(X,fa,R),R),R);I(y,S,R,void 0,J,b);J-=3}V=f[ca++];ba=f[ca++];V.splice(0,3);ba.splice(ba.length-3,3);x.set(V,H);x.set(ba,J-ba.length+1);t=ba.length-3;da+=3;R=k.fromArray(p,da,R);for(q=0;q<ba.length;q+=3)O=e.geodeticSurfaceNormal(k.fromArray(V,q,aa),aa),T=e.geodeticSurfaceNormal(k.fromArray(ba,t-q,U),U),S=k.normalize(k.add(O,T,S),S),I(y,S,R,H,J,b),Q=H/3,T=Q-1,M=(J-2)/3,O=M+1,C[W++]=O,C[W++]=T,C[W++]=M,C[W++]=M,C[W++]=T,C[W++]=Q,H+=3,J-=3;H-=3;J+=3}S=k.fromArray(v,v.length-3,S);I(y,S,R,H,J,b);if(E)for(H+=3,J-=3,da=P,ca=N,e=l[1],B=0;B<Y;B++)da=k.fromArray(e,3*(G-B-1),da),ca=k.fromArray(e,3*B,ca),h.addAttribute(x,da,void 0,J),h.addAttribute(x,ca,H),I(y,S,R,H,J,b),Q=H/3,T=Q-1,M=(J-2)/3,O=M+1,C[W++]=O,C[W++]=T,C[W++]=M,C[W++]=M,C[W++]=T,C[W++]=Q,H+=3,J-=3;a.position=new c({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:x});if(b.st){M=new Float32Array(D/3*2);Q=0;if(E){r/=3;w/=3;f=Math.PI/(G+1);e=1/(r-G+1);E=1/(w-G+1);l=G/2;for(B=l+1;B<G+1;B++)g=z.PI_OVER_TWO+f*B,M[Q++]=E*(1+Math.cos(g)),M[Q++]=.5*(1+Math.sin(g));for(B=1;B<w-G+1;B++)M[Q++]=B*E,M[Q++]=0;for(B=G;B>l;B--)g=z.PI_OVER_TWO-B*f,M[Q++]=1-E*(1+Math.cos(g)),M[Q++]=.5*(1+Math.sin(g));for(B=l;0<B;B--)g=z.PI_OVER_TWO-f*B,M[Q++]=1-e*(1+Math.cos(g)),M[Q++]=.5*(1+Math.sin(g));for(B=r-G;0<B;B--)M[Q++]=B*e,M[Q++]=1;for(B=1;B<l+1;B++)g=z.PI_OVER_TWO+f*B,M[Q++]=e*(1+Math.cos(g)),M[Q++]=.5*(1+Math.sin(g))}else{r/=3;w/=3;e=1/(r-1);E=1/(w-1);for(B=0;B<w;B++)M[Q++]=B*E,M[Q++]=0;for(B=r;0<B;B--)M[Q++]=(B-1)*e,M[Q++]=1}a.st=new c({componentDatatype:m.FLOAT,componentsPerAttribute:2,values:M})}b.normal&&(a.normal=new c({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:y.normals}));b.tangent&&(a.tangent=new c({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:y.tangents}));b.bitangent&&(a.bitangent=new c({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:y.bitangents}));return{attributes:a,indices:C}}function J(a,c,b){b[c++]=a[0];b[c++]=a[1];b[c++]=a[2];for(var d=3;d<a.length;d+=3){var e=a[d],f=a[d+1],h=a[d+2];b[c++]=e;b[c++]=f;b[c++]=h;b[c++]=e;b[c++]=f;b[c++]=h}b[c++]=a[0];b[c++]=a[1];b[c++]=a[2];return b}function w(a,c,b,d,e,f){c=k.subtract(c,a,W);k.normalize(c,c);var h=b.geodeticSurfaceNormal(a,M);c=k.cross(c,h,W);k.multiplyByScalar(c,d,c);d=e.latitude;var h=e.longitude,g=f.latitude,l=f.longitude;k.add(a,c,M);b.cartesianToCartographic(M,R);var p=R.latitude,m=R.longitude;d=Math.min(d,p);h=Math.min(h,m);g=Math.max(g,p);l=Math.max(l,m);k.subtract(a,c,M);b.cartesianToCartographic(M,R);p=R.latitude;m=R.longitude;d=Math.min(d,p);h=Math.min(h,m);g=Math.max(g,p);l=Math.max(l,m);e.latitude=d;e.longitude=h;f.latitude=g;f.longitude=l}function G(c,b,f,h,g){c=C(c,b);c=a(c,k.equalsEpsilon);var l=c.length;if(2>l||0>=f)return new v;f*=.5;S.latitude=Number.POSITIVE_INFINITY;S.longitude=Number.POSITIVE_INFINITY;ca.latitude=Number.NEGATIVE_INFINITY;ca.longitude=Number.NEGATIVE_INFINITY;var p,m;h===e.ROUNDED&&(p=c[0],k.subtract(p,c[1],Y),k.normalize(Y,Y),k.multiplyByScalar(Y,f,Y),k.add(p,Y,Q),b.cartesianToCartographic(Q,R),p=R.latitude,m=R.longitude,S.latitude=Math.min(S.latitude,p),S.longitude=Math.min(S.longitude,m),ca.latitude=Math.max(ca.latitude,p),ca.longitude=Math.max(ca.longitude,m));for(p=0;p<l-1;++p)w(c[p],c[p+1],b,f,S,ca);p=c[l-1];k.subtract(p,c[l-2],Y);k.normalize(Y,Y);k.multiplyByScalar(Y,f,Y);k.add(p,Y,Q);w(p,Q,b,f,S,ca);h===e.ROUNDED&&(b.cartesianToCartographic(Q,R),p=R.latitude,m=R.longitude,S.latitude=Math.min(S.latitude,p),S.longitude=Math.min(S.longitude,m),ca.latitude=Math.max(ca.latitude,p),ca.longitude=Math.max(ca.longitude,m));b=d(g)?g:new v;b.north=ca.latitude;b.south=S.latitude;b.east=ca.longitude;b.west=S.longitude;return b}function E(a){a=p(a,p.EMPTY_OBJECT);var c=a.positions,b=a.width;l.defined("options.positions",c);l.defined("options.width",b);var d=p(a.height,0),f=p(a.extrudedHeight,d);this._positions=c;this._ellipsoid=t.clone(p(a.ellipsoid,t.WGS84));this._vertexFormat=B.clone(p(a.vertexFormat,B.DEFAULT));this._width=b;this._height=Math.max(d,f);this._extrudedHeight=Math.min(d,f);this._cornerType=p(a.cornerType,e.ROUNDED);this._granularity=p(a.granularity,z.RADIANS_PER_DEGREE);this._shadowVolume=p(a.shadowVolume,!1);this._workerName="createCorridorGeometry";this._offsetAttribute=a.offsetAttribute;this._rectangle=void 0;this.packedLength=1+c.length*k.packedLength+t.packedLength+B.packedLength+7}var L=new k,K=new k,P=new k,N=new k,O=new k,Z=new k,aa=new k,U=new k,W=new k,M=new k,R=new g,Y=new k,Q=new k,S=new g,ca=new g;E.pack=function(a,c,b){l.defined("value",a);l.defined("array",c);b=p(b,0);var d=a._positions,e=d.length;c[b++]=e;for(var f=0;f<e;++f,b+=k.packedLength)k.pack(d[f],c,b);t.pack(a._ellipsoid,c,b);b+=t.packedLength;B.pack(a._vertexFormat,c,b);b+=B.packedLength;c[b++]=a._width;c[b++]=a._height;c[b++]=a._extrudedHeight;c[b++]=a._cornerType;c[b++]=a._granularity;c[b++]=a._shadowVolume?1:0;c[b]=p(a._offsetAttribute,-1);return c};var T=t.clone(t.UNIT_SPHERE),da=new B,V={positions:void 0,ellipsoid:T,vertexFormat:da,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,shadowVolume:void 0,offsetAttribute:void 0};E.unpack=function(a,c,b){l.defined("array",a);c=p(c,0);for(var e=a[c++],f=Array(e),h=0;h<e;++h,c+=k.packedLength)f[h]=k.unpack(a,c);e=t.unpack(a,c,T);c+=t.packedLength;h=B.unpack(a,c,da);c+=B.packedLength;var g=a[c++],m=a[c++],q=a[c++],v=a[c++],r=a[c++],w=1===a[c++];a=a[c];if(!d(b))return V.positions=f,V.width=g,V.height=m,V.extrudedHeight=q,V.cornerType=v,V.granularity=r,V.shadowVolume=w,V.offsetAttribute=-1===a?void 0:a,new E(V);b._positions=f;b._ellipsoid=t.clone(e,b._ellipsoid);b._vertexFormat=B.clone(h,b._vertexFormat);b._width=g;b._height=m;b._extrudedHeight=q;b._cornerType=v;b._granularity=r;b._shadowVolume=w;b._offsetAttribute=-1===a?void 0:a;return b};E.computeRectangle=function(a,c){a=p(a,p.EMPTY_OBJECT);var b=a.positions,d=a.width;l.defined("options.positions",b);l.defined("options.width",d);var f=p(a.ellipsoid,t.WGS84),h=p(a.cornerType,e.ROUNDED);return G(b,f,d,h,c)};E.createGeometry=function(e){var g=e._positions,l=e._width,p=e._ellipsoid,g=C(g,p),q=a(g,k.equalsEpsilon);if(!(2>q.length||0>=l)){var v=e._height,w=e._extrudedHeight,u=!z.equalsEpsilon(v,w,0,z.EPSILON2),g=e._vertexFormat,l={ellipsoid:p,positions:q,width:l,cornerType:e._cornerType,granularity:e._granularity,saveAttributes:!0};if(u){l.height=v;l.extrudedHeight=w;l.shadowVolume=e._shadowVolume;l.offsetAttribute=e._offsetAttribute;var p=new B({position:g.position,normal:g.normal||g.bitangent||l.shadowVolume,tangent:g.tangent,bitangent:g.normal||g.bitangent,st:g.st}),q=l.ellipsoid,v=h.computePositions(l),p=H(v,p,q),t=l.height,E=l.extrudedHeight,u=p.attributes,p=p.indices,G=u.position.values,w=G.length,v=new Float64Array(6*w),I=new Float64Array(w);I.set(G);var M=new Float64Array(4*w),G=x.scaleToGeodeticHeight(G,t,q),M=J(G,0,M),I=x.scaleToGeodeticHeight(I,E,q),M=J(I,2*w,M);v.set(G);v.set(I,w);v.set(M,2*w);u.position.values=v;if(g.normal||g.tangent||g.bitangent||g.st){var G=u.position.values,T,Q;if(g.normal||g.bitangent)T=u.normal.values,Q=u.bitangent.values;q=u.position.values.length/18;E=3*q;q*=2;M=2*E;if(g.normal||g.bitangent||g.tangent){for(var S=g.normal?new Float32Array(6*E):void 0,I=g.tangent?new Float32Array(6*E):void 0,R=g.bitangent?new Float32Array(6*E):void 0,da=L,ca=K,Y=P,W=N,V=O,aa=Z,U=M,t=0;t<E;t+=3){var ba=U+M,da=k.fromArray(G,t,da),ca=k.fromArray(G,t+E,ca),Y=k.fromArray(G,(t+3)%E,Y),ca=k.subtract(ca,da,ca),Y=k.subtract(Y,da,Y),W=k.normalize(k.cross(ca,Y,W),W);g.normal&&(h.addAttribute(S,W,ba),h.addAttribute(S,W,ba+3),h.addAttribute(S,W,U),h.addAttribute(S,W,U+3));if(g.tangent||g.bitangent)aa=k.fromArray(T,t,aa),g.bitangent&&(h.addAttribute(R,aa,ba),h.addAttribute(R,aa,ba+3),h.addAttribute(R,aa,U),h.addAttribute(R,aa,U+3)),g.tangent&&(V=k.normalize(k.cross(aa,W,V),V),h.addAttribute(I,V,ba),h.addAttribute(I,V,ba+3),h.addAttribute(I,V,U),h.addAttribute(I,V,U+3));U+=6}if(g.normal){S.set(T);for(t=0;t<E;t+=3)S[t+E]=-T[t],S[t+E+1]=-T[t+1],S[t+E+2]=-T[t+2];u.normal.values=S}else u.normal=void 0;g.bitangent?(R.set(Q),R.set(Q,E),u.bitangent.values=R):u.bitangent=void 0;g.tangent&&(T=u.tangent.values,I.set(T),I.set(T,E),u.tangent.values=I)}if(g.st){T=u.st.values;Q=new Float32Array(6*q);Q.set(T);Q.set(T,q);E=2*q;for(G=0;2>G;G++){Q[E++]=T[0];Q[E++]=T[1];for(t=2;t<q;t+=2)I=T[t],M=T[t+1],Q[E++]=I,Q[E++]=M,Q[E++]=I,Q[E++]=M;Q[E++]=T[0];Q[E++]=T[1]}u.st.values=Q}}Q=w/3;if(l.shadowVolume){q=u.normal.values;w=q.length;t=new Float32Array(6*w);for(T=0;T<w;T++)q[T]=-q[T];t.set(q,w);t=J(q,4*w,t);u.extrudeDirection=new c({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:t});g.normal||(u.normal=void 0)}d(l.offsetAttribute)&&(w=new Uint8Array(6*Q),l.offsetAttribute===y.TOP?(w=b(w,1,0,Q),w=b(w,1,2*Q,4*Q)):w=b(w,l.offsetAttribute===y.NONE?0:1),u.applyOffset=new c({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:w}));q=p.length;l=Q+Q;v=A.createTypedArray(v.length/3,2*q+3*l);v.set(p);w=q;for(T=0;T<q;T+=3)t=p[T],E=p[T+1],G=p[T+2],v[w++]=G+Q,v[w++]=E+Q,v[w++]=t+Q;for(T=0;T<l;T+=2)p=T+l,Q=p+l,q=p+1,t=Q+1,v[w++]=p,v[w++]=Q,v[w++]=q,v[w++]=q,v[w++]=Q,v[w++]=t;l={attributes:u,indices:v}}else l=h.computePositions(l),l=H(l,g,p),l.attributes.position.values=x.scaleToGeodeticHeight(l.attributes.position.values,v,p),d(e._offsetAttribute)&&(p=e._offsetAttribute===y.NONE?0:1,v=new Uint8Array(l.attributes.position.values.length/3),b(v,p),l.attributes.applyOffset=new c({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:v}));p=l.attributes;v=f.fromVertices(p.position.values,void 0,3);g.position||(l.attributes.position.values=void 0);return new r({attributes:p,indices:l.indices,primitiveType:D.TRIANGLES,boundingSphere:v,offsetAttribute:e._offsetAttribute})}};E.createShadowVolume=function(a,c,b){var d=a._granularity,e=a._ellipsoid;c=c(d,e);b=b(d,e);return new E({positions:a._positions,width:a._width,cornerType:a._cornerType,ellipsoid:e,granularity:d,extrudedHeight:c,height:b,vertexFormat:B.POSITION_ONLY,shadowVolume:!0})};q(E.prototype,{rectangle:{get:function(){d(this._rectangle)||(this._rectangle=G(this._positions,this._ellipsoid,this._width,this._cornerType));return this._rectangle}},textureCoordinateRotationPoints:{get:function(){return[0,0,0,1,1,0]}}});return E});F("Core/CorridorOutlineGeometry","./arrayFill ./arrayRemoveDuplicates ./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./CornerType ./CorridorGeometryLibrary ./defaultValue ./defined ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PolygonPipeline ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(a,c){var b=[],d=a.positions,f=a.corners,h=a.endPositions,g=new r,q,w=0,z=0,y,D=0,A;for(y=0;y<d.length;y+=2)A=d[y].length-3,w+=A,D+=A/3*4,z+=d[y+1].length-3;w+=3;z+=3;for(y=0;y<f.length;y++){var x=f[y].leftPositions;p(x)?(A=x.length,w+=A):(A=f[y].rightPositions.length,z+=A);D+=A/3*2}var x=p(h),H;x&&(H=h[0].length-3,w+=H,z+=H,H/=3,D+=4*H);y=w+z;var w=new Float64Array(y),z=0,I=y-1,J,S,ca,T,da=H/2,D=u.createTypedArray(y/3,D+4),V=0;D[V++]=z/3;D[V++]=(I-2)/3;if(x){b.push(z/3);A=v;T=B;var ba=h[0];for(y=0;y<da;y++)A=k.fromArray(ba,3*(da-1-y),A),T=k.fromArray(ba,3*(da+y),T),e.addAttribute(w,T,z),e.addAttribute(w,A,void 0,I),q=z/3,ca=q+1,J=(I-2)/3,S=J-1,D[V++]=J,D[V++]=S,D[V++]=q,D[V++]=ca,z+=3,I-=3}T=0;J=d[T++];ba=d[T++];w.set(J,z);w.set(ba,I-ba.length+1);A=ba.length-3;b.push(z/3,(I-2)/3);for(y=0;y<A;y+=3)q=z/3,ca=q+1,J=(I-2)/3,S=J-1,D[V++]=J,D[V++]=S,D[V++]=q,D[V++]=ca,z+=3,I-=3;for(y=0;y<f.length;y++){q=f[y];J=q.leftPositions;q=q.rightPositions;var X=C;if(p(J)){I-=3;ba=S;b.push(ca);for(A=0;A<J.length/3;A++)X=k.fromArray(J,3*A,X),D[V++]=ba-A-1,D[V++]=ba-A,e.addAttribute(w,X,void 0,I),I-=3;b.push(ba-Math.floor(J.length/6));c===m.BEVELED&&b.push((I-2)/3+1);z+=3}else{z+=3;ba=ca;b.push(S);for(A=0;A<q.length/3;A++)X=k.fromArray(q,3*A,X),D[V++]=ba+A,D[V++]=ba+A+1,e.addAttribute(w,X,z),z+=3;b.push(ba+Math.floor(q.length/6));c===m.BEVELED&&b.push(z/3-1);I-=3}J=d[T++];ba=d[T++];J.splice(0,3);ba.splice(ba.length-3,3);w.set(J,z);w.set(ba,I-ba.length+1);for(A=0;A<ba.length;A+=3)ca=z/3,q=ca-1,S=(I-2)/3,J=S+1,D[V++]=J,D[V++]=S,D[V++]=q,D[V++]=ca,z+=3,I-=3;z-=3;I+=3;b.push(z/3,(I-2)/3)}if(x){z+=3;I-=3;A=v;T=B;d=h[1];for(y=0;y<da;y++)A=k.fromArray(d,3*(H-y-1),A),T=k.fromArray(d,3*y,T),e.addAttribute(w,A,void 0,I),e.addAttribute(w,T,z),ca=z/3,q=ca-1,S=(I-2)/3,J=S+1,D[V++]=J,D[V++]=S,D[V++]=q,D[V++]=ca,z+=3,I-=3;b.push(z/3)}else b.push(z/3,(I-2)/3);D[V++]=z/3;D[V++]=(I-2)/3;g.position=new t({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:w});return{attributes:g,indices:D,wallIndices:b}}function D(a){a=h(a,h.EMPTY_OBJECT);var c=a.positions,b=a.width;g.typeOf.object("options.positions",c);g.typeOf.number("options.width",b);var e=h(a.height,0),f=h(a.extrudedHeight,e);this._positions=c;this._ellipsoid=d.clone(h(a.ellipsoid,d.WGS84));this._width=b;this._height=Math.max(e,f);this._extrudedHeight=Math.min(e,f);this._cornerType=h(a.cornerType,m.ROUNDED);this._granularity=h(a.granularity,y.RADIANS_PER_DEGREE);this._offsetAttribute=a.offsetAttribute;this._workerName="createCorridorOutlineGeometry";this.packedLength=1+c.length*k.packedLength+d.packedLength+6}var v=new k,B=new k,C=new k;D.pack=function(a,c,b){g.typeOf.object("value",a);g.typeOf.object("array",c);b=h(b,0);var e=a._positions,f=e.length;c[b++]=f;for(var l=0;l<f;++l,b+=k.packedLength)k.pack(e[l],c,b);d.pack(a._ellipsoid,c,b);b+=d.packedLength;c[b++]=a._width;c[b++]=a._height;c[b++]=a._extrudedHeight;c[b++]=a._cornerType;c[b++]=a._granularity;c[b]=h(a._offsetAttribute,-1);return c};var I=d.clone(d.UNIT_SPHERE),H={positions:void 0,ellipsoid:I,width:void 0,height:void 0,extrudedHeight:void 0,cornerType:void 0,granularity:void 0,offsetAttribute:void 0};D.unpack=function(a,c,b){g.typeOf.object("array",a);c=h(c,0);for(var e=a[c++],f=Array(e),l=0;l<e;++l,c+=k.packedLength)f[l]=k.unpack(a,c);e=d.unpack(a,c,I);c+=d.packedLength;var l=a[c++],m=a[c++],q=a[c++],v=a[c++],w=a[c++];a=a[c];if(!p(b))return H.positions=f,H.width=l,H.height=m,H.extrudedHeight=q,H.cornerType=v,H.granularity=w,H.offsetAttribute=-1===a?void 0:a,new D(H);b._positions=f;b._ellipsoid=d.clone(e,b._ellipsoid);b._width=l;b._height=m;b._extrudedHeight=q;b._cornerType=v;b._granularity=w;b._offsetAttribute=-1===a?void 0:a;return b};D.createGeometry=function(d){for(var h=d._positions,g=d._width,m=d._ellipsoid,v=0;v<h.length;v++)h[v]=m.scaleToGeodeticSurface(h[v],h[v]);v=a(h,k.equalsEpsilon);if(!(2>v.length||0>=g)){var h=d._height,r=d._extrudedHeight,B=!y.equalsEpsilon(h,r,0,y.EPSILON2),v={ellipsoid:m,positions:v,width:g,cornerType:d._cornerType,granularity:d._granularity,saveAttributes:!1};if(B){v.height=h;v.extrudedHeight=r;v.offsetAttribute=d._offsetAttribute;var B=v.ellipsoid,m=e.computePositions(v),h=x(m,v.cornerType),m=h.wallIndices,C=v.height,D=v.extrudedHeight,g=h.attributes,r=h.indices,H=g.position.values,h=H.length,I=new Float64Array(h);I.set(H);var J=new Float64Array(2*h),H=A.scaleToGeodeticHeight(H,C,B),I=A.scaleToGeodeticHeight(I,D,B);J.set(H);J.set(I,h);g.position.values=J;h/=3;p(v.offsetAttribute)&&(B=new Uint8Array(2*h),B=v.offsetAttribute===c.TOP?b(B,1,0,h):b(B,v.offsetAttribute===c.NONE?0:1),g.applyOffset=new t({componentDatatype:l.UNSIGNED_BYTE,componentsPerAttribute:1,values:B}));C=r.length;B=u.createTypedArray(J.length/3,2*(C+m.length));B.set(r);J=C;for(v=0;v<C;v+=2)D=r[v],H=r[v+1],B[J++]=D+h,B[J++]=H+h;for(v=0;v<m.length;v++)r=m[v],C=r+h,B[J++]=r,B[J++]=C;g={attributes:g,indices:B}}else g=e.computePositions(v),g=x(g,v.cornerType),g.attributes.position.values=A.scaleToGeodeticHeight(g.attributes.position.values,h,m),p(d._offsetAttribute)&&(m=new Uint8Array(g.attributes.position.values.length/3),b(m,d._offsetAttribute===c.NONE?0:1),g.attributes.applyOffset=new t({componentDatatype:l.UNSIGNED_BYTE,componentsPerAttribute:1,values:m}));m=g.attributes;h=f.fromVertices(m.position.values,void 0,3);return new q({attributes:m,indices:g.indices,primitiveType:z.LINES,boundingSphere:h,offsetAttribute:d._offsetAttribute})}};return D});F("Core/createGuid",[],function(){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var a=16*Math.random()|0;return("x"===b?a:a&3|8).toString(16)})}});F("Core/Ion",["./Credit","./defined","./Resource"],function(b,a,f){var k,g={defaultAccessToken:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJmM2QxOTgwYi05NWUwLTQ5YzAtOWQzNS01ZGUzY2U0MDJkYzciLCJpZCI6MjU5LCJzY29wZXMiOlsiYXNyIiwiZ2MiXSwiaWF0IjoxNTYxOTc2NzgwfQ.7_uNmrARhPNr9f3bn4FQAxF1JVVZ81sw2RypWivq5Zc"};g.defaultServer=new f({url:"https://api.cesium.com/"});g.getDefaultTokenCredit=function(f){if("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiJmM2QxOTgwYi05NWUwLTQ5YzAtOWQzNS01ZGUzY2U0MDJkYzciLCJpZCI6MjU5LCJzY29wZXMiOlsiYXNyIiwiZ2MiXSwiaWF0IjoxNTYxOTc2NzgwfQ.7_uNmrARhPNr9f3bn4FQAxF1JVVZ81sw2RypWivq5Zc"===f)return a(k)||(k=new b('\x3cb\x3e             This application is using Cesium\'s default ion access token. Please assign \x3ci\x3eCesium.Ion.defaultAccessToken\x3c/i\x3e             with an access token from your ion account before making any Cesium API calls.             You can sign up for a free ion account at \x3ca href\x3d"https://cesium.com"\x3ehttps://cesium.com\x3c/a\x3e.\x3c/b\x3e',!0)),k};return g});F("Core/IonResource","../ThirdParty/Uri ../ThirdParty/when ./Check ./Credit ./defaultValue ./defined ./defineProperties ./Ion ./Resource ./RuntimeError".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a,d){f.defined("endpoint",a);f.defined("endpointResource",d);var c;c=a.externalType;var e=l(c);if(e)if("3DTILES"===c||"STK_TERRAIN_SERVER"===c)c={url:a.options.url};else throw new p("Ion.createResource does not support external imagery assets; use IonImageryProvider instead.");else c={url:a.url,retryAttempts:1,retryCallback:q};h.call(this,c);this._ionEndpoint=a;this._ionEndpointDomain=e?void 0:(new b(a.url)).authority;this._ionEndpointResource=d;this._credits=this._pendingPromise=this._ionRoot=void 0;this._isExternal=e}function q(b,d){var c=g(b._ionRoot,b),e=c._ionEndpointResource;if(!l(d)||401!==d.statusCode&&!(d.target instanceof Image))return a.resolve(!1);l(c._pendingPromise)||(c._pendingPromise=e.fetchJson().then(function(a){return c._ionEndpoint=a}).always(function(a){c._pendingPromise=void 0;return a}));return c._pendingPromise.then(function(a){b._ionEndpoint=a;return!0})}l(Object.create)&&(d.prototype=Object.create(h.prototype),d.prototype.constructor=d);d.fromAssetId=function(a,b){var c=d._createEndpointResource(a,b);return c.fetchJson().then(function(a){return new d(a,c)})};m(d.prototype,{credits:{get:function(){return l(this._ionRoot)?this._ionRoot.credits:l(this._credits)?this._credits:this._credits=d.getCreditsFromEndpoint(this._ionEndpoint,this._ionEndpointResource)}}});d.getCreditsFromEndpoint=function(a,b){var c=a.attributions.map(k.getIonCredit),d=e.getDefaultTokenCredit(b.queryParameters.access_token);l(d)&&c.push(k.clone(d));return c};d.prototype.clone=function(a){var b=g(this._ionRoot,this);l(a)||(a=new d(b._ionEndpoint,b._ionEndpointResource));a=h.prototype.clone.call(this,a);a._ionRoot=b;a._isExternal=this._isExternal;return a};d.prototype.fetchImage=function(a){if(!this._isExternal){var b=a;a={preferBlob:!0};l(b)&&(a.flipY=b.flipY,a.preferImageBitmap=b.preferImageBitmap)}return h.prototype.fetchImage.call(this,a)};d.prototype._makeRequest=function(a){if(this._isExternal||(new b(this.url)).authority!==this._ionEndpointDomain)return h.prototype._makeRequest.call(this,a);var d="*/*;access_token\x3d"+this._ionEndpoint.accessToken,c=d,e=this.headers;l(e)&&l(e.Accept)&&(c=e.Accept+","+d);l(a.headers)?l(a.headers.Accept)?a.headers.Accept=a.headers.Accept+","+d:a.headers.Accept=c:a.headers={Accept:c};return h.prototype._makeRequest.call(this,a)};d._createEndpointResource=function(a,b){f.defined("assetId",a);b=g(b,g.EMPTY_OBJECT);var c=g(b.server,e.defaultServer),d=g(b.accessToken,e.defaultAccessToken),c=h.createIfNeeded(c),k={url:"v1/assets/"+a+"/endpoint"};l(d)&&(k.queryParameters={access_token:d});return c.getDerivedResource(k)};return d});F("Core/createWorldTerrain",["./CesiumTerrainProvider","./defaultValue","./IonResource"],function(b,a,f){return function(k){k=a(k,a.EMPTY_OBJECT);return new b({url:f.fromAssetId(1),requestVertexNormals:a(k.requestVertexNormals,!1),requestWaterMask:a(k.requestWaterMask,!1)})}});F("Core/CullingVolume","./Cartesian3 ./Cartesian4 ./defaultValue ./defined ./DeveloperError ./Intersect ./Plane".split(" "),function(b,a,f,k,g,l,m){function e(a){this.planes=f(a,[])}var h=[new b,new b,new b];b.clone(b.UNIT_X,h[0]);b.clone(b.UNIT_Y,h[1]);b.clone(b.UNIT_Z,h[2]);var p=new b,d=new b,q=new m(new b(1,0,0),0);e.fromBoundingSphere=function(f,l){if(!k(f))throw new g("boundingSphere is required.");k(l)||(l=new e);var c=h.length,m=l.planes;m.length=2*c;for(var q=f.center,r=f.radius,t=0,x=0;x<c;++x){var D=h[x],v=m[t],B=m[t+1];k(v)||(v=m[t]=new a);k(B)||(B=m[t+1]=new a);b.multiplyByScalar(D,-r,p);b.add(q,p,p);v.x=D.x;v.y=D.y;v.z=D.z;v.w=-b.dot(D,p);b.multiplyByScalar(D,r,p);b.add(q,p,p);B.x=-D.x;B.y=-D.y;B.z=-D.z;B.w=-b.dot(b.negate(D,d),p);t+=2}return l};e.prototype.computeVisibility=function(a){if(!k(a))throw new g("boundingVolume is required.");for(var b=this.planes,c=!1,d=0,e=b.length;d<e;++d){var f=a.intersectPlane(m.fromCartesian4(b[d],q));if(f===l.OUTSIDE)return l.OUTSIDE;f===l.INTERSECTING&&(c=!0)}return c?l.INTERSECTING:l.INSIDE};e.prototype.computeVisibilityWithPlaneMask=function(a,b){if(!k(a))throw new g("boundingVolume is required.");if(!k(b))throw new g("parentPlaneMask is required.");if(b===e.MASK_OUTSIDE||b===e.MASK_INSIDE)return b;for(var c=e.MASK_INSIDE,d=this.planes,f=0,h=d.length;f<h;++f){var p=31>f?1<<f:0;if(!(31>f&&0===(b&p))){var r=a.intersectPlane(m.fromCartesian4(d[f],q));if(r===l.OUTSIDE)return e.MASK_OUTSIDE;r===l.INTERSECTING&&(c|=p)}}return c};e.MASK_OUTSIDE=4294967295;e.MASK_INSIDE=0;e.MASK_INDETERMINATE=2147483647;return e});F("Core/CylinderGeometryLibrary",["./Math"],function(b){return{computePositions:function(a,f,k,g,l){a*=.5;for(var m=-a,e=g+g,h=new Float64Array(3*(l?2*e:e)),p=0,d=0,q=l?3*e:0,t=l?3*(e+g):3*g,e=0;e<g;e++){var r=e/g*b.TWO_PI,c=Math.cos(r),u=Math.sin(r),r=c*k,y=u*k,c=c*f,u=u*f;h[d+q]=r;h[d+q+1]=y;h[d+q+2]=m;h[d+t]=c;h[d+t+1]=u;h[d+t+2]=a;d+=3;l&&(h[p++]=r,h[p++]=y,h[p++]=m,h[p++]=c,h[p++]=u,h[p++]=a)}return h}}});F("Core/CylinderGeometry","./arrayFill ./BoundingSphere ./Cartesian2 ./Cartesian3 ./ComponentDatatype ./CylinderGeometryLibrary ./defaultValue ./defined ./DeveloperError ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PrimitiveType ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=m(a,m.EMPTY_OBJECT);var c=a.length,b=a.topRadius,d=a.bottomRadius,f=m(a.vertexFormat,y.DEFAULT),g=m(a.slices,128);if(!e(c))throw new h("options.length must be defined.");if(!e(b))throw new h("options.topRadius must be defined.");if(!e(d))throw new h("options.bottomRadius must be defined.");if(3>g)throw new h("options.slices must be greater than or equal to 3.");if(e(a.offsetAttribute)&&a.offsetAttribute===t.TOP)throw new h("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=c;this._topRadius=b;this._bottomRadius=d;this._vertexFormat=y.clone(f);this._slices=g;this._offsetAttribute=a.offsetAttribute;this._workerName="createCylinderGeometry"}var z=new f,x=new k,D=new k,v=new k,B=new k;A.packedLength=y.packedLength+5;A.pack=function(a,c,b){if(!e(a))throw new h("value is required");if(!e(c))throw new h("array is required");b=m(b,0);y.pack(a._vertexFormat,c,b);b+=y.packedLength;c[b++]=a._length;c[b++]=a._topRadius;c[b++]=a._bottomRadius;c[b++]=a._slices;c[b]=m(a._offsetAttribute,-1);return c};var C=new y,I={vertexFormat:C,length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,offsetAttribute:void 0};A.unpack=function(a,c,b){if(!e(a))throw new h("array is required");c=m(c,0);var d=y.unpack(a,c,C);c+=y.packedLength;var f=a[c++],g=a[c++],k=a[c++],l=a[c++];a=a[c];if(!e(b))return I.length=f,I.topRadius=g,I.bottomRadius=k,I.slices=l,I.offsetAttribute=-1===a?void 0:a,new A(I);b._vertexFormat=y.clone(d,b._vertexFormat);b._length=f;b._topRadius=g;b._bottomRadius=k;b._slices=l;b._offsetAttribute=-1===a?void 0:a;return b};A.createGeometry=function(h){var m=h._length,C=h._topRadius,y=h._bottomRadius,A=h._vertexFormat,H=h._slices;if(!(0>=m||0>C||0>y||0===C&&0===y)){var I=H+H,J=H+I,O=I+I,Z=l.computePositions(m,C,y,H,!0),aa=A.st?new Float32Array(2*O):void 0,U=A.normal?new Float32Array(3*O):void 0,W=A.tangent?new Float32Array(3*O):void 0,M=A.bitangent?new Float32Array(3*O):void 0,R,Y=A.normal||A.tangent||A.bitangent;if(Y){var Q=A.tangent||A.bitangent,S=0,ca=0,T=0;R=Math.atan2(y-C,m);x.z=Math.sin(R);var da=Math.cos(R),V=v,ba=D;for(R=0;R<H;R++){var X=R/H*c.TWO_PI,fa=da*Math.cos(X),X=da*Math.sin(X);Y&&(x.x=fa,x.y=X,Q&&(V=k.normalize(k.cross(k.UNIT_Z,x,V),V)),A.normal&&(U[S++]=x.x,U[S++]=x.y,U[S++]=x.z,U[S++]=x.x,U[S++]=x.y,U[S++]=x.z),A.tangent&&(W[ca++]=V.x,W[ca++]=V.y,W[ca++]=V.z,W[ca++]=V.x,W[ca++]=V.y,W[ca++]=V.z),A.bitangent&&(ba=k.normalize(k.cross(x,V,ba),ba),M[T++]=ba.x,M[T++]=ba.y,M[T++]=ba.z,M[T++]=ba.x,M[T++]=ba.y,M[T++]=ba.z))}for(R=0;R<H;R++)A.normal&&(U[S++]=0,U[S++]=0,U[S++]=-1),A.tangent&&(W[ca++]=1,W[ca++]=0,W[ca++]=0),A.bitangent&&(M[T++]=0,M[T++]=-1,M[T++]=0);for(R=0;R<H;R++)A.normal&&(U[S++]=0,U[S++]=0,U[S++]=1),A.tangent&&(W[ca++]=1,W[ca++]=0,W[ca++]=0),A.bitangent&&(M[T++]=0,M[T++]=1,M[T++]=0)}Y=r.createTypedArray(O,12*H-12);for(R=S=Q=0;R<H-1;R++)Y[Q++]=S,Y[Q++]=S+2,Y[Q++]=S+3,Y[Q++]=S,Y[Q++]=S+3,Y[Q++]=S+1,S+=2;Y[Q++]=I-2;Y[Q++]=0;Y[Q++]=1;Y[Q++]=I-2;Y[Q++]=1;Y[Q++]=I-1;for(R=1;R<H-1;R++)Y[Q++]=I+R+1,Y[Q++]=I+R,Y[Q++]=I;for(R=1;R<H-1;R++)Y[Q++]=J,Y[Q++]=J+R,Y[Q++]=J+R+1;H=0;if(A.st)for(I=Math.max(C,y),R=0;R<O;R++)J=k.fromArray(Z,3*R,B),aa[H++]=(J.x+I)/(2*I),aa[H++]=(J.y+I)/(2*I);O=new q;A.position&&(O.position=new d({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:Z}));A.normal&&(O.normal=new d({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:U}));A.tangent&&(O.tangent=new d({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:W}));A.bitangent&&(O.bitangent=new d({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:M}));A.st&&(O.st=new d({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:aa}));z.x=.5*m;z.y=Math.max(y,C);C=new a(k.ZERO,f.magnitude(z));e(h._offsetAttribute)&&(m=Z.length,m=new Uint8Array(m/3),b(m,h._offsetAttribute===t.NONE?0:1),O.applyOffset=new d({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:1,values:m}));return new p({attributes:O,indices:Y,primitiveType:u.TRIANGLES,boundingSphere:C,offsetAttribute:h._offsetAttribute})}};var H;A.getUnitCylinder=function(){e(H)||(H=A.createGeometry(new A({topRadius:1,bottomRadius:1,length:1,vertexFormat:y.POSITION_ONLY})));return H};return A});F("Core/CylinderOutlineGeometry","./arrayFill ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Check ./ComponentDatatype ./CylinderGeometryLibrary ./defaultValue ./defined ./DeveloperError ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a){a=e(a,e.EMPTY_OBJECT);var c=a.length,b=a.topRadius,d=a.bottomRadius,f=e(a.slices,128),k=Math.max(e(a.numberOfVerticalLines,16),0);g.typeOf.number("options.positions",c);g.typeOf.number("options.topRadius",b);g.typeOf.number("options.bottomRadius",d);g.typeOf.number.greaterThanOrEquals("options.slices",f,3);if(h(a.offsetAttribute)&&a.offsetAttribute===r.TOP)throw new p("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._length=c;this._topRadius=b;this._bottomRadius=d;this._slices=f;this._numberOfVerticalLines=k;this._offsetAttribute=a.offsetAttribute;this._workerName="createCylinderOutlineGeometry"}var A=new f;y.packedLength=6;y.pack=function(a,c,b){g.typeOf.object("value",a);g.defined("array",c);b=e(b,0);c[b++]=a._length;c[b++]=a._topRadius;c[b++]=a._bottomRadius;c[b++]=a._slices;c[b++]=a._numberOfVerticalLines;c[b]=e(a._offsetAttribute,-1);return c};var z={length:void 0,topRadius:void 0,bottomRadius:void 0,slices:void 0,numberOfVerticalLines:void 0,offsetAttribute:void 0};y.unpack=function(a,c,b){g.defined("array",a);c=e(c,0);var d=a[c++],f=a[c++],k=a[c++],l=a[c++],p=a[c++];a=a[c];if(!h(b))return z.length=d,z.topRadius=f,z.bottomRadius=k,z.slices=l,z.numberOfVerticalLines=p,z.offsetAttribute=-1===a?void 0:a,new y(z);b._length=d;b._topRadius=f;b._bottomRadius=k;b._slices=l;b._numberOfVerticalLines=p;b._offsetAttribute=-1===a?void 0:a;return b};y.createGeometry=function(e){var g=e._length,p=e._topRadius,B=e._bottomRadius,C=e._slices,z=e._numberOfVerticalLines;if(!(0>=g||0>p||0>B||0===p&&0===B)){var y=2*C,x=m.computePositions(g,p,B,C,!1),w=2*C,G;if(0<z){var E=Math.min(z,C);G=Math.round(C/E);w+=E}y=c.createTypedArray(y,2*w);for(E=w=0;E<C-1;E++)y[w++]=E,y[w++]=E+1,y[w++]=E+C,y[w++]=E+1+C;y[w++]=C-1;y[w++]=0;y[w++]=C+C-1;y[w++]=C;if(0<z)for(E=0;E<C;E+=G)y[w++]=E,y[w++]=E+C;C=new t;C.position=new q({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:x});A.x=.5*g;A.y=Math.max(B,p);p=new a(k.ZERO,f.magnitude(A));h(e._offsetAttribute)&&(g=x.length,g=new Uint8Array(g/3),b(g,e._offsetAttribute===r.NONE?0:1),C.applyOffset=new q({componentDatatype:l.UNSIGNED_BYTE,componentsPerAttribute:1,values:g}));return new d({attributes:C,indices:y,primitiveType:u.LINES,boundingSphere:p,offsetAttribute:e._offsetAttribute})}};return y});F("Core/decodeGoogleEarthEnterpriseData",["./Check","./RuntimeError"],function(b,a){function f(k,g){if(f.passThroughDataForTesting)return g;b.typeOf.object("key",k);b.typeOf.object("data",g);var l=k.byteLength;if(0===l||0!==l%4)throw new a("The length of key must be greater than 0 and a multiple of 4.");var m=new DataView(g),e=m.getUint32(0,!0);if(1953029805===e||2917034100===e)return g;for(var e=new DataView(k),h=0,p=g.byteLength,d=p-p%8,q,t=8;h<d;)for(q=t=(t+8)%24;h<d&&q<l;)m.setUint32(h,m.getUint32(h,!0)^e.getUint32(q,!0),!0),m.setUint32(h+4,m.getUint32(h+4,!0)^e.getUint32(q+4,!0),!0),h+=8,q+=24;if(h<p)for(q>=l&&(q=(t+8)%24);h<p;)m.setUint8(h,m.getUint8(h)^e.getUint8(q)),h++,q++}f.passThroughDataForTesting=!1;return f});F("Core/DefaultProxy",[],function(){function b(a){this.proxy=a}b.prototype.getURL=function(a){var b=-1===this.proxy.indexOf("?")?"?":"";return this.proxy+b+encodeURIComponent(a)};return b});F("Core/oneTimeWarning",["./defaultValue","./defined","./DeveloperError"],function(b,a,f){function k(k,m){if(!a(k))throw new f("identifier is required.");a(g[k])||(g[k]=!0,console.warn(b(m,k)))}var g={};k.geometryOutlines="Entity geometry outlines are unsupported on terrain. Outlines will be disabled. To enable outlines, disable geometry terrain clamping by explicitly setting height to 0.";k.geometryZIndex="Entity geometry with zIndex are unsupported when height or extrudedHeight are defined.  zIndex will be ignored";k.geometryHeightReference="Entity corridor, ellipse, polygon or rectangle with heightReference must also have a defined height.  heightReference will be ignored";k.geometryExtrudedHeightReference="Entity corridor, ellipse, polygon or rectangle with extrudedHeightReference must also have a defined extrudedHeight.  extrudedHeightReference will be ignored";return k});F("Core/deprecationWarning",["./defined","./DeveloperError","./oneTimeWarning"],function(b,a,f){return function(k,g){if(!b(k)||!b(g))throw new a("identifier and message are required.");f(k,g)}});F("Core/DistanceDisplayCondition",["./defaultValue","./defined","./defineProperties","./DeveloperError"],function(b,a,f,k){function g(a,f){this._near=a=b(a,0);this._far=f=b(f,Number.MAX_VALUE)}f(g.prototype,{near:{get:function(){return this._near},set:function(a){this._near=a}},far:{get:function(){return this._far},set:function(a){this._far=a}}});g.packedLength=2;g.pack=function(f,g,e){if(!a(f))throw new k("value is required");if(!a(g))throw new k("array is required");e=b(e,0);g[e++]=f.near;g[e]=f.far;return g};g.unpack=function(f,m,e){if(!a(f))throw new k("array is required");m=b(m,0);a(e)||(e=new g);e.near=f[m++];e.far=f[m];return e};g.equals=function(b,f){return b===f||a(b)&&a(f)&&b.near===f.near&&b.far===f.far};g.clone=function(b,f){if(a(b))return a(f)||(f=new g),f.near=b.near,f.far=b.far,f};g.prototype.clone=function(a){return g.clone(this,a)};g.prototype.equals=function(a){return g.equals(this,a)};return g});F("Core/DistanceDisplayConditionGeometryInstanceAttribute",["./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError"],function(b,a,f,k,g){function l(b,e){b=a(b,0);e=a(e,Number.MAX_VALUE);if(e<=b)throw new g("far distance must be greater than near distance.");this.value=new Float32Array([b,e])}k(l.prototype,{componentDatatype:{get:function(){return b.FLOAT}},componentsPerAttribute:{get:function(){return 2}},normalize:{get:function(){return!1}}});l.fromDistanceDisplayCondition=function(a){if(!f(a))throw new g("distanceDisplayCondition is required.");if(a.far<=a.near)throw new g("distanceDisplayCondition.far distance must be greater than distanceDisplayCondition.near distance.");return new l(a.near,a.far)};l.toValue=function(a,b){if(!f(a))throw new g("distanceDisplayCondition is required.");if(!f(b))return new Float32Array([a.near,a.far]);b[0]=a.near;b[1]=a.far;return b};return l});F("Core/DoublyLinkedList",["./defined","./defineProperties"],function(b,a){function f(){this.tail=this.head=void 0;this._length=0}function k(a,b,e){this.item=a;this.previous=b;this.next=e}function g(a,f){b(f.previous)&&b(f.next)?(f.previous.next=f.next,f.next.previous=f.previous):b(f.previous)?(f.previous.next=void 0,a.tail=f.previous):b(f.next)?(f.next.previous=void 0,a.head=f.next):(a.head=void 0,a.tail=void 0);f.next=void 0;f.previous=void 0}a(f.prototype,{length:{get:function(){return this._length}}});f.prototype.add=function(a){a=new k(a,this.tail,void 0);b(this.tail)?this.tail.next=a:this.head=a;this.tail=a;++this._length;return a};f.prototype.remove=function(a){b(a)&&(g(this,a),--this._length)};f.prototype.splice=function(a,b){if(a!==b){g(this,b);var e=a.next;a.next=b;this.tail===a?this.tail=b:e.previous=b;b.next=e;b.previous=a}};return f});F("ThirdParty/Tween",[],function(){void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()});var b=b||function(){var a=[];return{REVISION:"13",getAll:function(){return a},removeAll:function(){a=[]},add:function(b){a.push(b)},remove:function(b){b=a.indexOf(b);-1!==b&&a.splice(b,1)},update:function(b){if(0===a.length)return!1;var f=0;for(b=void 0!==b?b:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();f<a.length;)a[f].update(b)?f++:a.splice(f,1);return!0}}}();b.Tween=function(a){var f={},k={},g={},l=1E3,m=0,e=!1,h=!1,p=0,d=null,q=b.Easing.Linear.None,t=b.Interpolation.Linear,r=[],c=null,u=!1,y=null,A=null,z=null,x;for(x in a)f[x]=parseFloat(a[x],10);this.to=function(a,c){void 0!==c&&(l=c);k=a;return this};this.start=function(c){b.add(this);h=!0;u=!1;d=void 0!==c?c:"undefined"!==typeof window&&void 0!==window.performance&&void 0!==window.performance.now?window.performance.now():Date.now();d+=p;for(var e in k){if(k[e]instanceof Array){if(0===k[e].length)continue;k[e]=[a[e]].concat(k[e])}f[e]=a[e];!1===f[e]instanceof Array&&(f[e]*=1);g[e]=f[e]||0}return this};this.stop=function(){if(!h)return this;b.remove(this);h=!1;null!==z&&z.call(a);this.stopChainedTweens();return this};this.stopChainedTweens=function(){for(var a=0,c=r.length;a<c;a++)r[a].stop()};this.delay=function(a){p=a;return this};this.repeat=function(a){m=a;return this};this.yoyo=function(a){e=a;return this};this.easing=function(a){q=a;return this};this.interpolation=function(a){t=a;return this};this.chain=function(){r=arguments;return this};this.onStart=function(a){c=a;return this};this.onUpdate=function(a){y=a;return this};this.onComplete=function(a){A=a;return this};this.onStop=function(a){z=a;return this};this.update=function(b){var h;if(b<d)return!0;!1===u&&(null!==c&&c.call(a),u=!0);var B=(b-d)/l,B=1<B?1:B,C=q(B);for(h in k){var z=f[h]||0,D=k[h];D instanceof Array?a[h]=t(D,C):("string"===typeof D&&(D=z+parseFloat(D,10)),"number"===typeof D&&(a[h]=z+(D-z)*C))}null!==y&&y.call(a,C);if(1==B)if(0<m){isFinite(m)&&m--;for(h in g)"string"===typeof k[h]&&(g[h]+=parseFloat(k[h],10)),e&&(B=g[h],g[h]=k[h],k[h]=B),f[h]=g[h];d=b+p}else{null!==A&&A.call(a);h=0;for(B=r.length;h<B;h++)r[h].start(b);return!1}return!0}};b.Easing={Linear:{None:function(a){return a}},Quadratic:{In:function(a){return a*a},Out:function(a){return a*(2-a)},InOut:function(a){return 1>(a*=2)?.5*a*a:-.5*(--a*(a-2)-1)}},Cubic:{In:function(a){return a*a*a},Out:function(a){return--a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a:.5*((a-=2)*a*a+2)}},Quartic:{In:function(a){return a*a*a*a},Out:function(a){return 1- --a*a*a*a},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2)}},Quintic:{In:function(a){return a*a*a*a*a},Out:function(a){return--a*a*a*a*a+1},InOut:function(a){return 1>(a*=2)?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2)}},Sinusoidal:{In:function(a){return 1-Math.cos(a*Math.PI/2)},Out:function(a){return Math.sin(a*Math.PI/2)},InOut:function(a){return.5*(1-Math.cos(Math.PI*a))}},Exponential:{In:function(a){return 0===a?0:Math.pow(1024,a-1)},Out:function(a){return 1===a?1:1-Math.pow(2,-10*a)},InOut:function(a){return 0===a?0:1===a?1:1>(a*=2)?.5*Math.pow(1024,a-1):.5*(-Math.pow(2,-10*(a-1))+2)}},Circular:{In:function(a){return 1-Math.sqrt(1-a*a)},Out:function(a){return Math.sqrt(1- --a*a)},InOut:function(a){return 1>(a*=2)?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1)}},Elastic:{In:function(a){var b,k=.1;if(0===a)return 0;if(1===a)return 1;!k||1>k?(k=1,b=.1):b=.4*Math.asin(1/k)/(2*Math.PI);return-(k*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4))},Out:function(a){var b,k=.1;if(0===a)return 0;if(1===a)return 1;!k||1>k?(k=1,b=.1):b=.4*Math.asin(1/k)/(2*Math.PI);return k*Math.pow(2,-10*a)*Math.sin(2*(a-b)*Math.PI/.4)+1},InOut:function(a){var b,k=.1;if(0===a)return 0;if(1===a)return 1;!k||1>k?(k=1,b=.1):b=.4*Math.asin(1/k)/(2*Math.PI);return 1>(a*=2)?-.5*k*Math.pow(2,10*--a)*Math.sin(2*(a-b)*Math.PI/.4):k*Math.pow(2,-10*--a)*Math.sin(2*(a-b)*Math.PI/.4)*.5+1}},Back:{In:function(a){return a*a*(2.70158*a-1.70158)},Out:function(a){return--a*a*(2.70158*a+1.70158)+1},InOut:function(a){return 1>(a*=2)?.5*a*a*(3.5949095*a-2.5949095):.5*((a-=2)*a*(3.5949095*a+2.5949095)+2)}},Bounce:{In:function(a){return 1-b.Easing.Bounce.Out(1-a)},Out:function(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},InOut:function(a){return.5>a?.5*b.Easing.Bounce.In(2*a):.5*b.Easing.Bounce.Out(2*a-1)+.5}}};b.Interpolation={Linear:function(a,f){var k=a.length-1,g=k*f,l=Math.floor(g),m=b.Interpolation.Utils.Linear;return 0>f?m(a[0],a[1],g):1<f?m(a[k],a[k-1],k-g):m(a[l],a[l+1>k?k:l+1],g-l)},Bezier:function(a,f){var k=0,g=a.length-1,l=Math.pow,m=b.Interpolation.Utils.Bernstein,e;for(e=0;e<=g;e++)k+=l(1-f,g-e)*l(f,e)*a[e]*m(g,e);return k},CatmullRom:function(a,f){var k=a.length-1,g=k*f,l=Math.floor(g),m=b.Interpolation.Utils.CatmullRom;return a[0]===a[k]?(0>f&&(l=Math.floor(g=k*(1+f))),m(a[(l-1+k)%k],a[l],a[(l+1)%k],a[(l+2)%k],g-l)):0>f?a[0]-(m(a[0],a[0],a[1],a[1],-g)-a[0]):1<f?a[k]-(m(a[k],a[k],a[k-1],a[k-1],g-k)-a[k]):m(a[l?l-1:0],a[l],a[k<l+1?k:l+1],a[k<l+2?k:l+2],g-l)},Utils:{Linear:function(a,b,k){return(b-a)*k+a},Bernstein:function(a,f){var k=b.Interpolation.Utils.Factorial;return k(a)/k(f)/k(a-f)},Factorial:function(){var a=[1];return function(b){var f=1,g;if(a[b])return a[b];for(g=b;1<g;g--)f*=g;return a[b]=f}}(),CatmullRom:function(a,b,k,g,l){a=.5*(k-a);g=.5*(g-b);var f=l*l;return(2*b-2*k+a+g)*l*f+(-3*b+3*k-2*a-g)*f+a*l+b}}};return b});F("Core/EasingFunction",["../ThirdParty/Tween","./freezeObject"],function(b,a){return a({LINEAR_NONE:b.Easing.Linear.None,QUADRACTIC_IN:b.Easing.Quadratic.In,QUADRACTIC_OUT:b.Easing.Quadratic.Out,QUADRACTIC_IN_OUT:b.Easing.Quadratic.InOut,CUBIC_IN:b.Easing.Cubic.In,CUBIC_OUT:b.Easing.Cubic.Out,CUBIC_IN_OUT:b.Easing.Cubic.InOut,QUARTIC_IN:b.Easing.Quartic.In,QUARTIC_OUT:b.Easing.Quartic.Out,QUARTIC_IN_OUT:b.Easing.Quartic.InOut,QUINTIC_IN:b.Easing.Quintic.In,QUINTIC_OUT:b.Easing.Quintic.Out,QUINTIC_IN_OUT:b.Easing.Quintic.InOut,SINUSOIDAL_IN:b.Easing.Sinusoidal.In,SINUSOIDAL_OUT:b.Easing.Sinusoidal.Out,SINUSOIDAL_IN_OUT:b.Easing.Sinusoidal.InOut,EXPONENTIAL_IN:b.Easing.Exponential.In,EXPONENTIAL_OUT:b.Easing.Exponential.Out,EXPONENTIAL_IN_OUT:b.Easing.Exponential.InOut,CIRCULAR_IN:b.Easing.Circular.In,CIRCULAR_OUT:b.Easing.Circular.Out,CIRCULAR_IN_OUT:b.Easing.Circular.InOut,ELASTIC_IN:b.Easing.Elastic.In,ELASTIC_OUT:b.Easing.Elastic.Out,ELASTIC_IN_OUT:b.Easing.Elastic.InOut,BACK_IN:b.Easing.Back.In,BACK_OUT:b.Easing.Back.Out,BACK_IN_OUT:b.Easing.Back.InOut,BOUNCE_IN:b.Easing.Bounce.In,BOUNCE_OUT:b.Easing.Bounce.Out,BOUNCE_IN_OUT:b.Easing.Bounce.InOut})});F("Core/EllipsoidGeometry","./arrayFill ./BoundingSphere ./Cartesian2 ./Cartesian3 ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PrimitiveType ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=l(a,l.EMPTY_OBJECT);var c=l(a.radii,C),b=Math.round(l(a.stackPartitions,64)),d=Math.round(l(a.slicePartitions,64)),f=l(a.vertexFormat,y.DEFAULT);if(3>d)throw new e("options.slicePartitions cannot be less than three.");if(3>b)throw new e("options.stackPartitions cannot be less than three.");if(m(a.offsetAttribute)&&a.offsetAttribute===t.TOP)throw new e("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=k.clone(c);this._stackPartitions=b;this._slicePartitions=d;this._vertexFormat=y.clone(f);this._offsetAttribute=a.offsetAttribute;this._workerName="createEllipsoidGeometry"}var z=new k,x=new k,D=new k,v=new k,B=new k,C=new k(1,1,1),I=Math.cos,H=Math.sin;A.packedLength=k.packedLength+y.packedLength+3;A.pack=function(a,c,b){if(!m(a))throw new e("value is required");if(!m(c))throw new e("array is required");b=l(b,0);k.pack(a._radii,c,b);b+=k.packedLength;y.pack(a._vertexFormat,c,b);b+=y.packedLength;c[b++]=a._stackPartitions;c[b++]=a._slicePartitions;c[b]=l(a._offsetAttribute,-1);return c};var J=new k,w=new y,G={radii:J,vertexFormat:w,stackPartitions:void 0,slicePartitions:void 0,offsetAttribute:void 0};A.unpack=function(a,c,b){if(!m(a))throw new e("array is required");c=l(c,0);var d=k.unpack(a,c,J);c+=k.packedLength;var f=y.unpack(a,c,w);c+=y.packedLength;var h=a[c++],g=a[c++];a=a[c];if(!m(b))return G.stackPartitions=h,G.slicePartitions=g,G.offsetAttribute=-1===a?void 0:a,new A(G);b._radii=k.clone(d,b._radii);b._vertexFormat=y.clone(f,b._vertexFormat);b._stackPartitions=h;b._slicePartitions=g;b._offsetAttribute=-1===a?void 0:a;return b};A.createGeometry=function(e){var l=e._radii;if(!(0>=l.x||0>=l.y||0>=l.z)){var w=h.fromCartesian3(l),C=e._vertexFormat,y=e._slicePartitions+1,E=e._stackPartitions+1,A=E*y,G=new Float64Array(3*A),L=r.createTypedArray(A,6*(y-1)*(E-2)),J=C.normal?new Float32Array(3*A):void 0,R=C.tangent?new Float32Array(3*A):void 0,Y=C.bitangent?new Float32Array(3*A):void 0,Q=C.st?new Float32Array(2*A):void 0,S=Array(y),ca=Array(y),T,da,V=0;for(T=0;T<y;T++)da=c.TWO_PI*T/(y-1),S[T]=I(da),ca[T]=H(da),G[V++]=0,G[V++]=0,G[V++]=l.z;for(T=1;T<E-1;T++){da=Math.PI*T/(E-1);var ba=H(da),X=l.x*ba,ba=l.y*ba,fa=l.z*I(da);for(da=0;da<y;da++)G[V++]=S[da]*X,G[V++]=ca[da]*ba,G[V++]=fa}for(T=0;T<y;T++)G[V++]=0,G[V++]=0,G[V++]=-l.z;l=new q;C.position&&(l.position=new d({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:G}));X=da=ca=S=0;if(C.st||C.normal||C.tangent||C.bitangent){for(T=0;T<A;T++)if(V=k.fromArray(G,3*T,z),ba=w.geodeticSurfaceNormal(V,x),C.st&&(fa=f.negate(ba,B),f.magnitude(fa)<c.EPSILON6&&(V=3*(T+y*Math.floor(.5*E)),V>G.length&&(V=3*(T-y*Math.floor(.5*E))),k.fromArray(G,V,fa),w.geodeticSurfaceNormal(fa,fa),f.negate(fa,fa)),Q[S++]=Math.atan2(fa.y,fa.x)/c.TWO_PI+.5,Q[S++]=Math.asin(ba.z)/Math.PI+.5),C.normal&&(J[ca++]=ba.x,J[ca++]=ba.y,J[ca++]=ba.z),C.tangent||C.bitangent)V=D,T<y||T>A-y-1?k.cross(k.UNIT_X,ba,V):k.cross(k.UNIT_Z,ba,V),k.normalize(V,V),C.tangent&&(R[da++]=V.x,R[da++]=V.y,R[da++]=V.z),C.bitangent&&(V=k.cross(ba,V,v),k.normalize(V,V),Y[X++]=V.x,Y[X++]=V.y,Y[X++]=V.z);C.st&&(l.st=new d({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:Q}));C.normal&&(l.normal=new d({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:J}));C.tangent&&(l.tangent=new d({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:R}));C.bitangent&&(l.bitangent=new d({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:Y}))}m(e._offsetAttribute)&&(T=new Uint8Array(G.length/3),b(T,e._offsetAttribute===t.NONE?0:1),l.applyOffset=new d({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:1,values:T}));for(da=V=0;da<y-1;da++)L[V++]=y+da,L[V++]=y+da+1,L[V++]=da+1;for(T=1;T<E-2;T++)for(C=T*y,A=(T+1)*y,da=0;da<y-1;da++)L[V++]=A+da,L[V++]=A+da+1,L[V++]=C+da+1,L[V++]=A+da,L[V++]=C+da+1,L[V++]=C+da;T=E-2;C=T*y;A=(T+1)*y;for(da=0;da<y-1;da++)L[V++]=A+da,L[V++]=C+da+1,L[V++]=C+da;return new p({attributes:l,indices:L,primitiveType:u.TRIANGLES,boundingSphere:a.fromEllipsoid(w),offsetAttribute:e._offsetAttribute})}};var E;A.getUnitEllipsoid=function(){m(E)||(E=A.createGeometry(new A({radii:new k(1,1,1),vertexFormat:y.POSITION_ONLY})));return E};return A});F("Core/EllipsoidOutlineGeometry","./arrayFill ./BoundingSphere ./Cartesian3 ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(a){a=g(a,g.EMPTY_OBJECT);var c=g(a.radii,y),b=Math.round(g(a.stackPartitions,10)),d=Math.round(g(a.slicePartitions,8)),e=Math.round(g(a.subdivisions,128));if(1>b)throw new m("options.stackPartitions cannot be less than 1");if(0>d)throw new m("options.slicePartitions cannot be less than 0");if(0>e)throw new m("options.subdivisions must be greater than or equal to zero.");if(l(a.offsetAttribute)&&a.offsetAttribute===q.TOP)throw new m("GeometryOffsetAttribute.TOP is not a supported options.offsetAttribute for this geometry.");this._radii=f.clone(c);this._stackPartitions=b;this._slicePartitions=d;this._subdivisions=e;this._offsetAttribute=a.offsetAttribute;this._workerName="createEllipsoidOutlineGeometry"}var y=new f(1,1,1),A=Math.cos,z=Math.sin;u.packedLength=f.packedLength+4;u.pack=function(a,c,b){if(!l(a))throw new m("value is required");if(!l(c))throw new m("array is required");b=g(b,0);f.pack(a._radii,c,b);b+=f.packedLength;c[b++]=a._stackPartitions;c[b++]=a._slicePartitions;c[b++]=a._subdivisions;c[b]=g(a._offsetAttribute,-1);return c};var x=new f,D={radii:x,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0,offsetAttribute:void 0};u.unpack=function(a,c,b){if(!l(a))throw new m("array is required");c=g(c,0);var d=f.unpack(a,c,x);c+=f.packedLength;var e=a[c++],h=a[c++],k=a[c++];a=a[c];if(!l(b))return D.stackPartitions=e,D.slicePartitions=h,D.subdivisions=k,D.offsetAttribute=-1===a?void 0:a,new u(D);b._radii=f.clone(d,b._radii);b._stackPartitions=e;b._slicePartitions=h;b._subdivisions=k;b._offsetAttribute=-1===a?void 0:a;return b};u.createGeometry=function(f){var g=f._radii;if(!(0>=g.x||0>=g.y||0>=g.z)){var m=e.fromCartesian3(g),v=f._stackPartitions,u=f._slicePartitions,y=f._subdivisions,w=y*(v+u-1),G=w-u+2,E=new Float64Array(3*G),w=t.createTypedArray(G,2*w),D,x,P,N,G=0,O=Array(y),Z=Array(y);for(D=0;D<y;D++)x=r.TWO_PI*D/y,O[D]=A(x),Z[D]=z(x);for(D=1;D<v;D++)for(x=Math.PI*D/v,P=A(x),N=z(x),x=0;x<y;x++)E[G++]=g.x*O[x]*N,E[G++]=g.y*Z[x]*N,E[G++]=g.z*P;O.length=u;Z.length=u;for(D=0;D<u;D++)x=r.TWO_PI*D/u,O[D]=A(x),Z[D]=z(x);E[G++]=0;E[G++]=0;E[G++]=g.z;for(D=1;D<y;D++)for(x=Math.PI*D/y,P=A(x),N=z(x),x=0;x<u;x++)E[G++]=g.x*O[x]*N,E[G++]=g.y*Z[x]*N,E[G++]=g.z*P;E[G++]=0;E[G++]=0;E[G++]=-g.z;for(D=G=0;D<v-1;++D){g=D*y;for(x=0;x<y-1;++x)w[G++]=g+x,w[G++]=g+x+1;w[G++]=g+y-1;w[G++]=g}v=y*(v-1);for(x=1;x<u+1;++x)w[G++]=v,w[G++]=v+x;for(D=0;D<y-2;++D){g=D*u+1+v;O=(D+1)*u+1+v;for(x=0;x<u-1;++x)w[G++]=O+x,w[G++]=g+x;w[G++]=O+u-1;w[G++]=g+u-1}y=E.length/3-1;for(x=y-1;x>y-u-1;--x)w[G++]=y,w[G++]=x;u=new d({position:new p({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:E})});l(f._offsetAttribute)&&(E=new Uint8Array(E.length/3),b(E,f._offsetAttribute===q.NONE?0:1),u.applyOffset=new p({componentDatatype:k.UNSIGNED_BYTE,componentsPerAttribute:1,values:E}));return new h({attributes:u,indices:w,primitiveType:c.LINES,boundingSphere:a.fromEllipsoid(m),offsetAttribute:f._offsetAttribute})}};return u});F("Core/EllipsoidTerrainProvider","../ThirdParty/when ./defaultValue ./defined ./defineProperties ./Ellipsoid ./Event ./GeographicTilingScheme ./HeightmapTerrainData ./TerrainProvider".split(" "),function(b,a,f,k,g,l,m,e,h){function p(d){d=a(d,{});this._tilingScheme=d.tilingScheme;f(this._tilingScheme)||(this._tilingScheme=new m({ellipsoid:a(d.ellipsoid,g.WGS84)}));this._levelZeroMaximumGeometricError=h.getEstimatedLevelZeroGeometricErrorForAHeightmap(this._tilingScheme.ellipsoid,64,this._tilingScheme.getNumberOfXTilesAtLevel(0));this._errorEvent=new l;this._readyPromise=b.resolve(!0)}k(p.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}});p.prototype.requestTileGeometry=function(a,f,h,g){return b.resolve(new e({buffer:new Uint8Array(256),width:16,height:16}))};p.prototype.getLevelMaximumGeometricError=function(a){return this._levelZeroMaximumGeometricError/(1<<a)};p.prototype.getTileDataAvailable=function(a,b,e){};p.prototype.loadTileDataAvailability=function(a,b,e){};return p});F("Core/EventHelper",["./defined","./DeveloperError"],function(b,a){function f(){this._removalFunctions=[]}f.prototype.add=function(f,g,l){if(!b(f))throw new a("event is required");var k=f.addEventListener(g,l);this._removalFunctions.push(k);var e=this;return function(){k();var a=e._removalFunctions;a.splice(a.indexOf(k),1)}};f.prototype.removeAll=function(){for(var a=this._removalFunctions,b=0,f=a.length;b<f;++b)a[b]();a.length=0};return f});F("Core/ExtrapolationType",["./freezeObject"],function(b){return b({NONE:0,HOLD:1,EXTRAPOLATE:2})});F("Core/OrthographicOffCenterFrustum","./Cartesian3 ./Cartesian4 ./CullingVolume ./defaultValue ./defined ./defineProperties ./DeveloperError ./Math ./Matrix4".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a){a=k(a,k.EMPTY_OBJECT);this.left=a.left;this._left=void 0;this.right=a.right;this._right=void 0;this.top=a.top;this._top=void 0;this.bottom=a.bottom;this._bottom=void 0;this._near=this.near=k(a.near,1);this._far=this.far=k(a.far,5E8);this._cullingVolume=new f;this._orthographicMatrix=new h}function d(a){if(!(g(a.right)&&g(a.left)&&g(a.top)&&g(a.bottom)&&g(a.near)&&g(a.far)))throw new m("right, left, top, bottom, near, or far parameters are not set.");if(a.top!==a._top||a.bottom!==a._bottom||a.left!==a._left||a.right!==a._right||a.near!==a._near||a.far!==a._far){if(a.left>a.right)throw new m("right must be greater than left.");if(a.bottom>a.top)throw new m("top must be greater than bottom.");if(0>=a.near||a.near>a.far)throw new m("near must be greater than zero and less than far.");a._left=a.left;a._right=a.right;a._top=a.top;a._bottom=a.bottom;a._near=a.near;a._far=a.far;a._orthographicMatrix=h.computeOrthographicOffCenter(a.left,a.right,a.bottom,a.top,a.near,a.far,a._orthographicMatrix)}}l(p.prototype,{projectionMatrix:{get:function(){d(this);return this._orthographicMatrix}}});var q=new b,t=new b,r=new b,c=new b;p.prototype.computeCullingVolume=function(d,e,f){if(!g(d))throw new m("position is required.");if(!g(e))throw new m("direction is required.");if(!g(f))throw new m("up is required.");var h=this._cullingVolume.planes,k=this.top,l=this.bottom,p=this.right,u=this.left,C=this.near,y=this.far,A=b.cross(e,f,q);b.normalize(A,A);b.multiplyByScalar(e,C,t);b.add(d,t,t);b.multiplyByScalar(A,u,r);b.add(t,r,r);u=h[0];g(u)||(u=h[0]=new a);u.x=A.x;u.y=A.y;u.z=A.z;u.w=-b.dot(A,r);b.multiplyByScalar(A,p,r);b.add(t,r,r);u=h[1];g(u)||(u=h[1]=new a);u.x=-A.x;u.y=-A.y;u.z=-A.z;u.w=-b.dot(b.negate(A,c),r);b.multiplyByScalar(f,l,r);b.add(t,r,r);u=h[2];g(u)||(u=h[2]=new a);u.x=f.x;u.y=f.y;u.z=f.z;u.w=-b.dot(f,r);b.multiplyByScalar(f,k,r);b.add(t,r,r);u=h[3];g(u)||(u=h[3]=new a);u.x=-f.x;u.y=-f.y;u.z=-f.z;u.w=-b.dot(b.negate(f,c),r);u=h[4];g(u)||(u=h[4]=new a);u.x=e.x;u.y=e.y;u.z=e.z;u.w=-b.dot(e,t);b.multiplyByScalar(e,y,r);b.add(d,r,r);u=h[5];g(u)||(u=h[5]=new a);u.x=-e.x;u.y=-e.y;u.z=-e.z;u.w=-b.dot(b.negate(e,c),r);return this._cullingVolume};p.prototype.getPixelDimensions=function(a,c,b,e){d(this);if(!g(a)||!g(c))throw new m("Both drawingBufferWidth and drawingBufferHeight are required.");if(0>=a)throw new m("drawingBufferWidth must be greater than zero.");if(0>=c)throw new m("drawingBufferHeight must be greater than zero.");if(!g(b))throw new m("distance is required.");if(!g(e))throw new m("A result object is required.");b=this.top-this.bottom;e.x=(this.right-this.left)/a;e.y=b/c;return e};p.prototype.clone=function(a){g(a)||(a=new p);a.left=this.left;a.right=this.right;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a._left=void 0;a._right=void 0;a._top=void 0;a._bottom=void 0;a._near=void 0;a._far=void 0;return a};p.prototype.equals=function(a){return g(a)&&a instanceof p&&this.right===a.right&&this.left===a.left&&this.top===a.top&&this.bottom===a.bottom&&this.near===a.near&&this.far===a.far};p.prototype.equalsEpsilon=function(a,c,b){return a===this||g(a)&&a instanceof p&&e.equalsEpsilon(this.right,a.right,c,b)&&e.equalsEpsilon(this.left,a.left,c,b)&&e.equalsEpsilon(this.top,a.top,c,b)&&e.equalsEpsilon(this.bottom,a.bottom,c,b)&&e.equalsEpsilon(this.near,a.near,c,b)&&e.equalsEpsilon(this.far,a.far,c,b)};return p});F("Core/OrthographicFrustum","./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./Math ./OrthographicOffCenterFrustum".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._offCenterFrustum=new m;this.width=b.width;this._width=void 0;this.aspectRatio=b.aspectRatio;this._aspectRatio=void 0;this._near=this.near=a(b.near,1);this._far=this.far=a(b.far,5E8)}function h(a){if(!(f(a.width)&&f(a.aspectRatio)&&f(a.near)&&f(a.far)))throw new g("width, aspectRatio, near, or far parameters are not set.");var b=a._offCenterFrustum;if(a.width!==a._width||a.aspectRatio!==a._aspectRatio||a.near!==a._near||a.far!==a._far){if(0>a.aspectRatio)throw new g("aspectRatio must be positive.");if(0>a.near||a.near>a.far)throw new g("near must be greater than zero and less than far.");a._aspectRatio=a.aspectRatio;a._width=a.width;a._near=a.near;a._far=a.far;var e=1/a.aspectRatio;b.right=.5*a.width;b.left=-b.right;b.top=e*b.right;b.bottom=-b.top;b.near=a.near;b.far=a.far}}e.packedLength=4;e.pack=function(e,d,f){b.typeOf.object("value",e);b.defined("array",d);f=a(f,0);d[f++]=e.width;d[f++]=e.aspectRatio;d[f++]=e.near;d[f]=e.far;return d};e.unpack=function(h,d,g){b.defined("array",h);d=a(d,0);f(g)||(g=new e);g.width=h[d++];g.aspectRatio=h[d++];g.near=h[d++];g.far=h[d];return g};k(e.prototype,{projectionMatrix:{get:function(){h(this);return this._offCenterFrustum.projectionMatrix}}});e.prototype.computeCullingVolume=function(a,b,e){h(this);return this._offCenterFrustum.computeCullingVolume(a,b,e)};e.prototype.getPixelDimensions=function(a,b,e,f){h(this);return this._offCenterFrustum.getPixelDimensions(a,b,e,f)};e.prototype.clone=function(a){f(a)||(a=new e);a.aspectRatio=this.aspectRatio;a.width=this.width;a.near=this.near;a.far=this.far;a._aspectRatio=void 0;a._width=void 0;a._near=void 0;a._far=void 0;this._offCenterFrustum.clone(a._offCenterFrustum);return a};e.prototype.equals=function(a){if(!(f(a)&&a instanceof e))return!1;h(this);h(a);return this.width===a.width&&this.aspectRatio===a.aspectRatio&&this._offCenterFrustum.equals(a._offCenterFrustum)};e.prototype.equalsEpsilon=function(a,b,g){if(!(f(a)&&a instanceof e))return!1;h(this);h(a);return l.equalsEpsilon(this.width,a.width,b,g)&&l.equalsEpsilon(this.aspectRatio,a.aspectRatio,b,g)&&this._offCenterFrustum.equalsEpsilon(a._offCenterFrustum,b,g)};return e});F("Core/PerspectiveOffCenterFrustum","./Cartesian3 ./Cartesian4 ./CullingVolume ./defaultValue ./defined ./defineProperties ./DeveloperError ./Math ./Matrix4".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a){a=k(a,k.EMPTY_OBJECT);this.left=a.left;this._left=void 0;this.right=a.right;this._right=void 0;this.top=a.top;this._top=void 0;this.bottom=a.bottom;this._bottom=void 0;this._near=this.near=k(a.near,1);this._far=this.far=k(a.far,5E8);this._cullingVolume=new f;this._perspectiveMatrix=new h;this._infinitePerspective=new h}function d(a){if(!(g(a.right)&&g(a.left)&&g(a.top)&&g(a.bottom)&&g(a.near)&&g(a.far)))throw new m("right, left, top, bottom, near, or far parameters are not set.");var c=a.top,b=a.bottom,d=a.right,e=a.left,f=a.near,k=a.far;if(c!==a._top||b!==a._bottom||e!==a._left||d!==a._right||f!==a._near||k!==a._far){if(0>=a.near||a.near>a.far)throw new m("near must be greater than zero and less than far.");a._left=e;a._right=d;a._top=c;a._bottom=b;a._near=f;a._far=k;a._perspectiveMatrix=h.computePerspectiveOffCenter(e,d,b,c,f,k,a._perspectiveMatrix);a._infinitePerspective=h.computeInfinitePerspectiveOffCenter(e,d,b,c,f,a._infinitePerspective)}}l(p.prototype,{projectionMatrix:{get:function(){d(this);return this._perspectiveMatrix}},infiniteProjectionMatrix:{get:function(){d(this);return this._infinitePerspective}}});var q=new b,t=new b,r=new b,c=new b;p.prototype.computeCullingVolume=function(d,e,f){if(!g(d))throw new m("position is required.");if(!g(e))throw new m("direction is required.");if(!g(f))throw new m("up is required.");var h=this._cullingVolume.planes,k=this.top,l=this.bottom,p=this.right,u=this.left,C=this.near,y=this.far,A=b.cross(e,f,q);b.multiplyByScalar(e,C,t);b.add(d,t,t);b.multiplyByScalar(e,y,r);b.add(d,r,r);b.multiplyByScalar(A,u,c);b.add(t,c,c);b.subtract(c,d,c);b.normalize(c,c);b.cross(c,f,c);b.normalize(c,c);u=h[0];g(u)||(u=h[0]=new a);u.x=c.x;u.y=c.y;u.z=c.z;u.w=-b.dot(c,d);b.multiplyByScalar(A,p,c);b.add(t,c,c);b.subtract(c,d,c);b.cross(f,c,c);b.normalize(c,c);u=h[1];g(u)||(u=h[1]=new a);u.x=c.x;u.y=c.y;u.z=c.z;u.w=-b.dot(c,d);b.multiplyByScalar(f,l,c);b.add(t,c,c);b.subtract(c,d,c);b.cross(A,c,c);b.normalize(c,c);u=h[2];g(u)||(u=h[2]=new a);u.x=c.x;u.y=c.y;u.z=c.z;u.w=-b.dot(c,d);b.multiplyByScalar(f,k,c);b.add(t,c,c);b.subtract(c,d,c);b.cross(c,A,c);b.normalize(c,c);u=h[3];g(u)||(u=h[3]=new a);u.x=c.x;u.y=c.y;u.z=c.z;u.w=-b.dot(c,d);u=h[4];g(u)||(u=h[4]=new a);u.x=e.x;u.y=e.y;u.z=e.z;u.w=-b.dot(e,t);b.negate(e,c);u=h[5];g(u)||(u=h[5]=new a);u.x=c.x;u.y=c.y;u.z=c.z;u.w=-b.dot(c,r);return this._cullingVolume};p.prototype.getPixelDimensions=function(a,c,b,e){d(this);if(!g(a)||!g(c))throw new m("Both drawingBufferWidth and drawingBufferHeight are required.");if(0>=a)throw new m("drawingBufferWidth must be greater than zero.");if(0>=c)throw new m("drawingBufferHeight must be greater than zero.");if(!g(b))throw new m("distance is required.");if(!g(e))throw new m("A result object is required.");var f=1/this.near,h=this.top*f;c=2*b*h/c;h=this.right*f;e.x=2*b*h/a;e.y=c;return e};p.prototype.clone=function(a){g(a)||(a=new p);a.right=this.right;a.left=this.left;a.top=this.top;a.bottom=this.bottom;a.near=this.near;a.far=this.far;a._left=void 0;a._right=void 0;a._top=void 0;a._bottom=void 0;a._near=void 0;a._far=void 0;return a};p.prototype.equals=function(a){return g(a)&&a instanceof p&&this.right===a.right&&this.left===a.left&&this.top===a.top&&this.bottom===a.bottom&&this.near===a.near&&this.far===a.far};p.prototype.equalsEpsilon=function(a,c,b){return a===this||g(a)&&a instanceof p&&e.equalsEpsilon(this.right,a.right,c,b)&&e.equalsEpsilon(this.left,a.left,c,b)&&e.equalsEpsilon(this.top,a.top,c,b)&&e.equalsEpsilon(this.bottom,a.bottom,c,b)&&e.equalsEpsilon(this.near,a.near,c,b)&&e.equalsEpsilon(this.far,a.far,c,b)};return p});F("Core/PerspectiveFrustum","./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./Math ./PerspectiveOffCenterFrustum".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._offCenterFrustum=new m;this.fov=b.fov;this._sseDenominator=this._fovy=this._fov=void 0;this.aspectRatio=b.aspectRatio;this._aspectRatio=void 0;this._near=this.near=a(b.near,1);this._far=this.far=a(b.far,5E8);this._xOffset=this.xOffset=a(b.xOffset,0);this._yOffset=this.yOffset=a(b.yOffset,0)}function h(a){if(!(f(a.fov)&&f(a.aspectRatio)&&f(a.near)&&f(a.far)))throw new g("fov, aspectRatio, near, or far parameters are not set.");var b=a._offCenterFrustum;if(a.fov!==a._fov||a.aspectRatio!==a._aspectRatio||a.near!==a._near||a.far!==a._far||a.xOffset!==a._xOffset||a.yOffset!==a._yOffset){if(0>a.fov||a.fov>=Math.PI)throw new g("fov must be in the range [0, PI).");if(0>a.aspectRatio)throw new g("aspectRatio must be positive.");if(0>a.near||a.near>a.far)throw new g("near must be greater than zero and less than far.");a._aspectRatio=a.aspectRatio;a._fov=a.fov;a._fovy=1>=a.aspectRatio?a.fov:2*Math.atan(Math.tan(.5*a.fov)/a.aspectRatio);a._near=a.near;a._far=a.far;a._sseDenominator=2*Math.tan(.5*a._fovy);a._xOffset=a.xOffset;a._yOffset=a.yOffset;b.top=a.near*Math.tan(.5*a._fovy);b.bottom=-b.top;b.right=a.aspectRatio*b.top;b.left=-b.right;b.near=a.near;b.far=a.far;b.right+=a.xOffset;b.left+=a.xOffset;b.top+=a.yOffset;b.bottom+=a.yOffset}}e.packedLength=6;e.pack=function(e,d,f){b.typeOf.object("value",e);b.defined("array",d);f=a(f,0);d[f++]=e.fov;d[f++]=e.aspectRatio;d[f++]=e.near;d[f++]=e.far;d[f++]=e.xOffset;d[f]=e.yOffset;return d};e.unpack=function(h,d,g){b.defined("array",h);d=a(d,0);f(g)||(g=new e);g.fov=h[d++];g.aspectRatio=h[d++];g.near=h[d++];g.far=h[d++];g.xOffset=h[d++];g.yOffset=h[d];return g};k(e.prototype,{projectionMatrix:{get:function(){h(this);return this._offCenterFrustum.projectionMatrix}},infiniteProjectionMatrix:{get:function(){h(this);return this._offCenterFrustum.infiniteProjectionMatrix}},fovy:{get:function(){h(this);return this._fovy}},sseDenominator:{get:function(){h(this);return this._sseDenominator}}});e.prototype.computeCullingVolume=function(a,b,e){h(this);return this._offCenterFrustum.computeCullingVolume(a,b,e)};e.prototype.getPixelDimensions=function(a,b,e,f){if(0>=a)console.info("createTextures:drawingBufferWidth needs greater than zero");else return h(this),this._offCenterFrustum.getPixelDimensions(a,b,e,f)};e.prototype.clone=function(a){f(a)||(a=new e);a.aspectRatio=this.aspectRatio;a.fov=this.fov;a.near=this.near;a.far=this.far;a._aspectRatio=void 0;a._fov=void 0;a._near=void 0;a._far=void 0;this._offCenterFrustum.clone(a._offCenterFrustum);return a};e.prototype.equals=function(a){if(!(f(a)&&a instanceof e))return!1;h(this);h(a);return this.fov===a.fov&&this.aspectRatio===a.aspectRatio&&this._offCenterFrustum.equals(a._offCenterFrustum)};e.prototype.equalsEpsilon=function(a,b,g){if(!(f(a)&&a instanceof e))return!1;h(this);h(a);return l.equalsEpsilon(this.fov,a.fov,b,g)&&l.equalsEpsilon(this.aspectRatio,a.aspectRatio,b,g)&&this._offCenterFrustum.equalsEpsilon(a._offCenterFrustum,b,g)};return e});F("Core/FrustumGeometry","./BoundingSphere ./Cartesian3 ./Cartesian4 ./Check ./ComponentDatatype ./defaultValue ./defined ./Geometry ./GeometryAttribute ./GeometryAttributes ./Matrix3 ./Matrix4 ./OrthographicFrustum ./PerspectiveFrustum ./PrimitiveType ./Quaternion ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(c){k.typeOf.object("options",c);k.typeOf.object("options.frustum",c.frustum);k.typeOf.object("options.origin",c.origin);k.typeOf.object("options.orientation",c.orientation);var b=c.frustum,d=c.orientation,e=c.origin,f=l(c.vertexFormat,y.DEFAULT);c=l(c._drawNearPlane,!0);var h,g;b instanceof r?(h=0,g=r.packedLength):b instanceof t&&(h=1,g=t.packedLength);this._frustumType=h;this._frustum=b.clone();this._origin=a.clone(e);this._orientation=u.clone(d);this._drawNearPlane=c;this._vertexFormat=f;this._workerName="createFrustumGeometry";this.packedLength=2+g+a.packedLength+u.packedLength+y.packedLength}function z(a,c,b,d,e,f,h,g){for(var k=a/3*2,l=0;4>l;++l)m(c)&&(c[a]=f.x,c[a+1]=f.y,c[a+2]=f.z),m(b)&&(b[a]=h.x,b[a+1]=h.y,b[a+2]=h.z),m(d)&&(d[a]=g.x,d[a+1]=g.y,d[a+2]=g.z),a+=3;e[k]=0;e[k+1]=0;e[k+2]=1;e[k+3]=0;e[k+4]=1;e[k+5]=1;e[k+6]=0;e[k+7]=1}A.pack=function(c,b,d){k.typeOf.object("value",c);k.defined("array",b);d=l(d,0);var e=c._frustumType,f=c._frustum;b[d++]=e;0===e?(r.pack(f,b,d),d+=r.packedLength):(t.pack(f,b,d),d+=t.packedLength);a.pack(c._origin,b,d);d+=a.packedLength;u.pack(c._orientation,b,d);d+=u.packedLength;y.pack(c._vertexFormat,b,d);d+=y.packedLength;b[d]=c._drawNearPlane?1:0;return b};var x=new r,D=new t,v=new u,B=new a,C=new y;A.unpack=function(c,b,d){k.defined("array",c);b=l(b,0);var e=c[b++],f;0===e?(f=r.unpack(c,b,x),b+=r.packedLength):(f=t.unpack(c,b,D),b+=t.packedLength);var h=a.unpack(c,b,B);b+=a.packedLength;var g=u.unpack(c,b,v);b+=u.packedLength;var p=y.unpack(c,b,C);b+=y.packedLength;c=1===c[b];if(!m(d))return new A({frustum:f,origin:h,orientation:g,vertexFormat:p,_drawNearPlane:c});d._frustum=f.clone(e===d._frustumType?d._frustum:void 0);d._frustumType=e;d._origin=a.clone(h,d._origin);d._orientation=u.clone(g,d._orientation);d._vertexFormat=y.clone(p,d._vertexFormat);d._drawNearPlane=c;return d};var I=new d,H=new q,J=new q,w=new a,G=new a,E=new a,L=new a,K=new a,P=new a,N=Array(3),O=Array(4);O[0]=new f(-1,-1,1,1);O[1]=new f(1,-1,1,1);O[2]=new f(1,1,1,1);O[3]=new f(-1,1,1,1);for(var Z=Array(4),aa=0;4>aa;++aa)Z[aa]=new f;A._computeNearFarPlanes=function(c,b,e,h,g,k,p,v){b=d.fromQuaternion(b,I);k=l(k,w);p=l(p,G);v=l(v,E);k=d.getColumn(b,0,k);p=d.getColumn(b,1,p);v=d.getColumn(b,2,v);a.normalize(k,k);a.normalize(p,p);a.normalize(v,v);a.negate(k,k);b=q.computeView(c,v,p,k,H);var r,u;0===e?(u=q.multiply(h.projectionMatrix,b,J),u=q.inverse(u,J)):r=q.inverseTransformation(b,J);m(u)?(N[0]=h.near,N[1]=h.far):(N[0]=0,N[1]=h.near,N[2]=h.far);for(e=0;2>e;++e)for(b=0;4>b;++b){p=f.clone(O[b],Z[b]);if(m(u))p=q.multiplyByVector(u,p,p),a.multiplyByScalar(p,1/p.w,p),a.subtract(p,c,p),a.normalize(p,p),k=a.dot(v,p),a.multiplyByScalar(p,N[e]/k,p),a.add(p,c,p);else{m(h._offCenterFrustum)&&(h=h._offCenterFrustum);k=N[e];var C=N[e+1];p.x=.5*(p.x*(h.right-h.left)+h.left+h.right);p.y=.5*(p.y*(h.top-h.bottom)+h.bottom+h.top);p.z=.5*(p.z*(k-C)-k-C);p.w=1;q.multiplyByVector(r,p,p)}g[12*e+3*b]=p.x;g[12*e+3*b+1]=p.y;g[12*e+3*b+2]=p.z}};A.createGeometry=function(d){var f=d._frustumType,k=d._frustum,l=d._origin,q=d._orientation,v=d._drawNearPlane,r=d._vertexFormat;d=v?6:5;var u=new Float64Array(72);A._computeNearFarPlanes(l,q,f,k,u);k=24;u[k]=u[12];u[k+1]=u[13];u[k+2]=u[14];u[k+3]=u[0];u[k+4]=u[1];u[k+5]=u[2];u[k+6]=u[9];u[k+7]=u[10];u[k+8]=u[11];u[k+9]=u[21];u[k+10]=u[22];u[k+11]=u[23];k+=12;u[k]=u[15];u[k+1]=u[16];u[k+2]=u[17];u[k+3]=u[3];u[k+4]=u[4];u[k+5]=u[5];u[k+6]=u[0];u[k+7]=u[1];u[k+8]=u[2];u[k+9]=u[12];u[k+10]=u[13];u[k+11]=u[14];k+=12;u[k]=u[3];u[k+1]=u[4];u[k+2]=u[5];u[k+3]=u[15];u[k+4]=u[16];u[k+5]=u[17];u[k+6]=u[18];u[k+7]=u[19];u[k+8]=u[20];u[k+9]=u[6];u[k+10]=u[7];u[k+11]=u[8];k+=12;u[k]=u[6];u[k+1]=u[7];u[k+2]=u[8];u[k+3]=u[18];u[k+4]=u[19];u[k+5]=u[20];u[k+6]=u[21];u[k+7]=u[22];u[k+8]=u[23];u[k+9]=u[9];u[k+10]=u[10];u[k+11]=u[11];v||(u=u.subarray(12));f=new p({position:new h({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:u})});if(m(r.normal)||m(r.tangent)||m(r.bitangent)||m(r.st)){var l=m(r.normal)?new Float32Array(12*d):void 0,q=m(r.tangent)?new Float32Array(12*d):void 0,C=m(r.bitangent)?new Float32Array(12*d):void 0,r=m(r.st)?new Float32Array(8*d):void 0,B=a.negate(w,L),t=a.negate(G,K),y=a.negate(E,P),k=0;v&&(z(k,l,q,C,r,y,w,G),k+=12);z(k,l,q,C,r,E,B,G);k+=12;z(k,l,q,C,r,B,y,G);k+=12;z(k,l,q,C,r,t,y,B);k+=12;z(k,l,q,C,r,w,E,G);z(k+12,l,q,C,r,G,E,B);m(l)&&(f.normal=new h({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:l}));m(q)&&(f.tangent=new h({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:q}));m(C)&&(f.bitangent=new h({componentDatatype:g.FLOAT,componentsPerAttribute:3,values:C}));m(r)&&(f.st=new h({componentDatatype:g.FLOAT,componentsPerAttribute:2,values:r}))}v=new Uint16Array(6*d);for(r=0;r<d;++r)k=6*r,l=4*r,v[k]=l,v[k+1]=l+1,v[k+2]=l+2,v[k+3]=l,v[k+4]=l+2,v[k+5]=l+3;return new e({attributes:f,indices:v,primitiveType:c.TRIANGLES,boundingSphere:b.fromVertices(u)})};return A});F("Core/FrustumOutlineGeometry","./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./defaultValue ./defined ./FrustumGeometry ./Geometry ./GeometryAttribute ./GeometryAttributes ./OrthographicFrustum ./PerspectiveFrustum ./PrimitiveType ./Quaternion".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(c){f.typeOf.object("options",c);f.typeOf.object("options.frustum",c.frustum);f.typeOf.object("options.origin",c.origin);f.typeOf.object("options.orientation",c.orientation);var b=c.frustum,e=c.orientation,h=c.origin;c=g(c._drawNearPlane,!0);var k,l;b instanceof q?(k=0,l=q.packedLength):b instanceof d&&(k=1,l=d.packedLength);this._frustumType=k;this._frustum=b.clone();this._origin=a.clone(h);this._orientation=r.clone(e);this._drawNearPlane=c;this._workerName="createFrustumOutlineGeometry";this.packedLength=2+l+a.packedLength+r.packedLength}c.pack=function(c,b,e){f.typeOf.object("value",c);f.defined("array",b);e=g(e,0);var h=c._frustumType,k=c._frustum;b[e++]=h;0===h?(q.pack(k,b,e),e+=q.packedLength):(d.pack(k,b,e),e+=d.packedLength);a.pack(c._origin,b,e);e+=a.packedLength;r.pack(c._orientation,b,e);e+=r.packedLength;b[e]=c._drawNearPlane?1:0;return b};var u=new q,y=new d,A=new r,z=new a;c.unpack=function(b,e,h){f.defined("array",b);e=g(e,0);var k=b[e++],m;0===k?(m=q.unpack(b,e,u),e+=q.packedLength):(m=d.unpack(b,e,y),e+=d.packedLength);var p=a.unpack(b,e,z);e+=a.packedLength;var v=r.unpack(b,e,A);e+=r.packedLength;b=1===b[e];if(!l(h))return new c({frustum:m,origin:p,orientation:v,_drawNearPlane:b});h._frustum=m.clone(k===h._frustumType?h._frustum:void 0);h._frustumType=k;h._origin=a.clone(p,h._origin);h._orientation=r.clone(v,h._orientation);h._drawNearPlane=b;return h};c.createGeometry=function(a){var c=a._frustumType,d=a._frustum,f=a._origin,g=a._orientation;a=a._drawNearPlane;var l=new Float64Array(24);m._computeNearFarPlanes(f,g,c,d,l);for(var c=new p({position:new h({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:l})}),g=a?2:1,q=new Uint16Array(8*(g+1)),r=a?0:1;2>r;++r)d=a?8*r:0,f=4*r,q[d]=f,q[d+1]=f+1,q[d+2]=f+1,q[d+3]=f+2,q[d+4]=f+2,q[d+5]=f+3,q[d+6]=f+3,q[d+7]=f;for(r=0;2>r;++r)d=8*(g+r),f=4*r,q[d]=f,q[d+1]=f+4,q[d+2]=f+1,q[d+3]=f+5,q[d+4]=f+2,q[d+5]=f+6,q[d+6]=f+3,q[d+7]=f+7;return new e({attributes:c,indices:q,primitiveType:t.LINES,boundingSphere:b.fromVertices(l)})};return c});F("Core/GeocoderService",["./DeveloperError"],function(b){function a(){}a.prototype.geocode=b.throwInstantiationError;return a});F("Core/GeocodeType",["../Core/freezeObject"],function(b){return b({SEARCH:0,AUTOCOMPLETE:1})});F("Core/GeometryInstanceAttribute",["./defaultValue","./defined","./DeveloperError"],function(b,a,f){return function(k){k=b(k,b.EMPTY_OBJECT);if(!a(k.componentDatatype))throw new f("options.componentDatatype is required.");if(!a(k.componentsPerAttribute))throw new f("options.componentsPerAttribute is required.");if(1>k.componentsPerAttribute||4<k.componentsPerAttribute)throw new f("options.componentsPerAttribute must be between 1 and 4.");if(!a(k.value))throw new f("options.value is required.");this.componentDatatype=k.componentDatatype;this.componentsPerAttribute=k.componentsPerAttribute;this.normalize=b(k.normalize,!1);this.value=k.value}});F("Core/getFilenameFromUri",["../ThirdParty/Uri","./defined","./DeveloperError"],function(b,a,f){return function(k){if(!a(k))throw new f("uri is required.");k=new b(k);k.normalize();k=k.path;var g=k.lastIndexOf("/");-1!==g&&(k=k.substr(g+1));return k}});F("Core/getImagePixels",["./defined"],function(b){var a={};return function(f,k,g){b(k)||(k=f.width);b(g)||(g=f.height);var l=a[k];b(l)||(l={},a[k]=l);var m=l[g];b(m)||(m=document.createElement("canvas"),m.width=k,m.height=g,m=m.getContext("2d"),m.globalCompositeOperation="copy",l[g]=m);m.drawImage(f,0,0,k,g);return m.getImageData(0,0,k,g).data}});F("Core/getMagic",["./defaultValue","./getStringFromTypedArray"],function(b,a){return function(f,k){k=b(k,0);return a(f,k,Math.min(4,f.length))}});(function(b,a){(function(a,k,g){function f(b){var e=k[b];e||a[b][0].call(e=k[b]={exports:{}},f,e,e.exports);return e.exports}var m=b.protobuf=f(g[0]);"function"===typeof F&&F.amd&&F("ThirdParty/protobuf-minimal",[],function(){m.configure();return m});"object"===typeof module&&module&&module.exports&&(module.exports=m)})({1:[function(a,b,g){b.exports=function(a,b){for(var e=[],f=2;f<arguments.length;)e.push(arguments[f++]);var g=!0;return new Promise(function(d,f){e.push(function(a){if(g)if(g=!1,a)f(a);else{for(var b=[],c=1;c<arguments.length;)b.push(arguments[c++]);d.apply(null,b)}});try{a.apply(b||this,e)}catch(t){g&&(g=!1,f(t))}})}},{}],2:[function(b,k,g){g.length=function(a){var b=a.length;if(!b)return 0;for(var e=0;1<--b%4&&"\x3d"===a.charAt(b);)++e;return Math.ceil(3*a.length)/4-e};var f=Array(64),m=Array(123);for(b=0;64>b;)m[f[b]=26>b?b+65:52>b?b+71:62>b?b-4:b-59|43]=b++;g.encode=function(a,b,g){for(var d=[],e=0,h=0,k;b<g;){var c=a[b++];switch(h){case 0:d[e++]=f[c>>2];k=(c&3)<<4;h=1;break;case 1:d[e++]=f[k|c>>4];k=(c&15)<<2;h=2;break;case 2:d[e++]=f[k|c>>6],d[e++]=f[c&63],h=0}}h&&(d[e++]=f[k],d[e]=61,1===h&&(d[e+1]=61));return String.fromCharCode.apply(String,d)};g.decode=function(b,f,g){for(var d=g,e=0,h,k=0;k<b.length;){var c=b.charCodeAt(k++);if(61===c&&1<e)break;if((c=
m[c])===a)throw Error("invalid encoding");switch(e){case 0:h=c;e=1;break;case 1:f[g++]=h<<2|(c&48)>>4;h=c;e=2;break;case 2:f[g++]=(h&15)<<4|(c&60)>>2;h=c;e=3;break;case 3:f[g++]=(h&3)<<6|c,e=0}}if(1===e)throw Error("invalid encoding");return g-d};g.test=function(a){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(a)}},{}],3:[function(b,k,g){function f(){this._listeners={}}k.exports=f;f.prototype.on=function(a,b,f){(this._listeners[a]||(this._listeners[a]=[])).push({fn:b,ctx:f||this});return this};f.prototype.off=function(b,e){if(b===a)this._listeners={};else if(e===a)this._listeners[b]=[];else for(var f=this._listeners[b],g=0;g<f.length;)f[g].fn===e?f.splice(g,1):++g;return this};f.prototype.emit=function(a){var b=this._listeners[a];if(b){for(var f=[],g=1;g<arguments.length;)f.push(arguments[g++]);for(g=0;g<b.length;)b[g].fn.apply(b[g++].ctx,f)}return this}},{}],4:[function(a,b,g){b.exports=function(a){try{var b=eval("quire".replace(/^/,"re"))(a);if(b&&(b.length||Object.keys(b).length))return b}catch(e){}return null}},{}],5:[function(a,b,g){b.exports=function(a,b,e){var f=e||8192,g=f>>>1,d=null,k=f;return function(e){if(1>e||e>g)return a(e);k+e>f&&(d=a(f),k=0);e=b.call(d,k,k+=e);k&7&&(k=(k|7)+1);return e}}},{}],6:[function(a,b,g){g.length=function(a){for(var b=0,e,f=0;f<a.length;++f)e=a.charCodeAt(f),128>e?b+=1:2048>e?b+=2:55296===(e&64512)&&56320===(a.charCodeAt(f+1)&64512)?(++f,b+=4):b+=3;return b};g.read=function(a,b,e){if(1>e-b)return"";for(var f=null,g=[],d=0,k;b<e;)k=a[b++],128>k?g[d++]=k:191<k&&224>k?g[d++]=(k&31)<<6|a[b++]&63:239<k&&365>k?(k=((k&7)<<18|(a[b++]&63)<<12|(a[b++]&63)<<6|a[b++]&63)-65536,g[d++]=55296+(k>>10),g[d++]=56320+(k&1023)):g[d++]=(k&15)<<12|(a[b++]&63)<<6|a[b++]&63,8191<d&&((f||(f=[])).push(String.fromCharCode.apply(String,g)),d=0);return f?(d&&f.push(String.fromCharCode.apply(String,g.slice(0,d))),f.join("")):String.fromCharCode.apply(String,g.slice(0,d))};g.write=function(a,b,e){for(var f=e,g,d,k=0;k<a.length;++k)g=a.charCodeAt(k),128>g?b[e++]=g:(2048>g?b[e++]=g>>6|192:(55296===(g&64512)&&56320===((d=a.charCodeAt(k+1))&64512)?(g=65536+((g&1023)<<10)+(d&1023),++k,b[e++]=g>>18|240,b[e++]=g>>12&63|128):b[e++]=g>>12|224,b[e++]=g>>6&63|128),b[e++]=g&63|128);return e-f}},{}],7:[function(a,b,g){function f(){k.Reader._configure(k.BufferReader);k.util._configure()}var k=g;k.build="minimal";k.roots={};k.Writer=a(14);k.BufferWriter=a(15);k.Reader=a(8);k.BufferReader=a(9);k.util=a(13);k.rpc=a(10);k.configure=f;k.Writer._configure(k.BufferWriter);f()},{10:10,13:13,14:14,15:15,8:8,9:9}],8:[function(a,b,g){function f(a,c){return RangeError("index out of range: "+a.pos+" + "+(c||1)+" \x3e "+a.len)}function k(a){this.buf=a;this.pos=0;this.len=a.length}function e(){var a=new t(0,0),c=0;if(4<this.len-this.pos){for(;4>c;++c)if(a.lo=(a.lo|(this.buf[this.pos]&127)<<7*c)>>>0,128>this.buf[this.pos++])return a;a.lo=(a.lo|(this.buf[this.pos]&127)<<28)>>>0;a.hi=(a.hi|(this.buf[this.pos]&127)>>4)>>>0;if(128>this.buf[this.pos++])return a;c=0}else{for(;3>c;++c){if(this.pos>=this.len)throw f(this);a.lo=(a.lo|(this.buf[this.pos]&127)<<7*c)>>>0;if(128>this.buf[this.pos++])return a}a.lo=(a.lo|(this.buf[this.pos++]&127)<<7*c)>>>0;return a}if(4<this.len-this.pos)for(;5>c;++c){if(a.hi=(a.hi|(this.buf[this.pos]&127)<<7*c+3)>>>0,128>this.buf[this.pos++])return a}else for(;5>c;++c){if(this.pos>=this.len)throw f(this);a.hi=(a.hi|(this.buf[this.pos]&127)<<7*c+3)>>>0;if(128>this.buf[this.pos++])return a}throw Error("invalid varint encoding");}function h(a,c){return(a[c-4]|a[c-3]<<8|a[c-2]<<16|a[c-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw f(this,8);return new t(h(this.buf,this.pos+=4),h(this.buf,this.pos+=4))}b.exports=k;var d=a(13),q,t=d.LongBits,r=d.utf8,c="undefined"!==typeof Uint8Array?function(a){if(a instanceof Uint8Array||Array.isArray(a))return new k(a);throw Error("illegal buffer");}:function(a){if(Array.isArray(a))return new k(a);throw Error("illegal buffer");};k.create=d.Buffer?function(a){return(k.create=function(a){return d.Buffer.isBuffer(a)?new q(a):c(a)})(a)}:c;k.prototype._slice=d.Array.prototype.subarray||d.Array.prototype.slice;k.prototype.uint32=function(){var a=4294967295;return function(){a=(this.buf[this.pos]&127)>>>0;if(128>this.buf[this.pos++])return a;a=(a|(this.buf[this.pos]&127)<<7)>>>0;if(128>this.buf[this.pos++])return a;a=(a|(this.buf[this.pos]&127)<<14)>>>0;if(128>this.buf[this.pos++])return a;a=(a|(this.buf[this.pos]&127)<<21)>>>0;if(128>this.buf[this.pos++])return a;a=(a|(this.buf[this.pos]&15)<<28)>>>0;if(128>this.buf[this.pos++])return a;if((this.pos+=5)>this.len)throw this.pos=this.len,f(this,10);return a}}();k.prototype.int32=function(){return this.uint32()|0};k.prototype.sint32=function(){var a=this.uint32();return a>>>1^-(a&1)|0};k.prototype.bool=function(){return 0!==this.uint32()};k.prototype.fixed32=function(){if(this.pos+4>this.len)throw f(this,4);return h(this.buf,this.pos+=4)};k.prototype.sfixed32=function(){if(this.pos+4>this.len)throw f(this,4);return h(this.buf,this.pos+=4)|0};var u="undefined"!==typeof Float32Array?function(){var a=new Float32Array(1),c=new Uint8Array(a.buffer);a[0]=-0;return c[3]?function(b,d){c[0]=b[d];c[1]=b[d+1];c[2]=b[d+2];c[3]=b[d+3];return a[0]}:function(b,d){c[0]=b[d+3];c[1]=b[d+2];c[2]=b[d+1];c[3]=b[d];return a[0]}}():function(a,c){var b=h(a,c+4),d=2*(b>>31)+1,e=b>>>23&255,b=b&8388607;return 255===e?b?NaN:Infinity*d:0===e?1.401298464324817E-45*d*b:d*Math.pow(2,e-150)*(b+8388608)};k.prototype["float"]=function(){if(this.pos+4>this.len)throw f(this,4);var a=u(this.buf,this.pos);this.pos+=4;return a};var y="undefined"!==typeof Float64Array?function(){var a=new Float64Array(1),c=new Uint8Array(a.buffer);a[0]=-0;return c[7]?function(b,d){c[0]=b[d];c[1]=b[d+1];c[2]=b[d+2];c[3]=b[d+3];c[4]=b[d+4];c[5]=b[d+5];c[6]=b[d+6];c[7]=b[d+7];return a[0]}:function(b,d){c[0]=b[d+7];c[1]=b[d+6];c[2]=b[d+5];c[3]=b[d+4];c[4]=b[d+3];c[5]=b[d+2];c[6]=b[d+1];c[7]=b[d];return a[0]}}():function(a,c){var b=h(a,c+4),d=h(a,c+8),e=2*(d>>31)+1,f=d>>>20&2047,b=4294967296*(d&1048575)+b;return 2047===f?b?NaN:Infinity*e:0===f?4.9E-324*e*b:e*Math.pow(2,f-1075)*(b+4503599627370496)};k.prototype["double"]=function(){if(this.pos+8>this.len)throw f(this,4);var a=y(this.buf,this.pos);this.pos+=8;return a};k.prototype.bytes=function(){var a=this.uint32(),c=this.pos,b=this.pos+a;if(b>this.len)throw f(this,a);this.pos+=a;return c===b?new this.buf.constructor(0):this._slice.call(this.buf,c,b)};k.prototype.string=function(){var a=this.bytes();return r.read(a,0,a.length)};k.prototype.skip=function(a){if("number"===typeof a){if(this.pos+a>this.len)throw f(this,a);this.pos+=a}else{do if(this.pos>=this.len)throw f(this);while(this.buf[this.pos++]&128)}return this};k.prototype.skipType=function(a){switch(a){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:do{if(4===(a=this.uint32()&7))break;this.skipType(a)}while(1);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+a+" at offset "+this.pos);}return this};k._configure=function(a){q=a;var c=d.Long?"toLong":"toNumber";d.merge(k.prototype,{int64:function(){return e.call(this)[c](!1)},uint64:function(){return e.call(this)[c](!0)},sint64:function(){return e.call(this).zzDecode()[c](!1)},fixed64:function(){return p.call(this)[c](!0)},sfixed64:function(){return p.call(this)[c](!1)}})}},{13:13}],9:[function(a,b,g){function f(a){k.call(this,a)}b.exports=f;var k=a(8);(f.prototype=Object.create(k.prototype)).constructor=f;a=a(13);a.Buffer&&(f.prototype._slice=a.Buffer.prototype.slice);f.prototype.string=function(){var a=this.uint32();return this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+a,this.len))}},{13:13,8:8}],10:[function(a,b,g){g.Service=a(11)},{11:11}],11:[function(b,k,g){function f(a,b,f){if("function"!==typeof a)throw TypeError("rpcImpl must be a function");m.EventEmitter.call(this);this.rpcImpl=a;this.requestDelimited=!!b;this.responseDelimited=!!f}k.exports=f;var m=b(13);(f.prototype=Object.create(m.EventEmitter.prototype)).constructor=f;f.prototype.rpcCall=function h(b,d,f,g,k){if(!g)throw TypeError("request must be specified");var c=this;if(!k)return m.asPromise(h,c,b,d,f,g);if(!c.rpcImpl)return setTimeout(function(){k(Error("already ended"))},0),a;try{return c.rpcImpl(b,d[c.requestDelimited?"encodeDelimited":"encode"](g).finish(),function(d,h){if(d)return c.emit("error",d,b),k(d);if(null===h)return c.end(!0),a;if(!(h instanceof f))try{h=f[c.responseDelimited?"decodeDelimited":"decode"](h)}catch(A){return c.emit("error",A,b),k(A)}c.emit("data",h,b);return k(null,h)})}catch(u){return c.emit("error",u,b),setTimeout(function(){k(u)},0),a}};f.prototype.end=function(a){this.rpcImpl&&(a||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off());return this}},{13:13}],12:[function(a,b,g){function f(a,b){this.lo=a>>>0;this.hi=b>>>0}b.exports=f;var k=a(13),e=f.zero=new f(0,0);e.toNumber=function(){return 0};e.zzEncode=e.zzDecode=function(){return this};e.length=function(){return 1};var h=f.zeroHash="\x00\x00\x00\x00\x00\x00\x00\x00";f.fromNumber=function(a){if(0===a)return e;var b=0>a;b&&(a=-a);var d=a>>>0;a=(a-d)/4294967296>>>0;b&&(a=~a>>>0,d=~d>>>0,4294967295<++d&&(d=0,4294967295<++a&&(a=0)));return new f(d,a)};f.from=function(a){if("number"===typeof a)return f.fromNumber(a);if(k.isString(a))if(k.Long)a=k.Long.fromString(a);else return f.fromNumber(parseInt(a,10));return a.low||a.high?new f(a.low>>>0,a.high>>>0):e};f.prototype.toNumber=function(a){if(!a&&this.hi>>>31){a=~this.lo+1>>>0;var b=~this.hi>>>0;a||(b=b+1>>>0);return-(a+4294967296*b)}return this.lo+4294967296*this.hi};f.prototype.toLong=function(a){return k.Long?new k.Long(this.lo|0,this.hi|0,!!a):{low:this.lo|0,high:this.hi|0,unsigned:!!a}};var p=String.prototype.charCodeAt;f.fromHash=function(a){return a===h?e:new f((p.call(a,0)|p.call(a,1)<<8|p.call(a,2)<<16|p.call(a,3)<<24)>>>0,(p.call(a,4)|p.call(a,5)<<8|p.call(a,6)<<16|p.call(a,7)<<24)>>>0)};f.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};f.prototype.zzEncode=function(){var a=this.hi>>31;this.hi=((this.hi<<1|this.lo>>>31)^a)>>>0;this.lo=(this.lo<<1^a)>>>0;return this};f.prototype.zzDecode=function(){var a=-(this.lo&1);this.lo=((this.lo>>>1|this.hi<<31)^a)>>>0;this.hi=(this.hi>>>1^a)>>>0;return this};f.prototype.length=function(){var a=this.lo,b=(this.lo>>>28|this.hi<<4)>>>0,e=this.hi>>>24;return 0===e?0===b?16384>a?128>a?1:2:2097152>a?3:4:16384>b?128>b?5:6:2097152>b?7:8:128>e?9:10}},{13:13}],13:[function(f,k,g){function l(b,f,g){for(var d=Object.keys(f),e=0;e<d.length;++e)b[d[e]]!==a&&g||(b[d[e]]=f[d[e]]);return b}function m(a){function b(a,d){if(!(this instanceof b))return new b(a,d);Object.defineProperty(this,"message",{get:function(){return a}});Error.captureStackTrace?Error.captureStackTrace(this,b):Object.defineProperty(this,"stack",{value:Error().stack||""});d&&l(this,d)}(b.prototype=Object.create(Error.prototype)).constructor=b;Object.defineProperty(b.prototype,"name",{get:function(){return a}});b.prototype.toString=function(){return this.name+": "+this.message};return b}g.asPromise=f(1);g.base64=f(2);g.EventEmitter=f(3);g.inquire=f(4);g.utf8=f(6);g.pool=f(5);g.LongBits=f(12);g.emptyArray=Object.freeze?Object.freeze([]):[];g.emptyObject=Object.freeze?Object.freeze({}):{};g.isNode=!!(b.process&&b.process.versions&&b.process.versions.node);g.isInteger=Number.isInteger||function(a){return"number"===typeof a&&isFinite(a)&&Math.floor(a)===a};g.isString=function(a){return"string"===typeof a||a instanceof String};g.isObject=function(a){return a&&"object"===typeof a};g.Buffer=function(){try{var a=g.inquire("buffer").Buffer;return a.prototype.utf8Write?a:null}catch(h){return null}}();g._Buffer_from=null;g._Buffer_allocUnsafe=null;g.newBuffer=function(a){return"number"===typeof a?g.Buffer?g._Buffer_allocUnsafe(a):new g.Array(a):g.Buffer?g._Buffer_from(a):"undefined"===typeof Uint8Array?a:new Uint8Array(a)};g.Array="undefined"!==typeof Uint8Array?Uint8Array:Array;g.Long=b.dcodeIO&&b.dcodeIO.Long||g.inquire("long");g.key2Re=/^true|false|0|1$/;g.key32Re=/^-?(?:0|[1-9][0-9]*)$/;g.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;g.longToHash=function(a){return a?g.LongBits.from(a).toHash():g.LongBits.zeroHash};g.longFromHash=function(a,b){var e=g.LongBits.fromHash(a);return g.Long?g.Long.fromBits(e.lo,e.hi,b):e.toNumber(!!b)};g.merge=l;g.lcFirst=function(a){return a.charAt(0).toLowerCase()+a.substring(1)};g.newError=m;g.ProtocolError=m("ProtocolError");g.oneOfGetter=function(b){for(var e={},f=0;f<b.length;++f)e[b[f]]=1;return function(){for(var b=Object.keys(this),f=b.length-1;-1<f;--f)if(1===e[b[f]]&&this[b[f]]!==a&&null!==this[b[f]])return b[f]}};g.oneOfSetter=function(a){return function(b){for(var e=0;e<a.length;++e)a[e]!==b&&delete this[a[e]]}};g.lazyResolve=function(a,b){for(var e=0;e<b.length;++e)for(var d=Object.keys(b[e]),f=0;f<d.length;++f){for(var h=b[e][d[f]].split("."),g=a;h.length;)g=g[h.shift()];b[e][d[f]]=g}};g.toJSONOptions={longs:String,enums:String,bytes:String};g._configure=function(){var a=g.Buffer;a?(g._Buffer_from=a.from!==Uint8Array.from&&a.from||function(b,e){return new a(b,e)},g._Buffer_allocUnsafe=a.allocUnsafe||function(b){return new a(b)}):g._Buffer_from=g._Buffer_allocUnsafe=null}},{1:1,12:12,2:2,3:3,4:4,5:5,6:6}],14:[function(b,k,g){function f(c,b,d){this.fn=c;this.len=b;this.next=a;this.val=d}function m(){}function e(a){this.head=a.head;this.tail=a.tail;this.len=a.len;this.next=a.states}function h(){this.len=0;this.tail=this.head=new f(m,0,0);this.states=null}function p(a,c,b){c[b]=a&255}function d(c,b){this.len=c;this.next=a;this.val=b}function q(a,c,b){for(;a.hi;)c[b++]=a.lo&127|128,a.lo=(a.lo>>>7|a.hi<<25)>>>0,a.hi>>>=7;for(;127<a.lo;)c[b++]=a.lo&127|128,a.lo>>>=7;c[b++]=a.lo}function t(a,c,b){c[b++]=a&255;c[b++]=a>>>8&255;c[b++]=a>>>16&255;c[b]=a>>>24}k.exports=h;var r=b(13),c,u=r.LongBits,y=r.base64,A=r.utf8;h.create=r.Buffer?function(){return(h.create=function(){return new c})()}:function(){return new h};h.alloc=function(a){return new r.Array(a)};r.Array!==Array&&(h.alloc=r.pool(h.alloc,r.Array.prototype.subarray));h.prototype.push=function(a,c,b){this.tail=this.tail.next=new f(a,c,b);this.len+=c;return this};d.prototype=Object.create(f.prototype);d.prototype.fn=function(a,c,b){for(;127<a;)c[b++]=a&127|128,a>>>=7;c[b]=a};h.prototype.uint32=function(a){this.len+=(this.tail=this.tail.next=new d(128>(a>>>=0)?1:16384>a?2:2097152>a?3:268435456>a?4:5,a)).len;return this};h.prototype.int32=function(a){return 0>a?this.push(q,10,u.fromNumber(a)):this.uint32(a)};h.prototype.sint32=function(a){return this.uint32((a<<1^a>>31)>>>0)};h.prototype.uint64=function(a){a=u.from(a);return this.push(q,a.length(),a)};h.prototype.int64=h.prototype.uint64;h.prototype.sint64=function(a){a=u.from(a).zzEncode();return this.push(q,a.length(),a)};h.prototype.bool=function(a){return this.push(p,1,a?1:0)};h.prototype.fixed32=function(a){return this.push(t,4,a>>>0)};h.prototype.sfixed32=h.prototype.fixed32;h.prototype.fixed64=function(a){a=u.from(a);return this.push(t,4,a.lo).push(t,4,a.hi)};h.prototype.sfixed64=h.prototype.fixed64;var z="undefined"!==typeof Float32Array?function(){var a=new Float32Array(1),c=new Uint8Array(a.buffer);a[0]=-0;return c[3]?function(b,d,e){a[0]=b;d[e++]=c[0];d[e++]=c[1];d[e++]=c[2];d[e]=c[3]}:function(b,d,e){a[0]=b;d[e++]=c[3];d[e++]=c[2];d[e++]=c[1];d[e]=c[0]}}():function(a,c,b){var d=0>a?1:0;d&&(a=-a);if(0===a)t(0<1/a?0:2147483648,c,b);else if(isNaN(a))t(2147483647,c,b);else if(3.4028234663852886E38<a)t((d<<31|2139095040)>>>0,c,b);else if(1.1754943508222875E-38>a)t((d<<31|Math.round(a/1.401298464324817E-45))>>>0,c,b);else{var e=Math.floor(Math.log(a)/Math.LN2);t((d<<31|e+127<<23|Math.round(a*Math.pow(2,-e)*8388608)&8388607)>>>0,c,b)}};h.prototype["float"]=function(a){return this.push(z,4,a)};var x="undefined"!==typeof Float64Array?function(){var a=new Float64Array(1),c=new Uint8Array(a.buffer);a[0]=-0;return c[7]?function(b,d,e){a[0]=b;d[e++]=c[0];d[e++]=c[1];d[e++]=c[2];d[e++]=c[3];d[e++]=c[4];d[e++]=c[5];d[e++]=c[6];d[e]=c[7]}:function(b,d,e){a[0]=b;d[e++]=c[7];d[e++]=c[6];d[e++]=c[5];d[e++]=c[4];d[e++]=c[3];d[e++]=c[2];d[e++]=c[1];d[e]=c[0]}}():function(a,c,b){var d=0>a?1:0;d&&(a=-a);if(0===a)t(0,c,b),t(0<1/a?0:2147483648,c,b+4);else if(isNaN(a))t(4294967295,c,b),t(2147483647,c,b+4);else if(1.7976931348623157E308<a)t(0,c,b),t((d<<31|2146435072)>>>0,c,b+4);else if(2.2250738585072014E-308>a)a/=4.9E-324,t(a>>>0,c,b),t((d<<31|a/4294967296)>>>0,c,b+4);else{var e=Math.floor(Math.log(a)/Math.LN2);1024===e&&(e=1023);a*=Math.pow(2,-e);t(4503599627370496*a>>>0,c,b);t((d<<31|e+1023<<20|1048576*a&1048575)>>>0,c,b+4)}};h.prototype["double"]=function(a){return this.push(x,8,a)};var D=r.Array.prototype.set?function(a,c,b){c.set(a,b)}:function(a,c,b){for(var d=0;d<a.length;++d)c[b+d]=a[d]};h.prototype.bytes=function(a){var c=a.length>>>0;if(!c)return this.push(p,1,0);if(r.isString(a)){var b=h.alloc(c=y.length(a));y.decode(a,b,0);a=b}return this.uint32(c).push(D,c,a)};h.prototype.string=function(a){var c=A.length(a);return c?this.uint32(c).push(A.write,c,a):this.push(p,1,0)};h.prototype.fork=function(){this.states=new e(this);this.head=this.tail=new f(m,0,0);this.len=0;return this};h.prototype.reset=function(){this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new f(m,0,0),this.len=0);return this};h.prototype.ldelim=function(){var a=this.head,c=this.tail,b=this.len;this.reset().uint32(b);b&&(this.tail.next=a.next,this.tail=c,this.len+=b);return this};h.prototype.finish=function(){for(var a=this.head.next,c=this.constructor.alloc(this.len),b=0;a;)a.fn(a.val,c,b),b+=a.len,a=a.next;return c};h._configure=function(a){c=a}},{13:13}],15:[function(a,b,g){function f(){e.call(this)}function k(a,b,d){40>a.length?h.utf8.write(a,b,d):b.utf8Write(a,d)}b.exports=f;var e=a(14);(f.prototype=Object.create(e.prototype)).constructor=f;var h=a(13),p=h.Buffer;f.alloc=function(a){return(f.alloc=h._Buffer_allocUnsafe)(a)};var d=p&&p.prototype instanceof Uint8Array&&"set"===p.prototype.set.name?function(a,b,d){b.set(a,d)}:function(a,b,d){if(a.copy)a.copy(b,d,0,a.length);else for(var c=0;c<a.length;)b[d++]=a[c++]};f.prototype.bytes=function(a){h.isString(a)&&(a=h._Buffer_from(a,"base64"));var b=a.length>>>0;this.uint32(b);b&&this.push(d,b,a);return this};f.prototype.string=function(a){var b=p.byteLength(a);this.uint32(b);b&&this.push(k,b,a);return this}},{13:13,14:14}]},{},[7])})("object"===typeof window&&window||"object"===typeof self&&self||this);F("Core/isBitSet",[],function(){return function(b,a){return 0!==(b&a)}});F("Core/GoogleEarthEnterpriseTileInformation",["./defined","./isBitSet"],function(b,a){function f(a,b,f,e,h,k){this._bits=a;this.cnodeVersion=b;this.imageryVersion=f;this.terrainVersion=e;this.imageryProvider=h;this.terrainProvider=k;this.ancestorHasTerrain=!1;this.terrainState=void 0}var k=[1,2,4,8];f.clone=function(a,k){b(k)?(k._bits=a._bits,k.cnodeVersion=a.cnodeVersion,k.imageryVersion=a.imageryVersion,k.terrainVersion=a.terrainVersion,k.imageryProvider=a.imageryProvider,k.terrainProvider=a.terrainProvider):k=new f(a._bits,a.cnodeVersion,a.imageryVersion,a.terrainVersion,a.imageryProvider,a.terrainProvider);k.ancestorHasTerrain=a.ancestorHasTerrain;k.terrainState=a.terrainState;return k};f.prototype.setParent=function(a){this.ancestorHasTerrain=a.ancestorHasTerrain||this.hasTerrain()};f.prototype.hasSubtree=function(){return a(this._bits,16)};f.prototype.hasImagery=function(){return a(this._bits,64)};f.prototype.hasTerrain=function(){return a(this._bits,128)};f.prototype.hasChildren=function(){return a(this._bits,15)};f.prototype.hasChild=function(b){return a(this._bits,k[b])};f.prototype.getChildBitmask=function(){return this._bits&15};return f});F("Core/GoogleEarthEnterpriseMetadata","../ThirdParty/protobuf-minimal ../ThirdParty/when ./buildModuleUrl ./Check ./Credit ./defaultValue ./defined ./defineProperties ./GoogleEarthEnterpriseTileInformation ./isBitSet ./loadAndExecuteScript ./Math ./Request ./Resource ./RuntimeError ./TaskProcessor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(b){k.defined("resourceOrUrl",b);var d=b;"string"===typeof d||d instanceof r||(k.typeOf.string("resourceOrUrl.url",b.url),d=b.url);b=r.createIfNeeded(d);b.appendForwardSlash();this._resource=b;this.imageryPresent=!0;this.protoImagery=void 0;this.terrainPresent=!0;this.negativeAltitudeExponentBias=32;this.negativeAltitudeThreshold=q.EPSILON12;this.providers={};this.key=void 0;this._quadPacketVersion=1;this._tileInfo={};this._subtreePromises={};var e=this;this._readyPromise=z(this).then(function(){return e.getQuadTreePacket("",e._quadPacketVersion)}).then(function(){return!0}).otherwise(function(b){b="An error occurred while accessing "+e._resource.getDerivedResource({url:"flatfile?q2-0-q."+(1).toString(),request:void 0}).url+".";return a.reject(new c(b))})}function A(b,d,e){var f=b._tileInfo,h=d,g=f[h];if(m(g)&&(!g.hasSubtree()||g.hasChildren()))return g;for(;void 0===g&&1<h.length;)h=h.substring(0,h.length-1),g=f[h];var k,l=b._subtreePromises,f=l[h];if(m(f))return f.then(function(){k=new t({throttle:e.throttle,throttleByServer:e.throttleByServer,type:e.type,priorityFunction:e.priorityFunction});return A(b,d,k)});if(!m(g)||!g.hasSubtree())return a.reject(new c("Couldn't load metadata for tile "+d));f=b.getQuadTreePacket(h,g.cnodeVersion,e);if(m(f))return l[h]=f,f.then(function(){k=new t({throttle:e.throttle,throttleByServer:e.throttleByServer,type:e.type,priorityFunction:e.priorityFunction});return A(b,d,k)}).always(function(){delete l[h]})}function z(a){var c=a._resource.getDerivedResource({url:"dbRoot.v5",queryParameters:{output:"proto"}});if(!m(B)){var e=f("ThirdParty/google-earth-dbroot-parser.js"),h=window.cesiumGoogleEarthDbRootParser;B=d(e).then(function(){v=window.cesiumGoogleEarthDbRootParser(b);m(h)?window.cesiumGoogleEarthDbRootParser=h:delete window.cesiumGoogleEarthDbRootParser})}return B.then(function(){return c.fetchArrayBuffer()}).then(function(c){var b=v.EncryptedDbRootProto.decode(new Uint8Array(c)),d=b.encryptionData,e=d.byteOffset,f=e+d.byteLength;c=a.key=d.buffer.slice(e,f);d=b.dbrootData;e=d.byteOffset;f=e+d.byteLength;b=d.buffer.slice(e,f);return D.scheduleTask({buffer:b,type:"DbRoot",key:c},[b])}).then(function(c){var b=v.DbRootProto.decode(new Uint8Array(c.buffer));a.imageryPresent=l(b.imageryPresent,a.imageryPresent);a.protoImagery=b.protoImagery;a.terrainPresent=l(b.terrainPresent,a.terrainPresent);m(b.endSnippet)&&m(b.endSnippet.model)&&(c=b.endSnippet.model,a.negativeAltitudeExponentBias=l(c.negativeAltitudeExponentBias,a.negativeAltitudeExponentBias),a.negativeAltitudeThreshold=l(c.compressedNegativeAltitudeThreshold,a.negativeAltitudeThreshold));m(b.databaseVersion)&&(a._quadPacketVersion=l(b.databaseVersion.quadtreeVersion,a._quadPacketVersion));c=a.providers;for(var b=l(b.providerInfo,[]),d=b.length,e=0;e<d;++e){var f=b[e],h=f.copyrightString;m(h)&&(c[f.providerId]=new g(h.value))}}).otherwise(function(){console.log("Failed to retrieve "+c.url+". Using defaults.");a.key=x})}var x=function(a){for(var c=a.length,b=new ArrayBuffer(c),d=new Uint8Array(b),e=0;e<c;++e)d[e]=a.charCodeAt(e);return b}('E\u00f4\u00bd\x0By\u00e2jE"\u0005\u0092,\u0017\u00cd\u0006q\u00f8I\u0010FgQ\x00B%\u00c6\u00e8a,f)\b\u00c64\u00dcjb%y\nw\u001dmi\u00d6\u00f0\u009ck\u0093\u00a1\u00bdNu\u00e0A\u0004[\u00df@V\f\u00d9\u00bbr\u009b\u0081|\u00103S\u00eeOl\u00d4q\u0005\u00b0{\u00c0\u007fE\u0003VZ\u00adwUe\x0B3\u0092*\u00ac\u0019l5\u0014\u00c5\u001d0s\u00f83\x3emF8J\u00b4\u00dd\u00f0.\u00dd\u0017u\u0016\u00da\u008cDt"\u0006\u00faa"\f3"So\u00af9D\x0B\u008c\u000e9\u00d99\u0013L\u00b9\u00bf\u007f\u00ab\\\u008cP_\u009f"ux\u001f\u00e9\u0007q\u0091h;\u00c1\u00c4\u009b\u007f\u00f0\x3cVqH\u0082\u0005\'UfYNe\u001d\u0098u\u00a3aF}a?\u0015A\x00\u009f\u0014\u0006\u00d7\u00b44M\u00ce\u0013\u0087F\u00b0\u001a\u00d5\u0005\u001c\u00b8\u008a\'{\u008b\u00dc+\u00bbMg0\u00c8\u00d1\u00f6\\\u008fP\u00fa[/F\u009bn5\u0018/\'C.\u00eb\n\f^\u0010\u0005\u0010\u00a5s\u001be4\u00e5l.jC\'c\u0014#U\u00a9?q{gC}:\u00af\u00cd\u00e2TU\u009c\u00fdK\u00c6\u00e2\u009f/(\u00ed\u00cb\\\u00c6-f\u0007\u0088\u00a7;/\u0018*"N\u000e\u00b0k.\u00dd\r\u0095}}G\u00baC\u00b2\u0011\u00b2+\x3eM\u00aa\x3e}\u00e6\u00ceI\u0089\u00c6\u00e6x\fa1\u0005-\u0001\u00a4O\u00a5~q \u0088\u00ec\r1\u00e8N\x0B\x00nPh}\u0017\x3d\b\r\u0017\u0095\u00a6n\u00a3h\u0097$[k\u00f3\u0017#\u00f3\u00b6s\u00b3\r\x0B@\u00c0\u009f\u00d8\u0004Q]\u00fa\u001a\u0017".\u0015j\u00dfI\x00\u00b9\u00a0wU\u00c6\u00ef\u0010j\u00bf{GL\u007f\u0083\u0017\u0005\u00ee\u00dc\u00dcF\u0085\u00a9\u00adS\u0007+S4\u0006\u0007\u00ff\u0014\u0094Y\u0019\u0002\u00e48\u00e81\u0083N\u00b9XFk\u00cb-#\u0086\u0092p\x005\u0088"\u00cf1\u00b2\x26/\u00e7\u00c3u-6,rt\u00b0#G\u00b7\u00d3\u00d1\x26\u0016\u00857r\u00e2\x00\u008cD\u00cf\u0010\u00da3-\u001a\u00de`\u0086i#i*|\u00cdKQ\r\u0095T9w.)\u00ea\u001b\u00a6P\u00a2j\u008foP\u0099\\\x3eT\u00fb\u00efP[\x0B\u0007E\u0017\u0089m(\u0013w7\u001d\u00db\u008e\u001eJ\u0005fJo\u0099 \u00e5p\u00e2\u00b9q~\fmI\u0004-z\u00fer\u00c7\u00f2Y0\u008f\u00bb\u0002]s\u00e5\u00c9 \u00eax\u00ec \u0090\u00f0\u008a\u007fB\u0017|G\u0019`\u00b0\u0016\u00bd\x26\u00b7q\u00b6\u00c7\u009f\u000e\u00d13\u0082\x3d\u00d3\u00ab\u00eec\u0099\u00c8+S\u00a0D\\q\u0001\u00c6\u00ccD\u001f2O\x3c\u00ca\u00c0)\x3dR\u00d3a\u0019X\u00a9}e\u00b4\u00dc\u00cf\r\u00f4\x3d\u00f1\b\u00a9B\u00da#\t\u00d8\u00bf^PI\u00f8M\u00c0\u00cbGL\u001cO\u00f7{+\u00d8\u0016\u0018\u00c51\u0092;\u00b5o\u00dcl\r\u0092\u0088\u0016\u00d1\u009e\u00db?\u00e2\u00e9\u00da_\u00d4\u0084\u00e2FaZ\u00de\u001cU\u00cf\u00a4\x00\u00be\u00fd\u00ceg\u00f1Ji\u001c\u0097\u00e6 H\u00d8]\u007f~\u00aeq \u000eN\u00ae\u00c0V\u00a9\u0091\u0001\x3c\u0082\u001d\u000fr\u00e7v\u00ec)I\u00d6]-\u0083\u00e3\u00db6\u0006\u00a9;f\u0013\u0097\u0087j\u00d5\u00b6\x3dP^R\u00b9K\u00c7sWx\u00c9\u00f4.Y\u0007\u0095\u0093o\u00d0K\u0017W\u0019\x3e\'\'\u00c7`\u00db;\u00ed\u009a\u000eSD\u0016\x3e?\u008d\u0092mw\u00a2\n\u00eb?R\u00a8\u00c6U^1I7\u0085\u00f4\u00c5\u001f\x26-\u00a9\u001c\u00bf\u008b\'T\u00da\u00c3j \u00e5*x\u0004\u00b0\u00d6\u0090pr\u00aa\u008bh\u00bd\u0088\u00f7\u0002_H\u00b1~\u00c0XL?f\u001a\u00f9\x3e\u00e1e\u00c0p\u00a7\u00cf8i\u00af\u00f0VldI\u009c\'\u00adxtO\u00c2\u0087\u00deV9\x00\u00daw\x0B\u00cb-\u001b\u0089\u00fb5O\u0002\u00f5\bQ\u0013`\u00c1\nZGM\x26\u001c30x\u00da\u00c0\u009cFG\u00e2[y`In7gS\n\x3e\u00e9\u00ecF9\u00b2\u00f14\r\u00c6\u0084Sun\u00e1\fY\u00d9\u001e\u00de)\u0085\u0010{II\u00a5wy\u00beIV.6\u00e7\x0B:\u00bbO\u0003b{\u00d2M1\u0095/\u00bd8{\u00a8O!\u00e1\u00ecFpv\u0095})"x\u0088\n\u0090\u00dd\u009d\\\u00da\u00de\u0019Q\u00cf\u00f0\u00fcYRe|3\u0013\u00df\u00f3H\u00da\u00bb*u\u00db`\u00b2\u0002\u0015\u00d4\u00fc\u0019\u00ed\u001b\u00ec\u007f5\u00a8\u00ff(1\u0007-\u0012\u00c8\u00dc\u0088F|\u008a["');e(y.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},resource:{get:function(){return this._resource}},readyPromise:{get:function(){return this._readyPromise}}});y.tileXYToQuadKey=function(a,c,b){for(var d="";0<=b;--b){var e=1<<b,f=0;p(c,e)?p(a,e)&&(f|=1):(f|=2,p(a,e)||(f|=1));d+=f}return d};y.quadKeyToTileXY=function(a){for(var c=0,b=0,d=a.length-1,e=d;0<=e;--e){var f=1<<e,h=+a[d-e];p(h,2)?p(h,1)||(c|=f):(b|=f,p(h,1)&&(c|=f))}return{x:c,y:b,level:d}};y.prototype.isValid=function(a){var c=this.getTileInformationFromQuadKey(a);if(m(c))return null!==c;for(var b=!0,d;1<a.length;)if(d=a.substring(a.length-1),a=a.substring(0,a.length-1),c=this.getTileInformationFromQuadKey(a),m(c)){c.hasSubtree()||c.hasChild(parseInt(d))||(b=!1);break}else if(null===c){b=!1;break}return b};var D=new u("decodeGoogleEarthEnterprisePacket",Number.POSITIVE_INFINITY);y.prototype.getQuadTreePacket=function(a,c,b){c=l(c,1);a=l(a,"");c=this._resource.getDerivedResource({url:"flatfile?q2-0"+a+"-q."+c.toString(),request:b}).fetchArrayBuffer();if(m(c)){var d=this._tileInfo,e=this.key;return c.then(function(c){return D.scheduleTask({buffer:c,quadKey:a,type:"Metadata",key:e},[c]).then(function(c){var b,e=-1;if(""!==a){var e=a.length+1,f=c[a];b=d[a];b._bits|=f._bits;delete c[a]}f=Object.keys(c);f.sort(function(a,c){return a.length-c.length});for(var g=f.length,k=0;k<g;++k){var l=f[k];if(null!==c[l]){var m=h.clone(c[l]),p=l.length;p===e?m.setParent(b):1<p&&(p=d[l.substring(0,l.length-1)],m.setParent(p));d[l]=m}else d[l]=null}})})}};y.prototype.populateSubtree=function(a,c,b,d){a=y.tileXYToQuadKey(a,c,b);return A(this,a,d)};y.prototype.getTileInformation=function(a,c,b){a=y.tileXYToQuadKey(a,c,b);return this._tileInfo[a]};y.prototype.getTileInformationFromQuadKey=function(a){return this._tileInfo[a]};var v,B;return y});F("Core/GoogleEarthEnterpriseTerrainData","./BoundingSphere ./Cartesian2 ./Cartesian3 ./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./IndexDatatype ./Intersections2D ./Math ./OrientedBoundingBox ./QuantizedMeshTerrainData ./Rectangle ./TaskProcessor ./TerrainEncoding ./TerrainMesh".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=g(a,g.EMPTY_OBJECT);k.typeOf.object("options.buffer",a.buffer);k.typeOf.number("options.negativeAltitudeExponentBias",a.negativeAltitudeExponentBias);k.typeOf.number("options.negativeElevationThreshold",a.negativeElevationThreshold);this._buffer=a.buffer;this._credits=a.credits;this._negativeAltitudeExponentBias=a.negativeAltitudeExponentBias;this._negativeElevationThreshold=a.negativeElevationThreshold;var c=g(a.childTileMask,15);this._childTileMask=c&3|(c&4?8:0)|(c&8?4:0);this._createdByUpsampling=g(a.createdByUpsampling,!1);this._skirtHeight=void 0;this._bufferType=this._buffer.constructor;this._skirtIndex=this._vertexCountWithoutSkirts=this._maximumHeight=this._minimumHeight=this._mesh=void 0}m(A.prototype,{credits:{get:function(){return this._credits}},waterMask:{get:function(){}}});var z=new c("createVerticesFromGoogleEarthEnterpriseBuffer"),x=new r,D=new r;A.prototype.createMesh=function(a,c,d,e,h){k.typeOf.object("tilingScheme",a);k.typeOf.number("x",c);k.typeOf.number("y",d);k.typeOf.number("level",e);var m=a.ellipsoid;a.tileXYToNativeRectangle(c,d,e,x);a.tileXYToRectangle(c,d,e,D);h=g(h,1);var p=m.cartographicToCartesian(r.center(D));this._skirtHeight=Math.min(40075.16/(1<<e)*8,1E3);a=z.scheduleTask({buffer:this._buffer,nativeRectangle:x,rectangle:D,relativeToCenter:p,ellipsoid:m,skirtHeight:this._skirtHeight,exaggeration:h,includeWebMercatorT:!0,negativeAltitudeExponentBias:this._negativeAltitudeExponentBias,negativeElevationThreshold:this._negativeElevationThreshold});if(l(a)){var v=this;return a.then(function(a){v._mesh=new y(p,new Float32Array(a.vertices),new Uint16Array(a.indices),a.minimumHeight,a.maximumHeight,b.clone(a.boundingSphere3D),f.clone(a.occludeePointInScaledSpace),a.numberOfAttributes,q.clone(a.orientedBoundingBox),u.clone(a.encoding),h,a.westIndicesSouthToNorth,a.southIndicesEastToWest,a.eastIndicesNorthToSouth,a.northIndicesWestToEast);v._vertexCountWithoutSkirts=a.vertexCountWithoutSkirts;v._skirtIndex=a.skirtIndex;v._minimumHeight=a.minimumHeight;v._maximumHeight=a.maximumHeight;v._buffer=void 0;return v._mesh})}};A.prototype.interpolateHeight=function(a,c,b){c=d.clamp((c-a.west)/a.width,0,1);b=d.clamp((b-a.south)/a.height,0,1);if(!l(this._mesh)){a:{var e=this._buffer,f=0,h=0,g=0;.5<b?(.5<c?(f=2,h=.5):f=3,g=.5):.5<c&&(f=1,h=.5);for(var e=new DataView(e),k=0,m=0;m<f;++m)k+=e.getUint32(k,!0),k+=w;var k=k+w,k=k+2*L,m=d.toRadians(180*e.getFloat64(k,!0)),k=k+L,f=d.toRadians(180*e.getFloat64(k,!0)),k=k+L,q=a.width/m/2,v=a.height/f/2,r=e.getInt32(k,!0),k=k+G;a=3*e.getInt32(k,!0);var k=k+G,k=k+G,f=Array(r),m=Array(r),u=Array(r),t;for(t=0;t<r;++t)f[t]=h+e.getUint8(k++)*q,m[t]=g+e.getUint8(k++)*v,u[t]=6371010*e.getFloat32(k,!0),k+=E;h=Array(a);for(t=0;t<a;++t)h[t]=e.getUint16(k,!0),k+=J;for(t=0;t<a;t+=3)if(g=h[t],e=h[t+1],k=h[t+2],q=p.computeBarycentricCoordinates(c,b,f[g],m[g],f[e],m[e],f[k],m[k],H),-1E-15<=q.x&&-1E-15<=q.y&&-1E-15<=q.z){c=q.x*u[g]+q.y*u[e]+q.z*u[k];break a}c=void 0}return c}a:{e=this._mesh;h=e.vertices;g=e.encoding;a=e.indices;f=0;for(m=a.length;f<m;f+=3)if(u=a[f],k=a[f+1],e=a[f+2],t=g.decodeTextureCoordinates(h,u,B),q=g.decodeTextureCoordinates(h,k,C),v=g.decodeTextureCoordinates(h,e,I),t=p.computeBarycentricCoordinates(c,b,t.x,t.y,q.x,q.y,v.x,v.y,H),-1E-15<=t.x&&-1E-15<=t.y&&-1E-15<=t.z){c=g.decodeHeight(h,u);b=g.decodeHeight(h,k);h=g.decodeHeight(h,e);c=t.x*c+t.y*b+t.z*h;break a}c=void 0}return c};var v=new c("upsampleQuantizedTerrainMesh");A.prototype.upsample=function(a,c,d,g,m,p,r){k.typeOf.object("tilingScheme",a);k.typeOf.number("thisX",c);k.typeOf.number("thisY",d);k.typeOf.number("thisLevel",g);k.typeOf.number("descendantX",m);k.typeOf.number("descendantY",p);k.typeOf.number("descendantLevel",r);if(1<r-g)throw new e("Upsampling through more than one level at a time is not currently supported.");g=this._mesh;if(l(this._mesh)){c=2*c!==m;d=2*d===p;var w=a.ellipsoid;a=a.tileXYToRectangle(m,p,r);a=v.scheduleTask({vertices:g.vertices,vertexCountWithoutSkirts:this._vertexCountWithoutSkirts,indices:g.indices,skirtIndex:this._skirtIndex,encoding:g.encoding,minimumHeight:this._minimumHeight,maximumHeight:this._maximumHeight,isEastChild:c,isNorthChild:d,childRectangle:a,ellipsoid:w,exaggeration:g.exaggeration});if(l(a)){var u=this;return a.then(function(a){var c=new Uint16Array(a.vertices),d=h.createTypedArray(c.length/3,a.indices),e=u._skirtHeight;return new t({quantizedVertices:c,indices:d,minimumHeight:a.minimumHeight,maximumHeight:a.maximumHeight,boundingSphere:b.clone(a.boundingSphere),orientedBoundingBox:q.clone(a.orientedBoundingBox),horizonOcclusionPoint:f.clone(a.horizonOcclusionPoint),westIndices:a.westIndices,southIndices:a.southIndices,eastIndices:a.eastIndices,northIndices:a.northIndices,westSkirtHeight:e,southSkirtHeight:e,eastSkirtHeight:e,northSkirtHeight:e,childTileMask:0,createdByUpsampling:!0,credits:u._credits})})}}};A.prototype.isChildAvailable=function(a,c,b,d){k.typeOf.number("thisX",a);k.typeOf.number("thisY",c);k.typeOf.number("childX",b);k.typeOf.number("childY",d);var e=2;b!==2*a&&++e;d!==2*c&&(e-=2);return 0!==(this._childTileMask&1<<e)};A.prototype.wasCreatedByUpsampling=function(){return this._createdByUpsampling};var B=new a,C=new a,I=new a,H=new f,J=Uint16Array.BYTES_PER_ELEMENT,w=Uint32Array.BYTES_PER_ELEMENT,G=Int32Array.BYTES_PER_ELEMENT,E=Float32Array.BYTES_PER_ELEMENT,L=Float64Array.BYTES_PER_ELEMENT;return A});F("Core/GoogleEarthEnterpriseTerrainProvider","../ThirdParty/when ./Credit ./defaultValue ./defined ./defineProperties ./DeveloperError ./Event ./GeographicTilingScheme ./GoogleEarthEnterpriseMetadata ./GoogleEarthEnterpriseTerrainData ./HeightmapTerrainData ./JulianDate ./Math ./Rectangle ./Request ./RequestState ./RequestType ./Resource ./RuntimeError ./TaskProcessor ./TileProviderError".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){function v(){this._terrainCache={};this._lastTidy=q.now()}function B(c){c=f(c,{});if(!k(c.url)&&!k(c.metadata))throw new l("options.url or options.metadata is required.");var d;if(k(c.metadata))d=c.metadata;else{var g=A.createIfNeeded(c.url);d=new h(g)}this._metadata=d;this._tilingScheme=new e({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new r(-t.PI,-t.PI,t.PI,t.PI),ellipsoid:c.ellipsoid});c=c.credit;"string"===typeof c&&(c=new a(c));this._credit=c;this._levelZeroMaximumGeometricError=40075.16;this._terrainCache=new v;this._terrainPromises={};this._terrainRequests={};this._errorEvent=new m;this._ready=!1;var p=this,q;this._readyPromise=d.readyPromise.then(function(a){if(!d.terrainPresent)return a=new z("The server "+d.url+" doesn't have terrain"),q=D.handleError(q,p,p._errorEvent,a.message,void 0,void 0,void 0,a),b.reject(a);D.handleSuccess(q);return p._ready=a}).otherwise(function(a){q=D.handleError(q,p,p._errorEvent,a.message,void 0,void 0,void 0,a);return b.reject(a)})}function C(a,c,b){var d=c.getChildBitmask();if(c.terrainState===H.PARENT)for(c=d=0;4>c;++c){var e=b.getTileInformationFromQuadKey(a+c.toString());k(e)&&e.hasTerrain()&&(d|=1<<c)}return d}function I(a,c,b,d){b=k(b)&&0<b?b:1;return a._metadata.resource.getDerivedResource({url:"flatfile?f1c-0"+c+"-t."+b.toString(),request:d})}var H={UNKNOWN:0,NONE:1,SELF:2,PARENT:3},J=new q;v.prototype.add=function(a,c){this._terrainCache[a]={buffer:c,timestamp:q.now()}};v.prototype.get=function(a){var c=this._terrainCache[a];if(k(c))return delete this._terrainCache[a],c.buffer};v.prototype.tidy=function(){q.now(J);if(10<q.secondsDifference(J,this._lastTidy)){for(var a=this._terrainCache,c=Object.keys(a),b=c.length,d=0;d<b;++d){var e=c[d];10<q.secondsDifference(J,a[e].timestamp)&&delete a[e]}q.clone(J,this._lastTidy)}};g(B.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tilingScheme:{get:function(){if(!this._ready)throw new l("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}},availability:{get:function(){}}});var w=new x("decodeGoogleEarthEnterprisePacket",Number.POSITIVE_INFINITY);B.prototype.requestTileGeometry=function(a,c,e,f){if(!this._ready)throw new l("requestTileGeometry must not be called before the terrain provider is ready.");var g=h.tileXYToQuadKey(a,c,e),m=this._terrainCache,q=this._metadata,v=q.getTileInformationFromQuadKey(g);if(!k(v))return b.reject(new z("Terrain tile doesn't exist"));a=v.terrainState;k(a)||(a=v.terrainState=H.UNKNOWN);c=m.get(g);if(k(c))return a=q.providers[v.terrainProvider],b.resolve(new p({buffer:c,childTileMask:C(g,v,q),credits:k(a)?[a]:void 0,negativeAltitudeExponentBias:q.negativeAltitudeExponentBias,negativeElevationThreshold:q.negativeAltitudeThreshold}));m.tidy();if(!v.ancestorHasTerrain)return b.resolve(new d({buffer:new Uint8Array(256),width:16,height:16}));if(a===H.NONE)return b.reject(new z("Terrain tile doesn't exist"));var r=g;c=-1;switch(a){case H.SELF:c=v.terrainVersion;break;case H.PARENT:r=r.substring(0,r.length-1);a=q.getTileInformationFromQuadKey(r);c=a.terrainVersion;break;case H.UNKNOWN:v.hasTerrain()?c=v.terrainVersion:(r=r.substring(0,r.length-1),a=q.getTileInformationFromQuadKey(r),k(a)&&a.hasTerrain()&&(c=a.terrainVersion))}if(0>c)return b.reject(new z("Terrain tile doesn't exist"));var B=this._terrainPromises,t=this._terrainRequests,y;if(k(B[r]))a=B[r],y=t[r];else{y=f;a=I(this,r,c,y).fetchArrayBuffer();if(!k(a))return;a=a.then(function(a){return k(a)?w.scheduleTask({buffer:a,type:"Terrain",key:q.key},[a]).then(function(a){var c=q.getTileInformationFromQuadKey(r);c.terrainState=H.SELF;m.add(r,a[0]);for(var c=c.terrainProvider,b=a.length-1,d=0;d<b;++d){var e=r+d.toString(),f=q.getTileInformationFromQuadKey(e);k(f)&&(m.add(e,a[d+1]),f.terrainState=H.PARENT,0===f.terrainProvider&&(f.terrainProvider=c))}}):b.reject(new z("Failed to load terrain."))});B[r]=a;t[r]=y;a=a.always(function(){delete B[r];delete t[r]})}return a.then(function(){var a=m.get(g);if(k(a)){var c=q.providers[v.terrainProvider];return new p({buffer:a,childTileMask:C(g,v,q),credits:k(c)?[c]:void 0,negativeAltitudeExponentBias:q.negativeAltitudeExponentBias,negativeElevationThreshold:q.negativeAltitudeThreshold})}return b.reject(new z("Failed to load terrain."))}).otherwise(function(a){if(y.state===u.CANCELLED)return f.state=y.state,b.reject(a);v.terrainState=H.NONE;return b.reject(a)})};B.prototype.getLevelMaximumGeometricError=function(a){return this._levelZeroMaximumGeometricError/(1<<a)};B.prototype.getTileDataAvailable=function(a,b,d){var e=this._metadata,f=h.tileXYToQuadKey(a,b,d),g=e.getTileInformation(a,b,d);if(null===g)return!1;if(k(g)){if(!g.ancestorHasTerrain)return!0;a=g.terrainState;if(a===H.NONE)return!1;if(!k(a)||a===H.UNKNOWN)if(g.terrainState=H.UNKNOWN,!g.hasTerrain()&&(f=f.substring(0,f.length-1),e=e.getTileInformationFromQuadKey(f),!k(e)||!e.hasTerrain()))return!1;return!0}e.isValid(f)&&(f=new c({throttle:!0,throttleByServer:!0,type:y.TERRAIN}),e.populateSubtree(a,b,d,f));return!1};B.prototype.loadTileDataAvailability=function(a,c,b){};return B});F("Core/GroundPolylineGeometry","./ApproximateTerrainHeights ./ArcType ./arrayRemoveDuplicates ./BoundingSphere ./Cartesian3 ./Cartographic ./Check ./ComponentDatatype ./DeveloperError ./Math ./defaultValue ./defined ./defineProperties ./Ellipsoid ./EllipsoidGeodesic ./EllipsoidRhumbLine ./EncodedCartesian3 ./GeographicProjection ./Geometry ./GeometryAttribute ./IntersectionTests ./Matrix3 ./Plane ./Quaternion ./Rectangle ./WebMercatorProjection".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H){function J(c){c=d(c,d.EMPTY_OBJECT);var b=c.positions;if(!q(b)||2>b.length)throw new h("At least two positions are required.");if(q(c.arcType)&&c.arcType!==a.GEODESIC&&c.arcType!==a.RHUMB)throw new h("Valid options for arcType are ArcType.GEODESIC and ArcType.RHUMB.");this.width=d(c.width,1);this._positions=b;this.granularity=d(c.granularity,9999);this.loop=d(c.loop,!1);this.arcType=d(c.arcType,a.GEODESIC);this._ellipsoid=r.WGS84;this._projectionIndex=0;this._workerName="createGroundPolylineGeometry";this._scene3DOnly=!1}function w(a,c,b,d,e){var f=E(d,a,0,Q);a=E(d,a,b,S);c=E(d,c,0,ca);d=L(a,f,S);f=L(c,f,ca);g.cross(f,d,e);return g.normalize(e,e)}function G(b,d,e,f,h,k,l,m,p,q,v){if(0!==h){var r;k===a.GEODESIC?r=new c(b,d,l):k===a.RHUMB&&(r=new u(b,d,l));k=r.surfaceDistance;if(!(k<h)){b=w(b,d,f,l,ba);d=Math.ceil(k/h);k=h=k/d;--d;for(var B=m.length,C=0;C<d;C++){var t=r.interpolateUsingSurfaceDistance(k,T),y=E(l,t,e,da),z=E(l,t,f,V);g.pack(b,m,B);g.pack(y,p,B);g.pack(z,q,B);v.push(t.latitude);v.push(t.longitude);B+=3;k+=h}}}}function E(a,c,b,d){l.clone(c,X);X.height=b;return l.toCartesian(X,a,d)}function L(a,c,b){g.subtract(a,c,b);g.normalize(b,b);return b}function K(a,c,b,d){d=L(a,c,d);d=g.cross(d,b,d);d=g.normalize(d,d);return d=g.cross(b,d,d)}function P(a,c,b,d,e){b=L(b,c,na);a=K(a,c,b,fa);c=K(d,c,b,ga);if(p.equalsEpsilon(g.dot(a,c),-1,p.EPSILON5))return e=g.cross(b,a,e),e=g.normalize(e,e);e=g.add(c,a,e);e=g.normalize(e,e);d=g.cross(b,e,F);0>g.dot(c,d)&&(e=g.negate(e,e));return e}function N(a,c,b,d){c=L(b,c,Da);c=g.dot(c,a);return c>R||c<Y?(b=L(d,b,na),b=C.fromAxisAngle(b,c<Y?p.PI_OVER_TWO:-p.PI_OVER_TWO,ra),b=v.fromQuaternion(b,Ba),v.multiplyByVector(b,a,a),!0):!1}function O(a,c,b,d,e){var f=l.toCartesian(c,a._ellipsoid,Ga),h=g.add(f,b,Ca),k=!1,m=a._ellipsoid,h=m.cartesianToCartographic(h,Ea);Math.abs(c.longitude-h.longitude)>p.PI_OVER_TWO&&(k=!0,h=g.subtract(f,b,Ca),h=m.cartesianToCartographic(h,Ea));h.height=0;a=a.project(h,e);e=g.subtract(a,d,e);e.z=0;e=g.normalize(e,e);k&&g.negate(e,e);return e}function Z(a,c,b,d,e,f){var h=g.subtract(c,a,ya);g.normalize(h,h);b=g.multiplyByScalar(h,b-0,Aa);g.add(a,b,e);b=g.multiplyByScalar(h,d-1E3,Aa);g.add(c,b,f)}function aa(a,c){var b=B.getPointDistance(ia,a),d=B.getPointDistance(ia,c),e=Ua;p.equalsEpsilon(b,0,p.EPSILON2)?(e=L(c,a,e),g.multiplyByScalar(e,p.EPSILON2,e),g.add(a,e,a)):p.equalsEpsilon(d,0,p.EPSILON2)&&(e=L(a,c,e),g.multiplyByScalar(e,p.EPSILON2,e),g.add(c,e,c))}function U(a){return new x({componentDatatype:e.FLOAT,componentsPerAttribute:4,normalize:!1,values:a})}var W=[A,H],M=W.length,R=Math.cos(p.toRadians(30)),Y=Math.cos(p.toRadians(150));t(J.prototype,{packedLength:{get:function(){return 3*this._positions.length+4+r.packedLength+1+1}}});J.setProjectionAndEllipsoid=function(a,c){for(var b=0,d=0;d<M;d++)if(c instanceof W[d]){b=d;break}a._projectionIndex=b;a._ellipsoid=c.ellipsoid};var Q=new g,S=new g,ca=new g,T=new l,da=new g,V=new g,ba=new g,X=new l;J.pack=function(a,c,b){m.typeOf.object("value",a);m.defined("array",c);b=d(b,0);var e=a._positions,f=e.length;c[b++]=f;for(var h=0;h<f;++h)g.pack(e[h],c,b),b+=3;c[b++]=a.granularity;c[b++]=a.loop?1:0;c[b++]=a.arcType;r.pack(a._ellipsoid,c,b);b+=r.packedLength;c[b++]=a._projectionIndex;c[b++]=a._scene3DOnly?1:0;return c};J.unpack=function(a,c,b){m.defined("array",a);var e=d(c,0),f=a[e++];c=Array(f);for(var h=0;h<f;h++)c[h]=g.unpack(a,e),e+=3;var f=a[e++],h=1===a[e++],k=a[e++],l=r.unpack(a,e),e=e+r.packedLength,p=a[e++];a=1===a[e++];q(b)||(b=new J({positions:c}));b._positions=c;b.granularity=f;b.loop=h;b.arcType=k;b._ellipsoid=l;b._projectionIndex=p;b._scene3DOnly=a;return b};var fa=new g,ga=new g,F=new g,na=new g,ia=B.fromPointNormal(g.ZERO,g.UNIT_Y),la=new g,ha=new g,pa=new g,oa=new g,qa=new g,ua=new g,ta=new l,wa=new l,za=new l;J.createGeometry=function(c){var d=!c._scene3DOnly,h=c.loop,m=c._ellipsoid,v=c.granularity,r=c.arcType,B=new W[c._projectionIndex](m),C,t,A=c._positions,H=A.length;2===H&&(h=!1);var K,J,T,M,Q=new u(void 0,void 0,m),S,da,V,Y=[A[0]];for(t=0;t<H-1;t++)K=A[t],J=A[t+1],S=D.lineSegmentPlane(K,J,ia,ua),!q(S)||g.equalsEpsilon(S,K,p.EPSILON7)||g.equalsEpsilon(S,J,p.EPSILON7)||(c.arcType===a.GEODESIC?Y.push(g.clone(S)):c.arcType===a.RHUMB&&(V=m.cartesianToCartographic(S,ta).longitude,T=m.cartesianToCartographic(K,ta),M=m.cartesianToCartographic(J,wa),Q.setEndPoints(T,M),da=Q.findIntersectionWithLongitude(V,za),S=m.cartographicToCartesian(da,ua),!q(S)||g.equalsEpsilon(S,K,p.EPSILON7)||g.equalsEpsilon(S,J,p.EPSILON7)||Y.push(g.clone(S)))),Y.push(J);h&&(K=A[H-1],J=A[0],S=D.lineSegmentPlane(K,J,ia,ua),!q(S)||g.equalsEpsilon(S,K,p.EPSILON7)||g.equalsEpsilon(S,J,p.EPSILON7)||(c.arcType===a.GEODESIC?Y.push(g.clone(S)):c.arcType===a.RHUMB&&(V=m.cartesianToCartographic(S,ta).longitude,T=m.cartesianToCartographic(K,ta),M=m.cartesianToCartographic(J,wa),Q.setEndPoints(T,M),da=Q.findIntersectionWithLongitude(V,za),S=m.cartographicToCartesian(da,ua),!q(S)||g.equalsEpsilon(S,K,p.EPSILON7)||g.equalsEpsilon(S,J,p.EPSILON7)||Y.push(g.clone(S)))));var ca=Y.length,ba=Array(ca);for(t=0;t<ca;t++){var fa=l.fromCartesian(Y[t],m);fa.height=0;ba[t]=fa}ba=f(ba,l.equalsEpsilon);ca=ba.length;if(!(2>ca)){var X=[],ga=[],F=[],ra=[],Ba=la,Ea=ha,Aa=pa,Da=oa,Ca=qa,Ga=ba[0],ka=ba[1],Ba=E(m,ba[ca-1],0,Ba),Da=E(m,ka,0,Da),Ea=E(m,Ga,0,Ea),Aa=E(m,Ga,1E3,Aa),Ca=h?P(Ba,Ea,Aa,Da,Ca):w(Ga,ka,1E3,m,Ca);g.pack(Ca,ga,0);g.pack(Ea,F,0);g.pack(Aa,ra,0);X.push(Ga.latitude);X.push(Ga.longitude);G(Ga,ka,0,1E3,v,r,m,ga,F,ra,X);for(t=1;t<ca-1;++t){var Ba=g.clone(Ea,Ba),Ea=g.clone(Da,Ea),na=ba[t];E(m,na,1E3,Aa);E(m,ba[t+1],0,Da);P(Ba,Ea,Aa,Da,Ca);C=ga.length;g.pack(Ca,ga,C);g.pack(Ea,F,C);g.pack(Aa,ra,C);X.push(na.latitude);X.push(na.longitude);G(ba[t],ba[t+1],0,1E3,v,r,m,ga,F,ra,X)}var ya=ba[ca-1],Ua=ba[ca-2],Ea=E(m,ya,0,Ea),Aa=E(m,ya,1E3,Aa);if(h)var Na=ba[0],Ba=E(m,Ua,0,Ba),Da=E(m,Na,0,Da),Ca=P(Ba,Ea,Aa,Da,Ca);else Ca=w(Ua,ya,1E3,m,Ca);C=ga.length;g.pack(Ca,ga,C);g.pack(Ea,F,C);g.pack(Aa,ra,C);X.push(ya.latitude);X.push(ya.longitude);if(h){G(ya,Ga,0,1E3,v,r,m,ga,F,ra,X);C=ga.length;for(t=0;3>t;++t)ga[C+t]=ga[t],F[C+t]=F[t],ra[C+t]=ra[t];X.push(Ga.latitude);X.push(Ga.longitude)}var Ob=h,lb,nb,Cb=B._ellipsoid,wb=F.length/3-1,xb=8*wb,rb=4*xb,yb=36*wb,oc=65535<xb?new Uint32Array(yb):new Uint16Array(yb),sb=new Float64Array(3*xb),Sb=new Float32Array(rb),Pb=new Float32Array(rb),$b=new Float32Array(rb),ec=new Float32Array(rb),Db=new Float32Array(rb),Eb,eb,ea,Qb;d&&(Eb=new Float32Array(rb),eb=new Float32Array(rb),ea=new Float32Array(rb),Qb=new Float32Array(2*xb));var bb=X.length/2,cb=0,Ya=sa;Ya.height=0;var Fb=Va;Fb.height=0;var Pa=xa,Xa=Ha;if(d)for(nb=0,lb=1;lb<bb;lb++)Ya.latitude=X[nb],Ya.longitude=X[nb+1],Fb.latitude=X[nb+2],Fb.longitude=X[nb+3],Pa=B.project(Ya,Pa),Xa=B.project(Fb,Xa),cb+=g.distance(Pa,Xa),nb+=2;var pc=ra.length/3,Xa=g.unpack(ra,0,Xa),ic=0;nb=3;for(lb=1;lb<pc;lb++)Pa=g.clone(Xa,Pa),Xa=g.unpack(ra,nb,Xa),ic+=g.distance(Pa,Xa),nb+=3;var ob;nb=3;var Kb=0,Rb=0,ub=0,jc=0,jb=!1,Jb=g.unpack(F,0,Ia),Gb=g.unpack(ra,0,Ha),kb=g.unpack(ga,0,Fa);if(Ob){var Lb=g.unpack(F,F.length-6,Ma);N(kb,Lb,Jb,Gb)&&(kb=g.negate(kb,kb))}var kc=0,Vb=0,Tb=0;for(lb=0;lb<wb;lb++){var fb=g.clone(Jb,Ma),zb=g.clone(Gb,xa),Mb=g.clone(kb,La);jb&&(Mb=g.negate(Mb,Mb));Jb=g.unpack(F,nb,Ia);Gb=g.unpack(ra,nb,Ha);kb=g.unpack(ga,nb,Fa);jb=N(kb,fb,Jb,Gb);Ya.latitude=X[Kb];Ya.longitude=X[Kb+1];Fb.latitude=X[Kb+2];Fb.longitude=X[Kb+3];var $a,lc,qc,mc;if(d){var bc;var kd=Ya,Hc=Fb,Ge=Math.abs(kd.longitude),Bb=Math.abs(Hc.longitude);if(p.equalsEpsilon(Ge,p.PI,p.EPSILON11)){var ld=p.sign(Hc.longitude);kd.longitude=ld*(Ge-p.EPSILON11);bc=1}else if(p.equalsEpsilon(Bb,p.PI,p.EPSILON11)){var Wc=p.sign(kd.longitude);Hc.longitude=Wc*(Bb-p.EPSILON11);bc=2}else bc=0;$a=B.project(Ya,Ka);lc=B.project(Fb,Wa);var Cc=L(lc,$a,tc);Cc.y=Math.abs(Cc.y);qc=Ra;mc=Nb;0===bc||g.dot(Cc,g.UNIT_Y)>R?(qc=O(B,Ya,Mb,$a,Ra),mc=O(B,Fb,kb,lc,Nb)):1===bc?(mc=O(B,Fb,kb,lc,Nb),qc.x=0,qc.y=p.sign(Ya.longitude-Math.abs(Fb.longitude)),qc.z=0):(qc=O(B,Ya,Mb,$a,Ra),mc.x=0,mc.y=p.sign(Ya.longitude-Fb.longitude),mc.z=0)}var fd=g.distance(zb,Gb),qd=y.fromCartesian(fb,sc),gd=g.subtract(Jb,fb,hb),Qc=g.normalize(gd,tb),Xc=g.subtract(zb,fb,Hb),Xc=g.normalize(Xc,Xc),cd=g.cross(Qc,Xc,tb),cd=g.normalize(cd,cd),Yc=g.cross(Xc,Mb,Jc),Yc=g.normalize(Yc,Yc),Bd=g.subtract(Gb,Jb,db),Bd=g.normalize(Bd,Bd),md=g.cross(kb,Bd,cc),md=g.normalize(md,md),af=fd/ic,$d=kc/ic,Nd=0,Cd,Fd,hd,oe=0,yd=0;if(d){Nd=g.distance($a,lc);Cd=y.fromCartesian($a,Za);Fd=g.subtract(lc,$a,tc);hd=g.normalize(Fd,wc);var pe=hd.x;hd.x=hd.y;hd.y=-pe;oe=Nd/cb;yd=Vb/cb}for(ob=0;8>ob;ob++){var ac=jc+4*ob,Uc=Rb+2*ob,id=ac+3,Zc=4>ob?1:-1,Dd=2===ob||3===ob||6===ob||7===ob?1:-1;g.pack(qd.high,Sb,ac);Sb[id]=gd.x;g.pack(qd.low,Pb,ac);Pb[id]=gd.y;g.pack(Yc,$b,ac);$b[id]=gd.z;g.pack(md,ec,ac);ec[id]=af*Zc;g.pack(cd,Db,ac);var zd=$d*Dd;0===zd&&0>Dd&&(zd=Number.POSITIVE_INFINITY);Db[id]=zd;d&&(Eb[ac]=Cd.high.x,Eb[ac+1]=Cd.high.y,Eb[ac+2]=Cd.low.x,Eb[ac+3]=Cd.low.y,ea[ac]=-qc.y,ea[ac+1]=qc.x,ea[ac+2]=mc.y,ea[ac+3]=-mc.x,eb[ac]=Fd.x,eb[ac+1]=Fd.y,eb[ac+2]=hd.x,eb[ac+3]=hd.y,Qb[Uc]=oe*Zc,zd=yd*Dd,0===zd&&0>Dd&&(zd=Number.POSITIVE_INFINITY),Qb[Uc+1]=zd)}var rd=Oa,sd=Ta,nd=va,dd=Sa,He=I.fromCartographicArray(Ja,Qa),Od=b.getMinimumMaximumHeights(He,Cb),pb=Od.minimumTerrainHeight,ae=Od.maximumTerrainHeight,Tb=Tb+pb,Tb=Tb+ae;Z(fb,zb,pb,ae,rd,nd);Z(Jb,Gb,pb,ae,sd,dd);var od=g.multiplyByScalar(cd,p.EPSILON5,Xb);g.add(rd,od,rd);g.add(sd,od,sd);g.add(nd,od,nd);g.add(dd,od,dd);aa(rd,sd);aa(nd,dd);g.pack(rd,sb,ub);g.pack(sd,sb,ub+3);g.pack(dd,sb,ub+6);g.pack(nd,sb,ub+9);od=g.multiplyByScalar(cd,-2*p.EPSILON5,Xb);g.add(rd,od,rd);g.add(sd,od,sd);g.add(nd,od,nd);g.add(dd,od,dd);aa(rd,sd);aa(nd,dd);g.pack(rd,sb,ub+12);g.pack(sd,sb,ub+15);g.pack(dd,sb,ub+18);g.pack(nd,sb,ub+21);Kb+=2;nb+=3;Rb+=16;ub+=24;jc+=32;kc+=fd;Vb+=Nd}var qe=nb=0;for(lb=0;lb<wb;lb++){for(ob=0;ob<uc;ob++)oc[nb+ob]=ja[ob]+qe;qe+=8;nb+=uc}var be=dc;k.fromVertices(F,g.ZERO,3,be[0]);k.fromVertices(ra,g.ZERO,3,be[1]);var ce=k.fromBoundingSpheres(be);ce.radius+=Tb/(2*wb);var Gd={position:new x({componentDatatype:e.DOUBLE,componentsPerAttribute:3,normalize:!1,values:sb}),startHiAndForwardOffsetX:U(Sb),startLoAndForwardOffsetY:U(Pb),startNormalAndForwardOffsetZ:U($b),endNormalAndTextureCoordinateNormalizationX:U(ec),rightNormalAndTextureCoordinateNormalizationY:U(Db)};d&&(Gd.startHiLo2D=U(Eb),Gd.offsetAndRight2D=U(eb),Gd.startEndNormals2D=U(ea),Gd.texcoordNormalization2D=new x({componentDatatype:e.FLOAT,componentsPerAttribute:2,normalize:!1,values:Qb}));return new z({attributes:Gd,indices:oc,boundingSphere:ce})}};var Da=new g,Ba=new v,ra=new C,Ea=new l,Ga=new g,Ca=new g,ya=new g,Aa=new g,Ua=new g,sa=new l,Va=new l,xa=new g,Ha=new g,Ma=new g,Ia=new g,La=new g,Fa=new g,Ja=[sa,Va],Qa=new I,va=new g,Sa=new g,Oa=new g,Ta=new g,Ka=new g,Wa=new g,Ra=new g,Nb=new g,hb=new g,Hb=new g,db=new g,tb=new g,Jc=new g,cc=new g,sc=new y,Za=new y,tc=new g,wc=new g,Xb=new g,dc=[new k,new k],ja=[0,2,1,0,3,2,0,7,3,0,4,7,0,5,4,0,1,5,5,7,4,5,6,7,5,2,6,5,1,2,3,6,2,3,7,6],uc=ja.length;J._projectNormal=O;return J});F("Core/HeadingPitchRange",["./defaultValue","./defined"],function(b,a){function f(a,f,l){this.heading=b(a,0);this.pitch=b(f,0);this.range=b(l,0)}f.clone=function(b,g){if(a(b))return a(g)||(g=new f),g.heading=b.heading,g.pitch=b.pitch,g.range=b.range,g};return f});F("Core/HermitePolynomialApproximation",["./defaultValue","./defined","./DeveloperError","./Math"],function(b,a,f,k){function g(a,b,d,e,f,k){var c=0,h,l,m;if(0<e){for(l=0;l<f;l++){h=!1;for(m=0;m<k.length&&!h;m++)l===k[m]&&(h=!0);h||(k.push(l),c+=g(a,b,d,e-1,f,k),k.splice(k.length-1,1))}return c}c=1;for(l=0;l<f;l++){h=!1;for(m=0;m<k.length&&!h;m++)l===k[m]&&(h=!0);h||(c*=a-d[b[l]])}return c}var l=k.factorial,m={type:"Hermite",getRequiredDataPoints:function(e,g){g=b(g,0);if(!a(e))throw new f("degree is required.");if(0>e)throw new f("degree must be 0 or greater.");if(0>g)throw new f("inputOrder must be 0 or greater.");return Math.max(Math.floor((e+1)/(g+1)),2)},interpolateOrderZero:function(b,e,d,f,k){a(k)||(k=Array(f));var h,c,m,p,q=e.length,t=Array(f);for(h=0;h<f;h++)for(k[h]=0,m=Array(q),t[h]=m,c=0;c<q;c++)m[c]=[];var x=Array(q);for(h=0;h<q;h++)x[h]=h;var D=q-1;for(m=0;m<f;m++){for(c=0;c<q;c++)p=x[c]*f+m,t[m][0].push(d[p]);for(h=1;h<q;h++){var v=!1;for(c=0;c<q-h;c++){p=e[x[c]];var B=e[x[c+h]],C;0>=B-p?(p=x[c]*f+f*h+m,C=d[p],t[m][h].push(C/l(h))):(C=t[m][h-1][c+1]-t[m][h-1][c],t[m][h].push(C/(B-p)));v=v||0!==C}v||(D=h-1)}}for(d=0;0>=d;d++)for(h=d;h<=D;h++)for(c=g(b,x,e,d,h,[]),m=0;m<f;m++)k[m+d*f]+=t[m][h][0]*c;return k}},e=[];m.interpolate=function(b,f,d,l,m,r,c){var h=l*(r+1);a(c)||(c=Array(h));for(var p=0;p<h;p++)c[p]=0;var p=f.length,h=Array(p*(m+1)),q;for(q=0;q<p;q++)for(var t=0;t<m+1;t++)h[q*(m+1)+t]=q;for(var p=h.length,x,t=-1,D=h.length,v=D*(D+1)/2,B=0;B<l;B++){var C=Math.floor(B*v);for(q=0;q<D;q++)x=h[q]*l*(m+1)+B,e[C+q]=d[x];for(var I=1;I<D;I++){var H=0,J=Math.floor(I*(1-I)/2)+D*I,w=!1;for(q=0;q<D-I;q++){x=f[h[q]];var G=f[h[q+I]],E;0>=G-x?(x=h[q]*l*(m+1)+l*I+B,E=d[x],x=E/k.factorial(I)):(E=Math.floor((I-1)*(2-I)/2)+D*(I-1),E=e[C+E+q+1]-e[C+E+q],x=E/(G-x));e[C+J+H]=x;H++;w=w||0!==E}w&&(t=Math.max(t,I))}}d=t;m=[];t=p*(p+1)/2;r=Math.min(d,r);for(D=0;D<=r;D++)for(q=D;q<=d;q++)for(m.length=0,v=g(b,h,f,D,q,m),B=Math.floor(q*(1-q)/2)+p*q,C=0;C<l;C++)c[C+D*l]+=e[Math.floor(C*t)+B]*v;return c};return m});F("Core/IauOrientationParameters",[],function(){return function(b,a,f,k){this.rightAscension=b;this.declination=a;this.rotation=f;this.rotationRate=k}});F("Core/Iau2000Orientation",["./defined","./IauOrientationParameters","./JulianDate","./Math","./TimeConstants"],function(b,a,f,k,g){var l={},m=new f;l.ComputeMoon=function(e,h){b(e)||(e=f.now());m=f.addSeconds(e,32.184,m);var l=f.totalDays(m)-2451545,d=l/g.DAYS_PER_JULIAN_CENTURY,q=(125.045+-.0529921*l)*k.RADIANS_PER_DEGREE,t=(250.089+-.1059842*l)*k.RADIANS_PER_DEGREE,r=(260.008+13.0120009*l)*k.RADIANS_PER_DEGREE,c=(176.625+13.3407154*l)*k.RADIANS_PER_DEGREE,u=(357.529+.9856003*l)*k.RADIANS_PER_DEGREE,y=(311.589+26.4057084*l)*k.RADIANS_PER_DEGREE,A=(134.963+13.064993*l)*k.RADIANS_PER_DEGREE,z=(276.617+.3287146*l)*k.RADIANS_PER_DEGREE,x=(34.226+1.7484877*l)*k.RADIANS_PER_DEGREE,D=(15.134+-.1589763*l)*k.RADIANS_PER_DEGREE,v=(119.743+.0036096*l)*k.RADIANS_PER_DEGREE,B=(239.961+.1643573*l)*k.RADIANS_PER_DEGREE,C=(25.053+12.9590088*l)*k.RADIANS_PER_DEGREE,I=Math.sin(q),H=Math.sin(t),J=Math.sin(r),w=Math.sin(c),G=Math.sin(y),E=Math.sin(D),L=Math.sin(C),q=Math.cos(q),t=Math.cos(t),r=Math.cos(r),c=Math.cos(c),y=Math.cos(y),K=Math.cos(A),D=Math.cos(D),P=Math.cos(C),C=(269.9949+.0031*d-3.8787*I-.1204*H+.07*J-.0172*w+.0072*G-.0052*E+.0043*L)*k.RADIANS_PER_DEGREE,d=(66.5392+.013*d+1.5419*q+.0239*t-.0278*r+.0068*c-.0029*y+9E-4*K+8E-4*D-9E-4*P)*k.RADIANS_PER_DEGREE,A=(38.3213+13.17635815*l-1.4E-12*l*l+3.561*I+.1208*H-.0642*J+.0158*w+.0252*Math.sin(u)-.0066*G-.0047*Math.sin(A)-.0046*Math.sin(z)+.0028*Math.sin(x)+.0052*E+.004*Math.sin(v)+.0019*Math.sin(B)-.0044*L)*k.RADIANS_PER_DEGREE,l=(13.17635815-2.8E-12*l+-.1887048681*q+-.01280289136*t-.83537045778*r+.0158*c*13.3407154+.02483712756*Math.cos(u)-.17427767544*y-.0614054671*K-.00151208716*Math.cos(z)+.00489576556*Math.cos(x)+.0052*D*-.1589763+1.44384E-5*Math.cos(v)+.0019*Math.cos(B)*.1643573-.05701963872*P)/86400*k.RADIANS_PER_DEGREE;b(h)||(h=new a);h.rightAscension=C;h.declination=d;h.rotation=A;h.rotationRate=l;return h};return l});F("Core/IauOrientationAxes","./Cartesian3 ./defined ./Iau2000Orientation ./JulianDate ./Math ./Matrix3 ./Quaternion".split(" "),function(b,a,f,k,g,l,m){function e(b){a(b)&&"function"===typeof b||(b=f.ComputeMoon);this._computeFunction=b}var h=new b,p=new b,d=new b,q=new l,t=new m;e.prototype.evaluate=function(e,c){a(e)||(e=k.now());var f=this._computeFunction(e),r,A=f.rightAscension,z=f.declination;r=c;h.x=Math.cos(A+g.PI_OVER_TWO);h.y=Math.sin(A+g.PI_OVER_TWO);h.z=0;var x=Math.cos(z);d.x=x*Math.cos(A);d.y=x*Math.sin(A);d.z=Math.sin(z);A=b.cross(d,h,p);a(r)||(r=new l);r[0]=h.x;r[1]=A.x;r[2]=d.x;r[3]=h.y;r[4]=A.y;r[5]=d.y;r[6]=h.z;r[7]=A.z;r[8]=d.z;f=g.zeroToTwoPi(f.rotation);f=m.fromAxisAngle(b.UNIT_Z,f,t);f=l.fromQuaternion(m.conjugate(f,f),q);return l.multiply(f,r,r)};return e});F("Core/InterpolationAlgorithm",["./DeveloperError"],function(b){var a={type:void 0};a.getRequiredDataPoints=b.throwInstantiationError;a.interpolateOrderZero=b.throwInstantiationError;a.interpolate=b.throwInstantiationError;return a});F("Core/PeliasGeocoderService","./Cartesian3 ./Check ./defined ./defineProperties ./GeocodeType ./Rectangle ./Resource".split(" "),function(b,a,f,k,g,l,m){function e(b){a.defined("url",b);this._url=m.createIfNeeded(b);this._url.appendForwardSlash()}k(e.prototype,{url:{get:function(){return this._url}}});e.prototype.geocode=function(e,k){a.typeOf.string("query",e);return this._url.getDerivedResource({url:k===g.AUTOCOMPLETE?"autocomplete":"search",queryParameters:{text:e}}).fetchJson().then(function(a){return a.features.map(function(a){var d;d=a.bbox;d=f(d)?l.fromDegrees(d[0],d[1],d[2],d[3]):b.fromDegrees(a.geometry.coordinates[0],a.geometry.coordinates[1]);return{displayName:a.properties.label,destination:d}})})};return e});F("Core/IonGeocoderService","./Check ./Credit ./defaultValue ./defined ./defineProperties ./Ion ./PeliasGeocoderService ./Rectangle ./Resource".split(" "),function(b,a,f,k,g,l,m,e,h){function p(d){d=f(d,f.EMPTY_OBJECT);b.typeOf.object("options.scene",d.scene);var e=f(d.accessToken,l.defaultAccessToken),g=h.createIfNeeded(f(d.server,l.defaultServer));g.appendForwardSlash();var p=l.getDefaultTokenCredit(e);k(p)&&d.scene.frameState.creditDisplay.addDefaultCredit(a.clone(p));d=g.getDerivedResource({url:"v1/geocode"});k(e)&&d.appendQueryParameters({access_token:e});this._accessToken=e;this._server=g;this._pelias=new m(d)}p.prototype.geocode=function(a,b){return this._pelias.geocode(a,b)};return p});F("Core/TimeInterval","./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./freezeObject ./JulianDate".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this.start=f(b.start)?m.clone(b.start):new m;this.stop=f(b.stop)?m.clone(b.stop):new m;this.data=b.data;this.isStartIncluded=a(b.isStartIncluded,!0);this.isStopIncluded=a(b.isStopIncluded,!0)}k(e.prototype,{isEmpty:{get:function(){var a=m.compare(this.stop,this.start);return 0>a||0===a&&(!this.isStartIncluded||!this.isStopIncluded)}}});var h={start:void 0,stop:void 0,isStartIncluded:void 0,isStopIncluded:void 0,data:void 0};e.fromIso8601=function(k,d){b.typeOf.object("options",k);b.typeOf.string("options.iso8601",k.iso8601);var l=k.iso8601.split("/");if(2!==l.length)throw new g("options.iso8601 is an invalid ISO 8601 interval.");var p=m.fromIso8601(l[0]),l=m.fromIso8601(l[1]),r=a(k.isStartIncluded,!0),c=a(k.isStopIncluded,!0),u=k.data;if(!f(d))return h.start=p,h.stop=l,h.isStartIncluded=r,h.isStopIncluded=c,h.data=u,new e(h);d.start=p;d.stop=l;d.isStartIncluded=r;d.isStopIncluded=c;d.data=u;return d};e.toIso8601=function(a,d){b.typeOf.object("timeInterval",a);return m.toIso8601(a.start,d)+"/"+m.toIso8601(a.stop,d)};e.clone=function(a,b){if(f(a)){if(!f(b))return new e(a);b.start=a.start;b.stop=a.stop;b.isStartIncluded=a.isStartIncluded;b.isStopIncluded=a.isStopIncluded;b.data=a.data;return b}};e.equals=function(a,b,e){return a===b||f(a)&&f(b)&&(a.isEmpty&&b.isEmpty||a.isStartIncluded===b.isStartIncluded&&a.isStopIncluded===b.isStopIncluded&&m.equals(a.start,b.start)&&m.equals(a.stop,b.stop)&&(a.data===b.data||f(e)&&e(a.data,b.data)))};e.equalsEpsilon=function(a,d,e,h){b.typeOf.number("epsilon",e);return a===d||f(a)&&f(d)&&(a.isEmpty&&d.isEmpty||a.isStartIncluded===d.isStartIncluded&&a.isStopIncluded===d.isStopIncluded&&m.equalsEpsilon(a.start,d.start,e)&&m.equalsEpsilon(a.stop,d.stop,e)&&(a.data===d.data||f(h)&&h(a.data,d.data)))};e.intersect=function(a,d,h,g){b.typeOf.object("left",a);b.typeOf.object("result",h);if(!f(d))return e.clone(e.EMPTY,h);var k=a.start,c=a.stop,l=d.start,p=d.stop,q=m.greaterThanOrEquals(l,k)&&m.greaterThanOrEquals(c,l),t=!q&&m.lessThanOrEquals(l,k)&&m.lessThanOrEquals(k,p);if(!q&&!t)return e.clone(e.EMPTY,h);var x=a.isStartIncluded,D=a.isStopIncluded,v=d.isStartIncluded,B=d.isStopIncluded,C=m.lessThan(c,p);h.start=q?l:k;h.isStartIncluded=x&&v||!m.equals(l,k)&&(q&&v||t&&x);h.stop=C?c:p;h.isStopIncluded=C?D:D&&B||!m.equals(p,c)&&B;h.data=f(g)?g(a.data,d.data):a.data;return h};e.contains=function(a,d){b.typeOf.object("timeInterval",a);b.typeOf.object("julianDate",d);if(a.isEmpty)return!1;var e=m.compare(a.start,d);if(0===e)return a.isStartIncluded;var f=m.compare(d,a.stop);return 0===f?a.isStopIncluded:0>e&&0>f};e.prototype.clone=function(a){return e.clone(this,a)};e.prototype.equals=function(a,b){return e.equals(this,a,b)};e.prototype.equalsEpsilon=function(a,b,f){return e.equalsEpsilon(this,a,b,f)};e.prototype.toString=function(){return e.toIso8601(this)};e.EMPTY=l(new e({start:new m,stop:new m,isStartIncluded:!1,isStopIncluded:!1}));return e});F("Core/Iso8601",["./freezeObject","./JulianDate","./TimeInterval"],function(b,a,f){var k=b(a.fromIso8601("0000-01-01T00:00:00Z"));a=b(a.fromIso8601("9999-12-31T24:00:00Z"));b=b(new f({start:k,stop:a}));return{MINIMUM_VALUE:k,MAXIMUM_VALUE:a,MAXIMUM_INTERVAL:b}});F("Core/KeyboardEventModifier",["./freezeObject"],function(b){return b({SHIFT:0,CTRL:1,ALT:2})});F("Core/LagrangePolynomialApproximation",["./defined"],function(b){return{type:"Lagrange",getRequiredDataPoints:function(a){return Math.max(a+1,2)},interpolateOrderZero:function(a,f,k,g,l){b(l)||(l=Array(g));var m,e,h=f.length;for(m=0;m<g;m++)l[m]=0;for(m=0;m<h;m++){var p=1;for(e=0;e<h;e++)e!==m&&(p*=(a-f[e])/(f[m]-f[e]));for(e=0;e<g;e++)l[e]+=p*k[m*g+e]}return l}}});F("Core/LinearApproximation",["./defined","./DeveloperError"],function(b,a){return{type:"Linear",getRequiredDataPoints:function(a){return 2},interpolateOrderZero:function(f,k,g,l,m){if(2!==k.length)throw new a("The xTable provided to the linear interpolator must have exactly two elements.");if(0>=l)throw new a("There must be at least 1 dependent variable for each independent variable.");b(m)||(m=Array(l));var e,h,p=k[0],d=k[1];if(p===d)throw new a("Divide by zero error: xTable[0] and xTable[1] are equal");for(k=0;k<l;k++)e=g[k],h=g[k+l],m[k]=((h-e)*f+d*e-p*h)/(d-p);return m}}});F("Core/loadCRN","../ThirdParty/when ./CompressedTextureBuffer ./defined ./DeveloperError ./Resource ./TaskProcessor".split(" "),function(b,a,f,k,g,l){var m=new l("transcodeCRNToDXT",Number.POSITIVE_INFINITY);return function(e){if(!f(e))throw new k("resourceOrUrlOrBuffer is required.");e=e instanceof ArrayBuffer||ArrayBuffer.isView(e)?b.resolve(e):g.createIfNeeded(e).fetchArrayBuffer();if(f(e))return e.then(function(a){if(f(a)){var b=[];if(a instanceof ArrayBuffer)b.push(a);else{if(0!==a.byteOffset||a.byteLength!==a.buffer.byteLength)a=a.slice(0,a.length);b.push(a.buffer)}return m.scheduleTask(a,b)}}).then(function(b){return a.clone(b)})}});F("Core/loadImageFromTypedArray","../ThirdParty/when ./Check ./defined ./defaultValue ./FeatureDetection ./Resource".split(" "),function(b,a,f,k,g,l){return function(g){var e=g.uint8Array,h=g.format,m=g.request,d=k(g.flipY,!1);a.typeOf.object("uint8Array",e);a.typeOf.string("format",h);var q=new Blob([e],{type:h}),t;return l.supportsImageBitmapOptions().then(function(a){if(a)return b(l.createImageBitmapFromBlob(q,{flipY:d,premultiplyAlpha:!1}));t=window.URL.createObjectURL(q);return(new l({url:t,request:m})).fetchImage({flipY:d})}).then(function(a){f(t)&&window.URL.revokeObjectURL(t);return a}).otherwise(function(a){f(t)&&window.URL.revokeObjectURL(t);return b.reject(a)})}});F("Renderer/PixelDatatype",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={UNSIGNED_BYTE:a.UNSIGNED_BYTE,UNSIGNED_SHORT:a.UNSIGNED_SHORT,UNSIGNED_INT:a.UNSIGNED_INT,FLOAT:a.FLOAT,HALF_FLOAT:a.HALF_FLOAT_OES,UNSIGNED_INT_24_8:a.UNSIGNED_INT_24_8,UNSIGNED_SHORT_4_4_4_4:a.UNSIGNED_SHORT_4_4_4_4,UNSIGNED_SHORT_5_5_5_1:a.UNSIGNED_SHORT_5_5_5_1,UNSIGNED_SHORT_5_6_5:a.UNSIGNED_SHORT_5_6_5,isPacked:function(a){return a===f.UNSIGNED_INT_24_8||a===f.UNSIGNED_SHORT_4_4_4_4||a===f.UNSIGNED_SHORT_5_5_5_1||a===f.UNSIGNED_SHORT_5_6_5},sizeInBytes:function(a){switch(a){case f.UNSIGNED_BYTE:return 1;case f.UNSIGNED_SHORT:case f.UNSIGNED_SHORT_4_4_4_4:case f.UNSIGNED_SHORT_5_5_5_1:case f.UNSIGNED_SHORT_5_6_5:case f.HALF_FLOAT:return 2;case f.UNSIGNED_INT:case f.FLOAT:case f.UNSIGNED_INT_24_8:return 4}},validate:function(a){return a===f.UNSIGNED_BYTE||a===f.UNSIGNED_SHORT||a===f.UNSIGNED_INT||a===f.FLOAT||a===f.HALF_FLOAT||a===f.UNSIGNED_INT_24_8||a===f.UNSIGNED_SHORT_4_4_4_4||a===f.UNSIGNED_SHORT_5_5_5_1||a===f.UNSIGNED_SHORT_5_6_5}};return b(f)});F("Core/PixelFormat",["../Renderer/PixelDatatype","./freezeObject","./WebGLConstants"],function(b,a,f){var k={DEPTH_COMPONENT:f.DEPTH_COMPONENT,DEPTH_STENCIL:f.DEPTH_STENCIL,ALPHA:f.ALPHA,RGB:f.RGB,RGBA:f.RGBA,LUMINANCE:f.LUMINANCE,LUMINANCE_ALPHA:f.LUMINANCE_ALPHA,RGB_DXT1:f.COMPRESSED_RGB_S3TC_DXT1_EXT,RGBA_DXT1:f.COMPRESSED_RGBA_S3TC_DXT1_EXT,RGBA_DXT3:f.COMPRESSED_RGBA_S3TC_DXT3_EXT,RGBA_DXT5:f.COMPRESSED_RGBA_S3TC_DXT5_EXT,RGB_PVRTC_4BPPV1:f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,RGB_PVRTC_2BPPV1:f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,RGBA_PVRTC_4BPPV1:f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,RGBA_PVRTC_2BPPV1:f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,RGB_ETC1:f.COMPRESSED_RGB_ETC1_WEBGL,componentsLength:function(a){switch(a){case k.RGB:return 3;case k.RGBA:return 4;case k.LUMINANCE_ALPHA:return 2;case k.ALPHA:case k.LUMINANCE:return 1;default:return 1}},validate:function(a){return a===k.DEPTH_COMPONENT||a===k.DEPTH_STENCIL||a===k.ALPHA||a===k.RGB||a===k.RGBA||a===k.LUMINANCE||a===k.LUMINANCE_ALPHA||a===k.RGB_DXT1||a===k.RGBA_DXT1||a===k.RGBA_DXT3||a===k.RGBA_DXT5||a===k.RGB_PVRTC_4BPPV1||a===k.RGB_PVRTC_2BPPV1||a===k.RGBA_PVRTC_4BPPV1||a===k.RGBA_PVRTC_2BPPV1||a===k.RGB_ETC1},isColorFormat:function(a){return a===k.ALPHA||a===k.RGB||a===k.RGBA||a===k.LUMINANCE||a===k.LUMINANCE_ALPHA},isDepthFormat:function(a){return a===k.DEPTH_COMPONENT||a===k.DEPTH_STENCIL},isCompressedFormat:function(a){return a===k.RGB_DXT1||a===k.RGBA_DXT1||a===k.RGBA_DXT3||a===k.RGBA_DXT5||a===k.RGB_PVRTC_4BPPV1||a===k.RGB_PVRTC_2BPPV1||a===k.RGBA_PVRTC_4BPPV1||a===k.RGBA_PVRTC_2BPPV1||a===k.RGB_ETC1},isDXTFormat:function(a){return a===k.RGB_DXT1||a===k.RGBA_DXT1||a===k.RGBA_DXT3||a===k.RGBA_DXT5},isPVRTCFormat:function(a){return a===k.RGB_PVRTC_4BPPV1||a===k.RGB_PVRTC_2BPPV1||a===k.RGBA_PVRTC_4BPPV1||a===k.RGBA_PVRTC_2BPPV1},isETC1Format:function(a){return a===k.RGB_ETC1},compressedTextureSizeInBytes:function(a,b,f){switch(a){case k.RGB_DXT1:case k.RGBA_DXT1:case k.RGB_ETC1:return Math.floor((b+3)/4)*Math.floor((f+3)/4)*8;case k.RGBA_DXT3:case k.RGBA_DXT5:return Math.floor((b+3)/4)*Math.floor((f+3)/4)*16;case k.RGB_PVRTC_4BPPV1:case k.RGBA_PVRTC_4BPPV1:return Math.floor((Math.max(b,8)*Math.max(f,8)*4+7)/8);case k.RGB_PVRTC_2BPPV1:case k.RGBA_PVRTC_2BPPV1:return Math.floor((Math.max(b,16)*Math.max(f,8)*2+7)/8);default:return 0}},textureSizeInBytes:function(a,f,m,e){a=k.componentsLength(a);b.isPacked(f)&&(a=1);return a*b.sizeInBytes(f)*m*e},alignmentInBytes:function(a,b,f){a=k.textureSizeInBytes(a,b,f,1)%4;return 0===a?4:2===a?2:1},createTypedArray:function(a,f,m,e){var h=b.sizeInBytes(f);f=h===Uint8Array.BYTES_PER_ELEMENT?Uint8Array:h===Uint16Array.BYTES_PER_ELEMENT?Uint16Array:h===Float32Array.BYTES_PER_ELEMENT&&f===b.FLOAT?Float32Array:Uint32Array;a=k.componentsLength(a)*m*e;return new f(a)},flipY:function(a,b,f,e,h){if(1===h)return a;f=k.createTypedArray(b,f,e,h);b=k.componentsLength(b);e*=b;for(var g=0;g<h;++g)for(var d=g*h*b,l=(h-g-1)*h*b,m=0;m<e;++m)f[l+m]=a[d+m];return f}};return a(k)});F("Core/loadKTX","../ThirdParty/when ./Check ./CompressedTextureBuffer ./defined ./PixelFormat ./Resource ./RuntimeError ./WebGLConstants".split(" "),function(b,a,f,k,g,l,m,e){var h=[171,75,84,88,32,49,49,187,13,10,26,10],p="positiveX negativeX positiveY negativeY positiveZ negativeZ".split(" ");return function(d){a.defined("resourceOrUrlOrBuffer",d);d=d instanceof ArrayBuffer||ArrayBuffer.isView(d)?b.resolve(d):l.createIfNeeded(d).fetchArrayBuffer();if(k(d))return d.then(function(a){if(k(a)){var b=new Uint8Array(a),d=!0,c;for(c=0;c<h.length;++c)if(h[c]!==b[c]){d=!1;break}if(!d)throw new m("Invalid KTX file.");var l;k(a.buffer)?(l=new DataView(a.buffer),c=a.byteOffset):(l=new DataView(a),c=0);c+=12;b=l.getUint32(c,!0);c+=4;if(67305985!==b)throw new m("File is the wrong endianness.");var q=l.getUint32(c,!0);c+=4;var A=l.getUint32(c,!0);c+=4;var z=l.getUint32(c,!0);c+=4;var x=l.getUint32(c,!0);c+=4;var D=l.getUint32(c,!0);c+=4;var v=l.getUint32(c,!0);c+=4;var B=l.getUint32(c,!0);c+=4;var C=l.getUint32(c,!0);c+=4;var I=l.getUint32(c,!0);c+=4;b=l.getUint32(c,!0);c+=4;d=l.getUint32(c,!0);c+=4;var H=l.getUint32(c,!0);c=c+4+H;l=l.getUint32(c,!0);c+=4;a=k(a.buffer)?new Uint8Array(a.buffer,c,l):new Uint8Array(a,c,l);x===e.RGB8?x=g.RGB:x===e.RGBA8&&(x=g.RGBA);if(!g.validate(x))throw new m("glInternalFormat is not a valid format.");if(g.isCompressedFormat(x)){if(0!==q)throw new m("glType must be zero when the texture is compressed.");if(1!==A)throw new m("The type size for compressed textures must be 1.");if(0!==z)throw new m("glFormat must be zero when the texture is compressed.");}else{if(q!==e.UNSIGNED_BYTE)throw new m("Only unsigned byte buffers are supported.");if(D!==z)throw new m("The base internal format must be the same as the format for uncompressed textures.");}if(0!==C)throw new m("3D textures are unsupported.");if(0!==I)throw new m("Texture arrays are unsupported.");A=a.byteOffset;z=Array(d);for(c=0;c<d;++c){D=z[c]={};for(C=0;C<b;++C){I=v>>c;l=B>>c;var H=g.isCompressedFormat(x)?g.compressedTextureSizeInBytes(x,I,l):g.textureSizeInBytes(x,q,I,l),J=new Uint8Array(a.buffer,A,H);D[p[C]]=new f(x,I,l,J);A+=H}A+=3-(A+3)%4+4}q=z;if(1===b)for(c=0;c<d;++c)q[c]=q[c][p[0]];1===d&&(q=q[0]);return q}})}});F("Core/ManagedArray",["./Check","./defaultValue","./defineProperties"],function(b,a,f){function k(b){b=a(b,0);this._array=Array(b);this._length=b}f(k.prototype,{length:{get:function(){return this._length},set:function(a){this._length=a;a>this._array.length&&(this._array.length=a)}},values:{get:function(){return this._array}}});k.prototype.get=function(a){b.typeOf.number.lessThan("index",a,this._array.length);return this._array[a]};k.prototype.set=function(a,f){b.typeOf.number("index",a);a>=this.length&&(this.length=a+1);this._array[a]=f};k.prototype.peek=function(){return this._array[this._length-1]};k.prototype.push=function(a){var b=this.length++;this._array[b]=a};k.prototype.pop=function(){return this._array[--this.length]};k.prototype.reserve=function(a){b.typeOf.number.greaterThanOrEquals("length",a,0);a>this._array.length&&(this._array.length=a)};k.prototype.resize=function(a){b.typeOf.number.greaterThanOrEquals("length",a,0);this.length=a};k.prototype.trim=function(b){b=a(b,this.length);this._array.length=b};return k});F("Core/MapboxApi",["./Credit","./defined"],function(b,a){var f={defaultAccessToken:void 0},k=!1,g;f.getAccessToken=function(b){return a(b)?b:a(f.defaultAccessToken)?f.defaultAccessToken:(k||(console.log("\x3cb\x3eThis application is using Cesium's default Mapbox access token.  Please create a new access token for the application as soon as possible and prior to deployment by visiting \x3ca href\x3dhttps://www.mapbox.com/account/apps/\x3ehttps://www.mapbox.com/account/apps/\x3c/a\x3e, and provide your token to Cesium by setting the Cesium.MapboxApi.defaultAccessToken property before constructing the CesiumWidget or any other object that uses the Mapbox API.\x3c/b\x3e"),k=!0),"pk.eyJ1IjoiYW5hbHl0aWNhbGdyYXBoaWNzIiwiYSI6ImNpd204Zm4wejAwNzYyeW5uNjYyZmFwdWEifQ.7i-VIZZWX8pd1bTfxIVj9g")};f.getErrorCredit=function(k){if(!a(k)&&!a(f.defaultAccessToken))return a(g)||(g=new b("\x3cb\x3eThis application is using Cesium's default Mapbox access token.  Please create a new access token for the application as soon as possible and prior to deployment by visiting \x3ca href\x3dhttps://www.mapbox.com/account/apps/\x3ehttps://www.mapbox.com/account/apps/\x3c/a\x3e, and provide your token to Cesium by setting the Cesium.MapboxApi.defaultAccessToken property before constructing the CesiumWidget or any other object that uses the Mapbox API.\x3c/b\x3e",!0)),g};return f});F("Core/MapProjection",["./defineProperties","./DeveloperError"],function(b,a){function f(){a.throwInstantiationError()}b(f.prototype,{ellipsoid:{get:a.throwInstantiationError}});f.prototype.project=a.throwInstantiationError;f.prototype.unproject=a.throwInstantiationError;return f});F("Core/mergeSort",["./defined","./DeveloperError"],function(b,a){function f(a,b,e,h,p){if(!(h>=p)){var d=Math.floor(.5*(h+p));f(a,b,e,h,d);f(a,b,e,d+1,p);var l=d-h+1,m=p-d,r=k,c=g,u,y;for(u=0;u<l;++u)r[u]=a[h+u];for(y=0;y<m;++y)c[y]=a[d+y+1];for(y=u=0;h<=p;++h){var d=r[u],A=c[y];u<l&&(y>=m||0>=b(d,A,e))?(a[h]=d,++u):y<m&&(a[h]=A,++y)}}}var k=[],g=[];return function(l,m,e){if(!b(l))throw new a("array is required.");if(!b(m))throw new a("comparator is required.");var h=l.length,p=Math.ceil(.5*h);k.length=p;g.length=p;f(l,m,e,0,h-1);k.length=0;g.length=0}});F("Core/NearFarScalar",["./defaultValue","./defined","./DeveloperError"],function(b,a,f){function k(a,f,k,e){this.near=b(a,0);this.nearValue=b(f,0);this.far=b(k,1);this.farValue=b(e,0)}k.clone=function(b,f){if(a(b)){if(!a(f))return new k(b.near,b.nearValue,b.far,b.farValue);f.near=b.near;f.nearValue=b.nearValue;f.far=b.far;f.farValue=b.farValue;return f}};k.packedLength=4;k.pack=function(g,k,m){if(!a(g))throw new f("value is required");if(!a(k))throw new f("array is required");m=b(m,0);k[m++]=g.near;k[m++]=g.nearValue;k[m++]=g.far;k[m]=g.farValue;return k};k.unpack=function(g,l,m){if(!a(g))throw new f("array is required");l=b(l,0);a(m)||(m=new k);m.near=g[l++];m.nearValue=g[l++];m.far=g[l++];m.farValue=g[l];return m};k.equals=function(b,f){return b===f||a(b)&&a(f)&&b.near===f.near&&b.nearValue===f.nearValue&&b.far===f.far&&b.farValue===f.farValue};k.prototype.clone=function(a){return k.clone(this,a)};k.prototype.equals=function(a){return k.equals(this,a)};return k});F("Core/Visibility",["./freezeObject"],function(b){return b({NONE:-1,PARTIAL:0,FULL:1})});F("Core/Occluder","./BoundingSphere ./Cartesian3 ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./Math ./Rectangle ./Visibility".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(c,b){if(!k(c))throw new l("occluderBoundingSphere is required.");if(!k(b))throw new l("camera position is required.");this._occluderPosition=a.clone(c.center);this._occluderRadius=c.radius;this._horizonDistance=0;this._cameraPosition=this._horizonPlanePosition=this._horizonPlaneNormal=void 0;this.cameraPosition=b}var q=new a;g(d.prototype,{position:{get:function(){return this._occluderPosition}},radius:{get:function(){return this._occluderRadius}},cameraPosition:{set:function(c){if(!k(c))throw new l("cameraPosition is required.");c=a.clone(c,this._cameraPosition);var b=a.subtract(this._occluderPosition,c,q),d=a.magnitudeSquared(b),e=this._occluderRadius*this._occluderRadius,f,h;d>e?(e=Math.sqrt(d-e),d=1/Math.sqrt(d),f=a.multiplyByScalar(b,d,q),h=a.add(c,a.multiplyByScalar(f,e*e*d,q),q)):e=Number.MAX_VALUE;this._horizonDistance=e;this._horizonPlaneNormal=f;this._horizonPlanePosition=h;this._cameraPosition=c}}});d.fromBoundingSphere=function(c,b,e){if(!k(c))throw new l("occluderBoundingSphere is required.");if(!k(b))throw new l("camera position is required.");if(!k(e))return new d(c,b);a.clone(c.center,e._occluderPosition);e._occluderRadius=c.radius;e.cameraPosition=b;return e};var t=new a;d.prototype.isPointVisible=function(c){if(this._horizonDistance!==Number.MAX_VALUE){var b=a.subtract(c,this._occluderPosition,t),d=this._occluderRadius,d=a.magnitudeSquared(b)-d*d;if(0<d)return d=Math.sqrt(d)+this._horizonDistance,b=a.subtract(c,this._cameraPosition,b),d*d>a.magnitudeSquared(b)}return!1};var r=new a;d.prototype.isBoundingSphereVisible=function(c){var b=a.clone(c.center,r),d=c.radius;if(this._horizonDistance!==Number.MAX_VALUE){var e=a.subtract(b,this._occluderPosition,t);c=this._occluderRadius-d;c=a.magnitudeSquared(e)-c*c;if(d<this._occluderRadius)return 0<c?(c=Math.sqrt(c)+this._horizonDistance,e=a.subtract(b,this._cameraPosition,e),c*c+d*d>a.magnitudeSquared(e)):!1;if(0<c){e=a.subtract(b,this._cameraPosition,e);b=a.magnitudeSquared(e);e=this._occluderRadius*this._occluderRadius;d*=d;if((this._horizonDistance*this._horizonDistance+e)*d>b*e)return!0;c=Math.sqrt(c)+this._horizonDistance;return c*c+d>b}return!0}return!1};var c=new a;d.prototype.computeVisibility=function(b){if(!k(b))throw new l("occludeeBS is required.");var d=a.clone(b.center);b=b.radius;if(b>this._occluderRadius)return p.FULL;if(this._horizonDistance!==Number.MAX_VALUE){var e=a.subtract(d,this._occluderPosition,c),f=this._occluderRadius-b,h=a.magnitudeSquared(e),f=h-f*f;if(0<f){var f=Math.sqrt(f)+this._horizonDistance,e=a.subtract(d,this._cameraPosition,e),g=a.magnitudeSquared(e);if(f*f+b*b<g)return p.NONE;f=this._occluderRadius+b;f=h-f*f;if(0<f)return f=Math.sqrt(f)+this._horizonDistance,g<f*f+b*b?p.FULL:p.PARTIAL;e=a.subtract(d,this._horizonPlanePosition,e);return a.dot(e,this._horizonPlaneNormal)>-b?p.PARTIAL:p.FULL}}return p.NONE};var u=new a;d.computeOccludeePoint=function(c,b,e){if(!k(c))throw new l("occluderBoundingSphere is required.");if(!k(e))throw new l("positions is required.");if(0===e.length)throw new l("positions must contain at least one element");var f=a.clone(b),h=a.clone(c.center),g=c.radius,m=e.length;if(a.equals(h,b))throw new l("occludeePosition must be different than occluderBoundingSphere.center");b=a.normalize(a.subtract(f,h,u),u);var f=-a.dot(b,h),p=d._anyRotationVector(h,b,f),q=d._horizonToPlaneNormalDotProduct(c,b,f,p,e[0]);if(q){for(var v,r=1;r<m;++r){v=d._horizonToPlaneNormalDotProduct(c,b,f,p,e[r]);if(!v)return;v<q&&(q=v)}if(!(.0017453283658983088>q))return a.add(h,a.multiplyByScalar(b,g/q,u),u)}};var y=[];d.computeOccludeePointFromRectangle=function(c,e){if(!k(c))throw new l("rectangle is required.");e=f(e,m.WGS84);var g=h.subsample(c,e,0,y),p=b.fromPoints(g),q=a.ZERO;if(!a.equals(q,p.center))return d.computeOccludeePoint(new b(q,e.minimumRadius),p.center,g)};var A=new a;d._anyRotationVector=function(c,b,d){var e=a.abs(b,A),f=e.x>e.y?0:1;if(0===f&&e.z>e.x||1===f&&e.z>e.y)f=2;var h=new a;0===f?(e.x=c.x,e.y=c.y+1,e.z=c.z+1,f=a.UNIT_X):1===f?(e.x=c.x+1,e.y=c.y,e.z=c.z+1,f=a.UNIT_Y):(e.x=c.x+1,e.y=c.y+1,e.z=c.z,f=a.UNIT_Z);b=(a.dot(b,e)+d)/-a.dot(b,f);return a.normalize(a.subtract(a.add(e,a.multiplyByScalar(f,b,h),e),c,e),e)};var z=new a;d._rotationVector=function(c,b,d,f,h){c=a.subtract(f,c,z);c=a.normalize(c,c);return.9999999847691291>a.dot(b,c)&&(b=a.cross(b,c,c),a.magnitude(b)>e.EPSILON13)?a.normalize(b,new a):h};var x=new a,D=new a,v=new a,B=new a;d._horizonToPlaneNormalDotProduct=function(c,b,d,e,f){var h=a.clone(f,x);f=a.clone(c.center,D);var g=c.radius;c=a.subtract(f,h,v);var k=a.magnitudeSquared(c),g=g*g;if(k<g)return!1;var g=k-g,l=Math.sqrt(g),l=1/Math.sqrt(k)*l*l;c=a.normalize(c,c);k=a.add(h,a.multiplyByScalar(c,l,B),B);g=Math.sqrt(g-l*l);d=this._rotationVector(f,b,d,h,e);d=a.fromElements(d.x*d.x*c.x+(d.x*d.y-d.z)*c.y+(d.x*d.z+d.y)*c.z,(d.x*d.y+d.z)*c.x+d.y*d.y*c.y+(d.y*d.z-d.x)*c.z,(d.x*d.z-d.y)*c.x+(d.y*d.z+d.x)*c.y+d.z*d.z*c.z,x);d=a.normalize(d,d);h=a.multiplyByScalar(d,g,x);d=a.normalize(a.subtract(a.add(k,h,v),f,v),v);e=a.dot(b,d);d=a.normalize(a.subtract(a.subtract(k,h,d),f,d),d);b=a.dot(b,d);return e<b?e:b};return d});F("Core/OffsetGeometryInstanceAttribute",["./Check","./ComponentDatatype","./defaultValue","./defined","./defineProperties"],function(b,a,f,k,g){function l(a,b,h){a=f(a,0);b=f(b,0);h=f(h,0);this.value=new Float32Array([a,b,h])}g(l.prototype,{componentDatatype:{get:function(){return a.FLOAT}},componentsPerAttribute:{get:function(){return 3}},normalize:{get:function(){return!1}}});l.fromCartesian3=function(a){b.defined("offset",a);return new l(a.x,a.y,a.z)};l.toValue=function(a,e){b.defined("offset",a);k(e)||(e=new Float32Array([a.x,a.y,a.z]));e[0]=a.x;e[1]=a.y;e[2]=a.z;return e};return l});F("Core/OpenCageGeocoderService","./Cartesian3 ./Check ./combine ./defaultValue ./defined ./defineProperties ./GeocodeType ./Rectangle ./Resource".split(" "),function(b,a,f,k,g,l,m,e,h){function p(b,e,f){a.defined("url",b);a.defined("apiKey",e);g(f)&&a.typeOf.object("params",f);b=h.createIfNeeded(b);b.appendForwardSlash();b.setQueryParameters({key:e});this._url=b;this._params=k(f,{})}l(p.prototype,{url:{get:function(){return this._url}},params:{get:function(){return this._params}}});p.prototype.geocode=function(d){a.typeOf.string("query",d);return this._url.getDerivedResource({url:"json",queryParameters:f(this._params,{q:d})}).fetchJson().then(function(a){return a.results.map(function(a){var d;d=a.bounds;d=g(d)?e.fromDegrees(d.southwest.lng,d.southwest.lat,d.northeast.lng,d.northeast.lat):b.fromDegrees(a.geometry.lat,a.geometry.lng);return{displayName:a.formatted,destination:d}})})};return p});F("Core/Packable",["./DeveloperError"],function(b){return{packedLength:void 0,pack:b.throwInstantiationError,unpack:b.throwInstantiationError}});F("Core/PackableForInterpolation",["./DeveloperError"],function(b){return{packedInterpolationLength:void 0,convertPackedArrayForInterpolation:b.throwInstantiationError,unpackInterpolationResult:b.throwInstantiationError}});F("ThirdParty/measureText",[],function(){var b=function(a,b){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)};return function(a,f,k,g){var l=a.measureText(f),m=b(a.canvas,"font-family"),e=b(a.canvas,"font-size").replace("px",""),h=b(a.canvas,"font-style"),p=b(a.canvas,"font-weight"),d=!/\S/.test(f);l.fontsize=e;var q=document.createElement("div");q.style.position="absolute";q.style.opacity=0;q.style.font=h+" "+p+" "+e+"px "+m;q.innerHTML=f+"\x3cbr/\x3e"+f;document.body.appendChild(q);l.leading=1.2*e;var t=b(q,"height"),t=t.replace("px","");t>=2*e&&(l.leading=t/2|0);document.body.removeChild(q);if(d)l.ascent=0,l.descent=0,l.bounds={minx:0,maxx:l.width,miny:0,maxy:0},l.height=0;else{q=document.createElement("canvas");q.width=l.width+100;q.height=3*e;q.style.opacity=1;q.style.fontFamily=m;q.style.fontSize=e;q.style.fontStyle=h;q.style.fontWeight=p;d=q.getContext("2d");d.font=h+" "+p+" "+e+"px "+m;e=q.width;h=q.height;m=h/2;d.fillStyle="white";d.fillRect(-1,-1,e+2,h+2);k&&(d.strokeStyle="black",d.lineWidth=a.lineWidth,d.strokeText(f,50,m));g&&(d.fillStyle="black",d.fillText(f,50,m));a=d.getImageData(0,0,e,h).data;f=0;k=4*e;for(g=a.length;++f<g&&255===a[f];);e=f/k|0;for(f=g-1;0<--f&&255===a[f];);h=f/k|0;for(f=0;f<g&&255===a[f];)f+=k,f>=g&&(f=f-g+4);p=f%k/4|0;d=1;for(f=g-3;0<=f&&255===a[f];)f-=k,0>f&&(f=g-3-4*d++);l.ascent=m-e;l.descent=h-m;l.bounds={minx:p-50,maxx:(f%k/4+1|0)-50,miny:0,maxy:h-e};l.height=1+(h-e)}return l}});F("Core/writeTextToCanvas",["../ThirdParty/measureText","./Color","./defaultValue","./defined","./DeveloperError"],function(b,a,f,k,g){var l;return function(m,e){if(!k(m))throw new g("text is required.");if(""!==m){e=f(e,f.EMPTY_OBJECT);var h=f(e.font,"10px sans-serif"),p=f(e.stroke,!1),d=f(e.fill,!0),q=f(e.strokeWidth,1),t=f(e.backgroundColor,a.TRANSPARENT),r=f(e.padding,0),c=2*r,u=document.createElement("canvas");u.width=1;u.height=1;u.style.font=h;var y=u.getContext("2d");k(l)||(k(y.imageSmoothingEnabled)?l="imageSmoothingEnabled":k(y.mozImageSmoothingEnabled)?l="mozImageSmoothingEnabled":k(y.webkitImageSmoothingEnabled)?l="webkitImageSmoothingEnabled":k(y.msImageSmoothingEnabled)&&(l="msImageSmoothingEnabled"));y.font=h;y.lineJoin="round";y.lineWidth=q;y[l]=!1;y.textBaseline=f(e.textBaseline,"bottom");u.style.visibility="hidden";document.body.appendChild(u);var A=b(y,m,p,d);u.dimensions=A;document.body.removeChild(u);u.style.visibility="";var z=-A.bounds.minx,x=A.height+c,D=x-(x-A.ascent+c)+c;u.width=Math.ceil(A.width)+z+c;u.height=x;y.font=h;y.lineJoin="round";y.lineWidth=q;y[l]=!1;t!==a.TRANSPARENT&&(y.fillStyle=t.toCssColorString(),y.fillRect(0,0,u.width,u.height));p&&(h=f(e.strokeColor,a.BLACK),y.strokeStyle=h.toCssColorString(),y.strokeText(m,z+r,D));d&&(d=f(e.fillColor,a.WHITE),y.fillStyle=d.toCssColorString(),y.fillText(m,z+r,D));return u}}});F("Core/PinBuilder","./buildModuleUrl ./Color ./defined ./defaultValue ./DeveloperError ./Resource ./writeTextToCanvas".split(" "),function(b,a,f,k,g,l,m){function e(a){this._cache={};a=k(a,k.EMPTY_OBJECT);this.font=k(a.font,"30px sans-serif");this.stroke=k(a.stroke,!0)}function h(a,c,b,d){a.save();a.scale(b/24,b/24);a.fillStyle=c.toCssColorString();a.strokeStyle=c.brighten(.6,q).toCssColorString();a.beginPath();a.moveTo(6.72,.422);a.lineTo(17.28,.422);a.bezierCurveTo(18.553,.422,19.577,1.758,19.577,3.415);a.lineTo(19.577,10.973);a.bezierCurveTo(19.577,12.63,18.553,13.966,17.282,13.966);a.lineTo(14.386,14.008);a.lineTo(11.826,23.578);a.lineTo(9.614,14.008);a.lineTo(6.719,13.965);a.bezierCurveTo(5.446,13.983,4.422,12.629,4.422,10.972);a.lineTo(4.422,3.416);a.bezierCurveTo(4.423,1.76,5.447,.423,6.718,.423);a.closePath();a.fill();f(d)&&!0===d&&a.stroke();a.restore()}function p(b,c,d,e,h){var g=d/2.5*(c.width/24),k=g,l=g;c.width>c.height?l=c.height/c.width*g:c.width<c.height&&(k=c.width/c.height*g);g=Math.round((d-k)/2);d=Math.round(7/24*d-l/2);b.globalCompositeOperation="destination-out";b.drawImage(c,g-1,d,k,l);b.drawImage(c,g,d-1,k,l);b.drawImage(c,g+1,d,k,l);b.drawImage(c,g,d+1,k,l);b.globalCompositeOperation="destination-over";b.fillStyle=e.toCssColorString();b.fillRect(g-1,d-1,k+2,l+2);b.globalCompositeOperation="destination-out";b.drawImage(c,g,d,k,l);b.globalCompositeOperation="destination-over";f(h)?b.fillStyle=a.fromCssColorString(h).toCssColorString():b.fillStyle=a.WHITE.toCssColorString();b.fillRect(g-1,d-2,k+2,l+2)}function d(b,c,d,e,g,q,x,D){t[0]=b;t[1]=c;t[2]=d;t[3]=e;var v=JSON.stringify(t),r=g[v];if(f(r))return r;var u=document.createElement("canvas");u.width=e;u.height=e;D=k(D,"rgb(255,255,255)");var y=u.getContext("2d");h(y,d,e,x);if(f(b))return d=l.createIfNeeded(b).fetchImage().then(function(a){p(y,a,e);return g[v]=u}),g[v]=d;f(c)&&(b=m(c,{fillColor:a.fromCssColorString(D),stroke:f(x)?x:!1,font:q}),p(y,b,e,d,D));return g[v]=u}e.prototype.fromColor=function(a,c){if(!f(a))throw new g("color is required");if(!f(c))throw new g("size is required");return d(void 0,void 0,a,c,this._cache)};e.prototype.fromUrl=function(a,c,b){if(!f(a))throw new g("url is required");if(!f(c))throw new g("color is required");if(!f(b))throw new g("size is required");return d(a,void 0,c,b,this._cache)};e.prototype.fromMakiIconId=function(a,c,e){if(!f(a))throw new g("id is required");if(!f(c))throw new g("color is required");if(!f(e))throw new g("size is required");return d(b("Assets/Textures/maki/"+encodeURIComponent(a)+".png"),void 0,c,e,this._cache)};e.prototype.fromText=function(a,c,b,e,h){if(!f(a))throw new g("text is required");if(!f(c))throw new g("color is required");if(!f(b))throw new g("size is required");h=f(h)?h:this.font;return d(void 0,a,c,b,this._cache,h,this.stroke,e)};var q=new a,t=Array(4);return e});F("Core/PlaneGeometry","./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./defaultValue ./defined ./Geometry ./GeometryAttribute ./GeometryAttributes ./PrimitiveType ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a){a=g(a,g.EMPTY_OBJECT);this._vertexFormat=g(a.vertexFormat,d.DEFAULT);this._workerName="createPlaneGeometry"}q.packedLength=d.packedLength;q.pack=function(a,c,b){f.typeOf.object("value",a);f.defined("array",c);b=g(b,0);d.pack(a._vertexFormat,c,b);return c};var t=new d,r={vertexFormat:t};q.unpack=function(a,c,b){f.defined("array",a);c=g(c,0);a=d.unpack(a,c,t);if(!l(b))return new q(r);b._vertexFormat=d.clone(a,b._vertexFormat);return b};var c=new a(-.5,-.5,0),u=new a(.5,.5,0);q.createGeometry=function(d){var f=d._vertexFormat;d=new h;var g;f.position&&(g=new Float64Array(12),g[0]=c.x,g[1]=c.y,g[2]=0,g[3]=u.x,g[4]=c.y,g[5]=0,g[6]=u.x,g[7]=u.y,g[8]=0,g[9]=c.x,g[10]=u.y,g[11]=0,d.position=new e({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:g}),f.normal&&(g=new Float32Array(12),g[0]=0,g[1]=0,g[2]=1,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=1,g[9]=0,g[10]=0,g[11]=1,d.normal=new e({componentDatatype:k.FLOAT,componentsPerAttribute:3,values:g})),f.st&&(g=new Float32Array(8),g[0]=0,g[1]=0,g[2]=1,g[3]=0,g[4]=1,g[5]=1,g[6]=0,g[7]=1,d.st=new e({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:g})),f.tangent&&(g=new Float32Array(12),g[0]=1,g[1]=0,g[2]=0,g[3]=1,g[4]=0,g[5]=0,g[6]=1,g[7]=0,g[8]=0,g[9]=1,g[10]=0,g[11]=0,d.tangent=new e({componentDatatype:k.FLOAT,componentsPerAttribute:3,values:g})),f.bitangent&&(f=new Float32Array(12),f[0]=0,f[1]=1,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=1,f[8]=0,f[9]=0,f[10]=1,f[11]=0,d.bitangent=new e({componentDatatype:k.FLOAT,componentsPerAttribute:3,values:f})),g=new Uint16Array(6),g[0]=0,g[1]=1,g[2]=2,g[3]=0,g[4]=2,g[5]=3);return new m({attributes:d,indices:g,primitiveType:p.TRIANGLES,boundingSphere:new b(a.ZERO,Math.sqrt(2))})};return q});F("Core/PlaneOutlineGeometry","./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./defined ./Geometry ./GeometryAttribute ./GeometryAttributes ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h){function p(){this._workerName="createPlaneOutlineGeometry"}p.packedLength=0;p.pack=function(a,b){f.defined("value",a);f.defined("array",b);return b};p.unpack=function(a,b,c){f.defined("array",a);return g(c)?c:new p};var d=new a(-.5,-.5,0),q=new a(.5,.5,0);p.createGeometry=function(){var f=new e,g=new Uint16Array(8),c=new Float64Array(12);c[0]=d.x;c[1]=d.y;c[2]=d.z;c[3]=q.x;c[4]=d.y;c[5]=d.z;c[6]=q.x;c[7]=q.y;c[8]=d.z;c[9]=d.x;c[10]=q.y;c[11]=d.z;f.position=new m({componentDatatype:k.DOUBLE,componentsPerAttribute:3,values:c});g[0]=0;g[1]=1;g[2]=1;g[3]=2;g[4]=2;g[5]=3;g[6]=3;g[7]=0;return new l({attributes:f,indices:g,primitiveType:h.LINES,boundingSphere:new b(a.ZERO,Math.sqrt(2))})};return p});F("Core/pointInsideTriangle",["./barycentricCoordinates","./Cartesian3"],function(b,a){var f=new a;return function(a,g,l,m){b(a,g,l,m,f);return 0<f.x&&0<f.y&&0<f.z}});F("Core/PolygonGeometry","./ArcType ./arrayFill ./BoundingRectangle ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./ComponentDatatype ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./EllipsoidGeodesic ./EllipsoidRhumbLine ./EllipsoidTangentPlane ./Geometry ./GeometryAttribute ./GeometryInstance ./GeometryOffsetAttribute ./GeometryPipeline ./IndexDatatype ./Math ./Matrix2 ./Matrix3 ./PolygonGeometryLibrary ./PolygonPipeline ./Quaternion ./Rectangle ./VertexFormat ./WindingOrder".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K){function P(c){var b=c.vertexFormat,e=c.geometry,f=c.shadowVolume,k=e.attributes.position.values,m=k.length,p=c.wall,q=c.top||p,v=c.bottom||p;if(b.st||b.normal||b.tangent||b.bitangent||f){var w=c.boundingRectangle,r=c.tangentPlane,u=c.ellipsoid,B=c.stRotation,t=c.perPositionHeight,y=ba;y.x=w.x;y.y=w.y;var E=b.st?new Float32Array(m/3*2):void 0,A;b.normal&&(A=t&&q&&!p?e.attributes.normal.values:new Float32Array(m));var x=b.tangent?new Float32Array(m):void 0,I=b.bitangent?new Float32Array(m):void 0,L=f?new Float32Array(m):void 0,K=0,J=0,O=R,P=Y,N=Q,W=!0,Z=F,oa=na;if(0!==B)var wa=G.fromAxisAngle(r._plane.normal,B,ga),Z=H.fromQuaternion(wa,Z),wa=G.fromAxisAngle(r._plane.normal,-B,ga),oa=H.fromQuaternion(wa,oa);else Z=H.clone(H.IDENTITY,Z),oa=H.clone(H.IDENTITY,oa);wa=B=0;q&&v&&(B=m/2,wa=m/3,m/=2);for(var za=0;za<m;za+=3){var la=l.fromArray(k,za,fa);if(b.st){var ta=H.multiplyByVector(Z,la,M),ta=u.scaleToGeodeticSurface(ta,ta),qa=r.projectPointOntoPlane(ta,X);g.subtract(qa,y,qa);ta=C.clamp(qa.x/w.width,0,1);qa=C.clamp(qa.y/w.height,0,1);v&&(E[K+wa]=ta,E[K+1+wa]=qa);q&&(E[K]=ta,E[K+1]=qa);K+=2}if(b.normal||b.tangent||b.bitangent||f){ta=J+1;qa=J+2;if(p){if(za+3<m){var pa=l.fromArray(k,za+3,S);if(W){W=l.fromArray(k,za+m,ca);if(t){var ka=pa,ha=W,ia=u,ua=ia.cartesianToCartographic(la,aa).height,Xb=ia.cartesianToCartographic(ka,U);Xb.height=ua;ia.cartographicToCartesian(Xb,ka);ka=ia.cartesianToCartographic(ha,U);ka.height=ua-100;ia.cartographicToCartesian(ka,ha)}l.subtract(pa,la,pa);l.subtract(W,la,W);O=l.normalize(l.cross(W,pa,O),O);W=!1}l.equalsEpsilon(pa,la,C.EPSILON10)&&(W=!0)}if(b.tangent||b.bitangent)N=u.geodeticSurfaceNormal(la,N),b.tangent&&(P=l.normalize(l.cross(N,O,P),P))}else if(O=u.geodeticSurfaceNormal(la,O),b.tangent||b.bitangent)t&&(T=l.fromArray(A,J,T),da=l.cross(l.UNIT_Z,T,da),da=l.normalize(H.multiplyByVector(oa,da,da),da),b.bitangent&&(V=l.normalize(l.cross(T,da,V),V))),P=l.cross(l.UNIT_Z,O,P),P=l.normalize(H.multiplyByVector(oa,P,P),P),b.bitangent&&(N=l.normalize(l.cross(O,P,N),N));b.normal&&(c.wall?(A[J+B]=O.x,A[ta+B]=O.y,A[qa+B]=O.z):v&&(A[J+B]=-O.x,A[ta+B]=-O.y,A[qa+B]=-O.z),q&&!t||p)&&(A[J]=O.x,A[ta]=O.y,A[qa]=O.z);f&&(p&&(O=u.geodeticSurfaceNormal(la,O)),L[J+B]=-O.x,L[ta+B]=-O.y,L[qa+B]=-O.z);b.tangent&&(c.wall?(x[J+B]=P.x,x[ta+B]=P.y,x[qa+B]=P.z):v&&(x[J+B]=-P.x,x[ta+B]=-P.y,x[qa+B]=-P.z),q&&(t?(x[J]=da.x,x[ta]=da.y,x[qa]=da.z):(x[J]=P.x,x[ta]=P.y,x[qa]=P.z)));b.bitangent&&(v&&(I[J+B]=N.x,I[ta+B]=N.y,I[qa+B]=N.z),q&&(t?(I[J]=V.x,I[ta]=V.y,I[qa]=V.z):(I[J]=N.x,I[ta]=N.y,I[qa]=N.z)));J+=3}}b.st&&(e.attributes.st=new z({componentDatatype:h.FLOAT,componentsPerAttribute:2,values:E}));b.normal&&(e.attributes.normal=new z({componentDatatype:h.FLOAT,componentsPerAttribute:3,values:A}));b.tangent&&(e.attributes.tangent=new z({componentDatatype:h.FLOAT,componentsPerAttribute:3,values:x}));b.bitangent&&(e.attributes.bitangent=new z({componentDatatype:h.FLOAT,componentsPerAttribute:3,values:I}));f&&(e.attributes.extrudeDirection=new z({componentDatatype:h.FLOAT,componentsPerAttribute:3,values:L}))}c.extrude&&d(c.offsetAttribute)&&(b=k.length/3,f=new Uint8Array(b),c.offsetAttribute===D.TOP?q&&v||p?f=a(f,1,0,b/2):q&&(f=a(f,1)):f=a(f,c.offsetAttribute===D.NONE?0:1),e.attributes.applyOffset=new z({componentDatatype:h.UNSIGNED_BYTE,componentsPerAttribute:1,values:f}));return e}function N(a,e,f,h,g){g=p(g,new E);if(!d(a)||3>a.length)return g.west=0,g.north=0,g.south=0,g.east=0,g;if(f===b.RHUMB)return E.fromCartesianArray(a,e,g);pa.ellipsoid.equals(e)||(pa=new c(void 0,void 0,e));g.west=Number.POSITIVE_INFINITY;g.east=Number.NEGATIVE_INFINITY;g.south=Number.POSITIVE_INFINITY;g.north=Number.NEGATIVE_INFINITY;ha.westOverIDL=Number.POSITIVE_INFINITY;ha.eastOverIDL=Number.NEGATIVE_INFINITY;f=1/C.chordLength(h,e.maximumRadius);h=a.length;for(var k=e.cartesianToCartographic(a[0],la),l=ia,m,q=1;q<h;q++)m=l,l=k,k=e.cartesianToCartographic(a[q],m),pa.setEndPoints(l,k),O(pa,f,g,ha);m=l;l=k;k=e.cartesianToCartographic(a[0],m);pa.setEndPoints(l,k);O(pa,f,g,ha);g.east-g.west>ha.eastOverIDL-ha.westOverIDL&&(g.west=ha.westOverIDL,g.east=ha.eastOverIDL,g.east>C.PI&&(g.east-=C.TWO_PI),g.west>C.PI&&(g.west-=C.TWO_PI));return g}function O(a,c,b,d){var e=a.surfaceDistance;c=Math.ceil(e*c);for(var e=0<c?e/(c-1):Number.POSITIVE_INFINITY,f=0,h=0;h<c;h++){var g=a.interpolateUsingSurfaceDistance(f,oa),f=f+e,k=g.longitude,g=g.latitude;b.west=Math.min(b.west,k);b.east=Math.max(b.east,k);b.south=Math.min(b.south,g);b.north=Math.max(b.north,g);k=0<=k?k:k+C.TWO_PI;d.westOverIDL=Math.min(d.westOverIDL,k);d.eastOverIDL=Math.max(d.eastOverIDL,k)}}function Z(a){e.typeOf.object("options",a);e.typeOf.object("options.polygonHierarchy",a.polygonHierarchy);if(d(a.perPositionHeight)&&a.perPositionHeight&&d(a.height))throw new t("Cannot use both options.perPositionHeight and options.height");if(d(a.arcType)&&a.arcType!==b.GEODESIC&&a.arcType!==b.RHUMB)throw new t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var c=a.polygonHierarchy,f=p(a.vertexFormat,L.DEFAULT),h=p(a.ellipsoid,r.WGS84),g=p(a.granularity,C.RADIANS_PER_DEGREE),k=p(a.stRotation,0),l=p(a.perPositionHeight,!1),m=l&&d(a.extrudedHeight),q=p(a.height,0),v=p(a.extrudedHeight,q);if(!m)var w=Math.max(q,v),v=Math.min(q,v),q=w;this._vertexFormat=L.clone(f);this._ellipsoid=r.clone(h);this._granularity=g;this._stRotation=k;this._height=q;this._extrudedHeight=v;this._closeTop=p(a.closeTop,!0);this._closeBottom=p(a.closeBottom,!0);this._polygonHierarchy=c;this._perPositionHeight=l;this._perPositionHeightExtrude=m;this._shadowVolume=p(a.shadowVolume,!1);this._workerName="createPolygonGeometry";this._offsetAttribute=a.offsetAttribute;this._arcType=p(a.arcType,b.GEODESIC);this._textureCoordinateRotationPoints=this._rectangle=void 0;this.packedLength=J.computeHierarchyPackedLength(c)+r.packedLength+L.packedLength+12}var aa=new m,U=new m,W=new f,M=new l,R=new l,Y=new l,Q=new l,S=new l,ca=new l,T=new l,da=new l,V=new l,ba=new g,X=new g,fa=new l,ga=new G,F=new H,na=new H,ia=new m,la=new m,ha={westOverIDL:0,eastOverIDL:0},pa=new c,oa=new m,qa=[];Z.fromPositions=function(a){a=p(a,p.EMPTY_OBJECT);e.defined("options.positions",a.positions);return new Z({polygonHierarchy:{positions:a.positions},height:a.height,extrudedHeight:a.extrudedHeight,vertexFormat:a.vertexFormat,stRotation:a.stRotation,ellipsoid:a.ellipsoid,granularity:a.granularity,perPositionHeight:a.perPositionHeight,closeTop:a.closeTop,closeBottom:a.closeBottom,offsetAttribute:a.offsetAttribute,arcType:a.arcType})};Z.pack=function(a,c,b){e.typeOf.object("value",a);e.defined("array",c);b=p(b,0);b=J.packPolygonHierarchy(a._polygonHierarchy,c,b);r.pack(a._ellipsoid,c,b);b+=r.packedLength;L.pack(a._vertexFormat,c,b);b+=L.packedLength;c[b++]=a._height;c[b++]=a._extrudedHeight;c[b++]=a._granularity;c[b++]=a._stRotation;c[b++]=a._perPositionHeightExtrude?1:0;c[b++]=a._perPositionHeight?1:0;c[b++]=a._closeTop?1:0;c[b++]=a._closeBottom?1:0;c[b++]=a._shadowVolume?1:0;c[b++]=p(a._offsetAttribute,-1);c[b++]=a._arcType;c[b]=a.packedLength;return c};var ua=r.clone(r.UNIT_SPHERE),ta=new L,wa={polygonHierarchy:{}};Z.unpack=function(a,c,b){e.defined("array",a);c=p(c,0);var f=J.unpackPolygonHierarchy(a,c);c=f.startingIndex;delete f.startingIndex;var h=r.unpack(a,c,ua);c+=r.packedLength;var g=L.unpack(a,c,ta);c+=L.packedLength;var k=a[c++],l=a[c++],m=a[c++],q=a[c++],v=1===a[c++],w=1===a[c++],u=1===a[c++],B=1===a[c++],C=1===a[c++],t=a[c++],y=a[c++];a=a[c];d(b)||(b=new Z(wa));b._polygonHierarchy=f;b._ellipsoid=r.clone(h,b._ellipsoid);b._vertexFormat=L.clone(g,b._vertexFormat);b._height=k;b._extrudedHeight=l;b._granularity=m;b._stRotation=q;b._perPositionHeightExtrude=v;b._perPositionHeight=w;b._closeTop=u;b._closeBottom=B;b._shadowVolume=C;b._offsetAttribute=-1===t?void 0:t;b._arcType=y;b.packedLength=a;return b};Z.computeRectangle=function(a,c){e.typeOf.object("options",a);e.typeOf.object("options.polygonHierarchy",a.polygonHierarchy);var d=p(a.granularity,C.RADIANS_PER_DEGREE),f=p(a.arcType,b.GEODESIC);if(f!==b.GEODESIC&&f!==b.RHUMB)throw new t("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var h=a.polygonHierarchy,g=p(a.ellipsoid,r.WGS84);return N(h.positions,g,f,d,c)};Z.createGeometry=function(c){var b=c._vertexFormat,e=c._ellipsoid,f=c._granularity,g=c._stRotation,l=c._polygonHierarchy,m=c._perPositionHeight,p=c._closeTop,q=c._closeBottom,r=c._arcType,u=l.positions;if(!(3>u.length)){var t=y.fromPoints(u,e),l=J.polygonsFromHierarchy(l,t.projectPointsOntoPlane.bind(t),!m,e),E=l.hierarchy,l=l.polygons;if(0!==E.length){var u=E[0].outerRing,G=J.computeBoundingRectangle(t.plane.normal,t.projectPointOntoPlane.bind(t),u,g,W),u=[],I=c._height,L=c._extrudedHeight,H=c._perPositionHeightExtrude||!C.equalsEpsilon(I,L,0,C.EPSILON2),g={perPositionHeight:m,vertexFormat:b,geometry:void 0,tangentPlane:t,boundingRectangle:G,ellipsoid:e,stRotation:g,bottom:!1,top:!0,wall:!1,extrude:!1,arcType:r};if(H)for(g.extrude=!0,g.top=p,g.bottom=q,g.shadowVolume=c._shadowVolume,g.offsetAttribute=c._offsetAttribute,t=0;t<l.length;t++){var H=e,G=f,O=E[t],T=m,M=p,Q=q,N=b,S=r,da={walls:[]};if(M||Q){var R=J.createGeometryFromPositions(H,l[t],G,T,N,S),V=R.attributes.position.values,Y=R.indices;if(M&&Q){V=V.concat(V);M=V.length/3;Q=B.createTypedArray(M,2*Y.length);Q.set(Y);for(var Y=Y.length,ca=M/2,M=0;M<Y;M+=3){var aa=Q[M]+ca,Z=Q[M+1]+ca;Q[M+Y]=Q[M+2]+ca;Q[M+1+Y]=Z;Q[M+2+Y]=aa}R.attributes.position.values=V;T&&N.normal&&(M=R.attributes.normal.values,R.attributes.normal.values=new Float32Array(V.length),R.attributes.normal.values.set(M));R.indices=Q}else if(Q){M=V.length/3;Q=B.createTypedArray(M,Y.length);for(M=0;M<Y.length;M+=3)Q[M]=Y[M+2],Q[M+1]=Y[M+1],Q[M+2]=Y[M];R.indices=Q}da.topAndBottom=new x({geometry:R})}M=O.outerRing;R=y.fromPoints(M,H);R=R.projectPointsOntoPlane(M,qa);R=w.computeWindingOrder2D(R);R===K.CLOCKWISE&&(M=M.slice().reverse());R=J.computeWallGeometry(M,H,G,T,S);da.walls.push(new x({geometry:R}));O=O.holes;for(M=0;M<O.length;M++)N=O[M],R=y.fromPoints(N,H),R=R.projectPointsOntoPlane(N,qa),R=w.computeWindingOrder2D(R),R===K.COUNTER_CLOCKWISE&&(N=N.slice().reverse()),R=J.computeWallGeometry(N,H,G,T,S),da.walls.push(new x({geometry:R}));var H=da,U;p&&q?(U=H.topAndBottom,g.geometry=J.scaleToGeodeticHeightExtruded(U.geometry,I,L,e,m)):p?(U=H.topAndBottom,U.geometry.attributes.position.values=w.scaleToGeodeticHeight(U.geometry.attributes.position.values,I,e,!m),g.geometry=U.geometry):q&&(U=H.topAndBottom,U.geometry.attributes.position.values=w.scaleToGeodeticHeight(U.geometry.attributes.position.values,L,e,!0),g.geometry=U.geometry);if(p||q)g.wall=!1,U.geometry=P(g),u.push(U);H=H.walls;g.wall=!0;for(G=0;G<H.length;G++)T=H[G],g.geometry=J.scaleToGeodeticHeightExtruded(T.geometry,I,L,e,m),T.geometry=P(g),u.push(T)}else for(t=0;t<l.length;t++)p=new x({geometry:J.createGeometryFromPositions(e,l[t],f,m,b,r)}),p.geometry.attributes.position.values=w.scaleToGeodeticHeight(p.geometry.attributes.position.values,I,e,!m),g.geometry=p.geometry,p.geometry=P(g),d(c._offsetAttribute)&&(q=new Uint8Array(p.geometry.attributes.position.values.length/3),a(q,c._offsetAttribute===D.NONE?0:1),p.geometry.attributes.applyOffset=new z({componentDatatype:h.UNSIGNED_BYTE,componentsPerAttribute:1,values:q})),u.push(p);e=v.combineInstances(u)[0];e.attributes.position.values=new Float64Array(e.attributes.position.values);e.indices=B.createTypedArray(e.attributes.position.values.length/3,e.indices);f=e.attributes;m=k.fromVertices(f.position.values);b.position||delete f.position;return new A({attributes:f,indices:e.indices,primitiveType:e.primitiveType,boundingSphere:m,offsetAttribute:c._offsetAttribute})}}};Z.createShadowVolume=function(a,c,b){var d=a._granularity,e=a._ellipsoid;c=c(d,e);b=b(d,e);return new Z({polygonHierarchy:a._polygonHierarchy,ellipsoid:e,stRotation:a._stRotation,granularity:d,perPositionHeight:!1,extrudedHeight:c,height:b,vertexFormat:L.POSITION_ONLY,shadowVolume:!0,arcType:a._arcType})};q(Z.prototype,{rectangle:{get:function(){d(this._rectangle)||(this._rectangle=N(this._polygonHierarchy.positions,this._ellipsoid,this._arcType,this._granularity));return this._rectangle}},textureCoordinateRotationPoints:{get:function(){if(!d(this._textureCoordinateRotationPoints)){var a;a=-this._stRotation;a=0===a?[0,0,0,1,1,0]:A._textureCoordinateRotationPoints(this._polygonHierarchy.positions,a,this._ellipsoid,this.rectangle);this._textureCoordinateRotationPoints=a}return this._textureCoordinateRotationPoints}}});return Z});F("Core/PolygonHierarchy",["./defined"],function(b){return function(a,f){this.positions=b(a)?a:[];this.holes=b(f)?f:[]}});F("Core/PolygonOutlineGeometry","./ArcType ./arrayFill ./arrayRemoveDuplicates ./BoundingSphere ./Cartesian3 ./Check ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./EllipsoidTangentPlane ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryInstance ./GeometryOffsetAttribute ./GeometryPipeline ./IndexDatatype ./Math ./PolygonGeometryLibrary ./PolygonPipeline ./PrimitiveType ./Queue ./WindingOrder".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I){function H(a){l.typeOf.object("options",a);l.typeOf.object("options.polygonHierarchy",a.polygonHierarchy);if(a.perPositionHeight&&h(a.height))throw new p("Cannot use both options.perPositionHeight and options.height");if(h(a.arcType)&&a.arcType!==b.GEODESIC&&a.arcType!==b.RHUMB)throw new p("Invalid arcType. Valid options are ArcType.GEODESIC and ArcType.RHUMB.");var c=a.polygonHierarchy,f=e(a.ellipsoid,d.WGS84),g=e(a.granularity,x.RADIANS_PER_DEGREE),k=e(a.perPositionHeight,!1),m=k&&h(a.extrudedHeight),q=e(a.arcType,b.GEODESIC),v=e(a.height,0),w=e(a.extrudedHeight,v);if(!m)var r=Math.max(v,w),w=Math.min(v,w),v=r;this._ellipsoid=d.clone(f);this._granularity=g;this._height=v;this._extrudedHeight=w;this._arcType=q;this._polygonHierarchy=c;this._perPositionHeight=k;this._perPositionHeightExtrude=m;this._offsetAttribute=a.offsetAttribute;this._workerName="createPolygonOutlineGeometry";this.packedLength=D.computeHierarchyPackedLength(c)+d.packedLength+8}var J=[],w=[];H.pack=function(a,c,b){l.typeOf.object("value",a);l.defined("array",c);b=e(b,0);b=D.packPolygonHierarchy(a._polygonHierarchy,c,b);d.pack(a._ellipsoid,c,b);b+=d.packedLength;c[b++]=a._height;c[b++]=a._extrudedHeight;c[b++]=a._granularity;c[b++]=a._perPositionHeightExtrude?1:0;c[b++]=a._perPositionHeight?1:0;c[b++]=a._arcType;c[b++]=e(a._offsetAttribute,-1);c[b]=a.packedLength;return c};var G=d.clone(d.UNIT_SPHERE),E={polygonHierarchy:{}};H.unpack=function(a,c,b){l.defined("array",a);c=e(c,0);var f=D.unpackPolygonHierarchy(a,c);c=f.startingIndex;delete f.startingIndex;var g=d.unpack(a,c,G);c+=d.packedLength;var k=a[c++],m=a[c++],p=a[c++],q=1===a[c++],v=1===a[c++],w=a[c++],r=a[c++];a=a[c];h(b)||(b=new H(E));b._polygonHierarchy=f;b._ellipsoid=d.clone(g,b._ellipsoid);b._height=k;b._extrudedHeight=m;b._granularity=p;b._perPositionHeight=v;b._perPositionHeightExtrude=q;b._arcType=w;b._offsetAttribute=-1===r?void 0:r;b.packedLength=a;return b};H.fromPositions=function(a){a=e(a,e.EMPTY_OBJECT);l.defined("options.positions",a.positions);return new H({polygonHierarchy:{positions:a.positions},height:a.height,extrudedHeight:a.extrudedHeight,ellipsoid:a.ellipsoid,granularity:a.granularity,perPositionHeight:a.perPositionHeight,arcType:a.arcType,offsetAttribute:a.offsetAttribute})};H.createGeometry=function(d){var e=d._ellipsoid,f=d._granularity,g=d._perPositionHeight,l=d._arcType,p=D.polygonOutlinesFromHierarchy(d._polygonHierarchy,!g,e);if(0!==p.length){var C,E=[],f=x.chordLength(f,e.maximumRadius),G=d._height,H=d._extrudedHeight,L,Y;if(d._perPositionHeightExtrude||!x.equalsEpsilon(G,H,0,x.EPSILON2))for(Y=0;Y<p.length;Y++){var Q=e,S=p[Y],ca=f,T=g,da=l,V=q.fromPoints(S,Q).projectPointsOntoPlane(S,J);v.computeWindingOrder2D(V)===I.CLOCKWISE&&(V.reverse(),S=S.slice().reverse());var ba,V=S.length;C=Array(V);L=0;if(T)for(ba=new Float64Array(12*V),T=0;T<V;++T)C[T]=L/3,Q=S[T],ca=S[(T+1)%V],ba[L++]=Q.x,ba[L++]=Q.y,ba[L++]=Q.z,ba[L++]=ca.x,ba[L++]=ca.y,ba[L++]=ca.z;else{ba=0;if(da===b.GEODESIC)for(T=0;T<V;T++)ba+=D.subdivideLineCount(S[T],S[(T+1)%V],ca);else if(da===b.RHUMB)for(T=0;T<V;T++)ba+=D.subdivideRhumbLineCount(Q,S[T],S[(T+1)%V],ca);ba=new Float64Array(6*ba);for(T=0;T<V;++T){C[T]=L/3;var X;da===b.GEODESIC?X=D.subdivideLine(S[T],S[(T+1)%V],ca,w):da===b.RHUMB&&(X=D.subdivideRhumbLine(Q,S[T],S[(T+1)%V],ca,w));for(var fa=X.length,ga=0;ga<fa;++ga)ba[L++]=X[ga]}}V=ba.length/6;S=C.length;Q=z.createTypedArray(V+S,2*(2*V+S));for(T=L=0;T<V;++T)Q[L++]=T,Q[L++]=(T+1)%V,Q[L++]=T+V,Q[L++]=(T+1)%V+V;for(T=0;T<S;T++)ca=C[T],Q[L++]=ca,Q[L++]=ca+V;C=new u({geometry:new t({attributes:new c({position:new r({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:ba})}),indices:Q,primitiveType:B.LINES})});C.geometry=D.scaleToGeodeticHeightExtruded(C.geometry,G,H,e,g);h(d._offsetAttribute)&&(L=C.geometry.attributes.position.values.length/3,V=new Uint8Array(L),d._offsetAttribute===y.TOP?V=a(V,1,0,L/2):(L=d._offsetAttribute===y.NONE?0:1,V=a(V,L)),C.geometry.attributes.applyOffset=new r({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:V}));E.push(C)}else for(Y=0;Y<p.length;Y++){T=e;X=p[Y];S=f;L=g;ba=l;H=q.fromPoints(X,T).projectPointsOntoPlane(X,J);v.computeWindingOrder2D(H)===I.CLOCKWISE&&(H.reverse(),X=X.slice().reverse());H=X.length;C=0;if(L)for(Q=new Float64Array(6*H),L=0;L<H;L++)T=X[L],S=X[(L+1)%H],Q[C++]=T.x,Q[C++]=T.y,Q[C++]=T.z,Q[C++]=S.x,Q[C++]=S.y,Q[C++]=S.z;else{Q=0;if(ba===b.GEODESIC)for(L=0;L<H;L++)Q+=D.subdivideLineCount(X[L],X[(L+1)%H],S);else if(ba===b.RHUMB)for(L=0;L<H;L++)Q+=D.subdivideRhumbLineCount(T,X[L],X[(L+1)%H],S);Q=new Float64Array(3*Q);for(L=0;L<H;L++)for(ba===b.GEODESIC?V=D.subdivideLine(X[L],X[(L+1)%H],S,w):ba===b.RHUMB&&(V=D.subdivideRhumbLine(T,X[L],X[(L+1)%H],S,w)),ca=V.length,da=0;da<ca;++da)Q[C++]=V[da]}H=Q.length/3;X=z.createTypedArray(H,2*H);for(L=C=0;L<H-1;L++)X[C++]=L,X[C++]=L+1;X[C++]=H-1;X[C++]=0;C=new u({geometry:new t({attributes:new c({position:new r({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:Q})}),indices:X,primitiveType:B.LINES})});C.geometry.attributes.position.values=v.scaleToGeodeticHeight(C.geometry.attributes.position.values,G,e,!g);h(d._offsetAttribute)&&(X=new Uint8Array(C.geometry.attributes.position.values.length/3),L=d._offsetAttribute===y.NONE?0:1,a(X,L),C.geometry.attributes.applyOffset=new r({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:X}));E.push(C)}e=A.combineInstances(E)[0];g=k.fromVertices(e.attributes.position.values);return new t({attributes:e.attributes,indices:e.indices,primitiveType:e.primitiveType,boundingSphere:g,offsetAttribute:d._offsetAttribute})}};return H});F("Core/PolylineGeometry","./ArcType ./arrayRemoveDuplicates ./BoundingSphere ./Cartesian3 ./Color ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryType ./IndexDatatype ./Math ./PolylinePipeline ./PrimitiveType ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(a){a=m(a,m.EMPTY_OBJECT);var c=a.positions,d=a.colors,f=m(a.width,1),l=m(a.colorsPerVertex,!1);if(!e(c)||2>c.length)throw new h("At least two positions are required.");if("number"!==typeof f)throw new h("width must be a number");if(e(d)&&(l&&d.length<c.length||!l&&d.length<c.length-1))throw new h("colors has an invalid length.");this._positions=c;this._colors=d;this._width=f;this._colorsPerVertex=l;this._vertexFormat=z.clone(m(a.vertexFormat,z.DEFAULT));this._arcType=m(a.arcType,b.GEODESIC);this._granularity=m(a.granularity,u.RADIANS_PER_DEGREE);this._ellipsoid=p.clone(m(a.ellipsoid,p.WGS84));this._workerName="createPolylineGeometry";a=1+c.length*k.packedLength;a+=e(d)?1+d.length*g.packedLength:1;this.packedLength=a+p.packedLength+z.packedLength+4}var D=[];x.pack=function(a,c,b){if(!e(a))throw new h("value is required");if(!e(c))throw new h("array is required");b=m(b,0);var d,f=a._positions,l=f.length;c[b++]=l;for(d=0;d<l;++d,b+=k.packedLength)k.pack(f[d],c,b);f=a._colors;l=e(f)?f.length:0;c[b++]=l;for(d=0;d<l;++d,b+=g.packedLength)g.pack(f[d],c,b);p.pack(a._ellipsoid,c,b);b+=p.packedLength;z.pack(a._vertexFormat,c,b);b+=z.packedLength;c[b++]=a._width;c[b++]=a._colorsPerVertex?1:0;c[b++]=a._arcType;c[b]=a._granularity;return c};var v=p.clone(p.UNIT_SPHERE),B=new z,C={positions:void 0,colors:void 0,ellipsoid:v,vertexFormat:B,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};x.unpack=function(a,c,b){if(!e(a))throw new h("array is required");c=m(c,0);var d,f=a[c++],l=Array(f);for(d=0;d<f;++d,c+=k.packedLength)l[d]=k.unpack(a,c);var f=a[c++],q=0<f?Array(f):void 0;for(d=0;d<f;++d,c+=g.packedLength)q[d]=g.unpack(a,c);d=p.unpack(a,c,v);c+=p.packedLength;f=z.unpack(a,c,B);c+=z.packedLength;var w=a[c++],r=1===a[c++],u=a[c++];a=a[c];if(!e(b))return C.positions=l,C.colors=q,C.width=w,C.colorsPerVertex=r,C.arcType=u,C.granularity=a,new x(C);b._positions=l;b._colors=q;b._ellipsoid=p.clone(d,b._ellipsoid);b._vertexFormat=z.clone(f,b._vertexFormat);b._width=w;b._colorsPerVertex=r;b._arcType=u;b._granularity=a;return b};var I=new k,H=new k,J=new k,w=new k;x.createGeometry=function(h){var m=h._width,p=h._vertexFormat,v=h._colors,B=h._colorsPerVertex,C=h._arcType,z=h._granularity,x=h._ellipsoid,G,U;h=a(h._positions,k.equalsEpsilon);var W=h.length;if(!(2>W||0>=m)){if(C===b.GEODESIC||C===b.RHUMB){var M,R;C===b.GEODESIC?(M=u.chordLength(z,x.maximumRadius),R=y.numberOfPoints):(M=z,R=y.numberOfPointsRhumbLine);var Y=y.extractHeights(h,x);if(e(v)){var Q=1;for(G=0;G<W-1;++G)Q+=R(h[G],h[G+1],M);var S=Array(Q),ca=0;for(G=0;G<W-1;++G){var T=v[G],da=R(h[G],h[G+1],M);if(B&&G<Q){var V=T,ba=v[G+1],z=da,da=D;da.length=z;var X,T=V.red;U=V.green;var fa=V.blue,ga=V.alpha,F=ba.red,na=ba.green,ia=ba.blue;X=ba.alpha;if(g.equals(V,ba))for(X=0;X<z;X++)da[X]=g.clone(V);else for(V=(F-T)/z,ba=(na-U)/z,ia=(ia-fa)/z,na=(X-ga)/z,X=0;X<z;X++)da[X]=new g(T+X*V,U+X*ba,fa+X*ia,ga+X*na);T=da.length;for(z=0;z<T;++z)S[ca++]=da[z]}else for(z=0;z<da;++z)S[ca++]=g.clone(T)}S[ca]=g.clone(v[v.length-1]);v=S;D.length=0}h=C===b.GEODESIC?y.generateCartesianArc({positions:h,minDistance:M,ellipsoid:x,height:Y}):y.generateCartesianRhumbArc({positions:h,granularity:M,ellipsoid:x,height:Y})}W=h.length;C=4*W-4;x=new Float64Array(3*C);G=new Float64Array(3*C);M=new Float64Array(3*C);R=new Float32Array(2*C);Y=p.st?new Float32Array(2*C):void 0;Q=e(v)?new Uint8Array(4*C):void 0;for(z=T=da=ca=S=0;z<W;++z){0===z?(U=I,k.subtract(h[0],h[1],U),k.add(h[0],U,U)):U=h[z-1];k.clone(U,J);k.clone(h[z],H);z===W-1?(U=I,k.subtract(h[W-1],h[W-2],U),k.add(h[W-1],U,U)):U=h[z+1];k.clone(U,w);var la,ha;e(Q)&&(la=0===z||B?v[z]:v[z-1],z!==W-1&&(ha=v[z]));fa=z===W-1?2:4;for(U=0===z?2:0;U<fa;++U)k.pack(H,x,S),k.pack(J,G,S),k.pack(w,M,S),S+=3,ga=0>U-2?-1:1,R[ca++]=U%2*2-1,R[ca++]=ga*m,p.st&&(Y[da++]=z/(W-1),Y[da++]=Math.max(R[ca-2],0)),e(Q)&&(ga=2>U?la:ha,Q[T++]=g.floatToByte(ga.red),Q[T++]=g.floatToByte(ga.green),Q[T++]=g.floatToByte(ga.blue),Q[T++]=g.floatToByte(ga.alpha))}m=new t;m.position=new q({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:x});m.prevPosition=new q({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:G});m.nextPosition=new q({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:M});m.expandAndWidth=new q({componentDatatype:l.FLOAT,componentsPerAttribute:2,values:R});p.st&&(m.st=new q({componentDatatype:l.FLOAT,componentsPerAttribute:2,values:Y}));e(Q)&&(m.color=new q({componentDatatype:l.UNSIGNED_BYTE,componentsPerAttribute:4,values:Q,normalize:!0}));p=c.createTypedArray(C,6*W-6);B=v=0;--W;for(z=0;z<W;++z)p[B++]=v,p[B++]=v+2,p[B++]=v+1,p[B++]=v+1,p[B++]=v+2,p[B++]=v+3,v+=4;return new d({attributes:m,indices:p,primitiveType:A.TRIANGLES,boundingSphere:f.fromPoints(h),geometryType:r.POLYLINES})}};return x});F("Core/PolylineVolumeGeometry","./arrayRemoveDuplicates ./BoundingRectangle ./BoundingSphere ./Cartesian2 ./Cartesian3 ./ComponentDatatype ./CornerType ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryPipeline ./IndexDatatype ./Math ./oneTimeWarning ./PolygonPipeline ./PolylineVolumeGeometryLibrary ./PrimitiveType ./VertexFormat ./WindingOrder".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a){a=e(a,e.EMPTY_OBJECT);var c=a.polylinePositions,b=a.shapePositions;if(!h(c))throw new p("options.polylinePositions is required.");if(!h(b))throw new p("options.shapePositions is required.");this._positions=c;this._shape=b;this._ellipsoid=d.clone(e(a.ellipsoid,d.WGS84));this._cornerType=e(a.cornerType,m.ROUNDED);this._vertexFormat=v.clone(e(a.vertexFormat,v.DEFAULT));this._granularity=e(a.granularity,y.RADIANS_PER_DEGREE);this._workerName="createPolylineVolumeGeometry";a=1+c.length*g.packedLength;a+=1+b.length*k.packedLength;this.packedLength=a+d.packedLength+v.packedLength+2}C.pack=function(a,c,b){if(!h(a))throw new p("value is required");if(!h(c))throw new p("array is required");b=e(b,0);var f,l=a._positions,m=l.length;c[b++]=m;for(f=0;f<m;++f,b+=g.packedLength)g.pack(l[f],c,b);l=a._shape;m=l.length;c[b++]=m;for(f=0;f<m;++f,b+=k.packedLength)k.pack(l[f],c,b);d.pack(a._ellipsoid,c,b);b+=d.packedLength;v.pack(a._vertexFormat,c,b);b+=v.packedLength;c[b++]=a._cornerType;c[b]=a._granularity;return c};var I=d.clone(d.UNIT_SPHERE),H=new v,J={polylinePositions:void 0,shapePositions:void 0,ellipsoid:I,vertexFormat:H,cornerType:void 0,granularity:void 0};C.unpack=function(a,c,b){if(!h(a))throw new p("array is required");c=e(c,0);var f,l=a[c++],m=Array(l);for(f=0;f<l;++f,c+=g.packedLength)m[f]=g.unpack(a,c);var l=a[c++],q=Array(l);for(f=0;f<l;++f,c+=k.packedLength)q[f]=k.unpack(a,c);f=d.unpack(a,c,I);c+=d.packedLength;l=v.unpack(a,c,H);c+=v.packedLength;var w=a[c++];a=a[c];if(!h(b))return J.polylinePositions=m,J.shapePositions=q,J.cornerType=w,J.granularity=a,new C(J);b._positions=m;b._shape=q;b._ellipsoid=d.clone(f,b._ellipsoid);b._vertexFormat=v.clone(l,b._vertexFormat);b._cornerType=w;b._granularity=a;return b};var w=new a;C.createGeometry=function(d){var e=b(d._positions,g.equalsEpsilon),h=d._shape,h=x.removeDuplicatesFromShape(h);if(!(2>e.length||3>h.length)){z.computeWindingOrder2D(h)===B.CLOCKWISE&&h.reverse();var k=a.fromPoints(h,w),e=x.computePositions(e,h,k,d,!0),m=h;d=d._vertexFormat;h=new r;d.position&&(h.position=new t({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:e}));var p=m.length,v=e.length/3,C=(v-2*p)/(2*p),y=z.triangulate(m),G=u.createTypedArray(v,(C-1)*p*6+2*y.length),I,H,J,Y,Q,S,ca=2*p,T=0;for(I=0;I<C-1;I++){for(H=0;H<p-1;H++)J=2*H+I*p*2,S=J+ca,Y=J+1,Q=Y+ca,G[T++]=Y,G[T++]=J,G[T++]=Q,G[T++]=Q,G[T++]=J,G[T++]=S;J=2*p-2+I*p*2;Y=J+1;Q=Y+ca;S=J+ca;G[T++]=Y;G[T++]=J;G[T++]=Q;G[T++]=Q;G[T++]=J;G[T++]=S}if(d.st||d.tangent||d.bitangent){J=new Float32Array(2*v);Y=1/(C-1);Q=1/k.height;var k=k.height/2,da=0;for(I=0;I<C;I++){S=I*Y;ca=Q*(m[0].y+k);J[da++]=S;J[da++]=ca;for(H=1;H<p;H++)ca=Q*(m[H].y+k),J[da++]=S,J[da++]=ca,J[da++]=S,J[da++]=ca;ca=Q*(m[0].y+k);J[da++]=S;J[da++]=ca}for(H=0;H<p;H++)S=0,ca=Q*(m[H].y+k),J[da++]=S,J[da++]=ca;for(H=0;H<p;H++)S=(C-1)*Y,ca=Q*(m[H].y+k),J[da++]=S,J[da++]=ca;h.st=new t({componentDatatype:l.FLOAT,componentsPerAttribute:2,values:new Float32Array(J)})}m=v-2*p;for(I=0;I<y.length;I+=3)v=y[I]+m,C=y[I+1]+m,H=y[I+2]+m,G[T++]=v,G[T++]=C,G[T++]=H,G[T++]=H+p,G[T++]=C+p,G[T++]=v+p;e=new q({attributes:h,indices:G,boundingSphere:f.fromVertices(e),primitiveType:D.TRIANGLES});d.normal&&(e=c.computeNormal(e));if(d.tangent||d.bitangent){try{e=c.computeTangentAndBitangent(e)}catch(V){A("polyline-volume-tangent-bitangent","Unable to compute tangents and bitangents for polyline volume geometry")}d.tangent||(e.attributes.tangent=void 0);d.bitangent||(e.attributes.bitangent=void 0);d.st||(e.attributes.st=void 0)}return e}};return C});F("Core/PolylineVolumeOutlineGeometry","./arrayRemoveDuplicates ./BoundingRectangle ./BoundingSphere ./Cartesian2 ./Cartesian3 ./ComponentDatatype ./CornerType ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./IndexDatatype ./Math ./PolygonPipeline ./PolylineVolumeGeometryLibrary ./PrimitiveType ./WindingOrder".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(a){a=e(a,e.EMPTY_OBJECT);var c=a.polylinePositions,b=a.shapePositions;if(!h(c))throw new p("options.polylinePositions is required.");if(!h(b))throw new p("options.shapePositions is required.");this._positions=c;this._shape=b;this._ellipsoid=d.clone(e(a.ellipsoid,d.WGS84));this._cornerType=e(a.cornerType,m.ROUNDED);this._granularity=e(a.granularity,u.RADIANS_PER_DEGREE);this._workerName="createPolylineVolumeOutlineGeometry";a=1+c.length*g.packedLength;a+=1+b.length*k.packedLength;this.packedLength=a+d.packedLength+2}D.pack=function(a,c,b){if(!h(a))throw new p("value is required");if(!h(c))throw new p("array is required");b=e(b,0);var f,l=a._positions,m=l.length;c[b++]=m;for(f=0;f<m;++f,b+=g.packedLength)g.pack(l[f],c,b);l=a._shape;m=l.length;c[b++]=m;for(f=0;f<m;++f,b+=k.packedLength)k.pack(l[f],c,b);d.pack(a._ellipsoid,c,b);b+=d.packedLength;c[b++]=a._cornerType;c[b]=a._granularity;return c};var v=d.clone(d.UNIT_SPHERE),B={polylinePositions:void 0,shapePositions:void 0,ellipsoid:v,height:void 0,cornerType:void 0,granularity:void 0};D.unpack=function(a,c,b){if(!h(a))throw new p("array is required");c=e(c,0);var f,l=a[c++],m=Array(l);for(f=0;f<l;++f,c+=g.packedLength)m[f]=g.unpack(a,c);var l=a[c++],q=Array(l);for(f=0;f<l;++f,c+=k.packedLength)q[f]=k.unpack(a,c);f=d.unpack(a,c,v);c+=d.packedLength;l=a[c++];a=a[c];if(!h(b))return B.polylinePositions=m,B.shapePositions=q,B.cornerType=l,B.granularity=a,new D(B);b._positions=m;b._shape=q;b._ellipsoid=d.clone(f,b._ellipsoid);b._cornerType=l;b._granularity=a;return b};var C=new a;D.createGeometry=function(d){var e=b(d._positions,g.equalsEpsilon),h=d._shape,h=A.removeDuplicatesFromShape(h);if(!(2>e.length||3>h.length)){y.computeWindingOrder2D(h)===x.CLOCKWISE&&h.reverse();var k=a.fromPoints(h,C);d=A.computePositions(e,h,k,d,!1);e=h;h=new r;h.position=new t({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:d});var e=e.length,k=h.position.values.length/3,m=d.length/3/e,p=c.createTypedArray(k,2*e*(m+1)),v,u,B=0;v=0*e;for(u=0;u<e-1;u++)p[B++]=u+v,p[B++]=u+v+1;p[B++]=e-1+v;p[B++]=v;v=(m-1)*e;for(u=0;u<e-1;u++)p[B++]=u+v,p[B++]=u+v+1;p[B++]=e-1+v;p[B++]=v;for(v=0;v<m-1;v++){var D=e*v,I=D+e;for(u=0;u<e;u++)p[B++]=u+D,p[B++]=u+I}return new q({attributes:h,indices:c.createTypedArray(k,p),boundingSphere:f.fromVertices(d),primitiveType:z.LINES})}};return D});F("Core/QuaternionSpline","./defaultValue ./defined ./defineProperties ./DeveloperError ./Quaternion ./Spline".split(" "),function(b,a,f,k,g,l){function m(b){var e=b.points,d=b.times;return function(f,h){a(h)||(h=new g);var k=b._lastTimeIndex=b.findTimeInterval(f,b._lastTimeIndex);return g.fastSlerp(e[k],e[k+1],(f-d[k])/(d[k+1]-d[k]),h)}}function e(e){e=b(e,b.EMPTY_OBJECT);var f=e.points;e=e.times;if(!a(f)||!a(e))throw new k("points and times are required.");if(2>f.length)throw new k("points.length must be greater than or equal to 2.");if(e.length!==f.length)throw new k("times.length must be equal to points.length.");this._times=e;this._points=f;this._evaluateFunction=m(this);this._lastTimeIndex=0}f(e.prototype,{times:{get:function(){return this._times}},points:{get:function(){return this._points}}});e.prototype.findTimeInterval=l.prototype.findTimeInterval;e.prototype.wrapTime=l.prototype.wrapTime;e.prototype.clampTime=l.prototype.clampTime;e.prototype.evaluate=function(a,b){return this._evaluateFunction(a,b)};return e});F("ThirdParty/quickselect",[],function(){function b(f,g,l,m,e){for(;m>l;){if(600<m-l){var h=m-l+1,k=g-l+1,d=Math.log(h),q=.5*Math.exp(2*d/3),d=.5*Math.sqrt(d*q*(h-q)/h)*(0>k-h/2?-1:1);b(f,g,Math.max(l,Math.floor(g-k*q/h+d)),Math.min(m,Math.floor(g+(h-k)*q/h+d)),e)}h=f[g];k=l;q=m;a(f,l,g);for(0<e(f[m],h)&&a(f,l,m);k<q;){a(f,k,q);k++;for(q--;0>e(f[k],h);)k++;for(;0<e(f[q],h);)q--}0===e(f[l],h)?a(f,l,q):(q++,a(f,q,m));q<=g&&(l=q+1);g<=q&&(m=q-1)}}function a(a,b,f){var g=a[b];a[b]=a[f];a[f]=g}function f(a,b){return a<b?-1:a>b?1:0}return function(a,g,l,m,e){b(a,g,l||0,m||a.length-1,e||f)}});F("ThirdParty/rbush",["./quickselect"],function(b){function a(b,c){if(!(this instanceof a))return new a(b,c);this._maxEntries=Math.max(4,b||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));c&&this._initFormat(c);this.clear()}function f(a,c){k(a,0,a.children.length,c,a)}function k(a,c,b,d,e){e||(e=q(null));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;for(var f;c<b;c++)f=a.children[c],g(e,a.leaf?d(f):f);return e}function g(a,c){a.minX=Math.min(a.minX,c.minX);a.minY=Math.min(a.minY,c.minY);a.maxX=Math.max(a.maxX,c.maxX);a.maxY=Math.max(a.maxY,c.maxY);return a}function l(a,c){return a.minX-c.minX}function m(a,c){return a.minY-c.minY}function e(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function h(a){return a.maxX-a.minX+(a.maxY-a.minY)}function p(a,c){return a.minX<=c.minX&&a.minY<=c.minY&&c.maxX<=a.maxX&&c.maxY<=a.maxY}function d(a,c){return c.minX<=a.maxX&&c.minY<=a.maxY&&c.maxX>=a.minX&&c.maxY>=a.minY}function q(a){return{children:a,height:1,leaf:!0,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function t(a,c,d,e,f){for(var h=[c,d],g;h.length;)d=h.pop(),c=h.pop(),d-c<=e||(g=c+Math.ceil((d-c)/e/2)*e,b(a,g,c,d,f),h.push(c,g,g,d))}a.prototype={all:function(){return this._all(this.data,[])},search:function(a){var c=this.data,b=[],e=this.toBBox;if(!d(a,c))return b;for(var f=[],h,g,k,l;c;){h=0;for(g=c.children.length;h<g;h++)k=c.children[h],l=c.leaf?e(k):k,d(a,l)&&(c.leaf?b.push(k):p(a,l)?this._all(k,b):f.push(k));c=f.pop()}return b},collides:function(a){var c=this.data,b=this.toBBox;if(!d(a,c))return!1;for(var e=[],f,h,g,k;c;){f=0;for(h=c.children.length;f<h;f++)if(g=c.children[f],k=c.leaf?b(g):g,d(a,k)){if(c.leaf||p(a,k))return!0;e.push(g)}c=e.pop()}return!1},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var c=0,b=a.length;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(),0,a.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,this.data.height-a.height-1,!0)):this.data=a;return this},insert:function(a){a&&this._insert(a,this.data.height-1);return this},clear:function(){this.data=q([]);return this},remove:function(a,c){if(!a)return this;for(var b=this.data,d=this.toBBox(a),e=[],f=[],h,g,k,l;b||e.length;){b||(b=e.pop(),g=e[e.length-1],h=f.pop(),l=!0);if(b.leaf){a:{k=a;var m=b.children,q=c;if(q){for(var r=0;r<m.length;r++)if(q(k,m[r])){k=r;break a}k=-1}else k=m.indexOf(k)}if(-1!==k){b.children.splice(k,1);e.push(b);this._condense(e);break}}l||b.leaf||!p(b,d)?g?(h++,b=g.children[h],l=!1):b=null:(e.push(b),f.push(h),h=0,g=b,b=b.children[0])}return this},toBBox:function(a){return a},compareMinX:l,compareMinY:m,toJSON:function(){return this.data},fromJSON:function(a){this.data=a;return this},_all:function(a,c){for(var b=[];a;)a.leaf?c.push.apply(c,a.children):b.push.apply(b,a.children),a=b.pop();return c},_build:function(a,c,b,d){var e=b-c+1,h=this._maxEntries,g;if(e<=h)return g=q(a.slice(c,b+1)),f(g,this.toBBox),g;d||(d=Math.ceil(Math.log(e)/Math.log(h)),h=Math.ceil(e/Math.pow(h,d-1)));g=q([]);g.leaf=!1;g.height=d;var e=Math.ceil(e/h),h=e*Math.ceil(Math.sqrt(h)),k,l,m;for(t(a,c,b,h,this.compareMinX);c<=b;c+=h)for(l=Math.min(c+h-1,b),t(a,c,l,e,this.compareMinY),k=c;k<=l;k+=e)m=Math.min(k+e-1,l),g.children.push(this._build(a,k,m,d-1));f(g,this.toBBox);return g},_chooseSubtree:function(a,c,b,d){for(var f,h,g,k,l,m,p,q;;){d.push(c);if(c.leaf||d.length-1===b)break;p=q=Infinity;f=0;for(h=c.children.length;f<h;f++)g=c.children[f],l=e(g),m=(Math.max(g.maxX,a.maxX)-Math.min(g.minX,a.minX))*(Math.max(g.maxY,a.maxY)-Math.min(g.minY,a.minY))-l,m<q?(q=m,p=l<p?l:p,k=g):m===q&&l<p&&(p=l,k=g);c=k||c.children[0]}return c},_insert:function(a,c,b){var d=this.toBBox;b=b?a:d(a);var d=[],e=this._chooseSubtree(b,this.data,c,d);e.children.push(a);for(g(e,b);0<=c;)if(d[c].children.length>this._maxEntries)this._split(d,c),c--;else break;this._adjustParentBBoxes(b,d,c)},_split:function(a,c){var b=a[c],d=b.children.length,e=this._minEntries;this._chooseSplitAxis(b,e,d);d=this._chooseSplitIndex(b,e,d);d=q(b.children.splice(d,b.children.length-d));d.height=b.height;d.leaf=b.leaf;f(b,this.toBBox);f(d,this.toBBox);c?a[c-1].children.push(d):this._splitRoot(b,d)},_splitRoot:function(a,c){this.data=q([a,c]);this.data.height=a.height+1;this.data.leaf=!1;f(this.data,this.toBBox)},_chooseSplitIndex:function(a,c,b){var d,f,h,g,l,m,p;l=m=Infinity;for(d=c;d<=b-c;d++)f=k(a,0,d,this.toBBox),h=k(a,d,b,this.toBBox),g=Math.max(0,Math.min(f.maxX,h.maxX)-Math.max(f.minX,h.minX))*Math.max(0,Math.min(f.maxY,h.maxY)-Math.max(f.minY,h.minY)),f=e(f)+e(h),g<l?(l=g,p=d,m=f<m?f:m):g===l&&f<m&&(m=f,p=d);return p},_chooseSplitAxis:function(a,c,b){var d=a.leaf?this.compareMinX:l,e=a.leaf?this.compareMinY:m,f=this._allDistMargin(a,c,b,d);c=this._allDistMargin(a,c,b,e);f<c&&a.children.sort(d)},_allDistMargin:function(a,c,b,d){a.children.sort(d);d=this.toBBox;var e=k(a,0,c,d),f=k(a,b-c,b,d),l=h(e)+h(f),m,p;for(m=c;m<b-c;m++)p=a.children[m],g(e,a.leaf?d(p):p),l+=h(e);for(m=b-c-1;m>=c;m--)p=a.children[m],g(f,a.leaf?d(p):p),l+=h(f);return l},_adjustParentBBoxes:function(a,c,b){for(;0<=b;b--)g(c[b],a)},_condense:function(a){for(var c=a.length-1,b;0<=c;c--)0===a[c].children.length?0<c?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():f(a[c],this.toBBox)},_initFormat:function(a){var c=["return a"," - b",";"];this.compareMinX=new Function("a","b",c.join(a[0]));this.compareMinY=new Function("a","b",c.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")}};return a});F("Core/RectangleCollisionChecker",["../ThirdParty/rbush","./Check"],function(b,a){function f(){this._tree=b()}function k(){this.maxY=this.maxX=this.minY=this.minX=0;this.id=""}function g(a,b){return a.id===b.id}k.fromRectangleAndId=function(a,b,f){f.minX=b.west;f.minY=b.south;f.maxX=b.east;f.maxY=b.north;f.id=a;return f};f.prototype.insert=function(b,f){a.typeOf.string("id",b);a.typeOf.object("rectangle",f);var e=k.fromRectangleAndId(b,f,new k);this._tree.insert(e)};var l=new k;f.prototype.remove=function(b,f){a.typeOf.string("id",b);a.typeOf.object("rectangle",f);var e=k.fromRectangleAndId(b,f,l);this._tree.remove(e,g)};var m=new k;f.prototype.collides=function(b){a.typeOf.object("rectangle",b);b=k.fromRectangleAndId("",b,m);return this._tree.collides(b)};return f});F("Core/RectangleGeometryLibrary","./Cartesian3 ./Cartographic ./defined ./DeveloperError ./GeographicProjection ./Math ./Matrix2 ./Rectangle".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d,e,f,h,g,k){var l=Math.cos(d);h=f*l;var l=e*l,p=Math.sin(d);f*=p;e*=p;c=A.project(a,c);c=b.subtract(c,y,c);d=m.fromRotation(d,r);c=m.multiplyByVector(d,c,c);c=b.add(c,y,c);a=A.unproject(c,a);--g;--k;d=a.latitude;var p=d+g*e,q=d-h*k,v=d-h*k+g*e,u=a.longitude,B=u+g*l,C=u+k*f;g=u+k*f+g*l;return{north:Math.max(d,p,q,v),south:Math.min(d,p,q,v),east:Math.max(u,B,C,g),west:Math.min(u,B,C,g),granYCos:h,granYSin:f,granXCos:l,granXSin:e,nwCorner:a}}var p=Math.cos,d=Math.sin,q=Math.sqrt,t={computePosition:function(a,c,b,e,h,g,k){var l=c.radiiSquared,m=a.nwCorner;c=a.boundingRectangle;var v=m.latitude-a.granYCos*e+h*a.granXSin,r=p(v),u=d(v),B=l.z*u,m=m.longitude+e*a.granYSin+h*a.granXCos,C=r*p(m),t=r*d(m),r=l.x*C,l=l.y*t,u=q(r*C+l*t+B*u);g.x=r/u;g.y=l/u;g.z=B/u;b&&(b=a.stNwCorner,f(b)?(v=b.latitude-a.stGranYCos*e+h*a.stGranXSin,m=b.longitude+e*a.stGranYSin+h*a.stGranXCos,k.x=(m-a.stWest)*a.lonScalar,k.y=(v-a.stSouth)*a.latScalar):(k.x=(m-c.west)*a.lonScalar,k.y=(v-c.south)*a.latScalar))}},r=new m,c=new b,u=new a,y=new b,A=new g;t.computeOptions=function(a,c,b,d,f,g,m){var p=a.east,q=a.west,v=a.north,r=a.south,B=!1,C=!1;v===l.PI_OVER_TWO&&(B=!0);r===-l.PI_OVER_TWO&&(C=!0);var t,z,D;D=v-r;z=q>p?l.TWO_PI-q+p:p-q;t=Math.ceil(z/c)+1;c=Math.ceil(D/c)+1;z/=t-1;D/=c-1;p=e.northwest(a,g);g=e.center(a,u);if(0!==b||0!==d)g.longitude<p.longitude&&(g.longitude+=l.TWO_PI),y=A.project(g,y);a=e.clone(a,f);B={granYCos:D,granYSin:0,granXCos:z,granXSin:0,nwCorner:p,boundingRectangle:a,width:t,height:c,northCap:B,southCap:C};if(0!==b){C=h(p,b,z,D,g,t,c);v=C.north;r=C.south;p=C.east;q=C.west;if(v<-l.PI_OVER_TWO||v>l.PI_OVER_TWO||r<-l.PI_OVER_TWO||r>l.PI_OVER_TWO)throw new k("Rotated rectangle is invalid.  It crosses over either the north or south pole.");B.granYCos=C.granYCos;B.granYSin=C.granYSin;B.granXCos=C.granXCos;B.granXSin=C.granXSin;a.north=v;a.south=r;a.east=p;a.west=q}0!==d&&(b-=d,d=e.northwest(a,m),b=h(d,b,z,D,g,t,c),B.stGranYCos=b.granYCos,B.stGranXCos=b.granXCos,B.stGranYSin=b.granYSin,B.stGranXSin=b.granXSin,B.stNwCorner=d,B.stWest=b.west,B.stSouth=b.south);return B};return t});F("Core/RectangleGeometry","./arrayFill ./BoundingSphere ./Cartesian2 ./Cartesian3 ./Cartographic ./Check ./ComponentDatatype ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryInstance ./GeometryOffsetAttribute ./GeometryPipeline ./IndexDatatype ./Math ./Matrix2 ./Matrix3 ./PolygonPipeline ./PrimitiveType ./Quaternion ./Rectangle ./RectangleGeometryLibrary ./VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w){function G(a,b){var d=new t({attributes:new c,primitiveType:C.TRIANGLES});d.attributes.position=new r({componentDatatype:m.DOUBLE,componentsPerAttribute:3,values:b.positions});a.normal&&(d.attributes.normal=new r({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:b.normals}));a.tangent&&(d.attributes.tangent=new r({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:b.tangents}));a.bitangent&&(d.attributes.bitangent=new r({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:b.bitangents}));return d}function E(a,c){var b=a._vertexFormat,d=a._ellipsoid,e=c.height,f=c.width,h=c.northCap,g=c.southCap,l=0,p=e,q=e,w=0;h&&(l=1,--q,w+=1);g&&(--p,--q,w+=1);for(var w=w+f*q,u=b.position?new Float64Array(3*w):void 0,B=b.st?new Float32Array(2*w):void 0,C=0,t=0,y=O,E=M,D=Number.MAX_VALUE,A=Number.MAX_VALUE,x=-Number.MAX_VALUE,I=-Number.MAX_VALUE;l<p;++l)for(var H=0;H<f;++H)J.computePosition(c,d,b.st,l,H,y,E),u[C++]=y.x,u[C++]=y.y,u[C++]=y.z,b.st&&(B[t++]=E.x,B[t++]=E.y,D=Math.min(D,E.x),A=Math.min(A,E.y),x=Math.max(x,E.x),I=Math.max(I,E.y));h&&(J.computePosition(c,d,b.st,0,0,y,E),u[C++]=y.x,u[C++]=y.y,u[C++]=y.z,b.st&&(B[t++]=E.x,B[t++]=E.y,D=E.x,A=E.y,x=E.x,I=E.y));g&&(J.computePosition(c,d,b.st,e-1,0,y,E),u[C++]=y.x,u[C++]=y.y,u[C]=y.z,b.st&&(B[t++]=E.x,B[t]=E.y,D=Math.min(D,E.x),A=Math.min(A,E.y),x=Math.max(x,E.x),I=Math.max(I,E.y)));if(b.st&&(0>D||0>A||1<x||1<I))for(e=0;e<B.length;e+=2)B[e]=(B[e]-D)/(x-D),B[e+1]=(B[e+1]-A)/(I-A);D=c.tangentRotationMatrix;A=u.length;x=b.normal?new Float32Array(A):void 0;I=b.tangent?new Float32Array(A):void 0;e=b.bitangent?new Float32Array(A):void 0;p=0;C=U;t=aa;y=Z;if(b.normal||b.tangent||b.bitangent)for(E=0;E<A;E+=3){var l=k.fromArray(u,E,O),H=p+1,L=p+2,y=d.geodeticSurfaceNormal(l,y);if(b.tangent||b.bitangent)k.cross(k.UNIT_Z,y,t),v.multiplyByVector(D,t,t),k.normalize(t,t),b.bitangent&&k.normalize(k.cross(y,t,C),C);b.normal&&(x[p]=y.x,x[H]=y.y,x[L]=y.z);b.tangent&&(I[p]=t.x,I[H]=t.y,I[L]=t.z);b.bitangent&&(e[p]=C.x,e[H]=C.y,e[L]=C.z);p+=3}d=G(b,{positions:u,normals:x,tangents:I,bitangents:e});u=6*(f-1)*(q-1);h&&(u+=3*(f-1));g&&(u+=3*(f-1));u=z.createTypedArray(w,u);for(x=A=D=0;x<q-1;++x){for(I=0;I<f-1;++I)e=D,p=e+f,C=p+1,t=e+1,u[A++]=e,u[A++]=p,u[A++]=t,u[A++]=t,u[A++]=p,u[A++]=C,++D;++D}if(h||g){I=w-1;e=w-1;h&&g&&(I=w-2);D=0;if(h)for(x=0;x<f-1;x++)h=D,w=h+1,u[A++]=I,u[A++]=h,u[A++]=w,++D;if(g)for(D=(q-1)*f,x=0;x<f-1;x++)h=D,w=h+1,u[A++]=h,u[A++]=e,u[A++]=w,++D}d.indices=u;b.st&&(d.attributes.st=new r({componentDatatype:m.FLOAT,componentsPerAttribute:2,values:B}));return d}function L(a,c,b,d,e){a[c++]=d[b];a[c++]=d[b+1];a[c++]=d[b+2];a[c++]=e[b];a[c++]=e[b+1];a[c]=e[b+2];return a}function K(a,c,b,d){a[c++]=d[b];a[c++]=d[b+1];a[c++]=d[b];a[c]=d[b+1];return a}function P(a,c,b,d,e){if(0===b)return H.clone(a,e);a=J.computeOptions(a,c,b,0,W,da);c=a.height;b=a.width;var f=T;J.computePosition(a,d,!1,0,0,f[0]);J.computePosition(a,d,!1,0,b-1,f[1]);J.computePosition(a,d,!1,c-1,0,f[2]);J.computePosition(a,d,!1,c-1,b-1,f[3]);return H.fromCartesianArray(f,d,e)}function N(a){a=e(a,e.EMPTY_OBJECT);var c=a.rectangle;l.typeOf.object("rectangle",c);H.validate(c);if(c.north<c.south)throw new d("options.rectangle.north must be greater than or equal to options.rectangle.south");var b=e(a.height,0),f=e(a.extrudedHeight,b);this._rectangle=H.clone(c);this._granularity=e(a.granularity,x.RADIANS_PER_DEGREE);this._ellipsoid=q.clone(e(a.ellipsoid,q.WGS84));this._surfaceHeight=Math.max(b,f);this._rotation=e(a.rotation,0);this._stRotation=e(a.stRotation,0);this._vertexFormat=w.clone(e(a.vertexFormat,w.DEFAULT));this._extrudedHeight=Math.min(b,f);this._shadowVolume=e(a.shadowVolume,!1);this._workerName="createRectangleGeometry";this._offsetAttribute=a.offsetAttribute;this._textureCoordinateRotationPoints=this._rotatedRectangle=void 0}var O=new k,Z=new k,aa=new k,U=new k,W=new H,M=new f,R=new a,Y=new a,Q=new k,S=new k,ca=new w,T=[new k,new k,new k,new k],da=new g,V=new g;N.packedLength=H.packedLength+q.packedLength+w.packedLength+7;N.pack=function(a,c,b){l.typeOf.object("value",a);l.defined("array",c);b=e(b,0);H.pack(a._rectangle,c,b);b+=H.packedLength;q.pack(a._ellipsoid,c,b);b+=q.packedLength;w.pack(a._vertexFormat,c,b);b+=w.packedLength;c[b++]=a._granularity;c[b++]=a._surfaceHeight;c[b++]=a._rotation;c[b++]=a._stRotation;c[b++]=a._extrudedHeight;c[b++]=a._shadowVolume?1:0;c[b]=e(a._offsetAttribute,-1);return c};var ba=new H,X=q.clone(q.UNIT_SPHERE),fa={rectangle:ba,ellipsoid:X,vertexFormat:ca,granularity:void 0,height:void 0,rotation:void 0,stRotation:void 0,extrudedHeight:void 0,shadowVolume:void 0,offsetAttribute:void 0};N.unpack=function(a,c,b){l.defined("array",a);c=e(c,0);var d=H.unpack(a,c,ba);c+=H.packedLength;var f=q.unpack(a,c,X);c+=q.packedLength;var g=w.unpack(a,c,ca);c+=w.packedLength;var k=a[c++],m=a[c++],p=a[c++],v=a[c++],r=a[c++],u=1===a[c++];a=a[c];if(!h(b))return fa.granularity=k,fa.height=m,fa.rotation=p,fa.stRotation=v,fa.extrudedHeight=r,fa.shadowVolume=u,fa.offsetAttribute=-1===a?void 0:a,new N(fa);b._rectangle=H.clone(d,b._rectangle);b._ellipsoid=q.clone(f,b._ellipsoid);b._vertexFormat=w.clone(g,b._vertexFormat);b._granularity=k;b._surfaceHeight=m;b._rotation=p;b._stRotation=v;b._extrudedHeight=r;b._shadowVolume=u;b._offsetAttribute=-1===a?void 0:a;return b};N.computeRectangle=function(a,c){a=e(a,e.EMPTY_OBJECT);var b=a.rectangle;l.typeOf.object("rectangle",b);H.validate(b);if(b.north<b.south)throw new d("options.rectangle.north must be greater than or equal to options.rectangle.south");var f=e(a.granularity,x.RADIANS_PER_DEGREE),h=e(a.ellipsoid,q.WGS84),g=e(a.rotation,0);return P(b,f,g,h,c)};var ga=new v,F=new I,na=new g;N.createGeometry=function(c){if(!x.equalsEpsilon(c._rectangle.north,c._rectangle.south,x.EPSILON10)&&!x.equalsEpsilon(c._rectangle.east,c._rectangle.west,x.EPSILON10)){var d=c._rectangle,e=c._ellipsoid,f=c._rotation,g=c._stRotation,l=c._vertexFormat,p=J.computeOptions(d,c._granularity,f,g,W,da,V);0!==g||0!==f?(d=H.center(d,na),d=e.geodeticSurfaceNormalCartographic(d,Q),I.fromAxisAngle(d,-g,F),v.fromQuaternion(F,ga)):v.clone(v.IDENTITY,ga);var g=c._surfaceHeight,f=c._extrudedHeight,q=!x.equalsEpsilon(g,f,0,x.EPSILON2);p.lonScalar=1/c._rectangle.width;p.latScalar=1/c._rectangle.height;p.tangentRotationMatrix=ga;d=c._rectangle;if(q){var C=c._shadowVolume,D=c._offsetAttribute,T=c._vertexFormat,M=c._extrudedHeight,P=c._surfaceHeight,N=c._ellipsoid,ba=p.height,fa=p.width,X;C&&(q=w.clone(T,ca),q.normal=!0,c._vertexFormat=q);q=E(c,p);C&&(c._vertexFormat=T);var P=B.scaleToGeodeticHeight(q.attributes.position.values,P,N,!1),P=new Float64Array(P),oa=P.length,la=2*oa;X=new Float64Array(la);X.set(P);var pa=B.scaleToGeodeticHeight(q.attributes.position.values,M,N);X.set(pa,oa);q.attributes.position.values=X;var M=T.normal?new Float32Array(la):void 0,ka=T.tangent?new Float32Array(la):void 0,ia=T.bitangent?new Float32Array(la):void 0,Fa=T.st?new Float32Array(la/3*2):void 0,Ja,ha;if(T.normal){ha=q.attributes.normal.values;M.set(ha);for(X=0;X<oa;X++)ha[X]=-ha[X];M.set(ha,oa);q.attributes.normal.values=M}if(C){ha=q.attributes.normal.values;T.normal||(q.attributes.normal=void 0);M=new Float32Array(la);for(X=0;X<oa;X++)ha[X]=-ha[X];M.set(ha,oa);q.attributes.extrudeDirection=new r({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:M})}if(M=h(D)){X=oa/3*2;var va=new Uint8Array(X);D===y.TOP?va=b(va,1,0,X/2):(X=D===y.NONE?0:1,va=b(va,X));q.attributes.applyOffset=new r({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:va})}if(T.tangent){va=q.attributes.tangent.values;ka.set(va);for(X=0;X<oa;X++)va[X]=-va[X];ka.set(va,oa);q.attributes.tangent.values=ka}T.bitangent&&(X=q.attributes.bitangent.values,ia.set(X),ia.set(X,oa),q.attributes.bitangent.values=ia);T.st&&(Ja=q.attributes.st.values,Fa.set(Ja),Fa.set(Ja,oa/3*2),q.attributes.st.values=Fa);ia=q.indices;Fa=ia.length;oa/=3;la=z.createTypedArray(la/3,2*Fa);la.set(ia);for(X=0;X<Fa;X+=3)la[X+Fa]=ia[X+2]+oa,la[X+1+Fa]=ia[X+1]+oa,la[X+2+Fa]=ia[X]+oa;q.indices=la;var ka=p.northCap,va=p.southCap,Sa=ba,p=2,oa=0,ba=X=4;ka&&(--p,--Sa,oa+=1,X-=2,--ba);va&&(--p,--Sa,oa+=1,X-=2,--ba);var oa=oa+(p*fa+2*Sa-X),ba=2*(oa+ba),p=new Float64Array(3*ba),la=C?new Float32Array(3*ba):void 0,ia=M?new Uint8Array(ba):void 0,Fa=T.st?new Float32Array(2*ba):void 0,Oa=D===y.TOP;M&&!Oa&&(X=D===y.ALL?1:0,ia=b(ia,X));var Ta=D=0,Ka=0,Wa=0,Sa=fa*Sa,Ra;for(X=0;X<Sa;X+=fa)Ra=3*X,p=L(p,D,Ra,P,pa),D+=6,T.st&&(Fa=K(Fa,Ta,2*X,Ja),Ta+=4),C&&(Ka+=3,la[Ka++]=ha[Ra],la[Ka++]=ha[Ra+1],la[Ka++]=ha[Ra+2]),Oa&&(ia[Wa++]=1,Wa+=1);if(va)for(va=ka?Sa+1:Sa,Ra=3*va,X=0;2>X;X++)p=L(p,D,Ra,P,pa),D+=6,T.st&&(Fa=K(Fa,Ta,2*va,Ja),Ta+=4),C&&(Ka+=3,la[Ka++]=ha[Ra],la[Ka++]=ha[Ra+1],la[Ka++]=ha[Ra+2]),Oa&&(ia[Wa++]=1,Wa+=1);else for(X=Sa-fa;X<Sa;X++)Ra=3*X,p=L(p,D,Ra,P,pa),D+=6,T.st&&(Fa=K(Fa,Ta,2*X,Ja),Ta+=4),C&&(Ka+=3,la[Ka++]=ha[Ra],la[Ka++]=ha[Ra+1],la[Ka++]=ha[Ra+2]),Oa&&(ia[Wa++]=1,Wa+=1);for(X=Sa-1;0<X;X-=fa)Ra=3*X,p=L(p,D,Ra,P,pa),D+=6,T.st&&(Fa=K(Fa,Ta,2*X,Ja),Ta+=4),C&&(Ka+=3,la[Ka++]=ha[Ra],la[Ka++]=ha[Ra+1],la[Ka++]=ha[Ra+2]),Oa&&(ia[Wa++]=1,Wa+=1);if(ka)for(Ra=3*Sa,X=0;2>X;X++)p=L(p,D,Ra,P,pa),D+=6,T.st&&(Fa=K(Fa,Ta,2*Sa,Ja),Ta+=4),C&&(Ka+=3,la[Ka++]=ha[Ra],la[Ka++]=ha[Ra+1],la[Ka++]=ha[Ra+2]),Oa&&(ia[Wa++]=1,Wa+=1);else for(X=fa-1;0<=X;X--)Ra=3*X,p=L(p,D,Ra,P,pa),D+=6,T.st&&(Fa=K(Fa,Ta,2*X,Ja),Ta+=4),C&&(Ka+=3,la[Ka++]=ha[Ra],la[Ka++]=ha[Ra+1],la[Ka++]=ha[Ra+2]),Oa&&(ia[Wa++]=1,Wa+=1);Ja=p;ha=Ja.length;fa=T.normal?new Float32Array(ha):void 0;P=T.tangent?new Float32Array(ha):void 0;X=T.bitangent?new Float32Array(ha):void 0;ka=D=pa=0;Ra=!0;va=U;Oa=aa;Sa=Z;if(T.normal||T.tangent||T.bitangent)for(Ta=0;Ta<ha;Ta+=6){Ka=k.fromArray(Ja,Ta,O);Wa=k.fromArray(Ja,(Ta+6)%ha,Q);Ra&&(Ra=k.fromArray(Ja,(Ta+3)%ha,S),k.subtract(Wa,Ka,Wa),k.subtract(Ra,Ka,Ra),Sa=k.normalize(k.cross(Ra,Wa,Sa),Sa),Ra=!1);k.equalsEpsilon(Wa,Ka,x.EPSILON10)&&(Ra=!0);if(T.tangent||T.bitangent)va=N.geodeticSurfaceNormal(Ka,va),T.tangent&&(Oa=k.normalize(k.cross(va,Sa,Oa),Oa));T.normal&&(fa[pa++]=Sa.x,fa[pa++]=Sa.y,fa[pa++]=Sa.z,fa[pa++]=Sa.x,fa[pa++]=Sa.y,fa[pa++]=Sa.z);T.tangent&&(P[D++]=Oa.x,P[D++]=Oa.y,P[D++]=Oa.z,P[D++]=Oa.x,P[D++]=Oa.y,P[D++]=Oa.z);T.bitangent&&(X[ka++]=va.x,X[ka++]=va.y,X[ka++]=va.z,X[ka++]=va.x,X[ka++]=va.y,X[ka++]=va.z)}N=G(T,{positions:Ja,normals:fa,tangents:P,bitangents:X});T.st&&(N.attributes.st=new r({componentDatatype:m.FLOAT,componentsPerAttribute:2,values:Fa}));C&&(N.attributes.extrudeDirection=new r({componentDatatype:m.FLOAT,componentsPerAttribute:3,values:la}));M&&(N.attributes.applyOffset=new r({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:ia}));C=z.createTypedArray(ba,6*oa);oa=p.length/3;for(X=Ja=0;X<oa-1;X+=2)T=X,M=(T+2)%oa,ha=k.fromArray(p,3*T,Q),fa=k.fromArray(p,3*M,S),k.equalsEpsilon(ha,fa,x.EPSILON10)||(ha=(T+1)%oa,fa=(ha+2)%oa,C[Ja++]=T,C[Ja++]=ha,C[Ja++]=M,C[Ja++]=M,C[Ja++]=ha,C[Ja++]=fa);N.indices=C;N=A.combineInstances([new u({geometry:q}),new u({geometry:N})]);q=N[0];g=a.fromRectangle3D(d,e,g,Y);e=a.fromRectangle3D(d,e,f,R);e=a.union(g,e)}else q=E(c,p),q.attributes.position.values=B.scaleToGeodeticHeight(q.attributes.position.values,g,e,!1),h(c._offsetAttribute)&&(f=new Uint8Array(q.attributes.position.values.length/3),b(f,c._offsetAttribute===y.NONE?0:1),q.attributes.applyOffset=new r({componentDatatype:m.UNSIGNED_BYTE,componentsPerAttribute:1,values:f})),e=a.fromRectangle3D(d,e,g);l.position||delete q.attributes.position;return new t({attributes:q.attributes,indices:q.indices,primitiveType:q.primitiveType,boundingSphere:e,offsetAttribute:c._offsetAttribute})}};N.createShadowVolume=function(a,c,b){var d=a._granularity,e=a._ellipsoid;c=c(d,e);b=b(d,e);return new N({rectangle:a._rectangle,rotation:a._rotation,ellipsoid:e,stRotation:a._stRotation,granularity:d,extrudedHeight:b,height:c,vertexFormat:w.POSITION_ONLY,shadowVolume:!0})};var ia=new H,la=[new f,new f,new f],ha=new D,pa=new g;p(N.prototype,{rectangle:{get:function(){h(this._rotatedRectangle)||(this._rotatedRectangle=P(this._rectangle,this._granularity,this._rotation,this._ellipsoid));return this._rotatedRectangle}},textureCoordinateRotationPoints:{get:function(){if(!h(this._textureCoordinateRotationPoints)){var a;if(0===this._stRotation)a=[0,0,0,1,1,0];else{a=H.clone(this._rectangle,ia);a=P(a,this._granularity,this._rotation-this._stRotation,this._ellipsoid,ia);la[0].x=a.west;la[0].y=a.south;la[1].x=a.west;la[1].y=a.north;la[2].x=a.east;la[2].y=a.south;a=this.rectangle;for(var c=D.fromRotation(this._stRotation,ha),b=H.center(a,pa),d=0;3>d;++d){var e=la[d];e.x-=b.longitude;e.y-=b.latitude;D.multiplyByVector(c,e,e);e.x+=b.longitude;e.y+=b.latitude;e.x=(e.x-a.west)/a.width;e.y=(e.y-a.south)/a.height}a=la[1];c=la[2];b=Array(6);f.pack(la[0],b);f.pack(a,b,2);f.pack(c,b,4);a=b}this._textureCoordinateRotationPoints=a}return this._textureCoordinateRotationPoints}}});return N});F("Core/RectangleOutlineGeometry","./arrayFill ./BoundingSphere ./Cartesian3 ./Cartographic ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./GeometryOffsetAttribute ./IndexDatatype ./Math ./PolygonPipeline ./PrimitiveType ./Rectangle ./RectangleGeometryLibrary".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(a,c){var b=a._ellipsoid,e=c.height,f=c.width,h=c.northCap,k=c.southCap,l=e,m=2,v=0,w=4;h&&(--m,--l,v+=1,w-=2);k&&(--m,--l,v+=1,w-=2);l=new Float64Array(3*(v+(m*f+2*l-w)));v=m=0;w=C;if(h)z.computePosition(c,b,!1,v,0,w),l[m++]=w.x,l[m++]=w.y,l[m++]=w.z;else for(h=0;h<f;h++)z.computePosition(c,b,!1,v,h,w),l[m++]=w.x,l[m++]=w.y,l[m++]=w.z;h=f-1;for(v=1;v<e;v++)z.computePosition(c,b,!1,v,h,w),l[m++]=w.x,l[m++]=w.y,l[m++]=w.z;v=e-1;if(!k)for(h=f-2;0<=h;h--)z.computePosition(c,b,!1,v,h,w),l[m++]=w.x,l[m++]=w.y,l[m++]=w.z;h=0;for(v=e-2;0<v;v--)z.computePosition(c,b,!1,v,h,w),l[m++]=w.x,l[m++]=w.y,l[m++]=w.z;b=r.createTypedArray(l.length/3,l.length/3*2);for(f=e=0;f<l.length/3-1;f++)b[e++]=f,b[e++]=f+1;b[e++]=l.length/3-1;b[e++]=0;e=new p({attributes:new q,primitiveType:y.LINES});e.attributes.position=new d({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:l});e.indices=b;return e}function D(a){a=l(a,l.EMPTY_OBJECT);var b=a.rectangle,d=l(a.granularity,c.RADIANS_PER_DEGREE),f=l(a.ellipsoid,h.WGS84),g=l(a.rotation,0);if(!m(b))throw new e("rectangle is required.");A.validate(b);if(b.north<b.south)throw new e("options.rectangle.north must be greater than options.rectangle.south");var k=l(a.height,0),p=l(a.extrudedHeight,k);this._rectangle=A.clone(b);this._granularity=d;this._ellipsoid=f;this._surfaceHeight=Math.max(k,p);this._rotation=g;this._extrudedHeight=Math.min(k,p);this._offsetAttribute=a.offsetAttribute;this._workerName="createRectangleOutlineGeometry"}var v=new a,B=new a,C=new f,I=new A;D.packedLength=A.packedLength+h.packedLength+5;D.pack=function(a,c,b){if(!m(a))throw new e("value is required");if(!m(c))throw new e("array is required");b=l(b,0);A.pack(a._rectangle,c,b);b+=A.packedLength;h.pack(a._ellipsoid,c,b);b+=h.packedLength;c[b++]=a._granularity;c[b++]=a._surfaceHeight;c[b++]=a._rotation;c[b++]=a._extrudedHeight;c[b]=l(a._offsetAttribute,-1);return c};var H=new A,J=h.clone(h.UNIT_SPHERE),w={rectangle:H,ellipsoid:J,granularity:void 0,height:void 0,rotation:void 0,extrudedHeight:void 0,offsetAttribute:void 0};D.unpack=function(a,c,b){if(!m(a))throw new e("array is required");c=l(c,0);var d=A.unpack(a,c,H);c+=A.packedLength;var f=h.unpack(a,c,J);c+=h.packedLength;var g=a[c++],k=a[c++],p=a[c++],q=a[c++];a=a[c];if(!m(b))return w.granularity=g,w.height=k,w.rotation=p,w.extrudedHeight=q,w.offsetAttribute=-1===a?void 0:a,new D(w);b._rectangle=A.clone(d,b._rectangle);b._ellipsoid=h.clone(f,b._ellipsoid);b._surfaceHeight=k;b._rotation=p;b._extrudedHeight=q;b._offsetAttribute=-1===a?void 0:a;return b};var G=new k;D.createGeometry=function(e){var f=e._rectangle,h=e._ellipsoid,k=z.computeOptions(f,e._granularity,e._rotation,0,I,G),l;if(!c.equalsEpsilon(f.north,f.south,c.EPSILON10)&&!c.equalsEpsilon(f.east,f.west,c.EPSILON10)){var q=e._surfaceHeight,w=e._extrudedHeight,C;if(c.equalsEpsilon(q,w,0,c.EPSILON2))l=x(e,k),l.attributes.position.values=u.scaleToGeodeticHeight(l.attributes.position.values,q,h,!1),m(e._offsetAttribute)&&(w=new Uint8Array(l.attributes.position.values.length/3),C=e._offsetAttribute===t.NONE?0:1,b(w,C),l.attributes.applyOffset=new d({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:1,values:w})),f=a.fromRectangle3D(f,h,q);else{var D=e._ellipsoid,E=e._extrudedHeight,A=e._surfaceHeight;l=x(e,k);var H=k.height;C=k.width;var J=u.scaleToGeodeticHeight(l.attributes.position.values,A,D,!1),A=J.length,Q=new Float64Array(2*A);Q.set(J);D=u.scaleToGeodeticHeight(l.attributes.position.values,E,D);Q.set(D,A);l.attributes.position.values=Q;E=k.northCap;k=k.southCap;A=4;E&&--A;k&&--A;D=r.createTypedArray(Q.length/3,2*(Q.length/3+A));A=Q.length/6;for(J=Q=0;J<A-1;J++)D[Q++]=J,D[Q++]=J+1,D[Q++]=J+A,D[Q++]=J+A+1;D[Q++]=A-1;D[Q++]=0;D[Q++]=A+A-1;D[Q++]=A;D[Q++]=0;D[Q++]=A;E?--H:(E=C-1,D[Q++]=E,D[Q++]=E+A,H=C+H-2);D[Q++]=H;D[Q++]=H+A;k||(C=C+H-1,D[Q++]=C,D[Q]=C+A);l.indices=D;m(e._offsetAttribute)&&(C=l.attributes.position.values.length/3,H=new Uint8Array(C),e._offsetAttribute===t.TOP?H=b(H,1,0,C/2):(C=e._offsetAttribute===t.NONE?0:1,H=b(H,C)),l.attributes.applyOffset=new d({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:1,values:H}));q=a.fromRectangle3D(f,h,q,B);f=a.fromRectangle3D(f,h,w,v);f=a.union(q,f)}return new p({attributes:l.attributes,indices:l.indices,primitiveType:y.LINES,boundingSphere:f,offsetAttribute:e._offsetAttribute})}};return D});F("Core/ReferenceFrame",["./freezeObject"],function(b){return b({FIXED:0,INERTIAL:1})});F("Core/requestAnimationFrame",["./defined","./getTimestamp"],function(b,a){if("undefined"!==typeof window){var f=window.requestAnimationFrame;(function(){if(!b(f))for(var k=["webkit","moz","ms","o"],g=0,l=k.length;g<l&&!b(f);)f=window[k[g]+"RequestAnimationFrame"],++g;if(!b(f)){var m=1E3/60,e=0;f=function(b){var f=a(),d=Math.max(m-(f-e),0);e=f+d;return setTimeout(function(){b(e)},d)}}})();return function(a){return f(a)}}});F("Core/sampleTerrain",["../ThirdParty/when","./Check"],function(b,a){function f(a,f,e){var h=a.tilingScheme,l,d=[],m={};for(l=0;l<e.length;++l){var t=h.positionToTileXY(e[l],f),r=t.toString();m.hasOwnProperty(r)||(t={x:t.x,y:t.y,level:f,tilingScheme:h,terrainProvider:a,positions:[]},m[r]=t,d.push(t));m[r].positions.push(e[l])}a=[];for(l=0;l<d.length;++l)f=d[l],f=f.terrainProvider.requestTileGeometry(f.x,f.y,f.level).then(k(f)).otherwise(g(f)),a.push(f);return b.all(a,function(){return e})}function k(a){var b=a.positions,e=a.tilingScheme.tileXYToRectangle(a.x,a.y,a.level);return function(a){for(var f=0;f<b.length;++f){var d=b[f];d.height=a.interpolateHeight(e,d.longitude,d.latitude)}}}function g(a){var b=a.positions;return function(){for(var a=0;a<b.length;++a)b[a].height=void 0}}return function(b,g,e){a.typeOf.object("terrainProvider",b);a.typeOf.number("level",g);a.defined("positions",e);return b.readyPromise.then(function(){return f(b,g,e)})}});F("Core/sampleTerrainMostDetailed",["../ThirdParty/when","./Cartesian2","./defined","./DeveloperError","./sampleTerrain"],function(b,a,f,k,g){function l(a,h){if(!f(a))throw new k("terrainProvider is required.");if(!f(h))throw new k("positions is required.");return a.readyPromise.then(function(){var e=[],d=[],q=a.availability;if(!f(q))throw new k("sampleTerrainMostDetailed requires a terrain provider that has tile availability.");for(var t=[],r=0;r<h.length;++r){var c=h[r],u=q.computeMaximumLevelAtPosition(c);d[r]=u;if(0===u){a.tilingScheme.positionToTileXY(c,1,m);var y=a.loadTileDataAvailability(m.x,m.y,1);f(y)&&t.push(y)}y=e[u];f(y)||(e[u]=y=[]);y.push(c)}return b.all(t).then(function(){return b.all(e.map(function(c,b){if(f(c))return g(a,b,c)}))}).then(function(){for(var c=[],b=0;b<h.length;++b){var e=h[b];q.computeMaximumLevelAtPosition(e)!==d[b]&&c.push(e)}if(0<c.length)return l(a,c)}).then(function(){return h})})}var m=new a;return l});F("Core/ScreenSpaceEventType",["./freezeObject"],function(b){return b({LEFT_DOWN:0,LEFT_UP:1,LEFT_CLICK:2,LEFT_DOUBLE_CLICK:3,RIGHT_DOWN:5,RIGHT_UP:6,RIGHT_CLICK:7,MIDDLE_DOWN:10,MIDDLE_UP:11,MIDDLE_CLICK:12,MOUSE_MOVE:15,WHEEL:16,PINCH_START:17,PINCH_END:18,PINCH_MOVE:19})});F("Core/ScreenSpaceEventHandler","./AssociativeArray ./Cartesian2 ./defaultValue ./defined ./destroyObject ./DeveloperError ./FeatureDetection ./getTimestamp ./KeyboardEventModifier ./ScreenSpaceEventType".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a,c,b){a=a._element;if(a===document)return b.x=c.clientX,b.y=c.clientY,b;a=a.getBoundingClientRect();b.x=c.clientX-a.left;b.y=c.clientY-a.top;return b}function q(a,c){var b=a;k(c)&&(b+="+"+c);return b}function t(a){if(a.shiftKey)return h.SHIFT;if(a.ctrlKey)return h.CTRL;if(a.altKey)return h.ALT}function r(a,c,b,d){function e(c){d(a,c)}b.addEventListener(c,e,!1);a._removalFunctions.push(function(){b.removeEventListener(c,e,!1)})}function c(a){return e()-a._lastSeenTouchEvent>L.mouseEmulationIgnoreMilliseconds}function u(a,c,b){var d=a.x-c.x;a=a.y-c.y;return Math.sqrt(d*d+a*a)<b}function y(b,e){if(c(b)){var f=e.button;b._buttonDown[f]=!0;var h;if(f===K.LEFT)h=p.LEFT_DOWN;else if(f===K.MIDDLE)h=p.MIDDLE_DOWN;else if(f===K.RIGHT)h=p.RIGHT_DOWN;else return;f=d(b,e,b._primaryPosition);a.clone(f,b._primaryStartPosition);a.clone(f,b._primaryPreviousPosition);var g=t(e);h=b.getInputAction(h,g);k(h)&&(a.clone(f,P.position),h(P),e.preventDefault())}}function A(c,b,e,f){var h=t(f);b=c.getInputAction(b,h);e=c.getInputAction(e,h);if(k(b)||k(e))f=d(c,f,c._primaryPosition),k(b)&&(a.clone(f,N.position),b(N)),k(e)&&u(c._primaryStartPosition,f,c._clickPixelTolerance)&&(a.clone(f,O.position),e(O))}function z(a,b){if(c(a)){var d=b.button;if(d===K.LEFT||d===K.MIDDLE||d===K.RIGHT)a._buttonDown[K.LEFT]&&(A(a,p.LEFT_UP,p.LEFT_CLICK,b),a._buttonDown[K.LEFT]=!1),a._buttonDown[K.MIDDLE]&&(A(a,p.MIDDLE_UP,p.MIDDLE_CLICK,b),a._buttonDown[K.MIDDLE]=!1),a._buttonDown[K.RIGHT]&&(A(a,p.RIGHT_UP,p.RIGHT_CLICK,b),a._buttonDown[K.RIGHT]=!1)}}function x(b,e){if(c(b)){var f=t(e),h=d(b,e,b._primaryPosition),g=b._primaryPreviousPosition,f=b.getInputAction(p.MOUSE_MOVE,f);k(f)&&(a.clone(g,Z.startPosition),a.clone(h,Z.endPosition),f(Z));a.clone(h,g);(b._buttonDown[K.LEFT]||b._buttonDown[K.MIDDLE]||b._buttonDown[K.RIGHT])&&e.preventDefault()}}function D(a,c){var b;if(c.button===K.LEFT){b=p.LEFT_DOUBLE_CLICK;var e=t(c);b=a.getInputAction(b,e);k(b)&&(d(a,c,aa.position),b(aa))}}function v(a,c){var b;k(c.deltaY)?(b=c.deltaMode,b=b===c.DOM_DELTA_PIXEL?-c.deltaY:b===c.DOM_DELTA_LINE?40*-c.deltaY:120*-c.deltaY):b=0<c.detail?-120*c.detail:c.wheelDelta;if(k(b)){var d=t(c),d=a.getInputAction(p.WHEEL,d);k(d)&&(d(b),c.preventDefault())}}function B(c,b){c._lastSeenTouchEvent=e();var f=b.changedTouches,h,g=f.length,k,l,m=c._positions;for(h=0;h<g;++h)k=f[h],l=k.identifier,m.set(l,d(c,k,new a));I(c,b);var p=c._previousPositions;for(h=0;h<g;++h)k=f[h],l=k.identifier,p.set(l,a.clone(m.get(l)))}function C(a,c){a._lastSeenTouchEvent=e();var b=c.changedTouches,d,f=b.length,h,g=a._positions;for(d=0;d<f;++d)h=b[d],h=h.identifier,g.remove(h);I(a,c);g=a._previousPositions;for(d=0;d<f;++d)h=b[d],h=h.identifier,g.remove(h)}function I(c,b){var d=t(b),e=c._positions,f=e.length,h,g,l=c._isPinching;1!==f&&c._buttonDown[K.LEFT]&&(c._buttonDown[K.LEFT]=!1,k(c._touchHoldTimer)&&(clearTimeout(c._touchHoldTimer),c._touchHoldTimer=void 0),h=c.getInputAction(p.LEFT_UP,d),k(h)&&(a.clone(c._primaryPosition,M.position),h(M)),0!==f||c._isTouchHolding||(g=c.getInputAction(p.LEFT_CLICK,d),k(g)&&u(c._primaryStartPosition,c._previousPositions.values[0],c._clickPixelTolerance)&&(a.clone(c._primaryPosition,R.position),g(R))),c._isTouchHolding=!1);0===f&&l&&(c._isPinching=!1,h=c.getInputAction(p.PINCH_END,d),k(h)&&h());if(1===f&&!l){var m=e.values[0];a.clone(m,c._primaryPosition);a.clone(m,c._primaryStartPosition);a.clone(m,c._primaryPreviousPosition);c._buttonDown[K.LEFT]=!0;h=c.getInputAction(p.LEFT_DOWN,d);k(h)&&(a.clone(m,U.position),h(U));c._touchHoldTimer=setTimeout(function(){c.isDestroyed()||(c._touchHoldTimer=void 0,c._isTouchHolding=!0,g=c.getInputAction(p.RIGHT_CLICK,d),k(g)&&u(c._primaryStartPosition,c._previousPositions.values[0],c._holdPixelTolerance)&&(a.clone(c._primaryPosition,Y.position),g(Y)))},L.touchHoldDelayMilliseconds);b.preventDefault()}2!==f||l||(c._isPinching=!0,h=c.getInputAction(p.PINCH_START,d),k(h)&&(a.clone(e.values[0],W.position1),a.clone(e.values[1],W.position2),h(W),b.preventDefault()))}function H(c,b){c._lastSeenTouchEvent=e();var f=b.changedTouches,h,g=f.length,l,m,p=c._positions;for(h=0;h<g;++h)l=f[h],m=l.identifier,m=p.get(m),k(m)&&d(c,l,m);J(c,b);var q=c._previousPositions;for(h=0;h<g;++h)l=f[h],m=l.identifier,a.clone(p.get(m),q.get(m))}function J(c,b){var d=t(b),e=c._positions,f=c._previousPositions,h=e.length;if(1===h&&c._buttonDown[K.LEFT])f=e.values[0],a.clone(f,c._primaryPosition),e=c._primaryPreviousPosition,d=c.getInputAction(p.MOUSE_MOVE,d),k(d)&&(a.clone(e,Q.startPosition),a.clone(f,Q.endPosition),d(Q)),a.clone(f,e),b.preventDefault();else if(2===h&&c._isPinching&&(d=c.getInputAction(p.PINCH_MOVE,d),k(d))){var g=e.values[0],l=e.values[1],m=f.values[0],q=f.values[1],v=l.x-g.x,w=l.y-g.y,f=.25*Math.sqrt(v*v+w*w),e=q.x-m.x,h=q.y-m.y,g=.125*(l.y+g.y),m=.125*(q.y+m.y),v=Math.atan2(w,v),w=Math.atan2(h,e);a.fromElements(0,.25*Math.sqrt(e*e+h*h),S.distance.startPosition);a.fromElements(0,f,S.distance.endPosition);a.fromElements(w,m,S.angleAndHeight.startPosition);a.fromElements(v,g,S.angleAndHeight.endPosition);d(S)}}function w(c,b){b.target.setPointerCapture(b.pointerId);if("touch"===b.pointerType){var e=c._positions,f=b.pointerId;e.set(f,d(c,b,new a));I(c,b);c._previousPositions.set(f,a.clone(e.get(f)))}else y(c,b)}function G(a,c){if("touch"===c.pointerType){var b=c.pointerId;a._positions.remove(b);I(a,c);a._previousPositions.remove(b)}else z(a,c)}function E(c,b){if("touch"===b.pointerType){var e=c._positions,f=b.pointerId,h=e.get(f);k(h)&&(d(c,b,h),J(c,b),h=c._previousPositions,a.clone(e.get(f),h.get(f)))}else x(c,b)}function L(c){this._inputEvents={};this._buttonDown={LEFT:!1,MIDDLE:!1,RIGHT:!1};this._isTouchHolding=this._isPinching=!1;this._lastSeenTouchEvent=-L.mouseEmulationIgnoreMilliseconds;this._primaryStartPosition=new a;this._primaryPosition=new a;this._primaryPreviousPosition=new a;this._positions=new b;this._previousPositions=new b;this._removalFunctions=[];this._touchHoldTimer=void 0;this._clickPixelTolerance=5;this._holdPixelTolerance=25;c=this._element=f(c,document);var d=k(c.disableRootEvents)?c:document;m.isWindows()||m.isLinux()?(r(this,"mousedown",c,y),r(this,"mouseup",d,z),r(this,"mousemove",d,x),r(this,"touchstart",c,B),r(this,"touchend",d,C),r(this,"touchmove",d,H),r(this,"touchcancel",d,C)):m.supportsPointerEvents()?(r(this,"pointerdown",c,w),r(this,"pointerup",c,G),r(this,"pointermove",c,E),r(this,"pointercancel",c,G)):(r(this,"mousedown",c,y),r(this,"mouseup",d,z),r(this,"mousemove",d,x),r(this,"touchstart",c,B),r(this,"touchend",d,C),r(this,"touchmove",d,H),r(this,"touchcancel",d,C));r(this,"dblclick",c,D);r(this,"onwheel"in c?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",c,v)}var K={LEFT:0,MIDDLE:1,RIGHT:2},P={position:new a},N={position:new a},O={position:new a},Z={startPosition:new a,endPosition:new a},aa={position:new a},U={position:new a},W={position1:new a,position2:new a},M={position:new a},R={position:new a},Y={position:new a},Q={startPosition:new a,endPosition:new a},S={distance:{startPosition:new a,endPosition:new a},angleAndHeight:{startPosition:new a,endPosition:new a}};L.prototype.setInputAction=function(a,c,b){if(!k(a))throw new l("action is required.");if(!k(c))throw new l("type is required.");c=q(c,b);this._inputEvents[c]=a};L.prototype.getInputAction=function(a,c){if(!k(a))throw new l("type is required.");var b=q(a,c);return this._inputEvents[b]};L.prototype.removeInputAction=function(a,c){if(!k(a))throw new l("type is required.");var b=q(a,c);delete this._inputEvents[b]};L.prototype.isDestroyed=function(){return!1};L.prototype.destroy=function(){for(var a=this._removalFunctions,c=0;c<a.length;++c)a[c]();return g(this)};L.mouseEmulationIgnoreMilliseconds=800;L.touchHoldDelayMilliseconds=1500;return L});F("Core/ShowGeometryInstanceAttribute",["./ComponentDatatype","./defaultValue","./defined","./defineProperties","./DeveloperError"],function(b,a,f,k,g){function l(b){b=a(b,!0);this.value=l.toValue(b)}k(l.prototype,{componentDatatype:{get:function(){return b.UNSIGNED_BYTE}},componentsPerAttribute:{get:function(){return 1}},normalize:{get:function(){return!1}}});l.toValue=function(a,b){if(!f(a))throw new g("show is required.");if(!f(b))return new Uint8Array([a]);b[0]=a;return b};return l});F("Core/Simon1994PlanetaryPositions","./Cartesian3 ./defined ./DeveloperError ./JulianDate ./Math ./Matrix3 ./TimeConstants ./TimeStandard".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=6.239996+.0172019696544*a;return.001657*Math.sin(a+.01671*Math.sin(a))}function p(a,c){c=k.addSeconds(a,32.184,c);var b=k.totalDays(c)-2451545;return c=k.addSeconds(c,h(b),c)}function d(c,d,e,h,k,m,p){0>e&&(e=-e,k+=g.PI);if(0>e||e>g.PI)throw new f("The inclination is out of range. Inclination must be greater than or equal to zero and less than or equal to Pi radians.");c*=1-d;var q=h-k;h=m-h;if(0>d||1<=d)throw new f("eccentricity out of range.");if(0>d||1<=d)throw new f("eccentricity out of range.");m=Math.floor(h/g.TWO_PI);h-=m*g.TWO_PI;var v=h+d*Math.sin(h)/(1-Math.sin(h+d)+Math.sin(h)),w=Number.MAX_VALUE,r;for(r=0;r<A&&Math.abs(w-v)>z;++r)w=v,v=w-(w-d*Math.sin(w)-h)/(1-d*Math.cos(w));if(r>=A)throw new f("Kepler equation did not converge");h=w=v+m*g.TWO_PI;if(0>d||1<=d)throw new f("eccentricity out of range.");m=Math.floor(h/g.TWO_PI);h-=m*g.TWO_PI;v=Math.atan2(Math.sin(h)*Math.sqrt(1-d*d),Math.cos(h)-d);v=g.zeroToTwoPi(v);0>h&&(v-=g.TWO_PI);h=v+=m*g.TWO_PI;if(0>d)throw new f("eccentricity cannot be negative.");if("Hyperbolic"===(0>=d?"Circular":1>d?"Elliptical":1>=d?"Parabolic":"Hyperbolic")&&Math.abs(g.negativePiToPi(h))>=Math.acos(-1/d))throw new f("The true anomaly of the hyperbolic orbit lies outside of the bounds of the hyperbola.");w=e;e=y;if(0>w||w>g.PI)throw new f("inclination out of range");m=Math.cos(q);q=Math.sin(q);v=Math.cos(w);w=Math.sin(w);r=Math.cos(k);k=Math.sin(k);a(e)?(e[0]=r*m-k*q*v,e[1]=k*m+r*q*v,e[2]=q*w,e[3]=-r*q-k*m*v,e[4]=-k*q+r*m*v,e[5]=m*w,e[6]=k*w,e[7]=-r*w,e[8]=v):new l(r*m-k*q*v,-r*q-k*m*v,k*w,k*m+r*q*v,-k*q+r*m*v,-r*w,q*w,m*w,v);k=c*(1+d);c=Math.cos(h);q=Math.sin(h);d=1+d*c;if(d<=g.Epsilon10)throw new f("elements cannot be converted to cartesian");d=k/d;a(p)?(p.x=d*c,p.y=d*q,p.z=0):p=new b(d*c,d*q,0);return l.multiplyByVector(y,p,p)}function q(a,b){p(a,H);var e=(H.dayNumber-r.dayNumber+(H.secondsOfDay-r.secondsOfDay)/m.SECONDS_PER_DAY)/m.DAYS_PER_JULIAN_CENTURY,f=e*e,h=f*e,g=h*e,k,l,q=5.15668983*c,v,w=83.35324312*c,B,C=125.04455501*c,t,y=218.31664563*c;l=297.85019547*c+u*(1.602961601209E9*e-6.3706*f+.006593*h-3.169E-5*g);var z=134.96340251*c+u*(1.7179159232178E9*e+31.8792*f+.051635*h-2.447E-4*g),D=357.52910918*c+u*(1.295965810481E8*e-.5532*f+1.36E-4*h-1.149E-5*g),E=310.17137918*c-u*(6967051.436*e+6.2068*f+.007618*h-3.219E-5*g),A=2*l;B=4*l;var x=6*l;t=2*z;var G=3*z,I=4*z,J=2*(93.27209062*c+u*(1.7395272628478E9*e-12.7512*f-.001037*h+4.17E-6*g));k=383397.7725+.004*e+(3400.4*Math.cos(A)-635.6*Math.cos(A-z)-235.6*Math.cos(z)+218.1*Math.cos(A-D)+181*Math.cos(A+z));l=.055545526-1.6E-8*e+(.014216*Math.cos(A-z)+.008551*Math.cos(A-t)-.001383*Math.cos(z)+.001356*Math.cos(A+z)-.001147*Math.cos(B-G)-9.14E-4*Math.cos(B-t)+8.69E-4*Math.cos(A-D-z)-6.27E-4*Math.cos(A)-3.94E-4*Math.cos(B-I)+2.82E-4*Math.cos(A-D-t)-2.79E-4*Math.cos(l-z)-2.36E-4*Math.cos(t)+2.31E-4*Math.cos(B)+2.29E-4*Math.cos(x-I)-2.01E-4*Math.cos(t-J));v=-8E-5*e+.02966*f-4.2E-5*h-1.3E-7*g+(486.26*Math.cos(A-J)-40.13*Math.cos(A)+37.51*Math.cos(J)+25.73*Math.cos(t-J)+19.97*Math.cos(A-D-J));B=1.46434202669E7*e-38.2702*f-.045047*h+2.1301E-4*g+(-55609*Math.sin(A-z)-34711*Math.sin(A-t)-9792*Math.sin(z)+9385*Math.sin(B-G)+7505*Math.sin(B-t)+5318*Math.sin(A+z)+3484*Math.sin(B-I)-3417*Math.sin(A-D-z)-2530*Math.sin(x-I)-2376*Math.sin(A)-2075*Math.sin(A-G)-1883*Math.sin(t)-1736*Math.sin(x-5*z)+1626*Math.sin(D)-1370*Math.sin(x-G));t=-6967919.3631*e+6.3602*f+.007625*h-3.586E-5*g+(-5392*Math.sin(A-J)-540*Math.sin(D)-441*Math.sin(A)+423*Math.sin(J)-288*Math.sin(t-J));g=1.7325593434847E9*e-6.391*f+.006588*h-3.169E-5*g+(-3332.9*Math.sin(A)+1197.4*Math.sin(A-z)-662.5*Math.sin(D)+396.3*Math.sin(z)-218*Math.sin(A-D));z=2*E;D=3*E;v+=46.997*Math.cos(E)*e-.614*Math.cos(A-J+E)*e+.614*Math.cos(A-J-E)*e-.0297*Math.cos(z)*f-.0335*Math.cos(E)*f+.0012*Math.cos(A-J+z)*f-1.6E-4*Math.cos(E)*h+4E-5*Math.cos(D)*h+4E-5*Math.cos(z)*h;x=2.116*Math.sin(E)*e-.111*Math.sin(A-J-E)*e-.0015*Math.sin(E)*f;t+=-520.77*Math.sin(E)*e+13.66*Math.sin(A-J+E)*e+1.12*Math.sin(A-E)*e-1.06*Math.sin(J-E)*e+.66*Math.sin(z)*f+.371*Math.sin(E)*f-.035*Math.sin(A-J+z)*f-.015*Math.sin(A-J+E)*f+.0014*Math.sin(E)*h-.0011*Math.sin(D)*h-9E-4*Math.sin(z)*h;return d(1E3*k,l,q+v*u,w+(B+x)*u,C+t*u,y+(g+x)*u,b)}var t={},r=new k(2451545,0,e.TAI),c=g.RADIANS_PER_DEGREE,u=g.RADIANS_PER_ARCSECOND,y=new l,A=50,z=g.EPSILON8,x=100.46645683*c,D=1.29597742283429E9*u,v=-79*1E-7,B=232*1E-7,C=-52*1E-7,I=-116*1E-7,H=new k(0,0,e.TAI),J=new l(1.0000000000000002,5.619723173785822E-16,4.690511510146299E-19,-5.154129427414611E-16,.9174820620691819,-.39777715593191376,-2.23970096136568E-16,.39777715593191376,.9174820620691819),w=new b;t.computeSunPositionInEarthInertialFrame=function(e,f){a(e)||(e=k.now());a(f)||(f=new b);var h=w;p(e,H);var g=(H.dayNumber-r.dayNumber+(H.secondsOfDay-r.secondsOfDay)/m.SECONDS_PER_DAY)/(10*m.DAYS_PER_JULIAN_CENTURY),t=.3595362*g;w=d(1.495980222607121E11+957426.3679999999*Math.cos(16002*t)+-2243968.05*Math.sin(16002*t)+-2273887.624*Math.cos(21863*t)+-688150.202*Math.sin(21863*t)+927506.794*Math.cos(32004*t)+1017265.516*Math.sin(32004*t)+-119678.29599999999*Math.cos(10931*t)+807828.498*Math.sin(10931*t)+478713.18399999995*Math.cos(14529*t)+209437.01799999998*Math.sin(14529*t)+-613351.267*Math.cos(16368*t)+359034.888*Math.sin(16368*t)+284235.953*Math.cos(15318*t)+-418874.03599999996*Math.sin(15318*t)+-164557.657*Math.cos(32794*t)+329115.314*Math.sin(32794*t),.0167086342-4.203654E-4*g,469.97289*u*g,102.93734808*c+11612.3529*u*g,174.87317577*c-8679.27034*u*g,x+D*g+-3.25E-5*Math.cos(10*t)+-1.05E-5*Math.sin(10*t)+-3.22E-5*Math.cos(16002*t)+-1.37E-5*Math.sin(16002*t)+v*Math.cos(21863*t)+2.58E-5*Math.sin(21863*t)+B*Math.cos(10931*t)+3.5E-6*Math.sin(10931*t)+C*Math.cos(1473*t)+I*Math.sin(1473*t)+9.7E-6*Math.cos(32004*t)+-8.8E-6*Math.sin(32004*t)+5.5E-6*Math.cos(4387*t)+-1.12E-5*Math.sin(4387*t)+-4.1E-6*Math.cos(73*t)+-8E-6*Math.sin(73*t),h);f=b.negate(w,f);h=w;h=q(e,h);b.multiplyByScalar(h,-.01215058143522694,h);b.subtract(f,w,f);l.multiplyByVector(J,f,f);return f};t.computeMoonPositionInEarthInertialFrame=function(c,b){a(c)||(c=k.now());b=q(c,b);l.multiplyByVector(J,b,b);return b};return t});F("Core/SimplePolylineGeometry","./ArcType ./BoundingSphere ./Cartesian3 ./Color ./ComponentDatatype ./defaultValue ./defined ./deprecationWarning ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./IndexDatatype ./Math ./PolylinePipeline ./PrimitiveType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=l(a,l.EMPTY_OBJECT);var d=a.positions,e=a.colors,g=l(a.colorsPerVertex,!1);if(!m(d)||2>d.length)throw new h("At least two positions are required.");if(m(e)&&(g&&e.length<d.length||!g&&e.length<d.length-1))throw new h("colors has an invalid length.");this._positions=d;this._colors=e;this._colorsPerVertex=g;this._arcType=l(a.arcType,b.GEODESIC);this._granularity=l(a.granularity,c.RADIANS_PER_DEGREE);this._ellipsoid=l(a.ellipsoid,p.WGS84);this._workerName="createSimplePolylineGeometry";a=1+d.length*f.packedLength;a+=m(e)?1+e.length*k.packedLength:1;this.packedLength=a+p.packedLength+3}A.pack=function(a,c,b){if(!m(a))throw new h("value is required");if(!m(c))throw new h("array is required");b=l(b,0);var d,e=a._positions,g=e.length;c[b++]=g;for(d=0;d<g;++d,b+=f.packedLength)f.pack(e[d],c,b);e=a._colors;g=m(e)?e.length:0;c[b++]=g;for(d=0;d<g;++d,b+=k.packedLength)k.pack(e[d],c,b);p.pack(a._ellipsoid,c,b);b+=p.packedLength;c[b++]=a._colorsPerVertex?1:0;c[b++]=a._arcType;c[b]=a._granularity;return c};A.unpack=function(a,c,b){if(!m(a))throw new h("array is required");c=l(c,0);var d,e=a[c++],g=Array(e);for(d=0;d<e;++d,c+=f.packedLength)g[d]=f.unpack(a,c);var e=a[c++],q=0<e?Array(e):void 0;for(d=0;d<e;++d,c+=k.packedLength)q[d]=k.unpack(a,c);d=p.unpack(a,c);c+=p.packedLength;var e=1===a[c++],v=a[c++];a=a[c];if(!m(b))return new A({positions:g,colors:q,ellipsoid:d,colorsPerVertex:e,arcType:v,granularity:a});b._positions=g;b._colors=q;b._ellipsoid=d;b._colorsPerVertex=e;b._arcType=v;b._granularity=a;return b};var z=Array(2),x=Array(2),D={positions:z,height:x,ellipsoid:void 0,minDistance:void 0,granularity:void 0};A.createGeometry=function(e){var h=e._positions,l=e._colors,p=e._colorsPerVertex,v=e._arcType,A=e._granularity,w=e._ellipsoid;e=c.chordLength(A,w.maximumRadius);var G=m(l)&&!p,p=h.length,E,L=0;if(v===b.GEODESIC||v===b.RHUMB){var K,P,N;v===b.GEODESIC?(K=c.chordLength(A,w.maximumRadius),P=u.numberOfPoints,N=u.generateArc):(K=A,P=u.numberOfPointsRhumbLine,N=u.generateRhumbArc);var O=u.extractHeights(h,w);v===b.GEODESIC?D.minDistance=e:D.granularity=A;D.ellipsoid=w;if(G){for(v=E=0;v<p-1;v++)E+=P(h[v],h[v+1],K)+1;A=new Float64Array(3*E);E=new Uint8Array(4*E);D.positions=z;D.height=x;for(v=G=0;v<p-1;++v){z[0]=h[v];z[1]=h[v+1];x[0]=O[v];x[1]=O[v+1];K=N(D);if(m(l))for(P=K.length/3,e=l[v],w=0;w<P;++w)E[G++]=k.floatToByte(e.red),E[G++]=k.floatToByte(e.green),E[G++]=k.floatToByte(e.blue),E[G++]=k.floatToByte(e.alpha);A.set(K,L);L+=K.length}}else if(D.positions=h,D.height=O,A=new Float64Array(N(D)),m(l)){E=new Uint8Array(A.length/3*4);for(v=0;v<p-1;++v){var Z=l[v],aa=l[v+1];N=E;var w=L,L=u.numberOfPoints(h[v],h[v+1],e),U,O=Z.red,G=Z.green;K=Z.blue;P=Z.alpha;var W=aa.red,M=aa.green,R=aa.blue;U=aa.alpha;if(k.equals(Z,aa))for(U=0;U<L;U++)N[w++]=k.floatToByte(O),N[w++]=k.floatToByte(G),N[w++]=k.floatToByte(K),N[w++]=k.floatToByte(P);else for(Z=(W-O)/L,aa=(M-G)/L,R=(R-K)/L,M=(U-P)/L,U=0;U<L;U++)N[w++]=k.floatToByte(O+U*Z),N[w++]=k.floatToByte(G+U*aa),N[w++]=k.floatToByte(K+U*R),N[w++]=k.floatToByte(P+U*M);L=w}v=l[p-1];E[L++]=k.floatToByte(v.red);E[L++]=k.floatToByte(v.green);E[L++]=k.floatToByte(v.blue);E[L++]=k.floatToByte(v.alpha)}}else for(E=G?2*p-2:p,A=new Float64Array(3*E),E=m(l)?new Uint8Array(4*E):void 0,v=L=N=0;v<p;++v){O=h[v];G&&0<v&&(f.pack(O,A,N),N+=3,e=l[v-1],E[L++]=k.floatToByte(e.red),E[L++]=k.floatToByte(e.green),E[L++]=k.floatToByte(e.blue),E[L++]=k.floatToByte(e.alpha));if(G&&v===p-1)break;f.pack(O,A,N);N+=3;m(l)&&(e=l[v],E[L++]=k.floatToByte(e.red),E[L++]=k.floatToByte(e.green),E[L++]=k.floatToByte(e.blue),E[L++]=k.floatToByte(e.alpha))}p=new t;p.position=new q({componentDatatype:g.DOUBLE,componentsPerAttribute:3,values:A});m(l)&&(p.color=new q({componentDatatype:g.UNSIGNED_BYTE,componentsPerAttribute:4,values:E,normalize:!0}));E=A.length/3;l=r.createTypedArray(E,2*(E-1));for(v=A=0;v<E-1;++v)l[A++]=v,l[A++]=v+1;return new d({attributes:p,indices:l,primitiveType:y.LINES,boundingSphere:a.fromPoints(h)})};return A});F("Core/SphereGeometry","./Cartesian3 ./Check ./defaultValue ./defined ./EllipsoidGeometry ./VertexFormat".split(" "),function(b,a,f,k,g,l){function m(a){var d=f(a.radius,1);a={radii:new b(d,d,d),stackPartitions:a.stackPartitions,slicePartitions:a.slicePartitions,vertexFormat:a.vertexFormat};this._ellipsoidGeometry=new g(a);this._workerName="createSphereGeometry"}m.packedLength=g.packedLength;m.pack=function(b,d,e){a.typeOf.object("value",b);return g.pack(b._ellipsoidGeometry,d,e)};var e=new g,h={radius:void 0,radii:new b,vertexFormat:new l,stackPartitions:void 0,slicePartitions:void 0};m.unpack=function(a,d,f){a=g.unpack(a,d,e);h.vertexFormat=l.clone(a._vertexFormat,h.vertexFormat);h.stackPartitions=a._stackPartitions;h.slicePartitions=a._slicePartitions;if(!k(f))return h.radius=a._radii.x,new m(h);b.clone(a._radii,h.radii);f._ellipsoidGeometry=new g(h);return f};m.createGeometry=function(a){return g.createGeometry(a._ellipsoidGeometry)};return m});F("Core/SphereOutlineGeometry",["./Cartesian3","./Check","./defaultValue","./defined","./EllipsoidOutlineGeometry"],function(b,a,f,k,g){function l(a){var e=f(a.radius,1);a={radii:new b(e,e,e),stackPartitions:a.stackPartitions,slicePartitions:a.slicePartitions,subdivisions:a.subdivisions};this._ellipsoidGeometry=new g(a);this._workerName="createSphereOutlineGeometry"}l.packedLength=g.packedLength;l.pack=function(b,e,d){a.typeOf.object("value",b);return g.pack(b._ellipsoidGeometry,e,d)};var m=new g,e={radius:void 0,radii:new b,stackPartitions:void 0,slicePartitions:void 0,subdivisions:void 0};l.unpack=function(a,f,d){a=g.unpack(a,f,m);e.stackPartitions=a._stackPartitions;e.slicePartitions=a._slicePartitions;e.subdivisions=a._subdivisions;if(!k(d))return e.radius=a._radii.x,new l(e);b.clone(a._radii,e.radii);d._ellipsoidGeometry=new g(e);return d};l.createGeometry=function(a){return g.createGeometry(a._ellipsoidGeometry)};return l});F("Core/Spherical",["./Check","./defaultValue","./defined"],function(b,a,f){function k(b,f,k){this.clock=a(b,0);this.cone=a(f,0);this.magnitude=a(k,1)}k.fromCartesian3=function(a,l){b.typeOf.object("cartesian3",a);var g=a.x,e=a.y,h=a.z,p=g*g+e*e;f(l)||(l=new k);l.clock=Math.atan2(e,g);l.cone=Math.atan2(Math.sqrt(p),h);l.magnitude=Math.sqrt(p+h*h);return l};k.clone=function(a,b){if(f(a)){if(!f(b))return new k(a.clock,a.cone,a.magnitude);b.clock=a.clock;b.cone=a.cone;b.magnitude=a.magnitude;return b}};k.normalize=function(a,l){b.typeOf.object("spherical",a);if(!f(l))return new k(a.clock,a.cone,1);l.clock=a.clock;l.cone=a.cone;l.magnitude=1;return l};k.equals=function(a,b){return a===b||f(a)&&f(b)&&a.clock===b.clock&&a.cone===b.cone&&a.magnitude===b.magnitude};k.equalsEpsilon=function(b,k,m){m=a(m,0);return b===k||f(b)&&f(k)&&Math.abs(b.clock-k.clock)<=m&&Math.abs(b.cone-k.cone)<=m&&Math.abs(b.magnitude-k.magnitude)<=m};k.prototype.equals=function(a){return k.equals(this,a)};k.prototype.clone=function(a){return k.clone(this,a)};k.prototype.equalsEpsilon=function(a,b){return k.equalsEpsilon(this,a,b)};k.prototype.toString=function(){return"("+this.clock+", "+this.cone+", "+this.magnitude+")"};return k});F("Core/subdivideArray",["./defined","./DeveloperError"],function(b,a){return function(f,k){if(!b(f))throw new a("array is required.");if(!b(k)||1>k)throw new a("numberOfArrays must be greater than 0.");for(var g=[],l=f.length,m=0;m<l;){var e=Math.ceil((l-m)/k--);g.push(f.slice(m,m+e));m+=e}return g}});F("Core/TerrainData",["./defineProperties","./DeveloperError"],function(b,a){function f(){a.throwInstantiationError()}b(f.prototype,{credits:{get:a.throwInstantiationError},waterMask:{get:a.throwInstantiationError}});f.prototype.interpolateHeight=a.throwInstantiationError;f.prototype.isChildAvailable=a.throwInstantiationError;f.prototype.createMesh=a.throwInstantiationError;f.prototype.upsample=a.throwInstantiationError;f.prototype.wasCreatedByUpsampling=a.throwInstantiationError;return f});F("Core/TileEdge",[],function(){return{WEST:0,NORTH:1,EAST:2,SOUTH:3,NORTHWEST:4,NORTHEAST:5,SOUTHWEST:6,SOUTHEAST:7}});F("Core/TilingScheme",["./defineProperties","./DeveloperError"],function(b,a){function f(b){throw new a("This type should not be instantiated directly.  Instead, use WebMercatorTilingScheme or GeographicTilingScheme.");}b(f.prototype,{ellipsoid:{get:a.throwInstantiationError},rectangle:{get:a.throwInstantiationError},projection:{get:a.throwInstantiationError}});f.prototype.getNumberOfXTilesAtLevel=a.throwInstantiationError;f.prototype.getNumberOfYTilesAtLevel=a.throwInstantiationError;f.prototype.rectangleToNativeRectangle=a.throwInstantiationError;f.prototype.tileXYToNativeRectangle=a.throwInstantiationError;f.prototype.tileXYToRectangle=a.throwInstantiationError;f.prototype.positionToTileXY=a.throwInstantiationError;return f});F("Core/TimeIntervalCollection","./binarySearch ./defaultValue ./defined ./defineProperties ./DeveloperError ./Event ./GregorianDate ./isLeapYear ./Iso8601 ./JulianDate ./TimeInterval".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a,c){return p.compare(a.start,c.start)}function t(a){this._intervals=[];this._changedEvent=new l;if(f(a))for(var c=a.length,b=0;b<c;b++)this.addInterval(a[b])}function r(a,c,b){f(b)||(b=new p);p.toGregorianDate(a,y);a=y.millisecond+c.millisecond;var d=y.second+c.second,h=y.minute+c.minute,g=y.hour+c.hour,k=y.day+c.day,l=y.month+c.month;c=y.year+c.year;1E3<=a&&(d+=Math.floor(a/1E3),a%=1E3);60<=d&&(h+=Math.floor(d/60),d%=60);60<=h&&(g+=Math.floor(h/60),h%=60);24<=g&&(k+=Math.floor(g/24),g%=24);for(A[2]=e(c)?29:28;k>A[l]||13<=l;)k>A[l]&&(k-=A[l],++l),13<=l&&(--l,c+=Math.floor(l/12),l%=12,++l),A[2]=e(c)?29:28;y.millisecond=a;y.second=d;y.minute=h;y.hour=g;y.day=k;y.month=l;y.year=c;return p.fromGregorianDate(y,b)}function c(a,c){if(!f(a)||0===a.length)return!1;c.year=0;c.month=0;c.day=0;c.hour=0;c.minute=0;c.second=0;c.millisecond=0;if("P"===a[0]){var b=a.match(x);if(!f(b))return!1;f(b[1])&&(c.year=Number(b[1].replace(",",".")));f(b[2])&&(c.month=Number(b[2].replace(",",".")));f(b[3])&&(c.day=7*Number(b[3].replace(",",".")));f(b[4])&&(c.day+=Number(b[4].replace(",",".")));f(b[5])&&(c.hour=Number(b[5].replace(",",".")));f(b[6])&&(c.minute=Number(b[6].replace(",",".")));f(b[7])&&(b=Number(b[7].replace(",",".")),c.second=Math.floor(b),c.millisecond=b%1*1E3)}else"Z"!==a[a.length-1]&&(a+="Z"),p.toGregorianDate(p.fromIso8601(a,z),c);return c.year||c.month||c.day||c.hour||c.minute||c.second||c.millisecond}k(t.prototype,{changedEvent:{get:function(){return this._changedEvent}},start:{get:function(){var a=this._intervals;return 0===a.length?void 0:a[0].start}},isStartIncluded:{get:function(){var a=this._intervals;return 0===a.length?!1:a[0].isStartIncluded}},stop:{get:function(){var a=this._intervals,c=a.length;return 0===c?void 0:a[c-1].stop}},isStopIncluded:{get:function(){var a=this._intervals,c=a.length;return 0===c?!1:a[c-1].isStopIncluded}},length:{get:function(){return this._intervals.length}},isEmpty:{get:function(){return 0===this._intervals.length}}});t.prototype.equals=function(a,c){if(this===a)return!0;if(!(a instanceof t))return!1;var b=this._intervals,e=a._intervals,f=b.length;if(f!==e.length)return!1;for(var h=0;h<f;h++)if(!d.equals(b[h],e[h],c))return!1;return!0};t.prototype.get=function(a){if(!f(a))throw new g("index is required.");return this._intervals[a]};t.prototype.removeAll=function(){0<this._intervals.length&&(this._intervals.length=0,this._changedEvent.raiseEvent(this))};t.prototype.findIntervalContainingDate=function(a){a=this.indexOf(a);return 0<=a?this._intervals[a]:void 0};t.prototype.findDataForIntervalContainingDate=function(a){a=this.indexOf(a);return 0<=a?this._intervals[a].data:void 0};t.prototype.contains=function(a){return 0<=this.indexOf(a)};var u=new d;t.prototype.indexOf=function(a){if(!f(a))throw new g("date is required");var c=this._intervals;u.start=a;u.stop=a;var e=b(c,u,q);if(0<=e)return c[e].isStartIncluded?e:0<e&&c[e-1].stop.equals(a)&&c[e-1].isStopIncluded?e-1:~e;e=~e;return 0<e&&e-1<c.length&&d.contains(c[e-1],a)?e-1:~e};t.prototype.findInterval=function(c){c=a(c,a.EMPTY_OBJECT);var b=c.start,d=c.stop,e=c.isStartIncluded;c=c.isStopIncluded;for(var h=this._intervals,g=0,k=h.length;g<k;g++){var l=h[g];if(!(f(b)&&!l.start.equals(b)||f(d)&&!l.stop.equals(d)||f(e)&&l.isStartIncluded!==e||f(c)&&l.isStopIncluded!==c))return h[g]}};t.prototype.addInterval=function(a,c){if(!f(a))throw new g("interval is required");if(!a.isEmpty){var e=this._intervals;if(0===e.length||p.greaterThan(a.start,e[e.length-1].stop))e.push(a);else{var h=b(e,a,q);0>h?h=~h:0<h&&a.isStartIncluded&&e[h-1].isStartIncluded&&e[h-1].start.equals(a.start)?--h:h<e.length&&!a.isStartIncluded&&e[h].isStartIncluded&&e[h].start.equals(a.start)&&++h;var k;0<h&&(k=p.compare(e[h-1].stop,a.start),0<k||0===k&&(e[h-1].isStopIncluded||a.isStartIncluded))&&((f(c)?c(e[h-1].data,a.data):e[h-1].data===a.data)?(a=p.greaterThan(a.stop,e[h-1].stop)?new d({start:e[h-1].start,stop:a.stop,isStartIncluded:e[h-1].isStartIncluded,isStopIncluded:a.isStopIncluded,data:a.data}):new d({start:e[h-1].start,stop:e[h-1].stop,isStartIncluded:e[h-1].isStartIncluded,isStopIncluded:e[h-1].isStopIncluded||a.stop.equals(e[h-1].stop)&&a.isStopIncluded,data:a.data}),e.splice(h-1,1),--h):(k=p.compare(e[h-1].stop,a.stop),(0<k||0===k&&e[h-1].isStopIncluded&&!a.isStopIncluded)&&e.splice(h,0,new d({start:a.stop,stop:e[h-1].stop,isStartIncluded:!a.isStopIncluded,isStopIncluded:e[h-1].isStopIncluded,data:e[h-1].data})),e[h-1]=new d({start:e[h-1].start,stop:a.start,isStartIncluded:e[h-1].isStartIncluded,isStopIncluded:!a.isStartIncluded,data:e[h-1].data})));for(;h<e.length;)if(k=p.compare(a.stop,e[h].start),0<k||0===k&&(a.isStopIncluded||e[h].isStartIncluded))if(f(c)?c(e[h].data,a.data):e[h].data===a.data)a=new d({start:a.start,stop:p.greaterThan(e[h].stop,a.stop)?e[h].stop:a.stop,isStartIncluded:a.isStartIncluded,isStopIncluded:p.greaterThan(e[h].stop,a.stop)?e[h].isStopIncluded:a.isStopIncluded,data:a.data}),e.splice(h,1);else if(e[h]=new d({start:a.stop,stop:e[h].stop,isStartIncluded:!a.isStopIncluded,isStopIncluded:e[h].isStopIncluded,data:e[h].data}),e[h].isEmpty)e.splice(h,1);else break;else break;e.splice(h,0,a)}this._changedEvent.raiseEvent(this)}};t.prototype.removeInterval=function(a){if(!f(a))throw new g("interval is required");if(a.isEmpty)return!1;var c=this._intervals,e=b(c,a,q);0>e&&(e=~e);var h=!1;0<e&&(p.greaterThan(c[e-1].stop,a.start)||c[e-1].stop.equals(a.start)&&c[e-1].isStopIncluded&&a.isStartIncluded)&&(h=!0,(p.greaterThan(c[e-1].stop,a.stop)||c[e-1].isStopIncluded&&!a.isStopIncluded&&c[e-1].stop.equals(a.stop))&&c.splice(e,0,new d({start:a.stop,stop:c[e-1].stop,isStartIncluded:!a.isStopIncluded,isStopIncluded:c[e-1].isStopIncluded,data:c[e-1].data})),c[e-1]=new d({start:c[e-1].start,stop:a.start,isStartIncluded:c[e-1].isStartIncluded,isStopIncluded:!a.isStartIncluded,data:c[e-1].data}));e<c.length&&!a.isStartIncluded&&c[e].isStartIncluded&&a.start.equals(c[e].start)&&(h=!0,c.splice(e,0,new d({start:c[e].start,stop:c[e].start,isStartIncluded:!0,isStopIncluded:!0,data:c[e].data})),++e);for(;e<c.length&&p.greaterThan(a.stop,c[e].stop);)h=!0,c.splice(e,1);e<c.length&&a.stop.equals(c[e].stop)&&(h=!0,!a.isStopIncluded&&c[e].isStopIncluded?e+1<c.length&&c[e+1].start.equals(a.stop)&&c[e].data===c[e+1].data?(c.splice(e,1),c[e]=new d({start:c[e].start,stop:c[e].stop,isStartIncluded:!0,isStopIncluded:c[e].isStopIncluded,data:c[e].data})):c[e]=new d({start:a.stop,stop:a.stop,isStartIncluded:!0,isStopIncluded:!0,data:c[e].data}):c.splice(e,1));e<c.length&&(p.greaterThan(a.stop,c[e].start)||a.stop.equals(c[e].start)&&a.isStopIncluded&&c[e].isStartIncluded)&&(h=!0,c[e]=new d({start:a.stop,stop:c[e].stop,isStartIncluded:!a.isStopIncluded,isStopIncluded:c[e].isStopIncluded,data:c[e].data}));h&&this._changedEvent.raiseEvent(this);return h};t.prototype.intersect=function(a,c,b){if(!f(a))throw new g("other is required.");var e=new t,h=0,k=0,l=this._intervals;for(a=a._intervals;h<l.length&&k<a.length;){var m=l[h],q=a[k];if(p.lessThan(m.stop,q.start))++h;else if(p.lessThan(q.stop,m.start))++k;else{if(f(b)||f(c)&&c(m.data,q.data)||!f(c)&&q.data===m.data){var v=d.intersect(m,q,new d,b);v.isEmpty||e.addInterval(v,c)}p.lessThan(m.stop,q.stop)||m.stop.equals(q.stop)&&!m.isStopIncluded&&q.isStopIncluded?++h:++k}}return e};t.fromJulianDateArray=function(c,b){if(!f(c))throw new g("options is required.");if(!f(c.julianDates))throw new g("options.iso8601Array is required.");f(b)||(b=new t);var e=c.julianDates,k=e.length,l=c.dataCallback,m=a(c.isStartIncluded,!0),p=a(c.isStopIncluded,!0),q=a(c.leadingInterval,!1),v=a(c.trailingInterval,!1),r=0;q&&(++r,q=new d({start:h.MINIMUM_VALUE,stop:e[0],isStartIncluded:!0,isStopIncluded:!m}),q.data=f(l)?l(q,b.length):b.length,b.addInterval(q));for(var u=0;u<k-1;++u)q=new d({start:e[u],stop:e[u+1],isStartIncluded:b.length===r?m:!0,isStopIncluded:u===k-2?p:!1}),q.data=f(l)?l(q,b.length):b.length,b.addInterval(q);v&&(q=new d({start:e[k-1],stop:h.MAXIMUM_VALUE,isStartIncluded:!p,isStopIncluded:!0}),q.data=f(l)?l(q,b.length):b.length,b.addInterval(q));return b};var y=new m,A=[0,31,28,31,30,31,30,31,31,30,31,30,31],z=new p,x=/P(?:([\d.,]+)Y)?(?:([\d.,]+)M)?(?:([\d.,]+)W)?(?:([\d.,]+)D)?(?:T(?:([\d.,]+)H)?(?:([\d.,]+)M)?(?:([\d.,]+)S)?)?/,D=new m;t.fromIso8601=function(a,b){if(!f(a))throw new g("options is required.");if(!f(a.iso8601))throw new g("options.iso8601 is required.");var d=a.iso8601.split("/"),e=p.fromIso8601(d[0]),h=p.fromIso8601(d[1]),k=[];if(c(d[2],D))for(d=p.clone(e),k.push(d);0>p.compare(d,h);)d=r(d,D),0>=p.compare(h,d)&&p.clone(h,d),k.push(d);else k.push(e,h);return t.fromJulianDateArray({julianDates:k,isStartIncluded:a.isStartIncluded,isStopIncluded:a.isStopIncluded,leadingInterval:a.leadingInterval,trailingInterval:a.trailingInterval,dataCallback:a.dataCallback},b)};t.fromIso8601DateArray=function(a,c){if(!f(a))throw new g("options is required.");if(!f(a.iso8601Dates))throw new g("options.iso8601Dates is required.");return t.fromJulianDateArray({julianDates:a.iso8601Dates.map(function(a){return p.fromIso8601(a)}),isStartIncluded:a.isStartIncluded,isStopIncluded:a.isStopIncluded,leadingInterval:a.leadingInterval,trailingInterval:a.trailingInterval,dataCallback:a.dataCallback},c)};t.fromIso8601DurationArray=function(b,d){if(!f(b))throw new g("options is required.");if(!f(b.epoch))throw new g("options.epoch is required.");if(!f(b.iso8601Durations))throw new g("options.iso8601Durations is required.");for(var e=b.epoch,h=b.iso8601Durations,k=a(b.relativeToPrevious,!1),l=[],m,p=h.length,q=0;q<p;++q)if(c(h[q],D)||0===q)m=k&&f(m)?r(m,D):r(e,D),l.push(m);return t.fromJulianDateArray({julianDates:l,isStartIncluded:b.isStartIncluded,isStopIncluded:b.isStopIncluded,leadingInterval:b.leadingInterval,trailingInterval:b.trailingInterval,dataCallback:b.dataCallback},d)};return t});F("Core/TranslationRotationScale",["./Cartesian3","./defaultValue","./defined","./Quaternion"],function(b,a,f,k){var g=new b(1,1,1),l=b.ZERO,m=k.IDENTITY,e=function(e,f,d){this.translation=b.clone(a(e,l));this.rotation=k.clone(a(f,m));this.scale=b.clone(a(d,g))};e.prototype.equals=function(a){return this===a||f(a)&&b.equals(this.translation,a.translation)&&k.equals(this.rotation,a.rotation)&&b.equals(this.scale,a.scale)};return e});F("Core/VideoSynchronizer","./defaultValue ./defined ./defineProperties ./destroyObject ./Iso8601 ./JulianDate".split(" "),function(b,a,f,k,g,l){function m(a){a=b(a,b.EMPTY_OBJECT);this._lastPlaybackRate=this._seekFunction=this._clockSubscription=this._element=this._clock=void 0;this.clock=a.clock;this.element=a.element;this.epoch=b(a.epoch,g.MINIMUM_VALUE);this.tolerance=b(a.tolerance,1);this._seeking=!1;this._seekFunction=void 0;this._firstTickAfterSeek=!1}function e(a){return function(){a._seeking=!1;a._firstTickAfterSeek=!0}}f(m.prototype,{clock:{get:function(){return this._clock},set:function(b){var e=this._clock;e!==b&&(a(e)&&(this._clockSubscription(),this._clockSubscription=void 0),a(b)&&(this._clockSubscription=b.onTick.addEventListener(m.prototype._onTick,this)),this._clock=b)}},element:{get:function(){return this._element},set:function(b){var f=this._element;f!==b&&(a(f)&&f.removeEventListener("seeked",this._seekFunction,!1),a(b)&&(this._seeking=!1,this._seekFunction=e(this),b.addEventListener("seeked",this._seekFunction,!1)),this._element=b,this._firstTickAfterSeek=this._seeking=!1)}}});m.prototype.destroy=function(){this.clock=this.element=void 0;return k(this)};m.prototype.isDestroyed=function(){return!1};m.prototype._trySetPlaybackRate=function(a){if(this._lastPlaybackRate!==a.multiplier){var b=this._element;try{b.playbackRate=a.multiplier}catch(d){b.playbackRate=0}this._lastPlaybackRate=a.multiplier}};m.prototype._onTick=function(e){var f=this._element;if(a(f)&&!(2>f.readyState)){var d=e.shouldAnimate;d===f.paused&&(d?f.play():f.pause());if(this._seeking||this._firstTickAfterSeek)this._firstTickAfterSeek=!1;else{this._trySetPlaybackRate(e);e=e.currentTime;var h=b(this.epoch,g.MINIMUM_VALUE),h=l.secondsDifference(e,h),k=f.duration;e=f.currentTime;f.loop?(h%=k,0>h&&(h=k-h)):h=h>k?k:0>h?0:h;d=d?b(this.tolerance,1):.001;Math.abs(h-e)>d&&(this._seeking=!0,f.currentTime=h)}}};return m});F("Core/VRTheWorldTerrainProvider","../ThirdParty/when ./Credit ./defaultValue ./defined ./defineProperties ./DeveloperError ./Ellipsoid ./Event ./GeographicTilingScheme ./getImagePixels ./HeightmapTerrainData ./Math ./Rectangle ./Resource ./TerrainProvider ./TileProviderError".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a,c){this.rectangle=a;this.maxLevel=c}function A(d){function g(a){var b=a.getElementsByTagName("SRS")[0].textContent;if("EPSG:4326"===b){D._tilingScheme=new h({ellipsoid:w});b=a.getElementsByTagName("TileFormat")[0];D._heightmapWidth=parseInt(b.getAttribute("width"),10);D._heightmapHeight=parseInt(b.getAttribute("height"),10);D._levelZeroMaximumGeometricError=c.getEstimatedLevelZeroGeometricErrorForAHeightmap(w,Math.min(D._heightmapWidth,D._heightmapHeight),D._tilingScheme.getNumberOfXTilesAtLevel(0));a=a.getElementsByTagName("DataExtent");for(b=0;b<a.length;++b){var d=a[b],e=q.toRadians(parseFloat(d.getAttribute("minx"))),f=q.toRadians(parseFloat(d.getAttribute("miny"))),g=q.toRadians(parseFloat(d.getAttribute("maxx"))),k=q.toRadians(parseFloat(d.getAttribute("maxy"))),d=parseInt(d.getAttribute("maxlevel"),10);D._rectangles.push(new y(new t(e,f,g,k),d))}D._ready=!0;D._readyPromise.resolve(!0)}else p("SRS "+b+" is not supported.")}function p(a){a=f(a,"An error occurred while accessing "+D._resource.url+".");A=u.handleError(A,D,D._errorEvent,a,void 0,void 0,void 0,C)}function C(){b(D._resource.fetchXML(),g,p)}d=f(d,f.EMPTY_OBJECT);if(!k(d.url))throw new l("options.url is required.");this._resource=r.createIfNeeded(d.url);this._errorEvent=new e;this._ready=!1;this._readyPromise=b.defer();this._terrainDataStructure={heightScale:.001,heightOffset:-1E3,elementsPerHeight:3,stride:4,elementMultiplier:256,isBigEndian:!0,lowestEncodedHeight:0,highestEncodedHeight:16777215};var z=d.credit;"string"===typeof z&&(z=new a(z));this._credit=z;this._tilingScheme=void 0;this._rectangles=[];var D=this,A,w=f(d.ellipsoid,m.WGS84);C()}function z(a,c,b,d,e){a=a.tileXYToRectangle(b,d,e);return k(t.intersection(a,c,x))}g(A.prototype,{errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){return this._credit}},tilingScheme:{get:function(){if(!this.ready)throw new l("requestTileGeometry must not be called before ready returns true.");return this._tilingScheme}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},hasWaterMask:{get:function(){return!1}},hasVertexNormals:{get:function(){return!1}}});A.prototype.requestTileGeometry=function(a,c,e,f){if(!this.ready)throw new l("requestTileGeometry must not be called before ready returns true.");var h=this._tilingScheme.getNumberOfYTilesAtLevel(e);f=this._resource.getDerivedResource({url:e+"/"+a+"/"+(h-c-1)+".tif",queryParameters:{cesium:!0},request:f}).fetchImage({preferImageBitmap:!0});if(k(f)){var g=this;return b(f).then(function(b){b=p(b);for(var f=g._heightmapWidth,h=g._heightmapHeight,l=g._tilingScheme,m=g._rectangles,q=l.tileXYToRectangle(a,c,e),v=0,r=0;r<m.length&&15!==v;++r){var u=m[r];if(!(u.maxLevel<=e)){var u=u.rectangle,B=t.intersection(u,q,x);k(B)&&(z(l,u,2*a,2*c,e+1)&&(v|=4),z(l,u,2*a+1,2*c,e+1)&&(v|=8),z(l,u,2*a,2*c+1,e+1)&&(v|=1),z(l,u,2*a+1,2*c+1,e+1)&&(v|=2))}}return new d({buffer:b,width:f,height:h,childTileMask:v,structure:g._terrainDataStructure})})}};A.prototype.getLevelMaximumGeometricError=function(a){if(!this.ready)throw new l("requestTileGeometry must not be called before ready returns true.");return this._levelZeroMaximumGeometricError/(1<<a)};var x=new t;A.prototype.getTileDataAvailable=function(a,c,b){};A.prototype.loadTileDataAvailability=function(a,c,b){};return A});F("Core/WallGeometryLibrary","./Cartographic ./defined ./EllipsoidTangentPlane ./Math ./PolygonPipeline ./PolylinePipeline ./WindingOrder".split(" "),function(b,a,f,k,g,l,m){var e={},h=new b,p=new b,d=Array(2),q=Array(2),t={positions:void 0,height:void 0,granularity:void 0,ellipsoid:void 0};e.computePositions=function(e,c,u,y,A,z){var r=c.length;if(2>r)y=void 0;else{var D=a(y),v=a(u),B=!0,C=Array(r),I=Array(r),H=Array(r),J=c[0];C[0]=J;J=e.cartesianToCartographic(J,h);v&&(J.height=u[0]);B=B&&0>=J.height;I[0]=J.height;H[0]=D?y[0]:0;for(var w=1,G=1;G<r;++G){var E=c[G],L=e.cartesianToCartographic(E,p);v&&(L.height=u[G]);var B=B&&0>=L.height,K=J,P=L;k.equalsEpsilon(K.latitude,P.latitude,k.EPSILON14)&&k.equalsEpsilon(K.longitude,P.longitude,k.EPSILON14)?J.height<L.height&&(I[w-1]=L.height):(C[w]=E,I[w]=L.height,H[w]=D?y[G]:0,b.clone(L,J),++w)}B||2>w?y=void 0:(C.length=w,I.length=w,H.length=w,y={positions:C,topHeights:I,bottomHeights:H})}if(a(y)){c=y.positions;u=y.topHeights;y=y.bottomHeights;3<=c.length&&(r=f.fromPoints(c,e).projectPointsOntoPlane(c),g.computeWindingOrder2D(r)===m.CLOCKWISE&&(c.reverse(),u.reverse(),y.reverse()));r=c.length;D=r-2;A=k.chordLength(A,e.maximumRadius);t.minDistance=A;t.ellipsoid=e;if(z){for(e=v=0;e<r-1;e++)v+=l.numberOfPoints(c[e],c[e+1],A)+1;z=new Float64Array(3*v);A=new Float64Array(3*v);t.positions=d;t.height=q;for(e=v=0;e<r-1;e++)d[0]=c[e],d[1]=c[e+1],q[0]=u[e],q[1]=u[e+1],B=l.generateArc(t),z.set(B,v),q[0]=y[e],q[1]=y[e+1],A.set(l.generateArc(t),v),v+=B.length}else t.positions=c,t.height=u,z=new Float64Array(l.generateArc(t)),t.height=y,A=new Float64Array(l.generateArc(t));return{bottomPositions:A,topPositions:z,numCorners:D}}};return e});F("Core/WallGeometry","./BoundingSphere ./Cartesian3 ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./IndexDatatype ./Math ./PrimitiveType ./VertexFormat ./WallGeometryLibrary".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(c){c=k(c,k.EMPTY_OBJECT);var b=c.positions,d=c.maximumHeights,e=c.minimumHeights;if(!g(b))throw new l("options.positions is required.");if(g(d)&&d.length!==b.length)throw new l("options.positions and options.maximumHeights must have the same length.");if(g(e)&&e.length!==b.length)throw new l("options.positions and options.minimumHeights must have the same length.");var f=k(c.vertexFormat,r.DEFAULT),h=k(c.granularity,q.RADIANS_PER_DEGREE);c=k(c.ellipsoid,m.WGS84);this._positions=b;this._minimumHeights=e;this._maximumHeights=d;this._vertexFormat=r.clone(f);this._granularity=h;this._ellipsoid=m.clone(c);this._workerName="createWallGeometry";b=b.length*a.packedLength+3;g(e)&&(b+=e.length);g(d)&&(b+=d.length);this.packedLength=b+m.packedLength+r.packedLength+1}var y=new a,A=new a,z=new a,x=new a,D=new a,v=new a,B=new a,C=new a;u.pack=function(c,b,d){if(!g(c))throw new l("value is required");if(!g(b))throw new l("array is required");d=k(d,0);var e,f=c._positions,h=f.length;b[d++]=h;for(e=0;e<h;++e,d+=a.packedLength)a.pack(f[e],b,d);f=c._minimumHeights;h=g(f)?f.length:0;b[d++]=h;if(g(f))for(e=0;e<h;++e)b[d++]=f[e];f=c._maximumHeights;h=g(f)?f.length:0;b[d++]=h;if(g(f))for(e=0;e<h;++e)b[d++]=f[e];m.pack(c._ellipsoid,b,d);d+=m.packedLength;r.pack(c._vertexFormat,b,d);d+=r.packedLength;b[d]=c._granularity;return b};var I=m.clone(m.UNIT_SPHERE),H=new r,J={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:I,vertexFormat:H,granularity:void 0};u.unpack=function(c,b,d){if(!g(c))throw new l("array is required");b=k(b,0);var e,f=c[b++],h=Array(f);for(e=0;e<f;++e,b+=a.packedLength)h[e]=a.unpack(c,b);var f=c[b++],p;if(0<f)for(p=Array(f),e=0;e<f;++e)p[e]=c[b++];var f=c[b++],q;if(0<f)for(q=Array(f),e=0;e<f;++e)q[e]=c[b++];e=m.unpack(c,b,I);b+=m.packedLength;f=r.unpack(c,b,H);b+=r.packedLength;c=c[b];if(!g(d))return J.positions=h,J.minimumHeights=p,J.maximumHeights=q,J.granularity=c,new u(J);d._positions=h;d._minimumHeights=p;d._maximumHeights=q;d._ellipsoid=m.clone(e,d._ellipsoid);d._vertexFormat=r.clone(f,d._vertexFormat);d._granularity=c;return d};u.fromConstantHeights=function(a){a=k(a,k.EMPTY_OBJECT);var c=a.positions;if(!g(c))throw new l("options.positions is required.");var b,d,e=a.minimumHeight,f=a.maximumHeight,h=g(e),m=g(f);if(h||m){var p=c.length;b=h?Array(p):void 0;d=m?Array(p):void 0;for(var q=0;q<p;++q)h&&(b[q]=e),m&&(d[q]=f)}return new u({positions:c,maximumHeights:d,minimumHeights:b,ellipsoid:a.ellipsoid,vertexFormat:a.vertexFormat})};u.createGeometry=function(k){var l=k._positions,m=k._vertexFormat,w=k._ellipsoid;k=c.computePositions(w,l,k._maximumHeights,k._minimumHeights,k._granularity,!0);if(g(k)){var r=k.bottomPositions,u=k.topPositions,I=k.numCorners,H=u.length,J=2*H;k=m.position?new Float64Array(J):void 0;for(var aa=m.normal?new Float32Array(J):void 0,U=m.tangent?new Float32Array(J):void 0,W=m.bitangent?new Float32Array(J):void 0,M=m.st?new Float32Array(J/3*2):void 0,R=0,Y=0,Q=0,S=0,ca=0,T=C,da=B,V=v,ba=!0,H=H/3,X=0,fa=1/(H-l.length+1),l=0;l<H;++l){var ga=3*l,F=a.fromArray(u,ga,y),na=a.fromArray(r,ga,A);m.position&&(k[R++]=na.x,k[R++]=na.y,k[R++]=na.z,k[R++]=F.x,k[R++]=F.y,k[R++]=F.z);m.st&&(M[ca++]=X,M[ca++]=0,M[ca++]=X,M[ca++]=1);if(m.normal||m.tangent||m.bitangent){var ia,la=a.clone(a.ZERO,D),na=w.scaleToGeodeticSurface(a.fromArray(u,ga,A),A);l+1<H&&(ia=w.scaleToGeodeticSurface(a.fromArray(u,ga+3,z),z),la=a.fromArray(u,ga+3,D));ba&&(ba=a.subtract(la,F,x),F=a.subtract(na,F,y),T=a.normalize(a.cross(F,ba,T),T),ba=!1);a.equalsEpsilon(ia,na,q.EPSILON10)?ba=!0:(X+=fa,m.tangent&&(da=a.normalize(a.subtract(ia,na,da),da)),m.bitangent&&(V=a.normalize(a.cross(T,da,V),V)));m.normal&&(aa[Y++]=T.x,aa[Y++]=T.y,aa[Y++]=T.z,aa[Y++]=T.x,aa[Y++]=T.y,aa[Y++]=T.z);m.tangent&&(U[S++]=da.x,U[S++]=da.y,U[S++]=da.z,U[S++]=da.x,U[S++]=da.y,U[S++]=da.z);m.bitangent&&(W[Q++]=V.x,W[Q++]=V.y,W[Q++]=V.z,W[Q++]=V.x,W[Q++]=V.y,W[Q++]=V.z)}}w=new p;m.position&&(w.position=new h({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:k}));m.normal&&(w.normal=new h({componentDatatype:f.FLOAT,componentsPerAttribute:3,values:aa}));m.tangent&&(w.tangent=new h({componentDatatype:f.FLOAT,componentsPerAttribute:3,values:U}));m.bitangent&&(w.bitangent=new h({componentDatatype:f.FLOAT,componentsPerAttribute:3,values:W}));m.st&&(w.st=new h({componentDatatype:f.FLOAT,componentsPerAttribute:2,values:M}));m=J/3;I=d.createTypedArray(m,J-6*(I+1));for(l=J=0;l<m-2;l+=2)ia=l,r=l+2,u=a.fromArray(k,3*ia,y),aa=a.fromArray(k,3*r,A),a.equalsEpsilon(u,aa,q.EPSILON10)||(u=l+1,aa=l+3,I[J++]=u,I[J++]=ia,I[J++]=aa,I[J++]=aa,I[J++]=ia,I[J++]=r);return new e({attributes:w,indices:I,primitiveType:t.TRIANGLES,boundingSphere:new b.fromVertices(k)})}};return u});F("Core/WallOutlineGeometry","./BoundingSphere ./Cartesian3 ./ComponentDatatype ./defaultValue ./defined ./DeveloperError ./Ellipsoid ./Geometry ./GeometryAttribute ./GeometryAttributes ./IndexDatatype ./Math ./PrimitiveType ./WallGeometryLibrary".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(c){c=k(c,k.EMPTY_OBJECT);var b=c.positions,d=c.maximumHeights,e=c.minimumHeights;if(!g(b))throw new l("options.positions is required.");if(g(d)&&d.length!==b.length)throw new l("options.positions and options.maximumHeights must have the same length.");if(g(e)&&e.length!==b.length)throw new l("options.positions and options.minimumHeights must have the same length.");var f=k(c.granularity,q.RADIANS_PER_DEGREE);c=k(c.ellipsoid,m.WGS84);this._positions=b;this._minimumHeights=e;this._maximumHeights=d;this._granularity=f;this._ellipsoid=m.clone(c);this._workerName="createWallOutlineGeometry";b=b.length*a.packedLength+3;g(e)&&(b+=e.length);g(d)&&(b+=d.length);this.packedLength=b+m.packedLength+1}var u=new a,y=new a;c.pack=function(c,b,d){if(!g(c))throw new l("value is required");if(!g(b))throw new l("array is required");d=k(d,0);var e,f=c._positions,h=f.length;b[d++]=h;for(e=0;e<h;++e,d+=a.packedLength)a.pack(f[e],b,d);f=c._minimumHeights;h=g(f)?f.length:0;b[d++]=h;if(g(f))for(e=0;e<h;++e)b[d++]=f[e];f=c._maximumHeights;h=g(f)?f.length:0;b[d++]=h;if(g(f))for(e=0;e<h;++e)b[d++]=f[e];m.pack(c._ellipsoid,b,d);d+=m.packedLength;b[d]=c._granularity;return b};var A=m.clone(m.UNIT_SPHERE),z={positions:void 0,minimumHeights:void 0,maximumHeights:void 0,ellipsoid:A,granularity:void 0};c.unpack=function(b,d,e){if(!g(b))throw new l("array is required");d=k(d,0);var f,h=b[d++],p=Array(h);for(f=0;f<h;++f,d+=a.packedLength)p[f]=a.unpack(b,d);var h=b[d++],q;if(0<h)for(q=Array(h),f=0;f<h;++f)q[f]=b[d++];var h=b[d++],v;if(0<h)for(v=Array(h),f=0;f<h;++f)v[f]=b[d++];f=m.unpack(b,d,A);d+=m.packedLength;b=b[d];if(!g(e))return z.positions=p,z.minimumHeights=q,z.maximumHeights=v,z.granularity=b,new c(z);e._positions=p;e._minimumHeights=q;e._maximumHeights=v;e._ellipsoid=m.clone(f,e._ellipsoid);e._granularity=b;return e};c.fromConstantHeights=function(a){a=k(a,k.EMPTY_OBJECT);var b=a.positions;if(!g(b))throw new l("options.positions is required.");var d,e,f=a.minimumHeight,h=a.maximumHeight,m=g(f),p=g(h);if(m||p){var q=b.length;d=m?Array(q):void 0;e=p?Array(q):void 0;for(var r=0;r<q;++r)m&&(d[r]=f),p&&(e[r]=h)}return new c({positions:b,maximumHeights:e,minimumHeights:d,ellipsoid:a.ellipsoid})};c.createGeometry=function(c){c=r.computePositions(c._ellipsoid,c._positions,c._maximumHeights,c._minimumHeights,c._granularity,!1);if(g(c)){var k=c.bottomPositions,l=c.topPositions,m=l.length,C=2*m;c=new Float64Array(C);var z=0,m=m/3,A;for(A=0;A<m;++A){var x=3*A,w=a.fromArray(l,x,u),x=a.fromArray(k,x,y);c[z++]=x.x;c[z++]=x.y;c[z++]=x.z;c[z++]=w.x;c[z++]=w.y;c[z++]=w.z}k=new p({position:new h({componentDatatype:f.DOUBLE,componentsPerAttribute:3,values:c})});C/=3;l=d.createTypedArray(C,2*C-4+C);for(A=m=0;A<C-2;A+=2){var z=A,w=A+2,x=a.fromArray(c,3*z,u),G=a.fromArray(c,3*w,y);a.equalsEpsilon(x,G,q.EPSILON10)||(x=A+1,G=A+3,l[m++]=x,l[m++]=z,l[m++]=x,l[m++]=G,l[m++]=z,l[m++]=w)}l[m++]=C-2;l[m++]=C-1;return new e({attributes:k,indices:l,primitiveType:t.LINES,boundingSphere:new b.fromVertices(c)})}};return c});F("Core/webGLConstantToGlslType",["./WebGLConstants"],function(b){return function(a){switch(a){case b.FLOAT:return"float";case b.FLOAT_VEC2:return"vec2";case b.FLOAT_VEC3:return"vec3";case b.FLOAT_VEC4:return"vec4";case b.FLOAT_MAT2:return"mat2";case b.FLOAT_MAT3:return"mat3";case b.FLOAT_MAT4:return"mat4";case b.SAMPLER_2D:return"sampler2D";case b.BOOL:return"bool"}}});F("Core/WeightSpline","./Check ./defaultValue ./defined ./defineProperties ./DeveloperError ./Spline".split(" "),function(b,a,f,k,g,l){function m(e){e=a(e,a.EMPTY_OBJECT);var f=e.weights;e=e.times;b.defined("weights",f);b.defined("times",e);b.typeOf.number.greaterThanOrEquals("weights.length",f.length,3);if(0!==f.length%e.length)throw new g("times.length must be a factor of weights.length.");this._times=e;this._weights=f;this._count=f.length/e.length;this._lastTimeIndex=0}k(m.prototype,{times:{get:function(){return this._times}},weights:{get:function(){return this._weights}}});m.prototype.findTimeInterval=l.prototype.findTimeInterval;m.prototype.wrapTime=l.prototype.wrapTime;m.prototype.clampTime=l.prototype.clampTime;m.prototype.evaluate=function(a,b){var e=this.weights,d=this.times,h=this._lastTimeIndex=this.findTimeInterval(a,this._lastTimeIndex),d=(a-d[h])/(d[h+1]-d[h]);f(b)||(b=Array(this._count));for(var g=0;g<this._count;g++){var k=h*this._count+g;b[g]=e[k]*(1-d)+e[k+this._count]*d}return b};return m});F("Core/wrapFunction",["./DeveloperError"],function(b){return function(a,f,k){if("function"!==typeof f)throw new b("oldFunction is required to be a function.");if("function"!==typeof k)throw new b("oldFunction is required to be a function.");return function(){k.apply(a,arguments);f.apply(a,arguments)}}});F("DataSources/ConstantProperty",["../Core/defined","../Core/defineProperties","../Core/Event"],function(b,a,f){function k(a){this._value=void 0;this._hasEquals=this._hasClone=!1;this._definitionChanged=new f;this.setValue(a)}a(k.prototype,{isConstant:{value:!0},definitionChanged:{get:function(){return this._definitionChanged}}});k.prototype.getValue=function(a,b){return this._hasClone?this._value.clone(b):this._value};k.prototype.setValue=function(a){var f=this._value;if(f!==a){var g=b(a),e=g&&"function"===typeof a.clone,g=g&&"function"===typeof a.equals;g&&a.equals(f)||(this._hasClone=e,this._hasEquals=g,this._value=e?a.clone(this._value):a,this._definitionChanged.raiseEvent(this))}};k.prototype.equals=function(a){return this===a||a instanceof k&&(!this._hasEquals&&this._value===a._value||this._hasEquals&&this._value.equals(a._value))};k.prototype.valueOf=function(){return this._value};k.prototype.toString=function(){return String(this._value)};return k});F("DataSources/createPropertyDescriptor",["../Core/defaultValue","../Core/defined","./ConstantProperty"],function(b,a,f){function k(b,f,e,h,g){return{configurable:h,get:function(){return this[f]},set:function(d){var h=this[f],k=this[e];a(k)&&(k(),this[e]=void 0);void 0===d||a(d)&&a(d.getValue)||!a(g)||(d=g(d));h!==d&&(this[f]=d,this._definitionChanged.raiseEvent(this,b,d,h));a(d)&&a(d.definitionChanged)&&(this[e]=d.definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this,b,d,d)},this))}}}function g(a){return new f(a)}return function(a,f,e){return k(a,"_"+a.toString(),"_"+a.toString()+"Subscription",b(f,!1),b(e,g))}});F("DataSources/BillboardGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l){function m(a){this._definitionChanged=new g;this._disableDepthTestDistanceSubscription=this._disableDepthTestDistance=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._imageSubRegionSubscription=this._imageSubRegion=this._pixelOffsetScaleByDistanceSubscription=this._pixelOffsetScaleByDistance=this._translucencyByDistanceSubscription=this._translucencyByDistance=this._scaleByDistanceSubscription=this._scaleByDistance=this._heightSubscription=this._height=this._widthSubscription=this._width=this._sizeInMetersSubscription=this._sizeInMeters=this._alignedAxisSubscription=this._alignedAxis=this._rotationSubscription=this._rotation=this._colorSubscription=this._color=this._heightReferenceSubscription=this._heightReference=this._verticalOriginSubscription=this._verticalOrigin=this._horizontalOriginSubscription=this._horizontalOrigin=this._eyeOffsetSubscription=this._eyeOffset=this._pixelOffsetSubscription=this._pixelOffset=this._scaleSubscription=this._scale=this._imageSubscription=this._image=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(m.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:l("show"),image:l("image"),scale:l("scale"),pixelOffset:l("pixelOffset"),eyeOffset:l("eyeOffset"),horizontalOrigin:l("horizontalOrigin"),verticalOrigin:l("verticalOrigin"),heightReference:l("heightReference"),color:l("color"),rotation:l("rotation"),alignedAxis:l("alignedAxis"),sizeInMeters:l("sizeInMeters"),width:l("width"),height:l("height"),scaleByDistance:l("scaleByDistance"),translucencyByDistance:l("translucencyByDistance"),pixelOffsetScaleByDistance:l("pixelOffsetScaleByDistance"),imageSubRegion:l("imageSubRegion"),distanceDisplayCondition:l("distanceDisplayCondition"),disableDepthTestDistance:l("disableDepthTestDistance")});m.prototype.clone=function(b){if(!a(b))return new m(this);b.show=this._show;b.image=this._image;b.scale=this._scale;b.pixelOffset=this._pixelOffset;b.eyeOffset=this._eyeOffset;b.horizontalOrigin=this._horizontalOrigin;b.verticalOrigin=this._verticalOrigin;b.heightReference=this._heightReference;b.color=this._color;b.rotation=this._rotation;b.alignedAxis=this._alignedAxis;b.sizeInMeters=this._sizeInMeters;b.width=this._width;b.height=this._height;b.scaleByDistance=this._scaleByDistance;b.translucencyByDistance=this._translucencyByDistance;b.pixelOffsetScaleByDistance=this._pixelOffsetScaleByDistance;b.imageSubRegion=this._imageSubRegion;b.distanceDisplayCondition=this._distanceDisplayCondition;b.disableDepthTestDistance=this._disableDepthTestDistance;return b};m.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this._show,e.show);this.image=b(this._image,e.image);this.scale=b(this._scale,e.scale);this.pixelOffset=b(this._pixelOffset,e.pixelOffset);this.eyeOffset=b(this._eyeOffset,e.eyeOffset);this.horizontalOrigin=b(this._horizontalOrigin,e.horizontalOrigin);this.verticalOrigin=b(this._verticalOrigin,e.verticalOrigin);this.heightReference=b(this._heightReference,e.heightReference);this.color=b(this._color,e.color);this.rotation=b(this._rotation,e.rotation);this.alignedAxis=b(this._alignedAxis,e.alignedAxis);this.sizeInMeters=b(this._sizeInMeters,e.sizeInMeters);this.width=b(this._width,e.width);this.height=b(this._height,e.height);this.scaleByDistance=b(this._scaleByDistance,e.scaleByDistance);this.translucencyByDistance=b(this._translucencyByDistance,e.translucencyByDistance);this.pixelOffsetScaleByDistance=b(this._pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance);this.imageSubRegion=b(this._imageSubRegion,e.imageSubRegion);this.distanceDisplayCondition=b(this._distanceDisplayCondition,e.distanceDisplayCondition);this.disableDepthTestDistance=b(this._disableDepthTestDistance,e.disableDepthTestDistance)};return m});F("Scene/SceneMode",["../Core/freezeObject"],function(b){var a={MORPHING:0,COLUMBUS_VIEW:1,SCENE2D:2,SCENE3D:3,getMorphTime:function(b){if(b===a.SCENE3D)return 1;if(b!==a.MORPHING)return 0}};return b(a)});F("Scene/HeightReference",["../Core/freezeObject"],function(b){return b({NONE:0,CLAMP_TO_GROUND:1,RELATIVE_TO_GROUND:2})});F("Scene/HorizontalOrigin",["../Core/freezeObject"],function(b){return b({CENTER:0,LEFT:1,RIGHT:-1})});F("Scene/VerticalOrigin",["../Core/freezeObject"],function(b){return b({CENTER:0,BOTTOM:1,BASELINE:2,TOP:-1})});F("DataSources/BoundingSphereState",["../Core/freezeObject"],function(b){return b({DONE:0,PENDING:1,FAILED:2})});F("DataSources/Property",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError"],function(b,a,f,k){function g(){k.throwInstantiationError()}f(g.prototype,{isConstant:{get:k.throwInstantiationError},definitionChanged:{get:k.throwInstantiationError}});g.prototype.getValue=k.throwInstantiationError;g.prototype.equals=k.throwInstantiationError;g.equals=function(b,f){return b===f||a(b)&&b.equals(f)};g.arrayEquals=function(b,f){if(b===f)return!0;if(!a(b)||!a(f)||b.length!==f.length)return!1;for(var e=b.length,h=0;h<e;h++)if(!g.equals(b[h],f[h]))return!1;return!0};g.isConstant=function(b){return!a(b)||b.isConstant};g.getValueOrUndefined=function(b,f,e){return a(b)?b.getValue(f,e):void 0};g.getValueOrDefault=function(f,g,e,h){return a(f)?b(f.getValue(g,h),e):e};g.getValueOrClonedDefault=function(b,f,e,h){var g;a(b)&&(g=b.getValue(f,h));a(g)||(g=e.clone(g));return g};return g});F("DataSources/BillboardVisualizer","../Core/AssociativeArray ../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Color ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/NearFarScalar ../Scene/SceneMode ../Scene/HeightReference ../Scene/HorizontalOrigin ../Scene/VerticalOrigin ./BoundingSphereState ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a){this.entity=a;this.textureValue=this.billboard=void 0}function A(a,c){if(!l(a))throw new e("entityCluster is required.");if(!l(c))throw new e("entityCollection is required.");c.collectionChanged.addEventListener(A.prototype._onCollectionChanged,this);this._cluster=a;this._entityCollection=c;this._items=new b;this._onCollectionChanged(c,c.values,[],[])}function z(a,c,b){l(a)&&(a.billboard=void 0,b.removeBillboard(c))}var x=g.WHITE,D=k.ZERO,v=q.NONE,B=f.ZERO,C=k.ZERO,I=t.CENTER,H=r.CENTER,J=new k,w=new g,G=new k,E=new f,L=new p,K=new p,P=new p,N=new a,O=new h;A.prototype.update=function(a,c){if(!l(a))throw new e("time is required.");for(var b=this._items.values,f=this._cluster,h=0,g=b.length;h<g;h++){var k=b[h],m=k.entity,p=m._billboard,r,t=k.billboard,y=m.isShowing&&m.isAvailable(a)&&u.getValueOrDefault(p._show,a,!0),A;y&&(A=u.getValueOrUndefined(m._position,a,J),r=u.getValueOrUndefined(p._image,a),y=l(A)&&l(r));y?(u.isConstant(m._position)||(f._clusterDirty=!0),l(t)||(t=f.getBillboard(m),t.id=m,t.image=void 0,k.billboard=t),t.show=y,l(t.image)&&k.textureValue===r||(t.image=r,k.textureValue=r),t.position=A,t.color=u.getValueOrDefault(p._color,a,x,w),t.eyeOffset=u.getValueOrDefault(p._eyeOffset,a,D,G),t.heightReference=c===d.SCENE3D?u.getValueOrDefault(p._heightReference,a,v):q.NONE,t.pixelOffset=u.getValueOrDefault(p._pixelOffset,a,B,E),t.scale=u.getValueOrDefault(p._scale,a,1),t.rotation=u.getValueOrDefault(p._rotation,a,0),t.alignedAxis=u.getValueOrDefault(p._alignedAxis,a,C),t.horizontalOrigin=u.getValueOrDefault(p._horizontalOrigin,a,I),t.verticalOrigin=u.getValueOrDefault(p._verticalOrigin,a,H),t.width=u.getValueOrUndefined(p._width,a),t.height=u.getValueOrUndefined(p._height,a),t.scaleByDistance=u.getValueOrUndefined(p._scaleByDistance,a,L),t.translucencyByDistance=u.getValueOrUndefined(p._translucencyByDistance,a,K),t.pixelOffsetScaleByDistance=u.getValueOrUndefined(p._pixelOffsetScaleByDistance,a,P),t.sizeInMeters=u.getValueOrDefault(p._sizeInMeters,a,!1),t.distanceDisplayCondition=c===d.SCENE3D?u.getValueOrUndefined(p._distanceDisplayCondition,a,O):void 0,t.disableDepthTestDistance=u.getValueOrUndefined(p._disableDepthTestDistance,a),k=u.getValueOrUndefined(p._imageSubRegion,a,N),l(k)&&t.setImageSubRegion(t._imageId,k)):z(k,m,f)}return!0};A.prototype.getBoundingSphere=function(a,b){if(!l(a))throw new e("entity is required.");if(!l(b))throw new e("result is required.");var d=this._items.get(a.id);if(!l(d)||!l(d.billboard))return c.FAILED;d=d.billboard;if(d.heightReference===q.NONE)b.center=k.clone(d.position,b.center);else{if(!l(d._clampedPosition))return c.PENDING;b.center=k.clone(d._clampedPosition,b.center)}b.radius=0;return c.DONE};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(A.prototype._onCollectionChanged,this);for(var a=this._entityCollection.values,c=0;c<a.length;c++)this._cluster.removeBillboard(a[c]);return m(this)};A.prototype._onCollectionChanged=function(a,c,b,d){var e,f=this._items,h=this._cluster;for(a=c.length-1;-1<a;a--)e=c[a],l(e._billboard)&&l(e._position)&&f.set(e.id,new y(e));for(a=d.length-1;-1<a;a--)e=d[a],l(e._billboard)&&l(e._position)?f.contains(e.id)||f.set(e.id,new y(e)):(z(f.get(e.id),e,h),f.remove(e.id));for(a=b.length-1;-1<a;a--)e=b[a],z(f.get(e.id),e,h),f.remove(e.id)};return A});F("Shaders/Appearances/AllMaterialAppearanceFS",[],function(){return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec3 positionToEyeEC \x3d -v_positionEC;\nmat3 tangentToEyeMatrix \x3d czm_tangentToEyeSpaceMatrix(v_normalEC, v_tangentEC, v_bitangentEC);\nvec3 normalEC \x3d normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC \x3d faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.tangentToEyeMatrix \x3d tangentToEyeMatrix;\nmaterialInput.positionToEyeEC \x3d positionToEyeEC;\nmaterialInput.st \x3d v_st;\nczm_material material \x3d czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor \x3d czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});F("Shaders/Appearances/AllMaterialAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec3 tangent;\nattribute vec3 bitangent;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec3 v_tangentEC;\nvarying vec3 v_bitangentEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p \x3d czm_computePosition();\nv_positionEC \x3d (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC \x3d czm_normal * normal;\nv_tangentEC \x3d czm_normal * tangent;\nv_bitangentEC \x3d czm_normal * bitangent;\nv_st \x3d st;\ngl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}\n"});F("Shaders/Appearances/BasicMaterialAppearanceFS",[],function(){return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\nvec3 positionToEyeEC \x3d -v_positionEC;\nvec3 normalEC \x3d normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC \x3d faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.positionToEyeEC \x3d positionToEyeEC;\nczm_material material \x3d czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor \x3d czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});F("Shaders/Appearances/BasicMaterialAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\nvec4 p \x3d czm_computePosition();\nv_positionEC \x3d (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC \x3d czm_normal * normal;\ngl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}\n"});F("Shaders/Appearances/TexturedMaterialAppearanceFS",[],function(){return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec3 positionToEyeEC \x3d -v_positionEC;\nvec3 normalEC \x3d normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC \x3d faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nczm_materialInput materialInput;\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.positionToEyeEC \x3d positionToEyeEC;\nmaterialInput.st \x3d v_st;\nczm_material material \x3d czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor \x3d czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});F("Shaders/Appearances/TexturedMaterialAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p \x3d czm_computePosition();\nv_positionEC \x3d (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC \x3d czm_normal * normal;\nv_st \x3d st;\ngl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}\n"});F("Scene/BlendEquation",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){return b({ADD:a.FUNC_ADD,SUBTRACT:a.FUNC_SUBTRACT,REVERSE_SUBTRACT:a.FUNC_REVERSE_SUBTRACT,MIN:a.MIN,MAX:a.MAX})});F("Scene/BlendFunction",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){return b({ZERO:a.ZERO,ONE:a.ONE,SOURCE_COLOR:a.SRC_COLOR,ONE_MINUS_SOURCE_COLOR:a.ONE_MINUS_SRC_COLOR,DESTINATION_COLOR:a.DST_COLOR,ONE_MINUS_DESTINATION_COLOR:a.ONE_MINUS_DST_COLOR,SOURCE_ALPHA:a.SRC_ALPHA,ONE_MINUS_SOURCE_ALPHA:a.ONE_MINUS_SRC_ALPHA,DESTINATION_ALPHA:a.DST_ALPHA,ONE_MINUS_DESTINATION_ALPHA:a.ONE_MINUS_DST_ALPHA,CONSTANT_COLOR:a.CONSTANT_COLOR,ONE_MINUS_CONSTANT_COLOR:a.ONE_MINUS_CONSTANT_COLOR,CONSTANT_ALPHA:a.CONSTANT_ALPHA,ONE_MINUS_CONSTANT_ALPHA:a.ONE_MINUS_CONSTANT_ALPHA,SOURCE_ALPHA_SATURATE:a.SRC_ALPHA_SATURATE})});F("Scene/BlendingState",["../Core/freezeObject","./BlendEquation","./BlendFunction"],function(b,a,f){a={DISABLED:b({enabled:!1}),ALPHA_BLEND:b({enabled:!0,equationRgb:a.ADD,equationAlpha:a.ADD,functionSourceRgb:f.SOURCE_ALPHA,functionSourceAlpha:f.SOURCE_ALPHA,functionDestinationRgb:f.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:f.ONE_MINUS_SOURCE_ALPHA}),PRE_MULTIPLIED_ALPHA_BLEND:b({enabled:!0,equationRgb:a.ADD,equationAlpha:a.ADD,functionSourceRgb:f.ONE,functionSourceAlpha:f.ONE,functionDestinationRgb:f.ONE_MINUS_SOURCE_ALPHA,functionDestinationAlpha:f.ONE_MINUS_SOURCE_ALPHA}),ADDITIVE_BLEND:b({enabled:!0,equationRgb:a.ADD,equationAlpha:a.ADD,functionSourceRgb:f.SOURCE_ALPHA,functionSourceAlpha:f.SOURCE_ALPHA,functionDestinationRgb:f.ONE,functionDestinationAlpha:f.ONE})};return b(a)});F("Scene/CullFace",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){return b({FRONT:a.FRONT,BACK:a.BACK,FRONT_AND_BACK:a.FRONT_AND_BACK})});F("Scene/Appearance","../Core/clone ../Core/combine ../Core/defaultValue ../Core/defined ../Core/defineProperties ./BlendingState ./CullFace".split(" "),function(b,a,f,k,g,l,m){function e(a){a=f(a,f.EMPTY_OBJECT);this.material=a.material;this.translucent=f(a.translucent,!0);this._vertexShaderSource=a.vertexShaderSource;this._fragmentShaderSource=a.fragmentShaderSource;this._renderState=a.renderState;this._closed=f(a.closed,!1)}g(e.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}}});e.prototype.getFragmentShaderSource=function(){var a=[];this.flat&&a.push("#define FLAT");this.faceForward&&a.push("#define FACE_FORWARD");k(this.material)&&a.push(this.material.shaderSource);a.push(this.fragmentShaderSource);return a.join("\n")};e.prototype.isTranslucent=function(){return k(this.material)&&this.material.isTranslucent()||!k(this.material)&&this.translucent};e.prototype.getRenderState=function(){var a=this.isTranslucent(),e=b(this.renderState,!1);a?(e.depthMask=!1,e.blending=l.ALPHA_BLEND):e.depthMask=!0;return e};e.getDefaultRenderState=function(b,e,d){var f={depthTest:{enabled:!0}};b&&(f.depthMask=!1,f.blending=l.ALPHA_BLEND);e&&(f.cull={enabled:!0,face:m.BACK});k(d)&&(f=a(d,f,!0));return f};return e});F("Renderer/ContextLimits",["../Core/defineProperties"],function(b){var a={_maximumCombinedTextureImageUnits:0,_maximumCubeMapSize:0,_maximumFragmentUniformVectors:0,_maximumTextureImageUnits:0,_maximumRenderbufferSize:0,_maximumTextureSize:0,_maximumVaryingVectors:0,_maximumVertexAttributes:0,_maximumVertexTextureImageUnits:0,_maximumVertexUniformVectors:0,_minimumAliasedLineWidth:0,_maximumAliasedLineWidth:0,_minimumAliasedPointSize:0,_maximumAliasedPointSize:0,_maximumViewportWidth:0,_maximumViewportHeight:0,_maximumTextureFilterAnisotropy:0,_maximumDrawBuffers:0,_maximumColorAttachments:0,_highpFloatSupported:!1,_highpIntSupported:!1};b(a,{maximumCombinedTextureImageUnits:{get:function(){return a._maximumCombinedTextureImageUnits}},maximumCubeMapSize:{get:function(){return a._maximumCubeMapSize}},maximumFragmentUniformVectors:{get:function(){return a._maximumFragmentUniformVectors}},maximumTextureImageUnits:{get:function(){return a._maximumTextureImageUnits}},maximumRenderbufferSize:{get:function(){return a._maximumRenderbufferSize}},maximumTextureSize:{get:function(){return a._maximumTextureSize}},maximumVaryingVectors:{get:function(){return a._maximumVaryingVectors}},maximumVertexAttributes:{get:function(){return a._maximumVertexAttributes}},maximumVertexTextureImageUnits:{get:function(){return a._maximumVertexTextureImageUnits}},maximumVertexUniformVectors:{get:function(){return a._maximumVertexUniformVectors}},minimumAliasedLineWidth:{get:function(){return a._minimumAliasedLineWidth}},maximumAliasedLineWidth:{get:function(){return a._maximumAliasedLineWidth}},minimumAliasedPointSize:{get:function(){return a._minimumAliasedPointSize}},maximumAliasedPointSize:{get:function(){return a._maximumAliasedPointSize}},maximumViewportWidth:{get:function(){return a._maximumViewportWidth}},maximumViewportHeight:{get:function(){return a._maximumViewportHeight}},maximumTextureFilterAnisotropy:{get:function(){return a._maximumTextureFilterAnisotropy}},maximumDrawBuffers:{get:function(){return a._maximumDrawBuffers}},maximumColorAttachments:{get:function(){return a._maximumColorAttachments}},highpFloatSupported:{get:function(){return a._highpFloatSupported}},highpIntSupported:{get:function(){return a._highpIntSupported}}});return a});F("Renderer/CubeMapFace","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/PixelFormat ./PixelDatatype".split(" "),function(b,a,f,k,g,l,m){function e(a,b,d,e,f,g,c,k,l,m){this._gl=a;this._texture=b;this._textureTarget=d;this._targetFace=e;this._pixelFormat=f;this._pixelDatatype=g;this._size=c;this._preMultiplyAlpha=k;this._flipY=l;this._initialized=m}k(e.prototype,{pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},_target:{get:function(){return this._targetFace}}});e.prototype.copyFrom=function(e,k,d){k=a(k,0);d=a(d,0);b.defined("source",e);b.typeOf.number.greaterThanOrEquals("xOffset",k,0);b.typeOf.number.greaterThanOrEquals("yOffset",d,0);if(k+e.width>this._size)throw new g("xOffset + source.width must be less than or equal to width.");if(d+e.height>this._size)throw new g("yOffset + source.height must be less than or equal to height.");var h=this._gl,m=this._textureTarget,p=this._targetFace;h.activeTexture(h.TEXTURE0);h.bindTexture(m,this._texture);var c=e.width,u=e.height,y=e.arrayBufferView,A=this._size,z=this._pixelFormat,x=this._pixelDatatype,D=this._preMultiplyAlpha,v=this._flipY,B=4;f(y)&&(B=l.alignmentInBytes(z,x,c));h.pixelStorei(h.UNPACK_ALIGNMENT,B);B=!1;if(!this._initialized){if(0===k&&0===d&&c===A&&u===A)f(y)?(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),v&&(y=l.flipY(y,z,x,A,A)),h.texImage2D(p,0,z,A,A,0,z,x,y)):(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,v),h.texImage2D(p,0,z,z,x,e)),B=!0;else{h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1);var C=l.createTypedArray(z,x,A,A);h.texImage2D(p,0,z,A,A,0,z,x,C)}this._initialized=!0}B||(f(y)?(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,!1),v&&(y=l.flipY(y,z,x,c,u)),h.texSubImage2D(p,0,k,d,c,u,z,x,y)):(h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,D),h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,v),h.texSubImage2D(p,0,k,d,z,x,e)));h.bindTexture(m,null)};e.prototype.copyFromFramebuffer=function(e,f,d,k,l,r){e=a(e,0);f=a(f,0);d=a(d,0);k=a(k,0);l=a(l,this._size);r=a(r,this._size);b.typeOf.number.greaterThanOrEquals("xOffset",e,0);b.typeOf.number.greaterThanOrEquals("yOffset",f,0);b.typeOf.number.greaterThanOrEquals("framebufferXOffset",d,0);b.typeOf.number.greaterThanOrEquals("framebufferYOffset",k,0);if(e+l>this._size)throw new g("xOffset + source.width must be less than or equal to width.");if(f+r>this._size)throw new g("yOffset + source.height must be less than or equal to height.");if(this._pixelDatatype===m.FLOAT)throw new g("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===m.HALF_FLOAT)throw new g("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");var c=this._gl,h=this._textureTarget;c.activeTexture(c.TEXTURE0);c.bindTexture(h,this._texture);c.copyTexSubImage2D(this._targetFace,0,e,f,d,k,l,r);c.bindTexture(h,null);this._initialized=!0};return e});F("Renderer/MipmapHint",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={DONT_CARE:a.DONT_CARE,FASTEST:a.FASTEST,NICEST:a.NICEST,validate:function(a){return a===f.DONT_CARE||a===f.FASTEST||a===f.NICEST}};return b(f)});F("Renderer/TextureMagnificationFilter",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={NEAREST:a.NEAREST,LINEAR:a.LINEAR,validate:function(a){return a===f.NEAREST||a===f.LINEAR}};return b(f)});F("Renderer/TextureMinificationFilter",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={NEAREST:a.NEAREST,LINEAR:a.LINEAR,NEAREST_MIPMAP_NEAREST:a.NEAREST_MIPMAP_NEAREST,LINEAR_MIPMAP_NEAREST:a.LINEAR_MIPMAP_NEAREST,NEAREST_MIPMAP_LINEAR:a.NEAREST_MIPMAP_LINEAR,LINEAR_MIPMAP_LINEAR:a.LINEAR_MIPMAP_LINEAR,validate:function(a){return a===f.NEAREST||a===f.LINEAR||a===f.NEAREST_MIPMAP_NEAREST||a===f.LINEAR_MIPMAP_NEAREST||a===f.NEAREST_MIPMAP_LINEAR||a===f.LINEAR_MIPMAP_LINEAR}};return b(f)});F("Renderer/TextureWrap",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={CLAMP_TO_EDGE:a.CLAMP_TO_EDGE,REPEAT:a.REPEAT,MIRRORED_REPEAT:a.MIRRORED_REPEAT,validate:function(a){return a===f.CLAMP_TO_EDGE||a===f.REPEAT||a===f.MIRRORED_REPEAT}};return b(f)});F("Renderer/Sampler","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ./TextureMagnificationFilter ./TextureMinificationFilter ./TextureWrap".split(" "),function(b,a,f,k,g,l,m,e){function h(h){h=a(h,a.EMPTY_OBJECT);var d=a(h.wrapS,e.CLAMP_TO_EDGE),k=a(h.wrapT,e.CLAMP_TO_EDGE),p=a(h.minificationFilter,m.LINEAR),r=a(h.magnificationFilter,l.LINEAR);h=f(h.maximumAnisotropy)?h.maximumAnisotropy:1;if(!e.validate(d))throw new g("Invalid sampler.wrapS.");if(!e.validate(k))throw new g("Invalid sampler.wrapT.");if(!m.validate(p))throw new g("Invalid sampler.minificationFilter.");if(!l.validate(r))throw new g("Invalid sampler.magnificationFilter.");b.typeOf.number.greaterThanOrEquals("maximumAnisotropy",h,1);this._wrapS=d;this._wrapT=k;this._minificationFilter=p;this._magnificationFilter=r;this._maximumAnisotropy=h}k(h.prototype,{wrapS:{get:function(){return this._wrapS}},wrapT:{get:function(){return this._wrapT}},minificationFilter:{get:function(){return this._minificationFilter}},magnificationFilter:{get:function(){return this._magnificationFilter}},maximumAnisotropy:{get:function(){return this._maximumAnisotropy}}});h.equals=function(a,b){return a===b||f(a)&&f(b)&&a._wrapS===b._wrapS&&a._wrapT===b._wrapT&&a._minificationFilter===b._minificationFilter&&a._magnificationFilter===b._magnificationFilter&&a._maximumAnisotropy===b._maximumAnisotropy};return h});F("Renderer/CubeMap","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Math ../Core/PixelFormat ./ContextLimits ./CubeMapFace ./MipmapHint ./PixelDatatype ./Sampler ./TextureMagnificationFilter ./TextureMinificationFilter".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(c){function d(a,c,b,d){var h=c.arrayBufferView;f(h)||(h=c.bufferView);var g=4;f(h)&&(g=e.alignmentInBytes(H,J,m));G.pixelStorei(G.UNPACK_ALIGNMENT,g);f(h)?(G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,!1),d&&(h=e.flipY(h,H,J,y,y)),G.texImage2D(a,0,H,y,y,0,H,J,h)):(G.pixelStorei(G.UNPACK_PREMULTIPLY_ALPHA_WEBGL,b),G.pixelStorei(G.UNPACK_FLIP_Y_WEBGL,d),G.texImage2D(a,0,H,H,J,c))}c=a(c,a.EMPTY_OBJECT);b.defined("options.context",c.context);var g=c.context,k=c.source,m,v;if(f(k)){var r=[k.positiveX,k.negativeX,k.positiveY,k.negativeY,k.positiveZ,k.negativeZ];if(!(r[0]&&r[1]&&r[2]&&r[3]&&r[4]&&r[5]))throw new l("options.source requires positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ faces.");m=r[0].width;v=r[0].height;for(var u=1;6>u;++u)if(Number(r[u].width)!==m||Number(r[u].height)!==v)throw new l("Each face in options.source must have the same width and height.");}else m=c.width,v=c.height;var y=m,H=a(c.pixelFormat,e.RGBA),J=a(c.pixelDatatype,q.UNSIGNED_BYTE);if(!f(m)||!f(v))throw new l("options requires a source field to create an initialized cube map or width and height fields to create a blank cube map.");if(m!==v)throw new l("Width must equal height.");if(0>=y)throw new l("Width and height must be greater than zero.");if(y>h.maximumCubeMapSize)throw new l("Width and height must be less than or equal to the maximum cube map size ("+h.maximumCubeMapSize+").  Check maximumCubeMapSize.");if(!e.validate(H))throw new l("Invalid options.pixelFormat.");if(e.isDepthFormat(H))throw new l("options.pixelFormat cannot be DEPTH_COMPONENT or DEPTH_STENCIL.");if(!q.validate(J))throw new l("Invalid options.pixelDatatype.");if(J===q.FLOAT&&!g.floatingPointTexture)throw new l("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.");if(J===q.HALF_FLOAT&&!g.halfFloatingPointTexture)throw new l("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension.");var w=6*e.textureSizeInBytes(H,J,y,y);v=c.preMultiplyAlpha||H===e.RGB||H===e.LUMINANCE;var r=a(c.flipY,!0),G=g._gl,u=G.TEXTURE_CUBE_MAP,E=G.createTexture();G.activeTexture(G.TEXTURE0);G.bindTexture(u,E);f(k)?(d(G.TEXTURE_CUBE_MAP_POSITIVE_X,k.positiveX,v,r),d(G.TEXTURE_CUBE_MAP_NEGATIVE_X,k.negativeX,v,r),d(G.TEXTURE_CUBE_MAP_POSITIVE_Y,k.positiveY,v,r),d(G.TEXTURE_CUBE_MAP_NEGATIVE_Y,k.negativeY,v,r),d(G.TEXTURE_CUBE_MAP_POSITIVE_Z,k.positiveZ,v,r),d(G.TEXTURE_CUBE_MAP_NEGATIVE_Z,k.negativeZ,v,r)):(G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X,0,H,y,y,0,H,J,null),G.texImage2D(G.TEXTURE_CUBE_MAP_NEGATIVE_X,0,H,y,y,0,H,J,null),G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_Y,0,H,y,y,0,H,J,null),G.texImage2D(G.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,H,y,y,0,H,J,null),G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_Z,0,H,y,y,0,H,J,null),G.texImage2D(G.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,H,y,y,0,H,J,null));G.bindTexture(u,null);this._context=g;this._textureFilterAnisotropic=g._textureFilterAnisotropic;this._textureTarget=u;this._texture=E;this._pixelFormat=H;this._pixelDatatype=J;this._size=y;this._hasMipmap=!1;this._sizeInBytes=w;this._preMultiplyAlpha=v;this._flipY=r;this._sampler=void 0;g=f(k);this._positiveX=new p(G,E,u,G.TEXTURE_CUBE_MAP_POSITIVE_X,H,J,y,v,r,g);this._negativeX=new p(G,E,u,G.TEXTURE_CUBE_MAP_NEGATIVE_X,H,J,y,v,r,g);this._positiveY=new p(G,E,u,G.TEXTURE_CUBE_MAP_POSITIVE_Y,H,J,y,v,r,g);this._negativeY=new p(G,E,u,G.TEXTURE_CUBE_MAP_NEGATIVE_Y,H,J,y,v,r,g);this._positiveZ=new p(G,E,u,G.TEXTURE_CUBE_MAP_POSITIVE_Z,H,J,y,v,r,g);this._negativeZ=new p(G,E,u,G.TEXTURE_CUBE_MAP_NEGATIVE_Z,H,J,y,v,r,g);this.sampler=f(c.sampler)?c.sampler:new t}k(u.prototype,{positiveX:{get:function(){return this._positiveX}},negativeX:{get:function(){return this._negativeX}},positiveY:{get:function(){return this._positiveY}},negativeY:{get:function(){return this._negativeY}},positiveZ:{get:function(){return this._positiveZ}},negativeZ:{get:function(){return this._negativeZ}},sampler:{get:function(){return this._sampler},set:function(a){var b=a.minificationFilter,d=a.magnificationFilter,e=b===c.NEAREST_MIPMAP_NEAREST||b===c.NEAREST_MIPMAP_LINEAR||b===c.LINEAR_MIPMAP_NEAREST||b===c.LINEAR_MIPMAP_LINEAR,h=this._context,g=this._pixelDatatype;if(g===q.FLOAT&&!h.textureFloatLinear||g===q.HALF_FLOAT&&!h.textureHalfFloatLinear)b=e?c.NEAREST_MIPMAP_NEAREST:c.NEAREST,d=r.NEAREST;e=h._gl;h=this._textureTarget;e.activeTexture(e.TEXTURE0);e.bindTexture(h,this._texture);e.texParameteri(h,e.TEXTURE_MIN_FILTER,b);e.texParameteri(h,e.TEXTURE_MAG_FILTER,d);e.texParameteri(h,e.TEXTURE_WRAP_S,a.wrapS);e.texParameteri(h,e.TEXTURE_WRAP_T,a.wrapT);f(this._textureFilterAnisotropic)&&e.texParameteri(h,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.maximumAnisotropy);e.bindTexture(h,null);this._sampler=a}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},width:{get:function(){return this._size}},height:{get:function(){return this._size}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},_target:{get:function(){return this._textureTarget}}});u.prototype.generateMipmap=function(c){c=a(c,d.DONT_CARE);if(1<this._size&&!m.isPowerOfTwo(this._size))throw new l("width and height must be a power of two to call generateMipmap().");if(!d.validate(c))throw new l("hint is invalid.");this._hasMipmap=!0;var b=this._context._gl,e=this._textureTarget;b.hint(b.GENERATE_MIPMAP_HINT,c);b.activeTexture(b.TEXTURE0);b.bindTexture(e,this._texture);b.generateMipmap(e);b.bindTexture(e,null)};u.prototype.isDestroyed=function(){return!1};u.prototype.destroy=function(){this._context._gl.deleteTexture(this._texture);this._positiveX=g(this._positiveX);this._negativeX=g(this._negativeX);this._positiveY=g(this._positiveY);this._negativeY=g(this._negativeY);this._positiveZ=g(this._positiveZ);this._negativeZ=g(this._negativeZ);return g(this)};return u});F("Renderer/Texture","../Core/Cartesian2 ../Core/Check ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Math ../Core/PixelFormat ../Core/WebGLConstants ./ContextLimits ./MipmapHint ./PixelDatatype ./Sampler ./TextureMagnificationFilter ./TextureMinificationFilter".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(h){h=k(h,k.EMPTY_OBJECT);a.defined("options.context",h.context);var l=h.context,m=h.width,v=h.height,u=h.source;g(u)&&(g(m)||(m=k(u.videoWidth,u.width)),g(v)||(v=k(u.videoHeight,u.height)));var t=k(h.pixelFormat,p.RGBA),y=k(h.pixelDatatype,r.UNSIGNED_BYTE),z=t,A=p.isCompressedFormat(z);if(l.webgl2)if(t===p.DEPTH_STENCIL?z=d.DEPTH24_STENCIL8:t===p.DEPTH_COMPONENT&&(y===r.UNSIGNED_SHORT?z=d.DEPTH_COMPONENT16:y===r.UNSIGNED_INT&&(z=d.DEPTH_COMPONENT24)),y===r.FLOAT)switch(t){case p.RGBA:z=d.RGBA32F;break;case p.RGB:z=d.RGB32F;break;case p.RG:z=d.RG32F;break;case p.R:z=d.R32F}else if(y===r.HALF_FLOAT)switch(t){case p.RGBA:z=d.RGBA16F;break;case p.RGB:z=d.RGB16F;break;case p.RG:z=d.RG16F;break;case p.R:z=d.R16F}if(!g(m)||!g(v))throw new e("options requires a source field to create an initialized texture or width and height fields to create a blank texture.");a.typeOf.number.greaterThan("width",m,0);if(m>q.maximumTextureSize)throw new e("Width must be less than or equal to the maximum texture size ("+q.maximumTextureSize+").  Check maximumTextureSize.");a.typeOf.number.greaterThan("height",v,0);if(v>q.maximumTextureSize)throw new e("Height must be less than or equal to the maximum texture size ("+q.maximumTextureSize+").  Check maximumTextureSize.");if(!p.validate(t))throw new e("Invalid options.pixelFormat.");if(!A&&!r.validate(y))throw new e("Invalid options.pixelDatatype.");if(t===p.DEPTH_COMPONENT&&y!==r.UNSIGNED_SHORT&&y!==r.UNSIGNED_INT)throw new e("When options.pixelFormat is DEPTH_COMPONENT, options.pixelDatatype must be UNSIGNED_SHORT or UNSIGNED_INT.");if(t===p.DEPTH_STENCIL&&y!==r.UNSIGNED_INT_24_8)throw new e("When options.pixelFormat is DEPTH_STENCIL, options.pixelDatatype must be UNSIGNED_INT_24_8.");if(y===r.FLOAT&&!l.floatingPointTexture)throw new e("When options.pixelDatatype is FLOAT, this WebGL implementation must support the OES_texture_float extension.  Check context.floatingPointTexture.");if(y===r.HALF_FLOAT&&!l.halfFloatingPointTexture)throw new e("When options.pixelDatatype is HALF_FLOAT, this WebGL implementation must support the OES_texture_half_float extension. Check context.halfFloatingPointTexture.");if(p.isDepthFormat(t)){if(g(u))throw new e("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, source cannot be provided.");if(!l.depthTexture)throw new e("When options.pixelFormat is DEPTH_COMPONENT or DEPTH_STENCIL, this WebGL implementation must support WEBGL_depth_texture.  Check context.depthTexture.");}if(A){if(!g(u)||!g(u.arrayBufferView))throw new e("When options.pixelFormat is compressed, options.source.arrayBufferView must be defined.");if(p.isDXTFormat(z)&&!l.s3tc)throw new e("When options.pixelFormat is S3TC compressed, this WebGL implementation must support the WEBGL_texture_compression_s3tc extension. Check context.s3tc.");if(p.isPVRTCFormat(z)&&!l.pvrtc)throw new e("When options.pixelFormat is PVRTC compressed, this WebGL implementation must support the WEBGL_texture_compression_pvrtc extension. Check context.pvrtc.");if(p.isETC1Format(z)&&!l.etc1)throw new e("When options.pixelFormat is ETC1 compressed, this WebGL implementation must support the WEBGL_texture_compression_etc1 extension. Check context.etc1.");if(p.compressedTextureSizeInBytes(z,m,v)!==u.arrayBufferView.byteLength)throw new e("The byte length of the array buffer is invalid for the compressed texture with the given width and height.");}var w=h.preMultiplyAlpha||t===p.RGB||t===p.LUMINANCE,G=k(h.flipY,!0),E=!0,L=l._gl,K=L.TEXTURE_2D,P=L.createTexture();L.activeTexture(L.TEXTURE0);L.bindTexture(K,P);var N=4;g(u)&&g(u.arrayBufferView)&&!A&&(N=p.alignmentInBytes(t,y,m));L.pixelStorei(L.UNPACK_ALIGNMENT,N);g(u)?g(u.arrayBufferView)?(L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,!1),u=u.arrayBufferView,A?L.compressedTexImage2D(K,0,z,m,v,0,u):(G&&(u=p.flipY(u,t,y,m,v)),L.texImage2D(K,0,z,m,v,0,t,y,u))):g(u.framebuffer)?(L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,!1),u.framebuffer!==l.defaultFramebuffer&&u.framebuffer._bind(),L.copyTexImage2D(K,0,z,u.xOffset,u.yOffset,m,v,0),u.framebuffer!==l.defaultFramebuffer&&u.framebuffer._unBind()):g(u.windFieldBuffer)?(L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,G),L.texImage2D(K,0,z,m,v,0,t,y,u.windFieldBuffer)):(L.pixelStorei(L.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w),L.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,G),L.texImage2D(K,0,z,t,y,u)):(L.texImage2D(K,0,z,m,v,0,t,y,null),E=!1);L.bindTexture(K,null);z=A?p.compressedTextureSizeInBytes(t,m,v):p.textureSizeInBytes(t,y,m,v);this._id=f();this._context=l;this._textureFilterAnisotropic=l._textureFilterAnisotropic;this._textureTarget=K;this._texture=P;this._pixelFormat=t;this._pixelDatatype=y;this._width=m;this._height=v;this._dimensions=new b(m,v);this._hasMipmap=!1;this._sizeInBytes=z;this._preMultiplyAlpha=w;this._flipY=G;this._initialized=E;this._sampler=void 0;this.sampler=g(h.sampler)?h.sampler:new c}A.create=function(a){return new A(a)};A.fromFramebuffer=function(c){c=k(c,k.EMPTY_OBJECT);a.defined("options.context",c.context);var b=c.context,d=b._gl,f=k(c.pixelFormat,p.RGB),h=k(c.framebufferXOffset,0),l=k(c.framebufferYOffset,0),m=k(c.width,d.drawingBufferWidth),q=k(c.height,d.drawingBufferHeight),u=c.framebuffer;if(!p.validate(f))throw new e("Invalid pixelFormat.");if(p.isDepthFormat(f)||p.isCompressedFormat(f))throw new e("pixelFormat cannot be DEPTH_COMPONENT, DEPTH_STENCIL or a compressed format.");a.defined("options.context",c.context);a.typeOf.number.greaterThanOrEquals("framebufferXOffset",h,0);a.typeOf.number.greaterThanOrEquals("framebufferYOffset",l,0);if(h+m>d.drawingBufferWidth)throw new e("framebufferXOffset + width must be less than or equal to drawingBufferWidth");if(l+q>d.drawingBufferHeight)throw new e("framebufferYOffset + height must be less than or equal to drawingBufferHeight.");return new A({context:b,width:m,height:q,pixelFormat:f,source:{framebuffer:g(u)?u:b.defaultFramebuffer,xOffset:h,yOffset:l,width:m,height:q}})};l(A.prototype,{id:{get:function(){return this._id}},sampler:{get:function(){return this._sampler},set:function(a){var c=a.minificationFilter,b=a.magnificationFilter,d=c===y.NEAREST_MIPMAP_NEAREST||c===y.NEAREST_MIPMAP_LINEAR||c===y.LINEAR_MIPMAP_NEAREST||c===y.LINEAR_MIPMAP_LINEAR,e=this._context,f=this._pixelDatatype;if(f===r.FLOAT&&!e.textureFloatLinear||f===r.HALF_FLOAT&&!e.textureHalfFloatLinear)c=d?y.NEAREST_MIPMAP_NEAREST:y.NEAREST,b=u.NEAREST;d=e._gl;e=this._textureTarget;d.activeTexture(d.TEXTURE0);d.bindTexture(e,this._texture);d.texParameteri(e,d.TEXTURE_MIN_FILTER,c);d.texParameteri(e,d.TEXTURE_MAG_FILTER,b);d.texParameteri(e,d.TEXTURE_WRAP_S,a.wrapS);d.texParameteri(e,d.TEXTURE_WRAP_T,a.wrapT);g(this._textureFilterAnisotropic)&&d.texParameteri(e,this._textureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.maximumAnisotropy);d.bindTexture(e,null);this._sampler=a}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},dimensions:{get:function(){return this._dimensions}},preMultiplyAlpha:{get:function(){return this._preMultiplyAlpha}},flipY:{get:function(){return this._flipY}},width:{get:function(){return this._width}},height:{get:function(){return this._height}},sizeInBytes:{get:function(){return this._hasMipmap?Math.floor(4*this._sizeInBytes/3):this._sizeInBytes}},_target:{get:function(){return this._textureTarget}}});A.prototype.copyFrom=function(c,b,d){b=k(b,0);d=k(d,0);a.defined("source",c);if(p.isDepthFormat(this._pixelFormat))throw new e("Cannot call copyFrom when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(p.isCompressedFormat(this._pixelFormat))throw new e("Cannot call copyFrom with a compressed texture pixel format.");a.typeOf.number.greaterThanOrEquals("xOffset",b,0);a.typeOf.number.greaterThanOrEquals("yOffset",d,0);a.typeOf.number.lessThanOrEquals("xOffset + source.width",b+c.width,this._width);a.typeOf.number.lessThanOrEquals("yOffset + source.height",d+c.height,this._height);var f=this._context._gl,h=this._textureTarget;f.activeTexture(f.TEXTURE0);f.bindTexture(h,this._texture);var l=c.width,m=c.height,q=c.arrayBufferView,u=this._width,w=this._height,r=this._pixelFormat,t=this._pixelDatatype,y=this._preMultiplyAlpha,z=this._flipY,A=4;g(q)&&(A=p.alignmentInBytes(r,t,l));f.pixelStorei(f.UNPACK_ALIGNMENT,A);A=!1;if(!this._initialized){if(0===b&&0===d&&l===u&&m===w)g(q)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),z&&(q=p.flipY(q,r,t,u,w)),f.texImage2D(h,0,r,u,w,0,r,t,q)):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,z),f.texImage2D(h,0,r,r,t,c)),A=!0;else{f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1);var D=p.createTypedArray(r,t,u,w);f.texImage2D(h,0,r,u,w,0,r,t,D)}this._initialized=!0}A||(g(q)?(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,!1),z&&(q=p.flipY(q,r,t,l,m)),f.texSubImage2D(h,0,b,d,l,m,r,t,q)):(f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,y),f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,z),f.texSubImage2D(h,0,b,d,r,t,c)));f.bindTexture(h,null)};A.prototype.copyFromFramebuffer=function(c,b,d,f,h,g){c=k(c,0);b=k(b,0);d=k(d,0);f=k(f,0);h=k(h,this._width);g=k(g,this._height);if(p.isDepthFormat(this._pixelFormat))throw new e("Cannot call copyFromFramebuffer when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(this._pixelDatatype===r.FLOAT)throw new e("Cannot call copyFromFramebuffer when the texture pixel data type is FLOAT.");if(this._pixelDatatype===r.HALF_FLOAT)throw new e("Cannot call copyFromFramebuffer when the texture pixel data type is HALF_FLOAT.");if(p.isCompressedFormat(this._pixelFormat))throw new e("Cannot call copyFrom with a compressed texture pixel format.");a.typeOf.number.greaterThanOrEquals("xOffset",c,0);a.typeOf.number.greaterThanOrEquals("yOffset",b,0);a.typeOf.number.greaterThanOrEquals("framebufferXOffset",d,0);a.typeOf.number.greaterThanOrEquals("framebufferYOffset",f,0);a.typeOf.number.lessThanOrEquals("xOffset + width",c+h,this._width);a.typeOf.number.lessThanOrEquals("yOffset + height",b+g,this._height);var l=this._context._gl,m=this._textureTarget;l.activeTexture(l.TEXTURE0);l.bindTexture(m,this._texture);l.copyTexSubImage2D(m,0,c,b,d,f,h,g);l.bindTexture(m,null);this._initialized=!0};A.prototype.generateMipmap=function(a){a=k(a,t.DONT_CARE);if(p.isDepthFormat(this._pixelFormat))throw new e("Cannot call generateMipmap when the texture pixel format is DEPTH_COMPONENT or DEPTH_STENCIL.");if(p.isCompressedFormat(this._pixelFormat))throw new e("Cannot call generateMipmap with a compressed pixel format.");if(1<this._width&&!h.isPowerOfTwo(this._width))throw new e("width must be a power of two to call generateMipmap().");if(1<this._height&&!h.isPowerOfTwo(this._height))throw new e("height must be a power of two to call generateMipmap().");if(!t.validate(a))throw new e("hint is invalid.");this._hasMipmap=!0;var c=this._context._gl,b=this._textureTarget;c.hint(c.GENERATE_MIPMAP_HINT,a);c.activeTexture(c.TEXTURE0);c.bindTexture(b,this._texture);c.generateMipmap(b);c.bindTexture(b,null)};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){this._context._gl.deleteTexture(this._texture);return m(this)};return A});F("Shaders/Materials/AspectRampMaterial",[],function(){return"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec4 rampColor \x3d texture2D(image, vec2(materialInput.aspect / (2.0 * czm_pi), 0.5));\nrampColor \x3d czm_gammaCorrect(rampColor);\nmaterial.diffuse \x3d rampColor.rgb;\nmaterial.alpha \x3d rampColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/BumpMapMaterial",[],function(){return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\nvec2 centerPixel \x3d fract(repeat * st);\nfloat centerBump \x3d texture2D(image, centerPixel).channel;\nfloat imageWidth \x3d float(imageDimensions.x);\nvec2 rightPixel \x3d fract(repeat * (st + vec2(1.0 / imageWidth, 0.0)));\nfloat rightBump \x3d texture2D(image, rightPixel).channel;\nfloat imageHeight \x3d float(imageDimensions.y);\nvec2 leftPixel \x3d fract(repeat * (st + vec2(0.0, 1.0 / imageHeight)));\nfloat topBump \x3d texture2D(image, leftPixel).channel;\nvec3 normalTangentSpace \x3d normalize(vec3(centerBump - rightBump, centerBump - topBump, clamp(1.0 - strength, 0.1, 1.0)));\nvec3 normalEC \x3d materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal \x3d normalEC;\nmaterial.diffuse \x3d vec3(0.01);\nreturn material;\n}\n"});F("Shaders/Materials/CheckerboardMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\nfloat b \x3d mod(floor(repeat.s * st.s) + floor(repeat.t * st.t), 2.0);\nfloat scaledWidth \x3d fract(repeat.s * st.s);\nscaledWidth \x3d abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight \x3d fract(repeat.t * st.t);\nscaledHeight \x3d abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value \x3d min(scaledWidth, scaledHeight);\nvec4 currentColor \x3d mix(lightColor, darkColor, b);\nvec4 color \x3d czm_antialias(lightColor, darkColor, currentColor, value, 0.03);\ncolor \x3d czm_gammaCorrect(color);\nmaterial.diffuse \x3d color.rgb;\nmaterial.alpha \x3d color.a;\nreturn material;\n}\n"});F("Shaders/Materials/DotMaterial",[],function(){return"uniform vec4 lightColor;\nuniform vec4 darkColor;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nfloat b \x3d smoothstep(0.3, 0.32, length(fract(repeat * materialInput.st) - 0.5));\nvec4 color \x3d mix(lightColor, darkColor, b);\ncolor \x3d czm_gammaCorrect(color);\nmaterial.diffuse \x3d color.rgb;\nmaterial.alpha \x3d color.a;\nreturn material;\n}\n"});F("Shaders/Materials/ElevationContourMaterial",[],function(){return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float spacing;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nfloat distanceToContour \x3d mod(materialInput.height, spacing);\n#ifdef GL_OES_standard_derivatives\nfloat dxc \x3d abs(dFdx(materialInput.height));\nfloat dyc \x3d abs(dFdy(materialInput.height));\nfloat dF \x3d max(dxc, dyc) * width;\nfloat alpha \x3d (distanceToContour \x3c dF) ? 1.0 : 0.0;\n#else\nfloat alpha \x3d (distanceToContour \x3c (czm_resolutionScale * width)) ? 1.0 : 0.0;\n#endif\nvec4 outColor \x3d czm_gammaCorrect(vec4(color.rgb, alpha));\nmaterial.diffuse \x3d outColor.rgb;\nmaterial.alpha \x3d outColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/ElevationRampMaterial",[],function(){return"uniform sampler2D image;\nuniform float minimumHeight;\nuniform float maximumHeight;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nfloat scaledHeight \x3d clamp((materialInput.height - minimumHeight) / (maximumHeight - minimumHeight), 0.0, 1.0);\nvec4 rampColor \x3d texture2D(image, vec2(scaledHeight, 0.5));\nrampColor \x3d czm_gammaCorrect(rampColor);\nmaterial.diffuse \x3d rampColor.rgb;\nmaterial.alpha \x3d rampColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/FadeMaterial",[],function(){return"uniform vec4 fadeInColor;\nuniform vec4 fadeOutColor;\nuniform float maximumDistance;\nuniform bool repeat;\nuniform vec2 fadeDirection;\nuniform vec2 time;\nfloat getTime(float t, float coord)\n{\nfloat scalar \x3d 1.0 / maximumDistance;\nfloat q  \x3d distance(t, coord) * scalar;\nif (repeat)\n{\nfloat r \x3d distance(t, coord + 1.0) * scalar;\nfloat s \x3d distance(t, coord - 1.0) * scalar;\nq \x3d min(min(r, s), q);\n}\nreturn clamp(q, 0.0, 1.0);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\nfloat s \x3d getTime(time.x, st.s) * fadeDirection.s;\nfloat t \x3d getTime(time.y, st.t) * fadeDirection.t;\nfloat u \x3d length(vec2(s, t));\nvec4 color \x3d mix(fadeInColor, fadeOutColor, u);\ncolor \x3d czm_gammaCorrect(color);\nmaterial.emission \x3d color.rgb;\nmaterial.alpha \x3d color.a;\nreturn material;\n}\n"});F("Shaders/Materials/GridMaterial",[],function(){return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nuniform float cellAlpha;\nuniform vec2 lineCount;\nuniform vec2 lineThickness;\nuniform vec2 lineOffset;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\nfloat scaledWidth \x3d fract(lineCount.s * st.s - lineOffset.s);\nscaledWidth \x3d abs(scaledWidth - floor(scaledWidth + 0.5));\nfloat scaledHeight \x3d fract(lineCount.t * st.t - lineOffset.t);\nscaledHeight \x3d abs(scaledHeight - floor(scaledHeight + 0.5));\nfloat value;\n#ifdef GL_OES_standard_derivatives\nconst float fuzz \x3d 1.2;\nvec2 thickness \x3d (lineThickness * czm_resolutionScale) - 1.0;\nvec2 dx \x3d abs(dFdx(st));\nvec2 dy \x3d abs(dFdy(st));\nvec2 dF \x3d vec2(max(dx.s, dy.s), max(dx.t, dy.t)) * lineCount;\nvalue \x3d min(\nsmoothstep(dF.s * thickness.s, dF.s * (fuzz + thickness.s), scaledWidth),\nsmoothstep(dF.t * thickness.t, dF.t * (fuzz + thickness.t), scaledHeight));\n#else\nconst float fuzz \x3d 0.05;\nvec2 range \x3d 0.5 - (lineThickness * 0.05);\nvalue \x3d min(\n1.0 - smoothstep(range.s, range.s + fuzz, scaledWidth),\n1.0 - smoothstep(range.t, range.t + fuzz, scaledHeight));\n#endif\nfloat dRim \x3d 1.0 - abs(dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC)));\nfloat sRim \x3d smoothstep(0.8, 1.0, dRim);\nvalue *\x3d (1.0 - sRim);\nvec4 halfColor;\nhalfColor.rgb \x3d color.rgb * 0.5;\nhalfColor.a \x3d color.a * (1.0 - ((1.0 - cellAlpha) * value));\nhalfColor \x3d czm_gammaCorrect(halfColor);\nmaterial.diffuse \x3d halfColor.rgb;\nmaterial.emission \x3d halfColor.rgb;\nmaterial.alpha \x3d halfColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/NormalMapMaterial",[],function(){return"uniform sampler2D image;\nuniform float strength;\nuniform vec2 repeat;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec4 textureValue \x3d texture2D(image, fract(repeat * materialInput.st));\nvec3 normalTangentSpace \x3d textureValue.channels;\nnormalTangentSpace.xy \x3d normalTangentSpace.xy * 2.0 - 1.0;\nnormalTangentSpace.z \x3d clamp(1.0 - strength, 0.1, 1.0);\nnormalTangentSpace \x3d normalize(normalTangentSpace);\nvec3 normalEC \x3d materialInput.tangentToEyeMatrix * normalTangentSpace;\nmaterial.normal \x3d normalEC;\nreturn material;\n}\n"});F("Shaders/Materials/PolylineArrowMaterial",[],function(){return"#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\nuniform vec4 color;\nvarying float v_width;\nfloat getPointOnLine(vec2 p0, vec2 p1, float x)\n{\nfloat slope \x3d (p0.y - p1.y) / (p0.x - p1.x);\nreturn slope * (x - p0.x) + p0.y;\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\n#ifdef GL_OES_standard_derivatives\nfloat base \x3d 1.0 - abs(fwidth(st.s)) * 10.0;\n#else\nfloat base \x3d 0.99;\n#endif\nvec2 center \x3d vec2(1.0, 0.5);\nfloat ptOnUpperLine \x3d getPointOnLine(vec2(base, 1.0), center, st.s);\nfloat ptOnLowerLine \x3d getPointOnLine(vec2(base, 0.0), center, st.s);\nfloat halfWidth \x3d 0.15;\nfloat s \x3d step(0.5 - halfWidth, st.t);\ns *\x3d 1.0 - step(0.5 + halfWidth, st.t);\ns *\x3d 1.0 - step(base, st.s);\nfloat t \x3d step(base, materialInput.st.s);\nt *\x3d 1.0 - step(ptOnUpperLine, st.t);\nt *\x3d step(ptOnLowerLine, st.t);\nfloat dist;\nif (st.s \x3c base)\n{\nfloat d1 \x3d abs(st.t - (0.5 - halfWidth));\nfloat d2 \x3d abs(st.t - (0.5 + halfWidth));\ndist \x3d min(d1, d2);\n}\nelse\n{\nfloat d1 \x3d czm_infinity;\nif (st.t \x3c 0.5 - halfWidth \x26\x26 st.t \x3e 0.5 + halfWidth)\n{\nd1 \x3d abs(st.s - base);\n}\nfloat d2 \x3d abs(st.t - ptOnUpperLine);\nfloat d3 \x3d abs(st.t - ptOnLowerLine);\ndist \x3d min(min(d1, d2), d3);\n}\nvec4 outsideColor \x3d vec4(0.0);\nvec4 currentColor \x3d mix(outsideColor, color, clamp(s + t, 0.0, 1.0));\nvec4 outColor \x3d czm_antialias(outsideColor, color, currentColor, dist);\noutColor \x3d czm_gammaCorrect(outColor);\nmaterial.diffuse \x3d outColor.rgb;\nmaterial.alpha \x3d outColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/PolylineDashMaterial",[],function(){return"uniform vec4 color;\nuniform vec4 gapColor;\nuniform float dashLength;\nuniform float dashPattern;\nvarying float v_polylineAngle;\nconst float maskLength \x3d 16.0;\nmat2 rotate(float rad) {\nfloat c \x3d cos(rad);\nfloat s \x3d sin(rad);\nreturn mat2(\nc, s,\n-s, c\n);\n}\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 pos \x3d rotate(v_polylineAngle) * gl_FragCoord.xy;\nfloat dashPosition \x3d fract(pos.x / dashLength);\nfloat maskIndex \x3d floor(dashPosition * maskLength);\nfloat maskTest \x3d floor(dashPattern / pow(2.0, maskIndex));\nvec4 fragColor \x3d (mod(maskTest, 2.0) \x3c 1.0) ? gapColor : color;\nif (fragColor.a \x3c 0.005) {\ndiscard;\n}\nfragColor \x3d czm_gammaCorrect(fragColor);\nmaterial.emission \x3d fragColor.rgb;\nmaterial.alpha \x3d fragColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/PolylineGlowMaterial",[],function(){return"uniform vec4 color;\nuniform float glowPower;\nuniform float taperPower;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\nfloat glow \x3d glowPower / abs(st.t - 0.5) - (glowPower / 0.5);\nif (taperPower \x3c\x3d 0.99999) {\nglow *\x3d min(1.0, taperPower / (0.5 - st.s * 0.5) - (taperPower / 0.5));\n}\nvec4 fragColor;\nfragColor.rgb \x3d max(vec3(glow - 1.0 + color.rgb), color.rgb);\nfragColor.a \x3d clamp(0.0, 1.0, glow) * color.a;\nfragColor \x3d czm_gammaCorrect(fragColor);\nmaterial.emission \x3d fragColor.rgb;\nmaterial.alpha \x3d fragColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/PolylineOutlineMaterial",[],function(){return"uniform vec4 color;\nuniform vec4 outlineColor;\nuniform float outlineWidth;\nvarying float v_width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec2 st \x3d materialInput.st;\nfloat halfInteriorWidth \x3d  0.5 * (v_width - outlineWidth) / v_width;\nfloat b \x3d step(0.5 - halfInteriorWidth, st.t);\nb *\x3d 1.0 - step(0.5 + halfInteriorWidth, st.t);\nfloat d1 \x3d abs(st.t - (0.5 - halfInteriorWidth));\nfloat d2 \x3d abs(st.t - (0.5 + halfInteriorWidth));\nfloat dist \x3d min(d1, d2);\nvec4 currentColor \x3d mix(outlineColor, color, b);\nvec4 outColor \x3d czm_antialias(outlineColor, color, currentColor, dist);\noutColor \x3d czm_gammaCorrect(outColor);\nmaterial.diffuse \x3d outColor.rgb;\nmaterial.alpha \x3d outColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/RimLightingMaterial",[],function(){return"uniform vec4 color;\nuniform vec4 rimColor;\nuniform float width;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nfloat d \x3d 1.0 - dot(materialInput.normalEC, normalize(materialInput.positionToEyeEC));\nfloat s \x3d smoothstep(1.0 - width, 1.0, d);\nvec4 outColor \x3d czm_gammaCorrect(color);\nvec4 outRimColor \x3d czm_gammaCorrect(rimColor);\nmaterial.diffuse \x3d outColor.rgb;\nmaterial.emission \x3d outRimColor.rgb * s;\nmaterial.alpha \x3d mix(outColor.a, outRimColor.a, s);\nreturn material;\n}\n"});F("Shaders/Materials/SlopeRampMaterial",[],function(){return"uniform sampler2D image;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nvec4 rampColor \x3d texture2D(image, vec2(materialInput.slope / (czm_pi / 2.0), 0.5));\nrampColor \x3d czm_gammaCorrect(rampColor);\nmaterial.diffuse \x3d rampColor.rgb;\nmaterial.alpha \x3d rampColor.a;\nreturn material;\n}\n"});F("Shaders/Materials/StripeMaterial",[],function(){return"uniform vec4 evenColor;\nuniform vec4 oddColor;\nuniform float offset;\nuniform float repeat;\nuniform bool horizontal;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nfloat coord \x3d mix(materialInput.st.s, materialInput.st.t, float(horizontal));\nfloat value \x3d fract((coord - offset) * (repeat * 0.5));\nfloat dist \x3d min(value, min(abs(value - 0.5), 1.0 - value));\nvec4 currentColor \x3d mix(evenColor, oddColor, step(0.5, value));\nvec4 color \x3d czm_antialias(evenColor, oddColor, currentColor, dist);\ncolor \x3d czm_gammaCorrect(color);\nmaterial.diffuse \x3d color.rgb;\nmaterial.alpha \x3d color.a;\nreturn material;\n}\n"});F("Shaders/Materials/Water",[],function(){return"uniform sampler2D specularMap;\nuniform sampler2D normalMap;\nuniform vec4 baseWaterColor;\nuniform vec4 blendColor;\nuniform float frequency;\nuniform float animationSpeed;\nuniform float amplitude;\nuniform float specularIntensity;\nuniform float fadeFactor;\nczm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nfloat time \x3d czm_frameNumber * animationSpeed;\nfloat fade \x3d max(1.0, (length(materialInput.positionToEyeEC) / 10000000000.0) * frequency * fadeFactor);\nfloat specularMapValue \x3d texture2D(specularMap, materialInput.st).r;\nvec4 noise \x3d czm_getWaterNoise(normalMap, materialInput.st * frequency, time, 0.0);\nvec3 normalTangentSpace \x3d noise.xyz * vec3(1.0, 1.0, (1.0 / amplitude));\nnormalTangentSpace.xy /\x3d fade;\nnormalTangentSpace \x3d mix(vec3(0.0, 0.0, 50.0), normalTangentSpace, specularMapValue);\nnormalTangentSpace \x3d normalize(normalTangentSpace);\nfloat tsPerturbationRatio \x3d clamp(dot(normalTangentSpace, vec3(0.0, 0.0, 1.0)), 0.0, 1.0);\nmaterial.alpha \x3d specularMapValue;\nmaterial.diffuse \x3d mix(blendColor.rgb, baseWaterColor.rgb, specularMapValue);\nmaterial.diffuse +\x3d (0.1 * tsPerturbationRatio);\nmaterial.diffuse \x3d material.diffuse;\nmaterial.normal \x3d normalize(materialInput.tangentToEyeMatrix * normalTangentSpace);\nmaterial.specular \x3d specularIntensity;\nmaterial.shininess \x3d 10.0;\nreturn material;\n}\n"});F("FeShadersEx/Materials/polylineLinkMaterial",[],function(){return"czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n    czm_material material \x3d czm_getDefaultMaterial(materialInput);\n    vec2 st \x3d materialInput.st;\n\n    if(texture2D(image, vec2(0.0, 0.0)).a \x3d\x3d 1.0){\n        discard;\n    }else{\n         material.alpha \x3d texture2D(image, vec2(1.0 - fract(time - st.s), st.t)).a * color.a;\n    }\n\n    material.diffuse \x3d max(color.rgb * material.alpha * 3.0, color.rgb);\n\n    return material;\n}"});F("FeShadersEx/Materials/ElliposidFadeMaterial",[],function(){return"czm_material czm_getMaterial(czm_materialInput materialInput)\n{\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nmaterial.diffuse \x3d 1.5 * color.rgb;\nvec2 st \x3d materialInput.st;\nfloat dis \x3d distance(st, vec2(0.5, 0.5));\nfloat per \x3d fract(time);\nif(dis \x3e per * 0.5){\ndiscard;\n}else {\nmaterial.alpha \x3d color.a  * dis / per / 2.0;\n}\nreturn material;\n}\n"});F("Scene/Material","../Core/Cartesian2 ../Core/clone ../Core/Color ../Core/combine ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/isArray ../Core/loadCRN ../Core/loadKTX ../Core/Matrix2 ../Core/Matrix3 ../Core/Matrix4 ../Core/Resource ../Renderer/CubeMap ../Renderer/Texture ../Shaders/Materials/AspectRampMaterial ../Shaders/Materials/BumpMapMaterial ../Shaders/Materials/CheckerboardMaterial ../Shaders/Materials/DotMaterial ../Shaders/Materials/ElevationContourMaterial ../Shaders/Materials/ElevationRampMaterial ../Shaders/Materials/FadeMaterial ../Shaders/Materials/GridMaterial ../Shaders/Materials/NormalMapMaterial ../Shaders/Materials/PolylineArrowMaterial ../Shaders/Materials/PolylineDashMaterial ../Shaders/Materials/PolylineGlowMaterial ../Shaders/Materials/PolylineOutlineMaterial ../Shaders/Materials/RimLightingMaterial ../Shaders/Materials/SlopeRampMaterial ../Shaders/Materials/StripeMaterial ../Shaders/Materials/Water ../FeShadersEx/Materials/polylineLinkMaterial ../FeShadersEx/Materials/ElliposidFadeMaterial ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W){function M(a){this._count=this._template=this._strict=this.translucent=this._uniforms=this.uniforms=this.materials=this.shaderSource=this.type=void 0;this._texturePaths={};this._loadedImages=[];this._loadedCubeMaps=[];this._textures={};this._updateFunctions=[];this._defaultTexture=void 0;R(a,this);e(this,{type:{value:this.type,writable:!1}});m(M._uniformList[this.type])||(M._uniformList[this.type]=Object.keys(this._uniforms))}function R(c,b){c=l(c,l.EMPTY_OBJECT);b._strict=l(c.strict,!1);b._count=l(c.count,0);b._template=a(l(c.fabric,l.EMPTY_OBJECT));b._template.uniforms=a(l(b._template.uniforms,l.EMPTY_OBJECT));b._template.materials=a(l(b._template.materials,l.EMPTY_OBJECT));b.type=m(b._template.type)?b._template.type:g();b.shaderSource="";b.materials={};b.uniforms={};b._uniforms={};b._translucentFunctions=[];var d,e=M._materialCache.getMaterial(b.type);if(m(e)){var f=a(e.fabric,!0);b._template=k(b._template,f,!0);d=e.translucent}ca(b);m(e)||M._materialCache.addMaterial(b.type,b);T(b);ba(b);ga(b);d=l(d,0===b._translucentFunctions.length?!0:void 0);d=l(c.translucent,d);m(d)&&("function"===typeof d?b._translucentFunctions.push(function(){return d(b)}):b._translucentFunctions.push(d))}function Y(a,c,b,d){if(m(a))for(var e in a)if(a.hasOwnProperty(e)){var f=-1!==c.indexOf(e);(d&&!f||!d&&f)&&b(e,c)}}function Q(a,c){for(var b="fabric: property name '"+a+"' is not valid. It should be ",d=0;d<c.length;d++)var e="'"+c[d]+"'",b=b+(d===c.length-1?"or "+e+".":e+", ");throw new p(b);}function S(a,c){throw new p("fabric: uniforms and materials cannot share the same property '"+a+"'");}function ca(a){var c=a._template;a=c.uniforms;var b=c.materials,d=c.components;if(m(d)&&m(c.source))throw new p("fabric: cannot have source and components in the same template.");Y(c,na,Q,!0);Y(d,ia,Q,!0);var c=[],e;for(e in b)b.hasOwnProperty(e)&&c.push(e);Y(a,c,S,!1)}function T(a){var c=a._template.components,b=a._template.source;if(m(b))a.shaderSource+=b+"\n";else{a.shaderSource+="czm_material czm_getMaterial(czm_materialInput materialInput)\n{\n";a.shaderSource+="czm_material material \x3d czm_getDefaultMaterial(materialInput);\n";if(m(c))for(var d in c)c.hasOwnProperty(d)&&(a.shaderSource="diffuse"===d||"emission"===d?a.shaderSource+("material."+d+" \x3d czm_gammaCorrect("+c[d]+"); \n"):"alpha"===d?a.shaderSource+("material.alpha \x3d czm_gammaCorrect(vec4(vec3(0.0), "+c.alpha+")).a; \n"):a.shaderSource+("material."+d+" \x3d "+c[d]+";\n"));a.shaderSource+="return material;\n}\n"}}function da(a){var c;return function(b,d){var e=b.uniforms,f=e[a],h=c!==f;c=f;var g=b._textures[a];if(f instanceof HTMLVideoElement)2<=f.readyState?(h&&m(g)&&(g!==d.defaultTexture&&g.destroy(),g=void 0),m(g)&&g!==d.defaultTexture?g.copyFrom(f):(g=new z({context:d,source:f}),b._textures[a]=g)):m(g)||(b._textures[a]=d.defaultTexture);else if(f instanceof z&&f!==g)b._texturePaths[a]=void 0,g=b._textures[a],g!==b._defaultTexture&&g.destroy(),b._textures[a]=f,h=a+"Dimensions",e.hasOwnProperty(h)&&(e=e[h],e.x=f._width,e.y=f._height);else if(m(g)||(b._texturePaths[a]=void 0,m(b._defaultTexture)||(b._defaultTexture=d.defaultTexture),g=b._textures[a]=b._defaultTexture,h=a+"Dimensions",e.hasOwnProperty(h)&&(e=e[h],e.x=g._width,e.y=g._height)),f!==M.DefaultImageId&&(e=f instanceof y,!m(b._texturePaths[a])||e&&f.url!==b._texturePaths[a].url||!e&&f!==b._texturePaths[a]))"string"===typeof f||e?(e=e?f:y.createIfNeeded(f),e=ha.test(f)?t(e):pa.test(f)?q(e):e.fetchImage(),W(e,function(c){b._loadedImages.push({id:a,image:c})})):(f instanceof HTMLCanvasElement||f instanceof HTMLImageElement)&&b._loadedImages.push({id:a,image:f}),b._texturePaths[a]=f}}function V(a){return function(c,b){var d=c.uniforms[a];if(d instanceof A){var e=c._textures[a];e!==c._defaultTexture&&e.destroy();c._texturePaths[a]=void 0;c._textures[a]=d}else m(c._textures[a])||(c._texturePaths[a]=void 0,c._textures[a]=b.defaultCubeMap),d!==M.DefaultCubeMapId&&(e=d.positiveX+d.negativeX+d.positiveY+d.negativeY+d.positiveZ+d.negativeZ,e!==c._texturePaths[a]&&(d=[y.createIfNeeded(d.positiveX).fetchImage(),y.createIfNeeded(d.negativeX).fetchImage(),y.createIfNeeded(d.positiveY).fetchImage(),y.createIfNeeded(d.negativeY).fetchImage(),y.createIfNeeded(d.positiveZ).fetchImage(),y.createIfNeeded(d.negativeZ).fetchImage()],W.all(d).then(function(b){c._loadedCubeMaps.push({id:a,images:b})}),c._texturePaths[a]=e))}}function ba(a){var c=a._template.uniforms,b;for(b in c)c.hasOwnProperty(b)&&X(a,b)}function X(a,c){var b=a._strict,d=a._template.uniforms,e=d[c],f=fa(e);if(!m(f))throw new p("fabric: uniform '"+c+"' has invalid type.");if("channels"===f){if(d=F(a,c,e,!1),0===d&&b)throw new p("strict: shader source does not use channels '"+c+"'.");}else{if("sampler2D"===f){var h=c+"Dimensions";0<F(a,h,h,void 0)&&(d[h]={type:"ivec3",x:1,y:1},X(a,h))}(new RegExp("uniform\\s+"+f+"\\s+"+c+"\\s*;")).test(a.shaderSource)||(a.shaderSource="uniform "+f+" "+c+";"+a.shaderSource);h=c+"_"+a._count++;d=F(a,c,h);if(1===d&&b)throw new p("strict: shader source does not use uniform '"+c+"'.");a.uniforms[c]=e;if("sampler2D"===f)a._uniforms[h]=function(){return a._textures[c]},a._updateFunctions.push(da(c));else if("samplerCube"===f)a._uniforms[h]=function(){return a._textures[c]},a._updateFunctions.push(V(c));else if(-1!==f.indexOf("mat")){var g=new la[f];a._uniforms[h]=function(){return la[f].fromColumnMajorArray(a.uniforms[c],g)}}else a._uniforms[h]=function(){return a.uniforms[c]}}}function fa(a){var c=a.type;if(!m(c)){var b=typeof a;if("number"===b)c="float";else if("boolean"===b)c="bool";else if("string"===b||a instanceof y||a instanceof HTMLCanvasElement||a instanceof HTMLImageElement)c=/^([rgba]){1,4}$/i.test(a)?"channels":a===M.DefaultCubeMapId?"samplerCube":"sampler2D";else if("object"===b)if(d(a)){if(4===a.length||9===a.length||16===a.length)c="mat"+Math.sqrt(a.length)}else{var b=0,e;for(e in a)a.hasOwnProperty(e)&&(b+=1);2<=b&&4>=b?c="vec"+b:6===b&&(c="samplerCube")}}return c}function ga(a){var c=a._strict,b=a._template.materials,d;for(d in b)if(b.hasOwnProperty(d)){var e=new M({strict:c,fabric:b[d],count:a._count});a._count=e._count;a._uniforms=k(a._uniforms,e._uniforms,!0);a.materials[d]=e;a._translucentFunctions=a._translucentFunctions.concat(e._translucentFunctions);var f="czm_getMaterial_"+a._count++;F(e,"czm_getMaterial",f);a.shaderSource=e.shaderSource+a.shaderSource;if(0===F(a,d,f+"(materialInput)")&&c)throw new p("strict: shader source does not use material '"+d+"'.");}}function F(a,c,b,d){d=l(d,!0);var e=0;a.shaderSource=a.shaderSource.replace(new RegExp("([\\w"+(d?".":"")+"])?"+c+"([\\w])?","g"),function(a,c,d){if(c||d)return a;e+=1;return b});return e}M._uniformList={};M.fromType=function(a,c){if(!m(M._materialCache.getMaterial(a)))throw new p("material with type '"+a+"' does not exist.");var b=new M({fabric:{type:a}});if(m(c))for(var d in c)c.hasOwnProperty(d)&&(b.uniforms[d]=c[d]);return b};M.prototype.isTranslucent=function(){if(m(this.translucent))return"function"===typeof this.translucent?this.translucent():this.translucent;for(var a=!0,c=this._translucentFunctions,b=c.length,d=0;d<b;++d){var e=c[d],a="function"===typeof e?a&&e():a&&e;if(!a)break}return a};M.prototype.update=function(a){var c,b,d=this._loadedImages,e=d.length;for(c=0;c<e;++c){var f=d[c];b=f.id;f=f.image;f=m(f.internalFormat)?new z({context:a,pixelFormat:f.internalFormat,width:f.width,height:f.height,source:{arrayBufferView:f.bufferView}}):new z({context:a,source:f});this._textures[b]=f;b+="Dimensions";this.uniforms.hasOwnProperty(b)&&(b=this.uniforms[b],b.x=f._width,b.y=f._height)}d.length=0;d=this._loadedCubeMaps;e=d.length;for(c=0;c<e;++c)f=d[c],b=f.id,f=f.images,f=new A({context:a,source:{positiveX:f[0],negativeX:f[1],positiveY:f[2],negativeY:f[3],positiveZ:f[4],negativeZ:f[5]}}),this._textures[b]=f;d.length=0;b=this._updateFunctions;e=b.length;for(c=0;c<e;++c)b[c](this,a);c=this.materials;for(var h in c)c.hasOwnProperty(h)&&c[h].update(a)};M.prototype.isDestroyed=function(){return!1};M.prototype.destroy=function(){var a=this._textures,c;for(c in a)if(a.hasOwnProperty(c)){var b=a[c];b!==this._defaultTexture&&b.destroy()}var a=this.materials,d;for(d in a)a.hasOwnProperty(d)&&a[d].destroy();return h(this)};var na=["type","materials","uniforms","components","source"],ia="diffuse specular shininess normal emission alpha".split(" "),la={mat2:r,mat3:c,mat4:u},ha=/\.ktx$/i,pa=/\.crn$/i;M._materialCache={_materials:{},addMaterial:function(a,c){this._materials[a]=c},getMaterial:function(a){return this._materials[a]}};M.DefaultImageId="czm_defaultImage";M.DefaultCubeMapId="czm_defaultCubeMap";M.ColorType="Color";M._materialCache.addMaterial(M.ColorType,{fabric:{type:M.ColorType,uniforms:{color:new f(1,0,0,.5)},components:{diffuse:"color.rgb",alpha:"color.a"}},translucent:function(a){return 1>a.uniforms.color.alpha}});M.ImageType="Image";M._materialCache.addMaterial(M.ImageType,{fabric:{type:M.ImageType,uniforms:{image:M.DefaultImageId,repeat:new b(1,1),color:new f(1,1,1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).rgb * color.rgb",alpha:"texture2D(image, fract(repeat * materialInput.st)).a * color.a"}},translucent:function(a){return 1>a.uniforms.color.alpha}});M.DiffuseMapType="DiffuseMap";M._materialCache.addMaterial(M.DiffuseMapType,{fabric:{type:M.DiffuseMapType,uniforms:{image:M.DefaultImageId,channels:"rgb",repeat:new b(1,1)},components:{diffuse:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1});M.AlphaMapType="AlphaMap";M._materialCache.addMaterial(M.AlphaMapType,{fabric:{type:M.AlphaMapType,uniforms:{image:M.DefaultImageId,channel:"a",repeat:new b(1,1)},components:{alpha:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!0});M.SpecularMapType="SpecularMap";M._materialCache.addMaterial(M.SpecularMapType,{fabric:{type:M.SpecularMapType,uniforms:{image:M.DefaultImageId,channel:"r",repeat:new b(1,1)},components:{specular:"texture2D(image, fract(repeat * materialInput.st)).channel"}},translucent:!1});M.EmissionMapType="EmissionMap";M._materialCache.addMaterial(M.EmissionMapType,{fabric:{type:M.EmissionMapType,uniforms:{image:M.DefaultImageId,channels:"rgb",repeat:new b(1,1)},components:{emission:"texture2D(image, fract(repeat * materialInput.st)).channels"}},translucent:!1});M.BumpMapType="BumpMap";M._materialCache.addMaterial(M.BumpMapType,{fabric:{type:M.BumpMapType,uniforms:{image:M.DefaultImageId,channel:"r",strength:.8,repeat:new b(1,1)},source:D},translucent:!1});M.NormalMapType="NormalMap";M._materialCache.addMaterial(M.NormalMapType,{fabric:{type:M.NormalMapType,uniforms:{image:M.DefaultImageId,channels:"rgb",strength:.8,repeat:new b(1,1)},source:w},translucent:!1});M.GridType="Grid";M._materialCache.addMaterial(M.GridType,{fabric:{type:M.GridType,uniforms:{color:new f(0,1,0,1),cellAlpha:.1,lineCount:new b(8,8),lineThickness:new b(1,1),lineOffset:new b(0,0)},source:J},translucent:function(a){a=a.uniforms;return 1>a.color.alpha||1>a.cellAlpha}});M.StripeType="Stripe";M._materialCache.addMaterial(M.StripeType,{fabric:{type:M.StripeType,uniforms:{horizontal:!0,evenColor:new f(1,1,1,.5),oddColor:new f(0,0,1,.5),offset:0,repeat:5},source:O},translucent:function(a){a=a.uniforms;return 1>a.evenColor.alpha||1>a.oddColor.alpha}});M.CheckerboardType="Checkerboard";M._materialCache.addMaterial(M.CheckerboardType,{fabric:{type:M.CheckerboardType,uniforms:{lightColor:new f(1,1,1,.5),darkColor:new f(0,0,0,.5),repeat:new b(5,5)},source:v},translucent:function(a){a=a.uniforms;return 1>a.lightColor.alpha||1>a.darkColor.alpha}});M.DotType="Dot";M._materialCache.addMaterial(M.DotType,{fabric:{type:M.DotType,uniforms:{lightColor:new f(1,1,0,.75),darkColor:new f(0,1,1,.75),repeat:new b(5,5)},source:B},translucent:function(a){a=a.uniforms;return 1>a.lightColor.alpha||1>a.darkColor.alpha}});M.WaterType="Water";M._materialCache.addMaterial(M.WaterType,{fabric:{type:M.WaterType,uniforms:{baseWaterColor:new f(.2,.3,.6,1),blendColor:new f(0,1,.699,1),specularMap:M.DefaultImageId,normalMap:M.DefaultImageId,frequency:10,animationSpeed:.01,amplitude:1,specularIntensity:.5,fadeFactor:1},source:Z},translucent:function(a){a=a.uniforms;return 1>a.baseWaterColor.alpha||1>a.blendColor.alpha}});M.PolylineArrowLinkType="PolylineArrowLink";M._materialCache.addMaterial(M.PolylineArrowLinkType,{fabric:{type:M.PolylineArrowLinkType,uniforms:{color:new f(1,0,0,1),image:M.DefaultImageId,time:0},source:aa},translucent:function(a){return 1>a.uniforms.color.alpha}});M.EllipsoidFadeType="EllipsoidFade";M._materialCache.addMaterial(M.EllipsoidFadeType,{fabric:{type:M.EllipsoidFadeType,uniforms:{color:new f(1,0,0,1),time:1},source:U},translucent:function(a){return 1>a.uniforms.color.alpha}});M.RimLightingType="RimLighting";M._materialCache.addMaterial(M.RimLightingType,{fabric:{type:M.RimLightingType,uniforms:{color:new f(1,0,0,.7),rimColor:new f(1,1,1,.4),width:.3},source:P},translucent:function(a){a=a.uniforms;return 1>a.color.alpha||1>a.rimColor.alpha}});M.FadeType="Fade";M._materialCache.addMaterial(M.FadeType,{fabric:{type:M.FadeType,uniforms:{fadeInColor:new f(1,0,0,1),fadeOutColor:new f(0,0,0,0),maximumDistance:.5,repeat:!0,fadeDirection:{x:!0,y:!0},time:new b(.5,.5)},source:H},translucent:function(a){a=a.uniforms;return 1>a.fadeInColor.alpha||1>a.fadeOutColor.alpha}});M.PolylineArrowType="PolylineArrow";M._materialCache.addMaterial(M.PolylineArrowType,{fabric:{type:M.PolylineArrowType,uniforms:{color:new f(1,1,1,1)},source:G},translucent:!0});M.PolylineDashType="PolylineDash";M._materialCache.addMaterial(M.PolylineDashType,{fabric:{type:M.PolylineDashType,uniforms:{color:new f(1,0,1,1),gapColor:new f(0,0,0,0),dashLength:16,dashPattern:255},source:E},translucent:!0});M.PolylineGlowType="PolylineGlow";M._materialCache.addMaterial(M.PolylineGlowType,{fabric:{type:M.PolylineGlowType,uniforms:{color:new f(0,.5,1,1),glowPower:.25,taperPower:1},source:L},translucent:!0});M.PolylineOutlineType="PolylineOutline";M._materialCache.addMaterial(M.PolylineOutlineType,{fabric:{type:M.PolylineOutlineType,uniforms:{color:new f(1,1,1,1),outlineColor:new f(1,0,0,1),outlineWidth:1},source:K},translucent:function(a){a=a.uniforms;return 1>a.color.alpha||1>a.outlineColor.alpha}});M.ElevationContourType="ElevationContour";M._materialCache.addMaterial(M.ElevationContourType,{fabric:{type:M.ElevationContourType,uniforms:{spacing:100,color:new f(1,0,0,1),width:1},source:C},translucent:!1});M.ElevationRampType="ElevationRamp";M._materialCache.addMaterial(M.ElevationRampType,{fabric:{type:M.ElevationRampType,uniforms:{image:M.DefaultImageId,minimumHeight:0,maximumHeight:1E4},source:I},translucent:!1});M.SlopeRampMaterialType="SlopeRamp";M._materialCache.addMaterial(M.SlopeRampMaterialType,{fabric:{type:M.SlopeRampMaterialType,uniforms:{image:M.DefaultImageId},source:N},translucent:!1});M.AspectRampMaterialType="AspectRamp";M._materialCache.addMaterial(M.AspectRampMaterialType,{fabric:{type:M.AspectRampMaterialType,uniforms:{image:M.DefaultImageId},source:x},translucent:!1});return M});F("Scene/MaterialAppearance","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/freezeObject ../Core/VertexFormat ../Shaders/Appearances/AllMaterialAppearanceFS ../Shaders/Appearances/AllMaterialAppearanceVS ../Shaders/Appearances/BasicMaterialAppearanceFS ../Shaders/Appearances/BasicMaterialAppearanceVS ../Shaders/Appearances/TexturedMaterialAppearanceFS ../Shaders/Appearances/TexturedMaterialAppearanceVS ./Appearance ./Material".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(c){c=b(c,b.EMPTY_OBJECT);var d=b(c.translucent,!0),e=b(c.closed,!1),f=b(c.materialSupport,r.MaterialSupport.TEXTURED);this.material=a(c.material)?c.material:t.fromType(t.ColorType);this.translucent=d;this._vertexShaderSource=b(c.vertexShaderSource,f.vertexShaderSource);this._fragmentShaderSource=b(c.fragmentShaderSource,f.fragmentShaderSource);this._renderState=q.getDefaultRenderState(d,e,c.renderState);this._closed=e;this._materialSupport=f;this._vertexFormat=f.vertexFormat;this._flat=b(c.flat,!1);this._faceForward=b(c.faceForward,!e)}f(r.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},materialSupport:{get:function(){return this._materialSupport}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}});r.prototype.getFragmentShaderSource=q.prototype.getFragmentShaderSource;r.prototype.isTranslucent=q.prototype.isTranslucent;r.prototype.getRenderState=q.prototype.getRenderState;r.MaterialSupport={BASIC:k({vertexFormat:g.POSITION_AND_NORMAL,vertexShaderSource:h,fragmentShaderSource:e}),TEXTURED:k({vertexFormat:g.POSITION_NORMAL_AND_ST,vertexShaderSource:d,fragmentShaderSource:p}),ALL:k({vertexFormat:g.ALL,vertexShaderSource:m,fragmentShaderSource:l})};return r});F("Shaders/Appearances/PerInstanceColorAppearanceFS",[],function(){return"varying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec3 positionToEyeEC \x3d -v_positionEC;\nvec3 normalEC \x3d normalize(v_normalEC);\n#ifdef FACE_FORWARD\nnormalEC \x3d faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nvec4 color \x3d czm_gammaCorrect(v_color);\nczm_materialInput materialInput;\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.positionToEyeEC \x3d positionToEyeEC;\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nmaterial.diffuse \x3d color.rgb;\nmaterial.alpha \x3d color.a;\ngl_FragColor \x3d czm_phong(normalize(positionToEyeEC), material);\n}\n"});F("Shaders/Appearances/PerInstanceColorAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p \x3d czm_computePosition();\nv_positionEC \x3d (czm_modelViewRelativeToEye * p).xyz;\nv_normalEC \x3d czm_normal * normal;\nv_color \x3d color;\ngl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}\n"});F("Shaders/Appearances/PerInstanceFlatColorAppearanceFS",[],function(){return"varying vec4 v_color;\nvoid main()\n{\ngl_FragColor \x3d czm_gammaCorrect(v_color);\n}\n"});F("Shaders/Appearances/PerInstanceFlatColorAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nvec4 p \x3d czm_computePosition();\nv_color \x3d color;\ngl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}\n"});F("Scene/PerInstanceColorAppearance","../Core/defaultValue ../Core/defineProperties ../Core/VertexFormat ../Shaders/Appearances/PerInstanceColorAppearanceFS ../Shaders/Appearances/PerInstanceColorAppearanceVS ../Shaders/Appearances/PerInstanceFlatColorAppearanceFS ../Shaders/Appearances/PerInstanceFlatColorAppearanceVS ./Appearance".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=b(a,b.EMPTY_OBJECT);var d=b(a.translucent,!0),f=b(a.closed,!1),p=b(a.flat,!1),r=p?m:g,c=p?l:k,u=p?h.FLAT_VERTEX_FORMAT:h.VERTEX_FORMAT;this.material=void 0;this.translucent=d;this._vertexShaderSource=b(a.vertexShaderSource,r);this._fragmentShaderSource=b(a.fragmentShaderSource,c);this._renderState=e.getDefaultRenderState(d,f,a.renderState);this._closed=f;this._vertexFormat=u;this._flat=p;this._faceForward=b(a.faceForward,!f)}a(h.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}});h.VERTEX_FORMAT=f.POSITION_AND_NORMAL;h.FLAT_VERTEX_FORMAT=f.POSITION_ONLY;h.prototype.getFragmentShaderSource=e.prototype.getFragmentShaderSource;h.prototype.isTranslucent=e.prototype.isTranslucent;h.prototype.getRenderState=e.prototype.getRenderState;return h});F("DataSources/CallbackProperty",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/Event"],function(b,a,f,k){function g(a,b){this._isConstant=this._callback=void 0;this._definitionChanged=new k;this.setCallback(a,b)}a(g.prototype,{isConstant:{get:function(){return this._isConstant}},definitionChanged:{get:function(){return this._definitionChanged}}});g.prototype.getValue=function(a,b){return this._callback(a,b)};g.prototype.setCallback=function(a,g){if(!b(a))throw new f("callback is required.");if(!b(g))throw new f("isConstant is required.");var e=this._callback!==a||this._isConstant!==g;this._callback=a;this._isConstant=g;e&&this._definitionChanged.raiseEvent(this)};g.prototype.equals=function(a){return this===a||a instanceof g&&this._callback===a._callback&&this._isConstant===a._isConstant};return g});F("Scene/ClassificationType",["../Core/freezeObject"],function(b){return b({TERRAIN:0,CESIUM_3D_TILE:1,BOTH:2,NUMBER_OF_CLASSIFICATION_TYPES:3})});F("Scene/ShadowMode",["../Core/freezeObject"],function(b){var a={DISABLED:0,ENABLED:1,CAST_ONLY:2,RECEIVE_ONLY:3,NUMBER_OF_SHADOW_MODES:4,castShadows:function(b){return b===a.ENABLED||b===a.CAST_ONLY},receiveShadows:function(b){return b===a.ENABLED||b===a.RECEIVE_ONLY},fromCastReceive:function(b,k){return b&&k?a.ENABLED:b?a.CAST_ONLY:k?a.RECEIVE_ONLY:a.DISABLED}};return b(a)});F("DataSources/ColorMaterialProperty","../Core/Color ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l){function m(a){this._definitionChanged=new k;this._colorSubscription=this._color=void 0;this.color=a}f(m.prototype,{isConstant:{get:function(){return l.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:g("color")});m.prototype.getType=function(a){return"Color"};m.prototype.getValue=function(e,f){a(f)||(f={});f.color=l.getValueOrClonedDefault(this._color,e,b.WHITE,f.color);return f};m.prototype.equals=function(a){return this===a||a instanceof m&&l.equals(this._color,a._color)};return m});F("Renderer/DrawCommand",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/PrimitiveType"],function(b,a,f,k){function g(a){a=b(a,b.EMPTY_OBJECT);this._boundingVolume=a.boundingVolume;this._orientedBoundingBox=a.orientedBoundingBox;this._cull=b(a.cull,!0);this._occlude=b(a.occlude,!0);this._modelMatrix=a.modelMatrix;this._primitiveType=b(a.primitiveType,k.TRIANGLES);this._vertexArray=a.vertexArray;this._count=a.count;this._offset=b(a.offset,0);this._instanceCount=b(a.instanceCount,0);this._shaderProgram=a.shaderProgram;this._uniformMap=a.uniformMap;this._renderState=a.renderState;this._framebuffer=a.framebuffer;this._pass=a.pass;this._executeInClosestFrustum=b(a.executeInClosestFrustum,!1);this._owner=a.owner;this._debugShowBoundingVolume=b(a.debugShowBoundingVolume,!1);this._debugOverlappingFrustums=0;this._castShadows=b(a.castShadows,!1);this._receiveShadows=b(a.receiveShadows,!1);this._pickId=a.pickId;this._pickOnly=b(a.pickOnly,!1);this.dirty=!0;this.lastDirtyTime=0;this.derivedCommands={}}f(g.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(a){this._boundingVolume!==a&&(this._boundingVolume=a,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(a){this._orientedBoundingBox!==a&&(this._orientedBoundingBox=a,this.dirty=!0)}},cull:{get:function(){return this._cull},set:function(a){this._cull!==a&&(this._cull=a,this.dirty=!0)}},occlude:{get:function(){return this._occlude},set:function(a){this._occlude!==a&&(this._occlude=a,this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(a){this._modelMatrix!==a&&(this._modelMatrix=a,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(a){this._primitiveType!==a&&(this._primitiveType=a,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(a){this._vertexArray!==a&&(this._vertexArray=a,this.dirty=!0)}},count:{get:function(){return this._count},set:function(a){this._count!==a&&(this._count=a,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(a){this._offset!==a&&(this._offset=a,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(a){this._instanceCount!==a&&(this._instanceCount=a,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(a){this._shaderProgram!==a&&(this._shaderProgram=a,this.dirty=!0)}},castShadows:{get:function(){return this._castShadows},set:function(a){this._castShadows!==a&&(this._castShadows=a,this.dirty=!0)}},receiveShadows:{get:function(){return this._receiveShadows},set:function(a){this._receiveShadows!==a&&(this._receiveShadows=a,this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(a){this._uniformMap!==a&&(this._uniformMap=a,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(a){this._renderState!==a&&(this._renderState=a,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(a){this._framebuffer!==a&&(this._framebuffer=a,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(a){this._pass!==a&&(this._pass=a,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return this._executeInClosestFrustum},set:function(a){this._executeInClosestFrustum!==a&&(this._executeInClosestFrustum=a,this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(a){this._owner!==a&&(this._owner=a,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(a){this._debugShowBoundingVolume!==a&&(this._debugShowBoundingVolume=a,this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(a){this._debugOverlappingFrustums!==a&&(this._debugOverlappingFrustums=a,this.dirty=!0)}},pickId:{get:function(){return this._pickId},set:function(a){this._pickId!==a&&(this._pickId=a,this.dirty=!0)}},pickOnly:{get:function(){return this._pickOnly},set:function(a){this._pickOnly!==a&&(this._pickOnly=a,this.dirty=!0)}}});g.shallowClone=function(b,f){if(a(b))return a(f)||(f=new g),f._boundingVolume=b._boundingVolume,f._orientedBoundingBox=b._orientedBoundingBox,f._cull=b._cull,f._occlude=b._occlude,f._modelMatrix=b._modelMatrix,f._primitiveType=b._primitiveType,f._vertexArray=b._vertexArray,f._count=b._count,f._offset=b._offset,f._instanceCount=b._instanceCount,f._shaderProgram=b._shaderProgram,f._uniformMap=b._uniformMap,f._renderState=b._renderState,f._framebuffer=b._framebuffer,f._pass=b._pass,f._executeInClosestFrustum=b._executeInClosestFrustum,f._owner=b._owner,f._debugShowBoundingVolume=b._debugShowBoundingVolume,f._debugOverlappingFrustums=b._debugOverlappingFrustums,f._castShadows=b._castShadows,f._receiveShadows=b._receiveShadows,f._pickId=b._pickId,f._pickOnly=b._pickOnly,f.dirty=!0,f.lastDirtyTime=0,f};g.prototype.execute=function(a,b){a.draw(this,b)};return g});F("Renderer/Pass",["../Core/freezeObject"],function(b){return b({ENVIRONMENT:0,COMPUTE:1,GLOBE:2,TERRAIN_CLASSIFICATION:3,CESIUM_3D_TILE:4,CESIUM_3D_TILE_CLASSIFICATION:5,CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW:6,OPAQUE:7,TRANSLUCENT:8,OVERLAY:9,NUMBER_OF_PASSES:10})});F("Renderer/freezeRenderState",["../Core/freezeObject"],function(b){function a(f){if("object"!==typeof f||null===f)return f;for(var k,g=Object.keys(f),l=0;l<g.length;l++)k=g[l],f.hasOwnProperty(k)&&"_applyFunctions"!==k&&(f[k]=a(f[k]));return b(f)}return a});F("Renderer/RenderState","../Core/BoundingRectangle ../Core/Color ../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Core/WebGLConstants ../Core/WindingOrder ./ContextLimits ./freezeRenderState".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a){return a===l.FUNC_ADD||a===l.FUNC_SUBTRACT||a===l.FUNC_REVERSE_SUBTRACT||a===l.MIN||a===l.MAX}function d(a){return a===l.ZERO||a===l.ONE||a===l.SRC_COLOR||a===l.ONE_MINUS_SRC_COLOR||a===l.DST_COLOR||a===l.ONE_MINUS_DST_COLOR||a===l.SRC_ALPHA||a===l.ONE_MINUS_SRC_ALPHA||a===l.DST_ALPHA||a===l.ONE_MINUS_DST_ALPHA||a===l.CONSTANT_COLOR||a===l.ONE_MINUS_CONSTANT_COLOR||a===l.CONSTANT_ALPHA||a===l.ONE_MINUS_CONSTANT_ALPHA||a===l.SRC_ALPHA_SATURATE}function q(a){return a===l.NEVER||a===l.LESS||a===l.EQUAL||a===l.LEQUAL||a===l.GREATER||a===l.NOTEQUAL||a===l.GEQUAL||a===l.ALWAYS}function t(a){return a===l.ZERO||a===l.KEEP||a===l.REPLACE||a===l.INCR||a===l.DECR||a===l.INVERT||a===l.INCR_WRAP||a===l.DECR_WRAP}function r(c){c=f(c,{});var h=f(c.cull,{}),v=f(c.polygonOffset,{}),w=f(c.scissorTest,{}),r=f(w.rectangle,{}),u=f(c.depthRange,{}),y=f(c.depthTest,{}),B=f(c.colorMask,{}),C=f(c.blending,{}),z=f(C.color,{}),A=f(c.stencilTest,{}),D=f(A.frontOperation,{}),E=f(A.backOperation,{}),x=f(c.sampleCoverage,{}),G=c.viewport;this.frontFace=f(c.frontFace,m.COUNTER_CLOCKWISE);this.cull={enabled:f(h.enabled,!1),face:f(h.face,l.BACK)};this.lineWidth=f(c.lineWidth,1);this.polygonOffset={enabled:f(v.enabled,!1),factor:f(v.factor,0),units:f(v.units,0)};this.scissorTest={enabled:f(w.enabled,!1),rectangle:b.clone(r)};this.depthRange={near:f(u.near,0),far:f(u.far,1)};this.depthTest={enabled:f(y.enabled,!1),func:f(y.func,l.LESS)};this.colorMask={red:f(B.red,!0),green:f(B.green,!0),blue:f(B.blue,!0),alpha:f(B.alpha,!0)};this.depthMask=f(c.depthMask,!0);this.stencilMask=f(c.stencilMask,-1);this.blending={enabled:f(C.enabled,!1),color:new a(f(z.red,0),f(z.green,0),f(z.blue,0),f(z.alpha,0)),equationRgb:f(C.equationRgb,l.FUNC_ADD),equationAlpha:f(C.equationAlpha,l.FUNC_ADD),functionSourceRgb:f(C.functionSourceRgb,l.ONE),functionSourceAlpha:f(C.functionSourceAlpha,l.ONE),functionDestinationRgb:f(C.functionDestinationRgb,l.ZERO),functionDestinationAlpha:f(C.functionDestinationAlpha,l.ZERO)};this.stencilTest={enabled:f(A.enabled,!1),frontFunction:f(A.frontFunction,l.ALWAYS),backFunction:f(A.backFunction,l.ALWAYS),reference:f(A.reference,0),mask:f(A.mask,-1),frontOperation:{fail:f(D.fail,l.KEEP),zFail:f(D.zFail,l.KEEP),zPass:f(D.zPass,l.KEEP)},backOperation:{fail:f(E.fail,l.KEEP),zFail:f(E.zFail,l.KEEP),zPass:f(E.zPass,l.KEEP)}};this.sampleCoverage={enabled:f(x.enabled,!1),value:f(x.value,1),invert:f(x.invert,!1)};this.viewport=k(G)?new b(G.x,G.y,G.width,G.height):void 0;if(this.lineWidth<e.minimumAliasedLineWidth||this.lineWidth>e.maximumAliasedLineWidth)throw new g("renderState.lineWidth is out of range.  Check minimumAliasedLineWidth and maximumAliasedLineWidth.");if(!m.validate(this.frontFace))throw new g("Invalid renderState.frontFace.");c=this.cull.face;if(c!==l.FRONT&&c!==l.BACK&&c!==l.FRONT_AND_BACK)throw new g("Invalid renderState.cull.face.");if(0>this.scissorTest.rectangle.width||0>this.scissorTest.rectangle.height)throw new g("renderState.scissorTest.rectangle.width and renderState.scissorTest.rectangle.height must be greater than or equal to zero.");if(this.depthRange.near>this.depthRange.far)throw new g("renderState.depthRange.near can not be greater than renderState.depthRange.far.");if(0>this.depthRange.near)throw new g("renderState.depthRange.near must be greater than or equal to zero.");if(1<this.depthRange.far)throw new g("renderState.depthRange.far must be less than or equal to one.");c=this.depthTest.func;if(c!==l.NEVER&&c!==l.LESS&&c!==l.EQUAL&&c!==l.LEQUAL&&c!==l.GREATER&&c!==l.NOTEQUAL&&c!==l.GEQUAL&&c!==l.ALWAYS)throw new g("Invalid renderState.depthTest.func.");if(0>this.blending.color.red||1<this.blending.color.red||0>this.blending.color.green||1<this.blending.color.green||0>this.blending.color.blue||1<this.blending.color.blue||0>this.blending.color.alpha||1<this.blending.color.alpha)throw new g("renderState.blending.color components must be greater than or equal to zero and less than or equal to one.");if(!p(this.blending.equationRgb))throw new g("Invalid renderState.blending.equationRgb.");if(!p(this.blending.equationAlpha))throw new g("Invalid renderState.blending.equationAlpha.");if(!d(this.blending.functionSourceRgb))throw new g("Invalid renderState.blending.functionSourceRgb.");if(!d(this.blending.functionSourceAlpha))throw new g("Invalid renderState.blending.functionSourceAlpha.");if(!d(this.blending.functionDestinationRgb))throw new g("Invalid renderState.blending.functionDestinationRgb.");if(!d(this.blending.functionDestinationAlpha))throw new g("Invalid renderState.blending.functionDestinationAlpha.");if(!q(this.stencilTest.frontFunction))throw new g("Invalid renderState.stencilTest.frontFunction.");if(!q(this.stencilTest.backFunction))throw new g("Invalid renderState.stencilTest.backFunction.");if(!t(this.stencilTest.frontOperation.fail))throw new g("Invalid renderState.stencilTest.frontOperation.fail.");if(!t(this.stencilTest.frontOperation.zFail))throw new g("Invalid renderState.stencilTest.frontOperation.zFail.");if(!t(this.stencilTest.frontOperation.zPass))throw new g("Invalid renderState.stencilTest.frontOperation.zPass.");if(!t(this.stencilTest.backOperation.fail))throw new g("Invalid renderState.stencilTest.backOperation.fail.");if(!t(this.stencilTest.backOperation.zFail))throw new g("Invalid renderState.stencilTest.backOperation.zFail.");if(!t(this.stencilTest.backOperation.zPass))throw new g("Invalid renderState.stencilTest.backOperation.zPass.");if(k(this.viewport)){if(0>this.viewport.width)throw new g("renderState.viewport.width must be greater than or equal to zero.");if(0>this.viewport.height)throw new g("renderState.viewport.height must be greater than or equal to zero.");if(this.viewport.width>e.maximumViewportWidth)throw new g("renderState.viewport.width must be less than or equal to the maximum viewport width ("+e.maximumViewportWidth.toString()+").  Check maximumViewportWidth.");if(this.viewport.height>e.maximumViewportHeight)throw new g("renderState.viewport.height must be less than or equal to the maximum viewport height ("+e.maximumViewportHeight.toString()+").  Check maximumViewportHeight.");}this.id=0;this._applyFunctions=[]}function c(a,c,b){b?a.enable(c):a.disable(c)}function u(a,c){a.frontFace(c.frontFace)}function y(a,b){var d=b.cull,e=d.enabled;c(a,a.CULL_FACE,e);e&&a.cullFace(d.face)}function A(a,c){a.lineWidth(c.lineWidth)}function z(a,b){var d=b.polygonOffset,e=d.enabled;c(a,a.POLYGON_OFFSET_FILL,e);e&&a.polygonOffset(d.factor,d.units)}function x(a,b,d){b=b.scissorTest;var e=k(d.scissorTest)?d.scissorTest.enabled:b.enabled;c(a,a.SCISSOR_TEST,e);e&&(d=k(d.scissorTest)?d.scissorTest.rectangle:b.rectangle,a.scissor(d.x,d.y,d.width,d.height))}function D(a,c){var b=c.depthRange;a.depthRange(b.near,b.far)}function v(a,b){var d=b.depthTest,e=d.enabled;c(a,a.DEPTH_TEST,e);e&&a.depthFunc(d.func)}function B(a,c){var b=c.colorMask;a.colorMask(b.red,b.green,b.blue,b.alpha)}function C(a,c){a.depthMask(c.depthMask)}function I(a,c){a.stencilMask(c.stencilMask)}function H(a,b,d){b=b.blending;d=k(d.blendingEnabled)?d.blendingEnabled:b.enabled;c(a,a.BLEND,d);d&&(d=b.color,a.blendColor(d.red,d.green,d.blue,d.alpha),a.blendEquationSeparate(b.equationRgb,b.equationAlpha),a.blendFuncSeparate(b.functionSourceRgb,b.functionDestinationRgb,b.functionSourceAlpha,b.functionDestinationAlpha))}function J(a,b){var d=b.stencilTest,e=d.enabled;c(a,a.STENCIL_TEST,e);if(e){var e=d.frontFunction,f=d.backFunction,h=d.reference,g=d.mask;a.stencilFunc(e,h,g);a.stencilFuncSeparate(a.BACK,f,h,g);a.stencilFuncSeparate(a.FRONT,e,h,g);e=d.frontOperation;a.stencilOpSeparate(a.FRONT,e.fail,e.zFail,e.zPass);d=d.backOperation;a.stencilOpSeparate(a.BACK,d.fail,d.zFail,d.zPass)}}function w(a,b){var d=b.sampleCoverage,e=d.enabled;c(a,a.SAMPLE_COVERAGE,e);e&&a.sampleCoverage(d.value,d.invert)}function G(a,c,b){c=f(c.viewport,b.viewport);k(c)||(c=K,c.width=b.context.drawingBufferWidth,c.height=b.context.drawingBufferHeight);b.context.uniformState.viewport=c;a.viewport(c.x,c.y,c.width,c.height)}var E=0,L={};r.fromCache=function(a){var c=JSON.stringify(a),b=L[c];if(k(b))return++b.referenceCount,b.state;a=new r(a);var d=JSON.stringify(a),b=L[d];k(b)||(a.id=E++,a=h(a),b={referenceCount:0,state:a},L[d]=b);++b.referenceCount;L[c]={referenceCount:1,state:b.state};return b.state};r.removeFromCache=function(a){var c=new r(a),c=JSON.stringify(c),b=L[c];a=JSON.stringify(a);var d=L[a];k(d)&&(--d.referenceCount,0===d.referenceCount&&(delete L[a],k(b)&&--b.referenceCount));k(b)&&0===b.referenceCount&&delete L[c]};r.getCache=function(){return L};r.clearCache=function(){L={}};var K=new b;r.apply=function(a,c,b){u(a,c);y(a,c);A(a,c);z(a,c);D(a,c);v(a,c);B(a,c);C(a,c);I(a,c);J(a,c);w(a,c);x(a,c,b);H(a,c,b);G(a,c,b)};r.partialApply=function(a,c,b,d,e,f){if(c!==b){var h=b._applyFunctions[c.id];k(h)||(h=[],c.frontFace!==b.frontFace&&h.push(u),c.cull.enabled===b.cull.enabled&&c.cull.face===b.cull.face||h.push(y),c.lineWidth!==b.lineWidth&&h.push(A),c.polygonOffset.enabled===b.polygonOffset.enabled&&c.polygonOffset.factor===b.polygonOffset.factor&&c.polygonOffset.units===b.polygonOffset.units||h.push(z),c.depthRange.near===b.depthRange.near&&c.depthRange.far===b.depthRange.far||h.push(D),c.depthTest.enabled===b.depthTest.enabled&&c.depthTest.func===b.depthTest.func||h.push(v),c.colorMask.red===b.colorMask.red&&c.colorMask.green===b.colorMask.green&&c.colorMask.blue===b.colorMask.blue&&c.colorMask.alpha===b.colorMask.alpha||h.push(B),c.depthMask!==b.depthMask&&h.push(C),c.stencilMask!==b.stencilMask&&h.push(I),c.stencilTest.enabled===b.stencilTest.enabled&&c.stencilTest.frontFunction===b.stencilTest.frontFunction&&c.stencilTest.backFunction===b.stencilTest.backFunction&&c.stencilTest.reference===b.stencilTest.reference&&c.stencilTest.mask===b.stencilTest.mask&&c.stencilTest.frontOperation.fail===b.stencilTest.frontOperation.fail&&c.stencilTest.frontOperation.zFail===b.stencilTest.frontOperation.zFail&&c.stencilTest.backOperation.fail===b.stencilTest.backOperation.fail&&c.stencilTest.backOperation.zFail===b.stencilTest.backOperation.zFail&&c.stencilTest.backOperation.zPass===b.stencilTest.backOperation.zPass||h.push(J),c.sampleCoverage.enabled===b.sampleCoverage.enabled&&c.sampleCoverage.value===b.sampleCoverage.value&&c.sampleCoverage.invert===b.sampleCoverage.invert||h.push(w),b._applyFunctions[c.id]=h);for(var g=h.length,l=0;l<g;++l)h[l](a,b)}h=k(d.scissorTest)?d.scissorTest:c.scissorTest;g=k(e.scissorTest)?e.scissorTest:b.scissorTest;(h!==g||f)&&x(a,b,e);f=k(d.blendingEnabled)?d.blendingEnabled:c.blending.enabled;h=k(e.blendingEnabled)?e.blendingEnabled:b.blending.enabled;(f!==h||h&&c.blending!==b.blending)&&H(a,b,e);c===b&&d===e&&d.context===e.context||G(a,b,e)};r.getState=function(c){if(!k(c))throw new g("renderState is required.");return{frontFace:c.frontFace,cull:{enabled:c.cull.enabled,face:c.cull.face},lineWidth:c.lineWidth,polygonOffset:{enabled:c.polygonOffset.enabled,factor:c.polygonOffset.factor,units:c.polygonOffset.units},scissorTest:{enabled:c.scissorTest.enabled,rectangle:b.clone(c.scissorTest.rectangle)},depthRange:{near:c.depthRange.near,far:c.depthRange.far},depthTest:{enabled:c.depthTest.enabled,func:c.depthTest.func},colorMask:{red:c.colorMask.red,green:c.colorMask.green,blue:c.colorMask.blue,alpha:c.colorMask.alpha},depthMask:c.depthMask,stencilMask:c.stencilMask,blending:{enabled:c.blending.enabled,color:a.clone(c.blending.color),equationRgb:c.blending.equationRgb,equationAlpha:c.blending.equationAlpha,functionSourceRgb:c.blending.functionSourceRgb,functionSourceAlpha:c.blending.functionSourceAlpha,functionDestinationRgb:c.blending.functionDestinationRgb,functionDestinationAlpha:c.blending.functionDestinationAlpha},stencilTest:{enabled:c.stencilTest.enabled,frontFunction:c.stencilTest.frontFunction,backFunction:c.stencilTest.backFunction,reference:c.stencilTest.reference,mask:c.stencilTest.mask,frontOperation:{fail:c.stencilTest.frontOperation.fail,zFail:c.stencilTest.frontOperation.zFail,zPass:c.stencilTest.frontOperation.zPass},backOperation:{fail:c.stencilTest.backOperation.fail,zFail:c.stencilTest.backOperation.zFail,zPass:c.stencilTest.backOperation.zPass}},sampleCoverage:{enabled:c.sampleCoverage.enabled,value:c.sampleCoverage.value,invert:c.sampleCoverage.invert},viewport:k(c.viewport)?b.clone(c.viewport):void 0}};return r});F("Renderer/AutomaticUniforms",["../Core/Cartesian3","../Core/Math","../Core/Matrix4","../Core/WebGLConstants"],function(b,a,f,k){function g(a){this._size=a.size;this._datatype=a.datatype;this.getValue=a.getValue}var l=new b;if("undefined"===typeof WebGLRenderingContext)return{};var m={};m[k.FLOAT]="float";m[k.FLOAT_VEC2]="vec2";m[k.FLOAT_VEC3]="vec3";m[k.FLOAT_VEC4]="vec4";m[k.INT]="int";m[k.INT_VEC2]="ivec2";m[k.INT_VEC3]="ivec3";m[k.INT_VEC4]="ivec4";m[k.BOOL]="bool";m[k.BOOL_VEC2]="bvec2";m[k.BOOL_VEC3]="bvec3";m[k.BOOL_VEC4]="bvec4";m[k.FLOAT_MAT2]="mat2";m[k.FLOAT_MAT3]="mat3";m[k.FLOAT_MAT4]="mat4";m[k.SAMPLER_2D]="sampler2D";m[k.SAMPLER_CUBE]="samplerCube";g.prototype.getDeclaration=function(a){a="uniform "+m[this._datatype]+" "+a;var b=this._size;return a=1===b?a+";":a+("["+b.toString()+"];")};return{czm_viewport:new g({size:1,datatype:k.FLOAT_VEC4,getValue:function(a){return a.viewportCartesian4}}),czm_viewportOrthographic:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.viewportOrthographic}}),czm_viewportTransformation:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.viewportTransformation}}),czm_globeDepthTexture:new g({size:1,datatype:k.SAMPLER_2D,getValue:function(a){return a.globeDepthTexture}}),czm_model:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.model}}),czm_inverseModel:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseModel}}),czm_view:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.view}}),czm_view3D:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.view3D}}),czm_viewRotation:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.viewRotation}}),czm_viewRotation3D:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.viewRotation3D}}),czm_inverseView:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseView}}),czm_inverseView3D:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseView3D}}),czm_inverseViewRotation:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.inverseViewRotation}}),czm_inverseViewRotation3D:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.inverseViewRotation3D}}),czm_projection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.projection}}),czm_inverseProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseProjection}}),czm_infiniteProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.infiniteProjection}}),czm_modelView:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.modelView}}),czm_modelView3D:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.modelView3D}}),czm_modelViewRelativeToEye:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.modelViewRelativeToEye}}),czm_inverseModelView:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseModelView}}),czm_inverseModelView3D:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseModelView3D}}),czm_viewProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.viewProjection}}),czm_inverseViewProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseViewProjection}}),czm_modelViewProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.modelViewProjection}}),czm_inverseModelViewProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.inverseModelViewProjection}}),czm_modelViewProjectionRelativeToEye:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.modelViewProjectionRelativeToEye}}),czm_modelViewInfiniteProjection:new g({size:1,datatype:k.FLOAT_MAT4,getValue:function(a){return a.modelViewInfiniteProjection}}),czm_orthographicIn3D:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.orthographicIn3D?1:0}}),czm_normal:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.normal}}),czm_normal3D:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.normal3D}}),czm_inverseNormal:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.inverseNormal}}),czm_inverseNormal3D:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.inverseNormal3D}}),czm_eyeHeight2D:new g({size:1,datatype:k.FLOAT_VEC2,getValue:function(a){return a.eyeHeight2D}}),czm_entireFrustum:new g({size:1,datatype:k.FLOAT_VEC2,getValue:function(a){return a.entireFrustum}}),czm_currentFrustum:new g({size:1,datatype:k.FLOAT_VEC2,getValue:function(a){return a.currentFrustum}}),czm_frustumPlanes:new g({size:1,datatype:k.FLOAT_VEC4,getValue:function(a){return a.frustumPlanes}}),czm_log2FarDistance:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.log2FarDistance}}),czm_log2FarPlusOne:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.log2FarPlusOne}}),czm_log2NearDistance:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.log2NearDistance}}),czm_sunPositionWC:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.sunPositionWC}}),czm_sunPositionColumbusView:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.sunPositionColumbusView}}),czm_sunDirectionEC:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.sunDirectionEC}}),czm_sunDirectionWC:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.sunDirectionWC}}),czm_moonDirectionEC:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.moonDirectionEC}}),czm_encodedCameraPositionMCHigh:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.encodedCameraPositionMCHigh}}),czm_encodedCameraPositionMCLow:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.encodedCameraPositionMCLow}}),czm_viewerPositionWC:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return f.getTranslation(a.inverseView,l)}}),czm_frameNumber:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.frameState.frameNumber}}),czm_morphTime:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.frameState.morphTime}}),czm_sceneMode:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.frameState.mode}}),czm_pass:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.pass}}),czm_backgroundColor:new g({size:1,datatype:k.FLOAT_VEC4,getValue:function(a){return a.backgroundColor}}),czm_brdfLut:new g({size:1,datatype:k.SAMPLER_2D,getValue:function(a){return a.brdfLut}}),czm_environmentMap:new g({size:1,datatype:k.SAMPLER_CUBE,getValue:function(a){return a.environmentMap}}),czm_specularEnvironmentMaps:new g({size:1,datatype:k.SAMPLER_2D,getValue:function(a){return a.specularEnvironmentMaps}}),czm_specularEnvironmentMapSize:new g({size:1,datatype:k.FLOAT_VEC2,getValue:function(a){return a.specularEnvironmentMapsDimensions}}),czm_specularEnvironmentMapsMaximumLOD:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.specularEnvironmentMapsMaximumLOD}}),czm_sphericalHarmonicCoefficients:new g({size:9,datatype:k.FLOAT_VEC3,getValue:function(a){return a.sphericalHarmonicCoefficients}}),czm_temeToPseudoFixed:new g({size:1,datatype:k.FLOAT_MAT3,getValue:function(a){return a.temeToPseudoFixedMatrix}}),czm_resolutionScale:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.resolutionScale}}),czm_fogDensity:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.fogDensity}}),czm_imagerySplitPosition:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.imagerySplitPosition}}),czm_geometricToleranceOverMeter:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.geometricToleranceOverMeter}}),czm_minimumDisableDepthTestDistance:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.minimumDisableDepthTestDistance}}),czm_invertClassificationColor:new g({size:1,datatype:k.FLOAT_VEC4,getValue:function(a){return a.invertClassificationColor}}),czm_gamma:new g({size:1,datatype:k.FLOAT,getValue:function(a){return a.gamma}}),czm_texWindU:new g({size:1,datatype:k.SAMPLER_2D,getValue:function(a){return a.windField.texWindU}}),czm_texWindV:new g({size:1,datatype:k.SAMPLER_2D,getValue:function(a){return a.windField.texWindV}}),czm_nightLightTexture:new g({size:1,datatype:k.SAMPLER_2D,getValue:function(a){return a.nightLightMap}}),czm_sunColor:new g({size:1,datatype:k.FLOAT_VEC3,getValue:function(a){return a.sunColor}})}});F("Renderer/createUniform","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Color ../Core/defined ../Core/DeveloperError ../Core/FeatureDetection ../Core/Matrix2 ../Core/Matrix3 ../Core/Matrix4 ../Core/RuntimeError".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a,c,b,d){this.name=b;this.value=void 0;this._value=0;this._gl=a;this._location=d}function t(a,c,d,e){this.name=d;this.value=void 0;this._value=new b;this._gl=a;this._location=e}function r(a,c,b,d){this.name=b;this._value=this.value=void 0;this._gl=a;this._location=d}function c(a,c,b,d){this.name=b;this._value=this.value=void 0;this._gl=a;this._location=d}function u(a,c,b,d){this.name=b;this.value=void 0;this._gl=a;this._location=d;this.textureUnitIndex=void 0}function y(a,c,b,d){this.name=b;this.value=void 0;this._value=0;this._gl=a;this._location=d}function A(a,c,d,e){this.name=d;this.value=void 0;this._value=new b;this._gl=a;this._location=e}function z(c,b,d,e){this.name=d;this.value=void 0;this._value=new a;this._gl=c;this._location=e}function x(a,c,b,d){this.name=b;this.value=void 0;this._value=new f;this._gl=a;this._location=d}function D(a,c,b,d){this.name=b;this.value=void 0;this._value=new e;this._gl=a;this._location=d}function v(a,c,b,d){this.name=b;this.value=void 0;this._value=new h;this._gl=a;this._location=d}function B(a,c,b,d){this.name=b;this.value=void 0;this._value=new p;this._gl=a;this._location=d}if(!m.supportsTypedArrays())return{};q.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1f(this._location,this.value))};t.prototype.set=function(){var a=this.value;b.equals(a,this._value)||(b.clone(a,this._value),this._gl.uniform2f(this._location,a.x,a.y))};r.prototype.set=function(){var c=this.value;if(g(c.red))k.equals(c,this._value)||(this._value=k.clone(c,this._value),this._gl.uniform3f(this._location,c.red,c.green,c.blue));else if(g(c.x))a.equals(c,this._value)||(this._value=a.clone(c,this._value),this._gl.uniform3f(this._location,c.x,c.y,c.z));else throw new l('Invalid vec3 value for uniform "'+this.name+'".');};c.prototype.set=function(){var a=this.value;if(g(a.red))k.equals(a,this._value)||(this._value=k.clone(a,this._value),this._gl.uniform4f(this._location,a.red,a.green,a.blue,a.alpha));else if(g(a.x))f.equals(a,this._value)||(this._value=f.clone(a,this._value),this._gl.uniform4f(this._location,a.x,a.y,a.z,a.w));else throw new l('Invalid vec4 value for uniform "'+this.name+'".');};u.prototype.set=function(){var a=this._gl;a.activeTexture(a.TEXTURE0+this.textureUnitIndex);var c=this.value;a.bindTexture(c._target,c._texture)};u.prototype._setSampler=function(a){this.textureUnitIndex=a;this._gl.uniform1i(this._location,a);return a+1};y.prototype.set=function(){this.value!==this._value&&(this._value=this.value,this._gl.uniform1i(this._location,this.value))};A.prototype.set=function(){var a=this.value;b.equals(a,this._value)||(b.clone(a,this._value),this._gl.uniform2i(this._location,a.x,a.y))};z.prototype.set=function(){var c=this.value;a.equals(c,this._value)||(a.clone(c,this._value),this._gl.uniform3i(this._location,c.x,c.y,c.z))};x.prototype.set=function(){var a=this.value;f.equals(a,this._value)||(f.clone(a,this._value),this._gl.uniform4i(this._location,a.x,a.y,a.z,a.w))};var C=new Float32Array(4);D.prototype.set=function(){if(!e.equalsArray(this.value,this._value,0)){e.clone(this.value,this._value);var a=e.toArray(this.value,C);this._gl.uniformMatrix2fv(this._location,!1,a)}};var I=new Float32Array(9);v.prototype.set=function(){if(!h.equalsArray(this.value,this._value,0)){h.clone(this.value,this._value);var a=h.toArray(this.value,I);this._gl.uniformMatrix3fv(this._location,!1,a)}};var H=new Float32Array(16);B.prototype.set=function(){if(!p.equalsArray(this.value,this._value,0)){p.clone(this.value,this._value);var a=p.toArray(this.value,H);this._gl.uniformMatrix4fv(this._location,!1,a)}};return function(a,b,e,f){switch(b.type){case a.FLOAT:return new q(a,b,e,f);case a.FLOAT_VEC2:return new t(a,b,e,f);case a.FLOAT_VEC3:return new r(a,b,e,f);case a.FLOAT_VEC4:return new c(a,b,e,f);case a.SAMPLER_2D:case a.SAMPLER_CUBE:return new u(a,b,e,f);case a.INT:case a.BOOL:return new y(a,b,e,f);case a.INT_VEC2:case a.BOOL_VEC2:return new A(a,b,e,f);case a.INT_VEC3:case a.BOOL_VEC3:return new z(a,b,e,f);case a.INT_VEC4:case a.BOOL_VEC4:return new x(a,b,e,f);case a.FLOAT_MAT2:return new D(a,b,e,f);case a.FLOAT_MAT3:return new v(a,b,e,f);case a.FLOAT_MAT4:return new B(a,b,e,f);default:throw new d("Unrecognized uniform type: "+b.type+' for uniform "'+e+'".');}}});F("Renderer/createUniformArray","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Color ../Core/defined ../Core/DeveloperError ../Core/Matrix2 ../Core/Matrix3 ../Core/Matrix4 ../Core/RuntimeError".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(c);this._gl=a;this._location=d[0]}function q(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(2*c);this._gl=a;this._location=d[0]}function t(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(3*c);this._gl=a;this._location=d[0]}function r(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(4*c);this._gl=a;this._location=d[0]}function c(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(c);this._gl=a;this._locations=d;this.textureUnitIndex=void 0}function u(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Int32Array(c);this._gl=a;this._location=d[0]}function y(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Int32Array(2*c);this._gl=a;this._location=d[0]}function A(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Int32Array(3*c);this._gl=a;this._location=d[0]}function z(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Int32Array(4*c);this._gl=a;this._location=d[0]}function x(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(4*c);this._gl=a;this._location=d[0]}function D(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(9*c);this._gl=a;this._location=d[0]}function v(a,c,b,d){c=d.length;this.name=b;this.value=Array(c);this._value=new Float32Array(16*c);this._gl=a;this._location=d[0]}d.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,e=0;e<c;++e){var f=a[e];f!==b[e]&&(b[e]=f,d=!0)}d&&this._gl.uniform1fv(this._location,b)};q.prototype.set=function(){for(var a=this.value,c=a.length,d=this._value,e=!1,f=0,h=0;h<c;++h){var g=a[h];b.equalsArray(g,d,f)||(b.pack(g,d,f),e=!0);f+=2}e&&this._gl.uniform2fv(this._location,d)};t.prototype.set=function(){for(var c=this.value,b=c.length,d=this._value,e=!1,f=0,h=0;h<b;++h){var k=c[h];if(g(k.red)){if(k.red!==d[f]||k.green!==d[f+1]||k.blue!==d[f+2])d[f]=k.red,d[f+1]=k.green,d[f+2]=k.blue,e=!0}else if(g(k.x))a.equalsArray(k,d,f)||(a.pack(k,d,f),e=!0);else throw new l("Invalid vec3 value.");f+=3}e&&this._gl.uniform3fv(this._location,d)};r.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,e=0,h=0;h<c;++h){var m=a[h];if(g(m.red))k.equalsArray(m,b,e)||(k.pack(m,b,e),d=!0);else if(g(m.x))f.equalsArray(m,b,e)||(f.pack(m,b,e),d=!0);else throw new l("Invalid vec4 value.");e+=4}d&&this._gl.uniform4fv(this._location,b)};c.prototype.set=function(){for(var a=this._gl,c=a.TEXTURE0+this.textureUnitIndex,b=this.value,d=b.length,e=0;e<d;++e){var f=b[e];a.activeTexture(c+e);a.bindTexture(f._target,f._texture)}};c.prototype._setSampler=function(a){this.textureUnitIndex=a;for(var c=this._locations,b=c.length,d=0;d<b;++d)this._gl.uniform1i(c[d],a+d);return a+b};u.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,e=0;e<c;++e){var f=a[e];f!==b[e]&&(b[e]=f,d=!0)}d&&this._gl.uniform1iv(this._location,b)};y.prototype.set=function(){for(var a=this.value,c=a.length,d=this._value,e=!1,f=0,h=0;h<c;++h){var g=a[h];b.equalsArray(g,d,f)||(b.pack(g,d,f),e=!0);f+=2}e&&this._gl.uniform2iv(this._location,d)};A.prototype.set=function(){for(var c=this.value,b=c.length,d=this._value,e=!1,f=0,h=0;h<b;++h){var g=c[h];a.equalsArray(g,d,f)||(a.pack(g,d,f),e=!0);f+=3}e&&this._gl.uniform3iv(this._location,d)};z.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,e=0,h=0;h<c;++h){var g=a[h];f.equalsArray(g,b,e)||(f.pack(g,b,e),d=!0);e+=4}d&&this._gl.uniform4iv(this._location,b)};x.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,e=0,f=0;f<c;++f){var h=a[f];m.equalsArray(h,b,e)||(m.pack(h,b,e),d=!0);e+=4}d&&this._gl.uniformMatrix2fv(this._location,!1,b)};D.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,f=0,h=0;h<c;++h){var g=a[h];e.equalsArray(g,b,f)||(e.pack(g,b,f),d=!0);f+=9}d&&this._gl.uniformMatrix3fv(this._location,!1,b)};v.prototype.set=function(){for(var a=this.value,c=a.length,b=this._value,d=!1,e=0,f=0;f<c;++f){var g=a[f];h.equalsArray(g,b,e)||(h.pack(g,b,e),d=!0);e+=16}d&&this._gl.uniformMatrix4fv(this._location,!1,b)};return function(a,b,e,f){switch(b.type){case a.FLOAT:return new d(a,b,e,f);case a.FLOAT_VEC2:return new q(a,b,e,f);case a.FLOAT_VEC3:return new t(a,b,e,f);case a.FLOAT_VEC4:return new r(a,b,e,f);case a.SAMPLER_2D:case a.SAMPLER_CUBE:return new c(a,b,e,f);case a.INT:case a.BOOL:return new u(a,b,e,f);case a.INT_VEC2:case a.BOOL_VEC2:return new y(a,b,e,f);case a.INT_VEC3:case a.BOOL_VEC3:return new A(a,b,e,f);case a.INT_VEC4:case a.BOOL_VEC4:return new z(a,b,e,f);case a.FLOAT_MAT2:return new x(a,b,e,f);case a.FLOAT_MAT3:return new D(a,b,e,f);case a.FLOAT_MAT4:return new v(a,b,e,f);default:throw new p("Unrecognized uniform type: "+b.type+' for uniform "'+e+'".');}}});F("Renderer/ShaderProgram","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/RuntimeError ./AutomaticUniforms ./ContextLimits ./createUniform ./createUniformArray".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a){var b=a.fragmentShaderText,d={};if(!h.highpFloatSupported||!h.highpIntSupported){var e,f,g,k,l=t(a.vertexShaderText),m=t(b),p=l.length,q=m.length;for(e=0;e<p;e++)for(f=0;f<q;f++)l[e]===m[f]&&(g=l[e],k="czm_mediump_"+g,b=b.replace(new RegExp(g+"\\b","g"),k),d[k]=g)}this._gl=a.gl;this._logShaderCompilation=a.logShaderCompilation;this._debugShaders=a.debugShaders;this._attributeLocations=a.attributeLocations;this._manualUniforms=this._automaticUniforms=this._uniforms=this._uniformsByName=this._vertexAttributes=this._numberOfVertexAttributes=this._program=void 0;this._duplicateUniformNames=d;this.maximumTextureUnitIndex=this._cachedShader=void 0;this._vertexShaderSource=a.vertexShaderSource;this._vertexShaderText=a.vertexShaderText;this._fragmentShaderSource=a.fragmentShaderSource;this._fragmentShaderText=b;this.id=c++}function t(a){var c=[];a=a.match(/uniform.*?(?![^{]*})(?=[=\[;])/g);if(f(a))for(var b=a.length,d=0;d<b;d++){var e=a[d].trim(),e=e.slice(e.lastIndexOf(" ")+1);c.push(e)}return c}function r(a){if(!f(a._program)){var c=a._gl,b=a._vertexShaderText,h=a._fragmentShaderText,g=c.createShader(c.VERTEX_SHADER);c.shaderSource(g,b);c.compileShader(g);b=c.createShader(c.FRAGMENT_SHADER);c.shaderSource(b,h);c.compileShader(b);h=c.createProgram();c.attachShader(h,g);c.attachShader(h,b);c.deleteShader(g);c.deleteShader(b);var k=a._attributeLocations;if(f(k))for(var l in k)k.hasOwnProperty(l)&&c.bindAttribLocation(h,k[l],l);c.linkProgram(h);if(!c.getProgramParameter(h,c.LINK_STATUS)){a=a._debugShaders;if(!c.getShaderParameter(b,c.COMPILE_STATUS))throw l=c.getShaderInfoLog(b),console.error(u+"Fragment shader compile log: "+l),f(a)&&(a=a.getTranslatedShaderSource(b),""!==a?console.error(u+"Translated fragment shader source:\n"+a):console.error(u+"Fragment shader translation failed.")),c.deleteProgram(h),new m("Fragment shader failed to compile.  Compile log: "+l);if(!c.getShaderParameter(g,c.COMPILE_STATUS))throw l=c.getShaderInfoLog(g),console.error(u+"Vertex shader compile log: "+l),f(a)&&(a=a.getTranslatedShaderSource(g),""!==a?console.error(u+"Translated vertex shader source:\n"+a):console.error(u+"Vertex shader translation failed.")),c.deleteProgram(h),new m("Vertex shader failed to compile.  Compile log: "+l);l=c.getProgramInfoLog(h);console.error(u+"Shader program link log: "+l);f(a)&&(console.error(u+"Translated vertex shader source:\n"+a.getTranslatedShaderSource(g)),console.error(u+"Translated fragment shader source:\n"+a.getTranslatedShaderSource(b)));c.deleteProgram(h);throw new m("Program failed to link.  Link log: "+l);}if(k=a._logShaderCompilation)l=c.getShaderInfoLog(g),f(l)&&0<l.length&&console.log(u+"Vertex shader compile log: "+l);k&&(l=c.getShaderInfoLog(b),f(l)&&0<l.length&&console.log(u+"Fragment shader compile log: "+l));k&&(l=c.getProgramInfoLog(h),f(l)&&0<l.length&&console.log(u+"Shader program link log: "+l));b=c.getProgramParameter(h,c.ACTIVE_ATTRIBUTES);l={};for(var k=[],g=[],q=c.getProgramParameter(h,c.ACTIVE_UNIFORMS),r=0;r<q;++r){var t=c.getActiveUniform(h,r),y=-1!==t.name.indexOf("[0]",t.name.length-3)?t.name.slice(0,t.name.length-3):t.name;if(0!==y.indexOf("gl_"))if(0>t.name.indexOf("[")){var w=c.getUniformLocation(h,y);null!==w&&(t=p(c,t,y,w),l[y]=t,k.push(t),t._setSampler&&g.push(t))}else{var G,w=y.indexOf("[");if(0<=w)t=l[y.slice(0,w)],f(t)&&(w=t._locations,1>=w.length&&(t=t.value,G=c.getUniformLocation(h,y),null!==G&&(w.push(G),t.push(c.getUniform(h,G)))));else{for(var w=[],E=0;E<t.size;++E)G=c.getUniformLocation(h,y+"["+E+"]"),null!==G&&w.push(G);t=d(c,t,y,w);l[y]=t;k.push(t);t._setSampler&&g.push(t)}}}var q=[],r=[],L;for(L in l)l.hasOwnProperty(L)&&(y=l[L],t=L,w=a._duplicateUniformNames[t],f(w)&&(t=y.name=w),t=e[t],f(t)?q.push({uniform:y,automaticUniform:t}):r.push(y));a._program=h;a._numberOfVertexAttributes=b;L={};for(y=0;y<b;++y)t=c.getActiveAttrib(h,y),w=c.getAttribLocation(h,t.name),L[t.name]={name:t.name,type:t.type,index:w};a._vertexAttributes=L;a._uniformsByName=l;a._uniforms=k;a._automaticUniforms=q;a._manualUniforms=r;c.useProgram(h);h=0;L=g.length;for(b=0;b<L;++b)h=g[b]._setSampler(h);c.useProgram(null);a.maximumTextureUnitIndex=h}}var c=0;q.fromCache=function(c){c=a(c,a.EMPTY_OBJECT);b.defined("options.context",c.context);return c.context.shaderCache.getShaderProgram(c)};q.replaceCache=function(c){c=a(c,a.EMPTY_OBJECT);b.defined("options.context",c.context);return c.context.shaderCache.replaceShaderProgram(c)};k(q.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},vertexAttributes:{get:function(){r(this);return this._vertexAttributes}},numberOfVertexAttributes:{get:function(){r(this);return this._numberOfVertexAttributes}},allUniforms:{get:function(){r(this);return this._uniformsByName}}});var u="[Cesium WebGL] ";q.prototype._bind=function(){r(this);this._gl.useProgram(this._program)};q.prototype._setUniforms=function(a,c,b){var d,e;if(f(a)){var h=this._manualUniforms;d=h.length;for(e=0;e<d;++e){var g=h[e];g.value=a[g.name]()}}a=this._automaticUniforms;d=a.length;for(e=0;e<d;++e)h=a[e],h.uniform.value=h.automaticUniform.getValue(c);c=this._uniforms;d=c.length;for(e=0;e<d;++e)c[e].set();if(b&&(b=this._gl,d=this._program,b.validateProgram(d),!b.getProgramParameter(d,b.VALIDATE_STATUS)))throw new l("Program validation failed.  Program info log: "+b.getProgramInfoLog(d));};q.prototype.isDestroyed=function(){return!1};q.prototype.destroy=function(){this._cachedShader.cache.releaseShaderProgram(this)};q.prototype.finalDestroy=function(){this._gl.deleteProgram(this._program);return g(this)};return q});F("Renderer/modernizeShader",["../Core/defined","../Core/DeveloperError"],function(b,a){function f(a,b,e){a=new RegExp("(^|[^\\w])("+a+")($|[^\\w])","g");for(var f=e.length,g=0;g<f;++g)e[g]=e[g].replace(a,"$1"+b+"$3")}function k(a,f){for(var e={},h=a.length,g=[],d=0;d<f.length;++d){var k=f[d],l=/(#ifdef|#if)/g.test(k),m=/#else/g.test(k),c=/#endif/g.test(k);if(l)g.push(k);else if(m)k=g[g.length-1].replace("ifdef","ifndef"),/if/g.test(k)&&(k=k.replace(/(#if\s+)(\S*)([^]*)/,"$1!($2)$3")),g.pop(),g.push(k);else if(c)g.pop();else if(!/layout/g.test(k))for(l=0;l<h;++l)m=a[l],-1!==k.indexOf(m)&&(b(e[m])?e[m]=e[m].filter(function(a){return 0<=g.indexOf(a)}):e[m]=g.slice())}return e}function g(a,b){for(var e=new RegExp("#extension\\s+GL_"+a+"\\s+:\\s+[a-zA-Z0-9]+\\s*$","g"),f=b.length,g=0;g<f;++g)b[g]=b[g].replace(e,"")}return function(b,m){var e=/#define OUTPUT_DECLARATION/,h=b.split("\n");if(/#version 300 es/g.test(b))return b;var l=-1,d,q;for(d=0;d<h.length;++d)if(q=h[d],e.test(q)){l=d;break}if(-1===l)throw new a("Could not find a #define OUTPUT_DECLARATION!");e=[];for(d=0;10>d;d++){q="gl_FragData\\["+d+"\\]";var t="czm_out"+d;if((new RegExp(q,"g")).test(b)){var r=t,c=e;-1===c.indexOf(r)&&c.push(r);f(q,t,h);h.splice(l,0,"layout(location \x3d "+d+") out vec4 "+t+";");l+=1}}a:{d=RegExp("(^|[^\\w])(gl_FragColor)($|[^\\w])","g");q=h.length;for(t=0;t<q;++t)if(d.test(h[t])){d=!0;break a}d=!1}d&&(-1===e.indexOf("czm_fragColor")&&e.push("czm_fragColor"),f("gl_FragColor","czm_fragColor",h),h.splice(l,0,"layout(location \x3d 0) out vec4 czm_fragColor;"));l=k(e,h);e={};for(d=0;d<h.length;d++){q=h[d];for(var u in l)l.hasOwnProperty(u)&&(new RegExp("(layout)[^]+(out)[^]+("+u+")[^]+","g")).test(q)&&(e[q]=u)}for(var y in e)if(e.hasOwnProperty(y)){d=e[y];u=h.indexOf(y);d=l[d];q=d.length;for(t=0;t<q;t++)h.splice(u,0,d[t]);u+=q+1;for(t=q-1;0<=t;t--)h.splice(u,0,"#endif //"+d[t])}y=!1;for(d=0;d<h.length;d++)/#version/.test(h[d])&&(h[d]="#version 300 es",y=!0);y||h.splice(0,0,"#version 300 es");g("EXT_draw_buffers",h);g("EXT_frag_depth",h);f("texture2D","texture",h);f("texture3D","texture",h);f("textureCube","texture",h);f("gl_FragDepthEXT","gl_FragDepth",h);m?f("varying","in",h):(f("attribute","in",h),f("varying","out",h));y="";u=h.length;for(l=0;l<u;++l)y+=h[l]+"\n";return y}});F("Shaders/Builtin/Constants/degreesPerRadian",[],function(){return"const float czm_degreesPerRadian \x3d 57.29577951308232;\n"});F("Shaders/Builtin/Constants/depthRange",[],function(){return"const czm_depthRangeStruct czm_depthRange \x3d czm_depthRangeStruct(0.0, 1.0);\n"});F("Shaders/Builtin/Constants/ellipsoidInverseRadii",[],function(){return"const vec3 czm_ellipsoidInverseRadii \x3d vec3(1.0 / 6378137.0, 1.0 / 6378137.0, 1.0 / 6356752.314245);\n"});F("Shaders/Builtin/Constants/ellipsoidRadii",[],function(){return"const vec3 czm_ellipsoidRadii \x3d vec3(6378137.0, 6378137.0, 6356752.314245);\n"});F("Shaders/Builtin/Constants/epsilon1",[],function(){return"const float czm_epsilon1 \x3d 0.1;\n"});F("Shaders/Builtin/Constants/epsilon2",[],function(){return"const float czm_epsilon2 \x3d 0.01;\n"});F("Shaders/Builtin/Constants/epsilon3",[],function(){return"const float czm_epsilon3 \x3d 0.001;\n"});F("Shaders/Builtin/Constants/epsilon4",[],function(){return"const float czm_epsilon4 \x3d 0.0001;\n"});F("Shaders/Builtin/Constants/epsilon5",[],function(){return"const float czm_epsilon5 \x3d 0.00001;\n"});F("Shaders/Builtin/Constants/epsilon6",[],function(){return"const float czm_epsilon6 \x3d 0.000001;\n"});F("Shaders/Builtin/Constants/epsilon7",[],function(){return"const float czm_epsilon7 \x3d 0.0000001;\n"});F("Shaders/Builtin/Constants/infinity",[],function(){return"const float czm_infinity \x3d 5906376272000.0;\n"});F("Shaders/Builtin/Constants/oneOverPi",[],function(){return"const float czm_oneOverPi \x3d 0.3183098861837907;\n"});F("Shaders/Builtin/Constants/oneOverTwoPi",[],function(){return"const float czm_oneOverTwoPi \x3d 0.15915494309189535;\n"});F("Shaders/Builtin/Constants/passCesium3DTile",[],function(){return"const float czm_passCesium3DTile \x3d 4.0;\n"});F("Shaders/Builtin/Constants/passCesium3DTileClassification",[],function(){return"const float czm_passCesium3DTileClassification \x3d 5.0;\n"});F("Shaders/Builtin/Constants/passCesium3DTileClassificationIgnoreShow",[],function(){return"const float czm_passCesium3DTileClassificationIgnoreShow \x3d 6.0;\n"});F("Shaders/Builtin/Constants/passClassification",[],function(){return"const float czm_passClassification \x3d 7.0;\n"});F("Shaders/Builtin/Constants/passCompute",[],function(){return"const float czm_passCompute \x3d 1.0;\n"});F("Shaders/Builtin/Constants/passEnvironment",[],function(){return"const float czm_passEnvironment \x3d 0.0;\n"});F("Shaders/Builtin/Constants/passGlobe",[],function(){return"const float czm_passGlobe \x3d 2.0;\n"});F("Shaders/Builtin/Constants/passOpaque",[],function(){return"const float czm_passOpaque \x3d 7.0;\n"});F("Shaders/Builtin/Constants/passOverlay",[],function(){return"const float czm_passOverlay \x3d 9.0;\n"});F("Shaders/Builtin/Constants/passTerrainClassification",[],function(){return"const float czm_passTerrainClassification \x3d 3.0;\n"});F("Shaders/Builtin/Constants/passTranslucent",[],function(){return"const float czm_passTranslucent \x3d 8.0;\n"});F("Shaders/Builtin/Constants/pi",[],function(){return"const float czm_pi \x3d 3.141592653589793;\n"});F("Shaders/Builtin/Constants/piOverFour",[],function(){return"const float czm_piOverFour \x3d 0.7853981633974483;\n"});F("Shaders/Builtin/Constants/piOverSix",[],function(){return"const float czm_piOverSix \x3d 0.5235987755982988;\n"});F("Shaders/Builtin/Constants/piOverThree",[],function(){return"const float czm_piOverThree \x3d 1.0471975511965976;\n"});F("Shaders/Builtin/Constants/piOverTwo",[],function(){return"const float czm_piOverTwo \x3d 1.5707963267948966;\n"});F("Shaders/Builtin/Constants/radiansPerDegree",[],function(){return"const float czm_radiansPerDegree \x3d 0.017453292519943295;\n"});F("Shaders/Builtin/Constants/sceneMode2D",[],function(){return"const float czm_sceneMode2D \x3d 2.0;\n"});F("Shaders/Builtin/Constants/sceneMode3D",[],function(){return"const float czm_sceneMode3D \x3d 3.0;\n"});F("Shaders/Builtin/Constants/sceneModeColumbusView",[],function(){return"const float czm_sceneModeColumbusView \x3d 1.0;\n"});F("Shaders/Builtin/Constants/sceneModeMorphing",[],function(){return"const float czm_sceneModeMorphing \x3d 0.0;\n"});F("Shaders/Builtin/Constants/solarRadius",[],function(){return"const float czm_solarRadius \x3d 695500000.0;\n"});F("Shaders/Builtin/Constants/threePiOver2",[],function(){return"const float czm_threePiOver2 \x3d 4.71238898038469;\n"});F("Shaders/Builtin/Constants/twoPi",[],function(){return"const float czm_twoPi \x3d 6.283185307179586;\n"});F("Shaders/Builtin/Constants/webMercatorMaxLatitude",[],function(){return"const float czm_webMercatorMaxLatitude \x3d 1.4844222297453324;\n"});F("Shaders/Builtin/Structs/depthRangeStruct",[],function(){return"struct czm_depthRangeStruct\n{\nfloat near;\nfloat far;\n};\n"});F("Shaders/Builtin/Structs/ellipsoid",[],function(){return"struct czm_ellipsoid\n{\nvec3 center;\nvec3 radii;\nvec3 inverseRadii;\nvec3 inverseRadiiSquared;\n};\n"});F("Shaders/Builtin/Structs/material",[],function(){return"struct czm_material\n{\nvec3 diffuse;\nfloat specular;\nfloat shininess;\nvec3 normal;\nvec3 emission;\nfloat alpha;\n};\n"});F("Shaders/Builtin/Structs/materialInput",[],function(){return"struct czm_materialInput\n{\nfloat s;\nvec2 st;\nvec3 str;\nvec3 normalEC;\nmat3 tangentToEyeMatrix;\nvec3 positionToEyeEC;\nfloat height;\nfloat slope;\nfloat aspect;\n};\n"});F("Shaders/Builtin/Structs/ray",[],function(){return"struct czm_ray\n{\nvec3 origin;\nvec3 direction;\n};\n"});F("Shaders/Builtin/Structs/raySegment",[],function(){return"struct czm_raySegment\n{\nfloat start;\nfloat stop;\n};\nconst czm_raySegment czm_emptyRaySegment \x3d czm_raySegment(-czm_infinity, -czm_infinity);\nconst czm_raySegment czm_fullRaySegment \x3d czm_raySegment(0.0, czm_infinity);\n"});F("Shaders/Builtin/Structs/shadowParameters",[],function(){return"struct czm_shadowParameters\n{\n#ifdef USE_CUBE_MAP_SHADOW\nvec3 texCoords;\n#else\nvec2 texCoords;\n#endif\nfloat depthBias;\nfloat depth;\nfloat nDotL;\nvec2 texelStepSize;\nfloat normalShadingSmooth;\nfloat darkness;\n};\n"});F("Shaders/Builtin/Functions/alphaWeight",[],function(){return"float czm_alphaWeight(float a)\n{\nfloat z \x3d (gl_FragCoord.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nreturn pow(a + 0.01, 4.0) + max(1e-2, min(3.0 * 1e3, 0.003 / (1e-5 + pow(abs(z) / 200.0, 4.0))));\n}\n"});F("Shaders/Builtin/Functions/antialias",[],function(){return"vec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist, float fuzzFactor)\n{\nfloat val1 \x3d clamp(dist / fuzzFactor, 0.0, 1.0);\nfloat val2 \x3d clamp((dist - 0.5) / fuzzFactor, 0.0, 1.0);\nval1 \x3d val1 * (1.0 - val2);\nval1 \x3d val1 * val1 * (3.0 - (2.0 * val1));\nval1 \x3d pow(val1, 0.5);\nvec4 midColor \x3d (color1 + color2) * 0.5;\nreturn mix(midColor, currentColor, val1);\n}\nvec4 czm_antialias(vec4 color1, vec4 color2, vec4 currentColor, float dist)\n{\nreturn czm_antialias(color1, color2, currentColor, dist, 0.1);\n}\n"});F("Shaders/Builtin/Functions/approximateSphericalCoordinates",[],function(){return"vec2 czm_approximateSphericalCoordinates(vec3 normal) {\nfloat latitudeApproximation \x3d czm_fastApproximateAtan(sqrt(normal.x * normal.x + normal.y * normal.y), normal.z);\nfloat longitudeApproximation \x3d czm_fastApproximateAtan(normal.x, normal.y);\nreturn vec2(latitudeApproximation, longitudeApproximation);\n}\n"});F("Shaders/Builtin/Functions/branchFreeTernary",[],function(){return"float czm_branchFreeTernary(bool comparison, float a, float b) {\nfloat useA \x3d float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec2 czm_branchFreeTernary(bool comparison, vec2 a, vec2 b) {\nfloat useA \x3d float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec3 czm_branchFreeTernary(bool comparison, vec3 a, vec3 b) {\nfloat useA \x3d float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\nvec4 czm_branchFreeTernary(bool comparison, vec4 a, vec4 b) {\nfloat useA \x3d float(comparison);\nreturn a * useA + b * (1.0 - useA);\n}\n"});F("Shaders/Builtin/Functions/cascadeColor",[],function(){return"vec4 czm_cascadeColor(vec4 weights)\n{\nreturn vec4(1.0, 0.0, 0.0, 1.0) * weights.x +\nvec4(0.0, 1.0, 0.0, 1.0) * weights.y +\nvec4(0.0, 0.0, 1.0, 1.0) * weights.z +\nvec4(1.0, 0.0, 1.0, 1.0) * weights.w;\n}\n"});F("Shaders/Builtin/Functions/cascadeDistance",[],function(){return"uniform vec4 shadowMap_cascadeDistances;\nfloat czm_cascadeDistance(vec4 weights)\n{\nreturn dot(shadowMap_cascadeDistances, weights);\n}\n"});F("Shaders/Builtin/Functions/cascadeMatrix",[],function(){return"uniform mat4 shadowMap_cascadeMatrices[4];\nmat4 czm_cascadeMatrix(vec4 weights)\n{\nreturn shadowMap_cascadeMatrices[0] * weights.x +\nshadowMap_cascadeMatrices[1] * weights.y +\nshadowMap_cascadeMatrices[2] * weights.z +\nshadowMap_cascadeMatrices[3] * weights.w;\n}\n"});F("Shaders/Builtin/Functions/cascadeWeights",[],function(){return"uniform vec4 shadowMap_cascadeSplits[2];\nvec4 czm_cascadeWeights(float depthEye)\n{\nvec4 near \x3d step(shadowMap_cascadeSplits[0], vec4(depthEye));\nvec4 far \x3d step(depthEye, shadowMap_cascadeSplits[1]);\nreturn near * far;\n}\n"});F("Shaders/Builtin/Functions/columbusViewMorph",[],function(){return"vec4 czm_columbusViewMorph(vec4 position2D, vec4 position3D, float time)\n{\nvec3 p \x3d mix(position2D.xyz, position3D.xyz, time);\nreturn vec4(p, 1.0);\n}\n"});F("Shaders/Builtin/Functions/computePosition",[],function(){return"vec4 czm_computePosition();\n"});F("Shaders/Builtin/Functions/cosineAndSine",[],function(){return"vec2 cordic(float angle)\n{\nvec2 vector \x3d vec2(6.0725293500888267e-1, 0.0);\nfloat sense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nmat2 rotation \x3d mat2(1.0, sense, -sense, 1.0);\nvector \x3d rotation * vector;\nangle -\x3d sense * 7.8539816339744828e-1;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfloat factor \x3d sense * 5.0e-1;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 4.6364760900080609e-1;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 2.5e-1;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 2.4497866312686414e-1;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.25e-1;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 1.2435499454676144e-1;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 6.25e-2;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 6.2418809995957350e-2;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 3.125e-2;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 3.1239833430268277e-2;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.5625e-2;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 1.5623728620476831e-2;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 7.8125e-3;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 7.8123410601011111e-3;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 3.90625e-3;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 3.9062301319669718e-3;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.953125e-3;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 1.9531225164788188e-3;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 9.765625e-4;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 9.7656218955931946e-4;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 4.8828125e-4;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 4.8828121119489829e-4;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 2.44140625e-4;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 2.4414062014936177e-4;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.220703125e-4;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 1.2207031189367021e-4;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 6.103515625e-5;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 6.1035156174208773e-5;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 3.0517578125e-5;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 3.0517578115526096e-5;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.52587890625e-5;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 1.5258789061315762e-5;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 7.62939453125e-6;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 7.6293945311019700e-6;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 3.814697265625e-6;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 3.8146972656064961e-6;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.9073486328125e-6;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 1.9073486328101870e-6;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 9.5367431640625e-7;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 9.5367431640596084e-7;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 4.76837158203125e-7;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 4.7683715820308884e-7;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 2.384185791015625e-7;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nangle -\x3d sense * 2.3841857910155797e-7;\nsense \x3d (angle \x3c 0.0) ? -1.0 : 1.0;\nfactor \x3d sense * 1.1920928955078125e-7;\nrotation[0][1] \x3d factor;\nrotation[1][0] \x3d -factor;\nvector \x3d rotation * vector;\nreturn vector;\n}\nvec2 czm_cosineAndSine(float angle)\n{\nif (angle \x3c -czm_piOverTwo || angle \x3e czm_piOverTwo)\n{\nif (angle \x3c 0.0)\n{\nreturn -cordic(angle + czm_pi);\n}\nelse\n{\nreturn -cordic(angle - czm_pi);\n}\n}\nelse\n{\nreturn cordic(angle);\n}\n}\n"});F("Shaders/Builtin/Functions/decompressTextureCoordinates",[],function(){return"vec2 czm_decompressTextureCoordinates(float encoded)\n{\nfloat temp \x3d encoded / 4096.0;\nfloat xZeroTo4095 \x3d floor(temp);\nfloat stx \x3d xZeroTo4095 / 4095.0;\nfloat sty \x3d (encoded - xZeroTo4095 * 4096.0) / 4095.0;\nreturn vec2(stx, sty);\n}\n"});F("Shaders/Builtin/Functions/depthClampFarPlane",[],function(){return"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvec4 czm_depthClampFarPlane(vec4 coords)\n{\n#ifndef LOG_DEPTH\nv_WindowZ \x3d (0.5 * (coords.z / coords.w) + 0.5) * coords.w;\ncoords.z \x3d min(coords.z, coords.w);\n#endif\nreturn coords;\n}\n"});F("Shaders/Builtin/Functions/eastNorthUpToEyeCoordinates",[],function(){return"mat3 czm_eastNorthUpToEyeCoordinates(vec3 positionMC, vec3 normalEC)\n{\nvec3 tangentMC \x3d normalize(vec3(-positionMC.y, positionMC.x, 0.0));\nvec3 tangentEC \x3d normalize(czm_normal3D * tangentMC);\nvec3 bitangentEC \x3d normalize(cross(normalEC, tangentEC));\nreturn mat3(\ntangentEC.x,   tangentEC.y,   tangentEC.z,\nbitangentEC.x, bitangentEC.y, bitangentEC.z,\nnormalEC.x,    normalEC.y,    normalEC.z);\n}\n"});F("Shaders/Builtin/Functions/ellipsoidContainsPoint",[],function(){return"bool czm_ellipsoidContainsPoint(vec3 ellipsoid_inverseRadii, vec3 point)\n{\nvec3 scaled \x3d ellipsoid_inverseRadii * (czm_inverseModelView * vec4(point, 1.0)).xyz;\nreturn (dot(scaled, scaled) \x3c\x3d 1.0);\n}\n"});F("Shaders/Builtin/Functions/ellipsoidWgs84TextureCoordinates",[],function(){return"vec2 czm_ellipsoidWgs84TextureCoordinates(vec3 normal)\n{\nreturn vec2(atan(normal.y, normal.x) * czm_oneOverTwoPi + 0.5, asin(normal.z) * czm_oneOverPi + 0.5);\n}\n"});F("Shaders/Builtin/Functions/equalsEpsilon",[],function(){return"bool czm_equalsEpsilon(vec4 left, vec4 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec4(epsilon)));\n}\nbool czm_equalsEpsilon(vec3 left, vec3 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\nbool czm_equalsEpsilon(vec2 left, vec2 right, float epsilon) {\nreturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\nbool czm_equalsEpsilon(float left, float right, float epsilon) {\nreturn (abs(left - right) \x3c\x3d epsilon);\n}\n"});F("Shaders/Builtin/Functions/eyeOffset",[],function(){return"vec4 czm_eyeOffset(vec4 positionEC, vec3 eyeOffset)\n{\nvec4 p \x3d positionEC;\nvec4 zEyeOffset \x3d normalize(p) * eyeOffset.z;\np.xy +\x3d eyeOffset.xy + zEyeOffset.xy;\np.z +\x3d zEyeOffset.z;\nreturn p;\n}\n"});F("Shaders/Builtin/Functions/eyeToWindowCoordinates",[],function(){return"vec4 czm_eyeToWindowCoordinates(vec4 positionEC)\n{\nvec4 q \x3d czm_projection * positionEC;\nq.xyz /\x3d q.w;\nq.xyz \x3d (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n"});F("Shaders/Builtin/Functions/fastApproximateAtan",[],function(){return"float czm_fastApproximateAtan(float x) {\nreturn x * (-0.1784 * x - 0.0663 * x * x + 1.0301);\n}\nfloat czm_fastApproximateAtan(float x, float y) {\nfloat t \x3d abs(x);\nfloat opposite \x3d abs(y);\nfloat adjacent \x3d max(t, opposite);\nopposite \x3d min(t, opposite);\nt \x3d czm_fastApproximateAtan(opposite / adjacent);\nt \x3d czm_branchFreeTernary(abs(y) \x3e abs(x), czm_piOverTwo - t, t);\nt \x3d czm_branchFreeTernary(x \x3c 0.0, czm_pi - t, t);\nt \x3d czm_branchFreeTernary(y \x3c 0.0, -t, t);\nreturn t;\n}\n"});F("Shaders/Builtin/Functions/fog",[],function(){return"vec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor)\n{\nfloat scalar \x3d distanceToCamera * czm_fogDensity;\nfloat fog \x3d 1.0 - exp(-(scalar * scalar));\nreturn mix(color, fogColor, fog);\n}\nvec3 czm_fog(float distanceToCamera, vec3 color, vec3 fogColor, float fogModifierConstant)\n{\nfloat scalar \x3d distanceToCamera * czm_fogDensity;\nfloat fog \x3d 1.0 - exp(-((fogModifierConstant * scalar + fogModifierConstant) * (scalar * (1.0 + fogModifierConstant))));\nreturn mix(color, fogColor, fog);\n}\n"});F("Shaders/Builtin/Functions/gammaCorrect",[],function(){return"vec3 czm_gammaCorrect(vec3 color) {\n#ifdef HDR\ncolor \x3d pow(color, vec3(czm_gamma));\n#endif\nreturn color;\n}\nvec4 czm_gammaCorrect(vec4 color) {\n#ifdef HDR\ncolor.rgb \x3d pow(color.rgb, vec3(czm_gamma));\n#endif\nreturn color;\n}\n"});F("Shaders/Builtin/Functions/geodeticSurfaceNormal",[],function(){return"vec3 czm_geodeticSurfaceNormal(vec3 positionOnEllipsoid, vec3 ellipsoidCenter, vec3 oneOverEllipsoidRadiiSquared)\n{\nreturn normalize((positionOnEllipsoid - ellipsoidCenter) * oneOverEllipsoidRadiiSquared);\n}\n"});F("Shaders/Builtin/Functions/getDefaultMaterial",[],function(){return"czm_material czm_getDefaultMaterial(czm_materialInput materialInput)\n{\nczm_material material;\nmaterial.diffuse \x3d vec3(0.0);\nmaterial.specular \x3d 0.0;\nmaterial.shininess \x3d 1.0;\nmaterial.normal \x3d materialInput.normalEC;\nmaterial.emission \x3d vec3(0.0);\nmaterial.alpha \x3d 1.0;\nreturn material;\n}\n"});F("Shaders/Builtin/Functions/getLambertDiffuse",[],function(){return"float czm_getLambertDiffuse(vec3 lightDirectionEC, vec3 normalEC)\n{\nreturn max(dot(lightDirectionEC, normalEC), 0.0);\n}\n"});F("Shaders/Builtin/Functions/getSpecular",[],function(){return"float czm_getSpecular(vec3 lightDirectionEC, vec3 toEyeEC, vec3 normalEC, float shininess)\n{\nvec3 toReflectedLight \x3d reflect(-lightDirectionEC, normalEC);\nfloat specular \x3d max(dot(toReflectedLight, toEyeEC), 0.0);\nreturn pow(specular, max(shininess, czm_epsilon2));\n}\n"});F("Shaders/Builtin/Functions/getWaterNoise",[],function(){return"vec4 czm_getWaterNoise(sampler2D normalMap, vec2 uv, float time, float angleInRadians)\n{\nfloat cosAngle \x3d cos(angleInRadians);\nfloat sinAngle \x3d sin(angleInRadians);\nvec2 s0 \x3d vec2(1.0/17.0, 0.0);\nvec2 s1 \x3d vec2(-1.0/29.0, 0.0);\nvec2 s2 \x3d vec2(1.0/101.0, 1.0/59.0);\nvec2 s3 \x3d vec2(-1.0/109.0, -1.0/57.0);\ns0 \x3d vec2((cosAngle * s0.x) - (sinAngle * s0.y), (sinAngle * s0.x) + (cosAngle * s0.y));\ns1 \x3d vec2((cosAngle * s1.x) - (sinAngle * s1.y), (sinAngle * s1.x) + (cosAngle * s1.y));\ns2 \x3d vec2((cosAngle * s2.x) - (sinAngle * s2.y), (sinAngle * s2.x) + (cosAngle * s2.y));\ns3 \x3d vec2((cosAngle * s3.x) - (sinAngle * s3.y), (sinAngle * s3.x) + (cosAngle * s3.y));\nvec2 uv0 \x3d (uv/103.0) + (time * s0);\nvec2 uv1 \x3d uv/107.0 + (time * s1) + vec2(0.23);\nvec2 uv2 \x3d uv/vec2(897.0, 983.0) + (time * s2) + vec2(0.51);\nvec2 uv3 \x3d uv/vec2(991.0, 877.0) + (time * s3) + vec2(0.71);\nuv0 \x3d fract(uv0);\nuv1 \x3d fract(uv1);\nuv2 \x3d fract(uv2);\nuv3 \x3d fract(uv3);\nvec4 noise \x3d (texture2D(normalMap, uv0)) +\n(texture2D(normalMap, uv1)) +\n(texture2D(normalMap, uv2)) +\n(texture2D(normalMap, uv3));\nreturn ((noise / 4.0) - 0.5) * 2.0;\n}\n"});F("Shaders/Builtin/Functions/getWgs84EllipsoidEC",[],function(){return"czm_ellipsoid czm_getWgs84EllipsoidEC()\n{\nvec3 radii \x3d vec3(6378137.0, 6378137.0, 6356752.314245);\nvec3 inverseRadii \x3d vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\nvec3 inverseRadiiSquared \x3d inverseRadii * inverseRadii;\nczm_ellipsoid temp \x3d czm_ellipsoid(czm_view[3].xyz, radii, inverseRadii, inverseRadiiSquared);\nreturn temp;\n}\n"});F("Shaders/Builtin/Functions/HSBToRGB",[],function(){return"const vec4 K_HSB2RGB \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nvec3 czm_HSBToRGB(vec3 hsb)\n{\nvec3 p \x3d abs(fract(hsb.xxx + K_HSB2RGB.xyz) * 6.0 - K_HSB2RGB.www);\nreturn hsb.z * mix(K_HSB2RGB.xxx, clamp(p - K_HSB2RGB.xxx, 0.0, 1.0), hsb.y);\n}\n"});F("Shaders/Builtin/Functions/HSLToRGB",[],function(){return"vec3 hueToRGB(float hue)\n{\nfloat r \x3d abs(hue * 6.0 - 3.0) - 1.0;\nfloat g \x3d 2.0 - abs(hue * 6.0 - 2.0);\nfloat b \x3d 2.0 - abs(hue * 6.0 - 4.0);\nreturn clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 czm_HSLToRGB(vec3 hsl)\n{\nvec3 rgb \x3d hueToRGB(hsl.x);\nfloat c \x3d (1.0 - abs(2.0 * hsl.z - 1.0)) * hsl.y;\nreturn (rgb - 0.5) * c + hsl.z;\n}\n"});F("Shaders/Builtin/Functions/hue",[],function(){return"vec3 czm_hue(vec3 rgb, float adjustment)\n{\nconst mat3 toYIQ \x3d mat3(0.299,     0.587,     0.114,\n0.595716, -0.274453, -0.321263,\n0.211456, -0.522591,  0.311135);\nconst mat3 toRGB \x3d mat3(1.0,  0.9563,  0.6210,\n1.0, -0.2721, -0.6474,\n1.0, -1.107,   1.7046);\nvec3 yiq \x3d toYIQ * rgb;\nfloat hue \x3d atan(yiq.z, yiq.y) + adjustment;\nfloat chroma \x3d sqrt(yiq.z * yiq.z + yiq.y * yiq.y);\nvec3 color \x3d vec3(yiq.x, chroma * cos(hue), chroma * sin(hue));\nreturn toRGB * color;\n}\n"});F("Shaders/Builtin/Functions/inverseGamma",[],function(){return"vec3 czm_inverseGamma(vec3 color) {\nreturn pow(color, vec3(1.0 / czm_gamma));\n}\n"});F("Shaders/Builtin/Functions/isEmpty",[],function(){return"bool czm_isEmpty(czm_raySegment interval)\n{\nreturn (interval.stop \x3c 0.0);\n}\n"});F("Shaders/Builtin/Functions/isFull",[],function(){return"bool czm_isFull(czm_raySegment interval)\n{\nreturn (interval.start \x3d\x3d 0.0 \x26\x26 interval.stop \x3d\x3d czm_infinity);\n}\n"});F("Shaders/Builtin/Functions/latitudeToWebMercatorFraction",[],function(){return"float czm_latitudeToWebMercatorFraction(float latitude, float southMercatorY, float oneOverMercatorHeight)\n{\nfloat sinLatitude \x3d sin(latitude);\nfloat mercatorY \x3d 0.5 * log((1.0 + sinLatitude) / (1.0 - sinLatitude));\nreturn (mercatorY - southMercatorY) * oneOverMercatorHeight;\n}\n"});F("Shaders/Builtin/Functions/lineDistance",[],function(){return"float czm_lineDistance(vec2 point1, vec2 point2, vec2 point) {\nreturn abs((point2.y - point1.y) * point.x - (point2.x - point1.x) * point.y + point2.x * point1.y - point2.y * point1.x) / distance(point2, point1);\n}\n"});F("Shaders/Builtin/Functions/luminance",[],function(){return"float czm_luminance(vec3 rgb)\n{\nconst vec3 W \x3d vec3(0.2125, 0.7154, 0.0721);\nreturn dot(rgb, W);\n}\n"});F("Shaders/Builtin/Functions/metersPerPixel",[],function(){return"float czm_metersPerPixel(vec4 positionEC)\n{\nfloat width \x3d czm_viewport.z;\nfloat height \x3d czm_viewport.w;\nfloat pixelWidth;\nfloat pixelHeight;\nfloat top \x3d czm_frustumPlanes.x;\nfloat bottom \x3d czm_frustumPlanes.y;\nfloat left \x3d czm_frustumPlanes.z;\nfloat right \x3d czm_frustumPlanes.w;\nif (czm_sceneMode \x3d\x3d czm_sceneMode2D || czm_orthographicIn3D \x3d\x3d 1.0)\n{\nfloat frustumWidth \x3d right - left;\nfloat frustumHeight \x3d top - bottom;\npixelWidth \x3d frustumWidth / width;\npixelHeight \x3d frustumHeight / height;\n}\nelse\n{\nfloat distanceToPixel \x3d -positionEC.z;\nfloat inverseNear \x3d 1.0 / czm_currentFrustum.x;\nfloat tanTheta \x3d top * inverseNear;\npixelHeight \x3d 2.0 * distanceToPixel * tanTheta / height;\ntanTheta \x3d right * inverseNear;\npixelWidth \x3d 2.0 * distanceToPixel * tanTheta / width;\n}\nreturn max(pixelWidth, pixelHeight);\n}\n"});F("Shaders/Builtin/Functions/modelToWindowCoordinates",[],function(){return"vec4 czm_modelToWindowCoordinates(vec4 position)\n{\nvec4 q \x3d czm_modelViewProjection * position;\nq.xyz /\x3d q.w;\nq.xyz \x3d (czm_viewportTransformation * vec4(q.xyz, 1.0)).xyz;\nreturn q;\n}\n"});F("Shaders/Builtin/Functions/multiplyWithColorBalance",[],function(){return"vec3 czm_multiplyWithColorBalance(vec3 left, vec3 right)\n{\nconst vec3 W \x3d vec3(0.2125, 0.7154, 0.0721);\nvec3 target \x3d left * right;\nfloat leftLuminance \x3d dot(left, W);\nfloat rightLuminance \x3d dot(right, W);\nfloat targetLuminance \x3d dot(target, W);\nreturn ((leftLuminance + rightLuminance) / (2.0 * targetLuminance)) * target;\n}\n"});F("Shaders/Builtin/Functions/nearFarScalar",[],function(){return"float czm_nearFarScalar(vec4 nearFarScalar, float cameraDistSq)\n{\nfloat valueAtMin \x3d nearFarScalar.y;\nfloat valueAtMax \x3d nearFarScalar.w;\nfloat nearDistanceSq \x3d nearFarScalar.x * nearFarScalar.x;\nfloat farDistanceSq \x3d nearFarScalar.z * nearFarScalar.z;\nfloat t \x3d (cameraDistSq - nearDistanceSq) / (farDistanceSq - nearDistanceSq);\nt \x3d pow(clamp(t, 0.0, 1.0), 0.2);\nreturn mix(valueAtMin, valueAtMax, t);\n}\n"});F("Shaders/Builtin/Functions/octDecode",[],function(){return"vec3 czm_octDecode(vec2 encoded, float range)\n{\nif (encoded.x \x3d\x3d 0.0 \x26\x26 encoded.y \x3d\x3d 0.0) {\nreturn vec3(0.0, 0.0, 0.0);\n}\nencoded \x3d encoded / range * 2.0 - 1.0;\nvec3 v \x3d vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\nif (v.z \x3c 0.0)\n{\nv.xy \x3d (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n}\nreturn normalize(v);\n}\nvec3 czm_octDecode(vec2 encoded)\n{\nreturn czm_octDecode(encoded, 255.0);\n}\nvec3 czm_octDecode(float encoded)\n{\nfloat temp \x3d encoded / 256.0;\nfloat x \x3d floor(temp);\nfloat y \x3d (temp - x) * 256.0;\nreturn czm_octDecode(vec2(x, y));\n}\nvoid czm_octDecode(vec2 encoded, out vec3 vector1, out vec3 vector2, out vec3 vector3)\n{\nfloat temp \x3d encoded.x / 65536.0;\nfloat x \x3d floor(temp);\nfloat encodedFloat1 \x3d (temp - x) * 65536.0;\ntemp \x3d encoded.y / 65536.0;\nfloat y \x3d floor(temp);\nfloat encodedFloat2 \x3d (temp - y) * 65536.0;\nvector1 \x3d czm_octDecode(encodedFloat1);\nvector2 \x3d czm_octDecode(encodedFloat2);\nvector3 \x3d czm_octDecode(vec2(x, y));\n}\n"});F("Shaders/Builtin/Functions/packDepth",[],function(){return"vec4 czm_packDepth(float depth)\n{\nvec4 enc \x3d vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nenc \x3d fract(enc);\nenc -\x3d enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\nreturn enc;\n}\n"});F("Shaders/Builtin/Functions/phong",[],function(){return"float czm_private_getLambertDiffuseOfMaterial(vec3 lightDirectionEC, czm_material material)\n{\nreturn czm_getLambertDiffuse(lightDirectionEC, material.normal);\n}\nfloat czm_private_getSpecularOfMaterial(vec3 lightDirectionEC, vec3 toEyeEC, czm_material material)\n{\nreturn czm_getSpecular(lightDirectionEC, toEyeEC, material.normal, material.shininess);\n}\nvec4 czm_phong(vec3 toEye, czm_material material)\n{\nfloat diffuse \x3d czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 0.0, 1.0), material);\nif (czm_sceneMode \x3d\x3d czm_sceneMode3D) {\ndiffuse +\x3d czm_private_getLambertDiffuseOfMaterial(vec3(0.0, 1.0, 0.0), material);\n}\nfloat specular \x3d czm_private_getSpecularOfMaterial(czm_sunDirectionEC, toEye, material) + czm_private_getSpecularOfMaterial(czm_moonDirectionEC, toEye, material);\nvec3 materialDiffuse \x3d material.diffuse * 0.5;\nvec3 ambient \x3d materialDiffuse;\nvec3 color \x3d ambient + material.emission;\ncolor +\x3d materialDiffuse * diffuse;\ncolor +\x3d material.specular * specular;\n#ifdef HDR\nfloat sunDiffuse \x3d czm_private_getLambertDiffuseOfMaterial(czm_sunDirectionEC, material);\ncolor +\x3d materialDiffuse * sunDiffuse * czm_sunColor;\n#endif\nreturn vec4(color, material.alpha);\n}\nvec4 czm_private_phong(vec3 toEye, czm_material material)\n{\nfloat diffuse \x3d czm_private_getLambertDiffuseOfMaterial(czm_sunDirectionEC, material);\nfloat specular \x3d czm_private_getSpecularOfMaterial(czm_sunDirectionEC, toEye, material);\nvec3 ambient \x3d vec3(0.0);\nvec3 color \x3d ambient + material.emission;\ncolor +\x3d material.diffuse * diffuse;\ncolor +\x3d material.specular * specular;\nreturn vec4(color, material.alpha);\n}\n"});F("Shaders/Builtin/Functions/planeDistance",[],function(){return"float czm_planeDistance(vec4 plane, vec3 point) {\nreturn (dot(plane.xyz, point) + plane.w);\n}\nfloat czm_planeDistance(vec3 planeNormal, float planeDistance, vec3 point) {\nreturn (dot(planeNormal, point) + planeDistance);\n}\n"});F("Shaders/Builtin/Functions/pointAlongRay",[],function(){return"vec3 czm_pointAlongRay(czm_ray ray, float time)\n{\nreturn ray.origin + (time * ray.direction);\n}\n"});F("Shaders/Builtin/Functions/rayEllipsoidIntersectionInterval",[],function(){return"czm_raySegment czm_rayEllipsoidIntersectionInterval(czm_ray ray, vec3 ellipsoid_center, vec3 ellipsoid_inverseRadii)\n{\nvec3 q \x3d ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.origin, 1.0)).xyz;\nvec3 w \x3d ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ray.direction, 0.0)).xyz;\nq \x3d q - ellipsoid_inverseRadii * (czm_inverseModelView * vec4(ellipsoid_center, 1.0)).xyz;\nfloat q2 \x3d dot(q, q);\nfloat qw \x3d dot(q, w);\nif (q2 \x3e 1.0)\n{\nif (qw \x3e\x3d 0.0)\n{\nreturn czm_emptyRaySegment;\n}\nelse\n{\nfloat qw2 \x3d qw * qw;\nfloat difference \x3d q2 - 1.0;\nfloat w2 \x3d dot(w, w);\nfloat product \x3d w2 * difference;\nif (qw2 \x3c product)\n{\nreturn czm_emptyRaySegment;\n}\nelse if (qw2 \x3e product)\n{\nfloat discriminant \x3d qw * qw - product;\nfloat temp \x3d -qw + sqrt(discriminant);\nfloat root0 \x3d temp / w2;\nfloat root1 \x3d difference / temp;\nif (root0 \x3c root1)\n{\nczm_raySegment i \x3d czm_raySegment(root0, root1);\nreturn i;\n}\nelse\n{\nczm_raySegment i \x3d czm_raySegment(root1, root0);\nreturn i;\n}\n}\nelse\n{\nfloat root \x3d sqrt(difference / w2);\nczm_raySegment i \x3d czm_raySegment(root, root);\nreturn i;\n}\n}\n}\nelse if (q2 \x3c 1.0)\n{\nfloat difference \x3d q2 - 1.0;\nfloat w2 \x3d dot(w, w);\nfloat product \x3d w2 * difference;\nfloat discriminant \x3d qw * qw - product;\nfloat temp \x3d -qw + sqrt(discriminant);\nczm_raySegment i \x3d czm_raySegment(0.0, temp / w2);\nreturn i;\n}\nelse\n{\nif (qw \x3c 0.0)\n{\nfloat w2 \x3d dot(w, w);\nczm_raySegment i \x3d czm_raySegment(0.0, -qw / w2);\nreturn i;\n}\nelse\n{\nreturn czm_emptyRaySegment;\n}\n}\n}\n"});F("Shaders/Builtin/Functions/readDepth",[],function(){return"float czm_readDepth(sampler2D depthTexture, vec2 texCoords)\n{\nreturn czm_reverseLogDepth(texture2D(depthTexture, texCoords).r);\n}\n"});F("Shaders/Builtin/Functions/reverseLogDepth",[],function(){return"float czm_reverseLogDepth(float logZ)\n{\n#ifdef LOG_DEPTH\nfloat near \x3d czm_currentFrustum.x;\nfloat far \x3d czm_currentFrustum.y;\nlogZ \x3d pow(2.0, logZ * czm_log2FarPlusOne) - 1.0;\nlogZ \x3d far * (1.0 - near / logZ) / (far - near);\n#endif\nreturn logZ;\n}\n"});F("Shaders/Builtin/Functions/RGBToHSB",[],function(){return"const vec4 K_RGB2HSB \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nvec3 czm_RGBToHSB(vec3 rgb)\n{\nvec4 p \x3d mix(vec4(rgb.bg, K_RGB2HSB.wz), vec4(rgb.gb, K_RGB2HSB.xy), step(rgb.b, rgb.g));\nvec4 q \x3d mix(vec4(p.xyw, rgb.r), vec4(rgb.r, p.yzx), step(p.x, rgb.r));\nfloat d \x3d q.x - min(q.w, q.y);\nreturn vec3(abs(q.z + (q.w - q.y) / (6.0 * d + czm_epsilon7)), d / (q.x + czm_epsilon7), q.x);\n}\n"});F("Shaders/Builtin/Functions/RGBToHSL",[],function(){return"vec3 RGBtoHCV(vec3 rgb)\n{\nvec4 p \x3d (rgb.g \x3c rgb.b) ? vec4(rgb.bg, -1.0, 2.0 / 3.0) : vec4(rgb.gb, 0.0, -1.0 / 3.0);\nvec4 q \x3d (rgb.r \x3c p.x) ? vec4(p.xyw, rgb.r) : vec4(rgb.r, p.yzx);\nfloat c \x3d q.x - min(q.w, q.y);\nfloat h \x3d abs((q.w - q.y) / (6.0 * c + czm_epsilon7) + q.z);\nreturn vec3(h, c, q.x);\n}\nvec3 czm_RGBToHSL(vec3 rgb)\n{\nvec3 hcv \x3d RGBtoHCV(rgb);\nfloat l \x3d hcv.z - hcv.y * 0.5;\nfloat s \x3d hcv.y / (1.0 - abs(l * 2.0 - 1.0) + czm_epsilon7);\nreturn vec3(hcv.x, s, l);\n}\n"});F("Shaders/Builtin/Functions/RGBToXYZ",[],function(){return"vec3 czm_RGBToXYZ(vec3 rgb)\n{\nconst mat3 RGB2XYZ \x3d mat3(0.4124, 0.2126, 0.0193,\n0.3576, 0.7152, 0.1192,\n0.1805, 0.0722, 0.9505);\nvec3 xyz \x3d RGB2XYZ * rgb;\nvec3 Yxy;\nYxy.r \x3d xyz.g;\nfloat temp \x3d dot(vec3(1.0), xyz);\nYxy.gb \x3d xyz.rg / temp;\nreturn Yxy;\n}\n"});F("Shaders/Builtin/Functions/sampleOctahedralProjection",[],function(){return"vec3 czm_sampleOctahedralProjectionWithFiltering(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod)\n{\ndirection /\x3d dot(vec3(1.0), abs(direction));\nvec2 rev \x3d abs(direction.zx) - vec2(1.0);\nvec2 neg \x3d vec2(direction.x \x3c 0.0 ? rev.x : -rev.x,\ndirection.z \x3c 0.0 ? rev.y : -rev.y);\nvec2 uv \x3d direction.y \x3c 0.0 ? neg : direction.xz;\nvec2 coord \x3d 0.5 * uv + vec2(0.5);\nvec2 pixel \x3d 1.0 / textureSize;\nif (lod \x3e 0.0)\n{\nfloat scale \x3d 1.0 / pow(2.0, lod);\nfloat offset \x3d ((textureSize.y + 1.0) / textureSize.x);\ncoord.x *\x3d offset;\ncoord *\x3d scale;\ncoord.x +\x3d offset + pixel.x;\ncoord.y +\x3d (1.0 - (1.0 / pow(2.0, lod - 1.0))) + pixel.y * (lod - 1.0) * 2.0;\n}\nelse\n{\ncoord.x *\x3d (textureSize.y / textureSize.x);\n}\n#ifndef OES_texture_float_linear\nvec3 color1 \x3d texture2D(projectedMap, coord + vec2(0.0, pixel.y)).rgb;\nvec3 color2 \x3d texture2D(projectedMap, coord + vec2(pixel.x, 0.0)).rgb;\nvec3 color3 \x3d texture2D(projectedMap, coord + pixel).rgb;\nvec3 color4 \x3d texture2D(projectedMap, coord).rgb;\nvec2 texturePosition \x3d coord * textureSize;\nfloat fu \x3d fract(texturePosition.x);\nfloat fv \x3d fract(texturePosition.y);\nvec3 average1 \x3d mix(color4, color2, fu);\nvec3 average2 \x3d mix(color1, color3, fu);\nvec3 color \x3d mix(average1, average2, fv);\n#else\nvec3 color \x3d texture2D(projectedMap, coord).rgb;\n#endif\nreturn color;\n}\nvec3 czm_sampleOctahedralProjection(sampler2D projectedMap, vec2 textureSize, vec3 direction, float lod, float maxLod) {\nfloat currentLod \x3d floor(lod + 0.5);\nfloat nextLod \x3d min(currentLod + 1.0, maxLod);\nvec3 colorCurrentLod \x3d czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, currentLod);\nvec3 colorNextLod \x3d czm_sampleOctahedralProjectionWithFiltering(projectedMap, textureSize, direction, nextLod);\nreturn mix(colorNextLod, colorCurrentLod, nextLod - lod);\n}\n"});F("Shaders/Builtin/Functions/saturation",[],function(){return"vec3 czm_saturation(vec3 rgb, float adjustment)\n{\nconst vec3 W \x3d vec3(0.2125, 0.7154, 0.0721);\nvec3 intensity \x3d vec3(dot(rgb, W));\nreturn mix(intensity, rgb, adjustment);\n}\n"});F("Shaders/Builtin/Functions/shadowDepthCompare",[],function(){return"float czm_sampleShadowMap(samplerCube shadowMap, vec3 d)\n{\nreturn czm_unpackDepth(textureCube(shadowMap, d));\n}\nfloat czm_sampleShadowMap(sampler2D shadowMap, vec2 uv)\n{\n#ifdef USE_SHADOW_DEPTH_TEXTURE\nreturn texture2D(shadowMap, uv).r;\n#else\nreturn czm_unpackDepth(texture2D(shadowMap, uv));\n#endif\n}\nfloat czm_shadowDepthCompare(samplerCube shadowMap, vec3 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\nfloat czm_shadowDepthCompare(sampler2D shadowMap, vec2 uv, float depth)\n{\nreturn step(depth, czm_sampleShadowMap(shadowMap, uv));\n}\n"});F("Shaders/Builtin/Functions/shadowVisibility",[],function(){return"float czm_private_shadowVisibility(float visibility, float nDotL, float normalShadingSmooth, float darkness)\n{\n#ifdef USE_NORMAL_SHADING\n#ifdef USE_NORMAL_SHADING_SMOOTH\nfloat strength \x3d clamp(nDotL / normalShadingSmooth, 0.0, 1.0);\n#else\nfloat strength \x3d step(0.0, nDotL);\n#endif\nvisibility *\x3d strength;\n#endif\nvisibility \x3d max(visibility, darkness);\nreturn visibility;\n}\n#ifdef USE_CUBE_MAP_SHADOW\nfloat czm_shadowVisibility(samplerCube shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias \x3d shadowParameters.depthBias;\nfloat depth \x3d shadowParameters.depth;\nfloat nDotL \x3d shadowParameters.nDotL;\nfloat normalShadingSmooth \x3d shadowParameters.normalShadingSmooth;\nfloat darkness \x3d shadowParameters.darkness;\nvec3 uvw \x3d shadowParameters.texCoords;\ndepth -\x3d depthBias;\nfloat visibility \x3d czm_shadowDepthCompare(shadowMap, uvw, depth);\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#else\nfloat czm_shadowVisibility(sampler2D shadowMap, czm_shadowParameters shadowParameters)\n{\nfloat depthBias \x3d shadowParameters.depthBias;\nfloat depth \x3d shadowParameters.depth;\nfloat nDotL \x3d shadowParameters.nDotL;\nfloat normalShadingSmooth \x3d shadowParameters.normalShadingSmooth;\nfloat darkness \x3d shadowParameters.darkness;\nvec2 uv \x3d shadowParameters.texCoords;\ndepth -\x3d depthBias;\n#ifdef USE_SOFT_SHADOWS\nvec2 texelStepSize \x3d shadowParameters.texelStepSize;\nfloat radius \x3d 1.0;\nfloat dx0 \x3d -texelStepSize.x * radius;\nfloat dy0 \x3d -texelStepSize.y * radius;\nfloat dx1 \x3d texelStepSize.x * radius;\nfloat dy1 \x3d texelStepSize.y * radius;\nfloat visibility \x3d (\nczm_shadowDepthCompare(shadowMap, uv, depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, 0.0), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(0.0, dy1), depth) +\nczm_shadowDepthCompare(shadowMap, uv + vec2(dx1, dy1), depth)\n) * (1.0 / 9.0);\n#else\nfloat visibility \x3d czm_shadowDepthCompare(shadowMap, uv, depth);\n#endif\nreturn czm_private_shadowVisibility(visibility, nDotL, normalShadingSmooth, darkness);\n}\n#endif\n"});F("Shaders/Builtin/Functions/signNotZero",[],function(){return"float czm_signNotZero(float value)\n{\nreturn value \x3e\x3d 0.0 ? 1.0 : -1.0;\n}\nvec2 czm_signNotZero(vec2 value)\n{\nreturn vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n}\nvec3 czm_signNotZero(vec3 value)\n{\nreturn vec3(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z));\n}\nvec4 czm_signNotZero(vec4 value)\n{\nreturn vec4(czm_signNotZero(value.x), czm_signNotZero(value.y), czm_signNotZero(value.z), czm_signNotZero(value.w));\n}\n"});F("Shaders/Builtin/Functions/sphericalHarmonics",[],function(){return"vec3 czm_sphericalHarmonics(vec3 normal, vec3 coefficients[9])\n{\nconst float c1 \x3d 0.429043;\nconst float c2 \x3d 0.511664;\nconst float c3 \x3d 0.743125;\nconst float c4 \x3d 0.886227;\nconst float c5 \x3d 0.247708;\nvec3 L00 \x3d coefficients[0];\nvec3 L1_1 \x3d coefficients[1];\nvec3 L10 \x3d coefficients[2];\nvec3 L11 \x3d coefficients[3];\nvec3 L2_2 \x3d coefficients[4];\nvec3 L2_1 \x3d coefficients[5];\nvec3 L20 \x3d coefficients[6];\nvec3 L21 \x3d coefficients[7];\nvec3 L22 \x3d coefficients[8];\nfloat x \x3d normal.x;\nfloat y \x3d normal.y;\nfloat z \x3d normal.z;\nreturn c1 * L22 * (x * x - y * y) + c3 * L20 * z * z + c4 * L00 - c5 * L20 +\n2.0 * c1 * (L2_2 * x * y + L21 * x * z + L2_1 * y * z) +\n2.0 * c2 * (L11 * x + L1_1 * y + L10 * z);\n}\n"});F("Shaders/Builtin/Functions/tangentToEyeSpaceMatrix",[],function(){return"mat3 czm_tangentToEyeSpaceMatrix(vec3 normalEC, vec3 tangentEC, vec3 bitangentEC)\n{\nvec3 normal \x3d normalize(normalEC);\nvec3 tangent \x3d normalize(tangentEC);\nvec3 bitangent \x3d normalize(bitangentEC);\nreturn mat3(tangent.x  , tangent.y  , tangent.z,\nbitangent.x, bitangent.y, bitangent.z,\nnormal.x   , normal.y   , normal.z);\n}\n"});F("Shaders/Builtin/Functions/transformPlane",[],function(){return"vec4 czm_transformPlane(vec4 clippingPlane, mat4 transform) {\nvec3 transformedDirection \x3d normalize((transform * vec4(clippingPlane.xyz, 0.0)).xyz);\nvec3 transformedPosition \x3d (transform * vec4(clippingPlane.xyz * -clippingPlane.w, 1.0)).xyz;\nvec4 transformedPlane;\ntransformedPlane.xyz \x3d transformedDirection;\ntransformedPlane.w \x3d -dot(transformedDirection, transformedPosition);\nreturn transformedPlane;\n}\n"});F("Shaders/Builtin/Functions/translateRelativeToEye",[],function(){return"vec4 czm_translateRelativeToEye(vec3 high, vec3 low)\n{\nvec3 highDifference \x3d high - czm_encodedCameraPositionMCHigh;\nvec3 lowDifference \x3d low - czm_encodedCameraPositionMCLow;\nreturn vec4(highDifference + lowDifference, 1.0);\n}\n"});F("Shaders/Builtin/Functions/translucentPhong",[],function(){return"vec4 czm_translucentPhong(vec3 toEye, czm_material material)\n{\nfloat diffuse \x3d czm_getLambertDiffuse(vec3(0.0, 0.0, 1.0), material.normal);\nif (czm_sceneMode \x3d\x3d czm_sceneMode3D) {\ndiffuse +\x3d czm_getLambertDiffuse(vec3(0.0, 1.0, 0.0), material.normal);\n}\ndiffuse \x3d clamp(diffuse, 0.0, 1.0);\nfloat specular \x3d czm_getSpecular(czm_sunDirectionEC, toEye, material.normal, material.shininess);\nspecular +\x3d czm_getSpecular(czm_moonDirectionEC, toEye, material.normal, material.shininess);\nvec3 materialDiffuse \x3d material.diffuse * 0.5;\nvec3 ambient \x3d materialDiffuse;\nvec3 color \x3d ambient + material.emission;\ncolor +\x3d materialDiffuse * diffuse;\ncolor +\x3d material.specular * specular;\nreturn vec4(color, material.alpha);\n}\n"});F("Shaders/Builtin/Functions/transpose",[],function(){return"mat2 czm_transpose(mat2 matrix)\n{\nreturn mat2(\nmatrix[0][0], matrix[1][0],\nmatrix[0][1], matrix[1][1]);\n}\nmat3 czm_transpose(mat3 matrix)\n{\nreturn mat3(\nmatrix[0][0], matrix[1][0], matrix[2][0],\nmatrix[0][1], matrix[1][1], matrix[2][1],\nmatrix[0][2], matrix[1][2], matrix[2][2]);\n}\nmat4 czm_transpose(mat4 matrix)\n{\nreturn mat4(\nmatrix[0][0], matrix[1][0], matrix[2][0], matrix[3][0],\nmatrix[0][1], matrix[1][1], matrix[2][1], matrix[3][1],\nmatrix[0][2], matrix[1][2], matrix[2][2], matrix[3][2],\nmatrix[0][3], matrix[1][3], matrix[2][3], matrix[3][3]);\n}\n"});F("Shaders/Builtin/Functions/unpackDepth",[],function(){return"float czm_unpackDepth(vec4 packedDepth)\n{\nreturn dot(packedDepth, vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n}\n"});F("Shaders/Builtin/Functions/unpackFloat",[],function(){return"#define SHIFT_RIGHT_8 0.00390625 //1.0 / 256.0\n#define SHIFT_RIGHT_16 0.00001525878 //1.0 / 65536.0\n#define SHIFT_RIGHT_24 5.960464477539063e-8//1.0 / 16777216.0\n#define BIAS 38.0\nfloat czm_unpackFloat(vec4 packedFloat)\n{\npackedFloat *\x3d 255.0;\nfloat temp \x3d packedFloat.w / 2.0;\nfloat exponent \x3d floor(temp);\nfloat sign \x3d (temp - exponent) * 2.0;\nexponent \x3d exponent - float(BIAS);\nsign \x3d sign * 2.0 - 1.0;\nsign \x3d -sign;\nfloat unpacked \x3d sign * packedFloat.x * float(SHIFT_RIGHT_8);\nunpacked +\x3d sign * packedFloat.y * float(SHIFT_RIGHT_16);\nunpacked +\x3d sign * packedFloat.z * float(SHIFT_RIGHT_24);\nreturn unpacked * pow(10.0, exponent);\n}\n"});F("Shaders/Builtin/Functions/vertexLogDepth",[],function(){return"#ifdef LOG_DEPTH\nvarying float v_logZ;\n#ifdef SHADOW_MAP\nvarying vec3 v_logPositionEC;\n#endif\n#endif\nvoid czm_updatePositionDepth() {\n#if defined(LOG_DEPTH) \x26\x26 !defined(DISABLE_GL_POSITION_LOG_DEPTH)\nvec3 logPositionEC \x3d (czm_inverseProjection * gl_Position).xyz;\n#ifdef SHADOW_MAP\nv_logPositionEC \x3d logPositionEC;\n#endif\n#ifdef ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT\nif (length(logPositionEC) \x3c 2.0e6)\n{\nreturn;\n}\n#endif\ngl_Position.z \x3d log2(max(1e-6, 1.0 + gl_Position.w)) * czm_log2FarDistance - 1.0;\ngl_Position.z *\x3d gl_Position.w;\n#endif\n}\nvoid czm_vertexLogDepth()\n{\n#ifdef LOG_DEPTH\nv_logZ \x3d 1.0 + gl_Position.w;\nczm_updatePositionDepth();\n#endif\n}\nvoid czm_vertexLogDepth(vec4 clipCoords)\n{\n#ifdef LOG_DEPTH\nv_logZ \x3d 1.0 + clipCoords.w;\nczm_updatePositionDepth();\n#endif\n}\n"});F("Shaders/Builtin/Functions/windColor",[],function(){return"vec4 czm_windColor(vec3 positionWC)\n{\nvec3 radii \x3d vec3(6378137.0, 6378137.0, 6356752.3142451793);\nvec3 inverseRadii \x3d vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\nvec3 inverseRadiiSquared \x3d inverseRadii * inverseRadii;\nfloat wgs84CenterToleranceSquared \x3d 0.1;\nvec3 r \x3d positionWC;\nvec3 scaleGeodeticSurface;\nfloat positionX \x3d r.x;\nfloat positionY \x3d r.y;\nfloat positionZ \x3d r.z;\nfloat oneOverRadiiX \x3d inverseRadii.x;\nfloat oneOverRadiiY \x3d inverseRadii.y;\nfloat oneOverRadiiZ \x3d inverseRadii.z;\nfloat x2 \x3d positionX * positionX * oneOverRadiiX * oneOverRadiiX;\nfloat y2 \x3d positionY * positionY * oneOverRadiiY * oneOverRadiiY;\nfloat z2 \x3d positionZ * positionZ * oneOverRadiiZ * oneOverRadiiZ;\nfloat squaredNorm \x3d x2 + y2 + z2;\nfloat ratio \x3d sqrt(1.0 / squaredNorm);\nvec3 scaleToGeodeticSurfaceIntersection;\nscaleToGeodeticSurfaceIntersection.x \x3d r.x*ratio;\nscaleToGeodeticSurfaceIntersection.y \x3d r.y*ratio;\nscaleToGeodeticSurfaceIntersection.z \x3d r.z*ratio;\nif (squaredNorm \x3c wgs84CenterToleranceSquared) {\nif( ratio \x3e\x3d czm_infinity ){\nreturn vec4(1.0,1.0,0.0,10.0);\n}else{\nscaleGeodeticSurface \x3d scaleToGeodeticSurfaceIntersection;\n}\n}else{\nfloat oneOverRadiiSquaredX \x3d inverseRadiiSquared.x;\nfloat oneOverRadiiSquaredY \x3d inverseRadiiSquared.y;\nfloat oneOverRadiiSquaredZ \x3d inverseRadiiSquared.z;\nvec3 gradient;\ngradient.x \x3d scaleToGeodeticSurfaceIntersection.x*oneOverRadiiSquaredY*2.0;\ngradient.y \x3d scaleToGeodeticSurfaceIntersection.y*oneOverRadiiSquaredY*2.0;\ngradient.z \x3d scaleToGeodeticSurfaceIntersection.z*oneOverRadiiSquaredZ*2.0;\nfloat lambda \x3d (1.0 - ratio) * length(r) / (0.5 * length(gradient));\nfloat correction \x3d 0.0;\nfloat func;\nfloat denominator;\nfloat xMultiplier;\nfloat yMultiplier;\nfloat zMultiplier;\nfloat xMultiplier2;\nfloat yMultiplier2;\nfloat zMultiplier2;\nfloat xMultiplier3;\nfloat yMultiplier3;\nfloat zMultiplier3;\nlambda -\x3d correction;\nxMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredX);\nyMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredY);\nzMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredZ);\nxMultiplier2 \x3d xMultiplier * xMultiplier;\nyMultiplier2 \x3d yMultiplier * yMultiplier;\nzMultiplier2 \x3d zMultiplier * zMultiplier;\nxMultiplier3 \x3d xMultiplier2 * xMultiplier;\nyMultiplier3 \x3d yMultiplier2 * yMultiplier;\nzMultiplier3 \x3d zMultiplier2 * zMultiplier;\nfunc \x3d x2 * xMultiplier2 + y2 * yMultiplier2 + z2 * zMultiplier2 - 1.0;\ndenominator \x3d x2 * xMultiplier3 * oneOverRadiiSquaredX + y2 * yMultiplier3 * oneOverRadiiSquaredY + z2 * zMultiplier3 * oneOverRadiiSquaredZ;\nfloat derivative \x3d -2.0 * denominator;\ncorrection \x3d func / derivative;\nfloat condition \x3d abs(func);\nfor( int m \x3d 0; m \x3c 5906376272000; ++m ){\nif( condition \x3c\x3d 0.000000000001){\nbreak;\n}\nlambda -\x3d correction;\nxMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredX);\nyMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredY);\nzMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredZ);\nxMultiplier2 \x3d xMultiplier * xMultiplier;\nyMultiplier2 \x3d yMultiplier * yMultiplier;\nzMultiplier2 \x3d zMultiplier * zMultiplier;\nxMultiplier3 \x3d xMultiplier2 * xMultiplier;\nyMultiplier3 \x3d yMultiplier2 * yMultiplier;\nzMultiplier3 \x3d zMultiplier2 * zMultiplier;\nfunc \x3d x2 * xMultiplier2 + y2 * yMultiplier2 + z2 * zMultiplier2 - 1.0;\ndenominator \x3d x2 * xMultiplier3 * oneOverRadiiSquaredX + y2 * yMultiplier3 * oneOverRadiiSquaredY + z2 * zMultiplier3 * oneOverRadiiSquaredZ;\nfloat derivatived \x3d -2.0 * denominator;\ncorrection \x3d func / derivatived;\ncondition \x3d abs(func);\n}\nscaleGeodeticSurface.x \x3d positionX * xMultiplier;\nscaleGeodeticSurface.y \x3d positionY * yMultiplier;\nscaleGeodeticSurface.z \x3d positionZ * zMultiplier;\n}\nvec3 normal;\nnormal.x \x3d scaleGeodeticSurface.x*inverseRadiiSquared.x;\nnormal.y \x3d scaleGeodeticSurface.y*inverseRadiiSquared.y;\nnormal.z \x3d scaleGeodeticSurface.z*inverseRadiiSquared.z;\nnormal \x3d normalize(normal);\nfloat longitude \x3d atan(normal.y, normal.x)*czm_degreesPerRadian;\nif(longitude \x3e 360.0){\nlongitude \x3d 360.0;\n}\nfloat latitude \x3d -asin(normal.z)*czm_degreesPerRadian;\nlatitude \x3d clamp( latitude,-90.0,90.0);\nif( longitude \x3e\x3d 110.0 \x26\x26 longitude \x3c\x3d 130.0 \x26\x26 latitude \x3e\x3d 40.0 \x26\x26 latitude \x3c\x3d 60.0){\n}\nfloat lon0 \x3d 0.0;\nfloat lond \x3d 1.0;\nfloat lat0 \x3d 90.0;\nfloat latd \x3d 1.0;\nfloat lonDelta \x3d longitude - lon0;\nfloat fIndex \x3d lonDelta - 360.0 *floor(lonDelta / 360.0);\nbvec2 res \x3d equal( vec2(fIndex,0.0),vec2(360.0,0.0));\nif( res.x ){\nfIndex \x3d 0.0;\n}\nfloat loni \x3d fIndex / lond;\nfloat latj \x3d (lat0 - latitude) / latd;\nfloat fi \x3d floor(loni);\nfloat ci \x3d fi + 1.0;\nfloat fj \x3d floor(latj);\nfloat cj \x3d fj + 1.0;\nfloat g00yIndex \x3d float(fj);\nfloat g00xIndex \x3d float(fi);\nvec2 g00coord \x3d vec2(g00xIndex / 361.0,g00yIndex / 181.0);\nvec4 rgbag00u \x3d texture2D(czm_texWindU,g00coord);\nfloat g00uiInteger \x3d floor(rgbag00u.r*255.0);\nfloat g00ufInteger \x3d float(g00uiInteger);\nfloat g00uiDecimal \x3d floor(rgbag00u.g*255.0);\nfloat g00ufDecimal \x3d float(g00uiDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g00ufDecimal \x3e\x3d 1.0){\ng00ufDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g00u \x3d g00ufInteger + g00ufDecimal;\nfloat g00uSymbol \x3d float(rgbag00u.b);\nif( g00uSymbol \x3e 0.0 ){\n}else{\ng00u \x3d -abs(g00u);\n}\nvec4 rgbag00v \x3d texture2D(czm_texWindV,g00coord);\nfloat g00viInteger \x3d floor(rgbag00v.r*255.0);\nfloat g00vfInteger \x3d float(g00viInteger);\nfloat g00viDecimal \x3d floor(rgbag00v.g*255.0);\nfloat g00vfDecimal \x3d float(g00viDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g00vfDecimal \x3e\x3d 1.0){\ng00vfDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g00v \x3d g00vfInteger + g00vfDecimal;\nfloat g00vSymbol \x3d float(rgbag00v.b*255.0);\nif( g00vSymbol \x3e 0.0 ){\n}else{\ng00v \x3d -abs(g00v);\n}\nfloat g10yIndex \x3d float(fj);\nfloat g10xIndex \x3d float(ci);\nvec2 g10coord \x3d vec2(g10xIndex/361.0,g10yIndex/181.0);\nvec4 rgbag10u \x3d texture2D(czm_texWindU,g10coord);\nfloat g10uiInteger \x3d floor(rgbag10u.r*255.0);\nfloat g10ufInteger \x3d float(g10uiInteger);\nfloat g10uiDecimal \x3d floor(rgbag10u.g*255.0);\nfloat g10ufDecimal \x3d float(g10uiDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g10ufDecimal \x3e\x3d 1.0){\ng10ufDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g10u \x3d g10ufInteger + g10ufDecimal;\nfloat g10uSymbol \x3d float(rgbag10u.b*255.0);\nif( g10uSymbol \x3e 0.0 ){\n}else{\ng10u \x3d -abs(g10u);\n}\nvec4 rgbag10v \x3d texture2D(czm_texWindV,g10coord);\nint g10viInteger \x3d int(rgbag10v.r*255.0);\nfloat g10vfInteger \x3d float(g10viInteger);\nfloat g10viDecimal \x3d floor(rgbag10v.g*255.0);\nfloat g10vfDecimal \x3d float(g10viDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g10vfDecimal \x3e\x3d 1.0){\ng10vfDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g10v \x3d g10vfInteger + g10vfDecimal;\nfloat g10vSymbol \x3d float(rgbag10v.b*255.0);\nif( g10vSymbol \x3e 0.0 ){\n}else{\ng10v \x3d -abs(g10v);\n}\nfloat g01yIndex \x3d float(cj);\nfloat g01xIndex \x3d float(fi);\nvec2 g01coord \x3d vec2(g01xIndex/361.0,g01yIndex/181.0);\nvec4 rgbag01u \x3d texture2D(czm_texWindU,g01coord);\nfloat g01uiInteger \x3d floor(rgbag01u.r*255.0);\nfloat g01ufInteger \x3d float(g01uiInteger);\nfloat g01uiDecimal \x3d floor(rgbag01u.g*255.0);\nfloat g01ufDecimal \x3d float(g01uiDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g01ufDecimal \x3e\x3d 1.0){\ng01ufDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g01u \x3d g01ufInteger + g01ufDecimal;\nfloat g01uSymbol \x3d float(rgbag01u.b*255.0);\nif( g01uSymbol \x3e 0.0 ){\n}else{\ng01u \x3d -abs(g01u);\n}\nvec4 rgbag01v \x3d texture2D(czm_texWindV,g01coord);\nfloat g01viInteger \x3d floor(rgbag01v.r*255.0);\nfloat g01vfInteger \x3d float(g01viInteger);\nfloat g01viDecimal \x3d floor(rgbag01v.g*255.0);\nfloat g01vfDecimal \x3d float(g01viDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g01vfDecimal \x3e\x3d 1.0){\ng01vfDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g01v \x3d g01vfInteger + g01vfDecimal;\nfloat g01vSymbol \x3d float(rgbag01v.b*255.0);\nif( g01vSymbol \x3e 0.0 ){\n}else{\ng01v \x3d -abs(g01v);\n}\nfloat g11yIndex \x3d float(cj);\nfloat g11xIndex \x3d float(ci);\nvec2 g11coord \x3d vec2(g11xIndex/361.0,g11yIndex/181.0);\nvec4 rgbag11u \x3d texture2D(czm_texWindU,g11coord);\nfloat g11uiInteger \x3d floor(rgbag11u.r*255.0);\nfloat g11ufInteger \x3d float(g11uiInteger);\nfloat g11uiDecimal \x3d floor(rgbag11u.g*255.0);\nfloat g11ufDecimal \x3d float(g11uiDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g11ufDecimal \x3e\x3d 1.0){\ng11ufDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g11u \x3d g11ufInteger + g11ufDecimal;\nfloat g11uSymbol \x3d float(rgbag11u.b*255.0);\nif( g11uSymbol \x3e 0.0 ){\n}else{\ng11u \x3d -abs(g11u);\n}\nvec4 rgbag11v \x3d texture2D(czm_texWindV,g11coord);\nfloat g11viInteger \x3d floor(rgbag11v.r*255.0);\nfloat g11vfInteger \x3d float(g11viInteger);\nfloat g11viDecimal \x3d floor(rgbag11v.g*255.0);\nfloat g11vfDecimal \x3d float(g11viDecimal);\nfor( int i \x3d 0; i \x3c 5; ++i ){\nif( g11vfDecimal \x3e\x3d 1.0){\ng11vfDecimal /\x3d 10.0;\n}else{\nbreak;\n}\n}\nfloat g11v \x3d g11vfInteger + g11vfDecimal;\nfloat g11vSymbol \x3d float(rgbag11v.b*255.0);\nif( g11vSymbol \x3e 0.0 ){\n}else{\ng11v \x3d -abs(g11v);\n}\nfloat deltaLon \x3d loni - float(fi);\nfloat deltaLat \x3d latj - float(fj);\nfloat rx \x3d (1.0 - deltaLon);\nfloat ry \x3d (1.0 - deltaLat);\nfloat a \x3d rx * ry,  b \x3d deltaLon * ry,  c \x3d rx * deltaLat,  d \x3d deltaLon * deltaLat;\nfloat u \x3d g00u * a + g10u * b + g01u * c + g11u * d;\nfloat v \x3d g00v * a + g10v * b + g01v * c + g11v * d;\nvec3 uvInterpolate \x3d vec3(u, v, sqrt(u * u + v * v));\nfloat scalar \x3d uvInterpolate.z;\nfloat OVERLAY_ALPHA \x3d 0.4;\nfloat pramV \x3d min( scalar,100.0)/100.0;\nfloat BOUNDARY \x3d 0.45;\nif( pramV \x3c\x3d BOUNDARY ){\nfloat hue \x3d pramV/BOUNDARY;\nfloat rad \x3d hue * czm_twoPi * 5.0/6.0;\nrad *\x3d 0.75;\nfloat s \x3d sin(rad);\nfloat c \x3d cos(rad);\nfloat r \x3d max(0.0, -c);\nfloat g \x3d max(s, 0.0);\nfloat b \x3d max( max(c, 0.0), -s);\nreturn vec4(r,g,b,OVERLAY_ALPHA);\n}else{\nfloat hue \x3d 1.0;\nfloat rad \x3d hue * czm_twoPi * 5.0/6.0;\nrad *\x3d 0.75;\nfloat s \x3d sin(rad);\nfloat c \x3d cos(rad);\nfloat r \x3d floor( max(0.0, -c)*255.0);\nfloat g \x3d floor( max(s, 0.0)*255.0);\nfloat b \x3d floor( max( max(c, 0.0), -s)*255.0);\nvec3 start \x3d vec3( float(r),float(g),float(b));\nvec3 end \x3d vec3(255.0,255.0,255.0);\nfloat red \x3d start.x, green \x3d start.y, blue \x3d start.z;\nfloat rd \x3d end.x - red, gd \x3d end.y - green, bd \x3d end.z - blue;\nfloat ii \x3d (pramV - BOUNDARY)/(1.0 - BOUNDARY);\nreturn vec4( (red + ii * rd)/255.0, (green + ii * gd)/255.0,(blue + ii * bd)/255.0, OVERLAY_ALPHA);\n}\nreturn vec4(0.0,0.0,0.0,10.0);\n}\n"});F("Shaders/Builtin/Functions/windowToEyeCoordinates",[],function(){return"vec4 czm_windowToEyeCoordinates(vec4 fragmentCoordinate)\n{\nfloat x \x3d 2.0 * (fragmentCoordinate.x - czm_viewport.x) / czm_viewport.z - 1.0;\nfloat y \x3d 2.0 * (fragmentCoordinate.y - czm_viewport.y) / czm_viewport.w - 1.0;\nfloat z \x3d (fragmentCoordinate.z - czm_viewportTransformation[3][2]) / czm_viewportTransformation[2][2];\nvec4 q \x3d vec4(x, y, z, 1.0);\nq /\x3d fragmentCoordinate.w;\nif (!(czm_inverseProjection \x3d\x3d mat4(0.0)))\n{\nq \x3d czm_inverseProjection * q;\n}\nelse\n{\nfloat top \x3d czm_frustumPlanes.x;\nfloat bottom \x3d czm_frustumPlanes.y;\nfloat left \x3d czm_frustumPlanes.z;\nfloat right \x3d czm_frustumPlanes.w;\nfloat near \x3d czm_currentFrustum.x;\nfloat far \x3d czm_currentFrustum.y;\nq.x \x3d (q.x * (right - left) + left + right) * 0.5;\nq.y \x3d (q.y * (top - bottom) + bottom + top) * 0.5;\nq.z \x3d (q.z * (near - far) - near - far) * 0.5;\nq.w \x3d 1.0;\n}\nreturn q;\n}\nvec4 czm_windowToEyeCoordinates(vec2 fragmentCoordinateXY, float depthOrLogDepth)\n{\n#ifdef LOG_DEPTH\nfloat near \x3d czm_currentFrustum.x;\nfloat far \x3d czm_currentFrustum.y;\nfloat unscaledDepth \x3d pow(2.0, depthOrLogDepth * czm_log2FarPlusOne) - 1.0;\nvec4 windowCoord \x3d vec4(fragmentCoordinateXY, far * (1.0 - near / unscaledDepth) / (far - near), 1.0);\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(windowCoord);\neyeCoordinate.w \x3d 1.0 / unscaledDepth;\n#else\nvec4 windowCoord \x3d vec4(fragmentCoordinateXY, depthOrLogDepth, 1.0);\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(windowCoord);\n#endif\nreturn eyeCoordinate;\n}\n"});F("Shaders/Builtin/Functions/writeDepthClampedToFarPlane",[],function(){return"#ifndef LOG_DEPTH\nvarying float v_WindowZ;\n#endif\nvoid czm_writeDepthClampedToFarPlane()\n{\n#if defined(GL_EXT_frag_depth) \x26\x26 !defined(LOG_DEPTH)\ngl_FragDepthEXT \x3d min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n"});F("Shaders/Builtin/Functions/writeLogDepth",[],function(){return"#ifdef LOG_DEPTH\nvarying float v_logZ;\n#endif\nvoid czm_writeLogDepth(float logZ)\n{\n#if defined(GL_EXT_frag_depth) \x26\x26 defined(LOG_DEPTH) \x26\x26 !defined(DISABLE_LOG_DEPTH_FRAGMENT_WRITE)\nfloat halfLogFarDistance \x3d czm_log2FarDistance * 0.5;\nfloat depth \x3d log2(logZ);\nif (depth \x3c czm_log2NearDistance) {\ndiscard;\n}\ngl_FragDepthEXT \x3d depth * halfLogFarDistance;\n#endif\n}\nvoid czm_writeLogDepth() {\n#ifdef LOG_DEPTH\nczm_writeLogDepth(v_logZ);\n#endif\n}\n"});F("Shaders/Builtin/Functions/xyzToLonLatHeight",[],function(){return"vec3 czm_xyzToLonLatHeight(vec3 positionWC)\n{\nvec3 radii \x3d vec3(6378137.0, 6378137.0, 6356752.3142451793);\nvec3 inverseRadii \x3d vec3(1.0 / radii.x, 1.0 / radii.y, 1.0 / radii.z);\nvec3 inverseRadiiSquared \x3d inverseRadii * inverseRadii;\nfloat wgs84CenterToleranceSquared \x3d 0.1;\nvec3 r \x3d positionWC;\nvec3 scaleGeodeticSurface;\nfloat positionX \x3d r.x;\nfloat positionY \x3d r.y;\nfloat positionZ \x3d r.z;\nfloat oneOverRadiiX \x3d inverseRadii.x;\nfloat oneOverRadiiY \x3d inverseRadii.y;\nfloat oneOverRadiiZ \x3d inverseRadii.z;\nfloat x2 \x3d positionX * positionX * oneOverRadiiX * oneOverRadiiX;\nfloat y2 \x3d positionY * positionY * oneOverRadiiY * oneOverRadiiY;\nfloat z2 \x3d positionZ * positionZ * oneOverRadiiZ * oneOverRadiiZ;\nfloat squaredNorm \x3d x2 + y2 + z2;\nfloat ratio \x3d sqrt(1.0 / squaredNorm);\nvec3 scaleToGeodeticSurfaceIntersection;\nscaleToGeodeticSurfaceIntersection.x \x3d r.x*ratio;\nscaleToGeodeticSurfaceIntersection.y \x3d r.y*ratio;\nscaleToGeodeticSurfaceIntersection.z \x3d r.z*ratio;\nif (squaredNorm \x3c wgs84CenterToleranceSquared) {\nif( ratio \x3e\x3d czm_infinity ){\nreturn vec3(0.0,0.0,0.0);\n}else{\nscaleGeodeticSurface \x3d scaleToGeodeticSurfaceIntersection;\n}\n}else{\nfloat oneOverRadiiSquaredX \x3d inverseRadiiSquared.x;\nfloat oneOverRadiiSquaredY \x3d inverseRadiiSquared.y;\nfloat oneOverRadiiSquaredZ \x3d inverseRadiiSquared.z;\nvec3 gradient;\ngradient.x \x3d scaleToGeodeticSurfaceIntersection.x*oneOverRadiiSquaredY*2.0;\ngradient.y \x3d scaleToGeodeticSurfaceIntersection.y*oneOverRadiiSquaredY*2.0;\ngradient.z \x3d scaleToGeodeticSurfaceIntersection.z*oneOverRadiiSquaredZ*2.0;\nfloat lambda \x3d (1.0 - ratio) * length(r) / (0.5 * length(gradient));\nfloat correction \x3d 0.0;\nfloat func;\nfloat denominator;\nfloat xMultiplier;\nfloat yMultiplier;\nfloat zMultiplier;\nfloat xMultiplier2;\nfloat yMultiplier2;\nfloat zMultiplier2;\nfloat xMultiplier3;\nfloat yMultiplier3;\nfloat zMultiplier3;\nlambda -\x3d correction;\nxMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredX);\nyMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredY);\nzMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredZ);\nxMultiplier2 \x3d xMultiplier * xMultiplier;\nyMultiplier2 \x3d yMultiplier * yMultiplier;\nzMultiplier2 \x3d zMultiplier * zMultiplier;\nxMultiplier3 \x3d xMultiplier2 * xMultiplier;\nyMultiplier3 \x3d yMultiplier2 * yMultiplier;\nzMultiplier3 \x3d zMultiplier2 * zMultiplier;\nfunc \x3d x2 * xMultiplier2 + y2 * yMultiplier2 + z2 * zMultiplier2 - 1.0;\ndenominator \x3d x2 * xMultiplier3 * oneOverRadiiSquaredX + y2 * yMultiplier3 * oneOverRadiiSquaredY + z2 * zMultiplier3 * oneOverRadiiSquaredZ;\nfloat derivative \x3d -2.0 * denominator;\ncorrection \x3d func / derivative;\nfloat condition \x3d abs(func);\nfor( int m \x3d 0; m \x3c 5906376272000; ++m ){\nif( condition \x3c\x3d 0.000000000001){\nbreak;\n}\nlambda -\x3d correction;\nxMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredX);\nyMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredY);\nzMultiplier \x3d 1.0 / (1.0 + lambda * oneOverRadiiSquaredZ);\nxMultiplier2 \x3d xMultiplier * xMultiplier;\nyMultiplier2 \x3d yMultiplier * yMultiplier;\nzMultiplier2 \x3d zMultiplier * zMultiplier;\nxMultiplier3 \x3d xMultiplier2 * xMultiplier;\nyMultiplier3 \x3d yMultiplier2 * yMultiplier;\nzMultiplier3 \x3d zMultiplier2 * zMultiplier;\nfunc \x3d x2 * xMultiplier2 + y2 * yMultiplier2 + z2 * zMultiplier2 - 1.0;\ndenominator \x3d x2 * xMultiplier3 * oneOverRadiiSquaredX + y2 * yMultiplier3 * oneOverRadiiSquaredY + z2 * zMultiplier3 * oneOverRadiiSquaredZ;\nfloat derivatived \x3d -2.0 * denominator;\ncorrection \x3d func / derivatived;\ncondition \x3d abs(func);\n}\nscaleGeodeticSurface.x \x3d positionX * xMultiplier;\nscaleGeodeticSurface.y \x3d positionY * yMultiplier;\nscaleGeodeticSurface.z \x3d positionZ * zMultiplier;\n}\nvec3 normal;\nnormal.x \x3d scaleGeodeticSurface.x*inverseRadiiSquared.x;\nnormal.y \x3d scaleGeodeticSurface.y*inverseRadiiSquared.y;\nnormal.z \x3d scaleGeodeticSurface.z*inverseRadiiSquared.z;\nnormal \x3d normalize(normal);\nfloat longitude \x3d atan(normal.y, normal.x)*czm_degreesPerRadian;\nif(longitude \x3e 360.0){\nlongitude \x3d 360.0;\n}\nfloat latitude \x3d asin(normal.z)*czm_degreesPerRadian;\nlatitude \x3d clamp( latitude,-90.0,90.0);\nvec3 h \x3d r - scaleGeodeticSurface;\nfloat height \x3d sign(dot(h, r)) * length(h);\nreturn vec3(longitude,latitude,height);\n}\n"});F("Shaders/Builtin/Functions/XYZToRGB",[],function(){return"vec3 czm_XYZToRGB(vec3 Yxy)\n{\nconst mat3 XYZ2RGB \x3d mat3( 3.2405, -0.9693,  0.0556,\n-1.5371,  1.8760, -0.2040,\n-0.4985,  0.0416,  1.0572);\nvec3 xyz;\nxyz.r \x3d Yxy.r * Yxy.g / Yxy.b;\nxyz.g \x3d Yxy.r;\nxyz.b \x3d Yxy.r * (1.0 - Yxy.g - Yxy.b) / Yxy.b;\nreturn XYZ2RGB * xyz;\n}\n"});F("Shaders/Builtin/CzmBuiltins","./Constants/degreesPerRadian ./Constants/depthRange ./Constants/ellipsoidInverseRadii ./Constants/ellipsoidRadii ./Constants/epsilon1 ./Constants/epsilon2 ./Constants/epsilon3 ./Constants/epsilon4 ./Constants/epsilon5 ./Constants/epsilon6 ./Constants/epsilon7 ./Constants/infinity ./Constants/oneOverPi ./Constants/oneOverTwoPi ./Constants/passCesium3DTile ./Constants/passCesium3DTileClassification ./Constants/passCesium3DTileClassificationIgnoreShow ./Constants/passClassification ./Constants/passCompute ./Constants/passEnvironment ./Constants/passGlobe ./Constants/passOpaque ./Constants/passOverlay ./Constants/passTerrainClassification ./Constants/passTranslucent ./Constants/pi ./Constants/piOverFour ./Constants/piOverSix ./Constants/piOverThree ./Constants/piOverTwo ./Constants/radiansPerDegree ./Constants/sceneMode2D ./Constants/sceneMode3D ./Constants/sceneModeColumbusView ./Constants/sceneModeMorphing ./Constants/solarRadius ./Constants/threePiOver2 ./Constants/twoPi ./Constants/webMercatorMaxLatitude ./Structs/depthRangeStruct ./Structs/ellipsoid ./Structs/material ./Structs/materialInput ./Structs/ray ./Structs/raySegment ./Structs/shadowParameters ./Functions/alphaWeight ./Functions/antialias ./Functions/approximateSphericalCoordinates ./Functions/branchFreeTernary ./Functions/cascadeColor ./Functions/cascadeDistance ./Functions/cascadeMatrix ./Functions/cascadeWeights ./Functions/columbusViewMorph ./Functions/computePosition ./Functions/cosineAndSine ./Functions/decompressTextureCoordinates ./Functions/depthClampFarPlane ./Functions/eastNorthUpToEyeCoordinates ./Functions/ellipsoidContainsPoint ./Functions/ellipsoidWgs84TextureCoordinates ./Functions/equalsEpsilon ./Functions/eyeOffset ./Functions/eyeToWindowCoordinates ./Functions/fastApproximateAtan ./Functions/fog ./Functions/gammaCorrect ./Functions/geodeticSurfaceNormal ./Functions/getDefaultMaterial ./Functions/getLambertDiffuse ./Functions/getSpecular ./Functions/getWaterNoise ./Functions/getWgs84EllipsoidEC ./Functions/HSBToRGB ./Functions/HSLToRGB ./Functions/hue ./Functions/inverseGamma ./Functions/isEmpty ./Functions/isFull ./Functions/latitudeToWebMercatorFraction ./Functions/lineDistance ./Functions/luminance ./Functions/metersPerPixel ./Functions/modelToWindowCoordinates ./Functions/multiplyWithColorBalance ./Functions/nearFarScalar ./Functions/octDecode ./Functions/packDepth ./Functions/phong ./Functions/planeDistance ./Functions/pointAlongRay ./Functions/rayEllipsoidIntersectionInterval ./Functions/readDepth ./Functions/reverseLogDepth ./Functions/RGBToHSB ./Functions/RGBToHSL ./Functions/RGBToXYZ ./Functions/sampleOctahedralProjection ./Functions/saturation ./Functions/shadowDepthCompare ./Functions/shadowVisibility ./Functions/signNotZero ./Functions/sphericalHarmonics ./Functions/tangentToEyeSpaceMatrix ./Functions/transformPlane ./Functions/translateRelativeToEye ./Functions/translucentPhong ./Functions/transpose ./Functions/unpackDepth ./Functions/unpackFloat ./Functions/vertexLogDepth ./Functions/windColor ./Functions/windowToEyeCoordinates ./Functions/writeDepthClampedToFarPlane ./Functions/writeLogDepth ./Functions/xyzToLonLatHeight ./Functions/XYZToRGB".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga,F,na,ia,la,ha,pa,oa,qa,ua,ta,wa,za,Da,Ba,ra,Ea,Ga,Ca,ya,Aa,Ua,sa,Va,xa,Ha,Ma,Ia,La,Fa,Ja,Qa,va,Sa,Oa,Ta,Ka,Wa,Ra,Nb,hb,Hb,db,tb,Jc,cc,sc,Za,tc,wc,Xb,dc,ja,uc,ec,ad,Dc,fc,xd,Vc,xc,Pa,Lc,Oc,ed,Rc,Pc){return{czm_degreesPerRadian:b,czm_depthRange:a,czm_ellipsoidInverseRadii:f,czm_ellipsoidRadii:k,czm_epsilon1:g,czm_epsilon2:l,czm_epsilon3:m,czm_epsilon4:e,czm_epsilon5:h,czm_epsilon6:p,czm_epsilon7:d,czm_infinity:q,czm_oneOverPi:t,czm_oneOverTwoPi:r,czm_passCesium3DTile:c,czm_passCesium3DTileClassification:u,czm_passCesium3DTileClassificationIgnoreShow:y,czm_passClassification:A,czm_passCompute:z,czm_passEnvironment:x,czm_passGlobe:D,czm_passOpaque:v,czm_passOverlay:B,czm_passTerrainClassification:C,czm_passTranslucent:I,czm_pi:H,czm_piOverFour:J,czm_piOverSix:w,czm_piOverThree:G,czm_piOverTwo:E,czm_radiansPerDegree:L,czm_sceneMode2D:K,czm_sceneMode3D:P,czm_sceneModeColumbusView:N,czm_sceneModeMorphing:O,czm_solarRadius:Z,czm_threePiOver2:aa,czm_twoPi:U,czm_webMercatorMaxLatitude:W,czm_depthRangeStruct:M,czm_ellipsoid:R,czm_material:Y,czm_materialInput:Q,czm_ray:S,czm_raySegment:ca,czm_shadowParameters:T,czm_alphaWeight:da,czm_antialias:V,czm_approximateSphericalCoordinates:ba,czm_branchFreeTernary:X,czm_cascadeColor:fa,czm_cascadeDistance:ga,czm_cascadeMatrix:F,czm_cascadeWeights:na,czm_columbusViewMorph:ia,czm_computePosition:la,czm_cosineAndSine:ha,czm_decompressTextureCoordinates:pa,czm_depthClampFarPlane:oa,czm_eastNorthUpToEyeCoordinates:qa,czm_ellipsoidContainsPoint:ua,czm_ellipsoidWgs84TextureCoordinates:ta,czm_equalsEpsilon:wa,czm_eyeOffset:za,czm_eyeToWindowCoordinates:Da,czm_fastApproximateAtan:Ba,czm_fog:ra,czm_gammaCorrect:Ea,czm_geodeticSurfaceNormal:Ga,czm_getDefaultMaterial:Ca,czm_getLambertDiffuse:ya,czm_getSpecular:Aa,czm_getWaterNoise:Ua,czm_getWgs84EllipsoidEC:sa,czm_HSBToRGB:Va,czm_HSLToRGB:xa,czm_hue:Ha,czm_inverseGamma:Ma,czm_isEmpty:Ia,czm_isFull:La,czm_latitudeToWebMercatorFraction:Fa,czm_lineDistance:Ja,czm_luminance:Qa,czm_metersPerPixel:va,czm_modelToWindowCoordinates:Sa,czm_multiplyWithColorBalance:Oa,czm_nearFarScalar:Ta,czm_octDecode:Ka,czm_packDepth:Wa,czm_phong:Ra,czm_planeDistance:Nb,czm_pointAlongRay:hb,czm_rayEllipsoidIntersectionInterval:Hb,czm_readDepth:db,czm_reverseLogDepth:tb,czm_RGBToHSB:Jc,czm_RGBToHSL:cc,czm_RGBToXYZ:sc,czm_sampleOctahedralProjection:Za,czm_saturation:tc,czm_shadowDepthCompare:wc,czm_shadowVisibility:Xb,czm_signNotZero:dc,czm_sphericalHarmonics:ja,czm_tangentToEyeSpaceMatrix:uc,czm_transformPlane:ec,czm_translateRelativeToEye:ad,czm_translucentPhong:Dc,czm_transpose:fc,czm_unpackDepth:xd,czm_unpackFloat:Vc,czm_vertexLogDepth:xc,czm_windColor:Pa,czm_windowToEyeCoordinates:Lc,czm_writeDepthClampedToFarPlane:Oc,czm_writeLogDepth:ed,czm_xyzToLonLatHeight:Rc,czm_XYZToRGB:Pc}});F("Renderer/ShaderSource","../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Renderer/modernizeShader ../Shaders/Builtin/CzmBuiltins ./AutomaticUniforms".split(" "),function(b,a,f,k,g,l){function m(a){a=a.replace(/\/\/.*/g,"");return a.replace(/\/\*\*[\s\S]*?\*\//gm,function(a){a=a.match(/\n/gm).length;for(var c="",b=0;b<a;++b)c+="\n";return c})}function e(c,b,d){for(var e,f=0;f<d.length;++f)d[f].name===c&&(e=d[f]);a(e)||(b=m(b),e={name:c,glslSource:b,dependsOn:[],requiredBy:[],evaluated:!1},d.push(e));return e}function h(c,b){if(!c.evaluated){c.evaluated=!0;var d=c.glslSource.match(/\bczm_[a-zA-Z0-9_]*/g);a(d)&&null!==d&&(d=d.filter(function(a,c){return d.indexOf(a)===c}),d.forEach(function(a){a!==c.name&&q._czmBuiltinsAndUniforms.hasOwnProperty(a)&&(a=e(a,q._czmBuiltinsAndUniforms[a],b),c.dependsOn.push(a),a.requiredBy.push(c),h(a,b))}))}}function p(a){var c=[];a=e("main",a,c);h(a,c);for(var b=[],d=[];0<c.length;){var g=c.pop();d.push(g);0===g.requiredBy.length&&b.push(g)}for(;0<b.length;){g=b.shift();c.push(g);for(var k=0;k<g.dependsOn.length;++k){var l=g.dependsOn[k],m=l.requiredBy.indexOf(g);l.requiredBy.splice(m,1);0===l.requiredBy.length&&b.push(l)}}b=[];for(g=0;g<d.length;++g)0!==d[g].requiredBy.length&&b.push(d[g]);if(0!==b.length){c="A circular dependency was found in the following built-in functions/structs/constants: \n";for(a=0;a<b.length;++a)c=c+b[a].name+"\n";throw new f(c);}d="";for(b=c.length-1;0<=b;--b)d=d+c[b].glslSource+"\n";return d.replace(a.glslSource,"")}function d(c,b,d){var e,h,g="",l=c.sources;if(a(l))for(e=0,h=l.length;e<h;++e)g+="\n#line 0\n"+l[e];var g=m(g),r,g=g.replace(/#version\s+(.*?)\n/gm,function(c,b){if(a(r)&&r!==b)throw new f("inconsistent versions found: "+r+" and "+b);r=b;return"\n"}),u=[],g=g.replace(/#extension.*\n/gm,function(a){u.push(a);return"\n"}),g=g.replace(/precision\s(lowp|mediump|highp)\s(float|int);/,"");e=c.pickColorQualifier;a(e)&&(g=q.createPickFragmentShaderSource(g,e));l="";a(r)&&(l="#version "+r+"\n");h=u.length;for(e=0;e<h;e++)l+=u[e];b&&(l+="#ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n#else\n    precision mediump float;\n#endif\n\n");var t=c.defines;if(a(t))for(e=0,h=t.length;e<h;++e){var y=t[e];0!==y.length&&(l+="#define "+y+"\n")}d.webgl2&&(l+="#define OUTPUT_DECLARATION\n\n");d.textureFloatLinear&&(l+="#define OES_texture_float_linear\n\n");c.includeBuiltIns&&(l+=p(g));l=l+"\n#line 0\n"+g;d.webgl2&&(l=k(l,b,!0));return l}function q(c){c=b(c,b.EMPTY_OBJECT);var d=c.pickColorQualifier;if(a(d)&&"uniform"!==d&&"varying"!==d)throw new f("options.pickColorQualifier must be 'uniform' or 'varying'.");this.defines=a(c.defines)?c.defines.slice(0):[];this.sources=a(c.sources)?c.sources.slice(0):[];this.pickColorQualifier=d;this.includeBuiltIns=b(c.includeBuiltIns,!0)}q.prototype.clone=function(){return new q({sources:this.sources,defines:this.defines,pickColorQualifier:this.pickColorQualifier,includeBuiltIns:this.includeBuiltIns})};q.replaceMain=function(a,c){return a.replace(/void\s+main\s*\(\s*(?:void)?\s*\)/g,"void "+c+"()")};q.prototype.createCombinedVertexShader=function(a){return d(this,!1,a)};q.prototype.createCombinedFragmentShader=function(a){return d(this,!0,a)};q._czmBuiltinsAndUniforms={};for(var t in g)g.hasOwnProperty(t)&&(q._czmBuiltinsAndUniforms[t]=g[t]);for(var r in l)l.hasOwnProperty(r)&&(g=l[r],"function"===typeof g.getDeclaration&&(q._czmBuiltinsAndUniforms[r]=g.getDeclaration(r)));q.createPickVertexShaderSource=function(a){return q.replaceMain(a,"czm_old_main")+"\nattribute vec4 pickColor; \nvarying vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    czm_pickColor \x3d pickColor; \n}"};q.createPickFragmentShaderSource=function(a,c){return q.replaceMain(a,"czm_old_main")+"\n"+(c+" vec4 czm_pickColor; \nvoid main() \n{ \n    czm_old_main(); \n    if (gl_FragColor.a \x3d\x3d 0.0) { \n       discard; \n    } \n    gl_FragColor \x3d czm_pickColor; \n}")};q.findVarying=function(a,c){for(var b=a.sources,d=c.length,e=0;e<d;++e)for(var f=c[e],h=b.length,g=0;g<h;++g)if(-1!==b[g].indexOf(f))return f};var c=["v_normalEC","v_normal"];q.findNormalVarying=function(a){return q.findVarying(a,c)};var u=["v_positionEC"];q.findPositionVarying=function(a){return q.findVarying(a,u)};return q});F("Shaders/ShadowVolumeFS",[],function(){return"#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvoid main(void)\n{\n#ifdef VECTOR_TILE\ngl_FragColor \x3d czm_gammaCorrect(u_highlightColor);\n#else\ngl_FragColor \x3d vec4(1.0);\n#endif\nczm_writeDepthClampedToFarPlane();\n}\n"});F("Shaders/ShadowVolumeAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute float batchId;\n#ifdef EXTRUDED_GEOMETRY\nattribute vec3 extrudeDirection;\nuniform float u_globeMinimumAltitude;\n#endif // EXTRUDED_GEOMETRY\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif // PER_INSTANCE_COLOR\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else // SPHERICAL\nvarying vec2 v_inversePlaneExtents;\nvarying vec4 v_westPlane;\nvarying vec4 v_southPlane;\n#endif // SPHERICAL\nvarying vec3 v_uvMinAndSphericalLongitudeRotation;\nvarying vec3 v_uMaxAndInverseDistance;\nvarying vec3 v_vMaxAndInverseDistance;\n#endif // TEXTURE_COORDINATES\nvoid main()\n{\nvec4 position \x3d czm_computePosition();\n#ifdef EXTRUDED_GEOMETRY\nfloat delta \x3d min(u_globeMinimumAltitude, czm_geometricToleranceOverMeter * length(position.xyz));\ndelta *\x3d czm_sceneMode \x3d\x3d czm_sceneMode3D ? 1.0 : 0.0;\nposition \x3d position + vec4(extrudeDirection * delta, 0.0);\n#endif\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nv_sphericalExtents \x3d czm_batchTable_sphericalExtents(batchId);\nv_uvMinAndSphericalLongitudeRotation.z \x3d czm_batchTable_longitudeRotation(batchId);\n#else // SPHERICAL\n#ifdef COLUMBUS_VIEW_2D\nvec4 planes2D_high \x3d czm_batchTable_planes2D_HIGH(batchId);\nvec4 planes2D_low \x3d czm_batchTable_planes2D_LOW(batchId);\nvec2 idlSplitNewPlaneHiLow \x3d vec2(EAST_MOST_X_HIGH - (WEST_MOST_X_HIGH - planes2D_high.w), EAST_MOST_X_LOW - (WEST_MOST_X_LOW - planes2D_low.w));\nbool idlSplit \x3d planes2D_high.x \x3e planes2D_high.w \x26\x26 position3DLow.y \x3e 0.0;\nplanes2D_high.w \x3d czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.w);\nplanes2D_low.w \x3d czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.w);\nidlSplit \x3d planes2D_high.x \x3e planes2D_high.w \x26\x26 position3DLow.y \x3c 0.0;\nidlSplitNewPlaneHiLow \x3d vec2(WEST_MOST_X_HIGH - (EAST_MOST_X_HIGH - planes2D_high.x), WEST_MOST_X_LOW - (EAST_MOST_X_LOW - planes2D_low.x));\nplanes2D_high.x \x3d czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.x, planes2D_high.x);\nplanes2D_low.x \x3d czm_branchFreeTernary(idlSplit, idlSplitNewPlaneHiLow.y, planes2D_low.x);\nvec3 southWestCorner \x3d (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.xy), vec3(0.0, planes2D_low.xy))).xyz;\nvec3 northWestCorner \x3d (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.x, planes2D_high.z), vec3(0.0, planes2D_low.x, planes2D_low.z))).xyz;\nvec3 southEastCorner \x3d (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, planes2D_high.w, planes2D_high.y), vec3(0.0, planes2D_low.w, planes2D_low.y))).xyz;\n#else // COLUMBUS_VIEW_2D\nvec3 southWestCorner \x3d (czm_modelViewRelativeToEye * czm_translateRelativeToEye(czm_batchTable_southWest_HIGH(batchId), czm_batchTable_southWest_LOW(batchId))).xyz;\nvec3 northWestCorner \x3d czm_normal * czm_batchTable_northward(batchId) + southWestCorner;\nvec3 southEastCorner \x3d czm_normal * czm_batchTable_eastward(batchId) + southWestCorner;\n#endif // COLUMBUS_VIEW_2D\nvec3 eastWard \x3d southEastCorner - southWestCorner;\nfloat eastExtent \x3d length(eastWard);\neastWard /\x3d eastExtent;\nvec3 northWard \x3d northWestCorner - southWestCorner;\nfloat northExtent \x3d length(northWard);\nnorthWard /\x3d northExtent;\nv_westPlane \x3d vec4(eastWard, -dot(eastWard, southWestCorner));\nv_southPlane \x3d vec4(northWard, -dot(northWard, southWestCorner));\nv_inversePlaneExtents \x3d vec2(1.0 / eastExtent, 1.0 / northExtent);\n#endif // SPHERICAL\nvec4 uvMinAndExtents \x3d czm_batchTable_uvMinAndExtents(batchId);\nvec4 uMaxVmax \x3d czm_batchTable_uMaxVmax(batchId);\nv_uMaxAndInverseDistance \x3d vec3(uMaxVmax.xy, uvMinAndExtents.z);\nv_vMaxAndInverseDistance \x3d vec3(uMaxVmax.zw, uvMinAndExtents.w);\nv_uvMinAndSphericalLongitudeRotation.xy \x3d uvMinAndExtents.xy;\n#endif // TEXTURE_COORDINATES\n#ifdef PER_INSTANCE_COLOR\nv_color \x3d czm_batchTable_color(batchId);\n#endif\ngl_Position \x3d czm_depthClampFarPlane(czm_modelViewProjectionRelativeToEye * position);\n}\n"});F("Scene/DepthFunction",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){return b({NEVER:a.NEVER,LESS:a.LESS,EQUAL:a.EQUAL,LESS_OR_EQUAL:a.LEQUAL,GREATER:a.GREATER,NOT_EQUAL:a.NOTEQUAL,GREATER_OR_EQUAL:a.GEQUAL,ALWAYS:a.ALWAYS})});F("Renderer/BufferUsage",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={STREAM_DRAW:a.STREAM_DRAW,STATIC_DRAW:a.STATIC_DRAW,DYNAMIC_DRAW:a.DYNAMIC_DRAW,validate:function(a){return a===f.STREAM_DRAW||a===f.STATIC_DRAW||a===f.DYNAMIC_DRAW}};return b(f)});F("Renderer/Buffer","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/IndexDatatype ../Core/WebGLConstants ./BufferUsage".split(" "),function(b,a,f,k,g,l,m,e,h){function p(d){d=a(d,a.EMPTY_OBJECT);b.defined("options.context",d.context);if(!f(d.typedArray)&&!f(d.sizeInBytes))throw new l("Either options.sizeInBytes or options.typedArray is required.");if(f(d.typedArray)&&f(d.sizeInBytes))throw new l("Cannot pass in both options.sizeInBytes and options.typedArray.");f(d.typedArray)&&(b.typeOf.object("options.typedArray",d.typedArray),b.typeOf.number("options.typedArray.byteLength",d.typedArray.byteLength));if(!h.validate(d.usage))throw new l("usage is invalid.");var e=d.context._gl,g=d.bufferTarget,k=d.typedArray,c=d.sizeInBytes,m=d.usage,p=f(k);p&&(c=k.byteLength);b.typeOf.number.greaterThan("sizeInBytes",c,0);var A=e.createBuffer();e.bindBuffer(g,A);e.bufferData(g,p?k:c,m);e.bindBuffer(g,null);this._gl=e;this._webgl2=d.context._webgl2;this._bufferTarget=g;this._sizeInBytes=c;this._usage=m;this._buffer=A;this.vertexArrayDestroyable=!0}p.createVertexBuffer=function(a){b.defined("options.context",a.context);return new p({context:a.context,bufferTarget:e.ARRAY_BUFFER,typedArray:a.typedArray,sizeInBytes:a.sizeInBytes,usage:a.usage})};p.createIndexBuffer=function(a){b.defined("options.context",a.context);if(!m.validate(a.indexDatatype))throw new l("Invalid indexDatatype.");if(a.indexDatatype===m.UNSIGNED_INT&&!a.context.elementIndexUint)throw new l("IndexDatatype.UNSIGNED_INT requires OES_element_index_uint, which is not supported on this system.  Check context.elementIndexUint.");var d=a.context,f=a.indexDatatype,h=m.getSizeInBytes(f);a=new p({context:d,bufferTarget:e.ELEMENT_ARRAY_BUFFER,typedArray:a.typedArray,sizeInBytes:a.sizeInBytes,usage:a.usage});var c=a.sizeInBytes/h;k(a,{indexDatatype:{get:function(){return f}},bytesPerIndex:{get:function(){return h}},numberOfIndices:{get:function(){return c}}});return a};k(p.prototype,{sizeInBytes:{get:function(){return this._sizeInBytes}},usage:{get:function(){return this._usage}}});p.prototype._getBuffer=function(){return this._buffer};p.prototype.copyFromArrayView=function(d,e){e=a(e,0);b.defined("arrayView",d);b.typeOf.number.lessThanOrEquals("offsetInBytes + arrayView.byteLength",e+d.byteLength,this._sizeInBytes);var f=this._gl,h=this._bufferTarget;f.bindBuffer(h,this._buffer);f.bufferSubData(h,e,d);f.bindBuffer(h,null)};p.prototype.copyFromBuffer=function(a,b,h,g){if(!this._webgl2)throw new l("A WebGL 2 context is required.");if(!f(a))throw new l("readBuffer must be defined.");if(!f(g)||0>=g)throw new l("sizeInBytes must be defined and be greater than zero.");if(!f(b)||0>b||b+g>a._sizeInBytes)throw new l("readOffset must be greater than or equal to zero and readOffset + sizeInBytes must be less than of equal to readBuffer.sizeInBytes.");if(!f(h)||0>h||h+g>this._sizeInBytes)throw new l("writeOffset must be greater than or equal to zero and writeOffset + sizeInBytes must be less than of equal to this.sizeInBytes.");if(this._buffer===a._buffer&&(h>=b&&h<b+g||b>h&&b<h+g))throw new l("When readBuffer is equal to this, the ranges [readOffset + sizeInBytes) and [writeOffset, writeOffset + sizeInBytes) must not overlap.");if(this._bufferTarget===e.ELEMENT_ARRAY_BUFFER&&a._bufferTarget!==e.ELEMENT_ARRAY_BUFFER||this._bufferTarget!==e.ELEMENT_ARRAY_BUFFER&&a._bufferTarget===e.ELEMENT_ARRAY_BUFFER)throw new l("Can not copy an index buffer into another buffer type.");var c=e.COPY_READ_BUFFER,d=e.COPY_WRITE_BUFFER,k=this._gl;k.bindBuffer(d,this._buffer);k.bindBuffer(c,a._buffer);k.copyBufferSubData(c,d,b,h,g);k.bindBuffer(d,null);k.bindBuffer(c,null)};p.prototype.getBufferData=function(b,h,g,k){h=a(h,0);g=a(g,0);if(!this._webgl2)throw new l("A WebGL 2 context is required.");if(!f(b))throw new l("arrayView is required.");var c,d,m=b.byteLength;f(k)?(c=k,f(m)?d=1:(m=b.length,d=b.BYTES_PER_ELEMENT)):f(m)?(c=m-g,d=1):(m=b.length,c=m-g,d=b.BYTES_PER_ELEMENT);if(0>g||g>m)throw new l("destinationOffset must be greater than zero and less than the arrayView length.");if(g+c>m)throw new l("destinationOffset + length must be less than or equal to the arrayViewLength.");if(0>h||h>this._sizeInBytes)throw new l("sourceOffset must be greater than zero and less than the buffers size.");if(h+c*d>this._sizeInBytes)throw new l("sourceOffset + length must be less than the buffers size.");c=this._gl;d=e.COPY_READ_BUFFER;c.bindBuffer(d,this._buffer);c.getBufferSubData(d,h,b,g,k);c.bindBuffer(d,null)};p.prototype.isDestroyed=function(){return!1};p.prototype.destroy=function(){this._gl.deleteBuffer(this._buffer);return g(this)};return p});F("Renderer/VertexArray","../Core/Check ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Geometry ../Core/IndexDatatype ../Core/Math ../Core/RuntimeError ./Buffer ./BufferUsage ./ContextLimits".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(c,b,d,e){var h=k(b.vertexBuffer),g=k(b.value),l=b.value?b.value.length:b.componentsPerAttribute;if(!h&&!g)throw new m("attribute must have a vertexBuffer or a value.");if(h&&g)throw new m("attribute cannot have both a vertexBuffer and a value.  It must have either a vertexBuffer property defining per-vertex data or a value property defining data for all vertices.");if(1!==l&&2!==l&&3!==l&&4!==l){if(g)throw new m("attribute.value.length must be in the range [1, 4].");throw new m("attribute.componentsPerAttribute must be in the range [1, 4].");}if(k(b.componentDatatype)&&!a.validate(b.componentDatatype))throw new m("attribute must have a valid componentDatatype or not specify it.");if(k(b.strideInBytes)&&255<b.strideInBytes)throw new m("attribute must have a strideInBytes less than or equal to 255 or not specify it.");if(k(b.instanceDivisor)&&0<b.instanceDivisor&&!e.instancedArrays)throw new m("instanced arrays is not supported");if(k(b.instanceDivisor)&&0>b.instanceDivisor)throw new m("attribute must have an instanceDivisor greater than or equal to zero");if(k(b.instanceDivisor)&&g)throw new m("attribute cannot have have an instanceDivisor if it is not backed by a buffer");if(k(b.instanceDivisor)&&0<b.instanceDivisor&&0===b.index)throw new m("attribute zero cannot have an instanceDivisor greater than 0");b={index:f(b.index,d),enabled:f(b.enabled,!0),vertexBuffer:b.vertexBuffer,value:g?b.value.slice(0):void 0,componentsPerAttribute:l,componentDatatype:f(b.componentDatatype,a.FLOAT),normalize:f(b.normalize,!1),offsetInBytes:f(b.offsetInBytes,0),strideInBytes:f(b.strideInBytes,0),instanceDivisor:f(b.instanceDivisor,0)};if(h)b.vertexAttrib=function(a){var c=this.index;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer._getBuffer());a.vertexAttribPointer(c,this.componentsPerAttribute,this.componentDatatype,this.normalize,this.strideInBytes,this.offsetInBytes);a.enableVertexAttribArray(c);0<this.instanceDivisor&&(e.glVertexAttribDivisor(c,this.instanceDivisor),e._vertexAttribDivisors[c]=this.instanceDivisor,e._previousDrawInstanced=!0)},b.disableVertexAttribArray=function(a){a.disableVertexAttribArray(this.index);0<this.instanceDivisor&&e.glVertexAttribDivisor(d,0)};else{switch(b.componentsPerAttribute){case 1:b.vertexAttrib=function(a){a.vertexAttrib1fv(this.index,this.value)};break;case 2:b.vertexAttrib=function(a){a.vertexAttrib2fv(this.index,this.value)};break;case 3:b.vertexAttrib=function(a){a.vertexAttrib3fv(this.index,this.value)};break;case 4:b.vertexAttrib=function(a){a.vertexAttrib4fv(this.index,this.value)}}b.disableVertexAttribArray=function(a){}}c.push(b)}function u(a,c,b){for(var d=0;d<c.length;++d){var e=c[d];e.enabled&&e.vertexAttrib(a)}k(b)&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,b._getBuffer())}function y(d){d=f(d,f.EMPTY_OBJECT);b.defined("options.context",d.context);b.defined("options.attributes",d.attributes);var e=d.context,h=e._gl,g=d.attributes;d=d.indexBuffer;var l,p=[],q=1,r=!1,t=!1,y=g.length;for(l=0;l<y;++l)c(p,g[l],l,e);y=p.length;for(l=0;l<y;++l)if(g=p[l],k(g.vertexBuffer)&&0===g.instanceDivisor){l=g.strideInBytes||g.componentsPerAttribute*a.getSizeInBytes(g.componentDatatype);q=g.vertexBuffer.sizeInBytes/l;break}for(l=0;l<y;++l)0<p[l].instanceDivisor&&(r=!0),k(p[l].value)&&(t=!0);g={};for(l=0;l<y;++l){var z=p[l].index;if(g[z])throw new m("Index "+z+" is used by more than one attribute.");g[z]=!0}var A;e.vertexArrayObject&&(A=e.glCreateVertexArray(),e.glBindVertexArray(A),u(h,p,d),e.glBindVertexArray(null));this._numberOfVertices=q;this._hasInstancedAttributes=r;this._hasConstantAttributes=t;this._context=e;this._gl=h;this._vao=A;this._attributes=p;this._indexBuffer=d}function A(a){return a.values.length/a.componentsPerAttribute}function z(c){return a.getSizeInBytes(c.componentDatatype)*c.componentsPerAttribute}function x(c){var b,e,f,h=[];for(e in c)c.hasOwnProperty(e)&&k(c[e])&&k(c[e].values)&&(h.push(e),c[e].componentDatatype===a.DOUBLE&&(c[e].componentDatatype=a.FLOAT,c[e].values=a.createTypedArray(a.FLOAT,c[e].values)));var g,l=h.length;if(0<l)for(g=A(c[h[0]]),b=1;b<l;++b){var m=A(c[h[b]]);if(m!==g)throw new d("Each attribute list must have the same number of vertices.  Attribute "+h[b]+" has a different number of vertices ("+m.toString()+") than attribute "+h[0]+" ("+g.toString()+").");}h.sort(function(b,d){return a.getSizeInBytes(c[d].componentDatatype)-a.getSizeInBytes(c[b].componentDatatype)});var m=0,p={};for(b=0;b<l;++b)e=h[b],f=c[e],p[e]=m,m+=z(f);if(0<m){b=a.getSizeInBytes(c[h[0]].componentDatatype);var q=m%b;0!==q&&(m+=b-q);var q=new ArrayBuffer(g*m),r={};for(b=0;b<l;++b){e=h[b];var u=a.getSizeInBytes(c[e].componentDatatype);r[e]={pointer:a.createTypedArray(c[e].componentDatatype,q),index:p[e]/u,strideInComponentType:m/u}}for(b=0;b<g;++b)for(u=0;u<l;++u){e=h[u];f=c[e];var t=f.values;e=r[e];var y=e.pointer;f=f.componentsPerAttribute;for(var D=0;D<f;++D)y[e.index+D]=t[b*f+D];e.index+=e.strideInComponentType}return{buffer:q,offsetsInBytes:p,vertexSizeInBytes:m}}}y.fromGeometry=function(c){c=f(c,f.EMPTY_OBJECT);b.defined("options.context",c.context);var d=c.context,g=f(c.geometry,f.EMPTY_OBJECT),l=f(c.bufferUsage,t.DYNAMIC_DRAW),m=f(c.attributeLocations,f.EMPTY_OBJECT),r=f(c.interleave,!1);c=c.vertexArrayAttributes;var u,w;c=k(c)?c:[];var z=g.attributes;if(r){if(w=x(z),k(w)){var r=q.createVertexBuffer({context:d,typedArray:w.buffer,usage:l}),A=w.offsetsInBytes,D=w.vertexSizeInBytes;for(u in z)z.hasOwnProperty(u)&&k(z[u])&&(w=z[u],k(w.values)?c.push({index:m[u],vertexBuffer:r,componentDatatype:w.componentDatatype,componentsPerAttribute:w.componentsPerAttribute,normalize:w.normalize,offsetInBytes:A[u],strideInBytes:D}):c.push({index:m[u],value:w.value,componentDatatype:w.componentDatatype,normalize:w.normalize}))}}else for(u in z)z.hasOwnProperty(u)&&k(z[u])&&(w=z[u],A=w.componentDatatype,A===a.DOUBLE&&(A=a.FLOAT),r=void 0,k(w.values)&&(r=q.createVertexBuffer({context:d,typedArray:a.createTypedArray(A,w.values),usage:l})),c.push({index:m[u],vertexBuffer:r,value:w.value,componentDatatype:A,componentsPerAttribute:w.componentsPerAttribute,normalize:w.normalize}));var K,m=g.indices;k(m)&&(K=e.computeNumberOfVertices(g)>=p.SIXTY_FOUR_KILOBYTES&&d.elementIndexUint?q.createIndexBuffer({context:d,typedArray:new Uint32Array(m),usage:l,indexDatatype:h.UNSIGNED_INT}):q.createIndexBuffer({context:d,typedArray:new Uint16Array(m),usage:l,indexDatatype:h.UNSIGNED_SHORT}));return new y({context:d,attributes:c,indexBuffer:K})};g(y.prototype,{numberOfAttributes:{get:function(){return this._attributes.length}},numberOfVertices:{get:function(){return this._numberOfVertices}},indexBuffer:{get:function(){return this._indexBuffer}}});y.prototype.getAttribute=function(a){b.defined("index",a);return this._attributes[a]};y.prototype._bind=function(){if(k(this._vao)){this._context.glBindVertexArray(this._vao);if(this._context.instancedArrays){var a=this._context,c=this._hasInstancedAttributes;if(c||a._previousDrawInstanced){a._previousDrawInstanced=c;var b=a._vertexAttribDivisors,d=this._attributes,e=r.maximumVertexAttributes;if(c)for(e=d.length,c=0;c<e;++c){var f=d[c];if(f.enabled){var h=f.instanceDivisor,f=f.index;h!==b[f]&&(a.glVertexAttribDivisor(f,h),b[f]=h)}}else for(c=0;c<e;++c)0<b[c]&&(a.glVertexAttribDivisor(c,0),b[c]=0)}}if(this._hasConstantAttributes)for(a=this._gl,b=this._attributes,d=b.length,c=0;c<d;++c)e=b[c],e.enabled&&k(e.value)&&e.vertexAttrib(a)}else u(this._gl,this._attributes,this._indexBuffer)};y.prototype._unBind=function(){if(k(this._vao))this._context.glBindVertexArray(null);else{for(var a=this._attributes,c=this._gl,b=0;b<a.length;++b){var d=a[b];d.enabled&&d.disableVertexAttribArray(c)}this._indexBuffer&&c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null)}};y.prototype.isDestroyed=function(){return!1};y.prototype.destroy=function(){for(var a=this._attributes,c=0;c<a.length;++c){var b=a[c].vertexBuffer;k(b)&&!b.isDestroyed()&&b.vertexArrayDestroyable&&b.destroy()}a=this._indexBuffer;k(a)&&!a.isDestroyed()&&a.vertexArrayDestroyable&&a.destroy();k(this._vao)&&this._context.glDeleteVertexArray(this._vao);return l(this)};return y});F("Scene/BatchTable","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/combine ../Core/ComponentDatatype ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/FeatureDetection ../Core/Math ../Core/PixelFormat ../Renderer/ContextLimits ../Renderer/PixelDatatype ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(a,c,d){if(!l(a))throw new h("context is required");if(!l(c))throw new h("attributes is required");if(!l(d))throw new h("numberOfInstances is required");this._attributes=c;this._numberOfInstances=d;if(0!==c.length){var e;e=!1;for(var k=c.length,m=0;m<k;++m)if(c[m].componentDatatype!==g.UNSIGNED_BYTE){e=!0;break}e=e?r.FLOAT:r.UNSIGNED_BYTE;a=a.floatingPointTexture;a=e===r.FLOAT&&!a;for(var k=Array(c.length),m=0,p=c.length,q=0;q<p;++q){var u=c[q].componentDatatype;k[q]=m;u!==g.UNSIGNED_BYTE&&a?m+=4:++m}m=k.length;p=k[m-1];c=c[m-1].componentDatatype!==g.UNSIGNED_BYTE&&a?p+4:p+1;p=Math.min(d,Math.floor(t.maximumTextureSize/c));m=c*p;d=Math.ceil(d/p);var p=1/m,q=.5*p,u=1/d,v=.5*u;this._textureDimensions=new b(m,d);this._textureStep=new f(p,q,u,v);this._pixelDatatype=a?r.UNSIGNED_BYTE:e;this._packFloats=a;this._offsets=k;this._stride=c;this._texture=void 0;d*=4*m;this._batchValues=e!==r.FLOAT||a?new Uint8Array(d):new Float32Array(d);this._batchValuesDirty=!1}}function x(c,d){var e=c[d].componentsPerAttribute;return 2===e?b:3===e?a:4===e?f:Number}function D(a){var c=a._stride;return 1===a._textureDimensions.y?"uniform vec4 batchTextureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX \x3d batchTextureStep.x; \n    float centerX \x3d batchTextureStep.y; \n    float numberOfAttributes \x3d float("+c+"); \n    return vec2(centerX + (batchId * numberOfAttributes * stepX), 0.5); \n} \n":"uniform vec4 batchTextureStep; \nuniform vec2 batchTextureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX \x3d batchTextureStep.x; \n    float centerX \x3d batchTextureStep.y; \n    float stepY \x3d batchTextureStep.z; \n    float centerY \x3d batchTextureStep.w; \n    float numberOfAttributes \x3d float("+c+"); \n    float xId \x3d mod(batchId * numberOfAttributes, batchTextureDimensions.x); \n    float yId \x3d floor(batchId * numberOfAttributes / batchTextureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n"}function v(a,c){var b=a._attributes[c],d=b.componentsPerAttribute,e=b.functionName,f;f=1===d?"float":"vec"+d;e=f+" "+e+"(float batchId) \n{ \n    vec2 st \x3d computeSt(batchId); \n    st.x +\x3d batchTextureStep.x * float("+a._offsets[c]+"); \n";e=a._packFloats&&b.componentDatatype!==r.UNSIGNED_BYTE?e+"vec4 textureValue; \ntextureValue.x \x3d czm_unpackFloat(texture2D(batchTexture, st)); \ntextureValue.y \x3d czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x, 0.0))); \ntextureValue.z \x3d czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 2.0, 0.0))); \ntextureValue.w \x3d czm_unpackFloat(texture2D(batchTexture, st + vec2(batchTextureStep.x * 3.0, 0.0))); \n":e+"    vec4 textureValue \x3d texture2D(batchTexture, st); \n";e+="    "+f+" value \x3d textureValue"+(1===d?".x":2===d?".xy":3===d?".xyz":"")+"; \n";a._pixelDatatype!==r.UNSIGNED_BYTE||b.componentDatatype!==g.UNSIGNED_BYTE||b.normalize?a._pixelDatatype===r.FLOAT&&b.componentDatatype===g.UNSIGNED_BYTE&&b.normalize&&(e+="value /\x3d 255.0; \n"):e+="value *\x3d 255.0; \n";return e+"    return value; \n} \n"}m(z.prototype,{attributes:{get:function(){return this._attributes}},numberOfInstances:{get:function(){return this._numberOfInstances}}});var B=new f;if(p.supportsTypedArrays()){var C=new f;z.prototype.getBatchedAttribute=function(a,c,b){if(0>a||a>=this._numberOfInstances)throw new h("instanceIndex is out of range.");if(0>c||c>=this._attributes.length)throw new h("attributeIndex is out of range");var d=this._attributes,e=4*this._stride*a+4*this._offsets[c];if(this._packFloats&&d[c].componentDatatype!==r.UNSIGNED_BYTE){var g=this._batchValues,k=f.unpack(g,e,B);a=f.unpackFloat(k);var k=f.unpack(g,e+4,B),m=f.unpackFloat(k),k=f.unpack(g,e+8,B),p=f.unpackFloat(k),k=f.unpack(g,e+12,B),e=f.unpackFloat(k);a=f.fromElements(a,m,p,e,C)}else a=f.unpack(this._batchValues,e,C);c=x(d,c);return l(c.fromCartesian4)?c.fromCartesian4(a,b):l(c.clone)?c.clone(a,b):a.x};var I=[void 0,void 0,new b,new a,new f],H=new f;z.prototype.setBatchedAttribute=function(a,c,b){if(0>a||a>=this._numberOfInstances)throw new h("instanceIndex is out of range.");if(0>c||c>=this._attributes.length)throw new h("attributeIndex is out of range");if(!l(b))throw new h("value is required.");var d=this._attributes,e=this.getBatchedAttribute(a,c,I[d[c].componentsPerAttribute]),g=x(this._attributes,c);(l(g.equals)?g.equals(e,b):e===b)||(H.x=l(b.x)?b.x:b,H.y=l(b.y)?b.y:0,H.z=l(b.z)?b.z:0,H.w=l(b.w)?b.w:0,a=4*this._stride*a+4*this._offsets[c],this._packFloats&&d[c].componentDatatype!==r.UNSIGNED_BYTE?(c=this._batchValues,d=f.packFloat(H.x,B),f.pack(d,c,a),d=f.packFloat(H.y,d),f.pack(d,c,a+4),d=f.packFloat(H.z,d),f.pack(d,c,a+8),d=f.packFloat(H.w,d),f.pack(d,c,a+12)):f.pack(H,this._batchValues,a),this._batchValuesDirty=!0)};z.prototype.update=function(a){if((!l(this._texture)||this._batchValuesDirty)&&0!==this._attributes.length){this._batchValuesDirty=!1;if(!l(this._texture)){var b=this._textureDimensions;this._texture=new u({context:a.context,pixelFormat:q.RGBA,pixelDatatype:this._pixelDatatype,width:b.x,height:b.y,sampler:new c({minificationFilter:A.NEAREST,magnificationFilter:y.NEAREST}),flipY:!1})}a=this._textureDimensions;this._texture.copyFrom({width:a.x,height:a.y,arrayBufferView:this._batchValues})}};z.prototype.getUniformMapCallback=function(){var a=this;return function(c){return 0===a._attributes.length?c:k(c,{batchTexture:function(){return a._texture},batchTextureDimensions:function(){return a._textureDimensions},batchTextureStep:function(){return a._textureStep}})}};z.prototype.getVertexShaderCallback=function(){var a=this._attributes;if(0===a.length)return function(a){return a};for(var c="uniform sampler2D batchTexture; \n",c=c+(D(this)+"\n"),a=a.length,b=0;b<a;++b)c+=v(this,b);return function(a){var b=a.indexOf("void main"),d=a.substring(0,b);a=a.substring(b);return d+"\n"+c+"\n"+a}};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){this._texture=this._texture&&this._texture.destroy();return e(this)};return z}});F("Scene/PrimitivePipeline","../Core/BoundingSphere ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Core/Ellipsoid ../Core/FeatureDetection ../Core/GeographicProjection ../Core/Geometry ../Core/GeometryAttribute ../Core/GeometryAttributes ../Core/GeometryPipeline ../Core/IndexDatatype ../Core/Matrix4 ../Core/OffsetGeometryInstanceAttribute ../Core/WebMercatorProjection".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(c,b){var d=c.attributes,e=d.position,e=e.values.length/e.componentsPerAttribute;d.batchId=new p({componentDatatype:a.FLOAT,componentsPerAttribute:1,values:new Float32Array(e)});for(var d=d.batchId.values,f=0;f<e;++f)d[f]=b}function A(a,c,b,d){var e,f,h;e=d.length-1;0<=e?(f=d[e],e=f.offset+f.count,h=f.index):h=e=0;f=b[h].indices.length;for(var g=a.length,l=0;l<g;++l){var m=a[l][c];k(m)&&(m=m.indices.length,e+m>f&&(e=0,f=b[++h].indices.length),d.push({index:h,offset:e,count:m}),e+=m)}}function z(a){var c=a.length,d=new Float32Array(1+(b.packedLength+1)*c),e=0;d[e++]=c;for(var f=0;f<c;++f)k(a[f])?(d[e++]=1,b.pack(a[f],d,e)):d[e++]=0,e+=b.packedLength;return d}function x(a){for(var c=Array(a[0]),d=0,e=1;e<a.length;)1===a[e++]&&(c[d]=b.unpack(a,e)),++d,e+=b.packedLength;return c}if(!m.supportsTypedArrays())return{};var D={combineGeometry:function(c){var d,e,f=c.instances,h=f.length,l,m,p=!1;if(0<h){var u=c.instances,v=c.projection,t=c.elementIndexUintSupported,z=c.scene3DOnly,D=c.vertexCacheOptimize,x=c.compressVertices,Z=c.modelMatrix,aa,U;d=u.length;for(aa=0;aa<d;++aa)if(k(u[aa].geometry)){U=u[aa].geometry.primitiveType;break}for(aa=1;aa<d;++aa)if(k(u[aa].geometry)&&u[aa].geometry.primitiveType!==U)throw new g("All instance geometries must have the same primitiveType.");aa=!z;U=u.length;var W;if(!aa&&1<U){var M=u[0].modelMatrix;for(W=1;W<U;++W)if(!r.equals(M,u[W].modelMatrix)){aa=!0;break}}if(aa)for(W=0;W<U;++W)k(u[W].geometry)&&q.transformToWorldCoordinates(u[W]);else r.multiplyTransformation(Z,u[0].modelMatrix,Z);if(!z)for(aa=0;aa<d;++aa)k(u[aa].geometry)&&q.splitLongitude(u[aa]);aa=u.length;for(Z=0;Z<aa;++Z)U=u[Z],k(U.geometry)?y(U.geometry,Z):k(U.westHemisphereGeometry)&&k(U.eastHemisphereGeometry)&&(y(U.westHemisphereGeometry,Z),y(U.eastHemisphereGeometry,Z));if(D)for(aa=0;aa<d;++aa)D=u[aa],k(D.geometry)?(q.reorderForPostVertexCache(D.geometry),q.reorderForPreVertexCache(D.geometry)):k(D.westHemisphereGeometry)&&k(D.eastHemisphereGeometry)&&(q.reorderForPostVertexCache(D.westHemisphereGeometry),q.reorderForPreVertexCache(D.westHemisphereGeometry),q.reorderForPostVertexCache(D.eastHemisphereGeometry),q.reorderForPreVertexCache(D.eastHemisphereGeometry));D=q.combineInstances(u);d=D.length;for(aa=0;aa<d;++aa){var u=D[aa],Z=u.attributes,R;if(z)for(R in Z)Z.hasOwnProperty(R)&&Z[R].componentDatatype===a.DOUBLE&&q.encodeAttribute(u,R,R+"3DHigh",R+"3DLow");else for(R in Z)Z.hasOwnProperty(R)&&Z[R].componentDatatype===a.DOUBLE&&(U=R+"3D",W=R+"2D",q.projectTo2D(u,R,U,W,v),k(u.boundingSphere)&&"position"===R&&(u.boundingSphereCV=b.fromVertices(u.attributes.position2D.values)),q.encodeAttribute(u,U,U+"High",U+"Low"),q.encodeAttribute(u,W,W+"High",W+"Low"));x&&q.compressVertices(u)}if(!t){R=[];d=D.length;for(aa=0;aa<d;++aa)u=D[aa],R=R.concat(q.fitToUnsignedShortIndices(u));D=R}d=D;0<d.length&&(e=q.createAttributeLocations(d[0]),c.createPickOffsets&&(l=d,R=[],A(f,"geometry",l,R),A(f,"westHemisphereGeometry",l,R),A(f,"eastHemisphereGeometry",l,R),l=R));k(f[0].attributes)&&k(f[0].attributes.offset)&&(m=Array(h),p=!0)}R=Array(h);v=Array(h);for(t=0;t<h;++t)z=f[t],x=z.geometry,k(x)&&(R[t]=x.boundingSphere,v[t]=x.boundingSphereCV,p&&(m[t]=z.geometry.offsetAttribute)),x=z.eastHemisphereGeometry,z=z.westHemisphereGeometry,k(x)&&k(z)&&(k(x.boundingSphere)&&k(z.boundingSphere)&&(R[t]=b.union(x.boundingSphere,z.boundingSphere)),k(x.boundingSphereCV)&&k(z.boundingSphereCV)&&(v[t]=b.union(x.boundingSphereCV,z.boundingSphereCV)));return{geometries:d,modelMatrix:c.modelMatrix,attributeLocations:e,pickOffsets:l,offsetInstanceExtend:m,boundingSpheres:R,boundingSpheresCV:v}},packCreateGeometryResults:function(a,c){for(var d=Float64Array,e=1,h=a.length,g=0;g<h;g++){var l=a[g];++e;if(k(l)){var m=l.attributes,e=e+(7+2*b.packedLength+(k(l.indices)?l.indices.length:0)),p;for(p in m)m.hasOwnProperty(p)&&k(m[p])&&(e+=5+m[p].values.length)}}d=new d(e);e=[];h={};g=a.length;l=0;d[l++]=g;for(m=0;m<g;m++){p=a[m];var q=k(p);d[l++]=q?1:0;if(q){d[l++]=p.primitiveType;d[l++]=p.geometryType;d[l++]=f(p.offsetAttribute,-1);q=k(p.boundingSphere)?1:0;(d[l++]=q)&&b.pack(p.boundingSphere,d,l);l+=b.packedLength;q=k(p.boundingSphereCV)?1:0;(d[l++]=q)&&b.pack(p.boundingSphereCV,d,l);var l=l+b.packedLength,q=p.attributes,u=[],r;for(r in q)q.hasOwnProperty(r)&&k(q[r])&&(u.push(r),k(h[r])||(h[r]=e.length,e.push(r)));d[l++]=u.length;for(var v=0;v<u.length;v++){var t=u[v],y=q[t];d[l++]=h[t];d[l++]=y.componentDatatype;d[l++]=y.componentsPerAttribute;d[l++]=y.normalize?1:0;d[l++]=y.values.length;d.set(y.values,l);l+=y.values.length}q=k(p.indices)?p.indices.length:0;d[l++]=q;0<q&&(d.set(p.indices,l),l+=q)}}c.push(d.buffer);return{stringTable:e,packedData:d}},unpackCreateGeometryResults:function(c){var e=c.stringTable;c=c.packedData;for(var f,g=Array(c[0]),k=0,l=1;l<c.length;)if(1!==c[l++])g[k++]=void 0;else{var m=c[l++],q=c[l++],u=c[l++];-1===u&&(u=void 0);var r,v;1===c[l++]&&(r=b.unpack(c,l));l+=b.packedLength;1===c[l++]&&(v=b.unpack(c,l));var l=l+b.packedLength,y,z,A,D=new d,x=c[l++];for(f=0;f<x;f++){var U=e[c[l++]],W=c[l++];A=c[l++];var M=0!==c[l++];y=c[l++];z=a.createTypedArray(W,y);for(var R=0;R<y;R++)z[R]=c[l++];D[U]=new p({componentDatatype:W,componentsPerAttribute:A,normalize:M,values:z})}var Y;y=c[l++];if(0<y)for(Y=t.createTypedArray(z.length/A,y),f=0;f<y;f++)Y[f]=c[l++];g[k++]=new h({primitiveType:m,geometryType:q,boundingSphere:r,boundingSphereCV:v,indices:Y,attributes:D,offsetAttribute:u})}return g},packCombineGeometryParameters:function(a,c){for(var b=a.createGeometryResults,d=b.length,f=0;f<d;f++)c.push(b[f].packedData.buffer);var b=a.createGeometryResults,d=a.instances,f=d.length,h=new Float64Array(1+19*f),g=0;h[g++]=f;for(var l=0;l<f;l++){var m=d[l];r.pack(m.modelMatrix,h,g);g+=r.packedLength;k(m.attributes)&&k(m.attributes.offset)&&(m=m.attributes.offset.value,h[g]=m[0],h[g+1]=m[1],h[g+2]=m[2]);g+=3}c.push(h.buffer);return{createGeometryResults:b,packedInstances:h,ellipsoid:a.ellipsoid,isGeographic:a.projection instanceof e,elementIndexUintSupported:a.elementIndexUintSupported,scene3DOnly:a.scene3DOnly,vertexCacheOptimize:a.vertexCacheOptimize,compressVertices:a.compressVertices,modelMatrix:a.modelMatrix,createPickOffsets:a.createPickOffsets}},unpackCombineGeometryParameters:function(a){for(var b=a.packedInstances,d=Array(b[0]),f=0,h=1;h<b.length;){var g=r.unpack(b,h),m,h=h+r.packedLength;k(b[h])&&(m={offset:new c(b[h],b[h+1],b[h+2])});h+=3;d[f++]={modelMatrix:g,attributes:m}}b=a.createGeometryResults;f=b.length;for(g=h=0;g<f;g++){m=D.unpackCreateGeometryResults(b[g]);for(var p=m.length,q=0;q<p;q++)d[h].geometry=m[q],++h}b=l.clone(a.ellipsoid);f=a.isGeographic?new e(b):new u(b);return{instances:d,ellipsoid:b,projection:f,elementIndexUintSupported:a.elementIndexUintSupported,scene3DOnly:a.scene3DOnly,vertexCacheOptimize:a.vertexCacheOptimize,compressVertices:a.compressVertices,modelMatrix:r.clone(a.modelMatrix),createPickOffsets:a.createPickOffsets}},packCombineGeometryResults:function(a,c){if(k(a.geometries))for(var b=a.geometries,d=b.length,e=0;e<d;++e){var f=b[e],h=c,g=f.attributes,l=void 0;for(l in g)if(g.hasOwnProperty(l)){var m=g[l];k(m)&&k(m.values)&&h.push(m.values.buffer)}k(f.indices)&&h.push(f.indices.buffer)}b=z(a.boundingSpheres);d=z(a.boundingSpheresCV);c.push(b.buffer,d.buffer);return{geometries:a.geometries,attributeLocations:a.attributeLocations,modelMatrix:a.modelMatrix,pickOffsets:a.pickOffsets,offsetInstanceExtend:a.offsetInstanceExtend,boundingSpheres:b,boundingSpheresCV:d}},unpackCombineGeometryResults:function(a){return{geometries:a.geometries,attributeLocations:a.attributeLocations,modelMatrix:a.modelMatrix,pickOffsets:a.pickOffsets,offsetInstanceExtend:a.offsetInstanceExtend,boundingSpheres:x(a.boundingSpheres),boundingSpheresCV:x(a.boundingSpheresCV)}}};return D});F("Scene/PrimitiveState",["../Core/freezeObject"],function(b){return b({READY:0,CREATING:1,CREATED:2,COMBINING:3,COMBINED:4,COMPLETE:5,FAILED:6})});F("Scene/Primitive","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/clone ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/FeatureDetection ../Core/Geometry ../Core/GeometryAttribute ../Core/GeometryAttributes ../Core/GeometryOffsetAttribute ../Core/Intersect ../Core/isArray ../Core/Matrix4 ../Core/Plane ../Core/RuntimeError ../Core/subdivideArray ../Core/TaskProcessor ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../ThirdParty/when ./BatchTable ./CullFace ./DepthFunction ./PrimitivePipeline ./PrimitiveState ./SceneMode ./ShadowMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q){function S(a){a=p(a,p.EMPTY_OBJECT);this.geometryInstances=a.geometryInstances;this.appearance=a.appearance;this._material=this._appearance=void 0;this.depthFailAppearance=a.depthFailAppearance;this._depthFailMaterial=this._depthFailAppearance=void 0;this.modelMatrix=B.clone(p(a.modelMatrix,B.IDENTITY));this._modelMatrix=new B;this.show=p(a.show,!0);this._vertexCacheOptimize=p(a.vertexCacheOptimize,!1);this._interleave=p(a.interleave,!1);this._releaseGeometryInstances=p(a.releaseGeometryInstances,!0);this._allowPicking=p(a.allowPicking,!0);this._asynchronous=p(a.asynchronous,!0);this._compressVertices=p(a.compressVertices,!0);this.cull=p(a.cull,!0);this.debugShowBoundingVolume=p(a.debugShowBoundingVolume,!1);this.rtcCenter=a.rtcCenter;if(d(this.rtcCenter)&&(!d(this.geometryInstances)||v(this.geometryInstances)&&1!==this.geometryInstances))throw new r("Relative-to-center rendering only supports one geometry instance.");this.shadows=p(a.shadows,Q.DISABLED);this._translucent=void 0;this._state=R.READY;this._geometries=[];this._error=void 0;this._numberOfInstances=0;this._boundingSpheres=[];this._boundingSphereWC=[];this._boundingSphereCV=[];this._boundingSphere2D=[];this._boundingSphereMorph=[];this._perInstanceAttributeCache=[];this._instanceIds=[];this._lastPerInstanceAttributeIndex=0;this._va=[];this._backFaceDepthFailRS=this._frontFaceDepthFailRS=this._spDepthFail=this._depthFailAppearance=this._sp=this._backFaceRS=this._frontFaceRS=this._primitiveType=this._attributeLocations=void 0;this._pickIds=[];this._colorCommands=[];this._pickCommands=[];this._readOnlyInstanceAttributes=a._readOnlyInstanceAttributes;this._createBoundingVolumeFunction=a._createBoundingVolumeFunction;this._createRenderStatesFunction=a._createRenderStatesFunction;this._createShaderProgramFunction=a._createShaderProgramFunction;this._createCommandsFunction=a._createCommandsFunction;this._updateAndQueueCommandsFunction=a._updateAndQueueCommandsFunction;this._createPickOffsets=a._createPickOffsets;this._createGeometryResults=this._pickOffsets=void 0;this._ready=!1;this._readyPromise=Z.defer();this._batchTableOffsetAttribute2DIndex=this._offsetInstanceExtend=this._batchTableAttributeIndices=this._batchTable=void 0;this._batchTableOffsetsUpdated=!1;this._tempBoundingSpheres=this._instanceBoundingSpheresCV=this._instanceBoundingSpheres=void 0;this._batchTableBoundingSpheresUpdated=this._recomputeBoundingSpheres=!1;this._batchTableBoundingSphereAttributeIndices=void 0}function ca(c){var b=c.length;if(1===b)return c[0];if(2===b)return a.unpack(c,0,wa);if(3===b)return f.unpack(c,0,za);if(4===b)return k.unpack(c,0,Da)}function T(a){return N.replaceMain(a,"czm_non_pick_main")+"\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor \x3d czm_batchTable_pickColor(batchId); \n}"}function da(a,c){if(!a.compressVertices)return c;var b=-1!==c.search(/attribute\s+vec3\s+normal;/g),d=-1!==c.search(/attribute\s+vec2\s+st;/g);if(!b&&!d)return c;var e=-1!==c.search(/attribute\s+vec3\s+tangent;/g),f=-1!==c.search(/attribute\s+vec3\s+bitangent;/g),h;h=(d&&b?2:1)+(e||f?1:0);var g="attribute "+(1<h?"vec"+h:"float")+" compressedAttributes;",k="",l="";d&&(k+="vec2 st;\n",l+="    st \x3d czm_decompressTextureCoordinates("+(1<h?"compressedAttributes.x":"compressedAttributes")+");\n");b&&e&&f?(k+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",l+="    czm_octDecode(compressedAttributes."+(d?"yz":"xy")+", normal, tangent, bitangent);\n"):(b&&(k+="vec3 normal;\n",l+="    normal \x3d czm_octDecode(compressedAttributes"+(1<h?"."+(d?"y":"x"):"")+");\n"),e&&(k+="vec3 tangent;\n",l+="    tangent \x3d czm_octDecode(compressedAttributes."+(d&&b?"z":"y")+");\n"),f&&(k+="vec3 bitangent;\n",l+="    bitangent \x3d czm_octDecode(compressedAttributes."+(d&&b?"z":"y")+");\n"));b=c.replace(/attribute\s+vec3\s+normal;/g,"");b=b.replace(/attribute\s+vec2\s+st;/g,"");b=b.replace(/attribute\s+vec3\s+tangent;/g,"");b=b.replace(/attribute\s+vec3\s+bitangent;/g,"");b=N.replaceMain(b,"czm_non_compressed_main");return[g,k,b,"void main() \n{ \n"+l+"    czm_non_compressed_main(); \n}"].join("\n")}function V(a,c){var b=a.vertexAttributes,e;for(e in b)if(b.hasOwnProperty(e)&&!d(c[e]))throw new r("Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '"+e+"', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.");}function ba(a,c){return function(){return a[c]}}function X(a,c){var b,e,f,h=a._instanceIds;if(a._state===R.READY){b=v(a.geometryInstances)?a.geometryInstances:[a.geometryInstances];var g=a._numberOfInstances=b.length,k=[],l=[];for(f=0;f<g;++f){e=b[f].geometry;h.push(b[f].id);if(!d(e._workerName))throw new r("_workerName must be defined for asynchronous geometry.");l.push({moduleName:e._workerName,geometry:e})}if(!d(Ea))for(Ea=Array(ra),f=0;f<ra;f++)Ea[f]=new J("createGeometry",Number.POSITIVE_INFINITY);l=H(l,ra);for(f=0;f<l.length;f++){var m=0,g=l[f],q=g.length;for(b=0;b<q;++b)h=g[b],e=h.geometry,d(e.constructor.pack)&&(h.offset=m,m+=p(e.constructor.packedLength,e.packedLength));var u;if(0<m)for(m=new Float64Array(m),u=[m.buffer],b=0;b<q;++b)h=g[b],e=h.geometry,d(e.constructor.pack)&&(e.constructor.pack(e,m,h.offset),h.geometry=m);k.push(Ea[f].scheduleTask({subTasks:l[f]},u))}a._state=R.CREATING;Z.all(k,function(c){a._createGeometryResults=c;a._state=R.CREATED}).otherwise(function(b){ta(a,c,R.FAILED,b)})}else a._state===R.CREATED&&(e=[],b=v(a.geometryInstances)?a.geometryInstances:[a.geometryInstances],f=c.mapProjection,e=Ga.scheduleTask(M.packCombineGeometryParameters({createGeometryResults:a._createGeometryResults,instances:b,ellipsoid:f.ellipsoid,projection:f,elementIndexUintSupported:c.context.elementIndexUint,scene3DOnly:c.scene3DOnly,vertexCacheOptimize:a.vertexCacheOptimize,compressVertices:a.compressVertices,modelMatrix:a.modelMatrix,createPickOffsets:a._createPickOffsets},e),e),a._createGeometryResults=void 0,a._state=R.COMBINING,Z(e,function(b){b=M.unpackCombineGeometryResults(b);a._geometries=b.geometries;a._attributeLocations=b.attributeLocations;a.modelMatrix=B.clone(b.modelMatrix,a.modelMatrix);a._pickOffsets=b.pickOffsets;a._offsetInstanceExtend=b.offsetInstanceExtend;a._instanceBoundingSpheres=b.boundingSpheres;a._instanceBoundingSpheresCV=b.boundingSpheresCV;d(a._geometries)&&0<a._geometries.length?(a._recomputeBoundingSpheres=!0,a._state=R.COMBINED):ta(a,c,R.FAILED,void 0)}).otherwise(function(b){ta(a,c,R.FAILED,b)}))}function fa(a,c){if(d(a._batchTableAttributeIndices.offset)&&!a._batchTableOffsetsUpdated&&!c.scene3DOnly){for(var e=a._batchTableOffsetAttribute2DIndex,h=c.mapProjection,g=h.ellipsoid,k=a._batchTable,l=a._instanceBoundingSpheres,m=l.length,p=0;p<m;++p){var q=l[p];if(d(q)){var u=k.getBatchedAttribute(p,a._batchTableAttributeIndices.offset);if(f.equals(u,f.ZERO))k.setBatchedAttribute(p,e,f.ZERO);else{var r=a.modelMatrix;d(r)&&(q=b.transform(q,r,Ua));var v=q.center,v=g.scaleToGeodeticSurface(v,Va),r=g.cartesianToCartographic(v,ya),q=h.project(r,Aa),u=f.add(u,v,sa),r=g.cartesianToCartographic(u,r),u=h.project(r,sa),u=f.subtract(u,q,sa),q=u.x;u.x=u.z;u.z=u.y;u.y=q;k.setBatchedAttribute(p,e,u)}}}a._batchTableOffsetsUpdated=!0}}function ga(a,c,b,e){c=b.getRenderState();e?(b=l(c,!1),b.cull={enabled:!0,face:U.BACK},a._frontFaceRS=K.fromCache(b),b.cull.face=U.FRONT,a._backFaceRS=K.fromCache(b)):(a._frontFaceRS=K.fromCache(c),a._backFaceRS=a._frontFaceRS);b=l(c,!1);d(a._depthFailAppearance)&&(b.depthTest.enabled=!1);d(a._depthFailAppearance)&&(c=a._depthFailAppearance.getRenderState(),b=l(c,!1),b.depthTest.func=W.GREATER,e?(b.cull={enabled:!0,face:U.BACK},a._frontFaceDepthFailRS=K.fromCache(b),b.cull.face=U.FRONT,a._backFaceDepthFailRS=K.fromCache(b)):(a._frontFaceDepthFailRS=K.fromCache(b),a._backFaceDepthFailRS=a._frontFaceRS))}function F(a,c,b){var e=c.context,f=a._attributeLocations,h=a._batchTable.getVertexShaderCallback()(b.vertexShaderSource),h=S._appendOffsetToShader(a,h),h=S._appendShowToShader(a,h),h=S._appendDistanceDisplayConditionToShader(a,h,c.scene3DOnly),h=T(h),h=S._updateColorAttribute(a,h,!1),h=da(a,h),h=S._modifyShaderPosition(a,h,c.scene3DOnly);b=b.getFragmentShaderSource();a._sp=P.replaceCache({context:e,shaderProgram:a._sp,vertexShaderSource:h,fragmentShaderSource:"varying vec4 v_pickColor;\n"+b,attributeLocations:f});V(a._sp,f);d(a._depthFailAppearance)&&(h=a._batchTable.getVertexShaderCallback()(a._depthFailAppearance.vertexShaderSource),h=S._appendShowToShader(a,h),h=S._appendDistanceDisplayConditionToShader(a,h,c.scene3DOnly),h=T(h),h=S._updateColorAttribute(a,h,!0),h=da(a,h),h=S._modifyShaderPosition(a,h,c.scene3DOnly),h=N.replaceMain(h,"czm_non_depth_clamp_main")+"varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n    vec4 position \x3d gl_Position;\n    v_WindowZ \x3d (0.5 * (position.z / position.w) + 0.5) * position.w;\n    position.z \x3d min(position.z, position.w);\n    gl_Position \x3d position;\n}\n",b=a._depthFailAppearance.getFragmentShaderSource(),b="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+(N.replaceMain("varying vec4 v_pickColor;\n"+b,"czm_non_depth_clamp_main")+"varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth) \x26\x26 !defined(LOG_DEPTH)\n    gl_FragDepthEXT \x3d min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n"),a._spDepthFail=P.replaceCache({context:e,shaderProgram:a._spDepthFail,vertexShaderSource:h,fragmentShaderSource:b,attributeLocations:f}),V(a._spDepthFail,f))}function na(a,c,b,f){b=d(b)?b._uniforms:void 0;var h={};c=c.uniforms;if(d(c))for(var g in c)if(c.hasOwnProperty(g)){if(d(b)&&d(b[g]))throw new r("Appearance and material have a uniform with the same name: "+g);h[g]=ba(c,g)}g=e(h,b);g=a._batchTable.getUniformMapCallback()(g);d(a.rtcCenter)&&(g.u_modifiedModelView=function(){B.multiply(f.context.uniformState.view,a._modelMatrix,xa);B.multiplyByPoint(xa,a.rtcCenter,Ha);B.setTranslation(xa,Ha,xa);return xa});return g}function ia(a,c,b,e,f,h,g,k){c=na(a,c,b,k);var l;d(a._depthFailAppearance)&&(l=na(a,a._depthFailAppearance,a._depthFailAppearance.material,k));e=e?L.TRANSLUCENT:L.OPAQUE;k=(f?2:1)*(d(a._depthFailAppearance)?2:1);h.length=a._va.length*k;k=h.length;for(g=b=0;g<k;++g){var m;f&&(m=h[g],d(m)||(m=h[g]=new E({owner:a,primitiveType:a._primitiveType})),m.vertexArray=a._va[b],m.renderState=a._backFaceRS,m.shaderProgram=a._sp,m.uniformMap=c,m.pass=e,++g);m=h[g];d(m)||(m=h[g]=new E({owner:a,primitiveType:a._primitiveType}));m.vertexArray=a._va[b];m.renderState=a._frontFaceRS;m.shaderProgram=a._sp;m.uniformMap=c;m.pass=e;d(a._depthFailAppearance)&&(f&&(++g,m=h[g],d(m)||(m=h[g]=new E({owner:a,primitiveType:a._primitiveType})),m.vertexArray=a._va[b],m.renderState=a._backFaceDepthFailRS,m.shaderProgram=a._spDepthFail,m.uniformMap=l,m.pass=e),++g,m=h[g],d(m)||(m=h[g]=new E({owner:a,primitiveType:a._primitiveType})),m.vertexArray=a._va[b],m.renderState=a._frontFaceDepthFailRS,m.shaderProgram=a._spDepthFail,m.uniformMap=l,m.pass=e);++b}}function la(a,c,b,e,f,h,g,k){if(c.mode!==Y.SCENE3D&&!B.equals(f,B.IDENTITY))throw new r("Primitive.modelMatrix is only supported in 3D mode.");S._updateBoundingVolumes(a,c,f);var l;c.mode===Y.SCENE3D?l=a._boundingSphereWC:c.mode===Y.COLUMBUS_VIEW?l=a._boundingSphereCV:c.mode===Y.SCENE2D&&d(a._boundingSphere2D)?l=a._boundingSphere2D:d(a._boundingSphereMorph)&&(l=a._boundingSphereMorph);e=c.commandList;c=c.passes;if(c.render||c.pick){c=a.allowPicking;var m=Q.castShadows(a.shadows),p=Q.receiveShadows(a.shadows),q=b.length;a=(k?2:1)*(d(a._depthFailAppearance)?2:1);for(k=0;k<q;++k){var u=Math.floor(k/a),v=b[k];v.modelMatrix=f;v.boundingVolume=l[u];v.cull=h;v.debugShowBoundingVolume=g;v.castShadows=m;v.receiveShadows=p;v.pickId=c?"v_pickColor":void 0;e.push(v)}}}function ha(a,c,d){if(d===x.TOP){d=b.clone(a,Ma);var e=b.clone(a,Ia);e.center=f.add(e.center,c,e.center);a=b.union(d,e,a)}else d===x.ALL&&(a.center=f.add(a.center,c,a.center));return a}function pa(a,c,b){return function(){var e=a.getBatchedAttribute(c,b),f=a.attributes[b],f=h.createTypedArray(f.componentDatatype,f.componentsPerAttribute);d(e.constructor.pack)?e.constructor.pack(e,f,0):f[0]=e;return f}}function oa(a,c,b,e,f){return function(h){if(!d(h)||!d(h.length)||1>h.length||4<h.length)throw new r("value must be and array with length between 1 and 4.");h=ca(h);a.setBatchedAttribute(c,b,h);"offset"===f&&(e._recomputeBoundingSpheres=!0,e._batchTableOffsetsUpdated=!1)}}function qa(a,c,e){c.boundingSphere={get:function(){var h=a._instanceBoundingSpheres[e];if(d(h)){var h=h.clone(),g=a.modelMatrix,k=c.offset;d(k)&&ha(h,f.fromArray(k.get(),0,La),a._offsetInstanceExtend[e]);d(g)&&(h=b.transform(h,g))}return h}};c.boundingSphereCV={get:function(){return a._instanceBoundingSpheresCV[e]}}}function ua(a,c,b){c.pickId={get:function(){return a._pickIds[b]}}}function ta(a,c,b,e){a._error=e;a._state=b;c.afterRender.push(function(){a._ready=a._state===R.COMPLETE||a._state===R.FAILED;d(e)?a._readyPromise.reject(e):a._readyPromise.resolve(a)})}q(S.prototype,{vertexCacheOptimize:{get:function(){return this._vertexCacheOptimize}},interleave:{get:function(){return this._interleave}},releaseGeometryInstances:{get:function(){return this._releaseGeometryInstances}},allowPicking:{get:function(){return this._allowPicking}},asynchronous:{get:function(){return this._asynchronous}},compressVertices:{get:function(){return this._compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});var wa=new a,za=new f,Da=new k,Ba=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;S._modifyShaderPosition=function(a,c,b){for(var e,f="",h="",g="";null!==(e=Ba.exec(c));){e=e[1];var k="vec4 czm_compute"+e[0].toUpperCase()+e.substr(1)+"()";"vec4 czm_computePosition()"!==k&&(f+=k+";\n");d(a.rtcCenter)?(c=c.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,""),c=c.replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,""),f+="uniform mat4 u_modifiedModelView;\n",h+="attribute vec4 position;\n",g+=k+"\n{\n    return u_modifiedModelView * position;\n}\n\n",c=c.replace(/czm_modelViewRelativeToEye\s+\*\s+/g,""),c=c.replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):b?g+=k+"\n{\n    return czm_translateRelativeToEye("+e+"3DHigh, "+e+"3DLow);\n}\n\n":(h+="attribute vec3 "+e+"2DHigh;\nattribute vec3 "+e+"2DLow;\n",g+=k+"\n{\n    vec4 p;\n    if (czm_morphTime \x3d\x3d 1.0)\n    {\n        p \x3d czm_translateRelativeToEye("+e+"3DHigh, "+e+"3DLow);\n    }\n    else if (czm_morphTime \x3d\x3d 0.0)\n    {\n        p \x3d czm_translateRelativeToEye("+e+"2DHigh.zxy, "+e+"2DLow.zxy);\n    }\n    else\n    {\n        p \x3d czm_columbusViewMorph(\n                czm_translateRelativeToEye("+e+"2DHigh.zxy, "+e+"2DLow.zxy),\n                czm_translateRelativeToEye("+e+"3DHigh, "+e+"3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n")}return[f,h,c,g].join("\n")};S._appendShowToShader=function(a,c){return d(a._batchTableAttributeIndices.show)?N.replaceMain(c,"czm_non_show_main")+"\nvoid main() \n{ \n    czm_non_show_main(); \n    gl_Position *\x3d czm_batchTable_show(batchId); \n}":c};S._updateColorAttribute=function(a,c,b){if(!d(a._batchTableAttributeIndices.color)&&!d(a._batchTableAttributeIndices.depthFailColor)||-1===c.search(/attribute\s+vec4\s+color;/g))return c;if(b&&!d(a._batchTableAttributeIndices.depthFailColor))throw new r("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");a=c.replace(/attribute\s+vec4\s+color;/g,"");return a=b?a.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):a.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2")};S._updatePickColorAttribute=function(a){a=a.replace(/attribute\s+vec4\s+pickColor;/g,"");return a=a.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2")};S._appendOffsetToShader=function(a,c){if(!d(a._batchTableAttributeIndices.offset))return c;var b=c.replace(/attribute\s+float\s+batchId;/g,"attribute float batchId;\nattribute float applyOffset;");return b=b.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,"vec4 $1 \x3d czm_computePosition();\n    if (czm_sceneMode \x3d\x3d czm_sceneMode3D)\n    {\n        $1 \x3d $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);    }\n    else\n    {\n        $1 \x3d $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);    }\n")};S._appendDistanceDisplayConditionToShader=function(a,c,b){if(!d(a._batchTableAttributeIndices.distanceDisplayCondition))return c;a=N.replaceMain(c,"czm_non_distanceDisplayCondition_main");c="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition \x3d czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh \x3d czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow \x3d czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius \x3d czm_batchTable_boundingSphereRadius(batchId);\n";return a+"\n"+((b?c+"    vec4 centerRTE \x3d czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":c+"    vec3 boundingSphereCenter2DHigh \x3d czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow \x3d czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime \x3d\x3d 1.0)\n    {\n        centerRTE \x3d czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime \x3d\x3d 0.0)\n    {\n        centerRTE \x3d czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE \x3d czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n")+"    float radiusSq \x3d boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode \x3d\x3d czm_sceneMode2D) \n    { \n        distanceSq \x3d czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq \x3d dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq \x3d max(distanceSq, 0.0); \n    float nearSq \x3d distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq \x3d distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show \x3d (distanceSq \x3e\x3d nearSq \x26\x26 distanceSq \x3c\x3d farSq) ? 1.0 : 0.0; \n    gl_Position *\x3d show; \n}")};var ra=Math.max(u.hardwareConcurrency-1,1),Ea,Ga=new J("combineGeometry",Number.POSITIVE_INFINITY),Ca=new c,ya=new g,Aa=new f,Ua=new b,sa=new f,Va=new f,xa=new B,Ha=new f;S._updateBoundingVolumes=function(a,c,e,f){var h,g;if(f||!B.equals(e,a._modelMatrix))for(B.clone(e,a._modelMatrix),h=a._boundingSpheres.length,f=0;f<h;++f)g=a._boundingSpheres[f],d(g)&&(a._boundingSphereWC[f]=b.transform(g,e,a._boundingSphereWC[f]),c.scene3DOnly||(a._boundingSphere2D[f]=b.clone(a._boundingSphereCV[f],a._boundingSphere2D[f]),a._boundingSphere2D[f].center.x=0,a._boundingSphereMorph[f]=b.union(a._boundingSphereWC[f],a._boundingSphereCV[f])));e=a.appearance.pixelSize;if(d(e))for(h=a._boundingSpheres.length,f=0;f<h;++f){g=a._boundingSpheres[f];var k=a._boundingSphereWC[f],l=c.camera.getPixelSize(g,c.context.drawingBufferWidth,c.context.drawingBufferHeight)*e;k.radius=g.radius+l}};S.prototype.update=function(a){if(!(!d(this.geometryInstances)&&0===this._va.length||d(this.geometryInstances)&&v(this.geometryInstances)&&0===this.geometryInstances.length||!d(this.appearance)||a.mode!==Y.SCENE3D&&a.scene3DOnly||!a.passes.render&&!a.passes.pick)){if(d(this._error))throw this._error;if(d(this.rtcCenter)&&!a.scene3DOnly)throw new r("RTC rendering is only available for 3D only scenes.");if(this._state!==R.FAILED){var e=a.context;if(!d(this._batchTable)){var g=this.geometryInstances,k=v(g)?g:[g],l=k.length;if(0!==l){var q=k.length,u=[],t=k[0].attributes,E;for(E in t)if(t.hasOwnProperty(E)&&d(t[E])){for(var x=t[E],L=!0,H=1;H<q;++H){var T=k[H].attributes[E];if(!d(T)||x.componentDatatype!==T.componentDatatype||x.componentsPerAttribute!==T.componentsPerAttribute||x.normalize!==T.normalize){L=!1;break}}L&&u.push(E)}var K=u.length,Q=[],J={},N={},V,da=k[0].attributes,P,W,U;for(P=0;P<K;++P)W=u[P],U=da[W],J[W]=P,Q.push({functionName:"czm_batchTable_"+W,componentDatatype:U.componentDatatype,componentsPerAttribute:U.componentsPerAttribute,normalize:U.normalize});-1!==u.indexOf("distanceDisplayCondition")&&(Q.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:h.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:h.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:h.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:h.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:h.FLOAT,componentsPerAttribute:1}),N.center3DHigh=Q.length-5,N.center3DLow=Q.length-4,N.center2DHigh=Q.length-3,N.center2DLow=Q.length-2,N.radius=Q.length-1);-1!==u.indexOf("offset")&&(Q.push({functionName:"czm_batchTable_offset2D",componentDatatype:h.FLOAT,componentsPerAttribute:3}),V=Q.length-1);Q.push({functionName:"czm_batchTable_pickColor",componentDatatype:h.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});var ba=Q.length,Z=new aa(e,Q,l);for(P=0;P<l;++P){for(var wa=k[P],da=wa.attributes,ra=0;ra<K;++ra){W=u[ra];U=da[W];var pa=ca(U.value);Z.setBatchedAttribute(P,J[W],pa)}var oa={primitive:p(wa.pickPrimitive,this)};d(wa.id)&&(oa.id=wa.id);var Ea=e.createPickId(oa);this._pickIds.push(Ea);var za=Ea.color,ka=Da;ka.x=m.floatToByte(za.red);ka.y=m.floatToByte(za.green);ka.z=m.floatToByte(za.blue);ka.w=m.floatToByte(za.alpha);Z.setBatchedAttribute(P,ba-1,ka)}this._batchTable=Z;this._batchTableAttributeIndices=J;this._batchTableBoundingSphereAttributeIndices=N;this._batchTableOffsetAttribute2DIndex=V}}if(0<this._batchTable.attributes.length){if(0===G.maximumVertexTextureImageUnits)throw new I("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(a)}if(this._state!==R.COMPLETE&&this._state!==R.COMBINED)if(this.asynchronous)X(this,a);else{var Ba=v(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],Ga=this._numberOfInstances=Ba.length,sa=Array(Ga),na=this._instanceIds,qa,Fa,ua=0;for(Fa=0;Fa<Ga;Fa++){qa=Ba[Fa];var Va=qa.geometry,xa,Ha;if(d(Va.attributes)&&d(Va.primitiveType)){var Ma=Va,Ia=Ma.attributes,La=new z,qb=void 0;for(qb in Ia)if(Ia.hasOwnProperty(qb)&&d(Ia[qb])){var Pa=qb,vb,vc=Ia[qb],ma=void 0,ma=v(vc.values)?vc.values.slice(0):new vc.values.constructor(vc.values);vb=new A({componentDatatype:vc.componentDatatype,componentsPerAttribute:vc.componentsPerAttribute,normalize:vc.normalize,values:ma});La[Pa]=vb}var Ib=void 0;if(d(Ma.indices))var ib=Ma.indices,Ib=v(ib)?ib.slice(0):new ib.constructor(ib);Ha=new y({attributes:La,indices:Ib,primitiveType:Ma.primitiveType,boundingSphere:b.clone(Ma.boundingSphere)})}else Ha=Va.constructor.createGeometry(Va);xa=Ha;var zc=ua++,Bc,Ec=qa;Bc={geometry:xa,attributes:Ec.attributes,modelMatrix:B.clone(Ec.modelMatrix),pickPrimitive:Ec.pickPrimitive,id:Ec.id};sa[zc]=Bc;na.push(qa.id)}sa.length=ua;var nc=a.mapProjection,gc=M.combineGeometry({instances:sa,ellipsoid:nc.ellipsoid,projection:nc,elementIndexUintSupported:a.context.elementIndexUint,scene3DOnly:a.scene3DOnly,vertexCacheOptimize:this.vertexCacheOptimize,compressVertices:this.compressVertices,modelMatrix:this.modelMatrix,createPickOffsets:this._createPickOffsets});this._geometries=gc.geometries;this._attributeLocations=gc.attributeLocations;this.modelMatrix=B.clone(gc.modelMatrix,this.modelMatrix);this._pickOffsets=gc.pickOffsets;this._offsetInstanceExtend=gc.offsetInstanceExtend;this._instanceBoundingSpheres=gc.boundingSpheres;this._instanceBoundingSpheresCV=gc.boundingSpheresCV;d(this._geometries)&&0<this._geometries.length?(this._recomputeBoundingSpheres=!0,this._state=R.COMBINED):ta(this,a,R.FAILED,void 0)}if(this._state===R.COMBINED){if(d(this._batchTableAttributeIndices.distanceDisplayCondition)&&!this._batchTableBoundingSpheresUpdated){for(var hc=this._batchTableBoundingSphereAttributeIndices,Fc=hc.center3DHigh,mb=hc.center3DLow,gb=hc.center2DHigh,Zb=hc.center2DLow,Gc=hc.radius,Na=a.mapProjection,Ob=Na.ellipsoid,lb=this._batchTable,nb=this._instanceBoundingSpheres,Cb=nb.length,wb=0;wb<Cb;++wb){var xb=nb[wb];if(d(xb)){var rb=this.modelMatrix;d(rb)&&(xb=b.transform(xb,rb,Ua));var yb=xb.center,oc=xb.radius,sb=c.fromCartesian(yb,Ca);lb.setBatchedAttribute(wb,Fc,sb.high);lb.setBatchedAttribute(wb,mb,sb.low);if(!a.scene3DOnly){var Sb=Ob.cartesianToCartographic(yb,ya),Pb=Na.project(Sb,Aa),sb=c.fromCartesian(Pb,Ca);lb.setBatchedAttribute(wb,gb,sb.high);lb.setBatchedAttribute(wb,Zb,sb.low)}lb.setBatchedAttribute(wb,Gc,oc)}}this._batchTableBoundingSpheresUpdated=!0}fa(this,a);for(var $b=this._attributeLocations,Tc=this._geometries,Db=a.scene3DOnly,Eb=a.context,eb=[],ea=Tc.length,Qb=0;Qb<ea;++Qb){var bb=Tc[Qb];eb.push(O.fromGeometry({context:Eb,geometry:bb,attributeLocations:$b,bufferUsage:w.STATIC_DRAW,interleave:this._interleave}));if(d(this._createBoundingVolumeFunction))this._createBoundingVolumeFunction(a,bb);else if(this._boundingSpheres.push(b.clone(bb.boundingSphere)),this._boundingSphereWC.push(new b),!Db){var cb=bb.boundingSphereCV.center,Ya=cb.x,Fb=cb.y;cb.x=cb.z;cb.y=Ya;cb.z=Fb;this._boundingSphereCV.push(b.clone(bb.boundingSphereCV));this._boundingSphere2D.push(new b);this._boundingSphereMorph.push(new b)}}this._va=eb;this._primitiveType=Tc[0].primitiveType;this.releaseGeometryInstances&&(this.geometryInstances=void 0);this._geometries=void 0;ta(this,a,R.COMPLETE,void 0)}if(this.show&&this._state===R.COMPLETE){this._batchTableOffsetsUpdated||fa(this,a);if(this._recomputeBoundingSpheres){var Ac=this._batchTableAttributeIndices.offset;if(this._recomputeBoundingSpheres&&d(Ac)){var Xa,pc=this._offsetInstanceExtend,ic=this._instanceBoundingSpheres,ob=ic.length,Kb=this._tempBoundingSpheres;if(!d(Kb)){Kb=Array(ob);for(Xa=0;Xa<ob;Xa++)Kb[Xa]=new b;this._tempBoundingSpheres=Kb}for(Xa=0;Xa<ob;++Xa){var Rb=Kb[Xa],ub=this._batchTable.getBatchedAttribute(Xa,Ac,new f),Rb=ic[Xa].clone(Rb);ha(Rb,ub,pc[Xa])}var jc=[],jb=[],Jb=[];for(Xa=0;Xa<ob;++Xa){var Gb=Kb[Xa];0<Gb.center.x-Gb.radius||b.intersectPlane(Gb,C.ORIGIN_ZX_PLANE)!==D.INTERSECTING?jc.push(Gb):(jb.push(Gb),Jb.push(Gb))}var kb=jc[0],Lb=Jb[0],kc=jb[0];for(Xa=1;Xa<jc.length;Xa++)kb=b.union(kb,jc[Xa]);for(Xa=1;Xa<Jb.length;Xa++)Lb=b.union(Lb,Jb[Xa]);for(Xa=1;Xa<jb.length;Xa++)kc=b.union(kc,jb[Xa]);var Vb=[];d(kb)&&Vb.push(kb);d(Lb)&&Vb.push(Lb);d(kc)&&Vb.push(kc);for(Xa=0;Xa<Vb.length;Xa++){var Tb=Vb[Xa].clone(this._boundingSpheres[Xa]);this._boundingSpheres[Xa]=Tb;this._boundingSphereCV[Xa]=b.projectTo2D(Tb,a.mapProjection,this._boundingSphereCV[Xa])}S._updateBoundingVolumes(this,a,this.modelMatrix,!0)}this._recomputeBoundingSpheres=!1}var fb=this.appearance,zb=fb.material,Mb=!1,$a=!1;this._appearance!==fb?(this._appearance=fb,this._material=zb,$a=Mb=!0):this._material!==zb&&(this._material=zb,$a=!0);var lc=this.depthFailAppearance,qc=d(lc)?lc.material:void 0;this._depthFailAppearance!==lc?(this._depthFailAppearance=lc,this._depthFailMaterial=qc,$a=Mb=!0):this._depthFailMaterial!==qc&&(this._depthFailMaterial=qc,$a=!0);var mc=this._appearance.isTranslucent();this._translucent!==mc&&(this._translucent=mc,Mb=!0);d(this._material)&&this._material.update(e);var bc=fb.closed&&mc;Mb&&p(this._createRenderStatesFunction,ga)(this,e,fb,bc);$a&&p(this._createShaderProgramFunction,F)(this,a,fb);(Mb||$a)&&p(this._createCommandsFunction,ia)(this,fb,zb,mc,bc,this._colorCommands,this._pickCommands,a);p(this._updateAndQueueCommandsFunction,la)(this,a,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,bc)}}}};var Ma=new b,Ia=new b,La=new f;S.prototype.getGeometryInstanceAttributes=function(a){if(!d(a))throw new r("id is required");if(!d(this._batchTable))throw new r("must call update before calling getGeometryInstanceAttributes");for(var c=-1,b=this._lastPerInstanceAttributeIndex,e=this._instanceIds,f=e.length,h=0;h<f;++h){var g=(b+h)%f;if(a===e[g]){c=g;break}}if(-1!==c){a=this._perInstanceAttributeCache[c];if(d(a))return a;b=this._batchTable;e=this._batchTableAttributeIndices;a={};var h={},k;for(k in e)if(e.hasOwnProperty(k)){g=e[k];h[k]={get:pa(b,c,g)};var l=!0,m=this._readOnlyInstanceAttributes;if(l&&d(m))for(var f=m.length,p=0;p<f;++p)if(k===m[p]){l=!1;break}l&&(h[k].set=oa(b,c,g,this,k))}qa(this,h,c);ua(this,h,c);q(a,h);this._lastPerInstanceAttributeIndex=c;return this._perInstanceAttributeCache[c]=a}};S.prototype.isDestroyed=function(){return!1};S.prototype.destroy=function(){var a,c;this._sp=this._sp&&this._sp.destroy();this._pickSP=this._pickSP&&this._pickSP.destroy();var b=this._va;a=b.length;for(c=0;c<a;++c)b[c].destroy();this._va=void 0;b=this._pickIds;a=b.length;for(c=0;c<a;++c)b[c].destroy();this._pickIds=void 0;this._batchTable=this._batchTable&&this._batchTable.destroy();this._attributeLocations=this._perInstanceAttributeCache=this._instanceIds=void 0;return t(this)};return S});F("Shaders/ShadowVolumeAppearanceFS",[],function(){return"#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#ifdef TEXTURE_COORDINATES\n#ifdef SPHERICAL\nvarying vec4 v_sphericalExtents;\n#else // SPHERICAL\nvarying vec2 v_inversePlaneExtents;\nvarying vec4 v_westPlane;\nvarying vec4 v_southPlane;\n#endif // SPHERICAL\nvarying vec3 v_uvMinAndSphericalLongitudeRotation;\nvarying vec3 v_uMaxAndInverseDistance;\nvarying vec3 v_vMaxAndInverseDistance;\n#endif // TEXTURE_COORDINATES\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\n#ifdef NORMAL_EC\nvec3 getEyeCoordinate3FromWindowCoordinate(vec2 fragCoord, float logDepthOrDepth) {\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(fragCoord, logDepthOrDepth);\nreturn eyeCoordinate.xyz / eyeCoordinate.w;\n}\nvec3 vectorFromOffset(vec4 eyeCoordinate, vec2 positiveOffset) {\nvec2 glFragCoordXY \x3d gl_FragCoord.xy;\nfloat upOrRightLogDepth \x3d czm_unpackDepth(texture2D(czm_globeDepthTexture, (glFragCoordXY + positiveOffset) / czm_viewport.zw));\nfloat downOrLeftLogDepth \x3d czm_unpackDepth(texture2D(czm_globeDepthTexture, (glFragCoordXY - positiveOffset) / czm_viewport.zw));\nbvec2 upOrRightInBounds \x3d lessThan(glFragCoordXY + positiveOffset, czm_viewport.zw);\nfloat useUpOrRight \x3d float(upOrRightLogDepth \x3e 0.0 \x26\x26 upOrRightInBounds.x \x26\x26 upOrRightInBounds.y);\nfloat useDownOrLeft \x3d float(useUpOrRight \x3d\x3d 0.0);\nvec3 upOrRightEC \x3d getEyeCoordinate3FromWindowCoordinate(glFragCoordXY + positiveOffset, upOrRightLogDepth);\nvec3 downOrLeftEC \x3d getEyeCoordinate3FromWindowCoordinate(glFragCoordXY - positiveOffset, downOrLeftLogDepth);\nreturn (upOrRightEC - (eyeCoordinate.xyz / eyeCoordinate.w)) * useUpOrRight + ((eyeCoordinate.xyz / eyeCoordinate.w) - downOrLeftEC) * useDownOrLeft;\n}\n#endif // NORMAL_EC\nvoid main(void)\n{\n#ifdef REQUIRES_EC\nfloat logDepthOrDepth \x3d czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw));\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\n#endif\n#ifdef REQUIRES_WC\nvec4 worldCoordinate4 \x3d czm_inverseView * eyeCoordinate;\nvec3 worldCoordinate \x3d worldCoordinate4.xyz / worldCoordinate4.w;\n#endif\n#ifdef TEXTURE_COORDINATES\nvec2 uv;\n#ifdef SPHERICAL\nvec2 sphericalLatLong \x3d czm_approximateSphericalCoordinates(worldCoordinate);\nsphericalLatLong.y +\x3d v_uvMinAndSphericalLongitudeRotation.z;\nsphericalLatLong.y \x3d czm_branchFreeTernary(sphericalLatLong.y \x3c czm_pi, sphericalLatLong.y, sphericalLatLong.y - czm_twoPi);\nuv.x \x3d (sphericalLatLong.y - v_sphericalExtents.y) * v_sphericalExtents.w;\nuv.y \x3d (sphericalLatLong.x - v_sphericalExtents.x) * v_sphericalExtents.z;\n#else // SPHERICAL\nuv.x \x3d czm_planeDistance(v_westPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.x;\nuv.y \x3d czm_planeDistance(v_southPlane, eyeCoordinate.xyz / eyeCoordinate.w) * v_inversePlaneExtents.y;\n#endif // SPHERICAL\n#endif // TEXTURE_COORDINATES\n#ifdef PICK\n#ifdef CULL_FRAGMENTS\nif (0.0 \x3c\x3d uv.x \x26\x26 uv.x \x3c\x3d 1.0 \x26\x26 0.0 \x3c\x3d uv.y \x26\x26 uv.y \x3c\x3d 1.0) {\ngl_FragColor.a \x3d 1.0;\nczm_writeDepthClampedToFarPlane();\n}\n#else // CULL_FRAGMENTS\ngl_FragColor.a \x3d 1.0;\n#endif // CULL_FRAGMENTS\n#else // PICK\n#ifdef CULL_FRAGMENTS\nif (uv.x \x3c\x3d 0.0 || 1.0 \x3c\x3d uv.x || uv.y \x3c\x3d 0.0 || 1.0 \x3c\x3d uv.y) {\ndiscard;\n}\n#endif\n#ifdef NORMAL_EC\nvec3 downUp \x3d vectorFromOffset(eyeCoordinate, vec2(0.0, 1.0));\nvec3 leftRight \x3d vectorFromOffset(eyeCoordinate, vec2(1.0, 0.0));\nvec3 normalEC \x3d normalize(cross(leftRight, downUp));\n#endif\n#ifdef PER_INSTANCE_COLOR\nvec4 color \x3d czm_gammaCorrect(v_color);\n#ifdef FLAT\ngl_FragColor \x3d color;\n#else // FLAT\nczm_materialInput materialInput;\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.positionToEyeEC \x3d -eyeCoordinate.xyz;\nczm_material material \x3d czm_getDefaultMaterial(materialInput);\nmaterial.diffuse \x3d color.rgb;\nmaterial.alpha \x3d color.a;\ngl_FragColor \x3d czm_phong(normalize(-eyeCoordinate.xyz), material);\n#endif // FLAT\n#else // PER_INSTANCE_COLOR\nczm_materialInput materialInput;\n#ifdef USES_NORMAL_EC\nmaterialInput.normalEC \x3d normalEC;\n#endif\n#ifdef USES_POSITION_TO_EYE_EC\nmaterialInput.positionToEyeEC \x3d -eyeCoordinate.xyz;\n#endif\n#ifdef USES_TANGENT_TO_EYE\nmaterialInput.tangentToEyeMatrix \x3d czm_eastNorthUpToEyeCoordinates(worldCoordinate, normalEC);\n#endif\n#ifdef USES_ST\nmaterialInput.st.x \x3d czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_uMaxAndInverseDistance.xy, uv) * v_uMaxAndInverseDistance.z;\nmaterialInput.st.y \x3d czm_lineDistance(v_uvMinAndSphericalLongitudeRotation.xy, v_vMaxAndInverseDistance.xy, uv) * v_vMaxAndInverseDistance.z;\n#endif\nczm_material material \x3d czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#else // FLAT\ngl_FragColor \x3d czm_phong(normalize(-eyeCoordinate.xyz), material);\n#endif // FLAT\n#endif // PER_INSTANCE_COLOR\nczm_writeDepthClampedToFarPlane();\n#endif // PICK\n}\n"});F("Scene/ShadowVolumeAppearance","../Core/Cartographic ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Math ../Core/Check ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/EncodedCartesian3 ../Core/GeometryInstanceAttribute ../Core/Matrix4 ../Core/Rectangle ../Core/Transforms ../Renderer/ShaderSource ../Scene/PerInstanceColorAppearance ../Shaders/ShadowVolumeAppearanceFS".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a,c,b){g.typeOf.bool("extentsCulling",a);g.typeOf.bool("planarExtents",c);g.typeOf.object("appearance",b);var d=new x;d.requiresTextureCoordinates=a;d.requiresEC=!b.flat;var e=new x;e.requiresTextureCoordinates=a;if(b instanceof u)d.requiresNormalEC=!b.flat;else{var f=b.material.shaderSource+"\n"+b.fragmentShaderSource;d.normalEC=-1!==f.indexOf("materialInput.normalEC")||-1!==f.indexOf("czm_getDefaultMaterial");d.positionToEyeEC=-1!==f.indexOf("materialInput.positionToEyeEC");d.tangentToEyeMatrix=-1!==f.indexOf("materialInput.tangentToEyeMatrix");d.st=-1!==f.indexOf("materialInput.st")}this._colorShaderDependencies=d;this._pickShaderDependencies=e;this._appearance=b;this._extentsCulling=a;this._planarExtents=c}function z(a,b,d,f,h,g,l){f=f.slice();if(""===I.eastMostYhighDefine){var m=J;m.longitude=k.PI;m.latitude=0;m.height=0;m=l.project(m,H);m=p.encode(m.x,w);I.eastMostYhighDefine="EAST_MOST_X_HIGH "+m.high.toFixed((m.high+"").length+1);I.eastMostYlowDefine="EAST_MOST_X_LOW "+m.low.toFixed((m.low+"").length+1);m=J;m.longitude=-k.PI;m.latitude=0;m.height=0;l=l.project(m,H);m=p.encode(l.x,w);I.westMostYhighDefine="WEST_MOST_X_HIGH "+m.high.toFixed((m.high+"").length+1);I.westMostYlowDefine="WEST_MOST_X_LOW "+m.low.toFixed((m.low+"").length+1)}d&&(f.push(I.eastMostYhighDefine),f.push(I.eastMostYlowDefine),f.push(I.westMostYhighDefine),f.push(I.westMostYlowDefine));e(g)&&g instanceof u&&f.push("PER_INSTANCE_COLOR");a.requiresTextureCoordinates&&(f.push("TEXTURE_COORDINATES"),b||d||f.push("SPHERICAL"),d&&f.push("COLUMBUS_VIEW_2D"));return new c({defines:f,sources:[h]})}function x(){this._usesSt=this._usesTangentToEyeMat=this._usesPositionToEyeEC=this._usesNormalEC=this._requiresTextureCoordinates=this._requiresNormalEC=this._requiresWC=this._requiresEC=!1}function D(c,b,d){return Math.abs((b.y-c.y)*d.x-(b.x-c.x)*d.y+b.x*c.y-b.y*c.x)/a.distance(b,c)}function v(c,b){var e=G,f=a.unpack(b,0,e[0]),h=a.unpack(b,2,e[1]),g=a.unpack(b,4,e[2]);c.uMaxVmax=new d({componentDatatype:l.FLOAT,componentsPerAttribute:4,normalize:!1,value:[h.x,h.y,g.x,g.y]});e=1/D(f,h,g);h=1/D(f,g,h);c.uvMinAndExtents=new d({componentDatatype:l.FLOAT,componentsPerAttribute:4,normalize:!1,value:[f.x,f.y,e,h]})}function B(a,c,b){var e=E;e.height=0;e.longitude=a.west;e.latitude=a.south;var f=c.project(e,L);e.latitude=a.north;var h=c.project(e,K);e.longitude=a.east;e.latitude=a.south;a=c.project(e,P);c=[0,0,0,0];var e=[0,0,0,0],g=p.encode(f.x,N);c[0]=g.high;e[0]=g.low;g=p.encode(f.y,N);c[1]=g.high;e[1]=g.low;g=p.encode(h.y,N);c[2]=g.high;e[2]=g.low;g=p.encode(a.x,N);c[3]=g.high;e[3]=g.low;b.planes2D_HIGH=new d({componentDatatype:l.FLOAT,componentsPerAttribute:4,normalize:!1,value:c});b.planes2D_LOW=new d({componentDatatype:l.FLOAT,componentsPerAttribute:4,normalize:!1,value:e})}function C(a,c,d,e){var f=E;f.latitude=a;f.longitude=c;f.height=0;c=b.toCartesian(f,d,Q);a=k.fastApproximateAtan2(Math.sqrt(c.x*c.x+c.y*c.y),c.z);c=k.fastApproximateAtan2(c.x,c.y);e.x=a;e.y=c;return e}var I={eastMostYhighDefine:"",eastMostYlowDefine:"",westMostYhighDefine:"",westMostYlowDefine:""};A.prototype.createFragmentShader=function(a){g.typeOf.bool("columbusView2D",a);var b=this._appearance,d=this._colorShaderDependencies,e=[];a||this._planarExtents||e.push("SPHERICAL");d.requiresEC&&e.push("REQUIRES_EC");d.requiresWC&&e.push("REQUIRES_WC");d.requiresTextureCoordinates&&e.push("TEXTURE_COORDINATES");this._extentsCulling&&e.push("CULL_FRAGMENTS");d.requiresNormalEC&&e.push("NORMAL_EC");b instanceof u&&e.push("PER_INSTANCE_COLOR");d.normalEC&&e.push("USES_NORMAL_EC");d.positionToEyeEC&&e.push("USES_POSITION_TO_EYE_EC");d.tangentToEyeMatrix&&e.push("USES_TANGENT_TO_EYE");d.st&&e.push("USES_ST");b.flat&&e.push("FLAT");a="";b instanceof u||(a=b.material.shaderSource);return new c({defines:e,sources:[a,y]})};A.prototype.createPickFragmentShader=function(a){g.typeOf.bool("columbusView2D",a);var b=this._pickShaderDependencies,d=["PICK"];a||this._planarExtents||d.push("SPHERICAL");b.requiresEC&&d.push("REQUIRES_EC");b.requiresWC&&d.push("REQUIRES_WC");b.requiresTextureCoordinates&&d.push("TEXTURE_COORDINATES");this._extentsCulling&&d.push("CULL_FRAGMENTS");return new c({defines:d,sources:[y],pickColorQualifier:"varying"})};A.prototype.createVertexShader=function(a,c,b,d){g.defined("defines",a);g.typeOf.string("vertexShaderSource",c);g.typeOf.bool("columbusView2D",b);g.defined("mapProjection",d);return z(this._colorShaderDependencies,this._planarExtents,b,a,c,this._appearance,d)};A.prototype.createPickVertexShader=function(a,c,b,d){g.defined("defines",a);g.typeOf.string("vertexShaderSource",c);g.typeOf.bool("columbusView2D",b);g.defined("mapProjection",d);return z(this._pickShaderDependencies,this._planarExtents,b,a,c,void 0,d)};var H=new f,J=new b,w={high:0,low:0};h(x.prototype,{requiresEC:{get:function(){return this._requiresEC},set:function(a){this._requiresEC=a||this._requiresEC}},requiresWC:{get:function(){return this._requiresWC},set:function(a){this.requiresEC=this._requiresWC=a||this._requiresWC}},requiresNormalEC:{get:function(){return this._requiresNormalEC},set:function(a){this.requiresEC=this._requiresNormalEC=a||this._requiresNormalEC}},requiresTextureCoordinates:{get:function(){return this._requiresTextureCoordinates},set:function(a){this.requiresWC=this._requiresTextureCoordinates=a||this._requiresTextureCoordinates}},normalEC:{set:function(a){this._usesNormalEC=this.requiresNormalEC=a},get:function(){return this._usesNormalEC}},tangentToEyeMatrix:{set:function(a){this._usesTangentToEyeMat=this.requiresNormalEC=this.requiresWC=a},get:function(){return this._usesTangentToEyeMat}},positionToEyeEC:{set:function(a){this._usesPositionToEyeEC=this.requiresEC=a},get:function(){return this._usesPositionToEyeEC}},st:{set:function(a){this._usesSt=this.requiresTextureCoordinates=a},get:function(){return this._usesSt}}});var G=[new a,new a,new a,new a],E=new b,L=new f,K=new f,P=new f,N={high:0,low:0},O=new q,Z=new q,aa=new f,U=new b,W=[new b,new b,new b,new b,new b,new b,new b,new b],M=new f,R=new f,Y=new p;A.getPlanarTextureCoordinateAttributes=function(a,c,e,h,k){g.typeOf.object("boundingRectangle",a);g.defined("textureCoordinateRotationPoints",c);g.typeOf.object("ellipsoid",e);g.typeOf.object("projection",h);var u=L;k=m(k,0);var w=t.center(a,U);w.height=k;var w=b.toCartesian(w,e,aa),w=r.eastNorthUpToFixedFrame(w,e,O),y=q.inverse(w,Z),z=a.west,C=a.east,A=a.north,D=a.south;W[0].latitude=D;W[0].longitude=z;W[1].latitude=A;W[1].longitude=z;W[2].latitude=A;W[2].longitude=C;W[3].latitude=D;W[3].longitude=C;var E=.5*(z+C),x=.5*(A+D);W[4].latitude=D;W[4].longitude=E;W[5].latitude=A;W[5].longitude=E;W[6].latitude=x;W[6].longitude=z;W[7].latitude=x;W[7].longitude=C;z=Number.POSITIVE_INFINITY;C=Number.NEGATIVE_INFINITY;A=Number.POSITIVE_INFINITY;D=Number.NEGATIVE_INFINITY;for(E=0;8>E;E++)W[E].height=k,x=b.toCartesian(W[E],e,aa),q.multiplyByPoint(y,x,x),x.z=0,z=Math.min(z,x.x),C=Math.max(C,x.x),A=Math.min(A,x.y),D=Math.max(D,x.y);u.x=z;u.y=A;u.z=0;q.multiplyByPoint(w,u,u);M.x=C;M.y=A;M.z=0;q.multiplyByPoint(w,M,M);f.subtract(M,u,M);R.x=z;R.y=D;R.z=0;q.multiplyByPoint(w,R,R);f.subtract(R,u,R);e={};v(e,c);c=p.fromCartesian(u,Y);e.southWest_HIGH=new d({componentDatatype:l.FLOAT,componentsPerAttribute:3,normalize:!1,value:f.pack(c.high,[0,0,0])});e.southWest_LOW=new d({componentDatatype:l.FLOAT,componentsPerAttribute:3,normalize:!1,value:f.pack(c.low,[0,0,0])});e.eastward=new d({componentDatatype:l.FLOAT,componentsPerAttribute:3,normalize:!1,value:f.pack(M,[0,0,0])});e.northward=new d({componentDatatype:l.FLOAT,componentsPerAttribute:3,normalize:!1,value:f.pack(R,[0,0,0])});B(a,h,e);return e};var Q=new f,S=new a;A.getSphericalExtentGeometryInstanceAttributes=function(a,c,b,e){g.typeOf.object("boundingRectangle",a);g.defined("textureCoordinateRotationPoints",c);g.typeOf.object("ellipsoid",b);g.typeOf.object("projection",e);var f=C(a.south,a.west,b,S),h=f.x,f=f.y,m=C(a.north,a.east,b,S);b=m.x;var m=m.y,p=0;f>m&&(p=k.PI-f,f=-k.PI,m+=p);h-=k.EPSILON5;f-=k.EPSILON5;b+=k.EPSILON5;m+=k.EPSILON5;h={sphericalExtents:new d({componentDatatype:l.FLOAT,componentsPerAttribute:4,normalize:!1,value:[h,f,1/(b-h),1/(m-f)]}),longitudeRotation:new d({componentDatatype:l.FLOAT,componentsPerAttribute:1,normalize:!1,value:[p]})};v(h,c);B(a,e,h);return h};A.hasAttributesForTextureCoordinatePlanes=function(a){return e(a.southWest_HIGH)&&e(a.southWest_LOW)&&e(a.northward)&&e(a.eastward)&&e(a.planes2D_HIGH)&&e(a.planes2D_LOW)&&e(a.uMaxVmax)&&e(a.uvMinAndExtents)};A.hasAttributesForSphericalExtents=function(a){return e(a.sphericalExtents)&&e(a.longitudeRotation)&&e(a.planes2D_HIGH)&&e(a.planes2D_LOW)&&e(a.uMaxVmax)&&e(a.uvMinAndExtents)};A.shouldUseSphericalCoordinates=function(a){g.typeOf.object("rectangle",a);return Math.max(a.width,a.height)>A.MAX_WIDTH_FOR_PLANAR_EXTENTS};A.MAX_WIDTH_FOR_PLANAR_EXTENTS=k.toRadians(1);return A});F("Scene/StencilFunction",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){return b({NEVER:a.NEVER,LESS:a.LESS,EQUAL:a.EQUAL,LESS_OR_EQUAL:a.LEQUAL,GREATER:a.GREATER,NOT_EQUAL:a.NOTEQUAL,GREATER_OR_EQUAL:a.GEQUAL,ALWAYS:a.ALWAYS})});F("Scene/StencilOperation",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){return b({ZERO:a.ZERO,KEEP:a.KEEP,REPLACE:a.REPLACE,INCREMENT:a.INCR,DECREMENT:a.DECR,INVERT:a.INVERT,INCREMENT_WRAP:a.INCR_WRAP,DECREMENT_WRAP:a.DECR_WRAP})});F("Scene/StencilConstants",["../Core/freezeObject","./StencilFunction","./StencilOperation"],function(b,a,f){var k={CESIUM_3D_TILE_MASK:128,SKIP_LOD_MASK:112,SKIP_LOD_BIT_SHIFT:4,CLASSIFICATION_MASK:15,setCesium3DTileBit:function(){return{enabled:!0,frontFunction:a.ALWAYS,frontOperation:{fail:f.KEEP,zFail:f.KEEP,zPass:f.REPLACE},backFunction:a.ALWAYS,backOperation:{fail:f.KEEP,zFail:f.KEEP,zPass:f.REPLACE},reference:k.CESIUM_3D_TILE_MASK,mask:k.CESIUM_3D_TILE_MASK}}};return b(k)});F("Scene/ClassificationPrimitive","../Core/ColorGeometryInstanceAttribute ../Core/combine ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/GeometryInstance ../Core/isArray ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Shaders/ShadowVolumeFS ../Shaders/ShadowVolumeAppearanceVS ../ThirdParty/when ./BlendingState ./ClassificationType ./DepthFunction ./PerInstanceColorAppearance ./Primitive ./SceneMode ./ShadowVolumeAppearance ./StencilConstants ./StencilFunction ./StencilOperation".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a){a=f(a,f.EMPTY_OBJECT);var c=a.geometryInstances;this.geometryInstances=c;this.show=f(a.show,!0);this.classificationType=f(a.classificationType,z.BOTH);this.debugShowBoundingVolume=f(a.debugShowBoundingVolume,!1);this.debugShowShadowVolume=f(a.debugShowShadowVolume,!1);this._debugShowShadowVolume=!1;this._extruded=f(a._extruded,!1);this._uniformMap=a._uniformMap;this._rsPickPass=this._rsColorPass=this._rsStencilDepthPass3DTiles=this._rsStencilDepthPass=this._rsStencilPreloadPass3DTiles=this._rsStencilPreloadPass=this._spColor2D=this._spPick2D=this._spColor=this._spPick=this._spStencil=this._sp=void 0;this._commandsIgnoreShow=[];this._ready=!1;this._readyPromise=y.defer();this._primitive=void 0;this._pickPrimitive=a._pickPrimitive;this._hasPerColorAttribute=this._hasPlanarExtentsAttributes=this._hasSphericalExtentsAttribute=!1;this.appearance=a.appearance;var b;k(c)&&h(c)&&1<c.length&&(b=P);this._createBoundingVolumeFunction=a._createBoundingVolumeFunction;this._updateAndQueueCommandsFunction=a._updateAndQueueCommandsFunction;this._usePickOffsets=!1;this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:f(a.vertexCacheOptimize,!1),interleave:f(a.interleave,!1),releaseGeometryInstances:f(a.releaseGeometryInstances,!0),allowPicking:f(a.allowPicking,!0),asynchronous:f(a.asynchronous,!0),compressVertices:f(a.compressVertices,!0),_readOnlyInstanceAttributes:b,_createBoundingVolumeFunction:void 0,_createRenderStatesFunction:void 0,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0,_createPickOffsets:!0}}function G(a,c){var b=c?H.EQUAL:H.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:a,frontFunction:b,frontOperation:{fail:J.KEEP,zFail:J.DECREMENT_WRAP,zPass:J.DECREMENT_WRAP},backFunction:b,backOperation:{fail:J.KEEP,zFail:J.INCREMENT_WRAP,zPass:J.INCREMENT_WRAP},reference:I.CESIUM_3D_TILE_MASK,mask:I.CESIUM_3D_TILE_MASK},stencilMask:I.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1}}function E(a,c){var b=c?H.EQUAL:H.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:a,frontFunction:b,frontOperation:{fail:J.KEEP,zFail:J.KEEP,zPass:J.INCREMENT_WRAP},backFunction:b,backOperation:{fail:J.KEEP,zFail:J.KEEP,zPass:J.DECREMENT_WRAP},reference:I.CESIUM_3D_TILE_MASK,mask:I.CESIUM_3D_TILE_MASK},stencilMask:I.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:x.LESS_OR_EQUAL},depthMask:!1}}function L(a){return{stencilTest:{enabled:a,frontFunction:H.NOT_EQUAL,frontOperation:{fail:J.KEEP,zFail:J.KEEP,zPass:J.DECREMENT_WRAP},backFunction:H.NOT_EQUAL,backOperation:{fail:J.KEEP,zFail:J.KEEP,zPass:J.DECREMENT_WRAP},reference:0,mask:I.CLASSIFICATION_MASK},stencilMask:I.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:A.ALPHA_BLEND}}function K(a,c,b,d,e,f){a.modelMatrix=b;a.boundingVolume=e;a.cull=d;a.debugShowBoundingVolume=f;c.commandList.push(a)}var P=["color"];g(w.prototype,{vertexCacheOptimize:{get:function(){return this._primitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},compressVertices:{get:function(){return this._primitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},_needs2DShader:{get:function(){return this._hasPlanarExtentsAttributes||this._hasSphericalExtentsAttribute}}});w.isSupported=function(a){return a.context.stencilBuffer};var N={stencilTest:{enabled:!0,frontFunction:H.NOT_EQUAL,frontOperation:{fail:J.KEEP,zFail:J.KEEP,zPass:J.DECREMENT_WRAP},backFunction:H.NOT_EQUAL,backOperation:{fail:J.KEEP,zFail:J.KEEP,zPass:J.DECREMENT_WRAP},reference:0,mask:I.CLASSIFICATION_MASK},stencilMask:I.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1};w.prototype.update=function(g){if(k(this._primitive)||k(this.geometryInstances)){var l=this.appearance;k(l)&&k(l.material)&&l.material.update(g.context);var w=this,y=this._primitiveOptions;if(!k(this._primitive)){var A=h(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],x=A.length,H,I,Q=!1,O=!0,J,T=!1,P=!1;0<x&&(H=A[0].attributes,T=C.hasAttributesForSphericalExtents(H),P=C.hasAttributesForTextureCoordinatePlanes(H),J=H.color);for(H=0;H<x;H++){I=A[H];I=I.attributes.color;if(k(I))Q=!0;else if(Q)throw new m("All GeometryInstances must have color attributes to use per-instance color.");O=O&&k(I)&&b.equals(J,I)}if(!O&&!T&&!P)throw new m("All GeometryInstances must have the same color attribute except via GroundPrimitives");Q&&!k(l)&&(this.appearance=l=new D({flat:!0}));if(!Q&&l instanceof D)throw new m("PerInstanceColorAppearance requires color GeometryInstanceAttributes on all GeometryInstances");if(k(l.material)&&!T&&!P)throw new m("Materials on ClassificationPrimitives are not supported except via GroundPrimitives");this._usePickOffsets=!T&&!P;this._hasSphericalExtentsAttribute=T;this._hasPlanarExtentsAttributes=P;this._hasPerColorAttribute=Q;Q=Array(x);for(H=0;H<x;++H)I=A[H],Q[H]=new e({geometry:I.geometry,attributes:I.attributes,modelMatrix:I.modelMatrix,id:I.id,pickPrimitive:f(this._pickPrimitive,w)});y.appearance=l;y.geometryInstances=Q;k(this._createBoundingVolumeFunction)&&(y._createBoundingVolumeFunction=function(a,c){w._createBoundingVolumeFunction(a,c)});y._createRenderStatesFunction=function(a,c,b,d){k(w._rsStencilPreloadPass)||(a=!w.debugShowShadowVolume,w._rsStencilPreloadPass=q.fromCache(G(a,!1)),w._rsStencilPreloadPass3DTiles=q.fromCache(G(a,!0)),w._rsStencilDepthPass=q.fromCache(E(a,!1)),w._rsStencilDepthPass3DTiles=q.fromCache(E(a,!0)),w._rsColorPass=q.fromCache(L(a,!1)),w._rsPickPass=q.fromCache(N))};y._createShaderProgramFunction=function(a,b,d){a=b.context;var e=w._primitive,f=u,f=w._primitive._batchTable.getVertexShaderCallback()(f),f=v._appendDistanceDisplayConditionToShader(e,f),f=v._modifyShaderPosition(w,f,b.scene3DOnly),f=v._updateColorAttribute(e,f),h=w._hasPlanarExtentsAttributes,g=h||w._hasSphericalExtentsAttribute;w._extruded&&(d=f,e.compressVertices?-1!==d.search(/attribute\s+vec3\s+extrudeDirection;/g)?(d=d.replace(/attribute\s+vec3\s+extrudeDirection;/g,""),d=r.replaceMain(d,"czm_non_compressed_main"),f=["attribute vec2 compressedAttributes;\nvec3 extrudeDirection;\n",d,"void main() \n{ \n    extrudeDirection \x3d czm_octDecode(compressedAttributes, 65535.0);\n    czm_non_compressed_main(); \n}"].join("\n")):f=void 0:f=d);var l=w._extruded?"EXTRUDED_GEOMETRY":"",m=new r({defines:[l,"ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT"],sources:[f]}),p=new r({sources:[c]});d=w._primitive._attributeLocations;h=new C(g,h,w.appearance);w._spStencil=t.replaceCache({context:a,shaderProgram:w._spStencil,vertexShaderSource:m,fragmentShaderSource:p,attributeLocations:d});if(w._primitive.allowPicking){var m=r.createPickVertexShaderSource(f),m=v._appendShowToShader(e,m),m=v._updatePickColorAttribute(m),q=h.createPickFragmentShader(!1),y=h.createPickVertexShader([l,"ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT"],m,!1,b.mapProjection);w._spPick=t.replaceCache({context:a,shaderProgram:w._spPick,vertexShaderSource:y,fragmentShaderSource:q,attributeLocations:d});g&&(q=a.shaderCache.getDerivedShaderProgram(w._spPick,"2dPick"),k(q)||(q=h.createPickFragmentShader(!0),m=h.createPickVertexShader([l,"ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT"],m,!0,b.mapProjection),q=a.shaderCache.createDerivedShaderProgram(w._spPick,"2dPick",{vertexShaderSource:m,fragmentShaderSource:q,attributeLocations:d})),w._spPick2D=q)}else w._spPick=t.fromCache({context:a,vertexShaderSource:m,fragmentShaderSource:p,attributeLocations:d});f=v._appendShowToShader(e,f);m=new r({defines:[l,"ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT"],sources:[f]});w._sp=t.replaceCache({context:a,shaderProgram:w._sp,vertexShaderSource:m,fragmentShaderSource:p,attributeLocations:d});e=h.createFragmentShader(!1);p=h.createVertexShader([l,"ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT"],f,!1,b.mapProjection);w._spColor=t.replaceCache({context:a,shaderProgram:w._spColor,vertexShaderSource:p,fragmentShaderSource:e,attributeLocations:d});g&&(g=a.shaderCache.getDerivedShaderProgram(w._spColor,"2dColor"),k(g)||(g=h.createFragmentShader(!0),b=h.createVertexShader([l,"ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT"],f,!0,b.mapProjection),g=a.shaderCache.createDerivedShaderProgram(w._spColor,"2dColor",{vertexShaderSource:b,fragmentShaderSource:g,attributeLocations:d})),w._spColor2D=g)};y._createCommandsFunction=function(c,b,e,f,h,g,l){b=w._primitive;c=3*b._va.length;g.length=c;var m;h=0;var q=b._batchTable.getUniformMapCallback()(w._uniformMap),u=w._needs2DShader;for(e=0;e<c;e+=3){var r=b._va[h++];f=g[e];k(f)||(f=g[e]=new p({owner:w,primitiveType:b._primitiveType}));f.vertexArray=r;f.renderState=w._rsStencilPreloadPass;f.shaderProgram=w._sp;f.uniformMap=q;f.pass=d.TERRAIN_CLASSIFICATION;m=p.shallowClone(f,f.derivedCommands.tileset);m.renderState=w._rsStencilPreloadPass3DTiles;m.pass=d.CESIUM_3D_TILE_CLASSIFICATION;f.derivedCommands.tileset=m;f=g[e+1];k(f)||(f=g[e+1]=new p({owner:w,primitiveType:b._primitiveType}));f.vertexArray=r;f.renderState=w._rsStencilDepthPass;f.shaderProgram=w._sp;f.uniformMap=q;f.pass=d.TERRAIN_CLASSIFICATION;m=p.shallowClone(f,f.derivedCommands.tileset);m.renderState=w._rsStencilDepthPass3DTiles;m.pass=d.CESIUM_3D_TILE_CLASSIFICATION;f.derivedCommands.tileset=m;f=g[e+2];k(f)||(f=g[e+2]=new p({owner:w,primitiveType:b._primitiveType}));f.vertexArray=r;f.renderState=w._rsColorPass;f.shaderProgram=w._spColor;f.pass=d.TERRAIN_CLASSIFICATION;m=w.appearance.material;k(m)&&(q=a(q,m._uniforms));f.uniformMap=q;m=p.shallowClone(f,f.derivedCommands.tileset);m.pass=d.CESIUM_3D_TILE_CLASSIFICATION;f.derivedCommands.tileset=m;u&&(r=p.shallowClone(f,f.derivedCommands.appearance2D),r.shaderProgram=w._spColor2D,f.derivedCommands.appearance2D=r,r=p.shallowClone(m,m.derivedCommands.appearance2D),r.shaderProgram=w._spColor2D,m.derivedCommands.appearance2D=r)}b=w._commandsIgnoreShow;e=w._spStencil;f=0;c=b.length=c/3*2;for(h=0;h<c;h+=2)q=b[h]=p.shallowClone(g[f],b[h]),q.shaderProgram=e,q.pass=d.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,q=b[h+1]=p.shallowClone(g[f+1],b[h+1]),q.shaderProgram=e,q.pass=d.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,f+=3;g=w._usePickOffsets;c=w._primitive;b=3*c._va.length;var v;e=0;var t;g&&(v=c._pickOffsets,b=3*v.length);l.length=b;u=0;m=c._batchTable.getUniformMapCallback()(w._uniformMap);r=w._needs2DShader;for(f=0;f<b;f+=3){var y=c._va[u++];g&&(t=v[e++],y=c._va[t.index]);h=l[f];k(h)||(h=l[f]=new p({owner:w,primitiveType:c._primitiveType,pickOnly:!0}));h.vertexArray=y;h.renderState=w._rsStencilPreloadPass;h.shaderProgram=w._sp;h.uniformMap=m;h.pass=d.TERRAIN_CLASSIFICATION;g&&(h.offset=t.offset,h.count=t.count);q=p.shallowClone(h,h.derivedCommands.tileset);q.renderState=w._rsStencilPreloadPass3DTiles;q.pass=d.CESIUM_3D_TILE_CLASSIFICATION;h.derivedCommands.tileset=q;h=l[f+1];k(h)||(h=l[f+1]=new p({owner:w,primitiveType:c._primitiveType,pickOnly:!0}));h.vertexArray=y;h.renderState=w._rsStencilDepthPass;h.shaderProgram=w._sp;h.uniformMap=m;h.pass=d.TERRAIN_CLASSIFICATION;g&&(h.offset=t.offset,h.count=t.count);q=p.shallowClone(h,h.derivedCommands.tileset);q.renderState=w._rsStencilDepthPass3DTiles;q.pass=d.CESIUM_3D_TILE_CLASSIFICATION;h.derivedCommands.tileset=q;h=l[f+2];k(h)||(h=l[f+2]=new p({owner:w,primitiveType:c._primitiveType,pickOnly:!0}));h.vertexArray=y;h.renderState=w._rsPickPass;h.shaderProgram=w._spPick;h.uniformMap=m;h.pass=d.TERRAIN_CLASSIFICATION;g&&(h.offset=t.offset,h.count=t.count);q=p.shallowClone(h,h.derivedCommands.tileset);q.pass=d.CESIUM_3D_TILE_CLASSIFICATION;h.derivedCommands.tileset=q;r&&(y=p.shallowClone(h,h.derivedCommands.pick2D),y.shaderProgram=w._spPick2D,h.derivedCommands.pick2D=y,y=p.shallowClone(q,q.derivedCommands.pick2D),y.shaderProgram=w._spPick2D,q.derivedCommands.pick2D=y)}};k(this._updateAndQueueCommandsFunction)?y._updateAndQueueCommandsFunction=function(a,c,b,d,e,f,h,g){w._updateAndQueueCommandsFunction(a,c,b,d,e,f,h,g)}:y._updateAndQueueCommandsFunction=function(a,c,b,d,e,f,h,g){var l=w._primitive;v._updateBoundingVolumes(l,c,e);var m;c.mode===B.SCENE3D?m=l._boundingSphereWC:c.mode===B.COLUMBUS_VIEW?m=l._boundingSphereCV:c.mode===B.SCENE2D&&k(l._boundingSphere2D)?m=l._boundingSphere2D:k(l._boundingSphereMorph)&&(m=l._boundingSphereMorph);g=w.classificationType;a=g!==z.CESIUM_3D_TILE;g=g!==z.TERRAIN;var p=c.passes,q,u,r;if(p.render){var t=b.length;for(q=0;q<t;++q)u=m[Math.floor(q%t/3)],a&&(r=b[q],K(r,c,e,f,u,h)),g&&(r=b[q].derivedCommands.tileset,K(r,c,e,f,u,h));if(c.invertClassification)for(b=w._commandsIgnoreShow,t=b.length,q=0;q<t;++q)u=m[Math.floor(q/2)],r=b[q],K(r,c,e,f,u,h)}if(p.pick)for(h=d.length,l=l._pickOffsets,q=0;q<h;++q)u=m[l[Math.floor(q%h/3)].index],a&&(r=d[q],b=c,p=f,t=u,r.modelMatrix=e,r.boundingVolume=t,r.cull=p,b.commandList.push(r)),g&&(r=d[q].derivedCommands.tileset,b=c,p=f,r.modelMatrix=e,r.boundingVolume=u,r.cull=p,b.commandList.push(r))};this._primitive=new v(y);this._primitive.readyPromise.then(function(a){w._ready=!0;w.releaseGeometryInstances&&(w.geometryInstances=void 0);a=a._error;k(a)?w._readyPromise.reject(a):w._readyPromise.resolve(w)})}this.debugShowShadowVolume&&!this._debugShowShadowVolume&&this._ready?(this._debugShowShadowVolume=!0,this._rsStencilPreloadPass=q.fromCache(G(!1,!1)),this._rsStencilPreloadPass3DTiles=q.fromCache(G(!1,!0)),this._rsStencilDepthPass=q.fromCache(E(!1,!1)),this._rsStencilDepthPass3DTiles=q.fromCache(E(!1,!0)),this._rsColorPass=q.fromCache(L(!1))):!this.debugShowShadowVolume&&this._debugShowShadowVolume&&(this._debugShowShadowVolume=!1,this._rsStencilPreloadPass=q.fromCache(G(!0,!1)),this._rsStencilPreloadPass3DTiles=q.fromCache(G(!0,!0)),this._rsStencilDepthPass=q.fromCache(E(!0,!1)),this._rsStencilDepthPass3DTiles=q.fromCache(E(!0,!0)),this._rsColorPass=q.fromCache(L(!0)));if(this._primitive.appearance!==l){if(!this._hasSphericalExtentsAttribute&&!this._hasPlanarExtentsAttributes&&k(l.material))throw new m("Materials on ClassificationPrimitives are not supported except via GroundPrimitive");if(!this._hasPerColorAttribute&&l instanceof D)throw new m("PerInstanceColorAppearance requires color GeometryInstanceAttribute");this._primitive.appearance=l}this._primitive.show=this.show;this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(g)}};w.prototype.getGeometryInstanceAttributes=function(a){if(!k(this._primitive))throw new m("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(a)};w.prototype.isDestroyed=function(){return!1};w.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();this._sp=this._sp&&this._sp.destroy();this._spPick=this._spPick&&this._spPick.destroy();this._spColor=this._spColor&&this._spColor.destroy();this._spColor2D=this._spPick2D=void 0;return l(this)};return w});F("Scene/GroundPrimitive","../Core/ApproximateTerrainHeights ../Core/BoundingSphere ../Core/buildModuleUrl ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/ColorGeometryInstanceAttribute ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/GeographicTilingScheme ../Core/GeometryInstance ../Core/isArray ../Core/Math ../Core/OrientedBoundingBox ../Core/Rectangle ../Core/RectangleGeometry ../Core/Resource ../Renderer/DrawCommand ../Renderer/Pass ../ThirdParty/when ./ClassificationPrimitive ./ClassificationType ./PerInstanceColorAppearance ./SceneMode ./ShadowVolumeAppearance".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G){function E(a){a=h(a,h.EMPTY_OBJECT);var c=a.appearance,d=a.geometryInstances;if(!p(c)&&p(d))for(var d=u(d)?d:[d],e=d.length,f=0;f<e;f++){var g=d[f].attributes;if(p(g)&&p(g.color)){c=new J({flat:!0});break}}this.appearance=c;this.geometryInstances=a.geometryInstances;this.show=h(a.show,!0);this.classificationType=h(a.classificationType,H.BOTH);this.debugShowBoundingVolume=h(a.debugShowBoundingVolume,!1);this.debugShowShadowVolume=h(a.debugShowShadowVolume,!1);this._boundingVolumes=[];this._boundingVolumes2D=[];this._ready=!1;this._readyPromise=C.defer();this._minHeight=this._maxHeight=this._primitive=void 0;this._maxTerrainHeight=b._defaultMaxTerrainHeight;this._minTerrainHeight=b._defaultMinTerrainHeight;this._boundingSpheresKeys=[];this._boundingSpheres=[];this._useFragmentCulling=!1;this._zIndex=void 0;this._classificationPrimitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:h(a.vertexCacheOptimize,!1),interleave:h(a.interleave,!1),releaseGeometryInstances:h(a.releaseGeometryInstances,!0),allowPicking:h(a.allowPicking,!0),asynchronous:h(a.asynchronous,!0),compressVertices:h(a.compressVertices,!0),_createBoundingVolumeFunction:void 0,_updateAndQueueCommandsFunction:void 0,_pickPrimitive:this,_extruded:!0,_uniformMap:aa}}function L(a){return function(c,b){var d=b.maximumRadius;return a._maxHeight+(d/Math.cos(.5*c)-d)}}function K(a){return function(c,b){return a._minHeight}}function P(a,c){var b=a.mapProjection.ellipsoid;if(p(c.attributes)&&p(c.attributes.position3DHigh)){for(var d=c.attributes.position3DHigh.values,e=c.attributes.position3DLow.values,f=d.length,h=Number.POSITIVE_INFINITY,k=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY,m=Number.NEGATIVE_INFINITY,q=0;q<f;q+=3)var u=g.unpack(d,q,U),r=g.unpack(e,q,W),u=g.add(u,r,M),r=b.cartesianToCartographic(u,R),u=r.latitude,r=r.longitude,h=Math.min(h,u),k=Math.min(k,r),l=Math.max(l,u),m=Math.max(m,r);b=Y;b.north=l;b.south=h;b.east=m;b.west=k;return b}if(p(c.rectangle))return c.rectangle}function N(a,c,d){c=b.getMinimumMaximumHeights(c,d);a._minTerrainHeight=c.minimumTerrainHeight;a._maxTerrainHeight=c.maximumTerrainHeight}function O(a,c,b,d,e,f,h){var g=a._primitive;b.mode!==w.SCENE3D&&c.shaderProgram===g._spColor&&g._needs2DShader&&(c=c.derivedCommands.appearance2D);c.owner=a;c.modelMatrix=d;c.boundingVolume=f;c.cull=e;c.debugShowBoundingVolume=h;b.commandList.push(c)}function Z(a,c,b,d,e,f){var h=a._primitive;b.mode!==w.SCENE3D&&c.shaderProgram===h._spPick&&h._needs2DShader&&(c=c.derivedCommands.pick2D);c.owner=a;c.modelMatrix=d;c.boundingVolume=f;c.cull=e;b.commandList.push(c)}var aa={u_globeMinimumAltitude:function(){return 55E3}};d(E.prototype,{vertexCacheOptimize:{get:function(){return this._classificationPrimitiveOptions.vertexCacheOptimize}},interleave:{get:function(){return this._classificationPrimitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._classificationPrimitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._classificationPrimitiveOptions.allowPicking}},asynchronous:{get:function(){return this._classificationPrimitiveOptions.asynchronous}},compressVertices:{get:function(){return this._classificationPrimitiveOptions.compressVertices}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});E.isSupported=I.isSupported;var U=new g,W=new g,M=new g,R=new l,Y=new z;E.initializeTerrainHeights=function(){return b.initialize()};E.prototype.update=function(d){if(p(this._primitive)||p(this.geometryInstances))if(b.initialized){var e=this,f=this._classificationPrimitiveOptions;if(!p(this._primitive)){var h=d.mapProjection.ellipsoid,k,l,m,q=u(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],r=q.length,v=Array(r),B,C;for(B=0;B<r;++B)if(k=q[B],l=k.geometry,m=P(d,l),p(C)?p(m)&&z.union(C,m,C):C=z.clone(m),k=k.id,p(k)&&p(m)&&(m=b.getBoundingSphere(m,h),this._boundingSpheresKeys.push(k),this._boundingSpheres.push(m)),m=l.constructor,!p(m)||!p(m.createShadowVolume))throw new t("Not all of the geometry instances have GroundPrimitive support.");N(this,C,h);l=d.terrainExaggeration;this._minHeight=this._minTerrainHeight*l;this._maxHeight=this._maxTerrainHeight*l;if(this._useFragmentCulling=l=E._supportsMaterials(d.context)){var D=!0;for(B=0;B<r;++B)if(k=q[B],l=k.geometry,C=P(d,l),G.shouldUseSphericalCoordinates(C)){D=!1;break}for(B=0;B<r;++B){k=q[B];l=k.geometry;m=l.constructor;C=P(d,l);var x=l.textureCoordinateRotationPoints;C=D?G.getPlanarTextureCoordinateAttributes(C,x,h,d.mapProjection,this._maxHeight):G.getSphericalExtentGeometryInstanceAttributes(C,x,h,d.mapProjection);var x=k.attributes,Q;for(Q in x)x.hasOwnProperty(Q)&&(C[Q]=x[Q]);v[B]=new c({geometry:m.createShadowVolume(l,K(this),L(this)),attributes:C,id:k.id})}}else for(B=0;B<r;++B)k=q[B],l=k.geometry,m=l.constructor,v[B]=new c({geometry:m.createShadowVolume(l,K(this),L(this)),attributes:k.attributes,id:k.id});f.geometryInstances=v;f.appearance=this.appearance;f._createBoundingVolumeFunction=function(c,b){var d=c.mapProjection.ellipsoid,f=P(c,b);f.width<y.PI?(d=A.fromRectangle(f,e._maxHeight,e._minHeight,d),e._boundingVolumes.push(d)):e._boundingVolumes.push(a.fromEncodedCartesianVertices(b.attributes.position3DHigh.values,b.attributes.position3DLow.values));c.scene3DOnly||(f=a.fromRectangleWithHeights2D(f,c.mapProjection,e._maxHeight,e._minHeight),g.fromElements(f.center.z,f.center.x,f.center.y,f.center),e._boundingVolumes2D.push(f))};f._updateAndQueueCommandsFunction=function(a,c,b,d,f,h,g,k){a=c.mode===w.SCENE3D?e._boundingVolumes:e._boundingVolumes2D;var l=e.classificationType;k=l!==H.CESIUM_3D_TILE;var l=l!==H.TERRAIN,m=c.passes,p=e._primitive,q,u,r;if(m.render){var v=b.length;for(q=0;q<v;++q)u=a[Math.floor(q%v/3)],k&&(r=b[q],O(e,r,c,f,h,u,g)),l&&(r=b[q].derivedCommands.tileset,O(e,r,c,f,h,u,g));if(c.invertClassification)for(b=p._commandsIgnoreShow,v=b.length,q=0;q<v;++q)u=a[Math.floor(q/2)],r=b[q],O(e,r,c,f,h,u,g)}if(m.pick){g=d.length;var t;e._useFragmentCulling||(t=p._primitive._pickOffsets);for(q=0;q<g;++q)u=a[Math.floor(q%g/3)],e._useFragmentCulling||(u=a[t[Math.floor(q%g/3)].index]),k&&(r=d[q],Z(e,r,c,f,h,u)),l&&(r=d[q].derivedCommands.tileset,Z(e,r,c,f,h,u))}};this._primitive=new I(f);this._primitive.readyPromise.then(function(a){e._ready=!0;e.releaseGeometryInstances&&(e.geometryInstances=void 0);a=a._error;p(a)?e._readyPromise.reject(a):e._readyPromise.resolve(e)})}this._primitive.appearance=this.appearance;this._primitive.show=this.show;this._primitive.debugShowShadowVolume=this.debugShowShadowVolume;this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(d)}else{if(!this.asynchronous)throw new t("For synchronous GroundPrimitives, you must call GroundPrimitive.initializeTerrainHeights() and wait for the returned promise to resolve.");E.initializeTerrainHeights()}};E.prototype.getBoundingSphere=function(a){a=this._boundingSpheresKeys.indexOf(a);if(-1!==a)return this._boundingSpheres[a]};E.prototype.getGeometryInstanceAttributes=function(a){if(!p(this._primitive))throw new t("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(a)};E.prototype.isDestroyed=function(){return!1};E.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();return q(this)};E._supportsMaterials=function(a){return a.depthTexture};E.supportsMaterials=function(a){m.typeOf.object("scene",a);return E._supportsMaterials(a.frameState.context)};return E});F("Shaders/PolylineShadowVolumeVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\n#ifndef COLUMBUS_VIEW_2D\nattribute vec4 startHiAndForwardOffsetX;\nattribute vec4 startLoAndForwardOffsetY;\nattribute vec4 startNormalAndForwardOffsetZ;\nattribute vec4 endNormalAndTextureCoordinateNormalizationX;\nattribute vec4 rightNormalAndTextureCoordinateNormalizationY;\n#else\nattribute vec4 startHiLo2D;\nattribute vec4 offsetAndRight2D;\nattribute vec4 startEndNormals2D;\nattribute vec2 texcoordNormalization2D;\n#endif\nattribute float batchId;\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;\nvarying vec4 v_endPlaneNormalEcAndBatchId;\nvarying vec4 v_rightPlaneEC;\nvarying vec4 v_endEcAndStartEcX;\nvarying vec4 v_texcoordNormalizationAndStartEcYZ;\n#ifdef WIDTH_VARYING\nvarying float v_width;\n#endif\n#ifdef ANGLE_VARYING\nvarying float v_polylineAngle;\n#endif\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\nvoid main()\n{\n#ifdef COLUMBUS_VIEW_2D\nvec3 ecStart \x3d (czm_modelViewRelativeToEye * czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw))).xyz;\nvec3 forwardDirectionEC \x3d czm_normal * vec3(0.0, offsetAndRight2D.xy);\nvec3 ecEnd \x3d forwardDirectionEC + ecStart;\nforwardDirectionEC \x3d normalize(forwardDirectionEC);\nv_rightPlaneEC.xyz \x3d czm_normal * vec3(0.0, offsetAndRight2D.zw);\nv_rightPlaneEC.w \x3d -dot(v_rightPlaneEC.xyz, ecStart);\nvec4 startPlaneEC;\nstartPlaneEC.xyz \x3d  czm_normal * vec3(0.0, startEndNormals2D.xy);\nstartPlaneEC.w \x3d -dot(startPlaneEC.xyz, ecStart);\nvec4 endPlaneEC;\nendPlaneEC.xyz \x3d  czm_normal * vec3(0.0, startEndNormals2D.zw);\nendPlaneEC.w \x3d -dot(endPlaneEC.xyz, ecEnd);\nv_texcoordNormalizationAndStartEcYZ.x \x3d abs(texcoordNormalization2D.x);\nv_texcoordNormalizationAndStartEcYZ.y \x3d texcoordNormalization2D.y;\n#else // COLUMBUS_VIEW_2D\nvec3 ecStart \x3d (czm_modelViewRelativeToEye * czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz)).xyz;\nvec3 offset \x3d czm_normal * vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w);\nvec3 ecEnd \x3d ecStart + offset;\nvec3 forwardDirectionEC \x3d normalize(offset);\nvec4 startPlaneEC;\nstartPlaneEC.xyz \x3d czm_normal * startNormalAndForwardOffsetZ.xyz;\nstartPlaneEC.w \x3d -dot(startPlaneEC.xyz, ecStart);\nvec4 endPlaneEC;\nendPlaneEC.xyz \x3d czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;\nendPlaneEC.w \x3d -dot(endPlaneEC.xyz, ecEnd);\nv_rightPlaneEC.xyz \x3d czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;\nv_rightPlaneEC.w \x3d -dot(v_rightPlaneEC.xyz, ecStart);\nv_texcoordNormalizationAndStartEcYZ.x \x3d abs(endNormalAndTextureCoordinateNormalizationX.w);\nv_texcoordNormalizationAndStartEcYZ.y \x3d rightNormalAndTextureCoordinateNormalizationY.w;\n#endif // COLUMBUS_VIEW_2D\nv_endEcAndStartEcX.xyz \x3d ecEnd;\nv_endEcAndStartEcX.w \x3d ecStart.x;\nv_texcoordNormalizationAndStartEcYZ.zw \x3d ecStart.yz;\n#ifdef PER_INSTANCE_COLOR\nv_color \x3d czm_batchTable_color(batchId);\n#endif // PER_INSTANCE_COLOR\nvec4 positionRelativeToEye \x3d czm_computePosition();\nvec4 positionEC \x3d czm_modelViewRelativeToEye * positionRelativeToEye;\nfloat absStartPlaneDistance \x3d abs(czm_planeDistance(startPlaneEC, positionEC.xyz));\nfloat absEndPlaneDistance \x3d abs(czm_planeDistance(endPlaneEC, positionEC.xyz));\nvec3 planeDirection \x3d czm_branchFreeTernary(absStartPlaneDistance \x3c absEndPlaneDistance, startPlaneEC.xyz, endPlaneEC.xyz);\nvec3 upOrDown \x3d normalize(cross(v_rightPlaneEC.xyz, planeDirection));\nvec3 normalEC \x3d normalize(cross(planeDirection, upOrDown));\nupOrDown \x3d cross(forwardDirectionEC, normalEC);\nupOrDown \x3d float(czm_sceneMode \x3d\x3d czm_sceneMode3D) * upOrDown;\nupOrDown \x3d float(v_texcoordNormalizationAndStartEcYZ.y \x3e 1.0 || v_texcoordNormalizationAndStartEcYZ.y \x3c 0.0) * upOrDown;\nupOrDown \x3d min(GLOBE_MINIMUM_ALTITUDE, czm_geometricToleranceOverMeter * length(positionRelativeToEye.xyz)) * upOrDown;\npositionEC.xyz +\x3d upOrDown;\nv_texcoordNormalizationAndStartEcYZ.y \x3d czm_branchFreeTernary(v_texcoordNormalizationAndStartEcYZ.y \x3e 1.0, 0.0, abs(v_texcoordNormalizationAndStartEcYZ.y));\nfloat width \x3d czm_batchTable_width(batchId);\n#ifdef WIDTH_VARYING\nv_width \x3d width;\n#endif\nv_startPlaneNormalEcAndHalfWidth.xyz \x3d startPlaneEC.xyz;\nv_startPlaneNormalEcAndHalfWidth.w \x3d width * 0.5;\nv_endPlaneNormalEcAndBatchId.xyz \x3d endPlaneEC.xyz;\nv_endPlaneNormalEcAndBatchId.w \x3d batchId;\nwidth \x3d width * max(0.0, czm_metersPerPixel(positionEC));\nwidth \x3d width / dot(normalEC, v_rightPlaneEC.xyz);\n#ifdef COLUMBUS_VIEW_2D\nnormalEC *\x3d sign(texcoordNormalization2D.x);\n#else\nnormalEC *\x3d sign(endNormalAndTextureCoordinateNormalizationX.w);\n#endif\npositionEC.xyz +\x3d width * normalEC;\ngl_Position \x3d czm_depthClampFarPlane(czm_projection * positionEC);\n#ifdef ANGLE_VARYING\nvec2 approxLineDirection \x3d normalize(vec2(forwardDirectionEC.x, -forwardDirectionEC.y));\napproxLineDirection.y \x3d czm_branchFreeTernary(approxLineDirection.x \x3d\x3d 0.0 \x26\x26 approxLineDirection.y \x3d\x3d 0.0, -1.0, approxLineDirection.y);\nv_polylineAngle \x3d czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);\n#endif\n}\n"});F("Shaders/PolylineShadowVolumeFS",[],function(){return"#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvarying vec4 v_startPlaneNormalEcAndHalfWidth;\nvarying vec4 v_endPlaneNormalEcAndBatchId;\nvarying vec4 v_rightPlaneEC;\nvarying vec4 v_endEcAndStartEcX;\nvarying vec4 v_texcoordNormalizationAndStartEcYZ;\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#endif\nvoid main(void)\n{\nfloat logDepthOrDepth \x3d czm_branchFreeTernary(czm_sceneMode \x3d\x3d czm_sceneMode2D, gl_FragCoord.z, czm_unpackDepth(texture2D(czm_globeDepthTexture, gl_FragCoord.xy / czm_viewport.zw)));\nvec3 ecStart \x3d vec3(v_endEcAndStartEcX.w, v_texcoordNormalizationAndStartEcYZ.zw);\nif (logDepthOrDepth \x3d\x3d 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\ngl_FragColor \x3d vec4(1.0, 0.0, 0.0, 0.5);\nreturn;\n#else // DEBUG_SHOW_VOLUME\ndiscard;\n#endif // DEBUG_SHOW_VOLUME\n}\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\neyeCoordinate /\x3d eyeCoordinate.w;\nfloat halfMaxWidth \x3d v_startPlaneNormalEcAndHalfWidth.w * czm_metersPerPixel(eyeCoordinate);\nfloat widthwiseDistance \x3d czm_planeDistance(v_rightPlaneEC, eyeCoordinate.xyz);\nfloat distanceFromStart \x3d czm_planeDistance(v_startPlaneNormalEcAndHalfWidth.xyz, -dot(ecStart, v_startPlaneNormalEcAndHalfWidth.xyz), eyeCoordinate.xyz);\nfloat distanceFromEnd \x3d czm_planeDistance(v_endPlaneNormalEcAndBatchId.xyz, -dot(v_endEcAndStartEcX.xyz, v_endPlaneNormalEcAndBatchId.xyz), eyeCoordinate.xyz);\nif (abs(widthwiseDistance) \x3e halfMaxWidth || distanceFromStart \x3c 0.0 || distanceFromEnd \x3c 0.0) {\n#ifdef DEBUG_SHOW_VOLUME\ngl_FragColor \x3d vec4(1.0, 0.0, 0.0, 0.5);\nreturn;\n#else // DEBUG_SHOW_VOLUME\ndiscard;\n#endif // DEBUG_SHOW_VOLUME\n}\nvec3 alignedPlaneNormal;\nalignedPlaneNormal \x3d cross(v_rightPlaneEC.xyz, v_startPlaneNormalEcAndHalfWidth.xyz);\nalignedPlaneNormal \x3d normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));\ndistanceFromStart \x3d czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, ecStart), eyeCoordinate.xyz);\nalignedPlaneNormal \x3d cross(v_rightPlaneEC.xyz, v_endPlaneNormalEcAndBatchId.xyz);\nalignedPlaneNormal \x3d normalize(cross(alignedPlaneNormal, v_rightPlaneEC.xyz));\ndistanceFromEnd \x3d czm_planeDistance(alignedPlaneNormal, -dot(alignedPlaneNormal, v_endEcAndStartEcX.xyz), eyeCoordinate.xyz);\n#ifdef PER_INSTANCE_COLOR\ngl_FragColor \x3d czm_gammaCorrect(v_color);\n#else // PER_INSTANCE_COLOR\nfloat s \x3d clamp(distanceFromStart / (distanceFromStart + distanceFromEnd), 0.0, 1.0);\ns \x3d (s * v_texcoordNormalizationAndStartEcYZ.x) + v_texcoordNormalizationAndStartEcYZ.y;\nfloat t \x3d (widthwiseDistance + halfMaxWidth) / (2.0 * halfMaxWidth);\nczm_materialInput materialInput;\nmaterialInput.s \x3d s;\nmaterialInput.st \x3d vec2(s, t);\nmaterialInput.str \x3d vec3(s, t, 0.0);\nczm_material material \x3d czm_getMaterial(materialInput);\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#endif // PER_INSTANCE_COLOR\nczm_writeDepthClampedToFarPlane();\n}\n"});F("Shaders/PolylineShadowVolumeMorphVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec4 startHiAndForwardOffsetX;\nattribute vec4 startLoAndForwardOffsetY;\nattribute vec4 startNormalAndForwardOffsetZ;\nattribute vec4 endNormalAndTextureCoordinateNormalizationX;\nattribute vec4 rightNormalAndTextureCoordinateNormalizationY;\nattribute vec4 startHiLo2D;\nattribute vec4 offsetAndRight2D;\nattribute vec4 startEndNormals2D;\nattribute vec2 texcoordNormalization2D;\nattribute float batchId;\nvarying vec3 v_forwardDirectionEC;\nvarying vec3 v_texcoordNormalizationAndHalfWidth;\nvarying float v_batchId;\n#ifdef WIDTH_VARYING\nvarying float v_width;\n#endif\n#ifdef ANGLE_VARYING\nvarying float v_polylineAngle;\n#endif\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#else\nvarying vec2 v_alignedPlaneDistances;\nvarying float v_texcoordT;\n#endif\nvoid main()\n{\nv_batchId \x3d batchId;\nvec4 posRelativeToEye2D \x3d czm_translateRelativeToEye(vec3(0.0, startHiLo2D.xy), vec3(0.0, startHiLo2D.zw));\nvec4 posRelativeToEye3D \x3d czm_translateRelativeToEye(startHiAndForwardOffsetX.xyz, startLoAndForwardOffsetY.xyz);\nvec4 posRelativeToEye \x3d czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);\nvec3 posEc2D \x3d (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;\nvec3 posEc3D \x3d (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;\nvec3 startEC \x3d (czm_modelViewRelativeToEye * posRelativeToEye).xyz;\nvec4 startPlane2D;\nvec4 startPlane3D;\nstartPlane2D.xyz \x3d czm_normal * vec3(0.0, startEndNormals2D.xy);\nstartPlane3D.xyz \x3d czm_normal * startNormalAndForwardOffsetZ.xyz;\nstartPlane2D.w \x3d -dot(startPlane2D.xyz, posEc2D);\nstartPlane3D.w \x3d -dot(startPlane3D.xyz, posEc3D);\nvec4 rightPlane2D;\nvec4 rightPlane3D;\nrightPlane2D.xyz \x3d czm_normal * vec3(0.0, offsetAndRight2D.zw);\nrightPlane3D.xyz \x3d czm_normal * rightNormalAndTextureCoordinateNormalizationY.xyz;\nrightPlane2D.w \x3d -dot(rightPlane2D.xyz, posEc2D);\nrightPlane3D.w \x3d -dot(rightPlane3D.xyz, posEc3D);\nposRelativeToEye2D \x3d posRelativeToEye2D + vec4(0.0, offsetAndRight2D.xy, 0.0);\nposRelativeToEye3D \x3d posRelativeToEye3D + vec4(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w, 0.0);\nposRelativeToEye \x3d czm_columbusViewMorph(posRelativeToEye2D, posRelativeToEye3D, czm_morphTime);\nposEc2D \x3d (czm_modelViewRelativeToEye * posRelativeToEye2D).xyz;\nposEc3D \x3d (czm_modelViewRelativeToEye * posRelativeToEye3D).xyz;\nvec3 endEC \x3d (czm_modelViewRelativeToEye * posRelativeToEye).xyz;\nvec3 forwardEc3D \x3d czm_normal * normalize(vec3(startHiAndForwardOffsetX.w, startLoAndForwardOffsetY.w, startNormalAndForwardOffsetZ.w));\nvec3 forwardEc2D \x3d czm_normal * normalize(vec3(0.0, offsetAndRight2D.xy));\nvec4 endPlane2D;\nvec4 endPlane3D;\nendPlane2D.xyz \x3d czm_normal * vec3(0.0, startEndNormals2D.zw);\nendPlane3D.xyz \x3d czm_normal * endNormalAndTextureCoordinateNormalizationX.xyz;\nendPlane2D.w \x3d -dot(endPlane2D.xyz, posEc2D);\nendPlane3D.w \x3d -dot(endPlane3D.xyz, posEc3D);\nv_forwardDirectionEC \x3d normalize(endEC - startEC);\nvec2 cleanTexcoordNormalization2D;\ncleanTexcoordNormalization2D.x \x3d abs(texcoordNormalization2D.x);\ncleanTexcoordNormalization2D.y \x3d czm_branchFreeTernary(texcoordNormalization2D.y \x3e 1.0, 0.0, abs(texcoordNormalization2D.y));\nvec2 cleanTexcoordNormalization3D;\ncleanTexcoordNormalization3D.x \x3d abs(endNormalAndTextureCoordinateNormalizationX.w);\ncleanTexcoordNormalization3D.y \x3d rightNormalAndTextureCoordinateNormalizationY.w;\ncleanTexcoordNormalization3D.y \x3d czm_branchFreeTernary(cleanTexcoordNormalization3D.y \x3e 1.0, 0.0, abs(cleanTexcoordNormalization3D.y));\nv_texcoordNormalizationAndHalfWidth.xy \x3d mix(cleanTexcoordNormalization2D, cleanTexcoordNormalization3D, czm_morphTime);\n#ifdef PER_INSTANCE_COLOR\nv_color \x3d czm_batchTable_color(batchId);\n#else // PER_INSTANCE_COLOR\nv_alignedPlaneDistances.x \x3d -dot(v_forwardDirectionEC, startEC);\nv_alignedPlaneDistances.y \x3d -dot(-v_forwardDirectionEC, endEC);\n#endif // PER_INSTANCE_COLOR\n#ifdef WIDTH_VARYING\nfloat width \x3d czm_batchTable_width(batchId);\nfloat halfWidth \x3d width * 0.5;\nv_width \x3d width;\nv_texcoordNormalizationAndHalfWidth.z \x3d halfWidth;\n#else\nfloat halfWidth \x3d 0.5 * czm_batchTable_width(batchId);\nv_texcoordNormalizationAndHalfWidth.z \x3d halfWidth;\n#endif\nvec4 positionEc3D \x3d czm_modelViewRelativeToEye * czm_translateRelativeToEye(position3DHigh, position3DLow);\nfloat absStartPlaneDistance \x3d abs(czm_planeDistance(startPlane3D, positionEc3D.xyz));\nfloat absEndPlaneDistance \x3d abs(czm_planeDistance(endPlane3D, positionEc3D.xyz));\nvec3 planeDirection \x3d czm_branchFreeTernary(absStartPlaneDistance \x3c absEndPlaneDistance, startPlane3D.xyz, endPlane3D.xyz);\nvec3 upOrDown \x3d normalize(cross(rightPlane3D.xyz, planeDirection));\nvec3 normalEC \x3d normalize(cross(planeDirection, upOrDown));\nvec3 geodeticSurfaceNormal \x3d normalize(cross(normalEC, forwardEc3D));\ngeodeticSurfaceNormal *\x3d float(0.0 \x3c\x3d rightNormalAndTextureCoordinateNormalizationY.w \x26\x26 rightNormalAndTextureCoordinateNormalizationY.w \x3c\x3d 1.0);\ngeodeticSurfaceNormal *\x3d MAX_TERRAIN_HEIGHT;\npositionEc3D.xyz +\x3d geodeticSurfaceNormal;\nnormalEC *\x3d sign(endNormalAndTextureCoordinateNormalizationX.w);\npositionEc3D.xyz +\x3d halfWidth * max(0.0, czm_metersPerPixel(positionEc3D)) * normalEC;\nvec4 positionEc2D \x3d czm_modelViewRelativeToEye * czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\nabsStartPlaneDistance \x3d abs(czm_planeDistance(startPlane2D, positionEc2D.xyz));\nabsEndPlaneDistance \x3d abs(czm_planeDistance(endPlane2D, positionEc2D.xyz));\nplaneDirection \x3d czm_branchFreeTernary(absStartPlaneDistance \x3c absEndPlaneDistance, startPlane2D.xyz, endPlane2D.xyz);\nupOrDown \x3d normalize(cross(rightPlane2D.xyz, planeDirection));\nnormalEC \x3d normalize(cross(planeDirection, upOrDown));\ngeodeticSurfaceNormal \x3d normalize(cross(normalEC, forwardEc2D));\ngeodeticSurfaceNormal *\x3d float(0.0 \x3c\x3d texcoordNormalization2D.y \x26\x26 texcoordNormalization2D.y \x3c\x3d 1.0);\ngeodeticSurfaceNormal *\x3d MAX_TERRAIN_HEIGHT;\npositionEc2D.xyz +\x3d geodeticSurfaceNormal;\nnormalEC *\x3d sign(texcoordNormalization2D.x);\n#ifndef PER_INSTANCE_COLOR\nv_texcoordT \x3d clamp(sign(texcoordNormalization2D.x), 0.0, 1.0);\n#endif\npositionEc2D.xyz +\x3d halfWidth * max(0.0, czm_metersPerPixel(positionEc2D)) * normalEC;\ngl_Position \x3d czm_projection * mix(positionEc2D, positionEc3D, czm_morphTime);\n#ifdef ANGLE_VARYING\nvec2 approxLineDirection \x3d normalize(vec2(v_forwardDirectionEC.x, -v_forwardDirectionEC.y));\napproxLineDirection.y \x3d czm_branchFreeTernary(approxLineDirection.x \x3d\x3d 0.0 \x26\x26 approxLineDirection.y \x3d\x3d 0.0, -1.0, approxLineDirection.y);\nv_polylineAngle \x3d czm_fastApproximateAtan(approxLineDirection.x, approxLineDirection.y);\n#endif\n}\n"});
F("Shaders/PolylineShadowVolumeMorphFS",[],function(){return"varying vec3 v_forwardDirectionEC;\nvarying vec3 v_texcoordNormalizationAndHalfWidth;\nvarying float v_batchId;\n#ifdef PER_INSTANCE_COLOR\nvarying vec4 v_color;\n#else\nvarying vec2 v_alignedPlaneDistances;\nvarying float v_texcoordT;\n#endif\nfloat rayPlaneDistanceUnsafe(vec3 origin, vec3 direction, vec3 planeNormal, float planeDistance) {\nreturn (-planeDistance - dot(planeNormal, origin)) / dot(planeNormal, direction);\n}\nvoid main(void)\n{\nvec4 eyeCoordinate \x3d gl_FragCoord;\neyeCoordinate /\x3d eyeCoordinate.w;\n#ifdef PER_INSTANCE_COLOR\ngl_FragColor \x3d czm_gammaCorrect(v_color);\n#else // PER_INSTANCE_COLOR\nfloat distanceFromStart \x3d rayPlaneDistanceUnsafe(eyeCoordinate.xyz, -v_forwardDirectionEC, v_forwardDirectionEC.xyz, v_alignedPlaneDistances.x);\nfloat distanceFromEnd \x3d rayPlaneDistanceUnsafe(eyeCoordinate.xyz, v_forwardDirectionEC, -v_forwardDirectionEC.xyz, v_alignedPlaneDistances.y);\ndistanceFromStart \x3d max(0.0, distanceFromStart);\ndistanceFromEnd \x3d max(0.0, distanceFromEnd);\nfloat s \x3d distanceFromStart / (distanceFromStart + distanceFromEnd);\ns \x3d (s * v_texcoordNormalizationAndHalfWidth.x) + v_texcoordNormalizationAndHalfWidth.y;\nczm_materialInput materialInput;\nmaterialInput.s \x3d s;\nmaterialInput.st \x3d vec2(s, v_texcoordT);\nmaterialInput.str \x3d vec3(s, v_texcoordT, 0.0);\nczm_material material \x3d czm_getMaterial(materialInput);\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#endif // PER_INSTANCE_COLOR\n}\n"});F("Shaders/Appearances/PolylineColorAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec4 color;\nattribute float batchId;\nvarying vec4 v_color;\nvoid main()\n{\nfloat expandDir \x3d expandAndWidth.x;\nfloat width \x3d abs(expandAndWidth.y) + 0.5;\nbool usePrev \x3d expandAndWidth.y \x3c 0.0;\nvec4 p \x3d czm_computePosition();\nvec4 prev \x3d czm_computePrevPosition();\nvec4 next \x3d czm_computeNextPosition();\nv_color \x3d color;\nfloat angle;\nvec4 positionWC \x3d getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, angle);\ngl_Position \x3d czm_viewportOrthographic * positionWC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"});F("Shaders/PolylineCommon",[],function(){return"void clipLineSegmentToNearPlane(\nvec3 p0,\nvec3 p1,\nout vec4 positionWC,\nout bool clipped,\nout bool culledByNearPlane)\n{\nculledByNearPlane \x3d false;\nclipped \x3d false;\nvec3 p1ToP0 \x3d p1 - p0;\nfloat magnitude \x3d length(p1ToP0);\nvec3 direction \x3d normalize(p1ToP0);\nfloat endPoint0Distance \x3d  -(czm_currentFrustum.x + p0.z);\nfloat denominator \x3d -direction.z;\nif (endPoint0Distance \x3c 0.0 \x26\x26 abs(denominator) \x3c czm_epsilon7)\n{\nculledByNearPlane \x3d true;\n}\nelse if (endPoint0Distance \x3c 0.0 \x26\x26 abs(denominator) \x3e czm_epsilon7)\n{\nfloat t \x3d (czm_currentFrustum.x + p0.z) / denominator;\nif (t \x3c 0.0 || t \x3e magnitude)\n{\nculledByNearPlane \x3d true;\n}\nelse\n{\np0 \x3d p0 + t * direction;\nclipped \x3d true;\n}\n}\npositionWC \x3d czm_eyeToWindowCoordinates(vec4(p0, 1.0));\n}\nvec4 getPolylineWindowCoordinatesEC(vec4 positionEC, vec4 prevEC, vec4 nextEC, float expandDirection, float width, bool usePrevious, out float angle)\n{\nvec4 endPointWC, p0, p1;\nbool culledByNearPlane, clipped;\n#ifdef POLYLINE_DASH\nvec4 positionWindow \x3d czm_eyeToWindowCoordinates(positionEC);\nvec4 previousWindow \x3d czm_eyeToWindowCoordinates(prevEC);\nvec4 nextWindow \x3d czm_eyeToWindowCoordinates(nextEC);\nvec2 lineDir;\nif (usePrevious) {\nlineDir \x3d normalize(positionWindow.xy - previousWindow.xy);\n}\nelse {\nlineDir \x3d normalize(nextWindow.xy - positionWindow.xy);\n}\nangle \x3d atan(lineDir.x, lineDir.y) - 1.570796327;\nangle \x3d floor(angle / czm_piOverFour + 0.5) * czm_piOverFour;\n#endif\nclipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, p0, clipped, culledByNearPlane);\nclipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, p1, clipped, culledByNearPlane);\nclipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, endPointWC, clipped, culledByNearPlane);\nif (culledByNearPlane)\n{\nreturn vec4(0.0, 0.0, 0.0, 1.0);\n}\nvec2 prevWC \x3d normalize(p0.xy - endPointWC.xy);\nvec2 nextWC \x3d normalize(p1.xy - endPointWC.xy);\nfloat expandWidth \x3d width * 0.5;\nvec2 direction;\n#ifdef CLIP_POLYLINE\nif (clipped)\n{\nif (prevEC.z - positionEC.z \x3c 0.0)\n{\ndirection \x3d vec2(prevWC.y, -prevWC.x);\n}\nelse\n{\ndirection \x3d vec2(-prevWC.y, prevWC.x);\n}\n}\nelse\n#endif\nif (czm_equalsEpsilon(prevEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1) || czm_equalsEpsilon(prevWC, -nextWC, czm_epsilon1))\n{\ndirection \x3d vec2(-nextWC.y, nextWC.x);\n}\nelse if (czm_equalsEpsilon(nextEC.xyz - positionEC.xyz, vec3(0.0), czm_epsilon1))\n{\ndirection \x3d vec2(prevWC.y, -prevWC.x);\n}\nelse\n{\nvec2 normal \x3d vec2(-nextWC.y, nextWC.x);\ndirection \x3d normalize((nextWC + prevWC) * 0.5);\nif (dot(direction, normal) \x3c 0.0)\n{\ndirection \x3d -direction;\n}\nfloat sinAngle \x3d abs(direction.x * nextWC.y - direction.y * nextWC.x);\nexpandWidth \x3d clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n}\nvec2 offset \x3d direction * expandDirection * expandWidth * czm_resolutionScale;\nreturn vec4(endPointWC.xy + offset, -endPointWC.z, 1.0);\n}\nvec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle)\n{\nvec4 positionEC \x3d czm_modelViewRelativeToEye * position;\nvec4 prevEC \x3d czm_modelViewRelativeToEye * previous;\nvec4 nextEC \x3d czm_modelViewRelativeToEye * next;\nreturn getPolylineWindowCoordinatesEC(positionEC, prevEC, nextEC, expandDirection, width, usePrevious, angle);\n}\n"});F("Scene/PolylineColorAppearance","../Core/defaultValue ../Core/defineProperties ../Core/FeatureDetection ../Core/VertexFormat ../Shaders/Appearances/PerInstanceFlatColorAppearanceFS ../Shaders/Appearances/PolylineColorAppearanceVS ../Shaders/PolylineCommon ./Appearance".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=b(a,b.EMPTY_OBJECT);var f=b(a.translucent,!0),g=h.VERTEX_FORMAT;this.material=void 0;this.translucent=f;this._vertexShaderSource=b(a.vertexShaderSource,p);this._fragmentShaderSource=b(a.fragmentShaderSource,d);this._renderState=e.getDefaultRenderState(f,!1,a.renderState);this._closed=!1;this._vertexFormat=g}var p=m+"\n"+l,d=g;f.isInternetExplorer()||(p="#define CLIP_POLYLINE \n"+p);a(h.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});h.VERTEX_FORMAT=k.POSITION_ONLY;h.prototype.getFragmentShaderSource=e.prototype.getFragmentShaderSource;h.prototype.isTranslucent=e.prototype.isTranslucent;h.prototype.getRenderState=e.prototype.getRenderState;return h});F("Shaders/Appearances/PolylineMaterialAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec2 expandAndWidth;\nattribute vec2 st;\nattribute float batchId;\nvarying float v_width;\nvarying vec2 v_st;\nvarying float v_polylineAngle;\nvoid main()\n{\nfloat expandDir \x3d expandAndWidth.x;\nfloat width \x3d abs(expandAndWidth.y) + 0.5;\nbool usePrev \x3d expandAndWidth.y \x3c 0.0;\nvec4 p \x3d czm_computePosition();\nvec4 prev \x3d czm_computePrevPosition();\nvec4 next \x3d czm_computeNextPosition();\nv_width \x3d width;\nv_st \x3d st;\nvec4 positionWC \x3d getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, v_polylineAngle);\ngl_Position \x3d czm_viewportOrthographic * positionWC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"});F("Shaders/PolylineFS",[],function(){return"#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.s \x3d v_st.s;\nmaterialInput.st \x3d v_st;\nmaterialInput.str \x3d vec3(v_st, 0.0);\nczm_material material \x3d czm_getMaterial(materialInput);\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#ifdef VECTOR_TILE\ngl_FragColor *\x3d u_highlightColor;\n#endif\nczm_writeLogDepth();\n}\n"});F("Scene/PolylineMaterialAppearance","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/FeatureDetection ../Core/VertexFormat ../Shaders/Appearances/PolylineMaterialAppearanceVS ../Shaders/PolylineCommon ../Shaders/PolylineFS ./Appearance ./Material".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(e){e=b(e,b.EMPTY_OBJECT);var c=b(e.translucent,!0),f=d.VERTEX_FORMAT;this.material=a(e.material)?e.material:p.fromType(p.ColorType);this.translucent=c;this._vertexShaderSource=b(e.vertexShaderSource,q);this._fragmentShaderSource=b(e.fragmentShaderSource,t);this._renderState=h.getDefaultRenderState(c,!1,e.renderState);this._closed=!1;this._vertexFormat=f}var q=m+"\n"+l,t=e;k.isInternetExplorer()||(q="#define CLIP_POLYLINE \n"+q);f(d.prototype,{vertexShaderSource:{get:function(){var a=this._vertexShaderSource;-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&(a="#define POLYLINE_DASH\n"+a);return a}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}}});d.VERTEX_FORMAT=g.POSITION_AND_ST;d.prototype.getFragmentShaderSource=h.prototype.getFragmentShaderSource;d.prototype.isTranslucent=h.prototype.isTranslucent;d.prototype.getRenderState=h.prototype.getRenderState;return d});F("Scene/GroundPolylinePrimitive","../Core/ApproximateTerrainHeights ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/GeometryInstance ../Core/GeometryInstanceAttribute ../Core/GroundPolylineGeometry ../Core/isArray ../Shaders/PolylineShadowVolumeVS ../Shaders/PolylineShadowVolumeFS ../Shaders/PolylineShadowVolumeMorphVS ../Shaders/PolylineShadowVolumeMorphFS ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../ThirdParty/when ./BlendingState ./ClassificationType ./CullFace ./PolylineColorAppearance ./PolylineMaterialAppearance ./Primitive ./SceneMode ./StencilConstants ./StencilFunction ./StencilOperation".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L){function K(a){a=f(a,f.EMPTY_OBJECT);this.geometryInstances=a.geometryInstances;this._hasPerInstanceColors=!0;var c=a.appearance;k(c)||(c=new H);this.appearance=c;this.show=f(a.show,!0);this.classificationType=f(a.classificationType,B.BOTH);this.debugShowBoundingVolume=f(a.debugShowBoundingVolume,!1);this._debugShowShadowVolume=f(a.debugShowShadowVolume,!1);this._primitiveOptions={geometryInstances:void 0,appearance:void 0,vertexCacheOptimize:!1,interleave:f(a.interleave,!1),releaseGeometryInstances:f(a.releaseGeometryInstances,!0),allowPicking:f(a.allowPicking,!0),asynchronous:f(a.asynchronous,!0),compressVertices:!1,_createShaderProgramFunction:void 0,_createCommandsFunction:void 0,_updateAndQueueCommandsFunction:void 0};this._zIndex=void 0;this._ready=!1;this._readyPromise=D.defer();this._spMorph=this._sp2D=this._sp=this._primitive=void 0;this._renderState=P(!1);this._renderState3DTiles=P(!0);this._renderStateMorph=A.fromCache({cull:{enabled:!0,face:C.FRONT},depthTest:{enabled:!0},blending:v.ALPHA_BLEND,depthMask:!1})}function P(a){return A.fromCache({cull:{enabled:!0},blending:v.ALPHA_BLEND,depthMask:!1,stencilTest:{enabled:a,frontFunction:E.EQUAL,frontOperation:{fail:L.KEEP,zFail:L.KEEP,zPass:L.KEEP},backFunction:E.EQUAL,backOperation:{fail:L.KEEP,zFail:L.KEEP,zPass:L.KEEP},reference:G.CESIUM_3D_TILE_MASK,mask:G.CESIUM_3D_TILE_MASK}})}function N(a,c,b,d,e,f,h){b.mode===w.MORPHING?c=c.derivedCommands.colorMorph:b.mode!==w.SCENE3D&&(c=c.derivedCommands.color2D);c.modelMatrix=d;c.boundingVolume=f;c.cull=e;c.debugShowBoundingVolume=h;b.commandList.push(c)}g(K.prototype,{interleave:{get:function(){return this._primitiveOptions.interleave}},releaseGeometryInstances:{get:function(){return this._primitiveOptions.releaseGeometryInstances}},allowPicking:{get:function(){return this._primitiveOptions.allowPicking}},asynchronous:{get:function(){return this._primitiveOptions.asynchronous}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},debugShowShadowVolume:{get:function(){return this._debugShowShadowVolume}}});K.initializeTerrainHeights=function(){return b.initialize()};K.prototype.update=function(f){if(k(this._primitive)||k(this.geometryInstances))if(b.initialized){var g,l=this,v=this._primitiveOptions;if(!k(this._primitive)){var C=d(this.geometryInstances)?this.geometryInstances:[this.geometryInstances],A=C.length,D=Array(A),E;for(g=0;g<A;++g)if(E=C[g].attributes,!k(E)||!k(E.color)){this._hasPerInstanceColors=!1;break}for(g=0;g<A;++g){var G=C[g];E={};var L=G.attributes,H;for(H in L)L.hasOwnProperty(H)&&(E[H]=L[H]);k(E.width)||(E.width=new h({componentDatatype:a.UNSIGNED_BYTE,componentsPerAttribute:1,value:[G.geometry.width]}));G.geometry._scene3DOnly=f.scene3DOnly;p.setProjectionAndEllipsoid(G.geometry,f.mapProjection);D[g]=new e({geometry:G.geometry,attributes:E,id:G.id,pickPrimitive:l})}v.geometryInstances=D;v.appearance=this.appearance;v._createShaderProgramFunction=function(a,d,e){a=d.context;var f=l._primitive,h=f._attributeLocations,g=f._batchTable.getVertexShaderCallback()(q),g=J._appendShowToShader(f,g),g=J._appendDistanceDisplayConditionToShader(f,g),g=J._modifyShaderPosition(l,g,d.scene3DOnly),m=f._batchTable.getVertexShaderCallback()(r),m=J._appendShowToShader(f,m),m=J._appendDistanceDisplayConditionToShader(f,m),m=J._modifyShaderPosition(l,m,d.scene3DOnly),p=f._batchTable.getVertexShaderCallback()(t),u=["ENABLE_GL_POSITION_LOG_DEPTH_AT_HEIGHT","GLOBE_MINIMUM_ALTITUDE "+d.mapProjection.ellipsoid.minimumRadius.toFixed(1)],w="";d="";k(e.material)?(d=k(e.material)?e.material.shaderSource:"",-1!==d.search(/varying\s+float\s+v_polylineAngle;/g)&&u.push("ANGLE_VARYING"),-1!==d.search(/varying\s+float\s+v_width;/g)&&u.push("WIDTH_VARYING")):w="PER_INSTANCE_COLOR";u.push(w);e=l.debugShowShadowVolume?["DEBUG_SHOW_VOLUME",w]:[w];w=new x({defines:u,sources:[g]});p=new x({defines:e,sources:[d,p]});l._sp=z.replaceCache({context:a,shaderProgram:f._sp,vertexShaderSource:w,fragmentShaderSource:p,attributeLocations:h});w=a.shaderCache.getDerivedShaderProgram(l._sp,"2dColor");k(w)||(g=new x({defines:u.concat(["COLUMBUS_VIEW_2D"]),sources:[g]}),w=a.shaderCache.createDerivedShaderProgram(l._sp,"2dColor",{context:a,shaderProgram:l._sp2D,vertexShaderSource:g,fragmentShaderSource:p,attributeLocations:h}));l._sp2D=w;g=a.shaderCache.getDerivedShaderProgram(l._sp,"MorphColor");k(g)||(m=new x({defines:u.concat(["MAX_TERRAIN_HEIGHT "+b._defaultMaxTerrainHeight.toFixed(1)]),sources:[m]}),p=f._batchTable.getVertexShaderCallback()(c),f=new x({defines:e,sources:[d,p]}),g=a.shaderCache.createDerivedShaderProgram(l._sp,"MorphColor",{context:a,shaderProgram:l._spMorph,vertexShaderSource:m,fragmentShaderSource:f,attributeLocations:h}));l._spMorph=g};v._createCommandsFunction=function(a,c,b,d,e,f,h){a=l._primitive;d=a._va.length;f.length=d;h.length=d;c=c instanceof I?{}:b._uniforms;c=a._batchTable.getUniformMapCallback()(c);for(b=0;b<d;b++){e=a._va[b];h=f[b];k(h)||(h=f[b]=new u({owner:l,primitiveType:a._primitiveType}));h.vertexArray=e;h.renderState=l._renderState;h.shaderProgram=l._sp;h.uniformMap=c;h.pass=y.TERRAIN_CLASSIFICATION;h.pickId="czm_batchTable_pickColor(v_endPlaneNormalEcAndBatchId.w)";e=u.shallowClone(h,h.derivedCommands.tileset);e.renderState=l._renderState3DTiles;e.pass=y.CESIUM_3D_TILE_CLASSIFICATION;h.derivedCommands.tileset=e;var g=u.shallowClone(h,h.derivedCommands.color2D);g.shaderProgram=l._sp2D;h.derivedCommands.color2D=g;g=u.shallowClone(e,e.derivedCommands.color2D);g.shaderProgram=l._sp2D;e.derivedCommands.color2D=g;e=u.shallowClone(h,h.derivedCommands.colorMorph);e.renderState=l._renderStateMorph;e.shaderProgram=l._spMorph;e.pickId="czm_batchTable_pickColor(v_batchId)";h.derivedCommands.colorMorph=e}};v._updateAndQueueCommandsFunction=function(a,c,b,d,e,f,h,g){g=l._primitive;J._updateBoundingVolumes(g,c,e);var m;c.mode===w.SCENE3D?m=g._boundingSphereWC:c.mode===w.COLUMBUS_VIEW?m=g._boundingSphereCV:c.mode===w.SCENE2D&&k(g._boundingSphere2D)?m=g._boundingSphere2D:k(g._boundingSphereMorph)&&(m=g._boundingSphereMorph);d=c.mode===w.MORPHING;var p=l.classificationType;a=p!==B.CESIUM_3D_TILE;d=p!==B.TERRAIN&&!d;p=c.passes;if(p.render||p.pick&&g.allowPicking)for(var p=b.length,q=0;q<p;++q){var u=m[q];a&&(g=b[q],N(l,g,c,e,f,u,h));d&&(g=b[q].derivedCommands.tileset,N(l,g,c,e,f,u,h))}};this._primitive=new J(v);this._primitive.readyPromise.then(function(a){l._ready=!0;l.releaseGeometryInstances&&(l.geometryInstances=void 0);a=a._error;k(a)?l._readyPromise.reject(a):l._readyPromise.resolve(l)})}if(this.appearance instanceof I&&!this._hasPerInstanceColors)throw new m("All GeometryInstances must have color attributes to use PolylineColorAppearance with GroundPolylinePrimitive.");this._primitive.appearance=this.appearance;this._primitive.show=this.show;this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume;this._primitive.update(f)}else{if(!this.asynchronous)throw new m("For synchronous GroundPolylinePrimitives, you must call GroundPolylinePrimitives.initializeTerrainHeights() and wait for the returned promise to resolve.");K.initializeTerrainHeights()}};K.prototype.getGeometryInstanceAttributes=function(a){if(!k(this._primitive))throw new m("must call update before calling getGeometryInstanceAttributes");return this._primitive.getGeometryInstanceAttributes(a)};K.isSupported=function(a){return a.frameState.context.depthTexture};K.prototype.isDestroyed=function(){return!1};K.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();this._sp=this._sp&&this._sp.destroy();this._spMorph=this._sp2D=void 0;return l(this)};return K});F("DataSources/ImageMaterialProperty","../Core/Cartesian2 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=f(a,f.EMPTY_OBJECT);this._definitionChanged=new l;this._transparentSubscription=this._transparent=this._colorSubscription=this._color=this._repeatSubscription=this._repeat=this._imageSubscription=this._image=void 0;this.image=a.image;this.repeat=a.repeat;this.color=a.color;this.transparent=a.transparent}var p=new b(1,1),d=a.WHITE;g(h.prototype,{isConstant:{get:function(){return e.isConstant(this._image)&&e.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},image:m("image"),repeat:m("repeat"),color:m("color"),transparent:m("transparent")});h.prototype.getType=function(a){return"Image"};h.prototype.getValue=function(a,b){k(b)||(b={});b.image=e.getValueOrUndefined(this._image,a);b.repeat=e.getValueOrClonedDefault(this._repeat,a,p,b.repeat);b.color=e.getValueOrClonedDefault(this._color,a,d,b.color);e.getValueOrDefault(this._transparent,a,!1)&&(b.color.alpha=Math.min(.99,b.color.alpha));return b};h.prototype.equals=function(a){return this===a||a instanceof h&&e.equals(this._image,a._image)&&e.equals(this._repeat,a._repeat)&&e.equals(this._color,a._color)&&e.equals(this._transparent,a._transparent)};return h});F("DataSources/createMaterialPropertyDescriptor","../Core/Color ../Core/DeveloperError ../Core/Resource ./ColorMaterialProperty ./createPropertyDescriptor ./ImageMaterialProperty".split(" "),function(b,a,f,k,g,l){function m(e){if(e instanceof b)return new k(e);if("string"===typeof e||e instanceof f||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement){var h=new l;h.image=e;return h}throw new a("Unable to infer material type: "+e);}return function(a,b){return g(a,b,m)}});F("DataSources/BoxGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._heightReferenceSubscription=this._heightReference=this._dimensionsSubscription=this._dimensions=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),dimensions:m("dimensions"),heightReference:m("heightReference"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.dimensions=this.dimensions;b.heightReference=this.heightReference;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.dimensions=b(this.dimensions,e.dimensions);this.heightReference=b(this.heightReference,e.heightReference);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/PositionProperty","../Core/Cartesian3 ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Matrix3 ../Core/ReferenceFrame ../Core/Transforms".split(" "),function(b,a,f,k,g,l,m){function e(){k.throwInstantiationError()}f(e.prototype,{isConstant:{get:k.throwInstantiationError},definitionChanged:{get:k.throwInstantiationError},referenceFrame:{get:k.throwInstantiationError}});e.prototype.getValue=k.throwInstantiationError;e.prototype.getValueInReferenceFrame=k.throwInstantiationError;e.prototype.equals=k.throwInstantiationError;var h=new g;e.convertToReferenceFrame=function(e,d,f,k,r){if(!a(d))return d;a(r)||(r=new b);if(f===k)return b.clone(d,r);k=m.computeIcrfToFixedMatrix(e,h);a(k)||(k=m.computeTemeToPseudoFixedMatrix(e,h));if(f===l.INERTIAL)return g.multiplyByVector(k,d,r);if(f===l.FIXED)return g.multiplyByVector(g.transpose(k,h),d,r)};return e});F("DataSources/ConstantPositionProperty","../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/ReferenceFrame ./PositionProperty".split(" "),function(b,a,f,k,g,l,m,e){function h(e,d){this._definitionChanged=new l;this._value=b.clone(e);this._referenceFrame=a(d,m.FIXED)}k(h.prototype,{isConstant:{get:function(){return!f(this._value)||this._referenceFrame===m.FIXED}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});h.prototype.getValue=function(a,b){return this.getValueInReferenceFrame(a,m.FIXED,b)};h.prototype.setValue=function(a,d){var e=!1;b.equals(this._value,a)||(e=!0,this._value=b.clone(a));f(d)&&this._referenceFrame!==d&&(e=!0,this._referenceFrame=d);e&&this._definitionChanged.raiseEvent(this)};h.prototype.getValueInReferenceFrame=function(a,b,h){if(!f(a))throw new g("time is required.");if(!f(b))throw new g("referenceFrame is required.");return e.convertToReferenceFrame(a,this._value,this._referenceFrame,b,h)};h.prototype.equals=function(a){return this===a||a instanceof h&&b.equals(this._value,a._value)&&this._referenceFrame===a._referenceFrame};return h});F("DataSources/CorridorGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._zIndexSubscription=this._zIndex=this._classificationTypeSubscription=this._classificationType=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._granularitySubscription=this._granularity=this._cornerTypeSubscription=this._cornerType=this._extrudedHeightReferenceSubscription=this._extrudedHeightReference=this._extrudedHeightSubscription=this._extrudedHeight=this._heightReferenceSubscription=this._heightReference=this._heightSubscription=this._height=this._widthSubscription=this._width=this._positionsSubscription=this._positions=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),positions:m("positions"),width:m("width"),height:m("height"),heightReference:m("heightReference"),extrudedHeight:m("extrudedHeight"),extrudedHeightReference:m("extrudedHeightReference"),cornerType:m("cornerType"),granularity:m("granularity"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition"),classificationType:m("classificationType"),zIndex:m("zIndex")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.positions=this.positions;b.width=this.width;b.height=this.height;b.heightReference=this.heightReference;b.extrudedHeight=this.extrudedHeight;b.extrudedHeightReference=this.extrudedHeightReference;b.cornerType=this.cornerType;b.granularity=this.granularity;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;b.classificationType=this.classificationType;b.zIndex=this.zIndex;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.positions=b(this.positions,e.positions);this.width=b(this.width,e.width);this.height=b(this.height,e.height);this.heightReference=b(this.heightReference,e.heightReference);this.extrudedHeight=b(this.extrudedHeight,e.extrudedHeight);this.extrudedHeightReference=b(this.extrudedHeightReference,e.extrudedHeightReference);this.cornerType=b(this.cornerType,e.cornerType);this.granularity=b(this.granularity,e.granularity);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition);this.classificationType=b(this.classificationType,e.classificationType);this.zIndex=b(this.zIndex,e.zIndex)};return e});F("DataSources/createRawPropertyDescriptor",["./createPropertyDescriptor"],function(b){function a(a){return a}return function(f,k){return b(f,k,a)}});F("DataSources/CylinderGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._slicesSubscription=this._slices=this._numberOfVerticalLinesSubscription=this._numberOfVerticalLines=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._heightReferenceSubscription=this._heightReference=this._bottomRadiusSubscription=this._bottomRadius=this._topRadiusSubscription=this._topRadius=this._lengthSubscription=this._length=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),length:m("length"),topRadius:m("topRadius"),bottomRadius:m("bottomRadius"),heightReference:m("heightReference"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),numberOfVerticalLines:m("numberOfVerticalLines"),slices:m("slices"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.length=this.length;b.topRadius=this.topRadius;b.bottomRadius=this.bottomRadius;b.heightReference=this.heightReference;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.numberOfVerticalLines=this.numberOfVerticalLines;b.slices=this.slices;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.length=b(this.length,e.length);this.topRadius=b(this.topRadius,e.topRadius);this.bottomRadius=b(this.bottomRadius,e.bottomRadius);this.heightReference=b(this.heightReference,e.heightReference);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.numberOfVerticalLines=b(this.numberOfVerticalLines,e.numberOfVerticalLines);this.slices=b(this.slices,e.slices);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/EllipseGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._zIndexSubscription=this._zIndex=this._classificationTypeSubscription=this._classificationType=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._numberOfVerticalLinesSubscription=this._numberOfVerticalLines=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._granularitySubscription=this._granularity=this._stRotationSubscription=this._stRotation=this._rotationSubscription=this._rotation=this._extrudedHeightReferenceSubscription=this._extrudedHeightReference=this._extrudedHeightSubscription=this._extrudedHeight=this._heightReferenceSubscription=this._heightReference=this._heightSubscription=this._height=this._semiMinorAxisSubscription=this._semiMinorAxis=this._semiMajorAxisSubscription=this._semiMajorAxis=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),semiMajorAxis:m("semiMajorAxis"),semiMinorAxis:m("semiMinorAxis"),height:m("height"),heightReference:m("heightReference"),extrudedHeight:m("extrudedHeight"),extrudedHeightReference:m("extrudedHeightReference"),rotation:m("rotation"),stRotation:m("stRotation"),granularity:m("granularity"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),numberOfVerticalLines:m("numberOfVerticalLines"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition"),classificationType:m("classificationType"),zIndex:m("zIndex")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.semiMajorAxis=this.semiMajorAxis;b.semiMinorAxis=this.semiMinorAxis;b.height=this.height;b.heightReference=this.heightReference;b.extrudedHeight=this.extrudedHeight;b.extrudedHeightReference=this.extrudedHeightReference;b.rotation=this.rotation;b.stRotation=this.stRotation;b.granularity=this.granularity;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.numberOfVerticalLines=this.numberOfVerticalLines;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;b.classificationType=this.classificationType;b.zIndex=this.zIndex;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.semiMajorAxis=b(this.semiMajorAxis,e.semiMajorAxis);this.semiMinorAxis=b(this.semiMinorAxis,e.semiMinorAxis);this.height=b(this.height,e.height);this.heightReference=b(this.heightReference,e.heightReference);this.extrudedHeight=b(this.extrudedHeight,e.extrudedHeight);this.extrudedHeightReference=b(this.extrudedHeightReference,e.extrudedHeightReference);this.rotation=b(this.rotation,e.rotation);this.stRotation=b(this.stRotation,e.stRotation);this.granularity=b(this.granularity,e.granularity);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.numberOfVerticalLines=b(this.numberOfVerticalLines,e.numberOfVerticalLines);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition);this.classificationType=b(this.classificationType,e.classificationType);this.zIndex=b(this.zIndex,e.zIndex)};return e});F("DataSources/EllipsoidGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._subdivisionsSubscription=this._subdivisions=this._slicePartitionsSubscription=this._slicePartitions=this._stackPartitionsSubscription=this._stackPartitions=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._heightReferenceSubscription=this._heightReference=this._radiiSubscription=this._radii=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),radii:m("radii"),heightReference:m("heightReference"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),stackPartitions:m("stackPartitions"),slicePartitions:m("slicePartitions"),subdivisions:m("subdivisions"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.radii=this.radii;b.heightReference=this.heightReference;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.stackPartitions=this.stackPartitions;b.slicePartitions=this.slicePartitions;b.subdivisions=this.subdivisions;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.radii=b(this.radii,e.radii);this.heightReference=b(this.heightReference,e.heightReference);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.stackPartitions=b(this.stackPartitions,e.stackPartitions);this.slicePartitions=b(this.slicePartitions,e.slicePartitions);this.subdivisions=b(this.subdivisions,e.subdivisions);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/LabelGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l){function m(a){this._definitionChanged=new g;this._enableShiftLine=this._disableDepthTestDistanceSubscription=this._disableDepthTestDistance=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._scaleByDistanceSubscription=this._scaleByDistance=this._pixelOffsetScaleByDistanceSubscription=this._pixelOffsetScaleByDistance=this._translucencyByDistanceSubscription=this._translucencyByDistance=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._fillColorSubscription=this._fillColor=this._heightReferenceSubscription=this._heightReference=this._verticalOriginSubscription=this._verticalOrigin=this._horizontalOriginSubscription=this._horizontalOrigin=this._eyeOffsetSubscription=this._eyeOffset=this._pixelOffsetSubscription=this._pixelOffset=this._backgroundPaddingSubscription=this._backgroundPadding=this._backgroundColorSubscription=this._backgroundColor=this._showBackgroundSubscription=this._showBackground=this._scaleSubscription=this._scale=this._styleSubscription=this._style=this._fontSubscription=this._font=this._textSubscription=this._text=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(m.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:l("show"),text:l("text"),font:l("font"),style:l("style"),scale:l("scale"),showBackground:l("showBackground"),backgroundColor:l("backgroundColor"),backgroundPadding:l("backgroundPadding"),pixelOffset:l("pixelOffset"),eyeOffset:l("eyeOffset"),horizontalOrigin:l("horizontalOrigin"),verticalOrigin:l("verticalOrigin"),heightReference:l("heightReference"),fillColor:l("fillColor"),outlineColor:l("outlineColor"),outlineWidth:l("outlineWidth"),translucencyByDistance:l("translucencyByDistance"),pixelOffsetScaleByDistance:l("pixelOffsetScaleByDistance"),scaleByDistance:l("scaleByDistance"),distanceDisplayCondition:l("distanceDisplayCondition"),enableShiftLine:l("enableShiftLine"),disableDepthTestDistance:l("disableDepthTestDistance")});m.prototype.clone=function(b){if(!a(b))return new m(this);b.show=this.show;b.text=this.text;b.font=this.font;b.style=this.style;b.scale=this.scale;b.showBackground=this.showBackground;b.backgroundColor=this.backgroundColor;b.backgroundPadding=this.backgroundPadding;b.pixelOffset=this.pixelOffset;b.eyeOffset=this.eyeOffset;b.horizontalOrigin=this.horizontalOrigin;b.verticalOrigin=this.verticalOrigin;b.heightReference=this.heightReference;b.fillColor=this.fillColor;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.translucencyByDistance=this.translucencyByDistance;b.pixelOffsetScaleByDistance=this.pixelOffsetScaleByDistance;b.scaleByDistance=this.scaleByDistance;b.distanceDisplayCondition=this.distanceDisplayCondition;b.disableDepthTestDistance=this.disableDepthTestDistance;b.enableShiftLine=this.enableShiftLine;return b};m.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.text=b(this.text,e.text);this.font=b(this.font,e.font);this.style=b(this.style,e.style);this.scale=b(this.scale,e.scale);this.showBackground=b(this.showBackground,e.showBackground);this.backgroundColor=b(this.backgroundColor,e.backgroundColor);this.backgroundPadding=b(this.backgroundPadding,e.backgroundPadding);this.pixelOffset=b(this.pixelOffset,e.pixelOffset);this.eyeOffset=b(this.eyeOffset,e.eyeOffset);this.horizontalOrigin=b(this.horizontalOrigin,e.horizontalOrigin);this.verticalOrigin=b(this.verticalOrigin,e.verticalOrigin);this.heightReference=b(this.heightReference,e.heightReference);this.fillColor=b(this.fillColor,e.fillColor);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.translucencyByDistance=b(this.translucencyByDistance,e.translucencyByDistance);this.pixelOffsetScaleByDistance=b(this.pixelOffsetScaleByDistance,e.pixelOffsetScaleByDistance);this.scaleByDistance=b(this.scaleByDistance,e.scaleByDistance);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition);this.disableDepthTestDistance=b(this.disableDepthTestDistance,e.disableDepthTestDistance);this.enableShiftLine=b(this.enableShiftLine,e.enableShiftLine)};return m});F("DataSources/NodeTransformationProperty","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ../Core/TranslationRotationScale ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m){var e=new g,h=function(a){a=b(a,b.EMPTY_OBJECT);this._definitionChanged=new k;this._scaleSubscription=this._scale=this._rotationSubscription=this._rotation=this._translationSubscription=this._translation=void 0;this.translation=a.translation;this.rotation=a.rotation;this.scale=a.scale};f(h.prototype,{isConstant:{get:function(){return m.isConstant(this._translation)&&m.isConstant(this._rotation)&&m.isConstant(this._scale)}},definitionChanged:{get:function(){return this._definitionChanged}},translation:l("translation"),rotation:l("rotation"),scale:l("scale")});h.prototype.getValue=function(b,d){a(d)||(d=new g);d.translation=m.getValueOrClonedDefault(this._translation,b,e.translation,d.translation);d.rotation=m.getValueOrClonedDefault(this._rotation,b,e.rotation,d.rotation);d.scale=m.getValueOrClonedDefault(this._scale,b,e.scale,d.scale);return d};h.prototype.equals=function(a){return this===a||a instanceof h&&m.equals(this._translation,a._translation)&&m.equals(this._rotation,a._rotation)&&m.equals(this._scale,a._scale)};return h});F("DataSources/PropertyBag","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./ConstantProperty ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(a){return new l(a)}var p=function(b,e){this._propertyNames=[];this._definitionChanged=new g;a(b)&&this.merge(b,e)};f(p.prototype,{propertyNames:{get:function(){return this._propertyNames}},isConstant:{get:function(){for(var a=this._propertyNames,b=0,f=a.length;b<f;b++)if(!e.isConstant(this[a[b]]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}});p.prototype.hasProperty=function(a){return-1!==this._propertyNames.indexOf(a)};p.prototype.addProperty=function(d,e,f){var g=this._propertyNames;if(!a(d))throw new k("propertyName is required.");if(-1!==g.indexOf(d))throw new k(d+" is already a registered property.");g.push(d);Object.defineProperty(this,d,m(d,!0,b(f,h)));a(e)&&(this[d]=e);this._definitionChanged.raiseEvent(this)};p.prototype.removeProperty=function(b){var d=this._propertyNames.indexOf(b);if(!a(b))throw new k("propertyName is required.");if(-1===d)throw new k(b+" is not a registered property.");this._propertyNames.splice(d,1);delete this[b];this._definitionChanged.raiseEvent(this)};p.prototype.getValue=function(b,f){if(!a(b))throw new k("time is required.");a(f)||(f={});for(var d=this._propertyNames,h=0,c=d.length;h<c;h++){var g=d[h];f[g]=e.getValueOrUndefined(this[g],b,f[g])}return f};p.prototype.merge=function(b,e){if(!a(b))throw new k("source is required.");for(var d=this._propertyNames,f=a(b._propertyNames)?b._propertyNames:Object.keys(b),c=0,h=f.length;c<h;c++){var g=f[c],l=this[g],m=b[g];void 0===l&&-1===d.indexOf(g)&&this.addProperty(g,void 0,e);void 0!==m&&(void 0!==l?a(l)&&a(l.merge)&&l.merge(m):a(m)&&a(m.merge)&&a(m.clone)?this[g]=m.clone():this[g]=m)}};p.prototype.equals=function(a){var b;if(!(b=this===a)&&(b=a instanceof p))a:{b=this._propertyNames;var d=a._propertyNames,f=b.length;if(f!==d.length)b=!1;else{for(var c=0;c<f;++c){var h=b[c];if(-1===d.indexOf(h)||!e.equals(this[h],a[h])){b=!1;break a}}b=!0}}return b};return p});F("DataSources/ModelGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createPropertyDescriptor ./NodeTransformationProperty ./PropertyBag".split(" "),function(b,a,f,k,g,l,m,e){function h(a){return new m(a)}function p(a){this._definitionChanged=new g;this._enableLighting=this._clippingPlanesSubscription=this._clippingPlanes=this._articulationsSubscription=this._articulations=this._nodeTransformationsSubscription=this._nodeTransformations=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._lightColorSubscription=this._lightColor=this._imageBasedLightingFactorSubscription=this._imageBasedLightingFactor=this._colorBlendAmountSubscription=this._colorBlendAmount=this._colorBlendModeSubscription=this._colorBlendMode=this._colorSubscription=this._color=this._silhouetteSizeSubscription=this._silhouetteSize=this._silhouetteColorSubscription=this._silhouetteColor=this._heightReferenceSubscription=this._heightReference=this._shadowsSubscription=this._shadows=this._clampAnimationsSubscription=this._clampAnimations=this._runAnimationsSubscription=this._runAnimations=this._incrementallyLoadTexturesSubscription=this._incrementallyLoadTextures=this._maximumScaleSubscription=this._maximumScale=this._minimumPixelSizeSubscription=this._minimumPixelSize=this._scaleSubscription=this._scale=this._uriSubscription=this._uri=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(p.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:l("show"),uri:l("uri"),scale:l("scale"),minimumPixelSize:l("minimumPixelSize"),maximumScale:l("maximumScale"),incrementallyLoadTextures:l("incrementallyLoadTextures"),runAnimations:l("runAnimations"),clampAnimations:l("clampAnimations"),shadows:l("shadows"),heightReference:l("heightReference"),silhouetteColor:l("silhouetteColor"),silhouetteSize:l("silhouetteSize"),color:l("color"),colorBlendMode:l("colorBlendMode"),colorBlendAmount:l("colorBlendAmount"),imageBasedLightingFactor:l("imageBasedLightingFactor"),enableLighting:l("enableLighting"),lightColor:l("lightColor"),distanceDisplayCondition:l("distanceDisplayCondition"),nodeTransformations:l("nodeTransformations",void 0,function(a){return new e(a,h)}),articulations:l("articulations",void 0,function(a){return new e(a)}),clippingPlanes:l("clippingPlanes")});p.prototype.clone=function(b){if(!a(b))return new p(this);b.show=this.show;b.uri=this.uri;b.scale=this.scale;b.minimumPixelSize=this.minimumPixelSize;b.maximumScale=this.maximumScale;b.incrementallyLoadTextures=this.incrementallyLoadTextures;b.runAnimations=this.runAnimations;b.clampAnimations=this.clampAnimations;b.heightReference=this._heightReference;b.silhouetteColor=this.silhouetteColor;b.silhouetteSize=this.silhouetteSize;b.color=this.color;b.colorBlendMode=this.colorBlendMode;b.colorBlendAmount=this.colorBlendAmount;b.imageBasedLightingFactor=this.imageBasedLightingFactor;b.lightColor=this.lightColor;b.distanceDisplayCondition=this.distanceDisplayCondition;b.nodeTransformations=this.nodeTransformations;b.articulations=this.articulations;b.clippingPlanes=this.clippingPlanes;b.enableLighting=this.enableLighting;return b};p.prototype.merge=function(d){if(!a(d))throw new k("source is required.");this.show=b(this.show,d.show);this.uri=b(this.uri,d.uri);this.scale=b(this.scale,d.scale);this.minimumPixelSize=b(this.minimumPixelSize,d.minimumPixelSize);this.maximumScale=b(this.maximumScale,d.maximumScale);this.incrementallyLoadTextures=b(this.incrementallyLoadTextures,d.incrementallyLoadTextures);this.runAnimations=b(this.runAnimations,d.runAnimations);this.clampAnimations=b(this.clampAnimations,d.clampAnimations);this.shadows=b(this.shadows,d.shadows);this.heightReference=b(this.heightReference,d.heightReference);this.silhouetteColor=b(this.silhouetteColor,d.silhouetteColor);this.silhouetteSize=b(this.silhouetteSize,d.silhouetteSize);this.color=b(this.color,d.color);this.colorBlendMode=b(this.colorBlendMode,d.colorBlendMode);this.colorBlendAmount=b(this.colorBlendAmount,d.colorBlendAmount);this.imageBasedLightingFactor=b(this.imageBasedLightingFactor,d.imageBasedLightingFactor);this.lightColor=b(this.lightColor,d.lightColor);this.distanceDisplayCondition=b(this.distanceDisplayCondition,d.distanceDisplayCondition);this.clippingPlanes=b(this.clippingPlanes,d.clippingPlanes);this.enableLighting=b(this.enableLighting,d.enableLighting);var f=d.nodeTransformations;if(a(f)){var g=this.nodeTransformations;a(g)?g.merge(f):this.nodeTransformations=new e(f,h)}d=d.articulations;a(d)&&(f=this.articulations,a(f)?f.merge(d):this.articulations=new e(d))};return p});F("DataSources/PathGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._materialSubscription=this._material=this._resolutionSubscription=this._resolution=this._widthSubscription=this._width=this._trailTimeSubscription=this._trailTime=this._leadTimeSubscription=this._leadTime=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),leadTime:m("leadTime"),trailTime:m("trailTime"),width:m("width"),resolution:m("resolution"),material:l("material"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.leadTime=this.leadTime;b.trailTime=this.trailTime;b.width=this.width;b.resolution=this.resolution;b.material=this.material;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.leadTime=b(this.leadTime,e.leadTime);this.trailTime=b(this.trailTime,e.trailTime);this.width=b(this.width,e.width);this.resolution=b(this.resolution,e.resolution);this.material=b(this.material,e.material);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/PlaneGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._dimensionsSubscription=this._dimensions=this._planeSubscription=this._plane=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),plane:m("plane"),dimensions:m("dimensions"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.plane=this.plane;b.dimensions=this.dimensions;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.plane=b(this.plane,e.plane);this.dimensions=b(this.dimensions,e.dimensions);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/PointGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l){function m(a){this._definitionChanged=new g;this._disableDepthTestDistanceSubscription=this._disableDepthTestDistance=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._translucencyByDistanceSubscription=this._translucencyByDistance=this._scaleByDistanceSubscription=this._scaleByDistance=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._colorSubscription=this._color=this._heightReferenceSubscription=this._heightReference=this._pixelSizeSubscription=this._pixelSize=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(m.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:l("show"),pixelSize:l("pixelSize"),heightReference:l("heightReference"),color:l("color"),outlineColor:l("outlineColor"),outlineWidth:l("outlineWidth"),scaleByDistance:l("scaleByDistance"),translucencyByDistance:l("translucencyByDistance"),distanceDisplayCondition:l("distanceDisplayCondition"),disableDepthTestDistance:l("disableDepthTestDistance")});m.prototype.clone=function(b){if(!a(b))return new m(this);b.show=this.show;b.pixelSize=this.pixelSize;b.heightReference=this.heightReference;b.color=this.color;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.scaleByDistance=this.scaleByDistance;b.translucencyByDistance=this._translucencyByDistance;b.distanceDisplayCondition=this.distanceDisplayCondition;b.disableDepthTestDistance=this.disableDepthTestDistance;return b};m.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.pixelSize=b(this.pixelSize,e.pixelSize);this.heightReference=b(this.heightReference,e.heightReference);this.color=b(this.color,e.color);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.scaleByDistance=b(this.scaleByDistance,e.scaleByDistance);this.translucencyByDistance=b(this._translucencyByDistance,e.translucencyByDistance);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition);this.disableDepthTestDistance=b(this.disableDepthTestDistance,e.disableDepthTestDistance)};return m});F("DataSources/PolygonGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._zIndexSubscription=this._zIndex=this._classificationTypeSubscription=this._classificationType=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._arcTypeSubscription=this._arcType=this._closeBottomSubscription=this._closeBottom=this._closeTopSubscription=this._closeTop=this._perPositionHeightSubscription=this._perPositionHeight=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._granularitySubscription=this._granularity=this._stRotationSubscription=this._stRotation=this._extrudedHeightReferenceSubscription=this._extrudedHeightReference=this._extrudedHeightSubscription=this._extrudedHeight=this._heightReferenceSubscription=this._heightReference=this._heightSubscription=this._height=this._hierarchySubscription=this._hierarchy=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),hierarchy:m("hierarchy"),height:m("height"),heightReference:m("heightReference"),extrudedHeight:m("extrudedHeight"),extrudedHeightReference:m("extrudedHeightReference"),stRotation:m("stRotation"),granularity:m("granularity"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),perPositionHeight:m("perPositionHeight"),closeTop:m("closeTop"),closeBottom:m("closeBottom"),arcType:m("arcType"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition"),classificationType:m("classificationType"),zIndex:m("zIndex")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.hierarchy=this.hierarchy;b.height=this.height;b.heightReference=this.heightReference;b.extrudedHeight=this.extrudedHeight;b.extrudedHeightReference=this.extrudedHeightReference;b.stRotation=this.stRotation;b.granularity=this.granularity;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.perPositionHeight=this.perPositionHeight;b.closeTop=this.closeTop;b.closeBottom=this.closeBottom;b.arcType=this.arcType;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;b.classificationType=this.classificationType;b.zIndex=this.zIndex;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.hierarchy=b(this.hierarchy,e.hierarchy);this.height=b(this.height,e.height);this.heightReference=b(this.heightReference,e.heightReference);this.extrudedHeight=b(this.extrudedHeight,e.extrudedHeight);this.extrudedHeightReference=b(this.extrudedHeightReference,e.extrudedHeightReference);this.stRotation=b(this.stRotation,e.stRotation);this.granularity=b(this.granularity,e.granularity);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.perPositionHeight=b(this.perPositionHeight,e.perPositionHeight);this.closeTop=b(this.closeTop,e.closeTop);this.closeBottom=b(this.closeBottom,e.closeBottom);this.arcType=b(this.arcType,e.arcType);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition);this.classificationType=b(this.classificationType,e.classificationType);this.zIndex=b(this.zIndex,e.zIndex)};return e});F("DataSources/PolylineGraphics","../Core/ArcType ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e){function h(b){this._definitionChanged=new l;this._zIndexSubscription=this._zIndex=this._classificationTypeSubscription=this._classificationType=this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._clampToGroundSubscription=this._clampToGround=this._arcTypeSubscription=this._arcType=this._depthFailMaterialSubscription=this._depthFailMaterial=this._materialSubscription=this._material=this._granularitySubscription=this._granularity=this._widthSubscription=this._width=this._positionsSubscription=this._positions=this._showSubscription=this._show=void 0;this.merge(a(b,a.EMPTY_OBJECT))}k(h.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:e("show"),positions:e("positions"),width:e("width"),granularity:e("granularity"),material:m("material"),depthFailMaterial:m("depthFailMaterial"),arcType:e("arcType"),clampToGround:e("clampToGround"),shadows:e("shadows"),distanceDisplayCondition:e("distanceDisplayCondition"),classificationType:e("classificationType"),zIndex:e("zIndex")});h.prototype.clone=function(a){if(!f(a))return new h(this);a.show=this.show;a.positions=this.positions;a.width=this.width;a.granularity=this.granularity;a.material=this.material;a.depthFailMaterial=this.depthFailMaterial;a.arcType=this.arcType;a.clampToGround=this.clampToGround;a.shadows=this.shadows;a.distanceDisplayCondition=this.distanceDisplayCondition;a.classificationType=this.classificationType;a.zIndex=this.zIndex;return a};h.prototype.merge=function(b){if(!f(b))throw new g("source is required.");this.show=a(this.show,b.show);this.positions=a(this.positions,b.positions);this.width=a(this.width,b.width);this.granularity=a(this.granularity,b.granularity);this.material=a(this.material,b.material);this.depthFailMaterial=a(this.depthFailMaterial,b.depthFailMaterial);this.arcType=a(this.arcType,b.arcType);this.clampToGround=a(this.clampToGround,b.clampToGround);this.shadows=a(this.shadows,b.shadows);this.distanceDisplayCondition=a(this.distanceDisplayCondition,b.distanceDisplayCondition);this.classificationType=a(this.classificationType,b.classificationType);this.zIndex=a(this.zIndex,b.zIndex)};return h});F("DataSources/PolylineVolumeGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubsription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._granularitySubscription=this._granularity=this._cornerTypeSubscription=this._cornerType=this._shapeSubscription=this._shape=this._positionsSubscription=this._positions=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),positions:m("positions"),shape:m("shape"),cornerType:m("cornerType"),granularity:m("granularity"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.positions=this.positions;b.shape=this.shape;b.cornerType=this.cornerType;b.granularity=this.granularity;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.positions=b(this.positions,e.positions);this.shape=b(this.shape,e.shape);this.cornerType=b(this.cornerType,e.cornerType);this.granularity=b(this.granularity,e.granularity);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/RectangleGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._zIndexSubscription=this._zIndex=this._classificationTypeSubscription=this._classificationType=this._distancedisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._granularitySubscription=this._granularity=this._stRotationSubscription=this._stRotation=this._rotationSubscription=this._rotation=this._extrudedHeightReferenceSubscription=this._extrudedHeightReference=this._extrudedHeightSubscription=this._extrudedHeight=this._heightReferenceSubscription=this._heightReference=this._heightSubscription=this._height=this._coordinatesSubscription=this._coordinates=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),coordinates:m("coordinates"),height:m("height"),heightReference:m("heightReference"),extrudedHeight:m("extrudedHeight"),extrudedHeightReference:m("extrudedHeightReference"),rotation:m("rotation"),stRotation:m("stRotation"),granularity:m("granularity"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition"),classificationType:m("classificationType"),zIndex:m("zIndex")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.coordinates=this.coordinates;b.height=this.height;b.heightReference=this.heightReference;b.extrudedHeight=this.extrudedHeight;b.extrudedHeightReference=this.extrudedHeightReference;b.rotation=this.rotation;b.stRotation=this.stRotation;b.granularity=this.granularity;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;b.classificationType=this.classificationType;b.zIndex=this.zIndex;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.coordinates=b(this.coordinates,e.coordinates);this.height=b(this.height,e.height);this.heightReference=b(this.heightReference,e.heightReference);this.extrudedHeight=b(this.extrudedHeight,e.extrudedHeight);this.extrudedHeightReference=b(this.extrudedHeightReference,e.extrudedHeightReference);this.rotation=b(this.rotation,e.rotation);this.stRotation=b(this.stRotation,e.stRotation);this.granularity=b(this.granularity,e.granularity);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition);this.classificationType=b(this.classificationType,e.classificationType);this.zIndex=b(this.zIndex,e.zIndex)};return e});F("DataSources/WallGraphics","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./createMaterialPropertyDescriptor ./createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._distanceDisplayConditionSubscription=this._distanceDisplayCondition=this._shadowsSubscription=this._shadows=this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._outlineSubscription=this._outline=this._materialSubscription=this._material=this._fillSubscription=this._fill=this._granularitySubscription=this._granularity=this._maximumHeightsSubscription=this._maximumHeights=this._minimumHeightsSubscription=this._minimumHeights=this._positionsSubscription=this._positions=this._showSubscription=this._show=void 0;this.merge(b(a,b.EMPTY_OBJECT))}f(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),positions:m("positions"),minimumHeights:m("minimumHeights"),maximumHeights:m("maximumHeights"),granularity:m("granularity"),fill:m("fill"),material:l("material"),outline:m("outline"),outlineColor:m("outlineColor"),outlineWidth:m("outlineWidth"),shadows:m("shadows"),distanceDisplayCondition:m("distanceDisplayCondition")});e.prototype.clone=function(b){if(!a(b))return new e(this);b.show=this.show;b.positions=this.positions;b.minimumHeights=this.minimumHeights;b.maximumHeights=this.maximumHeights;b.granularity=this.granularity;b.fill=this.fill;b.material=this.material;b.outline=this.outline;b.outlineColor=this.outlineColor;b.outlineWidth=this.outlineWidth;b.shadows=this.shadows;b.distanceDisplayCondition=this.distanceDisplayCondition;return b};e.prototype.merge=function(e){if(!a(e))throw new k("source is required.");this.show=b(this.show,e.show);this.positions=b(this.positions,e.positions);this.minimumHeights=b(this.minimumHeights,e.minimumHeights);this.maximumHeights=b(this.maximumHeights,e.maximumHeights);this.granularity=b(this.granularity,e.granularity);this.fill=b(this.fill,e.fill);this.material=b(this.material,e.material);this.outline=b(this.outline,e.outline);this.outlineColor=b(this.outlineColor,e.outlineColor);this.outlineWidth=b(this.outlineWidth,e.outlineWidth);this.shadows=b(this.shadows,e.shadows);this.distanceDisplayCondition=b(this.distanceDisplayCondition,e.distanceDisplayCondition)};return e});F("DataSources/Entity","../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/Quaternion ../Core/Transforms ../Scene/HeightReference ../Scene/GroundPrimitive ../Scene/GroundPolylinePrimitive ./BillboardGraphics ./BoxGraphics ./ConstantPositionProperty ./CorridorGraphics ./createPropertyDescriptor ./createRawPropertyDescriptor ./CylinderGraphics ./EllipseGraphics ./EllipsoidGraphics ./LabelGraphics ./ModelGraphics ./PathGraphics ./PlaneGraphics ./PointGraphics ./PolygonGraphics ./PolylineGraphics ./PolylineVolumeGraphics ./Property ./PropertyBag ./RectangleGraphics ./WallGraphics".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U){function W(a,b){return v(a,void 0,function(a){return a instanceof b?a:new b(a)})}function M(a){a=g(a,g.EMPTY_OBJECT);var b=a.id;l(b)||(b=k());this._availability=void 0;this._id=b;this._definitionChanged=new h;this._name=a.name;this._show=g(a.show,!0);this._parent=void 0;this._propertyNames="billboard box corridor cylinder description ellipse ellipsoid label model orientation path plane point polygon polyline polylineVolume position properties rectangle viewFrom wall".split(" ");this._wallSubscription=this._wall=this._viewFromSubscription=this._viewFrom=this._rectangleSubscription=this._rectangle=this._propertiesSubscription=this._properties=this._positionSubscription=this._position=this._polylineVolumeSubscription=this._polylineVolume=this._polylineSubscription=this._polyline=this._polygonSubscription=this._polygon=this._pointSubscription=this._point=this._planeSubscription=this._plane=this._pathSubscription=this._path=this._orientationSubscription=this._orientation=this._modelSubscription=this._model=this._labelSubscription=this._label=this._ellipsoidSubscription=this._ellipsoid=this._ellipseSubscription=this._ellipse=this._descriptionSubscription=this._description=this._cylinderSubscription=this._cylinder=this._corridorSubscription=this._corridor=this._boxSubscription=this._box=this._billboardSubscription=this._billboard=void 0;this._children=[];this.entityCollection=void 0;this.parent=a.parent;this.merge(a)}function R(a,b,c){for(var d=b.length,e=0;e<d;e++){var f=b[e],h=f._show;(!c&&h)!==(c&&h)&&R(f,f._children,c)}a._definitionChanged.raiseEvent(a,"isShowing",c,!c)}var Y=new a;m(M.prototype,{availability:B("availability"),id:{get:function(){return this._id}},definitionChanged:{get:function(){return this._definitionChanged}},name:B("name"),show:{get:function(){return this._show},set:function(a){if(!l(a))throw new e("value is required.");if(a!==this._show){var b=this.isShowing;this._show=a;var c=this.isShowing;b!==c&&R(this,this._children,c);this._definitionChanged.raiseEvent(this,"show",a,!a)}}},isShowing:{get:function(){return this._show&&(!l(this.entityCollection)||this.entityCollection.show)&&(!l(this._parent)||this._parent.isShowing)}},parent:{get:function(){return this._parent},set:function(a){var b=this._parent;if(b!==a){var c=this.isShowing;if(l(b)){var d=b._children.indexOf(this);b._children.splice(d,1)}this._parent=a;l(a)&&a._children.push(this);d=this.isShowing;c!==d&&R(this,this._children,d);this._definitionChanged.raiseEvent(this,"parent",a,b)}}},propertyNames:{get:function(){return this._propertyNames}},billboard:W("billboard",A),box:W("box",z),corridor:W("corridor",D),cylinder:W("cylinder",C),description:v("description"),ellipse:W("ellipse",I),ellipsoid:W("ellipsoid",H),label:W("label",J),model:W("model",w),orientation:v("orientation"),path:W("path",G),plane:W("plane",E),point:W("point",L),polygon:W("polygon",K),polyline:W("polyline",P),polylineVolume:W("polylineVolume",N),properties:W("properties",Z),position:v("position",void 0,function(a){return new x(a)}),rectangle:W("rectangle",aa),viewFrom:v("viewFrom"),wall:W("wall",U)});M.prototype.isAvailable=function(a){if(!l(a))throw new e("time is required.");var b=this._availability;return!l(b)||b.contains(a)};M.prototype.addProperty=function(a){var b=this._propertyNames;if(!l(a))throw new e("propertyName is required.");if(-1!==b.indexOf(a))throw new e(a+" is already a registered property.");if(a in this)throw new e(a+" is a reserved property name.");b.push(a);Object.defineProperty(this,a,B(a,!0))};M.prototype.removeProperty=function(a){var b=this._propertyNames.indexOf(a);if(!l(a))throw new e("propertyName is required.");if(-1===b)throw new e(a+" is not a registered property.");this._propertyNames.splice(b,1);delete this[a]};M.prototype.merge=function(a){if(!l(a))throw new e("source is required.");this.name=g(this.name,a.name);this.availability=g(this.availability,a.availability);for(var b=this._propertyNames,c=l(a._propertyNames)?a._propertyNames:Object.keys(a),d=c.length,f=0;f<d;f++){var h=c[f];if("parent"!==h){var k=this[h],m=a[h];l(k)||-1!==b.indexOf(h)||this.addProperty(h);l(m)&&(l(k)?l(k.merge)&&k.merge(m):l(m.merge)&&l(m.clone)?this[h]=m.clone():this[h]=m)}}};var Q=new d,S=new b,ca=new t;M.prototype.computeModelMatrix=function(a,b){f.typeOf.object("time",a);var c=O.getValueOrUndefined(this._position,a,S);if(l(c)){var e=O.getValueOrUndefined(this._orientation,a,ca);return b=l(e)?q.fromRotationTranslation(d.fromQuaternion(e,Q),c,b):r.eastNorthUpToFixedFrame(c,void 0,b)}};M.prototype.computeModelMatrixForHeightReference=function(a,e,h,g,k){f.typeOf.object("time",a);var m=O.getValueOrDefault(e,a,c.NONE);e=O.getValueOrUndefined(this._position,a,S);if(m===c.NONE||!l(e)||b.equalsEpsilon(e,b.ZERO,p.EPSILON8))return this.computeModelMatrix(a,k);var u=g.cartesianToCartographic(e,Y);u.height=m===c.CLAMP_TO_GROUND?h:u.height+h;e=g.cartographicToCartesian(u,e);a=O.getValueOrUndefined(this._orientation,a,ca);return k=l(a)?q.fromRotationTranslation(d.fromQuaternion(a,Q),e,k):r.eastNorthUpToFixedFrame(e,void 0,k)};M.supportsMaterialsforEntitiesOnTerrain=function(a){return u.supportsMaterials(a)};M.supportsPolylinesOnTerrain=function(a){return y.isSupported(a)};return M});F("DataSources/GeometryUpdater","../Core/Check ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/Event ../Core/Iso8601 ../Core/oneTimeWarning ../Scene/ClassificationType ../Scene/ShadowMode ./ColorMaterialProperty ./ConstantProperty ./Entity ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){b.defined("options.entity",a.entity);b.defined("options.scene",a.scene);b.defined("options.geometryOptions",a.geometryOptions);b.defined("options.geometryPropertyName",a.geometryPropertyName);b.defined("options.observedPropertyNames",a.observedPropertyNames);var c=a.entity,d=a.geometryPropertyName;this._entity=c;this._scene=a.scene;this._outlineEnabled=this._dynamic=this._onTerrain=this._isClosed=this._fillEnabled=!1;this._geometryChanged=new h;this._outlineColorProperty=this._showOutlineProperty=this._materialProperty=this._showProperty=void 0;this._outlineWidth=1;this._classificationTypeProperty=this._distanceDisplayConditionProperty=this._shadowsProperty=void 0;this._options=a.geometryOptions;this._geometryPropertyName=d;this._id=d+"-"+c.id;this._observedPropertyNames=a.observedPropertyNames;this._supportsMaterialsforEntitiesOnTerrain=u.supportsMaterialsforEntitiesOnTerrain(a.scene)}var z=new r(a.WHITE),x=new c(!0),D=new c(!0),v=new c(!1),B=new c(a.BLACK),C=new c(t.DISABLED),I=new c(new e),H=new c(q.BOTH);g(A.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!k(this._entity.availability)&&y.isConstant(this._showProperty)&&y.isConstant(this._fillProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},outlineEnabled:{get:function(){return this._outlineEnabled}},hasConstantOutline:{get:function(){return!this._outlineEnabled||!k(this._entity.availability)&&y.isConstant(this._showProperty)&&y.isConstant(this._showOutlineProperty)}},outlineColorProperty:{get:function(){return this._outlineColorProperty}},outlineWidth:{get:function(){return this._outlineWidth}},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{get:function(){return this._isClosed}},onTerrain:{get:function(){return this._onTerrain}},geometryChanged:{get:function(){return this._geometryChanged}}});A.prototype.isOutlineVisible=function(a){var b=this._entity;a=this._outlineEnabled&&b.isAvailable(a)&&this._showProperty.getValue(a)&&this._showOutlineProperty.getValue(a);return f(a,!1)};A.prototype.isFilled=function(a){var b=this._entity;a=this._fillEnabled&&b.isAvailable(a)&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a);return f(a,!1)};A.prototype.createFillGeometryInstance=m.throwInstantiationError;A.prototype.createOutlineGeometryInstance=m.throwInstantiationError;A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){l(this)};A.prototype._isHidden=function(a,b){var c=b.show;return k(c)&&c.isConstant&&!c.getValue(p.MINIMUM_VALUE)};A.prototype._isOnTerrain=function(a,b){return!1};A.prototype._getIsClosed=function(a){return!0};A.prototype._isDynamic=m.throwInstantiationError;A.prototype._setStaticOptions=m.throwInstantiationError;A.prototype._onEntityPropertyChanged=function(a,b,c,e){if(-1!==this._observedPropertyNames.indexOf(b))if(b=this._entity[this._geometryPropertyName],k(b)){e=b.fill;var h=k(e)&&e.isConstant?e.getValue(p.MINIMUM_VALUE):!0,g=b.outline;(c=k(g))&&g.isConstant&&(c=g.getValue(p.MINIMUM_VALUE));if(h||c)if(g=b.show,this._isHidden(a,b)){if(this._fillEnabled||this._outlineEnabled)this._outlineEnabled=this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)}else this._materialProperty=f(b.material,z),this._fillProperty=f(e,D),this._showProperty=f(g,x),this._showOutlineProperty=f(b.outline,v),this._outlineColorProperty=c?f(b.outlineColor,B):void 0,this._shadowsProperty=f(b.shadows,C),this._distanceDisplayConditionProperty=f(b.distanceDisplayCondition,I),this._classificationTypeProperty=f(b.classificationType,H),this._fillEnabled=h,e=this._isOnTerrain(a,b)&&(this._supportsMaterialsforEntitiesOnTerrain||this._materialProperty instanceof r),c&&e&&(d(d.geometryOutlines),c=!1),this._onTerrain=e,this._outlineEnabled=c,this._isDynamic(a,b)?this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this)):(this._setStaticOptions(a,b),this._isClosed=this._getIsClosed(this._options),a=b.outlineWidth,this._outlineWidth=k(a)?a.getValue(p.MINIMUM_VALUE):1,this._dynamic=!1,this._geometryChanged.raiseEvent(this));else if(this._fillEnabled||this._outlineEnabled)this._outlineEnabled=this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)}else if(this._fillEnabled||this._outlineEnabled)this._outlineEnabled=this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)};A.prototype.createDynamicUpdater=function(a,c){b.defined("primitives",a);b.defined("groundPrimitives",c);if(!this._dynamic)throw new m("This instance does not represent dynamic geometry.");return new this.constructor.DynamicGeometryUpdater(this,a,c)};return A});F("DataSources/TerrainOffsetProperty","../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Event ../Core/Iso8601 ../Core/Math ../Scene/HeightReference ../Scene/SceneMode ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(c,d,h,g){f.defined("scene",c);f.defined("positionProperty",d);this._scene=c;this._heightReference=h;this._extrudedHeightReference=g;this._positionProperty=d;this._position=new b;this._cartographicPosition=new a;this._normal=new b;this._definitionChanged=new m;this._terrainHeight=0;this._removeModeListener=this._removeEventListener=this._removeCallbackFunc=void 0;var l=this;k(c.globe)&&(this._removeEventListener=c.terrainProviderChanged.addEventListener(function(){l._updateClamping()}),this._removeModeListener=c.morphComplete.addEventListener(function(){l._updateClamping()}));d.isConstant&&(d=d.getValue(e.MINIMUM_VALUE,r),k(d)&&!b.equals(d,b.ZERO)&&k(c.globe)&&(this._position=b.clone(d,this._position),this._updateClamping(),this._normal=c.globe.ellipsoid.geodeticSurfaceNormal(d,this._normal)))}var r=new b,c=new a;g(t.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}}});t.prototype._updateClamping=function(){k(this._removeCallbackFunc)&&this._removeCallbackFunc();var a=this._scene,e=a.globe,f=this._position;if(!k(e)||b.equals(f,b.ZERO))this._terrainHeight=0;else{var h=e.ellipsoid,g=e._surface,l=this,f=h.cartesianToCartographic(f,this._cartographicPosition),e=e.getHeight(f);k(e)?this._terrainHeight=e:this._terrainHeight=0;this._removeCallbackFunc=g.updateHeight(f,function(b){a.mode===d.SCENE3D?(b=h.cartesianToCartographic(b,c),l._terrainHeight=b.height):l._terrainHeight=b.x;l.definitionChanged.raiseEvent()})}};t.prototype.getValue=function(a,c){var d=q.getValueOrDefault(this._heightReference,a,p.NONE),e=q.getValueOrDefault(this._extrudedHeightReference,a,p.NONE);if(d===p.NONE&&e!==p.RELATIVE_TO_GROUND)return this._position=b.clone(b.ZERO,this._position),b.clone(b.ZERO,c);if(this._positionProperty.isConstant)return b.multiplyByScalar(this._normal,this._terrainHeight,c);d=this._scene;e=this._positionProperty.getValue(a,r);if(!k(e)||b.equals(e,b.ZERO)||!k(d.globe))return b.clone(b.ZERO,c);if(b.equalsEpsilon(this._position,e,h.EPSILON10))return b.multiplyByScalar(this._normal,this._terrainHeight,c);this._position=b.clone(e,this._position);this._updateClamping();d=d.globe.ellipsoid.geodeticSurfaceNormal(e,this._normal);return b.multiplyByScalar(d,this._terrainHeight,c)};t.prototype.isDestroyed=function(){return!1};t.prototype.destroy=function(){k(this._removeEventListener)&&this._removeEventListener();k(this._removeModeListener)&&this._removeModeListener();k(this._removeCallbackFunc)&&this._removeCallbackFunc();return l(this)};return t});F("DataSources/heightReferenceOnEntityPropertyChanged",["../Core/defaultValue","../Core/defined","./CallbackProperty","./GeometryUpdater","./TerrainOffsetProperty"],function(b,a,f,k,g){return function(b,m,e,h){k.prototype._onEntityPropertyChanged.call(this,b,m,e,h);-1!==this._observedPropertyNames.indexOf(m)&&(b=this._entity[this._geometryPropertyName],a(b)&&(a(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),b=b.heightReference,a(b)&&(m=new f(this._computeCenter.bind(this),!this._dynamic),this._terrainOffsetProperty=new g(this._scene,m,b))))}});F("DataSources/MaterialProperty",["../Core/Color","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Scene/Material"],function(b,a,f,k,g){function l(){k.throwInstantiationError()}f(l.prototype,{isConstant:{get:k.throwInstantiationError},definitionChanged:{get:k.throwInstantiationError}});l.prototype.getType=k.throwInstantiationError;l.prototype.getValue=k.throwInstantiationError;l.prototype.equals=k.throwInstantiationError;l.getValue=function(f,e,h){var k;if(a(e)&&(k=e.getType(f),a(k)))return a(h)&&h.type===k||(h=g.fromType(k)),e.getValue(f,h.uniforms),h;a(h)&&h.type===g.ColorType||(h=g.fromType(g.ColorType));b.clone(b.WHITE,h.uniforms.color);return h};return l});F("DataSources/DynamicGeometryUpdater","../Core/BoundingSphere ../Core/Check ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Scene/GroundPrimitive ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ../Scene/Primitive ./BoundingSphereState ./ColorMaterialProperty ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(b,d,e){a.defined("geometryUpdater",b);a.defined("primitives",d);a.defined("orderedGroundPrimitives",e);this._primitives=d;this._orderedGroundPrimitives=e;this._outlinePrimitive=this._primitive=void 0;this._geometryUpdater=b;this._options=b._options;this._entity=b._entity;this._material=void 0}r.prototype._isHidden=function(a,b,d){return!a.isShowing||!a.isAvailable(d)||!t.getValueOrDefault(b.show,d,!0)};r.prototype._setOptions=g.throwInstantiationError;r.prototype.update=function(b){a.defined("time",b);var c=this._geometryUpdater,g=c._onTerrain,k=this._primitives,p=this._orderedGroundPrimitives;g?p.remove(this._primitive):(k.removeAndDestroy(this._primitive),k.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=void 0);this._primitive=void 0;var r=this._entity,D=r[this._geometryUpdater._geometryPropertyName];this._setOptions(r,D,b);if(!this._isHidden(r,D,b)){var r=this._geometryUpdater.shadowsProperty.getValue(b),v=this._options;if(!f(D.fill)||D.fill.getValue(b)){var B=c.fillMaterialProperty,C=B instanceof d,I;I=c._getIsClosed(v);C?I=new e({closed:I,flat:g&&!c._supportsMaterialsforEntitiesOnTerrain}):(this._material=B=q.getValue(b,B,this._material),I=new m({material:B,translucent:B.isTranslucent(),closed:I}));g?(v.vertexFormat=e.VERTEX_FORMAT,this._primitive=p.add(new l({geometryInstances:this._geometryUpdater.createFillGeometryInstance(b),appearance:I,asynchronous:!1,shadows:r,classificationType:this._geometryUpdater.classificationTypeProperty.getValue(b)}),t.getValueOrUndefined(this._geometryUpdater.zIndex,b))):(v.vertexFormat=I.vertexFormat,p=this._geometryUpdater.createFillGeometryInstance(b),C&&(I.translucent=255!==p.attributes.color.value[3]),this._primitive=k.add(new h({geometryInstances:p,appearance:I,asynchronous:!1,shadows:r})))}!g&&f(D.outline)&&D.outline.getValue(b)&&(g=this._geometryUpdater.createOutlineGeometryInstance(b),b=t.getValueOrDefault(D.outlineWidth,b,1),this._outlinePrimitive=k.add(new h({geometryInstances:g,appearance:new e({flat:!0,translucent:255!==g.attributes.color.value[3],renderState:{lineWidth:c._scene.clampLineWidth(b)}}),asynchronous:!1,shadows:r})))}};r.prototype.getBoundingSphere=function(a){if(!f(a))throw new g("result is required.");var c=this._entity,d=this._primitive,e=this._outlinePrimitive,h;return f(d)&&d.show&&d.ready&&(h=d.getGeometryInstanceAttributes(c),f(h)&&f(h.boundingSphere))||f(e)&&e.show&&e.ready&&(h=e.getGeometryInstanceAttributes(c),f(h)&&f(h.boundingSphere))?(b.clone(h.boundingSphere,a),p.DONE):f(d)&&!d.ready||f(e)&&!e.ready?p.PENDING:p.FAILED};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){var a=this._primitives,b=this._orderedGroundPrimitives;this._geometryUpdater._onTerrain?b.remove(this._primitive):a.removeAndDestroy(this._primitive);a.removeAndDestroy(this._outlinePrimitive);k(this)};return r});F("DataSources/BoxGeometryUpdater","../Core/BoxGeometry ../Core/BoxOutlineGeometry ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/OffsetGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./heightReferenceOnEntityPropertyChanged ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a){this.id=a;this.offsetAttribute=this.dimensions=this.vertexFormat=void 0}function I(a,b){v.call(this,{entity:a,scene:b,geometryOptions:new C(a),geometryPropertyName:"box",observedPropertyNames:["availability","position","orientation","box"]});this._onEntityPropertyChanged(a,"box",a.box,void 0)}function H(a,b,c){D.call(this,a,b,c)}var J=f.ZERO,w=new f,G=new f,E=new g;m(Object.create)&&(I.prototype=Object.create(v.prototype),I.prototype.constructor=I);e(I.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});I.prototype.createFillGeometryInstance=function(a){k.defined("time",a);if(!this._fillEnabled)throw new h("This instance does not represent a filled geometry.");var e=this._entity,f=e.isAvailable(a),q=new c(f&&e.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a)),u=this._distanceDisplayConditionProperty.getValue(a),u=p.fromDistanceDisplayCondition(u),q={show:q,distanceDisplayCondition:u,color:void 0,offset:void 0};if(this._materialProperty instanceof x){var v;m(this._materialProperty.color)&&(this._materialProperty.color.isConstant||f)&&(v=this._materialProperty.color.getValue(a,E));m(v)||(v=g.WHITE);q.color=l.fromColor(v)}m(this._options.offsetAttribute)&&(q.offset=r.fromCartesian3(B.getValueOrDefault(this._terrainOffsetProperty,a,J,w)));return new d({id:e,geometry:b.fromDimensions(this._options),modelMatrix:e.computeModelMatrixForHeightReference(a,e.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:q})};I.prototype.createOutlineGeometryInstance=function(b){k.defined("time",b);if(!this._outlineEnabled)throw new h("This instance does not represent an outlined geometry.");var e=this._entity,f=e.isAvailable(b),q=B.getValueOrDefault(this._outlineColorProperty,b,g.BLACK,E),u=this._distanceDisplayConditionProperty.getValue(b),f={show:new c(f&&e.isShowing&&this._showProperty.getValue(b)&&this._showOutlineProperty.getValue(b)),color:l.fromColor(q),distanceDisplayCondition:p.fromDistanceDisplayCondition(u),offset:void 0};m(this._options.offsetAttribute)&&(f.offset=r.fromCartesian3(B.getValueOrDefault(this._terrainOffsetProperty,b,J,w)));return new d({id:e,geometry:a.fromDimensions(this._options),modelMatrix:e.computeModelMatrixForHeightReference(b,e.box.heightReference,.5*this._options.dimensions.z,this._scene.mapProjection.ellipsoid),attributes:f})};I.prototype._computeCenter=function(a,b){return B.getValueOrUndefined(this._entity.position,a,b)};I.prototype._isHidden=function(a,b){return!m(b.dimensions)||!m(a.position)||v.prototype._isHidden.call(this,a,b)};I.prototype._isDynamic=function(a,b){return!a.position.isConstant||!B.isConstant(a.orientation)||!b.dimensions.isConstant||!B.isConstant(b.outlineWidth)};I.prototype._setStaticOptions=function(a,b){var c=B.getValueOrDefault(b.heightReference,t.MINIMUM_VALUE,u.NONE),d=this._options;d.vertexFormat=this._materialProperty instanceof x?A.VERTEX_FORMAT:y.MaterialSupport.TEXTURED.vertexFormat;d.dimensions=b.dimensions.getValue(t.MINIMUM_VALUE,d.dimensions);d.offsetAttribute=c!==u.NONE?q.ALL:void 0};I.prototype._onEntityPropertyChanged=z;I.DynamicGeometryUpdater=H;m(Object.create)&&(H.prototype=Object.create(D.prototype),H.prototype.constructor=H);H.prototype._isHidden=function(a,b,c){var d=B.getValueOrUndefined(a.position,c,G),e=this._options.dimensions;return!m(d)||!m(e)||D.prototype._isHidden.call(this,a,b,c)};H.prototype._setOptions=function(a,b,c){a=B.getValueOrDefault(b.heightReference,c,u.NONE);var d=this._options;d.dimensions=B.getValueOrUndefined(b.dimensions,c,d.dimensions);d.offsetAttribute=a!==u.NONE?q.ALL:void 0};return I});F("DataSources/CheckerboardMaterialProperty","../Core/Cartesian2 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=f(a,f.EMPTY_OBJECT);this._definitionChanged=new l;this._repeatSubscription=this._repeat=this._oddColorSubscription=this._oddColor=this._evenColorSubscription=this._evenColor=void 0;this.evenColor=a.evenColor;this.oddColor=a.oddColor;this.repeat=a.repeat}var p=a.WHITE,d=a.BLACK,q=new b(2,2);g(h.prototype,{isConstant:{get:function(){return e.isConstant(this._evenColor)&&e.isConstant(this._oddColor)&&e.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},evenColor:m("evenColor"),oddColor:m("oddColor"),repeat:m("repeat")});h.prototype.getType=function(a){return"Checkerboard"};h.prototype.getValue=function(a,b){k(b)||(b={});b.lightColor=e.getValueOrClonedDefault(this._evenColor,a,p,b.lightColor);b.darkColor=e.getValueOrClonedDefault(this._oddColor,a,d,b.darkColor);b.repeat=e.getValueOrDefault(this._repeat,a,q);return b};h.prototype.equals=function(a){return this===a||a instanceof h&&e.equals(this._evenColor,a._evenColor)&&e.equals(this._oddColor,a._oddColor)&&e.equals(this._repeat,a._repeat)};return h});F("DataSources/EntityCollection","../Core/AssociativeArray ../Core/createGuid ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/Iso8601 ../Core/JulianDate ../Core/RuntimeError ../Core/TimeInterval ./Entity".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a){if(a._firing)a._refire=!0;else if(0===a._suspendCount){var b=a._addedEntities,c=a._removedEntities,d=a._changedEntities;if(0!==d.length||0!==b.length||0!==c.length){a._firing=!0;do{a._refire=!1;var e=b.values.slice(0),f=c.values.slice(0),h=d.values.slice(0);b.removeAll();c.removeAll();d.removeAll();a._collectionChanged.raiseEvent(a,e,f,h)}while(a._refire);a._firing=!1}}}function t(c){this._owner=c;this._entities=new b;this._addedEntities=new b;this._removedEntities=new b;this._changedEntities=new b;this._suspendCount=0;this._collectionChanged=new l;this._id=a();this._show=!0;this._refire=this._firing=!1}var r={id:void 0};t.prototype.suspendEvents=function(){this._suspendCount++};t.prototype.resumeEvents=function(){if(0===this._suspendCount)throw new g("resumeEvents can not be called before suspendEvents.");this._suspendCount--;q(this)};t.collectionChangedEventCallback=void 0;k(t.prototype,{collectionChanged:{get:function(){return this._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._entities.values}},show:{get:function(){return this._show},set:function(a){if(!f(a))throw new g("value is required.");if(a!==this._show){this.suspendEvents();var b,c=[],d=this._entities.values,e=d.length;for(b=0;b<e;b++)c.push(d[b].isShowing);this._show=a;for(b=0;b<e;b++){a=c[b];var h=d[b];a!==h.isShowing&&h.definitionChanged.raiseEvent(h,"isShowing",h.isShowing,a)}this.resumeEvents()}}},owner:{get:function(){return this._owner}}});t.prototype.computeAvailability=function(){for(var a=m.MAXIMUM_VALUE,b=m.MINIMUM_VALUE,d=this._entities.values,h=0,g=d.length;h<g;h++){var k=d[h].availability;if(f(k)){var l=k.start,k=k.stop;e.lessThan(l,a)&&!l.equals(m.MINIMUM_VALUE)&&(a=l);e.greaterThan(k,b)&&!k.equals(m.MAXIMUM_VALUE)&&(b=k)}}m.MAXIMUM_VALUE.equals(a)&&(a=m.MINIMUM_VALUE);m.MINIMUM_VALUE.equals(b)&&(b=m.MAXIMUM_VALUE);return new p({start:a,stop:b})};t.prototype.add=function(a){if(!f(a))throw new g("entity is required.");a instanceof d||(a=new d(a));var b=a.id,c=this._entities;if(c.contains(b))throw new h("An entity with id "+b+" already exists in this collection.");a.entityCollection=this;c.set(b,a);this._removedEntities.remove(b)||this._addedEntities.set(b,a);a.definitionChanged.addEventListener(t.prototype._onEntityDefinitionChanged,this);q(this);return a};t.prototype.remove=function(a){return f(a)?this.removeById(a.id):!1};t.prototype.contains=function(a){if(!f(a))throw new g("entity is required");return this._entities.get(a.id)===a};t.prototype.removeById=function(a){if(!f(a))return!1;var b=this._entities.get(a);if(!this._entities.remove(a))return!1;this._addedEntities.remove(a)||(this._removedEntities.set(a,b),this._changedEntities.remove(a));this._entities.remove(a);b.definitionChanged.removeEventListener(t.prototype._onEntityDefinitionChanged,this);q(this);return!0};t.prototype.removeAll=function(){for(var a=this._entities,b=a.length,d=a.values,e=this._addedEntities,h=this._removedEntities,g=0;g<b;g++){var k=d[g],l=k.id,m=e.get(l);f(m)||(k.definitionChanged.removeEventListener(t.prototype._onEntityDefinitionChanged,this),h.set(l,k))}a.removeAll();e.removeAll();this._changedEntities.removeAll();q(this)};t.prototype.getById=function(a){if(!f(a))throw new g("id is required.");return this._entities.get(a)};t.prototype.getOrCreateEntity=function(a){if(!f(a))throw new g("id is required.");var b=this._entities.get(a);f(b)||(r.id=a,b=new d(r),this.add(b));return b};t.prototype._onEntityDefinitionChanged=function(a){var b=a.id;this._addedEntities.contains(b)||this._changedEntities.set(b,a);q(this)};return t});F("DataSources/CompositeEntityCollection","../Core/createGuid ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Math ./Entity ./EntityCollection".split(" "),function(b,a,f,k,g,l,m){function e(a){for(var b=a.propertyNames,c=b.length,d=0;d<c;d++)a[b[d]]=void 0;a._name=void 0;a._availability=void 0}function h(b){b._shouldRecomposite=!0;if(0===b._suspendCount){var c=b._collections,d=c.length,f=b._collectionsCopy,h=f.length,g,k,q,B,C=b._composite,I=new m(b),H=b._eventHash,J;for(g=0;g<h;g++)for(B=f[g],B.collectionChanged.removeEventListener(p.prototype._onCollectionChanged,b),q=B.values,J=B.id,B=q.length-1;-1<B;B--){k=q[B];var w=H;r[0]=J;r[1]=k.id;k=JSON.stringify(r);w[k]();w[k]=void 0}for(g=d-1;0<=g;g--)for(B=c[g],B.collectionChanged.addEventListener(p.prototype._onCollectionChanged,b),q=B.values,J=B.id,B=q.length-1;-1<B;B--)k=q[B],d=b,f=H,h=k,r[0]=J,r[1]=h.id,f[JSON.stringify(r)]=h.definitionChanged.addEventListener(p.prototype._onDefinitionChanged,d),d=I.getById(k.id),a(d)||(d=C.getById(k.id),a(d)?e(d):(t.id=k.id,d=new l(t)),I.add(d)),d.merge(k);b._collectionsCopy=c.slice(0);C.suspendEvents();C.removeAll();b=I.values;for(g=0;g<b.length;g++)C.add(b[g]);C.resumeEvents()}}function p(c,d){this._owner=d;this._composite=new m(this);this._suspendCount=0;this._collections=a(c)?c.slice():[];this._collectionsCopy=[];this._id=b();this._eventHash={};h(this);this._shouldRecomposite=!1}function d(b,d){if(!a(d))throw new k("collection is required.");var c=b.indexOf(d);if(-1===c)throw new k("collection is not in this composite.");return c}function q(a,b,d){var c=a._collections;b=g.clamp(b,0,c.length-1);d=g.clamp(d,0,c.length-1);if(b!==d){var e=c[b];c[b]=c[d];c[d]=e;h(a)}}var t={id:void 0},r=Array(2);f(p.prototype,{collectionChanged:{get:function(){return this._composite._collectionChanged}},id:{get:function(){return this._id}},values:{get:function(){return this._composite.values}},owner:{get:function(){return this._owner}}});p.prototype.addCollection=function(b,d){var c=a(d);if(!a(b))throw new k("collection is required.");if(c){if(0>d)throw new k("index must be greater than or equal to zero.");if(d>this._collections.length)throw new k("index must be less than or equal to the number of collections.");}c?this._collections.splice(d,0,b):this._collections.push(b);h(this)};p.prototype.removeCollection=function(a){a=this._collections.indexOf(a);return-1!==a?(this._collections.splice(a,1),h(this),!0):!1};p.prototype.removeAllCollections=function(){this._collections.length=0;h(this)};p.prototype.containsCollection=function(a){return-1!==this._collections.indexOf(a)};p.prototype.contains=function(a){return this._composite.contains(a)};p.prototype.indexOfCollection=function(a){return this._collections.indexOf(a)};p.prototype.getCollection=function(b){if(!a(b))throw new k("index is required.","index");return this._collections[b]};p.prototype.getCollectionsLength=function(){return this._collections.length};p.prototype.raiseCollection=function(a){a=d(this._collections,a);q(this,a,a+1)};p.prototype.lowerCollection=function(a){a=d(this._collections,a);q(this,a,a-1)};p.prototype.raiseCollectionToTop=function(a){var b=d(this._collections,a);b!==this._collections.length-1&&(this._collections.splice(b,1),this._collections.push(a),h(this))};p.prototype.lowerCollectionToBottom=function(a){var b=d(this._collections,a);0!==b&&(this._collections.splice(b,1),this._collections.splice(0,0,a),h(this))};p.prototype.suspendEvents=function(){this._suspendCount++;this._composite.suspendEvents()};p.prototype.resumeEvents=function(){if(0===this._suspendCount)throw new k("resumeEvents can not be called before suspendEvents.");this._suspendCount--;this._shouldRecomposite&&0===this._suspendCount&&(h(this),this._shouldRecomposite=!1);this._composite.resumeEvents()};p.prototype.computeAvailability=function(){return this._composite.computeAvailability()};p.prototype.getById=function(a){return this._composite.getById(a)};p.prototype._onCollectionChanged=function(b,d,f){var c=this._collectionsCopy,h=c.length,g=this._composite;g.suspendEvents();var k,m,q,u=f.length,y=this._eventHash,H=b.id;for(b=0;b<u;b++){k=f[b];m=y;var J=k;r[0]=H;r[1]=J.id;J=JSON.stringify(r);m[J]();m[J]=void 0;J=k.id;for(k=h-1;0<=k;k--)m=c[k].getById(J),a(m)&&(a(q)||(q=g.getById(J),e(q)),q.merge(m));a(q)||g.removeById(J);q=void 0}f=d.length;for(b=0;b<f;b++){u=d[b];k=y;m=u;r[0]=H;r[1]=m.id;k[JSON.stringify(r)]=m.definitionChanged.addEventListener(p.prototype._onDefinitionChanged,this);u=u.id;for(k=h-1;0<=k;k--)m=c[k].getById(u),a(m)&&(a(q)||(q=g.getById(u),a(q)?e(q):(t.id=u,q=new l(t),g.add(q))),q.merge(m));q=void 0}g.resumeEvents()};p.prototype._onDefinitionChanged=function(b,d,e,f){e=this._collections;var c=e.length;f=this._composite.getById(b.id);for(var h=f[d],g=!a(h),k=!0,c=c-1;0<=c;c--){var l=e[c].getById(b.id);if(a(l)&&(l=l[d],a(l))){if(k)if(k=!1,a(l.merge)&&a(l.clone))h=l.clone(h);else{h=l;break}h.merge(l)}}g&&-1===f.propertyNames.indexOf(d)&&f.addProperty(d);f[d]=h};return p});F("DataSources/CompositeProperty","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/EventHelper ../Core/TimeIntervalCollection ./Property".split(" "),function(b,a,f,k,g,l,m){function e(a,d,e,f){function h(){e.raiseEvent(a)}var c=[];d.removeAll();for(var g=f.length,k=0;k<g;k++){var l=f.get(k);b(l.data)&&-1===c.indexOf(l.data)&&d.add(l.data.definitionChanged,h)}}function h(){this._eventHelper=new g;this._definitionChanged=new k;this._intervals=new l;this._intervals.changedEvent.addEventListener(h.prototype._intervalsChanged,this)}a(h.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}});h.prototype.getValue=function(a,d){if(!b(a))throw new f("time is required");var e=this._intervals.findDataForIntervalContainingDate(a);if(b(e))return e.getValue(a,d)};h.prototype.equals=function(a){return this===a||a instanceof h&&this._intervals.equals(a._intervals,m.equals)};h.prototype._intervalsChanged=function(){e(this,this._eventHelper,this._definitionChanged,this._intervals);this._definitionChanged.raiseEvent(this)};return h});F("DataSources/CompositeMaterialProperty","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./CompositeProperty ./Property".split(" "),function(b,a,f,k,g,l){function m(){this._definitionChanged=new k;this._composite=new g;this._composite.definitionChanged.addEventListener(m.prototype._raiseDefinitionChanged,this)}a(m.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite._intervals}}});m.prototype.getType=function(a){if(!b(a))throw new f("time is required");var e=this._composite._intervals.findDataForIntervalContainingDate(a);if(b(e))return e.getType(a)};m.prototype.getValue=function(a,h){if(!b(a))throw new f("time is required");var e=this._composite._intervals.findDataForIntervalContainingDate(a);if(b(e))return e.getValue(a,h)};m.prototype.equals=function(a){return this===a||a instanceof m&&this._composite.equals(a._composite,l.equals)};m.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};return m});F("DataSources/CompositePositionProperty","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/ReferenceFrame ./CompositeProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(a){this._referenceFrame=b(a,l.FIXED);this._definitionChanged=new g;this._composite=new m;this._composite.definitionChanged.addEventListener(h.prototype._raiseDefinitionChanged,this)}f(h.prototype,{isConstant:{get:function(){return this._composite.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._composite.intervals}},referenceFrame:{get:function(){return this._referenceFrame},set:function(a){this._referenceFrame=a}}});h.prototype.getValue=function(a,b){return this.getValueInReferenceFrame(a,l.FIXED,b)};h.prototype.getValueInReferenceFrame=function(b,d,e){if(!a(b))throw new k("time is required.");if(!a(d))throw new k("referenceFrame is required.");var f=this._composite._intervals.findDataForIntervalContainingDate(b);if(a(f))return f.getValueInReferenceFrame(b,d,e)};h.prototype.equals=function(a){return this===a||a instanceof h&&this._referenceFrame===a._referenceFrame&&this._composite.equals(a._composite,e.equals)};h.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};return h});F("DataSources/GroundGeometryUpdater","../Core/ApproximateTerrainHeights ../Core/Cartesian3 ../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/oneTimeWarning ../Scene/GroundPrimitive ../Scene/HeightReference ./CallbackProperty ./ConstantProperty ./GeometryUpdater ./Property ./TerrainOffsetProperty".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){c.call(this,a);this._zIndex=0;this._terrainOffsetProperty=void 0}var z=new r(0);g(Object.create)&&(A.prototype=Object.create(c.prototype),A.prototype.constructor=A);l(A.prototype,{zIndex:{get:function(){return this._zIndex}},terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});A.prototype._isOnTerrain=function(a,b){return this._fillEnabled&&!g(b.height)&&!g(b.extrudedHeight)&&d.isSupported(this._scene)};A.prototype._getIsClosed=function(a){var b=a.height;a=a.extrudedHeight;return 0===b||g(a)&&a!==b};A.prototype._computeCenter=m.throwInstantiationError;A.prototype._onEntityPropertyChanged=function(a,b,d,e){c.prototype._onEntityPropertyChanged.call(this,a,b,d,e);-1!==this._observedPropertyNames.indexOf(b)&&(b=this._entity[this._geometryPropertyName],g(b)&&(g(b.zIndex)&&(g(b.height)||g(b.extrudedHeight))&&p(p.geometryZIndex),this._zIndex=k(b.zIndex,z),g(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0),a=b.heightReference,b=b.extrudedHeightReference,g(a)||g(b)))&&(d=new t(this._computeCenter.bind(this),!this._dynamic),this._terrainOffsetProperty=new y(this._scene,d,a,b))};A.prototype.destroy=function(){g(this._terrainOffsetProperty)&&(this._terrainOffsetProperty.destroy(),this._terrainOffsetProperty=void 0);c.prototype.destroy.call(this)};A.getGeometryHeight=function(a,b){f.defined("heightReference",b);if(g(a))return b!==q.CLAMP_TO_GROUND?a:0;b!==q.NONE&&p(p.geometryHeightReference)};A.getGeometryExtrudedHeight=function(a,b){f.defined("extrudedHeightReference",b);if(g(a))return b!==q.CLAMP_TO_GROUND?a:A.CLAMP_TO_GROUND;b!==q.NONE&&p(p.geometryExtrudedHeightReference)};A.CLAMP_TO_GROUND="clamp";A.computeGeometryOffsetAttribute=function(a,b,c,d){g(a)&&g(b)||(b=q.NONE);g(c)&&g(d)||(d=q.NONE);a=0;b!==q.NONE&&a++;d===q.RELATIVE_TO_GROUND&&a++;if(2===a)return e.ALL;if(1===a)return e.TOP};return A});F("DataSources/CorridorGeometryUpdater","../Core/ApproximateTerrainHeights ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/CorridorGeometry ../Core/CorridorOutlineGeometry ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/OffsetGeometryInstanceAttribute ../Core/Rectangle ../Core/ShowGeometryInstanceAttribute ../Scene/GroundPrimitive ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./GroundGeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I){function H(a){this.id=a;this.offsetAttribute=this.granularity=this.extrudedHeight=this.height=this.cornerType=this.width=this.positions=this.vertexFormat=void 0}function J(a,b){C.call(this,{entity:a,scene:b,geometryOptions:new H(a),geometryPropertyName:"corridor",observedPropertyNames:["availability","corridor"]});this._onEntityPropertyChanged(a,"corridor",a.corridor,void 0)}function w(a,b,c){v.call(this,a,b,c)}var G=new k,E=a.ZERO,L=new a,K=new c;e(Object.create)&&(J.prototype=Object.create(C.prototype),J.prototype.constructor=J);J.prototype.createFillGeometryInstance=function(a){f.defined("time",a);if(!this._fillEnabled)throw new h("This instance does not represent a filled geometry.");var b=this._entity,c=b.isAvailable(a),m={show:new u(c&&b.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a)),distanceDisplayCondition:p.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(a)),offset:void 0,color:void 0};if(this._materialProperty instanceof D){var q;e(this._materialProperty.color)&&(this._materialProperty.color.isConstant||c)&&(q=this._materialProperty.color.getValue(a,G));e(q)||(q=k.WHITE);m.color=g.fromColor(q)}e(this._options.offsetAttribute)&&(m.offset=r.fromCartesian3(I.getValueOrDefault(this._terrainOffsetProperty,a,E,L)));return new d({id:b,geometry:new l(this._options),attributes:m})};J.prototype.createOutlineGeometryInstance=function(a){f.defined("time",a);if(!this._outlineEnabled)throw new h("This instance does not represent an outlined geometry.");var b=this._entity,c=b.isAvailable(a),l=I.getValueOrDefault(this._outlineColorProperty,a,k.BLACK,G),c={show:new u(c&&b.isShowing&&this._showProperty.getValue(a)&&this._showOutlineProperty.getValue(a)),color:g.fromColor(l),distanceDisplayCondition:p.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(a)),offset:void 0};e(this._options.offsetAttribute)&&(c.offset=r.fromCartesian3(I.getValueOrDefault(this._terrainOffsetProperty,a,E,L)));return new d({id:b,geometry:new m(this._options),attributes:c})};J.prototype._computeCenter=function(b,c){var d=I.getValueOrUndefined(this._entity.corridor.positions,b);if(e(d)&&0!==d.length)return a.clone(d[Math.floor(d.length/2)],c)};J.prototype._isHidden=function(a,b){return!e(b.positions)||!e(b.width)||B.prototype._isHidden.call(this,a,b)};J.prototype._isDynamic=function(a,b){return!b.positions.isConstant||!I.isConstant(b.height)||!I.isConstant(b.extrudedHeight)||!I.isConstant(b.granularity)||!I.isConstant(b.width)||!I.isConstant(b.outlineWidth)||!I.isConstant(b.cornerType)||!I.isConstant(b.zIndex)||this._onTerrain&&!I.isConstant(this._materialProperty)};J.prototype._setStaticOptions=function(a,c){var d=I.getValueOrUndefined(c.height,t.MINIMUM_VALUE),f=I.getValueOrDefault(c.heightReference,t.MINIMUM_VALUE,A.NONE),h=I.getValueOrUndefined(c.extrudedHeight,t.MINIMUM_VALUE),g=I.getValueOrDefault(c.extrudedHeightReference,t.MINIMUM_VALUE,A.NONE);e(h)&&!e(d)&&(d=0);var k=this._options;k.vertexFormat=this._materialProperty instanceof D?x.VERTEX_FORMAT:z.MaterialSupport.TEXTURED.vertexFormat;k.positions=c.positions.getValue(t.MINIMUM_VALUE,k.positions);k.width=c.width.getValue(t.MINIMUM_VALUE);k.granularity=I.getValueOrUndefined(c.granularity,t.MINIMUM_VALUE);k.cornerType=I.getValueOrUndefined(c.cornerType,t.MINIMUM_VALUE);k.offsetAttribute=C.computeGeometryOffsetAttribute(d,f,h,g);k.height=C.getGeometryHeight(d,f);h=C.getGeometryExtrudedHeight(h,g);h===C.CLAMP_TO_GROUND&&(h=b.getMinimumMaximumHeights(l.computeRectangle(k,K)).minimumTerrainHeight);k.extrudedHeight=h};J.DynamicGeometryUpdater=w;e(Object.create)&&(w.prototype=Object.create(v.prototype),w.prototype.constructor=w);w.prototype._isHidden=function(a,b,c){var d=this._options;return!e(d.positions)||!e(d.width)||v.prototype._isHidden.call(this,a,b,c)};w.prototype._setOptions=function(a,c,d){a=this._options;var f=I.getValueOrUndefined(c.height,d),h=I.getValueOrDefault(c.heightReference,d,A.NONE),g=I.getValueOrUndefined(c.extrudedHeight,d),k=I.getValueOrDefault(c.extrudedHeightReference,d,A.NONE);e(g)&&!e(f)&&(f=0);a.positions=I.getValueOrUndefined(c.positions,d);a.width=I.getValueOrUndefined(c.width,d);a.granularity=I.getValueOrUndefined(c.granularity,d);a.cornerType=I.getValueOrUndefined(c.cornerType,d);a.offsetAttribute=C.computeGeometryOffsetAttribute(f,h,g,k);a.height=C.getGeometryHeight(f,h);g=C.getGeometryExtrudedHeight(g,k);g===C.CLAMP_TO_GROUND&&(g=b.getMinimumMaximumHeights(l.computeRectangle(a,K)).minimumTerrainHeight);a.extrudedHeight=g};return J});F("DataSources/DataSource",["../Core/defineProperties","../Core/DeveloperError"],function(b,a){function f(){a.throwInstantiationError()}b(f.prototype,{name:{get:a.throwInstantiationError},clock:{get:a.throwInstantiationError},entities:{get:a.throwInstantiationError},isLoading:{get:a.throwInstantiationError},changedEvent:{get:a.throwInstantiationError},errorEvent:{get:a.throwInstantiationError},loadingEvent:{get:a.throwInstantiationError},show:{get:a.throwInstantiationError},clustering:{get:a.throwInstantiationError}});f.prototype.update=a.throwInstantiationError;f.setLoading=function(a,b){a._isLoading!==b&&(b?a._entityCollection.suspendEvents():a._entityCollection.resumeEvents(),a._isLoading=b,a._loading.raiseEvent(a,b))};return f});F("Scene/SceneTransforms","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/defined ../Core/DeveloperError ../Core/Math ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Core/Transforms ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,b,c,d){a=h.multiplyByVector(c.viewMatrix,k.fromElements(a.x,a.y,a.z,1,D),D);if(l(a)&&0!=f.magnitude(a)){var e=f.multiplyComponents(b,f.normalize(a,v),v);a.x+=b.x+e.x;a.y+=b.y+e.y;a.z+=e.z;return h.multiplyByVector(c.frustum.projectionMatrix,a,d)}}var c={},u=new k(0,0,0,1),y=new k,A=new b,z=new a,x=new a;c.wgs84ToWindowCoordinates=function(a,b,d){return c.wgs84WithEyeOffsetToWindowCoordinates(a,b,f.ZERO,d)};var D=new k,v=new f,B=new g(Math.PI,e.PI_OVER_TWO),C=new f,I=new f;c.wgs84WithEyeOffsetToWindowCoordinates=function(b,g,w,v){if(!l(b))throw new m("scene is required.");if(!l(g))throw new m("position is required.");var D=b.frameState;g=c.computeActualWgs84Position(D,g,u);if(l(g)){var E=b.canvas;A.x=0;A.y=0;A.width=E.clientWidth;A.height=E.clientHeight;var G=b.camera,H=!1;if(D.mode===t.SCENE2D){var L=b.mapProjection.project(B,C);b=f.clone(G.position,I);var K=G.frustum.clone(),Q=h.computeViewportTransformation(A,0,1,new h),O=G.frustum.projectionMatrix,J=G.positionWC.y,T=f.fromElements(e.sign(J)*L.x-J,0,-G.positionWC.x),Q=q.pointToGLWindowCoordinates(O,Q,T);if(0===J||0>=Q.x||Q.x>=E.clientWidth)H=!0;else if(Q.x>.5*E.clientWidth?(A.width=Q.x,G.frustum.right=L.x-J,y=r(g,w,G,y),c.clipToGLWindowCoordinates(A,y,z),A.x+=Q.x,G.position.x=-G.position.x,L=G.frustum.right,G.frustum.right=-G.frustum.left,G.frustum.left=-L):(A.x+=Q.x,A.width-=Q.x,G.frustum.left=-L.x-J,y=r(g,w,G,y),c.clipToGLWindowCoordinates(A,y,z),A.x-=A.width,G.position.x=-G.position.x,L=G.frustum.left,G.frustum.left=-G.frustum.right,G.frustum.right=-L),y=r(g,w,G,y),c.clipToGLWindowCoordinates(A,y,x),f.clone(b,G.position),G.frustum=K.clone(),v=a.clone(z,v),0>v.x||v.x>E.clientWidth)v.x=x.x}if(D.mode!==t.SCENE2D||H){y=r(g,w,G,y);if(!l(y)||0>y.z&&!(G.frustum instanceof p)&&!(G.frustum instanceof d)){l(y)||(y=new k);return}v=c.clipToGLWindowCoordinates(A,y,v)}v.y=E.clientHeight-v.y;return v}};c.wgs84ToDrawingBufferCoordinates=function(a,b,d){d=c.wgs84ToWindowCoordinates(a,b,d);if(l(d))return c.transformWindowToDrawingBuffer(a,d,d)};var H=new f,J=new g;c.computeActualWgs84Position=function(a,b,c){var d=a.mode;if(d===t.SCENE3D)return f.clone(b,c);var h=a.mapProjection,g=h.ellipsoid.cartesianToCartographic(b,J);if(l(g)){h.project(g,H);if(d===t.COLUMBUS_VIEW)return f.fromElements(H.z,H.x,H.y,c);if(d===t.SCENE2D)return f.fromElements(0,H.x,H.y,c);a=a.morphTime;return f.fromElements(e.lerp(H.z,b.x,a),e.lerp(H.x,b.y,a),e.lerp(H.y,b.z,a),c)}};var w=new f,G=new f,E=new h;c.clipToGLWindowCoordinates=function(b,c,d){f.divideByScalar(c,c.w,w);h.computeViewportTransformation(b,0,1,E);h.multiplyByPoint(E,w,G);return a.fromCartesian3(G,d)};c.transformWindowToDrawingBuffer=function(b,c,d){var e=b.canvas;return a.fromElements(b.drawingBufferWidth/e.clientWidth*c.x,b.drawingBufferHeight/e.clientHeight*c.y,d)};var L=new k,K=new k;c.drawingBufferToWgs84Coordinates=function(a,b,c,d){var g=a.context.uniformState,m=g.currentFrustum,p=m.x,m=m.y;a.frameState.useLogDepth&&(c=Math.pow(2,c*e.log2(m+1))-1,c=m*(1-p/c)/(m-p));var q=a._view.passState.viewport,r=k.clone(k.UNIT_W,L);r.x=(b.x-q.x)/q.width*2-1;r.y=(b.y-q.y)/q.height*2-1;r.z=2*c-1;r.w=1;b=a.camera.frustum;l(b.fovy)?(a=h.multiplyByVector(g.inverseViewProjection,r,K),f.multiplyByScalar(a,1/a.w,a)):(l(b._offCenterFrustum)&&(b=b._offCenterFrustum),a=K,a.x=.5*(r.x*(b.right-b.left)+b.left+b.right),a.y=.5*(r.y*(b.top-b.bottom)+b.bottom+b.top),a.z=.5*(r.z*(p-m)-p-m),a.w=1,a=h.multiplyByVector(g.inverseView,a,a));return f.fromCartesian4(a,d)};return c});F("Scene/Billboard","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/Color ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/Matrix4 ../Core/NearFarScalar ../Core/Resource ./HeightReference ./HorizontalOrigin ./SceneMode ./SceneTransforms ./VerticalOrigin".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(b,c){b=e(b,e.EMPTY_OBJECT);if(h(b.disableDepthTestDistance)&&0>b.disableDepthTestDistance)throw new d("disableDepthTestDistance must be greater than or equal to 0.0.");var g=b.translucencyByDistance,k=b.pixelOffsetScaleByDistance,p=b.scaleByDistance,w=b.distanceDisplayCondition;if(h(g)){if(g.far<=g.near)throw new d("translucencyByDistance.far must be greater than translucencyByDistance.near.");g=r.clone(g)}if(h(k)){if(k.far<=k.near)throw new d("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");k=r.clone(k)}if(h(p)){if(p.far<=p.near)throw new d("scaleByDistance.far must be greater than scaleByDistance.near.");p=r.clone(p)}if(h(w)){if(w.far<=w.near)throw new d("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");w=q.clone(w)}this._show=e(b.show,!0);this._position=f.clone(e(b.position,f.ZERO));this._actualPosition=f.clone(this._position);this._pixelOffset=a.clone(e(b.pixelOffset,a.ZERO));this._translate=new a(0,0);this._eyeOffset=f.clone(e(b.eyeOffset,f.ZERO));this._heightReference=e(b.heightReference,u.NONE);this._verticalOrigin=e(b.verticalOrigin,x.CENTER);this._horizontalOrigin=e(b.horizontalOrigin,y.CENTER);this._scale=e(b.scale,1);this._color=l.clone(e(b.color,l.WHITE));this._rotation=e(b.rotation,0);this._alignedAxis=f.clone(e(b.alignedAxis,f.ZERO));this._width=b.width;this._height=b.height;this._scaleByDistance=p;this._translucencyByDistance=g;this._pixelOffsetScaleByDistance=k;this._sizeInMeters=e(b.sizeInMeters,!1);this._distanceDisplayCondition=w;this._disableDepthTestDistance=b.disableDepthTestDistance;this._id=b.id;this._collection=e(b.collection,c);this._pickId=void 0;this._pickPrimitive=e(b._pickPrimitive,this);this._billboardCollection=c;this._dirty=!1;this._index=-1;this._batchIndex=void 0;this._imageIndex=-1;this._labelTranslate=this._labelHorizontalOrigin=this._labelDimensions=this._imageHeight=this._imageWidth=this._imageSubRegion=this._image=this._imageId=this._imageIndexPromise=void 0;g=b.image;k=b.imageId;h(g)&&(h(k)||(k="string"===typeof g?g:h(g.src)?g.src:m()),this._imageId=k,this._image=g);h(b.imageSubRegion)&&(this._imageId=k,this._imageSubRegion=b.imageSubRegion);h(this._billboardCollection._textureAtlas)&&this._loadImage();this._removeCallbackFunc=this._actualClampedPosition=void 0;this._mode=A.SCENE3D;this._clusterShow=!0;this._updateClamping()}function v(a,b){var c=a._billboardCollection;h(c)&&(c._updateBillboard(a,b),a._dirty=!0)}var B=D.SHOW_INDEX=0,C=D.POSITION_INDEX=1,I=D.PIXEL_OFFSET_INDEX=2,H=D.EYE_OFFSET_INDEX=3,J=D.HORIZONTAL_ORIGIN_INDEX=4,w=D.VERTICAL_ORIGIN_INDEX=5,G=D.SCALE_INDEX=6,E=D.IMAGE_INDEX_INDEX=7,L=D.COLOR_INDEX=8,K=D.ROTATION_INDEX=9,P=D.ALIGNED_AXIS_INDEX=10,N=D.SCALE_BY_DISTANCE_INDEX=11,O=D.TRANSLUCENCY_BY_DISTANCE_INDEX=12,Z=D.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX=13,aa=D.DISTANCE_DISPLAY_CONDITION=14,U=D.DISABLE_DEPTH_DISTANCE=15;D.TEXTURE_COORDINATE_BOUNDS=16;D.NUMBER_OF_PROPERTIES=17;p(D.prototype,{show:{get:function(){return this._show},set:function(a){if(!h(a))throw new d("value is required.");this._show!==a&&(this._show=a,v(this,B))}},position:{get:function(){return this._position},set:function(a){if(!h(a))throw new d("value is required.");var b=this._position;f.equals(b,a)||(f.clone(a,b),f.clone(a,this._actualPosition),this._updateClamping(),v(this,C))}},heightReference:{get:function(){return this._heightReference},set:function(a){if(!h(a))throw new d("value is required.");a!==this._heightReference&&(this._heightReference=a,this._updateClamping(),v(this,C))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(b){if(!h(b))throw new d("value is required.");var c=this._pixelOffset;a.equals(c,b)||(a.clone(b,c),v(this,I))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(a){if(h(a)&&a.far<=a.near)throw new d("far distance must be greater than near distance.");var b=this._scaleByDistance;r.equals(b,a)||(this._scaleByDistance=r.clone(a,b),v(this,N))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(a){if(h(a)&&a.far<=a.near)throw new d("far distance must be greater than near distance.");var b=this._translucencyByDistance;r.equals(b,a)||(this._translucencyByDistance=r.clone(a,b),v(this,O))}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(a){if(h(a)&&a.far<=a.near)throw new d("far distance must be greater than near distance.");var b=this._pixelOffsetScaleByDistance;r.equals(b,a)||(this._pixelOffsetScaleByDistance=r.clone(a,b),v(this,Z))}},eyeOffset:{get:function(){return this._eyeOffset},set:function(a){if(!h(a))throw new d("value is required.");var b=this._eyeOffset;f.equals(b,a)||(f.clone(a,b),v(this,H))}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(a){if(!h(a))throw new d("value is required.");this._horizontalOrigin!==a&&(this._horizontalOrigin=a,v(this,J))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(a){if(!h(a))throw new d("value is required.");this._verticalOrigin!==a&&(this._verticalOrigin=a,v(this,w))}},scale:{get:function(){return this._scale},set:function(a){if(!h(a))throw new d("value is required.");this._scale!==a&&(this._scale=a,v(this,G))}},color:{get:function(){return this._color},set:function(a){if(!h(a))throw new d("value is required.");var b=this._color;l.equals(b,a)||(l.clone(a,b),v(this,L))}},rotation:{get:function(){return this._rotation},set:function(a){if(!h(a))throw new d("value is required.");this._rotation!==a&&(this._rotation=a,v(this,K))}},alignedAxis:{get:function(){return this._alignedAxis},set:function(a){if(!h(a))throw new d("value is required.");var b=this._alignedAxis;f.equals(b,a)||(f.clone(a,b),v(this,P))}},width:{get:function(){return e(this._width,this._imageWidth)},set:function(a){this._width!==a&&(this._width=a,v(this,E))}},height:{get:function(){return e(this._height,this._imageHeight)},set:function(a){this._height!==a&&(this._height=a,v(this,E))}},sizeInMeters:{get:function(){return this._sizeInMeters},set:function(a){this._sizeInMeters!==a&&(this._sizeInMeters=a,v(this,L))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(a){if(!q.equals(a,this._distanceDisplayCondition)){if(h(a)&&a.far<=a.near)throw new d("far distance must be greater than near distance.");this._distanceDisplayCondition=q.clone(a,this._distanceDisplayCondition);v(this,aa)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(a){if(this._disableDepthTestDistance!==a){if(h(a)&&0>a)throw new d("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=a;v(this,U)}}},id:{get:function(){return this._id},set:function(a){this._id=a;h(this._pickId)&&(this._pickId.object.id=a)}},pickPrimitive:{get:function(){return this._pickPrimitive},set:function(a){this._pickPrimitive=a;h(this._pickId)&&(this._pickId.object.primitive=a)}},pickId:{get:function(){return this._pickId}},image:{get:function(){return this._imageId},set:function(a){h(a)?"string"===typeof a?this.setImage(a,a):a instanceof c?this.setImage(a.url,a):h(a.src)?this.setImage(a.src,a):this.setImage(m(),a):(this._imageIndex=-1,this._imageIndexPromise=this._image=this._imageId=this._imageSubRegion=void 0,v(this,E))}},ready:{get:function(){return-1!==this._imageIndex}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(a){this._actualClampedPosition=f.clone(a,this._actualClampedPosition);v(this,C)}},clusterShow:{get:function(){return this._clusterShow},set:function(a){this._clusterShow!==a&&(this._clusterShow=a,v(this,B))}}});D.prototype.getPickId=function(a){h(this._pickId)||(this._pickId=a.createPickId({primitive:this._pickPrimitive,collection:this._collection,id:this._id}));return this._pickId};D.prototype._updateClamping=function(){D._updateClamping(this._billboardCollection,this)};var W=new g,M=new f;D._updateClamping=function(a,b){function c(a){if(b._heightReference===u.RELATIVE_TO_GROUND)if(b._mode===A.SCENE3D){var c=l.cartesianToCartographic(a,W);c.height+=q.height;l.cartographicToCartesian(c,a)}else a.x+=q.height;b._clampedPosition=f.clone(a,b._clampedPosition)}var e=a._scene;if(h(e)&&h(e.globe)){var k=e.globe,l=k.ellipsoid,m=k._surface,e=e.frameState.mode,p=e!==b._mode;b._mode=e;(b._heightReference===u.NONE||p)&&h(b._removeCallbackFunc)&&(b._removeCallbackFunc(),b._removeCallbackFunc=void 0,b._clampedPosition=void 0);if(b._heightReference!==u.NONE&&h(b._position)){var q=l.cartesianToCartographic(b._position);h(q)?(h(b._removeCallbackFunc)&&b._removeCallbackFunc(),b._removeCallbackFunc=m.updateHeight(q,c),g.clone(q,W),k=k.getHeight(q),h(k)&&(W.height=k),l.cartographicToCartesian(W,M),c(M)):b._actualClampedPosition=void 0}}else if(b._heightReference!==u.NONE)throw new d("Height reference is not supported without a scene and globe.");};D.prototype._loadImage=function(){var a=this._billboardCollection._textureAtlas,c=this._imageId,d=this._image,e=this._imageSubRegion,f;h(d)&&(f=a.addImage(c,d));h(e)&&(f=a.addSubRegion(c,e));this._imageIndexPromise=f;if(h(f)){var g=this;f.then(function(f){if(g._imageId===c&&g._image===d&&b.equals(g._imageSubRegion,e)){var h=a.textureCoordinates[f];g._imageWidth=a.texture.width*h.width;g._imageHeight=a.texture.height*h.height;g._imageIndex=f;g._ready=!0;g._image=void 0;g._imageIndexPromise=void 0;v(g,E)}}).otherwise(function(a){console.error("Error loading image for billboard: "+a);g._imageIndexPromise=void 0})}};D.prototype.setImage=function(a,b){if(!h(a))throw new d("id is required.");if(!h(b))throw new d("image is required.");this._imageId!==a&&(this._imageIndex=-1,this._imageSubRegion=void 0,this._imageId=a,this._image=b,h(this._billboardCollection._textureAtlas)&&this._loadImage())};D.prototype.setImageSubRegion=function(a,c){if(!h(a))throw new d("id is required.");if(!h(c))throw new d("subRegion is required.");this._imageId===a&&b.equals(this._imageSubRegion,c)||(this._imageIndex=-1,this._imageId=a,this._imageSubRegion=b.clone(c),h(this._billboardCollection._textureAtlas)&&this._loadImage())};D.prototype._setTranslate=function(b){if(!h(b))throw new d("value is required.");var c=this._translate;a.equals(c,b)||(a.clone(b,c),v(this,I))};D.prototype._getActualPosition=function(){return h(this._clampedPosition)?this._clampedPosition:this._actualPosition};D.prototype._setActualPosition=function(a){h(this._clampedPosition)||f.clone(a,this._actualPosition);v(this,C)};var R=new k;D._computeActualPosition=function(a,b,c,d){if(h(a._clampedPosition))return c.mode!==a._mode&&a._updateClamping(),a._clampedPosition;if(c.mode===A.SCENE3D)return b;t.multiplyByPoint(d,b,R);return z.computeActualWgs84Position(c,R)};var Y=new f;D._computeScreenSpacePosition=function(b,c,d,e,f,g){b=t.multiplyByPoint(b,c,Y);d=z.wgs84WithEyeOffsetToWindowCoordinates(f,b,d,g);if(h(d))return a.add(d,e,d),d};var Q=new a(0,0);D.prototype.computeScreenSpacePosition=function(b,c){var e=this._billboardCollection;h(c)||(c=new a);if(!h(e))throw new d("Billboard must be in a collection.  Was it removed?");if(!h(b))throw new d("scene is required.");a.clone(this._pixelOffset,Q);a.add(Q,this._translate,Q);var f=e.modelMatrix,e=this._position;if(h(this._clampedPosition)&&(e=this._clampedPosition,b.mode!==A.SCENE3D))var g=b.mapProjection,f=g.ellipsoid,e=g.unproject(e,W),e=f.cartographicToCartesian(e,Y),f=t.IDENTITY;return D._computeScreenSpacePosition(f,e,this._eyeOffset,Q,b,c)};D.getScreenSpaceBoundingBox=function(a,c,d){var e=a.width,f=a.height,g=a.scale,e=e*g,f=f*g,g=c.x;a.horizontalOrigin===y.RIGHT?g-=e:a.horizontalOrigin===y.CENTER&&(g-=.5*e);c=c.y;a.verticalOrigin===x.BOTTOM||a.verticalOrigin===x.BASELINE?c-=f:a.verticalOrigin===x.CENTER&&(c-=.5*f);h(d)||(d=new b);d.x=g;d.y=c;d.width=e;d.height=f;return d};D.prototype.equals=function(c){return this===c||h(c)&&this._id===c._id&&f.equals(this._position,c._position)&&this._imageId===c._imageId&&this._show===c._show&&this._scale===c._scale&&this._verticalOrigin===c._verticalOrigin&&this._horizontalOrigin===c._horizontalOrigin&&this._heightReference===c._heightReference&&b.equals(this._imageSubRegion,c._imageSubRegion)&&l.equals(this._color,c._color)&&a.equals(this._pixelOffset,c._pixelOffset)&&a.equals(this._translate,c._translate)&&f.equals(this._eyeOffset,c._eyeOffset)&&r.equals(this._scaleByDistance,c._scaleByDistance)&&r.equals(this._translucencyByDistance,c._translucencyByDistance)&&r.equals(this._pixelOffsetScaleByDistance,c._pixelOffsetScaleByDistance)&&q.equals(this._distanceDisplayCondition,c._distanceDisplayCondition)&&this._disableDepthTestDistance===c._disableDepthTestDistance};D.prototype._destroy=function(){h(this._customData)&&(this._billboardCollection._scene.globe._surface.removeTileCustomData(this._customData),this._customData=void 0);h(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0);this.image=void 0;this._pickId=this._pickId&&this._pickId.destroy();this._billboardCollection=void 0};return D});F("Renderer/VertexArrayFacade","../Core/Check ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/Math ./Buffer ./BufferUsage ./VertexArray".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(e,c,h,g){function m(b,c){return a.getSizeInBytes(c.componentDatatype)-a.getSizeInBytes(b.componentDatatype)}b.defined("context",e);if(!c||0===c.length)throw new l("At least one attribute is required.");var p=d._verifyAttributes(c);h=f(h,0);c=[];for(var q={},r,u,t=p.length,y=0;y<t;++y){var I=p[y];I.vertexBuffer?c.push(I):(u=I.usage,r=q[u],k(r)||(r=q[u]=[]),r.push(I))}this._allBuffers=[];for(u in q)q.hasOwnProperty(u)&&(r=q[u],r.sort(m),p=d._vertexSizeInBytes(r),r={vertexSizeInBytes:p,vertexBuffer:void 0,usage:r[0].usage,needsCommit:!1,arrayBuffer:void 0,arrayViews:d._createArrayViews(r,p)},this._allBuffers.push(r));this._size=0;this._instanced=f(g,!1);this._precreated=c;this._context=e;this.va=this.writers=void 0;this.resize(h)}function q(a){var b=a.va;if(k(b)){for(var d=b.length,e=0;e<d;++e)b[e].va.destroy();a.va=void 0}}d._verifyAttributes=function(b){for(var c=[],d=0;d<b.length;++d){var e=b[d],e={index:f(e.index,d),enabled:f(e.enabled,!0),componentsPerAttribute:e.componentsPerAttribute,componentDatatype:f(e.componentDatatype,a.FLOAT),normalize:f(e.normalize,!1),vertexBuffer:e.vertexBuffer,usage:f(e.usage,h.STATIC_DRAW)};c.push(e);if(1!==e.componentsPerAttribute&&2!==e.componentsPerAttribute&&3!==e.componentsPerAttribute&&4!==e.componentsPerAttribute)throw new l("attribute.componentsPerAttribute must be in the range [1, 4].");if(!a.validate(e.componentDatatype))throw new l("Attribute must have a valid componentDatatype or not specify it.");if(!h.validate(e.usage))throw new l("Attribute must have a valid usage or not specify it.");}b=Array(c.length);for(d=0;d<c.length;++d){e=c[d].index;if(b[e])throw new l("Index "+e+" is used by more than one attribute.");b[e]=!0}return c};d._vertexSizeInBytes=function(b){for(var c=0,d=b.length,e=0;e<d;++e)var f=b[e],c=c+f.componentsPerAttribute*a.getSizeInBytes(f.componentDatatype);b=0<d?a.getSizeInBytes(b[0].componentDatatype):0;d=0<b?c%b:0;return c+(0===d?0:b-d)};d._createArrayViews=function(b,c){for(var d=[],e=0,f=b.length,h=0;h<f;++h){var g=b[h],k=g.componentDatatype;d.push({index:g.index,enabled:g.enabled,componentsPerAttribute:g.componentsPerAttribute,componentDatatype:k,normalize:g.normalize,offsetInBytes:e,vertexSizeInComponentType:c/a.getSizeInBytes(k),view:void 0});e+=g.componentsPerAttribute*a.getSizeInBytes(k)}return d};d.prototype.resize=function(a){this._size=a;a=this._allBuffers;this.writers=[];for(var b=0,e=a.length;b<e;++b){var f=a[b];d._resize(f,this._size);d._appendWriters(this.writers,f)}q(this)};d._resize=function(b,c){if(0<b.vertexSizeInBytes){var d=new ArrayBuffer(c*b.vertexSizeInBytes);if(k(b.arrayBuffer))for(var e=new Uint8Array(d),f=new Uint8Array(b.arrayBuffer),h=f.length,g=0;g<h;++g)e[g]=f[g];e=b.arrayViews;f=e.length;for(h=0;h<f;++h)g=e[h],g.view=a.createArrayBufferView(g.componentDatatype,d,g.offsetInBytes);b.arrayBuffer=d}};var t=[function(a,b,d){return function(c,e){b[c*d]=e;a.needsCommit=!0}},function(a,b,d){return function(c,e,f){c*=d;b[c]=e;b[c+1]=f;a.needsCommit=!0}},function(a,b,d){return function(c,e,f,h){c*=d;b[c]=e;b[c+1]=f;b[c+2]=h;a.needsCommit=!0}},function(a,b,d){return function(c,e,f,h,g){c*=d;b[c]=e;b[c+1]=f;b[c+2]=h;b[c+3]=g;a.needsCommit=!0}}];d._appendWriters=function(a,b){for(var c=b.arrayViews,d=c.length,e=0;e<d;++e){var f=c[e];a[f.index]=t[f.componentsPerAttribute-1](b,f.view,f.vertexSizeInComponentType)}};d.prototype.commit=function(a){var b=!1,f=this._allBuffers,h,g,l;g=0;for(l=f.length;g<l;++g){h=f[g];a:{if(h.needsCommit&&0<h.vertexSizeInBytes){h.needsCommit=!1;var r=h.vertexBuffer,t=this._size*h.vertexSizeInBytes,v=k(r);if(!v||r.sizeInBytes<t){v&&r.destroy();h.vertexBuffer=e.createVertexBuffer({context:this._context,typedArray:h.arrayBuffer,usage:h.usage});h.vertexBuffer.vertexArrayDestroyable=!1;h=!0;break a}h.vertexBuffer.copyFromArrayView(h.arrayBuffer)}h=!1}b=h||b}if(b||!k(this.va))for(q(this),b=this.va=[],r=k(a)?Math.ceil(this._size/(m.SIXTY_FOUR_KILOBYTES-1)):1,t=0;t<r;++t){v=[];g=0;for(l=f.length;g<l;++g)h=f[g],d._appendAttributes(v,h,t*h.vertexSizeInBytes*(m.SIXTY_FOUR_KILOBYTES-1),this._instanced);v=v.concat(this._precreated);b.push({va:new p({context:this._context,attributes:v,indexBuffer:a}),indicesCount:1.5*(t!==r-1?m.SIXTY_FOUR_KILOBYTES-1:this._size%(m.SIXTY_FOUR_KILOBYTES-1))})}};d._appendAttributes=function(a,b,d,e){for(var c=b.arrayViews,f=c.length,h=0;h<f;++h){var g=c[h];a.push({index:g.index,enabled:g.enabled,componentsPerAttribute:g.componentsPerAttribute,componentDatatype:g.componentDatatype,normalize:g.normalize,vertexBuffer:b.vertexBuffer,offsetInBytes:d+g.offsetInBytes,strideInBytes:b.vertexSizeInBytes,instanceDivisor:e?1:0})}};d.prototype.subCommit=function(a,b){if(0>a||a>=this._size)throw new l("offsetInVertices must be greater than or equal to zero and less than the vertex array size.");if(a+b>this._size)throw new l("offsetInVertices + lengthInVertices cannot exceed the vertex array size.");for(var c=this._allBuffers,d=0,e=c.length;d<e;++d){var f=c[d];if(f.needsCommit&&0<f.vertexSizeInBytes){var h=f.vertexSizeInBytes*a;f.vertexBuffer.copyFromArrayView(new Uint8Array(f.arrayBuffer,h,f.vertexSizeInBytes*b),h)}}};d.prototype.endSubCommits=function(){for(var a=this._allBuffers,b=0,d=a.length;b<d;++b)a[b].needsCommit=!1};d.prototype.isDestroyed=function(){return!1};d.prototype.destroy=function(){for(var a=this._allBuffers,b=0,d=a.length;b<d;++b){var e=a[b];e.vertexBuffer=e.vertexBuffer&&e.vertexBuffer.destroy()}q(this);return g(this)};return d});F("FeShadersEx/BillboardCollectionDisableFxaaFS",[],function(){return"void main()\n{\n    gl_FragColor \x3d vec4(1.0,0.0,0.0,1.0);\n}"});F("Shaders/BillboardCollectionFS",[],function(){return"uniform sampler2D u_atlas;\n#ifdef VECTOR_TILE\nuniform vec4 u_highlightColor;\n#endif\nvarying vec2 v_textureCoordinates;\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\nconst float SHIFT_LEFT12 \x3d 4096.0;\nconst float SHIFT_LEFT1 \x3d 2.0;\nconst float SHIFT_RIGHT12 \x3d 1.0 / 4096.0;\nconst float SHIFT_RIGHT1 \x3d 1.0 / 2.0;\nfloat getGlobeDepth(vec2 adjustedST, vec2 depthLookupST, bool applyTranslate, vec2 dimensions, vec2 imageSize)\n{\nvec2 lookupVector \x3d imageSize * (depthLookupST - adjustedST);\nlookupVector \x3d v_rotationMatrix * lookupVector;\nvec2 labelOffset \x3d (dimensions - imageSize) * (depthLookupST - vec2(0.0, v_originTextureCoordinateAndTranslate.y));\nvec2 translation \x3d v_originTextureCoordinateAndTranslate.zw;\nif (applyTranslate)\n{\ntranslation +\x3d (dimensions * v_originTextureCoordinateAndTranslate.xy * vec2(1.0, 0.0));\n}\nvec2 st \x3d ((lookupVector - translation + labelOffset) + gl_FragCoord.xy) / czm_viewport.zw;\nfloat logDepthOrDepth \x3d czm_unpackDepth(texture2D(czm_globeDepthTexture, st));\nif (logDepthOrDepth \x3d\x3d 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(gl_FragCoord.xy, logDepthOrDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec4 color \x3d texture2D(u_atlas, v_textureCoordinates);\ncolor \x3d czm_gammaCorrect(color);\ncolor *\x3d czm_gammaCorrect(v_color);\n#if !defined(OPAQUE) \x26\x26 !defined(TRANSLUCENT)\nif (color.a \x3c 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\nif (color.a \x3c 0.995)\n{\ndiscard;\n}\n#else\nif (color.a \x3e\x3d 0.995)\n{\ndiscard;\n}\n#endif\n#endif\n#ifdef VECTOR_TILE\ncolor *\x3d u_highlightColor;\n#endif\ngl_FragColor \x3d color;\nczm_writeLogDepth();\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat temp \x3d v_compressed.y;\ntemp \x3d temp * SHIFT_RIGHT1;\nfloat temp2 \x3d (temp - floor(temp)) * SHIFT_LEFT1;\nbool enableDepthTest \x3d temp2 !\x3d 0.0;\nbool applyTranslate \x3d floor(temp) !\x3d 0.0;\nif (enableDepthTest) {\ntemp \x3d v_compressed.z;\ntemp \x3d temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y \x3d (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x \x3d floor(temp);\ntemp \x3d v_compressed.w;\ntemp \x3d temp * SHIFT_RIGHT12;\nvec2 imageSize;\nimageSize.y \x3d (temp - floor(temp)) * SHIFT_LEFT12;\nimageSize.x \x3d floor(temp);\nvec2 adjustedST \x3d v_textureCoordinates - v_textureCoordinateBounds.xy;\nadjustedST \x3d adjustedST / vec2(v_textureCoordinateBounds.z - v_textureCoordinateBounds.x, v_textureCoordinateBounds.w - v_textureCoordinateBounds.y);\nfloat epsilonEyeDepth \x3d v_compressed.x + czm_epsilon1;\nfloat globeDepth1 \x3d getGlobeDepth(adjustedST, v_originTextureCoordinateAndTranslate.xy, applyTranslate, dimensions, imageSize);\nif (globeDepth1 !\x3d 0.0 \x26\x26 globeDepth1 \x3e epsilonEyeDepth)\n{\nfloat globeDepth2 \x3d getGlobeDepth(adjustedST, vec2(0.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth2 !\x3d 0.0 \x26\x26 globeDepth2 \x3e epsilonEyeDepth)\n{\nfloat globeDepth3 \x3d getGlobeDepth(adjustedST, vec2(1.0, 1.0), applyTranslate, dimensions, imageSize);\nif (globeDepth3 !\x3d 0.0 \x26\x26 globeDepth3 \x3e epsilonEyeDepth)\n{\ndiscard;\n}\n}\n}\n}\n#endif\n}\n"});F("Shaders/BillboardCollectionVS",[],function(){return"#ifdef INSTANCED\nattribute vec2 direction;\n#endif\nattribute vec4 positionHighAndScale;\nattribute vec4 positionLowAndRotation;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 compressedAttribute2;\nattribute vec4 eyeOffset;\nattribute vec4 scaleByDistance;\nattribute vec4 pixelOffsetScaleByDistance;\nattribute vec4 compressedAttribute3;\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\nattribute vec4 textureCoordinateBoundsOrLabelTranslate;\n#endif\n#ifdef VECTOR_TILE\nattribute float a_batchId;\n#endif\nvarying vec2 v_textureCoordinates;\n#ifdef FRAGMENT_DEPTH_CHECK\nvarying vec4 v_textureCoordinateBounds;\nvarying vec4 v_originTextureCoordinateAndTranslate;\nvarying vec4 v_compressed;\nvarying mat2 v_rotationMatrix;\n#endif\nvarying vec4 v_pickColor;\nvarying vec4 v_color;\nconst float UPPER_BOUND \x3d 32768.0;\nconst float SHIFT_LEFT16 \x3d 65536.0;\nconst float SHIFT_LEFT12 \x3d 4096.0;\nconst float SHIFT_LEFT8 \x3d 256.0;\nconst float SHIFT_LEFT7 \x3d 128.0;\nconst float SHIFT_LEFT5 \x3d 32.0;\nconst float SHIFT_LEFT3 \x3d 8.0;\nconst float SHIFT_LEFT2 \x3d 4.0;\nconst float SHIFT_LEFT1 \x3d 2.0;\nconst float SHIFT_RIGHT12 \x3d 1.0 / 4096.0;\nconst float SHIFT_RIGHT8 \x3d 1.0 / 256.0;\nconst float SHIFT_RIGHT7 \x3d 1.0 / 128.0;\nconst float SHIFT_RIGHT5 \x3d 1.0 / 32.0;\nconst float SHIFT_RIGHT3 \x3d 1.0 / 8.0;\nconst float SHIFT_RIGHT2 \x3d 1.0 / 4.0;\nconst float SHIFT_RIGHT1 \x3d 1.0 / 2.0;\nvec4 addScreenSpaceOffset(vec4 positionEC, vec2 imageSize, float scale, vec2 direction, vec2 origin, vec2 translate, vec2 pixelOffset, vec3 alignedAxis, bool validAlignedAxis, float rotation, bool sizeInMeters, out mat2 rotationMatrix, out float mpp)\n{\nvec2 halfSize \x3d imageSize * scale * czm_resolutionScale * 0.5;\nhalfSize *\x3d ((direction * 2.0) - 1.0);\nvec2 originTranslate \x3d origin * abs(halfSize);\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nif (validAlignedAxis || rotation !\x3d 0.0)\n{\nfloat angle \x3d rotation;\nif (validAlignedAxis)\n{\nvec4 projectedAlignedAxis \x3d czm_modelViewProjection * vec4(alignedAxis, 0.0);\nangle +\x3d sign(-projectedAlignedAxis.x) * acos(sign(projectedAlignedAxis.y) * (projectedAlignedAxis.y * projectedAlignedAxis.y) /\n(projectedAlignedAxis.x * projectedAlignedAxis.x + projectedAlignedAxis.y * projectedAlignedAxis.y));\n}\nfloat cosTheta \x3d cos(angle);\nfloat sinTheta \x3d sin(angle);\nrotationMatrix \x3d mat2(cosTheta, sinTheta, -sinTheta, cosTheta);\nhalfSize \x3d rotationMatrix * halfSize;\n}\nelse\n{\nrotationMatrix \x3d mat2(1.0, 0.0, 0.0, 1.0);\n}\n#endif\nif (sizeInMeters)\n{\npositionEC.xy +\x3d halfSize;\n}\nmpp \x3d czm_metersPerPixel(positionEC);\nif (!sizeInMeters)\n{\noriginTranslate *\x3d mpp;\n}\npositionEC.xy +\x3d originTranslate;\nif (!sizeInMeters)\n{\npositionEC.xy +\x3d halfSize * mpp;\n}\npositionEC.xy +\x3d translate * mpp;\npositionEC.xy +\x3d (pixelOffset * czm_resolutionScale) * mpp;\nreturn positionEC;\n}\n#ifdef VERTEX_DEPTH_CHECK\nfloat getGlobeDepth(vec4 positionEC)\n{\nvec4 posWC \x3d czm_eyeToWindowCoordinates(positionEC);\nfloat globeDepth \x3d czm_unpackDepth(texture2D(czm_globeDepthTexture, posWC.xy / czm_viewport.zw));\nif (globeDepth \x3d\x3d 0.0)\n{\nreturn 0.0;\n}\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(posWC.xy, globeDepth);\nreturn eyeCoordinate.z / eyeCoordinate.w;\n}\n#endif\nvoid main()\n{\nvec3 positionHigh \x3d positionHighAndScale.xyz;\nvec3 positionLow \x3d positionLowAndRotation.xyz;\nfloat scale \x3d positionHighAndScale.w;\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nfloat rotation \x3d positionLowAndRotation.w;\n#else\nfloat rotation \x3d 0.0;\n#endif\nfloat compressed \x3d compressedAttribute0.x;\nvec2 pixelOffset;\npixelOffset.x \x3d floor(compressed * SHIFT_RIGHT7);\ncompressed -\x3d pixelOffset.x * SHIFT_LEFT7;\npixelOffset.x -\x3d UPPER_BOUND;\nvec2 origin;\norigin.x \x3d floor(compressed * SHIFT_RIGHT5);\ncompressed -\x3d origin.x * SHIFT_LEFT5;\norigin.y \x3d floor(compressed * SHIFT_RIGHT3);\ncompressed -\x3d origin.y * SHIFT_LEFT3;\n#ifdef FRAGMENT_DEPTH_CHECK\nvec2 depthOrigin \x3d origin.xy;\n#endif\norigin -\x3d vec2(1.0);\nfloat show \x3d floor(compressed * SHIFT_RIGHT2);\ncompressed -\x3d show * SHIFT_LEFT2;\n#ifdef INSTANCED\nvec2 textureCoordinatesBottomLeft \x3d czm_decompressTextureCoordinates(compressedAttribute0.w);\nvec2 textureCoordinatesRange \x3d czm_decompressTextureCoordinates(eyeOffset.w);\nvec2 textureCoordinates \x3d textureCoordinatesBottomLeft + direction * textureCoordinatesRange;\n#else\nvec2 direction;\ndirection.x \x3d floor(compressed * SHIFT_RIGHT1);\ndirection.y \x3d compressed - direction.x * SHIFT_LEFT1;\nvec2 textureCoordinates \x3d czm_decompressTextureCoordinates(compressedAttribute0.w);\n#endif\nfloat temp \x3d compressedAttribute0.y  * SHIFT_RIGHT8;\npixelOffset.y \x3d -(floor(temp) - UPPER_BOUND);\nvec2 translate;\ntranslate.y \x3d (temp - floor(temp)) * SHIFT_LEFT16;\ntemp \x3d compressedAttribute0.z * SHIFT_RIGHT8;\ntranslate.x \x3d floor(temp) - UPPER_BOUND;\ntranslate.y +\x3d (temp - floor(temp)) * SHIFT_LEFT8;\ntranslate.y -\x3d UPPER_BOUND;\ntemp \x3d compressedAttribute1.x * SHIFT_RIGHT8;\nfloat temp2 \x3d floor(compressedAttribute2.w * SHIFT_RIGHT2);\nvec2 imageSize \x3d vec2(floor(temp), temp2);\n#ifdef FRAGMENT_DEPTH_CHECK\nfloat labelHorizontalOrigin \x3d floor(compressedAttribute2.w - (temp2 * SHIFT_LEFT2));\nfloat applyTranslate \x3d 0.0;\nif (labelHorizontalOrigin !\x3d 0.0)\n{\napplyTranslate \x3d 1.0;\nlabelHorizontalOrigin -\x3d 2.0;\ndepthOrigin.x \x3d labelHorizontalOrigin + 1.0;\n}\ndepthOrigin \x3d vec2(1.0) - (depthOrigin * 0.5);\n#endif\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x \x3d compressedAttribute1.z;\ntranslucencyByDistance.z \x3d compressedAttribute1.w;\ntranslucencyByDistance.y \x3d ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp \x3d compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w \x3d ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\n#if defined(VERTEX_DEPTH_CHECK) || defined(FRAGMENT_DEPTH_CHECK)\ntemp \x3d compressedAttribute3.w;\ntemp \x3d temp * SHIFT_RIGHT12;\nvec2 dimensions;\ndimensions.y \x3d (temp - floor(temp)) * SHIFT_LEFT12;\ndimensions.x \x3d floor(temp);\n#endif\n#ifdef ALIGNED_AXIS\nvec3 alignedAxis \x3d czm_octDecode(floor(compressedAttribute1.y * SHIFT_RIGHT8));\ntemp \x3d compressedAttribute2.z * SHIFT_RIGHT5;\nbool validAlignedAxis \x3d (temp - floor(temp)) * SHIFT_LEFT1 \x3e 0.0;\n#else\nvec3 alignedAxis \x3d vec3(0.0);\nbool validAlignedAxis \x3d false;\n#endif\nvec4 pickColor;\nvec4 color;\ntemp \x3d compressedAttribute2.y;\ntemp \x3d temp * SHIFT_RIGHT8;\npickColor.b \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\npickColor.g \x3d (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r \x3d floor(temp);\ntemp \x3d compressedAttribute2.x;\ntemp \x3d temp * SHIFT_RIGHT8;\ncolor.b \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\ncolor.g \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r \x3d floor(temp);\ntemp \x3d compressedAttribute2.z * SHIFT_RIGHT8;\nbool sizeInMeters \x3d floor((temp - floor(temp)) * SHIFT_LEFT7) \x3e 0.0;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\npickColor.a \x3d (temp - floor(temp)) * SHIFT_LEFT8;\npickColor /\x3d 255.0;\ncolor.a \x3d floor(temp);\ncolor /\x3d 255.0;\nvec4 p \x3d czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC \x3d czm_modelViewRelativeToEye * p;\n#if defined(FRAGMENT_DEPTH_CHECK) || defined(VERTEX_DEPTH_CHECK)\nfloat eyeDepth \x3d positionEC.z;\n#endif\npositionEC \x3d czm_eyeOffset(positionEC, eyeOffset.xyz);\npositionEC.xyz *\x3d show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(EYE_DISTANCE_PIXEL_OFFSET) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode \x3d\x3d czm_sceneMode2D)\n{\nlengthSq \x3d czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq \x3d dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\nfloat distanceScale \x3d czm_nearFarScalar(scaleByDistance, lengthSq);\nscale *\x3d distanceScale;\ntranslate *\x3d distanceScale;\nif (scale \x3d\x3d 0.0)\n{\npositionEC.xyz \x3d vec3(0.0);\n}\n#endif\nfloat translucency \x3d 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency \x3d czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency \x3d\x3d 0.0)\n{\npositionEC.xyz \x3d vec3(0.0);\n}\n#endif\n#ifdef EYE_DISTANCE_PIXEL_OFFSET\nfloat pixelOffsetScale \x3d czm_nearFarScalar(pixelOffsetScaleByDistance, lengthSq);\npixelOffset *\x3d pixelOffsetScale;\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq \x3d compressedAttribute3.x;\nfloat farSq \x3d compressedAttribute3.y;\nif (lengthSq \x3c nearSq || lengthSq \x3e farSq)\n{\npositionEC.xyz \x3d vec3(0.0);\n}\n#endif\nmat2 rotationMatrix;\nfloat mpp;\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance \x3d compressedAttribute3.z;\n#endif\n#ifdef VERTEX_DEPTH_CHECK\nif (lengthSq \x3c disableDepthTestDistance) {\nfloat depthsilon \x3d 10.0;\nvec2 labelTranslate \x3d textureCoordinateBoundsOrLabelTranslate.xy;\nvec4 pEC1 \x3d addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth1 \x3d getGlobeDepth(pEC1);\nif (globeDepth1 !\x3d 0.0 \x26\x26 pEC1.z + depthsilon \x3c globeDepth1)\n{\nvec4 pEC2 \x3d addScreenSpaceOffset(positionEC, dimensions, scale, vec2(0.0, 1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth2 \x3d getGlobeDepth(pEC2);\nif (globeDepth2 !\x3d 0.0 \x26\x26 pEC2.z + depthsilon \x3c globeDepth2)\n{\nvec4 pEC3 \x3d addScreenSpaceOffset(positionEC, dimensions, scale, vec2(1.0), origin, labelTranslate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\nfloat globeDepth3 \x3d getGlobeDepth(pEC3);\nif (globeDepth3 !\x3d 0.0 \x26\x26 pEC3.z + depthsilon \x3c globeDepth3)\n{\npositionEC.xyz \x3d vec3(0.0);\n}\n}\n}\n}\n#endif\npositionEC \x3d addScreenSpaceOffset(positionEC, imageSize, scale, direction, origin, translate, pixelOffset, alignedAxis, validAlignedAxis, rotation, sizeInMeters, rotationMatrix, mpp);\ngl_Position \x3d czm_projection * positionEC;\nv_textureCoordinates \x3d textureCoordinates;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth();\n#endif\n#ifdef DISABLE_DEPTH_DISTANCE\nif (disableDepthTestDistance \x3d\x3d 0.0 \x26\x26 czm_minimumDisableDepthTestDistance !\x3d 0.0)\n{\ndisableDepthTestDistance \x3d czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance !\x3d 0.0)\n{\nfloat zclip \x3d gl_Position.z / gl_Position.w;\nbool clipped \x3d (zclip \x3c -1.0 || zclip \x3e 1.0);\nif (!clipped \x26\x26 (disableDepthTestDistance \x3c 0.0 || (lengthSq \x3e 0.0 \x26\x26 lengthSq \x3c disableDepthTestDistance)))\n{\ngl_Position.z \x3d -gl_Position.w;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(vec4(czm_currentFrustum.x));\n#endif\n}\n}\n#endif\n#ifdef FRAGMENT_DEPTH_CHECK\nif (sizeInMeters) {\ntranslate /\x3d mpp;\ndimensions /\x3d mpp;\nimageSize /\x3d mpp;\n}\n#if defined(ROTATION) || defined(ALIGNED_AXIS)\nv_rotationMatrix \x3d rotationMatrix;\n#else\nv_rotationMatrix \x3d mat2(1.0, 0.0, 0.0, 1.0);\n#endif\nfloat enableDepthCheck \x3d 0.0;\nif (lengthSq \x3c disableDepthTestDistance)\n{\nenableDepthCheck \x3d 1.0;\n}\nfloat dw \x3d floor(clamp(dimensions.x, 0.0, SHIFT_LEFT12));\nfloat dh \x3d floor(clamp(dimensions.y, 0.0, SHIFT_LEFT12));\nfloat iw \x3d floor(clamp(imageSize.x, 0.0, SHIFT_LEFT12));\nfloat ih \x3d floor(clamp(imageSize.y, 0.0, SHIFT_LEFT12));\nv_compressed.x \x3d eyeDepth;\nv_compressed.y \x3d applyTranslate * SHIFT_LEFT1 + enableDepthCheck;\nv_compressed.z \x3d dw * SHIFT_LEFT12 + dh;\nv_compressed.w \x3d iw * SHIFT_LEFT12 + ih;\nv_originTextureCoordinateAndTranslate.xy \x3d depthOrigin;\nv_originTextureCoordinateAndTranslate.zw \x3d translate;\nv_textureCoordinateBounds \x3d textureCoordinateBoundsOrLabelTranslate;\n#endif\nv_pickColor \x3d pickColor;\nv_color \x3d color;\nv_color.a *\x3d translucency;\n}\n"});F("Scene/BlendOption",["../Core/freezeObject"],function(b){return b({OPAQUE:0,TRANSLUCENT:1,OPAQUE_AND_TRANSLUCENT:2})});F("Renderer/Framebuffer","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/PixelFormat ./ContextLimits ./PixelDatatype".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a,b,c){a=a._gl;a.framebufferTexture2D(a.FRAMEBUFFER,b,c._target,c._texture,0)}function d(a,b,c){a=a._gl;a.framebufferRenderbuffer(a.FRAMEBUFFER,b,a.RENDERBUFFER,c._getRenderbuffer())}function q(g){g=a(g,a.EMPTY_OBJECT);var k=g.context;b.defined("options.context",k);var c=k._gl,q=e.maximumColorAttachments;this._gl=c;this._framebuffer=c.createFramebuffer();this._colorTextures=[];this._colorRenderbuffers=[];this._activeColorAttachments=[];this._depthStencilRenderbuffer=this._depthStencilTexture=this._stencilRenderbuffer=this._depthRenderbuffer=this._depthTexture=void 0;this.destroyAttachments=a(g.destroyAttachments,!0);if(f(g.colorTextures)&&f(g.colorRenderbuffers))throw new l("Cannot have both color texture and color renderbuffer attachments.");if(f(g.depthTexture)&&f(g.depthRenderbuffer))throw new l("Cannot have both a depth texture and depth renderbuffer attachment.");if(f(g.depthStencilTexture)&&f(g.depthStencilRenderbuffer))throw new l("Cannot have both a depth-stencil texture and depth-stencil renderbuffer attachment.");var c=f(g.depthTexture)||f(g.depthRenderbuffer),t=f(g.depthStencilTexture)||f(g.depthStencilRenderbuffer);if(c&&t)throw new l("Cannot have both a depth and depth-stencil attachment.");if(f(g.stencilRenderbuffer)&&t)throw new l("Cannot have both a stencil and depth-stencil attachment.");if(c&&f(g.stencilRenderbuffer))throw new l("Cannot have both a depth and stencil attachment.");this._bind();var A,z;if(f(g.colorTextures)){var x=g.colorTextures,t=this._colorTextures.length=this._activeColorAttachments.length=x.length;if(t>q)throw new l("The number of color attachments exceeds the number supported.");for(c=0;c<t;++c){A=x[c];if(!m.isColorFormat(A.pixelFormat))throw new l("The color-texture pixel-format must be a color format.");if(A.pixelDatatype===h.FLOAT&&!k.colorBufferFloat)throw new l("The color texture pixel datatype is FLOAT and the WebGL implementation does not support the EXT_color_buffer_float or WEBGL_color_buffer_float extensions. See Context.colorBufferFloat.");if(A.pixelDatatype===h.HALF_FLOAT&&!k.colorBufferHalfFloat)throw new l("The color texture pixel datatype is HALF_FLOAT and the WebGL implementation does not support the EXT_color_buffer_half_float extension. See Context.colorBufferHalfFloat.");z=this._gl.COLOR_ATTACHMENT0+c;p(this,z,A);this._activeColorAttachments[c]=z;this._colorTextures[c]=A}}if(f(g.colorRenderbuffers)){k=g.colorRenderbuffers;t=this._colorRenderbuffers.length=this._activeColorAttachments.length=k.length;if(t>q)throw new l("The number of color attachments exceeds the number supported.");for(c=0;c<t;++c)q=k[c],z=this._gl.COLOR_ATTACHMENT0+c,d(this,z,q),this._activeColorAttachments[c]=z,this._colorRenderbuffers[c]=q}if(f(g.depthTexture)){A=g.depthTexture;if(A.pixelFormat!==m.DEPTH_COMPONENT)throw new l("The depth-texture pixel-format must be DEPTH_COMPONENT.");p(this,this._gl.DEPTH_ATTACHMENT,A);this._depthTexture=A}f(g.depthRenderbuffer)&&(q=g.depthRenderbuffer,d(this,this._gl.DEPTH_ATTACHMENT,q),this._depthRenderbuffer=q);f(g.stencilRenderbuffer)&&(q=g.stencilRenderbuffer,d(this,this._gl.STENCIL_ATTACHMENT,q),this._stencilRenderbuffer=q);if(f(g.depthStencilTexture)){A=g.depthStencilTexture;if(A.pixelFormat!==m.DEPTH_STENCIL)throw new l("The depth-stencil pixel-format must be DEPTH_STENCIL.");p(this,this._gl.DEPTH_STENCIL_ATTACHMENT,A);this._depthStencilTexture=A}f(g.depthStencilRenderbuffer)&&(q=g.depthStencilRenderbuffer,d(this,this._gl.DEPTH_STENCIL_ATTACHMENT,q),this._depthStencilRenderbuffer=q);this._unBind()}k(q.prototype,{status:{get:function(){this._bind();var a=this._gl.checkFramebufferStatus(this._gl.FRAMEBUFFER);this._unBind();return a}},numberOfColorAttachments:{get:function(){return this._activeColorAttachments.length}},depthTexture:{get:function(){return this._depthTexture}},depthRenderbuffer:{get:function(){return this._depthRenderbuffer}},stencilRenderbuffer:{get:function(){return this._stencilRenderbuffer}},depthStencilTexture:{get:function(){return this._depthStencilTexture}},depthStencilRenderbuffer:{get:function(){return this._depthStencilRenderbuffer}},hasDepthAttachment:{get:function(){return!!(this.depthTexture||this.depthRenderbuffer||this.depthStencilTexture||this.depthStencilRenderbuffer)}}});q.prototype._bind=function(){var a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,this._framebuffer)};q.prototype._unBind=function(){var a=this._gl;a.bindFramebuffer(a.FRAMEBUFFER,null)};q.prototype._getActiveColorAttachments=function(){return this._activeColorAttachments};q.prototype.getColorTexture=function(a){if(!f(a)||0>a||a>=this._colorTextures.length)throw new l("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorTextures[a]};q.prototype.getColorRenderbuffer=function(a){if(!f(a)||0>a||a>=this._colorRenderbuffers.length)throw new l("index is required, must be greater than or equal to zero and must be less than the number of color attachments.");return this._colorRenderbuffers[a]};q.prototype.isDestroyed=function(){return!1};q.prototype.destroy=function(){if(this.destroyAttachments){for(var a=0,b=this._colorTextures,c=b.length;a<c;++a){var d=b[a];f(d)&&d.destroy()}b=this._colorRenderbuffers;c=b.length;for(a=0;a<c;++a)d=b[a],f(d)&&d.destroy();this._depthTexture=this._depthTexture&&this._depthTexture.destroy();this._depthRenderbuffer=this._depthRenderbuffer&&this._depthRenderbuffer.destroy();this._stencilRenderbuffer=this._stencilRenderbuffer&&this._stencilRenderbuffer.destroy();this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy();this._depthStencilRenderbuffer=this._depthStencilRenderbuffer&&this._depthStencilRenderbuffer.destroy()}this._gl.deleteFramebuffer(this._framebuffer);return g(this)};return q});F("Scene/TextureAtlas","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/PixelFormat ../Core/Resource ../Core/RuntimeError ../Renderer/Framebuffer ../Renderer/Texture ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(b,c,d,e,f){this.bottomLeft=k(b,a.ZERO);this.topRight=k(c,a.ZERO);this.childNode1=d;this.childNode2=e;this.imageIndex=f}function u(a){a=k(a,k.EMPTY_OBJECT);var b=k(a.borderWidthInPixels,1),c=k(a.initialSize,z);if(!g(a.context))throw new e("context is required.");if(0>b)throw new e("borderWidthInPixels must be greater than or equal to zero.");if(1>c.x||1>c.y)throw new e("initialSize must be greater than zero.");this._context=a.context;this._pixelFormat=k(a.pixelFormat,h.RGBA);this._borderWidthInPixels=b;this._textureCoordinates=[];this._guid=f();this._idHash={};this._initialSize=c;this._sampler=k(a.sampler,void 0);this._root=void 0}function y(b,d,e){if(g(d)){if(!g(d.childNode1)&&!g(d.childNode2)){if(g(d.imageIndex))return;var f=d.topRight.x-d.bottomLeft.x-e.width,h=d.topRight.y-d.bottomLeft.y-e.height;if(0>f||0>h)return;if(0===f&&0===h)return d;f>h?(d.childNode1=new c(new a(d.bottomLeft.x,d.bottomLeft.y),new a(d.bottomLeft.x+e.width,d.topRight.y)),f=d.bottomLeft.x+e.width+b._borderWidthInPixels,f<d.topRight.x&&(d.childNode2=new c(new a(f,d.bottomLeft.y),new a(d.topRight.x,d.topRight.y)))):(d.childNode1=new c(new a(d.bottomLeft.x,d.bottomLeft.y),new a(d.topRight.x,d.bottomLeft.y+e.height)),f=d.bottomLeft.y+e.height+b._borderWidthInPixels,f<d.topRight.y&&(d.childNode2=new c(new a(d.bottomLeft.x,f),new a(d.topRight.x,d.topRight.y))));return y(b,d.childNode1,e)}return y(b,d.childNode1,e)||y(b,d.childNode2,e)}}function A(d,e,h){var k=y(d,d._root,e);if(g(k)){k.imageIndex=h;var l=d._texture.width,m=d._texture.height;d._textureCoordinates[h]=new b(k.bottomLeft.x/l,k.bottomLeft.y/m,(k.topRight.x-k.bottomLeft.x)/l,(k.topRight.y-k.bottomLeft.y)/m);d._texture.copyFrom(e,k.bottomLeft.x,k.bottomLeft.y)}else{var m=d._context,p=d._borderWidthInPixels;if(0<d.numberOfImages){for(var r=d._texture.width,u=d._texture.height,k=2*(r+e.width+p),l=2*(u+e.height+p),v=r/k,z=u/l,r=new c(new a(r+p,p),new a(k,u)),r=new c(new a,new a(k,u),d._root,r),p=new c(new a(p,u+p),new a(k,l)),p=new c(new a,new a(k,l),r,p),u=0;u<d._textureCoordinates.length;u++)r=d._textureCoordinates[u],g(r)&&(r.x*=v,r.y*=z,r.width*=v,r.height*=z);v=new t({context:d._context,width:k,height:l,sampler:d._sampler,pixelFormat:d._pixelFormat});m=new q({context:m,colorTextures:[d._texture],destroyAttachments:!1});m._bind();v.copyFromFramebuffer(0,0,0,0,k,l);m._unBind();m.destroy();d._texture=d._texture&&d._texture.destroy();d._texture=v;d._root=p}else k=2*(e.width+2*p),l=2*(e.height+2*p),k<d._initialSize.x&&(k=d._initialSize.x),l<d._initialSize.y&&(l=d._initialSize.y),d._texture=d._texture&&d._texture.destroy(),d._texture=new t({context:d._context,width:k,height:l,sampler:d._sampler,pixelFormat:d._pixelFormat}),d._root=new c(new a(p,p),new a(k,l));A(d,e,h)}d._guid=f()}var z=new a(16,16);l(u.prototype,{borderWidthInPixels:{get:function(){return this._borderWidthInPixels}},textureCoordinates:{get:function(){return this._textureCoordinates}},texture:{get:function(){g(this._texture)||(this._texture=new t({context:this._context,width:this._initialSize.x,height:this._initialSize.y,pixelFormat:this._pixelFormat}));return this._texture}},numberOfImages:{get:function(){return this._textureCoordinates.length}},guid:{get:function(){return this._guid}}});u.prototype.addImage=function(a,b){if(!g(a))throw new e("id is required.");if(!g(b))throw new e("image is required.");var c=this._idHash[a];if(g(c))return c;if("function"===typeof b){if(b=b(a),!g(b))throw new e("image is required.");}else if("string"===typeof b||b instanceof p)b=p.createIfNeeded(b).fetchImage();var d=this,c=r(b,function(a){if(d.isDestroyed())return-1;var b=d.numberOfImages;A(d,a,b);return b});return this._idHash[a]=c};u.prototype.addSubRegion=function(a,c){if(!g(a))throw new e("id is required.");if(!g(c))throw new e("subRegion is required.");var h=this._idHash[a];if(!g(h))throw new d('image with id "'+a+'" not found in the atlas.');var k=this;return r(h,function(a){if(-1===a)return-1;var d=k._texture.width,e=k._texture.height,h=k.numberOfImages;a=k._textureCoordinates[a];k._textureCoordinates.push(new b(a.x+c.x/d,a.y+c.y/e,c.width/d,c.height/e));k._guid=f();return h})};u.prototype.isDestroyed=function(){return!1};u.prototype.destroy=function(){this._texture=this._texture&&this._texture.destroy();return m(this)};return u});F("Scene/BillboardCollection","../Core/AttributeCompression ../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/IndexDatatype ../Core/Math ../Core/Matrix4 ../Core/WebGLConstants ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArrayFacade ../Renderer/Sampler ../Renderer/TextureWrap ../Renderer/TextureMagnificationFilter ../FeShadersEx/BillboardCollectionDisableFxaaFS ../Shaders/BillboardCollectionFS ../Shaders/BillboardCollectionVS ./Billboard ./BlendingState ./BlendOption ./HeightReference ./HorizontalOrigin ./SceneMode ./TextureAtlas ./VerticalOrigin".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W){function M(b){b=m(b,m.EMPTY_OBJECT);this._scene=b.scene;this._batchTable=b.batchTable;this._enableFxaa=m(b.enableFxaa,!1);this._textureAtlasGUID=this._textureAtlas=this._disableFaxx=void 0;this._destroyTextureAtlas=!0;this._vaf=this._rsTranslucent=this._rsOpaque=this._spTranslucent=this._sp=void 0;this._billboards=[];this._billboardsToUpdate=[];this._billboardsToUpdateIndex=0;this._compiledShaderClampToGround=this._shaderClampToGround=this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance=this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition=this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance=this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance=this._compiledShaderScaleByDistance=this._shaderScaleByDistance=this._compiledShaderAlignedAxis=this._shaderAlignedAxis=this._compiledShaderRotation=this._shaderRotation=this._createVertexArray=this._billboardsRemoved=!1;this._propertiesChanged=new Uint32Array(Ua);this._maxEyeOffset=this._maxSize=0;this._maxScale=1;this._maxPixelOffset=0;this._allSizedInMeters=this._allVerticalCenter=this._allHorizontalCenter=!0;this._baseVolume=new a;this._baseVolumeWC=new a;this._baseVolume2D=new a;this._boundingVolume=new a;this._boundingVolumeDirty=!1;this._colorCommands=[];this.modelMatrix=c.clone(m(b.modelMatrix,c.IDENTITY));this._modelMatrix=c.clone(c.IDENTITY);this.debugShowBoundingVolume=m(b.debugShowBoundingVolume,!1);this.blendOption=m(b.blendOption,N.OPAQUE_AND_TRANSLUCENT);this._blendOption=void 0;this._mode=aa.SCENE3D;this._buffersUsage=[A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW,A.STATIC_DRAW];this._highlightColor=g.clone(g.WHITE);var d=this;this._uniforms={u_atlas:function(){return d._textureAtlas.texture},u_highlightColor:function(){return d._highlightColor}};b=this._scene;e(b)&&e(b.terrainProviderChanged)&&(this._removeCallbackFunc=b.terrainProviderChanged.addEventListener(function(){for(var a=this._billboards,b=a.length,c=0;c<b;++c)a[c]._updateClamping()},this))}function R(a){for(var b=a.length,c=0;c<b;++c)a[c]&&a[c]._destroy()}function Y(a){if(a._billboardsRemoved){a._billboardsRemoved=!1;for(var b=[],c=a._billboards,d=c.length,e=0,f=0;e<d;++e){var h=c[e];h&&(h._index=f++,b.push(h))}a._billboards=b}}function Q(a){var b=a.cache.billboardCollection_indexBufferBatched;if(e(b))return b;for(var b=new Uint16Array(98298),c=0,d=0;98298>c;c+=6,d+=4)b[c]=d,b[c+1]=d+1,b[c+2]=d+2,b[c+3]=d+0,b[c+4]=d+2,b[c+5]=d+3;b=y.createIndexBuffer({context:a,typedArray:b,usage:A.STATIC_DRAW,indexDatatype:t.UNSIGNED_SHORT});b.vertexArrayDestroyable=!1;return a.cache.billboardCollection_indexBufferBatched=b}function S(a){var b=a.cache.billboardCollection_indexBufferInstanced;if(e(b))return b;b=y.createIndexBuffer({context:a,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:A.STATIC_DRAW,indexDatatype:t.UNSIGNED_SHORT});b.vertexArrayDestroyable=!1;return a.cache.billboardCollection_indexBufferInstanced=b}function ca(a){var b=a.cache.billboardCollection_vertexBufferInstanced;if(e(b))return b;b=y.createVertexBuffer({context:a,typedArray:new Float32Array([0,0,1,0,1,1,0,1]),usage:A.STATIC_DRAW});b.vertexArrayDestroyable=!1;return a.cache.billboardCollection_vertexBufferInstanced=b}function T(b,c,d,e,f){c=e[sa.positionHighAndScale];e=e[sa.positionLowAndRotation];d=f._getActualPosition();b._mode===aa.SCENE3D&&(a.expand(b._baseVolume,d,b._baseVolume),b._boundingVolumeDirty=!0);q.fromCartesian(d,Ma);d=f.scale;var h=f.rotation;0!==h&&(b._shaderRotation=!0);b._maxScale=Math.max(b._maxScale,d);var g=Ma.high,k=Ma.low;b._instanced?(b=f._index,c(b,g.x,g.y,g.z,d),e(b,k.x,k.y,k.z,h)):(b=4*f._index,c(b+0,g.x,g.y,g.z,d),c(b+1,g.x,g.y,g.z,d),c(b+2,g.x,g.y,g.z,d),c(b+3,g.x,g.y,g.z,d),e(b+0,k.x,k.y,k.z,h),e(b+1,k.x,k.y,k.z,h),e(b+2,k.x,k.y,k.z,h),e(b+3,k.x,k.y,k.z,h))}function da(a,c,f,h,g){c=h[sa.compressedAttribute0];h=g.pixelOffset;var k=h.x,l=h.y;h=g._translate;var m=h.x,p=h.y;a._maxPixelOffset=Math.max(a._maxPixelOffset,Math.abs(k+m),Math.abs(-l+p));var q=g.horizontalOrigin,u=g._verticalOrigin,w=g.show&&g.clusterShow;0===g.color.alpha&&(w=!1);u===W.BASELINE&&(u=W.BOTTOM);a._allHorizontalCenter=a._allHorizontalCenter&&q===Z.CENTER;a._allVerticalCenter=a._allVerticalCenter&&u===W.CENTER;var v=h=0,t=0,z=0,y=g._imageIndex;if(-1!==y){f=f[y];if(!e(f))throw new d("Invalid billboard image index: "+y);h=f.x;v=f.y;t=f.width;z=f.height}f=h+t;t=v+z;k=128*Math.floor(r.clamp(k,-32768,32768)+32768);k=k+32*(q+1)+8*(u+1);k+=4*(w?1:0);l=256*Math.floor(r.clamp(l,-32768,32768)+32768);m=256*Math.floor(r.clamp(m,-32768,32768)+32768);q=(r.clamp(p,-32768,32768)+32768)*La;p=Math.floor(q);q=Math.floor(256*(q-p));l+=p;m+=q;Ia.x=h;Ia.y=v;v=b.compressTextureCoordinates(Ia);Ia.x=f;p=b.compressTextureCoordinates(Ia);Ia.y=t;f=b.compressTextureCoordinates(Ia);Ia.x=h;h=b.compressTextureCoordinates(Ia);a._instanced?(a=g._index,c(a,k,l,m,v)):(a=4*g._index,c(a+0,k+0,l,m,v),c(a+1,k+2,l,m,p),c(a+2,k+3,l,m,f),c(a+3,k+1,l,m,h))}function V(a,c,f,h,g){c=h[sa.compressedAttribute1];var l=g.alignedAxis;k.equals(l,k.ZERO)||(a._shaderAlignedAxis=!0);h=0;var p=1,q=1,u=1,w=g.translucencyByDistance;e(w)&&(h=w.near,p=w.nearValue,q=w.far,u=w.farValue,1!==p||1!==u)&&(a._shaderTranslucencyByDistance=!0);var v=0,w=g._imageIndex;if(-1!==w){f=f[w];if(!e(f))throw new d("Invalid billboard image index: "+w);v=f.width}f=Math.round(m(g.width,a._textureAtlas.texture.width*v));a._maxSize=Math.max(a._maxSize,f);f=r.clamp(f,0,65536);w=0;Math.abs(k.magnitudeSquared(l)-1)<r.EPSILON6&&(w=b.octEncodeFloat(l));p=r.clamp(p,0,1);f=256*f+(1===p?255:255*p|0);u=r.clamp(u,0,1);w=256*w+(1===u?255:255*u|0);a._instanced?(a=g._index,c(a,f,w,h,q)):(a=4*g._index,c(a+0,f,w,h,q),c(a+1,f,w,h,q),c(a+2,f,w,h,q),c(a+3,f,w,h,q))}function ba(a,b,c,f,h){f=f[sa.compressedAttribute2];var l=h.color,p=e(a._batchTable)?g.WHITE:h.getPickId(b).color;b=h.sizeInMeters?1:0;var q=Math.abs(k.magnitudeSquared(h.alignedAxis)-1)<r.EPSILON6?1:0;a._allSizedInMeters=a._allSizedInMeters&&1===b;var u=0,w=h._imageIndex;if(-1!==w){c=c[w];if(!e(c))throw new d("Invalid billboard image index: "+w);u=c.height}c=Math.round(m(h.height,a._textureAtlas.texture.dimensions.y*u));a._maxSize=Math.max(a._maxSize,c);w=m(h._labelHorizontalOrigin,-2);c=4*c+(w+2);var u=g.floatToByte(l.red),v=g.floatToByte(l.green),t=g.floatToByte(l.blue),w=65536*u+256*v+t,u=g.floatToByte(p.red),v=g.floatToByte(p.green),t=g.floatToByte(p.blue),u=65536*u+256*v+t,l=65536*g.floatToByte(l.alpha)+256*g.floatToByte(p.alpha),l=l+(2*b+q);a._instanced?(a=h._index,f(a,w,u,l,c)):(a=4*h._index,f(a+0,w,u,l,c),f(a+1,w,u,l,c),f(a+2,w,u,l,c),f(a+3,w,u,l,c))}function X(a,c,f,h,g){c=h[sa.eyeOffset];h=g.eyeOffset;var k=h.z;g._heightReference!==O.NONE&&(k*=1.005);a._maxEyeOffset=Math.max(a._maxEyeOffset,Math.abs(h.x),Math.abs(h.y),Math.abs(k));if(a._instanced){var l=a=0,m=g._imageIndex;if(-1!==m){f=f[m];if(!e(f))throw new d("Invalid billboard image index: "+m);a=f.width;l=f.height}Ia.x=a;Ia.y=l;f=b.compressTextureCoordinates(Ia);g=g._index;c(g,h.x,h.y,k,f)}else g=4*g._index,c(g+0,h.x,h.y,k,0),c(g+1,h.x,h.y,k,0),c(g+2,h.x,h.y,k,0),c(g+3,h.x,h.y,k,0)}function fa(a,b,c,d,f){b=d[sa.scaleByDistance];c=0;var h=d=1,g=1,k=f.scaleByDistance;e(k)&&(c=k.near,d=k.nearValue,h=k.far,g=k.farValue,1!==d||1!==g)&&(a._shaderScaleByDistance=!0);a._instanced?(a=f._index,b(a,c,d,h,g)):(a=4*f._index,b(a+0,c,d,h,g),b(a+1,c,d,h,g),b(a+2,c,d,h,g),b(a+3,c,d,h,g))}function F(a,b,c,d,f){b=d[sa.pixelOffsetScaleByDistance];c=0;var h=d=1,g=1,k=f.pixelOffsetScaleByDistance;e(k)&&(c=k.near,d=k.nearValue,h=k.far,g=k.farValue,1!==d||1!==g)&&(a._shaderPixelOffsetScaleByDistance=!0);a._instanced?(a=f._index,b(a,c,d,h,g)):(a=4*f._index,b(a+0,c,d,h,g),b(a+1,c,d,h,g),b(a+2,c,d,h,g),b(a+3,c,d,h,g))}function ka(a,b,c,f,h){b=f[sa.compressedAttribute3];f=0;var g=Number.MAX_VALUE,k=h.distanceDisplayCondition;e(k)&&(f=k.near,g=k.far,f*=f,g*=g,a._shaderDistanceDisplayCondition=!0);var k=h.disableDepthTestDistance,l=h.heightReference===O.CLAMP_TO_GROUND&&a._scene.context.depthTexture;e(k)||(k=l?5E3:0);k*=k;if(l||0<k)a._shaderDisableDepthDistance=!0,k===Number.POSITIVE_INFINITY&&(k=-1);if(e(h._labelDimensions))l=h._labelDimensions.x,c=h._labelDimensions.y;else{var p=l=0,q=h._imageIndex;if(-1!==q){c=c[q];if(!e(c))throw new d("Invalid billboard image index: "+q);l=c.height;p=c.width}c=Math.round(m(h.height,a._textureAtlas.texture.dimensions.y*l));l=Math.round(m(h.width,a._textureAtlas.texture.width*p))}l=Math.floor(r.clamp(l,0,4096));c=Math.floor(r.clamp(c,0,4096));c=4096*l+c;a._instanced?(a=h._index,b(a,f,g,k,c)):(a=4*h._index,b(a+0,f,g,k,c),b(a+1,f,g,k,c),b(a+2,f,g,k,c),b(a+3,f,g,k,c))}function na(a,b,c,f,h){h.heightReference===O.CLAMP_TO_GROUND&&(a._shaderClampToGround=a._scene.context.depthTexture);b=f[sa.textureCoordinateBoundsOrLabelTranslate];if(0<z.maximumVertexTextureImageUnits){var g=f=0;e(h._labelTranslate)&&(f=h._labelTranslate.x,g=h._labelTranslate.y);a._instanced?(a=h._index,b(a,f,g,0,0)):(a=4*h._index,b(a+0,f,g,0,0),b(a+1,f,g,0,0),b(a+2,f,g,0,0),b(a+3,f,g,0,0))}else{var k=g=f=0,l=0,m=h._imageIndex;if(-1!==m){c=c[m];if(!e(c))throw new d("Invalid billboard image index: "+m);f=c.x;g=c.y;k=c.width;l=c.height}c=f+k;k=g+l;a._instanced?(a=h._index,b(a,f,g,c,k)):(a=4*h._index,b(a+0,f,g,c,k),b(a+1,f,g,c,k),b(a+2,f,g,c,k),b(a+3,f,g,c,k))}}function ia(b,c,d,f,h,g){var k;f.mode===aa.SCENE3D?(k=b._baseVolume,b._boundingVolumeDirty=!0):k=b._baseVolume2D;b=[];for(var l=0;l<d;++l){var m=c[l],p=K._computeActualPosition(m,m.position,f,h);e(p)&&(m._setActualPosition(p),g?b.push(p):a.expand(k,p,k))}g&&a.fromPoints(b,k)}var la=K.SHOW_INDEX,ha=K.POSITION_INDEX,pa=K.PIXEL_OFFSET_INDEX,oa=K.EYE_OFFSET_INDEX,qa=K.HORIZONTAL_ORIGIN_INDEX,ua=K.VERTICAL_ORIGIN_INDEX,ta=K.SCALE_INDEX,wa=K.IMAGE_INDEX_INDEX,za=K.COLOR_INDEX,Da=K.ROTATION_INDEX,Ba=K.ALIGNED_AXIS_INDEX,ra=K.SCALE_BY_DISTANCE_INDEX,Ea=K.TRANSLUCENCY_BY_DISTANCE_INDEX,Ga=K.PIXEL_OFFSET_SCALE_BY_DISTANCE_INDEX,Ca=K.DISTANCE_DISPLAY_CONDITION,ya=K.DISABLE_DEPTH_DISTANCE,Aa=K.TEXTURE_COORDINATE_BOUNDS,Ua=K.NUMBER_OF_PROPERTIES,sa,Va={positionHighAndScale:0,positionLowAndRotation:1,compressedAttribute0:2,compressedAttribute1:3,compressedAttribute2:4,eyeOffset:5,scaleByDistance:6,pixelOffsetScaleByDistance:7,compressedAttribute3:8,textureCoordinateBoundsOrLabelTranslate:9,a_batchId:10},xa={direction:0,positionHighAndScale:1,positionLowAndRotation:2,compressedAttribute0:3,compressedAttribute1:4,compressedAttribute2:5,eyeOffset:6,scaleByDistance:7,pixelOffsetScaleByDistance:8,compressedAttribute3:9,textureCoordinateBoundsOrLabelTranslate:10,a_batchId:11};h(M.prototype,{length:{get:function(){Y(this);return this._billboards.length}},textureAtlas:{get:function(){return this._textureAtlas},set:function(a){this._textureAtlas!==a&&(this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy(),this._textureAtlas=a,this._createVertexArray=!0)}},destroyTextureAtlas:{get:function(){return this._destroyTextureAtlas},set:function(a){this._destroyTextureAtlas=a}}});M.prototype.add=function(a){a=new K(a,this);a._index=this._billboards.length;this._billboards.push(a);this._createVertexArray=!0;return a};M.prototype.remove=function(a){return this.contains(a)?(this._billboards[a._index]=null,this._createVertexArray=this._billboardsRemoved=!0,a._destroy(),!0):!1};M.prototype.removeAll=function(){R(this._billboards);this._billboards=[];this._billboardsToUpdate=[];this._billboardsToUpdateIndex=0;this._billboardsRemoved=!1;this._createVertexArray=!0};M.prototype._updateBillboard=function(a,b){a._dirty||(this._billboardsToUpdate[this._billboardsToUpdateIndex++]=a);++this._propertiesChanged[b]};M.prototype.contains=function(a){return e(a)&&a._billboardCollection===this};M.prototype.get=function(a){if(!e(a))throw new d("index is required.");Y(this);return this._billboards[a]};var Ha;M.prototype.computeNewBuffersUsage=function(){for(var a=this._buffersUsage,b=!1,c=this._propertiesChanged,d=0;d<Ua;++d){var e=0===c[d]?A.STATIC_DRAW:A.STREAM_DRAW,b=b||a[d]!==e;a[d]=e}return b};var Ma=new q,Ia=new f,La=1/256,Fa=[];M.prototype.update=function(b){if(!this.notUpdate){Y(this);var d=this._billboards,f=d.length,h=b.context;sa=(this._instanced=h.instancedArrays)?xa:Va;Ha=this._instanced?S:Q;var g=this._textureAtlas;if(!e(g))for(var g=this._textureAtlas=new U({context:h,sampler:new H({minificationFilter:w.NEAREST,magnificationFilter:w.NEAREST})}),k=0;k<f;++k)d[k]._loadImage();k=g.textureCoordinates;if(0!==k.length){var f=b.mode,d=this._billboards,m=this._billboardsToUpdate,p=this._modelMatrix;this._createVertexArray||this._mode!==f||f!==aa.SCENE3D&&!c.equals(p,this.modelMatrix)?(this._mode=f,c.clone(this.modelMatrix,p),this._createVertexArray=!0,f!==aa.SCENE3D&&f!==aa.SCENE2D&&f!==aa.COLUMBUS_VIEW||ia(this,d,d.length,b,p,!0)):f===aa.MORPHING?ia(this,d,d.length,b,p,!0):f!==aa.SCENE2D&&f!==aa.COLUMBUS_VIEW||ia(this,m,this._billboardsToUpdateIndex,b,p,!1);var d=this._billboards,f=d.length,d=this._billboardsToUpdate,m=this._billboardsToUpdateIndex,q=this._propertiesChanged,g=g.guid,r=this._createVertexArray||this._textureAtlasGUID!==g;this._textureAtlasGUID=g;g=b.passes;p=g.pick;if(r||!p&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(p=0;p<Ua;++p)q[p]=0;this._vaf=this._vaf&&this._vaf.destroy();if(0<f){var p=f,t=this._buffersUsage,q=this._instanced,r=this._batchTable,t=[{index:sa.positionHighAndScale,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[ha]},{index:sa.positionLowAndRotation,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[ha]},{index:sa.compressedAttribute0,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[pa]},{index:sa.compressedAttribute1,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[Ea]},{index:sa.compressedAttribute2,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[za]},{index:sa.eyeOffset,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[oa]},{index:sa.scaleByDistance,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[ra]},{index:sa.pixelOffsetScaleByDistance,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[Ga]},{index:sa.compressedAttribute3,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[Ca]},{index:sa.textureCoordinateBoundsOrLabelTranslate,componentsPerAttribute:4,componentDatatype:l.FLOAT,usage:t[Aa]}];q&&t.push({index:sa.direction,componentsPerAttribute:2,componentDatatype:l.FLOAT,vertexBuffer:ca(h)});e(r)&&t.push({index:sa.a_batchId,componentsPerAttribute:1,componentDatatyps:l.FLOAT,bufferUsage:A.STATIC_DRAW});this._vaf=new I(h,t,q?p:4*p,q);p=this._vaf.writers;for(q=0;q<f;++q){var y=this._billboards[q];y._dirty=!1;var r=h,t=k,K=p;T(this,r,t,K,y);da(this,r,t,K,y);V(this,r,t,K,y);ba(this,r,t,K,y);X(this,r,t,K,y);fa(this,r,t,K,y);F(this,r,t,K,y);ka(this,r,t,K,y);na(this,r,t,K,y);t=K;r=y;e(this._batchTable)&&(t=t[sa.a_batchId],K=r._batchIndex,this._instanced?(r=r._index,t(r,K)):(r=4*r._index,t(r+0,K),t(r+1,K),t(r+2,K),t(r+3,K)))}this._vaf.commit(Ha(h))}this._billboardsToUpdateIndex=0}else if(0<m){Fa.length=0;(q[ha]||q[Da]||q[ta])&&Fa.push(T);if(q[wa]||q[pa]||q[qa]||q[ua]||q[la])Fa.push(da),this._instanced&&Fa.push(X);if(q[wa]||q[Ba]||q[Ea])Fa.push(V),Fa.push(ba);(q[wa]||q[za])&&Fa.push(ba);q[oa]&&Fa.push(X);q[ra]&&Fa.push(fa);q[Ga]&&Fa.push(F);(q[Ca]||q[ya]||q[wa]||q[ha])&&Fa.push(ka);(q[wa]||q[ha])&&Fa.push(na);q=Fa.length;p=this._vaf.writers;if(.1<m/f){for(r=0;r<m;++r)for(t=d[r],t._dirty=!1,K=0;K<q;++K)Fa[K](this,h,k,p,t);this._vaf.commit(Ha(h))}else{for(r=0;r<m;++r){t=d[r];t._dirty=!1;for(K=0;K<q;++K)Fa[K](this,h,k,p,t);this._instanced?this._vaf.subCommit(t._index,1):this._vaf.subCommit(4*t._index,4)}this._vaf.endSubCommits()}this._billboardsToUpdateIndex=0}m>1.5*f&&(d.length=f);if(e(this._vaf)&&e(this._vaf.va)){this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,a.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));d=c.IDENTITY;b.mode===aa.SCENE3D?(d=this.modelMatrix,k=a.clone(this._baseVolumeWC,this._boundingVolume)):k=a.clone(this._baseVolume2D,this._boundingVolume);m=k;p=1;this._allSizedInMeters&&0===this._maxPixelOffset||(p=b.camera.getPixelSize(m,b.context.drawingBufferWidth,b.context.drawingBufferHeight));q=p*this._maxScale*this._maxSize*2;this._allHorizontalCenter&&this._allVerticalCenter&&(q*=.5);m.radius+=q+(p*this._maxPixelOffset+this._maxEyeOffset);p=this._blendOption!==this.blendOption;this._blendOption=this.blendOption;p&&(this._rsOpaque=this._blendOption===N.OPAQUE||this._blendOption===N.OPAQUE_AND_TRANSLUCENT?v.fromCache({depthTest:{enabled:!0,func:u.LESS},depthMask:!0}):void 0,m=this._blendOption===N.TRANSLUCENT,this._rsTranslucent=this._blendOption===N.TRANSLUCENT||this._blendOption===N.OPAQUE_AND_TRANSLUCENT?v.fromCache({depthTest:{enabled:!0,func:m?u.LEQUAL:u.LESS},depthMask:m,blending:P.ALPHA_BLEND}):void 0);this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==b.minimumDisableDepthTestDistance;m=0<z.maximumVertexTextureImageUnits;if(p||this._shaderRotation!==this._compiledShaderRotation||this._shaderAlignedAxis!==this._compiledShaderAlignedAxis||this._shaderScaleByDistance!==this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance!==this._compiledShaderTranslucencyByDistance||this._shaderPixelOffsetScaleByDistance!==this._compiledShaderPixelOffsetScaleByDistance||this._shaderDistanceDisplayCondition!==this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance||this._shaderClampToGround!==this._compiledShaderClampToGround)q=L,p=E,r=[],e(this._batchTable)&&(r.push("VECTOR_TILE"),q=this._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(q),p=this._batchTable.getFragmentShaderCallback(!1,void 0)(p)),q=new C({defines:r,sources:[q]}),this._instanced&&q.defines.push("INSTANCED"),this._shaderRotation&&q.defines.push("ROTATION"),this._shaderAlignedAxis&&q.defines.push("ALIGNED_AXIS"),this._shaderScaleByDistance&&q.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&q.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderPixelOffsetScaleByDistance&&q.defines.push("EYE_DISTANCE_PIXEL_OFFSET"),this._shaderDistanceDisplayCondition&&q.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&q.defines.push("DISABLE_DEPTH_DISTANCE"),this._shaderClampToGround&&(m?q.defines.push("VERTEX_DEPTH_CHECK"):q.defines.push("FRAGMENT_DEPTH_CHECK")),t=e(this._batchTable)?"VECTOR_TILE":"",this._blendOption===N.OPAQUE_AND_TRANSLUCENT&&(r=new C({defines:["OPAQUE",t],sources:[p]}),this._shaderClampToGround&&(m?r.defines.push("VERTEX_DEPTH_CHECK"):r.defines.push("FRAGMENT_DEPTH_CHECK")),this._sp=B.replaceCache({context:h,shaderProgram:this._sp,vertexShaderSource:q,fragmentShaderSource:r,attributeLocations:sa}),r=new C({defines:["TRANSLUCENT",t],sources:[p]}),this._shaderClampToGround&&(m?r.defines.push("VERTEX_DEPTH_CHECK"):r.defines.push("FRAGMENT_DEPTH_CHECK")),this._spTranslucent=B.replaceCache({context:h,shaderProgram:this._spTranslucent,vertexShaderSource:q,fragmentShaderSource:r,attributeLocations:sa})),this._blendOption===N.OPAQUE&&(r=new C({defines:[t],sources:[p]}),this._shaderClampToGround&&(m?r.defines.push("VERTEX_DEPTH_CHECK"):r.defines.push("FRAGMENT_DEPTH_CHECK")),this._sp=B.replaceCache({context:h,shaderProgram:this._sp,vertexShaderSource:q,fragmentShaderSource:r,attributeLocations:sa})),this._blendOption===N.TRANSLUCENT&&(r=new C({defines:[t],sources:[p]}),this._shaderClampToGround&&(m?r.defines.push("VERTEX_DEPTH_CHECK"):r.defines.push("FRAGMENT_DEPTH_CHECK")),this._spTranslucent=B.replaceCache({context:h,shaderProgram:this._spTranslucent,vertexShaderSource:q,fragmentShaderSource:r,attributeLocations:sa})),m=new C({sources:[G]}),this._disableFaxx=B.replaceCache({context:h,shaderProgram:this._disableFaxx,vertexShaderSource:q,fragmentShaderSource:m,attributeLocations:sa}),this._compiledShaderRotation=this._shaderRotation,this._compiledShaderAlignedAxis=this._shaderAlignedAxis,this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderPixelOffsetScaleByDistance=this._shaderPixelOffsetScaleByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance,this._compiledShaderClampToGround=this._shaderClampToGround;b=b.commandList;if(g.render||g.pick){h=this._colorCommands;g=this._blendOption===N.OPAQUE;m=this._blendOption===N.OPAQUE_AND_TRANSLUCENT;q=this._vaf.va;p=q.length;r=this._uniforms;e(this._batchTable)?(r=this._batchTable.getUniformMapCallback()(r),t=this._batchTable.getPickId()):t="v_pickColor";h.length=p;K=m?2*p:p;if(!this._enableFxaa&&e(this._scene)&&(p=this._scene._frameState.passes.pick,!p&&this._scene.postProcessStages.fxaa.enabled&&(y=this._scene._view.sceneFramebuffer.getDisableFramebuffer(),e(y)&&e(y._colorTextures)))){p=new x;p.pass=D.OPAQUE;p.owner=this;var M=0;p.boundingVolume=k;p.modelMatrix=d;p.count=q[M].indicesCount;p.shaderProgram=this._disableFaxx;p.uniformMap=this._uniforms;p.vertexArray=q[M].va;p.renderState=v.fromCache({depthTest:{enabled:!0,func:u.LESS},depthMask:!1});p.debugShowBoundingVolume=this.debugShowBoundingVolume;this._instanced&&(p.count=6,p.instanceCount=f);p.framebuffer=y;this._scene._view.sceneFramebuffer.addCommand(p);var M=this._scene._view.viewport.height,O=y._colorTextures[0].height;this._scene._view.viewport.width===y._colorTextures[0].width&&M===O&&b.push(p)}for(y=0;y<K;++y)p=h[y],e(p)||(p=h[y]=new x),O=g||m&&0===y%2,p.pass=O||!m?D.OPAQUE:D.TRANSLUCENT,p.owner=this,M=m?Math.floor(y/2):y,p.boundingVolume=k,p.modelMatrix=d,p.count=q[M].indicesCount,p.shaderProgram=O?this._sp:this._spTranslucent,p.uniformMap=r,p.vertexArray=q[M].va,p.renderState=O?this._rsOpaque:this._rsTranslucent,p.debugShowBoundingVolume=this.debugShowBoundingVolume,p.pickId=t,this._instanced&&(p.count=6,p.instanceCount=f),b.push(p)}}}}};M.prototype.isDestroyed=function(){return!1};M.prototype.destroy=function(){e(this._removeCallbackFunc)&&(this._removeCallbackFunc(),this._removeCallbackFunc=void 0);this._textureAtlas=this._destroyTextureAtlas&&this._textureAtlas&&this._textureAtlas.destroy();this._sp=this._sp&&this._sp.destroy();this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy();this._vaf=this._vaf&&this._vaf.destroy();R(this._billboards);return p(this)};return M});F("Scene/LabelStyle",["../Core/freezeObject"],function(b){return b({FILL:0,OUTLINE:1,FILL_AND_OUTLINE:2})});F("Scene/Label","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/freezeObject ../Core/NearFarScalar ./Billboard ./HeightReference ./HorizontalOrigin ./LabelStyle ./VerticalOrigin".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a){a._rebindAllGlyphs||a._repositionAllGlyphs||a._labelCollection._labelsToUpdate.push(a);a._rebindAllGlyphs=!0}function A(a){a._rebindAllGlyphs||a._repositionAllGlyphs||a._labelCollection._labelsToUpdate.push(a);a._repositionAllGlyphs=!0}function z(b,m){b=g(b,g.EMPTY_OBJECT);if(l(b.disableDepthTestDistance)&&0>b.disableDepthTestDistance)throw new e("disableDepthTestDistance must be greater than 0.0.");var p=b.translucencyByDistance,q=b.pixelOffsetScaleByDistance,w=b.scaleByDistance,v=b.distanceDisplayCondition;if(l(p)){if(p.far<=p.near)throw new e("translucencyByDistance.far must be greater than translucencyByDistance.near.");p=d.clone(p)}if(l(q)){if(q.far<=q.near)throw new e("pixelOffsetScaleByDistance.far must be greater than pixelOffsetScaleByDistance.near.");q=d.clone(q)}if(l(w)){if(w.far<=w.near)throw new e("scaleByDistance.far must be greater than scaleByDistance.near.");w=d.clone(w)}if(l(v)){if(v.far<=v.near)throw new e("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");v=h.clone(v)}this._text=this._renderedText=void 0;this._show=g(b.show,!0);this._font=g(b.font,"30px sans-serif");this._fillColor=k.clone(g(b.fillColor,k.WHITE));this._outlineColor=k.clone(g(b.outlineColor,k.BLACK));this._outlineWidth=g(b.outlineWidth,1);this._showBackground=g(b.showBackground,!1);this._backgroundColor=g(b.backgroundColor,new k(.165,.165,.165,.8));this._backgroundPadding=g(b.backgroundPadding,new a(7,5));this._style=g(b.style,c.FILL);this._verticalOrigin=g(b.verticalOrigin,u.BASELINE);this._horizontalOrigin=g(b.horizontalOrigin,r.LEFT);this._pixelOffset=a.clone(g(b.pixelOffset,a.ZERO));this._eyeOffset=f.clone(g(b.eyeOffset,f.ZERO));this._position=f.clone(g(b.position,f.ZERO));this._scale=g(b.scale,1);this._id=b.id;this._translucencyByDistance=p;this._pixelOffsetScaleByDistance=q;this._scaleByDistance=w;this._heightReference=g(b.heightReference,t.NONE);this._distanceDisplayCondition=v;this._disableDepthTestDistance=b.disableDepthTestDistance;this._labelCollection=m;this._glyphs=[];this._batchIndex=this._backgroundBillboard=void 0;this._repositionAllGlyphs=this._rebindAllGlyphs=!0;this._mode=this._removeCallbackFunc=this._actualClampedPosition=void 0;this._clusterShow=!0;this.text=g(b.text,"");this._updateClamping()}function x(a,b,c){return a.slice(0,b)+c+a.slice(b)}function D(a){switch(a){case "(":return")";case ")":return"(";case "[":return"]";case "]":return"[";case "{":return"}";case "}":return"{";case "\x3c":return"\x3e";case "\x3e":return"\x3c"}}var v=p({LTR:0,RTL:1,WEAK:2,BRACKETS:3});m(z.prototype,{show:{get:function(){return this._show},set:function(a){if(!l(a))throw new e("value is required.");if(this._show!==a){this._show=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var f=b[c].billboard;l(f)&&(f.show=a)}b=this._backgroundBillboard;l(b)&&(b.show=a)}}},position:{get:function(){return this._position},set:function(a){if(!l(a))throw new e("value is required.");var b=this._position;if(!f.equals(b,a)){f.clone(a,b);for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var h=b[c].billboard;l(h)&&(h.position=a)}b=this._backgroundBillboard;l(b)&&(b.position=a);this._updateClamping()}}},heightReference:{get:function(){return this._heightReference},set:function(a){if(!l(a))throw new e("value is required.");if(a!==this._heightReference){this._heightReference=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var f=b[c].billboard;l(f)&&(f.heightReference=a)}b=this._backgroundBillboard;l(b)&&(b.heightReference=a);A(this);this._updateClamping()}}},text:{get:function(){return this._text},set:function(a){if(!l(a))throw new e("value is required.");if(this._text!==a){this._text=a;if(z.enableRightToLeftDetection){a=a.split("\n");for(var b="",c=0;c<a.length;c++){for(var d=a[c],f=B.test(d.charAt(0)),h=B,g=/[a-zA-Z0-9]/,k=/[()[\]{}<>]/,m=[],p="",q=v.LTR,r="",u=d.length,t=0;t<u;++t){var C=d.charAt(t),r=h.test(C)?v.RTL:g.test(C)?v.LTR:k.test(C)?v.BRACKETS:v.WEAK;0===t&&(q=r);q===r&&r!==v.BRACKETS?p+=C:(""!==p&&m.push({Type:q,Word:p}),q=r,p=C)}m.push({Type:r,Word:p});d=m;h=0;g="";for(k=0;k<d.length;++k)if(m=d[k],p=m.Type===v.BRACKETS?D(m.Word):m.Word.split("").reverse().join(""),f)if(m.Type===v.RTL)g=p+g,h=0;else if(m.Type===v.LTR)g=x(g,h,m.Word),h+=m.Word.length;else{if(m.Type===v.WEAK||m.Type===v.BRACKETS)m.Type===v.WEAK&&d[k-1].Type===v.BRACKETS?g=p+g:d[k-1].Type===v.RTL?(g=p+g,h=0):d.length>k+1?d[k+1].Type===v.RTL?(g=p+g,h=0):(g=x(g,h,m.Word),h+=m.Word.length):g=x(g,0,p)}else if(m.Type===v.RTL)g=x(g,h,p);else if(m.Type===v.LTR)g+=m.Word,h=g.length;else if(m.Type===v.WEAK||m.Type===v.BRACKETS)0<k?d[k-1].Type===v.RTL?d.length>k+1?d[k+1].Type===v.RTL?g=x(g,h,p):(g+=m.Word,h=g.length):g+=m.Word:(g+=m.Word,h=g.length):(g+=m.Word,h=g.length);b+=g;c<a.length-1&&(b+="\n")}a=b}this._renderedText=a;y(this)}}},font:{get:function(){return this._font},set:function(a){if(!l(a))throw new e("value is required.");this._font!==a&&(this._font=a,y(this))}},fillColor:{get:function(){return this._fillColor},set:function(a){if(!l(a))throw new e("value is required.");var b=this._fillColor;k.equals(b,a)||(k.clone(a,b),y(this))}},outlineColor:{get:function(){return this._outlineColor},set:function(a){if(!l(a))throw new e("value is required.");var b=this._outlineColor;k.equals(b,a)||(k.clone(a,b),y(this))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(a){if(!l(a))throw new e("value is required.");this._outlineWidth!==a&&(this._outlineWidth=a,y(this))}},showBackground:{get:function(){return this._showBackground},set:function(a){if(!l(a))throw new e("value is required.");this._showBackground!==a&&(this._showBackground=a,y(this))}},backgroundColor:{get:function(){return this._backgroundColor},set:function(a){if(!l(a))throw new e("value is required.");var b=this._backgroundColor;k.equals(b,a)||(k.clone(a,b),a=this._backgroundBillboard,l(a)&&(a.color=b))}},backgroundPadding:{get:function(){return this._backgroundPadding},set:function(b){if(!l(b))throw new e("value is required.");var c=this._backgroundPadding;a.equals(c,b)||(a.clone(b,c),A(this))}},style:{get:function(){return this._style},set:function(a){if(!l(a))throw new e("value is required.");this._style!==a&&(this._style=a,y(this))}},pixelOffset:{get:function(){return this._pixelOffset},set:function(b){if(!l(b))throw new e("value is required.");var c=this._pixelOffset;if(!a.equals(c,b)){a.clone(b,c);for(var c=this._glyphs,d=0,f=c.length;d<f;d++){var h=c[d];l(h.billboard)&&(h.billboard.pixelOffset=b)}c=this._backgroundBillboard;l(c)&&(c.pixelOffset=b)}}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(a){if(l(a)&&a.far<=a.near)throw new e("far distance must be greater than near distance.");var b=this._translucencyByDistance;if(!d.equals(b,a)){this._translucencyByDistance=d.clone(a,b);for(var b=this._glyphs,c=0,f=b.length;c<f;c++){var h=b[c];l(h.billboard)&&(h.billboard.translucencyByDistance=a)}b=this._backgroundBillboard;l(b)&&(b.translucencyByDistance=a)}}},pixelOffsetScaleByDistance:{get:function(){return this._pixelOffsetScaleByDistance},set:function(a){if(l(a)&&a.far<=a.near)throw new e("far distance must be greater than near distance.");var b=this._pixelOffsetScaleByDistance;if(!d.equals(b,a)){this._pixelOffsetScaleByDistance=d.clone(a,b);for(var b=this._glyphs,c=0,f=b.length;c<f;c++){var h=b[c];l(h.billboard)&&(h.billboard.pixelOffsetScaleByDistance=a)}b=this._backgroundBillboard;l(b)&&(b.pixelOffsetScaleByDistance=a)}}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(a){if(l(a)&&a.far<=a.near)throw new e("far distance must be greater than near distance.");var b=this._scaleByDistance;if(!d.equals(b,a)){this._scaleByDistance=d.clone(a,b);for(var b=this._glyphs,c=0,f=b.length;c<f;c++){var h=b[c];l(h.billboard)&&(h.billboard.scaleByDistance=a)}b=this._backgroundBillboard;l(b)&&(b.scaleByDistance=a)}}},eyeOffset:{get:function(){return this._eyeOffset},set:function(a){if(!l(a))throw new e("value is required.");var b=this._eyeOffset;if(!f.equals(b,a)){f.clone(a,b);for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var h=b[c];l(h.billboard)&&(h.billboard.eyeOffset=a)}b=this._backgroundBillboard;l(b)&&(b.eyeOffset=a)}}},horizontalOrigin:{get:function(){return this._horizontalOrigin},set:function(a){if(!l(a))throw new e("value is required.");this._horizontalOrigin!==a&&(this._horizontalOrigin=a,A(this))}},verticalOrigin:{get:function(){return this._verticalOrigin},set:function(a){if(!l(a))throw new e("value is required.");if(this._verticalOrigin!==a){this._verticalOrigin=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var f=b[c];l(f.billboard)&&(f.billboard.verticalOrigin=a)}b=this._backgroundBillboard;l(b)&&(b.verticalOrigin=a);A(this)}}},scale:{get:function(){return this._scale},set:function(a){if(!l(a))throw new e("value is required.");if(this._scale!==a){this._scale=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var f=b[c];l(f.billboard)&&(f.billboard.scale=a)}b=this._backgroundBillboard;l(b)&&(b.scale=a);A(this)}}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(a){if(l(a)&&a.far<=a.near)throw new e("far must be greater than near");if(!h.equals(a,this._distanceDisplayCondition)){this._distanceDisplayCondition=h.clone(a,this._distanceDisplayCondition);for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var f=b[c];l(f.billboard)&&(f.billboard.distanceDisplayCondition=a)}b=this._backgroundBillboard;l(b)&&(b.distanceDisplayCondition=a)}}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(a){if(this._disableDepthTestDistance!==a){if(l(a)&&0>a)throw new e("disableDepthTestDistance must be greater than 0.0.");this._disableDepthTestDistance=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var f=b[c];l(f.billboard)&&(f.billboard.disableDepthTestDistance=a)}b=this._backgroundBillboard;l(b)&&(b.disableDepthTestDistance=a)}}},id:{get:function(){return this._id},set:function(a){if(this._id!==a){this._id=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var e=b[c];l(e.billboard)&&(e.billboard.id=a)}b=this._backgroundBillboard;l(b)&&(b.id=a)}}},pickId:{get:function(){if(0!==this._glyphs.length&&l(this._glyphs[0].billboard))return this._glyphs[0].billboard.pickId}},_clampedPosition:{get:function(){return this._actualClampedPosition},set:function(a){this._actualClampedPosition=f.clone(a,this._actualClampedPosition);for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var e=b[c];l(e.billboard)&&(e.billboard._clampedPosition=a)}b=this._backgroundBillboard;l(b)&&(b._clampedPosition=a)}},clusterShow:{get:function(){return this._clusterShow},set:function(a){if(this._clusterShow!==a){this._clusterShow=a;for(var b=this._glyphs,c=0,d=b.length;c<d;c++){var e=b[c];l(e.billboard)&&(e.billboard.clusterShow=a)}b=this._backgroundBillboard;l(b)&&(b.clusterShow=a)}}}});z.prototype._updateClamping=function(){q._updateClamping(this._labelCollection,this)};z.prototype.computeScreenSpacePosition=function(b,c){if(!l(b))throw new e("scene is required.");l(c)||(c=new a);var d=this._labelCollection.modelMatrix,f=l(this._actualClampedPosition)?this._actualClampedPosition:this._position;return q._computeScreenSpacePosition(d,f,this._eyeOffset,this._pixelOffset,b,c)};z.getScreenSpaceBoundingBox=function(a,c,d){var e,f,h;h=a.scale;var g=a._labelCollection._resolutionScale,k=a._backgroundBillboard;if(l(k))e=c.x+k._translate.x/g,f=c.y-k._translate.y/g,c=k.width*h,h*=k.height,a.verticalOrigin===u.BOTTOM||a.verticalOrigin===u.BASELINE?f-=h:a.verticalOrigin===u.CENTER&&(f-=.5*h);else{f=e=Number.POSITIVE_INFINITY;for(var m=0,k=0,p=a._glyphs,q=p.length,r=0;r<q;++r){var v=p[r].billboard;if(l(v)){var t=c.x+v._translate.x/g,y=c.y-v._translate.y/g,z=v.width*h,v=v.height*h;a.verticalOrigin===u.BOTTOM||a.verticalOrigin===u.BASELINE?y-=v:a.verticalOrigin===u.CENTER&&(y-=.5*v);e=Math.min(e,t);f=Math.min(f,y);m=Math.max(m,t+z);k=Math.max(k,y+v)}}c=m-e;h=k-f}l(d)||(d=new b);d.x=e;d.y=f;d.width=c;d.height=h;return d};z.prototype.equals=function(b){return this===b||l(b)&&this._show===b._show&&this._scale===b._scale&&this._outlineWidth===b._outlineWidth&&this._showBackground===b._showBackground&&this._style===b._style&&this._verticalOrigin===b._verticalOrigin&&this._horizontalOrigin===b._horizontalOrigin&&this._heightReference===b._heightReference&&this._renderedText===b._renderedText&&this._font===b._font&&f.equals(this._position,b._position)&&k.equals(this._fillColor,b._fillColor)&&k.equals(this._outlineColor,b._outlineColor)&&k.equals(this._backgroundColor,b._backgroundColor)&&a.equals(this._backgroundPadding,b._backgroundPadding)&&a.equals(this._pixelOffset,b._pixelOffset)&&f.equals(this._eyeOffset,b._eyeOffset)&&d.equals(this._translucencyByDistance,b._translucencyByDistance)&&d.equals(this._pixelOffsetScaleByDistance,b._pixelOffsetScaleByDistance)&&d.equals(this._scaleByDistance,b._scaleByDistance)&&h.equals(this._distanceDisplayCondition,b._distanceDisplayCondition)&&this._disableDepthTestDistance===b._disableDepthTestDistance&&this._id===b._id};z.prototype.isDestroyed=function(){return!1};z.enableRightToLeftDetection=!1;var B=RegExp("[\u05d0-\u05ea\u0600-\u06ff\u0750-\u077f\u08a0-\u08ff]");return z});F("Scene/LabelCollection","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Matrix4 ../Core/writeTextToCanvas ./BillboardCollection ./BlendOption ./HeightReference ./HorizontalOrigin ./Label ./LabelStyle ./TextureAtlas ../Renderer/Sampler ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ./VerticalOrigin".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){function v(){this.billboard=this.dimensions=this.textureInfo=void 0}function B(a,b,c){this.labelCollection=a;this.index=b;this.dimensions=c}function C(a,b){var c=document.createElement("canvas");c.width=G.x;c.height=G.y;var d=c.getContext("2d");d.fillStyle="#fff";d.fillRect(0,0,c.width,c.height);a.addImage("ID_WHITE_PIXEL",c).then(function(a){b._whitePixelIndex=a})}function I(a,b){b.textureInfo=void 0;b.dimensions=void 0;var c=b.billboard;g(c)&&(c.show=!1,c.image=void 0,g(c._removeCallbackFunc)&&(c._removeCallbackFunc(),c._removeCallbackFunc=void 0),a._spareBillboards.push(c),b.billboard=void 0)}function H(a,b,c,d){a.addImage(b,c).then(function(a){d.index=a})}function J(a,b){for(var c=b._glyphs,d=0,e=c.length;d<e;++d)I(a,c[d]);g(b._backgroundBillboard)&&(a._backgroundBillboardCollection.remove(b._backgroundBillboard),b._backgroundBillboard=void 0);b._labelCollection=void 0;g(b._removeCallbackFunc)&&b._removeCallbackFunc();m(b)}function w(a){a=k(a,k.EMPTY_OBJECT);this._scene=a.scene;this._batchTable=a.batchTable;this._enableFxaa=k(a.enableFxaa,!1);this._whitePixelIndex=this._backgroundTextureAtlas=this._textureAtlas=void 0;this._backgroundBillboardCollection=new d({scene:this._scene});this._backgroundBillboardCollection.destroyTextureAtlas=!1;this._billboardCollection=new d({scene:this._scene,enableFxaa:this._enableFxaa,batchTable:this._batchTable});this._billboardCollection.destroyTextureAtlas=!1;this._spareBillboards=[];this._glyphTextureCache={};this._labels=[];this._labelsToUpdate=[];this._totalGlyphCount=0;this._resolutionScale=void 0;this._highlightColor=f.clone(f.WHITE);this.modelMatrix=h.clone(k(a.modelMatrix,h.IDENTITY));this.debugShowBoundingVolume=k(a.debugShowBoundingVolume,!1);this.blendOption=k(a.blendOption,q.OPAQUE_AND_TRANSLUCENT)}var G=new a(4,4),E=new b(1,1,1,1),L={},K=new a,P=new a;l(w.prototype,{length:{get:function(){return this._labels.length}}});w.prototype.add=function(a){a=new c(a,this);this._labels.push(a);this._labelsToUpdate.push(a);return a};w.prototype.remove=function(a){if(g(a)&&a._labelCollection===this){var b=this._labels.indexOf(a);if(-1!==b)return this._labels.splice(b,1),J(this,a),!0}return!1};w.prototype.removeAll=function(){for(var a=this._labels,b=0,c=a.length;b<c;++b)J(this,a[b]);a.length=0};w.prototype.contains=function(a){return g(a)&&a._labelCollection===this};w.prototype.get=function(a){if(!g(a))throw new e("index is required.");return this._labels[a]};w.prototype.update=function(b){var c=this._billboardCollection,d=this._backgroundBillboardCollection;c.modelMatrix=this.modelMatrix;c.debugShowBoundingVolume=this.debugShowBoundingVolume;d.modelMatrix=this.modelMatrix;d.debugShowBoundingVolume=this.debugShowBoundingVolume;var e=b.context;g(this._textureAtlas)||(this._textureAtlas=new y({context:e,sampler:new A({minificationFilter:z.NEAREST,magnificationFilter:z.NEAREST})}),c.textureAtlas=this._textureAtlas);g(this._backgroundTextureAtlas)||(this._backgroundTextureAtlas=new y({context:e,initialSize:G}),d.textureAtlas=this._backgroundTextureAtlas,C(this._backgroundTextureAtlas,this));var e=e.uniformState.resolutionScale,f=this._resolutionScale!==e;this._resolutionScale=e;var h;h=f?this._labels:this._labelsToUpdate;for(var k=h.length,l=0;l<k;++l){var m=h[l];if(!m.isDestroyed()){var w=m._glyphs.length;if(m._rebindAllGlyphs){var x=m,J=x._renderedText,T;T=x.enableShiftLine?J.length:J.length?1:J.length;var N=x._glyphs,V=N.length,ba,X;if(T<V)for(X=T;X<V;++X)I(this,N[X]);N.length=T;V=x._showBackground&&0<J.split("\n").join("").length;X=x._backgroundBillboard;var fa=this._backgroundBillboardCollection;V?(g(X)||(X=fa.add({collection:this,image:"ID_WHITE_PIXEL",imageSubRegion:E}),x._backgroundBillboard=X),X.color=x._backgroundColor,X.show=x._show,X.position=x._position,X.eyeOffset=x._eyeOffset,X.pixelOffset=x._pixelOffset,X.horizontalOrigin=r.LEFT,X.verticalOrigin=x._verticalOrigin,X.heightReference=x._heightReference,X.scale=x._scale,X.pickPrimitive=x,X.id=x._id,X.translucencyByDistance=x._translucencyByDistance,X.pixelOffsetScaleByDistance=x._pixelOffsetScaleByDistance,X.scaleByDistance=x._scaleByDistance,X.distanceDisplayCondition=x._distanceDisplayCondition,X.disableDepthTestDistance=x._disableDepthTestDistance):g(X)&&(fa.remove(X),x._backgroundBillboard=void 0);X=this._glyphTextureCache;for(V=0;V<T;++V){var F;J.charAt(V);F=x.enableShiftLine?J.charAt(V):J;ba=x._font;var ka=x._fillColor,na=x._outlineColor,ia=x._outlineWidth,la=x._style,ha=x._verticalOrigin,fa=JSON.stringify([F,ba,ka.toRgba(),na.toRgba(),ia,+la,+ha]),pa=X[fa];g(pa)||(pa=F,L.font=ba,L.fillColor=ka,L.strokeColor=na,L.strokeWidth=ia,L.textBaseline=ha===D.CENTER?"middle":ha===D.TOP?"top":"bottom",L.fill=la===u.FILL||la===u.FILL_AND_OUTLINE,L.stroke=la===u.OUTLINE||la===u.FILL_AND_OUTLINE,ba=p(pa,L),pa=new B(this,-1,ba.dimensions),X[fa]=pa,0<ba.width&&0<ba.height&&H(this._textureAtlas,fa,ba,pa));ba=N[V];g(ba)?-1===pa.index?I(this,ba):g(ba.textureInfo)&&(ba.textureInfo=void 0):(ba=new v,N[V]=ba);ba.textureInfo=pa;ba.dimensions=pa.dimensions;-1!==pa.index&&(ha=ba.billboard,la=this._spareBillboards,g(ha)||(0<la.length?ha=la.pop():(ha=this._billboardCollection.add({collection:this}),ha._labelDimensions=new a,ha._labelTranslate=new a),ba.billboard=ha),ha.show=x._show,ha.position=x._position,ha.eyeOffset=x._eyeOffset,ha.pixelOffset=x._pixelOffset,ha.horizontalOrigin=r.LEFT,ha.verticalOrigin=x._verticalOrigin,ha.heightReference=x._heightReference,ha.scale=x._scale,ha.pickPrimitive=x,ha.id=x._id,ha.image=fa,ha.translucencyByDistance=x._translucencyByDistance,ha.pixelOffsetScaleByDistance=x._pixelOffsetScaleByDistance,ha.scaleByDistance=x._scaleByDistance,ha.distanceDisplayCondition=x._distanceDisplayCondition,ha.disableDepthTestDistance=x._disableDepthTestDistance,ha._batchIndex=x._batchIndex)}x._repositionAllGlyphs=!0;m._rebindAllGlyphs=!1}if(f||m._repositionAllGlyphs){N=m;V=e;x=N._glyphs;X=N._renderedText;var oa,qa,fa=ka=0;ba=[];var ha=Number.NEGATIVE_INFINITY,la=0,ua=1;T=x.length;pa=N._backgroundBillboard;ia=a.clone(g(pa)?N._backgroundPadding:a.ZERO,P);for(J=0;J<T;++J)"\n"===X.charAt(J)?(ba.push(ka),++ua,ka=0):(oa=x[J],qa=oa.dimensions,la=Math.max(la,qa.height-qa.descent),ha=Math.max(ha,qa.descent),ka+=qa.width-qa.bounds.minx,J<T-1&&(ka+=x[J+1].dimensions.bounds.minx),fa=Math.max(fa,ka));ba.push(ka);ka=la+ha;na=N._scale;F=N._horizontalOrigin;var ta=N._verticalOrigin,wa=0;oa=ba[wa];oa=F===r.CENTER?-oa/2:F===r.RIGHT?-(oa+ia.x):ia.x;var za=1.2*ka,ua=za*(ua-1),Da=fa,Ba=ka+ua;g(pa)&&(Da+=2*ia.x,Ba+=2*ia.y,pa._labelHorizontalOrigin=F);K.x=oa*na*V;for(var ra=K.y=0,J=0;J<T;++J)"\n"===X.charAt(J)?(++wa,ra+=za,oa=ba[wa],oa=F===r.CENTER?-oa/2:F===r.RIGHT?-(oa+ia.x):ia.x,K.x=oa*na*V):(oa=x[J],qa=oa.dimensions,K.y=ta===D.TOP?qa.height-la-ia.y:ta===D.CENTER?(ua+qa.height-la)/2:ta===D.BASELINE?ua:ua+ha+ia.y,K.y=(K.y-qa.descent-ra)*na*V,g(oa.billboard)&&(oa.billboard._setTranslate(K),oa.billboard._labelDimensions.x=Da,oa.billboard._labelDimensions.y=Ba,oa.billboard._labelHorizontalOrigin=F),J<T-1&&(K.x+=(qa.width-qa.bounds.minx+x[J+1].dimensions.bounds.minx)*na*V));g(pa)&&0<X.split("\n").join("").length&&(oa=F===r.CENTER?-fa/2-ia.x:F===r.RIGHT?-(fa+2*ia.x):0,K.x=oa*na*V,K.y=ta===D.TOP?ka-la-ha:ta===D.CENTER?(ka-la)/2-ha:ta===D.BASELINE?-ia.y-ha:0,K.y=K.y*na*V,pa.width=Da,pa.height=Ba,pa._setTranslate(K),pa._labelTranslate=a.clone(K,pa._labelTranslate));if(N.heightReference===t.CLAMP_TO_GROUND)for(J=0;J<T;++J)oa=x[J],N=oa.billboard,g(N)&&(N._labelTranslate=a.clone(K,N._labelTranslate));m._repositionAllGlyphs=!1}this._totalGlyphCount+=m._glyphs.length-w}}e=0<d.length?q.TRANSLUCENT:this.blendOption;c.blendOption=e;d.blendOption=e;c._highlightColor=this._highlightColor;d._highlightColor=this._highlightColor;this._labelsToUpdate.length=0;d.update(b);c.update(b)};w.prototype.isDestroyed=function(){return!1};w.prototype.destroy=function(){this.removeAll();this._billboardCollection=this._billboardCollection.destroy();this._textureAtlas=this._textureAtlas&&this._textureAtlas.destroy();this._backgroundBillboardCollection=this._backgroundBillboardCollection.destroy();this._backgroundTextureAtlas=this._backgroundTextureAtlas&&this._backgroundTextureAtlas.destroy();return m(this)};return w});F("Scene/PointPrimitive","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/Matrix4 ../Core/NearFarScalar ./SceneMode ./SceneTransforms".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a,b){a=l(a,l.EMPTY_OBJECT);if(m(a.disableDepthTestDistance)&&0>a.disableDepthTestDistance)throw new h("disableDepthTestDistance must be greater than or equal to 0.0.");var c=a.translucencyByDistance,d=a.scaleByDistance,e=a.distanceDisplayCondition;if(m(c)){if(c.far<=c.near)throw new h("translucencyByDistance.far must be greater than translucencyByDistance.near.");c=q.clone(c)}if(m(d)){if(d.far<=d.near)throw new h("scaleByDistance.far must be greater than scaleByDistance.near.");d=q.clone(d)}if(m(e)){if(e.far<=e.near)throw new h("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");e=p.clone(e)}this._show=l(a.show,!0);this._position=f.clone(l(a.position,f.ZERO));this._actualPosition=f.clone(this._position);this._color=g.clone(l(a.color,g.WHITE));this._outlineColor=g.clone(l(a.outlineColor,g.TRANSPARENT));this._outlineWidth=l(a.outlineWidth,0);this._pixelSize=l(a.pixelSize,10);this._scaleByDistance=d;this._translucencyByDistance=c;this._distanceDisplayCondition=e;this._disableDepthTestDistance=l(a.disableDepthTestDistance,0);this._id=a.id;this._collection=l(a.collection,b);this._clusterShow=!0;this._pickId=void 0;this._pointPrimitiveCollection=b;this._dirty=!1;this._index=-1}function u(a,b){var c=a._pointPrimitiveCollection;m(c)&&(c._updatePointPrimitive(a,b),a._dirty=!0)}var y=c.SHOW_INDEX=0,A=c.POSITION_INDEX=1,z=c.COLOR_INDEX=2,x=c.OUTLINE_COLOR_INDEX=3,D=c.OUTLINE_WIDTH_INDEX=4,v=c.PIXEL_SIZE_INDEX=5,B=c.SCALE_BY_DISTANCE_INDEX=6,C=c.TRANSLUCENCY_BY_DISTANCE_INDEX=7,I=c.DISTANCE_DISPLAY_CONDITION_INDEX=8,H=c.DISABLE_DEPTH_DISTANCE_INDEX=9;c.NUMBER_OF_PROPERTIES=10;e(c.prototype,{show:{get:function(){return this._show},set:function(a){if(!m(a))throw new h("value is required.");this._show!==a&&(this._show=a,u(this,y))}},position:{get:function(){return this._position},set:function(a){if(!m(a))throw new h("value is required.");var b=this._position;f.equals(b,a)||(f.clone(a,b),f.clone(a,this._actualPosition),u(this,A))}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(a){if(m(a)&&a.far<=a.near)throw new h("far distance must be greater than near distance.");var b=this._scaleByDistance;q.equals(b,a)||(this._scaleByDistance=q.clone(a,b),u(this,B))}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(a){if(m(a)&&a.far<=a.near)throw new h("far distance must be greater than near distance.");var b=this._translucencyByDistance;q.equals(b,a)||(this._translucencyByDistance=q.clone(a,b),u(this,C))}},pixelSize:{get:function(){return this._pixelSize},set:function(a){if(!m(a))throw new h("value is required.");this._pixelSize!==a&&(this._pixelSize=a,u(this,v))}},color:{get:function(){return this._color},set:function(a){if(!m(a))throw new h("value is required.");var b=this._color;g.equals(b,a)||(g.clone(a,b),u(this,z))}},outlineColor:{get:function(){return this._outlineColor},set:function(a){if(!m(a))throw new h("value is required.");var b=this._outlineColor;g.equals(b,a)||(g.clone(a,b),u(this,x))}},outlineWidth:{get:function(){return this._outlineWidth},set:function(a){if(!m(a))throw new h("value is required.");this._outlineWidth!==a&&(this._outlineWidth=a,u(this,D))}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(a){if(m(a)&&a.far<=a.near)throw new h("far must be greater than near");p.equals(this._distanceDisplayCondition,a)||(this._distanceDisplayCondition=p.clone(a,this._distanceDisplayCondition),u(this,I))}},disableDepthTestDistance:{get:function(){return this._disableDepthTestDistance},set:function(a){if(this._disableDepthTestDistance!==a){if(!m(a)||0>a)throw new h("disableDepthTestDistance must be greater than or equal to 0.0.");this._disableDepthTestDistance=a;u(this,H)}}},id:{get:function(){return this._id},set:function(a){this._id=a;m(this._pickId)&&(this._pickId.object.id=a)}},pickId:{get:function(){return this._pickId}},clusterShow:{get:function(){return this._clusterShow},set:function(a){this._clusterShow!==a&&(this._clusterShow=a,u(this,y))}}});c.prototype.getPickId=function(a){m(this._pickId)||(this._pickId=a.createPickId({primitive:this,collection:this._collection,id:this._id}));return this._pickId};c.prototype._getActualPosition=function(){return this._actualPosition};c.prototype._setActualPosition=function(a){f.clone(a,this._actualPosition);u(this,A)};var J=new k;c._computeActualPosition=function(a,b,c){if(b.mode===t.SCENE3D)return a;d.multiplyByPoint(c,a,J);return r.computeActualWgs84Position(b,J)};var w=new k;c._computeScreenSpacePosition=function(a,b,c,e){a=d.multiplyByVector(a,k.fromElements(b.x,b.y,b.z,1,w),w);return r.wgs84ToWindowCoordinates(c,a,e)};c.prototype.computeScreenSpacePosition=function(b,d){var e=this._pointPrimitiveCollection;m(d)||(d=new a);if(!m(e))throw new h("PointPrimitive must be in a collection.");if(!m(b))throw new h("scene is required.");e=c._computeScreenSpacePosition(e.modelMatrix,this._actualPosition,b,d);if(m(e))return e.y=b.canvas.clientHeight-e.y,e};c.getScreenSpaceBoundingBox=function(a,c,d){a=a.pixelSize;var e=.5*a,f=c.x-e;c=c.y-e;m(d)||(d=new b);d.x=f;d.y=c;d.width=a;d.height=a;return d};c.prototype.equals=function(a){return this===a||m(a)&&this._id===a._id&&f.equals(this._position,a._position)&&g.equals(this._color,a._color)&&this._pixelSize===a._pixelSize&&this._outlineWidth===a._outlineWidth&&this._show===a._show&&g.equals(this._outlineColor,a._outlineColor)&&q.equals(this._scaleByDistance,a._scaleByDistance)&&q.equals(this._translucencyByDistance,a._translucencyByDistance)&&p.equals(this._distanceDisplayCondition,a._distanceDisplayCondition)&&this._disableDepthTestDistance===a._disableDepthTestDistance};c.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy();this._pointPrimitiveCollection=void 0};return c});F("Shaders/PointPrimitiveCollectionFS",[],function(){return"varying vec4 v_color;\nvarying vec4 v_outlineColor;\nvarying float v_innerPercent;\nvarying float v_pixelDistance;\nvarying vec4 v_pickColor;\nvoid main()\n{\nfloat distanceToCenter \x3d length(gl_PointCoord - vec2(0.5));\nfloat maxDistance \x3d max(0.0, 0.5 - v_pixelDistance);\nfloat wholeAlpha \x3d 1.0 - smoothstep(maxDistance, 0.5, distanceToCenter);\nfloat innerAlpha \x3d 1.0 - smoothstep(maxDistance * v_innerPercent, 0.5 * v_innerPercent, distanceToCenter);\nvec4 color \x3d mix(v_outlineColor, v_color, innerAlpha);\ncolor.a *\x3d wholeAlpha;\n#if !defined(OPAQUE) \x26\x26 !defined(TRANSLUCENT)\nif (color.a \x3c 0.005)\n{\ndiscard;\n}\n#else\n#ifdef OPAQUE\nif (color.a \x3c 0.995)\n{\ndiscard;\n}\n#else\nif (color.a \x3e\x3d 0.995)\n{\ndiscard;\n}\n#endif\n#endif\ngl_FragColor \x3d czm_gammaCorrect(color);\nczm_writeLogDepth();\n}\n"});F("Shaders/PointPrimitiveCollectionVS",[],function(){return"uniform float u_maxTotalPointSize;\nattribute vec4 positionHighAndSize;\nattribute vec4 positionLowAndOutline;\nattribute vec4 compressedAttribute0;\nattribute vec4 compressedAttribute1;\nattribute vec4 scaleByDistance;\nattribute vec3 distanceDisplayConditionAndDisableDepth;\nvarying vec4 v_color;\nvarying vec4 v_outlineColor;\nvarying float v_innerPercent;\nvarying float v_pixelDistance;\nvarying vec4 v_pickColor;\nconst float SHIFT_LEFT8 \x3d 256.0;\nconst float SHIFT_RIGHT8 \x3d 1.0 / 256.0;\nvoid main()\n{\nvec3 positionHigh \x3d positionHighAndSize.xyz;\nvec3 positionLow \x3d positionLowAndOutline.xyz;\nfloat outlineWidthBothSides \x3d 2.0 * positionLowAndOutline.w;\nfloat totalSize \x3d positionHighAndSize.w + outlineWidthBothSides;\nfloat outlinePercent \x3d outlineWidthBothSides / totalSize;\ntotalSize *\x3d czm_resolutionScale;\ntotalSize +\x3d 3.0;\nfloat temp \x3d compressedAttribute1.x * SHIFT_RIGHT8;\nfloat show \x3d floor(temp);\n#ifdef EYE_DISTANCE_TRANSLUCENCY\nvec4 translucencyByDistance;\ntranslucencyByDistance.x \x3d compressedAttribute1.z;\ntranslucencyByDistance.z \x3d compressedAttribute1.w;\ntranslucencyByDistance.y \x3d ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\ntemp \x3d compressedAttribute1.y * SHIFT_RIGHT8;\ntranslucencyByDistance.w \x3d ((temp - floor(temp)) * SHIFT_LEFT8) / 255.0;\n#endif\nvec4 color;\nvec4 outlineColor;\nvec4 pickColor;\ntemp \x3d compressedAttribute0.z * SHIFT_RIGHT8;\npickColor.b \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\npickColor.g \x3d (temp - floor(temp)) * SHIFT_LEFT8;\npickColor.r \x3d floor(temp);\ntemp \x3d compressedAttribute0.x * SHIFT_RIGHT8;\ncolor.b \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\ncolor.g \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ncolor.r \x3d floor(temp);\ntemp \x3d compressedAttribute0.y * SHIFT_RIGHT8;\noutlineColor.b \x3d (temp - floor(temp)) * SHIFT_LEFT8;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\noutlineColor.g \x3d (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor.r \x3d floor(temp);\ntemp \x3d compressedAttribute0.w * SHIFT_RIGHT8;\npickColor.a \x3d (temp - floor(temp)) * SHIFT_LEFT8;\npickColor \x3d pickColor / 255.0;\ntemp \x3d floor(temp) * SHIFT_RIGHT8;\noutlineColor.a \x3d (temp - floor(temp)) * SHIFT_LEFT8;\noutlineColor /\x3d 255.0;\ncolor.a \x3d floor(temp);\ncolor /\x3d 255.0;\nvec4 p \x3d czm_translateRelativeToEye(positionHigh, positionLow);\nvec4 positionEC \x3d czm_modelViewRelativeToEye * p;\npositionEC.xyz *\x3d show;\n#if defined(EYE_DISTANCE_SCALING) || defined(EYE_DISTANCE_TRANSLUCENCY) || defined(DISTANCE_DISPLAY_CONDITION) || defined(DISABLE_DEPTH_DISTANCE)\nfloat lengthSq;\nif (czm_sceneMode \x3d\x3d czm_sceneMode2D)\n{\nlengthSq \x3d czm_eyeHeight2D.y;\n}\nelse\n{\nlengthSq \x3d dot(positionEC.xyz, positionEC.xyz);\n}\n#endif\n#ifdef EYE_DISTANCE_SCALING\ntotalSize *\x3d czm_nearFarScalar(scaleByDistance, lengthSq);\n#endif\ntotalSize \x3d min(totalSize, u_maxTotalPointSize);\nif (totalSize \x3c 1.0)\n{\npositionEC.xyz \x3d vec3(0.0);\ntotalSize \x3d 1.0;\n}\nfloat translucency \x3d 1.0;\n#ifdef EYE_DISTANCE_TRANSLUCENCY\ntranslucency \x3d czm_nearFarScalar(translucencyByDistance, lengthSq);\nif (translucency \x3c 0.004)\n{\npositionEC.xyz \x3d vec3(0.0);\n}\n#endif\n#ifdef DISTANCE_DISPLAY_CONDITION\nfloat nearSq \x3d distanceDisplayConditionAndDisableDepth.x;\nfloat farSq \x3d distanceDisplayConditionAndDisableDepth.y;\nif (lengthSq \x3c nearSq || lengthSq \x3e farSq) {\npositionEC.xyz \x3d vec3(0.0);\n}\n#endif\ngl_Position \x3d czm_projection * positionEC;\nczm_vertexLogDepth();\n#ifdef DISABLE_DEPTH_DISTANCE\nfloat disableDepthTestDistance \x3d distanceDisplayConditionAndDisableDepth.z;\nif (disableDepthTestDistance \x3d\x3d 0.0 \x26\x26 czm_minimumDisableDepthTestDistance !\x3d 0.0)\n{\ndisableDepthTestDistance \x3d czm_minimumDisableDepthTestDistance;\n}\nif (disableDepthTestDistance !\x3d 0.0)\n{\nfloat zclip \x3d gl_Position.z / gl_Position.w;\nbool clipped \x3d (zclip \x3c -1.0 || zclip \x3e 1.0);\nif (!clipped \x26\x26 (disableDepthTestDistance \x3c 0.0 || (lengthSq \x3e 0.0 \x26\x26 lengthSq \x3c disableDepthTestDistance)))\n{\ngl_Position.z \x3d -gl_Position.w;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(vec4(czm_currentFrustum.x));\n#endif\n}\n}\n#endif\nv_color \x3d color;\nv_color.a *\x3d translucency;\nv_outlineColor \x3d outlineColor;\nv_outlineColor.a *\x3d translucency;\nv_innerPercent \x3d 1.0 - outlinePercent;\nv_pixelDistance \x3d 2.0 / totalSize;\ngl_PointSize \x3d totalSize;\nv_pickColor \x3d pickColor;\n}\n"});F("Scene/PointPrimitiveCollection","../Core/BoundingSphere ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/Math ../Core/Matrix4 ../Core/PrimitiveType ../Core/WebGLConstants ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArrayFacade ../Shaders/PointPrimitiveCollectionFS ../Shaders/PointPrimitiveCollectionVS ./BlendingState ./BlendOption ./PointPrimitive ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a){a=k(a,k.EMPTY_OBJECT);this._vaf=this._rsTranslucent=this._rsOpaque=this._spTranslucent=this._sp=void 0;this._pointPrimitives=[];this._pointPrimitivesToUpdate=[];this._pointPrimitivesToUpdateIndex=0;this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance=this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition=this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance=this._compiledShaderScaleByDistance=this._shaderScaleByDistance=this._createVertexArray=this._pointPrimitivesRemoved=!1;this._propertiesChanged=new Uint32Array(da);this._maxPixelSize=1;this._baseVolume=new b;this._baseVolumeWC=new b;this._baseVolume2D=new b;this._boundingVolume=new b;this._boundingVolumeDirty=!1;this._colorCommands=[];this.modelMatrix=d.clone(k(a.modelMatrix,d.IDENTITY));this._modelMatrix=d.clone(d.IDENTITY);this.debugShowBoundingVolume=k(a.debugShowBoundingVolume,!1);this.blendOption=k(a.blendOption,I.OPAQUE_AND_TRANSLUCENT);this._blendOption=void 0;this._mode=J.SCENE3D;this._maxTotalPointSize=1;this._buffersUsage=[r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW,r.STATIC_DRAW];var c=this;this._uniforms={u_maxTotalPointSize:function(){return c._maxTotalPointSize}}}function G(a){for(var b=a.length,c=0;c<b;++c)a[c]&&a[c]._destroy()}function E(a){if(a._pointPrimitivesRemoved){a._pointPrimitivesRemoved=!1;for(var b=[],c=a._pointPrimitives,d=c.length,e=0,f=0;e<d;++e){var h=c[e];h&&(h._index=f++,b.push(h))}a._pointPrimitives=b}}function L(a,c,d,e){c=e._index;var f=e._getActualPosition();a._mode===J.SCENE3D&&(b.expand(a._baseVolume,f,a._baseVolume),a._boundingVolumeDirty=!0);h.fromCartesian(f,ba);f=e.pixelSize;e=e.outlineWidth;a._maxPixelSize=Math.max(a._maxPixelSize,f+e);a=ba.high;(0,d[V.positionHighAndSize])(c,a.x,a.y,a.z,f);a=ba.low;(0,d[V.positionLowAndOutline])(c,a.x,a.y,a.z,e)}function K(b,c,d,e){b=e._index;var f=e.color;c=e.getPickId(c).color;var h=e.outlineColor,g=a.floatToByte(f.red),k=a.floatToByte(f.green),l=a.floatToByte(f.blue);e=65536*g+256*k+l;var g=a.floatToByte(h.red),k=a.floatToByte(h.green),l=a.floatToByte(h.blue),m=65536*g+256*k+l,g=a.floatToByte(c.red),k=a.floatToByte(c.green),l=a.floatToByte(c.blue),g=65536*g+256*k+l,f=65536*a.floatToByte(f.alpha)+256*a.floatToByte(h.alpha)+a.floatToByte(c.alpha);(0,d[V.compressedAttribute0])(b,e,m,g,f)}function P(a,b,c,d){b=d._index;var e=0,f=1,h=1,k=1,l=d.translucencyByDistance;g(l)&&(e=l.near,f=l.nearValue,h=l.far,k=l.farValue,1!==f||1!==k)&&(a._shaderTranslucencyByDistance=!0);a=d.show&&d.clusterShow;0===d.color.alpha&&0===d.outlineColor.alpha&&(a=!1);f=p.clamp(f,0,1);d=256*(a?1:0)+(1===f?255:255*f|0);k=p.clamp(k,0,1);(0,c[V.compressedAttribute1])(b,d,1===k?255:255*k|0,e,h)}function N(a,b,c,d){b=d._index;c=c[V.scaleByDistance];var e=0,f=1,h=1,k=1;d=d.scaleByDistance;g(d)&&(e=d.near,f=d.nearValue,h=d.far,k=d.farValue,1!==f||1!==k)&&(a._shaderScaleByDistance=!0);c(b,e,f,h,k)}function O(a,b,c,d){b=d._index;c=c[V.distanceDisplayConditionAndDisableDepth];var e=0,f=Number.MAX_VALUE,h=d.distanceDisplayCondition;g(h)&&(e=h.near,f=h.far,e*=e,f*=f,a._shaderDistanceDisplayCondition=!0);d=d.disableDepthTestDistance;d*=d;0<d&&(a._shaderDisableDepthDistance=!0,d===Number.POSITIVE_INFINITY&&(d=-1));c(b,e,f,d)}function Z(a,c,d,e,f,h){var k;e.mode===J.SCENE3D?(k=a._baseVolume,a._boundingVolumeDirty=!0):k=a._baseVolume2D;a=[];for(var l=0;l<d;++l){var m=c[l],p=H._computeActualPosition(m.position,e,f);g(p)&&(m._setActualPosition(p),h?a.push(p):b.expand(k,p,k))}h&&b.fromPoints(a,k)}var aa=H.SHOW_INDEX,U=H.POSITION_INDEX,W=H.COLOR_INDEX,M=H.OUTLINE_COLOR_INDEX,R=H.OUTLINE_WIDTH_INDEX,Y=H.PIXEL_SIZE_INDEX,Q=H.SCALE_BY_DISTANCE_INDEX,S=H.TRANSLUCENCY_BY_DISTANCE_INDEX,ca=H.DISTANCE_DISPLAY_CONDITION_INDEX,T=H.DISABLE_DEPTH_DISTANCE_INDEX,da=H.NUMBER_OF_PROPERTIES,V={positionHighAndSize:0,positionLowAndOutline:1,compressedAttribute0:2,compressedAttribute1:3,scaleByDistance:4,distanceDisplayConditionAndDisableDepth:5};l(w.prototype,{length:{get:function(){E(this);return this._pointPrimitives.length}}});w.prototype.add=function(a){a=new H(a,this);a._index=this._pointPrimitives.length;this._pointPrimitives.push(a);this._createVertexArray=!0;return a};w.prototype.remove=function(a){return this.contains(a)?(this._pointPrimitives[a._index]=null,this._createVertexArray=this._pointPrimitivesRemoved=!0,a._destroy(),!0):!1};w.prototype.removeAll=function(){G(this._pointPrimitives);this._pointPrimitives=[];this._pointPrimitivesToUpdate=[];this._pointPrimitivesToUpdateIndex=0;this._pointPrimitivesRemoved=!1;this._createVertexArray=!0};w.prototype._updatePointPrimitive=function(a,b){a._dirty||(this._pointPrimitivesToUpdate[this._pointPrimitivesToUpdateIndex++]=a);++this._propertiesChanged[b]};w.prototype.contains=function(a){return g(a)&&a._pointPrimitiveCollection===this};w.prototype.get=function(a){if(!g(a))throw new e("index is required.");E(this);return this._pointPrimitives[a]};w.prototype.computeNewBuffersUsage=function(){for(var a=this._buffersUsage,b=!1,c=this._propertiesChanged,d=0;d<da;++d){var e=0===c[d]?r.STATIC_DRAW:r.STREAM_DRAW,b=b||a[d]!==e;a[d]=e}return b};var ba=new h,X=[];w.prototype.update=function(a){E(this);this._maxTotalPointSize=c.maximumAliasedPointSize;var e=a.mode,h=this._pointPrimitives,k=this._pointPrimitivesToUpdate,l=this._modelMatrix;this._createVertexArray||this._mode!==e||e!==J.SCENE3D&&!d.equals(l,this.modelMatrix)?(this._mode=e,d.clone(this.modelMatrix,l),this._createVertexArray=!0,e!==J.SCENE3D&&e!==J.SCENE2D&&e!==J.COLUMBUS_VIEW||Z(this,h,h.length,a,l,!0)):e===J.MORPHING?Z(this,h,h.length,a,l,!0):e!==J.SCENE2D&&e!==J.COLUMBUS_VIEW||Z(this,k,this._pointPrimitivesToUpdateIndex,a,l,!1);var l=this._pointPrimitives.length,m=this._pointPrimitivesToUpdate,p=this._pointPrimitivesToUpdateIndex,r=this._propertiesChanged,k=a.context,e=a.passes,h=e.pick;if(this._createVertexArray||!h&&this.computeNewBuffersUsage()){this._createVertexArray=!1;for(var w=0;w<da;++w)r[w]=0;this._vaf=this._vaf&&this._vaf.destroy();if(0<l){r=this._buffersUsage;this._vaf=new D(k,[{index:V.positionHighAndSize,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:r[U]},{index:V.positionLowAndShow,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:r[U]},{index:V.compressedAttribute0,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:r[W]},{index:V.compressedAttribute1,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:r[S]},{index:V.scaleByDistance,componentsPerAttribute:4,componentDatatype:f.FLOAT,usage:r[Q]},{index:V.distanceDisplayConditionAndDisableDepth,componentsPerAttribute:3,componentDatatype:f.FLOAT,usage:r[ca]}],l);r=this._vaf.writers;for(w=0;w<l;++w){var G=this._pointPrimitives[w];G._dirty=!1;var H=k,ba=r;L(this,H,ba,G);K(this,H,ba,G);P(this,H,ba,G);N(this,H,ba,G);O(this,H,ba,G)}this._vaf.commit()}this._pointPrimitivesToUpdateIndex=0}else if(0<p){X.length=0;(r[U]||r[R]||r[Y])&&X.push(L);(r[W]||r[M])&&X.push(K);(r[aa]||r[S])&&X.push(P);r[Q]&&X.push(N);(r[ca]||r[T])&&X.push(O);w=X.length;r=this._vaf.writers;if(.1<p/l){for(H=0;H<p;++H)for(ba=m[H],ba._dirty=!1,G=0;G<w;++G)X[G](this,k,r,ba);this._vaf.commit()}else{for(H=0;H<p;++H){ba=m[H];ba._dirty=!1;for(G=0;G<w;++G)X[G](this,k,r,ba);this._vaf.subCommit(ba._index,1)}this._vaf.endSubCommits()}this._pointPrimitivesToUpdateIndex=0}p>1.5*l&&(m.length=l);if(g(this._vaf)&&g(this._vaf.va)){this._boundingVolumeDirty&&(this._boundingVolumeDirty=!1,b.transform(this._baseVolume,this.modelMatrix,this._baseVolumeWC));m=d.IDENTITY;a.mode===J.SCENE3D?(m=this.modelMatrix,l=b.clone(this._baseVolumeWC,this._boundingVolume)):l=b.clone(this._baseVolume2D,this._boundingVolume);p=l;r=a.camera.getPixelSize(p,a.context.drawingBufferWidth,a.context.drawingBufferHeight)*this._maxPixelSize;p.radius+=r;p=this._blendOption!==this.blendOption;this._blendOption=this.blendOption;p&&(this._rsOpaque=this._blendOption===I.OPAQUE||this._blendOption===I.OPAQUE_AND_TRANSLUCENT?A.fromCache({depthTest:{enabled:!0,func:t.LEQUAL},depthMask:!0}):void 0,this._rsTranslucent=this._blendOption===I.TRANSLUCENT||this._blendOption===I.OPAQUE_AND_TRANSLUCENT?A.fromCache({depthTest:{enabled:!0,func:t.LEQUAL},depthMask:!1,blending:C.ALPHA_BLEND}):void 0);this._shaderDisableDepthDistance=this._shaderDisableDepthDistance||0!==a.minimumDisableDepthTestDistance;if(p||this._shaderScaleByDistance&&!this._compiledShaderScaleByDistance||this._shaderTranslucencyByDistance&&!this._compiledShaderTranslucencyByDistance||this._shaderDistanceDisplayCondition&&!this._compiledShaderDistanceDisplayCondition||this._shaderDisableDepthDistance!==this._compiledShaderDisableDepthDistance)p=new x({sources:[B]}),this._shaderScaleByDistance&&p.defines.push("EYE_DISTANCE_SCALING"),this._shaderTranslucencyByDistance&&p.defines.push("EYE_DISTANCE_TRANSLUCENCY"),this._shaderDistanceDisplayCondition&&p.defines.push("DISTANCE_DISPLAY_CONDITION"),this._shaderDisableDepthDistance&&p.defines.push("DISABLE_DEPTH_DISTANCE"),this._blendOption===I.OPAQUE_AND_TRANSLUCENT&&(r=new x({defines:["OPAQUE"],sources:[v]}),this._sp=z.replaceCache({context:k,shaderProgram:this._sp,vertexShaderSource:p,fragmentShaderSource:r,attributeLocations:V}),r=new x({defines:["TRANSLUCENT"],sources:[v]}),this._spTranslucent=z.replaceCache({context:k,shaderProgram:this._spTranslucent,vertexShaderSource:p,fragmentShaderSource:r,attributeLocations:V})),this._blendOption===I.OPAQUE&&(r=new x({sources:[v]}),this._sp=z.replaceCache({context:k,shaderProgram:this._sp,vertexShaderSource:p,fragmentShaderSource:r,attributeLocations:V})),this._blendOption===I.TRANSLUCENT&&(r=new x({sources:[v]}),this._spTranslucent=z.replaceCache({context:k,shaderProgram:this._spTranslucent,vertexShaderSource:p,fragmentShaderSource:r,attributeLocations:V})),this._compiledShaderScaleByDistance=this._shaderScaleByDistance,this._compiledShaderTranslucencyByDistance=this._shaderTranslucencyByDistance,this._compiledShaderDistanceDisplayCondition=this._shaderDistanceDisplayCondition,this._compiledShaderDisableDepthDistance=this._shaderDisableDepthDistance;a=a.commandList;if(e.render||h)for(h=this._colorCommands,k=this._blendOption===I.OPAQUE,p=this._blendOption===I.OPAQUE_AND_TRANSLUCENT,e=this._vaf.va,r=e.length,h.length=r,H=p?2*r:r,w=0;w<H;++w)ba=k||p&&0===w%2,r=h[w],g(r)||(r=h[w]=new u),r.primitiveType=q.POINTS,r.pass=ba||!p?y.OPAQUE:y.TRANSLUCENT,r.owner=this,G=p?Math.floor(w/2):w,r.boundingVolume=l,r.modelMatrix=m,r.shaderProgram=ba?this._sp:this._spTranslucent,r.uniformMap=this._uniforms,r.vertexArray=e[G].va,r.renderState=ba?this._rsOpaque:this._rsTranslucent,r.debugShowBoundingVolume=this.debugShowBoundingVolume,r.pickId="v_pickColor",a.push(r)}};w.prototype.isDestroyed=function(){return!1};w.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy();this._spTranslucent=this._spTranslucent&&this._spTranslucent.destroy();this._spPick=this._spPick&&this._spPick.destroy();this._vaf=this._vaf&&this._vaf.destroy();G(this._pointPrimitives);return m(this)};return w});F("ThirdParty/kdbush",[],function(){function b(b,h,g,d,l){h=h||a;g=g||f;l=l||Array;this.nodeSize=d||64;this.points=b;this.ids=new l(b.length);this.coords=new l(2*b.length);for(d=0;d<b.length;d++)this.ids[d]=d,this.coords[2*d]=h(b[d]),this.coords[2*d+1]=g(b[d]);k(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function a(a){return a[0]}function f(a){return a[1]}function k(a,b,f,d,l,m){if(!(l-d<=f)){var e=Math.floor((d+l)/2);g(a,b,e,d,l,m%2);k(a,b,f,d,e-1,m+1);k(a,b,f,e+1,l,m+1)}}function g(a,b,f,d,k,m){for(;k>d;){if(600<k-d){var e=k-d+1,c=f-d+1,h=Math.log(e),p=.5*Math.exp(2*h/3),h=.5*Math.sqrt(h*p*(e-p)/e)*(0>c-e/2?-1:1);g(a,b,f,Math.max(d,Math.floor(f-c*p/e+h)),Math.min(k,Math.floor(f+(e-c)*p/e+h)),m)}e=b[2*f+m];c=d;p=k;l(a,b,d,f);for(b[2*k+m]>e&&l(a,b,d,k);c<p;){l(a,b,c,p);c++;for(p--;b[2*c+m]<e;)c++;for(;b[2*p+m]>e;)p--}b[2*d+m]===e?l(a,b,d,p):(p++,l(a,b,p,k));p<=f&&(d=p+1);f<=p&&(k=p-1)}}function l(a,b,f,d){m(a,f,d);m(b,2*f,2*d);m(b,2*f+1,2*d+1)}function m(a,b,f){var d=a[b];a[b]=a[f];a[f]=d}b.prototype={range:function(a,b,f,d){for(var e=this.ids,h=this.coords,g=this.nodeSize,c=[0,e.length-1,0],k=[],l,m;c.length;){var p=c.pop(),x=c.pop(),D=c.pop();if(x-D<=g)for(p=D;p<=x;p++)l=h[2*p],m=h[2*p+1],l>=a&&l<=f&&m>=b&&m<=d&&k.push(e[p]);else{var v=Math.floor((D+x)/2);l=h[2*v];m=h[2*v+1];l>=a&&l<=f&&m>=b&&m<=d&&k.push(e[v]);var B=(p+1)%2;if(0===p?a<=l:b<=m)c.push(D),c.push(v-1),c.push(B);if(0===p?f>=l:d>=m)c.push(v+1),c.push(x),c.push(B)}}return k},within:function(a,b,f){for(var d=this.ids,e=this.coords,h=this.nodeSize,g=[0,d.length-1,0],c=[],k=f*f;g.length;){var l=g.pop(),m=g.pop(),p=g.pop();if(m-p<=h)for(l=p;l<=m;l++){var p=e[2*l]-a,x=e[2*l+1]-b;p*p+x*x<=k&&c.push(d[l])}else{var x=Math.floor((p+m)/2),D=e[2*x],v=e[2*x+1],B=D-a,C=v-b;B*B+C*C<=k&&c.push(d[x]);B=(l+1)%2;if(0===l?a-f<=D:b-f<=v)g.push(p),g.push(x-1),g.push(B);if(0===l?a+f>=D:b+f>=v)g.push(x+1),g.push(m),g.push(B)}}return c}};return function(a,f,g,d,k){return new b(a,f,g,d,k)}});F("DataSources/EntityCluster","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/EllipsoidalOccluder ../Core/Event ../Core/Matrix4 ../Scene/Billboard ../Scene/BillboardCollection ../Scene/Label ../Scene/LabelCollection ../Scene/PointPrimitive ../Scene/PointPrimitiveCollection ../Scene/SceneMode ../ThirdParty/kdbush".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=k(a,k.EMPTY_OBJECT);this._enabled=k(a.enabled,!1);this._pixelRange=k(a.pixelRange,80);this._minimumClusterSize=k(a.minimumClusterSize,2);this._clusterBillboards=k(a.clusterBillboards,!0);this._clusterLabels=k(a.clusterLabels,!0);this._clusterPoints=k(a.clusterPoints,!0);this._clusterPointCollection=this._clusterLabelCollection=this._clusterBillboardCollection=this._pointCollection=this._billboardCollection=this._labelCollection=void 0;this._collectionIndicesByEntity={};this._unusedLabelIndices=[];this._unusedBillboardIndices=[];this._unusedPointIndices=[];this._previousClusters=[];this._previousHeight=void 0;this._clusterDirty=this._enabledDirty=!1;this._removeEventListener=this._cluster=void 0;this._clusterEvent=new e}function z(a){return a.coord.x}function x(a){return a.coord.y}function D(a,b){a.x-=b;a.y-=b;a.width+=2*b;a.height+=2*b}function v(a,c,d,e,f){g(a._labelCollection)&&e._clusterLabels?f=q.getScreenSpaceBoundingBox(a,c,f):g(a._billboardCollection)&&e._clusterBillboards?f=p.getScreenSpaceBoundingBox(a,c,f):g(a._pointPrimitiveCollection)&&e._clusterPoints&&(f=r.getScreenSpaceBoundingBox(a,c,f));D(f,d);e._clusterLabels&&!g(a._labelCollection)&&g(a.id)&&C(e,a.id)&&g(a.id._label)&&(a=e._labelCollection.get(e._collectionIndicesByEntity[a.id]),c=q.getScreenSpaceBoundingBox(a,c,E),D(c,d),f=b.union(f,c,f));return f}function B(a,b,c,d){var e={billboard:d._clusterBillboardCollection.add(),label:d._clusterLabelCollection.add(),point:d._clusterPointCollection.add()};e.billboard.show=!1;e.point.show=!1;e.label.show=!0;e.label.text=b.toLocaleString();e.label.id=c;e.billboard.position=e.label.position=e.point.position=a;d._clusterEvent.raiseEvent(c,e)}function C(a,b){return g(a)&&g(a._collectionIndicesByEntity[b])&&g(a._collectionIndicesByEntity[b].labelIndex)}function I(a,b,c,d,e){if(g(a))for(var f=a.length,h=0;h<f;++h){var k=a.get(h);k.clusterShow=!1;if(k.show&&(e._scene.mode!==u.SCENE3D||d.isPointVisible(k.position))){var l=e._clusterLabels&&g(k._labelCollection),m=e._clusterBillboards&&g(k.id._billboard),p=e._clusterPoints&&g(k.id._point);l&&(p||m)||(k=k.computeScreenSpacePosition(c),g(k)&&b.push({index:h,collection:a,clustered:!1,coord:k}))}}}function H(e){return function(k){if(!(g(k)&&.05>k)&&e.enabled){var l=e._scene,q=e._labelCollection,r=e._billboardCollection,u=e._pointCollection;if((g(q)||g(r)||g(u))&&(e._clusterBillboards||e._clusterLabels||e._clusterPoints)){k=e._clusterLabelCollection;var w=e._clusterBillboardCollection,A=e._clusterPointCollection;g(k)?k.removeAll():k=e._clusterLabelCollection=new t({scene:l});g(w)?w.removeAll():w=e._clusterBillboardCollection=new d({scene:l});g(A)?A.removeAll():A=e._clusterPointCollection=new c;var D=e._pixelRange,E=e._minimumClusterSize,G=e._previousClusters,H=[],T=e._previousHeight,O=l.camera.positionCartographic.height,J=new m(l.mapProjection.ellipsoid,l.camera.positionWC),N=[];e._clusterLabels&&I(q,N,l,J,e);e._clusterBillboards&&I(r,N,l,J,e);e._clusterPoints&&I(u,N,l,J,e);var X,fa,F,ka,na,ia,la,u=y(N,z,x,64,Int32Array);if(O<T)for(r=G.length,q=0;q<r;++q){var ha=G[q];if(J.isPointVisible(ha.position)&&(fa=p._computeScreenSpacePosition(h.IDENTITY,ha.position,f.ZERO,a.ZERO,l),g(fa))){na=1-O/T;F=ha.width*=na;na=ha.height*=na;F=Math.max(F,ha.minimumWidth);na=Math.max(na,ha.minimumHeight);fa=u.range(fa.x-.5*F,fa.y-.5*na,fa.x+F,fa.y+na);F=fa.length;ia=0;na=[];for(X=0;X<F;++X)ka=fa[X],ka=N[ka],ka.clustered||(++ia,la=ka.collection,ka=ka.index,na.push(la.get(ka).id));if(ia>=E)for(B(ha.position,ia,na,e),H.push(ha),X=0;X<F;++X)N[fa[X]].clustered=!0}}r=N.length;for(q=0;q<r;++q)if(l=N[q],!l.clustered){l.clustered=!0;la=l.collection;ka=l.index;G=la.get(ka);l=v(G,l.coord,D,e,L);T=b.clone(l,K);fa=u.range(l.x,l.y,l.x+l.width,l.y+l.height);F=fa.length;J=f.clone(G.position);ia=1;na=[G.id];for(X=0;X<F;++X)ka=fa[X],ka=N[ka],ka.clustered||(ha=ka.collection.get(ka.index),ka=v(ha,ka.coord,D,e,P),f.add(ha.position,J,J),b.union(T,ka,T),++ia,na.push(ha.id));if(ia>=E)for(G=f.multiplyByScalar(J,1/ia,J),B(G,ia,na,e),H.push({position:G,width:T.width,height:T.height,minimumWidth:l.width,minimumHeight:l.height}),X=0;X<F;++X)N[fa[X]].clustered=!0;else l=G,G=e,l.clusterShow=!0,!g(l._labelCollection)&&g(l.id)&&C(G,l.id)&&g(l.id._label)&&(G._labelCollection.get(G._collectionIndicesByEntity[l.id]).clusterShow=!0)}0===k.length&&(k.destroy(),e._clusterLabelCollection=void 0);0===w.length&&(w.destroy(),e._clusterBillboardCollection=void 0);0===A.length&&(A.destroy(),e._clusterPointCollection=void 0);e._previousClusters=H;e._previousHeight=O}}}}function J(a,b,c,d){return function(e){var f=this[a];g(this._collectionIndicesByEntity)||(this._collectionIndicesByEntity={});var h=this._collectionIndicesByEntity[e.id];g(h)||(h=this._collectionIndicesByEntity[e.id]={billboardIndex:void 0,labelIndex:void 0,pointIndex:void 0});if(g(f)&&g(h[d]))return f.get(h[d]);g(f)||(f=this[a]=new b({scene:this._scene}));var k;e=this[c];0<e.length?(e=e.pop(),k=f.get(e)):(k=f.add(),e=f.length-1);h[d]=e;this._clusterDirty=!0;return k}}function w(a,b){var c=a._collectionIndicesByEntity[b];g(c.billboardIndex)||g(c.labelIndex)||g(c.pointIndex)||delete a._collectionIndicesByEntity[b]}function G(a){if(g(a))for(var b=a.length,c=0;c<b;++c)a.get(c).clusterShow=!0}var E=new b,L=new b,K=new b,P=new b;A.prototype._initialize=function(a){this._scene=a;var b=H(this);this._cluster=b;this._removeEventListener=a.camera.changed.addEventListener(b)};l(A.prototype,{enabled:{get:function(){return this._enabled},set:function(a){this._enabledDirty=a!==this._enabled;this._enabled=a}},pixelRange:{get:function(){return this._pixelRange},set:function(a){this._clusterDirty=this._clusterDirty||a!==this._pixelRange;this._pixelRange=a}},minimumClusterSize:{get:function(){return this._minimumClusterSize},set:function(a){this._clusterDirty=this._clusterDirty||a!==this._minimumClusterSize;this._minimumClusterSize=a}},clusterEvent:{get:function(){return this._clusterEvent}},clusterBillboards:{get:function(){return this._clusterBillboards},set:function(a){this._clusterDirty=this._clusterDirty||a!==this._clusterBillboards;this._clusterBillboards=a}},clusterLabels:{get:function(){return this._clusterLabels},set:function(a){this._clusterDirty=this._clusterDirty||a!==this._clusterLabels;this._clusterLabels=a}},clusterPoints:{get:function(){return this._clusterPoints},set:function(a){this._clusterDirty=this._clusterDirty||a!==this._clusterPoints;this._clusterPoints=a}}});A.prototype.getLabel=J("_labelCollection",t,"_unusedLabelIndices","labelIndex");A.prototype.removeLabel=function(a){var b=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[a.id];if(g(this._labelCollection)&&g(b)&&g(b.labelIndex)){var c=b.labelIndex;b.labelIndex=void 0;w(this,a.id);a=this._labelCollection.get(c);a.show=!1;a.text="";a.id=void 0;this._unusedLabelIndices.push(c);this._clusterDirty=!0}};A.prototype.getBillboard=J("_billboardCollection",d,"_unusedBillboardIndices","billboardIndex");A.prototype.removeBillboard=function(a){var b=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[a.id];if(g(this._billboardCollection)&&g(b)&&g(b.billboardIndex)){var c=b.billboardIndex;b.billboardIndex=void 0;w(this,a.id);a=this._billboardCollection.get(c);a.id=void 0;a.show=!1;a.image=void 0;this._unusedBillboardIndices.push(c);this._clusterDirty=!0}};A.prototype.getPoint=J("_pointCollection",c,"_unusedPointIndices","pointIndex");A.prototype.removePoint=function(a){var b=this._collectionIndicesByEntity&&this._collectionIndicesByEntity[a.id];if(g(this._pointCollection)&&g(b)&&g(b.pointIndex)){var c=b.pointIndex;b.pointIndex=void 0;w(this,a.id);a=this._pointCollection.get(c);a.show=!1;a.id=void 0;this._unusedPointIndices.push(c);this._clusterDirty=!0}};A.prototype.update=function(a){var b;g(this._labelCollection)&&0<this._labelCollection.length&&0===this._labelCollection.get(0)._glyphs.length&&(b=a.commandList,a.commandList=[],this._labelCollection.update(a),a.commandList=b);g(this._billboardCollection)&&0<this._billboardCollection.length&&!g(this._billboardCollection.get(0).width)&&(b=a.commandList,a.commandList=[],this._billboardCollection.update(a),a.commandList=b);this._enabledDirty&&(this._enabledDirty=!1,this.enabled||(g(this._clusterLabelCollection)&&this._clusterLabelCollection.destroy(),g(this._clusterBillboardCollection)&&this._clusterBillboardCollection.destroy(),g(this._clusterPointCollection)&&this._clusterPointCollection.destroy(),this._clusterPointCollection=this._clusterBillboardCollection=this._clusterLabelCollection=void 0,G(this._labelCollection),G(this._billboardCollection),G(this._pointCollection)),this._clusterDirty=!0);this._clusterDirty&&(this._clusterDirty=!1,this._cluster());g(this._clusterLabelCollection)&&this._clusterLabelCollection.update(a);g(this._clusterBillboardCollection)&&this._clusterBillboardCollection.update(a);g(this._clusterPointCollection)&&this._clusterPointCollection.update(a);g(this._labelCollection)&&this._labelCollection.update(a);g(this._billboardCollection)&&this._billboardCollection.update(a);g(this._pointCollection)&&this._pointCollection.update(a)};A.prototype.destroy=function(){this._labelCollection=this._labelCollection&&this._labelCollection.destroy();this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy();this._pointCollection=this._pointCollection&&this._pointCollection.destroy();this._clusterLabelCollection=this._clusterLabelCollection&&this._clusterLabelCollection.destroy();this._clusterBillboardCollection=this._clusterBillboardCollection&&this._clusterBillboardCollection.destroy();this._clusterPointCollection=this._clusterPointCollection&&this._clusterPointCollection.destroy();g(this._removeEventListener)&&(this._removeEventListener(),this._removeEventListener=void 0);this._collectionIndicesByEntity=this._clusterPointCollection=this._clusterLabelCollection=this._clusterBillboardCollection=this._pointCollection=this._billboardCollection=this._labelCollection=void 0;this._unusedLabelIndices=[];this._unusedBillboardIndices=[];this._unusedPointIndices=[];this._previousClusters=[];this._previousHeight=void 0;this._minimumClusterSizeDirty=this._pixelRangeDirty=this._enabledDirty=!1};return A});F("DataSources/CustomDataSource","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ./DataSource ./EntityCluster ./EntityCollection".split(" "),function(b,a,f,k,g,l,m){function e(a){this._name=a;this._clock=void 0;this._changed=new k;this._error=new k;this._isLoading=!1;this._loading=new k;this._entityCollection=new m(this);this._entityCluster=new l}a(e.prototype,{name:{get:function(){return this._name},set:function(a){this._name!==a&&(this._name=a,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock},set:function(a){this._clock!==a&&(this._clock=a,this._changed.raiseEvent(this))}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading},set:function(a){g.setLoading(this,a)}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(a){this._entityCollection.show=a}},clustering:{get:function(){return this._entityCluster},set:function(a){if(!b(a))throw new f("value must be defined.");this._entityCluster=a}}});return e});F("DataSources/CylinderGeometryUpdater","../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/CylinderGeometry ../Core/CylinderOutlineGeometry ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/OffsetGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./heightReferenceOnEntityPropertyChanged ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a){this.id=a;this.offsetAttribute=this.numberOfVerticalLines=this.slices=this.bottomRadius=this.topRadius=this.length=this.vertexFormat=void 0}function I(a,b){v.call(this,{entity:a,scene:b,geometryOptions:new C(a),geometryPropertyName:"cylinder",observedPropertyNames:["availability","position","orientation","cylinder"]});this._onEntityPropertyChanged(a,"cylinder",a.cylinder,void 0)}function H(a,b,c){D.call(this,a,b,c)}var J=b.ZERO,w=new b,G=new b,E=new f;m(Object.create)&&(I.prototype=Object.create(v.prototype),I.prototype.constructor=I);e(I.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});I.prototype.createFillGeometryInstance=function(b){a.defined("time",b);if(!this._fillEnabled)throw new h("This instance does not represent a filled geometry.");var e=this._entity,l=e.isAvailable(b),q=new c(l&&e.isShowing&&this._showProperty.getValue(b)&&this._fillProperty.getValue(b)),u=this._distanceDisplayConditionProperty.getValue(b),u=p.fromDistanceDisplayCondition(u),q={show:q,distanceDisplayCondition:u,color:void 0,offset:void 0};if(this._materialProperty instanceof x){var v;m(this._materialProperty.color)&&(this._materialProperty.color.isConstant||l)&&(v=this._materialProperty.color.getValue(b,E));m(v)||(v=f.WHITE);q.color=k.fromColor(v)}m(this._options.offsetAttribute)&&(q.offset=r.fromCartesian3(B.getValueOrDefault(this._terrainOffsetProperty,b,J,w)));return new d({id:e,geometry:new g(this._options),modelMatrix:e.computeModelMatrixForHeightReference(b,e.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:q})};I.prototype.createOutlineGeometryInstance=function(b){a.defined("time",b);if(!this._outlineEnabled)throw new h("This instance does not represent an outlined geometry.");var e=this._entity,g=e.isAvailable(b),q=B.getValueOrDefault(this._outlineColorProperty,b,f.BLACK,E),u=this._distanceDisplayConditionProperty.getValue(b),g={show:new c(g&&e.isShowing&&this._showProperty.getValue(b)&&this._showOutlineProperty.getValue(b)),color:k.fromColor(q),distanceDisplayCondition:p.fromDistanceDisplayCondition(u),offset:void 0};m(this._options.offsetAttribute)&&(g.offset=r.fromCartesian3(B.getValueOrDefault(this._terrainOffsetProperty,b,J,w)));return new d({id:e,geometry:new l(this._options),modelMatrix:e.computeModelMatrixForHeightReference(b,e.cylinder.heightReference,.5*this._options.length,this._scene.mapProjection.ellipsoid),attributes:g})};I.prototype._computeCenter=function(a,b){return B.getValueOrUndefined(this._entity.position,a,b)};I.prototype._isHidden=function(a,b){return!m(a.position)||!m(b.length)||!m(b.topRadius)||!m(b.bottomRadius)||v.prototype._isHidden.call(this,a,b)};I.prototype._isDynamic=function(a,b){return!a.position.isConstant||!B.isConstant(a.orientation)||!b.length.isConstant||!b.topRadius.isConstant||!b.bottomRadius.isConstant||!B.isConstant(b.slices)||!B.isConstant(b.outlineWidth)||!B.isConstant(b.numberOfVerticalLines)};I.prototype._setStaticOptions=function(a,b){var c=B.getValueOrDefault(b.heightReference,t.MINIMUM_VALUE,u.NONE),d=this._options;d.vertexFormat=this._materialProperty instanceof x?A.VERTEX_FORMAT:y.MaterialSupport.TEXTURED.vertexFormat;d.length=b.length.getValue(t.MINIMUM_VALUE);d.topRadius=b.topRadius.getValue(t.MINIMUM_VALUE);d.bottomRadius=b.bottomRadius.getValue(t.MINIMUM_VALUE);d.slices=B.getValueOrUndefined(b.slices,t.MINIMUM_VALUE);d.numberOfVerticalLines=B.getValueOrUndefined(b.numberOfVerticalLines,t.MINIMUM_VALUE);d.offsetAttribute=c!==u.NONE?q.ALL:void 0};I.prototype._onEntityPropertyChanged=z;I.DynamicGeometryUpdater=H;m(Object.create)&&(H.prototype=Object.create(D.prototype),H.prototype.constructor=H);H.prototype._isHidden=function(a,b,c){var d=this._options,e=B.getValueOrUndefined(a.position,c,G);return!m(e)||!m(d.length)||!m(d.topRadius)||!m(d.bottomRadius)||D.prototype._isHidden.call(this,a,b,c)};H.prototype._setOptions=function(a,b,c){a=B.getValueOrDefault(b.heightReference,c,u.NONE);var d=this._options;d.length=B.getValueOrUndefined(b.length,c);d.topRadius=B.getValueOrUndefined(b.topRadius,c);d.bottomRadius=B.getValueOrUndefined(b.bottomRadius,c);d.slices=B.getValueOrUndefined(b.slices,c);d.numberOfVerticalLines=B.getValueOrUndefined(b.numberOfVerticalLines,c);d.offsetAttribute=a!==u.NONE?q.ALL:void 0};return I});F("Scene/ColorBlendMode",["../Core/freezeObject","../Core/Math"],function(b,a){var f={HIGHLIGHT:0,REPLACE:1,MIX:2,getColorBlend:function(b,g){if(b===f.HIGHLIGHT)return 0;if(b===f.REPLACE)return 1;if(b===f.MIX)return a.clamp(g,a.EPSILON4,1)}};return b(f)});F("DataSources/DataSourceClock","../Core/Clock ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/JulianDate ./createRawPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e){function h(){this._definitionChanged=new l;this._multiplier=this._clockStep=this._clockRange=this._currentTime=this._stopTime=this._startTime=void 0}k(h.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},startTime:e("startTime"),stopTime:e("stopTime"),currentTime:e("currentTime"),clockRange:e("clockRange"),clockStep:e("clockStep"),multiplier:e("multiplier")});h.prototype.clone=function(a){f(a)||(a=new h);a.startTime=this.startTime;a.stopTime=this.stopTime;a.currentTime=this.currentTime;a.clockRange=this.clockRange;a.clockStep=this.clockStep;a.multiplier=this.multiplier;return a};h.prototype.equals=function(a){return this===a||f(a)&&m.equals(this.startTime,a.startTime)&&m.equals(this.stopTime,a.stopTime)&&m.equals(this.currentTime,a.currentTime)&&this.clockRange===a.clockRange&&this.clockStep===a.clockStep&&this.multiplier===a.multiplier};h.prototype.merge=function(b){if(!f(b))throw new g("source is required.");this.startTime=a(this.startTime,b.startTime);this.stopTime=a(this.stopTime,b.stopTime);this.currentTime=a(this.currentTime,b.currentTime);this.clockRange=a(this.clockRange,b.clockRange);this.clockStep=a(this.clockStep,b.clockStep);this.multiplier=a(this.multiplier,b.multiplier)};h.prototype.getValue=function(e){f(e)||(e=new b);e.startTime=a(this.startTime,e.startTime);e.stopTime=a(this.stopTime,e.stopTime);e.currentTime=a(this.currentTime,e.currentTime);e.clockRange=a(this.clockRange,e.clockRange);e.multiplier=a(this.multiplier,e.multiplier);e.clockStep=a(this.clockStep,e.clockStep);return e};return h});F("DataSources/GridMaterialProperty","../Core/Cartesian2 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(a){a=f(a,f.EMPTY_OBJECT);this._definitionChanged=new l;this._lineOffsetSubscription=this._lineOffset=this._lineThicknessSubscription=this._lineThickness=this._lineCountSubscription=this._lineCount=this._cellAlphaSubscription=this._cellAlpha=this._colorSubscription=this._color=void 0;this.color=a.color;this.cellAlpha=a.cellAlpha;this.lineCount=a.lineCount;this.lineThickness=a.lineThickness;this.lineOffset=a.lineOffset}var p=a.WHITE,d=new b(8,8),q=new b(0,0),t=new b(1,1);g(h.prototype,{isConstant:{get:function(){return e.isConstant(this._color)&&e.isConstant(this._cellAlpha)&&e.isConstant(this._lineCount)&&e.isConstant(this._lineThickness)&&e.isConstant(this._lineOffset)}},definitionChanged:{get:function(){return this._definitionChanged}},color:m("color"),cellAlpha:m("cellAlpha"),lineCount:m("lineCount"),lineThickness:m("lineThickness"),lineOffset:m("lineOffset")});h.prototype.getType=function(a){return"Grid"};h.prototype.getValue=function(a,b){k(b)||(b={});b.color=e.getValueOrClonedDefault(this._color,a,p,b.color);b.cellAlpha=e.getValueOrDefault(this._cellAlpha,a,.1);b.lineCount=e.getValueOrClonedDefault(this._lineCount,a,d,b.lineCount);b.lineThickness=e.getValueOrClonedDefault(this._lineThickness,a,t,b.lineThickness);b.lineOffset=e.getValueOrClonedDefault(this._lineOffset,a,q,b.lineOffset);return b};h.prototype.equals=function(a){return this===a||a instanceof h&&e.equals(this._color,a._color)&&e.equals(this._cellAlpha,a._cellAlpha)&&e.equals(this._lineCount,a._lineCount)&&e.equals(this._lineThickness,a._lineThickness)&&e.equals(this._lineOffset,a._lineOffset)};return h});F("DataSources/PolylineArrowMaterialProperty","../Core/Color ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l){function m(a){this._definitionChanged=new k;this._colorSubscription=this._color=void 0;this.color=a}f(m.prototype,{isConstant:{get:function(){return l.isConstant(this._color)}},definitionChanged:{get:function(){return this._definitionChanged}},color:g("color")});m.prototype.getType=function(a){return"PolylineArrow"};m.prototype.getValue=function(e,f){a(f)||(f={});f.color=l.getValueOrClonedDefault(this._color,e,b.WHITE,f.color);return f};m.prototype.equals=function(a){return this===a||a instanceof m&&l.equals(this._color,a._color)};return m});F("DataSources/PolylineDashMaterialProperty","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._definitionChanged=new g;this._dashPatternSubscription=this._dashPattern=this._dashLengthSubscription=this._dashLength=this._gapColorSubscription=this._gapColor=this._colorSubscription=this._color=void 0;this.color=b.color;this.gapColor=b.gapColor;this.dashLength=b.dashLength;this.dashPattern=b.dashPattern}var h=b.WHITE,p=b.TRANSPARENT;k(e.prototype,{isConstant:{get:function(){return m.isConstant(this._color)&&m.isConstant(this._gapColor)&&m.isConstant(this._dashLength)&&m.isConstant(this._dashPattern)}},definitionChanged:{get:function(){return this._definitionChanged}},color:l("color"),gapColor:l("gapColor"),dashLength:l("dashLength"),dashPattern:l("dashPattern")});e.prototype.getType=function(a){return"PolylineDash"};e.prototype.getValue=function(a,b){f(b)||(b={});b.color=m.getValueOrClonedDefault(this._color,a,h,b.color);b.gapColor=m.getValueOrClonedDefault(this._gapColor,a,p,b.gapColor);b.dashLength=m.getValueOrDefault(this._dashLength,a,16,b.dashLength);b.dashPattern=m.getValueOrDefault(this._dashPattern,a,255,b.dashPattern);return b};e.prototype.equals=function(a){return this===a||a instanceof e&&m.equals(this._color,a._color)&&m.equals(this._gapColor,a._gapColor)&&m.equals(this._dashLength,a._dashLength)&&m.equals(this._dashPattern,a._dashPattern)};return e});F("DataSources/PolylineGlowMaterialProperty","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._definitionChanged=new g;this._taperPowerSubscription=this._taperPower=this._glowPowerSubscription=this._glowPower=this._colorSubscription=this._color=void 0;this.color=b.color;this.glowPower=b.glowPower;this.taperPower=b.taperPower}var h=b.WHITE;k(e.prototype,{isConstant:{get:function(){return m.isConstant(this._color)&&m.isConstant(this._glow)}},definitionChanged:{get:function(){return this._definitionChanged}},color:l("color"),glowPower:l("glowPower"),taperPower:l("taperPower")});e.prototype.getType=function(a){return"PolylineGlow"};e.prototype.getValue=function(a,b){f(b)||(b={});b.color=m.getValueOrClonedDefault(this._color,a,h,b.color);b.glowPower=m.getValueOrDefault(this._glowPower,a,.25,b.glowPower);b.taperPower=m.getValueOrDefault(this._taperPower,a,1,b.taperPower);return b};e.prototype.equals=function(a){return this===a||a instanceof e&&m.equals(this._color,a._color)&&m.equals(this._glowPower,a._glowPower)&&m.equals(this._taperPower,a._taperPower)};return e});F("DataSources/PolylineOutlineMaterialProperty","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._definitionChanged=new g;this._outlineWidthSubscription=this._outlineWidth=this._outlineColorSubscription=this._outlineColor=this._colorSubscription=this._color=void 0;this.color=b.color;this.outlineColor=b.outlineColor;this.outlineWidth=b.outlineWidth}var h=b.WHITE,p=b.BLACK;k(e.prototype,{isConstant:{get:function(){return m.isConstant(this._color)&&m.isConstant(this._outlineColor)&&m.isConstant(this._outlineWidth)}},definitionChanged:{get:function(){return this._definitionChanged}},color:l("color"),outlineColor:l("outlineColor"),outlineWidth:l("outlineWidth")});e.prototype.getType=function(a){return"PolylineOutline"};e.prototype.getValue=function(a,b){f(b)||(b={});b.color=m.getValueOrClonedDefault(this._color,a,h,b.color);b.outlineColor=m.getValueOrClonedDefault(this._outlineColor,a,p,b.outlineColor);b.outlineWidth=m.getValueOrDefault(this._outlineWidth,a,1);return b};e.prototype.equals=function(a){return this===a||a instanceof e&&m.equals(this._color,a._color)&&m.equals(this._outlineColor,a._outlineColor)&&m.equals(this._outlineWidth,a._outlineWidth)};return e});F("DataSources/PositionPropertyArray","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/EventHelper ../Core/ReferenceFrame ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d){this._value=void 0;this._definitionChanged=new g;this._eventHelper=new l;this._referenceFrame=b(d,m.FIXED);this.setValue(a)}f(h.prototype,{isConstant:{get:function(){var b=this._value;if(!a(b))return!0;for(var d=b.length,f=0;f<d;f++)if(!e.isConstant(b[f]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}}});h.prototype.getValue=function(a,b){return this.getValueInReferenceFrame(a,m.FIXED,b)};h.prototype.getValueInReferenceFrame=function(b,d,e){if(!a(b))throw new k("time is required.");if(!a(d))throw new k("referenceFrame is required.");var f=this._value;if(a(f)){var h=f.length;a(e)||(e=Array(h));for(var c=0,g=0;c<h;){var l=f[c].getValueInReferenceFrame(b,d,e[c]);a(l)&&(e[g]=l,g++);c++}e.length=g;return e}};h.prototype.setValue=function(b){var d=this._eventHelper;d.removeAll();if(a(b)){this._value=b.slice();for(var e=b.length,f=0;f<e;f++){var g=b[f];a(g)&&d.add(g.definitionChanged,h.prototype._raiseDefinitionChanged,this)}}else this._value=void 0;this._definitionChanged.raiseEvent(this)};h.prototype.equals=function(a){return this===a||a instanceof h&&this._referenceFrame===a._referenceFrame&&e.arrayEquals(this._value,a._value)};h.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};return h});F("DataSources/PropertyArray","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/EventHelper ./Property".split(" "),function(b,a,f,k,g,l){function m(a){this._value=void 0;this._definitionChanged=new k;this._eventHelper=new g;this.setValue(a)}a(m.prototype,{isConstant:{get:function(){var a=this._value;if(!b(a))return!0;for(var f=a.length,g=0;g<f;g++)if(!l.isConstant(a[g]))return!1;return!0}},definitionChanged:{get:function(){return this._definitionChanged}}});m.prototype.getValue=function(a,h){if(!b(a))throw new f("time is required.");var e=this._value;if(b(e)){e=e.length;b(h)||(h=Array(e));for(var d=0,g=0;d<e;){var k=this._value[d].getValue(a,h[d]);b(k)&&(h[g]=k,g++);d++}h.length=g;return h}};m.prototype.setValue=function(a){var e=this._eventHelper;e.removeAll();if(b(a)){this._value=a.slice();for(var f=a.length,d=0;d<f;d++){var g=a[d];b(g)&&e.add(g.definitionChanged,m.prototype._raiseDefinitionChanged,this)}}else this._value=void 0;this._definitionChanged.raiseEvent(this)};m.prototype.equals=function(a){return this===a||a instanceof m&&l.arrayEquals(this._value,a._value)};m.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};return m});F("DataSources/ReferenceProperty","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/RuntimeError ./Property".split(" "),function(b,a,f,k,g,l){function m(a){var f=a._targetProperty;if(a._resolveProperty){var d,f=!0;if(a._resolveEntity&&(d=a._targetCollection.getById(a._targetId),b(d)?(d.definitionChanged.addEventListener(e.prototype._onTargetEntityDefinitionChanged,a),a._targetEntity=d,a._resolveEntity=!1):(d=a._targetEntity,f=!1),!b(d)))throw new g('target entity "'+a._targetId+'" could not be resolved.');d=f;for(var h=a._targetPropertyNames,f=a._targetEntity,k=h.length,l=0;l<k&&b(f);l++)f=f[h[l]];if(b(f))a._targetProperty=f,a._resolveProperty=!d;else if(!b(a._targetProperty))throw new g('targetProperty "'+a._targetId+"."+h.join(".")+'" could not be resolved.');}return f}function e(a,g,d){if(!b(a))throw new f("targetCollection is required.");if(!b(g)||""===g)throw new f("targetId is required.");if(!b(d)||0===d.length)throw new f("targetPropertyNames is required.");for(var h=0;h<d.length;h++){var l=d[h];if(!b(l)||""===l)throw new f("reference contains invalid properties.");}this._targetCollection=a;this._targetId=g;this._targetPropertyNames=d;this._targetEntity=this._targetProperty=void 0;this._definitionChanged=new k;this._resolveProperty=this._resolveEntity=!0;a.collectionChanged.addEventListener(e.prototype._onCollectionChanged,this)}a(e.prototype,{isConstant:{get:function(){return l.isConstant(m(this))}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return m(this).referenceFrame}},targetId:{get:function(){return this._targetId}},targetCollection:{get:function(){return this._targetCollection}},targetPropertyNames:{get:function(){return this._targetPropertyNames}},resolvedProperty:{get:function(){return m(this)}}});e.fromString=function(a,g){if(!b(a))throw new f("targetCollection is required.");if(!b(g))throw new f("referenceString is required.");for(var d,h=[],k=!0,l=!1,c="",m=0;m<g.length;++m){var p=g.charAt(m);l?(c+=p,l=!1):"\\"===p?l=!0:k&&"#"===p?(d=c,k=!1,c=""):k||"."!==p?c+=p:(h.push(c),c="")}h.push(c);return new e(a,d,h)};e.prototype.getValue=function(a,b){return m(this).getValue(a,b)};e.prototype.getValueInReferenceFrame=function(a,b,d){return m(this).getValueInReferenceFrame(a,b,d)};e.prototype.getType=function(a){return m(this).getType(a)};e.prototype.equals=function(a){if(this===a)return!0;var b=this._targetPropertyNames,d=a._targetPropertyNames;if(this._targetCollection!==a._targetCollection||this._targetId!==a._targetId||b.length!==d.length)return!1;a=this._targetPropertyNames.length;for(var e=0;e<a;e++)if(b[e]!==d[e])return!1;return!0};e.prototype._onTargetEntityDefinitionChanged=function(a,b,d,e){this._targetPropertyNames[0]===b&&(this._resolveProperty=!0,this._definitionChanged.raiseEvent(this))};e.prototype._onCollectionChanged=function(a,f,d){a=this._targetEntity;b(a)&&(-1!==d.indexOf(a)?(a.definitionChanged.removeEventListener(e.prototype._onTargetEntityDefinitionChanged,this),this._resolveProperty=this._resolveEntity=!0):this._resolveEntity&&(m(this),this._resolveEntity||this._definitionChanged.raiseEvent(this)))};return e});F("DataSources/Rotation",["../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/Math"],function(b,a,f,k){return{packedLength:1,pack:function(g,k,m){if(!a(g))throw new f("value is required");if(!a(k))throw new f("array is required");m=b(m,0);k[m]=g;return k},unpack:function(g,k,m){if(!a(g))throw new f("array is required");k=b(k,0);return g[k]},convertPackedArrayForInterpolation:function(g,l,m,e){if(!a(g))throw new f("packedArray is required");l=b(l,0);m=b(m,g.length);var h,p=0;for(m=m-l+1;p<m;p++){var d=g[l+p];e[p]=0===p||Math.abs(h-d)<Math.PI?d:d-k.TWO_PI;h=d}},unpackInterpolationResult:function(b,l,m,e,h){if(!a(b))throw new f("array is required");if(!a(l))throw new f("sourceArray is required");h=b[0];return 0>h?h+k.TWO_PI:h}}});F("DataSources/SampledProperty","../Core/binarySearch ../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/ExtrapolationType ../Core/JulianDate ../Core/LinearApproximation".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a,b,c){var d,e=a.length,f=c.length;d=e+f;a.length=d;if(e!==b)for(--e,--d;d>=b;d--)a[d]=a[e--];for(d=0;d<f;d++)a[b++]=c[d]}function q(a,b){return a instanceof h?a:"string"===typeof a?h.fromIso8601(a):h.addSeconds(b,a,new h)}function t(a,c,e,f,g){for(var l=0,m,p,r,u,v;l<f.length;){u=q(f[l],a);p=b(c,u,h.compare);var t=0,z=0;if(0>p){p=~p;r=p*g;m=void 0;for(v=c[p];l<f.length;){u=q(f[l],a);if(k(m)&&0<=h.compare(m,u)||k(v)&&0<=h.compare(u,v))break;y[t++]=u;l+=1;for(m=0;m<g;m++)A[z++]=f[l],l+=1;m=u}0<t&&(A.length=z,d(e,r,A),y.length=t,d(c,p,y))}else{for(m=0;m<g;m++)l++,e[p*g+m]=f[l];l++}}}function r(b,c){a.defined("type",b);var d=b;d===Number&&(d=u);var g=d.packedLength,h=f(d.packedInterpolationLength,g),l=0,q;if(k(c)){l=c.length;q=Array(l);for(var r=0;r<l;r++){var t=c[r];t===Number&&(t=u);var w=t.packedLength,g=g+w,h=h+f(t.packedInterpolationLength,w);q[r]=t}}this._type=b;this._innerType=d;this._interpolationDegree=1;this._interpolationAlgorithm=p;this._numberOfPoints=0;this._times=[];this._values=[];this._xTable=[];this._yTable=[];this._packedLength=g;this._packedInterpolationLength=h;this._updateTableLength=!0;this._interpolationResult=Array(h);this._definitionChanged=new m;this._derivativeTypes=c;this._innerDerivativeTypes=q;this._inputOrder=l;this._forwardExtrapolationType=e.NONE;this._forwardExtrapolationDuration=0;this._backwardExtrapolationType=e.NONE;this._backwardExtrapolationDuration=0}function c(a,b,c){var d=a._packedLength;a._times.splice(b,c);a._values.splice(b*d,c*d);a._updateTableLength=!0;a._definitionChanged.raiseEvent(a)}var u={packedLength:1,pack:function(a,b,c){c=f(c,0);b[c]=a},unpack:function(a,b,c){b=f(b,0);return a[b]}},y=[],A=[];g(r.prototype,{isConstant:{get:function(){return 0===this._values.length}},definitionChanged:{get:function(){return this._definitionChanged}},type:{get:function(){return this._type}},derivativeTypes:{get:function(){return this._derivativeTypes}},interpolationDegree:{get:function(){return this._interpolationDegree}},interpolationAlgorithm:{get:function(){return this._interpolationAlgorithm}},forwardExtrapolationType:{get:function(){return this._forwardExtrapolationType},set:function(a){this._forwardExtrapolationType!==a&&(this._forwardExtrapolationType=a,this._definitionChanged.raiseEvent(this))}},forwardExtrapolationDuration:{get:function(){return this._forwardExtrapolationDuration},set:function(a){this._forwardExtrapolationDuration!==a&&(this._forwardExtrapolationDuration=a,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationType:{get:function(){return this._backwardExtrapolationType},set:function(a){this._backwardExtrapolationType!==a&&(this._backwardExtrapolationType=a,this._definitionChanged.raiseEvent(this))}},backwardExtrapolationDuration:{get:function(){return this._backwardExtrapolationDuration},set:function(a){this._backwardExtrapolationDuration!==a&&(this._backwardExtrapolationDuration=a,this._definitionChanged.raiseEvent(this))}}});r.prototype.getValue=function(c,d){a.defined("time",c);var f=this._times,g=f.length;if(0!==g){var l,m=this._innerType,p=this._values,q=b(f,c,h.compare);if(0>q){q=~q;if(0===q){var r=f[q];l=this._backwardExtrapolationDuration;if(this._backwardExtrapolationType===e.NONE||0!==l&&h.secondsDifference(r,c)>l)return;if(this._backwardExtrapolationType===e.HOLD)return m.unpack(p,0,d)}if(q>=g){q=g-1;r=f[q];l=this._forwardExtrapolationDuration;if(this._forwardExtrapolationType===e.NONE||0!==l&&h.secondsDifference(c,r)>l)return;if(this._forwardExtrapolationType===e.HOLD)return m.unpack(p,(g-1)*m.packedLength,d)}l=this._xTable;var r=this._yTable,u=this._interpolationAlgorithm,t=this._packedInterpolationLength,y=this._inputOrder;if(this._updateTableLength){this._updateTableLength=!1;var z=Math.min(u.getRequiredDataPoints(this._interpolationDegree,y),g);z!==this._numberOfPoints&&(this._numberOfPoints=z,l.length=z,r.length=z*t)}var A=this._numberOfPoints-1;if(1>A)return;z=0;--g;if(g-z+1>=A+1){q=q-(A/2|0)-1;q<z&&(q=z);var x=q+A;x>g&&(x=g,q=x-A,q<z&&(q=z));z=q;g=x}q=g-z+1;for(A=0;A<q;++A)l[A]=h.secondsDifference(f[z+A],f[g]);if(k(m.convertPackedArrayForInterpolation))m.convertPackedArrayForInterpolation(p,z,g,r);else for(q=0,x=this._packedLength,A=z*x,x*=g+1;A<x;)r[q]=p[A],A++,q++;f=h.secondsDifference(c,f[g]);f=0!==y&&k(u.interpolate)?u.interpolate(f,l,r,Math.floor(t/(y+1)),y,y,this._interpolationResult):u.interpolateOrderZero(f,l,r,t,this._interpolationResult);return k(m.unpackInterpolationResult)?m.unpackInterpolationResult(f,p,z,g,d):m.unpack(f,0,d)}return m.unpack(p,q*this._packedLength,d)}};r.prototype.setInterpolationOptions=function(a){if(k(a)){var b=!1,c=a.interpolationAlgorithm;a=a.interpolationDegree;k(c)&&this._interpolationAlgorithm!==c&&(this._interpolationAlgorithm=c,b=!0);k(a)&&this._interpolationDegree!==a&&(this._interpolationDegree=a,b=!0);b&&(this._updateTableLength=!0,this._definitionChanged.raiseEvent(this))}};r.prototype.addSample=function(b,c,d){var e=this._innerDerivativeTypes,f=k(e);a.defined("time",b);a.defined("value",c);f&&a.defined("derivatives",d);var g=this._innerType,h=[];h.push(b);g.pack(c,h,h.length);if(f)for(b=e.length,c=0;c<b;c++)e[c].pack(d[c],h,h.length);t(void 0,this._times,this._values,h,this._packedLength);this._updateTableLength=!0;this._definitionChanged.raiseEvent(this)};r.prototype.addSamples=function(b,c,d){var e=this._innerDerivativeTypes,f=k(e);a.defined("times",b);a.defined("values",c);if(b.length!==c.length)throw new l("times and values must be the same length.");if(f&&(!k(d)||d.length!==b.length))throw new l("times and derivativeValues must be the same length.");for(var g=this._innerType,h=b.length,m=[],p=0;p<h;p++)if(m.push(b[p]),g.pack(c[p],m,m.length),f)for(var q=d[p],r=e.length,u=0;u<r;u++)e[u].pack(q[u],m,m.length);t(void 0,this._times,this._values,m,this._packedLength);this._updateTableLength=!0;this._definitionChanged.raiseEvent(this)};r.prototype.addSamplesPackedArray=function(b,c){a.defined("packedSamples",b);t(c,this._times,this._values,b,this._packedLength);this._updateTableLength=!0;this._definitionChanged.raiseEvent(this)};r.prototype.removeSample=function(d){a.defined("time",d);d=b(this._times,d,h.compare);if(0>d)return!1;c(this,d,1);return!0};r.prototype.removeSamples=function(d){a.defined("timeInterval",d);var e=this._times,f=b(e,d.start,h.compare);0>f?f=~f:d.isStartIncluded||++f;e=b(e,d.stop,h.compare);0>e?e=~e:d.isStopIncluded&&++e;c(this,f,e-f)};r.prototype.equals=function(a){if(this===a)return!0;if(!k(a)||this._type!==a._type||this._interpolationDegree!==a._interpolationDegree||this._interpolationAlgorithm!==a._interpolationAlgorithm)return!1;var b=this._derivativeTypes,c=k(b),d=a._derivativeTypes,e=k(d);if(c!==e)return!1;if(c){e=b.length;if(e!==d.length)return!1;for(c=0;c<e;c++)if(b[c]!==d[c])return!1}b=this._times;d=a._times;e=b.length;if(e!==d.length)return!1;for(c=0;c<e;c++)if(!h.equals(b[c],d[c]))return!1;b=this._values;a=a._values;for(c=0;c<e;c++)if(b[c]!==a[c])return!1;return!0};r._mergeNewSamples=t;return r});F("DataSources/SampledPositionProperty","../Core/Cartesian3 ../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/ReferenceFrame ./PositionProperty ./Property ./SampledProperty".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a,g){g=f(g,0);var c;if(0<g){c=Array(g);for(var h=0;h<g;h++)c[h]=b}this._numberOfDerivatives=g;this._property=new d(b,c);this._definitionChanged=new m;this._referenceFrame=f(a,e.FIXED);this._property._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)}g(q.prototype,{isConstant:{get:function(){return this._property.isConstant}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return this._referenceFrame}},interpolationDegree:{get:function(){return this._property.interpolationDegree}},interpolationAlgorithm:{get:function(){return this._property.interpolationAlgorithm}},numberOfDerivatives:{get:function(){return this._numberOfDerivatives}},forwardExtrapolationType:{get:function(){return this._property.forwardExtrapolationType},set:function(a){this._property.forwardExtrapolationType=a}},forwardExtrapolationDuration:{get:function(){return this._property.forwardExtrapolationDuration},set:function(a){this._property.forwardExtrapolationDuration=a}},backwardExtrapolationType:{get:function(){return this._property.backwardExtrapolationType},set:function(a){this._property.backwardExtrapolationType=a}},backwardExtrapolationDuration:{get:function(){return this._property.backwardExtrapolationDuration},set:function(a){this._property.backwardExtrapolationDuration=a}}});q.prototype.getValue=function(a,b){return this.getValueInReferenceFrame(a,e.FIXED,b)};q.prototype.getValueInReferenceFrame=function(b,d,c){a.defined("time",b);a.defined("referenceFrame",d);c=this._property.getValue(b,c);if(k(c))return h.convertToReferenceFrame(b,c,this._referenceFrame,d,c)};q.prototype.setInterpolationOptions=function(a){this._property.setInterpolationOptions(a)};q.prototype.addSample=function(a,b,c){var d=this._numberOfDerivatives;if(0<d&&(!k(c)||c.length!==d))throw new l("derivatives length must be equal to the number of derivatives.");this._property.addSample(a,b,c)};q.prototype.addSamples=function(a,b,c){this._property.addSamples(a,b,c)};q.prototype.addSamplesPackedArray=function(a,b){this._property.addSamplesPackedArray(a,b)};q.prototype.removeSample=function(a){this._property.removeSample(a)};q.prototype.removeSamples=function(a){this._property.removeSamples(a)};q.prototype.equals=function(a){return this===a||a instanceof q&&p.equals(this._property,a._property)&&this._referenceFrame===a._referenceFrame};return q});F("DataSources/StripeOrientation",["../Core/freezeObject"],function(b){return b({HORIZONTAL:0,VERTICAL:1})});F("DataSources/StripeMaterialProperty","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ./createPropertyDescriptor ./Property ./StripeOrientation".split(" "),function(b,a,f,k,g,l,m,e){function h(b){b=a(b,a.EMPTY_OBJECT);this._definitionChanged=new g;this._repeatSubscription=this._repeat=this._offsetSubscription=this._offset=this._oddColorSubscription=this._oddColor=this._evenColorSubscription=this._evenColor=this._orientationSubscription=this._orientation=void 0;this.orientation=b.orientation;this.evenColor=b.evenColor;this.oddColor=b.oddColor;this.offset=b.offset;this.repeat=b.repeat}var p=e.HORIZONTAL,d=b.WHITE,q=b.BLACK;k(h.prototype,{isConstant:{get:function(){return m.isConstant(this._orientation)&&m.isConstant(this._evenColor)&&m.isConstant(this._oddColor)&&m.isConstant(this._offset)&&m.isConstant(this._repeat)}},definitionChanged:{get:function(){return this._definitionChanged}},orientation:l("orientation"),evenColor:l("evenColor"),oddColor:l("oddColor"),offset:l("offset"),repeat:l("repeat")});h.prototype.getType=function(a){return"Stripe"};h.prototype.getValue=function(a,b){f(b)||(b={});b.horizontal=m.getValueOrDefault(this._orientation,a,p)===e.HORIZONTAL;b.evenColor=m.getValueOrClonedDefault(this._evenColor,a,d,b.evenColor);b.oddColor=m.getValueOrClonedDefault(this._oddColor,a,q,b.oddColor);b.offset=m.getValueOrDefault(this._offset,a,0);b.repeat=m.getValueOrDefault(this._repeat,a,1);return b};h.prototype.equals=function(a){return this===a||a instanceof h&&m.equals(this._orientation,a._orientation)&&m.equals(this._evenColor,a._evenColor)&&m.equals(this._oddColor,a._oddColor)&&m.equals(this._offset,a._offset)&&m.equals(this._repeat,a._repeat)};return h});F("DataSources/TimeIntervalCollectionPositionProperty","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/ReferenceFrame ../Core/TimeIntervalCollection ./PositionProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a){this._definitionChanged=new g;this._intervals=new m;this._intervals.changedEvent.addEventListener(p.prototype._intervalsChanged,this);this._referenceFrame=b(a,l.FIXED)}f(p.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}},referenceFrame:{get:function(){return this._referenceFrame}}});p.prototype.getValue=function(a,b){return this.getValueInReferenceFrame(a,l.FIXED,b)};p.prototype.getValueInReferenceFrame=function(b,f,g){if(!a(b))throw new k("time is required.");if(!a(f))throw new k("referenceFrame is required.");var d=this._intervals.findDataForIntervalContainingDate(b);if(a(d))return e.convertToReferenceFrame(b,d,this._referenceFrame,f,g)};p.prototype.equals=function(a){return this===a||a instanceof p&&this._intervals.equals(a._intervals,h.equals)&&this._referenceFrame===a._referenceFrame};p.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)};return p});F("DataSources/TimeIntervalCollectionProperty","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/TimeIntervalCollection ./Property".split(" "),function(b,a,f,k,g,l){function m(){this._definitionChanged=new k;this._intervals=new g;this._intervals.changedEvent.addEventListener(m.prototype._intervalsChanged,this)}a(m.prototype,{isConstant:{get:function(){return this._intervals.isEmpty}},definitionChanged:{get:function(){return this._definitionChanged}},intervals:{get:function(){return this._intervals}}});m.prototype.getValue=function(a,g){if(!b(a))throw new f("time is required");var e=this._intervals.findDataForIntervalContainingDate(a);return b(e)&&"function"===typeof e.clone?e.clone(g):e};m.prototype.equals=function(a){return this===a||a instanceof m&&this._intervals.equals(a._intervals,l.equals)};m.prototype._intervalsChanged=function(){this._definitionChanged.raiseEvent(this)};return m});F("DataSources/VelocityVectorProperty","../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/JulianDate ./Property".split(" "),function(b,a,f,k,g,l,m,e){function h(b,c){this._subscription=this._position=void 0;this._definitionChanged=new l;this._normalize=a(c,!0);this.position=b}k(h.prototype,{isConstant:{get:function(){return e.isConstant(this._position)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._position},set:function(a){var b=this._position;b!==a&&(f(b)&&this._subscription(),this._position=a,f(a)&&(this._subscription=a._definitionChanged.addEventListener(function(){this._definitionChanged.raiseEvent(this)},this)),this._definitionChanged.raiseEvent(this))}},normalize:{get:function(){return this._normalize},set:function(a){this._normalize!==a&&(this._normalize=a,this._definitionChanged.raiseEvent(this))}}});var p=new b,d=new b,q=new m,t=1/60;h.prototype.getValue=function(a,b){return this._getValue(a,b)};h.prototype._getValue=function(a,c,h){if(!f(a))throw new g("time is required");f(c)||(c=new b);var k=this._position;if(e.isConstant(k))return this._normalize?void 0:b.clone(b.ZERO,c);var l=k.getValue(a,p),r=k.getValue(m.addSeconds(a,t,q),d);if(f(l)){if(!f(r)&&(r=l,l=k.getValue(m.addSeconds(a,-t,q),d),!f(l)))return;if(b.equals(l,r))return this._normalize?void 0:b.clone(b.ZERO,c);f(h)&&l.clone(h);a=b.subtract(r,l,c);return this._normalize?b.normalize(a,c):b.divideByScalar(a,t,c)}};h.prototype.equals=function(a){return this===a||a instanceof h&&e.equals(this._position,a._position)};return h});F("DataSources/VelocityOrientationProperty","../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Ellipsoid ../Core/Event ../Core/Matrix3 ../Core/Quaternion ../Core/Transforms ./Property ./VelocityVectorProperty".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(b,c){this._velocityVectorProperty=new d(b,!0);this._ellipsoid=this._subscription=void 0;this._definitionChanged=new l;this.ellipsoid=a(c,g.WGS84);var e=this;this._velocityVectorProperty.definitionChanged.addEventListener(function(){e._definitionChanged.raiseEvent(e)})}k(q.prototype,{isConstant:{get:function(){return p.isConstant(this._velocityVectorProperty)}},definitionChanged:{get:function(){return this._definitionChanged}},position:{get:function(){return this._velocityVectorProperty.position},set:function(a){this._velocityVectorProperty.position=a}},ellipsoid:{get:function(){return this._ellipsoid},set:function(a){this._ellipsoid!==a&&(this._ellipsoid=a,this._definitionChanged.raiseEvent(this))}}});var t=new b,r=new b,c=new m;q.prototype.getValue=function(a,b){var d=this._velocityVectorProperty._getValue(a,r,t);if(f(d))return h.rotationMatrixFromPositionVelocity(t,d,this._ellipsoid,c),e.fromRotationMatrix(c,b)};q.prototype.equals=function(a){return this===a||a instanceof q&&p.equals(this._velocityVectorProperty,a._velocityVectorProperty)&&(this._ellipsoid===a._ellipsoid||this._ellipsoid.equals(a._ellipsoid))};return q});F("DataSources/CzmlDataSource","../Core/ArcType ../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/ClockRange ../Core/ClockStep ../Core/Color ../Core/CornerType ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/Ellipsoid ../Core/Event ../Core/ExtrapolationType ../Core/getFilenameFromUri ../Core/HermitePolynomialApproximation ../Core/isArray ../Core/Iso8601 ../Core/JulianDate ../Core/LagrangePolynomialApproximation ../Core/LinearApproximation ../Core/Math ../Core/NearFarScalar ../Core/Quaternion ../Core/Rectangle ../Core/ReferenceFrame ../Core/Resource ../Core/RuntimeError ../Core/Spherical ../Core/TimeInterval ../Core/TimeIntervalCollection ../Scene/ClassificationType ../Scene/ColorBlendMode ../Scene/HeightReference ../Scene/HorizontalOrigin ../Scene/LabelStyle ../Scene/ShadowMode ../Scene/VerticalOrigin ../ThirdParty/Uri ../ThirdParty/when ./BillboardGraphics ./BoxGraphics ./CallbackProperty ./CheckerboardMaterialProperty ./ColorMaterialProperty ./CompositeMaterialProperty ./CompositePositionProperty ./CompositeProperty ./ConstantPositionProperty ./ConstantProperty ./CorridorGraphics ./CylinderGraphics ./DataSource ./DataSourceClock ./EllipseGraphics ./EllipsoidGraphics ./EntityCluster ./EntityCollection ./GridMaterialProperty ./ImageMaterialProperty ./LabelGraphics ./ModelGraphics ./NodeTransformationProperty ./PathGraphics ./PointGraphics ./PolygonGraphics ./PolylineArrowMaterialProperty ./PolylineDashMaterialProperty ./PolylineGlowMaterialProperty ./PolylineGraphics ./PolylineOutlineMaterialProperty ./PositionPropertyArray ./PropertyArray ./PropertyBag ./RectangleGraphics ./ReferenceProperty ./Rotation ./SampledPositionProperty ./SampledProperty ./StripeMaterialProperty ./StripeOrientation ./TimeIntervalCollectionPositionProperty ./TimeIntervalCollectionProperty ./VelocityOrientationProperty ./VelocityVectorProperty ./WallGraphics".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,F,ka,na,ia,la,ha,pa,oa,qa,ua,ta,wa,za,Da,Ba,ra,Ea,Ga,Ca,ya,Aa,Ua,sa,Va,xa,Ha,Ma,Ia,La,Fa,Ja,Qa,va,Sa,Oa,Ta,Ka,Wa,Ra){function ga(){}function hb(a,b){"#"===b[0]&&(b=Sc+b);return La.fromString(a,b)}function Hb(a,b,c){if(q(c.reference))return hb(b,c.reference);if(q(c.velocityReference))switch(b=hb(b,c.velocityReference),a){case k:case ga:return new Wa(b,a===ga);case w:return new Ka(b)}throw new K(JSON.stringify(c)+" is not valid CZML.");}function db(a,b){return new da(function(c,d){return b(a.getValue(c,d))},a.isConstant)}function tb(a,b){var c=d(a.uri,a);return q(b)?b.getDerivedResource({url:c}):L.createIfNeeded(c)}function Jc(a){var b=a.cartesian;if(q(b))return b;b=a.cartesianVelocity;if(q(b))return b;b=a.unitCartesian;if(q(b))return b;b=a.unitSpherical;if(q(b)){a=b.length;Ab.magnitude=1;if(2===a)Ab.clock=b[0],Ab.cone=b[1],k.fromSpherical(Ab,ab),a=[ab.x,ab.y,ab.z];else{for(var c=Array(a/3*4),d=0,e=0;d<a;d+=3,e+=4)c[e]=b[d],Ab.clock=b[d+1],Ab.cone=b[d+2],k.fromSpherical(Ab,ab),c[e+1]=ab.x,c[e+2]=ab.y,c[e+3]=ab.z;a=c}return a}b=a.spherical;if(q(b)){a=b.length;if(3===a)Ab.clock=b[0],Ab.cone=b[1],Ab.magnitude=b[2],k.fromSpherical(Ab,ab),a=[ab.x,ab.y,ab.z];else{c=Array(a);for(d=0;d<a;d+=4)c[d]=b[d],Ab.clock=b[d+1],Ab.cone=b[d+2],Ab.magnitude=b[d+3],k.fromSpherical(Ab,ab),c[d+1]=ab.x,c[d+2]=ab.y,c[d+3]=ab.z;a=c}return a}b=a.cartographicRadians;if(q(b)){a=b.length;if(3===a)qb.longitude=b[0],qb.latitude=b[1],qb.height=b[2],u.WGS84.cartographicToCartesian(qb,ab),a=[ab.x,ab.y,ab.z];else{c=Array(a);for(d=0;d<a;d+=4)c[d]=b[d],qb.longitude=b[d+1],qb.latitude=b[d+2],qb.height=b[d+3],u.WGS84.cartographicToCartesian(qb,ab),c[d+1]=ab.x,c[d+2]=ab.y,c[d+3]=ab.z;a=c}return a}b=a.cartographicDegrees;if(q(b)){a=b.length;if(3===a)qb.longitude=H.toRadians(b[0]),qb.latitude=H.toRadians(b[1]),qb.height=b[2],u.WGS84.cartographicToCartesian(qb,ab),a=[ab.x,ab.y,ab.z];else{c=Array(a);for(d=0;d<a;d+=4)c[d]=b[d],qb.longitude=H.toRadians(b[d+1]),qb.latitude=H.toRadians(b[d+2]),qb.height=b[d+3],u.WGS84.cartographicToCartesian(qb,ab),c[d+1]=ab.x,c[d+2]=ab.y,c[d+3]=ab.z;a=c}return a}throw new K(JSON.stringify(a)+" is not a valid CZML interval.");}function cc(a,b){k.unpack(a,b,ab);k.normalize(ab,ab);k.pack(ab,a,b)}function sc(a,b){w.unpack(a,b,vb);w.normalize(vb,vb);w.pack(vb,a,b)}function Za(d){if("boolean"===typeof d)return Boolean;if("number"===typeof d)return Number;if("string"===typeof d)return String;if(d.hasOwnProperty("array"))return Array;if(d.hasOwnProperty("boolean"))return Boolean;if(d.hasOwnProperty("boundingRectangle"))return a;if(d.hasOwnProperty("cartesian2"))return f;if(d.hasOwnProperty("cartesian")||d.hasOwnProperty("spherical")||d.hasOwnProperty("cartographicRadians")||d.hasOwnProperty("cartographicDegrees"))return k;if(d.hasOwnProperty("unitCartesian")||d.hasOwnProperty("unitSpherical"))return ga;if(d.hasOwnProperty("rgba")||d.hasOwnProperty("rgbaf"))return e;if(d.hasOwnProperty("arcType"))return b;if(d.hasOwnProperty("classificationType"))return Z;if(d.hasOwnProperty("colorBlendMode"))return aa;if(d.hasOwnProperty("cornerType"))return h;if(d.hasOwnProperty("heightReference"))return U;if(d.hasOwnProperty("horizontalOrigin"))return W;if(d.hasOwnProperty("date"))return B;if(d.hasOwnProperty("labelStyle"))return M;if(d.hasOwnProperty("number"))return Number;if(d.hasOwnProperty("nearFarScalar"))return J;if(d.hasOwnProperty("distanceDisplayCondition"))return c;if(!d.hasOwnProperty("object")&&!d.hasOwnProperty("value")){if(d.hasOwnProperty("unitQuaternion"))return w;if(d.hasOwnProperty("shadowMode"))return R;if(d.hasOwnProperty("string"))return String;if(d.hasOwnProperty("stripeOrientation"))return Sa;if(d.hasOwnProperty("wsen")||d.hasOwnProperty("wsenDegrees"))return G;if(d.hasOwnProperty("uri"))return Q;if(d.hasOwnProperty("verticalOrigin"))return Y}return Object}function tc(g,l,m){switch(g){case b:return b[d(l.arcType,l)];case Array:return l.array;case Boolean:return d(l["boolean"],l);case a:return l.boundingRectangle;case f:return l.cartesian2;case k:return Jc(l);case ga:l=Jc(l);if(3===l.length)cc(l,0);else for(g=1;g<l.length;g+=4)cc(l,g);return l;case e:g=l.rgbaf;if(q(g))l=g;else if(l=l.rgba,q(l))if(m=l.length,m===e.packedLength)l=[e.byteToFloat(l[0]),e.byteToFloat(l[1]),e.byteToFloat(l[2]),e.byteToFloat(l[3])];else{g=Array(m);for(var p=0;p<m;p+=5)g[p]=l[p],g[p+1]=e.byteToFloat(l[p+1]),g[p+2]=e.byteToFloat(l[p+2]),g[p+3]=e.byteToFloat(l[p+3]),g[p+4]=e.byteToFloat(l[p+4]);l=g}else l=void 0;return l;case Z:return Z[d(l.classificationType,l)];case aa:return aa[d(l.colorBlendMode,l)];case h:return h[d(l.cornerType,l)];case U:return U[d(l.heightReference,l)];case W:return W[d(l.horizontalOrigin,l)];case Image:return tb(l,m);case B:return B.fromIso8601(d(l.date,l));case M:return M[d(l.labelStyle,l)];case Number:return d(l.number,l);case J:return l.nearFarScalar;case c:return l.distanceDisplayCondition;case Object:return d(d(l.object,l.value),l);case w:l=l.unitQuaternion;if(q(l))if(4===l.length)sc(l,0);else for(g=1;g<l.length;g+=5)sc(l,g);return l;case Fa:return d(l.number,l);case R:return R[d(d(l.shadowMode,l.shadows),l)];case String:return d(l.string,l);case Sa:return Sa[d(l.stripeOrientation,l)];case G:g=l.wsen;if(q(g))l=g;else if(l=l.wsenDegrees,q(l))if(m=l.length,m===G.packedLength)l=[H.toRadians(l[0]),H.toRadians(l[1]),H.toRadians(l[2]),H.toRadians(l[3])];else{g=Array(m);for(p=0;p<m;p+=5)g[p]=l[p],g[p+1]=H.toRadians(l[p+1]),g[p+2]=H.toRadians(l[p+2]),g[p+3]=H.toRadians(l[p+3]),g[p+4]=H.toRadians(l[p+4]);l=g}else l=void 0;return l;case Q:return tb(l,m);case Y:return Y[d(l.verticalOrigin,l)];default:throw new K(g);}}function wc(a,b){var c=a.interpolationAlgorithm;(q(c)||q(a.interpolationDegree))&&b.setInterpolationOptions({interpolationAlgorithm:vc[c],interpolationDegree:a.interpolationDegree});c=a.forwardExtrapolationType;q(c)&&(b.forwardExtrapolationType=A[c]);c=a.forwardExtrapolationDuration;q(c)&&(b.forwardExtrapolationDuration=c);c=a.backwardExtrapolationType;q(c)&&(b.backwardExtrapolationType=A[c]);c=a.backwardExtrapolationDuration;q(c)&&(b.backwardExtrapolationDuration=c)}function Xb(a,b,c,e,f,g,h){var k,l=e.interval;q(l)?(ma.iso8601=l,k=N.fromIso8601(ma),q(f)&&(k=N.intersect(k,f,yc))):q(f)&&(k=f);var m,p;f=!q(e.reference)&&!q(e.velocityReference);l=q(k)&&!k.equals(v.MAXIMUM_INTERVAL);if(!0===e["delete"]){if(!l){b[c]=void 0;return}return dc(b[c],k)}m=!1;f&&(p=tc(a,e,g),m=d(a.packedLength,1),g=d(p.length,1),m=!q(e.array)&&"string"!==typeof p&&g>m&&a!==Object);var r="function"===typeof a.unpack&&a!==Fa;if(m||l){g=b[c];var u,w=e.epoch;q(w)&&(u=B.fromIso8601(w));m&&!l?(g instanceof Qa||(g=new Qa(a),b[c]=g),g.addSamplesPackedArray(p,u),wc(e,g)):!m&&l?(k=k.clone(),k.data=f?r?a.unpack(p,0):p:Hb(a,h,e),q(g)||(g=f?new Ta:new F,b[c]=g),f&&g instanceof Ta||(g instanceof F||(h=v.MAXIMUM_INTERVAL.clone(),h.data=g,g=new F,b[c]=g,g.intervals.addInterval(h)),f&&(k.data=new na(k.data))),g.intervals.addInterval(k)):(q(g)||(g=new F,b[c]=g),g instanceof F||(h=v.MAXIMUM_INTERVAL.clone(),h.data=g,g=new F,b[c]=g,g.intervals.addInterval(h)),b=g.intervals,h=b.findInterval(k),q(h)&&h.data instanceof Qa||(h=k.clone(),h.data=new Qa(a),b.addInterval(h)),h.data.addSamplesPackedArray(p,u),wc(e,h.data))}else b[c]=f?new na(r?a.unpack(p,0):p):Hb(a,h,e)}function dc(a,b){if(a instanceof Qa)a.removeSamples(b);else if(a instanceof Ta)a.intervals.removeInterval(b);else if(a instanceof F){for(var c=a.intervals,d=0;d<c.length;++d){var e=N.intersect(c.get(d),b,yc);e.isEmpty||dc(e.data,b)}c.removeInterval(b)}}function ja(a,b,c,d,e,f,g){if(q(d))if(D(d))for(var h=0,k=d.length;h<k;h++)Xb(a,b,c,d[h],e,f,g);else Xb(a,b,c,d,e,f,g)}function uc(a,b,c,e,f,g){var h;f=c.interval;q(f)?(ma.iso8601=f,h=N.fromIso8601(ma),q(e)&&(h=N.intersect(h,e,yc))):q(e)&&(h=e);e=q(c.cartesianVelocity)?1:0;var l=k.packedLength*(e+1),m,p;f=!q(c.reference);var r=q(h)&&!h.equals(v.MAXIMUM_INTERVAL);if(!0===c["delete"]){if(!r){a[b]=void 0;return}return ec(a[b],h)}var u;p=!1;f&&(q(c.referenceFrame)&&(u=E[c.referenceFrame]),u=d(u,E.FIXED),m=Jc(c),p=d(m.length,1),p=p>l);if(p||r){var l=a[b],w,t=c.epoch;q(t)&&(w=B.fromIso8601(t));if(p&&!r){if(!(l instanceof Ja)||q(u)&&l.referenceFrame!==u)l=new Ja(u,e),a[b]=l;l.addSamplesPackedArray(m,w);wc(c,l)}else if(!p&&r)h=h.clone(),h.data=f?k.unpack(m):hb(g,c.reference),q(l)||(l=f?new Oa(u):new fa(u),a[b]=l),f&&l instanceof Oa&&q(u)&&l.referenceFrame===u||(l instanceof fa||(g=v.MAXIMUM_INTERVAL.clone(),g.data=l,l=new fa(l.referenceFrame),a[b]=l,l.intervals.addInterval(g)),f&&(h.data=new ka(h.data,u))),l.intervals.addInterval(h);else{q(l)?l instanceof fa||(g=v.MAXIMUM_INTERVAL.clone(),g.data=l,l=new fa(l.referenceFrame),a[b]=l,l.intervals.addInterval(g)):(l=new fa(u),a[b]=l);a=l.intervals;g=a.findInterval(h);if(!(q(g)&&g.data instanceof Ja)||q(u)&&g.data.referenceFrame!==u)g=h.clone(),g.data=new Ja(u,e),a.addInterval(g);g.data.addSamplesPackedArray(m,w);wc(c,g.data)}}else a[b]=f?new ka(k.unpack(m),u):hb(g,c.reference)}function ec(a,b){if(a instanceof Ja)a.removeSamples(b);else if(a instanceof Oa)a.intervals.removeInterval(b);else if(a instanceof fa){for(var c=a.intervals,d=0;d<c.length;++d){var e=N.intersect(c.get(d),b,yc);e.isEmpty||ec(e.data,b)}c.removeInterval(b)}}function ad(a,b,c,d,e,f){if(q(c))if(D(c))for(var g=0,h=c.length;g<h;g++)uc(a,b,c[g],d,e,f);else uc(a,b,c,d,e,f)}function Dc(a,b,c,d,g,h){var k,l=c.interval;q(l)?(ma.iso8601=l,k=N.fromIso8601(ma),q(d)&&(k=N.intersect(k,d,yc))):q(d)&&(k=d);d=a[b];var m,p;q(k)?(d instanceof X||(d=new X,a[b]=d),d=d.intervals,p=d.findInterval({start:k.start,stop:k.stop}),q(p)?m=p.data:(p=k.clone(),d.addInterval(p))):m=d;q(c.solidColor)?(m instanceof ba||(m=new ba),c=c.solidColor,ja(e,m,"color",c.color,void 0,void 0,h)):q(c.grid)?(m instanceof wa||(m=new wa),c=c.grid,ja(e,m,"color",c.color,void 0,g,h),ja(Number,m,"cellAlpha",c.cellAlpha,void 0,g,h),ja(f,m,"lineCount",c.lineCount,void 0,g,h),ja(f,m,"lineThickness",c.lineThickness,void 0,g,h),ja(f,m,"lineOffset",c.lineOffset,void 0,g,h)):q(c.image)?(m instanceof za||(m=new za),c=c.image,ja(Image,m,"image",c.image,void 0,g,h),ja(f,m,"repeat",c.repeat,void 0,g,h),ja(e,m,"color",c.color,void 0,g,h),ja(Boolean,m,"transparent",c.transparent,void 0,g,h)):q(c.stripe)?(m instanceof va||(m=new va),c=c.stripe,ja(Sa,m,"orientation",c.orientation,void 0,g,h),ja(e,m,"evenColor",c.evenColor,void 0,g,h),ja(e,m,"oddColor",c.oddColor,void 0,g,h),ja(Number,m,"offset",c.offset,void 0,g,h),ja(Number,m,"repeat",c.repeat,void 0,g,h)):q(c.polylineOutline)?(m instanceof Va||(m=new Va),c=c.polylineOutline,ja(e,m,"color",c.color,void 0,g,h),ja(e,m,"outlineColor",c.outlineColor,void 0,g,h),ja(Number,m,"outlineWidth",c.outlineWidth,void 0,g,h)):q(c.polylineGlow)?(m instanceof Ua||(m=new Ua),c=c.polylineGlow,ja(e,m,"color",c.color,void 0,g,h),ja(Number,m,"glowPower",c.glowPower,void 0,g,h),ja(Number,m,"taperPower",c.taperPower,void 0,g,h)):q(c.polylineArrow)?(m instanceof ya||(m=new ya),c=c.polylineArrow,ja(e,m,"color",c.color,void 0,void 0,h)):q(c.polylineDash)?(m instanceof Aa||(m=new Aa),c=c.polylineDash,ja(e,m,"color",c.color,void 0,void 0,h),ja(e,m,"gapColor",c.gapColor,void 0,void 0,h),ja(Number,m,"dashLength",c.dashLength,void 0,g,h),ja(Number,m,"dashPattern",c.dashPattern,void 0,g,h)):q(c.checkerboard)&&(m instanceof V||(m=new V),c=c.checkerboard,ja(e,m,"evenColor",c.evenColor,void 0,g,h),ja(e,m,"oddColor",c.oddColor,void 0,g,h),ja(f,m,"repeat",c.repeat,void 0,g,h));q(p)?p.data=m:a[b]=m}function fc(a,b,c,d,e,f){if(q(c))if(D(c))for(var g=0,h=c.length;g<h;g++)Dc(a,b,c[g],d,e,f);else Dc(a,b,c,d,e,f)}function Pa(a,b,c,d){var e=c.references;q(e)?(e=e.map(function(a){return hb(d,a)}),c=c.interval,q(c)?(c=N.fromIso8601(c),a[b]instanceof fa||(c.data=new Ha(e),e=new F,e.intervals.addInterval(c),a[b]=e)):a[b]=new Ha(e)):ja(Array,a,b,c,void 0,void 0,d)}function Vc(a,b,c,d){if(q(c))if(D(c))for(var e=0,f=c.length;e<f;++e)Pa(a,b,c[e],d);else Pa(a,b,c,d)}function xc(a,b,c,d){if(q(c.references)){var e=c.references.map(function(a){return hb(d,a)});c=c.interval;q(c)?(c=N.fromIso8601(c),a[b]instanceof fa||(c.data=new xa(e),e=new fa,e.intervals.addInterval(c),a[b]=e)):a[b]=new xa(e)}else q(c.cartesian)?c.array=k.unpackArray(c.cartesian):q(c.cartographicRadians)?c.array=k.fromRadiansArrayHeights(c.cartographicRadians):q(c.cartographicDegrees)&&(c.array=k.fromDegreesArrayHeights(c.cartographicDegrees)),q(c.array)&&ja(Array,a,b,c,void 0,void 0,d)}function Kc(a,b,c,d){if(q(c))if(D(c))for(var e=0,f=c.length;e<f;e++)xc(a,b,c[e],d);else xc(a,b,c,d)}function Lc(a,b,c,d,e){var f,g=b.interval;q(g)?(ma.iso8601=g,f=N.fromIso8601(ma),q(c)&&(f=N.intersect(f,c,yc))):q(c)&&(f=c);c=a.nodeTransformations;for(var g=Object.keys(b),h=0,l=g.length;h<l;++h){var m=g[h];if("interval"!==m){var p=b[m];if(q(p)){q(c)||(a.nodeTransformations=c=new Ma);c.hasProperty(m)||c.addProperty(m);var r=c[m];q(r)||(c[m]=r=new ra);ja(k,r,"translation",p.translation,f,d,e);ja(w,r,"rotation",p.rotation,f,d,e);ja(k,r,"scale",p.scale,f,d,e)}}}}function Oc(a,b,c,d,e){var f,g=b.interval;q(g)?(ma.iso8601=g,f=N.fromIso8601(ma),q(c)&&(f=N.intersect(f,c,yc))):q(c)&&(f=c);c=a.articulations;for(var g=Object.keys(b),h=0,k=g.length;h<k;++h){var l=g[h];if("interval"!==l){var m=b[l];q(m)&&(q(c)||(a.articulations=c=new Ma),c.hasProperty(l)||c.addProperty(l),ja(Number,c,l,m,f,d,e))}}}function ed(a){return a?b.GEODESIC:b.NONE}function Rc(a,b,c,e,f){var g=a.id;q(g)||(g=p());Sc=g;if(!q(f._version)&&"document"!==g)throw new K("The first CZML packet is required to be the document object.");if(!0===a["delete"])b.removeById(g);else if("document"===g){b=a.version;if(q(b)&&"string"===typeof b&&(c=b.split("."),2===c.length)){if("1"!==c[0])throw new K("Cesium only supports CZML version 1.");f._version=b}if(!q(f._version))throw new K("CZML version information invalid.  It is expected to be a property on the document object in the \x3cMajor\x3e.\x3cMinor\x3e version format.");b=f._documentPacket;q(a.name)&&(b.name=a.name);a=a.clock;q(a)&&(c=b.clock,q(c)?(c.interval=d(a.interval,c.interval),c.currentTime=d(a.currentTime,c.currentTime),c.range=d(a.range,c.range),c.step=d(a.step,c.step),c.multiplier=d(a.multiplier,c.multiplier)):b.clock={interval:a.interval,currentTime:a.currentTime,range:a.range,step:a.step,multiplier:a.multiplier})}else for(f=b.getOrCreateEntity(g),g=a.parent,q(g)&&(f.parent=b.getOrCreateEntity(g)),g=c.length-1;-1<g;g--)c[g](f,a,b,e);Sc=void 0}function Pc(a){var b,c=a._documentPacket.clock;if(!q(c)){if(!q(a._clock)&&(b=a._entityCollection.computeAvailability(),!b.start.equals(v.MINIMUM_VALUE))){var c=b.start,e=b.stop;b=B.secondsDifference(e,c);var f=Math.round(b/120);b=new pa;b.startTime=B.clone(c);b.stopTime=B.clone(e);b.clockRange=l.LOOP_STOP;b.multiplier=f;b.currentTime=B.clone(c);b.clockStep=m.SYSTEM_CLOCK_MULTIPLIER;a._clock=b;return!0}return!1}q(a._clock)?b=a._clock.clone():(b=new pa,b.startTime=v.MINIMUM_VALUE.clone(),b.stopTime=v.MAXIMUM_VALUE.clone(),b.currentTime=v.MINIMUM_VALUE.clone(),b.clockRange=l.LOOP_STOP,b.clockStep=m.SYSTEM_CLOCK_MULTIPLIER,b.multiplier=1);q(c.interval)&&(ma.iso8601=c.interval,e=N.fromIso8601(ma),b.startTime=e.start,b.stopTime=e.stop);q(c.currentTime)&&(b.currentTime=B.fromIso8601(c.currentTime));q(c.range)&&(b.clockRange=d(l[c.range],l.LOOP_STOP));q(c.step)&&(b.clockStep=d(m[c.step],m.SYSTEM_CLOCK_MULTIPLIER));q(c.multiplier)&&(b.multiplier=c.multiplier);return b.equals(a._clock)?!1:(a._clock=b.clone(a._clock),!0)}function bd(a,b,c,e){if(!q(b))throw new r("czml is required.");c=d(c,d.EMPTY_OBJECT);var f=b,g=c.sourceUri;if("string"===typeof b||b instanceof L)b=L.createIfNeeded(b),f=b.fetchJson(),g=d(g,b.clone());g=L.createIfNeeded(g);ha.setLoading(a,!0);return S(f,function(b){var c=g;ha.setLoading(a,!0);var d=a._entityCollection;e&&(a._version=void 0,a._documentPacket=new Mc,d.removeAll());Yb._processCzml(b,d,c,void 0,a);b=Pc(a);d=a._documentPacket;q(d.name)&&a._name!==d.name?(a._name=d.name,b=!0):!q(a._name)&&q(c)&&(a._name=z(c.getUrlComponent()),b=!0);ha.setLoading(a,!1);b&&a._changed.raiseEvent(a);return a}).otherwise(function(b){ha.setLoading(a,!1);a._error.raiseEvent(a,b);console.log(b);return S.reject(b)})}function Mc(){this.clock=this.name=void 0}function Yb(a){this._name=a;this._changed=new y;this._error=new y;this._isLoading=!1;this._loading=new y;this._clock=void 0;this._documentPacket=new Mc;this._version=void 0;this._entityCollection=new ta(this);this._entityCluster=new ua}ga.packedLength=k.packedLength;ga.unpack=k.unpack;ga.pack=k.pack;var Sc,ab=new k,Ab=new P,qb=new g,yc=new N,vb=new w,vc={HERMITE:x,LAGRANGE:C,LINEAR:I},ma={iso8601:void 0};Yb.load=function(a,b){return(new Yb).load(a,b)};t(Yb.prototype,{name:{get:function(){return this._name}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(a){this._entityCollection.show=a}},clustering:{get:function(){return this._entityCluster},set:function(a){if(!q(a))throw new r("value must be defined.");this._entityCluster=a}}});Yb.updaters=[function(b,d,g,h){d=d.billboard;if(q(d)){var l,m=d.interval;q(m)&&(ma.iso8601=m,l=N.fromIso8601(ma));m=b.billboard;q(m)||(b.billboard=m=new ca);ja(Boolean,m,"show",d.show,l,h,g);ja(Image,m,"image",d.image,l,h,g);ja(Number,m,"scale",d.scale,l,h,g);ja(f,m,"pixelOffset",d.pixelOffset,l,h,g);ja(k,m,"eyeOffset",d.eyeOffset,l,h,g);ja(W,m,"horizontalOrigin",d.horizontalOrigin,l,h,g);ja(Y,m,"verticalOrigin",d.verticalOrigin,l,h,g);ja(U,m,"heightReference",d.heightReference,l,h,g);ja(e,m,"color",d.color,l,h,g);ja(Fa,m,"rotation",d.rotation,l,h,g);b=m;var p=d.alignedAxis,r=l;q(p)&&ja(ga,b,"alignedAxis",p,r,h,g);ja(Boolean,m,"sizeInMeters",d.sizeInMeters,l,h,g);ja(Number,m,"width",d.width,l,h,g);ja(Number,m,"height",d.height,l,h,g);ja(J,m,"scaleByDistance",d.scaleByDistance,l,h,g);ja(J,m,"translucencyByDistance",d.translucencyByDistance,l,h,g);ja(J,m,"pixelOffsetScaleByDistance",d.pixelOffsetScaleByDistance,l,h,g);ja(a,m,"imageSubRegion",d.imageSubRegion,l,h,g);ja(c,m,"distanceDisplayCondition",d.distanceDisplayCondition,l,h,g);ja(Number,m,"disableDepthTestDistance",d.disableDepthTestDistance,l,h,g)}},function(a,b,d,f){b=b.box;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.box;q(h)||(a.box=h=new T);ja(Boolean,h,"show",b.show,g,f,d);ja(k,h,"dimensions",b.dimensions,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(Boolean,h,"fill",b.fill,g,f,d);fc(h,"material",b.material,g,f,d);ja(Boolean,h,"outline",b.outline,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d)}},function(a,b,d,f){b=b.corridor;if(q(b)){var g,k=b.interval;q(k)&&(ma.iso8601=k,g=N.fromIso8601(ma));k=a.corridor;q(k)||(a.corridor=k=new ia);ja(Boolean,k,"show",b.show,g,f,d);Kc(k,"positions",b.positions,d);ja(Number,k,"width",b.width,g,f,d);ja(Number,k,"height",b.height,g,f,d);ja(U,k,"heightReference",b.heightReference,g,f,d);ja(Number,k,"extrudedHeight",b.extrudedHeight,g,f,d);ja(U,k,"extrudedHeightReference",b.extrudedHeightReference,g,f,d);ja(h,k,"cornerType",b.cornerType,g,f,d);ja(Number,k,"granularity",b.granularity,g,f,d);ja(Boolean,k,"fill",b.fill,g,f,d);fc(k,"material",b.material,g,f,d);ja(Boolean,k,"outline",b.outline,g,f,d);ja(e,k,"outlineColor",b.outlineColor,g,f,d);ja(Number,k,"outlineWidth",b.outlineWidth,g,f,d);ja(R,k,"shadows",b.shadows,g,f,d);ja(c,k,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d);ja(Z,k,"classificationType",b.classificationType,g,f,d);ja(Number,k,"zIndex",b.zIndex,g,f,d)}},function(a,b,d,f){b=b.cylinder;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.cylinder;q(h)||(a.cylinder=h=new la);ja(Boolean,h,"show",b.show,g,f,d);ja(Number,h,"length",b.length,g,f,d);ja(Number,h,"topRadius",b.topRadius,g,f,d);ja(Number,h,"bottomRadius",b.bottomRadius,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(Boolean,h,"fill",b.fill,g,f,d);fc(h,"material",b.material,g,f,d);ja(Boolean,h,"outline",b.outline,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(Number,h,"numberOfVerticalLines",b.numberOfVerticalLines,g,f,d);ja(Number,h,"slices",b.slices,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d)}},function(a,b,d,f){b=b.ellipse;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.ellipse;q(h)||(a.ellipse=h=new oa);ja(Boolean,h,"show",b.show,g,f,d);ja(Number,h,"semiMajorAxis",b.semiMajorAxis,g,f,d);ja(Number,h,"semiMinorAxis",b.semiMinorAxis,g,f,d);ja(Number,h,"height",b.height,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(Number,h,"extrudedHeight",b.extrudedHeight,g,f,d);ja(U,h,"extrudedHeightReference",b.extrudedHeightReference,g,f,d);ja(Fa,h,"rotation",b.rotation,g,f,d);ja(Fa,h,"stRotation",b.stRotation,g,f,d);ja(Number,h,"granularity",b.granularity,g,f,d);ja(Boolean,h,"fill",b.fill,g,f,d);fc(h,"material",b.material,g,f,d);ja(Boolean,h,"outline",b.outline,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(Number,h,"numberOfVerticalLines",b.numberOfVerticalLines,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d);ja(Z,h,"classificationType",b.classificationType,g,f,d);ja(Number,h,"zIndex",b.zIndex,g,f,d)}},function(a,b,d,f){b=b.ellipsoid;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.ellipsoid;q(h)||(a.ellipsoid=h=new qa);ja(Boolean,h,"show",b.show,g,f,d);ja(k,h,"radii",b.radii,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(Boolean,h,"fill",b.fill,g,f,d);fc(h,"material",b.material,g,f,d);ja(Boolean,h,"outline",b.outline,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(Number,h,"stackPartitions",b.stackPartitions,g,f,d);ja(Number,h,"slicePartitions",b.slicePartitions,g,f,d);ja(Number,h,"subdivisions",b.subdivisions,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d)}},function(a,b,d,g){b=b.label;if(q(b)){var h,l=b.interval;q(l)&&(ma.iso8601=l,h=N.fromIso8601(ma));l=a.label;q(l)||(a.label=l=new Da);ja(Boolean,l,"show",b.show,h,g,d);ja(String,l,"text",b.text,h,g,d);ja(String,l,"font",b.font,h,g,d);ja(M,l,"style",b.style,h,g,d);ja(Number,l,"scale",b.scale,h,g,d);ja(Boolean,l,"showBackground",b.showBackground,h,g,d);ja(e,l,"backgroundColor",b.backgroundColor,h,g,d);ja(f,l,"backgroundPadding",b.backgroundPadding,h,g,d);ja(f,l,"pixelOffset",b.pixelOffset,h,g,d);ja(k,l,"eyeOffset",b.eyeOffset,h,g,d);ja(W,l,"horizontalOrigin",b.horizontalOrigin,h,g,d);ja(Y,l,"verticalOrigin",b.verticalOrigin,h,g,d);ja(U,l,"heightReference",b.heightReference,h,g,d);ja(e,l,"fillColor",b.fillColor,h,g,d);ja(e,l,"outlineColor",b.outlineColor,h,g,d);ja(Number,l,"outlineWidth",b.outlineWidth,h,g,d);ja(J,l,"translucencyByDistance",b.translucencyByDistance,h,g,d);ja(J,l,"pixelOffsetScaleByDistance",b.pixelOffsetScaleByDistance,h,g,d);ja(J,l,"scaleByDistance",b.scaleByDistance,h,g,d);ja(c,l,"distanceDisplayCondition",b.distanceDisplayCondition,h,g,d);ja(Number,l,"disableDepthTestDistance",b.disableDepthTestDistance,h,g,d)}},function(a,b,d,f){b=b.model;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.model;q(h)||(a.model=h=new Ba);ja(Boolean,h,"show",b.show,g,f,d);ja(Q,h,"uri",b.gltf,g,f,d);ja(Number,h,"scale",b.scale,g,f,d);ja(Number,h,"minimumPixelSize",b.minimumPixelSize,g,f,d);ja(Number,h,"maximumScale",b.maximumScale,g,f,d);ja(Boolean,h,"incrementallyLoadTextures",b.incrementallyLoadTextures,g,f,d);ja(Boolean,h,"runAnimations",b.runAnimations,g,f,d);ja(Boolean,h,"clampAnimations",b.clampAnimations,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(e,h,"silhouetteColor",b.silhouetteColor,g,f,d);ja(Number,h,"silhouetteSize",b.silhouetteSize,g,f,d);ja(e,h,"color",b.color,g,f,d);ja(aa,h,"colorBlendMode",b.colorBlendMode,g,f,d);ja(Number,h,"colorBlendAmount",b.colorBlendAmount,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d);var k,l=b.nodeTransformations;if(q(l))if(D(l))for(a=0,k=l.length;a<k;a++)Lc(h,l[a],g,f,d);else Lc(h,l,g,f,d);b=b.articulations;if(q(b))if(D(b))for(a=0,k=b.length;a<k;a++)Oc(h,b[a],g,f,d);else Oc(h,b,g,f,d)}},function(a,b,c,e){a.name=d(b.name,a.name)},function(a,b,c,d){b=b.description;q(b)&&ja(String,a,"description",b,void 0,d,c)},function(a,b,d,e){b=b.path;if(q(b)){var f,g=b.interval;q(g)&&(ma.iso8601=g,f=N.fromIso8601(ma));g=a.path;q(g)||(a.path=g=new Ea);ja(Boolean,g,"show",b.show,f,e,d);ja(Number,g,"leadTime",b.leadTime,f,e,d);ja(Number,g,"trailTime",b.trailTime,f,e,d);ja(Number,g,"width",b.width,f,e,d);ja(Number,g,"resolution",b.resolution,f,e,d);fc(g,"material",b.material,f,e,d);ja(c,g,"distanceDisplayCondition",b.distanceDisplayCondition,f,e,d)}},function(a,b,d,f){b=b.point;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.point;q(h)||(a.point=h=new Ga);ja(Boolean,h,"show",b.show,g,f,d);ja(Number,h,"pixelSize",b.pixelSize,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(e,h,"color",b.color,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(J,h,"scaleByDistance",b.scaleByDistance,g,f,d);ja(J,h,"translucencyByDistance",b.translucencyByDistance,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d);ja(Number,h,"disableDepthTestDistance",b.disableDepthTestDistance,g,f,d)}},function(a,d,f,g){d=d.polygon;if(q(d)){var h,k=d.interval;q(k)&&(ma.iso8601=k,h=N.fromIso8601(ma));k=a.polygon;q(k)||(a.polygon=k=new Ca);ja(Boolean,k,"show",d.show,h,g,f);Kc(k,"hierarchy",d.positions,f);ja(Number,k,"height",d.height,h,g,f);ja(U,k,"heightReference",d.heightReference,h,g,f);ja(Number,k,"extrudedHeight",d.extrudedHeight,h,g,f);ja(U,k,"extrudedHeightReference",d.extrudedHeightReference,h,g,f);ja(Fa,k,"stRotation",d.stRotation,h,g,f);ja(Number,k,"granularity",d.granularity,h,g,f);ja(Boolean,k,"fill",d.fill,h,g,f);fc(k,"material",d.material,h,g,f);ja(Boolean,k,"outline",d.outline,h,g,f);ja(e,k,"outlineColor",d.outlineColor,h,g,f);ja(Number,k,"outlineWidth",d.outlineWidth,h,g,f);ja(Boolean,k,"perPositionHeight",d.perPositionHeight,h,g,f);ja(Boolean,k,"closeTop",d.closeTop,h,g,f);ja(Boolean,k,"closeBottom",d.closeBottom,h,g,f);ja(b,k,"arcType",d.arcType,h,g,f);ja(R,k,"shadows",d.shadows,h,g,f);ja(c,k,"distanceDisplayCondition",d.distanceDisplayCondition,h,g,f);ja(Z,k,"classificationType",d.classificationType,h,g,f);ja(Number,k,"zIndex",d.zIndex,h,g,f)}},function(a,d,e,f){d=d.polyline;if(q(d)){var g,h=d.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.polyline;q(h)||(a.polyline=h=new sa);ja(Boolean,h,"show",d.show,g,f,e);Kc(h,"positions",d.positions,e);ja(Number,h,"width",d.width,g,f,e);ja(Number,h,"granularity",d.granularity,g,f,e);fc(h,"material",d.material,g,f,e);fc(h,"depthFailMaterial",d.depthFailMaterial,g,f,e);ja(b,h,"arcType",d.arcType,g,f,e);ja(Boolean,h,"clampToGround",d.clampToGround,g,f,e);ja(R,h,"shadows",d.shadows,g,f,e);ja(c,h,"distanceDisplayCondition",d.distanceDisplayCondition,g,f,e);ja(Z,h,"classificationType",d.classificationType,g,f,e);ja(Number,h,"zIndex",d.zIndex,g,f,e);q(d.followSurface)&&!q(d.arcType)&&(a={},ja(Boolean,a,"followSurface",d.followSurface,g,f,e),h.arcType=db(a.followSurface,ed))}},function(a,b,c,d){b=b.properties;if(q(b)){q(a.properties)||(a.properties=new Ma);for(var e in b)if(b.hasOwnProperty(e)){a.properties.hasProperty(e)||a.properties.addProperty(e);var f=b[e];if(D(f))for(var g=0,h=f.length;g<h;g++)Xb(Za(f[g]),a.properties,e,f[g],void 0,d,c);else Xb(Za(f),a.properties,e,f,void 0,d,c)}}},function(a,b,d,f){b=b.rectangle;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.rectangle;q(h)||(a.rectangle=h=new Ia);ja(Boolean,h,"show",b.show,g,f,d);ja(G,h,"coordinates",b.coordinates,g,f,d);ja(Number,h,"height",b.height,g,f,d);ja(U,h,"heightReference",b.heightReference,g,f,d);ja(Number,h,"extrudedHeight",b.extrudedHeight,g,f,d);ja(U,h,"extrudedHeightReference",b.extrudedHeightReference,g,f,d);ja(Fa,h,"rotation",b.rotation,g,f,d);ja(Fa,h,"stRotation",b.stRotation,g,f,d);ja(Number,h,"granularity",b.granularity,g,f,d);ja(Boolean,h,"fill",b.fill,g,f,d);fc(h,"material",b.material,g,f,d);ja(Boolean,h,"outline",b.outline,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d);ja(Z,h,"classificationType",b.classificationType,g,f,d);ja(Number,h,"zIndex",b.zIndex,g,f,d)}},function(a,b,c,d){b=b.position;q(b)&&ad(a,"position",b,void 0,d,c)},function(a,b,c,d){b=b.viewFrom;q(b)&&ja(k,a,"viewFrom",b,void 0,d,c)},function(a,b,d,f){b=b.wall;if(q(b)){var g,h=b.interval;q(h)&&(ma.iso8601=h,g=N.fromIso8601(ma));h=a.wall;q(h)||(a.wall=h=new Ra);ja(Boolean,h,"show",b.show,g,f,d);Kc(h,"positions",b.positions,d);Vc(h,"minimumHeights",b.minimumHeights,d);Vc(h,"maximumHeights",b.maximumHeights,d);ja(Number,h,"granularity",b.granularity,g,f,d);ja(Boolean,h,"fill",b.fill,g,f,d);fc(h,"material",b.material,g,f,d);ja(Boolean,h,"outline",b.outline,g,f,d);ja(e,h,"outlineColor",b.outlineColor,g,f,d);ja(Number,h,"outlineWidth",b.outlineWidth,g,f,d);ja(R,h,"shadows",b.shadows,g,f,d);ja(c,h,"distanceDisplayCondition",b.distanceDisplayCondition,g,f,d)}},function(a,b,c,d){b=b.orientation;q(b)&&ja(w,a,"orientation",b,void 0,d,c)},function(a,b,c,d){c=b.availability;if(q(c)){var e;if(D(c)){d=c.length;for(var f=0;f<d;f++)q(e)||(e=new O),ma.iso8601=c[f],b=N.fromIso8601(ma),e.addInterval(b)}else ma.iso8601=c,b=N.fromIso8601(ma),e=new O,e.addInterval(b);a.availability=e}}];Yb.prototype.process=function(a,b){return bd(this,a,b,!1)};Yb.prototype.load=function(a,b){return bd(this,a,b,!0)};Yb.processPacketData=ja;Yb.processPositionPacketData=ad;Yb.processMaterialPacketData=fc;Yb._processCzml=function(a,b,c,d,e){d=q(d)?d:Yb.updaters;if(D(a))for(var f=0,g=a.length;f<g;f++)Rc(a[f],b,d,c,e);else Rc(a,b,d,c,e)};return Yb});F("DataSources/DataSourceCollection","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Event ../Core/Math ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e){function h(){this._dataSources=[];this._dataSourceAdded=new l;this._dataSourceRemoved=new l;this._dataSourceMoved=new l}function p(b,d){if(!a(d))throw new g("dataSource is required.");var e=b.indexOf(d);if(-1===e)throw new g("dataSource is not in this collection.");return e}function d(a,b,d){var c=a._dataSources,e=c.length-1;b=m.clamp(b,0,e);d=m.clamp(d,0,e);b!==d&&(e=c[b],c[b]=c[d],c[d]=e,a.dataSourceMoved.raiseEvent(e,d,b))}f(h.prototype,{length:{get:function(){return this._dataSources.length}},dataSourceAdded:{get:function(){return this._dataSourceAdded}},dataSourceRemoved:{get:function(){return this._dataSourceRemoved}},dataSourceMoved:{get:function(){return this._dataSourceMoved}}});h.prototype.add=function(b){if(!a(b))throw new g("dataSource is required.");var d=this,f=this._dataSources;return e(b,function(a){f===d._dataSources&&(d._dataSources.push(a),d._dataSourceAdded.raiseEvent(d,a));return a})};h.prototype.remove=function(a,d){d=b(d,!1);var e=this._dataSources.indexOf(a);return-1!==e?(this._dataSources.splice(e,1),this._dataSourceRemoved.raiseEvent(this,a),d&&"function"===typeof a.destroy&&a.destroy(),!0):!1};h.prototype.removeAll=function(a){a=b(a,!1);for(var d=this._dataSources,e=0,c=d.length;e<c;++e){var f=d[e];this._dataSourceRemoved.raiseEvent(this,f);a&&"function"===typeof f.destroy&&f.destroy()}this._dataSources=[]};h.prototype.contains=function(a){return-1!==this.indexOf(a)};h.prototype.indexOf=function(a){return this._dataSources.indexOf(a)};h.prototype.get=function(b){if(!a(b))throw new g("index is required.");return this._dataSources[b]};h.prototype.raise=function(a){a=p(this._dataSources,a);d(this,a,a+1)};h.prototype.lower=function(a){a=p(this._dataSources,a);d(this,a,a-1)};h.prototype.raiseToTop=function(a){var b=p(this._dataSources,a);b!==this._dataSources.length-1&&(this._dataSources.splice(b,1),this._dataSources.push(a),this.dataSourceMoved.raiseEvent(a,this._dataSources.length-1,b))};h.prototype.lowerToBottom=function(a){var b=p(this._dataSources,a);0!==b&&(this._dataSources.splice(b,1),this._dataSources.splice(0,0,a),this.dataSourceMoved.raiseEvent(a,0,b))};h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){this.removeAll(!0);return k(this)};return h});F("Scene/PrimitiveCollection","../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError".split(" "),function(b,a,f,k,g,l){function m(e){e=a(e,a.EMPTY_OBJECT);this._primitives=[];this._guid=b();this._zIndex=void 0;this.show=a(e.show,!0);this.destroyPrimitives=a(e.destroyPrimitives,!0)}function e(a,b){if(!a.contains(b))throw new l("primitive is not in this collection.");return a._primitives.indexOf(b)}k(m.prototype,{length:{get:function(){return this._primitives.length}}});m.prototype.add=function(a){if(!f(a))throw new l("primitive is required.");var b=a._external=a._external||{};(b._composites=b._composites||{})[this._guid]={collection:this};this._primitives.push(a);return a};m.prototype.remove=function(a){if(this.contains(a)){var b=this._primitives.indexOf(a);if(-1!==b)return this._primitives.splice(b,1),delete a._external._composites[this._guid],this.destroyPrimitives&&a.destroy(),!0}return!1};m.prototype.removeAndDestroy=function(a){var b=this.remove(a);b&&!this.destroyPrimitives&&a.destroy();return b};m.prototype.removeAll=function(){for(var a=this._primitives,b=a.length,d=0;d<b;++d)delete a[d]._external._composites[this._guid],this.destroyPrimitives&&a[d].destroy();this._primitives=[]};m.prototype.contains=function(a){return!!(f(a)&&a._external&&a._external._composites&&a._external._composites[this._guid])};m.prototype.raise=function(a){if(f(a)){a=e(this,a);var b=this._primitives;if(a!==b.length-1){var d=b[a];b[a]=b[a+1];b[a+1]=d}}};m.prototype.raiseToTop=function(a){if(f(a)){var b=e(this,a),d=this._primitives;b!==d.length-1&&(d.splice(b,1),d.push(a))}};m.prototype.lower=function(a){if(f(a)){a=e(this,a);var b=this._primitives;if(0!==a){var d=b[a];b[a]=b[a-1];b[a-1]=d}}};m.prototype.lowerToBottom=function(a){if(f(a)){var b=e(this,a),d=this._primitives;0!==b&&(d.splice(b,1),d.unshift(a))}};m.prototype.get=function(a){if(!f(a))throw new l("index is required.");return this._primitives[a]};m.prototype.update=function(a){if(this.show)for(var b=this._primitives,d=0;d<b.length;++d)b[d].update(a)};m.prototype.prePassesUpdate=function(a){for(var b=this._primitives,d=0;d<b.length;++d){var e=b[d];f(e.prePassesUpdate)&&e.prePassesUpdate(a)}};m.prototype.updateForPass=function(a,b){for(var d=this._primitives,e=0;e<d.length;++e){var g=d[e];f(g.updateForPass)&&g.updateForPass(a,b)}};m.prototype.postPassesUpdate=function(a){for(var b=this._primitives,d=0;d<b.length;++d){var e=b[d];f(e.postPassesUpdate)&&e.postPassesUpdate(a)}};m.prototype.isDestroyed=function(){return!1};m.prototype.destroy=function(){this.removeAll();return g(this)};return m});F("Scene/OrderedGroundPrimitiveCollection","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Check ../Core/DeveloperError ./PrimitiveCollection".split(" "),function(b,a,f,k,g,l,m){function e(){this._length=0;this._collections={};this._collectionsArray=[];this.show=!0}f(e.prototype,{length:{get:function(){return this._length}}});e.prototype.add=function(e,f){g.defined("primitive",e);a(f)&&g.typeOf.number("zIndex",f);f=b(f,0);var d=this._collections[f];if(!a(d)){d=new m({destroyPrimitives:!1});d._zIndex=f;this._collections[f]=d;for(var h=this._collectionsArray,k=0;k<h.length&&h[k]._zIndex<f;)k++;h.splice(k,0,d)}d.add(e);this._length++;e._zIndex=f;return e};e.prototype.set=function(a,b){g.defined("primitive",a);g.typeOf.number("zIndex",b);if(b===a._zIndex)return a;this.remove(a,!0);this.add(a,b);return a};e.prototype.remove=function(a,b){if(this.contains(a)){var d=a._zIndex,e=this._collections[d],f;(f=b?e.remove(a):e.removeAndDestroy(a))&&this._length--;0===e.length&&(this._collectionsArray.splice(this._collectionsArray.indexOf(e),1),this._collections[d]=void 0,e.destroy());return f}return!1};e.prototype.removeAll=function(){for(var a=this._collectionsArray,b=0;b<a.length;b++){var d=a[b];d.destroyPrimitives=!0;d.destroy()}this._collections={};this._collectionsArray=[];this._length=0};e.prototype.contains=function(b){if(!a(b))return!1;var e=this._collections[b._zIndex];return a(e)&&e.contains(b)};e.prototype.update=function(a){if(this.show)for(var b=this._collectionsArray,d=0;d<b.length;d++)b[d].update(a)};e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){this.removeAll();return k(this)};return e});F("FeShadersEx/Materials/RectangularSensorVS",[],function(){return"attribute vec4 position;\nattribute vec3 normal;\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvoid main()\n{\n    gl_Position \x3d czm_modelViewProjection * position;\n    v_position \x3d vec3(position);\n    v_positionWC \x3d (czm_model * position).xyz;\n    v_positionEC \x3d (czm_modelView * position).xyz;\n    v_normalEC \x3d czm_normal * normal;\n}"});F("FeShadersEx/Materials/RectangularSensorFS",[],function(){return"\n#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\nuniform float u_radius;\nuniform float u_xHalfAngle;\nuniform float u_yHalfAngle;\nuniform float u_normalDirection;\nuniform float u_type;\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\n    czm_materialInput materialInput;\n    vec3 pointMC \x3d (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\n    materialInput.st \x3d sensor2dTextureCoordinates(sensorRadius, pointMC);\n    materialInput.str \x3d pointMC / sensorRadius;\n    vec3 positionToEyeEC \x3d -v_positionEC;\n    materialInput.positionToEyeEC \x3d positionToEyeEC;\n    vec3 normalEC \x3d normalize(v_normalEC);\n    materialInput.normalEC \x3d u_normalDirection * normalEC;\n    czm_material material \x3d czm_getMaterial(materialInput);\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\n}\nbool isOnBoundary(float value, float epsilon)\n{\n    float width \x3d getIntersectionWidth();\n    float tolerance \x3d width * epsilon;\n#ifdef GL_OES_standard_derivatives\n    float delta \x3d max(abs(dFdx(value)), abs(dFdy(value)));\n    float pixels \x3d width * delta;\n    float temp \x3d abs(value);\n    // There are a couple things going on here.\n    // First we test the value at the current fragment to see if it is within the tolerance.\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\n    // but we don't want to admit points that are obviously not on the surface.\n    // For example, if we are looking for [value] to be close to 0, but value is 1 and the adjacent value is 2,\n    // then the delta would be 1 and [temp - delta] would be [1 - 1] which is zero even though neither of\n    // the points is close to zero.\n    return temp \x3c tolerance \x26\x26 temp \x3c pixels || (delta \x3c 10.0 * tolerance \x26\x26 temp - delta \x3c tolerance \x26\x26 temp \x3c pixels);\n#else\n    return abs(value) \x3c tolerance;\n#endif\n}\nvec4 shade(bool isOnBoundary)\n{\n    if (u_showIntersection \x26\x26 isOnBoundary)\n    {\n        return getIntersectionColor();\n    }\n    if(u_type \x3d\x3d 1.0){\n        return getLineColor();\n    }\n    return getColor(u_radius, v_positionEC);\n}\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\n{\n    vec3 scaled \x3d ellipsoid.inverseRadii * point;\n    return dot(scaled, scaled) - 1.0;\n}\nvoid main()\n{\n    vec3 sensorVertexWC \x3d czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\n    vec3 sensorVertexEC \x3d czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\n    float positionX \x3d v_position.x;\n    float positionY \x3d v_position.y;\n    float positionZ \x3d v_position.z;\n    vec3 zDir \x3d vec3(0.0, 0.0, 1.0);\n    vec3 lineX \x3d vec3(positionX, 0 ,positionZ);\n    vec3 lineY \x3d vec3(0, positionY, positionZ);\n    float resX \x3d dot(normalize(lineX), zDir);\n    if(resX \x3c cos(u_xHalfAngle)-0.00001){\n        discard;\n    }\n    float resY \x3d dot(normalize(lineY), zDir);\n    if(resY \x3c cos(u_yHalfAngle)-0.00001){\n        discard;\n    }\n    czm_ellipsoid ellipsoid \x3d czm_getWgs84EllipsoidEC();\n    float ellipsoidValue \x3d ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\n    // Occluded by the ellipsoid?\n\tif (!u_showThroughEllipsoid)\n\t{\n\t    // Discard if in the ellipsoid\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\n\t    if (ellipsoidValue \x3c 0.0)\n\t    {\n            discard;\n\t    }\n\t    // Discard if in the sensor's shadow\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\n\t    {\n\t        discard;\n\t    }\n    }\n// Notes: Each surface functions should have an associated tolerance based on the floating point error.\n    bool isOnEllipsoid \x3d isOnBoundary(ellipsoidValue, czm_epsilon3);\n    gl_FragColor \x3d shade(isOnEllipsoid);\n}"});F("FeShadersEx/Materials/RectangularSensorScanPlaneFS",[],function(){return"#ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n#endif\nuniform bool u_showIntersection;\nuniform bool u_showThroughEllipsoid;\nuniform float u_radius;\nuniform float u_xHalfAngle;\nuniform float u_yHalfAngle;\nuniform float u_normalDirection;\nuniform vec4 u_color;\nvarying vec3 v_position;\nvarying vec3 v_positionWC;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvec4 getColor(float sensorRadius, vec3 pointEC)\n{\n    czm_materialInput materialInput;\n    vec3 pointMC \x3d (czm_inverseModelView * vec4(pointEC, 1.0)).xyz;\n    materialInput.st \x3d sensor2dTextureCoordinates(sensorRadius, pointMC);\n    materialInput.str \x3d pointMC / sensorRadius;\n    vec3 positionToEyeEC \x3d -v_positionEC;\n    materialInput.positionToEyeEC \x3d positionToEyeEC;\n    vec3 normalEC \x3d normalize(v_normalEC);\n    materialInput.normalEC \x3d u_normalDirection * normalEC;\n    czm_material material \x3d czm_getMaterial(materialInput);\n    material.diffuse \x3d u_color.rgb;\n    material.alpha \x3d u_color.a;\n    return mix(czm_phong(normalize(positionToEyeEC), material), vec4(material.diffuse, material.alpha), 0.4);\n}\nbool isOnBoundary(float value, float epsilon)\n{\n    float width \x3d getIntersectionWidth();\n    float tolerance \x3d width * epsilon;\n#ifdef GL_OES_standard_derivatives\n    float delta \x3d max(abs(dFdx(value)), abs(dFdy(value)));\n    float pixels \x3d width * delta;\n    float temp \x3d abs(value);\n    // There are a couple things going on here.\n    // First we test the value at the current fragment to see if it is within the tolerance.\n    // We also want to check if the value of an adjacent pixel is within the tolerance,\n    // but we don't want to admit points that are obviously not on the surface.\n    // For example, if we are looking for [value] to be close to 0, but value is 1 and the adjacent value is 2,\n    // then the delta would be 1 and [temp - delta] would be [1 - 1] which is zero even though neither of\n    // the points is close to zero.\n    return temp \x3c tolerance \x26\x26 temp \x3c pixels || (delta \x3c 10.0 * tolerance \x26\x26 temp - delta \x3c tolerance \x26\x26 temp \x3c pixels);\n#else\n    return abs(value) \x3c tolerance;\n#endif\n}\nvec4 shade(bool isOnBoundary)\n{\n    if (u_showIntersection \x26\x26 isOnBoundary)\n    {\n        return getIntersectionColor();\n    }\n    return getColor(u_radius, v_positionEC);\n}\nfloat ellipsoidSurfaceFunction(czm_ellipsoid ellipsoid, vec3 point)\n{\n    vec3 scaled \x3d ellipsoid.inverseRadii * point;\n    return dot(scaled, scaled) - 1.0;\n}\nvoid main()\n{\n    vec3 sensorVertexWC \x3d czm_model[3].xyz;      // (0.0, 0.0, 0.0) in model coordinates\n    vec3 sensorVertexEC \x3d czm_modelView[3].xyz;  // (0.0, 0.0, 0.0) in model coordinates\n    //vec3 pixDir \x3d normalize(v_position);\n    float positionX \x3d v_position.x;\n    float positionY \x3d v_position.y;\n    float positionZ \x3d v_position.z;\n    vec3 zDir \x3d vec3(0.0, 0.0, 1.0);\n    vec3 lineX \x3d vec3(positionX, 0 ,positionZ);\n    vec3 lineY \x3d vec3(0, positionY, positionZ);\n    float resX \x3d dot(normalize(lineX), zDir);\n    if(resX \x3c cos(u_xHalfAngle) - 0.0001){\n        discard;\n    }\n    float resY \x3d dot(normalize(lineY), zDir);\n    if(resY \x3c cos(u_yHalfAngle)- 0.0001){\n        discard;\n    }\n    czm_ellipsoid ellipsoid \x3d czm_getWgs84EllipsoidEC();\n    float ellipsoidValue \x3d ellipsoidSurfaceFunction(ellipsoid, v_positionWC);\n    // Occluded by the ellipsoid?\n\tif (!u_showThroughEllipsoid)\n\t{\n\t    // Discard if in the ellipsoid\n\t    // PERFORMANCE_IDEA: A coarse check for ellipsoid intersection could be done on the CPU first.\n\t    if (ellipsoidValue \x3c 0.0)\n\t    {\n            discard;\n\t    }\n\t    // Discard if in the sensor's shadow\n\t    if (inSensorShadow(sensorVertexWC, ellipsoid, v_positionWC))\n\t    {\n\t        discard;\n\t    }\n    }\n    // Notes: Each surface functions should have an associated tolerance based on the floating point error.\n    bool isOnEllipsoid \x3d isOnBoundary(ellipsoidValue, czm_epsilon3);\n    gl_FragColor \x3d shade(isOnEllipsoid);\n}"});F("FeShadersEx/Materials/RectangularSensor",[],function(){return"uniform vec4 u_intersectionColor;\nuniform float u_intersectionWidth;\nuniform vec4 u_lineColor;\nbool inSensorShadow(vec3 coneVertexWC, czm_ellipsoid ellipsoidEC, vec3 pointWC)\n{\n// Diagonal matrix from the unscaled ellipsoid space to the scaled space.\nvec3 D \x3d ellipsoidEC.inverseRadii;\n// Sensor vertex in the scaled ellipsoid space\nvec3 q \x3d D * coneVertexWC;\nfloat qMagnitudeSquared \x3d dot(q, q);\nfloat test \x3d qMagnitudeSquared - 1.0;\n// Sensor vertex to fragment vector in the ellipsoid's scaled space\nvec3 temp \x3d D * pointWC - q;\nfloat d \x3d dot(temp, q);\n// Behind silhouette plane and inside silhouette cone\n\treturn (d \x3c -test) \x26\x26 (d / length(temp) \x3c -sqrt(test));\n}\nvec4 getLineColor()\n{\n\treturn u_lineColor;\n}\nvec4 getIntersectionColor()\n{\n\treturn u_intersectionColor;\n}\nfloat getIntersectionWidth()\n{\n    return u_intersectionWidth;\n}\nvec2 sensor2dTextureCoordinates(float sensorRadius, vec3 pointMC)\n{\n// (s, t) both in the range [0, 1]\nfloat t \x3d pointMC.z / sensorRadius;\nfloat s \x3d 1.0 + (atan(pointMC.y, pointMC.x) / czm_twoPi);\ns \x3d s - floor(s);\nreturn vec2(s, t);\n}"});F("FeDataSources/conicSensor/RectangularSensorPrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/RectangularSensorVS ../../FeShadersEx/Materials/RectangularSensorFS ../../FeShadersEx/Materials/RectangularSensorScanPlaneFS ../../FeShadersEx/Materials/RectangularSensor ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa){function U(c){var e=this;c=b(c,b.EMPTY_OBJECT);this.show=b(c.show,!0);this.slice=b(c.slice,32);this.modelMatrix=d.clone(c.modelMatrix,new d);this._modelMatrix=new d;this._computedModelMatrix=new d;this._computedScanPlaneModelMatrix=new d;this.radius=b(c.radius,Number.POSITIVE_INFINITY);this._radius=void 0;this.xHalfAngle=b(c.xHalfAngle,0);this._xHalfAngle=void 0;this.yHalfAngle=b(c.yHalfAngle,0);this._yHalfAngle=void 0;this.lineColor=b(c.lineColor,f.WHITE);this.showSectorLines=b(c.showSectorLines,!0);this.showSectorSegmentLines=b(c.showSectorSegmentLines,!0);this.showLateralSurfaces=b(c.showLateralSurfaces,!0);this.material=a(c.material)?c.material:E.fromType(E.ColorType);this._translucent=this._material=void 0;this.lateralSurfaceMaterial=a(c.lateralSurfaceMaterial)?c.lateralSurfaceMaterial:E.fromType(E.ColorType);this._lateralSurfaceTranslucent=this._lateralSurfaceMaterial=void 0;this.showDomeSurfaces=b(c.showDomeSurfaces,!0);this.domeSurfaceMaterial=a(c.domeSurfaceMaterial)?c.domeSurfaceMaterial:E.fromType(E.ColorType);this._domeSurfaceMaterial=void 0;this.showDomeLines=b(c.showDomeLines,!0);this.showIntersection=b(c.showIntersection,!0);this.intersectionColor=b(c.intersectionColor,f.WHITE);this.intersectionWidth=b(c.intersectionWidth,5);this.showThroughEllipsoid=b(c.showThroughEllipsoid,!1);this._showThroughEllipsoid=void 0;this.showScanPlane=b(c.showScanPlane,!0);this.scanPlaneColor=b(c.scanPlaneColor,f.WHITE);this.scanPlaneMode=b(c.scanPlaneMode,"horizontal");this._scanPlaneMode=void 0;this.scanPlaneRate=b(c.scanPlaneRate,10);this.scanDir=b(c.scanDir,0);this.direct=1;this._scanePlaneYHalfAngle=this._scanePlaneXHalfAngle=0;this._time=A.now();this._boundingSphere=new g;this._boundingSphereWC=new g;this._sectorFrontCommand=new v({owner:this,primitiveType:q.TRIANGLES,boundingVolume:this._boundingSphereWC});this._sectorBackCommand=new v({owner:this,primitiveType:q.TRIANGLES,boundingVolume:this._boundingSphereWC});this._sectorVA=void 0;this._sectorLineCommand=new v({owner:this,primitiveType:q.LINES,boundingVolume:this._boundingSphereWC});this._sectorLineVA=void 0;this._sectorSegmentLineCommand=new v({owner:this,primitiveType:q.LINES,boundingVolume:this._boundingSphereWC});this._sectorSegmentLineVA=void 0;this._domeFrontCommand=new v({owner:this,primitiveType:q.TRIANGLES,boundingVolume:this._boundingSphereWC});this._domeBackCommand=new v({owner:this,primitiveType:q.TRIANGLES,boundingVolume:this._boundingSphereWC});this._domeVA=void 0;this._domeLineCommand=new v({owner:this,primitiveType:q.LINES,boundingVolume:this._boundingSphereWC});this._domeLineVA=void 0;this._scanPlaneFrontCommand=new v({owner:this,primitiveType:q.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scanPlaneBackCommand=new v({owner:this,primitiveType:q.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scanRadialCommand=void 0;this._colorCommands=[];this._sp=this._backFaceRS=this._frontFaceRS=void 0;this._uniforms={u_type:function(){return 0},u_xHalfAngle:function(){return e.xHalfAngle},u_yHalfAngle:function(){return e.yHalfAngle},u_radius:function(){return e.radius},u_showThroughEllipsoid:function(){return e.showThroughEllipsoid},u_showIntersection:function(){return e.showIntersection},u_intersectionColor:function(){return e.intersectionColor},u_intersectionWidth:function(){return e.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return e.lineColor}};this._scanUniforms={u_xHalfAngle:function(){return e._scanePlaneXHalfAngle},u_yHalfAngle:function(){return e._scanePlaneYHalfAngle},u_radius:function(){return e.radius},u_color:function(){return e.scanPlaneColor},u_showThroughEllipsoid:function(){return e.showThroughEllipsoid},u_showIntersection:function(){return e.showIntersection},u_intersectionColor:function(){return e.intersectionColor},u_intersectionWidth:function(){return e.intersectionWidth},u_normalDirection:function(){return 1},u_lineColor:function(){return e.lineColor}}}function W(a,b,c){a=a.slice;var d=S(c);c=ca(c);var e=S(b),f=ca(b);b=T(e*c);d=T(d*f);c=[];for(e=0;e<a;e++)f=2*b*e/(a-1)-b,c.push(new h(0,Q(f),S(f)));b=[];for(e=0;e<a;e++)f=2*d*e/(a-1)-d,b.push(new h(Q(f),0,S(f)));return{zoy:c,zox:b}}function M(a,b){var c=a.xHalfAngle,d=a.yHalfAngle,e=b.zoy,f=b.zox,g=[],k=p.fromRotationY(c,V);g.push(e.map(function(a){return p.multiplyByVector(k,a,new h)}));k=p.fromRotationX(-d,V);g.push(f.map(function(a){return p.multiplyByVector(k,a,new h)}).reverse());k=p.fromRotationY(-c,V);g.push(e.map(function(a){return p.multiplyByVector(k,a,new h)}).reverse());k=p.fromRotationX(d,V);g.push(f.map(function(a){return p.multiplyByVector(k,a,new h)}));return g}function R(a,b){for(var c=b.length-1,d=new Float32Array(9*c),e=0,f=0;f<c;f++)d[e++]=0,d[e++]=0,d[e++]=0,d[e++]=b[f].x,d[e++]=b[f].y,d[e++]=b[f].z,d[e++]=b[f+1].x,d[e++]=b[f+1].y,d[e++]=b[f+1].z;c=x.createVertexBuffer({context:a,typedArray:d,usage:D.STATIC_DRAW});return new J({context:a,attributes:[{index:da.position,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:r.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}function Y(a,b,c,d,e,f,g,h,k,l,m,p){l&&c&&(c.vertexArray=g,c.renderState=e,c.shaderProgram=f,c.uniformMap=t(h,a._material._uniforms),c.uniformMap.u_normalDirection=function(){return-1},c.pass=m,c.modelMatrix=k,a._colorCommands.push(c));b.vertexArray=g;b.renderState=d;b.shaderProgram=f;b.uniformMap=t(h,a._material._uniforms);p&&(b.uniformMap.u_type=function(){return 1});b.pass=m;b.modelMatrix=k;a._colorCommands.push(b)}var Q=Math.sin,S=Math.cos,ca=Math.tan,T=Math.atan,da={position:0,normal:1};U.prototype.update=function(a){var b=a.mode;if(this.show&&b===L.SCENE3D){var c=b=!1,f=!1,l=this.xHalfAngle,m=this.yHalfAngle;if(0>l||0>m)throw new e("halfAngle must be greater than or equal to zero.");if(0!=l&&0!=m){if(this._xHalfAngle!==l||this._yHalfAngle!==m)this._xHalfAngle=l,this._yHalfAngle=m,b=!0;this._scanPlaneMode!==this.scanPlaneMode&&(this._scanPlaneMode=this.scanPlaneMode,b=!0);var q=this.radius;if(0>q)throw new e("this.radius must be greater than or equal to zero.");var v=!1;this._radius!==q&&(v=!0,this._radius=q,this._boundingSphere=new g(h.ZERO,this.radius));if(!d.equals(this.modelMatrix,this._modelMatrix)||v)d.clone(this.modelMatrix,this._modelMatrix),d.multiplyByUniformScale(this.modelMatrix,this.radius,this._computedModelMatrix),g.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC);var t=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=t,c=!0);v=this.material;this._material!==v&&(this._material=v,f=c=!0);q=v.isTranslucent();this._translucent!==q&&(this._translucent=q,c=!0);if(this.showScanPlane){var E=a.time,Q=A.secondsDifference(E,this._time);0>Q&&(this._time=A.clone(E,this._time));E=Math.max(Q%this.scanPlaneRate/this.scanPlaneRate,0);1==this.scanDir?E=1-E:2==this.scanDir&&(this.lastPercentage&&.5<=Math.abs(E-this.lastPercentage)&&(this.direct*=-1),this.lastPercentage=E,0<this.direct||0>this.direct&&(E=1-E));"horizontal"==this.scanPlaneMode?(E=2*m*E-m,m=S(E),l=ca(l),this._scanePlaneXHalfAngle=T(m*l),this._scanePlaneYHalfAngle=E,p.fromRotationX(this._scanePlaneYHalfAngle,V)):(E=2*l*E-l,l=ca(m),m=S(E),l=T(m*l),this._scanePlaneXHalfAngle=E,this._scanePlaneYHalfAngle=l,p.fromRotationY(this._scanePlaneXHalfAngle,V));d.multiplyByMatrix3(this.modelMatrix,V,this._computedScanPlaneModelMatrix);d.multiplyByUniformScale(this._computedScanPlaneModelMatrix,this.radius,this._computedScanPlaneModelMatrix)}if(b){l=a.context;m=W(this,this.xHalfAngle,this.yHalfAngle);m=M(this,m);if(this.showLateralSurfaces){for(var E=Array.prototype.concat.apply([],m).length-m.length,Q=new Float32Array(18*E),U=0,aa=0,Z=m.length;aa<Z;aa++)for(var X=m[aa],F=h.normalize(h.cross(X[0],X[X.length-1],ba),ba),Ba=0,E=X.length-1;Ba<E;Ba++)Q[U++]=0,Q[U++]=0,Q[U++]=0,Q[U++]=-F.x,Q[U++]=-F.y,Q[U++]=-F.z,Q[U++]=X[Ba].x,Q[U++]=X[Ba].y,Q[U++]=X[Ba].z,Q[U++]=-F.x,Q[U++]=-F.y,Q[U++]=-F.z,Q[U++]=X[Ba+1].x,Q[U++]=X[Ba+1].y,Q[U++]=X[Ba+1].z,Q[U++]=-F.x,Q[U++]=-F.y,Q[U++]=-F.z;E=x.createVertexBuffer({context:l,typedArray:Q,usage:D.STATIC_DRAW});Q=6*Float32Array.BYTES_PER_ELEMENT;this._sectorVA=new J({context:l,attributes:[{index:da.position,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:r.FLOAT,offsetInBytes:0,strideInBytes:Q},{index:da.normal,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:r.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:Q}]})}if(this.showSectorLines){E=new Float32Array(9*m.length);U=Q=0;for(aa=m.length;U<aa;U++)Z=m[U],E[Q++]=0,E[Q++]=0,E[Q++]=0,E[Q++]=Z[0].x,E[Q++]=Z[0].y,E[Q++]=Z[0].z;E=x.createVertexBuffer({context:l,typedArray:E,usage:D.STATIC_DRAW});this._sectorLineVA=new J({context:l,attributes:[{index:da.position,vertexBuffer:E,componentsPerAttribute:3,componentDatatype:r.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}if(this.showSectorSegmentLines){E=Array.prototype.concat.apply([],m).length-m.length;Q=new Float32Array(9*E);aa=U=0;for(Z=m.length;aa<Z;aa++)for(X=m[aa],F=0,E=X.length-1;F<E;F++)Q[U++]=X[F].x,Q[U++]=X[F].y,Q[U++]=X[F].z,Q[U++]=X[F+1].x,Q[U++]=X[F+1].y,Q[U++]=X[F+1].z;m=x.createVertexBuffer({context:l,typedArray:Q,usage:D.STATIC_DRAW});this._sectorSegmentLineVA=new J({context:l,attributes:[{index:da.position,vertexBuffer:m,componentsPerAttribute:3,componentDatatype:r.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}this.showDomeSurfaces&&(m=z.createGeometry(new z({vertexFormat:u.POSITION_ONLY,stackPartitions:32,slicePartitions:32})),this._domeVA=J.fromGeometry({context:l,geometry:m,attributeLocations:da,bufferUsage:D.STATIC_DRAW,interleave:!1}));this.showDomeLines&&(m=k.createGeometry(new k({vertexFormat:u.POSITION_ONLY,stackPartitions:32,slicePartitions:32})),this._domeLineVA=J.fromGeometry({context:l,geometry:m,attributeLocations:da,bufferUsage:D.STATIC_DRAW,interleave:!1}));this.showScanPlane&&("horizontal"==this.scanPlaneMode?(m=W(this,y.PI_OVER_TWO,0),this._scanPlaneVA=R(l,m.zox)):(m=W(this,0,y.PI_OVER_TWO),this._scanPlaneVA=R(l,m.zoy)))}c&&(q?(this._frontFaceRS=C.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:w.ALPHA_BLEND,cull:{enabled:!0,face:G.BACK}}),this._backFaceRS=C.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:w.ALPHA_BLEND,cull:{enabled:!0,face:G.FRONT}}),this._pickRS=C.fromCache({depthTest:{enabled:!t},depthMask:!1,blending:w.ALPHA_BLEND})):(this._frontFaceRS=C.fromCache({depthTest:{enabled:!t},depthMask:!0}),this._pickRS=C.fromCache({depthTest:{enabled:!0},depthMask:!0})));f&&(t=a.context,l=new H({sources:[O,v.shaderSource,P]}),this._sp=I.replaceCache({context:t,shaderProgram:this._sp,vertexShaderSource:K,fragmentShaderSource:l,attributeLocations:da}),l=new H({sources:[O,v.shaderSource,P],pickColorQualifier:"uniform"}),this._pickSP=I.replaceCache({context:t,shaderProgram:this._pickSP,vertexShaderSource:K,fragmentShaderSource:l,attributeLocations:da}),this.showScanPlane&&(t=a.context,v=new H({sources:[O,v.shaderSource,N]}),this._scanePlaneSP=I.replaceCache({context:t,shaderProgram:this._scanePlaneSP,vertexShaderSource:K,fragmentShaderSource:v,attributeLocations:da})));if(c||f||b)this._colorCommands.length=0,b=q?B.TRANSLUCENT:B.OPAQUE,this.showLateralSurfaces&&Y(this,this._sectorFrontCommand,this._sectorBackCommand,this._frontFaceRS,this._backFaceRS,this._sp,this._sectorVA,this._uniforms,this._computedModelMatrix,q,b),this.showSectorLines&&Y(this,this._sectorLineCommand,void 0,this._frontFaceRS,this._backFaceRS,this._sp,this._sectorLineVA,this._uniforms,this._computedModelMatrix,q,b,!0),this.showSectorSegmentLines&&Y(this,this._sectorSegmentLineCommand,void 0,this._frontFaceRS,this._backFaceRS,this._sp,this._sectorSegmentLineVA,this._uniforms,this._computedModelMatrix,q,b,!0),this.showDomeSurfaces&&Y(this,this._domeFrontCommand,this._domeBackCommand,this._frontFaceRS,this._backFaceRS,this._sp,this._domeVA,this._uniforms,this._computedModelMatrix,q,b),this.showDomeLines&&Y(this,this._domeLineCommand,void 0,this._frontFaceRS,this._backFaceRS,this._sp,this._domeLineVA,this._uniforms,this._computedModelMatrix,q,b,!0),this.showScanPlane&&Y(this,this._scanPlaneFrontCommand,this._scanPlaneBackCommand,this._frontFaceRS,this._backFaceRS,this._scanePlaneSP,this._scanPlaneVA,this._scanUniforms,this._computedScanPlaneModelMatrix,q,b);b=a.commandList;c=this._colorCommands;if(a.passes.render)for(a=0,f=c.length;a<f;a++)b.push(c[a])}}};U.prototype.destroy=function(){return c(this)};var V=new p,ba=new h;return U});F("FeDataSources/conicSensor/RectangularSensorVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./RectangularSensorPrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,c,d){var e=c[b.id];a(e)&&(e=e.primitive,d.remove(e),e.isDestroyed()||e.destroy(),delete c[b.id])}function r(b,c){if(!a(b))throw new DeveloperError("scene is required.");if(!a(c))throw new DeveloperError("entityCollection is required.");c.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=c;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(c,c.values,[],[])}var c=new m;new e;var u=new g,y=new g,A=new l,z=new g,x=new l;r.prototype.update=function(h){if(!a(h))throw new DeveloperError("time is required.");for(var k=this._entitiesToVisualize.values,r=this._hash,t=this._primitives,D=0,H=k.length;D<H;D++){var J=k[D],w=J._rectangularSensor,G,E,L,K,P,N=r[J.id],O=J.isShowing&&J.isAvailable(h)&&d.getValueOrDefault(w._show,h,!0);O&&(G=d.getValueOrUndefined(J._position,h,u),E=d.getValueOrUndefined(J._orientation,h,A),L=d.getValueOrUndefined(w._radius,h),K=d.getValueOrUndefined(w._xHalfAngle,h),P=d.getValueOrUndefined(w._yHalfAngle,h),O=a(G)&&a(K)&&a(P));if(O){O=a(N)?N.primitive:void 0;a(O)||(O=new q,O.id=J,t.add(O),N={primitive:O,position:void 0,orientation:void 0},r[J.id]=N);J=d.getValueOrUndefined(w._gaze,h);if(a(J)){N=d.getValueOrUndefined(J._position,h,y);if(!a(G)||!a(N))continue;L=g.subtract(G,N,z);E=g.angleBetween(g.UNIT_Z,L);L=g.cross(g.UNIT_Z,L,z);E=l.fromAxisAngle(L,E-Math.PI,x);L=g.distance(G,N);O.modelMatrix=e.fromRotationTranslation(m.fromQuaternion(E,c),G,O.modelMatrix)}else g.equals(G,N.position)&&l.equals(E,N.orientation)||(a(E)?(O.modelMatrix=e.fromRotationTranslation(m.fromQuaternion(E,c),G,O.modelMatrix),N.position=g.clone(G,N.position),N.orientation=l.clone(E,N.orientation)):(O.modelMatrix=f.eastNorthUpToFixedFrame(G),N.position=g.clone(G,N.position)));O.show=!0;O.gaze=J;O.radius=L;O.xHalfAngle=K;O.yHalfAngle=P;O.lineColor=d.getValueOrDefault(w._lineColor,h,b.WHITE);O.showSectorLines=d.getValueOrDefault(w._showSectorLines,h,!0);O.showSectorSegmentLines=d.getValueOrDefault(w._showSectorSegmentLines,h,!0);O.showLateralSurfaces=d.getValueOrDefault(w._showLateralSurfaces,h,!0);O.material=p.getValue(h,w._material,O.material);O.showDomeSurfaces=d.getValueOrDefault(w._showDomeSurfaces,h,!0);O.showDomeLines=d.getValueOrDefault(w._showDomeLines,h,!0);O.showIntersection=d.getValueOrDefault(w._showIntersection,h,!0);O.intersectionColor=d.getValueOrDefault(w._intersectionColor,h,b.WHITE);O.intersectionWidth=d.getValueOrDefault(w._intersectionWidth,h,1);O.showThroughEllipsoid=d.getValueOrDefault(w._showThroughEllipsoid,h,!0);O.scanPlaneMode=d.getValueOrDefault(w._scanPlaneMode,h);O.scanPlaneColor=d.getValueOrDefault(w._scanPlaneColor,h,b.WHITE);O.showScanPlane=d.getValueOrDefault(w._showScanPlane,h,!0);O.scanPlaneRate=d.getValueOrDefault(w._scanPlaneRate,h,1);O.scanDir=d.getValueOrDefault(w._scanDir,h,0)}else a(N)&&(N.primitive.show=!1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,c=this._primitives,d=a.length-1;-1<d;d--)t(a[d],b,c);return h(this)};r.prototype._onCollectionChanged=function(b,c,d,e){var f,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=c.length-1;-1<b;b--)f=c[b],a(f._rectangularSensor)&&a(f._position)&&g.set(f.id,f);for(b=e.length-1;-1<b;b--)f=e[b],a(f._rectangularSensor)&&a(f._position)?g.set(f.id,f):(t(f,h,k),g.remove(f.id));for(b=d.length-1;-1<b;b--)f=d[b],t(f,h,k),g.remove(f.id)};return r});F("FeShadersEx/Materials/ConicalRadarVS",[],function(){return"attribute vec4 position;\nvoid main()\n{\n    gl_Position \x3d czm_modelViewProjection * position;\n}"});F("FeShadersEx/Materials/ConicalRadarFS",[],function(){return"\n#ifdef GL_ES\n    precision mediump float;\n#endif\nuniform vec4 u_color;\nuniform vec4 u_outlineColor;\nuniform float u_isline;\nvec4 getColor(float isline)\n{\n    if(isline\x3d\x3d1.0){\n        return u_outlineColor;\n    } else {\n        return u_color;\n    }\n}\nvoid main()\n{\n    gl_FragColor \x3d getColor(u_isline);\n}"});F("FeDataSources/conicalRadar/ConicalRadarFramework","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,b,c,d,e,f){this.setParameters(a,b,c,d,e,f)}function c(a,b,c,d){for(var e=[],f=c/d,g=0;g<=d;g++){var h=-c/2+g*f;e.push([b*Math.cos(h),-b*Math.sin(h),-a])}return e}r.prototype.setParameters=function(a,c,d,e,f,g){var h=Math.sqrt(a*a+c*c+d*d);this.height=a/h;this.frontScannerRadius=c/h;this.backScannerRadius=d/h;this.openingAngle=b(e,0);this.hSteps=b(f,10);this.angleSteps=b(g,10)};r.prototype.createVertexConicalArrayFront=function(){return this.createVertexConicalArray(this.frontScannerRadius)};r.prototype.createVertexConicalArrayBack=function(){return this.createVertexConicalArray(this.backScannerRadius)};r.prototype.createVertexConicalArray=function(a){var b=this.openingAngle,c=b/this.angleSteps,d=Math.atan(a/this.height);a=[];for(var e=[],f=0;f<=this.hSteps;f++)for(var g=f/this.hSteps*this.height*Math.tan(d),h=0;h<=this.angleSteps;h++){var k=-b/2+h*c;a.push([g*Math.cos(k),g*Math.sin(k),-(f/this.hSteps*this.height)])}for(f=0;f<this.hSteps;f++)if(b=f*(this.hSteps+1),c=(f+1)*(this.hSteps+1),0==f%2)for(h=0;h<this.angleSteps;h++)e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[c+h]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[c+h+1]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[b+h]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[b+h]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[b+h+1]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[c+h+1])));else for(h=this.angleSteps;0<h;h--)e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[b+h]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[b+h-1]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[c+h]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[c+h]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[c+h-1]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[b+h-1])));return e};r.prototype.createVertexLeftArray=function(){var a=[0,0,0],b=c(this.height,this.frontScannerRadius,this.openingAngle,this.angleSteps),d=c(this.height,this.backScannerRadius,this.openingAngle,this.angleSteps);a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[0])));a.push.apply(a,[].concat($jscomp.arrayFromIterable(d[0])));return a};r.prototype.createtVertexRightArray=function(){var a=[0,0,0],b=c(this.height,this.frontScannerRadius,this.openingAngle,this.angleSteps),d=c(this.height,this.backScannerRadius,this.openingAngle,this.angleSteps);a.push.apply(a,[].concat($jscomp.arrayFromIterable(d[d.length-1])));a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[b.length-1])));return a};r.prototype.createBottomPlaneArray=function(){var a=[],b=c(this.height,this.frontScannerRadius,this.openingAngle,this.angleSteps),d=c(this.height,this.backScannerRadius,this.openingAngle,this.angleSteps),e=b.length;if(!(e<d.length)){for(var f=0;f<e-1;f++)a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[f]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(d[f]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[f+1]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(d[f]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[f+1]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(d[f+1])));return a}};r.prototype.createVertexLineArray=function(){var a=[0,0,0],b=[],d=c(this.height,this.frontScannerRadius,this.openingAngle,this.angleSteps),e=c(this.height,this.backScannerRadius,this.openingAngle,this.angleSteps);b.push.apply(b,[].concat($jscomp.arrayFromIterable(a),$jscomp.arrayFromIterable(d[0])));b.push.apply(b,[].concat($jscomp.arrayFromIterable(a),$jscomp.arrayFromIterable(d[d.length-1])));b.push.apply(b,[].concat($jscomp.arrayFromIterable(a),$jscomp.arrayFromIterable(e[0])));b.push.apply(b,[].concat($jscomp.arrayFromIterable(a),$jscomp.arrayFromIterable(e[e.length-1])));return b};r.prototype.validateInitialData=function(){};return r});F("FeDataSources/conicalRadar/ConicalRadarPrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/HeadingPitchRoll ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/ConicalRadarVS ../../FeShadersEx/Materials/ConicalRadarFS ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor ./ConicalRadarFramework".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa){function U(c){var e=this;c=b(c,b.EMPTY_OBJECT);this.show=b(c.show,!0);this.height=b(c.height,0);this._height=void 0;this.material=a(c.material)?c.material:L.fromType(L.ColorType);this._material=void 0;this.frontScannerRadius=b(c.frontScannerRadius,0);this._frontScannerRadius=void 0;this.offset=b(c.offset,h.ZERO);this._offset=void 0;this.backScannerRadius=b(c.backScannerRadius,0);this._backScannerRadius=void 0;this.openingAngle=b(c.openingAngle,0);this._openingAngle=void 0;this.color=b(c.color,f.WHITE);this.outlineColor=b(c.outlineColor,f.WHITE);this.showThroughEllipsoid=b(c.showThroughEllipsoid,!1);this._showThroughEllipsoid=void 0;this.modelMatrix=b(c.modelMatrix,new d);this._modelMatrix=new d;this.headingPitchRoll=b(c.headingPitchRoll,new q);this._headingPitchRoll=new q;this._computedModelMatrix=new d;this._computedScanPlaneModelMatrix=new d;this._frontCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._backCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._linesCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._bottomCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._leftCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._rightCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scanRadialCommand=void 0;this._colorCommands=[];this._uniforms={u_isline:function(){return 0},u_color:function(){return e.color},u_outlineColor:function(){return e.outlineColor}};this._angleSteps=this._hSteps=10}function W(a,b){var d=new Float32Array(b),d=D.createVertexBuffer({context:a,typedArray:d,usage:v.STATIC_DRAW});return new w({context:a,attributes:[{index:0,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:c.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}function M(a,b,c,d,e,f,g,h,k,l){b.vertexArray=e;b.renderState=c;b.shaderProgram=d;b.uniformMap=r(f,a._material._uniforms);l&&(b.uniformMap.u_isline=function(){return 1});b.pass=k;b.modelMatrix=g;a._colorCommands.push(b)}var R={position:0};U.prototype.update=function(a){var b=a.mode;if(this.show&&b===K.SCENE3D){var c=b=!1,f=!1,k=this.height,l=this.frontScannerRadius,m=this.backScannerRadius,r=this.openingAngle,u=Math.sqrt(k*k+l*l);if(0>k||0>m||0>l)throw new e("height/backScannerRadius/frontScannerRadius   must be greater than or equal to zero.");if(0!=k&&0!=m&&0!=l&&0!=r){if(this._height!==k||this._backScannerRadius!==m||this._frontScannerRadius!==l||this._openingAngle!==r)this._height=k,this._backScannerRadius=m,this._frontScannerRadius=l,this._openingAngle=r,b=!0,u=Math.sqrt(k*k+l*l),this._boundingSphere=new g(h.ZERO,u);void 0==this.conicalRadarFramework?this.conicalRadarFramework=new aa(k,l,m,r,this._hSteps,this._angleSteps):this.conicalRadarFramework.setParameters(k,l,m,r,this._hSteps,this._angleSteps);k=!d.equals(this.modelMatrix,this._modelMatrix);l=!q.equals(this.headingPitchRoll,this._headingPitchRoll);m=!h.equals(this.offset,this._offset);if(k||l||m)d.clone(this.modelMatrix,this._modelMatrix),this._offset=h.clone(this.offset,this._offset),d.multiplyByUniformScale(this.modelMatrix,u,this._computedModelMatrix),g.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC),k=this._offset.x/u,l=this._offset.y/u,u=this._offset.z/u,q.clone(this.headingPitchRoll,this._headingPitchRoll),m=p.fromHeadingPitchRoll(this._headingPitchRoll,new p),u=d.fromRotationTranslation(m,h.fromElements(k,l,u),new d),d.multiply(this._computedModelMatrix,u,this._computedModelMatrix);l=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=l,c=!0);k=this.material;this._material!==k&&(this._material=k,f=c=!0);u=k.isTranslucent();this._translucent!==u&&(this._translucent=u,c=!0);b&&(m=a.context,this._frontConical=W(m,this.conicalRadarFramework.createVertexConicalArrayFront()),this._backConical=W(m,this.conicalRadarFramework.createVertexConicalArrayBack()),this._leftPlane=W(m,this.conicalRadarFramework.createVertexLeftArray()),this._rightPlane=W(m,this.conicalRadarFramework.createtVertexRightArray()),this._bottomPlane=W(m,this.conicalRadarFramework.createBottomPlaneArray()),this._lines=W(m,this.conicalRadarFramework.createVertexLineArray()));c&&(u?(this._frontFaceRS=I.fromCache({depthTest:{enabled:!l},depthMask:!1,blending:G.ALPHA_BLEND,cull:{enabled:!0,face:E.BACK}}),this._backFaceRS=I.fromCache({depthTest:{enabled:!l},depthMask:!1,blending:G.ALPHA_BLEND,cull:{enabled:!0,face:E.FRONT}}),this._pickRS=I.fromCache({depthTest:{enabled:!l},depthMask:!1,blending:G.ALPHA_BLEND})):(this._frontFaceRS=I.fromCache({depthTest:{enabled:!l},blending:G.ALPHA_BLEND,depthMask:!0}),this._pickRS=I.fromCache({depthTest:{enabled:!0},blending:G.ALPHA_BLEND,depthMask:!0})));f&&(l=a.context,k=new J({sources:[k.shaderSource,N]}),this._shaderProgram=H.replaceCache({context:l,shaderProgram:this._shaderProgram,vertexShaderSource:P,fragmentShaderSource:k,attributeLocations:R}));if(c||f||b)this._colorCommands.length=0,b=u?C.TRANSLUCENT:C.OPAQUE,M(this,this._frontCommand,this._frontFaceRS,this._shaderProgram,this._frontConical,this._uniforms,this._computedModelMatrix,u,b),M(this,this._backCommand,this._frontFaceRS,this._shaderProgram,this._backConical,this._uniforms,this._computedModelMatrix,u,b),M(this,this._leftCommand,this._frontFaceRS,this._shaderProgram,this._leftPlane,this._uniforms,this._computedModelMatrix,u,b),M(this,this._rightCommand,this._frontFaceRS,this._shaderProgram,this._rightPlane,this._uniforms,this._computedModelMatrix,u,b),M(this,this._bottomCommand,this._frontFaceRS,this._shaderProgram,this._bottomPlane,this._uniforms,this._computedModelMatrix,u,b),M(this,this._linesCommand,this._frontFaceRS,this._shaderProgram,this._lines,this._uniforms,this._computedModelMatrix,u,b,!0);b=a.commandList;c=this._colorCommands;if(a.passes.render)for(a=0,f=c.length;a<f;a++)b.push(c[a])}}};U.prototype.destroy=function(){return u(this)};new p;new h;return U});F("FeDataSources/conicalRadar/ConicalRadarVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./ConicalRadarPrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,c,d){var e=c[b.id];a(e)&&(e=e.primitive,d.remove(e),e.isDestroyed()||e.destroy(),delete c[b.id])}function r(b,c){if(!a(b))throw new DeveloperError("scene is required.");if(!a(c))throw new DeveloperError("entityCollection is required.");c.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=c;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(c,c.values,[],[])}new m;new e;var c=new g;new g;new l;new g;new l;r.prototype.update=function(b){if(!a(b))throw new DeveloperError("time is required.");for(var h=this._entitiesToVisualize.values,k=this._hash,l=this._primitives,r=0,u=h.length;r<u;r++){var v=h[r],t=v._conicalRadar,C,I=k[v.id],H=v.isShowing&&v.isAvailable(b)&&d.getValueOrDefault(t._show,b,!0);H&&(C=d.getValueOrUndefined(v._position,b,c));H?(H=a(I)?I.primitive:void 0,a(H)||(H=new q,H.id=v,l.add(H),I={primitive:H,position:void 0,orientation:void 0},k[v.id]=I),H.modelMatrix=e.multiply(f.eastNorthUpToFixedFrame(C),d.getValueOrDefault(t._modelMatrix,b,void 0),H.modelMatrix),e.multiplyByMatrix3(H.modelMatrix,m.fromRotationZ(Math.PI/2),H.modelMatrix),I.position=g.clone(C,I.position),H.show=!0,H.material=p.getValue(b,t._material,H.material),H.height=d.getValueOrDefault(t._height,b,void 0),H.headingPitchRoll=d.getValueOrDefault(t._headingPitchRoll,b,void 0),H.frontScannerRadius=d.getValueOrDefault(t._frontScannerRadius,b,void 0),H.backScannerRadius=d.getValueOrDefault(t._backScannerRadius,b,void 0),H.openingAngle=d.getValueOrDefault(t._openingAngle,b,void 0),H.color=d.getValueOrDefault(t._color,b,void 0),H.offset=d.getValueOrDefault(t._offset,b,void 0),H.outlineColor=d.getValueOrDefault(t._outlineColor,b,void 0)):a(I)&&(I.primitive.show=!1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,c=this._primitives,d=a.length-1;-1<d;d--)t(a[d],b,c);return h(this)};r.prototype._onCollectionChanged=function(b,c,d,e){var f,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=c.length-1;-1<b;b--)f=c[b],a(f._conicalRadar)&&a(f._position)&&g.set(f.id,f);for(b=e.length-1;-1<b;b--)f=e[b],a(f._conicalRadar)&&a(f._position)?g.set(f.id,f):(t(f,h,k),g.remove(f.id));for(b=d.length-1;-1<b;b--)f=d[b],t(f,h,k),g.remove(f.id)};return r});F("FeShadersEx/Materials/RibbonPrimitiveVS",[],function(){return"precision mediump float;\nattribute vec4 a_position;\nattribute float a_alpha;\nvarying float v_alpha;\nuniform mat4 uMVPMatrix;\nvoid main()\n{\n\tgl_Position \x3d uMVPMatrix * a_position;\n\tv_alpha \x3d a_alpha;\n}"});F("FeShadersEx/Materials/RibbonPrimitiveFS",[],function(){return"precision mediump float;\n\tvarying float v_alpha;\n\tuniform vec4 uColor;\nvoid main()\n{\n\tgl_FragColor \x3d vec4(uColor.xyz,v_alpha);\n}\n\n"});F("FeDataSources/Ribbon/RibbonPrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/HeadingPitchRoll ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Core/Transforms ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/RibbonPrimitiveVS ../../FeShadersEx/Materials/RibbonPrimitiveFS ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U){function W(a){a=b(a,b.EMPTY_OBJECT);this.show=b(a.show,!0);this.worldCoordArr=[];this.lastPositions=this.translation=this.viewProjMat=void 0;this.positions=b(a.positions,[]);this.changePosition=!1;this.modelMatrix=t.IDENTITY.clone();this.modelViewProjMat=t.IDENTITY.clone();this.color=b(a.color,f.RED);this._color=void 0;this.maxVerticeNum=b(a.maxVerticeNum,100);this._maxVerticeNum=void 0;this.deleteNum=b(a.deleteNum,1);this.rotation=b(a.rotation,[0,0,0]);this._rotation=void 0;this.width=b(a.width,1E4);this._width=void 0;this.offset=b(a.offset,[0,0,0]);this._offset=void 0;this.maxAlpha=b(a.maxAlpha,1);this._maxAlpha=void 0;this.minAlpha=b(a.minAlpha,0);this._minAlpha=void 0;this.fadeTime=b(a.fadeTime,1);this.fadeSpeed=b(a.fadeSpeed,1);this.lastUpdateTime=-1;this.enableFade=!0;this._mainCommand=new I({owner:this,primitiveType:r.TRIANGLES});this._mainVA=void 0;this._colorCommands=[];this._sp=this._backFaceRS=this._frontFaceRS=void 0;var c=this,d=new Float32Array(16);this._uniforms={uMVPMatrix:function(){var a=t.multiply(c.viewProjMat,c.modelMatrix,c.modelViewProjMat);t.toArray(a,d);return d},uColor:function(){return c.color}};this.positionsMap=new Map}function M(a){return""+a.x+"_"+a.y+"_"+a.z}var R={position:0,alpha:1};W.prototype.fadePosition=function(){var a=Date.now();if(this.enableFade&&-1!=this.lastUpdateTime&&!(0>=this.positions.length)){var b;if(a-this.lastUpdateTime>1E3*this.fadeTime&&(b=this.fadeSpeed,0<b)){b=this.positions.length-b;0>=b&&(b=0);for(var c=0;c<b;++c)this.positions[c]=this.positions[c+1];this.positions.length=b}this.lastFadeTime=a}};W.prototype.update=function(a){var b=a.mode;if(this.show&&b===N.SCENE3D){this.viewProjMat=a.context._us._modelViewProjection;var b=!0,c=!1,d=!1;Date.now();this.lastEndPoint?1<=this.positions.length&&!this.lastEndPoint.equals(this.positions[this.positions.length-1])&&(this.lastUpdateTime=Date.now(),this.lastEndPoint=this.positions[this.positions.length-1]):1<=this.positions.length&&(this.lastEndPoint=this.positions[this.positions.length-1]);this.fadePosition();if(!(2>this.positions.length)){var f=this.width,g=this.offset;if(0>=f)throw new e("width must be greater than to zero.");if(0!=f){if(this._width!==f||this._offset!==g)this._width=f,this._offset=g,this.reBuildWorldCoordArr(),b=!0;f=this.maxAlpha;g=this.minAlpha;if(this._maxAlpha!==f||this._minAlpha!==g)this._maxAlpha=f,this._minAlpha=g,b=!0;f=this.color;f.equals(this._color)||(this._color=f,d=c=!0);f=1>f.alpha;this._translucent!==f&&(this._translucent=f,c=!0);if(b){var g=a.context,k=this.positions[this.positions.length-1];this.translation=k;var l=t.IDENTITY.clone();this.translation instanceof p&&(l=t.multiplyByTranslation(l,k,new t));this.modelMatrix=l;this.worldCoordArr.length=0;for(var m,r=q.IDENTITY.clone(),y=new h,l=0;l<this.positions.length;++l){var z=M(this.positions[l]);if(this.positionsMap.has(z))m=this.positionsMap.get(z);else{var r=q.fromHeadingPitchRoll(Cesium.HeadingPitchRoll.fromDegrees(-this.rotation[0]-90,this.rotation[1],this.rotation[2],y),r),A=this.positions[l],D=r;m=this.offset;var z=new p,x=new p,A=v.eastNorthUpToFixedFrame(A),D=t.multiplyByMatrix3(A,D,new t);z.x=0+m[0];z.y=0+m[1]+this.width;z.z=0+m[2];z=t.multiplyByPoint(D,z,z);x.x=0+m[0];x.y=0+m[1]-this.width;x.z=0+m[2];x=t.multiplyByPoint(D,x,x);m=[z,x];z=M(this.positions[l]);this.positionsMap.has(z)||this.positionsMap.set(z,m)}this.worldCoordArr.push(m)}m=new Float32Array(6*this.worldCoordArr.length);for(var y=new Float32Array(2*this.worldCoordArr.length),r=new Uint16Array(6*(this.worldCoordArr.length-1)),D=x=z=0,G,A=this.worldCoordArr.length,l=0;l<A;++l)m[z++]=this.worldCoordArr[l][0].x-k.x,m[z++]=this.worldCoordArr[l][0].y-k.y,m[z++]=this.worldCoordArr[l][0].z-k.z,m[z++]=this.worldCoordArr[l][1].x-k.x,m[z++]=this.worldCoordArr[l][1].y-k.y,m[z++]=this.worldCoordArr[l][1].z-k.z,G=(A-1)/2,G=l<=G?(this.maxAlpha-this.minAlpha)/G*l+this.minAlpha:this.maxAlpha-this.minAlpha-(this.maxAlpha-this.minAlpha)/G*(l-G)+this.minAlpha,y[x++]=G,y[x++]=G,l<A-1&&(r[D++]=2*l,r[D++]=2*l+1,r[D++]=2*(l+1),r[D++]=2*(l+1),r[D++]=2*l+1,r[D++]=2*(l+1)+1);k=B.createVertexBuffer({context:g,typedArray:m,usage:C.STATIC_DRAW});l=B.createVertexBuffer({context:g,typedArray:y,usage:C.STATIC_DRAW});r=B.createIndexBuffer({context:g,typedArray:r,usage:C.STATIC_DRAW,indexDatatype:u.UNSIGNED_SHORT});y=3*Float32Array.BYTES_PER_ELEMENT;this._mainVA=new E({context:g,attributes:[{index:R.position,vertexBuffer:k,componentsPerAttribute:3,componentDatatype:u.FLOAT,offsetInBytes:0,strideInBytes:y},{index:R.alpha,vertexBuffer:l,componentsPerAttribute:1,componentDatatype:u.FLOAT,offsetInBytes:0,strideInBytes:y/3}],indexBuffer:r});this.changePosition=!1}c&&(this._frontFaceRS=J.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:L.ALPHA_BLEND}));d&&(this._sp=w.replaceCache({context:a.context,shaderProgram:this._sp,vertexShaderSource:O,fragmentShaderSource:Z,attributeLocations:R}));if(c||d||b)this._colorCommands.length=0,b=this._mainCommand,c=this._frontFaceRS,d=this._sp,g=this._uniforms,f=f?H.TRANSLUCENT:H.OPAQUE,b.vertexArray=this._mainVA,b.renderState=c,b.shaderProgram=d,b.uniformMap=g,b.pass=f,b.modelMatrix=t.IDENTITY.clone(),this._colorCommands.push(b);b=a.commandList;c=this._colorCommands;if(a.passes.render)for(a=0,d=c.length;a<d;a++)b.push(c[a])}}}};W.prototype.destroy=function(){return y(this)};new q;new p;W.prototype.reBuildWorldCoordArr=function(){this.worldCoordArr.length=0};return W});F("FeDataSources/Ribbon/RibbonVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./RibbonPrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,d,e){var c=d[b.id];a(c)&&(c=c.primitive,e.remove(c),c.isDestroyed()||c.destroy(),delete d[b.id])}function r(b,d){if(!a(b))throw new DeveloperError("scene is required.");if(!a(d))throw new DeveloperError("entityCollection is required.");d.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=d;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(d,d.values,[],[])}r.prototype.update=function(c){if(!a(c))throw new DeveloperError("time is required.");for(var e=this._entitiesToVisualize.values,f=this._hash,g=this._primitives,h=0,k=e.length;h<k;h++){var l=e[h],m=l._ribbonGraphics,p=f[l.id],r=a(p)?p.primitive:void 0;a(r)||(r=new q({width:d.getValueOrDefault(m._width,c,10),offset:d.getValueOrDefault(m._offset,c,[1,1,1])}),l.primitive=r,r.id=l,g.add(r),p={primitive:r,positions:void 0,orientation:void 0},f[l.id]=p);r.fadeFinished&&g.remove(r);r.show=l._show;r.positions=d.getValueOrDefault(m._positions,c,[]);r.maxVerticeNum=d.getValueOrDefault(m._maxVerticeNum,c,100);r.rotation=d.getValueOrDefault(m._rotation,c,[0,0,0]);r.offset=d.getValueOrDefault(m._offset,c,[1,1,1]);r.maxAlpha=d.getValueOrDefault(m._maxAlpha,c,1);r.minAlpha=d.getValueOrDefault(m._minAlpha,c,0);r.color=d.getValueOrDefault(m._color,c,b.RED);r.width=d.getValueOrDefault(m._width,c,10);r.fadeSpeed=d.getValueOrDefault(m._fadeSpeed,c,1);r.deleteNum=d.getValueOrDefault(m.deleteNum,c,1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,d=this._primitives,e=a.length-1;-1<e;e--)t(a[e],b,d);return h(this)};r.prototype._onCollectionChanged=function(b,d,e,f){var c,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=d.length-1;-1<b;b--)c=d[b],a(c._ribbonGraphics)&&g.set(c.id,c);for(b=f.length-1;-1<b;b--)c=f[b],a(c._ribbonGraphics)?g.set(c.id,c):(t(c,h,k),g.remove(c.id));for(b=e.length-1;-1<b;b--)c=e[b],t(c,h,k),g.remove(c.id)};return r});F("FeShadersEx/Materials/RingRadarVS",[],function(){return"attribute vec4 position;\nvoid main()\n{\n    gl_Position \x3d czm_modelViewProjection * position;\n}"});F("FeShadersEx/Materials/RingRadarFS",[],function(){return"\n#ifdef GL_ES\n    precision mediump float;\n#endif\nuniform vec4 u_color;\nuniform vec4 u_outlineColor;\nuniform float u_isline;\nuniform vec4 u_scannerColor;\nvec4 getColor(float isline)\n{\n    if(isline\x3d\x3d1.0){\n        return u_outlineColor;\n    }else if(isline\x3d\x3d2.0){\n        return u_scannerColor;\n    }else{\n        return u_color;\n    }\n}\nvoid main()\n{\n    gl_FragColor \x3d getColor(u_isline);\n}"});F("FeDataSources/RingRadar/RingRadarFramework","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,b,d,e,f){this.setParameters(a,b,d,e,f)}r.prototype.setParameters=function(a,d,e,f,g){d=b(d,0);e=b(e,0);a=b(a,0);var c=Math.sqrt(d*d+e*e+a*a);e/=c;this.radarHeight=d/c;this.sphericalRadius=e;this.bottomRadius=a/c;this.heightStride=b(f,20);this.radiusStride=b(g,50);this._bottomToCenter=Math.sqrt(this.sphericalRadius*this.sphericalRadius-this.bottomRadius*this.bottomRadius);this._topToCenter=this._bottomToCenter+this.radarHeight;if(this._topToCenter>this.sphericalRadius||this.bottomRadius>this.sphericalRadius)throw"not sutible combination of parameter for calculation";this.radiusTop=Math.sqrt(e*e-this._topToCenter*this._topToCenter)};r.prototype.createSphericalVertex=function(){for(var a=[],b=0;b<=this.heightStride;b++)for(var d=b/this.heightStride*this.radarHeight+this._bottomToCenter,e=Math.sqrt(this.sphericalRadius*this.sphericalRadius-d*d),d=0;d<=this.radiusStride;d++){var f=d/this.radiusStride*2*Math.PI;a.push([e*Math.cos(f),e*Math.sin(f),b/this.heightStride*this.radarHeight])}e=[];f=[];for(b=0;b<this.heightStride;b++)for(var g=b*(1+this.radiusStride),h=(b+1)*(1+this.radiusStride),d=0;d<this.radiusStride;d++)e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[h+d+1]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[h+d]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[g+d]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[g+d]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[g+d+1]))),e.push.apply(e,[].concat($jscomp.arrayFromIterable(a[h+d+1]))),f.push(h+d+1,h+d,g+d,g+d,g+d+1,h+d+1);return e};r.prototype.createScannerVertex=function(a){for(var b=[],c=0;c<this.heightStride;c++){var d=c/this.heightStride*this.radarHeight+this._bottomToCenter,d=Math.sqrt(this.sphericalRadius*this.sphericalRadius-d*d),e=(c+1)/this.heightStride*this.radarHeight+this._bottomToCenter,f=Math.sqrt(this.sphericalRadius*this.sphericalRadius-e*e),e=f*Math.cos(a),f=f*Math.sin(a),g=(c+1)/this.heightStride*this.radarHeight;b.push.apply(b,[].concat($jscomp.arrayFromIterable([d*Math.cos(a),d*Math.sin(a),c/this.heightStride*this.radarHeight])));b.push.apply(b,[].concat($jscomp.arrayFromIterable([0,0,0])));b.push.apply(b,[].concat($jscomp.arrayFromIterable([e,f,g])))}return b};r.prototype.createPlaneVertex=function(){for(var a=[0,0,0],b=this.calculateEdgeSphericalVertex()[1],d=[],e=0;e<b.length-1;e++)d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(b[e])));return d};r.prototype.createTopPlaneVertex=function(){for(var a=[0,0,0],b=this.calculateEdgeSphericalVertex()[1],d=[],e=0;e<b.length-1;e++)e!==b.length-1?(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(b[e]))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(b[e+1])))):(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(b[b.length-1]))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(b[0]))));return d};r.prototype.calculateEdgeSphericalVertex=function(){function a(a,b,c){for(var d=[],e=0;e<=a;e++){var f=e/a*2*Math.PI;d.push([b*Math.cos(f),b*Math.sin(f),c])}return d}return[a(this.radiusStride,this.bottomRadius,0),a(this.radiusStride,this.radiusTop,this.radarHeight)]};return r});F("FeDataSources/RingRadar/RingRadarPrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/HeadingPitchRoll ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/RingRadarVS ../../FeShadersEx/Materials/RingRadarFS ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor ./RingRadarFramework".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa){function U(c){var e=this;c=b(c,b.EMPTY_OBJECT);this.show=b(c.show,!0);this.material=a(c.material)?c.material:L.fromType(L.ColorType);this._material=void 0;this.radarHeight=b(c.radarHeight,0);this._radarHeight=void 0;this.sphericalRadius=b(c.sphericalRadius,0);this._sphericalRadius=void 0;this.bottomRadius=b(c.bottomRadius,0);this._bottomRadius=void 0;this.sphericalSurfaceLineCount=b(c.sphericalSurfaceLineCount,20);this._sphericalSurfaceLineCount=void 0;this.planeSurfaceLineCount=b(c.planeSurfaceLineCount,50);this._planeSurfaceLineCount=void 0;this.offset=b(c.offset,h.ZERO);this._offset=void 0;this.scannerColor=b(c.scannerColor,f.WHITE);this.scanningRate=b(c.scanningRate,50);this.color=b(c.color,f.WHITE);this.outlineColor=b(c.outlineColor,f.WHITE);this.showThroughEllipsoid=b(c.showThroughEllipsoid,!1);this._showThroughEllipsoid=void 0;this.modelMatrix=b(c.modelMatrix,new d);this._modelMatrix=new d;this.headingPitchRoll=b(c.headingPitchRoll,new q);this._headingPitchRoll=new q;this._computedModelMatrix=new d;this._computedScanPlaneModelMatrix=new d;this._sphericalCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._topPlaneCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scanner120Command=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scanner240Command=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scanner360Command=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._linesCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._topAndBottomLinesCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._sphericalConical;this._topAndBottomLines;this._allCommands=[];this._uniforms={u_isline:function(){return 0},u_color:function(){return e.color},u_outlineColor:function(){return e.outlineColor},u_scannerColor:function(){return e.scannerColor}};this._lastRenderingTime=void 0;this._rotatingAngle=0;this._scannerRotatingMatrix=new d}function W(a,b){var d=new Float32Array(b),d=D.createVertexBuffer({context:a,typedArray:d,usage:v.STATIC_DRAW});return new w({context:a,attributes:[{index:0,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:c.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}function M(a,b,c,d,e,f,g,h,k){b.vertexArray=e;b.renderState=c;b.shaderProgram=d;b.uniformMap=r(f,a._material._uniforms);b.uniformMap.u_isline=function(){return k};b.pass=h;b.modelMatrix=g;a._allCommands.push(b)}var R={position:0};U.prototype.update=function(a){var b=a.mode;if(this.show&&b===K.SCENE3D){var c=b=!1,f=!1,k=this.radarHeight,l=this.sphericalRadius,m=this.bottomRadius,r=this.sphericalSurfaceLineCount,w=this.planeSurfaceLineCount;void 0==this._lastRenderingTime&&(this._lastRenderingTime=z.clone(a.time,new z));var u=z.secondsDifference(a.time,this._lastRenderingTime);this._rotatingAngle+=u*this.scanningRate;this._rotatingAngle%=360;u=this._rotatingAngle/180*Math.PI;this._lastRenderingTime=z.clone(a.time,this._lastRenderingTime);this._rotatingMatrix3=p.fromRotationZ(u,new p);if(0>k||0>l||0>m||0>r||0>w)throw new e("height/backScannerRadius/frontScannerRadius   must be greater than or equal to zero.");if(0!=k&&0!=l&&0!=m&&0!=r&&0!=w){if(this._radarHeight!==k||this._sphericalRadius!==l||this._bottomRadius!==m||this._heightStride!==r||this._radiusStride!==w)this._radarHeight=k,this._sphericalRadius=l,this._bottomRadius=m,this._heightStride=r,this._radiusStride=w,b=!0,this._boundingSphere=new g(h.ZERO,m);void 0==this.ringRadarFramework?this.ringRadarFramework=new aa(m,k,l,r,w):this.ringRadarFramework.setParameters(m,k,l,r,w);k=!d.equals(this.modelMatrix,this._modelMatrix);l=!q.equals(this.headingPitchRoll,this._headingPitchRoll);r=!h.equals(this.offset,this._offset);if(k||l||r)d.clone(this.modelMatrix,this._modelMatrix),this._offset=h.clone(this.offset,this._offset),d.multiplyByUniformScale(this.modelMatrix,m,this._computedModelMatrix),g.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC),k=this._offset.x/m,l=this._offset.y/m,m=this._offset.z/m,q.clone(this.headingPitchRoll,this._headingPitchRoll),r=p.fromHeadingPitchRoll(this._headingPitchRoll,new p),m=d.fromRotationTranslation(r,h.fromElements(k,l,m),new d),d.multiply(this._computedModelMatrix,m,this._computedModelMatrix);d.multiplyByMatrix3(this._computedModelMatrix,this._rotatingMatrix3,this._scannerRotatingMatrix);k=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=k,c=!0);m=this.material;this._material!==m&&(this._material=m,f=c=!0);b&&(l=a.context,this._sphericalConical=W(l,this.ringRadarFramework.createSphericalVertex()),this._topAndBottomLines=W(l,this.ringRadarFramework.createPlaneVertex()),this._topPlaneVertex=W(l,this.ringRadarFramework.createTopPlaneVertex()),this._scannerVertex120=W(l,this.ringRadarFramework.createScannerVertex(2*Math.PI/3)),this._scannerVertex240=W(l,this.ringRadarFramework.createScannerVertex(4*Math.PI/3)),this._scannerVertex360=W(l,this.ringRadarFramework.createScannerVertex(2*Math.PI)));c&&(this._frontFaceRS=I.fromCache({depthTest:{enabled:!k},polygonOffset:{enabled:!0,factor:5,units:5},blending:G.ALPHA_BLEND,depthMask:!1}),this._lineFaceRS=I.fromCache({depthTest:{enabled:!k},depthMask:!1,blending:G.ALPHA_BLEND,cull:{enabled:!1,face:E.BACK},polygonOffset:{enabled:!0,factor:-5,units:-5}}));f&&(k=a.context,m=new J({sources:[m.shaderSource,N]}),this._shaderProgram=H.replaceCache({context:k,shaderProgram:this._shaderProgram,vertexShaderSource:P,fragmentShaderSource:m,attributeLocations:R}));if(c||f||b)this._allCommands.length=0,b=C.OPAQUE,M(this,this._sphericalCommand,this._frontFaceRS,this._shaderProgram,this._sphericalConical,this._uniforms,this._computedModelMatrix,b),M(this,this._topPlaneCommand,this._frontFaceRS,this._shaderProgram,this._topPlaneVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._scanner120Command,this._lineFaceRS,this._shaderProgram,this._scannerVertex120,this._uniforms,this._scannerRotatingMatrix,b,2),M(this,this._scanner240Command,this._lineFaceRS,this._shaderProgram,this._scannerVertex240,this._uniforms,this._scannerRotatingMatrix,b,2),M(this,this._scanner360Command,this._lineFaceRS,this._shaderProgram,this._scannerVertex360,this._uniforms,this._scannerRotatingMatrix,b,2),M(this,this._topAndBottomLinesCommand,this._lineFaceRS,this._shaderProgram,this._topAndBottomLines,this._uniforms,this._computedModelMatrix,b,1),M(this,this._linesCommand,this._lineFaceRS,this._shaderProgram,this._sphericalConical,this._uniforms,this._computedModelMatrix,b,1);b=a.commandList;c=this._allCommands;if(a.passes.render)for(a=0,f=c.length;a<f;a++)b.push(c[a])}}};U.prototype.destroy=function(){return u(this)};new p;new h;return U});F("FeDataSources/RingRadar/RingRadarVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./RingRadarPrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,c,d){var e=c[b.id];a(e)&&(e=e.primitive,d.remove(e),e.isDestroyed()||e.destroy(),delete c[b.id])}function r(b,c){if(!a(b))throw new DeveloperError("scene is required.");if(!a(c))throw new DeveloperError("entityCollection is required.");c.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=c;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(c,c.values,[],[])}new m;new e;var c=new g;new g;new l;new g;new l;r.prototype.update=function(b){if(!a(b))throw new DeveloperError("time is required.");for(var h=this._entitiesToVisualize.values,k=this._hash,l=this._primitives,r=0,u=h.length;r<u;r++){var v=h[r],t=v._ringRadar,C,I=k[v.id],H=v.isShowing&&v.isAvailable(b)&&d.getValueOrDefault(t._show,b,!0);H&&(C=d.getValueOrUndefined(v._position,b,c));H?(H=a(I)?I.primitive:void 0,a(H)||(H=new q,H.id=v,l.add(H),I={primitive:H,position:void 0,orientation:void 0},k[v.id]=I),H.modelMatrix=e.multiply(f.eastNorthUpToFixedFrame(C),d.getValueOrDefault(t._modelMatrix,b,void 0),H.modelMatrix),e.multiplyByMatrix3(H.modelMatrix,m.fromRotationZ(Math.PI/2),H.modelMatrix),I.position=g.clone(C,I.position),H.show=!0,H.material=p.getValue(b,t._material,H.material),H.radarHeight=d.getValueOrDefault(t._radarHeight,b,void 0),H.sphericalRadius=d.getValueOrDefault(t._sphericalRadius,b,void 0),H.bottomRadius=d.getValueOrDefault(t._bottomRadius,b,void 0),H.sphericalSurfaceLineCount=d.getValueOrDefault(t._sphericalSurfaceLineCount,b,void 0),H.planeSurfaceLineCount=d.getValueOrDefault(t._planeSurfaceLineCount,b,void 0),H.scannerColor=d.getValueOrDefault(t._scannerColor,b,void 0),H.scanningRate=d.getValueOrDefault(t._scanningRate,b,void 0),H.headingPitchRoll=d.getValueOrDefault(t._headingPitchRoll,b,void 0),H.offset=d.getValueOrDefault(t._offset,b,void 0),H.color=d.getValueOrDefault(t._color,b,void 0),H.outlineColor=d.getValueOrDefault(t._outlineColor,b,void 0)):a(I)&&(I.primitive.show=!1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,c=this._primitives,d=a.length-1;-1<d;d--)t(a[d],b,c);return h(this)};r.prototype._onCollectionChanged=function(b,c,d,e){var f,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=c.length-1;-1<b;b--)f=c[b],a(f._ringRadar)&&a(f._position)&&g.set(f.id,f);for(b=e.length-1;-1<b;b--)f=e[b],a(f._ringRadar)&&a(f._position)?g.set(f.id,f):(t(f,h,k),g.remove(f.id));for(b=d.length-1;-1<b;b--)f=d[b],t(f,h,k),g.remove(f.id)};return r});F("FeShadersEx/Materials/ParabolaRadarVS",[],function(){return"attribute vec4 position;\n    attribute vec4 linerColor;\n    attribute vec4 outlineColor;\n  varying vec4 v_Color;\n  varying vec4 v_outlineColor;\nvoid main()\n{\n    gl_Position \x3d czm_modelViewProjection * position;\n    v_Color \x3d linerColor;\n    v_outlineColor \x3d outlineColor;\n}"});F("FeShadersEx/Materials/ParabolaRadarFS",[],function(){return"\n    #ifdef GL_ES\n        precision mediump float;\n    #endif\n    uniform vec4 u_color;\n    varying vec4 v_outlineColor;\n    uniform float u_isline;\n    uniform vec4 u_scannerColor;\n    varying vec4 v_Color;\n    uniform float u_alphaFactor;\n    vec4 getColor(float isline)\n    {\n        if(isline\x3d\x3d1.0){\n            return v_outlineColor;\n        }else if(isline\x3d\x3d2.0){\n            return u_scannerColor;\n        }else{\n            return v_Color;\n        }\n    }\n    void main()\n    {\n        vec4 curColor \x3d getColor(u_isline);\n\t\tfloat alpha \x3d curColor[3];\n        curColor[3] \x3d alpha*u_alphaFactor;\n        gl_FragColor \x3d curColor;\n    }"});F("FeDataSources/ParabolaRadar/ParabolaRadarFramework","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/Color ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a,b,c,d,e){this.setParameters(a,b,c,d)}function u(a,b,c){var e=[];a=a.getHSLA();var f=b.getHSLA();b=f[0]-a[0];for(var g=f[1]-a[1],h=f[2]-a[2],f=f[3]-a[3],k=0;k<=c;k++){var l=d.fromHsl(a[0]+k/c*b,a[1]+k/c*g,a[2]+k/c*h,a[3]+k/c*f);e.push([l.red,l.green,l.blue,l.alpha])}return e}c.prototype.setParameters=function(a,c,d,e){c=b(c,1200);a=b(a,400);var f=Math.sqrt(a*a+c*c);this.parabolaRadius=c/f;this.parabolaHeight=a/f;this.rStride=b(d,50);this.angleStride=b(e,50)};c.prototype.createParabolaVertexArray=function(a){var b=this.parabolaRadius,c=this.parabolaHeight,d=this.rStride,e=this.angleStride;if(a instanceof Array)a=1==a.length?u(a[0],a[0],d):u(a[0],a[1],d);else if(a instanceof String)a=u(a,a,d);else throw"Not a sutable value of color";for(var f=[],g=[],h=0;h<=d;h++)for(var k=h/d*b,l=0;l<=e;l++){var m=l/e*2*Math.PI;g.push([k*Math.cos(m),k*Math.sin(m),4*c/(-b*b)*k*(k-b)])}for(h=0;h<d;h++)for(b=h*(1+e),c=(h+1)*(1+e),l=0;l<e;l++)f.push.apply(f,[].concat($jscomp.arrayFromIterable(g[c+l+1]),$jscomp.arrayFromIterable(a[h+1]))),f.push.apply(f,[].concat($jscomp.arrayFromIterable(g[b+l+1]),$jscomp.arrayFromIterable(a[h]))),f.push.apply(f,[].concat($jscomp.arrayFromIterable(g[b+l]),$jscomp.arrayFromIterable(a[h]))),f.push.apply(f,[].concat($jscomp.arrayFromIterable(g[b+l]),$jscomp.arrayFromIterable(a[h]))),f.push.apply(f,[].concat($jscomp.arrayFromIterable(g[c+l]),$jscomp.arrayFromIterable(a[h+1]))),f.push.apply(f,[].concat($jscomp.arrayFromIterable(g[c+l+1]),$jscomp.arrayFromIterable(a[h+1])));return f};c.prototype.createScannerVertex=function(){for(var a=this.parabolaRadius,b=this.parabolaHeight,c=this.rStride,d=[],e=0;e<c;e++){var f=e/c*a,g=(e+1)/c*a,h=g*Math.cos(0),k=g*Math.sin(0),g=4*b/(-a*a)*g*(g-a);d.push.apply(d,[].concat($jscomp.arrayFromIterable([f*Math.cos(0),f*Math.sin(0),4*b/(-a*a)*f*(f-a)])));d.push.apply(d,[].concat($jscomp.arrayFromIterable([0,0,0])));d.push.apply(d,[].concat($jscomp.arrayFromIterable([h,k,g])))}return d};c.prototype.validateInitialData=function(){};return c});F("FeDataSources/ParabolaRadar/ParabolaRadarPrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/HeadingPitchRoll ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/ParabolaRadarVS ../../FeShadersEx/Materials/ParabolaRadarFS ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor ./ParabolaRadarFramework".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa){function U(c){var e=this;c=b(c,b.EMPTY_OBJECT);this.show=b(c.show,!0);this.material=a(c.material)?c.material:L.fromType(L.ColorType);this._material=void 0;this.parabolaRadius=b(c.parabolaRadius,0);this._parabolaRadius=void 0;this.parabolaHeight=b(c.parabolaHeight,0);this._parabolaHeight=void 0;this.horizontalLineCount=b(c.horizontalLineCount,0);this._horizontalLineCount=void 0;this.verticalLineCount=b(c.verticalLineCount,0);this._verticalLineCount=void 0;this.offset=b(c.offset,h.ZERO);this._offset=void 0;this.scannerColor=b(c.scannerColor,f.WHITE);this.color=b(c.color,f.WHITE);this._color=void 0;this.alphaFactor=b(c.alphaFactor,1);this.outlineColor=b(c.outlineColor,f.WHITE);this._outlineColor=void 0;this.scanningRate=b(c.scanningRate,50);this.showThroughEllipsoid=b(c.showThroughEllipsoid,!1);this._showThroughEllipsoid=void 0;this.modelMatrix=b(c.modelMatrix,new d);this._modelMatrix=new d;this.headingPitchRoll=b(c.headingPitchRoll,new q);this._headingPitchRoll=new q;this._computedModelMatrix=new d;this._computedScanPlaneModelMatrix=new d;this._curvedPlaneCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._scannerCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._linesCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._allCommands=[];this._uniforms={u_isline:function(){return 0},u_scannerColor:function(){return e.scannerColor},u_alphaFactor:function(){return e.alphaFactor}};this._lastRenderingTime=void 0;this._rotatingAngle=0;this._scannerRotatingMatrix=new d}function W(a,b){if(b instanceof Array)for(var c=0;c<b.length;c++)if(!b[c].equals(a[c]))return!0;return!1}function M(a,b,d){b=new Float32Array(b);b=D.createVertexBuffer({context:a,typedArray:b,usage:v.STATIC_DRAW});var e=7*Float32Array.BYTES_PER_ELEMENT;return new w({context:a,attributes:[{index:Y.position,vertexBuffer:b,componentsPerAttribute:3,componentDatatype:c.FLOAT,offsetInBytes:0,strideInBytes:e},{index:d,vertexBuffer:b,componentsPerAttribute:4,componentDatatype:c.FLOAT,offsetInBytes:3*Float32Array.BYTES_PER_ELEMENT,strideInBytes:e}]})}function R(a,b,c,d,e,f,g,h,k){b.vertexArray=e;b.renderState=c;b.shaderProgram=d;b.uniformMap=r(f,a._material._uniforms);b.uniformMap.u_isline=function(){return k};b.pass=h;b.modelMatrix=g;a._allCommands.push(b)}var Y={position:0,color:1,outlineColor:2};U.prototype.update=function(a){var b=a.mode;if(this.show&&b===K.SCENE3D){var f=b=!1,k=!1,l=this.parabolaRadius,m=this.parabolaHeight,r=this.horizontalLineCount,u=this.verticalLineCount,t=this.outlineColor,y=this.color,B=l>=m?l:m;void 0==this._lastRenderingTime&&(this._lastRenderingTime=z.clone(a.time,new z));var A=z.secondsDifference(a.time,this._lastRenderingTime);this._rotatingAngle+=A*this.scanningRate;this._rotatingAngle%=360;A=this._rotatingAngle/180*Math.PI;this._lastRenderingTime=z.clone(a.time,this._lastRenderingTime);this._rotatingMatrix3=p.fromRotationZ(A,new p);if(0>m||0>r||0>l||0>u)throw new e("parabolaHeight/backScannerRadius/parabolaHeight   must be greater than or equal to zero.");if(!(0==m||0==r||0==l||0>u)){if(this._parabolaHeight!==m||this._horizontalLineCount!==r||this._parabolaRadius!==l||this._verticalLineCount!==u||W(this._color,y)||W(this._outlineColor,t))this._parabolaHeight=m,this._horizontalLineCount=r,this._parabolaRadius=l,this._verticalLineCount=u,this._color=y,this._outlineColor=t,b=!0,this._boundingSphere=new g(h.ZERO,B);void 0==this.parabolaRadarFramework?this.parabolaRadarFramework=new aa(m,l,r,u):this.parabolaRadarFramework.setParameters(m,l,r,u);l=!d.equals(this.modelMatrix,this._modelMatrix);m=!q.equals(this.headingPitchRoll,this._headingPitchRoll);r=!h.equals(this.offset,this._offset);if(l||m||r)d.clone(this.modelMatrix,this._modelMatrix),this._offset=h.clone(this.offset,this._offset),d.multiplyByUniformScale(this.modelMatrix,B,this._computedModelMatrix),g.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC),l=this._offset.x/B,m=this._offset.y/B,B=this._offset.z/B,q.clone(this.headingPitchRoll,this._headingPitchRoll),r=p.fromHeadingPitchRoll(this._headingPitchRoll,new p),B=d.fromRotationTranslation(r,h.fromElements(l,m,B),new d),d.multiply(this._computedModelMatrix,B,this._computedModelMatrix);d.multiplyByMatrix3(this._computedModelMatrix,this._rotatingMatrix3,this._scannerRotatingMatrix);l=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=l,f=!0);B=this.material;this._material!==B&&(this._material=B,k=f=!0);b&&(m=a.context,this._parabolaPlaneVertex=M(m,this.parabolaRadarFramework.createParabolaVertexArray(this.color),Y.color),this._parabolaLineVertex=M(m,this.parabolaRadarFramework.createParabolaVertexArray(this.outlineColor),Y.outlineColor),r=this.parabolaRadarFramework.createScannerVertex(),r=new Float32Array(r),r=D.createVertexBuffer({context:m,typedArray:r,usage:v.STATIC_DRAW}),this._scannerVertex=new w({context:m,attributes:[{index:0,vertexBuffer:r,componentsPerAttribute:3,componentDatatype:c.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]}));f&&(this._parabolaFaceRS=I.fromCache({depthTest:{enabled:!l},cull:{enabled:!0,face:E.BACK},polygonOffset:{enabled:!0,factor:5,units:5},blending:G.ALPHA_BLEND,depthMask:!1}),this._lineFaceRS=I.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:G.ALPHA_BLEND,cull:{enabled:!1,face:E.BACK},polygonOffset:{enabled:!0,factor:-5,units:-5}}));k&&(l=a.context,B=new J({sources:[B.shaderSource,N]}),this._shaderProgram=H.replaceCache({context:l,shaderProgram:this._shaderProgram,vertexShaderSource:P,fragmentShaderSource:B,attributeLocations:Y}));if(f||k||b)this._allCommands.length=0,b=C.OPAQUE,R(this,this._curvedPlaneCommand,this._parabolaFaceRS,this._shaderProgram,this._parabolaPlaneVertex,this._uniforms,this._computedModelMatrix,b),R(this,this._scannerCommand,this._lineFaceRS,this._shaderProgram,this._scannerVertex,this._uniforms,this._scannerRotatingMatrix,b,2),R(this,this._linesCommand,this._lineFaceRS,this._shaderProgram,this._parabolaLineVertex,this._uniforms,this._computedModelMatrix,b,1);b=a.commandList;f=this._allCommands;if(a.passes.render)for(a=0,k=f.length;a<k;a++)b.push(f[a])}}};U.prototype.destroy=function(){return u(this)};new p;new h;return U});F("FeDataSources/ParabolaRadar/ParabolaRadarVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./ParabolaRadarPrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,c,d){var e=c[b.id];a(e)&&(e=e.primitive,d.remove(e),e.isDestroyed()||e.destroy(),delete c[b.id])}function r(b,c){if(!a(b))throw new DeveloperError("scene is required.");if(!a(c))throw new DeveloperError("entityCollection is required.");c.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=c;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(c,c.values,[],[])}new m;new e;var c=new g;new g;new l;new g;new l;r.prototype.update=function(b){if(!a(b))throw new DeveloperError("time is required.");for(var h=this._entitiesToVisualize.values,k=this._hash,l=this._primitives,r=0,u=h.length;r<u;r++){var v=h[r],t=v._parabolaRadar,C,I=k[v.id],H=v.isShowing&&v.isAvailable(b)&&d.getValueOrDefault(t._show,b,!0);H&&(C=d.getValueOrUndefined(v._position,b,c));H?(H=a(I)?I.primitive:void 0,a(H)||(H=new q,H.id=v,l.add(H),I={primitive:H,position:void 0,orientation:void 0},k[v.id]=I),H.modelMatrix=e.multiply(f.eastNorthUpToFixedFrame(C),d.getValueOrDefault(t._modelMatrix,b,void 0),H.modelMatrix),e.multiplyByMatrix3(H.modelMatrix,m.fromRotationZ(Math.PI/2),H.modelMatrix),I.position=g.clone(C,I.position),H.show=!0,H.material=p.getValue(b,t._material,H.material),H.parabolaRadius=d.getValueOrDefault(t._parabolaRadius,b,void 0),H.parabolaHeight=d.getValueOrDefault(t._parabolaHeight,b,void 0),H.horizontalLineCount=d.getValueOrDefault(t._horizontalLineCount,b,void 0),H.verticalLineCount=d.getValueOrDefault(t._verticalLineCount,b,void 0),H.scannerColor=d.getValueOrDefault(t._scannerColor,b,void 0),H.color=d.getValueOrDefault(t._color,b,void 0),H.alphaFactor=d.getValueOrDefault(t._alphaFactor,b,1),H.offset=d.getValueOrDefault(t._offset,b,[0,0,0]),H.scanningRate=d.getValueOrDefault(t._scanningRate,b,void 0),H.headingPitchRoll=d.getValueOrDefault(t._headingPitchRoll,b,void 0),H.outlineColor=d.getValueOrDefault(t._outlineColor,b,void 0)):a(I)&&(I.primitive.show=!1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,c=this._primitives,d=a.length-1;-1<d;d--)t(a[d],b,c);return h(this)};r.prototype._onCollectionChanged=function(b,c,d,e){var f,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=c.length-1;-1<b;b--)f=c[b],a(f._parabolaRadar)&&a(f._position)&&g.set(f.id,f);for(b=e.length-1;-1<b;b--)f=e[b],a(f._parabolaRadar)&&a(f._position)?g.set(f.id,f):(t(f,h,k),g.remove(f.id));for(b=d.length-1;-1<b;b--)f=d[b],t(f,h,k),g.remove(f.id)};return r});F("FeShadersEx/Materials/SquareconeScannerVS",[],function(){return"attribute vec4 position;\nvoid main()\n{\n    gl_Position \x3d czm_modelViewProjection * position;\n}"});F("FeShadersEx/Materials/SquareconeScannerFS",[],function(){return"\n#ifdef GL_ES\n    precision mediump float;\n#endif\nuniform vec4 u_color;\nuniform vec4 u_outlineColor;\nuniform float u_isline;\nvec4 getColor(float isline)\n{\n    if(isline\x3d\x3d1.0){\n        return u_outlineColor;\n    } else {\n        return u_color;\n    }\n}\nvoid main()\n{\n    gl_FragColor \x3d getColor(u_isline);\n}"});F("FeDataSources/SquareconeScanner/SquareconeFramework","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,b,c,d,e,f,g){this.setParameters(a,b,c,d,e,f,g)}function c(a,b,c){c=-2*a*Math.cos(c);b=a*a-b*b;a=(-c+Math.sqrt(c*c-4*b))/2;c=(-c-Math.sqrt(c*c-4*b))/2;return Math.abs(a)>Math.abs(c)?Math.abs(c):Math.abs(a)}r.prototype.setParameters=function(a,c,d,e,f,g,h){a=b(a,0);c=b(c,0);d=b(d,0);var k=Math.sqrt(c*c);this.height=a/k;this.rectangleHeight=c/k;this.maxEllipsoidRadii=d/k;this.horizontalAngle=b(e,0);this.verticalAngle=b(f,0);this.hStride=b(g,20);this.angleStride=b(h,20);this._maxClampEllipsoidAngle=Math.asin(this.maxEllipsoidRadii/(this.maxEllipsoidRadii+this.height))};r.prototype.createClampEllipsiodLineArray=function(){var a=this.calSquareClampLineArray(),b=[];[].concat($jscomp.arrayFromIterable(a.qdt1horizontal),$jscomp.arrayFromIterable(a.qdt1vertical),$jscomp.arrayFromIterable(a.qdt2vertical),$jscomp.arrayFromIterable(a.qdt2horizontal),$jscomp.arrayFromIterable(a.qdt3horizontal),$jscomp.arrayFromIterable(a.qdt3vertical),$jscomp.arrayFromIterable(a.qdt4vertical),$jscomp.arrayFromIterable(a.qdt4horizontal)).forEach(function(a,c){b.push.apply(b,[].concat($jscomp.arrayFromIterable(a.position)))});return b};r.prototype.createVertexConicalLineArray=function(){function a(a){var c=[],d=b.rectangleHeight/Math.cos(b._maxClampEllipsoidAngle);a.forEach(function(a){if(a.angle>=b._maxClampEllipsoidAngle){var e=Math.sqrt(a.position[0]*a.position[0]+a.position[1]*a.position[1]+a.position[2]*a.position[2]);c.push([d/e*a.position[0],d/e*a.position[1],d/e*a.position[2]])}});return c}var b=this,c=b.calSquareClampLineArray(),d=[],e=[].concat($jscomp.arrayFromIterable(c.qdt1horizontal),$jscomp.arrayFromIterable(c.qdt1vertical)),f=a(e),e=[].concat($jscomp.arrayFromIterable(c.qdt2vertical),$jscomp.arrayFromIterable(c.qdt2horizontal)),g=a(e),e=[].concat($jscomp.arrayFromIterable(c.qdt3horizontal),$jscomp.arrayFromIterable(c.qdt3vertical)),h=a(e),c=[].concat($jscomp.arrayFromIterable(c.qdt4vertical),$jscomp.arrayFromIterable(c.qdt4horizontal)),k=a(c);f.forEach(function(a,b){b<f.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(f[b+1]))))});g.forEach(function(a,b){b<g.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(g[b+1]))))});h.forEach(function(a,b){b<h.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(h[b+1]))))});k.forEach(function(a,b){b<k.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(k[b+1]))))});return d};r.prototype.createVertexSquareLineArray=function(){var a=[];this.calSquareKeyPoints().forEach(function(b,c){b.forEach(function(b){a.push.apply(a,[].concat($jscomp.arrayFromIterable(b)))})});return a};r.prototype.calSquareClampLineArray=function(){var a=this.horizontalAngle,b=this.rectangleHeight,d=[],e=[],f=[],g=[],h=[],k=[],l=[],m=[],p=[],q;q=b*Math.tan(this.verticalAngle/2);for(var a=b*Math.tan(a/2),r=0;20>=r;r++){var t=q,E=r/20*a,L=Math.atan(Math.sqrt(t*t+E*E)/b),K;if(L<=this._maxClampEllipsoidAngle){K=c(this.height+this.maxEllipsoidRadii,this.maxEllipsoidRadii,L);var P=Math.sqrt(t*t+E*E+b*b)}else{K=this.maxEllipsoidRadii/Math.tan(this._maxClampEllipsoidAngle);var P=b*Math.tan(this._maxClampEllipsoidAngle),N=Math.sqrt(t*t+E*E),t=P/N*t,E=P/N*E,P=Math.sqrt(t*t+E*E+b*b)}t*=K/P;E*=K/P;P=K/P*-b;e.push({position:[E,t,P],angle:L});f.push({position:[E,-t,P],angle:L});g.push({position:[-E,-t,P],angle:L});h.push({position:[-E,t,P],angle:L});t=r/20*q;E=a;L=Math.atan(Math.sqrt(t*t+E*E)/b);L<=this._maxClampEllipsoidAngle?K=c(this.height+this.maxEllipsoidRadii,this.maxEllipsoidRadii,L):(K=this.maxEllipsoidRadii/Math.tan(this._maxClampEllipsoidAngle),P=b*Math.tan(this._maxClampEllipsoidAngle),N=Math.sqrt(t*t+E*E),t*=P/N,E*=P/N);P=Math.sqrt(t*t+E*E+b*b);t*=K/P;E*=K/P;P=K/P*-b;k.push({position:[E,t,P],angle:L});l.push({position:[E,-t,P],angle:L});m.push({position:[-E,-t,P],angle:L});p.push({position:[-E,t,P],angle:L});K=L<=this._maxClampEllipsoidAngle?c(this.height+this.maxEllipsoidRadii,this.maxEllipsoidRadii,L):c(this.height+this.maxEllipsoidRadii,this.maxEllipsoidRadii,this._maxClampEllipsoidAngle)}f=f.reverse();h=h.reverse();k=k.reverse();m=m.reverse();b={qdt1horizontal:e,qdt1vertical:k,qdt2vertical:l,qdt2horizontal:f,qdt3horizontal:g,qdt3vertical:m,qdt4vertical:p,qdt4horizontal:h};[].forEach(function(a){d.push.apply(d,[].concat($jscomp.arrayFromIterable(a)))});return b};r.prototype.calRectanglePoints=function(){var a,b,c=[];b=this.horizontalAngle;a=this.rectangleHeight*Math.tan(this.verticalAngle/2);b=this.rectangleHeight*Math.tan(b/2);var d=-this.rectangleHeight;c.push([b,a,d]);c.push([b,-a,d]);c.push([-b,-a,d]);c.push([-b,a,d]);return c};r.prototype.calClampEllipsoidConicalArray=function(){var a=[],b=[],c=this.calSquareClampLineArray();b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt1horizontal)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt1vertical)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt2vertical)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt2horizontal)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt3horizontal)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt3vertical)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt4vertical)));b.push.apply(b,[].concat($jscomp.arrayFromIterable(c.qdt4horizontal)));b.forEach(function(c,d){d<b.length-1&&(a.push.apply(a,[].concat($jscomp.arrayFromIterable(c.position))),a.push.apply(a,[].concat($jscomp.arrayFromIterable([0,0,0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[d+1].position))))});return a};r.prototype.isAllClampToEllipsoid=function(){var a=Math.tan(this.horizontalAngle/2),b=Math.tan(this.verticalAngle/2);return Math.atan(Math.sqrt(a*a+b*b))<=this._maxClampEllipsoidAngle};r.prototype.calCombinedConicalArray=function(){function a(a){a=a.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle});var c=[],d=b.rectangleHeight/Math.cos(b._maxClampEllipsoidAngle);a.forEach(function(a){var b=Math.sqrt(a.position[0]*a.position[0]+a.position[1]*a.position[1]+a.position[2]*a.position[2]);c.push([d/b*a.position[0],d/b*a.position[1],d/b*a.position[2]])});return c}var b=this,c=b.calSquareClampLineArray(),d=[],e=[].concat($jscomp.arrayFromIterable(c.qdt1horizontal),$jscomp.arrayFromIterable(c.qdt1vertical)),f=a(e),e=[].concat($jscomp.arrayFromIterable(c.qdt2vertical),$jscomp.arrayFromIterable(c.qdt2horizontal)),g=a(e),e=[].concat($jscomp.arrayFromIterable(c.qdt3horizontal),$jscomp.arrayFromIterable(c.qdt3vertical)),h=a(e),c=[].concat($jscomp.arrayFromIterable(c.qdt4vertical),$jscomp.arrayFromIterable(c.qdt4horizontal)),k=a(c);f.forEach(function(a,b){b<f.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable([0,0,0]))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(f[b+1]))))});g.forEach(function(a,b){b<g.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable([0,0,0]))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(g[b+1]))))});h.forEach(function(a,b){b<h.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable([0,0,0]))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(h[b+1]))))});k.forEach(function(a,b){b<k.length-1&&(d.push.apply(d,[].concat($jscomp.arrayFromIterable(a))),d.push.apply(d,[].concat($jscomp.arrayFromIterable([0,0,0]))),d.push.apply(d,[].concat($jscomp.arrayFromIterable(k[b+1]))))});return d};r.prototype.calSquareKeyPoints=function(){function a(a,b){var c=Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);return[b/c*a[0],b/c*a[1],b/c*a[2]]}var b=this,c=b.rectangleHeight/Math.cos(b._maxClampEllipsoidAngle),d=b.calRectanglePoints(),e=b.calSquareClampLineArray(),f=e.qdt1vertical.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),g=e.qdt2vertical.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),h=e.qdt3vertical.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),k=e.qdt4vertical.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),l=e.qdt1horizontal.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),m=e.qdt2horizontal.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),p=e.qdt3horizontal.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),q=e.qdt4horizontal.filter(function(a){return a.angle>=b._maxClampEllipsoidAngle}),r=[];r.push(d[0]);0<f.length&&f.length!=e.qdt1vertical.length&&r.push(a(f[f.length-1].position,c));0<g.length&&g.length!=e.qdt2vertical.length&&r.push(a(g[0].position,c));r.push(d[1]);f=[];f.push(d[1]);0<m.length&&m.length!=e.qdt2horizontal.length&&f.push(a(m[m.length-1].position,c));0<p.length&&p.length!=e.qdt3horizontal.length&&f.push(a(p[0].position,c));f.push(d[2]);m=[];m.push(d[2]);0<h.length&&h.length!=e.qdt3vertical.length&&m.push(a(h[h.length-1].position,c));0<k.length&&k.length!=e.qdt4vertical.length&&m.push(a(k[0].position,c));m.push(d[3]);h=[];h.push(d[3]);0<q.length&&q.length!=e.qdt4horizontal.length&&h.push(a(q[q.length-1].position,c));0<l.length&&l.length!=e.qdt1horizontal.length&&h.push(a(l[0].position,c));h.push(d[0]);return[r,f,m,h]};r.prototype.calCombinedSquareArray=function(){var a=[];this.calSquareKeyPoints().forEach(function(b){2==b.length?(a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable([0,0,0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[1])))):4==b.length&&(a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable([0,0,0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[1]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[2]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable([0,0,0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[3]))))});return a};return r});F("FeDataSources/SquareconeScanner/SquareconePrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/HeadingPitchRoll ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/SquareconeScannerVS ../../FeShadersEx/Materials/SquareconeScannerFS ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor ./SquareconeFramework".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa){function U(c){var e=this;c=b(c,b.EMPTY_OBJECT);this.show=b(c.show,!0);this.material=a(c.material)?c.material:L.fromType(L.ColorType);this._material=void 0;this.height=b(c.height,0);this._height=void 0;this.horizontalAngle=b(c.horizontalAngle,0);this._horizontalAngle=void 0;this.verticalAngle=b(c.verticalAngle,0);this._verticalAngle=void 0;this.rectangleHeight=b(c.rectangleHeight,0);this._rectangleHeight=void 0;this.maxEllipsoidRadii=b(c.maxEllipsoidRadii,0);this._maxEllipsoidRadii=void 0;this.offset=b(c.offset,h.ZERO);this._offset=void 0;this.color=b(c.color,f.WHITE);this.outlineColor=b(c.outlineColor,f.WHITE);this.showThroughEllipsoid=b(c.showThroughEllipsoid,!1);this._showThroughEllipsoid=void 0;this.modelMatrix=b(c.modelMatrix,new d);this._modelMatrix=new d;this.headingPitchRoll=b(c.headingPitchRoll,new q);this._headingPitchRoll=new q;this._computedModelMatrix=new d;this._computedScanPlaneModelMatrix=new d;this._squareFrontCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._squareBackCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._squareLineCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._conicalLineCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._clampEllipsiodLineCommand=new B({owner:this,primitiveType:t.LINE_STRIP,boundingVolume:this._boundingSphereWC});this._conicalFrontCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._conicalBackCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._colorCommands=[];this._uniforms={u_isline:function(){return 0},u_color:function(){return e.color},u_outlineColor:function(){return e.outlineColor}};this._angleStride=this._hStride=40}function W(a,b){var d=new Float32Array(b),d=D.createVertexBuffer({context:a,typedArray:d,usage:v.STATIC_DRAW});return new w({context:a,attributes:[{index:0,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:c.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}function M(a,b,c,d,e,f,g,h,k){b.vertexArray=e;b.renderState=c;b.shaderProgram=d;b.uniformMap=r(f,a._material._uniforms);k&&(b.uniformMap.u_isline=function(){return 1});b.pass=h;b.modelMatrix=g;a._colorCommands.push(b)}var R={position:0};U.prototype.update=function(a){var b=a.mode;if(this.show&&b===K.SCENE3D){var c=b=!1,f=!1,k=this.height,l=this.rectangleHeight,m=this.maxEllipsoidRadii,r=this.verticalAngle,w=this.horizontalAngle,v=Math.sqrt(l*l);if(0>k||0>m||0>l)throw new e("height/maxEllipsoidRadii/rectangleHeight   must be greater than or equal to zero.");if(0!=k&&0!=m&&0!=l&&0!=r&&0!=w){if(this._height!==k||this._maxEllipsoidRadii!==m||this._rectangleHeight!==l||this._verticalAngle!==r||this._horizontalAngle!==w)this._height=k,this._maxEllipsoidRadii=m,this._rectangleHeight=l,this._verticalAngle=r,this._horizontalAngle=w,b=!0,this._boundingSphere=new g(h.ZERO,v);void 0==this.squareconeScannerFramework?this.squareconeScannerFramework=new aa(k,l,m,w,r,this._hStride,this._angleStride):this.squareconeScannerFramework.setParameters(k,l,m,w,r,this._hStride,this._angleStride);k=!d.equals(this.modelMatrix,this._modelMatrix);l=!q.equals(this.headingPitchRoll,this._headingPitchRoll);m=!h.equals(this.offset,this._offset);if(k||l||m)d.clone(this.modelMatrix,this._modelMatrix),this._offset=h.clone(this.offset,this._offset),d.multiplyByUniformScale(this.modelMatrix,v,this._computedModelMatrix),g.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC),k=this._offset.x/v,l=this._offset.y/v,v=this._offset.z/v,q.clone(this.headingPitchRoll,this._headingPitchRoll),m=p.fromHeadingPitchRoll(this._headingPitchRoll,new p),v=d.fromRotationTranslation(m,h.fromElements(k,l,v),new d),d.multiply(this._computedModelMatrix,v,this._computedModelMatrix);k=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=k,c=!0);v=this.material;this._material!==v&&(this._material=v,f=c=!0);l=v.isTranslucent();this._translucent!==l&&(this._translucent=l,c=!0);b&&(l=a.context,this.squareconeScannerFramework.isAllClampToEllipsoid()?(this._clampEllipsiodLineVertex=W(l,this.squareconeScannerFramework.createClampEllipsiodLineArray()),this._conicalFrontVertex=W(l,this.squareconeScannerFramework.calClampEllipsoidConicalArray()),this._conicalBackVertex=W(l,this.squareconeScannerFramework.calClampEllipsoidConicalArray())):(this._squareFrontVertex=W(l,this.squareconeScannerFramework.calCombinedSquareArray()),this._squareBackVertex=W(l,this.squareconeScannerFramework.calCombinedSquareArray()),this._squareLineVertex=W(l,this.squareconeScannerFramework.createVertexSquareLineArray()),this._clampEllipsiodLineVertex=W(l,this.squareconeScannerFramework.createClampEllipsiodLineArray()),this._conicalLineVertex=W(l,this.squareconeScannerFramework.createVertexConicalLineArray()),this._conicalFrontVertex=W(l,this.squareconeScannerFramework.calCombinedConicalArray()),this._conicalBackVertex=W(l,this.squareconeScannerFramework.calCombinedConicalArray())));c&&(this._frontFaceRS=I.fromCache({depthTest:{enabled:!k},cull:{enabled:!0,face:E.FRONT},blending:G.ALPHA_BLEND,depthMask:!1}),this._backFaceRS=I.fromCache({depthTest:{enabled:!k},cull:{enabled:!0,face:E.BACK},blending:G.ALPHA_BLEND,depthMask:!1}),this._lineRS=I.fromCache({depthTest:{enabled:!k},blending:G.ALPHA_BLEND,depthMask:!1}));f&&(k=a.context,v=new J({sources:[v.shaderSource,N]}),this._shaderProgram=H.replaceCache({context:k,shaderProgram:this._shaderProgram,vertexShaderSource:P,fragmentShaderSource:v,attributeLocations:R}));if(c||f||b)this._colorCommands.length=0,b=C.OPAQUE,this.squareconeScannerFramework.isAllClampToEllipsoid()?(M(this,this._conicalFrontCommand,this._frontFaceRS,this._shaderProgram,this._conicalFrontVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._conicalBackCommand,this._backFaceRS,this._shaderProgram,this._conicalBackVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._clampEllipsiodLineCommand,this._lineRS,this._shaderProgram,this._clampEllipsiodLineVertex,this._uniforms,this._computedModelMatrix,b,!0)):(M(this,this._squareFrontCommand,this._frontFaceRS,this._shaderProgram,this._squareFrontVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._squareBackCommand,this._backFaceRS,this._shaderProgram,this._squareBackVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._conicalFrontCommand,this._frontFaceRS,this._shaderProgram,this._conicalFrontVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._conicalBackCommand,this._backFaceRS,this._shaderProgram,this._conicalBackVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._conicalLineCommand,this._lineRS,this._shaderProgram,this._conicalLineVertex,this._uniforms,this._computedModelMatrix,b,!0),M(this,this._clampEllipsiodLineCommand,this._lineRS,this._shaderProgram,this._clampEllipsiodLineVertex,this._uniforms,this._computedModelMatrix,b,!0),M(this,this._squareLineCommand,this._lineRS,this._shaderProgram,this._squareLineVertex,this._uniforms,this._computedModelMatrix,b,!0));b=a.commandList;c=this._colorCommands;if(a.passes.render)for(a=0,f=c.length;a<f;a++)b.push(c[a])}}};U.prototype.destroy=function(){return u(this)};new p;new h;return U});F("FeDataSources/SquareconeScanner/SquareconeVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./SquareconePrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,c,d){var e=c[b.id];a(e)&&(e=e.primitive,d.remove(e),e.isDestroyed()||e.destroy(),delete c[b.id])}function r(b,c){if(!a(b))throw new DeveloperError("scene is required.");if(!a(c))throw new DeveloperError("entityCollection is required.");c.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=c;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(c,c.values,[],[])}new m;new e;var c=new g;new g;new l;new g;new l;r.prototype.update=function(b){if(!a(b))throw new DeveloperError("time is required.");for(var h=this._entitiesToVisualize.values,k=this._hash,l=this._primitives,r=0,u=h.length;r<u;r++){var v=h[r],t=v._squareconeScanner,C,I=k[v.id],H=v.isShowing&&v.isAvailable(b)&&d.getValueOrDefault(t._show,b,!0);H&&(C=d.getValueOrUndefined(v._position,b,c));H?(H=a(I)?I.primitive:void 0,a(H)||(H=new q,H.id=v,l.add(H),I={primitive:H,position:void 0,orientation:void 0},k[v.id]=I),H.modelMatrix=e.multiply(f.eastNorthUpToFixedFrame(C),d.getValueOrDefault(t._modelMatrix,b,void 0),H.modelMatrix),e.multiplyByMatrix3(H.modelMatrix,m.fromRotationZ(Math.PI/2),H.modelMatrix),I.position=g.clone(C,I.position),H.show=!0,H.material=p.getValue(b,t._material,H.material),H.height=d.getValueOrDefault(t._height,b,void 0),H.rectangleHeight=d.getValueOrDefault(t._rectangleHeight,b,void 0),H.maxEllipsoidRadii=d.getValueOrDefault(t._maxEllipsoidRadii,b,void 0),H.headingPitchRoll=d.getValueOrDefault(t._headingPitchRoll,b,void 0),H.horizontalAngle=d.getValueOrDefault(t._horizontalAngle,b,void 0),H.verticalAngle=d.getValueOrDefault(t._verticalAngle,b,void 0),H.color=d.getValueOrDefault(t._color,b,void 0),H.offset=d.getValueOrDefault(t._offset,b,void 0),H.outlineColor=d.getValueOrDefault(t._outlineColor,b,void 0)):a(I)&&(I.primitive.show=!1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,c=this._primitives,d=a.length-1;-1<d;d--)t(a[d],b,c);return h(this)};r.prototype._onCollectionChanged=function(b,c,d,e){var f,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=c.length-1;-1<b;b--)f=c[b],a(f._squareconeScanner)&&a(f._position)&&g.set(f.id,f);for(b=e.length-1;-1<b;b--)f=e[b],a(f._squareconeScanner)&&a(f._position)?g.set(f.id,f):(t(f,h,k),g.remove(f.id));for(b=d.length-1;-1<b;b--)f=d[b],t(f,h,k),g.remove(f.id)};return r});F("FeShadersEx/Materials/RingconeScannerVS",[],function(){return"attribute vec4 position;\nvoid main()\n{\n    gl_Position \x3d czm_modelViewProjection * position;\n}"});F("FeShadersEx/Materials/RingconeScannerFS",[],function(){return"\n#ifdef GL_ES\n    precision mediump float;\n#endif\nuniform vec4 u_color;\nuniform vec4 u_outlineColor;\nuniform float u_isline;\nvec4 getColor(float isline)\n{\n    if(isline\x3d\x3d1.0){\n        return u_outlineColor;\n    } else {\n        return u_color;\n    }\n}\nvoid main()\n{\n    gl_FragColor \x3d getColor(u_isline);\n}"});F("FeDataSources/RingconeScanner/RingconeFramework","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,b,c,d,e,f){this.setParameters(a,b,c,d,e,f)}function c(a,b,c){return Math.atan(Math.sqrt(a*a*Math.tan(b)*Math.tan(b)-a*a*(Math.tan(b)*Math.tan(b)+1)/(Math.tan(c)*Math.tan(c)+1))/a)}function u(a,b,c){c=-2*a*Math.cos(c);b=a*a-b*b;a=(-c+Math.sqrt(c*c-4*b))/2;c=(-c-Math.sqrt(c*c-4*b))/2;return Math.abs(a)>Math.abs(c)?Math.abs(c):Math.abs(a)}r.prototype.setParameters=function(a,d,e,f,g,h){a=b(a,0);h=b(h,0);var k=Math.sqrt(a*a+h*h);a/=k;h/=k;d=b(d,0);e=b(e,0);d=d>Math.PI/2?Math.PI/2:0<d?d:0;e=e>Math.PI/2?Math.PI/2:0<e?e:0;this.height=a;this.maxEllipsoidRadii=h;this.forwordExclusionAngle=b(f,0);this.aftExclusionAngle=b(g,0);this._outerScanningHalfAngle=Math.asin(h*Math.sin(Math.PI/2+e)/(h+a));this._innerScanningHalfAngle=Math.asin(h*Math.sin(Math.PI/2+d)/(h+a));this._outerScanningHeight=u(h+a,h,this._outerScanningHalfAngle)*Math.cos(this._outerScanningHalfAngle);this._innerScanningHeight=u(h+a,h,this._innerScanningHalfAngle)*Math.cos(this._innerScanningHalfAngle);this.angleStride=60;this._innerAftDivideAngle=this._outerAftDivideAngle=this._innerForwordDivideAngle=this._outerForwordDivideAngle=0;Math.PI/2-this.forwordExclusionAngle<this._outerScanningHalfAngle&&(this._outerForwordDivideAngle=c(this._outerScanningHeight,this.forwordExclusionAngle,this._outerScanningHalfAngle));Math.PI/2-this.forwordExclusionAngle<this._innerScanningHalfAngle&&(this._innerForwordDivideAngle=c(this._outerScanningHeight,this.forwordExclusionAngle,this._innerScanningHalfAngle));Math.PI/2-this.aftExclusionAngle<this._outerScanningHalfAngle&&(this._outerAftDivideAngle=c(this._outerScanningHeight,this.aftExclusionAngle,this._outerScanningHalfAngle));Math.PI/2-this.aftExclusionAngle<this._innerScanningHalfAngle&&(this._innerAftDivideAngle=c(this._outerScanningHeight,this.aftExclusionAngle,this._innerScanningHalfAngle))};r.prototype.createOuterVertexArray=function(){var a=[],b=this.createVertexConicalArray(this._innerScanningHeight,this._innerScanningHalfAngle);[b.p2Inner.reverse(),b.p2,b.p3.reverse(),b.p3Inner].forEach(function(b){b.forEach(function(c,d){d<b.length-1&&(a.push.apply(a,[].concat($jscomp.arrayFromIterable(c))),a.push.apply(a,[].concat($jscomp.arrayFromIterable([0,0,0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[d+1]))))})});return a};r.prototype.createInnerVertexArray=function(){var a=[],b=this.createVertexConicalArray(this._innerScanningHeight,this._innerScanningHalfAngle);[b.p1Inner.reverse(),b.p1,b.p4.reverse(),b.p4Inner].forEach(function(b){b.forEach(function(c,d){d<b.length-1&&(a.push.apply(a,[].concat($jscomp.arrayFromIterable(c))),a.push.apply(a,[].concat($jscomp.arrayFromIterable([0,0,0]))),a.push.apply(a,[].concat($jscomp.arrayFromIterable(b[d+1]))))})});return a};r.prototype.createVertexConicalArray=function(a,b){var c=[],d=[],e=[],f=[],g=[],h=[],k=[],l=[],m=this._innerScanningHeight*Math.tan(this._innerScanningHalfAngle),p=this._outerScanningHeight*Math.tan(this._outerScanningHalfAngle);if(0!=this._outerForwordDivideAngle)for(var q=0;10>=q;q++){var r=this._innerForwordDivideAngle+q/10*(this._outerForwordDivideAngle-this._innerForwordDivideAngle),t=this._outerScanningHeight,r=Math.tan(r)*t,y=Math.sqrt(t*Math.tan(this.forwordExclusionAngle)*t*Math.tan(this.forwordExclusionAngle)-r*r),A=Math.sqrt(t*t+r*r+y*y),N=Math.atan(Math.sqrt(t*t+r*r)/y),N=u(this.maxEllipsoidRadii+this.height,this.maxEllipsoidRadii,N),t=N/A*t,r=N/A*r,y=N/A*-y;c.push([t,r,y]);e.push([t,-r,y])}for(q=0;10>=q;q++)r=this._outerForwordDivideAngle+q/10*(Math.PI/2-this._outerForwordDivideAngle),t=p*Math.cos(r),r=p*Math.sin(r),y=-this._outerScanningHeight,c.push([t,r,y]),e.push([t,-r,y]);for(q=0;10>=q;q++)r=this._innerForwordDivideAngle+q/10*(Math.PI/2-this._innerForwordDivideAngle),t=m*Math.cos(r),r=m*Math.sin(r),y=-this._innerScanningHeight,d.push([t,r,y]),f.push([t,-r,y]);if(0!=this._outerAftDivideAngle)for(q=0;10>=q;q++)r=this._innerAftDivideAngle+q/10*(this._outerAftDivideAngle-this._innerAftDivideAngle),t=this._outerScanningHeight,r=Math.tan(r)*t,y=Math.sqrt(t*Math.tan(this.aftExclusionAngle)*t*Math.tan(this.aftExclusionAngle)-r*r),A=Math.sqrt(t*t+r*r+y*y),N=Math.atan(Math.sqrt(t*t+r*r)/y),N=u(this.maxEllipsoidRadii+this.height,this.maxEllipsoidRadii,N),t*=N/A,r*=N/A,y=N/A*-y,g.push([-t,-r,y]),k.push([-t,r,y]);for(q=0;10>=q;q++)r=this._outerAftDivideAngle+q/10*(Math.PI/2-this._outerAftDivideAngle),t=p*Math.cos(r),r=p*Math.sin(r),y=-this._outerScanningHeight,g.push([-t,-r,y]),k.push([-t,r,y]);for(q=0;10>=q;q++)r=this._innerAftDivideAngle+q/10*(Math.PI/2-this._innerAftDivideAngle),t=m*Math.cos(r),r=m*Math.sin(r),y=-this._innerScanningHeight,h.push([-t,-r,y]),l.push([-t,r,y]);return{p1:c,p1Inner:d,p2Inner:f,p2:e,p3:g,p4:k,p3Inner:h,p4Inner:l}};r.prototype.createBorderVertexArray=function(){var a=this.createVertexConicalArray(),b=[];[a.p1Inner.reverse(),a.p1,a.p4.reverse(),a.p4Inner,a.p2Inner.reverse(),a.p2,a.p3.reverse(),a.p3Inner].forEach(function(a){a.forEach(function(c,d){d<a.length-1&&(b.push.apply(b,[].concat($jscomp.arrayFromIterable(c))),b.push.apply(b,[].concat($jscomp.arrayFromIterable(a[d+1]))))})});return b};return r});F("FeDataSources/RingconeScanner/RingconePrimitive","../../Core/defaultValue ../../Core/defined ../../Core/Color ../../Core/EllipsoidOutlineGeometry ../../Core/BoundingSphere ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/HeadingPitchRoll ../../Core/PrimitiveType ../../Core/combine ../../Core/ComponentDatatype ../../Core/destroyObject ../../Core/VertexFormat ../../Core/Math ../../Core/JulianDate ../../Core/EllipsoidGeometry ../../Renderer/Buffer ../../Renderer/BufferUsage ../../Renderer/DrawCommand ../../Renderer/Pass ../../Renderer/RenderState ../../Renderer/ShaderProgram ../../Renderer/ShaderSource ../../Renderer/VertexArray ../../Scene/BlendingState ../../Scene/CullFace ../../Scene/Material ../../Scene/SceneMode ../../FeShadersEx/Materials/RingconeScannerVS ../../FeShadersEx/Materials/RingconeScannerFS ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor ./RingconeFramework".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa){function U(c){var e=this;c=b(c,b.EMPTY_OBJECT);this.show=b(c.show,!0);this.material=a(c.material)?c.material:L.fromType(L.ColorType);this._material=void 0;this.maxElevationAngle=b(c.maxElevationAngle,0);this._maxElevationAngle=void 0;this.minElevationAngle=b(c.minElevationAngle,0);this._minElevationAngle=void 0;this.forwordExclusionAngle=b(c.forwordExclusionAngle,0);this._forwordExclusionAngle=void 0;this.aftExclusionAngle=b(c.aftExclusionAngle,0);this._aftExclusionAngle=void 0;this.maxEllipsoidRadii=b(c.maxEllipsoidRadii,0);this._maxEllipsoidRadii=void 0;this.offset=b(c.offset,h.ZERO);this._offset=void 0;this.color=b(c.color,f.WHITE);this.outlineColor=b(c.outlineColor,f.WHITE);this.showThroughEllipsoid=b(c.showThroughEllipsoid,!1);this._showThroughEllipsoid=void 0;this.modelMatrix=b(c.modelMatrix,new d);this._modelMatrix=new d;this.headingPitchRoll=b(c.headingPitchRoll,new q);this._headingPitchRoll=new q;this._computedModelMatrix=new d;this._computedScanPlaneModelMatrix=new d;this._frontCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._backCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._innerFrontCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._innerBackCommand=new B({owner:this,primitiveType:t.TRIANGLES,boundingVolume:this._boundingSphereWC});this._lineCommand=new B({owner:this,primitiveType:t.LINES,boundingVolume:this._boundingSphereWC});this._colorCommands=[];this._uniforms={u_isline:function(){return 0},u_color:function(){return e.color},u_outlineColor:function(){return e.outlineColor}}}function W(a,b){var d=new Float32Array(b),d=D.createVertexBuffer({context:a,typedArray:d,usage:v.STATIC_DRAW});return new w({context:a,attributes:[{index:0,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:c.FLOAT,offsetInBytes:0,strideInBytes:3*Float32Array.BYTES_PER_ELEMENT}]})}function M(a,b,c,d,e,f,g,h,k){b.vertexArray=e;b.renderState=c;b.shaderProgram=d;b.uniformMap=r(f,a._material._uniforms);k&&(b.uniformMap.u_isline=function(){return 1});b.pass=h;b.modelMatrix=g;a._colorCommands.push(b)}var R={position:0};U.prototype.update=function(a){var b=a.mode;if(this.show&&b===K.SCENE3D){var c=b=!1,f=!1,k=this.height,l=this.minElevationAngle,m=this.maxElevationAngle,r=this.aftExclusionAngle,w=this.forwordExclusionAngle,t=this.maxEllipsoidRadii,v=Math.sqrt(t*t+k*k);if(0>l||0>t||0>k)throw new e("minElevationAngle/maxEllipsoidRadii/height   must be greater than or equal to zero.");if(0!=t){if(this._minElevationAngle!==l||this._maxEllipsoidRadii!==t||this._height!==k||this._maxElevationAngle!==m||this._aftExclusionAngle!==r||this._forwordExclusionAngle!==w)this._maxEllipsoidRadii=t,this._minElevationAngle=l,this._maxElevationAngle=m,this._aftExclusionAngle=r,this._forwordExclusionAngle=w,this._height=k,b=!0,this._boundingSphere=new g(h.ZERO,v);void 0==this.ringconeFramework?this.ringconeFramework=new aa(k,m,l,w,r,t):this.ringconeFramework.setParameters(k,m,l,w,r,t);k=!d.equals(this.modelMatrix,this._modelMatrix);l=!q.equals(this.headingPitchRoll,this._headingPitchRoll);m=!h.equals(this.offset,this._offset);if(k||l||m)d.clone(this.modelMatrix,this._modelMatrix),this._offset=h.clone(this.offset,this._offset),d.multiplyByUniformScale(this.modelMatrix,v,this._computedModelMatrix),g.transform(this._boundingSphere,this.modelMatrix,this._boundingSphereWC),k=this._offset.x/v,l=this._offset.y/v,v=this._offset.z/v,q.clone(this.headingPitchRoll,this._headingPitchRoll),m=p.fromHeadingPitchRoll(this._headingPitchRoll,new p),v=d.fromRotationTranslation(m,h.fromElements(k,l,v),new d),d.multiply(this._computedModelMatrix,v,this._computedModelMatrix);k=this.showThroughEllipsoid;this._showThroughEllipsoid!==this.showThroughEllipsoid&&(this._showThroughEllipsoid=k,c=!0);v=this.material;this._material!==v&&(this._material=v,f=c=!0);b&&(l=a.context,this._frontConicalVertex=W(l,this.ringconeFramework.createOuterVertexArray()),this._backConicalVertex=W(l,this.ringconeFramework.createOuterVertexArray()),this._innerFrontConicalVertex=W(l,this.ringconeFramework.createInnerVertexArray()),this._innerBackConicalVertex=W(l,this.ringconeFramework.createInnerVertexArray()),this._lineVertex=W(l,this.ringconeFramework.createBorderVertexArray()));c&&(this._frontFaceRS=I.fromCache({depthTest:{enabled:!k},cull:{enabled:!0,face:E.FRONT},blending:G.ALPHA_BLEND,depthMask:!1}),this._backFaceRS=I.fromCache({depthTest:{enabled:!k},cull:{enabled:!0,face:E.BACK},blending:G.ALPHA_BLEND,depthMask:!1}),this._lineRS=I.fromCache({depthTest:{enabled:!k},blending:G.ALPHA_BLEND,depthMask:!1}));f&&(k=a.context,v=new J({sources:[v.shaderSource,N]}),this._shaderProgram=H.replaceCache({context:k,shaderProgram:this._shaderProgram,vertexShaderSource:P,fragmentShaderSource:v,attributeLocations:R}));if(c||f||b)this._colorCommands.length=0,b=C.OPAQUE,M(this,this._frontCommand,this._frontFaceRS,this._shaderProgram,this._frontConicalVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._backCommand,this._backFaceRS,this._shaderProgram,this._backConicalVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._innerFrontCommand,this._frontFaceRS,this._shaderProgram,this._innerFrontConicalVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._innerBackCommand,this._backFaceRS,this._shaderProgram,this._innerBackConicalVertex,this._uniforms,this._computedModelMatrix,b),M(this,this._lineCommand,this._lineRS,this._shaderProgram,this._lineVertex,this._uniforms,this._computedModelMatrix,b,!0);b=a.commandList;c=this._colorCommands;if(a.passes.render)for(a=0,f=c.length;a<f;a++)b.push(c[a])}}};U.prototype.destroy=function(){return u(this)};new p;new h;return U});F("FeDataSources/RingconeScanner/RingconeVisualizer","../../Core/Color ../../Core/defined ../../Core/Transforms ../../Core/AssociativeArray ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/MaterialProperty ../../DataSources/Property ./RingconePrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(b,c,d){var e=c[b.id];a(e)&&(e=e.primitive,d.remove(e),e.isDestroyed()||e.destroy(),delete c[b.id])}function r(b,c){if(!a(b))throw new DeveloperError("scene is required.");if(!a(c))throw new DeveloperError("entityCollection is required.");c.collectionChanged.addEventListener(r.prototype._onCollectionChanged,this);this._scene=b;this._primitives=b.primitives;this._entityCollection=c;this._hash={};this._entitiesToVisualize=new k;this._onCollectionChanged(c,c.values,[],[])}var c=new g;r.prototype.update=function(b){if(!a(b))throw new DeveloperError("time is required.");for(var h=this._entitiesToVisualize.values,k=this._hash,l=this._primitives,r=0,t=h.length;r<t;r++){var v=h[r],u=v._ringconeScanner,C,I=k[v.id],H=v.isShowing&&v.isAvailable(b)&&d.getValueOrDefault(u._show,b,!0);H&&(C=d.getValueOrUndefined(v._position,b,c));H?(H=a(I)?I.primitive:void 0,a(H)||(H=new q,H.id=v,l.add(H),I={primitive:H,position:void 0,orientation:void 0},k[v.id]=I),H.modelMatrix=e.multiply(f.eastNorthUpToFixedFrame(C),d.getValueOrDefault(u._modelMatrix,b,void 0),H.modelMatrix),e.multiplyByMatrix3(H.modelMatrix,m.fromRotationZ(Math.PI/2),H.modelMatrix),I.position=g.clone(C,I.position),H.show=!0,H.material=p.getValue(b,u._material,H.material),H.height=d.getValueOrDefault(u._height,b,void 0),H.maxElevationAngle=d.getValueOrDefault(u._maxElevationAngle,b,void 0),H.minElevationAngle=d.getValueOrDefault(u._minElevationAngle,b,void 0),H.forwordExclusionAngle=d.getValueOrDefault(u._forwordExclusionAngle,b,void 0),H.aftExclusionAngle=d.getValueOrDefault(u._aftExclusionAngle,b,void 0),H.maxEllipsoidRadii=d.getValueOrDefault(u._maxEllipsoidRadii,b,void 0),H.headingPitchRoll=d.getValueOrDefault(u._headingPitchRoll,b,void 0),H.color=d.getValueOrDefault(u._color,b,void 0),H.offset=d.getValueOrDefault(u._offset,b,void 0),H.outlineColor=d.getValueOrDefault(u._outlineColor,b,void 0)):a(I)&&(I.primitive.show=!1)}return!0};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){for(var a=this._entitiesToVisualize.values,b=this._hash,c=this._primitives,d=a.length-1;-1<d;d--)t(a[d],b,c);return h(this)};r.prototype._onCollectionChanged=function(b,c,d,e){var f,g=this._entitiesToVisualize,h=this._hash,k=this._primitives;for(b=c.length-1;-1<b;b--)f=c[b],a(f._ringconeScanner)&&a(f._position)&&g.set(f.id,f);for(b=e.length-1;-1<b;b--)f=e[b],a(f._ringconeScanner)&&a(f._position)?g.set(f.id,f):(t(f,h,k),g.remove(f.id));for(b=d.length-1;-1<b;b--)f=d[b],t(f,h,k),g.remove(f.id)};return r});F("DataSources/DynamicGeometryBatch",["../Core/AssociativeArray","../Core/defined","./BoundingSphereState"],function(b,a,f){function k(a,f){this._primitives=a;this._orderedGroundPrimitives=f;this._dynamicUpdaters=new b}k.prototype.add=function(a,b){this._dynamicUpdaters.set(b.id,b.createDynamicUpdater(this._primitives,this._orderedGroundPrimitives))};k.prototype.remove=function(b){b=b.id;var f=this._dynamicUpdaters.get(b);a(f)&&(this._dynamicUpdaters.remove(b),f.destroy())};k.prototype.update=function(a){for(var b=this._dynamicUpdaters.values,f=0,e=b.length;f<e;f++)b[f].update(a);return!0};k.prototype.removeAllPrimitives=function(){for(var a=this._dynamicUpdaters.values,b=0,f=a.length;b<f;b++)a[b].destroy();this._dynamicUpdaters.removeAll()};k.prototype.getBoundingSphere=function(b,k){b=this._dynamicUpdaters.get(b.id);return a(b)&&a(b.getBoundingSphere)?b.getBoundingSphere(k):f.FAILED};return k});F("DataSources/EllipseGeometryUpdater","../Core/ApproximateTerrainHeights ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/EllipseGeometry ../Core/EllipseOutlineGeometry ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/OffsetGeometryInstanceAttribute ../Core/Rectangle ../Core/ShowGeometryInstanceAttribute ../Scene/GroundPrimitive ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./GroundGeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I){function H(a){this.id=a;this.offsetAttribute=this.numberOfVerticalLines=this.stRotation=this.granularity=this.extrudedHeight=this.height=this.rotation=this.semiMinorAxis=this.semiMajorAxis=this.center=this.vertexFormat=void 0}function J(a,b){C.call(this,{entity:a,scene:b,geometryOptions:new H(a),geometryPropertyName:"ellipse",observedPropertyNames:["availability","position","ellipse"]});this._onEntityPropertyChanged(a,"ellipse",a.ellipse,void 0)}function w(a,b,c){v.call(this,a,b,c)}var G=new k,E=a.ZERO,L=new a,K=new c;l(Object.create)&&(J.prototype=Object.create(C.prototype),J.prototype.constructor=J);J.prototype.createFillGeometryInstance=function(a){f.defined("time",a);if(!this._fillEnabled)throw new m("This instance does not represent a filled geometry.");var b=this._entity,c=b.isAvailable(a),p={show:new u(c&&b.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a)),distanceDisplayCondition:e.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(a)),offset:void 0,color:void 0};if(this._materialProperty instanceof D){var q;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||c)&&(q=this._materialProperty.color.getValue(a,G));l(q)||(q=k.WHITE);p.color=g.fromColor(q)}l(this._options.offsetAttribute)&&(p.offset=r.fromCartesian3(I.getValueOrDefault(this._terrainOffsetProperty,a,E,L)));return new d({id:b,geometry:new h(this._options),attributes:p})};J.prototype.createOutlineGeometryInstance=function(a){f.defined("time",a);if(!this._outlineEnabled)throw new m("This instance does not represent an outlined geometry.");var b=this._entity,c=b.isAvailable(a),h=I.getValueOrDefault(this._outlineColorProperty,a,k.BLACK,G),q=this._distanceDisplayConditionProperty.getValue(a),c={show:new u(c&&b.isShowing&&this._showProperty.getValue(a)&&this._showOutlineProperty.getValue(a)),color:g.fromColor(h),distanceDisplayCondition:e.fromDistanceDisplayCondition(q),offset:void 0};l(this._options.offsetAttribute)&&(c.offset=r.fromCartesian3(I.getValueOrDefault(this._terrainOffsetProperty,a,E,L)));return new d({id:b,geometry:new p(this._options),attributes:c})};J.prototype._computeCenter=function(a,b){return I.getValueOrUndefined(this._entity.position,a,b)};J.prototype._isHidden=function(a,b){return!l(a.position)||!l(b.semiMajorAxis)||!l(b.semiMinorAxis)||B.prototype._isHidden.call(this,a,b)};J.prototype._isDynamic=function(a,b){return!a.position.isConstant||!b.semiMajorAxis.isConstant||!b.semiMinorAxis.isConstant||!I.isConstant(b.rotation)||!I.isConstant(b.height)||!I.isConstant(b.extrudedHeight)||!I.isConstant(b.granularity)||!I.isConstant(b.stRotation)||!I.isConstant(b.outlineWidth)||!I.isConstant(b.numberOfVerticalLines)||!I.isConstant(b.zIndex)||this._onTerrain&&!I.isConstant(this._materialProperty)};J.prototype._setStaticOptions=function(a,c){var d=I.getValueOrUndefined(c.height,t.MINIMUM_VALUE),e=I.getValueOrDefault(c.heightReference,t.MINIMUM_VALUE,A.NONE),f=I.getValueOrUndefined(c.extrudedHeight,t.MINIMUM_VALUE),g=I.getValueOrDefault(c.extrudedHeightReference,t.MINIMUM_VALUE,A.NONE);l(f)&&!l(d)&&(d=0);var k=this._options;k.vertexFormat=this._materialProperty instanceof D?x.VERTEX_FORMAT:z.MaterialSupport.TEXTURED.vertexFormat;k.center=a.position.getValue(t.MINIMUM_VALUE,k.center);k.semiMajorAxis=c.semiMajorAxis.getValue(t.MINIMUM_VALUE,k.semiMajorAxis);k.semiMinorAxis=c.semiMinorAxis.getValue(t.MINIMUM_VALUE,k.semiMinorAxis);k.rotation=I.getValueOrUndefined(c.rotation,t.MINIMUM_VALUE);k.granularity=I.getValueOrUndefined(c.granularity,t.MINIMUM_VALUE);k.stRotation=I.getValueOrUndefined(c.stRotation,t.MINIMUM_VALUE);k.numberOfVerticalLines=I.getValueOrUndefined(c.numberOfVerticalLines,t.MINIMUM_VALUE);k.offsetAttribute=C.computeGeometryOffsetAttribute(d,e,f,g);k.height=C.getGeometryHeight(d,e);f=C.getGeometryExtrudedHeight(f,g);f===C.CLAMP_TO_GROUND&&(f=b.getMinimumMaximumHeights(h.computeRectangle(k,K)).minimumTerrainHeight);k.extrudedHeight=f};J.DynamicGeometryUpdater=w;l(Object.create)&&(w.prototype=Object.create(v.prototype),w.prototype.constructor=w);w.prototype._isHidden=function(a,b,c){var d=this._options;return!l(d.center)||!l(d.semiMajorAxis)||!l(d.semiMinorAxis)||v.prototype._isHidden.call(this,a,b,c)};w.prototype._setOptions=function(a,c,d){var e=this._options,f=I.getValueOrUndefined(c.height,d),g=I.getValueOrDefault(c.heightReference,d,A.NONE),k=I.getValueOrUndefined(c.extrudedHeight,d),m=I.getValueOrDefault(c.extrudedHeightReference,d,A.NONE);l(k)&&!l(f)&&(f=0);e.center=I.getValueOrUndefined(a.position,d,e.center);e.semiMajorAxis=I.getValueOrUndefined(c.semiMajorAxis,d);e.semiMinorAxis=I.getValueOrUndefined(c.semiMinorAxis,d);e.rotation=I.getValueOrUndefined(c.rotation,d);e.granularity=I.getValueOrUndefined(c.granularity,d);e.stRotation=I.getValueOrUndefined(c.stRotation,d);e.numberOfVerticalLines=I.getValueOrUndefined(c.numberOfVerticalLines,d);e.offsetAttribute=C.computeGeometryOffsetAttribute(f,g,k,m);e.height=C.getGeometryHeight(f,g);k=C.getGeometryExtrudedHeight(k,m);k===C.CLAMP_TO_GROUND&&(k=b.getMinimumMaximumHeights(h.computeRectangle(e,K)).minimumTerrainHeight);e.extrudedHeight=k};return J});F("DataSources/EllipsoidGeometryUpdater","../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/EllipsoidGeometry ../Core/EllipsoidOutlineGeometry ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/OffsetGeometryInstanceAttribute ../Core/Matrix4 ../Core/ShowGeometryInstanceAttribute ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ../Scene/Primitive ../Scene/SceneMode ./heightReferenceOnEntityPropertyChanged ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w){function G(a){this.id=a;this.offsetAttribute=this.subdivisions=this.slicePartitions=this.stackPartitions=this.radii=this.vertexFormat=void 0}function E(a,b){H.call(this,{entity:a,scene:b,geometryOptions:new G(a),geometryPropertyName:"ellipsoid",observedPropertyNames:["availability","position","orientation","ellipsoid"]});this._onEntityPropertyChanged(a,"ellipsoid",a.ellipsoid,void 0)}function L(a,c,d){I.call(this,a,c,d);this._scene=a._scene;this._modelMatrix=new u;this._lastOutlineColor=this._lastOutlineWidth=this._lastOutlineShow=this._lastShow=this._lastSceneMode=this._outlineAttributes=this._attributes=void 0;this._lastOffset=new b;this._material={}}var K=new C(f.WHITE),P=b.ZERO,N=new b,O=new b,Z=new f,aa=new b(1,1,1);l(Object.create)&&(E.prototype=Object.create(H.prototype),E.prototype.constructor=E);m(E.prototype,{terrainOffsetProperty:{get:function(){return this._terrainOffsetProperty}}});E.prototype.createFillGeometryInstance=function(b,d,e){a.defined("time",b);var g=this._entity,m=g.isAvailable(b),r=new y(m&&g.isShowing&&this._showProperty.getValue(b)&&this._fillProperty.getValue(b)),v=this._distanceDisplayConditionProperty.getValue(b),v=h.fromDistanceDisplayCondition(v),r={show:r,distanceDisplayCondition:v,color:void 0,offset:void 0};if(this._materialProperty instanceof C){var t;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||m)&&(t=this._materialProperty.color.getValue(b,Z));l(t)||(t=f.WHITE);m=k.fromColor(t);r.color=m}l(this._options.offsetAttribute)&&(r.offset=c.fromCartesian3(w.getValueOrDefault(this._terrainOffsetProperty,b,P,N)));return new q({id:g,geometry:new p(this._options),modelMatrix:d?void 0:g.computeModelMatrixForHeightReference(b,g.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,e),attributes:r})};E.prototype.createOutlineGeometryInstance=function(b,e,g){a.defined("time",b);var m=this._entity,p=m.isAvailable(b),r=w.getValueOrDefault(this._outlineColorProperty,b,f.BLACK,Z),t=this._distanceDisplayConditionProperty.getValue(b),p={show:new y(p&&m.isShowing&&this._showProperty.getValue(b)&&this._showOutlineProperty.getValue(b)),color:k.fromColor(r),distanceDisplayCondition:h.fromDistanceDisplayCondition(t),offset:void 0};l(this._options.offsetAttribute)&&(p.offset=c.fromCartesian3(w.getValueOrDefault(this._terrainOffsetProperty,b,P,N)));return new q({id:m,geometry:new d(this._options),modelMatrix:e?void 0:m.computeModelMatrixForHeightReference(b,m.ellipsoid.heightReference,.5*this._options.radii.z,this._scene.mapProjection.ellipsoid,g),attributes:p})};E.prototype._computeCenter=function(a,b){return w.getValueOrUndefined(this._entity.position,a,b)};E.prototype._isHidden=function(a,b){return!l(a.position)||!l(b.radii)||H.prototype._isHidden.call(this,a,b)};E.prototype._isDynamic=function(a,b){return!a.position.isConstant||!w.isConstant(a.orientation)||!b.radii.isConstant||!w.isConstant(b.stackPartitions)||!w.isConstant(b.slicePartitions)||!w.isConstant(b.outlineWidth)||!w.isConstant(b.subdivisions)};E.prototype._setStaticOptions=function(a,b){var c=w.getValueOrDefault(b.heightReference,r.MINIMUM_VALUE,A.NONE),d=this._options;d.vertexFormat=this._materialProperty instanceof C?x.VERTEX_FORMAT:z.MaterialSupport.TEXTURED.vertexFormat;d.radii=b.radii.getValue(r.MINIMUM_VALUE,d.radii);d.stackPartitions=w.getValueOrUndefined(b.stackPartitions,r.MINIMUM_VALUE);d.slicePartitions=w.getValueOrUndefined(b.slicePartitions,r.MINIMUM_VALUE);d.subdivisions=w.getValueOrUndefined(b.subdivisions,r.MINIMUM_VALUE);d.offsetAttribute=c!==A.NONE?t.ALL:void 0};E.prototype._onEntityPropertyChanged=B;E.DynamicGeometryUpdater=L;l(Object.create)&&(L.prototype=Object.create(I.prototype),L.prototype.constructor=L);L.prototype.update=function(d){a.defined("time",d);var m=this._entity,p=m.ellipsoid;if(m.isShowing&&m.isAvailable(d)&&w.getValueOrDefault(p.show,d,!0)){var q=w.getValueOrUndefined(p.radii,d,O),r=l(q)?m.computeModelMatrixForHeightReference(d,p.heightReference,.5*q.z,this._scene.mapProjection.ellipsoid,this._modelMatrix):void 0;if(l(r)&&l(q)){var B=w.getValueOrDefault(p.fill,d,!0),E=w.getValueOrDefault(p.outline,d,!1),C=w.getValueOrClonedDefault(p.outlineColor,d,f.BLACK,Z),G=J.getValue(d,g(p.material,K),this._material),L=w.getValueOrUndefined(p.stackPartitions,d),H=w.getValueOrUndefined(p.slicePartitions,d),I=w.getValueOrUndefined(p.subdivisions,d),U=w.getValueOrDefault(p.outlineWidth,d,1),p=w.getValueOrDefault(p.heightReference,d,A.NONE),fa=p!==A.NONE?t.ALL:void 0,F=this._scene.mode,p=F===v.SCENE3D&&p===A.NONE,ka=this._options,na=this._geometryUpdater.shadowsProperty.getValue(d),ia=this._geometryUpdater.distanceDisplayConditionProperty.getValue(d),la=w.getValueOrDefault(this._geometryUpdater.terrainOffsetProperty,d,P,N);p&&this._lastSceneMode===F&&l(this._primitive)&&ka.stackPartitions===L&&ka.slicePartitions===H&&ka.subdivisions===I&&this._lastOutlineWidth===U&&ka.offsetAttribute===fa?this._primitive.ready&&(d=this._primitive,U=this._outlinePrimitive,d.show=!0,U.show=!0,d.appearance.material=G,G=this._attributes,l(G)||(this._attributes=G=d.getGeometryInstanceAttributes(m)),B!==this._lastShow&&(G.show=y.toValue(B,G.show),this._lastShow=B),B=this._outlineAttributes,l(B)||(this._outlineAttributes=B=U.getGeometryInstanceAttributes(m)),E!==this._lastOutlineShow&&(B.show=y.toValue(E,B.show),this._lastOutlineShow=E),f.equals(C,this._lastOutlineColor)||(B.color=k.toValue(C,B.color),f.clone(C,this._lastOutlineColor)),e.equals(ia,this._lastDistanceDisplayCondition)||(G.distanceDisplayCondition=h.toValue(ia,G.distanceDisplayCondition),B.distanceDisplayCondition=h.toValue(ia,B.distanceDisplayCondition),e.clone(ia,this._lastDistanceDisplayCondition)),b.equals(la,this._lastOffset)||(G.offset=c.toValue(la,G.offset),B.offset=c.toValue(la,G.offset),b.clone(la,this._lastOffset))):(m=this._primitives,m.removeAndDestroy(this._primitive),m.removeAndDestroy(this._outlinePrimitive),this._outlinePrimitive=this._primitive=void 0,this._lastSceneMode=F,this._lastOutlineWidth=U,ka.stackPartitions=L,ka.slicePartitions=H,ka.subdivisions=I,ka.offsetAttribute=fa,ka.radii=p?aa:q,G=new z({material:G,translucent:G.isTranslucent(),closed:!0}),ka.vertexFormat=G.vertexFormat,L=this._geometryUpdater.createFillGeometryInstance(d,p,this._modelMatrix),this._primitive=m.add(new D({geometryInstances:L,appearance:G,asynchronous:!1,shadows:na})),d=this._geometryUpdater.createOutlineGeometryInstance(d,p,this._modelMatrix),this._outlinePrimitive=m.add(new D({geometryInstances:d,appearance:new x({flat:!0,translucent:255!==d.attributes.color.value[3],renderState:{lineWidth:this._geometryUpdater._scene.clampLineWidth(U)}}),asynchronous:!1,shadows:na})),this._lastShow=B,this._lastOutlineShow=E,this._lastOutlineColor=f.clone(C,this._lastOutlineColor),this._lastDistanceDisplayCondition=ia,this._lastOffset=b.clone(la,this._lastOffset));p&&(q.x=Math.max(q.x,.001),q.y=Math.max(q.y,.001),q.z=Math.max(q.z,.001),r=u.multiplyByScale(r,q,r),this._primitive.modelMatrix=r,this._outlinePrimitive.modelMatrix=r)}else l(this._primitive)&&(this._primitive.show=!1),l(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1)}else l(this._primitive)&&(this._primitive.show=!1),l(this._outlinePrimitive)&&(this._outlinePrimitive.show=!1)};return E});F("DataSources/PlaneGeometryUpdater","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/GeometryInstance ../Core/Iso8601 ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/PlaneGeometry ../Core/PlaneOutlineGeometry ../Core/Quaternion ../Core/ShowGeometryInstanceAttribute ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a){this.id=a;this.dimensions=this.plane=this.vertexFormat=void 0}function I(a,b){v.call(this,{entity:a,scene:b,geometryOptions:new C(a),geometryPropertyName:"plane",observedPropertyNames:["availability","position","orientation","plane"]});this._onEntityPropertyChanged(a,"plane",a.plane,void 0)}function H(a,b,c){D.call(this,a,b,c)}function J(c,e,f,g,h){var k=c.normal;c=a.multiplyByScalar(k,-c.distance,K);c=t.multiplyByPoint(f,c,c);f=t.multiplyByPointAsVector(f,k,P);a.normalize(f,f);g=g.geodeticSurfaceNormal(c,L);d.equalsEpsilon(Math.abs(a.dot(g,f)),1,d.EPSILON8)&&(g=a.clone(a.UNIT_Z,g));k=a.cross(g,f,E);g=a.cross(f,k,g);a.normalize(k,k);a.normalize(g,g);var l=Z;q.setColumn(l,0,k,l);q.setColumn(l,1,g,l);q.setColumn(l,2,f,l);g=u.fromRotationMatrix(l,O);e=b.clone(e,N);e.z=1;return t.fromTranslationQuaternionRotationScale(c,g,e,h)}var w=new a,G=new k;l(Object.create)&&(I.prototype=Object.create(v.prototype),I.prototype.constructor=I);I.prototype.createFillGeometryInstance=function(a){f.defined("time",a);if(!this._fillEnabled)throw new m("This instance does not represent a filled geometry.");var b=this._entity,c=b.isAvailable(a),d;d=new y(c&&b.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a));var p=this._distanceDisplayConditionProperty.getValue(a),p=e.fromDistanceDisplayCondition(p);if(this._materialProperty instanceof x){var q;l(this._materialProperty.color)&&(this._materialProperty.color.isConstant||c)&&(q=this._materialProperty.color.getValue(a,G));l(q)||(q=k.WHITE);c=g.fromColor(q);d={show:d,distanceDisplayCondition:p,color:c}}else d={show:d,distanceDisplayCondition:p};var w=b.plane,c=this._options,p=b.computeModelMatrix(a);q=B.getValueOrDefault(w.plane,a,c.plane);a=B.getValueOrUndefined(w.dimensions,a,c.dimensions);c.plane=q;c.dimensions=a;p=J(q,a,p,this._scene.mapProjection.ellipsoid,p);return new h({id:b,geometry:new r(this._options),modelMatrix:p,attributes:d})};I.prototype.createOutlineGeometryInstance=function(a){f.defined("time",a);if(!this._outlineEnabled)throw new m("This instance does not represent an outlined geometry.");var b=this._entity,d=b.isAvailable(a),l=B.getValueOrDefault(this._outlineColorProperty,a,k.BLACK,G),p=this._distanceDisplayConditionProperty.getValue(a),q=b.plane,r=this._options,w=b.computeModelMatrix(a),t=B.getValueOrDefault(q.plane,a,r.plane),q=B.getValueOrUndefined(q.dimensions,a,r.dimensions);r.plane=t;r.dimensions=q;w=J(t,q,w,this._scene.mapProjection.ellipsoid,w);return new h({id:b,geometry:new c,modelMatrix:w,attributes:{show:new y(d&&b.isShowing&&this._showProperty.getValue(a)&&this._showOutlineProperty.getValue(a)),color:g.fromColor(l),distanceDisplayCondition:e.fromDistanceDisplayCondition(p)}})};I.prototype._isHidden=function(a,b){return!l(b.plane)||!l(b.dimensions)||!l(a.position)||v.prototype._isHidden.call(this,a,b)};I.prototype._getIsClosed=function(a){return!1};I.prototype._isDynamic=function(a,b){return!a.position.isConstant||!B.isConstant(a.orientation)||!b.plane.isConstant||!b.dimensions.isConstant||!B.isConstant(b.outlineWidth)};I.prototype._setStaticOptions=function(a,b){var c=this._options;c.vertexFormat=this._materialProperty instanceof x?z.VERTEX_FORMAT:A.MaterialSupport.TEXTURED.vertexFormat;c.plane=b.plane.getValue(p.MINIMUM_VALUE,c.plane);c.dimensions=b.dimensions.getValue(p.MINIMUM_VALUE,c.dimensions)};I.DynamicGeometryUpdater=H;l(Object.create)&&(H.prototype=Object.create(D.prototype),H.prototype.constructor=H);H.prototype._isHidden=function(a,b,c){var d=this._options,e=B.getValueOrUndefined(a.position,c,w);return!l(e)||!l(d.plane)||!l(d.dimensions)||D.prototype._isHidden.call(this,a,b,c)};H.prototype._setOptions=function(a,b,c){a=this._options;a.plane=B.getValueOrDefault(b.plane,c,a.plane);a.dimensions=B.getValueOrUndefined(b.dimensions,c,a.dimensions)};var E=new a,L=new a,K=new a,P=new a,N=new a,O=new u,Z=new q;I.createPrimitiveMatrix=J;return I});F("DataSources/PolygonGeometryUpdater","../Core/ApproximateTerrainHeights ../Core/ArcType ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/CoplanarPolygonGeometry ../Core/CoplanarPolygonOutlineGeometry ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/EllipsoidTangentPlane ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/isArray ../Core/Iso8601 ../Core/oneTimeWarning ../Core/OffsetGeometryInstanceAttribute ../Core/PolygonGeometry ../Core/PolygonHierarchy ../Core/PolygonOutlineGeometry ../Core/Rectangle ../Core/ShowGeometryInstanceAttribute ../Scene/GroundPrimitive ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./GroundGeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P){function N(a){this.id=a;this.arcType=this.offsetAttribute=this.stRotation=this.granularity=this.extrudedHeight=this.height=this.closeBottom=this.closeTop=this.perPositionHeight=this.polygonHierarchy=this.vertexFormat=void 0}function O(a,b){K.call(this,{entity:a,scene:b,geometryOptions:new N(a),geometryPropertyName:"polygon",observedPropertyNames:["availability","polygon"]});this._onEntityPropertyChanged(a,"polygon",a.polygon,void 0)}function Z(a,b,c){E.call(this,a,b,c)}var aa=new l,U=k.ZERO,W=new k,M=new B,R=[],Y=new f;p(Object.create)&&(O.prototype=Object.create(K.prototype),O.prototype.constructor=O);O.prototype.createFillGeometryInstance=function(a){g.defined("time",a);if(!this._fillEnabled)throw new d("This instance does not represent a filled geometry.");var b=this._entity,c=b.isAvailable(a),f=this._options,h={show:new C(c&&b.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a)),distanceDisplayCondition:q.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(a)),offset:void 0,color:void 0};if(this._materialProperty instanceof G){var k;p(this._materialProperty.color)&&(this._materialProperty.color.isConstant||c)&&(k=this._materialProperty.color.getValue(a,aa));p(k)||(k=l.WHITE);h.color=m.fromColor(k)}p(f.offsetAttribute)&&(h.offset=z.fromCartesian3(P.getValueOrDefault(this._terrainOffsetProperty,a,U,W)));a=f.perPositionHeight&&!p(f.extrudedHeight)?new e(f):new x(f);return new r({id:b,geometry:a,attributes:h})};O.prototype.createOutlineGeometryInstance=function(a){g.defined("time",a);if(!this._outlineEnabled)throw new d("This instance does not represent an outlined geometry.");var b=this._entity,c=b.isAvailable(a),e=this._options,f=P.getValueOrDefault(this._outlineColorProperty,a,l.BLACK,aa),k=this._distanceDisplayConditionProperty.getValue(a),c={show:new C(c&&b.isShowing&&this._showProperty.getValue(a)&&this._showOutlineProperty.getValue(a)),color:m.fromColor(f),distanceDisplayCondition:q.fromDistanceDisplayCondition(k),offset:void 0};p(e.offsetAttribute)&&(c.offset=z.fromCartesian3(P.getValueOrDefault(this._terrainOffsetProperty,a,U,W)));a=e.perPositionHeight&&!p(e.extrudedHeight)?new h(e):new v(e);return new r({id:b,geometry:a,attributes:c})};O.prototype._computeCenter=function(a,b){var c=P.getValueOrUndefined(this._entity.polygon.hierarchy,a);p(c)&&!u(c)&&(c=c.positions);if(0!==c.length){for(var d=t.fromPoints(c,this._scene.mapProjection.ellipsoid),c=d.projectPointsOntoPlane(c,R),e=c.length,g=0,h=e-1,k=new f,l=0;l<e;h=l++)var m=c[l],q=c[h],h=m.x*q.y-q.x*m.y,m=f.add(m,q,Y),m=f.multiplyByScalar(m,h,m),k=f.add(k,m,k),g=g+h;k=f.multiplyByScalar(k,1/(3*g),k);return d.projectPointOntoEllipsoid(k,b)}};O.prototype._isHidden=function(a,b){return!p(b.hierarchy)||L.prototype._isHidden.call(this,a,b)};O.prototype._isOnTerrain=function(a,b){var c=K.prototype._isOnTerrain.call(this,a,b),d=b.perPositionHeight,d=p(d)&&(d.isConstant?d.getValue(y.MINIMUM_VALUE):!0);return c&&!d};O.prototype._isDynamic=function(a,b){return!b.hierarchy.isConstant||!P.isConstant(b.height)||!P.isConstant(b.extrudedHeight)||!P.isConstant(b.granularity)||!P.isConstant(b.stRotation)||!P.isConstant(b.outlineWidth)||!P.isConstant(b.perPositionHeight)||!P.isConstant(b.closeTop)||!P.isConstant(b.closeBottom)||!P.isConstant(b.zIndex)||!P.isConstant(b.arcType)||this._onTerrain&&!P.isConstant(this._materialProperty)};O.prototype._setStaticOptions=function(c,d){var e=this._options;e.vertexFormat=this._materialProperty instanceof G?w.VERTEX_FORMAT:J.MaterialSupport.TEXTURED.vertexFormat;var f=d.hierarchy.getValue(y.MINIMUM_VALUE);u(f)&&(f=new D(f));var g=P.getValueOrUndefined(d.height,y.MINIMUM_VALUE),h=P.getValueOrDefault(d.heightReference,y.MINIMUM_VALUE,H.NONE),k=P.getValueOrUndefined(d.extrudedHeight,y.MINIMUM_VALUE),l=P.getValueOrDefault(d.extrudedHeightReference,y.MINIMUM_VALUE,H.NONE),m=P.getValueOrDefault(d.perPositionHeight,y.MINIMUM_VALUE,!1),g=K.getGeometryHeight(g,h),q;m?(p(g)&&(g=void 0,A("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),h!==H.NONE&&m&&(g=void 0,A("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(p(k)&&!p(g)&&(g=0),q=K.computeGeometryOffsetAttribute(g,h,k,l));e.polygonHierarchy=f;e.granularity=P.getValueOrUndefined(d.granularity,y.MINIMUM_VALUE);e.stRotation=P.getValueOrUndefined(d.stRotation,y.MINIMUM_VALUE);e.perPositionHeight=m;e.closeTop=P.getValueOrDefault(d.closeTop,y.MINIMUM_VALUE,!0);e.closeBottom=P.getValueOrDefault(d.closeBottom,y.MINIMUM_VALUE,!0);e.offsetAttribute=q;e.height=g;e.arcType=P.getValueOrDefault(d.arcType,y.MINIMUM_VALUE,a.GEODESIC);k=K.getGeometryExtrudedHeight(k,l);k===K.CLAMP_TO_GROUND&&(k=b.getMinimumMaximumHeights(x.computeRectangle(e,M)).minimumTerrainHeight);e.extrudedHeight=k};O.prototype._getIsClosed=function(a){var b=a.height,c=a.extrudedHeight,c=p(c)&&c!==b;return!a.perPositionHeight&&(!c&&0===b||c&&a.closeTop&&a.closeBottom)};O.DynamicGeometryUpdater=Z;p(Object.create)&&(Z.prototype=Object.create(E.prototype),Z.prototype.constructor=Z);Z.prototype._isHidden=function(a,b,c){return!p(this._options.polygonHierarchy)||E.prototype._isHidden.call(this,a,b,c)};Z.prototype._setOptions=function(c,d,e){c=this._options;var f=P.getValueOrUndefined(d.hierarchy,e);u(f)?c.polygonHierarchy=new D(f):c.polygonHierarchy=f;var f=P.getValueOrUndefined(d.height,e),g=P.getValueOrDefault(d.heightReference,e,H.NONE),h=P.getValueOrDefault(d.extrudedHeightReference,e,H.NONE),k=P.getValueOrUndefined(d.extrudedHeight,e),l=P.getValueOrUndefined(d.perPositionHeight,e),f=K.getGeometryHeight(f,h),m;l?(p(f)&&(f=void 0,A("Entity polygons cannot have both height and perPositionHeight.  height will be ignored")),g!==H.NONE&&l&&(f=void 0,A("heightReference is not supported for entity polygons with perPositionHeight. heightReference will be ignored"))):(p(k)&&!p(f)&&(f=0),m=K.computeGeometryOffsetAttribute(f,g,k,h));c.granularity=P.getValueOrUndefined(d.granularity,e);c.stRotation=P.getValueOrUndefined(d.stRotation,e);c.perPositionHeight=P.getValueOrUndefined(d.perPositionHeight,e);c.closeTop=P.getValueOrDefault(d.closeTop,e,!0);c.closeBottom=P.getValueOrDefault(d.closeBottom,e,!0);c.offsetAttribute=m;c.height=f;c.arcType=P.getValueOrDefault(d.arcType,e,a.GEODESIC);k=K.getGeometryExtrudedHeight(k,h);k===K.CLAMP_TO_GROUND&&(k=b.getMinimumMaximumHeights(x.computeRectangle(c,M)).minimumTerrainHeight);c.extrudedHeight=k};return O});F("DataSources/PolylineVolumeGeometryUpdater","../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/GeometryInstance ../Core/Iso8601 ../Core/PolylineVolumeGeometry ../Core/PolylineVolumeOutlineGeometry ../Core/ShowGeometryInstanceAttribute ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){this.id=a;this.granularity=this.cornerType=this.shapePositions=this.polylinePositions=this.vertexFormat=void 0}function z(a,b){u.call(this,{entity:a,scene:b,geometryOptions:new A(a),geometryPropertyName:"polylineVolume",observedPropertyNames:["availability","polylineVolume"]});this._onEntityPropertyChanged(a,"polylineVolume",a.polylineVolume,void 0)}function x(a,b,d){c.call(this,a,b,d)}var D=new a;k(Object.create)&&(z.prototype=Object.create(u.prototype),z.prototype.constructor=z);z.prototype.createFillGeometryInstance=function(c){b.defined("time",c);if(!this._fillEnabled)throw new g("This instance does not represent a filled geometry.");var e=this._entity,p=e.isAvailable(c),q;q=new d(p&&e.isShowing&&this._showProperty.getValue(c)&&this._fillProperty.getValue(c));var t=this._distanceDisplayConditionProperty.getValue(c),t=l.fromDistanceDisplayCondition(t);if(this._materialProperty instanceof r){var v;k(this._materialProperty.color)&&(this._materialProperty.color.isConstant||p)&&(v=this._materialProperty.color.getValue(c,D));k(v)||(v=a.WHITE);c=f.fromColor(v);q={show:q,distanceDisplayCondition:t,color:c}}else q={show:q,distanceDisplayCondition:t};return new m({id:e,geometry:new h(this._options),attributes:q})};z.prototype.createOutlineGeometryInstance=function(c){b.defined("time",c);if(!this._outlineEnabled)throw new g("This instance does not represent an outlined geometry.");var e=this._entity,h=e.isAvailable(c),k=y.getValueOrDefault(this._outlineColorProperty,c,a.BLACK,D),q=this._distanceDisplayConditionProperty.getValue(c);return new m({id:e,geometry:new p(this._options),attributes:{show:new d(h&&e.isShowing&&this._showProperty.getValue(c)&&this._showOutlineProperty.getValue(c)),color:f.fromColor(k),distanceDisplayCondition:l.fromDistanceDisplayCondition(q)}})};z.prototype._isHidden=function(a,b){return!k(b.positions)||!k(b.shape)||u.prototype._isHidden.call(this,a,b)};z.prototype._isDynamic=function(a,b){return!b.positions.isConstant||!b.shape.isConstant||!y.isConstant(b.granularity)||!y.isConstant(b.outlineWidth)||!y.isConstant(b.cornerType)};z.prototype._setStaticOptions=function(a,b){var c=b.granularity,d=b.cornerType,f=this._options;f.vertexFormat=this._materialProperty instanceof r?t.VERTEX_FORMAT:q.MaterialSupport.TEXTURED.vertexFormat;f.polylinePositions=b.positions.getValue(e.MINIMUM_VALUE,f.polylinePositions);f.shapePositions=b.shape.getValue(e.MINIMUM_VALUE,f.shape);f.granularity=k(c)?c.getValue(e.MINIMUM_VALUE):void 0;f.cornerType=k(d)?d.getValue(e.MINIMUM_VALUE):void 0};z.DynamicGeometryUpdater=x;k(Object.create)&&(x.prototype=Object.create(c.prototype),x.prototype.constructor=x);x.prototype._isHidden=function(a,b,d){var e=this._options;return!k(e.polylinePositions)||!k(e.shapePositions)||c.prototype._isHidden.call(this,a,b,d)};x.prototype._setOptions=function(a,b,c){a=this._options;a.polylinePositions=y.getValueOrUndefined(b.positions,c,a.polylinePositions);a.shapePositions=y.getValueOrUndefined(b.shape,c);a.granularity=y.getValueOrUndefined(b.granularity,c);a.cornerType=y.getValueOrUndefined(b.cornerType,c)};return z});F("DataSources/RectangleGeometryUpdater","../Core/ApproximateTerrainHeights ../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/Ellipsoid ../Core/GeometryInstance ../Core/GeometryOffsetAttribute ../Core/Iso8601 ../Core/OffsetGeometryInstanceAttribute ../Core/Rectangle ../Core/RectangleGeometry ../Core/RectangleOutlineGeometry ../Core/ShowGeometryInstanceAttribute ../Scene/GroundPrimitive ../Scene/HeightReference ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./GroundGeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a){this.id=a;this.offsetAttribute=this.rotation=this.stRotation=this.granularity=this.extrudedHeight=this.height=this.rectangle=this.vertexFormat=void 0}function G(a,b){H.call(this,{entity:a,scene:b,geometryOptions:new w(a),geometryPropertyName:"rectangle",observedPropertyNames:["availability","rectangle"]});this._onEntityPropertyChanged(a,"rectangle",a.rectangle,void 0)}function E(a,b,c){C.call(this,a,b,c)}var L=new g,K=a.ZERO,P=new a,N=new c,O=new c,Z=new f;m(Object.create)&&(G.prototype=Object.create(H.prototype),G.prototype.constructor=G);G.prototype.createFillGeometryInstance=function(a){k.defined("time",a);if(!this._fillEnabled)throw new e("This instance does not represent a filled geometry.");var b=this._entity,c=b.isAvailable(a),f={show:new A(c&&b.isShowing&&this._showProperty.getValue(a)&&this._fillProperty.getValue(a)),distanceDisplayCondition:h.fromDistanceDisplayCondition(this._distanceDisplayConditionProperty.getValue(a)),offset:void 0,color:void 0};if(this._materialProperty instanceof B){var p;m(this._materialProperty.color)&&(this._materialProperty.color.isConstant||c)&&(p=this._materialProperty.color.getValue(a,L));m(p)||(p=g.WHITE);f.color=l.fromColor(p)}m(this._options.offsetAttribute)&&(f.offset=r.fromCartesian3(J.getValueOrDefault(this._terrainOffsetProperty,a,K,P)));return new d({id:b,geometry:new u(this._options),attributes:f})};G.prototype.createOutlineGeometryInstance=function(a){k.defined("time",a);if(!this._outlineEnabled)throw new e("This instance does not represent an outlined geometry.");var b=this._entity,c=b.isAvailable(a),f=J.getValueOrDefault(this._outlineColorProperty,a,g.BLACK,L),p=this._distanceDisplayConditionProperty.getValue(a),c={show:new A(c&&b.isShowing&&this._showProperty.getValue(a)&&this._showOutlineProperty.getValue(a)),color:l.fromColor(f),distanceDisplayCondition:h.fromDistanceDisplayCondition(p),offset:void 0};m(this._options.offsetAttribute)&&(c.offset=r.fromCartesian3(J.getValueOrDefault(this._terrainOffsetProperty,a,K,P)));return new d({id:b,geometry:new y(this._options),attributes:c})};G.prototype._computeCenter=function(a,b){var d=J.getValueOrUndefined(this._entity.rectangle.coordinates,a,O);if(m(d))return d=c.center(d,Z),f.toCartesian(d,p.WGS84,b)};G.prototype._isHidden=function(a,b){return!m(b.coordinates)||I.prototype._isHidden.call(this,a,b)};G.prototype._isDynamic=function(a,b){return!b.coordinates.isConstant||!J.isConstant(b.height)||!J.isConstant(b.extrudedHeight)||!J.isConstant(b.granularity)||!J.isConstant(b.stRotation)||!J.isConstant(b.rotation)||!J.isConstant(b.outlineWidth)||!J.isConstant(b.zIndex)||this._onTerrain&&!J.isConstant(this._materialProperty)};G.prototype._setStaticOptions=function(a,c){var d=this._materialProperty instanceof B,e=J.getValueOrUndefined(c.height,t.MINIMUM_VALUE),f=J.getValueOrDefault(c.heightReference,t.MINIMUM_VALUE,x.NONE),g=J.getValueOrUndefined(c.extrudedHeight,t.MINIMUM_VALUE),h=J.getValueOrDefault(c.extrudedHeightReference,t.MINIMUM_VALUE,x.NONE);m(g)&&!m(e)&&(e=0);var k=this._options;k.vertexFormat=d?v.VERTEX_FORMAT:D.MaterialSupport.TEXTURED.vertexFormat;k.rectangle=c.coordinates.getValue(t.MINIMUM_VALUE,k.rectangle);k.granularity=J.getValueOrUndefined(c.granularity,t.MINIMUM_VALUE);k.stRotation=J.getValueOrUndefined(c.stRotation,t.MINIMUM_VALUE);k.rotation=J.getValueOrUndefined(c.rotation,t.MINIMUM_VALUE);k.offsetAttribute=H.computeGeometryOffsetAttribute(e,f,g,h);k.height=H.getGeometryHeight(e,f);g=H.getGeometryExtrudedHeight(g,h);g===H.CLAMP_TO_GROUND&&(g=b.getMinimumMaximumHeights(u.computeRectangle(k,N)).minimumTerrainHeight);k.extrudedHeight=g};G.DynamicGeometryUpdater=E;m(Object.create)&&(E.prototype=Object.create(C.prototype),E.prototype.constructor=E);E.prototype._isHidden=function(a,b,c){return!m(this._options.rectangle)||C.prototype._isHidden.call(this,a,b,c)};E.prototype._setOptions=function(a,c,d){a=this._options;var e=J.getValueOrUndefined(c.height,d),f=J.getValueOrDefault(c.heightReference,d,x.NONE),g=J.getValueOrUndefined(c.extrudedHeight,d),h=J.getValueOrDefault(c.extrudedHeightReference,d,x.NONE);m(g)&&!m(e)&&(e=0);a.rectangle=J.getValueOrUndefined(c.coordinates,d,a.rectangle);a.granularity=J.getValueOrUndefined(c.granularity,d);a.stRotation=J.getValueOrUndefined(c.stRotation,d);a.rotation=J.getValueOrUndefined(c.rotation,d);a.offsetAttribute=H.computeGeometryOffsetAttribute(e,f,g,h);a.height=H.getGeometryHeight(e,f);g=H.getGeometryExtrudedHeight(g,h);g===H.CLAMP_TO_GROUND&&(g=b.getMinimumMaximumHeights(u.computeRectangle(a,N)).minimumTerrainHeight);a.extrudedHeight=g};return G});F("DataSources/StaticGeometryColorBatch","../Core/AssociativeArray ../Core/Cartesian3 ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/OffsetGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/Primitive ./BoundingSphereState ./ColorMaterialProperty ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a,d,e,f,h,k,l){this.translucent=d;this.appearanceType=e;this.depthFailAppearanceType=f;this.depthFailMaterialProperty=h;this.depthFailMaterial=void 0;this.closed=k;this.shadows=l;this.primitives=a;this.waitingOnCreate=this.createPrimitive=!1;this.oldPrimitive=this.primitive=void 0;this.geometry=new b;this.updaters=new b;this.updatersWithAttributes=new b;this.attributes=new b;this.subscriptions=new b;this.showsUpdated=new b;this.itemsToRemove=[];this.invalidated=!1;var m;g(h)&&(m=h.definitionChanged.addEventListener(c.prototype.onMaterialChanged,this));this.removeMaterialSubscription=m}function u(a,b,c,d,e){this._solidItems=[];this._translucentItems=[];this._primitives=a;this._appearanceType=b;this._depthFailAppearanceType=c;this._closed=d;this._shadows=e}function y(a,b){for(var c=a.length-1;0<=c;c--){var d=a[c];if(d.remove(b))return 0===d.updaters.length&&(a.splice(c,1),d.destroy()),!0}return!1}function A(a,b,c){for(var d=!1,e=b.length,f=0;f<e;++f){var g=b[f],h=g.itemsToRemove,k=h.length;if(0<k)for(f=0;f<k;f++)d=h[f],g.remove(d),a.add(c,d),d=!0}return d}function z(a,b,c,d){var e=b.length,f;for(f=e-1;0<=f;f--)if(e=b[f],e.invalidated){b.splice(f,1);for(var g=e.updaters.values,h=g.length,k=0;k<h;k++)a.add(c,g[k]);e.destroy()}e=b.length;for(f=0;f<e;++f)d=b[f].update(c)&&d;return d}function x(a,b,c){for(var e=a.length,f=0;f<e;f++){var g=a[f];if(g.contains(b))return g.getBoundingSphere(b,c)}return d.FAILED}function D(a){for(var b=a.length,c=0;c<b;c++)a[c].destroy();a.length=0}var v=new f,B=new l,C=new l,I=a.ZERO,H=new a;c.prototype.onMaterialChanged=function(){this.invalidated=!0};c.prototype.isMaterial=function(a){var b=this.depthFailMaterialProperty;a=a.depthFailMaterialProperty;return a===b?!0:g(b)?b.equals(a):!1};c.prototype.add=function(a,b){var c=a.id;this.createPrimitive=!0;this.geometry.set(c,b);this.updaters.set(c,a);if(a.hasConstantFill&&a.fillMaterialProperty.isConstant&&r.isConstant(a.distanceDisplayConditionProperty)&&r.isConstant(a.terrainOffsetProperty)){var d=this;this.subscriptions.set(c,a.entity.definitionChanged.addEventListener(function(b,c,e,f){"isShowing"===c&&d.showsUpdated.set(a.id,a)}))}else this.updatersWithAttributes.set(c,a)};c.prototype.remove=function(a){a=a.id;this.createPrimitive=this.geometry.remove(a)||this.createPrimitive;if(this.updaters.remove(a)){this.updatersWithAttributes.remove(a);var b=this.subscriptions.get(a);g(b)&&(b(),this.subscriptions.remove(a),this.showsUpdated.remove(a));return!0}return!1};c.prototype.update=function(b){var c=!0,d=0,u=this.primitive,z=this.primitives;if(this.createPrimitive){var y=this.geometry.values;if(0<y.length){g(u)&&(g(this.oldPrimitive)?z.remove(u):this.oldPrimitive=u);var A;g(this.depthFailAppearanceType)&&(g(this.depthFailMaterialProperty)&&(this.depthFailMaterial=t.getValue(b,this.depthFailMaterialProperty,this.depthFailMaterial)),A=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.translucent,closed:this.closed}));u=new p({show:!1,asynchronous:!0,geometryInstances:y,appearance:new this.appearanceType({translucent:this.translucent,closed:this.closed}),depthFailAppearance:A,shadows:this.shadows});z.add(u);c=!1}else g(u)&&(z.remove(u),u=void 0),b=this.oldPrimitive,g(b)&&(z.remove(b),this.oldPrimitive=void 0);this.attributes.removeAll();this.primitive=u;this.createPrimitive=!1;this.waitingOnCreate=!0}else if(g(u)&&u.ready){u.show=!0;g(this.oldPrimitive)&&(z.remove(this.oldPrimitive),this.oldPrimitive=void 0);!g(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof q||(this.depthFailMaterial=t.getValue(b,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);y=this.updatersWithAttributes.values;A=y.length;for(var D=this.waitingOnCreate,z=0;z<A;z++){var x=y[z],J=this.geometry.get(x.id),aa=this.attributes.get(J.id.id);g(aa)||(aa=u.getGeometryInstanceAttributes(J.id),this.attributes.set(J.id.id,aa));if(!x.fillMaterialProperty.isConstant||D)if(J=r.getValueOrDefault(x.fillMaterialProperty.color,b,f.WHITE,v),!f.equals(aa._lastColor,J)&&(aa._lastColor=f.clone(J,aa._lastColor),aa.color=k.toValue(J,aa.color),this.translucent&&255===aa.color[3]||!this.translucent&&255!==aa.color[3]))this.itemsToRemove[d++]=x;g(this.depthFailAppearanceType)&&x.depthFailMaterialProperty instanceof q&&(!x.depthFailMaterialProperty.isConstant||D)&&(J=r.getValueOrDefault(x.depthFailMaterialProperty.color,b,f.WHITE,v),f.equals(aa._lastDepthFailColor,J)||(aa._lastDepthFailColor=f.clone(J,aa._lastDepthFailColor),aa.depthFailColor=k.toValue(J,aa.depthFailColor)));J=x.entity.isShowing&&(x.hasConstantFill||x.isFilled(b));J!==(1===aa.show[0])&&(aa.show=h.toValue(J,aa.show));J=x.distanceDisplayConditionProperty;r.isConstant(J)||(J=r.getValueOrDefault(J,b,C,B),l.equals(J,aa._lastDistanceDisplayCondition)||(aa._lastDistanceDisplayCondition=l.clone(J,aa._lastDistanceDisplayCondition),aa.distanceDisplayCondition=m.toValue(J,aa.distanceDisplayCondition)));x=x.terrainOffsetProperty;r.isConstant(x)||(x=r.getValueOrDefault(x,b,I,H),a.equals(x,aa._lastOffset)||(aa._lastOffset=a.clone(x,aa._lastOffset),aa.offset=e.toValue(x,aa.offset)))}this.updateShows(u);this.waitingOnCreate=!1}else g(u)&&!u.ready&&(c=!1);this.itemsToRemove.length=d;return c};c.prototype.updateShows=function(a){for(var b=this.showsUpdated.values,c=b.length,d=0;d<c;d++){var e=b[d],f=this.geometry.get(e.id),k=this.attributes.get(f.id.id);g(k)||(k=a.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,k));e=e.entity.isShowing;e!==(1===k.show[0])&&(k.show=h.toValue(e,k.show),f.attributes.show.value[0]=k.show[0])}this.showsUpdated.removeAll()};c.prototype.contains=function(a){return this.updaters.contains(a.id)};c.prototype.getBoundingSphere=function(a,b){var c=this.primitive;if(!c.ready)return d.PENDING;c=c.getGeometryInstanceAttributes(a.entity);if(!g(c)||!g(c.boundingSphere)||g(c.show)&&0===c.show[0])return d.FAILED;c.boundingSphere.clone(b);return d.DONE};c.prototype.destroy=function(){var a=this.primitive,b=this.primitives;g(a)&&b.remove(a);a=this.oldPrimitive;g(a)&&b.remove(a);g(this.removeMaterialSubscription)&&this.removeMaterialSubscription()};u.prototype.add=function(a,b){var d,e,f=b.createFillGeometryInstance(a);255===f.attributes.color.value[3]?(d=this._solidItems,e=!1):(d=this._translucentItems,e=!0);for(var g=d.length,h=0;h<g;h++){var k=d[h];if(k.isMaterial(b)){k.add(b,f);return}}e=new c(this._primitives,e,this._appearanceType,this._depthFailAppearanceType,b.depthFailMaterialProperty,this._closed,this._shadows);e.add(b,f);d.push(e)};u.prototype.remove=function(a){y(this._solidItems,a)||y(this._translucentItems,a)};u.prototype.update=function(a){var b=z(this,this._solidItems,a,!0),b=z(this,this._translucentItems,a,b)&&b,c=A(this,this._solidItems,a),d=A(this,this._translucentItems,a);if(c||d)b=z(this,this._solidItems,a,b)&&b,b=z(this,this._translucentItems,a,b)&&b;return b};u.prototype.getBoundingSphere=function(a,b){var c=x(this._solidItems,a,b);return c===d.FAILED?x(this._translucentItems,a,b):c};u.prototype.removeAllPrimitives=function(){D(this._solidItems);D(this._translucentItems)};return u});F("DataSources/StaticGeometryPerMaterialBatch","../Core/AssociativeArray ../Core/Cartesian3 ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/OffsetGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/Primitive ./BoundingSphereState ./ColorMaterialProperty ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a,d,e,f,g,h,k){this.primitives=a;this.appearanceType=d;this.materialProperty=e;this.depthFailAppearanceType=f;this.depthFailMaterialProperty=g;this.closed=h;this.shadows=k;this.updaters=new b;this.createPrimitive=!0;this.oldPrimitive=this.primitive=void 0;this.geometry=new b;this.depthFailMaterial=this.material=void 0;this.updatersWithAttributes=new b;this.attributes=new b;this.invalidated=!1;this.removeMaterialSubscription=e.definitionChanged.addEventListener(c.prototype.onMaterialChanged,this);this.subscriptions=new b;this.showsUpdated=new b}function u(a,b,c,d,e){this._items=[];this._primitives=a;this._appearanceType=b;this._depthFailAppearanceType=c;this._closed=d;this._shadows=e}var y=new l,A=new l,z=a.ZERO,x=new a;c.prototype.onMaterialChanged=function(){this.invalidated=!0};c.prototype.isMaterial=function(a){var b=this.materialProperty,c=a.fillMaterialProperty,d=this.depthFailMaterialProperty;a=a.depthFailMaterialProperty;if(c===b&&a===d)return!0;b=g(b)&&b.equals(c);return b=(!g(d)&&!g(a)||g(d)&&d.equals(a))&&b};c.prototype.add=function(a,b){var c=b.id;this.updaters.set(c,b);this.geometry.set(c,b.createFillGeometryInstance(a));if(b.hasConstantFill&&b.fillMaterialProperty.isConstant&&r.isConstant(b.distanceDisplayConditionProperty)&&r.isConstant(b.terrainOffsetProperty)){var d=this;this.subscriptions.set(c,b.entity.definitionChanged.addEventListener(function(a,c,e,f){"isShowing"===c&&d.showsUpdated.set(b.id,b)}))}else this.updatersWithAttributes.set(c,b);this.createPrimitive=!0};c.prototype.remove=function(a){a=a.id;this.createPrimitive=this.geometry.remove(a)||this.createPrimitive;if(this.updaters.remove(a)){this.updatersWithAttributes.remove(a);var b=this.subscriptions.get(a);g(b)&&(b(),this.subscriptions.remove(a),this.showsUpdated.remove(a));return!0}return!1};var D=new f;c.prototype.update=function(b){var c=!0,d=this.primitive,v=this.primitives,u=this.geometry.values;if(this.createPrimitive){if(0<u.length){g(d)&&(g(this.oldPrimitive)?v.remove(d):this.oldPrimitive=d);this.material=t.getValue(b,this.materialProperty,this.material);var J;g(this.depthFailMaterialProperty)&&(this.depthFailMaterial=t.getValue(b,this.depthFailMaterialProperty,this.depthFailMaterial),J=new this.depthFailAppearanceType({material:this.depthFailMaterial,translucent:this.depthFailMaterial.isTranslucent(),closed:this.closed}));d=new p({show:!1,asynchronous:!0,geometryInstances:u,appearance:new this.appearanceType({material:this.material,translucent:this.material.isTranslucent(),closed:this.closed}),depthFailAppearance:J,shadows:this.shadows});v.add(d);c=!1}else g(d)&&(v.remove(d),d=void 0),b=this.oldPrimitive,g(b)&&(v.remove(b),this.oldPrimitive=void 0);this.attributes.removeAll();this.primitive=d;this.createPrimitive=!1}else if(g(d)&&d.ready){d.show=!0;g(this.oldPrimitive)&&(v.remove(this.oldPrimitive),this.oldPrimitive=void 0);this.material=t.getValue(b,this.materialProperty,this.material);this.primitive.appearance.material=this.material;!g(this.depthFailAppearanceType)||this.depthFailMaterialProperty instanceof q||(this.depthFailMaterial=t.getValue(b,this.depthFailMaterialProperty,this.depthFailMaterial),this.primitive.depthFailAppearance.material=this.depthFailMaterial);u=this.updatersWithAttributes.values;J=u.length;for(v=0;v<J;v++){var w=u[v],G=w.entity,E=this.geometry.get(w.id),L=this.attributes.get(E.id.id);g(L)||(L=d.getGeometryInstanceAttributes(E.id),this.attributes.set(E.id.id,L));g(this.depthFailAppearanceType)&&this.depthFailMaterialProperty instanceof q&&!w.depthFailMaterialProperty.isConstant&&(E=r.getValueOrDefault(w.depthFailMaterialProperty.color,b,f.WHITE,D),f.equals(L._lastDepthFailColor,E)||(L._lastDepthFailColor=f.clone(E,L._lastDepthFailColor),L.depthFailColor=k.toValue(E,L.depthFailColor)));G=G.isShowing&&(w.hasConstantFill||w.isFilled(b));G!==(1===L.show[0])&&(L.show=h.toValue(G,L.show));G=w.distanceDisplayConditionProperty;r.isConstant(G)||(G=r.getValueOrDefault(G,b,A,y),l.equals(G,L._lastDistanceDisplayCondition)||(L._lastDistanceDisplayCondition=l.clone(G,L._lastDistanceDisplayCondition),L.distanceDisplayCondition=m.toValue(G,L.distanceDisplayCondition)));w=w.terrainOffsetProperty;r.isConstant(w)||(w=r.getValueOrDefault(w,b,z,x),a.equals(w,L._lastOffset)||(L._lastOffset=a.clone(w,L._lastOffset),L.offset=e.toValue(w,L.offset)))}this.updateShows(d)}else g(d)&&!d.ready&&(c=!1);return c};c.prototype.updateShows=function(a){for(var b=this.showsUpdated.values,c=b.length,d=0;d<c;d++){var e=b[d],f=e.entity,e=this.geometry.get(e.id),k=this.attributes.get(e.id.id);g(k)||(k=a.getGeometryInstanceAttributes(e.id),this.attributes.set(e.id.id,k));f=f.isShowing;f!==(1===k.show[0])&&(k.show=h.toValue(f,k.show),e.attributes.show.value[0]=k.show[0])}this.showsUpdated.removeAll()};c.prototype.contains=function(a){return this.updaters.contains(a.id)};c.prototype.getBoundingSphere=function(a,b){var c=this.primitive;if(!c.ready)return d.PENDING;c=c.getGeometryInstanceAttributes(a.entity);if(!g(c)||!g(c.boundingSphere)||g(c.show)&&0===c.show[0])return d.FAILED;c.boundingSphere.clone(b);return d.DONE};c.prototype.destroy=function(){var a=this.primitive,b=this.primitives;g(a)&&b.remove(a);a=this.oldPrimitive;g(a)&&b.remove(a);this.removeMaterialSubscription()};u.prototype.add=function(a,b){for(var d=this._items,e=d.length,f=0;f<e;f++){var g=d[f];if(g.isMaterial(b)){g.add(a,b);return}}e=new c(this._primitives,this._appearanceType,b.fillMaterialProperty,this._depthFailAppearanceType,b.depthFailMaterialProperty,this._closed,this._shadows);e.add(a,b);d.push(e)};u.prototype.remove=function(a){for(var b=this._items,c=b.length-1;0<=c;c--){var d=b[c];if(d.remove(a)){0===d.updaters.length&&(b.splice(c,1),d.destroy());break}}};u.prototype.update=function(a){var b,c=this._items;for(b=c.length-1;0<=b;b--){var d=c[b];if(d.invalidated){c.splice(b,1);for(var e=d.updaters.values,f=e.length,g=0;g<f;g++)this.add(a,e[g]);d.destroy()}}d=!0;for(b=0;b<c.length;b++)d=c[b].update(a)&&d;return d};u.prototype.getBoundingSphere=function(a,b){for(var c=this._items,e=c.length,f=0;f<e;f++){var g=c[f];if(g.contains(a))return g.getBoundingSphere(a,b)}return d.FAILED};u.prototype.removeAllPrimitives=function(){for(var a=this._items,b=a.length,c=0;c<b;c++)a[c].destroy();this._items.length=0};return u});F("DataSources/StaticGroundGeometryColorBatch","../Core/AssociativeArray ../Core/Color ../Core/defined ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/GroundPrimitive ./BoundingSphereState ./Property".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a,c,d,e,f){this.primitives=a;this.zIndex=f;this.classificationType=c;this.color=d;this.key=e;this.waitingOnCreate=this.createPrimitive=!1;this.oldPrimitive=this.primitive=void 0;this.geometry=new b;this.updaters=new b;this.updatersWithAttributes=new b;this.attributes=new b;this.subscriptions=new b;this.showsUpdated=new b;this.itemsToRemove=[];this.isDirty=!1}function d(a,c){this._batches=new b;this._primitives=a;this._classificationType=c}var q=new a,t=new k,r=new k;p.prototype.add=function(a,b){var c=a.id;this.createPrimitive=!0;this.geometry.set(c,b);this.updaters.set(c,a);if(a.hasConstantFill&&a.fillMaterialProperty.isConstant&&h.isConstant(a.distanceDisplayConditionProperty)){var d=this;this.subscriptions.set(c,a.entity.definitionChanged.addEventListener(function(b,c,e,f){"isShowing"===c&&d.showsUpdated.set(a.id,a)}))}else this.updatersWithAttributes.set(c,a)};p.prototype.remove=function(a){a=a.id;this.createPrimitive=this.geometry.remove(a)||this.createPrimitive;if(this.updaters.remove(a)){this.updatersWithAttributes.remove(a);var b=this.subscriptions.get(a);f(b)&&(b(),this.subscriptions.remove(a),this.showsUpdated.remove(a));return!0}return!1};var c=Array(4);p.prototype.update=function(b){var d=!0,e=0,p=this.primitive,u=this.primitives;if(this.createPrimitive)b=this.geometry.values,0<b.length?(f(p)&&(f(this.oldPrimitive)?u.remove(p):this.oldPrimitive=p),p=new m({show:!1,asynchronous:!0,geometryInstances:b,classificationType:this.classificationType}),u.add(p,this.zIndex),d=!1):(f(p)&&(u.remove(p),p=void 0),b=this.oldPrimitive,f(b)&&(u.remove(b),this.oldPrimitive=void 0)),this.attributes.removeAll(),this.primitive=p,this.createPrimitive=!1,this.waitingOnCreate=!0;else if(f(p)&&p.ready){p.show=!0;f(this.oldPrimitive)&&(u.remove(this.oldPrimitive),this.oldPrimitive=void 0);for(var D=this.updatersWithAttributes.values,v=D.length,B=this.waitingOnCreate,u=0;u<v;u++){var C=D[u],I=this.geometry.get(C.id),H=this.attributes.get(I.id.id);f(H)||(H=p.getGeometryInstanceAttributes(I.id),this.attributes.set(I.id.id,H));if(!C.fillMaterialProperty.isConstant||B){var J=h.getValueOrDefault(C.fillMaterialProperty.color,b,a.WHITE,q);a.equals(H._lastColor,J)||(H._lastColor=a.clone(J,H._lastColor),I=this.color,J=J.toBytes(c),I[0]===J[0]&&I[1]===J[1]&&I[2]===J[2]&&I[3]===J[3])||(this.itemsToRemove[e++]=C)}I=C.entity.isShowing&&(C.hasConstantFill||C.isFilled(b));I!==(1===H.show[0])&&(H.show=l.toValue(I,H.show));C=C.distanceDisplayConditionProperty;h.isConstant(C)||(C=h.getValueOrDefault(C,b,r,t),k.equals(C,H._lastDistanceDisplayCondition)||(H._lastDistanceDisplayCondition=k.clone(C,H._lastDistanceDisplayCondition),H.distanceDisplayCondition=g.toValue(C,H.distanceDisplayCondition)))}this.updateShows(p);this.waitingOnCreate=!1}else f(p)&&!p.ready&&(d=!1);this.itemsToRemove.length=e;return d};p.prototype.updateShows=function(a){for(var b=this.showsUpdated.values,c=b.length,d=0;d<c;d++){var e=b[d],g=this.geometry.get(e.id),h=this.attributes.get(g.id.id);f(h)||(h=a.getGeometryInstanceAttributes(g.id),this.attributes.set(g.id.id,h));e=e.entity.isShowing;e!==(1===h.show[0])&&(h.show=l.toValue(e,h.show),g.attributes.show.value[0]=h.show[0])}this.showsUpdated.removeAll()};p.prototype.contains=function(a){return this.updaters.contains(a.id)};p.prototype.getBoundingSphere=function(a,b){var c=this.primitive;if(!c.ready)return e.PENDING;c=c.getBoundingSphere(a.entity);if(!f(c))return e.FAILED;c.clone(b);return e.DONE};p.prototype.removeAllPrimitives=function(){var a=this.primitives,b=this.primitive;f(b)&&(a.remove(b),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());b=this.oldPrimitive;f(b)&&(a.remove(b),this.oldPrimitive=void 0)};d.prototype.add=function(a,b){var c=b.createFillGeometryInstance(a),d=this._batches,e=h.getValueOrDefault(b.zIndex,0),f=(new Uint32Array(c.attributes.color.value.buffer))[0]+":"+e;d.contains(f)?e=d.get(f):(e=new p(this._primitives,this._classificationType,c.attributes.color.value,f,e),d.set(f,e));e.add(b,c);return e};d.prototype.remove=function(a){for(var b=this._batches.values,c=b.length,d=0;d<c&&!b[d].remove(a);++d);};d.prototype.update=function(a){var b,c,d=!0,e=this._batches,f=e.values,g=f.length;for(b=0;b<g;++b)d=f[b].update(a)&&d;for(b=0;b<g;++b)for(var h=f[b],k=h.itemsToRemove,l=k.length,m=0;m<l;m++)c=k[m],h.remove(c),c=this.add(a,c),h.isDirty=!0,c.isDirty=!0;f=f.slice();g=f.length;for(b=0;b<g;++b)h=f[b],h.isDirty&&(d=f[b].update(a)&&d,h.isDirty=!1),0===h.geometry.length&&e.remove(h.key);return d};d.prototype.getBoundingSphere=function(a,b){for(var c=this._batches.values,d=c.length,f=0;f<d;++f){var g=c[f];if(g.contains(a))return g.getBoundingSphere(a,b)}return e.FAILED};d.prototype.removeAllPrimitives=function(){for(var a=this._batches.values,b=a.length,c=0;c<b;++c)a[c].removeAllPrimitives()};return d});F("DataSources/StaticGroundGeometryPerMaterialBatch","../Core/AssociativeArray ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Core/RectangleCollisionChecker ../Scene/ClassificationType ../Scene/GroundPrimitive ../Scene/ShadowVolumeAppearance ./BoundingSphereState ./ColorMaterialProperty ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a,d,e,f,g,h){this.primitives=a;this.classificationType=d;this.appearanceType=e;this.materialProperty=f;this.updaters=new b;this.createPrimitive=!0;this.oldPrimitive=this.primitive=void 0;this.geometry=new b;this.material=void 0;this.updatersWithAttributes=new b;this.attributes=new b;this.invalidated=!1;this.removeMaterialSubscription=f.definitionChanged.addEventListener(c.prototype.onMaterialChanged,this);this.subscriptions=new b;this.showsUpdated=new b;this.usingSphericalTextureCoordinates=g;this.zIndex=h;this.rectangleCollisionCheck=new m}function u(a,b,c){this._items=[];this._primitives=a;this._classificationType=b;this._appearanceType=c}var y=new k,A=new k;c.prototype.onMaterialChanged=function(){this.invalidated=!0};c.prototype.overlapping=function(a){return this.rectangleCollisionCheck.collides(a)};c.prototype.isMaterial=function(a){var b=this.materialProperty;a=a.fillMaterialProperty;return a===b||a instanceof q&&b instanceof q?!0:f(b)&&b.equals(a)};c.prototype.add=function(a,b,c){a=b.id;this.updaters.set(a,b);this.geometry.set(a,c);this.rectangleCollisionCheck.insert(a,c.geometry.rectangle);if(b.hasConstantFill&&b.fillMaterialProperty.isConstant&&r.isConstant(b.distanceDisplayConditionProperty)){var d=this;this.subscriptions.set(a,b.entity.definitionChanged.addEventListener(function(a,c,e,f){"isShowing"===c&&d.showsUpdated.set(b.id,b)}))}else this.updatersWithAttributes.set(a,b);this.createPrimitive=!0};c.prototype.remove=function(a){a=a.id;var b=this.geometry.get(a);this.createPrimitive=this.geometry.remove(a)||this.createPrimitive;return this.updaters.remove(a)?(this.rectangleCollisionCheck.remove(a,b.geometry.rectangle),this.updatersWithAttributes.remove(a),b=this.subscriptions.get(a),f(b)&&(b(),this.subscriptions.remove(a)),!0):!1};c.prototype.update=function(a){var b=!0,c=this.primitive,d=this.primitives,e=this.geometry.values;if(this.createPrimitive)0<e.length?(f(c)&&(f(this.oldPrimitive)?d.remove(c):this.oldPrimitive=c),this.material=t.getValue(a,this.materialProperty,this.material),c=new h({show:!1,asynchronous:!0,geometryInstances:e,appearance:new this.appearanceType({material:this.material}),classificationType:this.classificationType}),d.add(c,this.zIndex),b=!1):(f(c)&&(d.remove(c),c=void 0),a=this.oldPrimitive,f(a)&&(d.remove(a),this.oldPrimitive=void 0)),this.attributes.removeAll(),this.primitive=c,this.createPrimitive=!1;else if(f(c)&&c.ready){c.show=!0;f(this.oldPrimitive)&&(d.remove(this.oldPrimitive),this.oldPrimitive=void 0);this.material=t.getValue(a,this.materialProperty,this.material);this.primitive.appearance.material=this.material;for(var e=this.updatersWithAttributes.values,m=e.length,d=0;d<m;d++){var p=e[d],q=p.entity,u=this.geometry.get(p.id),w=this.attributes.get(u.id.id);f(w)||(w=c.getGeometryInstanceAttributes(u.id),this.attributes.set(u.id.id,w));q=q.isShowing&&(p.hasConstantFill||p.isFilled(a));q!==(1===w.show[0])&&(w.show=l.toValue(q,w.show));p=p.distanceDisplayConditionProperty;r.isConstant(p)||(p=r.getValueOrDefault(p,a,A,y),k.equals(p,w._lastDistanceDisplayCondition)||(w._lastDistanceDisplayCondition=k.clone(p,w._lastDistanceDisplayCondition),w.distanceDisplayCondition=g.toValue(p,w.distanceDisplayCondition)))}this.updateShows(c)}else f(c)&&!c.ready&&(b=!1);return b};c.prototype.updateShows=function(a){for(var b=this.showsUpdated.values,c=b.length,d=0;d<c;d++){var e=b[d],g=e.entity,e=this.geometry.get(e.id),h=this.attributes.get(e.id.id);f(h)||(h=a.getGeometryInstanceAttributes(e.id),this.attributes.set(e.id.id,h));g=g.isShowing;g!==(1===h.show[0])&&(h.show=l.toValue(g,h.show),e.attributes.show.value[0]=h.show[0])}this.showsUpdated.removeAll()};c.prototype.contains=function(a){return this.updaters.contains(a.id)};c.prototype.getBoundingSphere=function(a,b){var c=this.primitive;if(!c.ready)return d.PENDING;c=c.getGeometryInstanceAttributes(a.entity);if(!f(c)||!f(c.boundingSphere)||f(c.show)&&0===c.show[0])return d.FAILED;c.boundingSphere.clone(b);return d.DONE};c.prototype.destroy=function(){var a=this.primitive,b=this.primitives;f(a)&&b.remove(a);a=this.oldPrimitive;f(a)&&b.remove(a);this.removeMaterialSubscription()};u.prototype.add=function(a,b){for(var d=this._items,e=d.length,f=b.createFillGeometryInstance(a),g=p.shouldUseSphericalCoordinates(f.geometry.rectangle),h=r.getValueOrDefault(b.zIndex,0),k=0;k<e;++k){var l=d[k];if(l.isMaterial(b)&&l.usingSphericalTextureCoordinates===g&&l.zIndex===h&&!l.overlapping(f.geometry.rectangle)){l.add(a,b,f);return}}e=new c(this._primitives,this._classificationType,this._appearanceType,b.fillMaterialProperty,g,h);e.add(a,b,f);d.push(e)};u.prototype.remove=function(a){for(var b=this._items,c=b.length-1;0<=c;c--){var d=b[c];if(d.remove(a)){0===d.updaters.length&&(b.splice(c,1),d.destroy());break}}};u.prototype.update=function(a){var b,c=this._items;for(b=c.length-1;0<=b;b--){var d=c[b];if(d.invalidated){c.splice(b,1);for(var e=d.updaters.values,f=e.length,g=0;g<f;g++)this.add(a,e[g]);d.destroy()}}d=!0;for(b=0;b<c.length;b++)d=c[b].update(a)&&d;return d};u.prototype.getBoundingSphere=function(a,b){for(var c=this._items,e=c.length,f=0;f<e;f++){var g=c[f];if(g.contains(a))return g.getBoundingSphere(a,b)}return d.FAILED};u.prototype.removeAllPrimitives=function(){for(var a=this._items,b=a.length,c=0;c<b;c++)a[c].destroy();this._items.length=0};return u});F("DataSources/StaticOutlineGeometryBatch","../Core/AssociativeArray ../Core/Cartesian3 ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/OffsetGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/PerInstanceColorAppearance ../Scene/Primitive ./BoundingSphereState ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,c,d,e){this.translucent=c;this.width=d;this.shadows=e;this.primitives=a;this.waitingOnCreate=this.createPrimitive=!1;this.oldPrimitive=this.primitive=void 0;this.geometry=new b;this.updaters=new b;this.updatersWithAttributes=new b;this.attributes=new b;this.itemsToRemove=[];this.subscriptions=new b;this.showsUpdated=new b}function c(a,c,d){this._primitives=a;this._scene=c;this._shadows=d;this._solidBatches=new b;this._translucentBatches=new b}var u=new f,y=new l,A=new l,z=a.ZERO,x=new a;r.prototype.add=function(a,b){var c=a.id;this.createPrimitive=!0;this.geometry.set(c,b);this.updaters.set(c,a);if(a.hasConstantOutline&&a.outlineColorProperty.isConstant&&t.isConstant(a.distanceDisplayConditionProperty)&&t.isConstant(a.terrainOffsetProperty)){var d=this;this.subscriptions.set(c,a.entity.definitionChanged.addEventListener(function(b,c,e,f){"isShowing"===c&&d.showsUpdated.set(a.id,a)}))}else this.updatersWithAttributes.set(c,a)};r.prototype.remove=function(a){a=a.id;this.createPrimitive=this.geometry.remove(a)||this.createPrimitive;if(this.updaters.remove(a)){this.updatersWithAttributes.remove(a);var b=this.subscriptions.get(a);g(b)&&(b(),this.subscriptions.remove(a),this.showsUpdated.remove(a));return!0}return!1};r.prototype.update=function(b){var c=!0,q=0,r=this.primitive,D=this.primitives;if(this.createPrimitive)b=this.geometry.values,0<b.length?(g(r)&&(g(this.oldPrimitive)?D.remove(r):this.oldPrimitive=r),r=new d({show:!1,asynchronous:!0,geometryInstances:b,appearance:new p({flat:!0,translucent:this.translucent,renderState:{lineWidth:this.width}}),shadows:this.shadows}),D.add(r),c=!1):(g(r)&&(D.remove(r),r=void 0),b=this.oldPrimitive,g(b)&&(D.remove(b),this.oldPrimitive=void 0)),this.attributes.removeAll(),this.primitive=r,this.createPrimitive=!1,this.waitingOnCreate=!0;else if(g(r)&&r.ready){r.show=!0;g(this.oldPrimitive)&&(D.remove(this.oldPrimitive),this.oldPrimitive=void 0);for(var H=this.updatersWithAttributes.values,J=H.length,w=this.waitingOnCreate,D=0;D<J;D++){var G=H[D],E=this.geometry.get(G.id),L=this.attributes.get(E.id.id);g(L)||(L=r.getGeometryInstanceAttributes(E.id),this.attributes.set(E.id.id,L));if(!G.outlineColorProperty.isConstant||w)if(E=t.getValueOrDefault(G.outlineColorProperty,b,f.WHITE,u),!f.equals(L._lastColor,E)&&(L._lastColor=f.clone(E,L._lastColor),L.color=k.toValue(E,L.color),this.translucent&&255===L.color[3]||!this.translucent&&255!==L.color[3]))this.itemsToRemove[q++]=G;E=G.entity.isShowing&&(G.hasConstantOutline||G.isOutlineVisible(b));E!==(1===L.show[0])&&(L.show=h.toValue(E,L.show));E=G.distanceDisplayConditionProperty;t.isConstant(E)||(E=t.getValueOrDefault(E,b,A,y),l.equals(E,L._lastDistanceDisplayCondition)||(L._lastDistanceDisplayCondition=l.clone(E,L._lastDistanceDisplayCondition),L.distanceDisplayCondition=m.toValue(E,L.distanceDisplayCondition)));G=G.terrainOffsetProperty;t.isConstant(G)||(G=t.getValueOrDefault(G,b,z,x),a.equals(G,L._lastOffset)||(L._lastOffset=a.clone(G,L._lastOffset),L.offset=e.toValue(G,L.offset)))}this.updateShows(r);this.waitingOnCreate=!1}else g(r)&&!r.ready&&(c=!1);this.itemsToRemove.length=q;return c};r.prototype.updateShows=function(a){for(var b=this.showsUpdated.values,c=b.length,d=0;d<c;d++){var e=b[d],f=this.geometry.get(e.id),k=this.attributes.get(f.id.id);g(k)||(k=a.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,k));e=e.entity.isShowing;e!==(1===k.show[0])&&(k.show=h.toValue(e,k.show),f.attributes.show.value[0]=k.show[0])}this.showsUpdated.removeAll()};r.prototype.contains=function(a){return this.updaters.contains(a.id)};r.prototype.getBoundingSphere=function(a,b){var c=this.primitive;if(!c.ready)return q.PENDING;c=c.getGeometryInstanceAttributes(a.entity);if(!g(c)||!g(c.boundingSphere)||g(c.show)&&0===c.show[0])return q.FAILED;c.boundingSphere.clone(b);return q.DONE};r.prototype.removeAllPrimitives=function(){var a=this.primitives,b=this.primitive;g(b)&&(a.remove(b),this.primitive=void 0,this.geometry.removeAll(),this.updaters.removeAll());b=this.oldPrimitive;g(b)&&(a.remove(b),this.oldPrimitive=void 0)};c.prototype.add=function(a,b){var c=b.createOutlineGeometryInstance(a),d=this._scene.clampLineWidth(b.outlineWidth),e,f;255===c.attributes.color.value[3]?(e=this._solidBatches,f=e.get(d),g(f)||(f=new r(this._primitives,!1,d,this._shadows),e.set(d,f))):(e=this._translucentBatches,f=e.get(d),g(f)||(f=new r(this._primitives,!0,d,this._shadows),e.set(d,f)));f.add(b,c)};c.prototype.remove=function(a){var b,c=this._solidBatches.values,d=c.length;for(b=0;b<d;b++)if(c[b].remove(a))return;c=this._translucentBatches.values;d=c.length;for(b=0;b<d&&!c[b].remove(a);b++);};c.prototype.update=function(a){var b,c,d,e,f=this._solidBatches.values,g=f.length,h=this._translucentBatches.values,k=h.length,l,m=!0,p;do{p=!1;for(c=0;c<g;c++){e=f[c];m=e.update(a);l=e.itemsToRemove;var q=l.length;if(0<q)for(p=!0,b=0;b<q;b++)d=l[b],e.remove(d),this.add(a,d)}for(c=0;c<k;c++)if(e=h[c],m=e.update(a),l=e.itemsToRemove,q=l.length,0<q)for(p=!0,b=0;b<q;b++)d=l[b],e.remove(d),this.add(a,d)}while(p);return m};c.prototype.getBoundingSphere=function(a,b){var c,d=this._solidBatches.values,e=d.length;for(c=0;c<e;c++){var f=d[c];if(f.contains(a))return f.getBoundingSphere(a,b)}d=this._translucentBatches.values;e=d.length;for(c=0;c<e;c++)if(f=d[c],f.contains(a))return f.getBoundingSphere(a,b);return q.FAILED};c.prototype.removeAllPrimitives=function(){var a,b=this._solidBatches.values,c=b.length;for(a=0;a<c;a++)b[a].removeAllPrimitives();b=this._translucentBatches.values;c=b.length;for(a=0;a<c;a++)b[a].removeAllPrimitives()};return c});F("DataSources/WallGeometryUpdater","../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DeveloperError ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/GeometryInstance ../Core/Iso8601 ../Core/ShowGeometryInstanceAttribute ../Core/WallGeometry ../Core/WallOutlineGeometry ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ./ColorMaterialProperty ./DynamicGeometryUpdater ./GeometryUpdater ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){this.id=a;this.granularity=this.maximumHeights=this.minimumHeights=this.positions=this.vertexFormat=void 0}function z(a,b){u.call(this,{entity:a,scene:b,geometryOptions:new A(a),geometryPropertyName:"wall",observedPropertyNames:["availability","wall"]});this._onEntityPropertyChanged(a,"wall",a.wall,void 0)}function x(a,b,d){c.call(this,a,b,d)}var D=new a;k(Object.create)&&(z.prototype=Object.create(u.prototype),z.prototype.constructor=z);z.prototype.createFillGeometryInstance=function(c){b.defined("time",c);if(!this._fillEnabled)throw new g("This instance does not represent a filled geometry.");var d=this._entity,e=d.isAvailable(c),q;q=new h(e&&d.isShowing&&this._showProperty.getValue(c)&&this._fillProperty.getValue(c));var t=this._distanceDisplayConditionProperty.getValue(c),t=l.fromDistanceDisplayCondition(t);if(this._materialProperty instanceof r){var u;k(this._materialProperty.color)&&(this._materialProperty.color.isConstant||e)&&(u=this._materialProperty.color.getValue(c,D));k(u)||(u=a.WHITE);c=f.fromColor(u);q={show:q,distanceDisplayCondition:t,color:c}}else q={show:q,distanceDisplayCondition:t};return new m({id:d,geometry:new p(this._options),attributes:q})};z.prototype.createOutlineGeometryInstance=function(c){b.defined("time",c);if(!this._outlineEnabled)throw new g("This instance does not represent an outlined geometry.");var e=this._entity,k=e.isAvailable(c),p=y.getValueOrDefault(this._outlineColorProperty,c,a.BLACK,D),q=this._distanceDisplayConditionProperty.getValue(c);return new m({id:e,geometry:new d(this._options),attributes:{show:new h(k&&e.isShowing&&this._showProperty.getValue(c)&&this._showOutlineProperty.getValue(c)),color:f.fromColor(p),distanceDisplayCondition:l.fromDistanceDisplayCondition(q)}})};z.prototype._isHidden=function(a,b){return!k(b.positions)||u.prototype._isHidden.call(this,a,b)};z.prototype._getIsClosed=function(a){return!1};z.prototype._isDynamic=function(a,b){return!b.positions.isConstant||!y.isConstant(b.minimumHeights)||!y.isConstant(b.maximumHeights)||!y.isConstant(b.outlineWidth)||!y.isConstant(b.granularity)};z.prototype._setStaticOptions=function(a,b){var c=b.minimumHeights,d=b.maximumHeights,f=b.granularity,g=this._options;g.vertexFormat=this._materialProperty instanceof r?t.VERTEX_FORMAT:q.MaterialSupport.TEXTURED.vertexFormat;g.positions=b.positions.getValue(e.MINIMUM_VALUE,g.positions);g.minimumHeights=k(c)?c.getValue(e.MINIMUM_VALUE,g.minimumHeights):void 0;g.maximumHeights=k(d)?d.getValue(e.MINIMUM_VALUE,g.maximumHeights):void 0;g.granularity=k(f)?f.getValue(e.MINIMUM_VALUE):void 0};z.DynamicGeometryUpdater=x;k(Object.create)&&(x.prototype=Object.create(c.prototype),x.prototype.constructor=x);x.prototype._isHidden=function(a,b,d){return!k(this._options.positions)||c.prototype._isHidden.call(this,a,b,d)};x.prototype._setOptions=function(a,b,c){a=this._options;a.positions=y.getValueOrUndefined(b.positions,c,a.positions);a.minimumHeights=y.getValueOrUndefined(b.minimumHeights,c,a.minimumHeights);a.maximumHeights=y.getValueOrUndefined(b.maximumHeights,c,a.maximumHeights);a.granularity=y.getValueOrUndefined(b.granularity,c)};return z});F("DataSources/GeometryVisualizer","../Core/AssociativeArray ../Core/BoundingSphere ../Core/Check ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/Event ../Core/EventHelper ../Scene/ClassificationType ../Scene/MaterialAppearance ../Scene/PerInstanceColorAppearance ../Scene/ShadowMode ./BoundingSphereState ./BoxGeometryUpdater ./ColorMaterialProperty ./CorridorGeometryUpdater ./CylinderGeometryUpdater ./DynamicGeometryBatch ./EllipseGeometryUpdater ./EllipsoidGeometryUpdater ./Entity ./PlaneGeometryUpdater ./PolygonGeometryUpdater ./PolylineVolumeGeometryUpdater ./RectangleGeometryUpdater ./StaticGeometryColorBatch ./StaticGeometryPerMaterialBatch ./StaticGroundGeometryColorBatch ./StaticGroundGeometryPerMaterialBatch ./StaticOutlineGeometryBatch ./WallGeometryUpdater".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L){function K(a,b){function c(a){f.raiseEvent(a)}this.entity=a;this.scene=b;for(var d=Array(O.length),f=new m,g=new e,h=0;h<d.length;h++){var k=new O[h](a,b);g.add(k.geometryChanged,c);d[h]=k}this.updaters=d;this.geometryChanged=f;this.eventHelper=g;this._removeEntitySubscription=a.definitionChanged.addEventListener(K.prototype._onEntityPropertyChanged,this)}function P(a,c,e,g){f.defined("scene",a);f.defined("entityCollection",c);e=k(e,a.primitives);g=k(g,a.groundPrimitives);this._scene=a;this._primitives=e;this._groundPrimitives=g;this._entityCollection=void 0;this._addedObjects=new b;this._removedObjects=new b;this._changedObjects=new b;var l=q.NUMBER_OF_SHADOW_MODES;this._outlineBatches=Array(2*l);this._closedColorBatches=Array(2*l);this._closedMaterialBatches=Array(2*l);this._openColorBatches=Array(2*l);this._openMaterialBatches=Array(2*l);var m=D.supportsMaterialsforEntitiesOnTerrain(a);this._supportsMaterialsforEntitiesOnTerrain=m;var r;for(r=0;r<l;++r)this._outlineBatches[r]=new E(e,a,r,!1),this._outlineBatches[l+r]=new E(e,a,r,!0),this._closedColorBatches[r]=new H(e,d,void 0,!0,r,!0),this._closedColorBatches[l+r]=new H(e,d,void 0,!0,r,!1),this._closedMaterialBatches[r]=new J(e,p,void 0,!0,r,!0),this._closedMaterialBatches[l+r]=new J(e,p,void 0,!0,r,!1),this._openColorBatches[r]=new H(e,d,void 0,!1,r,!0),this._openColorBatches[l+r]=new H(e,d,void 0,!1,r,!1),this._openMaterialBatches[r]=new J(e,p,void 0,!1,r,!0),this._openMaterialBatches[l+r]=new J(e,p,void 0,!1,r,!1);a=h.NUMBER_OF_CLASSIFICATION_TYPES;var l=Array(a),t=[];if(m)for(r=0;r<a;++r)t.push(new G(g,r,p)),l[r]=new G(g,r,d);else for(r=0;r<a;++r)l[r]=new w(g,r);this._groundColorBatches=l;this._groundMaterialBatches=t;this._dynamicBatch=new A(e,g);this._batches=this._outlineBatches.concat(this._closedColorBatches,this._closedMaterialBatches,this._openColorBatches,this._openMaterialBatches,this._groundColorBatches,this._groundMaterialBatches,this._dynamicBatch);this._subscriptions=new b;this._updaterSets=new b;this._entityCollection=c;c.collectionChanged.addEventListener(P.prototype._onCollectionChanged,this);this._onCollectionChanged(c,c.values,N)}var N=[],O=[r,y,u,z,x,v,B,C,I,L];K.prototype._onEntityPropertyChanged=function(a,b,c,d){for(var e=this.updaters,f=0;f<e.length;f++)e[f]._onEntityPropertyChanged(a,b,c,d)};K.prototype.forEach=function(a){for(var b=this.updaters,c=0;c<b.length;c++)a(b[c])};K.prototype.destroy=function(){this.eventHelper.removeAll();for(var a=this.updaters,b=0;b<a.length;b++)a[b].destroy();this._removeEntitySubscription();l(this)};P.prototype.update=function(a){f.defined("time",a);var b=this._addedObjects,c=b.values,d=this._removedObjects,e=d.values,g=this._changedObjects,h=g.values,k,l,m,p,q=this;for(k=h.length-1;-1<k;k--)l=h[k],m=l.id,p=this._updaterSets.get(m),p.entity===l?p.forEach(function(b){q._removeUpdater(b);q._insertUpdaterIntoBatch(a,b)}):(e.push(l),c.push(l));for(k=e.length-1;-1<k;k--)l=e[k],m=l.id,p=this._updaterSets.get(m),p.forEach(this._removeUpdater.bind(this)),p.destroy(),this._updaterSets.remove(m),this._subscriptions.get(m)(),this._subscriptions.remove(m);for(k=c.length-1;-1<k;k--)l=c[k],m=l.id,p=new K(l,this._scene),this._updaterSets.set(m,p),p.forEach(function(b){q._insertUpdaterIntoBatch(a,b)}),this._subscriptions.set(m,p.geometryChanged.addEventListener(P._onGeometryChanged,this));b.removeAll();d.removeAll();g.removeAll();b=!0;c=this._batches;d=c.length;for(k=0;k<d;k++)b=c[k].update(a)&&b;return b};var Z=[],aa=new a;P.prototype.getBoundingSphere=function(b,c){f.defined("entity",b);f.defined("result",c);for(var d=0,e,g=this._batches,h=g.length,k=this._updaterSets.get(b.id).updaters,l=0;l<k.length;l++)for(var m=k[l],p=0;p<h;p++){e=g[p].getBoundingSphere(m,aa);if(e===t.PENDING)return t.PENDING;e===t.DONE&&(Z[d]=a.clone(aa,Z[d]),d++)}if(0===d)return t.FAILED;Z.length=d;a.fromBoundingSpheres(Z,c);return t.DONE};P.prototype.isDestroyed=function(){return!1};P.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(P.prototype._onCollectionChanged,this);this._addedObjects.removeAll();this._removedObjects.removeAll();var a,b=this._batches,c=b.length;for(a=0;a<c;a++)b[a].removeAllPrimitives();b=this._subscriptions.values;c=b.length;for(a=0;a<c;a++)b[a]();this._subscriptions.removeAll();b=this._updaterSets.values;c=b.length;for(a=0;a<c;a++)b[a].destroy();this._updaterSets.removeAll();return l(this)};P.prototype._removeUpdater=function(a){for(var b=this._batches,c=b.length,d=0;d<c;d++)b[d].remove(a)};P.prototype._insertUpdaterIntoBatch=function(a,b){if(b.isDynamic)this._dynamicBatch.add(a,b);else{var d;if(b.outlineEnabled||b.fillEnabled)d=b.shadowsProperty.getValue(a);var e=q.NUMBER_OF_SHADOW_MODES;b.outlineEnabled&&(g(b.terrainOffsetProperty)?this._outlineBatches[e+d].add(a,b):this._outlineBatches[d].add(a,b));b.fillEnabled&&(b.onTerrain?(d=b.classificationTypeProperty.getValue(a),b.fillMaterialProperty instanceof c?this._groundColorBatches[d].add(a,b):this._groundMaterialBatches[d].add(a,b)):b.isClosed?b.fillMaterialProperty instanceof c?g(b.terrainOffsetProperty)?this._closedColorBatches[e+d].add(a,b):this._closedColorBatches[d].add(a,b):g(b.terrainOffsetProperty)?this._closedMaterialBatches[e+d].add(a,b):this._closedMaterialBatches[d].add(a,b):b.fillMaterialProperty instanceof c?g(b.terrainOffsetProperty)?this._openColorBatches[e+d].add(a,b):this._openColorBatches[d].add(a,b):g(b.terrainOffsetProperty)?this._openMaterialBatches[e+d].add(a,b):this._openMaterialBatches[d].add(a,b))}};P._onGeometryChanged=function(a){var b=this._changedObjects;a=a.entity;var c=a.id;g(this._removedObjects.get(c))||g(b.get(c))||b.set(c,a)};P.prototype._onCollectionChanged=function(a,b,c){a=this._addedObjects;var d=this._removedObjects,e=this._changedObjects,f,g,h;for(f=c.length-1;-1<f;f--)h=c[f],g=h.id,a.remove(g)||(d.set(g,h),e.remove(g));for(f=b.length-1;-1<f;f--)h=b[f],g=h.id,d.remove(g)?e.set(g,h):a.set(g,h)};return P});F("DataSources/LabelVisualizer","../Core/AssociativeArray ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/NearFarScalar ../Scene/HeightReference ../Scene/HorizontalOrigin ../Scene/LabelStyle ../Scene/VerticalOrigin ../Scene/SceneMode ./BoundingSphereState ./Property".split(" "),
function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){this.entity=a;this.index=this.label=void 0}function z(a,c){if(!l(a))throw new e("entityCluster is required.");if(!l(c))throw new e("entityCollection is required.");c.collectionChanged.addEventListener(z.prototype._onCollectionChanged,this);this._cluster=a;this._entityCollection=c;this._items=new b;this._onCollectionChanged(c,c.values,[],[])}function x(a,b,c){l(a)&&(a.label=void 0,c.removeLabel(b))}var D=t.FILL,v=k.WHITE,B=k.BLACK,C=new k(.165,.165,.165,.8),I=new a(7,5),H=a.ZERO,J=f.ZERO,w=d.NONE,G=q.CENTER,E=r.CENTER,L=new f,K=new k,P=new k,N=new k,O=new a,Z=new f,aa=new a,U=new p,W=new p,M=new p,R=new h;z.prototype.update=function(a,b){if(!l(a))throw new e("time is required.");for(var g=this._items.values,h=this._cluster,k=0,m=g.length;k<m;k++){var p=g[k],q=p.entity,r=q._label,t,u=p.label,z=q.isShowing&&q.isAvailable(a)&&y.getValueOrDefault(r._show,a,!0),A;z&&(A=y.getValueOrUndefined(q._position,a,L),t=y.getValueOrUndefined(r._text,a),z=l(A)&&l(t));if(z){y.isConstant(q._position)||(h._clusterDirty=!0);var z=!1,Q;Q=b===c.SCENE3D?y.getValueOrDefault(r._heightReference,a,w):d.NONE;l(u)||(u=h.getLabel(q),u.id=q,p.label=u,z=f.equals(u.position,A)&&u.heightReference===Q);u.show=!0;u.position=A;u.text=t;u.scale=y.getValueOrDefault(r._scale,a,1);u.font=y.getValueOrDefault(r._font,a,"30px sans-serif");u.style=y.getValueOrDefault(r._style,a,D);u.fillColor=y.getValueOrDefault(r._fillColor,a,v,K);u.outlineColor=y.getValueOrDefault(r._outlineColor,a,B,P);u.outlineWidth=y.getValueOrDefault(r._outlineWidth,a,1);u.showBackground=y.getValueOrDefault(r._showBackground,a,!1);u.backgroundColor=y.getValueOrDefault(r._backgroundColor,a,C,N);u.backgroundPadding=y.getValueOrDefault(r._backgroundPadding,a,I,O);u.pixelOffset=y.getValueOrDefault(r._pixelOffset,a,H,aa);u.eyeOffset=y.getValueOrDefault(r._eyeOffset,a,J,Z);u.heightReference=Q;u.horizontalOrigin=y.getValueOrDefault(r._horizontalOrigin,a,G);u.verticalOrigin=y.getValueOrDefault(r._verticalOrigin,a,E);u.translucencyByDistance=y.getValueOrUndefined(r._translucencyByDistance,a,U);u.pixelOffsetScaleByDistance=y.getValueOrUndefined(r._pixelOffsetScaleByDistance,a,W);u.scaleByDistance=y.getValueOrUndefined(r._scaleByDistance,a,M);u.distanceDisplayCondition=b===c.SCENE3D?y.getValueOrUndefined(r._distanceDisplayCondition,a,R):void 0;u.enableShiftLine=y.getValueOrDefault(r._enableShiftLine,!1);u.disableDepthTestDistance=y.getValueOrUndefined(r._disableDepthTestDistance,a);z&&u._updateClamping()}else x(p,q,h)}return!0};z.prototype.getBoundingSphere=function(a,b){if(!l(a))throw new e("entity is required.");if(!l(b))throw new e("result is required.");var c=this._items.get(a.id);if(!l(c)||!l(c.label))return u.FAILED;c=c.label;b.center=f.clone(g(c._clampedPosition,c.position),b.center);b.radius=0;return u.DONE};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(z.prototype._onCollectionChanged,this);for(var a=this._entityCollection.values,b=0;b<a.length;b++)this._cluster.removeLabel(a[b]);return m(this)};z.prototype._onCollectionChanged=function(a,b,c,d){var e,f=this._items,g=this._cluster;for(a=b.length-1;-1<a;a--)e=b[a],l(e._label)&&l(e._position)&&f.set(e.id,new A(e));for(a=d.length-1;-1<a;a--)e=d[a],l(e._label)&&l(e._position)?f.contains(e.id)||f.set(e.id,new A(e)):(x(f.get(e.id),e,g),f.remove(e.id));for(a=c.length-1;-1<a;a--)e=c[a],x(f.get(e.id),e,g),f.remove(e.id)};return z});F("ThirdParty/GltfPipeline/addToArray",["../../Core/defaultValue"],function(b){return function(a,f,k){if(k=b(k,!1))if(k=a.indexOf(f),-1<k)return k;a.push(f);return a.length-1}});F("ThirdParty/GltfPipeline/hasExtension",["../../Core/defined"],function(b){return function(a,f){return b(a.extensionsUsed)&&0<=a.extensionsUsed.indexOf(f)}});F("ThirdParty/GltfPipeline/ForEach",["./hasExtension","../../Core/defined","../../Core/isArray"],function(b,a,f){function k(){}k.objectLegacy=function(b,f){if(a(b))for(var g in b)if(b.hasOwnProperty(g)){var e=f(b[g],g);if(a(e))return e}};k.object=function(b,f){if(a(b))for(var g=b.length,e=0;e<g;e++){var h=f(b[e],e);if(a(h))return h}};k.topLevel=function(b,l,m){b=b[l];return a(b)&&!f(b)?k.objectLegacy(b,m):k.object(b,m)};k.accessor=function(a,b){return k.topLevel(a,"accessors",b)};k.accessorWithSemantic=function(b,f,m){var e={};return k.mesh(b,function(b){return k.meshPrimitive(b,function(b){var d=k.meshPrimitiveAttribute(b,function(b,g){if(0===g.indexOf(f)&&!a(e[b])&&(e[b]=!0,d=m(b),a(d)))return d});return a(d)?d:k.meshPrimitiveTarget(b,function(b){return k.meshPrimitiveTargetAttribute(b,function(b,g){if(0===g.indexOf(f)&&!a(e[b])&&(e[b]=!0,d=m(b),a(d)))return d})})})})};k.accessorContainingVertexAttributeData=function(b,f){var g={};return k.mesh(b,function(b){return k.meshPrimitive(b,function(b){var e=k.meshPrimitiveAttribute(b,function(b){if(!a(g[b])&&(g[b]=!0,e=f(b),a(e)))return e});return a(e)?e:k.meshPrimitiveTarget(b,function(b){return k.meshPrimitiveTargetAttribute(b,function(b){if(!a(g[b])&&(g[b]=!0,e=f(b),a(e)))return e})})})})};k.accessorContainingIndexData=function(b,f){var g={};return k.mesh(b,function(b){return k.meshPrimitive(b,function(b){b=b.indices;if(a(b)&&!a(g[b])&&(g[b]=!0,b=f(b),a(b)))return b})})};k.animation=function(a,b){return k.topLevel(a,"animations",b)};k.animationChannel=function(a,b){return k.object(a.channels,b)};k.animationSampler=function(a,b){return k.object(a.samplers,b)};k.buffer=function(a,b){return k.topLevel(a,"buffers",b)};k.bufferView=function(a,b){return k.topLevel(a,"bufferViews",b)};k.camera=function(a,b){return k.topLevel(a,"cameras",b)};k.image=function(a,b){return k.topLevel(a,"images",b)};k.compressedImage=function(b,f){if(a(b.extras)){var g=b.extras.compressedImage3DTiles,e;for(e in g)if(g.hasOwnProperty(e)){var h=f(g[e],e);if(a(h))return h}}};k.material=function(a,b){return k.topLevel(a,"materials",b)};k.materialValue=function(b,f){var g=b.values;a(b.extensions)&&a(b.extensions.KHR_techniques_webgl)&&(g=b.extensions.KHR_techniques_webgl.values);for(var e in g)if(g.hasOwnProperty(e)){var h=f(g[e],e);if(a(h))return h}};k.mesh=function(a,b){return k.topLevel(a,"meshes",b)};k.meshPrimitive=function(b,f){var g=b.primitives;if(a(g))for(var e=g.length,h=0;h<e;h++){var k=f(g[h],h);if(a(k))return k}};k.meshPrimitiveAttribute=function(b,f){var g=b.attributes,e;for(e in g)if(g.hasOwnProperty(e)){var h=f(g[e],e);if(a(h))return h}};k.meshPrimitiveTarget=function(b,f){var g=b.targets;if(a(g))for(var e=g.length,h=0;h<e;++h){var k=f(g[h],h);if(a(k))return k}};k.meshPrimitiveTargetAttribute=function(b,f){for(var g in b)if(b.hasOwnProperty(g)){var e=f(b[g],g);if(a(e))return e}};k.node=function(a,b){return k.topLevel(a,"nodes",b)};k.nodeInTree=function(b,f,m){var e=b.nodes;if(a(e))for(var g=f.length,l=0;l<g;l++){var d=f[l],q=e[d];if(a(q)){d=m(q,d);if(a(d))return d;q=q.children;if(a(q)&&(d=k.nodeInTree(b,q,m),a(d)))return d}}};k.nodeInScene=function(b,f,m){f=f.nodes;if(a(f))return k.nodeInTree(b,f,m)};k.program=function(a,f){return b(a,"KHR_techniques_webgl")?k.object(a.extensions.KHR_techniques_webgl.programs,f):k.topLevel(a,"programs",f)};k.sampler=function(a,b){return k.topLevel(a,"samplers",b)};k.scene=function(a,b){return k.topLevel(a,"scenes",b)};k.shader=function(a,f){return b(a,"KHR_techniques_webgl")?k.object(a.extensions.KHR_techniques_webgl.shaders,f):k.topLevel(a,"shaders",f)};k.skin=function(a,b){return k.topLevel(a,"skins",b)};k.techniqueAttribute=function(b,f){var g=b.attributes,e;for(e in g)if(g.hasOwnProperty(e)){var h=f(g[e],e);if(a(h))return h}};k.techniqueUniform=function(b,f){var g=b.uniforms,e;for(e in g)if(g.hasOwnProperty(e)){var h=f(g[e],e);if(a(h))return h}};k.techniqueParameter=function(b,f){var g=b.parameters,e;for(e in g)if(g.hasOwnProperty(e)){var h=f(g[e],e);if(a(h))return h}};k.technique=function(a,f){return b(a,"KHR_techniques_webgl")?k.object(a.extensions.KHR_techniques_webgl.techniques,f):k.topLevel(a,"techniques",f)};k.texture=function(a,b){return k.topLevel(a,"textures",b)};return k});F("ThirdParty/GltfPipeline/numberOfComponentsForType",[],function(){return function(b){switch(b){case "SCALAR":return 1;case "VEC2":return 2;case "VEC3":return 3;case "VEC4":case "MAT2":return 4;case "MAT3":return 9;case "MAT4":return 16}}});F("ThirdParty/GltfPipeline/getAccessorByteStride",["./numberOfComponentsForType","../../Core/ComponentDatatype","../../Core/defined"],function(b,a,f){return function(k,g){var l=g.bufferView;return f(l)&&(l=k.bufferViews[l],f(l.byteStride)&&0<l.byteStride)?l.byteStride:a.getSizeInBytes(g.componentType)*b(g.type)}});F("ThirdParty/GltfPipeline/addDefaults","./addToArray ./ForEach ./getAccessorByteStride ../../Core/defaultValue ../../Core/defined ../../Core/WebGLConstants".split(" "),function(b,a,f,k,g,l){function m(b){var e={};a.animation(b,function(b){a.animationChannel(b,function(a){var b=a.target;a=b.node;b=b.path;if("translation"===b||"rotation"===b||"scale"===b)e[a]=!0})});return e}function e(a){g(a)&&(a.texCoord=k(a.texCoord,0))}return function(h){a.accessor(h,function(a){g(a.bufferView)&&(a.byteOffset=k(a.byteOffset,0))});a.bufferView(h,function(a){g(a.buffer)&&(a.byteOffset=k(a.byteOffset,0))});a.mesh(h,function(d){a.meshPrimitive(d,function(a){a.mode=k(a.mode,l.TRIANGLES);g(a.material)||(g(h.materials)||(h.materials=[]),a.material=b(h.materials,{name:"default"}))})});a.accessorContainingVertexAttributeData(h,function(a){a=h.accessors[a];var b=a.bufferView;a.normalized=k(a.normalized,!1);g(b)&&(b=h.bufferViews[b],b.byteStride=f(h,a),b.target=l.ARRAY_BUFFER)});a.accessorContainingIndexData(h,function(a){a=h.accessors[a].bufferView;g(a)&&(h.bufferViews[a].target=l.ELEMENT_ARRAY_BUFFER)});a.material(h,function(b){var d=k(b.extensions,k.EMPTY_OBJECT),f=d.KHR_materials_common;g(f)?(d=f.technique,b=g(f.values)?f.values:{},f.values=b,b.ambient=g(b.ambient)?b.ambient:[0,0,0,1],b.emission=g(b.emission)?b.emission:[0,0,0,1],b.transparency=k(b.transparency,1),b.transparent=k(b.transparent,!1),b.doubleSided=k(b.doubleSided,!1),"CONSTANT"!==d&&(b.diffuse=g(b.diffuse)?b.diffuse:[0,0,0,1],"LAMBERT"!==d&&(b.specular=g(b.specular)?b.specular:[0,0,0,1],b.shininess=k(b.shininess,0)))):(b.emissiveFactor=k(b.emissiveFactor,[0,0,0]),b.alphaMode=k(b.alphaMode,"OPAQUE"),b.doubleSided=k(b.doubleSided,!1),"MASK"===b.alphaMode&&(b.alphaCutoff=k(b.alphaCutoff,.5)),g(d.KHR_techniques_webgl)&&a.materialValue(b,function(a){g(a.index)&&e(a)}),e(b.emissiveTexture),e(b.normalTexture),e(b.occlusionTexture),f=b.pbrMetallicRoughness,g(f)&&(f.baseColorFactor=k(f.baseColorFactor,[1,1,1,1]),f.metallicFactor=k(f.metallicFactor,1),f.roughnessFactor=k(f.roughnessFactor,1),e(f.baseColorTexture),e(f.metallicRoughnessTexture)),f=d.pbrSpecularGlossiness,g(f)&&(f.diffuseFactor=k(f.diffuseFactor,[1,1,1,1]),f.specularFactor=k(f.specularFactor,[1,1,1]),f.glossinessFactor=k(f.glossinessFactor,1),e(f.specularGlossinessTexture)))});a.animation(h,function(b){a.animationSampler(b,function(a){a.interpolation=k(a.interpolation,"LINEAR")})});var p=m(h);a.node(h,function(a,b){g(p[b])||g(a.translation)||g(a.rotation)||g(a.scale)?(a.translation=k(a.translation,[0,0,0]),a.rotation=k(a.rotation,[0,0,0,1]),a.scale=k(a.scale,[1,1,1])):a.matrix=k(a.matrix,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])});a.sampler(h,function(a){a.wrapS=k(a.wrapS,l.REPEAT);a.wrapT=k(a.wrapT,l.REPEAT)});g(h.scenes)&&!g(h.scene)&&(h.scene=0);return h}});F("ThirdParty/GltfPipeline/addPipelineExtras",["./ForEach","../../Core/defined"],function(b,a){function f(b){b.extras=a(b.extras)?b.extras:{};b.extras._pipeline=a(b.extras._pipeline)?b.extras._pipeline:{}}return function(a){b.shader(a,function(a){f(a)});b.buffer(a,function(a){f(a)});b.image(a,function(a){f(a);b.compressedImage(a,function(a){f(a)})});f(a);return a}});F("ThirdParty/GltfPipeline/removeExtensionsRequired",["../../Core/defined"],function(b){return function(a,f){var k=a.extensionsRequired;if(b(k)){var g=k.indexOf(f);0<=g&&k.splice(g,1);0===k.length&&delete a.extensionsRequired}}});F("ThirdParty/GltfPipeline/removeExtensionsUsed",["./removeExtensionsRequired","../../Core/defined"],function(b,a){return function(f,k){var g=f.extensionsUsed;if(a(g)){var l=g.indexOf(k);0<=l&&g.splice(l,1);b(f,k);0===g.length&&delete f.extensionsUsed}}});F("ThirdParty/GltfPipeline/parseGlb","./addPipelineExtras ./removeExtensionsUsed ../../Core/defaultValue ../../Core/defined ../../Core/getMagic ../../Core/getStringFromTypedArray ../../Core/RuntimeError".split(" "),function(b,a,f,k,g,l,m){function e(a,b,d){for(var e=new DataView(a.buffer),f=Array(d),g=0;g<d;++g)f[g]=e.getUint32(a.byteOffset+b+4*g,!0);return f}return function(h){if("glTF"!==g(h))throw new m("File is not valid binary glTF");var p=e(h,0,5),d=p[1];if(1!==d&&2!==d)throw new m("Binary glTF version is not 1 or 2");if(1===d){var q=p[2],t=p[3];if(0!==p[4])throw new m("Binary glTF scene format is not JSON");p=20+t;t=l(h,20,t);t=JSON.parse(t);b(t);h=h.subarray(p,q);q=t.buffers;k(q)&&0<Object.keys(q).length&&(q=f(q.binary_glTF,q.KHR_binary_glTF),k(q)&&(q.extras._pipeline.source=h));a(t,"KHR_binary_glTF");return t}p=p[2];for(d=12;d<p;){var r=e(h,d,2),c=r[0],r=r[1],d=d+8,u=h.subarray(d,d+c),d=d+c;1313821514===r?(t=l(u),t=JSON.parse(t),b(t)):5130562===r&&(q=u)}k(t)&&k(q)&&(h=t.buffers,k(h)&&0<h.length&&(h[0].extras._pipeline.source=q));return t}});F("ThirdParty/GltfPipeline/removePipelineExtras",["./ForEach","../../Core/defined"],function(b,a){function f(b){a(b.extras)&&(a(b.extras._pipeline)&&delete b.extras._pipeline,0===Object.keys(b.extras).length&&delete b.extras)}return function(a){b.shader(a,function(a){f(a)});b.buffer(a,function(a){f(a)});b.image(a,function(a){f(a);b.compressedImage(a,function(a){f(a)})});f(a);return a}});F("ThirdParty/GltfPipeline/addExtensionsUsed",["./addToArray","../../Core/defined"],function(b,a){return function(f,k){var g=f.extensionsUsed;a(g)||(g=[],f.extensionsUsed=g);b(g,k,!0)}});F("ThirdParty/GltfPipeline/getComponentReader",["../../Core/ComponentDatatype"],function(b){return function(a){switch(a){case b.BYTE:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getInt8(b+e*l)};case b.UNSIGNED_BYTE:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getUint8(b+e*l)};case b.SHORT:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getInt16(b+e*l,!0)};case b.UNSIGNED_SHORT:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getUint16(b+e*l,!0)};case b.INT:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getInt32(b+e*l,!0)};case b.UNSIGNED_INT:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getUint32(b+e*l,!0)};case b.FLOAT:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getFloat32(b+e*l,!0)};case b.DOUBLE:return function(a,b,g,l,m){for(var e=0;e<g;++e)m[e]=a.getFloat64(b+e*l,!0)}}}});F("ThirdParty/GltfPipeline/findAccessorMinMax","./getAccessorByteStride ./getComponentReader ./numberOfComponentsForType ../../Core/arrayFill ../../Core/ComponentDatatype ../../Core/defined".split(" "),function(b,a,f,k,g,l){return function(m,e){var h=m.bufferViews,p=m.buffers,d=e.bufferView,q=f(e.type);if(!l(e.bufferView))return{min:k(Array(q),0),max:k(Array(q),0)};for(var t=k(Array(q),Number.POSITIVE_INFINITY),r=k(Array(q),Number.NEGATIVE_INFINITY),d=h[d],c=p[d.buffer].extras._pipeline.source,p=e.count,h=b(m,e),d=e.byteOffset+d.byteOffset+c.byteOffset,u=e.componentType,y=g.getSizeInBytes(u),c=new DataView(c.buffer),A=Array(q),u=a(u),z=0;z<p;z++){u(c,d,q,y,A);for(var x=0;x<q;x++){var D=A[x];t[x]=Math.min(t[x],D);r[x]=Math.max(r[x],D)}d+=h}return{min:t,max:r}}});F("ThirdParty/GltfPipeline/moveTechniqueRenderStates",["./addExtensionsUsed","./ForEach","../../Core/defaultValue","../../Core/defined","../../Core/WebGLConstants"],function(b,a,f,k,g){function l(a,b){var d=a.enable;return k(d)?-1<d.indexOf(b):!1}var m=[g.FUNC_ADD,g.FUNC_ADD],e=[g.ONE,g.ZERO,g.ONE,g.ZERO],h=[g.ZERO,g.ONE,g.SRC_COLOR,g.ONE_MINUS_SRC_COLOR,g.SRC_ALPHA,g.ONE_MINUS_SRC_ALPHA,g.DST_ALPHA,g.ONE_MINUS_DST_ALPHA,g.DST_COLOR,g.ONE_MINUS_DST_COLOR];return function(p){var d={},q={};if(!k(p.techniques))return p;a.technique(p,function(a,b){var c=a.states;if(k(c)){var p=q[b]={};if(l(c,g.BLEND)){p.alphaMode="BLEND";var r=c.functions;if(k(r)&&(k(r.blendEquationSeparate)||k(r.blendFuncSeparate))){var t=f(r.blendEquationSeparate,m);a:if(r=r.blendFuncSeparate,k(r))for(var z=0;4>z;z++){if(-1===h.indexOf(r[z])){r=e;break a}}else r=e;d[b]={blendEquation:t,blendFactors:r}}}l(c,g.CULL_FACE)||(p.doubleSided=!0);delete a.states}});0<Object.keys(d).length&&(k(p.extensions)||(p.extensions={}),b(p,"KHR_blend"));a.material(p,function(b){if(k(b.technique)){a.objectLegacy(q[b.technique],function(a,d){b[d]=a});var e=d[b.technique];k(e)&&(k(b.extensions)||(b.extensions={}),b.extensions.KHR_blend=e)}});return p}});F("ThirdParty/GltfPipeline/addExtensionsRequired",["./addExtensionsUsed","./addToArray","../../Core/defined"],function(b,a,f){return function(k,g){var l=k.extensionsRequired;f(l)||(l=[],k.extensionsRequired=l);a(l,g,!0);b(k,g)}});F("ThirdParty/GltfPipeline/moveTechniquesToExtension",["./addExtensionsUsed","./addExtensionsRequired","./addToArray","./ForEach","../../Core/defined"],function(b,a,f,k,g){return function(l){var m={},e={};if(g(l.techniques)){var h={programs:[],shaders:[],techniques:[]},p=l.glExtensionsUsed;delete l.glExtensionsUsed;k.technique(l,function(a,b){var d={name:a.name,program:void 0,attributes:{},uniforms:{}},g;k.techniqueAttribute(a,function(b,c){g=a.parameters[b];d.attributes[c]={semantic:g.semantic}});k.techniqueUniform(a,function(b,c){g=a.parameters[b];d.uniforms[c]={count:g.count,node:g.node,type:g.type,semantic:g.semantic,value:g.value};m[b]=c});var c=l.programs[a.program],q={name:c.name,fragmentShader:void 0,vertexShader:void 0,glExtensions:p};q.fragmentShader=f(h.shaders,l.shaders[c.fragmentShader],!0);q.vertexShader=f(h.shaders,l.shaders[c.vertexShader],!0);d.program=f(h.programs,q);e[b]=f(h.techniques,d)});0<h.techniques.length&&(g(l.extensions)||(l.extensions={}),l.extensions.KHR_techniques_webgl=h,b(l,"KHR_techniques_webgl"),a(l,"KHR_techniques_webgl"))}k.material(l,function(a){if(g(a.technique)){var b={technique:e[a.technique]};k.objectLegacy(a.values,function(a,d){g(b.values)||(b.values={});b.values[m[d]]=a});g(a.extensions)||(a.extensions={});a.extensions.KHR_techniques_webgl=b}delete a.technique;delete a.values});delete l.techniques;delete l.programs;delete l.shaders;return l}});F("ThirdParty/GltfPipeline/removeUnusedElements",["./ForEach","./hasExtension","../../Core/defined"],function(b,a,f){function k(a,b){var e=a[m[b]];if(f(e))for(var d=0,h=l[b](a),e=e.length,k=0;k<e;++k)h[k]||(g[b](a,k-d),d++)}function g(){}function l(){}var m={accessor:"accessors",buffer:"buffers",bufferView:"bufferViews"};g.accessor=function(a,g){a.accessors.splice(g,1);b.mesh(a,function(a){b.meshPrimitive(a,function(a){b.meshPrimitiveAttribute(a,function(b,d){b>g&&a.attributes[d]--});b.meshPrimitiveTarget(a,function(a){b.meshPrimitiveTargetAttribute(a,function(b,c){b>g&&a[c]--})});var d=a.indices;f(d)&&d>g&&a.indices--})});b.skin(a,function(a){f(a.inverseBindMatrices)&&a.inverseBindMatrices>g&&a.inverseBindMatrices--});b.animation(a,function(a){b.animationSampler(a,function(a){f(a.input)&&a.input>g&&a.input--;f(a.output)&&a.output>g&&a.output--})})};g.buffer=function(a,g){a.buffers.splice(g,1);b.bufferView(a,function(a){f(a.buffer)&&a.buffer>g&&a.buffer--})};g.bufferView=function(e,g){e.bufferViews.splice(g,1);b.accessor(e,function(a){f(a.bufferView)&&a.bufferView>g&&a.bufferView--});b.shader(e,function(a){f(a.bufferView)&&a.bufferView>g&&a.bufferView--});b.image(e,function(a){f(a.bufferView)&&a.bufferView>g&&a.bufferView--;b.compressedImage(a,function(a){var b=a.bufferView;f(b)&&b>g&&a.bufferView--})});a(e,"KHR_draco_mesh_compression")&&b.mesh(e,function(a){b.meshPrimitive(a,function(a){f(a.extensions)&&f(a.extensions.KHR_draco_mesh_compression)&&a.extensions.KHR_draco_mesh_compression.bufferView>g&&a.extensions.KHR_draco_mesh_compression.bufferView--})})};l.accessor=function(a){var e={};b.mesh(a,function(a){b.meshPrimitive(a,function(a){b.meshPrimitiveAttribute(a,function(a){e[a]=!0});b.meshPrimitiveTarget(a,function(a){b.meshPrimitiveTargetAttribute(a,function(a){e[a]=!0})});a=a.indices;f(a)&&(e[a]=!0)})});b.skin(a,function(a){f(a.inverseBindMatrices)&&(e[a.inverseBindMatrices]=!0)});b.animation(a,function(a){b.animationSampler(a,function(a){f(a.input)&&(e[a.input]=!0);f(a.output)&&(e[a.output]=!0)})});return e};l.buffer=function(a){var e={};b.bufferView(a,function(a){f(a.buffer)&&(e[a.buffer]=!0)});return e};l.bufferView=function(e){var g={};b.accessor(e,function(a){f(a.bufferView)&&(g[a.bufferView]=!0)});b.shader(e,function(a){f(a.bufferView)&&(g[a.bufferView]=!0)});b.image(e,function(a){f(a.bufferView)&&(g[a.bufferView]=!0);b.compressedImage(a,function(a){f(a.bufferView)&&(g[a.bufferView]=!0)})});a(e,"KHR_draco_mesh_compression")&&b.mesh(e,function(a){b.meshPrimitive(a,function(a){f(a.extensions)&&f(a.extensions.KHR_draco_mesh_compression)&&(g[a.extensions.KHR_draco_mesh_compression.bufferView]=!0)})});return g};return function(a){k(a,"accessor");k(a,"bufferView");k(a,"buffer");return a}});F("ThirdParty/GltfPipeline/addBuffer",["./addToArray"],function(b){return function(a,f){var k={buffer:b(a.buffers,{byteLength:f.length,extras:{_pipeline:{source:f}}}),byteOffset:0,byteLength:f.length};return b(a.bufferViews,k)}});F("ThirdParty/GltfPipeline/readAccessorPacked","./getAccessorByteStride ./getComponentReader ./numberOfComponentsForType ../../Core/arrayFill ../../Core/ComponentDatatype ../../Core/defined".split(" "),function(b,a,f,k,g,l){return function(m,e){var h=b(m,e),p=g.getSizeInBytes(e.componentType),d=f(e.type),q=e.count,t=Array(d*q);if(!l(e.bufferView))return k(t,0),t;for(var r=m.bufferViews[e.bufferView],c=m.buffers[r.buffer].extras._pipeline.source,r=e.byteOffset+r.byteOffset+c.byteOffset,c=new DataView(c.buffer),u=Array(d),y=a(e.componentType),A=0;A<q;++A){y(c,r,d,p,u);for(var z=0;z<d;++z)t[A*d+z]=u[z];r+=h}return t}});F("ThirdParty/GltfPipeline/updateAccessorComponentTypes",["./addBuffer","./ForEach","./readAccessorPacked","../../Core/ComponentDatatype","../../Core/WebGLConstants"],function(b,a,f,k,g){function l(a,e,g){var h=k.createTypedArray(g,f(a,e)),h=new Uint8Array(h.buffer);e.bufferView=b(a,h);e.componentType=g;e.byteOffset=0}return function(b){var e;a.accessorWithSemantic(b,"JOINTS_0",function(a){a=b.accessors[a];e=a.componentType;e===g.BYTE?l(b,a,k.UNSIGNED_BYTE):e!==g.UNSIGNED_BYTE&&e!==g.UNSIGNED_SHORT&&l(b,a,k.UNSIGNED_SHORT)});a.accessorWithSemantic(b,"WEIGHTS_0",function(a){a=b.accessors[a];e=a.componentType;e===g.BYTE?l(b,a,k.UNSIGNED_BYTE):e===g.SHORT&&l(b,a,k.UNSIGNED_SHORT)});return b}});F("ThirdParty/GltfPipeline/updateVersion","./addExtensionsUsed ./addToArray ./findAccessorMinMax ./ForEach ./getAccessorByteStride ./numberOfComponentsForType ./moveTechniqueRenderStates ./moveTechniquesToExtension ./removeUnusedElements ./updateAccessorComponentTypes ../../Core/Cartesian3 ../../Core/Cartesian4 ../../Core/clone ../../Core/ComponentDatatype ../../Core/defaultValue ../../Core/defined ../../Core/isArray ../../Core/Matrix4 ../../Core/Quaternion ../../Core/WebGLConstants".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(a){a=a.materials;for(var b in a)if(a.hasOwnProperty(b)){var c=a[b],d=c.instanceTechnique;u(d)&&(c.technique=d.technique,c.values=d.values,delete c.instanceTechnique)}}function v(a,b){var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var e=a[d];b[d]=c.length;c.push(e);u(e.name)||(e.name=d)}return c}function B(b){var c,d={accessors:{},animations:{},buffers:{},bufferViews:{},cameras:{},images:{},materials:{},meshes:{},nodes:{},programs:{},samplers:{},scenes:{},shaders:{},skins:{},textures:{},techniques:{}},e,f={},g=b.nodes,h;for(h in g)g.hasOwnProperty(h)&&(e=g[h].jointName,u(e)&&(f[e]=h));for(var l in b)b.hasOwnProperty(l)&&u(d[l])&&(g={},b[l]=v(b[l],g),d[l]=g);for(e in f)f.hasOwnProperty(e)&&(f[e]=d.nodes[f[e]]);u(b.scene)&&(b.scene=d.scenes[b.scene]);k.bufferView(b,function(a){u(a.buffer)&&(a.buffer=d.buffers[a.buffer])});k.accessor(b,function(a){u(a.bufferView)&&(a.bufferView=d.bufferViews[a.bufferView])});k.shader(b,function(a){var b=a.extensions;if(u(b)){var c=b.KHR_binary_glTF;u(c)&&(a.bufferView=d.bufferViews[c.bufferView],delete b.KHR_binary_glTF);0===Object.keys(b).length&&delete a.extensions}});k.program(b,function(a){u(a.vertexShader)&&(a.vertexShader=d.shaders[a.vertexShader]);u(a.fragmentShader)&&(a.fragmentShader=d.shaders[a.fragmentShader])});k.technique(b,function(a){u(a.program)&&(a.program=d.programs[a.program]);k.techniqueParameter(a,function(a){u(a.node)&&(a.node=d.nodes[a.node]);var b=a.value;"string"===typeof b&&(a.value={index:d.textures[b]})})});k.mesh(b,function(a){k.meshPrimitive(a,function(a){u(a.indices)&&(a.indices=d.accessors[a.indices]);k.meshPrimitiveAttribute(a,function(b,c){a.attributes[c]=d.accessors[b]});u(a.material)&&(a.material=d.materials[a.material])})});k.node(b,function(e){var f=e.children;if(u(f)){var g=f.length;for(c=0;c<g;++c)f[c]=d.nodes[f[c]]}if(u(e.meshes)){var g=e.meshes,h=g.length;if(0<h)for(e.mesh=d.meshes[g[0]],c=1;c<h;++c){var k=a(b.nodes,{mesh:d.meshes[g[c]]});u(f)||(f=[],e.children=f);f.push(k)}delete e.meshes}u(e.camera)&&(e.camera=d.cameras[e.camera]);u(e.skin)&&(e.skin=d.skins[e.skin]);u(e.skeletons)&&(f=e.skeletons,0<f.length&&u(e.skin)&&(b.skins[e.skin].skeleton=d.nodes[f[0]]),delete e.skeletons);u(e.jointName)&&delete e.jointName});k.skin(b,function(a){u(a.inverseBindMatrices)&&(a.inverseBindMatrices=d.accessors[a.inverseBindMatrices]);var b=a.jointNames;if(u(b)){var e=[],g=b.length;for(c=0;c<g;++c)e[c]=f[b[c]];a.joints=e;delete a.jointNames}});k.scene(b,function(a){a=a.nodes;if(u(a)){var b=a.length;for(c=0;c<b;++c)a[c]=d.nodes[a[c]]}});k.animation(b,function(a){var b={};a.samplers=v(a.samplers,b);k.animationSampler(a,function(a){a.input=d.accessors[a.input];a.output=d.accessors[a.output]});k.animationChannel(a,function(a){a.sampler=b[a.sampler];a=a.target;u(a)&&(a.node=d.nodes[a.id],delete a.id)})});k.material(b,function(a){u(a.technique)&&(a.technique=d.techniques[a.technique]);k.materialValue(a,function(b,c){"string"===typeof b&&(a.values[c]={index:d.textures[b]})});var b=a.extensions;if(u(b)){var c=b.KHR_materials_common;u(c)&&k.materialValue(c,function(a,b){"string"===typeof a&&(c.values[b]={index:d.textures[a]})})}});k.image(b,function(a){var b=a.extensions;if(u(b)){var c=b.KHR_binary_glTF;u(c)&&(a.bufferView=d.bufferViews[c.bufferView],a.mimeType=c.mimeType,delete b.KHR_binary_glTF);0===Object.keys(b).length&&delete a.extensions}k.compressedImage(a,function(a){var c=a.extensions;if(u(c)){var e=c.KHR_binary_glTF;u(e)&&(a.bufferView=d.bufferViews[e.bufferView],a.mimeType=e.mimeType,delete c.KHR_binary_glTF);0===Object.keys(b).length&&delete a.extensions}})});k.texture(b,function(a){u(a.sampler)&&(a.sampler=d.samplers[a.sampler]);u(a.source)&&(a.source=d.images[a.source])})}function C(a){k.animation(a,function(a){k.animationSampler(a,function(a){delete a.name})})}function I(a){for(var b in a)if(a.hasOwnProperty(b)){var c=a[b];y(c)&&0===c.length&&delete a[b]}k.node(a,function(a){u(a.children)&&0===a.children.length&&delete a.children})}function H(a){k.buffer(a,function(a){delete a.type})}function J(a){k.texture(a,function(a){delete a.format;delete a.internalFormat;delete a.target;delete a.type})}function w(a){k.mesh(a,function(a){k.meshPrimitive(a,function(a){k.meshPrimitiveAttribute(a,function(b,c){"TEXCOORD"===c?a.attributes.TEXCOORD_0=b:"COLOR"===c&&(a.attributes.COLOR_0=b)});delete a.attributes.TEXCOORD;delete a.attributes.COLOR})});k.technique(a,function(a){k.techniqueParameter(a,function(a){var b=a.semantic;u(b)&&("TEXCOORD"===b?a.semantic="TEXCOORD_0":"COLOR"===b&&(a.semantic="COLOR_0"))})})}function G(a){var b={};k.mesh(a,function(a){k.meshPrimitive(a,function(a){k.meshPrimitiveAttribute(a,function(a,c){if("_"!==c.charAt(0)){var d=c.search(/_[0-9]+/g),e=c,f="_0";0<=d&&(e=c.substring(0,d),f=c.substring(d));d=Y[e];u(d)?b[c]=d+f:u(R[e])||(b[c]="_"+c)}});for(var c in b)if(b.hasOwnProperty(c)){var d=b[c],e=a.attributes[c];u(e)&&(delete a.attributes[c],a.attributes[d]=e)}})});k.technique(a,function(a){k.techniqueParameter(a,function(a){var c=b[a.semantic];u(c)&&(a.semantic=c)})})}function E(a){k.camera(a,function(a){a=a.perspective;if(u(a)){var b=a.aspectRatio;u(b)&&0===b&&delete a.aspectRatio;b=a.yfov;u(b)&&0===b&&(a.yfov=1)}})}function L(a,b){return u(b.byteStride)&&0!==b.byteStride?b.byteStride:g(a,b)}function K(a){k.buffer(a,function(a){u(a.byteLength)||(a.byteLength=a.extras._pipeline.source.length)});k.accessor(a,function(b){var d=b.bufferView;if(u(d)){var d=a.bufferViews[d],e=L(a,b);b=b.byteOffset+b.count*e;d.byteLength=Math.max(c(d.byteLength,0),b)}})}function P(b){var d,e,f,g=b.bufferViews,l={};k.accessorContainingVertexAttributeData(b,function(a){a=b.accessors[a];u(a.bufferView)&&(l[a.bufferView]=!0)});var m={};k.accessor(b,function(a){u(a.bufferView)&&(m[a.bufferView]=c(m[a.bufferView],[]),m[a.bufferView].push(a))});for(var p in m)if(m.hasOwnProperty(p)){f=g[p];var q=m[p];q.sort(function(a,b){return a.byteOffset-b.byteOffset});var r=0;e=0;var w=q.length;for(d=0;d<w;++d){var v=q[d],z=L(b,v),E=v.byteOffset,y=v.count*z;delete v.byteStride;var A=d<w-1,v=A?L(b,q[d+1]):void 0;if(z!==v){v=t(f,!0);l[p]&&(v.byteStride=z);v.byteOffset+=r;v.byteLength=E+y-r;for(z=a(g,v);e<=d;++e)v=q[e],v.bufferView=z,v.byteOffset-=r;r=A?q[d+1].byteOffset:void 0;e=d+1}}}h(b)}function N(a){k.accessorWithSemantic(a,"POSITION",function(b){b=a.accessors[b];if(!u(b.min)||!u(b.max)){var c=f(a,b);b.min=c.min;b.max=c.max}})}function O(a){return(!u(a.children)||0===a.children.length)&&(!u(a.meshes)||0===a.meshes.length)&&!u(a.camera)&&!u(a.skin)&&!u(a.skeletons)&&!u(a.jointName)&&(!u(a.translation)||d.fromArray(a.translation).equals(d.ZERO))&&(!u(a.scale)||d.fromArray(a.scale).equals(new d(1,1,1)))&&(!u(a.rotation)||q.fromArray(a.rotation).equals(new q(0,0,0,1)))&&(!u(a.matrix)||A.fromColumnMajorArray(a.matrix).equals(A.IDENTITY))&&!u(a.extensions)&&!u(a.extras)}function Z(a,b){k.scene(a,function(a){a=a.nodes;if(u(a))for(var c=a.length;0<=c;--c)if(a[c]===b){a.splice(c,1);break}});k.node(a,function(c,d){if(u(c.children)){var e=c.children.indexOf(b);-1<e&&(c.children.splice(e,1),O(c)&&Z(a,d))}});delete a.nodes[b]}function aa(a){k.node(a,function(b,c){O(b)&&Z(a,c)});return a}function U(a){k.animation(a,function(b){k.animationSampler(b,function(b){b=a.accessors[b.input];if(!u(b.min)||!u(b.max)){var c=f(a,b);b.min=c.min;b.max=c.max}})})}var W={"0.8":function(a){u(a.asset)||(a.asset={});var e=a.asset;e.version="1.0";if("string"===typeof e.profile){var f=e.profile.split(" ");e.profile={api:f[0],version:f[1]}}else e.profile={};u(a.version)&&delete a.version;D(a);var e=a.meshes,g;for(g in e)if(e.hasOwnProperty(g)&&(f=e[g].primitives,u(f)))for(var h=f.length,k=0;k<h;++k){var m=f[k],p=c(m.primitive,x.TRIANGLES);m.mode=c(m.mode,p);delete m.primitive}g=a.nodes;var e=new d,f=new z,q;for(q in g)g.hasOwnProperty(q)&&(h=g[q],u(h.rotation)&&(k=h.rotation,d.fromArray(k,0,e),z.fromAxisAngle(e,k[3],f),h.rotation=[f.x,f.y,f.z,f.w]),k=h.instanceSkin,u(k)&&(h.skeletons=k.skeletons,h.skin=k.skin,h.meshes=k.meshes,delete h.instanceSkin));q=a.animations;g=a.accessors;var e=a.bufferViews,f=a.buffers,h={},k=new d,m=new z,w;for(w in q)if(q.hasOwnProperty(w)){var t=q[w],p=t.channels,v=t.parameters,t=t.samplers;if(u(p))for(var E=p.length,y=0;y<E;++y){var A=p[y];if("rotation"===A.target.path&&(A=v[t[A.sampler].output],!u(h[A]))){h[A]=!0;for(var B=g[A],A=e[B.bufferView],C=f[A.buffer].extras._pipeline.source,G=C.byteOffset+A.byteOffset+B.byteOffset,L=B.componentType,A=B.count,K=l(B.type),B=r.createArrayBufferView(L,C.buffer,G,B.count*K),C=0;C<A;C++)G=C*K,d.unpack(B,G,k),z.fromAxisAngle(k,B[G+3],m),z.pack(m,B,G)}}}w=a.techniques;for(var H in w)w.hasOwnProperty(H)&&(q=w[H],g=q.passes,u(g)&&(e=c(q.pass,"defaultPass"),g.hasOwnProperty(e)&&(g=g[e],e=g.instanceProgram,q.attributes=c(q.attributes,e.attributes),q.program=c(q.program,e.program),q.uniforms=c(q.uniforms,e.uniforms),q.states=c(q.states,g.states)),delete q.passes,delete q.pass));u(a.allExtensions)&&(a.extensionsUsed=a.allExtensions,delete a.allExtensions);u(a.lights)&&(H=c(a.extensions,{}),a.extensions=H,w=c(H.KHR_materials_common,{}),H.KHR_materials_common=w,w.lights=a.lights,delete a.lights,b(a,"KHR_materials_common"))},"1.0":function(a){a.asset=c(a.asset,{});a.asset.version="2.0";D(a);var b=a.animations,d;for(d in b)if(b.hasOwnProperty(d)){var f=b[d],g=f.parameters;if(u(g)){var h=f.samplers,k;for(k in h)if(h.hasOwnProperty(k)){var l=h[k];l.input=g[l.input];l.output=g[l.output]}delete f.parameters}}aa(a);B(a);C(a);b=a.asset;delete b.profile;delete b.premultipliedAlpha;b=a.extensionsUsed;a.extensionsRequired=c(a.extensionsRequired,[]);if(u(b))for(d=b.length,f=0;f<d;++f)g=b[f],u(M[g])&&a.extensionsRequired.push(g);K(a);P(a);N(a);U(a);H(a);J(a);w(a);G(a);p(a);E(a);m(a);e(a);I(a)},"2.0":void 0},M={CESIUM_RTC:!0,KHR_materials_common:!0,WEB3D_quantized_attributes:!0},R={POSITION:!0,NORMAL:!0,TANGENT:!0},Y={COLOR:"COLOR",JOINT:"JOINTS",JOINTS:"JOINTS",TEXCOORD:"TEXCOORD",WEIGHT:"WEIGHTS",WEIGHTS:"WEIGHTS"};return function(a,b){b=c(b,c.EMPTY_OBJECT);var d=b.targetVersion,e=a.version;a.asset=c(a.asset,{version:"1.0"});a.asset.version=c(a.asset.version,"1.0");e=c(e,a.asset.version).toString();W.hasOwnProperty(e)||(u(e)&&(e=e.substring(0,3)),W.hasOwnProperty(e)||(e="1.0"));for(var f=W[e];u(f)&&e!==d;)f(a,b),e=a.asset.version,f=W[e];return a}});F("Scene/Axis",["../Core/Check","../Core/freezeObject","../Core/Math","../Core/Matrix3","../Core/Matrix4"],function(b,a,f,k,g){var l={X:0,Y:1,Z:2,Y_UP_TO_Z_UP:g.fromRotationTranslation(k.fromRotationX(f.PI_OVER_TWO)),Z_UP_TO_Y_UP:g.fromRotationTranslation(k.fromRotationX(-f.PI_OVER_TWO)),X_UP_TO_Z_UP:g.fromRotationTranslation(k.fromRotationY(-f.PI_OVER_TWO)),Z_UP_TO_X_UP:g.fromRotationTranslation(k.fromRotationY(f.PI_OVER_TWO)),X_UP_TO_Y_UP:g.fromRotationTranslation(k.fromRotationZ(f.PI_OVER_TWO)),Y_UP_TO_X_UP:g.fromRotationTranslation(k.fromRotationZ(-f.PI_OVER_TWO)),fromName:function(a){b.typeOf.string("name",a);return l[a]}};return a(l)});F("Scene/ClippingPlane",["../Core/Cartesian3","../Core/Check","../Core/defined","../Core/defineProperties"],function(b,a,f,k){function g(b,e){a.typeOf.object("normal",b);a.typeOf.number("distance",e);this._distance=e;this._normal=new l(b,this);this.onChangeCallback=void 0;this.index=-1}function l(a,e){this._clippingPlane=e;this._cartesian3=b.clone(a)}k(g.prototype,{distance:{get:function(){return this._distance},set:function(b){a.typeOf.number("value",b);if(f(this.onChangeCallback)&&b!==this._distance)this.onChangeCallback(this.index);this._distance=b}},normal:{get:function(){return this._normal},set:function(g){a.typeOf.object("value",g);if(f(this.onChangeCallback)&&!b.equals(this._normal._cartesian3,g))this.onChangeCallback(this.index);b.clone(g,this._normal._cartesian3)}}});g.fromPlane=function(b,e){a.typeOf.object("plane",b);f(e)?(e.normal=b.normal,e.distance=b.distance):e=new g(b.normal,b.distance);return e};g.clone=function(a,b){if(!f(b))return new g(a.normal,a.distance);b.normal=a.normal;b.distance=a.distance;return b};k(l.prototype,{x:{get:function(){return this._cartesian3.x},set:function(b){a.typeOf.number("value",b);if(f(this._clippingPlane.onChangeCallback)&&b!==this._cartesian3.x)this._clippingPlane.onChangeCallback(this._clippingPlane.index);this._cartesian3.x=b}},y:{get:function(){return this._cartesian3.y},set:function(b){a.typeOf.number("value",b);if(f(this._clippingPlane.onChangeCallback)&&b!==this._cartesian3.y)this._clippingPlane.onChangeCallback(this._clippingPlane.index);this._cartesian3.y=b}},z:{get:function(){return this._cartesian3.z},set:function(b){a.typeOf.number("value",b);if(f(this._clippingPlane.onChangeCallback)&&b!==this._cartesian3.z)this._clippingPlane.onChangeCallback(this._clippingPlane.index);this._cartesian3.z=b}}});return g});F("Scene/ClippingPlaneCollection","../Core/AttributeCompression ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Check ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/DeveloperError ../Core/Event ../Core/Intersect ../Core/Matrix4 ../Core/PixelFormat ../Core/Plane ../Renderer/ContextLimits ../Renderer/PixelDatatype ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ./ClippingPlane".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I){function H(a){a=m(a,m.EMPTY_OBJECT);this._planes=[];this._dirtyIndex=-1;this._multipleDirtyPlanes=!1;this._enabled=m(a.enabled,!0);this.modelMatrix=c.clone(m(a.modelMatrix,c.IDENTITY));this.edgeColor=l.clone(m(a.edgeColor,l.WHITE));this.edgeWidth=m(a.edgeWidth,0);this.planeAdded=new t;this.planeRemoved=new t;this._owner=void 0;var b=m(a.unionClippingRegions,!1);this._testIntersection=(this._unionClippingRegions=b)?J:w;this._clippingPlanesTexture=this._float32View=this._uint8View=void 0;a=a.planes;if(e(a))for(var b=a.length,d=0;d<b;++d)this.add(a[d])}function J(a){return a===r.OUTSIDE}function w(a){return a===r.INSIDE}function G(a,b){a._multipleDirtyPlanes=a._multipleDirtyPlanes||-1!==a._dirtyIndex&&a._dirtyIndex!==b;a._dirtyIndex=b}function E(a,b){for(var c=a.length,d=0;d<c;++d)if(y.equals(a[d],b))return d;return-1}function L(a,c,d){var e=a._uint8View;a=a._planes;for(var f=0;c<d;++c){var g=a[c],h=b.octEncodeToCartesian4(g.normal,O);e[f]=h.x;e[f+1]=h.y;e[f+2]=h.z;e[f+3]=h.w;g=k.packFloat(g.distance,N);e[f+4]=g.x;e[f+5]=g.y;e[f+6]=g.z;e[f+7]=g.w;f+=8}}function K(a,b,c){var d=a._float32View;a=a._planes;for(var e=0;b<c;++b){var f=a[b],g=f.normal;d[e]=g.x;d[e+1]=g.y;d[e+2]=g.z;d[e+3]=f.distance;e+=4}}function P(a,b){b.x=Math.min(a,A.maximumTextureSize);b.y=Math.ceil(a/b.x);return b}h(H.prototype,{length:{get:function(){return this._planes.length}},unionClippingRegions:{get:function(){return this._unionClippingRegions},set:function(a){this._unionClippingRegions!==a&&(this._testIntersection=(this._unionClippingRegions=a)?J:w)}},enabled:{get:function(){return this._enabled},set:function(a){this._enabled!==a&&(this._enabled=a)}},texture:{get:function(){return this._clippingPlanesTexture}},owner:{get:function(){return this._owner}},clippingPlanesState:{get:function(){return this._unionClippingRegions?this._planes.length:-this._planes.length}}});H.prototype.add=function(a){var b=this._planes.length,c=this;a.onChangeCallback=function(a){G(c,a)};a.index=b;G(this,b);this._planes.push(a);this.planeAdded.raiseEvent(a,b)};H.prototype.get=function(a){g.typeOf.number("index",a);return this._planes[a]};H.prototype.contains=function(a){return-1!==E(this._planes,a)};H.prototype.remove=function(a){var b=this._planes,c=E(b,a);if(-1===c)return!1;a instanceof I&&(a.onChangeCallback=void 0,a.index=-1);for(var d=b.length-1,e=c;e<d;++e){var f=b[e+1];b[e]=f;f instanceof I&&(f.index=e)}this._multipleDirtyPlanes=!0;b.length=d;this.planeRemoved.raiseEvent(a,c);return!0};H.prototype.removeAll=function(){for(var a=this._planes,b=a.length,c=0;c<b;++c){var d=a[c];d instanceof I&&(d.onChangeCallback=void 0,d.index=-1);this.planeRemoved.raiseEvent(d,c)}this._multipleDirtyPlanes=!0;this._planes=[]};var N=new k,O=new k,Z=new a;H.prototype.update=function(a){var b=this._clippingPlanesTexture,c=a.context,d=(a=H.useFloatTexture(c))?this.length:2*this.length;if(e(b)){var f=b.width*b.height;if(f<d||d<.25*f)b.destroy(),this._clippingPlanesTexture=b=void 0}0!==this.length&&(e(b)||(d=P(d,Z),d.y*=2,b=new x({wrapS:C.CLAMP_TO_EDGE,wrapT:C.CLAMP_TO_EDGE,minificationFilter:B.NEAREST,magnificationFilter:v.NEAREST}),a?(b=new D({context:c,width:d.x,height:d.y,pixelFormat:u.RGBA,pixelDatatype:z.FLOAT,sampler:b,flipY:!1}),this._float32View=new Float32Array(d.x*d.y*4)):(b=new D({context:c,width:d.x,height:d.y,pixelFormat:u.RGBA,pixelDatatype:z.UNSIGNED_BYTE,sampler:b,flipY:!1}),this._uint8View=new Uint8Array(d.x*d.y*4)),this._clippingPlanesTexture=b,this._multipleDirtyPlanes=!0),c=this._dirtyIndex,this._multipleDirtyPlanes||-1!==c)&&(this._multipleDirtyPlanes?a?(K(this,0,this._planes.length),b.copyFrom({width:b.width,height:b.height,arrayBufferView:this._float32View})):(L(this,0,this._planes.length),b.copyFrom({width:b.width,height:b.height,arrayBufferView:this._uint8View})):a?(d=Math.floor(c/b.width),a=Math.floor(c-d*b.width),K(this,c,c+1),b.copyFrom({width:1,height:1,arrayBufferView:this._float32View},a,d)):(d=Math.floor(2*c/b.width),a=Math.floor(2*c-d*b.width),L(this,c,c+1),b.copyFrom({width:2,height:1,arrayBufferView:this._uint8View},a,d)),this._multipleDirtyPlanes=!1,this._dirtyIndex=-1)};var aa=new c,U=new y(f.UNIT_X,0);H.prototype.computeIntersectionWithBoundingVolume=function(a,b){var d=this._planes,f=d.length,g=this.modelMatrix;e(b)&&(g=c.multiply(b,g,aa));var h=r.INSIDE;!this.unionClippingRegions&&0<f&&(h=r.OUTSIDE);for(var k=0;k<f;++k){y.transform(d[k],g,U);var l=a.intersectPlane(U);if(l===r.INTERSECTING)h=l;else if(this._testIntersection(l))return l}return h};H.setOwner=function(a,b,c){if(a!==b[c]&&(b[c]=b[c]&&b[c].destroy(),e(a))){if(e(a._owner))throw new q("ClippingPlaneCollection should only be assigned to one object");a._owner=b;b[c]=a}};H.useFloatTexture=function(a){return a.floatingPointTexture};H.getTextureResolution=function(a,b,c){var d=a.texture;if(e(d))return c.x=d.width,c.y=d.height,c;a=H.useFloatTexture(b)?a.length:2*a.length;c=P(a,c);c.y*=2;return c};H.prototype.isDestroyed=function(){return!1};H.prototype.destroy=function(){this._clippingPlanesTexture=this._clippingPlanesTexture&&this._clippingPlanesTexture.destroy();return d(this)};return H});F("Scene/DracoLoader","../Core/arraySlice ../Core/ComponentDatatype ../Core/defined ../Core/FeatureDetection ../Core/TaskProcessor ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m){function e(){}function h(a,b){var d="runtime."+Object.keys(a.createdBufferViews).length,e=a.buffers,c=Object.keys(e).length;e[c]=b;a.createdBufferViews[d]={buffer:c,byteOffset:0,byteLength:b.byteLength};return d}function p(b,g,k,l){if(e._taskProcessorReady){var c=k.primitivesToDecode.peek();if(f(c)&&(b=b.scheduleTask(c,[c.array.buffer]),f(b)))return k.activeDecodingTasks++,k.primitivesToDecode.dequeue(),b.then(function(b){var d;k.activeDecodingTasks--;d=b.indexArray;var e=d.typedArray,f=g._loadResources,l=h(f,e);f.indexBuffersToCreate.enqueue({id:l,componentType:a.fromTypedArray(e)});d=d.numberOfIndices;e={};b=b.attributeData;for(var m in b)if(b.hasOwnProperty(m)){var p=b[m],q=g._loadResources,f=h(q,p.array);q.vertexBuffersToCreate.enqueue(f);p=p.data;p.bufferView=f;e[m]=p}g._decodedData[c.mesh+".primitive."+c.primitive]={bufferView:l,numberOfIndices:d,attributes:e}})}}e._maxDecodingConcurrency=Math.max(k.hardwareConcurrency-1,1);e._decoderTaskProcessor=void 0;e._taskProcessorReady=!1;e._getDecoderTaskProcessor=function(){if(!f(e._decoderTaskProcessor)){var a=new g("decodeDraco",e._maxDecodingConcurrency);a.initWebAssemblyModule({modulePath:"ThirdParty/Workers/draco_wasm_wrapper.js",wasmBinaryFile:"ThirdParty/draco_decoder.wasm",fallbackModulePath:"ThirdParty/Workers/draco_decoder.js"}).then(function(){e._taskProcessorReady=!0});e._decoderTaskProcessor=a}return e._decoderTaskProcessor};e.hasExtension=function(a){return f(a.extensionsRequired.KHR_draco_mesh_compression)||f(a.extensionsUsed.KHR_draco_mesh_compression)};e._decodedModelResourceCache=void 0;e.parse=function(a,g){if(e.hasExtension(a)){var d=a._loadResources,h=a.cacheKey;if(f(h)&&(f(e._decodedModelResourceCache)||(f(g.cache.modelDecodingCache)||(g.cache.modelDecodingCache={}),e._decodedModelResourceCache=g.cache.modelDecodingCache),h=e._decodedModelResourceCache[h],f(h))){h.count++;d.pendingDecodingCache=!0;return}var c=a._dequantizeInShader,k=a.gltf;l.mesh(k,function(a,e){l.meshPrimitive(a,function(a,g){if(f(a.extensions)){var h=a.extensions.KHR_draco_mesh_compression;if(f(h)){var l=k.bufferViews[h.bufferView],m=b(k.buffers[l.buffer].extras._pipeline.source,l.byteOffset,l.byteOffset+l.byteLength);d.primitivesToDecode.enqueue({mesh:e,primitive:g,array:m,bufferView:l,compressedAttributes:h.attributes,dequantizeInShader:c})}}})})}};e.decodeModel=function(a,b){if(!e.hasExtension(a))return m.resolve();var d=a._loadResources,g=a.cacheKey;if(f(g)&&f(e._decodedModelResourceCache)){var c=e._decodedModelResourceCache[g];if(f(c)&&d.pendingDecodingCache)return m(c.ready,function(){a._decodedData=c.data;d.pendingDecodingCache=!1});e._decodedModelResourceCache[g]={ready:!1,count:1,data:void 0}}if(0===d.primitivesToDecode.length)return m.resolve();for(var g=e._getDecoderTaskProcessor(),h=[],k=p(g,a,d,b);f(k);)h.push(k),k=p(g,a,d,b);return m.all(h)};e.decodePointCloud=function(a){var b=e._getDecoderTaskProcessor();if(e._taskProcessorReady)return b.scheduleTask(a,[a.buffer.buffer])};e.cacheDataForModel=function(a){var b=a.cacheKey;f(b)&&f(e._decodedModelResourceCache)&&(b=e._decodedModelResourceCache[b],f(b)&&(b.ready=!0,b.data=a._decodedData))};e.destroyCachedDataForModel=function(a){a=a.cacheKey;if(f(a)&&f(e._decodedModelResourceCache)){var b=e._decodedModelResourceCache[a];f(b)&&0===--b.count&&delete e._decodedModelResourceCache[a]}};return e});F("Scene/getClipAndStyleCode",["../Core/Check"],function(b){return function(a,f,k){b.typeOf.string("samplerUniformName",a);b.typeOf.string("matrixUniformName",f);b.typeOf.string("styleUniformName",k);return"    float clipDistance \x3d clip(gl_FragCoord, "+a+", "+f+"); \n    vec4 clippingPlanesEdgeColor \x3d vec4(1.0); \n    clippingPlanesEdgeColor.rgb \x3d "+k+".rgb; \n    float clippingPlanesEdgeWidth \x3d "+k+".a; \n    if (clipDistance \x3e 0.0 \x26\x26 clipDistance \x3c clippingPlanesEdgeWidth) \n    { \n        gl_FragColor \x3d clippingPlanesEdgeColor;\n    } \n"}});F("Scene/getClippingFunction",["../Core/Cartesian2","../Core/Check","../Renderer/PixelDatatype","./ClippingPlaneCollection"],function(b,a,f,k){var g=new b;return function(b,f){a.typeOf.object("clippingPlaneCollection",b);a.typeOf.object("context",f);var e=b.unionClippingRegions,h=b.length,l=k.useFloatTexture(f),d=k.getTextureResolution(b,f,g),m=d.x,d=d.y;l?(d=1/d,l=1/m+"",-1===l.indexOf(".")&&(l+=".0"),d+="",-1===d.indexOf(".")&&(d+=".0"),m="vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int pixY \x3d clippingPlaneNumber / "+m+";\n    int pixX \x3d clippingPlaneNumber - (pixY * "+m+");\n    float u \x3d (float(pixX) + 0.5) * "+l+";\n    float v \x3d (float(pixY) + 0.5) * "+d+";\n    vec4 plane \x3d texture2D(packedClippingPlanes, vec2(u, v));\n    return czm_transformPlane(plane, transform);\n}\n"):(d=1/d,l=1/m+"",-1===l.indexOf(".")&&(l+=".0"),d+="",-1===d.indexOf(".")&&(d+=".0"),m="vec4 getClippingPlane(sampler2D packedClippingPlanes, int clippingPlaneNumber, mat4 transform)\n{\n    int clippingPlaneStartIndex \x3d clippingPlaneNumber * 2;\n    int pixY \x3d clippingPlaneStartIndex / "+m+";\n    int pixX \x3d clippingPlaneStartIndex - (pixY * "+m+");\n    float u \x3d (float(pixX) + 0.5) * "+l+";\n    float v \x3d (float(pixY) + 0.5) * "+d+";\n    vec4 oct32 \x3d texture2D(packedClippingPlanes, vec2(u, v)) * 255.0;\n    vec2 oct \x3d vec2(oct32.x * 256.0 + oct32.y, oct32.z * 256.0 + oct32.w);\n    vec4 plane;\n    plane.xyz \x3d czm_octDecode(oct, 65535.0);\n    plane.w \x3d czm_unpackFloat(texture2D(packedClippingPlanes, vec2(u + "+l+", v)));\n    return czm_transformPlane(plane, transform);\n}\n");return e=m+"\n"+(e?"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    vec4 position \x3d czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal \x3d vec3(0.0);\n    vec3 clipPosition \x3d vec3(0.0);\n    float clipAmount;\n    float pixelWidth \x3d czm_metersPerPixel(position);\n    bool breakAndDiscard \x3d false;\n    for (int i \x3d 0; i \x3c "+h+"; ++i)\n    {\n        vec4 clippingPlane \x3d getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal \x3d clippingPlane.xyz;\n        clipPosition \x3d -clippingPlane.w * clipNormal;\n        float amount \x3d dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount \x3d czm_branchFreeTernary(i \x3d\x3d 0, amount, min(amount, clipAmount));\n        if (amount \x3c\x3d 0.0)\n        {\n           breakAndDiscard \x3d true;\n           break;\n        }\n    }\n    if (breakAndDiscard) {\n        discard;\n    }\n    return clipAmount;\n}\n":"float clip(vec4 fragCoord, sampler2D clippingPlanes, mat4 clippingPlanesMatrix)\n{\n    bool clipped \x3d true;\n    vec4 position \x3d czm_windowToEyeCoordinates(fragCoord);\n    vec3 clipNormal \x3d vec3(0.0);\n    vec3 clipPosition \x3d vec3(0.0);\n    float clipAmount \x3d 0.0;\n    float pixelWidth \x3d czm_metersPerPixel(position);\n    for (int i \x3d 0; i \x3c "+h+"; ++i)\n    {\n        vec4 clippingPlane \x3d getClippingPlane(clippingPlanes, i, clippingPlanesMatrix);\n        clipNormal \x3d clippingPlane.xyz;\n        clipPosition \x3d -clippingPlane.w * clipNormal;\n        float amount \x3d dot(clipNormal, (position.xyz - clipPosition)) / pixelWidth;\n        clipAmount \x3d max(amount, clipAmount);\n        clipped \x3d clipped \x26\x26 (amount \x3c\x3d 0.0);\n    }\n    if (clipped)\n    {\n        discard;\n    }\n    return clipAmount;\n}\n")}});F("Scene/JobType",["../Core/freezeObject"],function(b){return b({TEXTURE:0,PROGRAM:1,BUFFER:2,NUMBER_OF_JOB_TYPES:3})});F("Scene/AttributeType",["../Core/freezeObject"],function(b){return b({SCALAR:"SCALAR",VEC2:"VEC2",VEC3:"VEC3",VEC4:"VEC4",MAT2:"MAT2",MAT3:"MAT3",MAT4:"MAT4"})});F("Scene/ModelAnimationCache","../Core/Cartesian3 ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/LinearSpline ../Core/Matrix4 ../Core/Quaternion ../Core/QuaternionSpline ../Core/WebGLConstants ../Core/WeightSpline ../ThirdParty/GltfPipeline/getAccessorByteStride ../ThirdParty/GltfPipeline/numberOfComponentsForType ./AttributeType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(){}function c(a,b){var c=a.gltf,d=c.bufferViews[b.bufferView],c=c.buffers[d.buffer],d=d.byteOffset+b.byteOffset,e=b.count*q(b.type),c=y.test(c.uri)?"":c.uri;return a.cacheKey+"//"+c+"/"+d+"/"+e}function u(a){this._value=a}var y=/^data\:/i,A={};r.getAnimationParameterValues=function(e,g){var h=c(e,g),l=A[h];if(!k(l)){for(var l=e.gltf,p=l.bufferViews[g.bufferView],r=l.buffers[p.buffer].extras._pipeline.source,t=g.componentType,w=g.type,u=q(w),v=g.count,z=d(l,g),l=Array(v),y=f(g.byteOffset,0),p=p.byteOffset+y,y=0;y<v;y++){var D=a.createArrayBufferView(t,r.buffer,r.byteOffset+p,u);"SCALAR"===w?l[y]=D[0]:"VEC3"===w?l[y]=b.fromArray(D):"VEC4"===w&&(l[y]=m.unpack(D));p+=z}k(e.cacheKey)&&(A[h]=l)}return l};var z={};u.prototype.evaluate=function(a,b){return this._value};u.prototype.wrapTime=function(a){return 0};u.prototype.clampTime=function(a){return 0};r.getAnimationSpline=function(a,b,c,d,f,h,l,m){b=a.cacheKey+"//"+b+"/"+d;c=z[b];k(c)||(1===h.length&&1===m.length?c=new u(m[0]):"LINEAR"===f.interpolation&&("translation"===l||"scale"===l?c=new g({times:h,points:m}):"rotation"===l?c=new e({times:h,points:m}):"weights"===l&&(c=new p({times:h,weights:m}))),k(a.cacheKey)&&(z[b]=c));return c};var x={};r.getSkinInverseBindMatrices=function(b,e){var f=c(b,e),g=x[f];if(!k(g)){var m=b.gltf,g=m.bufferViews[e.bufferView],p=m.buffers[g.buffer].extras._pipeline.source,r=e.componentType,w=e.type,u=e.count,m=d(m,e),v=g.byteOffset+e.byteOffset,z=q(w),g=Array(u);if(r===h.FLOAT&&w===t.MAT4)for(w=0;w<u;++w){var y=a.createArrayBufferView(r,p.buffer,p.byteOffset+v,z);g[w]=l.fromArray(y);v+=m}x[f]=g}return g};return r});F("Scene/ModelAnimationLoop",["../Core/freezeObject"],function(b){return b({NONE:0,REPEAT:1,MIRRORED_REPEAT:2})});F("Scene/ModelAnimationState",["../Core/freezeObject"],function(b){return b({STOPPED:0,ANIMATING:1})});F("Scene/ModelAnimation","../Core/defaultValue ../Core/defineProperties ../Core/defined ../Core/deprecationWarning ../Core/Event ../Core/JulianDate ./ModelAnimationLoop ./ModelAnimationState".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d,f){this._name=f.name;this._startTime=l.clone(a.startTime);this._delay=b(a.delay,0);this._stopTime=a.stopTime;this.removeOnStop=b(a.removeOnStop,!1);this._multiplier=b(a.multiplier,1);this._reverse=b(a.reverse,!1);this._loop=b(a.loop,m.NONE);this.start=new g;this.update=new g;this.stop=new g;this._state=e.STOPPED;this._runtimeAnimation=f;this._duration=this._computedStartTime=void 0;var h=this;this._raiseStartEvent=function(){h.start.raiseEvent(d,h)};this._updateEventTime=0;this._raiseUpdateEvent=function(){h.update.raiseEvent(d,h,h._updateEventTime)};this._raiseStopEvent=function(){h.stop.raiseEvent(d,h)}}a(h.prototype,{name:{get:function(){return this._name}},startTime:{get:function(){return this._startTime}},delay:{get:function(){return this._delay}},stopTime:{get:function(){return this._stopTime}},multiplier:{get:function(){return this._multiplier}},reverse:{get:function(){return this._reverse}},loop:{get:function(){return this._loop}}});return h});F("Scene/ModelAnimationCollection","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/DeveloperError ../Core/Event ../Core/JulianDate ../Core/Math ./ModelAnimation ./ModelAnimationLoop ./ModelAnimationState".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a){this.animationAdded=new l;this.animationRemoved=new l;this._model=a;this._scheduledAnimations=[];this._previousTime=void 0}function t(a,b,c){var d=a._model;b=new h(c,d,d._runtime.animations[b]);a._scheduledAnimations.push(b);a.animationAdded.raiseEvent(d,b);return b}function r(a,b,c){return function(){a.animationRemoved.raiseEvent(b,c)}}f(q.prototype,{length:{get:function(){return this._scheduledAnimations.length}}});q.prototype.add=function(c){c=b(c,b.EMPTY_OBJECT);var d=this._model._runtime.animations;if(!a(d))throw new g("Animations are not loaded.  Wait for Model.readyPromise to resolve.");if(!a(c.name)&&!a(c.index))throw new g("Either options.name or options.index must be defined.");if(a(c.multiplier)&&0>=c.multiplier)throw new g("options.multiplier must be greater than zero.");if(a(c.index)&&(c.index>=d.length||0>c.index))throw new g("options.index must be a valid animation index.");if(a(c.index))return t(this,c.index,c);for(var e,f=d.length,h=0;h<f;++h)if(d[h].name===c.name){e=h;break}if(!a(e))throw new g("options.name must be a valid animation name.");return t(this,e,c)};q.prototype.addAll=function(c){c=b(c,b.EMPTY_OBJECT);if(!a(this._model._runtime.animations))throw new g("Animations are not loaded.  Wait for Model.readyPromise to resolve.");if(a(c.multiplier)&&0>=c.multiplier)throw new g("options.multiplier must be greater than zero.");for(var d=[],e=this._model._runtime.animations.length,f=0;f<e;++f)d.push(t(this,f,c));return d};q.prototype.remove=function(b){if(a(b)){var c=this._scheduledAnimations,d=c.indexOf(b);if(-1!==d)return c.splice(d,1),this.animationRemoved.raiseEvent(this._model,b),!0}return!1};q.prototype.removeAll=function(){var a=this._model,b=this._scheduledAnimations,c=b.length;this._scheduledAnimations=[];for(var d=0;d<c;++d)this.animationRemoved.raiseEvent(a,b[d])};q.prototype.contains=function(b){return a(b)?-1!==this._scheduledAnimations.indexOf(b):!1};q.prototype.get=function(b){if(!a(b))throw new g("index is required.");return this._scheduledAnimations[b]};var c=[];q.prototype.update=function(f){var g=this._scheduledAnimations,h=g.length;if(0===h)return this._previousTime=void 0,!1;if(m.equals(f.time,this._previousTime))return!1;this._previousTime=m.clone(f.time,this._previousTime);for(var k=!1,l=f.time,q=this._model,t=0;t<h;++t){var u=g[t],C=u._runtimeAnimation;a(u._computedStartTime)||(u._computedStartTime=m.addSeconds(b(u.startTime,l),u.delay,new m));a(u._duration)||(u._duration=1/u.multiplier*C.stopTime);var I=u._computedStartTime,H=u._duration,J=u.stopTime,I=0!==H?m.secondsDifference(l,I)/H:0,w=0<=I,G=u.loop===p.REPEAT||u.loop===p.MIRRORED_REPEAT;if((w||G&&!a(u.startTime))&&(1>=I||G)&&(!a(J)||m.lessThanOrEquals(l,J))){u._state===d.STOPPED&&(u._state=d.ANIMATING,0<u.start.numberOfListeners&&f.afterRender.push(u._raiseStartEvent));u.loop===p.REPEAT?I-=Math.floor(I):u.loop===p.MIRRORED_REPEAT&&(k=Math.floor(I),J=I-k,I=1===k%2?1-J:J);u.reverse&&(I=1-I);k=I*H*u.multiplier;H=k=e.clamp(k,C.startTime,C.stopTime);C=C.channelEvaluators;J=C.length;for(I=0;I<J;++I)C[I](H);0<u.update.numberOfListeners&&(u._updateEventTime=k,f.afterRender.push(u._raiseUpdateEvent));k=!0}else w&&u._state===d.ANIMATING&&(u._state=d.STOPPED,0<u.stop.numberOfListeners&&f.afterRender.push(u._raiseStopEvent),u.removeOnStop&&c.push(u))}h=c.length;for(l=0;l<h;++l)t=c[l],g.splice(g.indexOf(t),1),f.afterRender.push(r(this,q,t));c.length=0;return k};return q});F("Scene/ModelLoadResources",["../Core/Queue"],function(b){function a(){this.resourcesParsed=this.initialized=!1;this.vertexBuffersToCreate=new b;this.indexBuffersToCreate=new b;this.buffers={};this.pendingBufferLoads=0;this.programsToCreate=new b;this.shaders={};this.pendingShaderLoads=0;this.texturesToCreate=new b;this.pendingTextureLoads=0;this.texturesToCreateFromBufferView=new b;this.pendingBufferViewToImage=0;this.createRuntimeNodes=this.createUniformMaps=this.createRenderStates=this.createVertexArrays=this.createRuntimeAnimations=this.createSkins=this.createSamplers=!0;this.createdBufferViews={};this.primitivesToDecode=new b;this.activeDecodingTasks=0;this.pendingDecodingCache=!1;this.skinnedNodesIds=[]}a.prototype.getBuffer=function(a){var b=a.byteOffset;return this.buffers[a.buffer].subarray(b,b+a.byteLength)};a.prototype.finishedPendingBufferLoads=function(){return 0===this.pendingBufferLoads};a.prototype.finishedBuffersCreation=function(){return 0===this.pendingBufferLoads&&0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length};a.prototype.finishedProgramCreation=function(){return 0===this.pendingShaderLoads&&0===this.programsToCreate.length};a.prototype.finishedTextureCreation=function(){var a=0===this.texturesToCreate.length&&0===this.texturesToCreateFromBufferView.length;return 0===this.pendingTextureLoads&&a};a.prototype.finishedEverythingButTextureCreation=function(){var a=0===this.pendingBufferLoads&&0===this.pendingShaderLoads,b=0===this.vertexBuffersToCreate.length&&0===this.indexBuffersToCreate.length&&0===this.programsToCreate.length&&0===this.pendingBufferViewToImage;return this.finishedDecoding()&&a&&b};a.prototype.finishedDecoding=function(){return 0===this.primitivesToDecode.length&&0===this.activeDecodingTasks&&!this.pendingDecodingCache};a.prototype.finished=function(){return this.finishedDecoding()&&this.finishedTextureCreation()&&this.finishedEverythingButTextureCreation()};return a});F("Scene/ModelMaterial",["../Core/defined","../Core/defineProperties","../Core/DeveloperError"],function(b,a,f){function k(a,b,f){this._name=b.name;this._id=f;this._uniformMap=a._uniformMaps[f];this._values=this._program=this._technique=void 0}a(k.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}}});k.prototype.setValue=function(a,k){if(!b(a))throw new f("name is required.");var g=this._uniformMap.values["u_"+a];if(!b(g))throw new f("name must match a parameter name in the material's technique that is targetable and not optimized out.");g.value=g.clone(k,g.value)};k.prototype.getValue=function(a){if(!b(a))throw new f("name is required.");a=this._uniformMap.values["u_"+a];if(b(a))return a.value};return k});F("Scene/ModelMesh",["../Core/defineProperties"],function(b){function a(a,b,g){for(var f=[],k=a.primitives,e=k.length,h=0;h<e;++h)f[h]=b[k[h].material];this._name=a.name;this._materials=f;this._id=g}b(a.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},materials:{get:function(){return this._materials}}});return a});F("Scene/ModelNode",["../Core/defineProperties","../Core/Matrix4"],function(b,a){function f(b,f,l,m,e){this._model=b;this._runtimeNode=l;this._name=f.name;this._id=m;this.useMatrix=!1;this._show=!0;this._matrix=a.clone(e);this._originalMatrix=a.clone(e)}b(f.prototype,{name:{get:function(){return this._name}},id:{get:function(){return this._id}},show:{get:function(){return this._show},set:function(a){this._show!==a&&(this._show=a,this._model._perNodeShowDirty=!0)}},matrix:{get:function(){return this._matrix},set:function(b){this._matrix=a.clone(b,this._matrix);this.useMatrix=!0;b=this._model;b._cesiumAnimationsDirty=!0;this._runtimeNode.dirtyNumber=b._maxDirtyNumber}},originalMatrix:{get:function(){return this._originalMatrix}}});f.prototype.setMatrix=function(b){a.clone(b,this._matrix)};return f});F("Scene/ModelUtility","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/clone ../Core/defined ../Core/defineProperties ../Core/Matrix2 ../Core/Matrix3 ../Core/Matrix4 ../Core/Quaternion ../Core/FeatureDetection ../Core/RuntimeError ../Core/WebGLConstants ../Renderer/ShaderSource ../ThirdParty/GltfPipeline/addToArray ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/GltfPipeline/hasExtension ./AttributeType ./Axis".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(a,b){return y.techniqueAttribute(a,function(a,c){if(a.semantic===b)return c})}function v(a,b,c,d){return A(a,"KHR_techniques_webgl")?function(a,b){if(!(a.semantic!==c||d&&l(a.node)))return b}:function(a,e){var f=b.parameters[a];if(!(f.semantic!==c||d&&l(f.node)))return e}}function B(a,b,c){b=new RegExp(b+"(?!\\w)","g");var d=a.search(b);return a.replace(b,function(a,b){return d===b?a:c})}function C(a,b,c){b=a.materials[b.material];if(A(a,"KHR_techniques_webgl")&&l(b.extensions)&&l(b.extensions.KHR_techniques_webgl))return y.techniqueAttribute(a.extensions.KHR_techniques_webgl.techniques[b.extensions.KHR_techniques_webgl.technique],function(a,b){if(a.semantic===c)return b})}function I(a){var b={value:a,clone:function(a,b){return a},func:function(){return b.value}};return b}function H(b){var c={value:a.fromArray(b),clone:a.clone,func:function(){return c.value}};return c}function J(a){var b={value:f.fromArray(a),clone:f.clone,func:function(){return b.value}};return b}function w(a){var b={value:k.fromArray(a),clone:k.clone,func:function(){return b.value}};return b}function G(a){var b={value:e.fromColumnMajorArray(a),clone:e.clone,func:function(){return b.value}};return b}function E(a){var b={value:h.fromColumnMajorArray(a),clone:h.clone,func:function(){return b.value}};return b}function L(a){var b={value:p.fromColumnMajorArray(a),clone:p.clone,func:function(){return b.value}};return b}function K(a,b,c){this._value=void 0;this._textureId=a.index;this._textures=b;this._defaultTexture=c}var P={updateForwardAxis:function(a){var b=a.gltf.extras.sourceVersion;if(l(b)&&"2.0"!==b||"2.0"!==P.getAssetVersion(a.gltf))a._gltfForwardAxis=x.X},getAssetVersion:function(a){return l(a.asset)&&l(a.asset.version)?a.asset.version:"1.0"},splitIncompatibleMaterials:function(a){var b=a.accessors,c=a.materials,d={};y.mesh(a,function(a){y.meshPrimitive(a,function(a){var e=a.material,f=c[e],h=a.attributes.JOINTS_0,k,m;l(h)&&(m=b[h],k=m.componentType,m=m.type);var h=l(h),p=l(a.attributes.COLOR_0),q=l(a.targets),r=l(a.attributes.NORMAL),w=l(a.attributes.TANGENT),t=l(a.attributes.TEXCOORD_0),v=d[e];if(!l(v))d[e]={skinning:{skinned:h,componentType:k,type:m},hasVertexColors:p,hasMorphTargets:q,hasNormals:r,hasTangents:w,hasTexCoords:t};else if(v.skinning.skinned!==h||v.skinning.type!==m||v.hasVertexColors!==p||v.hasMorphTargets!==q||v.hasNormals!==r||v.hasTangents!==w||v.hasTexCoords!==t)e=g(f,!0),e=u(c,e),a.material=e,d[e]={skinning:{skinned:h,componentType:k,type:m},hasVertexColors:p,hasMorphTargets:q,hasNormals:r,hasTangents:w,hasTexCoords:t}})});return d},getShaderVariable:function(a){return"SCALAR"===a?"float":a.toLowerCase()},ModelState:{NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3},getFailedLoadFunction:function(a,b,c){return function(d){a._state=P.ModelState.FAILED;var e="Failed to load "+b+": "+c;l(d)&&(e+="\n"+d.message);a._readyPromise.reject(new t(e))}},parseBuffers:function(a,b){var c=a._loadResources;y.buffer(a.gltf,function(d,e){if(l(d.extras._pipeline.source))c.buffers[e]=d.extras._pipeline.source;else if(l(b)){var f=a._resource.getDerivedResource({url:d.uri});++c.pendingBufferLoads;f.fetchArrayBuffer().then(b(a,e)).otherwise(P.getFailedLoadFunction(a,"buffer",f.url))}})}},N=new f,O=new f;P.computeBoundingSphere=function(a){for(var c=a.gltf,d=c.nodes,e=c.meshes,g=c.scenes[c.scene].nodes,h=g.length,k=[],m=new f(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),q=new f(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r=0;r<h;++r){var w=d[g[r]];w._transformToRoot=P.getTransform(w);for(k.push(w);0<k.length;){var w=k.pop(),t=w._transformToRoot,u=w.mesh;if(l(u))for(var u=e[u].primitives,v=u.length,E=0;E<v;++E){var z=u[E].attributes.POSITION;if(l(z)){var y=P.getAccessorMinMax(c,z),z=f.fromArray(y.min,0,N),y=f.fromArray(y.max,0,O);l(m)&&l(q)&&(p.multiplyByPoint(t,z,z),p.multiplyByPoint(t,y,y),f.minimumByComponent(m,z,m),f.maximumByComponent(q,y,q))}}u=w.children;if(l(u))for(v=u.length,E=0;E<v;++E)z=d[u[E]],z._transformToRoot=P.getTransform(z),p.multiplyTransformation(t,z._transformToRoot,z._transformToRoot),k.push(z);delete w._transformToRoot}}c=b.fromCornerPoints(m,q);a._forwardAxis===x.Z&&b.transformWithoutScale(c,x.Z_UP_TO_X_UP,c);a._upAxis===x.Y?b.transformWithoutScale(c,x.Y_UP_TO_Z_UP,c):a._upAxis===x.X&&b.transformWithoutScale(c,x.X_UP_TO_Z_UP,c);return c};P.ensureSemanticExistence=function(a){y.mesh(a,function(b){y.meshPrimitive(b,function(b){var c=a.accessors,d=a.materials,e=a.extensions.KHR_techniques_webgl,f=e.techniques,g=e.programs,h=e.shaders,k=b.targets,e=b.attributes,m;for(m in k)if(k.hasOwnProperty(m)){var p=k[m],q;for(q in p)"extras"!==q&&(e[q+"_"+m]=p[q])}b=f[d[b.material].extensions.KHR_techniques_webgl.technique];var g=h[g[b.program].vertexShader],r;for(r in e)e.hasOwnProperty(r)&&!l(D(b,r))&&(d=c[e[r]],f=r.toLowerCase(),"_"===f.charAt(0)&&(f=f.slice(1)),f="a_"+f,b.attributes[f]={semantic:r,type:d.componentType},h=g.extras._pipeline,m=h.source,m="attribute "+P.getShaderVariable(d.type)+" "+f+";\n"+m,h.source=m)})});return a};P.createAttributeLocations=function(a,b){var c={},d=!1,e=1;y.techniqueAttribute(a,function(a,b){/pos/i.test(b)&&!d?(c[b]=0,d=!0):c[b]=e++});if(l(b))for(var f in b)b.hasOwnProperty(f)&&(c[f]=e++);return c};P.getAccessorMinMax=function(a,b){var c=a.accessors[b],d=c.extensions,e=c.min,c=c.max;l(d)&&(d=d.WEB3D_quantized_attributes,l(d)&&(e=d.decodedMin,c=d.decodedMax));return{min:e,max:c}};P.getAttributeOrUniformBySemantic=function(a,b,c,d){return y.technique(a,function(e){if(!l(c)||e.program===c){var f=y.techniqueAttribute(e,v(a,e,b,d));return l(f)?f:y.techniqueUniform(e,v(a,e,b,d))}})};P.getDiffuseAttributeOrUniform=function(a,b){var c=P.getAttributeOrUniformBySemantic(a,"COLOR_0",b);l(c)||(c=P.getAttributeOrUniformBySemantic(a,"_3DTILESDIFFUSE",b));return c};var Z=new f,aa=new d,U=new f;P.getTransform=function(a,b){return l(a.matrix)?p.fromColumnMajorArray(a.matrix,b):p.fromTranslationQuaternionRotationScale(f.fromArray(a.translation,0,Z),d.unpack(a.rotation,0,aa),f.fromArray(a.scale,0,U),b)};P.getUsedExtensions=function(a){a=a.extensionsUsed;var b={};if(l(a))for(var c=a.length,d=0;d<c;d++)b[a[d]]=!0;return b};P.getRequiredExtensions=function(a){a=a.extensionsRequired;var b={};if(l(a))for(var c=a.length,d=0;d<c;d++)b[a[d]]=!0;return b};P.supportedExtensions={AGI_articulations:!0,CESIUM_RTC:!0,EXT_texture_webp:!0,KHR_blend:!0,KHR_binary_glTF:!0,KHR_draco_mesh_compression:!0,KHR_materials_common:!0,KHR_techniques_webgl:!0,KHR_materials_unlit:!0,KHR_materials_pbrSpecularGlossiness:!0,KHR_texture_transform:!0,WEB3D_quantized_attributes:!0};P.checkSupportedExtensions=function(a,b){for(var c in a)if(a.hasOwnProperty(c)){if(!P.supportedExtensions[c])throw new t("Unsupported glTF Extension: "+c);if("EXT_texture_webp"===c&&!1===b)throw new t("Loaded model requires WebP but browser does not support it.");}};P.checkSupportedGlExtensions=function(a,b){if(l(a))for(var c=a.length,d=0;d<c;d++){var e=a[d];if("OES_element_index_uint"!==e)throw new t("Unsupported WebGL Extension: "+e);if(!b.elementIndexUint)throw new t("OES_element_index_uint WebGL extension is not enabled.");}};P.modifyShaderForDracoQuantizedAttributes=function(a,b,d,e){var f={},g;for(g in e)if(e.hasOwnProperty(g)){var h=e[g],k=h.quantization;if(l(k)){var m=C(a,b,g);"_"===g.charAt(0)&&(g=g.substring(1));var p="gltf_u_dec_"+g.toLowerCase();if(!l(f[p])){var q="gltf_decoded_"+g,r=m.replace("a_","gltf_a_dec_"),w=h.componentsPerAttribute;d=B(d,m,r);h=k.octEncoded?"vec3":1<w?"vec"+w:"float";d=h+" "+r+";\n"+d;(w=3===w&&"COLOR_0"===g)&&(d=B(d,r,"vec4("+r+", 1.0)"));k.octEncoded?(p+="_rangeConstant",d="uniform float "+p+";\n"+d,m="\nvoid main() {\n    "+r+" \x3d czm_octDecode("+m+".xy, "+p+").zxy;\n    "+q+"();\n}\n"):(k=p+"_normConstant",p+="_min",d="uniform float "+k+";\nuniform "+h+" "+p+";\n"+d,m="\nvoid main() {\n    "+r+" \x3d "+p+" + "+m+(w?".xyz":"")+" * "+k+";\n    "+q+"();\n}\n");d=c.replaceMain(d,q);d+=m}}}return{shader:d}};P.modifyShaderForQuantizedAttributes=function(a,b,d){var e={},f=b.attributes,g;for(g in f)if(f.hasOwnProperty(g)){var h=C(a,b,g),k=b.attributes[g];"_"===g.charAt(0)&&(g=g.substring(1));var m="gltf_u_dec_"+g.toLowerCase(),p=m+"_scale",q=m+"_translate";if(!l(e[m])&&!l(e[p])&&(k=a.accessors[k].extensions,k=l(k)?k.WEB3D_quantized_attributes:void 0,l(k))){var r=k.decodeMatrix,k="gltf_decoded_"+g,w=h.replace("a_","gltf_a_dec_"),r=Math.floor(Math.sqrt(r.length));d=B(d,h,w);var t;t=2<r?"vec"+(r-1):"float";d=t+" "+w+";\n"+d;5===r?(d="uniform mat4 "+p+";\n"+d,d="uniform vec4 "+q+";\n"+d,h="\nvoid main() {\n    "+w+" \x3d "+p+" * "+h+" + "+q+";\n    "+k+"();\n}\n",e[p]={mat:4},e[q]={vec:4}):(d="uniform mat"+r+" "+m+";\n"+d,h="\nvoid main() {\n    "+w+" \x3d "+t+"("+m+" * vec"+r+"("+h+",1.0));\n    "+k+"();\n}\n",e[m]={mat:r});d=c.replaceMain(d,k);d+=h}}return{shader:d,uniforms:e}};P.toClipCoordinatesGLSL=function(a,b){var c=P.getAttributeOrUniformBySemantic(a,"POSITION"),d=c.replace("a_","gltf_a_dec_");-1!==b.indexOf(d)&&(c=d);d=P.getAttributeOrUniformBySemantic(a,"MODELVIEWPROJECTION",void 0,!0);if(!l(d)||-1===b.indexOf(d)){var d=P.getAttributeOrUniformBySemantic(a,"PROJECTION",void 0,!0),e=P.getAttributeOrUniformBySemantic(a,"MODELVIEW",void 0,!0);-1!==b.indexOf("czm_instanced_modelView ")?e="czm_instanced_modelView":l(e)||(e=P.getAttributeOrUniformBySemantic(a,"CESIUM_RTC_MODELVIEW",void 0,!0));d=d+" * "+e}return d+" * vec4("+c+".xyz, 1.0)"};P.modifyFragmentShaderForLogDepth=function(a){a=c.replaceMain(a,"czm_depth_main");return a+"\nvoid main() \n{ \n    czm_depth_main(); \n    czm_writeLogDepth(); \n} \n"};P.modifyVertexShaderForLogDepth=function(a,b){a=c.replaceMain(a,"czm_depth_main");return a+("\nvoid main() \n{ \n    czm_depth_main(); \n    czm_vertexLogDepth("+b+"); \n} \n")};m(K.prototype,{value:{get:function(){if(!l(this._value)){var a=this._textures[this._textureId];if(l(a))this._value=a;else return this._defaultTexture}return this._value},set:function(a){this._value=a}}});K.prototype.clone=function(a){return a};K.prototype.func=void 0;var W={};W[r.FLOAT]=I;W[r.FLOAT_VEC2]=H;W[r.FLOAT_VEC3]=J;W[r.FLOAT_VEC4]=w;W[r.INT]=I;W[r.INT_VEC2]=H;W[r.INT_VEC3]=J;W[r.INT_VEC4]=w;W[r.BOOL]=I;W[r.BOOL_VEC2]=H;W[r.BOOL_VEC3]=J;W[r.BOOL_VEC4]=w;W[r.FLOAT_MAT2]=G;W[r.FLOAT_MAT3]=E;W[r.FLOAT_MAT4]=L;W[r.SAMPLER_2D]=function(a,b,c){var d=new K(a,b,c);d.func=function(){return d.value};return d};P.createUniformFunction=function(a,b,c,d){return W[a](b,c,d)};P.createUniformsForDracoQuantizedAttributes=function(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c],e=d.quantization;if(l(e)){"_"===c.charAt(0)&&(c=c.substring(1));var f="gltf_u_dec_"+c.toLowerCase();if(e.octEncoded)b[f+"_rangeConstant"]=I((1<<e.quantizationBits)-1).func;else switch(b[f+"_normConstant"]=I(e.range/(1<<e.quantizationBits)).func,f+="_min",d.componentsPerAttribute){case 1:b[f]=I(e.minValues).func;break;case 2:b[f]=H(e.minValues).func;break;case 3:b[f]=J(e.minValues).func;break;case 4:b[f]=w(e.minValues).func}}}return b};P.createUniformsForQuantizedAttributes=function(a,b,c){var d=a.accessors;a={};var f={};b=b.attributes;for(var g in b)if(b.hasOwnProperty(g)){var k=d[b[g]],m=k.extensions;"_"===g.charAt(0)&&(g=g.substring(1));if(l(m)&&(m=m.WEB3D_quantized_attributes,l(m))){var m=m.decodeMatrix,q="gltf_u_dec_"+g.toLowerCase();switch(k.type){case z.SCALAR:f[q]=G(m).func;a[q]=!0;break;case z.VEC2:f[q]=E(m).func;a[q]=!0;break;case z.VEC3:f[q]=L(m).func;a[q]=!0;break;case z.VEC4:k=q+"_scale",q+="_translate",f[k]=L([m[0],m[1],m[2],m[3],m[5],m[6],m[7],m[8],m[10],m[11],m[12],m[13],m[15],m[16],m[17],m[18]]).func,f[q]=w([m[20],m[21],m[22],m[23]]).func,a[k]=!0,a[q]=!0}}}for(var r in c)c.hasOwnProperty(r)&&!a[r]&&(g=c[r],l(g.mat)&&(2===g.mat?f[r]=G(e.IDENTITY).func:3===g.mat?f[r]=E(h.IDENTITY).func:4===g.mat&&(f[r]=L(p.IDENTITY).func)),l(g.vec)&&4===g.vec&&(f[r]=w([0,0,0,0]).func));return f};var M=new f,R={MODEL:function(a,b){return function(){return a.model}},VIEW:function(a,b){return function(){return a.view}},PROJECTION:function(a,b){return function(){return a.projection}},MODELVIEW:function(a,b){return function(){return a.modelView}},CESIUM_RTC_MODELVIEW:function(a,b){var c=new p;return function(){return l(b._rtcCenter)?(p.getTranslation(a.model,M),f.add(M,b._rtcCenter,M),p.multiplyByPoint(a.view,M,M),p.setTranslation(a.modelView,M,c)):a.modelView}},MODELVIEWPROJECTION:function(a,b){return function(){return a.modelViewProjection}},MODELINVERSE:function(a,b){return function(){return a.inverseModel}},VIEWINVERSE:function(a,b){return function(){return a.inverseView}},PROJECTIONINVERSE:function(a,b){return function(){return a.inverseProjection}},MODELVIEWINVERSE:function(a,b){return function(){return a.inverseModelView}},MODELVIEWPROJECTIONINVERSE:function(a,b){return function(){return a.inverseModelViewProjection}},MODELINVERSETRANSPOSE:function(a,b){return function(){return a.inverseTransposeModel}},MODELVIEWINVERSETRANSPOSE:function(a,b){return function(){return a.normal}},VIEWPORT:function(a,b){return function(){return a.viewportCartesian4}}};P.getGltfSemanticUniforms=function(){return R};return P});F("Renderer/ComputeCommand",["../Core/defaultValue","./Pass"],function(b,a){function f(f){f=b(f,b.EMPTY_OBJECT);this.vertexArray=f.vertexArray;this.fragmentShaderSource=f.fragmentShaderSource;this.shaderProgram=f.shaderProgram;this.uniformMap=f.uniformMap;this.outputTexture=f.outputTexture;this.preExecute=f.preExecute;this.postExecute=f.postExecute;this.persists=b(f.persists,!1);this.pass=a.COMPUTE;this.owner=f.owner}f.prototype.execute=function(a){a.execute(this)};return f});F("Shaders/OctahedralProjectionAtlasFS",[],function(){return"varying vec2 v_textureCoordinates;\nuniform float originalSize;\nuniform sampler2D texture0;\nuniform sampler2D texture1;\nuniform sampler2D texture2;\nuniform sampler2D texture3;\nuniform sampler2D texture4;\nuniform sampler2D texture5;\nconst float yMipLevel1 \x3d 1.0 - (1.0 / pow(2.0, 1.0));\nconst float yMipLevel2 \x3d 1.0 - (1.0 / pow(2.0, 2.0));\nconst float yMipLevel3 \x3d 1.0 - (1.0 / pow(2.0, 3.0));\nconst float yMipLevel4 \x3d 1.0 - (1.0 / pow(2.0, 4.0));\nvoid main()\n{\nvec2 uv \x3d v_textureCoordinates;\nvec2 textureSize \x3d vec2(originalSize * 1.5 + 2.0, originalSize);\nvec2 pixel \x3d 1.0 / textureSize;\nfloat mipLevel \x3d 0.0;\nif (uv.x - pixel.x \x3e (textureSize.y / textureSize.x))\n{\nmipLevel \x3d 1.0;\nif (uv.y - pixel.y \x3e yMipLevel1)\n{\nmipLevel \x3d 2.0;\nif (uv.y - pixel.y * 3.0 \x3e yMipLevel2)\n{\nmipLevel \x3d 3.0;\nif (uv.y - pixel.y * 5.0 \x3e yMipLevel3)\n{\nmipLevel \x3d 4.0;\nif (uv.y - pixel.y * 7.0 \x3e yMipLevel4)\n{\nmipLevel \x3d 5.0;\n}\n}\n}\n}\n}\nif (mipLevel \x3e 0.0)\n{\nfloat scale \x3d pow(2.0, mipLevel);\nuv.y -\x3d (pixel.y * (mipLevel - 1.0) * 2.0);\nuv.x *\x3d ((textureSize.x - 2.0) / textureSize.y);\nuv.x -\x3d 1.0 + pixel.x;\nuv.y -\x3d (1.0 - (1.0 / pow(2.0, mipLevel - 1.0)));\nuv *\x3d scale;\n}\nelse\n{\nuv.x *\x3d (textureSize.x / textureSize.y);\n}\nif(mipLevel \x3d\x3d 0.0)\n{\ngl_FragColor \x3d texture2D(texture0, uv);\n}\nelse if(mipLevel \x3d\x3d 1.0)\n{\ngl_FragColor \x3d texture2D(texture1, uv);\n}\nelse if(mipLevel \x3d\x3d 2.0)\n{\ngl_FragColor \x3d texture2D(texture2, uv);\n}\nelse if(mipLevel \x3d\x3d 3.0)\n{\ngl_FragColor \x3d texture2D(texture3, uv);\n}\nelse if(mipLevel \x3d\x3d 4.0)\n{\ngl_FragColor \x3d texture2D(texture4, uv);\n}\nelse if(mipLevel \x3d\x3d 5.0)\n{\ngl_FragColor \x3d texture2D(texture5, uv);\n}\nelse\n{\ngl_FragColor \x3d vec4(0.0);\n}\n}\n"});F("Shaders/OctahedralProjectionFS",[],function(){return"varying vec3 v_cubeMapCoordinates;\nuniform samplerCube cubeMap;\nvoid main()\n{\nvec4 rgbm \x3d textureCube(cubeMap, v_cubeMapCoordinates);\nfloat m \x3d rgbm.a * 16.0;\nvec3 r \x3d rgbm.rgb * m;\ngl_FragColor \x3d vec4(r * r, 1.0);\n}\n"});F("Shaders/OctahedralProjectionVS",[],function(){return"attribute vec4 position;\nattribute vec3 cubeMapCoordinates;\nvarying vec3 v_cubeMapCoordinates;\nvoid main()\n{\ngl_Position \x3d position;\nv_cubeMapCoordinates \x3d cubeMapCoordinates;\n}\n"});F("Scene/OctahedralProjectedCubeMap","../Core/Cartesian3 ../Core/ComponentDatatype ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/IndexDatatype ../Core/loadKTX ../Core/PixelFormat ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/ComputeCommand ../Renderer/CubeMap ../Renderer/PixelDatatype ../Renderer/ShaderProgram ../Renderer/Texture ../Renderer/VertexArray ../Shaders/OctahedralProjectionAtlasFS ../Shaders/OctahedralProjectionFS ../Shaders/OctahedralProjectionVS ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(a){this._url=a;this._maximumMipmapLevel=this._sp=this._va=this._mipTextures=this._texture=this._cubeMaps=this._cubeMapBuffers=void 0;this._ready=this._loading=!1;this._readyPromise=x.defer()}function v(b){var c=h.createVertexBuffer({context:b,typedArray:L,usage:p.STATIC_DRAW}),d=h.createVertexBuffer({context:b,typedArray:E,usage:p.STATIC_DRAW}),e=h.createIndexBuffer({context:b,typedArray:K,usage:p.STATIC_DRAW,indexDatatype:l.UNSIGNED_SHORT});return new u({context:b,attributes:[{index:0,vertexBuffer:c,componentsPerAttribute:2,componentDatatype:a.FLOAT},{index:1,vertexBuffer:d,componentsPerAttribute:3,componentDatatype:a.FLOAT}],indexBuffer:e})}function B(a){return function(){return a}}function C(a){a._va=a._va&&a._va.destroy();a._sp=a._sp&&a._sp.destroy();var b,c,d=a._cubeMaps;if(f(d))for(c=d.length,b=0;b<c;++b)d[b].destroy();d=a._mipTextures;if(f(d))for(c=d.length,b=0;b<c;++b)d[b].destroy();a._va=void 0;a._sp=void 0;a._cubeMaps=void 0;a._cubeMapBuffers=void 0;a._mipTextures=void 0}k(D.prototype,{url:{get:function(){return this._url}},texture:{get:function(){return this._texture}},maximumMipmapLevel:{get:function(){return this._maximumMipmapLevel}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}}});D.isSupported=function(a){return a.colorBufferHalfFloat&&a.halfFloatingPointTexture||a.floatingPointTexture&&a.colorBufferFloat};k=new b(1,0,0);var I=new b(0,0,1),H=new b(-1,0,0),J=new b(0,0,-1),w=new b(0,1,0),G=new b(0,-1,0);k=[w,H,I,G,k,w,J,w,w];for(var I=k.length,E=new Float32Array(3*I),J=H=0;J<I;++J,H+=3)b.pack(k[J],E,H);var L=new Float32Array([-1,1,-1,0,0,1,0,0,1,0,1,1,0,-1,-1,-1,1,-1]),K=new Uint16Array([0,1,2,2,3,1,7,6,1,3,6,1,2,5,4,3,4,2,4,8,6,3,4,6]);D.prototype.update=function(a){var b=a.context;if(D.isSupported(b)&&(f(this._texture)&&f(this._va)&&C(this),!f(this._texture))){if(!f(this._texture)&&!this._loading){var g=b.textureCache.getTexture(this._url);if(f(g)){C(this);this._texture=g;this._maximumMipmapLevel=this._texture.maximumMipmapLevel;this._ready=!0;this._readyPromise.resolve();return}}g=this._cubeMapBuffers;if(!f(g)&&!this._loading){var h=this;m(this._url).then(function(a){h._cubeMapBuffers=a;h._loading=!1});this._loading=!0}if(f(this._cubeMapBuffers)){this._va=v(b);this._sp=r.fromCache({context:b,vertexShaderSource:z,fragmentShaderSource:A,attributeLocations:{position:0,cubeMapCoordinates:1}});var k=Math.min(g.length,6);this._maximumMipmapLevel=k-1;for(var l=this._cubeMaps=Array(k),p=this._mipTextures=Array(k),w=2*g[0].positiveX.width,u={originalSize:function(){return w}},E=b.halfFloatingPointTexture?t.HALF_FLOAT:t.FLOAT,G=e.RGBA,x=0;x<k;++x){var L=g[x].positiveY;g[x].positiveY=g[x].negativeY;g[x].negativeY=L;var L=l[x]=new q({context:b,source:g[x]}),K=2*l[x].width,K=p[x]=new c({context:b,width:K,height:K,pixelDatatype:E,pixelFormat:G}),L=new d({vertexArray:this._va,shaderProgram:this._sp,uniformMap:{cubeMap:B(L)},outputTexture:K,persists:!0,owner:this});a.commandList.push(L);u["texture"+x]=B(K)}this._texture=new c({context:b,width:1.5*w+2,height:w,pixelDatatype:E,pixelFormat:G});this._texture.maximumMipmapLevel=this._maximumMipmapLevel;b.textureCache.addTexture(this._url,this._texture);b=new d({fragmentShaderSource:y,uniformMap:u,outputTexture:this._texture,persists:!1,owner:this});a.commandList.push(b);this._ready=!0;this._readyPromise.resolve()}}};D.prototype.isDestroyed=function(){return!1};D.prototype.destroy=function(){C(this);this._texture=this._texture&&this._texture.destroy();return g(this)};return D});F("Scene/processModelMaterialsCommon","./ModelUtility ../Core/defined ../Core/defaultValue ../Core/WebGLConstants ../Core/webGLConstantToGlslType ../ThirdParty/GltfPipeline/addToArray ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/GltfPipeline/hasExtension ../ThirdParty/GltfPipeline/numberOfComponentsForType".split(" "),function(b,a,f,k,g,l,m,e,h){function p(b){var d={},c;a(b.extensions)&&a(b.extensions.KHR_materials_common)&&(c=b.extensions.KHR_materials_common.lights);if(a(c)){b=b.nodes;for(var e in b)if(b.hasOwnProperty(e)){var f=b[e];if(a(f.extensions)&&a(f.extensions.KHR_materials_common)){var g=f.extensions.KHR_materials_common.light;a(g)&&a(c[g])&&(c[g].node=e);delete f.extensions.KHR_materials_common}}e=0;for(var h in c)if(c.hasOwnProperty(h))if(b=c[h],g=b.type,"ambient"===g||a(b.node)){f="light"+e.toString();b.baseName=f;switch(g){case "ambient":d[f+"Color"]={type:k.FLOAT_VEC3,value:b.ambient.color};break;case "directional":d[f+"Color"]={type:k.FLOAT_VEC3,value:b.directional.color};a(b.node)&&(d[f+"Transform"]={node:b.node,semantic:"MODELVIEW",type:k.FLOAT_MAT4});break;case "point":g=b.point;d[f+"Color"]={type:k.FLOAT_VEC3,value:g.color};a(b.node)&&(d[f+"Transform"]={node:b.node,semantic:"MODELVIEW",type:k.FLOAT_MAT4});d[f+"Attenuation"]={type:k.FLOAT_VEC3,value:[g.constantAttenuation,g.linearAttenuation,g.quadraticAttenuation]};break;case "spot":g=b.spot,d[f+"Color"]={type:k.FLOAT_VEC3,value:g.color},a(b.node)&&(d[f+"Transform"]={node:b.node,semantic:"MODELVIEW",type:k.FLOAT_MAT4},d[f+"InverseTransform"]={node:b.node,semantic:"MODELVIEWINVERSE",type:k.FLOAT_MAT4,useInFragment:!0}),d[f+"Attenuation"]={type:k.FLOAT_VEC3,value:[g.constantAttenuation,g.linearAttenuation,g.quadraticAttenuation]},d[f+"FallOff"]={type:k.FLOAT_VEC2,value:[g.fallOffAngle,g.fallOffExponent]}}++e}else delete c[h]}return d}function d(b,d){var c;c=a(d.value)?d.value:a(d.index)?[d.index]:d;switch(b){case "ambient":return 1===c.length?k.SAMPLER_2D:k.FLOAT_VEC4;case "diffuse":return 1===c.length?k.SAMPLER_2D:k.FLOAT_VEC4;case "emission":return 1===c.length?k.SAMPLER_2D:k.FLOAT_VEC4;case "specular":return 1===c.length?k.SAMPLER_2D:k.FLOAT_VEC4;case "shininess":return k.FLOAT;case "transparency":return k.FLOAT;case "transparent":return k.BOOL;case "doubleSided":return k.BOOL}}function q(b){b=b.extensions.KHR_materials_common;if(a(b)&&a(b.lights)){b=b.lights;for(var d=b.length,c=0;c<d;c++){var e=b[c];"ambient"===e.type?(a(e.ambient)||(e.ambient={}),e=e.ambient,a(e.color)||(e.color=[1,1,1])):"directional"===e.type?(a(e.directional)||(e.directional={}),e=e.directional,a(e.color)||(e.color=[1,1,1])):"point"===e.type?(a(e.point)||(e.point={}),e=e.point,a(e.color)||(e.color=[1,1,1]),e.constantAttenuation=f(e.constantAttenuation,1),e.linearAttenuation=f(e.linearAttenuation,0),e.quadraticAttenuation=f(e.quadraticAttenuation,0)):"spot"===e.type&&(a(e.spot)||(e.spot={}),e=e.spot,a(e.color)||(e.color=[1,1,1]),e.constantAttenuation=f(e.constantAttenuation,1),e.fallOffAngle=f(e.fallOffAngle,3.14159265),e.fallOffExponent=f(e.fallOffExponent,0),e.linearAttenuation=f(e.linearAttenuation,0),e.quadraticAttenuation=f(e.quadraticAttenuation,0))}}}return function(t,r){r=f(r,{});if(a(t)&&e(t,"KHR_materials_common")){e(t,"KHR_techniques_webgl")||(a(t.extensions)||(t.extensions={}),t.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]},t.extensionsUsed.push("KHR_techniques_webgl"),t.extensionsRequired.push("KHR_techniques_webgl"));var c=t.extensions.KHR_techniques_webgl;q(t);var u=p(t),y=b.splitIncompatibleMaterials(t),A={},z=!1;m.material(t,function(m,p){if(a(m.extensions)&&a(m.extensions.KHR_materials_common)){var q=m.extensions.KHR_materials_common,B=y[p],C;C=""+("technique:"+q.technique+";");for(var D=q.values,x=Object.keys(D).sort(),J=x.length,w=0;w<J;++w){var G=x[w];D.hasOwnProperty(G)&&(C+=G+":"+d(G,D[G]),C+=";")}D=f(q.jointCount,0);C+=D.toString()+";";a(B)&&(x=B.skinning,0<D&&(C+=x.type+";"),C+=B.hasVertexColors);D=A[C];if(!a(D)){var E=q,L=r.addBatchIdToGeneratedShaders;a(E)||(E={});var L=f(L,!1),D=c.techniques,J=c.shaders,x=c.programs,w=E.technique.toUpperCase(),K;a(t.extensions)&&a(t.extensions.KHR_materials_common)&&(K=t.extensions.KHR_materials_common.lights);var P=E.values,N=f(E.jointCount,0),O,Z=!1,G=!1;a(B)&&(O=B.skinning,Z=O.skinned,G=B.hasVertexColors);var aa="precision highp float;\n",U="precision highp float;\n",W="CONSTANT"!==w,B={u_modelViewMatrix:{semantic:e(t,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:k.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:k.FLOAT_MAT4}};W&&(B.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:k.FLOAT_MAT3});Z&&(B.u_jointMatrix={count:N,semantic:"JOINTMATRIX",type:k.FLOAT_MAT4});var M,N=!1,R;for(R in P)if(P.hasOwnProperty(R)&&"transparent"!==R&&"doubleSided"!==R){var Y=d(R,P[R]);M="u_"+R.toLowerCase();N||Y!==k.SAMPLER_2D||(N=!0);B[M]={type:Y}}a(B.u_diffuse)&&(B.u_diffuse.semantic="_3DTILESDIFFUSE");if(a(u))for(var Q in u)u.hasOwnProperty(Q)&&(M="u_"+Q,B[M]=u[Q]);for(M in B)B.hasOwnProperty(M)&&(R=B[M],Q=a(R.count)?"["+R.count+"]":"",R.type!==k.FLOAT_MAT3&&R.type!==k.FLOAT_MAT4||R.useInFragment?(U+="uniform "+g(R.type)+" "+M+Q+";\n",delete R.useInFragment):aa+="uniform "+g(R.type)+" "+M+Q+";\n");R="";if(Z)if(M=h(O.type),Q=!1,0===O.type.indexOf("MAT")&&(Q=!0,M=Math.sqrt(M)),Q)for(Q=0;Q<M;Q++)for(P=0;P<M;P++)R=0===Q&&0===P?R+"  mat4 skinMat \x3d ":R+"  skinMat +\x3d ",R+="a_weight["+Q+"]["+P+"] * u_jointMatrix[int(a_joint["+Q+"]["+P+"])];\n";else for(Q=0;Q<M;Q++)R=0===Q?R+"  mat4 skinMat \x3d ":R+"  skinMat +\x3d ",R+="a_weight["+Q+"] * u_jointMatrix[int(a_joint["+Q+"])];\n";M={a_position:{semantic:"POSITION"}};aa+="attribute vec3 a_position;\nvarying vec3 v_positionEC;\n";R=(Z?R+"  vec4 pos \x3d u_modelViewMatrix * skinMat * vec4(a_position,1.0);\n":R+"  vec4 pos \x3d u_modelViewMatrix * vec4(a_position,1.0);\n")+"  v_positionEC \x3d pos.xyz;\n  gl_Position \x3d u_projectionMatrix * pos;\n";U+="varying vec3 v_positionEC;\n";W&&(M.a_normal={semantic:"NORMAL"},aa+="attribute vec3 a_normal;\nvarying vec3 v_normal;\n",R=Z?R+"  v_normal \x3d u_normalMatrix * mat3(skinMat) * a_normal;\n":R+"  v_normal \x3d u_normalMatrix * a_normal;\n",U+="varying vec3 v_normal;\n");var S;N&&(M.a_texcoord_0={semantic:"TEXCOORD_0"},S="v_texcoord_0",aa=aa+"attribute vec2 a_texcoord_0;\n"+("varying vec2 "+S+";\n"),R+="  "+S+" \x3d a_texcoord_0;\n",U+="varying vec2 "+S+";\n");Z&&(O=b.getShaderVariable(O.type),M.a_joint={semantic:"JOINT"},M.a_weight={semantic:"WEIGHT"},aa=aa+("attribute "+O+" a_joint;\n")+("attribute "+O+" a_weight;\n"));G&&(M.a_vertexColor={semantic:"COLOR_0"},aa+="attribute vec4 a_vertexColor;\nvarying vec4 v_vertexColor;\n",R+="  v_vertexColor \x3d a_vertexColor;\n",U+="varying vec4 v_vertexColor;\n");L&&(M.a_batchId={semantic:"_BATCHID"},aa+="attribute float a_batchId;\n");L=W&&("BLINN"===w||"PHONG"===w)&&a(B.u_specular)&&a(B.u_shininess)&&0<B.u_shininess;Z=Q=!1;O="";for(var F in K)if(K.hasOwnProperty(F)){P=K[F];N=P.type.toLowerCase();P=P.baseName;O+="  {\n";var Y="u_"+P+"Color",T,da;"ambient"===N?(Z=!0,O+="    ambientLight +\x3d "+Y+";\n"):W&&(Q=!0,T="v_"+P+"Direction",da="v_"+P+"Position","point"!==N&&(aa+="varying vec3 "+T+";\n",U+="varying vec3 "+T+";\n",R+="  "+T+" \x3d mat3(u_"+P+"Transform) * vec3(0.,0.,1.);\n","directional"===N&&(O+="    vec3 l \x3d normalize("+T+");\n")),"directional"!==N?(aa+="varying vec3 "+da+";\n",U+="varying vec3 "+da+";\n",R+="  "+da+" \x3d u_"+P+"Transform[3].xyz;\n",O+="    vec3 VP \x3d "+da+" - v_positionEC;\n",O+="    vec3 l \x3d normalize(VP);\n",O+="    float range \x3d length(VP);\n",O+="    float attenuation \x3d 1.0 / (u_"+P+"Attenuation.x + ",O+="(u_"+P+"Attenuation.y * range) + ",O+="(u_"+P+"Attenuation.z * range * range));\n"):O+="    float attenuation \x3d 1.0;\n","spot"===N&&(O+="    float spotDot \x3d dot(l, normalize("+T+"));\n",O+="    if (spotDot \x3c cos(u_"+P+"FallOff.x * 0.5))\n",O+="    {\n",O+="      attenuation \x3d 0.0;\n",O+="    }\n",O+="    else\n",O+="    {\n",O+="        attenuation *\x3d max(0.0, pow(spotDot, u_"+P+"FallOff.y));\n",O+="    }\n"),O+="    diffuseLight +\x3d "+Y+"* max(dot(normal,l), 0.) * attenuation;\n",L&&("BLINN"===w?(O+="    vec3 h \x3d normalize(l + viewDir);\n",O+="    float specularIntensity \x3d max(0., pow(max(dot(normal, h), 0.), u_shininess)) * attenuation;\n"):(O+="    vec3 reflectDir \x3d reflect(-l, normal);\n",O+="    float specularIntensity \x3d max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess)) * attenuation;\n"),O+="    specularLight +\x3d "+Y+" * specularIntensity;\n"));O+="  }\n"}Z||(O+="  ambientLight +\x3d vec3(0.2, 0.2, 0.2);\n");Q||"CONSTANT"===w||(O+="  vec3 l \x3d normalize(czm_sunDirectionEC);\n  diffuseLight +\x3d vec3(1.0, 1.0, 1.0) * max(dot(normal,l), 0.2);\n",L&&(O=("BLINN"===w?O+"  vec3 h \x3d normalize(l + viewDir);\n  float specularIntensity \x3d max(0., pow(max(dot(normal, h), 0.), u_shininess));\n":O+"  vec3 reflectDir \x3d reflect(-l, normal);\n  float specularIntensity \x3d max(0., pow(max(dot(reflectDir, viewDir), 0.), u_shininess));\n")+"  specularLight +\x3d vec3(1.0, 1.0, 1.0) * specularIntensity;\n"));aa=aa+"void main(void) {\n"+R;aa+="}\n";U+="void main(void) {\n";K="  vec3 color \x3d vec3(0.0, 0.0, 0.0);\n";W&&(U+="  vec3 normal \x3d normalize(v_normal);\n",E.doubleSided&&(U+="  if (gl_FrontFacing \x3d\x3d false)\n  {\n    normal \x3d -normal;\n  }\n"));"CONSTANT"!==w?(a(B.u_diffuse)&&(U=B.u_diffuse.type===k.SAMPLER_2D?U+("  vec4 diffuse \x3d texture2D(u_diffuse, "+S+");\n"):U+"  vec4 diffuse \x3d u_diffuse;\n",U+="  vec3 diffuseLight \x3d vec3(0.0, 0.0, 0.0);\n",K+="  color +\x3d diffuse.rgb * diffuseLight;\n"),L&&(U=B.u_specular.type===k.SAMPLER_2D?U+("  vec3 specular \x3d texture2D(u_specular, "+S+").rgb;\n"):U+"  vec3 specular \x3d u_specular.rgb;\n",U+="  vec3 specularLight \x3d vec3(0.0, 0.0, 0.0);\n",K+="  color +\x3d specular * specularLight;\n"),F=a(B.u_transparency)?"  gl_FragColor \x3d vec4(color * diffuse.a * u_transparency, diffuse.a * u_transparency);\n":"  gl_FragColor \x3d vec4(color * diffuse.a, diffuse.a);\n"):F=a(B.u_transparency)?"  gl_FragColor \x3d vec4(color * u_transparency, u_transparency);\n":"  gl_FragColor \x3d vec4(color, 1.0);\n";G&&(K+="  color *\x3d v_vertexColor.rgb;\n");a(B.u_emission)&&(U=B.u_emission.type===k.SAMPLER_2D?U+("  vec3 emission \x3d texture2D(u_emission, "+S+").rgb;\n"):U+"  vec3 emission \x3d u_emission.rgb;\n",K+="  color +\x3d emission;\n");if(a(B.u_ambient)||"CONSTANT"!==w)U=a(B.u_ambient)?B.u_ambient.type===k.SAMPLER_2D?U+("  vec3 ambient \x3d texture2D(u_ambient, "+S+").rgb;\n"):U+"  vec3 ambient \x3d u_ambient.rgb;\n":U+"  vec3 ambient \x3d diffuse.rgb;\n",K+="  color +\x3d ambient * ambientLight;\n";U=U+"  vec3 viewDir \x3d -normalize(v_positionEC);\n  vec3 ambientLight \x3d vec3(0.0, 0.0, 0.0);\n"+O+K;U=U+F+"}\n";S=l(J,{type:k.VERTEX_SHADER,extras:{_pipeline:{source:aa,extension:".glsl"}}});K=l(J,{type:k.FRAGMENT_SHADER,extras:{_pipeline:{source:U,extension:".glsl"}}});S=l(x,{fragmentShader:K,vertexShader:S});D=l(D,{attributes:M,program:S,uniforms:B});A[C]=D;z=!0}S={};K=q.values;for(var V in K)K.hasOwnProperty(V)&&"transparent"!==V&&"doubleSided"!==V&&(F="u_"+V.toLowerCase(),S[F]=K[V]);m.extensions.KHR_techniques_webgl={technique:D,values:S};m.alphaMode="OPAQUE";q.transparent&&(m.alphaMode="BLEND");q.doubleSided&&(m.doubleSided=!0)}});if(!z)return t;b.ensureSemanticExistence(t);return t}}});F("Scene/processPbrMaterials","./ModelUtility ../Core/defined ../Core/defaultValue ../Core/WebGLConstants ../Core/webGLConstantToGlslType ../ThirdParty/GltfPipeline/addToArray ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/GltfPipeline/hasExtension ../ThirdParty/GltfPipeline/numberOfComponentsForType".split(" "),function(b,a,f,k,g,l,m,e,h){function p(b){return a(b.extensions)&&a(b.extensions.KHR_materials_pbrSpecularGlossiness)}function d(b,c,d,e,f){if(a(d[c+"Offset"])){d=b.samplers[b.textures[d[c].index].sampler];b=d.wrapS===k.REPEAT?"true":"false";var g=d.wrapT===k.REPEAT?"true":"false";d=c+"Coord";f.fragmentShaderMain+="    vec2 "+d+" \x3d computeTexCoord("+e+", "+c+"Offset, "+c+"Rotation, "+c+"Scale, "+b+", "+g+");\n"}else d=e;return d}function q(b,d,e){if(-1!==b.indexOf("Texture")&&a(d.extensions)&&a(d.extensions.KHR_texture_transform)){b="u_"+b;var g=d.extensions.KHR_texture_transform;e[b+"Offset"]=f(g.offset,c);e[b+"Rotation"]=f(g.rotation,u);e[b+"Scale"]=f(g.scale,y);a(d.texCoord)&&a(g.texCoord)&&(e[b].texCoord=g.texCoord)}}function t(c,t,u,y,v,B){var z=f(B.addBatchIdToGeneratedShaders,!1),A=c.extensions.KHR_techniques_webgl;B=A.techniques;var D=A.shaders,A=A.programs,x=p(t),w,G,E,L=t.pbrMetallicRoughness;if(a(L)&&!x)for(G in L)L.hasOwnProperty(G)&&(E=L[G],w="u_"+G,y[w]=E,q(G,E,y));if(x)for(G in L=t.extensions.KHR_materials_pbrSpecularGlossiness,L)L.hasOwnProperty(G)&&(E=L[G],w="u_"+G,y[w]=E,q(G,E,y));for(var K in t)t.hasOwnProperty(K)&&(0<=K.indexOf("Texture")||0<=K.indexOf("Factor"))&&(E=t[K],w="u_"+K,y[w]=E,q(K,E,y));G=K="precision highp float;\n";var P;a(c.skins)&&(P=c.skins[0]);var N=a(P)?P.joints:[],O=N.length;v=v[u];var Z,aa=!1,U=P=!1,W=L=E=!1,M=!1;a(v)&&(Z=v.skinning,aa=Z.skinned&&0<N.length,P=v.hasVertexColors,U=v.hasMorphTargets,E=v.hasNormals,L=v.hasTangents,W=v.hasTexCoords);var R;U&&m.mesh(c,function(b){m.meshPrimitive(b,function(b){b.material===u&&(b=b.targets,a(b)&&(R=b))})});v={u_modelViewMatrix:{semantic:e(c,"CESIUM_RTC")?"CESIUM_RTC_MODELVIEW":"MODELVIEW",type:k.FLOAT_MAT4},u_projectionMatrix:{semantic:"PROJECTION",type:k.FLOAT_MAT4}};a(t.extensions)&&a(t.extensions.KHR_materials_unlit)&&(M=!0,L=E=!1);E&&(v.u_normalMatrix={semantic:"MODELVIEWINVERSETRANSPOSE",type:k.FLOAT_MAT3});aa&&(v.u_jointMatrix={count:O,semantic:"JOINTMATRIX",type:k.FLOAT_MAT4});U&&(v.u_morphWeights={count:R.length,semantic:"MORPHWEIGHTS",type:k.FLOAT});O=t.alphaMode;a(O)&&"MASK"===O&&(v.u_alphaCutoff={semantic:"ALPHACUTOFF",type:k.FLOAT});for(w in y)y.hasOwnProperty(w)&&(v[w]={type:r(w)});N=f(v.u_baseColorTexture,v.u_baseColorFactor);a(N)&&(N.semantic="_3DTILESDIFFUSE");for(w in v)if(v.hasOwnProperty(w)){var N=v[w],Y=a(N.count)?"["+N.count+"]":"";N.type!==k.FLOAT_MAT3&&N.type!==k.FLOAT_MAT4&&"u_morphWeights"!==w||N.useInFragment?(G+="uniform "+g(N.type)+" "+w+Y+";\n",delete N.useInFragment):K+="uniform "+g(N.type)+" "+w+Y+";\n"}w="";if(aa){var Q,N=h(Z.type),Y=!1;0===Z.type.indexOf("MAT")&&(Y=!0,N=Math.sqrt(N));if(Y)for(Y=0;Y<N;Y++)for(Q=0;Q<N;Q++)w=0===Y&&0===Q?w+"    mat4 skinMatrix \x3d ":w+"    skinMatrix +\x3d ",w+="a_weight["+Y+"]["+Q+"] * u_jointMatrix[int(a_joint["+Y+"]["+Q+"])];\n";else for(Y=0;Y<N;Y++)w=0===Y?w+"    mat4 skinMatrix \x3d ":w+"    skinMatrix +\x3d ",w+="a_weight["+Y+"] * u_jointMatrix[int(a_joint["+Y+"])];\n"}N={a_position:{semantic:"POSITION"}};K+="attribute vec3 a_position;\n";E&&(K+="varying vec3 v_positionEC;\n");w+="    vec3 weightedPosition \x3d a_position;\n";E&&(w+="    vec3 weightedNormal \x3d a_normal;\n");L&&(w+="    vec4 weightedTangent \x3d a_tangent;\n");if(U)for(U=0;U<R.length;U++){var Y=R[U],S;for(S in Y)Y.hasOwnProperty(S)&&"extras"!==S&&(Q="a_"+S+"_"+U,N[Q]={semantic:S+"_"+U},K+="attribute vec3 "+Q+";\n","POSITION"===S?w+="    weightedPosition +\x3d u_morphWeights["+U+"] * "+Q+";\n":"NORMAL"===S?w+="    weightedNormal +\x3d u_morphWeights["+U+"] * "+Q+";\n":L&&"TANGENT"===S&&(w+="    weightedTangent.xyz +\x3d u_morphWeights["+U+"] * "+Q+";\n"))}w=(aa?w+"    vec4 position \x3d skinMatrix * vec4(weightedPosition, 1.0);\n":w+"    vec4 position \x3d vec4(weightedPosition, 1.0);\n")+"    position \x3d u_modelViewMatrix * position;\n";E&&(w+="    v_positionEC \x3d position.xyz;\n");w+="    gl_Position \x3d u_projectionMatrix * position;\n";E&&(N.a_normal={semantic:"NORMAL"},K+="attribute vec3 a_normal;\nvarying vec3 v_normal;\n",w=aa?w+"    v_normal \x3d u_normalMatrix * mat3(skinMatrix) * weightedNormal;\n":w+"    v_normal \x3d u_normalMatrix * weightedNormal;\n",G+="varying vec3 v_normal;\nvarying vec3 v_positionEC;\n");L&&(N.a_tangent={semantic:"TANGENT"},K+="attribute vec4 a_tangent;\nvarying vec4 v_tangent;\n",w+="    v_tangent.xyz \x3d u_normalMatrix * weightedTangent.xyz;\n    v_tangent.w \x3d weightedTangent.w;\n",G+="varying vec4 v_tangent;\n");S="";var F,T,da,V,ba,X,fa;W&&(N.a_texcoord_0={semantic:"TEXCOORD_0"},K+="attribute vec2 a_texcoord_0;\nvarying vec2 v_texcoord_0;\n",w+="    v_texcoord_0 \x3d a_texcoord_0;\n",G+="varying vec2 v_texcoord_0;\n",S={fragmentShaderMain:S},F=d(c,"u_normalTexture",y,"v_texcoord_0",S),T=d(c,"u_baseColorTexture",y,"v_texcoord_0",S),da=d(c,"u_specularGlossinessTexture",y,"v_texcoord_0",S),V=d(c,"u_diffuseTexture",y,"v_texcoord_0",S),ba=d(c,"u_metallicRoughnessTexture",y,"v_texcoord_0",S),X=d(c,"u_occlusionTexture",y,"v_texcoord_0",S),fa=d(c,"u_emmissiveTexture",y,"v_texcoord_0",S),S=S.fragmentShaderMain);aa&&(Z=b.getShaderVariable(Z.type),N.a_joint={semantic:"JOINTS_0"},N.a_weight={semantic:"WEIGHTS_0"},K=K+("attribute "+Z+" a_joint;\n")+("attribute "+Z+" a_weight;\n"));P&&(N.a_vertexColor={semantic:"COLOR_0"},K+="attribute vec4 a_vertexColor;\nvarying vec4 v_vertexColor;\n",w+="  v_vertexColor \x3d a_vertexColor;\n",G+="varying vec4 v_vertexColor;\n");z&&(N.a_batchId={semantic:"_BATCHID"},K+="attribute float a_batchId;\n");K=K+"void main(void) \n{\n"+w;K+="}\n";E&&(G+="const float M_PI \x3d 3.141592653589793;\nvec3 lambertianDiffuse(vec3 diffuseColor) \n{\n    return diffuseColor / M_PI;\n}\n\nvec3 fresnelSchlick2(vec3 f0, vec3 f90, float VdotH) \n{\n    return f0 + (f90 - f0) * pow(clamp(1.0 - VdotH, 0.0, 1.0), 5.0);\n}\n\nvec3 fresnelSchlick(float metalness, float VdotH) \n{\n    return metalness + (vec3(1.0) - metalness) * pow(1.0 - VdotH, 5.0);\n}\n\nfloat smithVisibilityG1(float NdotV, float roughness) \n{\n    float k \x3d (roughness + 1.0) * (roughness + 1.0) / 8.0;\n    return NdotV / (NdotV * (1.0 - k) + k);\n}\n\nfloat smithVisibilityGGX(float roughness, float NdotL, float NdotV) \n{\n    return smithVisibilityG1(NdotL, roughness) * smithVisibilityG1(NdotV, roughness);\n}\n\nfloat GGX(float roughness, float NdotH) \n{\n    float roughnessSquared \x3d roughness * roughness;\n    float f \x3d (NdotH * roughnessSquared - NdotH) * NdotH + 1.0;\n    return roughnessSquared / (M_PI * f * f);\n}\n\n");G=G+"vec3 SRGBtoLINEAR3(vec3 srgbIn) \n{\n    return pow(srgbIn, vec3(2.2));\n}\n\nvec4 SRGBtoLINEAR4(vec4 srgbIn) \n{\n    vec3 linearOut \x3d pow(srgbIn.rgb, vec3(2.2));\n    return vec4(linearOut, srgbIn.a);\n}\n\nvec3 LINEARtoSRGB(vec3 linearIn) \n{\n#ifndef HDR \n    return pow(linearIn, vec3(1.0/2.2));\n#else \n    return linearIn;\n#endif \n}\n\nvec2 computeTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale, bool repeatS, bool repeatT) \n{\n    rotation \x3d -rotation; \n    mat3 transform \x3d mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, \n       -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, \n        offset.x, offset.y, 1.0); \n    vec2 transformedTexCoords \x3d (transform * vec3(fract(texCoords), 1.0)).xy; \n    transformedTexCoords.x \x3d repeatS ? fract(transformedTexCoords.x) : clamp(transformedTexCoords.x, 0.0, 1.0); \n    transformedTexCoords.y \x3d repeatT ? fract(transformedTexCoords.y) : clamp(transformedTexCoords.y, 0.0, 1.0); \n    return transformedTexCoords; \n}\n\n#ifdef USE_IBL_LIGHTING \nuniform vec2 gltf_iblFactor; \n#endif \n#ifdef USE_CUSTOM_LIGHT_COLOR \nuniform vec3 gltf_lightColor; \n#endif \nvoid main(void) \n{\n"+S;E&&(G+="    vec3 ng \x3d normalize(v_normal);\n    vec3 positionWC \x3d vec3(czm_inverseView * vec4(v_positionEC, 1.0));\n",a(y.u_normalTexture)?L?G=G+"    vec3 t \x3d normalize(v_tangent.xyz);\n    vec3 b \x3d normalize(cross(ng, t) * v_tangent.w);\n    mat3 tbn \x3d mat3(t, b, ng);\n"+("    vec3 n \x3d texture2D(u_normalTexture, "+F+").rgb;\n")+"    n \x3d normalize(tbn * (2.0 * n - 1.0));\n":(G="#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n"+G+"#ifdef GL_OES_standard_derivatives\n    vec3 pos_dx \x3d dFdx(v_positionEC);\n    vec3 pos_dy \x3d dFdy(v_positionEC);\n"+("    vec3 tex_dx \x3d dFdx(vec3("+F+",0.0));\n")+("    vec3 tex_dy \x3d dFdy(vec3("+F+",0.0));\n")+"    vec3 t \x3d (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n    t \x3d normalize(t - ng * dot(ng, t));\n",G+="    vec3 b \x3d normalize(cross(ng, t));\n",G+="    mat3 tbn \x3d mat3(t, b, ng);\n",G=G+("    vec3 n \x3d texture2D(u_normalTexture, "+F+").rgb;\n")+"    n \x3d normalize(tbn * (2.0 * n - 1.0));\n#else\n",G+="    vec3 n \x3d ng;\n",G+="#endif\n"):G+="    vec3 n \x3d ng;\n",t.doubleSided&&(G+="    if (!gl_FrontFacing)\n",G+="    {\n",G+="        n \x3d -n;\n",G+="    }\n"));a(y.u_baseColorTexture)?(G+="    vec4 baseColorWithAlpha \x3d SRGBtoLINEAR4(texture2D(u_baseColorTexture, "+T+"));\n",a(y.u_baseColorFactor)&&(G+="    baseColorWithAlpha *\x3d u_baseColorFactor;\n")):G=a(y.u_baseColorFactor)?G+"    vec4 baseColorWithAlpha \x3d u_baseColorFactor;\n":G+"    vec4 baseColorWithAlpha \x3d vec4(1.0);\n";P&&(G+="    baseColorWithAlpha *\x3d v_vertexColor;\n");G+="    vec3 baseColor \x3d baseColorWithAlpha.rgb;\n";E?(x?(a(y.u_specularGlossinessTexture)?(G+="    vec4 specularGlossiness \x3d SRGBtoLINEAR4(texture2D(u_specularGlossinessTexture, "+da+"));\n",G+="    vec3 specular \x3d specularGlossiness.rgb;\n",G+="    float glossiness \x3d specularGlossiness.a;\n",a(y.u_specularFactor)&&(G+="    specular *\x3d u_specularFactor;\n"),a(y.u_glossinessFactor)&&(G+="    glossiness *\x3d u_glossinessFactor;\n")):(G=a(y.u_specularFactor)?G+"    vec3 specular \x3d clamp(u_specularFactor, vec3(0.0), vec3(1.0));\n":G+"    vec3 specular \x3d vec3(1.0);\n",G=a(y.u_glossinessFactor)?G+"    float glossiness \x3d clamp(u_glossinessFactor, 0.0, 1.0);\n":G+"    float glossiness \x3d 1.0;\n"),a(y.u_diffuseTexture)?(G+="    vec4 diffuse \x3d SRGBtoLINEAR4(texture2D(u_diffuseTexture, "+V+"));\n",a(y.u_diffuseFactor)&&(G+="    diffuse *\x3d u_diffuseFactor;\n")):G=a(y.u_diffuseFactor)?G+"    vec4 diffuse \x3d clamp(u_diffuseFactor, vec4(0.0), vec4(1.0));\n":G+"    vec4 diffuse \x3d vec4(1.0);\n"):a(y.u_metallicRoughnessTexture)?(G+="    vec3 metallicRoughness \x3d texture2D(u_metallicRoughnessTexture, "+ba+").rgb;\n",G+="    float metalness \x3d clamp(metallicRoughness.b, 0.0, 1.0);\n",G+="    float roughness \x3d clamp(metallicRoughness.g, 0.04, 1.0);\n",a(y.u_metallicFactor)&&(G+="    metalness *\x3d u_metallicFactor;\n"),a(y.u_roughnessFactor)&&(G+="    roughness *\x3d u_roughnessFactor;\n")):(G=a(y.u_metallicFactor)?G+"    float metalness \x3d clamp(u_metallicFactor, 0.0, 1.0);\n":G+"    float metalness \x3d 1.0;\n",G=a(y.u_roughnessFactor)?G+"    float roughness \x3d clamp(u_roughnessFactor, 0.04, 1.0);\n":G+"    float roughness \x3d 1.0;\n"),G+="    vec3 v \x3d -normalize(v_positionEC);\n",G+="#ifndef USE_CUSTOM_LIGHT_COLOR \n",G+="    vec3 lightColor \x3d vec3(1.5, 1.4, 1.2);\n",G+="#else \n",G+="    vec3 lightColor \x3d gltf_lightColor;\n",G+="#endif \n",G=!1===c.enableLighting?G+"    vec3 l \x3d vec3(0.0,0.0,1.0);\n":G+"    vec3 l \x3d normalize(czm_sunDirectionEC);\n",G+="    vec3 h \x3d normalize(v + l);\n",G+="    float NdotL \x3d clamp(dot(n, l), 0.001, 1.0);\n",G+="    float NdotV \x3d abs(dot(n, v)) + 0.001;\n",G+="    float NdotH \x3d clamp(dot(n, h), 0.0, 1.0);\n",G+="    float LdotH \x3d clamp(dot(l, h), 0.0, 1.0);\n",G+="    float VdotH \x3d clamp(dot(v, h), 0.0, 1.0);\n",G+="    vec3 f0 \x3d vec3(0.04);\n",x?(G+="    float roughness \x3d 1.0 - glossiness;\n",G+="    vec3 diffuseColor \x3d diffuse.rgb * (1.0 - max(max(specular.r, specular.g), specular.b));\n",G+="    vec3 specularColor \x3d specular;\n"):(G+="    vec3 diffuseColor \x3d baseColor * (1.0 - metalness) * (1.0 - f0);\n",G+="    vec3 specularColor \x3d mix(f0, baseColor, metalness);\n"),G+="    float alpha \x3d roughness * roughness;\n",G+="    float reflectance \x3d max(max(specularColor.r, specularColor.g), specularColor.b);\n",G+="    vec3 r90 \x3d vec3(clamp(reflectance * 25.0, 0.0, 1.0));\n",G+="    vec3 r0 \x3d specularColor.rgb;\n",G+="    vec3 F \x3d fresnelSchlick2(r0, r90, VdotH);\n",G+="    float G \x3d smithVisibilityGGX(alpha, NdotL, NdotV);\n",G+="    float D \x3d GGX(alpha, NdotH);\n",G+="    vec3 diffuseContribution \x3d (1.0 - F) * lambertianDiffuse(diffuseColor);\n",G+="    vec3 specularContribution \x3d F * G * D / (4.0 * NdotL * NdotV);\n",G+="    vec3 color \x3d NdotL * lightColor * (diffuseContribution + specularContribution);\n",G+="#if defined(USE_IBL_LIGHTING) \x26\x26 !defined(DIFFUSE_IBL) \x26\x26 !defined(SPECULAR_IBL) \n",G+="    vec3 r \x3d normalize(czm_inverseViewRotation * normalize(reflect(v, n)));\n",G+="    float vertexRadius \x3d length(positionWC);\n",G+="    float horizonDotNadir \x3d 1.0 - min(1.0, czm_ellipsoidRadii.x / vertexRadius);\n",G+="    float reflectionDotNadir \x3d dot(r, normalize(positionWC));\n",G+="    r.x \x3d -r.x;\n",G+="    r \x3d -normalize(czm_temeToPseudoFixed * r);\n",G+="    r.x \x3d -r.x;\n",G+="    float inverseRoughness \x3d 1.04 - roughness;\n",G+="    inverseRoughness *\x3d inverseRoughness;\n",G+="    vec3 sceneSkyBox \x3d textureCube(czm_environmentMap, r).rgb * inverseRoughness;\n",G+="    float atmosphereHeight \x3d 0.05;\n",G+="    float blendRegionSize \x3d 0.1 * ((1.0 - inverseRoughness) * 8.0 + 1.1 - horizonDotNadir);\n",G+="    float blendRegionOffset \x3d roughness * -1.0;\n",G+="    float farAboveHorizon \x3d clamp(horizonDotNadir - blendRegionSize * 0.5 + blendRegionOffset, 1.0e-10 - blendRegionSize, 0.99999);\n",G+="    float aroundHorizon \x3d clamp(horizonDotNadir + blendRegionSize * 0.5, 1.0e-10 - blendRegionSize, 0.99999);\n",G+="    float farBelowHorizon \x3d clamp(horizonDotNadir + blendRegionSize * 1.5, 1.0e-10 - blendRegionSize, 0.99999);\n",G+="    float smoothstepHeight \x3d smoothstep(0.0, atmosphereHeight, horizonDotNadir);\n",G+="    vec3 belowHorizonColor \x3d mix(vec3(0.1, 0.15, 0.25), vec3(0.4, 0.7, 0.9), smoothstepHeight);\n",G+="    vec3 nadirColor \x3d belowHorizonColor * 0.5;\n",G+="    vec3 aboveHorizonColor \x3d mix(vec3(0.9, 1.0, 1.2), belowHorizonColor, roughness * 0.5);\n",G+="    vec3 blueSkyColor \x3d mix(vec3(0.18, 0.26, 0.48), aboveHorizonColor, reflectionDotNadir * inverseRoughness * 0.5 + 0.75);\n",G+="    vec3 zenithColor \x3d mix(blueSkyColor, sceneSkyBox, smoothstepHeight);\n",G+="    vec3 blueSkyDiffuseColor \x3d vec3(0.7, 0.85, 0.9);\n",G+="    float diffuseIrradianceFromEarth \x3d (1.0 - horizonDotNadir) * (reflectionDotNadir * 0.25 + 0.75) * smoothstepHeight;\n",G+="    float diffuseIrradianceFromSky \x3d (1.0 - smoothstepHeight) * (1.0 - (reflectionDotNadir * 0.25 + 0.25));\n",G+="    vec3 diffuseIrradiance \x3d blueSkyDiffuseColor * clamp(diffuseIrradianceFromEarth + diffuseIrradianceFromSky, 0.0, 1.0);\n",G+="    float notDistantRough \x3d (1.0 - horizonDotNadir * roughness * 0.8);\n",G+="    vec3 specularIrradiance \x3d mix(zenithColor, aboveHorizonColor, smoothstep(farAboveHorizon, aroundHorizon, reflectionDotNadir) * notDistantRough);\n",G+="    specularIrradiance \x3d mix(specularIrradiance, belowHorizonColor, smoothstep(aroundHorizon, farBelowHorizon, reflectionDotNadir) * inverseRoughness);\n",G+="    specularIrradiance \x3d mix(specularIrradiance, nadirColor, smoothstep(farBelowHorizon, 1.0, reflectionDotNadir) * inverseRoughness);\n",G+="#ifdef USE_SUN_LUMINANCE \n",G+="    float LdotZenith \x3d clamp(dot(normalize(czm_inverseViewRotation * l), normalize(positionWC * -1.0)), 0.001, 1.0);\n",G+="    float S \x3d acos(LdotZenith);\n",G+="    float NdotZenith \x3d clamp(dot(normalize(czm_inverseViewRotation * n), normalize(positionWC * -1.0)), 0.001, 1.0);\n",G+="    float gamma \x3d acos(NdotL);\n",G+="    float numerator \x3d ((0.91 + 10.0 * exp(-3.0 * gamma) + 0.45 * pow(NdotL, 2.0)) * (1.0 - exp(-0.32 / NdotZenith)));\n",G+="    float denominator \x3d (0.91 + 10.0 * exp(-3.0 * S) + 0.45 * pow(LdotZenith,2.0)) * (1.0 - exp(-0.32));\n",G+="    float luminance \x3d gltf_luminanceAtZenith * (numerator / denominator);\n",G+="#endif \n",G+="    vec2 brdfLut \x3d texture2D(czm_brdfLut, vec2(NdotV, 1.0 - roughness)).rg;\n",G+="    vec3 IBLColor \x3d (diffuseIrradiance * diffuseColor * gltf_iblFactor.x) + (specularIrradiance * SRGBtoLINEAR3(specularColor * brdfLut.x + brdfLut.y) * gltf_iblFactor.y);\n",G+="#ifdef USE_SUN_LUMINANCE \n",G+="    color +\x3d IBLColor * luminance;\n",G+="#else \n",G+="    color +\x3d IBLColor; \n",G+="#endif \n",G+="#elif defined(DIFFUSE_IBL) || defined(SPECULAR_IBL) \n",G+="    mat3 fixedToENU \x3d mat3(gltf_clippingPlanesMatrix[0][0], gltf_clippingPlanesMatrix[1][0], gltf_clippingPlanesMatrix[2][0], \n",G+="                           gltf_clippingPlanesMatrix[0][1], gltf_clippingPlanesMatrix[1][1], gltf_clippingPlanesMatrix[2][1], \n",G+="                           gltf_clippingPlanesMatrix[0][2], gltf_clippingPlanesMatrix[1][2], gltf_clippingPlanesMatrix[2][2]); \n",G+="    const mat3 yUpToZUp \x3d mat3(-1.0, 0.0, 0.0, 0.0, 0.0, -1.0, 0.0, 1.0, 0.0); \n",G+="    vec3 cubeDir \x3d normalize(yUpToZUp * fixedToENU * normalize(reflect(-v, n))); \n",G+="#ifdef DIFFUSE_IBL \n",G+="#ifdef CUSTOM_SPHERICAL_HARMONICS \n",G+="    vec3 diffuseIrradiance \x3d czm_sphericalHarmonics(cubeDir, gltf_sphericalHarmonicCoefficients); \n",G+="#else \n",G+="    vec3 diffuseIrradiance \x3d czm_sphericalHarmonics(cubeDir, czm_sphericalHarmonicCoefficients); \n",G+="#endif \n",G+="#else \n",G+="    vec3 diffuseIrradiance \x3d vec3(0.0); \n",G+="#endif \n",G+="#ifdef SPECULAR_IBL \n",G+="    vec2 brdfLut \x3d texture2D(czm_brdfLut, vec2(NdotV, roughness)).rg;\n",G+="#ifdef CUSTOM_SPECULAR_IBL \n",G+="    vec3 specularIBL \x3d czm_sampleOctahedralProjection(gltf_specularMap, gltf_specularMapSize, cubeDir,  roughness * gltf_maxSpecularLOD, gltf_maxSpecularLOD);\n",G+="#else \n",G+="    vec3 specularIBL \x3d czm_sampleOctahedralProjection(czm_specularEnvironmentMaps, czm_specularEnvironmentMapSize, cubeDir,  roughness * czm_specularEnvironmentMapsMaximumLOD, czm_specularEnvironmentMapsMaximumLOD);\n",G+="#endif \n",G+="    specularIBL *\x3d F * brdfLut.x + brdfLut.y;\n",G+="#else \n",G+="    vec3 specularIBL \x3d vec3(0.0); \n",G+="#endif \n",G+="    color +\x3d diffuseIrradiance * diffuseColor + specularColor * specularIBL;\n",G+="#endif \n"):G+="    vec3 color \x3d baseColor;\n";M||(a(y.u_occlusionTexture)&&(G+="    color *\x3d texture2D(u_occlusionTexture, "+X+").r;\n"),a(y.u_emissiveTexture)?(G+="    vec3 emissive \x3d SRGBtoLINEAR3(texture2D(u_emissiveTexture, "+fa+").rgb);\n",a(y.u_emissiveFactor)&&(G+="    emissive *\x3d u_emissiveFactor;\n"),G+="    color +\x3d emissive;\n"):a(y.u_emissiveFactor)&&(G+="    color +\x3d u_emissiveFactor;\n"));G+="    color \x3d LINEARtoSRGB(color);\n";a(O)?"MASK"===O?(G+="    if (baseColorWithAlpha.a \x3c u_alphaCutoff) {\n",G+="        discard;\n",G+="    }\n",G+="    gl_FragColor \x3d vec4(color, 1.0);\n"):G="BLEND"===O?G+"    gl_FragColor \x3d vec4(color, baseColorWithAlpha.a);\n":G+"    gl_FragColor \x3d vec4(color, 1.0);\n":G+="    gl_FragColor \x3d vec4(color, 1.0);\n";G+="}\n";c=l(D,{type:k.VERTEX_SHADER,extras:{_pipeline:{source:K,extension:".glsl"}}});t=l(D,{type:k.FRAGMENT_SHADER,extras:{_pipeline:{source:G,extension:".glsl"}}});c=l(A,{fragmentShader:t,vertexShader:c});return l(B,{attributes:N,program:c,uniforms:v})}function r(a){if(-1!==a.indexOf("Offset"))return k.FLOAT_VEC2;if(-1!==a.indexOf("Rotation"))return k.FLOAT;if(-1!==a.indexOf("Scale"))return k.FLOAT_VEC2;if(-1!==a.indexOf("Texture"))return k.SAMPLER_2D;switch(a){case "u_baseColorFactor":return k.FLOAT_VEC4;case "u_metallicFactor":return k.FLOAT;case "u_roughnessFactor":return k.FLOAT;case "u_emissiveFactor":return k.FLOAT_VEC3;case "u_diffuseFactor":return k.FLOAT_VEC4;case "u_specularFactor":return k.FLOAT_VEC3;case "u_glossinessFactor":return k.FLOAT}}var c=[0,0],u=[0],y=[1,1];return function(c,d){d=f(d,{});if(e(c,"KHR_techniques_webgl")||!a(c.materials)||0===c.materials.length)return c;a(c.extensions)||(c.extensions={});a(c.extensionsUsed)||(c.extensionsUsed=[]);a(c.extensionsRequired)||(c.extensionsRequired=[]);c.extensions.KHR_techniques_webgl={programs:[],shaders:[],techniques:[]};c.extensionsUsed.push("KHR_techniques_webgl");c.extensionsRequired.push("KHR_techniques_webgl");var g=b.splitIncompatibleMaterials(c);m.material(c,function(b,e){var f={},h=t(c,b,e,f,g,d);a(b.extensions)||(b.extensions={});b.extensions.KHR_techniques_webgl={values:f,technique:h}});b.ensureSemanticExistence(c);return c}});F("Scene/Model","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/Check ../Core/clone ../Core/Color ../Core/combine ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/FeatureDetection ../Core/getAbsoluteUri ../Core/getMagic ../Core/getStringFromTypedArray ../Core/IndexDatatype ../Core/isArray ../Core/loadCRN ../Core/loadImageFromTypedArray ../Core/loadKTX ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/PixelFormat ../Core/PrimitiveType ../Core/Quaternion ../Core/Resource ../Core/Transforms ../Core/WebGLConstants ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/Sampler ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Renderer/VertexArray ../ThirdParty/GltfPipeline/addDefaults ../ThirdParty/GltfPipeline/addPipelineExtras ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/GltfPipeline/getAccessorByteStride ../ThirdParty/GltfPipeline/hasExtension ../ThirdParty/GltfPipeline/numberOfComponentsForType ../ThirdParty/GltfPipeline/parseGlb ../ThirdParty/GltfPipeline/removePipelineExtras ../ThirdParty/GltfPipeline/updateVersion ../ThirdParty/when ./Axis ./BlendingState ./ClippingPlaneCollection ./ColorBlendMode ./DracoLoader ./getClipAndStyleCode ./getClippingFunction ./HeightReference ./JobType ./ModelAnimationCache ./ModelAnimationCollection ./ModelLoadResources ./ModelMaterial ./ModelMesh ./ModelNode ./ModelUtility ./OctahedralProjectedCubeMap ./processModelMaterialsCommon ./processPbrMaterials ./SceneMode ./ShadowMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,F,T,da,V,ba,X,fa,ga,ka,na,ia,la,ha,pa,oa,qa,ua,ta,wa,za,Da,Ba,ra,Ea,Ga,Ca,ya,Aa,Ua,sa,Va,xa,Ha){function ca(a){this._gltf=a.gltf;this.ready=a.ready;this.modelsToLoad=[];this.count=0}function Ia(c){c=d(c,d.EMPTY_OBJECT);var g=c.cacheKey;this._cacheKey=g;this._cachedGltf=void 0;this._releaseGltfJson=d(c.releaseGltfJson,!1);var h;if(q(g)&&q(eb[g])&&eb[g].ready)h=eb[g],++h.count;else{var k=c.gltf;q(k)&&(k instanceof ArrayBuffer&&(k=new Uint8Array(k)),k instanceof Uint8Array?(h=ka(k),h=new ca({gltf:h,ready:!0})):h=new ca({gltf:c.gltf,ready:!0}),h.count=1,q(g)&&(eb[g]=h))}this._cachedGltf=h;g=d(c.basePath,"");this._resource=K.createIfNeeded(g);this.show=d(c.show,!0);this.silhouetteColor=d(c.silhouetteColor,e.RED);this._silhouetteColor=new e;this._silhouetteColorPreviousAlpha=1;this._normalAttributeName=void 0;this.silhouetteSize=d(c.silhouetteSize,0);this.modelMatrix=w.clone(d(c.modelMatrix,w.IDENTITY));this._modelMatrix=w.clone(this.modelMatrix);this._clampedModelMatrix=void 0;this._scale=this.scale=d(c.scale,1);this._minimumPixelSize=this.minimumPixelSize=d(c.minimumPixelSize,0);this._maximumScale=this.maximumScale=c.maximumScale;this._id=this.id=c.id;this._heightReference=this.heightReference=d(c.heightReference,za.NONE);this._heightChanged=!1;this._removeUpdateHeightCallback=void 0;this._scene=g=c.scene;q(g)&&q(g.terrainProviderChanged)&&(this._terrainProviderChangedCallback=g.terrainProviderChanged.addEventListener(function(){this._heightChanged=!0},this));this._pickObject=c.pickObject;this._allowPicking=d(c.allowPicking,!0);this._ready=!1;this._readyPromise=la.defer();this.activeAnimations=new ra(this);this.clampAnimations=d(c.clampAnimations,!0);this._defaultTexture=void 0;this._incrementallyLoadTextures=d(c.incrementallyLoadTextures,!0);this._asynchronous=d(c.asynchronous,!0);this._shadows=this.shadows=d(c.shadows,Ha.ENABLED);this.color=d(c.color,e.WHITE);this._color=new e;this._colorPreviousAlpha=1;this.colorBlendMode=d(c.colorBlendMode,qa.HIGHLIGHT);this.colorBlendAmount=d(c.colorBlendAmount,.5);this._colorShadingEnabled=!1;this._clippingPlanes=void 0;this.clippingPlanes=c.clippingPlanes;this._clippingPlanesState=0;this.clippingPlanesOriginMatrix=void 0;this.debugShowBoundingVolume=d(c.debugShowBoundingVolume,!1);this._debugShowBoundingVolume=!1;this.debugWireframe=d(c.debugWireframe,!1);this._debugWireframe=!1;this._distanceDisplayCondition=c.distanceDisplayCondition;this._addBatchIdToGeneratedShaders=c.addBatchIdToGeneratedShaders;this._precreatedAttributes=c.precreatedAttributes;this._vertexShaderLoaded=c.vertexShaderLoaded;this._fragmentShaderLoaded=c.fragmentShaderLoaded;this._uniformMapLoaded=c.uniformMapLoaded;this._pickIdLoaded=c.pickIdLoaded;this._ignoreCommands=d(c.ignoreCommands,!1);this._requestType=c.requestType;this._upAxis=d(c.upAxis,ha.Y);this._gltfForwardAxis=ha.Z;this._forwardAxis=c.forwardAxis;this.cull=d(c.cull,!0);this.opaquePass=d(c.opaquePass,U.OPAQUE);this._computedModelMatrix=new w;this._clippingPlaneModelViewMatrix=w.clone(w.IDENTITY);this._boundingSphere=this._initialRadius=void 0;this._scaledBoundingSphere=new b;this._state=Db.NEEDS_LOAD;this._mode=this._loadResources=void 0;this._dirty=this._cesiumAnimationsDirty=this._perNodeShowDirty=!1;this._maxDirtyNumber=0;this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0};this._uniformMaps={};this._extensionsRequired=this._extensionsUsed=void 0;this._quantizedUniforms={};this._programPrimitives={};this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}};this._cachedRendererResources=void 0;this._loadRendererResourcesFromCache=!1;this._dequantizeInShader=d(c.dequantizeInShader,!0);this._decodedData={};this._trianglesLength=this._texturesByteLength=this._geometryByteLength=this._cachedTexturesByteLength=this._cachedGeometryByteLength=0;this._sourceTechniques={};this._sourcePrograms={};this._quantizedVertexShaders={};this._nodeCommands=[];this._pickIds=[];this._sourceKHRTechniquesWebGL=this._sourceVersion=this._rtcCenter2D=this._rtcCenter3D=this._rtcCenterEye=this._rtcCenter=void 0;this._imageBasedLightingFactor=new a(1,1);a.clone(c.imageBasedLightingFactor,this._imageBasedLightingFactor);this._lightColor=f.clone(c.lightColor);this._enableLighting=d(c.enableLighting,!1);this._luminanceAtZenith=void 0;this.luminanceAtZenith=d(c.luminanceAtZenith,.5);this._sphericalHarmonicCoefficients=c.sphericalHarmonicCoefficients;this._specularEnvironmentMaps=c.specularEnvironmentMaps;this._shouldUpdateSpecularMapAtlas=!0;this._specularEnvironmentMapAtlas=void 0;this._shouldRegenerateShaders=this._useDefaultSpecularMaps=this._useDefaultSphericalHarmonics=!1}function La(a){return!e.equals(a.color,e.WHITE)||a.colorBlendMode!==qa.HIGHLIGHT}function Fa(a){a=a._clippingPlanes;return q(a)&&a.enabled&&0!==a.length}function Ja(a,b,d){if(a._state!==Db.LOADED)throw new c("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");if(!q(d))throw new c("name is required.");return a._runtime[b][d]}function Qa(a,b){l.typeOf.object("stage",a);l.typeOf.object("result",b);var c=a.currentValue,d=Qb;switch(a.type){case "xRotate":c=J.fromRotationX(H.toRadians(c),bb);w.multiplyByMatrix3(b,c,b);break;case "yRotate":c=J.fromRotationY(H.toRadians(c),bb);w.multiplyByMatrix3(b,c,b);break;case "zRotate":c=J.fromRotationZ(H.toRadians(c),bb);w.multiplyByMatrix3(b,c,b);break;case "xTranslate":d.x=c;d.y=0;d.z=0;w.multiplyByTranslation(b,d,b);break;case "yTranslate":d.x=0;d.y=c;d.z=0;w.multiplyByTranslation(b,d,b);break;case "zTranslate":d.x=0;d.y=0;d.z=c;w.multiplyByTranslation(b,d,b);break;case "xScale":d.x=c;d.y=1;d.z=1;w.multiplyByScale(b,d,b);break;case "yScale":d.x=1;d.y=c;d.z=1;w.multiplyByScale(b,d,b);break;case "zScale":d.x=1;d.y=1;d.z=c;w.multiplyByScale(b,d,b);break;case "uniformScale":w.multiplyByUniformScale(b,c,b)}return b}function va(a){var b=a._loadResources;ba.buffer(a.gltf,function(a,c){b.buffers[c]=a.extras._pipeline.source})}function Sa(a,b){return function(c){var d=a._loadResources;c=new Uint8Array(c);--d.pendingBufferLoads;a.gltf.buffers[b].extras._pipeline.source=c}}function Oa(a){var b=a.gltf.bufferViews,c=a._loadResources.vertexBuffersToCreate;ba.bufferView(a.gltf,function(a,b){a.target===N.ARRAY_BUFFER&&c.enqueue(b)});var d=a._loadResources.indexBuffersToCreate,e={};ba.accessor(a.gltf,function(a){var c=a.bufferView;q(c)&&b[c].target===N.ELEMENT_ARRAY_BUFFER&&!q(e[c])&&(e[c]=!0,d.enqueue({id:c,componentType:a.componentType}))})}function Ta(a){var b=a.gltf;if(fa(b,"KHR_techniques_webgl")){var c=a._sourcePrograms,d=a._sourceTechniques,e=b.extensions.KHR_techniques_webgl.programs;ba.technique(b,function(a,b){d[b]=m(a);var f=a.program;q(c[f])||(c[f]=m(e[f]))})}}function Ka(a,b,c){return function(d){var e=a._loadResources;e.shaders[c]={source:d,type:b,bufferView:void 0};--e.pendingShaderLoads;a._rendererResources.sourceShaders[c]=d}}function Wa(a){var b=a.gltf,c=b.buffers,d=b.bufferViews,e=a._rendererResources.sourceShaders;ba.shader(b,function(b,f){if(q(b.bufferView)){var g=d[b.bufferView],g=x(c[g.buffer].extras._pipeline.source,g.byteOffset,g.byteLength);e[f]=g}else q(b.extras._pipeline.source)?e[f]=b.extras._pipeline.source:(++a._loadResources.pendingShaderLoads,g=a._resource.getDerivedResource({url:b.uri}),g.fetchText().then(Ka(a,b.type,f)).otherwise(Aa.getFailedLoadFunction(a,"shader",g.url)))})}function Ra(a){var b=a._sourceTechniques,c;for(c in b)b.hasOwnProperty(c)&&a._loadResources.programsToCreate.enqueue({programId:b[c].program,techniqueId:c})}function Nb(a){var b={},c={},d={};a._runtime.articulationsByName=b;a._runtime.articulationsByStageKey=c;a._runtime.stagesByKey=d;a=a.gltf;if(fa(a,"AGI_articulations")&&q(a.extensions)&&q(a.extensions.AGI_articulations)&&(a=a.extensions.AGI_articulations.articulations,q(a)))for(var e=a.length,f=0;f<e;++f){var g=m(a[f]);g.nodes=[];g.isDirty=!0;b[g.name]=g;for(var h=g.stages.length,k=0;k<h;++k){var l=g.stages[k];l.currentValue=l.initialValue;var p=g.name+" "+l.name;c[p]=g;d[p]=l}}}function hb(a,b){return function(c){var d=a._loadResources;--d.pendingTextureLoads;d.texturesToCreate.enqueue({id:b,image:c,bufferView:c.bufferView,width:c.width,height:c.height,internalFormat:c.internalFormat})}}function Hb(a,b,c){var d=a.gltf,e=d.images,f;ba.texture(d,function(d,g){var h=d.source;q(d.extensions)&&q(d.extensions.EXT_texture_webp)&&c&&(h=d.extensions.EXT_texture_webp.source);var k=e[h],l=k.extras,m=k.bufferView,p=k.mimeType;f=k.uri;if(q(l)&&q(l.compressedImage3DTiles)){var k=l.compressedImage3DTiles.crunch,r=l.compressedImage3DTiles.s3tc,w=l.compressedImage3DTiles.pvrtc1,l=l.compressedImage3DTiles.etc1;b.s3tc&&q(k)?(p=k.mimeType,q(k.bufferView)?m=k.bufferView:f=k.uri):b.s3tc&&q(r)?(p=r.mimeType,q(r.bufferView)?m=r.bufferView:f=r.uri):b.pvrtc&&q(w)?(p=w.mimeType,q(w.bufferView)?m=w.bufferView:f=w.uri):b.etc1&&q(l)&&(p=l.mimeType,q(l.bufferView)?m=l.bufferView:f=l.uri)}q(m)?a._loadResources.texturesToCreateFromBufferView.enqueue({id:g,image:void 0,bufferView:m,mimeType:p}):(++a._loadResources.pendingTextureLoads,m=a._resource.getDerivedResource({url:f}),(Ya.test(f)?I(m):Fb.test(f)?B(m):m.fetchImage()).then(hb(a,g,h)).otherwise(Aa.getFailedLoadFunction(a,"image",m.url)))})}function db(a){var b={},c={},d=[],e=a._loadResources.skinnedNodesIds,f=a._runtime.articulationsByName;ba.node(a.gltf,function(g,h){var k={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new w,computedMatrix:new w,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:g.jointName,weights:[],children:[],parents:[],publicNode:void 0};k.publicNode=new ya(a,g,k,h,Aa.getTransform(g));b[h]=k;c[g.name]=k;q(g.skin)&&(e.push(h),d.push(k));if(q(g.extensions)&&q(g.extensions.AGI_articulations)){var l=g.extensions.AGI_articulations.articulationName;if(q(l)){var m=w.clone(k.publicNode.originalMatrix,Ac),l=f[l];l.nodes.push(k.publicNode);for(var p=l.stages.length,r=0;r<p;++r)m=Qa(l.stages[r],m);k.publicNode.matrix=m}}});a._runtime.nodes=b;a._runtime.nodesByName=c;a._runtime.skinnedNodes=d}function tb(a){var b=a._sourceTechniques,c={},d={},e=a._uniformMaps;ba.material(a.gltf,function(f,g){e[g]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var h=new Ga(a,f,g);if(q(f.extensions)&&q(f.extensions.KHR_techniques_webgl)){var k=f.extensions.KHR_techniques_webgl.technique;h._technique=k;h._program=b[k].program;ba.materialValue(f,function(a,b){q(h._values)||(h._values={});h._values[b]=m(a)})}c[f.name]=h;d[g]=h});a._runtime.materialsByName=c;a._runtime.materialsById=d}function Jc(a){var b={},c=a._runtime.materialsById;ba.mesh(a.gltf,function(d,e){b[d.name]=new Ca(d,c,e);(q(a.extensionsUsed.WEB3D_quantized_attributes)||a._dequantizeInShader)&&ba.meshPrimitive(d,function(b,c){var d=Za(a,b),f=a._programPrimitives[d];q(f)||(f={},a._programPrimitives[d]=f);f[e+".primitive."+c]=b})});a._runtime.meshesByName=b}function cc(a,b,c){var d=b._loadResources,e=b.gltf.bufferViews[a];q(e)||(e=d.createdBufferViews[a]);c=O.createVertexBuffer({context:c,typedArray:d.getBuffer(e),usage:Z.STATIC_DRAW});c.vertexArrayDestroyable=!1;b._rendererResources.buffers[a]=c;b._geometryByteLength+=c.sizeInBytes}function sc(a,b,c,d){var e=c._loadResources,f=c.gltf.bufferViews[a];q(f)||(f=e.createdBufferViews[a]);b=O.createIndexBuffer({context:d,typedArray:e.getBuffer(f),usage:Z.STATIC_DRAW,indexDatatype:b});b.vertexArrayDestroyable=!1;c._rendererResources.buffers[a]=b;c._geometryByteLength+=b.sizeInBytes}function Za(a,b){var c=a._runtime.materialsById[b.material];if(q(c))return c._program}function tc(a,b,c){var d,e=c._programPrimitives[b];if(!q(e))return a;for(var f in e)if(e.hasOwnProperty(f)&&(d=e[f],Za(c,d)===b))break;c._programPrimitives[b]=void 0;if(c.extensionsUsed.WEB3D_quantized_attributes)a=Aa.modifyShaderForQuantizedAttributes(c.gltf,d,a),c._quantizedUniforms[b]=a.uniforms;else if(b=c._decodedData[f],q(b))a=Aa.modifyShaderForDracoQuantizedAttributes(c.gltf,d,a,b.attributes);else return a;return a.shader}function wc(a,b,c){q(c)&&(a=c(a,b));return a}function Xb(a,b,c){var d=a.programId;a=a.techniqueId;var e=b._sourcePrograms[d],f=b._rendererResources.sourceShaders,g=f[e.vertexShader],f=f[e.fragmentShader],h=b._quantizedVertexShaders,e=b._toClipCoordinatesGLSL[d];if(b.extensionsUsed.WEB3D_quantized_attributes||b._dequantizeInShader){var k=h[d];q(k)||(k=tc(g,d,b),h[d]=k);g=k}g=wc(g,d,b._vertexShaderLoaded);f=wc(f,d,b._fragmentShaderLoaded);y.isInternetExplorer()||(g=Aa.modifyVertexShaderForLogDepth(g,e),f=Aa.modifyFragmentShaderForLogDepth(f));q(b._uniformMapLoaded)||(f="uniform vec4 czm_pickColor;\n"+f);(e=0<b._imageBasedLightingFactor.x||0<b._imageBasedLightingFactor.y)&&(f="#define USE_IBL_LIGHTING \n\n"+f);q(b._lightColor)&&(f="#define USE_CUSTOM_LIGHT_COLOR \n\n"+f);if("2.0"!==b._sourceVersion||b._sourceKHRTechniquesWebGL)f=Y.replaceMain(f,"non_gamma_corrected_main"),f+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor \x3d czm_gammaCorrect(gl_FragColor); \n} \n";if(Ua.isSupported(c)){h=q(b._sphericalHarmonicCoefficients)||b._useDefaultSphericalHarmonics;k=q(b._specularEnvironmentMapAtlas)&&b._specularEnvironmentMapAtlas.ready||b._useDefaultSpecularMaps;if(h||k||e)f="uniform mat4 gltf_clippingPlanesMatrix; \n"+f;q(b._sphericalHarmonicCoefficients)?f="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+f:b._useDefaultSphericalHarmonics&&(f="#define DIFFUSE_IBL \n"+f);q(b._specularEnvironmentMapAtlas)&&b._specularEnvironmentMapAtlas.ready?f="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+f:b._useDefaultSpecularMaps&&(f="#define SPECULAR_IBL \n"+f)}q(b._luminanceAtZenith)&&(f="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+f);dc(d,a,f,g,b,c)}function dc(a,b,c,d,e,f){b=Aa.createAttributeLocations(e._sourceTechniques[b],e._precreatedAttributes);e._rendererResources.programs[a]=R.fromCache({context:f,vertexShaderSource:d,fragmentShaderSource:c,attributeLocations:b})}function ja(a,b){return function(c){a.texturesToCreate.enqueue({id:b.id,image:c,bufferView:void 0});--a.pendingBufferViewToImage}}function uc(a){var b=a._loadResources;if(b.createSamplers){b.createSamplers=!1;var c=a._rendererResources.samplers;ba.sampler(a.gltf,function(a,b){c[b]=new M({wrapS:a.wrapS,wrapT:a.wrapT,minificationFilter:a.minFilter,magnificationFilter:a.magFilter})})}}function ec(a,b,c){var d=b.gltf.textures[a.id],e=b._rendererResources.samplers[d.sampler];q(e)||(e=new M({wrapS:F.REPEAT,wrapT:F.REPEAT}));for(var f=!1,g=b.gltf.materials,h=g.length,k=0;k<h;++k){var l=g[k];if(q(l.extensions)&&q(l.extensions.KHR_techniques_webgl)){var l=l.extensions.KHR_techniques_webgl.values,m;for(m in l)if(l.hasOwnProperty(m)&&-1!==m.indexOf("Texture")){var p=l[m];if(p.index===a.id&&q(p.extensions)&&q(p.extensions.KHR_texture_transform)){f=!0;break}}}if(f)break}h=e.wrapS;k=e.wrapT;m=e.minificationFilter;f&&m!==S.LINEAR&&m!==S.NEAREST&&(m=m===S.NEAREST_MIPMAP_NEAREST||m===S.NEAREST_MIPMAP_LINEAR?S.NEAREST:S.LINEAR,e=new M({wrapS:e.wrapS,wrapT:e.wrapT,textureMinificationFilter:m,textureMagnificationFilter:e.magnificationFilter}));var g=a.internalFormat,k=(f=!(q(g)&&G.isCompressedFormat(g))&&(m===S.NEAREST_MIPMAP_NEAREST||m===S.NEAREST_MIPMAP_LINEAR||m===S.LINEAR_MIPMAP_NEAREST||m===S.LINEAR_MIPMAP_LINEAR))||h===F.REPEAT||h===F.MIRRORED_REPEAT||k===F.REPEAT||k===F.MIRRORED_REPEAT,r,h=a.image;q(g)?r=new Q({context:c,source:{arrayBufferView:a.bufferView},width:a.width,height:a.height,pixelFormat:g,sampler:e}):q(h)&&(r=!H.isPowerOfTwo(h.width)||!H.isPowerOfTwo(h.height),k&&r&&(r=document.createElement("canvas"),r.width=H.nextPowerOfTwo(h.width),r.height=H.nextPowerOfTwo(h.height),r.getContext("2d").drawImage(h,0,0,h.width,h.height,0,0,r.width,r.height),h=r),r=new Q({context:c,source:h,pixelFormat:d.internalFormat,pixelDatatype:d.type,sampler:e,flipY:!1}),f&&r.generateMipmap());q(r)&&(b._rendererResources.textures[a.id]=r,b._texturesByteLength+=r.sizeInBytes)}function ad(a,b){var c=a._sourceTechniques,d={},e,f;f=a._runtime.materialsById[b.material];if(!q(f))return d;f=c[f._technique];if(!q(f))return d;c=f.attributes;f=a._rendererResources.programs[f.program];var g=f.vertexAttributes,h=f._attributeLocations;for(e in g)if(g.hasOwnProperty(e)){var k=c[e];q(k)&&(f=h[e],d[k.semantic]=f)}c=a._precreatedAttributes;if(q(c))for(e in c)c.hasOwnProperty(e)&&(f=h[e],d[e]=f);return d}function Dc(a,b){for(var c=a.gltf,d=c.skins,c=c.nodes,e=a._runtime.nodes,f=a._loadResources.skinnedNodesIds,g=f.length,h=0;h<g;++h){var k=f[h],l=e[k],k=c[k],m=b[k.skin];l.inverseBindMatrices=m.inverseBindMatrices;l.bindShapeMatrix=m.bindShapeMatrix;var m=[],p=d[k.skin];q(p.skeleton)&&m.push(p.skeleton);for(var p=c,r=m.length,w={},t=0;t<r;++t)for(var u=[m[t]];0<u.length;){var v=u.pop(),E=p[v];q(E)&&(w[v]=v);v=E.children;if(q(v))for(var E=v.length,y=0;y<E;++y)u.push(v[y])}m=w;k=d[k.skin].joints;p=k.length;for(r=0;r<p;++r)l.joints.push(e[m[k[r]]])}}function fc(a){var b=a._loadResources;if(0===b.pendingBufferLoads&&b.createSkins){b.createSkins=!1;var b=a.gltf,c=b.accessors,d={};ba.skin(b,function(b,e){var f=c[b.inverseBindMatrices],g;w.equals(b.bindShapeMatrix,w.IDENTITY)||(g=w.clone(b.bindShapeMatrix));d[e]={inverseBindMatrices:Ba.getSkinInverseBindMatrices(a,f),bindShapeMatrix:g}});Dc(a,d)}}function Pa(a,b,c,d){return function(e){q(d)&&(e=a.clampAnimations?d.clampTime(e):d.wrapTime(e),b[c]=d.evaluate(e,b[c]),b.dirtyNumber=a._maxDirtyNumber)}}function Vc(a){var b=a._loadResources;if(b.finishedPendingBufferLoads()&&b.createRuntimeAnimations){b.createRuntimeAnimations=!1;a._runtime.animations=[];var c=a._runtime.nodes,d=a.gltf.accessors;ba.animation(a.gltf,function(b,e){for(var f=b.channels,g=b.samplers,h=Number.MAX_VALUE,k=-Number.MAX_VALUE,l=f.length,m=Array(l),p=0;p<l;++p){var q=f[p],r=q.target,w=r.path,t=g[q.sampler],u=Ba.getAnimationParameterValues(a,d[t.input]),v=Ba.getAnimationParameterValues(a,d[t.output]),h=Math.min(h,u[0]),k=Math.max(k,u[u.length-1]),q=Ba.getAnimationSpline(a,e,b,q.sampler,t,u,w,v);m[p]=Pa(a,c[r.node],r.path,q)}a._runtime.animations[e]={name:b.name,startTime:h,stopTime:k,channelEvaluators:m}})}}function xc(a,b){var c=a._loadResources;if(c.finishedBuffersCreation()&&c.finishedProgramCreation()&&c.createVertexArrays){c.createVertexArrays=!1;var d=a._rendererResources.buffers,e=a._rendererResources.vertexArrays,f=a.gltf,g=f.accessors;ba.mesh(f,function(c,h){ba.meshPrimitive(c,function(c,k){var l=[],m,p=ad(a,c),r=a._decodedData[h+".primitive."+k];ba.meshPrimitiveAttribute(c,function(a,b){m=p[b];if(q(m)){if(q(r)){var c=r.attributes;if(c.hasOwnProperty(b)){c=c[b];l.push({index:m,vertexBuffer:d[c.bufferView],componentsPerAttribute:c.componentsPerAttribute,componentDatatype:c.componentDatatype,normalize:c.normalized,offsetInBytes:c.byteOffset,strideInBytes:c.byteStride});return}}var c=g[a],e=q(c.normalized)&&c.normalized;l.push({index:m,vertexBuffer:d[c.bufferView],componentsPerAttribute:ga(c.type),componentDatatype:c.componentType,normalize:e,offsetInBytes:c.byteOffset,strideInBytes:X(f,c)})}});var w,t,u=a._precreatedAttributes;if(q(u))for(t in u)u.hasOwnProperty(t)&&(m=p[t],q(m)&&(w=u[t],w.index=m,l.push(w)));var v;q(c.indices)&&(w=g[c.indices].bufferView,q(r)&&(w=r.bufferView),v=d[w]);e[h+".primitive."+k]=new T({context:b,attributes:l,indexBuffer:v})})})}}function Kc(a){var b=a._loadResources;b.createRenderStates&&(b.createRenderStates=!1,ba.material(a.gltf,function(b,c){var d=a._rendererResources.renderStates,e=[N.FUNC_ADD,N.FUNC_ADD],f=[N.ONE,N.ONE_MINUS_SRC_ALPHA,N.ONE,N.ONE_MINUS_SRC_ALPHA];q(b.extensions)&&q(b.extensions.KHR_blend)&&(e=b.extensions.KHR_blend.blendEquation,f=b.extensions.KHR_blend.blendFactors);var g="BLEND"===b.alphaMode;d[c]=W.fromCache({cull:{enabled:!b.doubleSided},depthTest:{enabled:!0},depthMask:!g,blending:{enabled:g,equationRgb:e[0],equationAlpha:e[1],functionSourceRgb:f[0],functionDestinationRgb:f[1],functionSourceAlpha:f[2],functionDestinationAlpha:f[3]}})}))}function Lc(a,b,c,e,f,g,h){var k={},l={},m,p;ba.techniqueUniform(c,function(c,r){var w;q(e)&&q(e[r])?(w=Aa.createUniformFunction(c.type,e[r],g,h),k[r]=w.func,l[r]=w):q(c.node)?(w=jb[c.semantic](f.uniformState,a,a._runtime.nodes[c.node]),k[r]=w):q(c.semantic)?"JOINTMATRIX"===c.semantic?m=r:"MORPHWEIGHTS"===c.semantic?p=r:"ALPHACUTOFF"===c.semantic?(w=b.alphaMode,q(w)&&"MASK"===w&&(w=d(b.alphaCutoff,.5),w=Aa.createUniformFunction(c.type,w,g,h),k[r]=w.func,l[r]=w)):k[r]=Aa.getGltfSemanticUniforms()[c.semantic](f.uniformState,a):q(c.value)&&(w=Aa.createUniformFunction(c.type,c.value,g,h),k[r]=w.func,l[r]=w)});return{map:k,values:l,jointMatrixUniformName:m,morphWeightsUniformName:p}}function Oc(a,b){var c=a._loadResources;if(c.finishedProgramCreation()&&c.createUniformMaps){c.createUniformMaps=!1;var d=a._sourceTechniques,e=a._uniformMaps,f=a._rendererResources.textures,g=a._defaultTexture;ba.material(a.gltf,function(c,h){var k=a._runtime.materialsById[h],k=Lc(a,c,d[k._technique],k._values,b,f,g),l=e[h];l.uniformMap=k.map;l.values=k.values;l.jointMatrixUniformName=k.jointMatrixUniformName;l.morphWeightsUniformName=k.morphWeightsUniformName})}}function ed(a){return function(){return a}}function Rc(a){return function(){return a.computedJointMatrices}}function Pc(a){return function(){return a.weights}}function bd(a){return function(){return a.silhouetteColor}}function Mc(a){return function(){return a.silhouetteSize}}function Yb(a){return function(){return a.color}}function Sc(a){return function(){var b=a.clippingPlanes;if(!q(b)&&!q(a._sphericalHarmonicCoefficients)&&!q(a._specularEnvironmentMaps))return w.IDENTITY;b=q(b)?b.modelMatrix:w.IDENTITY;return w.multiply(a._clippingPlaneModelViewMatrix,b,Jb)}}function ab(a){return function(){var b=a.clippingPlanes;return q(b)&&b.enabled?b.texture:a._defaultTexture}}function Ab(a){return function(){var b=a.clippingPlanes;if(!q(b))return e.WHITE.withAlpha(0);var c=e.clone(b.edgeColor);c.alpha=b.edgeWidth;return c}}function qb(a){return function(){return qa.getColorBlend(a.colorBlendMode,a.colorBlendAmount)}}function yc(a){return function(){return a._imageBasedLightingFactor}}function vb(a){return function(){return a._lightColor}}function vc(a){return function(){return a.luminanceAtZenith}}function ma(a){return function(){return a._sphericalHarmonicCoefficients}}function Ib(a){return function(){return a._specularEnvironmentMapAtlas.texture}}function ib(a){return function(){return a._specularEnvironmentMapAtlas.texture.dimensions}}function zc(a){return function(){return a._specularEnvironmentMapAtlas.maximumMipmapLevel}}function Bc(a,c){var d=c.context,e=c.scene3DOnly,g=a._quantizedVertexShaders,k=a._toClipCoordinatesGLSL={},l=a._sourceTechniques,m=a._sourcePrograms,p=a._rendererResources,r=p.sourceShaders;a._loadRendererResourcesFromCache&&(r=p.sourceShaders=a._cachedRendererResources.sourceShaders);for(var t in l)if(l.hasOwnProperty(t)){var u=l[t].program,v=m[u],y=r[v.vertexShader];Aa.checkSupportedGlExtensions(v.glExtensions,d);if(a.extensionsUsed.WEB3D_quantized_attributes||a._dequantizeInShader){var z=g[u];q(z)||(z=tc(y,u,a),g[u]=z);y=z}y=wc(y,u,a._vertexShaderLoaded);k[u]=Aa.toClipCoordinatesGLSL(a.gltf,y)}if(a._loadRendererResourcesFromCache){var A=a._cachedRendererResources;p.buffers=A.buffers;p.vertexArrays=A.vertexArrays;p.programs=A.programs;p.silhouettePrograms=A.silhouettePrograms;p.textures=A.textures;p.samplers=A.samplers;p.renderStates=A.renderStates;q(a._precreatedAttributes)&&xc(a,d);var G=a._cachedGeometryByteLength,x=A.buffers,K=0,H;for(H in x)x.hasOwnProperty(H)&&(K+=x[H].sizeInBytes);a._cachedGeometryByteLength=G+K;var M=a._cachedTexturesByteLength,O=A.textures,J=0,R;for(R in O)O.hasOwnProperty(R)&&(J+=O[R].sizeInBytes);a._cachedTexturesByteLength=M+J}else{var T=a._loadResources;if(0===T.pendingBufferLoads){var P=c.context,Q=T.vertexBuffersToCreate,N=T.indexBuffersToCreate,V;if(a.asynchronous){for(;0<Q.length;){ic.set(Q.peek(),a,P);if(!c.jobScheduler.execute(ic,Da.BUFFER))break;Q.dequeue()}for(;0<N.length;){V=N.peek();ob.set(V.id,V.componentType,a,P);if(!c.jobScheduler.execute(ob,Da.BUFFER))break;N.dequeue()}}else{for(;0<Q.length;)cc(Q.dequeue(),a,P);for(;0<N.length;)V=N.dequeue(),sc(V.id,V.componentType,a,P)}}var W=a._loadResources,Z=W.programsToCreate;if(0===W.pendingShaderLoads&&0===W.pendingBufferLoads){var da=c.context;if(a.asynchronous)for(;0<Z.length;){Rb.set(Z.peek(),a,da);if(!c.jobScheduler.execute(Rb,Da.PROGRAM))break;Z.dequeue()}else for(;0<Z.length;)Xb(Z.dequeue(),a,da)}uc(a,d);var Y=a._loadResources;if(0===Y.pendingBufferLoads)for(;0<Y.texturesToCreateFromBufferView.length;){var ba=Y.texturesToCreateFromBufferView.dequeue(),S=a.gltf,X=S.bufferViews[ba.bufferView],F=S.textures[ba.id].source,fa=Aa.getFailedLoadFunction(a,"image","id: "+ba.id+", bufferView: "+ba.bufferView);if("image/ktx"===ba.mimeType)I(Y.getBuffer(X)).then(hb(a,ba.id,F)).otherwise(fa),++a._loadResources.pendingTextureLoads;else if("image/crn"===ba.mimeType)B(Y.getBuffer(X)).then(hb(a,ba.id,F)).otherwise(fa),++a._loadResources.pendingTextureLoads;else{var ca=ja(Y,ba);C({uint8Array:Y.getBuffer(X),format:ba.mimeType,flipY:!1}).then(ca).otherwise(fa);++Y.pendingBufferViewToImage}}var ra=c.context,wa=a._loadResources.texturesToCreate;if(a.asynchronous)for(;0<wa.length;){jc.set(wa.peek(),a,ra);if(!c.jobScheduler.execute(jc,Da.TEXTURE))break;wa.dequeue()}else for(;0<wa.length;)ec(wa.dequeue(),a,ra)}fc(a);Vc(a);a._loadRendererResourcesFromCache||(xc(a,d),Kc(a));Oc(a,d);var la=a._loadResources;if(la.finishedEverythingButTextureCreation()&&la.createRuntimeNodes){la.createRuntimeNodes=!1;for(var Ea=[],ta=a._runtime.nodes,Ca=a.gltf,za=Ca.nodes,Ba=Ca.skins,oa=Ca.scenes[Ca.scene].nodes,Ga=oa.length,Ob=[],sa={},pa=0;pa<Ga;++pa){Ob.push({parentRuntimeNode:void 0,gltfNode:za[oa[pa]],id:oa[pa]});for(var ga=[];0<Ob.length;){var ha=Ob.pop();sa[ha.id]=!0;var Fa=ha.parentRuntimeNode,ub=ha.gltfNode,qa=ta[ha.id];if(0===qa.parents.length)if(q(ub.matrix))qa.matrix=w.fromColumnMajorArray(ub.matrix);else{var ia=ub.rotation;qa.translation=f.fromArray(ub.translation);qa.rotation=L.unpack(ia);qa.scale=f.fromArray(ub.scale)}q(Fa)?(Fa.children.push(qa),qa.parents.push(Fa)):Ea.push(qa);if(q(ub.mesh))for(var ya=a,Ua=qa,lb=d,va=e,ka=ya._nodeCommands,Qa=ya._pickIds,Oa=ya.allowPicking,Ja=ya._runtime.meshesByName,nb=ya._rendererResources,Va=nb.vertexArrays,ua=nb.programs,Ta=nb.renderStates,na=ya._uniformMaps,xa=ya.gltf,ea=xa.accessors,Cb=ub.mesh,Sa=xa.meshes[Cb],Ka=Sa.primitives,Zb=Ka.length,xb=0;xb<Zb;++xb){var Na=Ka[xb],lc=ea[Na.indices],Ma=ya._runtime.materialsById[Na.material]._program,wb=ya._decodedData[Cb+".primitive."+xb],Gc,Ia=Na.attributes.POSITION;if(q(Ia)){var Jb=Aa.getAccessorMinMax(xa,Ia);Gc=b.fromCornerPoints(f.fromArray(Jb.min),f.fromArray(Jb.max))}var Ra=Va[Cb+".primitive."+xb],jb,Wa;q(wb)?(Wa=wb.numberOfIndices,jb=0):q(lc)?(Wa=lc.count,jb=lc.byteOffset/D.getSizeInBytes(lc.componentType)):(Wa=ea[Na.attributes.POSITION].count,jb=0);var La=ya,Gb=ya._trianglesLength,yb;b:switch(Na.mode){case E.TRIANGLES:yb=Wa/3;break b;case E.TRIANGLE_STRIP:case E.TRIANGLE_FAN:yb=Math.max(Wa-2,0);break b;default:yb=0}La._trianglesLength=Gb+yb;var rb=na[Na.material],kb=rb.uniformMap;if(q(rb.jointMatrixUniformName)){var Nb={};Nb[rb.jointMatrixUniformName]=Rc(Ua);kb=h(kb,Nb)}if(q(rb.morphWeightsUniformName)){var qc={};qc[rb.morphWeightsUniformName]=Pc(Ua);kb=h(kb,qc)}kb=h(kb,{gltf_color:Yb(ya),gltf_colorBlend:qb(ya),gltf_clippingPlanes:ab(ya),gltf_clippingPlanesEdgeStyle:Ab(ya),gltf_clippingPlanesMatrix:Sc(ya),gltf_iblFactor:yc(ya),gltf_lightColor:vb(ya),gltf_sphericalHarmonicCoefficients:ma(ya),gltf_specularMap:Ib(ya),gltf_specularMapSize:ib(ya),gltf_maxSpecularLOD:zc(ya),gltf_luminanceAtZenith:vc(ya)});q(ya._uniformMapLoaded)&&(kb=ya._uniformMapLoaded(kb,Ma,Ua));var Lb={};if(ya.extensionsUsed.WEB3D_quantized_attributes)var Hb=ya,db=Na,oc=Za(Hb,db),Lb=Aa.createUniformsForQuantizedAttributes(Hb.gltf,db,Hb._quantizedUniforms[oc]);else ya._dequantizeInShader&&q(wb)&&(Lb=Aa.createUniformsForDracoQuantizedAttributes(wb.attributes));var kb=h(kb,Lb),sb=Ta[Na.material],kc=sb.blending.enabled,Vb=ya._pickObject;q(Vb)||(Vb={primitive:ya,id:ya.id,node:Ua.publicNode,mesh:Ja[Sa.name]});var Jc=Ha.castShadows(ya._shadows),tb=Ha.receiveShadows(ya._shadows),Sb;if(Oa&&!q(ya._uniformMapLoaded)){Sb=lb.createPickId(Vb);Qa.push(Sb);var dc={czm_pickColor:ed(Sb.color)},kb=h(kb,dc)}Oa&&(Sb=q(ya._pickIdLoaded)&&q(ya._uniformMapLoaded)?ya._pickIdLoaded():"czm_pickColor");var zb=new aa({boundingVolume:new b,cull:ya.cull,modelMatrix:new w,primitiveType:Na.mode,vertexArray:Ra,count:Wa,offset:jb,shaderProgram:ua[Ma],castShadows:Jc,receiveShadows:tb,uniformMap:kb,renderState:sb,owner:Vb,pass:kc?U.TRANSLUCENT:ya.opaquePass,pickId:Sb}),Tb;va||(Tb=aa.shallowClone(zb),Tb.boundingVolume=new b,Tb.modelMatrix=new w);var $b={show:!0,boundingSphere:Gc,command:zb,command2D:Tb,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,programId:Ma};Ua.commands.push($b);ka.push($b)}var fb=ub.children;if(q(fb))for(var Mb=fb.length,$a=0;$a<Mb;$a++){var Pb=fb[$a];sa[Pb]||Ob.push({parentRuntimeNode:qa,gltfNode:za[Pb],id:fb[$a]})}var eb=ub.skin;q(eb)&&ga.push(Ba[eb].skeleton);if(0===Ob.length)for(var cb=0;cb<ga.length;cb++){var bb=ga[cb];sa[bb]||Ob.push({parentRuntimeNode:void 0,gltfNode:za[bb],id:bb})}}}a._runtime.rootNodes=Ea;a._runtime.nodes=ta}}function Ec(a,b){var c=a.publicNode,d=c.matrix;c.useMatrix&&q(d)?w.clone(d,b):q(a.matrix)?w.clone(a.matrix,b):(w.fromTranslationQuaternionRotationScale(a.translation,a.rotation,a.scale,b),c.setMatrix(b))}function nc(a,c,d,e){var g=a._maxDirtyNumber,h=a._runtime.rootNodes,l=h.length,m=Gb,p=a._computedModelMatrix;if(a._mode!==xa.SCENE3D&&!a._ignoreCommands){var r=w.getColumn(p,3,kb);k.equals(r,k.UNIT_W)?(r=P.wgs84To2DModelMatrix(e,a.boundingSphere.center,Lb),p=w.multiply(r,p,Lb),q(a._rtcCenter)&&(w.setTranslation(p,k.UNIT_W,p),a._rtcCenter=a._rtcCenter2D)):(p=P.basisTo2D(e,p,Lb),a._rtcCenter=a._rtcCenter3D)}for(r=0;r<l;++r){var t=h[r];Ec(t,t.transformToRoot);for(m.push(t);0<m.length;){var t=m.pop(),u=t.transformToRoot,v=t.commands;if(t.dirtyNumber===g||c||d){var E=w.multiplyTransformation(p,u,t.computedMatrix),y=v.length;if(0<y)for(var z=0;z<y;++z){var A=v[z],B=A.command;w.clone(E,B.modelMatrix);b.transform(A.boundingSphere,B.modelMatrix,B.boundingVolume);q(a._rtcCenter)&&f.add(a._rtcCenter,B.boundingVolume.center,B.boundingVolume.center);B=A.command2D;q(B)&&a._mode===xa.SCENE2D&&(w.clone(E,B.modelMatrix),B.modelMatrix[13]-=2*H.sign(B.modelMatrix[13])*H.PI*e.ellipsoid.maximumRadius,b.transform(A.boundingSphere,B.modelMatrix,B.boundingVolume))}}v=t.children;if(q(v))for(E=v.length,y=0;y<E;++y){z=v[y];z.dirtyNumber=Math.max(z.dirtyNumber,t.dirtyNumber);if(z.dirtyNumber===g||d)Ec(z,z.transformToRoot),w.multiplyTransformation(u,z.transformToRoot,z.transformToRoot);m.push(z)}}}++a._maxDirtyNumber}function gc(a){a=a._runtime.skinnedNodes;for(var b=a.length,c=0;c<b;++c){var d=a[c];kc=w.inverseTransformation(d.transformToRoot,kc);for(var e=d.computedJointMatrices,f=d.joints,g=d.bindShapeMatrix,d=d.inverseBindMatrices,h=d.length,k=0;k<h;++k)q(e[k])||(e[k]=new w),e[k]=w.multiplyTransformation(kc,f[k].transformToRoot,e[k]),e[k]=w.multiplyTransformation(e[k],d[k],e[k]),q(g)&&(e[k]=w.multiplyTransformation(e[k],g,e[k]))}}function hc(a){a=a._runtime.rootNodes;for(var b=a.length,c=Gb,d=0;d<b;++d){var e=a[d];e.computedShow=e.publicNode.show;for(c.push(e);0<c.length;){for(var e=c.pop(),f=e.computedShow,g=e.commands,h=g.length,k=0;k<h;++k)g[k].show=f;e=e.children;if(q(e))for(g=e.length,h=0;h<g;++h)k=e[h],k.computedShow=f&&k.publicNode.show,c.push(k)}}}function Fc(a,b){var c=a.id;if(a._id!==c){a._id=c;for(var d=a._pickIds,e=d.length,f=0;f<e;++f)d[f].object.id=c}}function mb(a){if(a._debugWireframe!==a.debugWireframe){var b=(a._debugWireframe=a.debugWireframe)?E.LINES:E.TRIANGLES;a=a._nodeCommands;for(var c=a.length,d=0;d<c;++d)a[d].command.primitiveType=b}}function gb(a){if(a.debugShowBoundingVolume!==a._debugShowBoundingVolume){var b=a._debugShowBoundingVolume=a.debugShowBoundingVolume;a=a._nodeCommands;for(var c=a.length,d=0;d<c;++d)a[d].command.debugShowBoundingVolume=b}}function Zb(a){if(a.shadows!==a._shadows){a._shadows=a.shadows;var b=Ha.castShadows(a.shadows),c=Ha.receiveShadows(a.shadows);a=a._nodeCommands;for(var d=a.length,e=0;e<d;e++){var f=a[e];f.command.castShadows=b;f.command.receiveShadows=c}}}function Gc(a){var b=aa.shallowClone(a);b.pass=U.TRANSLUCENT;a=m(a.renderState,!0);a.cull.enabled=!1;a.depthTest.enabled=!0;a.depthMask=!1;a.blending=pa.ALPHA_BLEND;a=W.fromCache(a);b.renderState=a;return b}function Na(a,b,c){b=b.scene3DOnly;var d=a.color.alpha;if(0<d&&1>d&&(a=a._nodeCommands,d=a.length,!q(a[0].translucentCommand)||c))for(c=0;c<d;++c){var e=a[c];e.translucentCommand=Gc(e.command);b||(e.translucentCommand2D=Gc(e.command2D))}}function Ob(a){return 0<a.color.alpha&&1>a.color.alpha}function lb(a,b){return Math.floor(a)!==Math.floor(b)||Math.ceil(a)!==Math.ceil(b)}function nb(a,b,c){if(b.context.stencilBuffer&&0<a.silhouetteSize&&0<a.silhouetteColor.alpha&&q(a._normalAttributeName)){var d=a._nodeCommands,d=lb(a.color.alpha,a._colorPreviousAlpha)||lb(a.silhouetteColor.alpha,a._silhouetteColorPreviousAlpha)||!q(d[0].silhouetteModelCommand);a._colorPreviousAlpha=a.color.alpha;a._silhouetteColorPreviousAlpha=a.silhouetteColor.alpha;if(d||c){c=++Vb%255;a:{for(var d=a._nodeCommands,e=d.length,f=0;f<e;++f)if(d[f].command.pass===U.TRANSLUCENT){d=!0;break a}d=!1}for(var d=d||Ob(a)||1>a.silhouetteColor.alpha,e=a._rendererResources.silhouettePrograms,f=b.scene3DOnly,g=a._nodeCommands,k=g.length,l=0;l<k;++l){var p=g[l],r=p.command,w=Ob(a)?p.translucentCommand:r,t=aa.shallowClone(w),u=m(w.renderState);u.stencilTest={enabled:!0,frontFunction:N.ALWAYS,backFunction:N.ALWAYS,reference:c,mask:-1,frontOperation:{fail:N.KEEP,zFail:N.KEEP,zPass:N.REPLACE},backOperation:{fail:N.KEEP,zFail:N.KEEP,zPass:N.REPLACE}};0===a.color.alpha&&(u.colorMask={red:!1,green:!1,blue:!1,alpha:!1},u.depthMask=!1);u=W.fromCache(u);t.renderState=u;p.silhouetteModelCommand=t;w=aa.shallowClone(r);u=m(r.renderState,!0);u.depthTest.enabled=!0;u.cull.enabled=!1;d&&(w.pass=U.TRANSLUCENT,u.depthMask=!1,u.blending=pa.ALPHA_BLEND);u.stencilTest={enabled:!0,frontFunction:N.NOTEQUAL,backFunction:N.NOTEQUAL,reference:c,mask:-1,frontOperation:{fail:N.KEEP,zFail:N.KEEP,zPass:N.KEEP},backOperation:{fail:N.KEEP,zFail:N.KEEP,zPass:N.KEEP}};var u=W.fromCache(u),v=r.shaderProgram,E;a:{E=v;var y=a._rendererResources.programs,z=void 0;for(z in y)if(y.hasOwnProperty(z)&&y[z]===E){E=z;break a}E=void 0}y=e[E];if(!q(y)){var y=b,z=v.vertexShaderSource.sources[0],v=v._attributeLocations,A=a._normalAttributeName,z=Y.replaceMain(z,"gltf_silhouette_main"),y=R.fromCache({context:y.context,vertexShaderSource:z+("uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n \x3d normalize(czm_normal3D * "+A+"); \n    n.x *\x3d czm_projection[0][0]; \n    n.y *\x3d czm_projection[1][1]; \n    vec4 clip \x3d gl_Position; \n    clip.xy +\x3d n.xy * clip.w * gltf_silhouetteSize / czm_viewport.z; \n    gl_Position \x3d clip; \n}"),fragmentShaderSource:"uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor \x3d czm_gammaCorrect(gltf_silhouetteColor); \n}",attributeLocations:v});e[E]=y}r=h(r.uniformMap,{gltf_silhouetteColor:bd(a),gltf_silhouetteSize:Mc(a)});w.renderState=u;w.shaderProgram=y;w.uniformMap=r;w.castShadows=!1;w.receiveShadows=!1;p.silhouetteColorCommand=w;f||(r=p.command2D,t=aa.shallowClone(t),t.boundingVolume=r.boundingVolume,t.modelMatrix=r.modelMatrix,p.silhouetteModelCommand2D=t,w=aa.shallowClone(w),t.boundingVolume=r.boundingVolume,t.modelMatrix=r.modelMatrix,p.silhouetteColorCommand2D=w)}}}}function Cb(a,b){var c=a._clippingPlanes;q(c)&&c.owner===a&&c.enabled&&c.update(b)}function wb(a,b){var c=a.scale;if(0!==a.minimumPixelSize){var d=b.context,d=Math.max(d.drawingBufferWidth,d.drawingBufferHeight),e=q(a._clampedModelMatrix)?a._clampedModelMatrix:a.modelMatrix;fb.x=e[12];fb.y=e[13];fb.z=e[14];q(a._rtcCenter)&&f.add(a._rtcCenter,fb,fb);if(a._mode!==xa.SCENE3D){var e=b.mapProjection,g=e.ellipsoid.cartesianToCartographic(fb,zb);e.project(g,fb);f.fromElements(fb.z,fb.x,fb.y,fb)}e=a.boundingSphere.radius;Tb.center=fb;Tb.radius=e;g=b.camera.getPixelSize(Tb,b.context.drawingBufferWidth,b.context.drawingBufferHeight);Math.min(1/g*2*e,d)<a.minimumPixelSize&&(c=a.minimumPixelSize*g/(2*a._initialRadius))}return q(a.maximumScale)?Math.min(a.maximumScale,c):c}function xb(a){q(a._cacheKey)&&q(a._cachedGltf)&&0===--a._cachedGltf.count&&delete eb[a._cacheKey];a._cachedGltf=void 0}function rb(a,b){this.renderStates=this.samplers=this.textures=this.silhouettePrograms=this.sourceShaders=this.programs=this.vertexArrays=this.buffers=void 0;this.ready=!1;this.context=a;this.cacheKey=b;this.count=0}function yb(a){for(var b in a)a.hasOwnProperty(b)&&a[b].destroy()}function oc(a,b,c){return function(d){if(a.heightReference===za.RELATIVE_TO_GROUND){var e=b.cartesianToCartographic(d,zb);e.height+=c.height;b.cartographicToCartesian(e,d)}e=a._clampedModelMatrix;w.clone(a.modelMatrix,e);e[12]=d.x;e[13]=d.y;e[14]=d.z;a._heightChanged=!0}}function sb(a){q(a._removeUpdateHeightCallback)&&(a._removeUpdateHeightCallback(),a._removeUpdateHeightCallback=void 0);var b=a._scene;if(q(b)&&q(b.globe)&&a.heightReference!==za.NONE){var d=b.globe,b=d.ellipsoid,e=a.modelMatrix;fb.x=e[12];fb.y=e[13];fb.z=e[14];var f=b.cartesianToCartographic(fb);q(a._clampedModelMatrix)||(a._clampedModelMatrix=w.clone(e,new w));a._removeUpdateHeightCallback=d._surface.updateHeight(f,oc(a,b,f));d=d.getHeight(f);q(d)&&(a=oc(a,b,f),g.clone(f,zb),zb.height=d,b.cartographicToCartesian(zb,fb),a(fb))}else{if(a.heightReference!==za.NONE)throw new c("Height reference is not supported without a scene and globe.");a._clampedModelMatrix=void 0}}function Sb(a,b){var c,d=a.distanceDisplayCondition,e=d.near*d.near,d=d.far*d.far;if(b.mode===xa.SCENE2D)c=.5*(b.camera.frustum.right-b.camera.frustum.left),c*=c;else{c=w.getTranslation(a.modelMatrix,Mb);if(b.mode===xa.COLUMBUS_VIEW){var g=b.mapProjection,h=g.ellipsoid.cartesianToCartographic(c,$a);c=g.project(h,c);f.fromElements(c.z,c.x,c.y,c)}c=f.distanceSquared(c,b.camera.positionWC)}return c>=e&&c<=d}function Pb(a,b){a.programs!==b.programs&&yb(a.programs);a.silhouettePrograms!==b.silhouettePrograms&&yb(a.silhouettePrograms)}function $b(a,b){var c=a._rendererResources,d=a._cachedRendererResources;Pb(c,d);var e;if(Fa(a)||La(a)||a._shouldRegenerateShaders){a._shouldRegenerateShaders=!1;c.programs={};c.silhouettePrograms={};var d={},f=a._sourceTechniques,g,h;for(h in f)if(f.hasOwnProperty(h)&&(g=f[h],e=g.program,!d[e])){d[e]=!0;g=a;var k=b.context,l=h,m=g._sourcePrograms[e],p=g._rendererResources.sourceShaders,r=g._quantizedVertexShaders,w=g._toClipCoordinatesGLSL[e],t=g.clippingPlanes,u=Fa(g),v=p[m.vertexShader],m=p[m.fragmentShader];if(g.extensionsUsed.WEB3D_quantized_attributes||g._dequantizeInShader)v=r[e];r=m;La(g)&&(r=Ia._modifyShaderForColor(r));u&&(m=k,r=Y.replaceMain(r,"gltf_clip_main"),r+=Ia._getClippingFunction(t,m)+"\n",r+="uniform sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+ta("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n");v=wc(v,e,g._vertexShaderLoaded);t=wc(r,e,g._fragmentShaderLoaded);y.isInternetExplorer()||(v=Aa.modifyVertexShaderForLogDepth(v,w),t=Aa.modifyFragmentShaderForLogDepth(t));q(g._uniformMapLoaded)||(t="uniform vec4 czm_pickColor;\n"+t);(w=0<g._imageBasedLightingFactor.x||0<g._imageBasedLightingFactor.y)&&(t="#define USE_IBL_LIGHTING \n\n"+t);q(g._lightColor)&&(t="#define USE_CUSTOM_LIGHT_COLOR \n\n"+t);if("2.0"!==g._sourceVersion||g._sourceKHRTechniquesWebGL)t=Y.replaceMain(t,"non_gamma_corrected_main"),t+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor \x3d czm_gammaCorrect(gl_FragColor); \n} \n";Ua.isSupported(k)&&(r=q(g._sphericalHarmonicCoefficients)||g._useDefaultSphericalHarmonics,m=q(g._specularEnvironmentMapAtlas)&&g._specularEnvironmentMapAtlas.ready||g._useDefaultSpecularMaps,!u&&(r||m||w)&&(t="uniform mat4 gltf_clippingPlanesMatrix; \n"+t),q(g._sphericalHarmonicCoefficients)?t="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+t:g._useDefaultSphericalHarmonics&&(t="#define DIFFUSE_IBL \n"+t),q(g._specularEnvironmentMapAtlas)&&g._specularEnvironmentMapAtlas.ready?t="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+t:g._useDefaultSpecularMaps&&(t="#define SPECULAR_IBL \n"+t));q(g._luminanceAtZenith)&&(t="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+t);dc(e,l,t,v,g,k)}}else c.programs=d.programs,c.silhouettePrograms=d.silhouettePrograms;c=c.programs;h=a._nodeCommands;d=h.length;for(f=0;f<d;++f)g=h[f],e=g.programId,k=c[e],g.command.shaderProgram=k,q(g.command2D)&&(g.command2D.shaderProgram=k);Na(a,b,!0);nb(a,b,!0)}if(!y.supportsTypedArrays())return{};var Tc=new f,Db=Aa.ModelState,Eb=H.EPSILON16;t(ca.prototype,{gltf:{set:function(a){this._gltf=a},get:function(){return this._gltf}}});ca.prototype.makeReady=function(a){this.gltf=a;a=this.modelsToLoad;for(var b=a.length,c=0;c<b;++c){var d=a[c];d.isDestroyed()||(d._cachedGltf=this)}this.modelsToLoad=void 0;this.ready=!0};var eb={},ea={};t(Ia.prototype,{gltf:{get:function(){return q(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){if(this._state!==Db.LOADED)throw new c("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");var a=this.modelMatrix;this.heightReference!==za.NONE&&this._clampedModelMatrix&&(a=this._clampedModelMatrix);var a=w.getScale(a,Tc),b=q(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;f.multiplyByScalar(a,b,a);b=this._scaledBoundingSphere;b.center=f.multiplyComponents(this._boundingSphere.center,a,b.center);b.radius=f.maximumComponent(a)*this._initialRadius;q(this._rtcCenter)&&f.add(this._rtcCenter,b.center,b.center);return b}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return q(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(a){if(q(a)&&a.far<=a.near)throw new c("far must be greater than near");this._distanceDisplayCondition=u.clone(a,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){q(this._extensionsUsed)||(this._extensionsUsed=Aa.getUsedExtensions(this.gltf));return this._extensionsUsed}},extensionsRequired:{get:function(){q(this._extensionsRequired)||(this._extensionsRequired=Aa.getRequiredExtensions(this.gltf));return this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return q(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(a){a!==this._clippingPlanes&&oa.setOwner(a,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(b){l.typeOf.object("imageBasedLightingFactor",b);l.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",b.x,0);l.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",b.x,1);l.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",b.y,0);l.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",b.y,1);var c=this._imageBasedLightingFactor;b===c||a.equals(b,c)||(this._shouldRegenerateShaders=(this._shouldRegenerateShaders=this._shouldRegenerateShaders||0<this._imageBasedLightingFactor.x&&0===b.x||0===this._imageBasedLightingFactor.x&&0<b.x)||0<this._imageBasedLightingFactor.y&&0===b.y||0===this._imageBasedLightingFactor.y&&0<b.y,a.clone(b,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(a){var b=this._lightColor;a===b||f.equals(a,b)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||q(b)&&!q(a)||q(a)&&!q(b),this._lightColor=f.clone(a,b))}},enableLighting:{get:function(){return this._enableLighting},set:function(a){this._enableLighting=a}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(a){var b=this._luminanceAtZenith;a!==b&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||q(b)&&!q(a)||q(a)&&!q(b),this._luminanceAtZenith=a)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(a){if(q(a)&&(!v(a)||9!==a.length))throw new c("sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");a!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=a,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(a){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||a!==this._specularEnvironmentMaps;this._specularEnvironmentMaps=a}}});Ia.silhouetteSupported=function(a){return a.context.stencilBuffer};Ia.fromGltf=function(a){if(!q(a)||!q(a.url))throw new c("options.url is required");var b=a.url;a=m(a);var b=K.createIfNeeded(b),e=d(a.basePath,b.clone()),f=K.createIfNeeded(e),e=d(a.cacheKey,ea[A(b.url)]);q(e)||(e=p(),ea[A(b.url)]=e);q(a.basePath)&&!q(a.cacheKey)&&(e+=f.url);a.cacheKey=e;a.basePath=f;a=new Ia(a);var g=eb[e];q(g)?g.ready||(++g.count,g.modelsToLoad.push(a)):(g=new ca({ready:!1}),g.count=1,g.modelsToLoad.push(a),a._cachedGltf=g,eb[e]=g,q(b.headers.Accept)||(b.headers.Accept="model/gltf-binary,model/gltf+json;q\x3d0.8,application/json;q\x3d0.2,*/*;q\x3d0.01"),b.fetchArrayBuffer().then(function(a){a=new Uint8Array(a);"glTF"===z(a)?(a=ka(a),g.makeReady(a)):(a=x(a),g.makeReady(JSON.parse(a)))}).otherwise(Aa.getFailedLoadFunction(a,"model",b.url)));return a};Ia._gltfCache=eb;Ia.prototype.getNode=function(a){a=Ja(this,"nodesByName",a);return q(a)?a.publicNode:void 0};Ia.prototype.getMesh=function(a){return Ja(this,"meshesByName",a)};Ia.prototype.getMaterial=function(a){return Ja(this,"materialsByName",a)};Ia.prototype.setArticulationStage=function(a,b){l.typeOf.number("value",b);var c=Ja(this,"stagesByKey",a),d=Ja(this,"articulationsByStageKey",a);q(c)&&q(d)&&(b=H.clamp(b,c.minimumValue,c.maximumValue),H.equalsEpsilon(c.currentValue,b,Eb)||(c.currentValue=b,d.isDirty=!0))};var Qb=new f,bb=new J,cb=new w;Ia.prototype.applyArticulations=function(){var a=this._runtime.articulationsByName,b;for(b in a)if(a.hasOwnProperty(b)){var c=a[b];if(c.isDirty){c.isDirty=!1;for(var d=c.nodes.length,e=0;e<d;++e){for(var f=c.nodes[e],g=w.clone(f.originalMatrix,cb),h=c.stages.length,k=0;k<h;++k)g=Qa(c.stages[k],g);f.matrix=g}}}};var Ya=/(^data:image\/ktx)|(\.ktx$)/i,Fb=/(^data:image\/crn)|(\.crn$)/i,Ac=new w,Xa=function(){this.context=this.model=this.id=void 0};Xa.prototype.set=function(a,b,c){this.id=a;this.model=b;this.context=c};Xa.prototype.execute=function(){cc(this.id,this.model,this.context)};var pc=function(){this.context=this.model=this.componentType=this.id=void 0};pc.prototype.set=function(a,b,c,d){this.id=a;this.componentType=b;this.model=c;this.context=d};pc.prototype.execute=function(){sc(this.id,this.componentType,this.model,this.context)};var ic=new Xa,ob=new pc,Kb=function(){this.context=this.model=this.programToCreate=void 0};Kb.prototype.set=function(a,b,c){this.programToCreate=a;this.model=b;this.context=c};Kb.prototype.execute=function(){Xb(this.programToCreate,this.model,this.context)};var Rb=new Kb,ub=function(){this.context=this.model=this.gltfTexture=void 0};ub.prototype.set=function(a,b,c){this.gltfTexture=a;this.model=b;this.context=c};ub.prototype.execute=function(){ec(this.gltfTexture,this.model,this.context)};var jc=new ub,jb={MODEL:function(a,b,c){return function(){return c.computedMatrix}},VIEW:function(a,b,c){return function(){return a.view}},PROJECTION:function(a,b,c){return function(){return a.projection}},MODELVIEW:function(a,b,c){var d=new w;return function(){return w.multiplyTransformation(a.view,c.computedMatrix,d)}},CESIUM_RTC_MODELVIEW:function(a,b,c){var d=new w;return function(){w.multiplyTransformation(a.view,c.computedMatrix,d);return w.setTranslation(d,b._rtcCenterEye,d)}},MODELVIEWPROJECTION:function(a,b,c){var d=new w;return function(){w.multiplyTransformation(a.view,c.computedMatrix,d);return w.multiply(a._projection,d,d)}},MODELINVERSE:function(a,b,c){var d=new w;return function(){return w.inverse(c.computedMatrix,d)}},VIEWINVERSE:function(a,b){return function(){return a.inverseView}},PROJECTIONINVERSE:function(a,b,c){return function(){return a.inverseProjection}},MODELVIEWINVERSE:function(a,b,c){var d=new w,e=new w;return function(){w.multiplyTransformation(a.view,c.computedMatrix,d);return w.inverse(d,e)}},MODELVIEWPROJECTIONINVERSE:function(a,b,c){var d=new w,e=new w;return function(){w.multiplyTransformation(a.view,c.computedMatrix,d);w.multiply(a._projection,d,d);return w.inverse(d,e)}},MODELINVERSETRANSPOSE:function(a,b,c){var d=new w,e=new J;return function(){w.inverse(c.computedMatrix,d);w.getRotation(d,e);return J.transpose(e,e)}},MODELVIEWINVERSETRANSPOSE:function(a,b,c){var d=new w,e=new w,f=new J;return function(){w.multiplyTransformation(a.view,c.computedMatrix,d);w.inverse(d,e);w.getRotation(e,f);return J.transpose(f,f)}},VIEWPORT:function(a,b,c){return function(){return a.viewportCartesian4}}},Jb=new w,Gb=[],kb=new k,Lb=new w,kc=new w,Vb=0,Tb=new b,fb=new f,zb=new g;rb.prototype.release=function(){if(0===--this.count)return q(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],yb(this.buffers),yb(this.vertexArrays),yb(this.programs),yb(this.silhouettePrograms),yb(this.textures),r(this)};var Mb=new f,$a=new g;Ia.prototype.update=function(a){if(!this.notUpdate&&a.mode!==xa.MORPHING)if(y.supportsWebP.initialized){var b=y.supportsWebP(),c=a.context;this._defaultTexture=c.defaultTexture;if(this._state===Db.NEEDS_LOAD&&q(this.gltf)){var e,g=this.cacheKey;if(q(g)){c.cache.modelRendererResourceCache=d(c.cache.modelRendererResourceCache,{});var h=c.cache.modelRendererResourceCache;e=h[this.cacheKey];if(q(e)){if(!e.ready)return;++e.count;this._loadRendererResourcesFromCache=!0}else e=new rb(c,g),e.count=1,h[this.cacheKey]=e}else e=new rb(c),e.count=1;this._cachedRendererResources=e;this._state=Db.LOADING;this._state!==Db.FAILED&&(e=this.gltf.extensions,q(e)&&q(e.CESIUM_RTC)&&(e=f.fromArray(e.CESIUM_RTC.center),f.equals(e,f.ZERO)||(this._rtcCenter3D=e,e=a.mapProjection,g=e.ellipsoid.cartesianToCartographic(this._rtcCenter3D),e=e.project(g),f.fromElements(e.z,e.x,e.y,e),this._rtcCenter2D=e,this._rtcCenterEye=new f,this._rtcCenter=this._rtcCenter3D)),V(this.gltf),this._loadResources=new Ea,this._loadRendererResourcesFromCache||Aa.parseBuffers(this,Sa))}g=this._loadResources;h=this._incrementallyLoadTextures;e=!1;if(this._state===Db.LOADING){if(0===g.pendingBufferLoads){if(!g.initialized){a.brdfLutGenerator.update(a);Aa.checkSupportedExtensions(this.extensionsRequired,b);Aa.updateForwardAxis(this);if(!q(this.gltf.extras.sourceVersion)){var k=this.gltf;k.extras.sourceVersion=Aa.getAssetVersion(k);k.extras.sourceKHRTechniquesWebGL=q(Aa.getUsedExtensions(k).KHR_techniques_webgl);this._sourceVersion=k.extras.sourceVersion;this._sourceKHRTechniquesWebGL=k.extras.sourceKHRTechniquesWebGL;ia(k);da(k);var l={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};sa(k,l);Va(k,l)}this._sourceVersion=this.gltf.extras.sourceVersion;this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL;this._dequantizeInShader=this._dequantizeInShader&&ua.hasExtension(this);va(this);Nb(this);Ta(this);this._loadRendererResourcesFromCache||(Oa(this),Wa(this),Ra(this),Hb(this,c,b));tb(this);Jc(this);db(this);ua.parse(this,c);g.initialized=!0}g.finishedDecoding()||ua.decodeModel(this,c).otherwise(Aa.getFailedLoadFunction(this,"model",this.basePath));g.finishedDecoding()&&!g.resourcesParsed&&(this._boundingSphere=Aa.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,ua.cacheDataForModel(this),g.resourcesParsed=!0);g.resourcesParsed&&0===g.pendingShaderLoads&&Bc(this,a)}if(g.finished()||h&&g.finishedEverythingButTextureCreation())this._state=Db.LOADED,e=!0}q(g)&&this._state===Db.LOADED&&(h&&!e&&Bc(this,a),g.finished()&&(this._loadResources=void 0,b=this._rendererResources,g=this._cachedRendererResources,g.buffers=b.buffers,g.vertexArrays=b.vertexArrays,g.programs=b.programs,g.sourceShaders=b.sourceShaders,g.silhouettePrograms=b.silhouettePrograms,g.textures=b.textures,g.samplers=b.samplers,g.renderStates=b.renderStates,g.ready=!0,this._normalAttributeName=Aa.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),q(this._precreatedAttributes)&&(g.vertexArrays={}),this.releaseGltfJson&&xb(this)));b=Ua.isSupported(c);if(this._shouldUpdateSpecularMapAtlas&&b){this._shouldUpdateSpecularMapAtlas=!1;this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy();this._specularEnvironmentMapAtlas=void 0;if(q(this._specularEnvironmentMaps)){this._specularEnvironmentMapAtlas=new Ua(this._specularEnvironmentMaps);var m=this;this._specularEnvironmentMapAtlas.readyPromise.then(function(){m._shouldRegenerateShaders=!0})}this._shouldRegenerateShaders=!0}q(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(a);b=!q(this._specularEnvironmentMapAtlas)&&q(a.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps;g=!q(a.specularEnvironmentMaps)&&this._useDefaultSpecularMaps;h=!q(this._sphericalHarmonicCoefficients)&&q(a.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics;k=!q(a.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||b||g||h||k;this._useDefaultSpecularMaps=!q(this._specularEnvironmentMapAtlas)&&q(a.specularEnvironmentMaps);this._useDefaultSphericalHarmonics=!q(this._sphericalHarmonicCoefficients)&&q(a.sphericalHarmonicCoefficients);b=a.context.stencilBuffer&&0<this.silhouetteSize&&0<this.silhouetteColor.alpha&&q(this._normalAttributeName);g=Ob(this);h=0===this.color.alpha;k=q(this.distanceDisplayCondition)?Sb(this,a):!0;if((h=this.show&&k&&0!==this.scale&&(!h||b))&&this._state===Db.LOADED||e){l=this.activeAnimations.update(a)||this._cesiumAnimationsDirty;this._dirty=this._cesiumAnimationsDirty=!1;var k=this.modelMatrix,p=a.mode!==this._mode;this._mode=a.mode;if((p=!w.equals(this._modelMatrix,k)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||p)||e){w.clone(k,this._modelMatrix);sb(this);q(this._clampedModelMatrix)&&(k=this._clampedModelMatrix);this._scale=this.scale;this._minimumPixelSize=this.minimumPixelSize;this._maximumScale=this.maximumScale;this._heightReference=this.heightReference;this._heightChanged=!1;var r=wb(this,a),t=this._computedModelMatrix;w.multiplyByUniformScale(k,r,t);this._upAxis===ha.Y?w.multiplyTransformation(t,ha.Y_UP_TO_Z_UP,t):this._upAxis===ha.X&&w.multiplyTransformation(t,ha.X_UP_TO_Z_UP,t);this.forwardAxis===ha.Z&&w.multiplyTransformation(t,ha.Z_UP_TO_X_UP,t)}if(l||p||e)nc(this,p,e,a.mapProjection),this._dirty=!0,(l||e)&&gc(this);this._perNodeShowDirty&&(this._perNodeShowDirty=!1,hc(this));Fc(this,c);mb(this);gb(this);Zb(this);Cb(this,a);var p=this._clippingPlanes,l=0,r=q(p)&&p.enabled&&0<p.length,t=q(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,u=q(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps;if(r||t||u)k=d(this.clippingPlanesOriginMatrix,k),w.multiply(c.uniformState.view3D,k,this._clippingPlaneModelViewMatrix);r&&(l=p.clippingPlanesState);c=(c=this._shouldRegenerateShaders)||this._clippingPlanesState!==l;this._clippingPlanesState=l;k=La(this);k!==this._colorShadingEnabled&&(this._colorShadingEnabled=k,c=!0);c?$b(this,a):(Na(this,a,!1),nb(this,a,!1))}if(e){var v=this;a.afterRender.push(function(){v._ready=!0;v._readyPromise.resolve(v)})}else if(h&&!this._ignoreCommands&&(c=a.commandList,e=a.passes,h=this._nodeCommands,k=h.length,r=a.mapProjection.ellipsoid.maximumRadius*H.PI,e.render||e.pick&&this.allowPicking)){for(l=0;l<k;++l)p=h[l],p.show&&(t=g?p.translucentCommand:p.command,t=b?p.silhouetteModelCommand:t,c.push(t),t=p.command.boundingVolume,a.mode===xa.SCENE2D&&(t.center.y+t.radius>r||t.center.y-t.radius<r)&&(t=g?p.translucentCommand2D:p.command2D,t=b?p.silhouetteModelCommand2D:t,c.push(t)));if(b&&!e.pick)for(l=0;l<k;++l)p=h[l],p.show&&(c.push(p.silhouetteColorCommand),t=p.command.boundingVolume,a.mode===xa.SCENE2D&&(t.center.y+t.radius>r||t.center.y-t.radius<r)&&c.push(p.silhouetteColorCommand2D))}}else y.supportsWebP.initialize()};Ia.prototype.isDestroyed=function(){return!1};Ia.prototype.destroy=function(){q(this._precreatedAttributes)&&yb(this._rendererResources.vertexArrays);q(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0);q(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0);q(this._cachedRendererResources)&&Pb(this._rendererResources,this._cachedRendererResources);this._rendererResources=void 0;this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release();ua.destroyCachedDataForModel(this);for(var a=this._pickIds,b=a.length,c=0;c<b;++c)a[c].destroy();xb(this);this._quantizedVertexShaders=void 0;a=this._clippingPlanes;q(a)&&!a.isDestroyed()&&a.owner===this&&a.destroy();this._clippingPlanes=void 0;this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy();return r(this)};Ia._getClippingFunction=wa;Ia._modifyShaderForColor=function(a){a=Y.replaceMain(a,"gltf_blend_main");return a+"uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb \x3d mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight \x3d ceil(gltf_colorBlend); \n    gl_FragColor.rgb *\x3d mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *\x3d gltf_color.a; \n} \n"};return Ia});F("DataSources/ModelVisualizer","../Core/AssociativeArray ../Core/BoundingSphere ../Core/Cartesian2 ../Core/Color ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/Matrix4 ../Core/Resource ../Scene/ColorBlendMode ../Scene/HeightReference ../Scene/Model ../Scene/ModelAnimationLoop ../Scene/ShadowMode ./BoundingSphereState ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a,c){if(!g(a))throw new m("scene is required.");if(!g(c))throw new m("entityCollection is required.");c.collectionChanged.addEventListener(y.prototype._onCollectionChanged,this);this._scene=a;this._primitives=a.primitives;this._entityCollection=c;this._modelHash={};this._entitiesToVisualize=new b;this._onCollectionChanged(c,c.values,[],[])}function A(a,b,c,d){a=c[b.id];g(a)&&(d.removeAndDestroy(a.modelPrimitive),delete c[b.id])}function z(a,b,c){a.readyPromise.otherwise(function(a){console.error(a);c[b.id].loadFail=!0})}var x=r.ENABLED,D=d.NONE,v=k.RED,B=k.WHITE,C=p.HIGHLIGHT,I=new f(1,1),H=new e,J=new e;y.prototype.update=function(a){if(!g(a))throw new m("time is required.");for(var b=this._entitiesToVisualize.values,c=this._modelHash,d=this._primitives,f=0,k=b.length;f<k;f++){var l=b[f],p=l._model,r,w=c[l.id],y=l.isShowing&&l.isAvailable(a)&&u.getValueOrDefault(p._show,a,!0),A;y&&(A=l.computeModelMatrix(a,H),r=h.createIfNeeded(u.getValueOrUndefined(p._uri,a)),y=g(A)&&g(r));if(y){if(y=g(w)?w.modelPrimitive:void 0,g(y)&&r.url===w.url||(g(y)&&(d.removeAndDestroy(y),delete c[l.id]),y=q.fromGltf({url:r,incrementallyLoadTextures:u.getValueOrDefault(p._incrementallyLoadTextures,a,!0),scene:this._scene}),y.id=l,d.add(y),w={modelPrimitive:y,url:r.url,animationsRunning:!1,nodeTransformationsScratch:{},articulationsScratch:{},loadFail:!1},c[l.id]=w,z(y,l,c)),y.show=!0,y.scale=u.getValueOrDefault(p._scale,a,1),y.minimumPixelSize=u.getValueOrDefault(p._minimumPixelSize,a,0),y.maximumScale=u.getValueOrUndefined(p._maximumScale,a),y.modelMatrix=e.clone(A,y.modelMatrix),y.shadows=u.getValueOrDefault(p._shadows,a,x),y.heightReference=u.getValueOrDefault(p._heightReference,a,D),y.distanceDisplayCondition=u.getValueOrUndefined(p._distanceDisplayCondition,a),y.silhouetteColor=u.getValueOrDefault(p._silhouetteColor,a,v,y._silhouetteColor),y.silhouetteSize=u.getValueOrDefault(p._silhouetteSize,a,0),y.color=u.getValueOrDefault(p._color,a,B,y._color),y.colorBlendMode=u.getValueOrDefault(p._colorBlendMode,a,C),y.colorBlendAmount=u.getValueOrDefault(p._colorBlendAmount,a,.5),y.clippingPlanes=u.getValueOrUndefined(p._clippingPlanes,a),y.clampAnimations=u.getValueOrDefault(p._clampAnimations,a,!0),y.imageBasedLightingFactor=u.getValueOrDefault(p._imageBasedLightingFactor,a,I),y.lightColor=u.getValueOrUndefined(p._lightColor,a),y.enableLighting=u.getValueOrUndefined(p._enableLighting,a),y.ready){l=u.getValueOrDefault(p._runAnimations,a,!0);w.animationsRunning!==l&&(l?y.activeAnimations.addAll({loop:t.REPEAT}):y.activeAnimations.removeAll(),w.animationsRunning=l);l=u.getValueOrUndefined(p._nodeTransformations,a,w.nodeTransformationsScratch);if(g(l))for(var M=Object.keys(l),R=0,Y=M.length;R<Y;++R){var Q=M[R],S=l[Q];g(S)&&(Q=y.getNode(Q),g(Q)&&(S=e.fromTranslationRotationScale(S,J),Q.matrix=e.multiply(Q.originalMatrix,S,S)))}l=!1;p=u.getValueOrUndefined(p._articulations,a,w.articulationsScratch);if(g(p))for(w=Object.keys(p),M=0,R=w.length;M<R;++M)Y=w[M],S=p[Y],g(S)&&(l=!0,y.setArticulationStage(Y,S));l&&y.applyArticulations()}}else g(w)&&(w.modelPrimitive.show=!1)}return!0};y.prototype.isDestroyed=function(){return!1};y.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(y.prototype._onCollectionChanged,this);for(var a=this._entitiesToVisualize.values,b=this._modelHash,c=this._primitives,d=a.length-1;-1<d;d--)A(this,a[d],b,c);return l(this)};y.prototype.getBoundingSphere=function(b,e){if(!g(b))throw new m("entity is required.");if(!g(e))throw new m("result is required.");var f=this._modelHash[b.id];if(!g(f)||f.loadFail)return c.FAILED;f=f.modelPrimitive;if(!g(f)||!f.show)return c.FAILED;if(!f.ready)return c.PENDING;if(f.heightReference===d.NONE)a.transform(f.boundingSphere,f.modelMatrix,e);else{if(!g(f._clampedModelMatrix))return c.PENDING;a.transform(f.boundingSphere,f._clampedModelMatrix,e)}return c.DONE};y.prototype._onCollectionChanged=function(a,b,c,d){var e,f=this._entitiesToVisualize,h=this._modelHash,k=this._primitives;for(a=b.length-1;-1<a;a--)e=b[a],g(e._model)&&g(e._position)&&f.set(e.id,e);for(a=d.length-1;-1<a;a--)e=d[a],g(e._model)&&g(e._position)?(b=h[e.id],g(b)&&(b.nodeTransformationsScratch={},b.articulationsScratch={}),f.set(e.id,e)):(A(this,e,h,k),f.remove(e.id));for(a=c.length-1;-1<a;a--)e=c[a],A(this,e,h,k),f.remove(e.id)};return y});F("Shaders/PolylineVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 position2DHigh;\nattribute vec3 position2DLow;\nattribute vec3 prevPosition3DHigh;\nattribute vec3 prevPosition3DLow;\nattribute vec3 prevPosition2DHigh;\nattribute vec3 prevPosition2DLow;\nattribute vec3 nextPosition3DHigh;\nattribute vec3 nextPosition3DLow;\nattribute vec3 nextPosition2DHigh;\nattribute vec3 nextPosition2DLow;\nattribute vec4 texCoordExpandAndBatchIndex;\nvarying vec2  v_st;\nvarying float v_width;\nvarying vec4 v_pickColor;\nvarying float v_polylineAngle;\nvoid main()\n{\nfloat texCoord \x3d texCoordExpandAndBatchIndex.x;\nfloat expandDir \x3d texCoordExpandAndBatchIndex.y;\nbool usePrev \x3d texCoordExpandAndBatchIndex.z \x3c 0.0;\nfloat batchTableIndex \x3d texCoordExpandAndBatchIndex.w;\nvec2 widthAndShow \x3d batchTable_getWidthAndShow(batchTableIndex);\nfloat width \x3d widthAndShow.x + 0.5;\nfloat show \x3d widthAndShow.y;\nif (width \x3c 1.0)\n{\nshow \x3d 0.0;\n}\nvec4 pickColor \x3d batchTable_getPickColor(batchTableIndex);\nvec4 p, prev, next;\nif (czm_morphTime \x3d\x3d 1.0)\n{\np \x3d czm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz);\nprev \x3d czm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz);\nnext \x3d czm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz);\n}\nelse if (czm_morphTime \x3d\x3d 0.0)\n{\np \x3d czm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy);\nprev \x3d czm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy);\nnext \x3d czm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy);\n}\nelse\n{\np \x3d czm_columbusViewMorph(\nczm_translateRelativeToEye(position2DHigh.zxy, position2DLow.zxy),\nczm_translateRelativeToEye(position3DHigh.xyz, position3DLow.xyz),\nczm_morphTime);\nprev \x3d czm_columbusViewMorph(\nczm_translateRelativeToEye(prevPosition2DHigh.zxy, prevPosition2DLow.zxy),\nczm_translateRelativeToEye(prevPosition3DHigh.xyz, prevPosition3DLow.xyz),\nczm_morphTime);\nnext \x3d czm_columbusViewMorph(\nczm_translateRelativeToEye(nextPosition2DHigh.zxy, nextPosition2DLow.zxy),\nczm_translateRelativeToEye(nextPosition3DHigh.xyz, nextPosition3DLow.xyz),\nczm_morphTime);\n}\n#ifdef DISTANCE_DISPLAY_CONDITION\nvec3 centerHigh \x3d batchTable_getCenterHigh(batchTableIndex);\nvec4 centerLowAndRadius \x3d batchTable_getCenterLowAndRadius(batchTableIndex);\nvec3 centerLow \x3d centerLowAndRadius.xyz;\nfloat radius \x3d centerLowAndRadius.w;\nvec2 distanceDisplayCondition \x3d batchTable_getDistanceDisplayCondition(batchTableIndex);\nfloat lengthSq;\nif (czm_sceneMode \x3d\x3d czm_sceneMode2D)\n{\nlengthSq \x3d czm_eyeHeight2D.y;\n}\nelse\n{\nvec4 center \x3d czm_translateRelativeToEye(centerHigh.xyz, centerLow.xyz);\nlengthSq \x3d max(0.0, dot(center.xyz, center.xyz) - radius * radius);\n}\nfloat nearSq \x3d distanceDisplayCondition.x * distanceDisplayCondition.x;\nfloat farSq \x3d distanceDisplayCondition.y * distanceDisplayCondition.y;\nif (lengthSq \x3c nearSq || lengthSq \x3e farSq)\n{\nshow \x3d 0.0;\n}\n#endif\nvec4 positionWC \x3d getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, v_polylineAngle);\ngl_Position \x3d czm_viewportOrthographic * positionWC * show;\nv_st \x3d vec2(texCoord, clamp(expandDir, 0.0, 1.0));\nv_width \x3d width;\nv_pickColor \x3d pickColor;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_modelViewProjectionRelativeToEye * p);\n#endif\n}\n"});F("Scene/Polyline","../Core/arrayRemoveDuplicates ../Core/BoundingSphere ../Core/Cartesian3 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/Matrix4 ../Core/PolylinePipeline ./Material".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(c,e){c=g(c,g.EMPTY_OBJECT);this._show=g(c.show,!0);this._width=g(c.width,1);this._loop=g(c.loop,!1);this._distanceDisplayCondition=c.distanceDisplayCondition;this._material=c.material;l(this._material)||(this._material=q.fromType(q.ColorType,{color:new k(1,1,1,1)}));var h=c.positions;l(h)||(h=[]);this._positions=h;this._actualPositions=b(h,f.equalsEpsilon);this._loop&&2<this._actualPositions.length&&(this._actualPositions===this._positions&&(this._actualPositions=h.slice()),this._actualPositions.push(f.clone(this._actualPositions[0])));this._length=this._actualPositions.length;this._id=c.id;var m;l(e)&&(m=p.clone(e.modelMatrix));this._modelMatrix=m;this._segments=d.wrapLongitude(this._actualPositions,m);this._actualLength=void 0;this._propertiesChanged=new Uint32Array(D);this._polylineCollection=e;this._dirty=!1;this._pickId=void 0;this._boundingVolume=a.fromPoints(this._actualPositions);this._boundingVolumeWC=a.transform(this._boundingVolume,this._modelMatrix);this._boundingVolume2D=new a}function r(a,b){++a._propertiesChanged[b];var c=a._polylineCollection;l(c)&&(c._updatePolyline(a,b),a._dirty=!0)}var c=t.POSITION_INDEX=0,u=t.SHOW_INDEX=1,y=t.WIDTH_INDEX=2,A=t.MATERIAL_INDEX=3,z=t.POSITION_SIZE_INDEX=4,x=t.DISTANCE_DISPLAY_CONDITION=5,D=t.NUMBER_OF_PROPERTIES=6;m(t.prototype,{show:{get:function(){return this._show},set:function(a){if(!l(a))throw new e("value is required.");a!==this._show&&(this._show=a,r(this,u))}},positions:{get:function(){return this._positions},set:function(d){if(!l(d))throw new e("value is required.");var g=b(d,f.equalsEpsilon);this._loop&&2<g.length&&(g===d&&(g=d.slice()),g.push(f.clone(g[0])));this._actualPositions.length===g.length&&this._actualPositions.length===this._length||r(this,z);this._positions=d;this._actualPositions=g;this._length=g.length;this._boundingVolume=a.fromPoints(this._actualPositions,this._boundingVolume);this._boundingVolumeWC=a.transform(this._boundingVolume,this._modelMatrix,this._boundingVolumeWC);r(this,c);this.update()}},material:{get:function(){return this._material},set:function(a){if(!l(a))throw new e("material is required.");this._material!==a&&(this._material=a,r(this,A))}},width:{get:function(){return this._width},set:function(a){if(!l(a))throw new e("value is required.");a!==this._width&&(this._width=a,r(this,y))}},loop:{get:function(){return this._loop},set:function(a){if(!l(a))throw new e("value is required.");if(a!==this._loop){var b=this._actualPositions;a?2<b.length&&!f.equals(b[0],b[b.length-1])&&(b.length===this._positions.length&&(this._actualPositions=b=this._positions.slice()),b.push(f.clone(b[0]))):2<b.length&&f.equals(b[0],b[b.length-1])&&(b.length-1===this._positions.length?this._actualPositions=this._positions:b.pop());this._loop=a;r(this,z)}}},id:{get:function(){return this._id},set:function(a){this._id=a;l(this._pickId)&&(this._pickId.object.id=a)}},pickId:{get:function(){return this._pickId}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(a){if(l(a)&&a.far<=a.near)throw new e("far distance must be greater than near distance.");h.equals(a,this._distanceDisplayCondition)||(this._distanceDisplayCondition=h.clone(a,this._distanceDisplayCondition),r(this,x))}}});t.prototype.update=function(){var b=p.IDENTITY;l(this._polylineCollection)&&(b=this._polylineCollection.modelMatrix);var e=this._segments.positions.length,f=this._segments.lengths,g=0<this._propertiesChanged[c]||0<this._propertiesChanged[z];if(!p.equals(b,this._modelMatrix)||g)this._segments=d.wrapLongitude(this._actualPositions,b),this._boundingVolumeWC=a.transform(this._boundingVolume,b,this._boundingVolumeWC);this._modelMatrix=p.clone(b,this._modelMatrix);if(this._segments.positions.length!==e)r(this,z);else for(b=f.length,e=0;e<b;++e)if(f[e]!==this._segments.lengths[e]){r(this,z);break}};t.prototype.getPickId=function(a){l(this._pickId)||(this._pickId=a.createPickId({primitive:this,collection:this._polylineCollection,id:this._id}));return this._pickId};t.prototype._clean=function(){this._dirty=!1;for(var a=this._propertiesChanged,b=0;b<D-1;++b)a[b]=0};t.prototype._destroy=function(){this._pickId=this._pickId&&this._pickId.destroy();this._material=this._material&&this._material.destroy();this._polylineCollection=void 0};return t});F("Scene/PolylineCollection","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/FeatureDetection ../Core/IndexDatatype ../Core/Intersect ../Core/Math ../Core/Matrix4 ../Core/Plane ../Core/RuntimeError ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/VertexArray ../Shaders/PolylineCommon ../Shaders/PolylineFS ../Shaders/PolylineVS ./BatchTable ./BlendingState ./Material ./Polyline ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W){function M(a){a=h(a,h.EMPTY_OBJECT);this.modelMatrix=z.clone(h(a.modelMatrix,z.IDENTITY));this._modelMatrix=z.clone(z.IDENTITY);this.debugShowBoundingVolume=h(a.debugShowBoundingVolume,!1);this._translucentRS=this._opaqueRS=void 0;this._colorCommands=[];this._createVertexArray=this._polylinesRemoved=this._polylinesUpdated=!1;this._propertiesChanged=new Uint32Array(la);this._polylines=[];this._polylineBuckets={};this._positionBufferUsage={bufferUsage:B.STATIC_DRAW,frameCount:0};this._mode=void 0;this._polylinesToUpdate=[];this._vertexArrays=[];this._batchTable=this._texCoordExpandAndBatchIndexBuffer=this._positionBuffer=void 0;this._useHighlightColor=this._createBatchTable=!1;this._highlightColor=l.clone(l.WHITE);var b=this;this._uniformMap={u_highlightColor:function(){return b._highlightColor}}}function R(a,b,c){a._createVertexArray=!1;S(a);F(a);for(var d=a._mode,f=a._modelMatrix,g=a._polylineBuckets={},h=a._polylines,k=h.length,l=0;l<k;++l){var m=h[l];if(1<m._actualPositions.length){m.update();var q=m.material,r=g[q.type];p(r)||(r=g[q.type]=new V(q,d,f));r.addPolyline(m)}}var d=[[]],m=a._batchTable,h=a._useHighlightColor,f=[0],q=0,g=[[]],r=0,w=a._polylineBuckets,t,y;for(t in w)w.hasOwnProperty(t)&&(y=w[t],y.updateShader(b,m,h),r+=y.lengthOfPositions);if(0<r){var h=a._mode,k=new Float32Array(18*r),l=new Float32Array(4*r),E,z=0,C=0,G=0;for(t in w)if(w.hasOwnProperty(t)){y=w[t];y.write(k,l,z,C,G,m,b,c);h===W.MORPHING&&(p(E)||(E=new Float32Array(18*r)),y.writeForMorph(E,z));var D=y.lengthOfPositions,z=z+18*D,C=C+4*D,G=G+4*D,q=y.updateIndices(d,f,g,q)}c=a._positionBufferUsage.bufferUsage;t=B.STATIC_DRAW;a._positionBuffer=v.createVertexBuffer({context:b,typedArray:k,usage:c});var x;p(E)&&(x=v.createVertexBuffer({context:b,typedArray:E,usage:c}));a._texCoordExpandAndBatchIndexBuffer=v.createVertexBuffer({context:b,typedArray:l,usage:t});E=3*Float32Array.BYTES_PER_ELEMENT;c=4*Float32Array.BYTES_PER_ELEMENT;t=0;k=d.length;for(l=0;l<k;++l)m=d[l],0<m.length&&(m=new Uint16Array(m),m=v.createIndexBuffer({context:b,typedArray:m,usage:B.STATIC_DRAW,indexDatatype:u.UNSIGNED_SHORT}),t+=f[l],q=6*(l*E*A.SIXTY_FOUR_KILOBYTES-t*E),r=E+q,w=E+r,y=E+w,z=E+y,C=E+z,q=[{index:ha.position3DHigh,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:q,strideInBytes:6*E},{index:ha.position3DLow,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:r,strideInBytes:6*E},{index:ha.position2DHigh,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:q,strideInBytes:6*E},{index:ha.position2DLow,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:r,strideInBytes:6*E},{index:ha.prevPosition3DHigh,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:w,strideInBytes:6*E},{index:ha.prevPosition3DLow,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:y,strideInBytes:6*E},{index:ha.prevPosition2DHigh,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:w,strideInBytes:6*E},{index:ha.prevPosition2DLow,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:y,strideInBytes:6*E},{index:ha.nextPosition3DHigh,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:z,strideInBytes:6*E},{index:ha.nextPosition3DLow,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:C,strideInBytes:6*E},{index:ha.nextPosition2DHigh,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:z,strideInBytes:6*E},{index:ha.nextPosition2DLow,componentsPerAttribute:3,componentDatatype:e.FLOAT,offsetInBytes:C,strideInBytes:6*E},{index:ha.texCoordExpandAndBatchIndex,componentsPerAttribute:4,componentDatatype:e.FLOAT,vertexBuffer:a._texCoordExpandAndBatchIndexBuffer,offsetInBytes:l*c*A.SIXTY_FOUR_KILOBYTES-t*c}],h===W.SCENE3D?(r=a._positionBuffer,w="vertexBuffer",y=wa,z="value"):(h===W.SCENE2D||h===W.COLUMBUS_VIEW?(r=wa,w="value"):(r=x,w="vertexBuffer"),y=a._positionBuffer,z="vertexBuffer"),q[0][w]=r,q[1][w]=r,q[2][z]=y,q[3][z]=y,q[4][w]=r,q[5][w]=r,q[6][z]=y,q[7][z]=y,q[8][w]=r,q[9][w]=r,q[10][z]=y,q[11][z]=y,m=new L({context:b,attributes:q,indexBuffer:m}),a._vertexArrays.push({va:m,buckets:g[l]}))}}function Y(a,b){return b instanceof E?b.id:b}function Q(a){if(a._polylinesRemoved){a._polylinesRemoved=!1;for(var b=[],c=a._polylines.length,d=0,e=0;d<c;++d){var f=a._polylines[d];p(f)&&(f._index=e++,b.push(f))}a._polylines=b}}function S(a){a=a._polylines;for(var b=a.length,c=0;c<b;++c)if(p(a[c])){var d=a[c]._bucket;p(d)&&(d.shaderProgram=d.shaderProgram&&d.shaderProgram.destroy())}}function F(a){for(var b=a._vertexArrays.length,c=0;c<b;++c)a._vertexArrays[c].va.destroy();a._vertexArrays.length=0}function T(a){a=a._polylines;for(var b=a.length,c=0;c<b;++c)p(a[c])&&a[c]._destroy()}function da(a,b,c){this.count=a;this.offset=b;this.bucket=c}function V(a,b,c){this.polylines=[];this.lengthOfPositions=0;this.material=a;this.shaderProgram=void 0;this.mode=b;this.modelMatrix=c}function ba(a){return 0>f.dot(f.UNIT_X,a._boundingVolume.center)||a._boundingVolume.intersectPlane(x.ORIGIN_ZX_PLANE)===y.INTERSECTING}var X=U.SHOW_INDEX,fa=U.WIDTH_INDEX,ga=U.POSITION_INDEX,ka=U.MATERIAL_INDEX,na=U.POSITION_SIZE_INDEX,ia=U.DISTANCE_DISPLAY_CONDITION,la=U.NUMBER_OF_PROPERTIES,ha={texCoordExpandAndBatchIndex:0,position3DHigh:1,position3DLow:2,position2DHigh:3,position2DLow:4,prevPosition3DHigh:5,prevPosition3DLow:6,prevPosition2DHigh:7,prevPosition2DLow:8,nextPosition3DHigh:9,nextPosition3DLow:10,nextPosition2DHigh:11,nextPosition2DLow:12};d(M.prototype,{length:{get:function(){Q(this);return this._polylines.length}}});M.prototype.add=function(a){a=new U(a,this);a._index=this._polylines.length;this._polylines.push(a);this._createBatchTable=this._createVertexArray=!0;return a};M.prototype.remove=function(a){if(this.contains(a)){this._polylines[a._index]=void 0;var b=this._polylinesToUpdate.indexOf(a);-1!==b&&this._polylinesToUpdate.splice(b,1);this._createBatchTable=this._createVertexArray=this._polylinesRemoved=!0;p(a._bucket)&&(b=a._bucket,b.shaderProgram=b.shaderProgram&&b.shaderProgram.destroy());a._destroy();return!0}return!1};M.prototype.removeAll=function(){S(this);T(this);this._polylineBuckets={};this._polylinesRemoved=!1;this._polylines.length=0;this._polylinesToUpdate.length=0;this._createVertexArray=!0};M.prototype.contains=function(a){return p(a)&&a._polylineCollection===this};M.prototype.get=function(a){if(!p(a))throw new t("index is required.");Q(this);return this._polylines[a]};var pa=new r,oa=new k,qa=new a;M.prototype.update=function(c){Q(this);if(0!==this._polylines.length){var d=c.mode;this._mode===d&&z.equals(this._modelMatrix,this.modelMatrix)||(this._mode=d,this._modelMatrix=z.clone(this.modelMatrix),this._createVertexArray=!0);var f=c.context,d=c.mapProjection,g,h=this._propertiesChanged;if(this._createBatchTable){if(0===C.maximumVertexTextureImageUnits)throw new D("Vertex texture fetch support is required to render polylines. The maximum number of vertex texture image units must be greater than zero.");p(this._batchTable)&&this._batchTable.destroy();this._batchTable=new O(f,[{functionName:"batchTable_getWidthAndShow",componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:2},{functionName:"batchTable_getPickColor",componentDatatype:e.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0},{functionName:"batchTable_getCenterHigh",componentDatatype:e.FLOAT,componentsPerAttribute:3},{functionName:"batchTable_getCenterLowAndRadius",componentDatatype:e.FLOAT,componentsPerAttribute:4},{functionName:"batchTable_getDistanceDisplayCondition",componentDatatype:e.FLOAT,componentsPerAttribute:2}],this._polylines.length);this._createBatchTable=!1}if(!(g=this._createVertexArray)){g=!1;var l=this._positionBufferUsage;this._propertiesChanged[ga]?(l.bufferUsage!==B.STREAM_DRAW&&(g=!0,l.bufferUsage=B.STREAM_DRAW),l.frameCount=100):l.bufferUsage!==B.STATIC_DRAW&&(0===l.frameCount?(g=!0,l.bufferUsage=B.STATIC_DRAW):l.frameCount--)}if(g)R(this,f,d);else if(this._polylinesUpdated){l=this._polylinesToUpdate;if(this._mode!==W.SCENE3D)for(var q=l.length,w=0;w<q;++w)g=l[w],g.update();if(h[na]||h[ka])R(this,f,d);else for(f=l.length,q=this._polylineBuckets,w=0;w<f;++w){g=l[w];var h=g._propertiesChanged,t=g._bucket,u=0,v;for(v in q)if(q.hasOwnProperty(v)){if(q[v]===t){h[ga]&&t.writeUpdate(u,g,this._positionBuffer,d);break}u+=q[v].lengthOfPositions}(h[X]||h[fa])&&this._batchTable.setBatchedAttribute(g._index,0,new a(g._width,g._show));if(2<this._batchTable.attributes.length){if(h[ga]||h[na])u=c.mode===W.SCENE2D?g._boundingVolume2D:g._boundingVolumeWC,t=r.fromCartesian(u.center,pa),u=k.fromElements(t.low.x,t.low.y,t.low.z,u.radius,oa),this._batchTable.setBatchedAttribute(g._index,2,t.high),this._batchTable.setBatchedAttribute(g._index,3,u);h[ia]&&(h=qa,h.x=0,h.y=Number.MAX_VALUE,t=g.distanceDisplayCondition,p(t)&&(h.x=t.near,h.y=t.far),this._batchTable.setBatchedAttribute(g._index,4,h))}g._clean()}l.length=0;this._polylinesUpdated=!1}h=this._propertiesChanged;for(v=0;v<la;++v)h[v]=0;d=z.IDENTITY;c.mode===W.SCENE3D&&(d=this.modelMatrix);v=c.passes;h=0!==c.morphTime;p(this._opaqueRS)&&this._opaqueRS.depthTest.enabled===h||(this._opaqueRS=J.fromCache({depthMask:h,depthTest:{enabled:h}}));p(this._translucentRS)&&this._translucentRS.depthTest.enabled===h||(this._translucentRS=J.fromCache({blending:Z.ALPHA_BLEND,depthMask:!h,depthTest:{enabled:h}}));this._batchTable.update(c);if(v.render||v.pick){v=this._colorCommands;h=c.context;g=c.commandList;for(var l=v.length,f=0,y=!0,q=this._vertexArrays,w=this.debugShowBoundingVolume,t=this._batchTable.getUniformMapCallback(),u=q.length,E=0;E<u;++E)for(var A=q[E],G=A.buckets,x=G.length,L=0;L<x;++L){for(var K=G[L],M=K.offset,T=K.bucket.shaderProgram,P=K.bucket.polylines,N=P.length,V,da,U=0,ba=0;ba<N;++ba){var S=P[ba],F;F=S._material;var ca=aa._uniformList[F.type],wa=ca.length;za.length=2*wa;for(var ra=0,Ea=0;Ea<wa;++Ea){var Aa=ca[Ea];za[ra]=Aa;za[ra+1]=F._uniforms[Aa]();ra+=2}F=F.type+":"+JSON.stringify(za,Y);F!==V&&(p(V)&&0<U&&(ca=da.isTranslucent(),f>=l?(V=new I({owner:this}),v.push(V)):V=v[f],++f,y=m(t(da._uniforms),this._uniformMap),V.boundingVolume=b.clone(ua,V.boundingVolume),V.modelMatrix=d,V.shaderProgram=T,V.vertexArray=A.va,V.renderState=ca?this._translucentRS:this._opaqueRS,V.pass=ca?H.TRANSLUCENT:H.OPAQUE,V.debugShowBoundingVolume=w,V.pickId="v_pickColor",V.uniformMap=y,V.count=U,V.offset=M,M+=U,U=0,y=!0,g.push(V)),da=S._material,da.update(h),V=F);F=S._locatorBuckets;ca=F.length;for(wa=0;wa<ca;++wa)ra=F[wa],ra.locator===K&&(U+=ra.count);var Ca;c.mode===W.SCENE3D?Ca=S._boundingVolumeWC:c.mode===W.COLUMBUS_VIEW?Ca=S._boundingVolume2D:c.mode===W.SCENE2D?p(S._boundingVolume2D)&&(Ca=b.clone(S._boundingVolume2D,ta),Ca.center.x=0):p(S._boundingVolumeWC)&&p(S._boundingVolume2D)&&(Ca=b.union(S._boundingVolumeWC,S._boundingVolume2D,ta));y?(y=!1,b.clone(Ca,ua)):b.union(Ca,ua,ua)}p(V)&&0<U&&(f>=l?(V=new I({owner:this}),v.push(V)):V=v[f],++f,y=m(t(da._uniforms),this._uniformMap),V.boundingVolume=b.clone(ua,V.boundingVolume),V.modelMatrix=d,V.shaderProgram=T,V.vertexArray=A.va,V.renderState=da.isTranslucent()?this._translucentRS:this._opaqueRS,V.pass=da.isTranslucent()?H.TRANSLUCENT:H.OPAQUE,V.debugShowBoundingVolume=w,V.pickId="v_pickColor",V.uniformMap=y,V.count=U,V.offset=M,y=!0,g.push(V));V=void 0}v.length=f}}};var ua=new b,ta=new b;M.prototype.isDestroyed=function(){return!1};M.prototype.destroy=function(){F(this);S(this);T(this);this._batchTable=this._batchTable&&this._batchTable.destroy();return q(this)};var wa=[0,0,0],za=[];M.prototype._updatePolyline=function(a,b){this._polylinesUpdated=!0;a._dirty||this._polylinesToUpdate.push(a);++this._propertiesChanged[b]};V.prototype.addPolyline=function(a){this.polylines.push(a);a._actualLength=this.getPolylinePositionsLength(a);this.lengthOfPositions+=a._actualLength;a._bucket=this};V.prototype.updateShader=function(a,b,d){if(!p(this.shaderProgram)){var e=["DISTANCE_DISPLAY_CONDITION"];d&&e.push("VECTOR_TILE");-1!==this.material.shaderSource.search(/varying\s+float\s+v_polylineAngle;/g)&&e.push("POLYLINE_DASH");c.isInternetExplorer()||e.push("CLIP_POLYLINE");d=new G({defines:e,sources:["varying vec4 v_pickColor;\n",this.material.shaderSource,P]});b=b.getVertexShaderCallback()(N);e=new G({defines:e,sources:[K,b]});this.shaderProgram=w.fromCache({context:a,vertexShaderSource:e,fragmentShaderSource:d,attributeLocations:ha})}};V.prototype.getPolylinePositionsLength=function(a){if(this.mode===W.SCENE3D||!ba(a))return a=a._actualPositions.length,4*a-4;var b=0,c=a._segments.lengths;a=c.length;for(var d=0;d<a;++d)b+=4*c[d]-4;return b};var Da=new f,Ba=new f,ra=new f,Ea=new f,Ga=new k,Ca=new a;V.prototype.write=function(a,b,c,d,e,g,h,m){d=this.mode;for(var q=m.ellipsoid.maximumRadius*A.PI,w=this.polylines,t=w.length,u=0;u<t;++u){for(var v=w[u],y=v.width,E=v.show&&0<y,z=v._index,B=this.getSegments(v,m),C=B.positions,G=B.lengths,D=C.length,B=v.getPickId(h).color,x=0,L=0,K,H=0;H<D;++H){0===H?v._loop?K=C[D-2]:(K=Ea,f.subtract(C[0],C[1],K),f.add(C[0],K,K)):K=C[H-1];f.clone(K,Ba);f.clone(C[H],Da);H===D-1?v._loop?K=C[1]:(K=Ea,f.subtract(C[D-1],C[D-2],K),f.add(C[D-1],K,K)):K=C[H+1];f.clone(K,ra);K=G[x];H===L+K&&(L+=K,++x);var M=0===H-L;K=H===L+G[x]-1;d===W.SCENE2D&&(Ba.z=0,Da.z=0,ra.z=0);(d===W.SCENE2D||d===W.MORPHING)&&(M||K)&&1>q-Math.abs(Da.x)&&((0>Da.x&&0<Ba.x||0<Da.x&&0>Ba.x)&&f.clone(Da,Ba),(0>Da.x&&0<ra.x||0<Da.x&&0>ra.x)&&f.clone(Da,ra));K=K?2:4;for(M=M?2:0;M<K;++M){r.writeElements(Da,a,c);r.writeElements(Ba,a,c+6);r.writeElements(ra,a,c+12);var I=0>M-2?-1:1;b[e]=H/(D-1);b[e+1]=M%2*2-1;b[e+2]=I;b[e+3]=z;c+=18;e+=4}}C=Ga;C.x=l.floatToByte(B.red);C.y=l.floatToByte(B.green);C.z=l.floatToByte(B.blue);C.w=l.floatToByte(B.alpha);B=Ca;B.x=y;B.y=E?1:0;E=d===W.SCENE2D?v._boundingVolume2D:v._boundingVolumeWC;G=r.fromCartesian(E.center,pa);y=G.high;E=k.fromElements(G.low.x,G.low.y,G.low.z,E.radius,oa);G=qa;G.x=0;G.y=Number.MAX_VALUE;v=v.distanceDisplayCondition;p(v)&&(G.x=v.near,G.y=v.far);g.setBatchedAttribute(z,0,B);g.setBatchedAttribute(z,1,C);2<g.attributes.length&&(g.setBatchedAttribute(z,2,y),g.setBatchedAttribute(z,3,E),g.setBatchedAttribute(z,4,G))}};var ya=new f,Aa=new f,Ua=new f,sa=new f;V.prototype.writeForMorph=function(a,b){for(var c=this.modelMatrix,d=this.polylines,e=d.length,g=0;g<e;++g)for(var h=d[g],k=h._segments.positions,l=h._segments.lengths,m=k.length,p=0,q=0,w=0;w<m;++w){var t;0===w?h._loop?t=k[m-2]:(t=sa,f.subtract(k[0],k[1],t),f.add(k[0],t,t)):t=k[w-1];t=z.multiplyByPoint(c,t,Aa);var u=z.multiplyByPoint(c,k[w],ya),v;w===m-1?h._loop?v=k[1]:(v=sa,f.subtract(k[m-1],k[m-2],v),f.add(k[m-1],v,v)):v=k[w+1];v=z.multiplyByPoint(c,v,Ua);var y=l[p];w===q+y&&(q+=y,++p);for(var y=w===q+l[p]-1?2:4,E=0===w-q?2:0;E<y;++E)r.writeElements(u,a,b),r.writeElements(t,a,b+6),r.writeElements(v,a,b+12),b+=18}};var Va=Array(1);V.prototype.updateIndices=function(a,b,c,d){var e=c.length-1,f=new da(0,d,this);c[e].push(f);var g=0,h=a[a.length-1],k=0;0<h.length&&(k=h[h.length-1]+1);for(var l=this.polylines,m=l.length,p=0;p<m;++p){var q=l[p];q._locatorBuckets=[];var r;if(this.mode===W.SCENE3D){r=Va;var w=q._actualPositions.length;if(0<w)r[0]=w;else continue}else r=q._segments.lengths;w=r.length;if(0<w){for(var t=0,u=0;u<w;++u)for(var v=r[u]-1,y=0;y<v;++y)k+4>A.SIXTY_FOUR_KILOBYTES&&(q._locatorBuckets.push({locator:f,count:t}),t=0,b.push(4),h=[],a.push(h),k=0,f.count=g,d=g=0,f=new da(0,0,this),c[++e]=[f]),h.push(k,k+2,k+1),h.push(k+1,k+2,k+3),t+=6,g+=6,d+=6,k+=4;q._locatorBuckets.push({locator:f,count:t});k+4>A.SIXTY_FOUR_KILOBYTES&&(b.push(0),h=[],a.push(h),k=0,f.count=g,g=d=0,f=new da(0,0,this),c[++e]=[f])}q._clean()}f.count=g;return d};V.prototype.getPolylineStartIndex=function(a){for(var b=this.polylines,c=0,d=b.length,e=0;e<d;++e){var f=b[e];if(f===a)break;c+=f._actualLength}return c};var xa={positions:void 0,lengths:void 0},Ha=Array(1),Ma=new f,Ia=new g;V.prototype.getSegments=function(a,c){var d=a._actualPositions;if(this.mode===W.SCENE3D)return Ha[0]=d.length,xa.positions=d,xa.lengths=Ha,xa;ba(a)&&(d=a._segments.positions);for(var e=c.ellipsoid,g=[],h=this.modelMatrix,k=d.length,l,m=Ma,p=0;p<k;++p)l=d[p],m=z.multiplyByPoint(h,l,m),g.push(c.project(e.cartesianToCartographic(m,Ia)));0<g.length&&(a._boundingVolume2D=b.fromPoints(g,a._boundingVolume2D),d=a._boundingVolume2D.center,a._boundingVolume2D.center=new f(d.z,d.x,d.y));xa.positions=g;xa.lengths=a._segments.lengths;return xa};var La;V.prototype.writeUpdate=function(a,b,c,d){var e=this.mode,g=d.ellipsoid.maximumRadius*A.PI,h=b._actualLength;if(h){a+=this.getPolylineStartIndex(b);var k=La,h=18*h;!p(k)||k.length<h?k=La=new Float32Array(h):k.length>h&&(k=new Float32Array(k.buffer,0,h));h=this.getSegments(b,d);d=h.positions;for(var l=h.lengths,m=0,q=0,w=0,t,h=d.length,u=0;u<h;++u){0===u?b._loop?t=d[h-2]:(t=Ea,f.subtract(d[0],d[1],t),f.add(d[0],t,t)):t=d[u-1];f.clone(t,Ba);f.clone(d[u],Da);u===h-1?b._loop?t=d[1]:(t=Ea,f.subtract(d[h-1],d[h-2],t),f.add(d[h-1],t,t)):t=d[u+1];f.clone(t,ra);t=l[q];u===w+t&&(w+=t,++q);t=0===u-w;var v=u===w+l[q]-1;e===W.SCENE2D&&(Ba.z=0,Da.z=0,ra.z=0);(e===W.SCENE2D||e===W.MORPHING)&&(t||v)&&1>g-Math.abs(Da.x)&&((0>Da.x&&0<Ba.x||0<Da.x&&0>Ba.x)&&f.clone(Da,Ba),(0>Da.x&&0<ra.x||0<Da.x&&0>ra.x)&&f.clone(Da,ra));v=v?2:4;for(t=t?2:0;t<v;++t)r.writeElements(Da,k,m),r.writeElements(Ba,k,m+6),r.writeElements(ra,k,m+12),m+=18}c.copyFromArrayView(k,18*Float32Array.BYTES_PER_ELEMENT*a)}};return M});F("DataSources/ScaledPositionProperty","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Ellipsoid ../Core/Event ../Core/ReferenceFrame ./Property".split(" "),function(b,a,f,k,g,l,m){function e(a){this._definitionChanged=new g;this._removeSubscription=this._value=void 0;this.setValue(a)}a(e.prototype,{isConstant:{get:function(){return m.isConstant(this._value)}},definitionChanged:{get:function(){return this._definitionChanged}},referenceFrame:{get:function(){return b(this._value)?this._value.referenceFrame:l.FIXED}}});e.prototype.getValue=function(a,b){return this.getValueInReferenceFrame(a,l.FIXED,b)};e.prototype.setValue=function(a){this._value!==a&&(this._value=a,b(this._removeSubscription)&&(this._removeSubscription(),this._removeSubscription=void 0),b(a)&&(this._removeSubscription=a.definitionChanged.addEventListener(this._raiseDefinitionChanged,this)),this._definitionChanged.raiseEvent(this))};e.prototype.getValueInReferenceFrame=function(a,e,d){if(!b(a))throw new f("time is required.");if(!b(e))throw new f("referenceFrame is required.");if(b(this._value))return d=this._value.getValueInReferenceFrame(a,e,d),b(d)?k.WGS84.scaleToGeodeticSurface(d,d):void 0};e.prototype.equals=function(a){return this===a||a instanceof e&&this._value===a._value};e.prototype._raiseDefinitionChanged=function(){this._definitionChanged.raiseEvent(this)};return e});F("DataSources/PathVisualizer","../Core/AssociativeArray ../Core/Cartesian3 ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/JulianDate ../Core/Matrix3 ../Core/Matrix4 ../Core/ReferenceFrame ../Core/TimeInterval ../Core/Transforms ../Scene/PolylineCollection ../Scene/SceneMode ./CompositePositionProperty ./ConstantPositionProperty ./MaterialProperty ./Property ./ReferenceProperty ./SampledPositionProperty ./ScaledPositionProperty ./TimeIntervalCollectionPositionProperty".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){function v(a){this.entity=a;this.updater=this.index=this.polyline=void 0}function B(a,b,d,e,g,h,k,m){for(;a instanceof A;)a=a.resolvedProperty;if(a instanceof z){var q=a;a=a._property._times;var t;t=q.getValueInReferenceFrame(b,g,m[k]);f(t)&&(m[k++]=t);for(var u=!f(e)||l.lessThanOrEquals(e,b)||l.greaterThanOrEquals(e,d),v=0,E=a.length,C=a[v],L=!1,K,H,I;v<E;){!u&&l.greaterThanOrEquals(C,e)&&(t=q.getValueInReferenceFrame(e,g,m[k]),f(t)&&(m[k++]=t),u=!0);l.greaterThan(C,b)&&l.lessThan(C,d)&&!C.equals(e)&&(t=q.getValueInReferenceFrame(C,g,m[k]),f(t)&&(m[k++]=t));if(v<E-1&&(0<h&&!L&&(t=l.secondsDifference(a[v+1],C),L=t>h)&&(K=Math.ceil(t/h),H=0,I=t/Math.max(K,2),K=Math.max(K-1,1)),L&&H<K)){C=l.addSeconds(C,I,new l);H++;continue}L=!1;v++;C=a[v]}t=q.getValueInReferenceFrame(d,g,m[k]);f(t)&&(m[k++]=t)}else if(a instanceof r){w.start=b;w.stop=d;q=k;K=a.intervals;for(H=0;H<K.length;H++)I=K.get(H),p.intersect(I,w,J).isEmpty||(u=I.start,a=I.stop,k=b,l.greaterThan(u,k)&&(k=u),u=d,l.lessThan(a,u)&&(u=a),q=B(I.data,k,u,e,g,h,q,m));k=q}else if(a instanceof D){e=a;G.start=b;G.stop=d;b=k;d=e.intervals;for(h=0;h<d.length;h++)q=d.get(h),p.intersect(q,G,J).isEmpty||(K=q.start,q.isStartIncluded||(K=q.isStopIncluded?q.stop:l.addSeconds(q.start,l.secondsDifference(q.stop,q.start)/2,new l)),q=e.getValueInReferenceFrame(K,g,m[b]),f(q)&&(m[b]=q,b++));k=b}else if(a instanceof c||a instanceof x&&y.isConstant(a))d=k,g=a.getValueInReferenceFrame(b,g,m[d]),f(g)&&(m[d++]=g),k=d;else{q=a;K=0;H=k;I=b;a=Math.max(h,60);for(k=!f(e)||l.lessThanOrEquals(e,b)||l.greaterThanOrEquals(e,d);l.lessThan(I,d);)!k&&l.greaterThanOrEquals(I,e)&&(k=!0,h=q.getValueInReferenceFrame(e,g,m[H]),f(h)&&(m[H]=h,H++)),h=q.getValueInReferenceFrame(I,g,m[H]),f(h)&&(m[H]=h,H++),K++,I=l.addSeconds(b,a*K,new l);h=q.getValueInReferenceFrame(d,g,m[H]);f(h)&&(m[H]=h,H++);k=H}return k}function C(a,b,c,d,e,g,h){f(h)||(h=[]);a=B(a,b,c,d,e,g,0,h);h.length=a;return h}function I(a,b){this._unusedIndexes=[];this._polylineCollection=new q;this._scene=a;this._referenceFrame=b;a.primitives.add(this._polylineCollection)}function H(a,c){if(!f(a))throw new g("scene is required.");if(!f(c))throw new g("entityCollection is required.");c.collectionChanged.addEventListener(H.prototype._onCollectionChanged,this);this._scene=a;this._updaters={};this._entityCollection=c;this._items=new b;this._onCollectionChanged(c,c.values,[],[])}var J=new p,w=new p,G=new p,E=new m;I.prototype.update=function(b){if(this._referenceFrame===h.INERTIAL){var c=d.computeIcrfToFixedMatrix(b,E);f(c)||(c=d.computeTemeToPseudoFixedMatrix(b,E));e.fromRotationTranslation(c,a.ZERO,this._polylineCollection.modelMatrix)}};I.prototype.updateObject=function(a,b){var c=b.entity,d=c._path,e=c._position,g,h,k=d._show,m=b.polyline,p=c.isShowing&&(!f(k)||k.getValue(a));if(p){var q=y.getValueOrUndefined(d._leadTime,a),r=y.getValueOrUndefined(d._trailTime,a),w=c._availability,t=f(w),k=f(q),v=f(r);if(p=t||k&&v){v&&(g=l.addSeconds(a,-r,new l));k&&(h=l.addSeconds(a,q,new l));if(t){p=w.start;w=w.stop;if(!v||l.greaterThan(p,g))g=p;if(!k||l.lessThan(w,h))h=w}p=l.lessThan(g,h)}}p?(f(m)||(m=this._unusedIndexes,0<m.length?(k=m.pop(),m=this._polylineCollection.get(k),b.index=k):(b.index=this._polylineCollection.length,m=this._polylineCollection.add()),m.id=c,b.polyline=m),c=y.getValueOrDefault(d._resolution,a,60),m.show=!0,m.positions=C(e,g,h,a,this._referenceFrame,c,m.positions.slice()),m.material=u.getValue(a,d._material,m.material),m.width=y.getValueOrDefault(d._width,a,1),m.distanceDisplayCondition=y.getValueOrUndefined(d._distanceDisplayCondition,a,m.distanceDisplayCondition)):f(m)&&(this._unusedIndexes.push(b.index),b.polyline=void 0,m.show=!1,b.index=void 0)};I.prototype.removeObject=function(a){var b=a.polyline;f(b)&&(this._unusedIndexes.push(a.index),a.polyline=void 0,b.show=!1,b.id=void 0,a.index=void 0)};I.prototype.destroy=function(){this._scene.primitives.remove(this._polylineCollection);return k(this)};H.prototype.update=function(a){if(!f(a))throw new g("time is required.");var b=this._updaters,c;for(c in b)b.hasOwnProperty(c)&&b[c].update(a);b=this._items.values;c=0;for(var d=b.length;c<d;c++){var e=b[c],k=e.entity._position,l=e.updater,m=h.FIXED;this._scene.mode===t.SCENE3D&&(m=k.referenceFrame);k=this._updaters[m];l===k&&f(k)?k.updateObject(a,e):(f(l)&&l.removeObject(e),f(k)||(k=new I(this._scene,m),k.update(a),this._updaters[m]=k),e.updater=k,f(k)&&k.updateObject(a,e))}return!0};H.prototype.isDestroyed=function(){return!1};H.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(H.prototype._onCollectionChanged,this);var a=this._updaters,b;for(b in a)a.hasOwnProperty(b)&&a[b].destroy();return k(this)};H.prototype._onCollectionChanged=function(a,b,c,d){var e,g=this._items;for(a=b.length-1;-1<a;a--)e=b[a],f(e._path)&&f(e._position)&&g.set(e.id,new v(e));for(a=d.length-1;-1<a;a--)e=d[a],f(e._path)&&f(e._position)?g.contains(e.id)||g.set(e.id,new v(e)):(b=g.get(e.id),f(b)&&(f(b.updater)&&b.updater.removeObject(b),g.remove(e.id)));for(a=c.length-1;-1<a;a--)e=c[a],b=g.get(e.id),f(b)&&(f(b.updater)&&b.updater.removeObject(b),g.remove(e.id))};H._subSample=C;return H});F("Scene/createBillboardPointCallback",[],function(){return function(b,a,f,k,g){return function(){var l=document.createElement("canvas"),m=g+2*k;l.height=l.width=m;var e=l.getContext("2d");e.clearRect(0,0,m,m);0!==k&&(e.beginPath(),e.arc(m/2,m/2,m/2,0,2*Math.PI,!0),e.closePath(),e.fillStyle=f,e.fill(),1>b&&(e.save(),e.globalCompositeOperation="destination-out",e.beginPath(),e.arc(m/2,m/2,g/2,0,2*Math.PI,!0),e.closePath(),e.fillStyle="black",e.fill(),e.restore()));e.beginPath();e.arc(m/2,m/2,g/2,0,2*Math.PI,!0);e.closePath();e.fillStyle=a;e.fill();return l}}});F("DataSources/PointVisualizer","../Core/AssociativeArray ../Core/Cartesian3 ../Core/Color ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/NearFarScalar ../Scene/createBillboardPointCallback ../Scene/HeightReference ../Scene/SceneMode ../Scene/VerticalOrigin ./BoundingSphereState ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a){this.entity=a;this.outlineWidth=this.pixelSize=this.outlineColor=this.color=this.billboard=this.pointPrimitive=void 0}function u(a,c){if(!k(a))throw new l("entityCluster is required.");if(!k(c))throw new l("entityCollection is required.");c.collectionChanged.addEventListener(u.prototype._onCollectionChanged,this);this._cluster=a;this._entityCollection=c;this._items=new b;this._onCollectionChanged(c,c.values,[],[])}function y(a,b,c){k(a)&&(k(a.pointPrimitive)?(a.pointPrimitive=void 0,c.removePoint(b)):k(a.billboard)&&(a.billboard=void 0,c.removeBillboard(b)))}var A=f.WHITE,z=f.BLACK,x=new f,D=new a,v=new f,B=new e,C=new e,I=new m;u.prototype.update=function(b,c){if(!k(b))throw new l("time is required.");for(var e=this._items.values,g=this._cluster,m=0,t=e.length;m<t;m++){var u=e[m],H=u.entity,J=H._point,O=u.pointPrimitive,Z=u.billboard,aa;aa=c===d.SCENE3D?r.getValueOrDefault(J._heightReference,b,p.NONE):p.NONE;var U=H.isShowing&&H.isAvailable(b)&&r.getValueOrDefault(J._show,b,!0),W;U&&(W=r.getValueOrUndefined(H._position,b,D),U=k(W));if(U){r.isConstant(H._position)||(g._clusterDirty=!0);var M=!1,U=!1;aa===p.NONE||k(Z)?aa!==p.NONE||k(O)||(k(Z)&&(y(u,H,g),Z=void 0),O=g.getPoint(H),O.id=H,u.pointPrimitive=O):(k(O)&&(y(u,H,g),O=void 0),Z=g.getBillboard(H),Z.id=H,Z.image=void 0,u.billboard=Z,M=!0,U=a.equals(Z.position,W)&&Z.heightReference===aa);k(O)?(O.show=!0,O.position=W,O.scaleByDistance=r.getValueOrUndefined(J._scaleByDistance,b,B),O.translucencyByDistance=r.getValueOrUndefined(J._translucencyByDistance,b,C),O.color=r.getValueOrDefault(J._color,b,A,x),O.outlineColor=r.getValueOrDefault(J._outlineColor,b,z,v),O.outlineWidth=r.getValueOrDefault(J._outlineWidth,b,0),O.pixelSize=r.getValueOrDefault(J._pixelSize,b,1),O.distanceDisplayCondition=c===d.SCENE3D?r.getValueOrUndefined(J._distanceDisplayCondition,b,I):void 0,O.disableDepthTestDistance=r.getValueOrDefault(J._disableDepthTestDistance,b,0)):k(Z)&&(Z.show=!0,Z.position=W,Z.scaleByDistance=r.getValueOrUndefined(J._scaleByDistance,b,B),Z.translucencyByDistance=r.getValueOrUndefined(J._translucencyByDistance,b,C),Z._pixelOffset.x=0,Z._pixelOffset.y=0,Z._verticalOrigin=q.CENTER,Z._width=void 0,Z._height=void 0,Z._imageWidth=void 0,Z._imageHeight=void 0,Z.distanceDisplayCondition=c===d.SCENE3D?r.getValueOrUndefined(J._distanceDisplayCondition,b,I):void 0,Z.disableDepthTestDistance=r.getValueOrDefault(J._disableDepthTestDistance,b,0),Z.heightReference=aa,aa=r.getValueOrDefault(J._color,b,A,x),O=r.getValueOrDefault(J._outlineColor,b,z,v),H=Math.round(r.getValueOrDefault(J._outlineWidth,b,0)),J=Math.max(1,Math.round(r.getValueOrDefault(J._pixelSize,b,1))),0<H?(Z.scale=1,M=M||H!==u.outlineWidth||J!==u.pixelSize||!f.equals(aa,u.color)||!f.equals(O,u.outlineColor)):(Z.scale=J/50,J=50,M=M||H!==u.outlineWidth||!f.equals(aa,u.color)||!f.equals(O,u.outlineColor)),M&&(u.color=f.clone(aa,u.color),u.outlineColor=f.clone(O,u.outlineColor),u.pixelSize=J,u.outlineWidth=H,u=aa.alpha,M=aa.toCssColorString(),O=O.toCssColorString(),aa=JSON.stringify([M,J,O,H]),Z.setImage(aa,h(u,M,O,H,J))),U&&Z._updateClamping())}else y(u,H,g)}return!0};u.prototype.getBoundingSphere=function(b,c){if(!k(b))throw new l("entity is required.");if(!k(c))throw new l("result is required.");var d=this._items.get(b.id);if(!k(d)||!k(d.pointPrimitive)&&!k(d.billboard))return t.FAILED;if(k(d.pointPrimitive))c.center=a.clone(d.pointPrimitive.position,c.center);else{d=d.billboard;if(!k(d._clampedPosition))return t.PENDING;c.center=a.clone(d._clampedPosition,c.center)}c.radius=0;return t.DONE};u.prototype.isDestroyed=function(){return!1};u.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(u.prototype._onCollectionChanged,this);for(var a=this._entityCollection.values,b=0;b<a.length;b++)this._cluster.removePoint(a[b]);return g(this)};u.prototype._onCollectionChanged=function(a,b,d,e){var f,g=this._items,h=this._cluster;for(a=b.length-1;-1<a;a--)f=b[a],k(f._point)&&k(f._position)&&g.set(f.id,new c(f));for(a=e.length-1;-1<a;a--)f=e[a],k(f._point)&&k(f._position)?g.contains(f.id)||g.set(f.id,new c(f)):(y(g.get(f.id),f,h),g.remove(f.id));for(a=d.length-1;-1<a;a--)f=d[a],y(g.get(f.id),f,h),g.remove(f.id)};return u});F("DataSources/PolylineGeometryUpdater","../Core/ArcType ../Core/BoundingSphere ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/Event ../Core/GeometryInstance ../Core/GroundPolylineGeometry ../Core/Iso8601 ../Core/oneTimeWarning ../Core/PolylineGeometry ../Core/PolylinePipeline ../Core/ShowGeometryInstanceAttribute ../DataSources/Entity ../Scene/ClassificationType ../Scene/GroundPolylinePrimitive ../Scene/PolylineCollection ../Scene/PolylineColorAppearance ../Scene/PolylineMaterialAppearance ../Scene/ShadowMode ./BoundingSphereState ./ColorMaterialProperty ./ConstantProperty ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K){function P(){this.granularity=this.arcType=this.width=this.positions=this.vertexFormat=void 0}function N(){this.granularity=this.arcType=this.width=this.positions=void 0}function O(a,b){if(!m(a))throw new p("entity is required");if(!m(b))throw new p("scene is required");this._entity=a;this._scene=b;this._entitySubscription=a.definitionChanged.addEventListener(O.prototype._onEntityPropertyChanged,this);this._dynamic=this._fillEnabled=!1;this._geometryChanged=new t;this._depthFailMaterialProperty=this._classificationTypeProperty=this._distanceDisplayConditionProperty=this._shadowsProperty=this._materialProperty=this._showProperty=void 0;this._geometryOptions=new P;this._groundGeometryOptions=new N;this._id="polyline-"+a.id;this._clampToGround=!1;this._supportsPolylinesOnTerrain=D.supportsPolylinesOnTerrain(b);this._zIndex=0;this._onEntityPropertyChanged(a,"polyline",a.polyline,void 0)}function Z(a,b,c){this._line=void 0;this._primitives=a;this._groundPrimitives=b;this._material=this._groundPolylinePrimitive=void 0;this._geometryUpdater=c;this._positions=[]}function aa(a){if(m(a._line))return a._line;var b=a._geometryUpdater._scene.id,c=W[b],d=a._primitives;!m(c)||c.isDestroyed()?(c=new C,W[b]=c,d.add(c)):d.contains(c)||d.add(c);b=c.add();b.id=a._geometryUpdater._entity;return a._line=b}var U=new E(0),W={},M=new k,R=new G(k.WHITE),Y=new E(!0),Q=new E(J.DISABLED),S=new E(new d),F=new E(v.BOTH);e(O.prototype,{id:{get:function(){return this._id}},entity:{get:function(){return this._entity}},fillEnabled:{get:function(){return this._fillEnabled}},hasConstantFill:{get:function(){return!this._fillEnabled||!m(this._entity.availability)&&K.isConstant(this._showProperty)}},fillMaterialProperty:{get:function(){return this._materialProperty}},depthFailMaterialProperty:{get:function(){return this._depthFailMaterialProperty}},outlineEnabled:{value:!1},hasConstantOutline:{value:!0},outlineColorProperty:{value:void 0},shadowsProperty:{get:function(){return this._shadowsProperty}},distanceDisplayConditionProperty:{get:function(){return this._distanceDisplayConditionProperty}},classificationTypeProperty:{get:function(){return this._classificationTypeProperty}},isDynamic:{get:function(){return this._dynamic}},isClosed:{value:!1},geometryChanged:{get:function(){return this._geometryChanged}},arcType:{get:function(){return this._arcType}},clampToGround:{get:function(){return this._clampToGround&&this._supportsPolylinesOnTerrain}},zIndex:{get:function(){return this._zIndex}}});O.prototype.isOutlineVisible=function(a){return!1};O.prototype.isFilled=function(a){var b=this._entity;a=this._fillEnabled&&b.isAvailable(a)&&this._showProperty.getValue(a);return l(a,!1)};O.prototype.createFillGeometryInstance=function(a){if(!m(a))throw new p("time is required.");if(!this._fillEnabled)throw new p("This instance does not represent a filled geometry.");var b=this._entity,d=b.isAvailable(a),e=new x(d&&b.isShowing&&this._showProperty.getValue(a)),f=this._distanceDisplayConditionProperty.getValue(a),f=q.fromDistanceDisplayCondition(f),e={show:e,distanceDisplayCondition:f},h;this._materialProperty instanceof G&&(m(this._materialProperty.color)&&(this._materialProperty.color.isConstant||d)&&(h=this._materialProperty.color.getValue(a,M)),m(h)||(h=k.WHITE),e.color=g.fromColor(h));if(this.clampToGround)return new r({id:b,geometry:new c(this._groundGeometryOptions),attributes:e});m(this._depthFailMaterialProperty)&&this._depthFailMaterialProperty instanceof G&&(m(this._depthFailMaterialProperty.color)&&(this._depthFailMaterialProperty.color.isConstant||d)&&(h=this._depthFailMaterialProperty.color.getValue(a,M)),m(h)||(h=k.WHITE),e.depthFailColor=g.fromColor(h));return new r({id:b,geometry:new A(this._geometryOptions),attributes:e})};O.prototype.createOutlineGeometryInstance=function(a){throw new p("This instance does not represent an outlined geometry.");};O.prototype.isDestroyed=function(){return!1};O.prototype.destroy=function(){this._entitySubscription();h(this)};O.prototype._onEntityPropertyChanged=function(a,b,c,d){if("availability"===b||"polyline"===b){var e=this._entity.polyline;if(m(e))if(d=e.positions,c=e.show,m(c)&&c.isConstant&&!c.getValue(u.MINIMUM_VALUE)||!m(d))this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this));else{a=e.zIndex;var f=l(e.material,R);b=f instanceof G;this._materialProperty=f;this._depthFailMaterialProperty=e.depthFailMaterial;this._showProperty=l(c,Y);this._shadowsProperty=l(e.shadows,Q);this._distanceDisplayConditionProperty=l(e.distanceDisplayCondition,S);this._classificationTypeProperty=l(e.classificationType,F);this._fillEnabled=!0;this._zIndex=l(a,U);var f=e.width,g=e.arcType;c=e.clampToGround;var h=e.granularity;d.isConstant&&K.isConstant(f)&&K.isConstant(g)&&K.isConstant(h)&&K.isConstant(c)&&K.isConstant(a)?(e=this._geometryOptions,d=d.getValue(u.MINIMUM_VALUE,e.positions),!m(d)||2>d.length?this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this)):(b=b&&(!m(this._depthFailMaterialProperty)||this._depthFailMaterialProperty instanceof G)?I.VERTEX_FORMAT:H.VERTEX_FORMAT,e.vertexFormat=b,e.positions=d,e.width=m(f)?f.getValue(u.MINIMUM_VALUE):void 0,e.arcType=m(g)?g.getValue(u.MINIMUM_VALUE):void 0,e.granularity=m(h)?h.getValue(u.MINIMUM_VALUE):void 0,b=this._groundGeometryOptions,b.positions=d,b.width=e.width,b.arcType=e.arcType,b.granularity=e.granularity,this._clampToGround=m(c)?c.getValue(u.MINIMUM_VALUE):!1,!this._clampToGround&&m(a)&&y("Entity polylines must have clampToGround: true when using zIndex.  zIndex will be ignored."),this._dynamic=!1,this._geometryChanged.raiseEvent(this))):this._dynamic||(this._dynamic=!0,this._geometryChanged.raiseEvent(this))}else this._fillEnabled&&(this._fillEnabled=!1,this._geometryChanged.raiseEvent(this))}};O.prototype.createDynamicUpdater=function(a,b){f.defined("primitives",a);f.defined("groundPrimitives",b);if(!this._dynamic)throw new p("This instance does not represent dynamic geometry.");return new Z(a,b,this)};var T={positions:void 0,granularity:void 0,height:void 0,ellipsoid:void 0};Z.prototype.update=function(a){var c=this._geometryUpdater,d=c._entity,e=d.polyline,f=K.getValueOrUndefined(e.positions,a,this._positions);c._clampToGround=K.getValueOrDefault(e._clampToGround,a,!1);c._groundGeometryOptions.positions=f;c._groundGeometryOptions.width=K.getValueOrDefault(e._width,a,1);c._groundGeometryOptions.arcType=K.getValueOrDefault(e._arcType,a,b.GEODESIC);c._groundGeometryOptions.granularity=K.getValueOrDefault(e._granularity,a,9999);var g=this._groundPrimitives;m(this._groundPolylinePrimitive)&&(g.remove(this._groundPolylinePrimitive),this._groundPolylinePrimitive=void 0);if(c.clampToGround)d.isShowing&&d.isAvailable(a)&&K.getValueOrDefault(e._show,a,!0)&&m(f)&&!(2>f.length)&&(e=c.fillMaterialProperty,e instanceof G?e=new I:(f=L.getValue(a,e,this._material),e=new H({material:f,translucent:f.isTranslucent()}),this._material=f),this._groundPolylinePrimitive=g.add(new B({geometryInstances:c.createFillGeometryInstance(a),appearance:e,classificationType:c.classificationTypeProperty.getValue(a),asynchronous:!1}),K.getValueOrUndefined(c.zIndex,a)),m(this._line)&&(this._line.show=!1));else if(g=aa(this),d.isShowing&&d.isAvailable(a)&&K.getValueOrDefault(e._show,a,!0))if(!m(f)||2>f.length)g.show=!1;else{var d=b.GEODESIC,d=K.getValueOrDefault(e._arcType,a,d),h=c._scene.globe;d!==b.NONE&&m(h)&&(T.ellipsoid=h.ellipsoid,T.positions=f,T.granularity=K.getValueOrUndefined(e._granularity,a),T.height=z.extractHeights(f,h.ellipsoid),f=z.generateCartesianArc(T));g.show=!0;g.positions=f.slice();g.material=L.getValue(a,c.fillMaterialProperty,g.material);g.width=K.getValueOrDefault(e._width,a,1);g.distanceDisplayCondition=K.getValueOrUndefined(e._distanceDisplayCondition,a,g.distanceDisplayCondition)}else g.show=!1};Z.prototype.getBoundingSphere=function(b){f.defined("result",b);if(this._geometryUpdater.clampToGround){var c=this._groundPolylinePrimitive;if(m(c)&&c.show&&c.ready){var d=c.getGeometryInstanceAttributes(this._geometryUpdater._entity);if(m(d)&&m(d.boundingSphere))return a.clone(d.boundingSphere,b),w.DONE}return m(c)&&!c.ready?w.PENDING:w.DONE}c=aa(this);return c.show&&0<c.positions.length?(a.fromPoints(c.positions,b),w.DONE):w.FAILED};Z.prototype.isDestroyed=function(){return!1};Z.prototype.destroy=function(){var a=this._geometryUpdater._scene.id,b=W[a];m(b)&&(b.remove(this._line),0===b.length&&(this._primitives.removeAndDestroy(b),delete W[a]));m(this._groundPolylinePrimitive)&&this._groundPrimitives.remove(this._groundPolylinePrimitive);h(this)};return O});F("DataSources/StaticGroundPolylinePerMaterialBatch","../Core/defaultValue ../Core/AssociativeArray ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defined ../Core/DistanceDisplayCondition ../Core/DistanceDisplayConditionGeometryInstanceAttribute ../Core/ShowGeometryInstanceAttribute ../Scene/GroundPolylinePrimitive ../Scene/PolylineColorAppearance ../Scene/PolylineMaterialAppearance ./BoundingSphereState ./ColorMaterialProperty ./MaterialProperty ./Property".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(b,c,e,f,g){var h;h=e instanceof t?p:d;this.orderedGroundPrimitives=b;this.classificationType=c;this.appearanceType=h;this.materialProperty=e;this.updaters=new a;this.createPrimitive=!0;this.oldPrimitive=this.primitive=void 0;this.geometry=new a;this.material=void 0;this.updatersWithAttributes=new a;this.attributes=new a;this.invalidated=!1;this.removeMaterialSubscription=e.definitionChanged.addEventListener(u.prototype.onMaterialChanged,this);this.subscriptions=new a;this.showsUpdated=new a;this.zIndex=f;this._asynchronous=g}function y(a,c,d){this._items=[];this._orderedGroundPrimitives=a;this._classificationType=c;this._asynchronous=b(d,!0)}var A=new f,z=new l,x=new l;u.prototype.onMaterialChanged=function(){this.invalidated=!0};u.prototype.isMaterial=function(a){var b=this.materialProperty;a=a.fillMaterialProperty;return a===b||a instanceof t&&b instanceof t?!0:g(b)&&b.equals(a)};u.prototype.add=function(a,b,d){a=b.id;this.updaters.set(a,b);this.geometry.set(a,d);if(b.hasConstantFill&&b.fillMaterialProperty.isConstant&&c.isConstant(b.distanceDisplayConditionProperty)){var e=this;this.subscriptions.set(a,b.entity.definitionChanged.addEventListener(function(a,c,d,f){"isShowing"===c&&e.showsUpdated.set(b.id,b)}))}else this.updatersWithAttributes.set(a,b);this.createPrimitive=!0};u.prototype.remove=function(a){a=a.id;this.createPrimitive=this.geometry.remove(a)||this.createPrimitive;if(this.updaters.remove(a)){this.updatersWithAttributes.remove(a);var b=this.subscriptions.get(a);g(b)&&(b(),this.subscriptions.remove(a));return!0}return!1};u.prototype.update=function(a){var b=!0,p=this.primitive,q=this.orderedGroundPrimitives,t=this.geometry.values;if(this.createPrimitive)0<t.length?(g(p)&&(g(this.oldPrimitive)?q.remove(p):this.oldPrimitive=p),p=new h({show:!1,asynchronous:this._asynchronous,geometryInstances:t,appearance:new this.appearanceType,classificationType:this.classificationType}),this.appearanceType===d&&(this.material=r.getValue(a,this.materialProperty,this.material),p.appearance.material=this.material),q.add(p,this.zIndex),b=!1):(g(p)&&(q.remove(p),p=void 0),a=this.oldPrimitive,g(a)&&(q.remove(a),this.oldPrimitive=void 0)),this.attributes.removeAll(),this.primitive=p,this.createPrimitive=!1;else if(g(p)&&p.ready){p.show=!0;g(this.oldPrimitive)&&(q.remove(this.oldPrimitive),this.oldPrimitive=void 0);this.appearanceType===d&&(this.material=r.getValue(a,this.materialProperty,this.material),this.primitive.appearance.material=this.material);for(var t=this.updatersWithAttributes.values,u=t.length,q=0;q<u;q++){var y=t[q],w=y.entity,G=this.geometry.get(y.id),E=this.attributes.get(G.id.id);g(E)||(E=p.getGeometryInstanceAttributes(G.id),this.attributes.set(G.id.id,E));y.fillMaterialProperty.isConstant||(G=c.getValueOrDefault(y.fillMaterialProperty.color,a,f.WHITE,A),f.equals(E._lastColor,G)||(E._lastColor=f.clone(G,E._lastColor),E.color=k.toValue(G,E.color)));w=w.isShowing&&(y.hasConstantFill||y.isFilled(a));w!==(1===E.show[0])&&(E.show=e.toValue(w,E.show));y=y.distanceDisplayConditionProperty;c.isConstant(y)||(y=c.getValueOrDefault(y,a,x,z),l.equals(y,E._lastDistanceDisplayCondition)||(E._lastDistanceDisplayCondition=l.clone(y,E._lastDistanceDisplayCondition),E.distanceDisplayCondition=m.toValue(y,E.distanceDisplayCondition)))}this.updateShows(p)}else g(p)&&!p.ready&&(b=!1);return b};u.prototype.updateShows=function(a){for(var b=this.showsUpdated.values,c=b.length,d=0;d<c;d++){var f=b[d],h=f.entity,f=this.geometry.get(f.id),k=this.attributes.get(f.id.id);g(k)||(k=a.getGeometryInstanceAttributes(f.id),this.attributes.set(f.id.id,k));h=h.isShowing;h!==(1===k.show[0])&&(k.show=e.toValue(h,k.show),f.attributes.show.value[0]=k.show[0])}this.showsUpdated.removeAll()};u.prototype.contains=function(a){return this.updaters.contains(a.id)};u.prototype.getBoundingSphere=function(a,b){var c=this.primitive;if(!c.ready)return q.PENDING;c=c.getGeometryInstanceAttributes(a.entity);if(!g(c)||!g(c.boundingSphere)||g(c.show)&&0===c.show[0])return q.FAILED;c.boundingSphere.clone(b);return q.DONE};u.prototype.destroy=function(){var a=this.primitive,b=this.orderedGroundPrimitives;g(a)&&b.remove(a);a=this.oldPrimitive;g(a)&&b.remove(a);this.removeMaterialSubscription()};y.prototype.add=function(a,b){for(var d=this._items,e=d.length,f=b.createFillGeometryInstance(a),g=c.getValueOrDefault(b.zIndex,0),h=0;h<e;++h){var k=d[h];if(k.isMaterial(b)&&k.zIndex===g){k.add(a,b,f);return}}e=new u(this._orderedGroundPrimitives,this._classificationType,b.fillMaterialProperty,g,this._asynchronous);e.add(a,b,f);d.push(e)};y.prototype.remove=function(a){for(var b=this._items,c=b.length-1;0<=c;c--){var d=b[c];if(d.remove(a)){0===d.updaters.length&&(b.splice(c,1),d.destroy());break}}};y.prototype.update=function(a){var b,c=this._items;for(b=c.length-1;0<=b;b--){var d=c[b];if(d.invalidated){c.splice(b,1);for(var e=d.updaters.values,f=e.length,g=0;g<f;g++)this.add(a,e[g]);d.destroy()}}d=!0;for(b=0;b<c.length;b++)d=c[b].update(a)&&d;return d};y.prototype.getBoundingSphere=function(a,b){for(var c=this._items,d=c.length,e=0;e<d;e++){var f=c[e];if(f.contains(a))return f.getBoundingSphere(a,b)}return q.FAILED};y.prototype.removeAllPrimitives=function(){for(var a=this._items,b=a.length,c=0;c<b;c++)a[c].destroy();this._items.length=0};return y});F("DataSources/PolylineVisualizer","../Core/AssociativeArray ../Core/BoundingSphere ../Core/Check ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Scene/ClassificationType ../Scene/PolylineColorAppearance ../Scene/PolylineMaterialAppearance ../Scene/ShadowMode ./BoundingSphereState ./ColorMaterialProperty ./DynamicGeometryBatch ./PolylineGeometryUpdater ./StaticGeometryColorBatch ./StaticGeometryPerMaterialBatch ./StaticGroundPolylinePerMaterialBatch".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a,b){for(var c=a._batches,d=c.length,e=0;e<d;e++)c[e].remove(b)}function z(a,b,c){if(c.isDynamic)a._dynamicBatch.add(b,c);else if(c.clampToGround&&c.fillEnabled){var d=c.classificationTypeProperty.getValue(b);a._groundBatches[d].add(b,c)}else{c.fillEnabled&&(d=c.shadowsProperty.getValue(b));var e=0;g(c.depthFailMaterialProperty)&&(e=c.depthFailMaterialProperty instanceof q?1:2);var f;g(d)&&(f=d+e*p.NUMBER_OF_SHADOW_MODES);c.fillEnabled&&(c.fillMaterialProperty instanceof q?a._colorBatches[f].add(b,c):a._materialBatches[f].add(b,c))}}function x(a,d,g,l){f.defined("scene",a);f.defined("entityCollection",d);l=k(l,a.groundPrimitives);g=k(g,a.primitives);this._scene=a;this._primitives=g;this._entityCollection=void 0;this._addedObjects=new b;this._removedObjects=new b;this._changedObjects=new b;var q=p.NUMBER_OF_SHADOW_MODES;this._colorBatches=Array(3*q);this._materialBatches=Array(3*q);for(a=0;a<q;++a)this._colorBatches[a]=new c(g,e,void 0,!1,a),this._materialBatches[a]=new u(g,h,void 0,!1,a),this._colorBatches[a+q]=new c(g,e,e,!1,a),this._materialBatches[a+q]=new u(g,h,e,!1,a),this._colorBatches[a+2*q]=new c(g,e,h,!1,a),this._materialBatches[a+2*q]=new u(g,h,h,!1,a);this._dynamicBatch=new t(g,l);g=m.NUMBER_OF_CLASSIFICATION_TYPES;this._groundBatches=Array(g);for(a=0;a<g;++a)this._groundBatches[a]=new y(l,a);this._batches=this._colorBatches.concat(this._materialBatches,this._dynamicBatch,this._groundBatches);this._subscriptions=new b;this._updaters=new b;this._entityCollection=d;d.collectionChanged.addEventListener(x.prototype._onCollectionChanged,this);this._onCollectionChanged(d,d.values,D)}var D=[];x.prototype.update=function(a){f.defined("time",a);var b=this._addedObjects,c=b.values,d=this._removedObjects,e=d.values,g=this._changedObjects,h=g.values,k,l,m,p;for(k=h.length-1;-1<k;k--)l=h[k],m=l.id,p=this._updaters.get(m),p.entity===l?(A(this,p),z(this,a,p)):(e.push(l),c.push(l));for(k=e.length-1;-1<k;k--)l=e[k],m=l.id,p=this._updaters.get(m),A(this,p),p.destroy(),this._updaters.remove(m),this._subscriptions.get(m)(),this._subscriptions.remove(m);for(k=c.length-1;-1<k;k--)l=c[k],m=l.id,p=new r(l,this._scene),this._updaters.set(m,p),z(this,a,p),this._subscriptions.set(m,p.geometryChanged.addEventListener(x._onGeometryChanged,this));b.removeAll();d.removeAll();g.removeAll();b=!0;c=this._batches;d=c.length;for(k=0;k<d;k++)b=c[k].update(a)&&b;return b};var v=[],B=new a;x.prototype.getBoundingSphere=function(b,c){f.defined("entity",b);f.defined("result",c);for(var e=0,g,h=this._batches,k=h.length,l=this._updaters.get(b.id),m=0;m<k;m++){g=h[m].getBoundingSphere(l,B);if(g===d.PENDING)return d.PENDING;g===d.DONE&&(v[e]=a.clone(B,v[e]),e++)}if(0===e)return d.FAILED;v.length=e;a.fromBoundingSpheres(v,c);return d.DONE};x.prototype.isDestroyed=function(){return!1};x.prototype.destroy=function(){this._entityCollection.collectionChanged.removeEventListener(x.prototype._onCollectionChanged,this);this._addedObjects.removeAll();this._removedObjects.removeAll();var a,b=this._batches,c=b.length;for(a=0;a<c;a++)b[a].removeAllPrimitives();b=this._subscriptions.values;c=b.length;for(a=0;a<c;a++)b[a]();this._subscriptions.removeAll();return l(this)};x._onGeometryChanged=function(a){var b=this._changedObjects;a=a.entity;var c=a.id;g(this._removedObjects.get(c))||g(b.get(c))||b.set(c,a)};x.prototype._onCollectionChanged=function(a,b,c){a=this._addedObjects;var d=this._removedObjects,e=this._changedObjects,f,g,h;for(f=c.length-1;-1<f;f--)h=c[f],g=h.id,a.remove(g)||(d.set(g,h),e.remove(g));for(f=b.length-1;-1<f;f--)h=b[f],g=h.id,d.remove(g)?e.set(g,h):a.set(g,h)};return x});F("DataSources/DataSourceDisplay","../Core/ApproximateTerrainHeights ../Core/BoundingSphere ../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/EventHelper ../Scene/GroundPolylinePrimitive ../Scene/GroundPrimitive ../Scene/OrderedGroundPrimitiveCollection ../Scene/PrimitiveCollection ../FeDataSources/conicSensor/RectangularSensorVisualizer ../FeDataSources/conicalRadar/ConicalRadarVisualizer ../FeDataSources/Ribbon/RibbonVisualizer ../FeDataSources/RingRadar/RingRadarVisualizer ../FeDataSources/ParabolaRadar/ParabolaRadarVisualizer ../FeDataSources/SquareconeScanner/SquareconeVisualizer ../FeDataSources/RingconeScanner/RingconeVisualizer ./BillboardVisualizer ./BoundingSphereState ./CustomDataSource ./GeometryVisualizer ./LabelVisualizer ./ModelVisualizer ./PathVisualizer ./PointVisualizer ./PolylineVisualizer".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w){function G(a){f.typeOf.object("options",a);f.typeOf.object("options.scene",a.scene);f.typeOf.object("options.dataSourceCollection",a.dataSourceCollection);p.initializeTerrainHeights();h.initializeTerrainHeights();var b=a.scene,c=a.dataSourceCollection;this._eventHelper=new e;this._eventHelper.add(c.dataSourceAdded,this._onDataSourceAdded,this);this._eventHelper.add(c.dataSourceRemoved,this._onDataSourceRemoved,this);this._eventHelper.add(c.dataSourceMoved,this._onDataSourceMoved,this);this._dataSourceCollection=c;this._scene=b;this._visualizersCallback=k(a.visualizersCallback,G.defaultVisualizersCallback);a=!1;var d=new q,g=new q;0<c.length&&(b.primitives.add(d),b.groundPrimitives.add(g),a=!0);this._primitives=d;this._groundPrimitives=g;for(var l=0,m=c.length;l<m;l++)this._onDataSourceAdded(c,c.get(l));l=new v;this._onDataSourceAdded(void 0,l);this._defaultDataSource=l;var r,w;if(!a){var t=this;a=function(){b.primitives.add(d);b.groundPrimitives.add(g);r();w();t._removeDefaultDataSoureListener=void 0;t._removeDataSourceCollectionListener=void 0};r=l.entities.collectionChanged.addEventListener(a);w=c.dataSourceAdded.addEventListener(a)}this._removeDefaultDataSoureListener=r;this._removeDataSourceCollectionListener=w;this._ready=!1}G.defaultVisualizersCallback=function(a,b,d){var e=d.entities;return[new x(b,e),new B(a,e,d._primitives,d._groundPrimitives),new C(b,e),new I(a,e),new J(b,e),new H(a,e),new w(a,e,d._primitives,d._groundPrimitives),new t(a,e),new r(a,e),new c(a,e),new u(a,e),new y(a,e),new A(a,e),new z(a,e)]};l(G.prototype,{scene:{get:function(){return this._scene}},dataSources:{get:function(){return this._dataSourceCollection}},defaultDataSource:{get:function(){return this._defaultDataSource}},ready:{get:function(){return this._ready}}});G.prototype.isDestroyed=function(){return!1};G.prototype.destroy=function(){this._eventHelper.removeAll();for(var a=this._dataSourceCollection,b=0,c=a.length;b<c;++b)this._onDataSourceRemoved(this._dataSourceCollection,a.get(b));this._onDataSourceRemoved(void 0,this._defaultDataSource);g(this._removeDefaultDataSoureListener)?(this._removeDefaultDataSoureListener(),this._removeDataSourceCollectionListener()):(this._scene.primitives.remove(this._primitives),this._scene.groundPrimitives.remove(this._groundPrimitives));return m(this)};G.prototype.update=function(a){f.defined("time",a);if(!b.initialized)return this._ready=!1;var c=!0,d,e,h,k,l=this._dataSourceCollection,m=l.length;for(d=0;d<m;d++)for(e=l.get(d),g(e.update)&&(c=e.update(a)&&c),h=e._visualizers,k=h.length,e=0;e<k;e++)c=h[e].update(a)&&c;h=this._defaultDataSource._visualizers;k=h.length;for(e=0;e<k;e++)c=h[e]instanceof J||h[e]instanceof x||h[e]instanceof C?h[e].update(a,this.scene.mode)&&c:h[e].update(a)&&c;return this._ready=c};var E=[],L=new a;G.prototype.getBoundingSphere=function(b,c,d){f.defined("entity",b);f.typeOf.bool("allowPartial",c);f.defined("result",d);if(!this._ready)return D.PENDING;var e,h,k=this._defaultDataSource;if(!k.entities.contains(b)){var k=void 0,l=this._dataSourceCollection;h=l.length;for(e=0;e<h;e++){var m=l.get(e);if(m.entities.contains(b)){k=m;break}}}if(!g(k))return D.FAILED;h=0;l=k._visualizers;m=l.length;for(e=0;e<m;e++)if(g(l[e].getBoundingSphere)){k=l[e].getBoundingSphere(b,L);if(!c&&k===D.PENDING)return D.PENDING;k===D.DONE&&(E[h]=a.clone(L,E[h]),h++)}if(0===h)return D.FAILED;E.length=h;a.fromBoundingSpheres(E,d);return D.DONE};G.prototype._onDataSourceAdded=function(a,b){var c=this._scene,e=this._groundPrimitives,f=this._primitives.add(new q),e=e.add(new d);b._primitives=f;b._groundPrimitives=e;e=b.clustering;e._initialize(c);f.add(e);b._visualizers=this._visualizersCallback(c,e,b)};G.prototype._onDataSourceRemoved=function(a,b){var c=this._primitives,d=this._groundPrimitives,e=b._primitives,f=b._groundPrimitives;e.remove(b.clustering);for(var g=b._visualizers,h=g.length,k=0;k<h;k++)g[k].destroy();c.remove(e);d.remove(f);b._visualizers=void 0};G.prototype._onDataSourceMoved=function(a,b,c){var d=this._primitives,e=this._groundPrimitives,f=a._primitives;a=a._groundPrimitives;b===c+1?(d.raise(f),e.raise(a)):b===c-1?(d.lower(f),e.lower(a)):0===b?(d.lowerToBottom(f),e.lowerToBottom(a),d.raise(f),e.raise(a)):(d.raiseToTop(f),e.raiseToTop(a))};return G});F("DataSources/EntityView","../Core/Cartesian3 ../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Ellipsoid ../Core/HeadingPitchRange ../Core/JulianDate ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/Transforms ../Scene/SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(c,d,e){a.defined("entity",c);a.defined("scene",d);this.entity=c;this.scene=d;this.ellipsoid=f(e,l.WGS84);this._mode=this._lastEntity=this.boundingSphere=void 0;this._lastCartesian=new b;this._defaultOffset3D=void 0;this._offset3D=new b}var c=new p,u=new p,y=new p,A=new d,z=new b,x=new b,D=new b,v=new b,B=new b,C=new b,I=new e;g(r,{defaultOffset3D:{get:function(){return this._defaultOffset3D},set:function(a){this._defaultOffset3D=b.clone(a,new b)}}});r.defaultOffset3D=new b(-14E3,3500,3500);var H=new m,J=new b;r.prototype.update=function(d,f){a.defined("time",d);var g=this.scene,l=this.ellipsoid,m=g.mode;if(m!==t.MORPHING){var w=this.entity,G=w.position;if(k(G)){var O=w!==this._lastEntity,Z=m!==this._mode,g=g.camera,aa=O||Z,U=!0;O?(O=w.viewFrom,Z=k(O),!Z&&k(f)?(H.pitch=-h.PI_OVER_FOUR,H.range=0,U=G.getValue(d,J),k(U)&&(U=2-1/Math.max(1,b.magnitude(U)/l.maximumRadius),H.pitch*=U),g.viewBoundingSphere(f,H),this.boundingSphere=f,U=aa=!1):Z&&k(O.getValue(d,this._offset3D))||b.clone(r._defaultOffset3D,this._offset3D)):Z||this._mode===t.SCENE2D||b.clone(g.position,this._offset3D);this._lastEntity=w;this._mode=m;m=aa;w=U;U=this.scene.mode;aa=G.getValue(d,this._lastCartesian);if(k(aa)){var Z=O=!1,W,M,R;if(U===t.SCENE3D){e.addSeconds(d,.001,I);var Y=G.getValue(I,z);k(Y)||(e.addSeconds(d,-.001,I),Y=G.getValue(I,z),Z=!0);if(k(Y)){var Q=q.computeFixedToIcrfMatrix(d,c),S=q.computeFixedToIcrfMatrix(I,u);k(Q)&&k(S)?G=p.transpose(Q,y):(G=q.computeTemeToPseudoFixedMatrix(d,y),Q=p.transpose(G,c),S=q.computeTemeToPseudoFixedMatrix(I,u),p.transpose(S,S));Q=p.multiplyByVector(Q,aa,B);S=p.multiplyByVector(S,Y,C);b.subtract(Q,S,v);var F=1E3*b.magnitude(v),T=h.GRAVITATIONALPARAMETER,F=-T/(F*F-2*T/b.magnitude(Q));0>F||F>1.25*l.maximumRadius?(W=x,b.normalize(aa,W),b.negate(W,W),R=b.clone(b.UNIT_Z,D),M=b.cross(R,W,z),b.magnitude(M)>h.EPSILON7&&(b.normalize(W,W),b.normalize(M,M),R=b.cross(W,M,D),b.normalize(R,R),O=!0)):b.equalsEpsilon(aa,Y,h.EPSILON7)||(R=x,b.normalize(Q,R),b.normalize(S,S),M=b.cross(R,S,D),Z&&(M=b.multiplyByScalar(M,-1,M)),b.equalsEpsilon(M,b.ZERO,h.EPSILON7)||(W=b.cross(M,R,z),p.multiplyByVector(G,W,W),p.multiplyByVector(G,M,M),p.multiplyByVector(G,R,R),b.normalize(W,W),b.normalize(M,M),b.normalize(R,R),O=!0))}}k(this.boundingSphere)&&(aa=this.boundingSphere.center);var da,V,ba;w&&(da=b.clone(g.position,v),V=b.clone(g.direction,B),ba=b.clone(g.up,C));O?(A[0]=W.x,A[1]=W.y,A[2]=W.z,A[3]=0,A[4]=M.x,A[5]=M.y,A[6]=M.z,A[7]=0,A[8]=R.x,A[9]=R.y,A[10]=R.z,A[11]=0,A[12]=aa.x,A[13]=aa.y,A[14]=aa.z,A[15]=0):q.eastNorthUpToFixedFrame(aa,l,A);g._setTransform(A);w&&(b.clone(da,g.position),b.clone(V,g.direction),b.clone(ba,g.up),b.cross(V,ba,g.right))}m&&(l=U===t.SCENE2D||b.equals(this._offset3D,b.ZERO)?void 0:this._offset3D,g.lookAtTransform(g.transform,l))}}};return r});F("ThirdParty/zip",["../Core/buildModuleUrl","../Core/defineProperties"],function(b,a){var f={};(function(f){function g(){var a=-1,b=this;b.append=function(c){var d,e=b.table;for(d=0;d<c.length;d++)a=a>>>8^e[(a^c[d])&255]};b.get=function(){return~a}}function k(a,b,c){if(a.slice)return a.slice(b,b+c);if(a.webkitSlice)return a.webkitSlice(b,b+c);if(a.mozSlice)return a.mozSlice(b,b+c);if(a.msSlice)return a.msSlice(b,b+c)}function m(a,b){var c,d;c=new ArrayBuffer(a);d=new Uint8Array(c);b&&d.set(b,0);return{buffer:c,array:d,view:new DataView(c)}}function e(){}function h(a){var b=this,c;b.size=0;b.init=function(e,f){var g=new Blob([a],{type:"text/plain"});c=new d(g);c.init(function(){b.size=c.size;e()},f)};b.readUint8Array=function(a,b,d,e){c.readUint8Array(a,b,d,e)}}function p(a){var b=this,c;b.size=0;b.init=function(d){for(var e=a.length;"\x3d"==a.charAt(e-1);)e--;c=a.indexOf(",")+1;b.size=Math.floor(.75*(e-c));d()};b.readUint8Array=function(b,d,e){var f=m(d),g=4*Math.floor(b/3),h=window.atob(a.substring(g+c,4*Math.ceil((b+d)/3)+c));for(b=g=b-3*Math.floor(g/4);b<g+d;b++)f.array[b-g]=h.charCodeAt(b);e(f.array)}}function d(a){this.size=0;this.init=function(b){this.size=a.size;b()};this.readUint8Array=function(b,c,d,e){var f=new FileReader;f.onload=function(a){d(new Uint8Array(a.target.result))};f.onerror=e;f.readAsArrayBuffer(k(a,b,c))}}function q(){}function t(a){var b;this.init=function(a){b=new Blob([],{type:"text/plain"});a()};this.writeUint8Array=function(a,c){b=new Blob([b,J?a:a.buffer],{type:"text/plain"});c()};this.getData=function(c,d){var e=new FileReader;e.onload=function(a){c(a.target.result)};e.onerror=d;e.readAsText(b,a)}}function r(a){var b="",c="";this.init=function(c){b+="data:"+(a||"")+";base64,";c()};this.writeUint8Array=function(a,d){var e,f=c.length,g=c;c="";for(e=0;e<3*Math.floor((f+a.length)/3)-f;e++)g+=String.fromCharCode(a[e]);for(;e<a.length;e++)c+=String.fromCharCode(a[e]);2<g.length?b+=window.btoa(g):c=g;d()};this.getData=function(a){a(b+window.btoa(c))}}function c(a){var b;this.init=function(c){b=new Blob([],{type:a});c()};this.writeUint8Array=function(c,d){b=new Blob([b,J?c:c.buffer],{type:a});d()};this.getData=function(a){a(b)}}function u(a,b,c,d,e,f,g,h,k,l){function m(b){b=b.data;var d=b.data;b.onappend&&(t+=d.length,c.writeUint8Array(d,function(){f(!1,d);p()},l));b.onflush&&(d?(t+=d.length,c.writeUint8Array(d,function(){f(!1,d);a.removeEventListener("message",m,!1);h(t)},l)):(a.removeEventListener("message",m,!1),h(t)));b.progress&&g&&g(r+b.current,e)}function p(){r=524288*q;r<e?b.readUint8Array(d+r,Math.min(524288,e-r),function(b){a.postMessage({append:!0,data:b});q++;g&&g(r,e);f(!0,b)},k):a.postMessage({flush:!0})}var q=0,r,t;t=0;a.addEventListener("message",m,!1);p()}function y(a,b,c,d,e,f,g,h,k,l){function m(){var t;q=524288*p;q<e?b.readUint8Array(d+q,Math.min(524288,e-q),function(b){var h=a.append(b,function(){g&&g(d+q,e)});r+=h.length;f(!0,b);c.writeUint8Array(h,function(){f(!1,h);p++;setTimeout(m,1)},l);g&&g(q,e)},k):(t=a.flush())?(r+=t.length,c.writeUint8Array(t,function(){f(!1,t);h(r)},l)):h(r)}var p=0,q,r=0;m()}function A(a,b,c,d,e,h,k,l,m){function p(a,b){e&&!a&&t.append(b)}function q(a){h(a,t.get())}var r,t=new g;f.zip.useWebWorkers?(r=new Worker(f.zip.workerScriptsPath+"inflate.js"),u(r,a,b,c,d,p,k,q,l,m)):y(new f.zip.Inflater,a,b,c,d,p,k,q,l,m);return r}function z(a,b,c,d,e,h,k){function l(a,b){a&&r.append(b)}function m(a){d(a,r.get())}function p(){q.removeEventListener("message",p,!1);u(q,a,b,0,a.size,l,e,m,h,k)}var q,r=new g;f.zip.useWebWorkers?(q=new Worker(f.zip.workerScriptsPath+"deflate.js"),q.addEventListener("message",p,!1),q.postMessage({init:!0,level:c})):y(new f.zip.Deflater,a,b,0,a.size,l,e,m,h,k);return q}function x(a,b,c,d,e,f,h,k,l){function m(){var g=524288*p;g<d?a.readUint8Array(c+g,Math.min(524288,d-g),function(a){e&&q.append(a);h&&h(g,d,a);b.writeUint8Array(a,function(){p++;m()},l)},k):f(d,q.get())}var p=0,q=new g;m()}function D(a){var b,c="",d,e="\u00c7\u00fc\u00e9\u00e2\u00e4\u00e0\u00e5\u00e7\u00ea\u00eb\u00e8\u00ef\u00ee\u00ec\u00c4\u00c5\u00c9\u00e6\u00c6\u00f4\u00f6\u00f2\u00fb\u00f9\u00ff\u00d6\u00dc\u00f8\u00a3\u00d8\u00d7\u0192\u00e1\u00ed\u00f3\u00fa\u00f1\u00d1\u00aa\u00ba\u00bf\u00ae\u00ac\u00bd\u00bc\u00a1\u00ab\u00bb___\u00a6\u00a6\u00c1\u00c2\u00c0\u00a9\u00a6\u00a6++\u00a2\u00a5++--+-+\u00e3\u00c3++--\u00a6-+\u00a4\u00f0\u00d0\u00ca\u00cb\u00c8i\u00cd\u00ce\u00cf++__\u00a6\u00cc_\u00d3\u00df\u00d4\u00d2\u00f5\u00d5\u00b5\u00fe\u00de\u00da\u00db\u00d9\u00fd\u00dd\u00af\u00b4\u00ad\u00b1_\u00be\u00b6\u00a7\u00f7\u00b8\u00b0\u00a8\u00b7\u00b9\u00b3\u00b2_ ".split("");for(b=0;b<a.length;b++)d=a.charCodeAt(b)&255,c=127<d?c+e[d-128]:c+String.fromCharCode(d);return c}function v(a){var b,c="";for(b=0;b<a.length;b++)c+=String.fromCharCode(a[b]);return c}function B(a,b,c,d,e){a.version=b.view.getUint16(c,!0);a.bitFlag=b.view.getUint16(c+2,!0);a.compressionMethod=b.view.getUint16(c+4,!0);a.lastModDateRaw=b.view.getUint32(c+6,!0);var f;a:{var g=a.lastModDateRaw,h=(g&4294901760)>>16,g=g&65535;try{f=new Date(1980+((h&65024)>>9),((h&480)>>5)-1,h&31,(g&63488)>>11,(g&2016)>>5,2*(g&31),0);break a}catch(aa){}f=void 0}a.lastModDate=f;if(1===(a.bitFlag&1))e("File contains encrypted entry.");else{if(d||8!=(a.bitFlag&8))a.crc32=b.view.getUint32(c+10,!0),a.compressedSize=b.view.getUint32(c+14,!0),a.uncompressedSize=b.view.getUint32(c+18,!0);4294967295===a.compressedSize||4294967295===a.uncompressedSize?e("File is using Zip64 (4gb+ file size)."):(a.filenameLength=b.view.getUint16(c+22,!0),a.extraFieldLength=b.view.getUint16(c+24,!0))}}function C(a,b){function c(){}function d(c,e){a.readUint8Array(a.size-c,c,function(a){a=m(a.length,a).view;1347093766!=a.getUint32(0)?d(c+1,e):e(a)},function(){b("Error while reading zip file.")})}c.prototype.getData=function(c,d,e,f){function g(a,b){r&&r.terminate();r=null;a&&a(b)}function h(a){var b=m(4);b.view.setUint32(0,a);return q.crc32==b.view.getUint32(0)}function k(a,b){f&&!h(b)?l():c.getData(function(a){g(d,a)})}function l(){g(b,"Error while reading file data.")}function p(){g(b,"Error while writing file data.")}var q=this,r;a.readUint8Array(q.offset,30,function(d){d=m(d.length,d);var g;1347093252!=d.view.getUint32(0)?b("File format is not recognized."):(B(q,d,4,!1,b),g=q.offset+30+q.filenameLength+q.extraFieldLength,c.init(function(){0===q.compressionMethod?x(a,c,g,q.compressedSize,f,k,e,l,p):r=A(a,c,g,q.compressedSize,f,k,e,l,p)},p))},l)};return{getEntries:function(e){22>a.size?b("File format is not recognized."):d(22,function(d){var f,g;f=d.getUint32(16,!0);g=d.getUint16(8,!0);a.readUint8Array(f,a.size-f,function(a){var d=0,f=[],h,k,l=m(a.length,a);for(a=0;a<g;a++){h=new c;if(1347092738!=l.view.getUint32(d)){b("File format is not recognized.");return}B(h,l,d+6,!0,b);h.commentLength=l.view.getUint16(d+32,!0);h.directory=16==(l.view.getUint8(d+38)&16);h.offset=l.view.getUint32(d+42,!0);k=v(l.array.subarray(d+46,d+46+h.filenameLength));h.filename=2048===(h.bitFlag&2048)?decodeURIComponent(escape(k)):D(k);h.directory||"/"!=h.filename.charAt(h.filename.length-1)||(h.directory=!0);k=v(l.array.subarray(d+46+h.filenameLength+h.extraFieldLength,d+46+h.filenameLength+h.extraFieldLength+h.commentLength));h.comment=2048===(h.bitFlag&2048)?decodeURIComponent(escape(k)):D(k);f.push(h);d+=46+h.filenameLength+h.extraFieldLength+h.commentLength}e(f)},function(){b("Error while reading zip file.")})})},close:function(a){a&&a()}}}function I(a){var b,c=[];for(b=0;b<a.length;b++)c.push(a.charCodeAt(b));return c}function H(a,b,c){function d(a,b){g&&g.terminate();g=null;a&&a(b)}function e(){d(b,"Error while writing zip file.")}function f(){d(b,"Error while reading file data.")}var g,h={},k=[],l=0;return{add:function(p,q,r,t,w){function u(b){var d;B=w.lastModDate||new Date;A=m(26);h[p]={headerArray:A.array,directory:w.directory,filename:E,offset:l,comment:I(unescape(encodeURIComponent(w.comment||"")))};A.view.setUint32(0,335546376);w.version&&A.view.setUint8(0,w.version);c||0===w.level||w.directory||A.view.setUint16(4,2048);A.view.setUint16(6,(B.getHours()<<6|B.getMinutes())<<5|B.getSeconds()/2,!0);A.view.setUint16(8,(B.getFullYear()-1980<<4|B.getMonth()+1)<<5|B.getDate(),!0);A.view.setUint16(22,E.length,!0);d=m(30+E.length);d.view.setUint32(0,1347093252);d.array.set(A.array,4);d.array.set(E,30);l+=d.array.length;a.writeUint8Array(d.array,b,e)}function v(b,c){var f=m(16);l+=b||0;f.view.setUint32(0,1347094280);"undefined"!=typeof c&&(A.view.setUint32(10,c,!0),f.view.setUint32(4,c,!0));q&&(f.view.setUint32(8,b,!0),A.view.setUint32(14,b,!0),f.view.setUint32(12,q.size,!0),A.view.setUint32(18,q.size,!0));a.writeUint8Array(f.array,function(){l+=16;d(r)},e)}function y(){w=w||{};p=p.trim();w.directory&&"/"!=p.charAt(p.length-1)&&(p+="/");h.hasOwnProperty(p)?b("File already exists."):(E=I(unescape(encodeURIComponent(p))),k.push(p),u(function(){q?c||0===w.level?x(q,a,0,q.size,!0,v,t,f,e):g=z(q,a,w.level,v,t,f,e):v()},e))}var A,E,B;q?q.init(y,f):y()},close:function(b){var c,f=0,g=0,p,q;for(p=0;p<k.length;p++)q=h[k[p]],f+=46+q.filename.length+q.comment.length;c=m(f+22);for(p=0;p<k.length;p++)q=h[k[p]],c.view.setUint32(g,1347092738),c.view.setUint16(g+4,5120),c.array.set(q.headerArray,g+6),c.view.setUint16(g+32,q.comment.length,!0),q.directory&&c.view.setUint8(g+38,16),c.view.setUint32(g+42,q.offset,!0),c.array.set(q.filename,g+46),c.array.set(q.comment,g+46+q.filename.length),g+=46+q.filename.length+q.comment.length;c.view.setUint32(g,1347093766);c.view.setUint16(g+8,k.length,!0);c.view.setUint16(g+10,k.length,!0);c.view.setUint32(g+12,f,!0);c.view.setUint32(g+16,l,!0);a.writeUint8Array(c.array,function(){d(function(){a.getData(b)})},e)}}}var J;try{J=0===(new Blob([new DataView(new ArrayBuffer(0))])).size}catch(G){}g.prototype.table=function(){var a,b,c,d=[];for(a=0;256>a;a++){c=a;for(b=0;8>b;b++)c=c&1?c>>>1^3988292384:c>>>1;d[a]=c}return d}();h.prototype=new e;h.prototype.constructor=h;p.prototype=new e;p.prototype.constructor=p;d.prototype=new e;d.prototype.constructor=d;q.prototype.getData=function(a){a(this.data)};t.prototype=new q;t.prototype.constructor=t;r.prototype=new q;r.prototype.constructor=r;c.prototype=new q;c.prototype.constructor=c;f.zip={Reader:e,Writer:q,BlobReader:d,Data64URIReader:p,TextReader:h,BlobWriter:c,Data64URIWriter:r,TextWriter:t,createReader:function(a,b,c){a.init(function(){b(C(a,c))},c)},createWriter:function(a,b,c,d){a.init(function(){b(H(a,c,d))},c)},useWebWorkers:!0};var w;a(f.zip,{workerScriptsPath:{get:function(){"undefined"===typeof w&&(w=b("ThirdParty/Workers/"));return w}}})})(f);return f.zip});F("DataSources/exportKml","./BillboardGraphics ./CompositePositionProperty ./ModelGraphics ./SampledPositionProperty ./SampledProperty ./ScaledPositionProperty ./RectangleGraphics ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/Color ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Ellipsoid ../Core/isArray ../Core/Iso8601 ../Core/JulianDate ../Core/Math ../Core/Rectangle ../Core/ReferenceFrame ../Core/Resource ../Core/RuntimeError ../Core/TimeInterval ../Core/TimeIntervalCollection ../Scene/HeightReference ../Scene/HorizontalOrigin ../Scene/VerticalOrigin ../ThirdParty/when ../ThirdParty/zip".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K){function P(a){this._files={};this._promises=[];this._count=0;this._modelCallback=a}function N(a,b){return function(c){a._files[b]=c}}function O(a){this._time=a}function Z(){this._ids={};this._styles={};this._count=0}function aa(){this._ids={}}function U(a){a=t(a,t.EMPTY_OBJECT);var b=a.entities,c=t(a.kmz,!1);if(!r(b))throw new u("entities is required.");var d=U._createState(a);a=b.values.filter(function(a){return!r(a.parent)});var e=d.kmlDoc,b=e.documentElement;b.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:gx","http://www.google.com/kml/ext/2.2");e=e.createElement("Document");b.appendChild(e);Y(d,e,a);d.styleCache.save(e);var f=d.externalFileHandler;return f.promise.then(function(){var a=(new XMLSerializer).serializeToString(d.kmlDoc);return c?W(a,f.files):{kml:a,externalFiles:f.files}})}function W(a,b){var c=L.defer();K.createWriter(new K.BlobWriter,function(d){M(d,a).then(function(){var a=Object.keys(b);return R(d,a,b,0)}).then(function(){d.close(function(a){c.resolve({kmz:a})})})});return c.promise}function M(a,b){var c=L.defer();a.add("doc.kml",new K.TextReader(b),function(){c.resolve()});return c.promise}function R(a,b,c,d){if(b.length!==d){var e=b[d],f=L.defer();a.add(e,new K.BlobReader(c[e]),function(){f.resolve()});return f.promise.then(function(){return R(a,b,c,d+1)})}}function Y(a,c,d){for(var e=a.kmlDoc,f=a.styleCache,g=a.valueGetter,h=a.idManager,k=d.length,l,m,q,w=0;w<k;++w){var u=d[w];l=[];m=[];q=[];var v=a,y=u,A=m,E=q,B=v.kmlDoc,C=v.ellipsoid,G=v.valueGetter,H=t(y.billboard,y.point);if(r(H)||r(y.path)){var L=y.position;L.isConstant?(G.get(L,void 0,ia),y=ga(B,"coordinates",fa(ia,C)),C=B.createElement("Point"),B=B.createElement("altitudeMode"),B.appendChild(X(v,H.heightReference)),C.appendChild(B),C.appendChild(y),A.push(C),v=H instanceof b?ca(v,H):F(v,H),E.push(v)):Q(v,y,H,A,E)}E=a;v=u.polyline;y=m;A=q;H=E.kmlDoc;L=E.ellipsoid;B=E.valueGetter;if(r(v)){var C=H.createElement("LineString"),K=H.createElement("altitudeMode"),G=B.get(v.clampToGround,!1),I;G?(C.appendChild(ga(H,"tessellate",!0)),I=H.createTextNode("clampToGround")):I=H.createTextNode("absolute");K.appendChild(I);C.appendChild(K);K=B.get(v.positions);L=ga(H,"coordinates",fa(K,L));C.appendChild(L);L=B.get(v.zIndex);G&&r(L)&&C.appendChild(ga(H,"drawOrder",L,"http://www.google.com/kml/ext/2.2"));y.push(C);y=H.createElement("LineStyle");B=B.get(v.width);r(B)&&y.appendChild(ga(H,"width",B));ba(E,v.material,y);A.push(y)}da(a,u.rectangle,m,q,l);da(a,u.polygon,m,q,l);A=a;G=u;H=u.model;E=m;L=q;v=A.kmlDoc;B=A.ellipsoid;y=A.valueGetter;r(H)&&(C=G.position,C.isConstant?(G=V(A,H),L=v.createElement("altitudeMode"),L.appendChild(X(A,H.heightReference)),G.appendChild(L),y.get(C,void 0,ia),p.fromCartesian(ia,B,la),A=v.createElement("Location"),A.appendChild(ga(v,"longitude",D.toDegrees(la.longitude))),A.appendChild(ga(v,"latitude",D.toDegrees(la.latitude))),A.appendChild(ga(v,"altitude",la.height)),G.appendChild(A),E.push(G)):Q(A,G,H,E,L));var M,E=u.availability;r(E)&&(M=e.createElement("TimeSpan"),x.equals(E.start,z.MINIMUM_VALUE)||M.appendChild(ga(e,"begin",x.toIso8601(E.start))),x.equals(E.stop,z.MAXIMUM_VALUE)||M.appendChild(ga(e,"end",x.toIso8601(E.stop))));for(E=0;E<l.length;++E)v=l[E],v.setAttribute("id",h.get(u.id)),v.appendChild(ga(e,"name",u.name)),v.appendChild(ga(e,"visibility",u.show)),v.appendChild(ga(e,"description",u.description)),r(M)&&v.appendChild(M),c.appendChild(v);l=m.length;if(0<l){E=e.createElement("Placemark");E.setAttribute("id",h.get(u.id));v=u.name;H=u.label;r(H)&&(A=e.createElement("LabelStyle"),B=g.get(H.text),v=r(B)&&0<B.length?B:v,B=g.getColor(H.fillColor),r(B)&&(A.appendChild(ga(e,"color",B)),A.appendChild(ga(e,"colorMode","normal"))),H=g.get(H.scale),r(H)&&A.appendChild(ga(e,"scale",H)),q.push(A));E.appendChild(ga(e,"name",v));E.appendChild(ga(e,"visibility",u.show));E.appendChild(ga(e,"description",u.description));r(M)&&E.appendChild(M);c.appendChild(E);v=q.length;if(0<v){A=e.createElement("Style");for(H=0;H<v;++H)A.appendChild(q[H]);E.appendChild(ga(e,"styleUrl",f.get(A)))}if(1===m.length)E.appendChild(m[0]);else if(1<m.length){q=e.createElement("MultiGeometry");for(v=0;v<l;++v)q.appendChild(m[v]);E.appendChild(q)}}m=u._children;0<m.length&&(q=e.createElement("Folder"),q.setAttribute("id",h.get(u.id)),q.appendChild(ga(e,"name",u.name)),q.appendChild(ga(e,"visibility",u.show)),q.appendChild(ga(e,"description",u.description)),c.appendChild(q),Y(a,q,m))}}function Q(c,d,e,m,p){var q=c.kmlDoc,u=c.ellipsoid,v=c.valueGetter,y,z=d.position,A=!0;z instanceof a?(y=z.intervals,A=!1):y=t(d.availability,c.defaultAvailability);var E=e instanceof f,C,G,D,H=[];for(C=0;C<y.length;++C){G=y.get(C);var L=A?z:G.data,K=q.createElement("altitudeMode");L instanceof l?(L=L._value,K.appendChild(X(c,w.CLAMP_TO_GROUND))):r(e)?K.appendChild(X(c,e.heightReference)):K.appendChild(X(c,w.NONE));var I=[],M=[];if(L.isConstant)v.get(L,void 0,ia),L=ga(q,"coordinates",fa(ia,u)),I.push(x.toIso8601(G.start)),M.push(L),I.push(x.toIso8601(G.stop)),M.push(L);else if(L instanceof k)for(D=L._property._times,G=0;G<D.length;++G)I.push(x.toIso8601(D[G])),L.getValueInReferenceFrame(D[G],B.FIXED,ia),M.push(fa(ia,u));else if(L instanceof g)for(D=L._times,L=L._values,G=0;G<D.length;++G)I.push(x.toIso8601(D[G])),h.fromArray(L,3*G,ia),M.push(fa(ia,u));else{D=c.sampleDuration;G.start.clone(ha);G.isStartIncluded||x.addSeconds(ha,D,ha);for(var J=G.stop;x.lessThan(ha,J);)L.getValue(ha,ia),I.push(x.toIso8601(ha)),M.push(fa(ia,u)),x.addSeconds(ha,D,ha);G.isStopIncluded&&x.equals(ha,J)&&(L.getValue(ha,ia),I.push(x.toIso8601(ha)),M.push(fa(ia,u)))}L=q.createElementNS("http://www.google.com/kml/ext/2.2","Track");L.appendChild(K);for(K=0;K<I.length;++K)G=ga(q,"when",I[K]),D=ga(q,"coord",M[K],"http://www.google.com/kml/ext/2.2"),L.appendChild(G),L.appendChild(D);E&&L.appendChild(V(c,e));H.push(L)}if(1===H.length)m.push(H[0]);else if(1<H.length){u=q.createElementNS("http://www.google.com/kml/ext/2.2","MultiTrack");for(C=0;C<H.length;++C)u.appendChild(H[C]);m.push(u)}r(e)&&!E&&(e=e instanceof b?ca(c,e):F(c,e),p.push(e));d=d.path;r(d)&&(v=v.get(d.width),d=d.material,r(d)||r(v))&&(e=q.createElement("LineStyle"),r(v)&&e.appendChild(ga(q,"width",v)),ba(c,d,e),p.push(e))}function F(a,b){var c=a.kmlDoc,d=a.valueGetter,e=c.createElement("IconStyle"),f=d.getColor(b.color);r(f)&&(e.appendChild(ga(c,"color",f)),e.appendChild(ga(c,"colorMode","normal")));d=d.get(b.pixelSize);r(d)&&e.appendChild(ga(c,"scale",d/32));return e}function ca(a,b){var c=a.kmlDoc,d=a.valueGetter,f=a.externalFileHandler,g=c.createElement("IconStyle"),k=d.get(b.image);r(k)&&(k=f.texture(k),f=c.createElement("Icon"),f.appendChild(ga(c,"href",k)),k=d.get(b.imageSubRegion),r(k)&&(f.appendChild(ga(c,"x",k.x,"http://www.google.com/kml/ext/2.2")),f.appendChild(ga(c,"y",k.y,"http://www.google.com/kml/ext/2.2")),f.appendChild(ga(c,"w",k.width,"http://www.google.com/kml/ext/2.2")),f.appendChild(ga(c,"h",k.height,"http://www.google.com/kml/ext/2.2"))),g.appendChild(f));k=d.getColor(b.color);r(k)&&(g.appendChild(ga(c,"color",k)),g.appendChild(ga(c,"colorMode","normal")));f=d.get(b.scale);r(f)&&g.appendChild(ga(c,"scale",f));k=d.get(b.pixelOffset);if(r(k)){f=t(f,1);e.divideByScalar(k,f,k);var l=d.get(b.width,32),f=d.get(b.height,32),m=d.get(b.horizontalOrigin,G.CENTER);m===G.CENTER?k.x-=.5*l:m===G.RIGHT&&(k.x-=l);l=d.get(b.verticalOrigin,E.CENTER);l===E.TOP?k.y+=f:l===E.CENTER&&(k.y+=.5*f);f=c.createElement("hotSpot");f.setAttribute("x",-k.x);f.setAttribute("y",k.y);f.setAttribute("xunits","pixels");f.setAttribute("yunits","pixels");g.appendChild(f)}k=d.get(b.rotation);d=d.get(b.alignedAxis);r(k)&&h.equals(h.UNIT_Z,d)&&(k=D.toDegrees(-k),0===k&&(k=360),g.appendChild(ga(c,"heading",k)));return g}function T(a,b,c,d){var e=a.kmlDoc;a=a.ellipsoid;for(var f=[],g=b.length,h=0;h<g;++h)p.fromCartesian(b[h],a,la),f.push(D.toDegrees(la.longitude)+","+D.toDegrees(la.latitude)+","+(d?la.height:c));b=ga(e,"coordinates",f.join(" "));e=e.createElement("LinearRing");e.appendChild(b);return e}function da(a,b,c,e,f){var g=a.kmlDoc,h=a.valueGetter;if(r(b)){var k=b instanceof m;if(k&&"Image"===h.getMaterialType(b.material))e=a.kmlDoc,c=a.valueGetter,h=a.externalFileHandler,g=e.createElement("GroundOverlay"),k=e.createElement("altitudeMode"),k.appendChild(X(a,b.heightReference)),g.appendChild(k),a=c.get(b.height),r(a)&&g.appendChild(ga(e,"altitude",a)),a=c.get(b.coordinates),k=e.createElement("LatLonBox"),k.appendChild(ga(e,"north",D.toDegrees(a.north))),k.appendChild(ga(e,"south",D.toDegrees(a.south))),k.appendChild(ga(e,"east",D.toDegrees(a.east))),k.appendChild(ga(e,"west",D.toDegrees(a.west))),g.appendChild(k),b=c.get(b.material),a=h.texture(b.image),h=e.createElement("Icon"),h.appendChild(ga(e,"href",a)),g.appendChild(h),r(b.color)&&g.appendChild(ga(e,"color",ka(b.color))),f.push(g);else{f=g.createElement("Polygon");var l=h.get(b.extrudedHeight,0);0<l&&f.appendChild(ga(g,"extrude",!0));if(k){var k=a.kmlDoc,p=a.valueGetter,q;q=p.get(b.height,0);0<l&&(q=l);for(var p=p.get(b.coordinates),l=[],t=[v.northeast,v.southeast,v.southwest,v.northwest],w=0;4>w;++w)t[w](p,la),l.push(D.toDegrees(la.longitude)+","+D.toDegrees(la.latitude)+","+q);q=ga(k,"coordinates",l.join(" "));p=k.createElement("outerBoundaryIs");k=k.createElement("LinearRing");k.appendChild(q);p.appendChild(k);k=[p]}else{k=a.kmlDoc;t=a.valueGetter;q=t.get(b.height,0);p=t.get(b.perPositionHeight,!1);!p&&0<l&&(q=l);var l=[],t=t.get(b.hierarchy),w=A(t)?t:t.positions,u=k.createElement("outerBoundaryIs");u.appendChild(T(a,w,q,p));l.push(u);t=t.holes;if(r(t))for(w=t.length,u=0;u<w;++u){var y=k.createElement("innerBoundaryIs");y.appendChild(T(a,t[u].positions,q,p));l.push(y)}k=l}q=k.length;for(p=0;p<q;++p)f.appendChild(k[p]);k=g.createElement("altitudeMode");k.appendChild(X(a,b.heightReference));f.appendChild(k);c.push(f);c=g.createElement("PolyStyle");(f=h.get(b.fill,!1))&&c.appendChild(ga(g,"fill",f));ba(a,b.material,c);if(a=h.get(b.outline,!1))c.appendChild(ga(g,"outline",a)),a=g.createElement("LineStyle"),f=h.get(b.outlineWidth,1),a.appendChild(ga(g,"width",f)),b=h.getColor(b.outlineColor,d.BLACK),a.appendChild(ga(g,"color",b)),a.appendChild(ga(g,"colorMode","normal")),e.push(a);e.push(c)}}}function V(a,b){var c=a.kmlDoc,d=a.valueGetter,e=a.externalFileHandler,f=c.createElement("Model"),d=d.get(b.scale);if(r(d)){var g=c.createElement("scale");g.appendChild(ga(c,"x",d));g.appendChild(ga(c,"y",d));g.appendChild(ga(c,"z",d));f.appendChild(g)}d=c.createElement("Link");e=e.model(b,a.time);d.appendChild(ga(c,"href",e));f.appendChild(d);return f}function ba(a,b,c){var e=a.kmlDoc,f=a.valueGetter;if(r(b)&&(a=f.get(b),r(a))){var g;switch(f.getMaterialType(b)){case "Image":g=ka(d.WHITE);break;case "Color":case "Grid":case "PolylineGlow":case "PolylineArrow":case "PolylineDash":g=ka(a.color);break;case "PolylineOutline":g=ka(a.color);b=ka(a.outlineColor);a=a.outlineWidth;c.appendChild(ga(e,"outerColor",b,"http://www.google.com/kml/ext/2.2"));c.appendChild(ga(e,"outerWidth",a,"http://www.google.com/kml/ext/2.2"));break;case "Stripe":g=ka(a.oddColor)}r(g)&&(c.appendChild(ga(e,"color",g)),c.appendChild(ga(e,"colorMode","normal")))}}function X(a,b){var c=a.kmlDoc,d;switch(a.valueGetter.get(b,w.NONE)){case w.NONE:d=c.createTextNode("absolute");break;case w.CLAMP_TO_GROUND:d=c.createTextNode("clampToGround");break;case w.RELATIVE_TO_GROUND:d=c.createTextNode("relativeToGround")}return d}function fa(a,b){A(a)||(a=[a]);for(var c=a.length,d=[],e=0;e<c;++e)p.fromCartesian(a[e],b,la),d.push(D.toDegrees(la.longitude)+","+D.toDegrees(la.latitude)+","+la.height);return d.join(" ")}function ga(a,b,c,d){c=t(c,"");"boolean"===typeof c&&(c=c?"1":"0");b=r(d)?a.createElementNS(d,b):a.createElement(b);a="string"===c&&-1!==c.indexOf("\x3c")?a.createCDATASection(c):a.createTextNode(c);b.appendChild(a);return b}function ka(a){var b="";a=a.toBytes();for(var c=3;0<=c;--c)b+=16>a[c]?"0"+a[c].toString(16):a[c].toString(16);return b}var na=/^data:image\/([^,;]+)/;P.prototype.texture=function(a){var b=this,c;if("string"===typeof a||a instanceof C){a=C.createIfNeeded(a);if(!a.isDataUri)return a.url;var d=a.url.match(na);c="texture_"+ ++this._count;r(d)&&(c+="."+d[1]);a=a.fetchBlob().then(function(a){b._files[c]=a});this._promises.push(a);return c}if(a instanceof HTMLCanvasElement){var e=L.defer();this._promises.push(e.promise);c="texture_"+ ++this._count+".png";a.toBlob(function(a){b._files[c]=a;e.resolve()});return c}return""};P.prototype.model=function(a,b){var c=this._modelCallback;if(!r(c))throw new I("Encountered a model entity while exporting to KML, but no model callback was supplied.");var d={},c=c(a,b,d),e;for(e in d)if(d.hasOwnProperty(e)){var f=L(d[e]);this._promises.push(f);f.then(N(this,e))}return c};c(P.prototype,{promise:{get:function(){return L.all(this._promises)}},files:{get:function(){return this._files}}});O.prototype.get=function(a,b,c){var d;r(a)&&(d=r(a.getValue)?a.getValue(this._time,c):a);return t(d,b)};O.prototype.getColor=function(a,b){var c=this.get(a,b);if(r(c))return ka(c)};O.prototype.getMaterialType=function(a){if(r(a))return a.getType(this._time)};Z.prototype.get=function(a){var b=this._ids,c=a.innerHTML;if(r(b[c]))return b[c];var d="style-"+ ++this._count;a.setAttribute("id",d);d="#"+d;b[c]=d;this._styles[c]=a;return d};Z.prototype.save=function(a){var b=this._styles,c=a.childNodes[0],d;for(d in b)b.hasOwnProperty(d)&&a.insertBefore(b[d],c)};aa.prototype.get=function(a){if(!r(a))return this.get(q());var b=this._ids;return r(b[a])?a.toString()+"-"+ ++b[a]:(b[a]=0,a)};U._createState=function(a){var b=a.entities,c=new Z,d=b.computeAvailability(),b=r(a.time)?a.time:d.start,d=t(a.defaultAvailability,d),e=t(a.sampleDuration,60);d.start===z.MINIMUM_VALUE?d.stop===z.MAXIMUM_VALUE?d=new H:x.addSeconds(d.stop,-10*e,d.start):d.stop===z.MAXIMUM_VALUE&&x.addSeconds(d.start,10*e,d.stop);var f=new P(a.modelCallback);return{kmlDoc:document.implementation.createDocument("http://www.opengis.net/kml/2.2","kml"),ellipsoid:t(a.ellipsoid,y.WGS84),idManager:new aa,styleCache:c,externalFileHandler:f,time:b,valueGetter:new O(b),sampleDuration:e,defaultAvailability:new J([d])}};var ia=new h,la=new p,ha=new x;return U});!function(){function b(a,b){function c(b){var c=a.arcs[0>b?~b:b],d=c[0],e;a.transform?(e=[0,0],c.forEach(function(a){e[0]+=a[0];e[1]+=a[1]})):e=c[c.length-1];return 0>b?[e,d]:[d,e]}function d(a,b){for(var c in a){var d=a[c];delete b[d.start];delete d.start;delete d.end;d.forEach(function(a){e[0>a?~a:a]=1});h.push(d)}}var e={},f={},g={},h=[],k=-1;b.forEach(function(c,d){var e=a.arcs[0>c?~c:c];3>e.length&&!e[1][0]&&!e[1][1]&&(e=b[++k],b[k]=c,b[d]=e)});b.forEach(function(a){var b=c(a),d=b[0],e=b[1];(b=g[d])?(delete g[b.end],b.push(a),b.end=e,(a=f[e])?(delete f[a.start],d=a===b?b:b.concat(a),f[d.start=b.start]=g[d.end=a.end]=d):f[b.start]=g[b.end]=b):(b=f[e])?(delete f[b.start],b.unshift(a),b.start=d,(a=g[d])?(delete g[a.end],d=a===b?b:a.concat(b),f[d.start=a.start]=g[d.end=b.end]=d):f[b.start]=g[b.end]=b):(b=[a],f[b.start=d]=g[b.end=e]=b)});d(g,f);d(f,g);b.forEach(function(a){e[0>a?~a:a]||h.push([a])});return h}function a(a,d,c){var e=[];if(1<arguments.length){var f=function(a){"GeometryCollection"===a.type?a.geometries.forEach(f):a.type in p&&(m=a,p[a.type](a.arcs))},g=function(a){a.forEach(h)},h=function(a){a.forEach(k)},k=function(a){var b=0>a?~a:a;(l[b]||(l[b]=[])).push({i:a,g:m})},l=[],m,p={LineString:h,MultiLineString:g,Polygon:g,MultiPolygon:function(a){a.forEach(g)}};f(d);l.forEach(3>arguments.length?function(a){e.push(a[0].i)}:function(a){c(a[0].g,a[a.length-1].g)&&e.push(a[0].i)})}else for(var q=0,r=a.arcs.length;q<r;++q)e.push(q);return{type:"MultiLineString",arcs:b(a,e)}}function f(a,d){function c(a){a.forEach(function(b){b.forEach(function(b){(f[b=0>b?~b:b]||(f[b]=[])).push(a)})});h.push(a)}function e(b){b=g(a,{type:"Polygon",arcs:[b]}).coordinates[0];for(var c=-1,d=b.length,e,f=b[d-1],h=0;++c<d;)e=f,f=b[c],h+=e[0]*f[1]-e[1]*f[0];return 0<.5*h}var f={},h=[],k=[];d.forEach(function(a){"Polygon"===a.type?c(a.arcs):"MultiPolygon"===a.type&&a.arcs.forEach(c)});h.forEach(function(a){if(!a._){var b=[],c=[a];a._=1;for(k.push(b);a=c.pop();)b.push(a),a.forEach(function(a){a.forEach(function(a){f[0>a?~a:a].forEach(function(a){a._||(a._=1,c.push(a))})})})}});h.forEach(function(a){delete a._});return{type:"MultiPolygon",arcs:k.map(function(c){var d=[];c.forEach(function(a){a.forEach(function(a){a.forEach(function(a){2>f[0>a?~a:a].length&&d.push(a)})})});d=b(a,d);if(1<(n=d.length)){var g=e(c[0][0]);for(c=0;c<n;++c)if(g===e(d[c])){g=d[0];d[0]=d[c];d[c]=g;break}}return d})}}function k(a,b){var c={type:"Feature",id:b.id,properties:b.properties||{},geometry:g(a,b)};null==b.id&&delete c.id;return c}function g(a,b){function c(a){a=a.slice();k(a,0);return a}function d(a){for(var b=[],c=0,d=a.length;c<d;++c){var e=a[c],f=b;f.length&&f.pop();for(var g=l[0>e?~e:e],h=0,m=g.length,p;h<m;++h)f.push(p=g[h].slice()),k(p,h);if(0>e)for(e=f,f=e.length,g=f-m;g<--f;)m=e[g],e[g++]=e[f],e[f]=m}2>b.length&&b.push(b[0].slice());return b}function e(a){for(a=d(a);4>a.length;)a.push(a[0].slice());return a}function f(a){return a.map(e)}function g(a){var b=a.type;return"GeometryCollection"===b?{type:b,geometries:a.geometries.map(g)}:b in m?{type:b,coordinates:m[b](a)}:null}var k=h(a.transform),l=a.arcs,m={Point:function(a){return c(a.coordinates)},MultiPoint:function(a){return a.coordinates.map(c)},LineString:function(a){return d(a.arcs)},MultiLineString:function(a){return a.arcs.map(d)},Polygon:function(a){return f(a.arcs)},MultiPolygon:function(a){return a.arcs.map(f)}};return g(b)}function l(a,b){for(var c=0,d=a.length;c<d;){var e=c+d>>>1;a[e]<b?c=e+1:d=e}return c}function m(a){var b=a[0],c=a[1];a=a[2];return Math.abs((b[0]-a[0])*(c[1]-b[1])-(b[0]-c[0])*(a[1]-b[1]))}function e(){function a(a,b){for(;0<b;){var c=(b+1>>1)-1,e=d[c];if(0<=a[1][2]-e[1][2])break;d[e._=b]=e;d[a._=b=c]=a}}function b(a,b){for(;;){var c=b+1<<1,f=c-1,g=b,h=d[g];f<e&&0>d[f][1][2]-h[1][2]&&(h=d[g=f]);c<e&&0>d[c][1][2]-h[1][2]&&(h=d[g=c]);if(g===b)break;d[h._=b]=h;d[a._=b=g]=a}}var c={},d=[],e=0;c.push=function(b){a(d[b._=e]=b,e++);return e};c.pop=function(){if(!(0>=e)){var a=d[0],c;0<--e&&(c=d[e],b(d[c._=0]=c,0));return a}};c.remove=function(c){var f=c._,g;if(d[f]===c)return f!==--e&&(g=d[e],(0>g[1][2]-c[1][2]?a:b)(d[g._=f]=g,f)),f};return c}function h(a){if(!a)return d;var b,c,e=a.scale[0],f=a.scale[1],g=a.translate[0],h=a.translate[1];return function(a,d){d||(b=c=0);a[0]=(b+=a[0])*e+g;a[1]=(c+=a[1])*f+h}}function p(a){if(!a)return d;var b,c,e=a.scale[0],f=a.scale[1],g=a.translate[0],h=a.translate[1];return function(a,d){d||(b=c=0);var k=(a[0]-g)/e|0,l=(a[1]-h)/f|0;a[0]=k-b;a[1]=l-c;b=k;c=l}}function d(){}var q={version:"1.6.18",mesh:function(b){return g(b,a.apply(this,arguments))},meshArcs:a,merge:function(a){return g(a,f.apply(this,arguments))},mergeArcs:f,feature:function(a,b){return"GeometryCollection"===b.type?{type:"FeatureCollection",features:b.geometries.map(function(b){return k(a,b)})}:k(a,b)},neighbors:function(a){function b(a,b){a.forEach(function(a){0>a&&(a=~a);var c=e[a];c?c.push(b):e[a]=[b]})}function c(a,c){a.forEach(function(a){b(a,c)})}function d(a,b){if("GeometryCollection"===a.type)a.geometries.forEach(function(a){d(a,b)});else if(a.type in g)g[a.type](a.arcs,b)}var e={},f=a.map(function(){return[]}),g={LineString:b,MultiLineString:c,Polygon:c,MultiPolygon:function(a,b){a.forEach(function(a){c(a,b)})}};a.forEach(d);for(var h in e){a=e[h];for(var k=a.length,m=0;m<k;++m)for(var p=m+1;p<k;++p){var q=a[m],t=a[p],H;(H=f[q])[h=l(H,t)]!==t&&H.splice(h,0,t);(H=f[t])[h=l(H,q)]!==q&&H.splice(h,0,q)}}return f},presimplify:function(a,b){function c(a){g.remove(a);a[1][2]=b(a);g.push(a)}var d=h(a.transform),f=p(a.transform),g=e();b||(b=m);a.arcs.forEach(function(a){for(var e=[],h=0,k,l=0,m=a.length;l<m;++l)k=a[l],d(a[l]=[k[0],k[1],Infinity],l);l=1;for(m=a.length-1;l<m;++l)k=a.slice(l-1,l+2),k[1][2]=b(k),e.push(k),g.push(k);l=0;for(m=e.length;l<m;++l)k=e[l],k.previous=e[l-1],k.next=e[l+1];for(;k=g.pop();)e=k.previous,l=k.next,k[1][2]<h?k[1][2]=h:h=k[1][2],e&&(e.next=l,e[2]=k[2],c(e)),l&&(l.previous=e,l[0]=k[0],c(l));a.forEach(f)});return a}};"function"===typeof F&&F.amd?F("ThirdParty/topojson",q):"object"===typeof module&&module.exports?module.exports=q:this.topojson=q}();F("DataSources/GeoJsonDataSource","../Core/ArcType ../Core/Cartesian3 ../Core/Color ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/getFilenameFromUri ../Core/PinBuilder ../Core/PolygonHierarchy ../Core/Resource ../Core/RuntimeError ../Scene/HeightReference ../Scene/VerticalOrigin ../ThirdParty/topojson ../ThirdParty/when ./BillboardGraphics ./CallbackProperty ./ColorMaterialProperty ./ConstantPositionProperty ./ConstantProperty ./DataSource ./EntityCluster ./EntityCollection ./PolygonGraphics ./PolylineGraphics".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w){function G(b){return a.fromDegrees(b[0],b[1],b[2])}function E(a,b){var c="",d;for(d in a)if(a.hasOwnProperty(d)&&d!==b&&-1===qa.indexOf(d)){var e=a[d];l(e)&&(c="object"===typeof e?c+("\x3ctr\x3e\x3cth\x3e"+d+"\x3c/th\x3e\x3ctd\x3e"+E(e)+"\x3c/td\x3e\x3c/tr\x3e"):c+("\x3ctr\x3e\x3cth\x3e"+d+"\x3c/th\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3c/tr\x3e"))}0<c.length&&(c='\x3ctable class\x3d"cesium-infoBox-defaultTable"\x3e\x3ctbody\x3e'+c+"\x3c/tbody\x3e\x3c/table\x3e");return c}function L(a,b,c){var d;return function(e,f){l(d)||(d=a(b,c));return d}}function K(a,b){return new x(L(E,a,b),!0)}function P(a,b,c){var d=a.id;if(l(d)&&"Feature"===a.type){for(var e=2,f=d;l(b.getById(f));)f=d+"_"+e,e++;d=f}else d=k();b=b.getOrCreateEntity(d);a=a.properties;if(l(a)){b.properties=a;var g,d=a.title;if(l(d))b.name=d,g="title";else{var d=Number.MAX_VALUE,h;for(h in a)if(a.hasOwnProperty(h)&&a[h])if(e=h.toLowerCase(),1<d&&"title"===e){g=h;break}else 2<d&&"name"===e?(d=2,g=h):3<d&&/title/i.test(h)?(d=3,g=h):4<d&&/name/i.test(h)&&(d=4,g=h);l(g)&&(b.name=a[g])}h=a.description;null!==h&&(b.description=l(h)?new B(h):c(a,g))}return b}function N(a,b){for(var c=Array(a.length),d=0;d<a.length;d++)c[d]=b(a[d]);return c}function O(a,b,c,d,e){if(null===b.geometry)P(b,a._entityCollection,e.describe);else{if(!l(b.geometry))throw new r("feature.geometry is required.");c=b.geometry.type;var f=ta[c];if(!l(f))throw new r("Unknown geometry type: "+c);f(a,b,b.geometry,d,e)}}function Z(a,b,c,d,e){c=c.geometries;for(var f=0,g=c.length;f<g;f++){var h=c[f],k=h.type,m=ta[k];if(!l(m))throw new r("Unknown geometry type: "+k);m(a,b,h,d,e)}}function aa(a,b,d,e,h){var k=h.markerSymbol,m=h.markerColor,p=h.markerSize,q=b.properties;if(l(q)){var r=q["marker-color"];l(r)&&(m=f.fromCssColorString(r));p=g(oa[q["marker-size"]],p);q=q["marker-symbol"];l(q)&&(k=q)}var k=l(k)?1===k.length?a._pinBuilder.fromText(k.toUpperCase(),m,p):a._pinBuilder.fromMakiIconId(k,m,p):a._pinBuilder.fromColor(m,p),w=new z;w.verticalOrigin=new B(u.BOTTOM);2===e.length&&h.clampToGround&&(w.heightReference=c.CLAMP_TO_GROUND);b=P(b,a._entityCollection,h.describe);b.billboard=w;b.position=new v(d(e));d=A(k).then(function(a){w.image=new B(a)}).otherwise(function(){w.image=new B(a._pinBuilder.fromColor(m,p))});a._promises.push(d)}function U(a,b,c,d,e){aa(a,b,d,c.coordinates,e)}function W(a,b,c,d,e){c=c.coordinates;for(var f=0;f<c.length;f++)aa(a,b,d,c[f],e)}function M(a,c,d,e,g){var h=g.strokeMaterialProperty,k=g.strokeWidthProperty,m=c.properties;if(l(m)){var p=m["stroke-width"];l(p)&&(k=new B(p));var q,p=m.stroke;l(p)&&(q=f.fromCssColorString(p));m=m["stroke-opacity"];l(m)&&1!==m&&(l(q)||(q=h.color.clone()),q.alpha=m);l(q)&&(h=new D(q))}a=P(c,a._entityCollection,g.describe);c=new w;a.polyline=c;c.clampToGround=g.clampToGround;c.material=h;c.width=k;c.positions=new B(N(e,d));c.arcType=b.RHUMB}function R(a,b,c,d,e){M(a,b,d,c.coordinates,e)}function Y(a,b,c,d,e){c=c.coordinates;for(var f=0;f<c.length;f++)M(a,b,d,c[f],e)}function Q(a,c,d,e,g){if(0!==e.length&&0!==e[0].length){var h=g.strokeMaterialProperty.color,k=g.fillMaterialProperty,m=g.strokeWidthProperty,p=c.properties;if(l(p)){var r=p["stroke-width"];l(r)&&(m=new B(r));var w,r=p.stroke;l(r)&&(w=f.fromCssColorString(r));r=p["stroke-opacity"];l(r)&&1!==r&&(l(w)||(w=g.strokeMaterialProperty.color.clone()),w.alpha=r);l(w)&&(h=new B(w));var t;w=p.fill;l(w)&&(t=f.fromCssColorString(w),t.alpha=k.color.alpha);r=p["fill-opacity"];l(r)&&r!==k.color.alpha&&(l(t)||(t=k.color.clone()),t.alpha=r);l(t)&&(k=new D(t))}p=new J;p.outline=new B(!0);p.outlineColor=h;p.outlineWidth=m;p.material=k;p.arcType=b.RHUMB;h=[];k=1;for(m=e.length;k<m;k++)h.push(new q(N(e[k],d)));e=e[0];p.hierarchy=new B(new q(N(e,d),h));2<e[0].length?p.perPositionHeight=new B(!0):g.clampToGround||(p.height=0);P(c,a._entityCollection,g.describe).polygon=p}}function F(a,b,c,d,e){Q(a,b,d,c.coordinates,e)}function ca(a,b,c,d,e){c=c.coordinates;for(var f=0;f<c.length;f++)Q(a,b,d,c[f],e)}function T(a,b,c,d,e){for(var f in c.objects)c.objects.hasOwnProperty(f)&&(b=y.feature(c,c.objects[f]),(0,ua[b.type])(a,b,b,d,e))}function da(a){this._name=a;this._changed=new h;this._error=new h;this._isLoading=!1;this._loading=new h;this._entityCollection=new H(this);this._promises=[];this._pinBuilder=new d;this._entityCluster=new I}function V(a,b,c,d){var e;l(d)&&(e=p(d));l(e)&&a._name!==e&&(a._name=e,a._changed.raiseEvent(a));var f=ua[b.type];if(!l(f))throw new r("Unsupported GeoJSON object type: "+b.type);e=b.crs;var g=null!==e?G:null;if(l(e)){if(!l(e.properties))throw new r("crs.properties is undefined.");d=e.properties;if("name"===e.type){if(g=ba[d.name],!l(g))throw new r("Unknown crs name: "+d.name);}else if("link"===e.type){e=X[d.href];l(e)||(e=fa[d.type]);if(!l(e))throw new r("Unable to resolve crs link: "+JSON.stringify(d));g=e(d)}else if("EPSG"===e.type){if(g=ba["EPSG:"+d.code],!l(g))throw new r("Unknown crs EPSG code: "+d.code);}else throw new r("Unknown crs type: "+e.type);}return A(g,function(d){a._entityCollection.removeAll();null!==d&&f(a,b,b,d,c);return A.all(a._promises,function(){a._promises.length=0;C.setLoading(a,!1);return a})})}var ba={"urn:ogc:def:crs:OGC:1.3:CRS84":G,"EPSG:4326":G,"urn:ogc:def:crs:EPSG::4326":G},X={},fa={},ga=48,ka,na=f.ROYALBLUE,ia=f.YELLOW,la=2,ha=f.fromBytes(255,255,0,100),pa=!1,oa={small:24,medium:48,large:64},qa="title description marker-size marker-symbol marker-color stroke stroke-opacity stroke-width fill fill-opacity".split(" "),ua={Feature:O,FeatureCollection:function(a,b,c,d,e){b=b.features;c=0;for(var f=b.length;c<f;c++)O(a,b[c],void 0,d,e)},GeometryCollection:Z,LineString:R,MultiLineString:Y,MultiPoint:W,MultiPolygon:ca,Point:U,Polygon:F,Topology:T},ta={GeometryCollection:Z,LineString:R,MultiLineString:Y,MultiPoint:W,MultiPolygon:ca,Point:U,Polygon:F,Topology:T};da.load=function(a,b){return(new da).load(a,b)};m(da,{markerSize:{get:function(){return ga},set:function(a){ga=a}},markerSymbol:{get:function(){return ka},set:function(a){ka=a}},markerColor:{get:function(){return na},set:function(a){na=a}},stroke:{get:function(){return ia},set:function(a){ia=a}},strokeWidth:{get:function(){return la},set:function(a){la=a}},fill:{get:function(){return ha},set:function(a){ha=a}},clampToGround:{get:function(){return pa},set:function(a){pa=a}},crsNames:{get:function(){return ba}},crsLinkHrefs:{get:function(){return X}},crsLinkTypes:{get:function(){return fa}}});m(da.prototype,{name:{get:function(){return this._name},set:function(a){this._name!==a&&(this._name=a,this._changed.raiseEvent(this))}},clock:{value:void 0,writable:!1},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},show:{get:function(){return this._entityCollection.show},set:function(a){this._entityCollection.show=a}},clustering:{get:function(){return this._entityCluster},set:function(a){if(!l(a))throw new e("value must be defined.");this._entityCluster=a}}});da.prototype.load=function(a,b){if(!l(a))throw new e("data is required.");C.setLoading(this,!0);var c=a;b=g(b,g.EMPTY_OBJECT);var d=b.sourceUri;if("string"===typeof a||a instanceof t)a=t.createIfNeeded(a),c=a.fetchJson(),d=g(d,a.getUrlComponent());b={describe:g(b.describe,K),markerSize:g(b.markerSize,ga),markerSymbol:g(b.markerSymbol,ka),markerColor:g(b.markerColor,na),strokeWidthProperty:new B(g(b.strokeWidth,la)),strokeMaterialProperty:new D(g(b.stroke,ia)),fillMaterialProperty:new D(g(b.fill,ha)),clampToGround:g(b.clampToGround,pa)};var f=this;return A(c,function(a){return V(f,a,b,d)}).otherwise(function(a){C.setLoading(f,!1);f._error.raiseEvent(f,a);console.log(a);return A.reject(a)})};return da});F("DataSources/KmlCamera",[],function(){return function(b,a){this.position=b;this.headingPitchRoll=a}});(function(b,a){"function"===typeof F&&F.amd?F("ThirdParty/Autolinker",[],function(){return b.Autolinker=a()}):"object"===typeof exports?module.exports=a():b.Autolinker=a()})(this,function(){var b=function(a){b.Util.assign(this,a);a=this.hashtag;if(!1!==a&&"twitter"!==a&&"facebook"!==a)throw Error("invalid `hashtag` cfg - see docs");};b.prototype={constructor:b,urls:!0,email:!0,twitter:!0,phone:!0,hashtag:!1,newWindow:!0,stripPrefix:!0,truncate:void 0,className:"",htmlParser:void 0,matchParser:void 0,tagBuilder:void 0,link:function(a){a=this.getHtmlParser().parse(a);for(var b=0,k=[],g=0,l=a.length;g<l;g++){var m=a[g],e=m.getType(),h=m.getText();"element"===e?("a"===m.getTagName()&&(m.isClosing()?b=Math.max(b-1,0):b++),k.push(h)):"entity"===e||"comment"===e?k.push(h):0===b?(m=this.linkifyStr(h),k.push(m)):k.push(h)}return k.join("")},linkifyStr:function(a){return this.getMatchParser().replace(a,this.createMatchReturnVal,this)},createMatchReturnVal:function(a){var f;this.replaceFn&&(f=this.replaceFn.call(this,this,a));return"string"===typeof f?f:!1===f?a.getMatchedText():f instanceof b.HtmlTag?f.toAnchorString():this.getTagBuilder().build(a).toAnchorString()},getHtmlParser:function(){var a=this.htmlParser;a||(a=this.htmlParser=new b.htmlParser.HtmlParser);return a},getMatchParser:function(){var a=this.matchParser;a||(a=this.matchParser=new b.matchParser.MatchParser({urls:this.urls,email:this.email,twitter:this.twitter,phone:this.phone,hashtag:this.hashtag,stripPrefix:this.stripPrefix}));return a},getTagBuilder:function(){var a=this.tagBuilder;a||(a=this.tagBuilder=new b.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className}));return a}};b.link=function(a,f){return(new b(f)).link(a)};b.match={};b.htmlParser={};b.matchParser={};b.Util={abstractMethod:function(){throw"abstract";},trimRegex:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,assign:function(a,b){for(var f in b)b.hasOwnProperty(f)&&(a[f]=b[f]);return a},extend:function(a,f){var k=a.prototype,g=function(){};g.prototype=k;var l;l=f.hasOwnProperty("constructor")?f.constructor:function(){k.constructor.apply(this,arguments)};g=l.prototype=new g;g.constructor=l;g.superclass=k;delete f.constructor;b.Util.assign(g,f);return l},ellipsis:function(a,b,k){a.length>b&&(k=null==k?"..":k,a=a.substring(0,b-k.length)+k);return a},indexOf:function(a,b){if(Array.prototype.indexOf)return a.indexOf(b);for(var f=0,g=a.length;f<g;f++)if(a[f]===b)return f;return-1},splitAndCapture:function(a,b){if(!b.global)throw Error("`splitRegex` must have the 'g' flag set");for(var f=[],g=0,l;l=b.exec(a);)f.push(a.substring(g,l.index)),f.push(l[0]),g=l.index+l[0].length;f.push(a.substring(g));return f},trim:function(a){return a.replace(this.trimRegex,"")}};b.HtmlTag=b.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(a){b.Util.assign(this,a);this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(a){this.tagName=a;return this},getTagName:function(){return this.tagName||""},setAttr:function(a,b){this.getAttrs()[a]=b;return this},getAttr:function(a){return this.getAttrs()[a]},setAttrs:function(a){var f=this.getAttrs();b.Util.assign(f,a);return this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(a){return this.setAttr("class",a)},addClass:function(a){var f=this.getClass(),k=this.whitespaceRegex,g=b.Util.indexOf,f=f?f.split(k):[];for(a=a.split(k);k=a.shift();)-1===g(f,k)&&f.push(k);this.getAttrs()["class"]=f.join(" ");return this},removeClass:function(a){var f=this.getClass(),k=this.whitespaceRegex,g=b.Util.indexOf,f=f?f.split(k):[];a=a.split(k);for(var l;f.length&&(l=a.shift());)k=g(f,l),-1!==k&&f.splice(k,1);this.getAttrs()["class"]=f.join(" ");return this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(a){return-1!==(" "+this.getClass()+" ").indexOf(" "+a+" ")},setInnerHtml:function(a){this.innerHtml=a;return this},getInnerHtml:function(){return this.innerHtml||""},toAnchorString:function(){var a=this.getTagName(),b=this.buildAttrsStr();return["\x3c",a,b?" "+b:"","\x3e",this.getInnerHtml(),"\x3c/",a,"\x3e"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var a=this.getAttrs(),b=[],k;for(k in a)a.hasOwnProperty(k)&&b.push(k+'\x3d"'+a[k]+'"');return b.join(" ")}});b.AnchorTagBuilder=b.Util.extend(Object,{constructor:function(a){b.Util.assign(this,a)},build:function(a){return new b.HtmlTag({tagName:"a",attrs:this.createAttrs(a.getType(),a.getAnchorHref()),innerHtml:this.processAnchorText(a.getAnchorText())})},createAttrs:function(a,b){var f={href:b},g=this.createCssClass(a);g&&(f["class"]=g);this.newWindow&&(f.target="_blank");return f},createCssClass:function(a){var b=this.className;return b?b+" "+b+"-"+a:""},processAnchorText:function(a){return a=this.doTruncate(a)},doTruncate:function(a){return b.Util.ellipsis(a,this.truncate||Number.POSITIVE_INFINITY)}});b.htmlParser.HtmlParser=b.Util.extend(Object,{htmlRegex:function(){var a=/(?:"[^"]*?"|'[^']*?'|[^'"=<>`\s]+)/,b=/[^\s\0"'>\/=\x01-\x1F\x7F]+/.source+"(?:\\s*\x3d\\s*"+a.source+")?";return new RegExp(["(?:\x3c(!DOCTYPE)(?:\\s+(?:",b,"|",a.source+")",")*\x3e)|(?:\x3c(/)?(?:",/!--([\s\S]+?)--/.source,"|(?:","("+/[0-9a-zA-Z][0-9a-zA-Z:]*/.source+")","(?:\\s+",b,")*\\s*/?))\x3e)"].join(""),"gi")}(),htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;|&quot;|&#34;|&#39;)/gi,parse:function(a){for(var b=this.htmlRegex,k,g=0,l=[];null!==(k=b.exec(a));){var m=k[0],e=k[3],h=k[1]||k[4],p=!!k[2];if(g=a.substring(g,k.index))g=this.parseTextAndEntityNodes(g),l.push.apply(l,g);e?l.push(this.createCommentNode(m,e)):l.push(this.createElementNode(m,h,p));g=k.index+m.length}g<a.length&&(a=a.substring(g))&&(g=this.parseTextAndEntityNodes(a),l.push.apply(l,g));return l},parseTextAndEntityNodes:function(a){var f=[];a=b.Util.splitAndCapture(a,this.htmlCharacterEntitiesRegex);for(var k=0,g=a.length;k<g;k+=2){var l=a[k],m=a[k+1];l&&f.push(this.createTextNode(l));m&&f.push(this.createEntityNode(m))}return f},createCommentNode:function(a,f){return new b.htmlParser.CommentNode({text:a,comment:b.Util.trim(f)})},createElementNode:function(a,f,k){return new b.htmlParser.ElementNode({text:a,tagName:f.toLowerCase(),closing:k})},createEntityNode:function(a){return new b.htmlParser.EntityNode({text:a})},createTextNode:function(a){return new b.htmlParser.TextNode({text:a})}});b.htmlParser.HtmlNode=b.Util.extend(Object,{text:"",constructor:function(a){b.Util.assign(this,a)},getType:b.Util.abstractMethod,getText:function(){return this.text}});b.htmlParser.CommentNode=b.Util.extend(b.htmlParser.HtmlNode,{comment:"",getType:function(){return"comment"},getComment:function(){return this.comment}});b.htmlParser.ElementNode=b.Util.extend(b.htmlParser.HtmlNode,{tagName:"",closing:!1,getType:function(){return"element"},getTagName:function(){return this.tagName},isClosing:function(){return this.closing}});b.htmlParser.EntityNode=b.Util.extend(b.htmlParser.HtmlNode,{getType:function(){return"entity"}});b.htmlParser.TextNode=b.Util.extend(b.htmlParser.HtmlNode,{getType:function(){return"text"}});b.matchParser.MatchParser=b.Util.extend(Object,{urls:!0,email:!0,twitter:!0,phone:!0,hashtag:!1,stripPrefix:!0,matcherRegex:function(){var a=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,b=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/;return new RegExp(["(",/(^|[^\w])@(\w{1,15})/.source,")|(",/(?:[\-;:&=\+\$,\w\.]+@)/.source,a.source,b.source,")|((?:(",/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/.source,a.source,")|(?:(.?//)?",/(?:www\.)/.source,a.source,")|(?:(.?//)?",a.source,b.source,"))","(?:"+/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/.source+")?",")|(",/(?:\+?\d{1,3}[-\s.])?\(?\d{3}\)?[-\s.]?\d{3}[-\s.]\d{4}/.source,")|(",/(^|[^\w])#(\w{1,15})/.source,")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,constructor:function(a){b.Util.assign(this,a);this.matchValidator=new b.MatchValidator},replace:function(a,b,k){var f=this;return a.replace(this.matcherRegex,function(a,g,e,h,p,d,q,t,r,c,u,y,A){return(g=f.processCandidateMatch(a,g,e,h,p,d,q,t,r,c,u,y,A))?(a=b.call(k,g.match),g.prefixStr+a+g.suffixStr):a})},processCandidateMatch:function(a,f,k,g,l,m,e,h,p,d,q,t,r){var c=h||p;p=h="";if(m&&!this.urls||l&&!this.email||d&&!this.phone||f&&!this.twitter||q&&!this.hashtag||!this.matchValidator.isValidMatch(m,e,c))return null;this.matchHasUnbalancedClosingParen(a)&&(a=a.substr(0,a.length-1),p=")");l?a=new b.match.Email({matchedText:a,email:l}):f?(k&&(h=k,a=a.slice(1)),a=new b.match.Twitter({matchedText:a,twitterHandle:g})):d?(e=a.replace(/\D/g,""),a=new b.match.Phone({matchedText:a,number:e})):q?(t&&(h=t,a=a.slice(1)),a=new b.match.Hashtag({matchedText:a,serviceName:this.hashtag,hashtag:r})):(c&&(f=c.match(this.charBeforeProtocolRelMatchRegex)[1]||"")&&(h=f,a=a.slice(1)),a=new b.match.Url({matchedText:a,url:a,protocolUrlMatch:!!e,protocolRelativeMatch:!!c,stripPrefix:this.stripPrefix}));return{prefixStr:h,suffixStr:p,match:a}},matchHasUnbalancedClosingParen:function(a){if(")"===a.charAt(a.length-1)){var b=a.match(/\(/g);a=a.match(/\)/g);if((b&&b.length||0)<(a&&a.length||0))return!0}return!1}});b.MatchValidator=b.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(a,b,k){return b&&!this.isValidUriScheme(b)||this.urlMatchDoesNotHaveProtocolOrDot(a,b)||this.urlMatchDoesNotHaveAtLeastOneWordChar(a,b)||this.isInvalidProtocolRelativeMatch(k)?!1:!0},isValidUriScheme:function(a){a=a.match(this.uriSchemeRegex)[0].toLowerCase();return"javascript:"!==a&&"vbscript:"!==a},urlMatchDoesNotHaveProtocolOrDot:function(a,b){return!!a&&(!b||!this.hasFullProtocolRegex.test(b))&&-1===a.indexOf(".")},urlMatchDoesNotHaveAtLeastOneWordChar:function(a,b){return a&&b?!this.hasWordCharAfterProtocolRegex.test(a):!1},isInvalidProtocolRelativeMatch:function(a){return!!a&&this.invalidProtocolRelMatchRegex.test(a)}});b.match.Match=b.Util.extend(Object,{constructor:function(a){b.Util.assign(this,a)},getType:b.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:b.Util.abstractMethod,getAnchorText:b.Util.abstractMethod});b.match.Email=b.Util.extend(b.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}});b.match.Hashtag=b.Util.extend(b.match.Match,{getType:function(){return"hashtag"},getHashtag:function(){return this.hashtag},getAnchorHref:function(){var a=this.serviceName,b=this.hashtag;switch(a){case "twitter":return"https://twitter.com/hashtag/"+b;case "facebook":return"https://www.facebook.com/hashtag/"+b;default:throw Error("Unknown service name to point hashtag to: ",a);}},getAnchorText:function(){return"#"+this.hashtag}});b.match.Phone=b.Util.extend(b.match.Match,{getType:function(){return"phone"},getNumber:function(){return this.number},getAnchorHref:function(){return"tel:"+this.number},getAnchorText:function(){return this.matchedText}});b.match.Twitter=b.Util.extend(b.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}});b.match.Url=b.Util.extend(b.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var a=this.url;this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(a=this.url="http://"+a,this.protocolPrepended=!0);return a},getAnchorHref:function(){return this.getUrl().replace(/&amp;/g,"\x26")},getAnchorText:function(){var a=this.getUrl();this.protocolRelativeMatch&&(a=this.stripProtocolRelativePrefix(a));this.stripPrefix&&(a=this.stripUrlPrefix(a));return a=this.removeTrailingSlash(a)},stripUrlPrefix:function(a){return a.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(a){return a.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(a){"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1));return a}});return b});F("DataSources/KmlLookAt",[],function(){return function(b,a){this.position=b;this.headingPitchRange=a}});F("DataSources/KmlTour",["../Core/defined","../Core/Event"],function(b,a){function f(b,e){this.id=e;this.name=b;this.playlistIndex=0;this.playlist=[];this.tourStart=new a;this.tourEnd=new a;this.entryStart=new a;this.entryEnd=new a;this._activeEntries=[]}function k(a){for(var b=a.pop();void 0!==b;b=a.pop())b.stop()}function g(a,e,f){var g=this.playlist[this.playlistIndex];if(g){var d=l.bind(this,a,e,f);this._activeEntries.push(g);this.entryStart.raiseEvent(g);if(g.blocking)g.play(d,a.scene.camera,e);else{var h=this;g.play(function(){h.entryEnd.raiseEvent(g);var a=h._activeEntries.indexOf(g);0<=a&&h._activeEntries.splice(a,1)});d(a,e,f)}}else b(f)&&f(!1)}function l(a,b,f,k){var d=this.playlist[this.playlistIndex];this.entryEnd.raiseEvent(d,k);k?f(k):(k=this._activeEntries.indexOf(d),0<=k&&this._activeEntries.splice(k,1),this.playlistIndex++,g.call(this,a,b,f))}f.prototype.addPlaylistEntry=function(a){this.playlist.push(a)};f.prototype.play=function(a,b){this.tourStart.raiseEvent();var e=this;g.call(this,a,b,function(a){e.playlistIndex=0;a||k(e._activeEntries);e.tourEnd.raiseEvent(a)})};f.prototype.stop=function(){k(this._activeEntries)};return f});F("DataSources/KmlTourFlyTo",["../Core/BoundingSphere","../Core/combine","../Core/defined","../Core/EasingFunction"],function(b,a,f,k){function g(a,b,e){this.type="KmlTourFlyTo";this.blocking=!0;this.activeCallback=this.activeCamera=null;this.duration=a;this.view=e;this.flyToMode=b}g.prototype.play=function(a,g,e){this.activeCamera=g;if(f(a)&&null!==a){var h=this;this.activeCallback=function(b){delete h.activeCallback;delete h.activeCamera;a(f(b)?!1:b)}}e=this.getCameraOptions(e);if(this.view.headingPitchRoll)g.flyTo(e);else if(this.view.headingPitchRange){var k=new b(this.view.position);g.flyToBoundingSphere(k,e)}};g.prototype.stop=function(){f(this.activeCamera)&&this.activeCamera.cancelFlight();f(this.activeCallback)&&this.activeCallback(!0)};g.prototype.getCameraOptions=function(b){var g={duration:this.duration};f(this.activeCallback)&&(g.complete=this.activeCallback);"smooth"===this.flyToMode&&(g.easingFunction=k.LINEAR_NONE);this.view.headingPitchRoll?(g.destination=this.view.position,g.orientation=this.view.headingPitchRoll):this.view.headingPitchRange&&(g.offset=this.view.headingPitchRange);f(b)&&(g=a(g,b));return g};return g});F("DataSources/KmlTourWait",["../Core/defined"],function(b){function a(a){this.type="KmlTourWait";this.blocking=!0;this.duration=a;this.timeout=null}a.prototype.play=function(a){var b=this;this.activeCallback=a;this.timeout=setTimeout(function(){delete b.activeCallback;a(!1)},1E3*this.duration)};a.prototype.stop=function(){clearTimeout(this.timeout);b(this.activeCallback)&&this.activeCallback(!0)};return a});F("DataSources/KmlDataSource","../Core/ArcType ../Core/AssociativeArray ../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/ClockRange ../Core/ClockStep ../Core/Color ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Ellipsoid ../Core/Event ../Core/getExtensionFromUri ../Core/getFilenameFromUri ../Core/HeadingPitchRange ../Core/HeadingPitchRoll ../Core/Iso8601 ../Core/JulianDate ../Core/Math ../Core/NearFarScalar ../Core/objectToQuery ../Core/oneTimeWarning ../Core/PinBuilder ../Core/PolygonHierarchy ../Core/queryToObject ../Core/Rectangle ../Core/Resource ../Core/RuntimeError ../Core/TimeInterval ../Core/TimeIntervalCollection ../Scene/HeightReference ../Scene/HorizontalOrigin ../Scene/LabelStyle ../Scene/SceneMode ../ThirdParty/Autolinker ../ThirdParty/Uri ../ThirdParty/when ../ThirdParty/zip ./BillboardGraphics ./CompositePositionProperty ./DataSource ./DataSourceClock ./Entity ./EntityCluster ./EntityCollection ./KmlCamera ./KmlLookAt ./KmlTour ./KmlTourFlyTo ./KmlTourWait ./LabelGraphics ./PathGraphics ./PolygonGraphics ./PolylineGraphics ./PositionPropertyArray ./RectangleGraphics ./ReferenceProperty ./SampledPositionProperty ./ScaledPositionProperty ./TimeIntervalCollectionProperty ./WallGraphics".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,F,ca,T,da,V,ba,X,fa,ga,ka,na,ia,la,ha,pa,oa,qa,ua,ta,wa,za,Da){function S(a){a=a.slice(0,Math.min(4,a.size));var b=R.defer(),c=new FileReader;c.addEventListener("load",function(){b.resolve(1347093252===(new DataView(c.result)).getUint32(0,!1))});c.addEventListener("error",function(){b.reject(c.error)});c.readAsArrayBuffer(a);return b.promise}function ra(a){var b=R.defer(),c=new FileReader;c.addEventListener("load",function(){b.resolve(c.result)});c.addEventListener("error",function(){b.reject(c.error)});c.readAsText(a);return b.promise}function Ea(a){var b={xsi:"http://www.w3.org/2001/XMLSchema-instance"},c,d,e,f,g;for(g in b)b.hasOwnProperty(g)&&(e=RegExp("[\x3c ]"+g+":"),f="xmlns:"+g+"\x3d",e.test(a)&&-1===a.indexOf(f)&&(q(c)||(c=a.substr(0,a.indexOf("\x3ckml")+4),d=a.substr(c.length)),c+=" "+f+'"'+b[g]+'"'));q(c)&&(a=c+d);return a}function Ga(a){for(var b=a.indexOf("xmlns:"),c=a.indexOf("\x3e",b),d,e;-1!==b&&b<c;)d=a.slice(b,a.indexOf('"',b)),e=b,b=a.indexOf(d,b+1),-1!==b?(d=a.indexOf('"',a.indexOf('"',b)+1),a=a.slice(0,b-1)+a.slice(d+1,a.length),b=a.indexOf("xmlns:",e-1)):b=a.indexOf("xmlns:",e+1);return a}function Ca(a,b,c){a.getData(new Y.TextWriter,function(a){a=Ea(a);a=Ga(a);b.kml=qb.parseFromString(a,"application/xml");c.resolve()})}function ya(a,b,c){var e=d(Ab.detectFromFilename(a.filename),"application/octet-stream");a.getData(new Y.Data64URIWriter(e),function(d){b[a.filename]=d;c.resolve()})}function Aa(a,b,c,d){var e=d.keys,f=new M(".");a=a.querySelectorAll(b);for(var g=0;g<a.length;g++){var h=a[g],k=h.getAttribute(c),k=(new M(k)).resolve(f).toString(),k=e.indexOf(k);-1!==k&&(k=e[k],h.setAttribute(c,d[k]),"a"===b&&null===h.getAttribute("download")&&h.setAttribute("download",k))}}function Ua(a,b,c,d){a=a.querySelectorAll(b);for(b=0;b<a.length;b++){var e=a[b],f=e.getAttribute(c),f=Oa(f,d);e.setAttribute(c,f.url)}}function sa(a,b,c){a=Ia(a,"id");a=q(a)&&0!==a.length?a:p();q(c)&&(a=c+a);var d=b.getById(a);q(d)&&(a=p(),q(c)&&(a=c+a));d=b.add(new da({id:a}));q(d.kml)||(d.addProperty("kml"),d.kml=new ab);return d}function Va(a,b){return"absolute"===a||"relativeToGround"===a||"relativeToSeaFloor"===b}function xa(a,b){if(!q(a))return g.fromDegrees(0,0,0,b);var c=a.match(/[^\s,\n]+/g);if(!q(c))return g.fromDegrees(0,0,0,b);var d=parseFloat(c[0]),e=parseFloat(c[1]),c=parseFloat(c[2]),d=isNaN(d)?0:d,e=isNaN(e)?0:e,c=isNaN(c)?0:c;return g.fromDegrees(d,e,c,b)}function Ha(a,b){if(q(a)){var c=a.textContent.match(/[^\s\n]+/g);if(q(c)){for(var d=c.length,e=Array(d),f=0,g=0;g<d;g++)e[f++]=xa(c[g],b);return e}}}function Ma(a,b){if(q(a)){var c=a.getAttribute(b);if(null!==c)return c=parseFloat(c),isNaN(c)?void 0:c}}function Ia(a,b){if(q(a)){var c=a.getAttribute(b);return null!==c?c:void 0}}function La(a,b,c){if(q(a)){a=a.childNodes;for(var d=a.length,e=0;e<d;e++){var f=a[e];if(f.localName===b&&-1!==c.indexOf(f.namespaceURI))return f}}}function Fa(a,b,c){if(q(a)){var d=[];a=a.getElementsByTagNameNS("*",b);for(var e=a.length,f=0;f<e;f++){var g=a[f];g.localName===b&&-1!==c.indexOf(g.namespaceURI)&&d.push(g)}return d}}function Ja(a,b,c){if(!q(a))return[];var d=[];a=a.childNodes;for(var e=a.length,f=0;f<e;f++){var g=a[f];g.localName===b&&-1!==c.indexOf(g.namespaceURI)&&d.push(g)}return d}function Qa(a,b,c){a=La(a,b,c);if(q(a))return a=parseFloat(a.textContent),isNaN(a)?void 0:a}function va(a,b,c){a=La(a,b,c);if(q(a))return a.textContent.trim()}function Sa(a,b,c){a=La(a,b,c);if(q(a))return a=a.textContent.trim(),"1"===a||/^true$/i.test(a)}function Oa(a,b,c){if(q(a)){var d;if(q(c)){var e=c[a];if(q(e))d=new L({url:e});else{var e=new M(b.getUrlComponent()),f=new M(a),e=c[f.resolve(e)];q(e)&&(d=new L({url:e}))}}q(d)||(d=b.getDerivedResource({url:a}));return d}}function Ta(a,b){if(q(a)&&!/^\s*$/gm.test(a)){"#"===a[0]&&(a=a.substring(1));var c=parseInt(a.substring(0,2),16)/255,d=parseInt(a.substring(2,4),16)/255,e=parseInt(a.substring(4,6),16)/255,f=parseInt(a.substring(6,8),16)/255;if(!b)return new h(f,e,d,c);0<f?(Ib.maximumRed=f,Ib.red=void 0):(Ib.maximumRed=void 0,Ib.red=0);0<e?(Ib.maximumGreen=e,Ib.green=void 0):(Ib.maximumGreen=void 0,Ib.green=0);0<d?(Ib.maximumBlue=d,Ib.blue=void 0):(Ib.maximumBlue=void 0,Ib.blue=0);Ib.alpha=c;return h.fromRandom(Ib)}}function Ka(a,b,c){b=va(a,b,c);if(q(b))return Ta(b,"random"===va(a,"colorMode",c))}function Wa(a){a=La(a,"TimeStamp",ma.kmlgx);var b=va(a,"when",ma.kmlgx);if(q(a)&&q(b)&&0!==b.length)return a=v.fromIso8601(b),b=new N,b.addInterval(new P({start:a,stop:D.MAXIMUM_VALUE})),b}function Ra(a){var b=La(a,"TimeSpan",ma.kmlgx);if(q(b)){var c;a=La(b,"begin",ma.kmlgx);a=q(a)?v.fromIso8601(a.textContent):void 0;b=La(b,"end",ma.kmlgx);b=q(b)?v.fromIso8601(b.textContent):void 0;q(a)&&q(b)?(v.lessThan(b,a)&&(c=a,a=b,b=c),c=new N,c.addInterval(new P({start:a,stop:b}))):q(a)?(c=new N,c.addInterval(new P({start:a,stop:D.MAXIMUM_VALUE}))):q(b)&&(c=new N,c.addInterval(new P({start:D.MINIMUM_VALUE,stop:b})));return c}}function Nb(){var a=new Q;a.width=32;a.height=32;a.scaleByDistance=new C(2414016,1,16093E3,.1);a.pixelOffsetScaleByDistance=new C(2414016,1,16093E3,.1);return a}function hb(){var a=new ha;a.outline=!0;a.outlineColor=h.WHITE;return a}function Hb(){var a=new ia;a.translucencyByDistance=new C(3E6,1,5E6,0);a.pixelOffset=new k(17,0);a.horizontalOrigin=Z.LEFT;a.font="16px sans-serif";a.style=aa.FILL_AND_OUTLINE;return a}function db(a,b,c,e,f){var g=va(a,"href",ma.kml);if(q(g)&&0!==g.length){if(0===g.indexOf("root://icons/palette-"))var g=g.charAt(21),h=d(Qa(a,"x",ma.gx),0),k=d(Qa(a,"y",ma.gx),0),h=Math.min(h/32,7),k=7-Math.min(k/32,7),g="https://maps.google.com/mapfiles/kml/pal"+g+"/icon"+(8*k+h)+".png";c=Oa(g,c,e);f&&(f=va(a,"refreshMode",ma.kml),e=va(a,"viewRefreshMode",ma.kml),"onInterval"===f||"onExpire"===f?H("kml-refreshMode-"+f,"KML - Unsupported Icon refreshMode: "+f):"onStop"!==e&&"onRegion"!==e||H("kml-refreshMode-"+e,"KML - Unsupported Icon viewRefreshMode: "+e),f=d(va(a,"viewBoundScale",ma.kml),1),e="onStop"===e?"BBOX\x3d[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",e=d(va(a,"viewFormat",ma.kml),e),a=va(a,"httpQuery",ma.kml),q(e)&&c.setQueryParameters(G(Lc(e))),q(a)&&c.setQueryParameters(G(Lc(a))),Oc(c,b._camera,b._canvas,f,b._lastCameraView.bbox,b._ellipsoid));return c}}function tb(a,b,c,e,l){for(var m=0,p=b.childNodes.length;m<p;m++){var r=b.childNodes.item(m);if("IconStyle"===r.localName){var w=a,t=r,u=c,v=e,y=l,r=Qa(t,"scale",ma.kml),z=Qa(t,"heading",ma.kml),E=Ka(t,"color",ma.kml),A=La(t,"Icon",ma.kml),w=db(A,w,v,y,!1);q(A)&&!q(w)&&(w=!1);var v=Qa(A,"x",ma.gx),y=Qa(A,"y",ma.gx),C=Qa(A,"w",ma.gx),G=Qa(A,"h",ma.gx),D=La(t,"hotSpot",ma.kml),t=Ma(D,"x"),A=Ma(D,"y"),x=Ia(D,"xunits"),D=Ia(D,"yunits"),L=u.billboard;q(L)||(L=Nb(),u.billboard=L);L.image=w;L.scale=r;L.color=E;if(q(v)||q(y)||q(C)||q(G))L.imageSubRegion=new f(v,y,C,G);q(z)&&0!==z&&(L.rotation=B.toRadians(-z),L.alignedAxis=g.UNIT_Z);r=d(r,1);z=u=void 0;q(t)&&("pixels"===x?u=-t*r:"insetPixels"===x?u=(t-32)*r:"fraction"===x&&(u=32*-t*r),u+=16*r);q(A)&&("pixels"===D?z=A*r:"insetPixels"===D?z=(-A+32)*r:"fraction"===D&&(z=32*A*r),z-=16*r);if(q(u)||q(z))L.pixelOffset=new k(u,z)}else"LabelStyle"===r.localName?(u=c.label,q(u)||(u=Hb(),c.label=u),u.scale=d(Qa(r,"scale",ma.kml),u.scale),u.fillColor=d(Ka(r,"color",ma.kml),u.fillColor),u.text=c.name):"LineStyle"===r.localName?(u=c.polyline,q(u)||(u=new pa,c.polyline=u),u.width=Qa(r,"width",ma.kml),u.material=Ka(r,"color",ma.kml),q(Ka(r,"outerColor",ma.gx))&&H("kml-gx:outerColor","KML - gx:outerColor is not supported in a LineStyle"),q(Qa(r,"outerWidth",ma.gx))&&H("kml-gx:outerWidth","KML - gx:outerWidth is not supported in a LineStyle"),q(Qa(r,"physicalWidth",ma.gx))&&H("kml-gx:physicalWidth","KML - gx:physicalWidth is not supported in a LineStyle"),q(Sa(r,"labelVisibility",ma.gx))&&H("kml-gx:labelVisibility","KML - gx:labelVisibility is not supported in a LineStyle")):"PolyStyle"===r.localName?(u=c.polygon,q(u)||(u=hb(),c.polygon=u),u.material=d(Ka(r,"color",ma.kml),u.material),u.fill=d(Sa(r,"fill",ma.kml),u.fill),u.outline=d(Sa(r,"outline",ma.kml),u.outline)):"BalloonStyle"===r.localName?(u=d(Ta(va(r,"bgColor",ma.kml)),h.WHITE),z=d(Ta(va(r,"textColor",ma.kml)),h.BLACK),r=va(r,"text",ma.kml),c.addProperty("balloonStyle"),c.balloonStyle={bgColor:u,textColor:z,text:r}):"ListStyle"===r.localName&&(r=va(r,"listItemType",ma.kml),"radioFolder"!==r&&"checkOffOnly"!==r||H("kml-listStyle-"+r,"KML - Unsupported ListStyle with listItemType: "+r))}}function Jc(a,b,c,d,e){var f=new da,g,h=-1,k=b.childNodes;g=k.length;for(var l=0;l<g;l++){var m=k[l];if("Style"===m.localName||"StyleMap"===m.localName)h=l}if(-1!==h)if(h=k[h],"Style"===h.localName)tb(a,h,f,d,e);else for(h=Ja(h,"Pair",ma.kml),k=0;k<h.length;k++)g=h[k],l=va(g,"key",ma.kml),"normal"===l?(l=va(g,"styleUrl",ma.kml),q(l)?(g=c.getById(l),q(g)||(g=c.getById("#"+l)),q(g)&&f.merge(g)):(g=La(g,"Style",ma.kml),tb(a,g,f,d,e))):H("kml-styleMap-"+l,"KML - Unsupported StyleMap key: "+l);b=va(b,"styleUrl",ma.kml);q(b)&&(a=b,"#"!==b[0]&&-1!==b.indexOf("#")&&(a=b.split("#"),a=d.getDerivedResource({url:a[0]}).getUrlComponent()+"#"+a[1]),g=c.getById(a),q(g)||(g=c.getById("#"+a)),q(g)&&f.merge(g));return f}function cc(a,b,c){return b.fetchXML().then(function(d){return sc(a,d,c,b,!0)})}function sc(a,b,c,d,e,f){var g,h,k,l,m=Fa(b,"Style",ma.kml);if(q(m)){var p=m.length;for(g=0;g<p;g++)l=m[g],h=Ia(l,"id"),q(h)&&(h="#"+h,e&&q(d)&&(h=d.getUrlComponent()+h),q(c.getById(h))||(k=new da({id:h}),c.add(k),tb(a,l,k,d,f)))}m=Fa(b,"StyleMap",ma.kml);if(q(m))for(p=m.length,g=0;g<p;g++)if(k=m[g],h=Ia(k,"id"),q(h))for(var r=Ja(k,"Pair",ma.kml),w=0;w<r.length;w++)if(l=r[w],k=va(l,"key",ma.kml),"normal"===k){if(h="#"+h,e&&q(d)&&(h=d.getUrlComponent()+h),!q(c.getById(h))){k=c.getOrCreateEntity(h);var t=va(l,"styleUrl",ma.kml);q(t)?("#"!==t[0]&&(t="#"+t),e&&q(d)&&(t=d.getUrlComponent()+t),l=c.getById(t),q(l)&&k.merge(l)):(l=La(l,"Style",ma.kml),tb(a,l,k,d,f))}}else H("kml-styleMap-"+k,"KML - Unsupported StyleMap key: "+k);e=[];b=b.getElementsByTagName("styleUrl");f=b.length;for(g=0;g<f;g++)h=b[g].textContent,"#"!==h[0]&&(h=h.split("#"),2===h.length&&(h=d.getDerivedResource({url:h[0]}),e.push(cc(a,h,c))));return e}function Za(a,b,c){a=new ua(a,b.id,["position"]);var d=new wa(b.position);b.polyline=q(c.polyline)?c.polyline.clone():new pa;b.polyline.positions=new oa([a,d])}function tc(a,b){if(!q(a)&&!q(b)||"clampToGround"===a)return O.CLAMP_TO_GROUND;if("relativeToGround"===a)return O.RELATIVE_TO_GROUND;if("absolute"===a)return O.NONE;if("clampToSeaFloor"===b)return H("kml-gx:altitudeMode-clampToSeaFloor","KML - \x3cgx:altitudeMode\x3e:clampToSeaFloor is currently not supported, using \x3ckml:altitudeMode\x3e:clampToGround."),O.CLAMP_TO_GROUND;if("relativeToSeaFloor"===b)return H("kml-gx:altitudeMode-relativeToSeaFloor","KML - \x3cgx:altitudeMode\x3e:relativeToSeaFloor is currently not supported, using \x3ckml:altitudeMode\x3e:relativeToGround."),O.RELATIVE_TO_GROUND;q(a)?H("kml-altitudeMode-unknown","KML - Unknown \x3ckml:altitudeMode\x3e:"+a+", using \x3ckml:altitudeMode\x3e:CLAMP_TO_GROUND."):H("kml-gx:altitudeMode-unknown","KML - Unknown \x3cgx:altitudeMode\x3e:"+b+", using \x3ckml:altitudeMode\x3e:CLAMP_TO_GROUND.");return O.CLAMP_TO_GROUND}function Pa(a,b,c){if("relativeToSeaFloor"===c||"absolute"===b||"relativeToGround"===b)return a;(q(b)&&"clampToGround"!==b||q(c)&&"clampToSeaFloor"!==c)&&H("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+d(b,c));return new wa(a)}function Xb(a,b,c,d){var e=b.label;q(e)||(e=q(c.label)?c.label.clone():Hb(),b.label=e);e.text=b.name;var f=b.billboard;q(f)||(f=q(c.billboard)?c.billboard.clone():Nb(),b.billboard=f);q(f.image)?f.image.getValue()||(f.image=void 0):f.image=a._pinBuilder.fromColor(h.YELLOW,64);q(f.scale)&&(b=f.scale.getValue(),0!==b?e.pixelOffset=new k(16*b+1,0):(e.pixelOffset=void 0,e.horizontalOrigin=void 0));q(d)&&a._clampToGround&&(f.heightReference=d,e.heightReference=d)}function dc(a,b){var c=a.path;q(c)||(c=new la,c.leadTime=0,a.path=c);var d=b.polyline;q(d)&&(c.material=d.material,c.width=d.width)}function ja(a,c,e,f,g){c=La(e,"coordinates",ma.kml);var k=va(e,"altitudeMode",ma.kml),l=va(e,"altitudeMode",ma.gx),m=Sa(e,"extrude",ma.kml),p=Sa(e,"tessellate",ma.kml),r=Va(k,l),w=Qa(e,"drawOrder",ma.gx),t=a._ellipsoid;e=Ha(c,t);c=g.polyline;if(r&&m)p=new Da,f.wall=p,p.positions=e,r=g.polygon,q(r)&&(p.fill=r.fill,p.material=r.material),p.outline=!0,q(c)?(p.outlineColor=q(c.material)?c.material.color:h.WHITE,p.outlineWidth=c.width):q(r)&&(p.outlineColor=q(r.material)?r.material.color:h.WHITE);else if(a._clampToGround&&!r&&p)p=new pa,p.clampToGround=!0,f.polyline=p,p.positions=e,q(c)?(p.material=q(c.material)?c.material.color.getValue(D.MINIMUM_VALUE):h.WHITE,p.width=d(c.width,1)):(p.material=h.WHITE,p.width=1),p.zIndex=w;else{q(w)&&H("kml-gx:drawOrder","KML - gx:drawOrder is not supported in LineStrings when clampToGround is false");c=q(c)?c.clone():new pa;f=f.polyline=c;if(q(e)){if("relativeToSeaFloor"!==l&&"absolute"!==k&&"relativeToGround"!==k)for((q(k)&&"clampToGround"!==k||q(l)&&"clampToSeaFloor"!==l)&&H("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+d(k,l)),g=e.length,a=0;a<g;a++)k=e[a],t.scaleToGeodeticSurface(k,k)}else e=void 0;f.positions=e;if(!p||r)c.arcType=b.NONE}return!0}function uc(a,b,c,d,e,f,g,h,k){var l=a[0],m=a[a.length-1],p=new ta;p.addSamples(a,b);c.intervals.addInterval(new P({start:l,stop:m,isStartIncluded:k,isStopIncluded:k,data:Pa(p,g,h)}));d.addInterval(new P({start:l,stop:m,isStartIncluded:k,isStopIncluded:k}));e.intervals.addInterval(new P({start:l,stop:m,isStartIncluded:k,isStopIncluded:k,data:f}))}function ec(a,b){var c=La(a,"ExtendedData",ma.kml);if(q(c)){q(La(c,"SchemaData",ma.kml))&&H("kml-schemaData","KML - SchemaData is unsupported");q(Ia(c,"xmlns:prefix"))&&H("kml-extendedData","KML - ExtendedData with xmlns:prefix is unsupported");var d={},c=Ja(c,"Data",ma.kml);if(q(c))for(var e=c.length,f=0;f<e;f++){var g=c[f],h=Ia(g,"name");q(h)&&(d[h]={displayName:va(g,"displayName",ma.kml),value:va(g,"value",ma.kml)})}b.kml.extendedData=d}}function ad(a,b,c,e,f){var g,k,l;g=b.kml;var m=g.extendedData,p=va(a,"description",ma.kml);k=d(b.balloonStyle,c.balloonStyle);a=h.WHITE;c=h.BLACK;var r=p;q(k)&&(a=d(k.bgColor,h.WHITE),c=d(k.textColor,h.BLACK),r=d(k.text,p));if(q(r)){if(r=r.replace("$[name]",d(b.name,"")),r=r.replace("$[description]",d(p,"")),r=r.replace("$[address]",d(g.address,"")),r=r.replace("$[Snippet]",d(g.snippet,"")),r=r.replace("$[id]",b.id),r=r.replace("$[geDirections]",""),q(m)&&(k=r.match(/\$\[.+?\]/g),null!==k))for(g=0;g<k.length;g++){l=k[g];var p=l.substr(2,l.length-3),w=/\/displayName$/.test(p),p=p.replace(/\/displayName$/,""),p=m[p];q(p)&&(p=w?p.displayName:p.value);q(p)&&(r=r.replace(l,d(p,"")))}}else if(q(m)&&(l=Object.keys(m),0<l.length)){r='\x3ctable class\x3d"cesium-infoBox-defaultTable cesium-infoBox-defaultTable-lighter"\x3e\x3ctbody\x3e';for(g=0;g<l.length;g++)k=l[g],p=m[k],r+="\x3ctr\x3e\x3cth\x3e"+d(p.displayName,k)+"\x3c/th\x3e\x3ctd\x3e"+d(p.value,"")+"\x3c/td\x3e\x3c/tr\x3e";r+="\x3c/tbody\x3e\x3c/table\x3e"}if(q(r)){r=yc.link(r);zc.innerHTML=r;m=zc.querySelectorAll("a");for(g=0;g<m.length;g++)m[g].setAttribute("target","_blank");q(e)&&1<e.keys.length&&(Aa(zc,"a","href",e),Aa(zc,"img","src",e));Ua(zc,"a","href",f);Ua(zc,"img","src",f);e='\x3cdiv class\x3d"cesium-infoBox-description-lighter" style\x3d"overflow:auto;word-wrap:break-word;'+("background-color:"+a.toCssColorString()+";");e+="color:"+c.toCssColorString()+";";e=e+'"\x3e'+(zc.innerHTML+"\x3c/div\x3e");zc.innerHTML="";b.description=e}}function Dc(a,b,c,e,f,g,h,k,l){function m(a){return a?a.show&&m(a.parent):!0}e=sa(c,e,l);k=e.kml;f=Jc(a,c,f,g,h);l=va(c,"name",ma.kml);e.name=l;e.parent=b;l=Ra(c);q(l)||(l=Wa(c));e.availability=l;Yb(e);l=Sa(c,"visibility",ma.kml);e.show=m(b)&&d(l,!0);b=La(c,"author",ma.atom);l=k.author;l.name=va(b,"name",ma.atom);l.uri=va(b,"uri",ma.atom);l.email=va(b,"email",ma.atom);b=La(c,"link",ma.atom);l=k.link;l.href=Ia(b,"href");l.hreflang=Ia(b,"hreflang");l.rel=Ia(b,"rel");l.type=Ia(b,"type");l.title=Ia(b,"title");l.length=Ia(b,"length");k.address=va(c,"address",ma.kml);k.phoneNumber=va(c,"phoneNumber",ma.kml);k.snippet=va(c,"Snippet",ma.kml);ec(c,e);ad(c,e,f,h,g);a=a._ellipsoid;xc(c,e,a);Vc(c,e,a);q(La(c,"Region",ma.kml))&&H("kml-region","KML - Placemark Regions are unsupported");return{entity:e,styleEntity:f}}function fc(a,b,c,d,e,f,g,h,k){for(var l=Object.keys(Bc),m=l.length,p=0;p<m;p++)for(var q=l[p],r=Bc[q],w=c.childNodes,t=w.length,u=0;u<t;u++){var v=w[u];v.localName!==q||-1===ma.kml.indexOf(v.namespaceURI)&&-1===ma.gx.indexOf(v.namespaceURI)||r(a,b,v,d,e,f,g,h,k)}}function xd(a,b){H("KML Tour unsupported node "+b.localName)}function Vc(a,b,c){var e=La(a,"Camera",ma.kml);if(q(e)){var f=d(Qa(e,"longitude",ma.kml),0),h=d(Qa(e,"latitude",ma.kml),0),k=d(Qa(e,"altitude",ma.kml),0);a=d(Qa(e,"heading",ma.kml),0);var l=d(Qa(e,"tilt",ma.kml),0),e=d(Qa(e,"roll",ma.kml),0);c=g.fromDegrees(f,h,k,c);a=x.fromDegrees(a,l-90,e);b.kml.camera=new X(c,a)}}function xc(a,b,c){var e=La(a,"LookAt",ma.kml);if(q(e)){a=d(Qa(e,"longitude",ma.kml),0);var f=d(Qa(e,"latitude",ma.kml),0),h=d(Qa(e,"altitude",ma.kml),0),k=Qa(e,"heading",ma.kml),l=Qa(e,"tilt",ma.kml),e=d(Qa(e,"range",ma.kml),0),l=B.toRadians(d(l,0)),k=B.toRadians(d(k,0)),k=new z(k,l-B.PI_OVER_TWO,e);c=g.fromDegrees(a,f,h,c);b.kml.lookAt=new fa(c,k)}}function Kc(a,b,c,d,e,f,g,h,k){a._unsupportedNode.raiseEvent(a,b,c,d,e,f,g);H("kml-unsupportedFeature-"+c.nodeName,"KML - Unsupported feature: "+c.nodeName)}function Lc(a){if(!q(a)||0===a.length)return"";var b=a[0];if("\x26"===b||"?"===b)a=a.substring(1);return a}function Oc(a,b,c,e,f,h){function k(a){return a<-B.PI_OVER_TWO?-B.PI_OVER_TWO:a>B.PI_OVER_TWO?B.PI_OVER_TWO:a}function l(a){return a>B.PI?a-B.TWO_PI:a<-B.PI?a+B.TWO_PI:a}var m=I(a.queryParameters),m=m.replace(/%5B/g,"[").replace(/%5D/g,"]");if(q(b)&&b._mode!==U.MORPHING){var p,r;f=d(f,gc);q(c)&&(Fc.x=.5*c.clientWidth,Fc.y=.5*c.clientHeight,p=b.pickEllipsoid(Fc,h,mb));q(p)?r=h.cartesianToCartographic(p,hc):(r=E.center(f,hc),p=h.cartographicToCartesian(r));if(q(e)&&!B.equalsEpsilon(e,1,B.EPSILON9)){var w=f.width*e*.5;e=f.height*e*.5;f=new E(l(r.longitude-w),k(r.latitude-e),l(r.longitude+w),k(r.latitude+e))}m=m.replace("[bboxWest]",B.toDegrees(f.west).toString());m=m.replace("[bboxSouth]",B.toDegrees(f.south).toString());m=m.replace("[bboxEast]",B.toDegrees(f.east).toString());m=m.replace("[bboxNorth]",B.toDegrees(f.north).toString());w=B.toDegrees(r.longitude).toString();e=B.toDegrees(r.latitude).toString();m=m.replace("[lookatLon]",w);m=m.replace("[lookatLat]",e);m=m.replace("[lookatTilt]",B.toDegrees(b.pitch).toString());m=m.replace("[lookatHeading]",B.toDegrees(b.heading).toString());m=m.replace("[lookatRange]",g.distance(b.positionWC,p));m=m.replace("[lookatTerrainLon]",w);m=m.replace("[lookatTerrainLat]",e);m=m.replace("[lookatTerrainAlt]",r.height.toString());h.cartesianToCartographic(b.positionWC,hc);m=m.replace("[cameraLon]",B.toDegrees(hc.longitude).toString());m=m.replace("[cameraLat]",B.toDegrees(hc.latitude).toString());m=m.replace("[cameraAlt]",B.toDegrees(hc.height).toString());r=b.frustum;b=r.aspectRatio;p=h="";q(b)&&(r=B.toDegrees(r.fov),1<b?(h=r,p=r/b):(p=r,h=r*b));m=m.replace("[horizFov]",h.toString());m=m.replace("[vertFov]",p.toString())}else m=m.replace("[bboxWest]","-180"),m=m.replace("[bboxSouth]","-90"),m=m.replace("[bboxEast]","180"),m=m.replace("[bboxNorth]","90"),m=m.replace("[lookatLon]",""),m=m.replace("[lookatLat]",""),m=m.replace("[lookatRange]",""),m=m.replace("[lookatTilt]",""),m=m.replace("[lookatHeading]",""),m=m.replace("[lookatTerrainLon]",""),m=m.replace("[lookatTerrainLat]",""),m=m.replace("[lookatTerrainAlt]",""),m=m.replace("[cameraLon]",""),m=m.replace("[cameraLat]",""),m=m.replace("[cameraAlt]",""),m=m.replace("[horizFov]",""),m=m.replace("[vertFov]","");q(c)?(m=m.replace("[horizPixels]",c.clientWidth),m=m.replace("[vertPixels]",c.clientHeight)):(m=m.replace("[horizPixels]",""),m=m.replace("[vertPixels]",""));m=m.replace("[terrainEnabled]","1");m=m.replace("[clientVersion]","1");m=m.replace("[kmlVersion]","2.2");m=m.replace("[clientName]","Cesium");m=m.replace("[language]","English");a.setQueryParameters(G(m))}function ed(a,b,c,d,e,f,g,h,k){var l=Bc[b.localName];q(l)?l(a,c,b,d,e,f,g,h,k):Kc(a,c,b,d,e,f,g,h,k)}function Rc(a,b,c,d,e,f){b.removeAll();var g=[],h=c.documentElement,h="Document"===h.localName?h:La(h,"Document",ma.kml),h=va(h,"name",ma.kml);q(h)||(h=A(d.getUrlComponent()));q(a._name)||(a._name=h);var k=new ba(a);return R.all(sc(a,c,k,d,!1,e)).then(function(){var h=c.documentElement;if("kml"===h.localName)for(var l=h.childNodes,m=0;m<l.length;m++){var p=l[m];if(q(Bc[p.localName])){h=p;break}}b.suspendEvents();ed(a,h,void 0,b,k,d,e,g,f);b.resumeEvents();return R.all(g).then(function(){return c.documentElement})})}function Pc(a,b,c,d){var e=R.defer();Y.createReader(new Y.BlobReader(c),function(c){c.getEntries(function(f){for(var g=[],h={},k,l,m=0;m<f.length;m++){var p=f[m];if(!p.directory){var r=R.defer();g.push(r.promise);/\.kml$/i.test(p.filename)?q(k)&&/\//i.test(p.filename)?ya(p,h,r):(q(k)&&ya(k,h,l),k=p,l=r):ya(p,h,r)}}q(k)&&Ca(k,h,l);R.all(g).then(function(){c.close();if(q(h.kml))return h.keys=Object.keys(h),Rc(a,b,h.kml,d,h);e.reject(new K("KMZ file does not contain a KML document."))}).then(e.resolve).otherwise(e.reject)})},function(a){e.reject(a)});return e.promise}function bd(a,b,c,e){e=d(e,d.EMPTY_OBJECT);var f=e.sourceUri,g=e.uriResolver,h=e.context;e=c;"string"===typeof c||c instanceof L?(c=L.createIfNeeded(c),e=c.fetchBlob(),f=d(f,c.clone())):f=d(f,L.DEFAULT.clone());f=L.createIfNeeded(f);return R(e).then(function(c){return c instanceof Blob?S(c).then(function(d){return d?Pc(a,b,c,f):ra(c).then(function(c){c=Ea(c);c=Ga(c);var d,e;try{d=qb.parseFromString(c,"application/xml")}catch(sb){e=sb.toString()}if(q(e)||d.body||"parsererror"===d.documentElement.tagName)throw c=q(e)?e:d.documentElement.firstChild.nodeValue,c||(c=d.body.innerText),new K(c);return Rc(a,b,d,f,g,h)})}):Rc(a,b,c,f,g,h)}).otherwise(function(b){a._error.raiseEvent(a,b);console.log(b);return R.reject(b)})}function Mc(b){b=d(b,{});var e=b.camera,f=b.canvas;if(!q(e))throw new r("options.camera is required.");if(!q(f))throw new r("options.canvas is required.");this._changed=new u;this._error=new u;this._loading=new u;this._refresh=new u;this._unsupportedNode=new u;this._clock=void 0;this._entityCollection=new ba(this);this._name=void 0;this._isLoading=!1;this._pinBuilder=new J;this._networkLinks=new a;this._entityCluster=new V;this._canvas=f;this._camera=e;this._lastCameraView={position:q(e)?g.clone(e.positionWC):void 0,direction:q(e)?g.clone(e.directionWC):void 0,up:q(e)?g.clone(e.upWC):void 0,bbox:q(e)?e.computeViewRectangle():E.clone(E.MAX_VALUE)};this._ellipsoid=d(b.ellipsoid,c.WGS84)}function Yb(a){var b=a.parent;if(q(b)&&(b=b.availability,q(b))){var c=a.availability;q(c)?c.intersect(b):a.availability=b}}function Sc(a,b,c,e,f){return function(g){function h(a){u.remove(a);a=a._children;for(var b=a.length,c=0;c<b;++c)h(a[c])}if(e.contains(b.id)){var k=!1,l=La(g,"NetworkLinkControl",ma.kml),m=0;if(q(l)){if(q(La(l,"Update",ma.kml))){H("kml-networkLinkControl-update","KML - NetworkLinkControl updates aren't supported.");b.updating=!1;e.remove(b.id);return}b.cookie=G(d(va(l,"cookie",ma.kml),""));m=d(Qa(l,"minRefreshPeriod",ma.kml),0)}g=v.now();var p=b.refreshMode;if(p===nc.INTERVAL)q(l)&&(b.time=Math.max(m,b.time));else if(p===nc.EXPIRE){var r;q(l)&&(r=va(l,"expires",ma.kml));if(q(r))try{var w=v.fromIso8601(r),t=v.secondsDifference(w,g);0<t&&t<m&&v.addSeconds(g,m,w);b.time=w}catch($b){H("kml-networkLinkControl-expires","KML - NetworkLinkControl expires is not a valid date"),k=!0}else H("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element"),k=!0}r=b.entity;var u=a._entityCollection,w=c.values;u.suspendEvents();l=u.values.slice();for(t=0;t<l.length;++t)m=l[t],m.parent===r&&(m.parent=void 0,h(m));u.resumeEvents();u.suspendEvents();for(t=0;t<w.length;t++)l=w[t],q(l.parent)||(l.parent=r,Yb(l)),u.add(l);u.resumeEvents();k?e.remove(b.id):b.lastUpdated=g;g=u.computeAvailability();k=g.start;g=g.stop;r=v.equals(k,D.MINIMUM_VALUE);w=v.equals(g,D.MAXIMUM_VALUE);if(!r||!w)if(r=a._clock,r.startTime!==k||r.stopTime!==g)r.startTime=k,r.stopTime=g,a._changed.raiseEvent(a);b.updating=!1;b.needsUpdate=!1;a._refresh.raiseEvent(a,f.getUrlComponent(!0))}}}function ab(){this.author={name:void 0,uri:void 0,email:void 0};this.link={href:void 0,hreflang:void 0,rel:void 0,type:void 0,title:void 0,length:void 0};this.extendedData=this.snippet=this.phoneNumber=this.address=void 0}if("undefined"===typeof DOMParser)return{};var Ab={avi:"video/x-msvideo",bmp:"image/bmp",bz2:"application/x-bzip2",chm:"application/vnd.ms-htmlhelp",css:"text/css",csv:"text/csv",doc:"application/msword",dvi:"application/x-dvi",eps:"application/postscript",flv:"video/x-flv",gif:"image/gif",gz:"application/x-gzip",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",jnlp:"application/x-java-jnlp-file",jpeg:"image/jpeg",jpg:"image/jpeg",m3u:"audio/x-mpegurl",m4v:"video/mp4",mathml:"application/mathml+xml",mid:"audio/midi",midi:"audio/midi",mov:"video/quicktime",mp3:"audio/mpeg",mp4:"video/mp4",mp4v:"video/mp4",mpeg:"video/mpeg",mpg:"video/mpeg",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",ogg:"application/ogg",pdf:"application/pdf",png:"image/png",pps:"application/vnd.ms-powerpoint",ppt:"application/vnd.ms-powerpoint",ps:"application/postscript",qt:"video/quicktime",rdf:"application/rdf+xml",rss:"application/rss+xml",rtf:"application/rtf",svg:"image/svg+xml",swf:"application/x-shockwave-flash",text:"text/plain",tif:"image/tiff",tiff:"image/tiff",txt:"text/plain",wav:"audio/x-wav",wma:"audio/x-ms-wma",wmv:"video/x-ms-wmv",xml:"application/xml",zip:"application/zip",detectFromFilename:function(a){a=a.toLowerCase();a=y(a);return Ab[a]}},qb=new DOMParser,yc=new W({stripPrefix:!1,twitter:!1,email:!1,replaceFn:function(a,b){if(!b.protocolUrlMatch)return!1}}),vb=[null,void 0,"http://www.opengis.net/kml/2.2","http://earth.google.com/kml/2.2","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.0"],vc=["http://www.google.com/kml/ext/2.2"],ma={kml:vb,gx:vc,atom:["http://www.w3.org/2005/Atom"],kmlgx:vb.concat(vc)},Ib={maximumRed:void 0,red:void 0,maximumGreen:void 0,green:void 0,maximumBlue:void 0,blue:void 0},ib={Point:function(a,b,c,d,e){var f=va(c,"coordinates",ma.kml),g=va(c,"altitudeMode",ma.kml),h=va(c,"altitudeMode",ma.gx);c=Sa(c,"extrude",ma.kml);f=xa(f,a._ellipsoid);d.position=f;Xb(a,d,e,tc(g,h));c&&Va(g,h)&&Za(b,d,e);return!0},LineString:ja,LinearRing:ja,Polygon:function(a,b,c,d,e){b=La(c,"outerBoundaryIs",ma.kml);var f=La(b,"LinearRing",ma.kml),g=La(f,"coordinates",ma.kml);b=a._ellipsoid;var g=Ha(g,b),f=Sa(c,"extrude",ma.kml),k=va(c,"altitudeMode",ma.kml),l=va(c,"altitudeMode",ma.gx),l=Va(k,l),k=q(e.polygon)?e.polygon.clone():hb();e=e.polyline;q(e)&&(k.outlineColor=q(e.material)?e.material.color:h.WHITE,k.outlineWidth=e.width);d.polygon=k;l?(k.perPositionHeight=!0,k.extrudedHeight=f?0:void 0):a._clampToGround||(k.height=0);if(q(g)){a=new w(g);c=Ja(c,"innerBoundaryIs",ma.kml);for(d=0;d<c.length;d++)for(f=Ja(c[d],"LinearRing",ma.kml),e=0;e<f.length;e++)g=La(f[e],"coordinates",ma.kml),g=Ha(g,b),q(g)&&a.holes.push(new w(g));k.hierarchy=a}return!0},Track:function(a,b,c,d,e){var f=va(c,"altitudeMode",ma.kml),g=va(c,"altitudeMode",ma.gx),h=Ja(c,"coord",ma.gx),k=Ja(c,"angles",ma.gx),l=Ja(c,"when",ma.kml);c=Sa(c,"extrude",ma.kml);var m=Va(f,g),p=a._ellipsoid;0<k.length&&H("kml-gx:angles","KML - gx:angles are not supported in gx:Tracks");for(var q=Math.min(h.length,l.length),k=[],r=[],w=0;w<q;w++){var t=xa(h[w].textContent,p);k.push(t);r.push(v.fromIso8601(l[w].textContent))}h=new ta;h.addSamples(r,k);d.position=h;Xb(a,d,e,tc(f,g));dc(d,e);d.availability=new N;0<l.length&&d.availability.addInterval(new P({start:r[0],stop:r[r.length-1]}));m&&c&&Za(b,d,e);return!0},MultiTrack:function(a,b,c,d,e){var f=Sa(c,"interpolate",ma.gx);c=Ja(c,"Track",ma.gx);for(var g,h,k,l=!1,m=new za,p=new N,r=new F,w=a._ellipsoid,t=0,u=c.length;t<u;t++){g=c[t];var y=Ja(g,"when",ma.kml),z=Ja(g,"coord",ma.gx),E=va(g,"altitudeMode",ma.kml),A=va(g,"altitudeMode",ma.gx),C=Va(E,A),B=Sa(g,"extrude",ma.kml),G=Math.min(z.length,y.length),D=[];g=[];for(var x=0;x<G;x++){var H=xa(z[x].textContent,w);D.push(H);g.push(v.fromIso8601(y[x].textContent))}f&&(q(h)&&uc([h,g[0]],[k,D[0]],r,p,m,!1,"absolute",void 0,!1),h=g[G-1],k=D[D.length-1]);uc(g,D,r,p,m,C&&B,E,A,!0);l=l||C&&B}d.availability=p;d.position=r;Xb(a,d,e);dc(d,e);l&&(Za(b,d,e),d.polyline.show=m);return!0},MultiGeometry:function(a,b,c,d,e,f){c=c.childNodes;for(var g=!1,h=0,k=c.length;h<k;h++){var l=c.item(h),m=ib[l.localName];if(q(m)){var p=sa(l,b,f);p.parent=d;p.name=d.name;p.availability=d.availability;p.description=d.description;p.kml=d.kml;m(a,b,l,p,e)&&(g=!0)}}return g},Model:function(a,b,c,d,e){H("kml-unsupportedGeometry","KML - Unsupported geometry: "+c.localName);return!1}},zc=document.createElement("div"),Bc={Document:fc,Folder:function(a,b,c,d,e,f,g,h,k){b=Dc(a,b,c,d,e,f,g,h,k);fc(a,b.entity,c,d,e,f,g,h,k)},Placemark:function(a,b,c,d,e,f,g,h,k){e=Dc(a,b,c,d,e,f,g,h,k);b=e.entity;e=e.styleEntity;f=!1;c=c.childNodes;g=0;for(h=c.length;g<h&&!f;g++){k=c.item(g);var l=ib[k.localName];q(l)&&(l(a,d,k,b,e,b.id),f=!0)}f||(b.merge(e),Xb(a,b,e))},NetworkLink:function(a,b,c,e,f,g,h,k,l){var m=Dc(a,b,c,e,f,g,h,k,l).entity,r=La(c,"Link",ma.kml);q(r)||(r=La(c,"Url",ma.kml));if(q(r)){var w=va(r,"href",ma.kml),t,u;if(q(w)){b=w;w=Oa(w,g,h);/^data:/.test(w.getUrlComponent())?/\.kmz/i.test(g.getUrlComponent())||(b=g.getDerivedResource({url:b})):(b=w.clone(),t=va(r,"viewRefreshMode",ma.kml),u=d(va(r,"viewBoundScale",ma.kml),1),g="onStop"===t?"BBOX\x3d[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]":"",g=d(va(r,"viewFormat",ma.kml),g),c=va(r,"httpQuery",ma.kml),q(g)&&w.setQueryParameters(G(Lc(g))),q(c)&&w.setQueryParameters(G(Lc(c))),Oc(w,a._camera,a._canvas,u,a._lastCameraView.bbox,a._ellipsoid));h={sourceUri:b,uriResolver:h,context:m.id};var y=new ba;h=bd(a,y,w,h).then(function(b){var c=a._entityCollection,e=y.values;c.suspendEvents();for(var f=0;f<e.length;f++){var g=e[f];q(g.parent)||(g.parent=m,Yb(g));c.add(g)}c.resumeEvents();c=va(r,"refreshMode",ma.kml);e=d(Qa(r,"refreshInterval",ma.kml),0);if("onInterval"===c&&0<e||"onExpire"===c||"onStop"===t){b=La(b,"NetworkLinkControl",ma.kml);var f=q(b),g=v.now(),h={id:p(),href:w,cookie:{},lastUpdated:g,updating:!1,entity:m,viewBoundScale:u,needsUpdate:!1,cameraUpdateTime:g},k=0;f&&(h.cookie=G(d(va(b,"cookie",ma.kml),"")),k=d(Qa(b,"minRefreshPeriod",ma.kml),0));if("onInterval"===c)f&&(e=Math.max(k,e)),h.refreshMode=nc.INTERVAL,h.time=e;else if("onExpire"===c){var l;f&&(l=va(b,"expires",ma.kml));if(q(l))try{var z=v.fromIso8601(l),E=v.secondsDifference(z,g);0<E&&E<k&&v.addSeconds(g,k,z);h.refreshMode=nc.EXPIRE;h.time=z}catch(Fb){H("kml-refreshMode-onInterval-onExpire","KML - NetworkLinkControl expires is not a valid date")}else H("kml-refreshMode-onExpire","KML - refreshMode of onExpire requires the NetworkLinkControl to have an expires element")}else a._camera?(h.refreshMode=nc.STOP,h.time=d(Qa(r,"viewRefreshTime",ma.kml),0)):H("kml-refrehMode-onStop-noCamera","A NetworkLink with viewRefreshMode\x3donStop requires a camera be passed in when creating the KmlDataSource");q(h.refreshMode)&&a._networkLinks.set(h.id,h)}else"onRegion"===t&&H("kml-refrehMode-onRegion","KML - Unsupported viewRefreshMode: onRegion")}).otherwise(function(b){H("An error occured during loading "+w.url);a._error.raiseEvent(a,b)});k.push(h)}}},GroundOverlay:function(a,b,c,d,e,f,g,h,k){e=Dc(a,b,c,d,e,f,g,h,k).entity;d=!1;b=a._ellipsoid;h=Ha(La(c,"LatLonQuad",ma.gx),b);k=Qa(c,"drawOrder",ma.kml);if(q(h))b=hb(),b.hierarchy=new w(h),b.zIndex=k,e.polygon=b,d=!0;else if(b=new qa,b.zIndex=k,e.rectangle=b,e=La(c,"LatLonBox",ma.kml),q(e)){h=Qa(e,"west",ma.kml);k=Qa(e,"south",ma.kml);var l=Qa(e,"east",ma.kml),m=Qa(e,"north",ma.kml);q(h)&&(h=B.negativePiToPi(B.toRadians(h)));q(k)&&(k=B.clampToLatitudeRange(B.toRadians(k)));q(l)&&(l=B.negativePiToPi(B.toRadians(l)));q(m)&&(m=B.clampToLatitudeRange(B.toRadians(m)));b.coordinates=new E(h,k,l,m);e=Qa(e,"rotation",ma.kml);q(e)&&(e=B.toRadians(e),b.rotation=e,b.stRotation=e)}e=La(c,"Icon",ma.kml);a=db(e,a,f,g,!0);q(a)?(d&&H("kml-gx:LatLonQuad","KML - gx:LatLonQuad Icon does not support texture projection."),f=Qa(e,"x",ma.gx),g=Qa(e,"y",ma.gx),d=Qa(e,"w",ma.gx),e=Qa(e,"h",ma.gx),(q(f)||q(g)||q(d)||q(e))&&H("kml-groundOverlay-xywh","KML - gx:x, gx:y, gx:w, gx:h aren't supported for GroundOverlays"),b.material=a,b.material.color=Ka(c,"color",ma.kml),b.material.transparent=!0):b.material=Ka(c,"color",ma.kml);a=va(c,"altitudeMode",ma.kml);q(a)?"absolute"===a?(b.height=Qa(c,"altitude",ma.kml),b.zIndex=void 0):"clampToGround"!==a&&H("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+a):(a=va(c,"altitudeMode",ma.gx),"relativeToSeaFloor"===a?(H("kml-altitudeMode-relativeToSeaFloor","KML - altitudeMode relativeToSeaFloor is currently not supported, treating as absolute."),b.height=Qa(c,"altitude",ma.kml),b.zIndex=void 0):"clampToSeaFloor"===a?H("kml-altitudeMode-clampToSeaFloor","KML - altitudeMode clampToSeaFloor is currently not supported, treating as clampToGround."):q(a)&&H("kml-altitudeMode-unknown","KML - Unknown altitudeMode: "+a))},PhotoOverlay:Kc,ScreenOverlay:Kc,Tour:function(a,b,c,d,e,f,g,h,k){b=va(c,"name",ma.kml);d=Ia(c,"id");b=new ga(b,d);if(d=La(c,"Playlist",ma.gx))for(c=a._ellipsoid,d=d.childNodes,e=0;e<d.length;e++)f=d[e],f.localName&&((g=Ec[f.localName])?g(b,f,c):console.log("Unknown KML Tour playlist entry type "+f.localName));q(a.kmlTours)||(a.kmlTours=[]);a.kmlTours.push(b)}},Ec={FlyTo:function(a,b,c){var d=Qa(b,"duration",ma.gx),e=va(b,"flyToMode",ma.gx),f={kml:{}};xc(b,f,c);Vc(b,f,c);b=new ka(d,e,f.kml.lookAt||f.kml.camera);a.addPlaylistEntry(b)},Wait:function(a,b){var c=Qa(b,"duration",ma.gx);a.addPlaylistEntry(new na(c))},SoundCue:xd,AnimatedUpdate:xd,TourControl:xd},nc={INTERVAL:0,EXPIRE:1,STOP:2},gc=new E,hc=new l,Fc=new k,mb=new g;Mc.load=function(a,b){b=d(b,d.EMPTY_OBJECT);return(new Mc(b)).load(a,b)};t(Mc.prototype,{name:{get:function(){return this._name},set:function(a){this._name!==a&&(this._name=a,this._changed.raiseEvent(this))}},clock:{get:function(){return this._clock}},entities:{get:function(){return this._entityCollection}},isLoading:{get:function(){return this._isLoading}},changedEvent:{get:function(){return this._changed}},errorEvent:{get:function(){return this._error}},loadingEvent:{get:function(){return this._loading}},refreshEvent:{get:function(){return this._refresh}},unsupportedNodeEvent:{get:function(){return this._unsupportedNode}},show:{get:function(){return this._entityCollection.show},set:function(a){this._entityCollection.show=a}},clustering:{get:function(){return this._entityCluster},set:function(a){if(!q(a))throw new r("value must be defined.");this._entityCluster=a}}});Mc.prototype.load=function(a,b){if(!q(a))throw new r("data is required.");b=d(b,{});ca.setLoading(this,!0);var c=this._name;this._name=void 0;this._clampToGround=d(b.clampToGround,!1);var f=this;return bd(this,this._entityCollection,a,b).then(function(){var a,b=f._entityCollection.computeAvailability(),d=b.start,b=b.stop,g=v.equals(d,D.MINIMUM_VALUE),h=v.equals(b,D.MAXIMUM_VALUE);g&&h||(g&&(a=new Date,a.setHours(0,0,0,0),d=v.fromDate(a)),h&&(a=new Date,a.setHours(24,0,0,0),b=v.fromDate(a)),a=new T,a.startTime=d,a.stopTime=b,a.currentTime=v.clone(d),a.clockRange=m.LOOP_STOP,a.clockStep=e.SYSTEM_CLOCK_MULTIPLIER,a.multiplier=Math.round(Math.min(Math.max(v.secondsDifference(b,d)/60,1),31556900)));d=!1;a!==f._clock&&(f._clock=a,d=!0);c!==f._name&&(d=!0);d&&f._changed.raiseEvent(f);ca.setLoading(f,!1);return f}).otherwise(function(a){ca.setLoading(f,!1);f._error.raiseEvent(f,a);console.log(a);return R.reject(a)})};var gb=new a;Mc.prototype.update=function(b){function e(a){a=a._children;for(var b=a.length,c=0;c<b;++c){var d=a[c];gb.set(d.id,d);e(d)}}b=this._networkLinks;if(0===b.length)return!0;var f=v.now(),h=this;gb.removeAll();var k=!1,l=this._lastCameraView,m=this._camera;!q(m)||m.positionWC.equalsEpsilon(l.position,B.EPSILON7)&&m.directionWC.equalsEpsilon(l.direction,B.EPSILON7)&&m.upWC.equalsEpsilon(l.up,B.EPSILON7)||(l.position=g.clone(m.positionWC),l.direction=g.clone(m.directionWC),l.up=g.clone(m.upWC),l.bbox=m.computeViewRectangle(),k=!0);var p=new a,r=!1;b.values.forEach(function(a){var b=a.entity;if(!gb.contains(b.id)){if(!a.updating){var g=!1;a.refreshMode===nc.INTERVAL?v.secondsDifference(f,a.lastUpdated)>a.time&&(g=!0):a.refreshMode===nc.EXPIRE?v.greaterThan(f,a.time)&&(g=!0):a.refreshMode===nc.STOP&&(k&&(a.needsUpdate=!0,a.cameraUpdateTime=f),a.needsUpdate&&v.secondsDifference(f,a.cameraUpdateTime)>=a.time&&(g=!0));if(g){e(b);a.updating=!0;var g=new ba,m=a.href.clone();m.setQueryParameters(a.cookie);var q=d(h._ellipsoid,c.WGS84);Oc(m,h._camera,h._canvas,a.viewBoundScale,l.bbox,q);bd(h,g,m,{context:b.id}).then(Sc(h,a,g,p,m)).otherwise(function(b){b="NetworkLink "+a.href+" refresh failed: "+b;console.log(b);h._error.raiseEvent(h,b)});r=!0}}p.set(a.id,a)}});r&&(this._networkLinks=p,this._changed.raiseEvent(this));return!0};return Mc});F("DataSources/Visualizer",["../Core/DeveloperError"],function(b){function a(){b.throwInstantiationError()}a.prototype.update=b.throwInstantiationError;a.prototype.getBoundingSphere=b.throwInstantiationError;a.prototype.isDestroyed=b.throwInstantiationError;a.prototype.destroy=b.throwInstantiationError;return a});F("FeDataSources/ElliposidFadeMaterialProperty","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ../DataSources/createPropertyDescriptor ../DataSources/Property".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._definitionChanged=new g;this._colorSubscription=this._color=void 0;this.color=b.color;this._time=void 0}var h=b.WHITE;k(e.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:l("color")});e.prototype.getType=function(a){return"EllipsoidFade"};e.prototype.getValue=function(a,b){f(b)||(b={});b.color=m.getValueOrClonedDefault(this._color,a,h,b.color);void 0===this._time&&(this._time=a.secondsOfDay);b.time=a.secondsOfDay-this._time;return b};e.prototype.equals=function(a){return this===a||a instanceof e&&m.equals(this._color,a._color)};return e});F("FeDataSources/PolylineArrowLinkMaterialProperty","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ../DataSources/createPropertyDescriptor ../DataSources/Property".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._definitionChanged=new g;this._colorSubscription=this._color=void 0;this.image=b.image;this.color=b.color;this.duration=b.duration||1E3;this._time=void 0}var h=b.WHITE;k(e.prototype,{isConstant:{get:function(){return!1}},definitionChanged:{get:function(){return this._definitionChanged}},color:l("color"),duration:l("duration"),image:l("image")});e.prototype.getType=function(a){return"PolylineArrowLink"};e.prototype.getValue=function(a,b){f(b)||(b={});b.color=m.getValueOrClonedDefault(this._color,a,h,b.color);b.image=m.getValueOrUndefined(this._image,a);void 0===this._time&&(this._time=a.secondsOfDay);b.time=1E3*(a.secondsOfDay-this._time)/this.duration;return b};e.prototype.equals=function(a){return this===a||a instanceof e&&m.equals(this.duration,a.duration)&&m.equals(this._image,a._image)&&m.equals(this._color,a._color)};return e});F("FeSceneEx/FeAutoTransForm",["../Core/Cartesian3","../Core/Cartesian4","../Core/Matrix3","../Core/Matrix4","../Core/defined"],function(b,a,f,k,g){function l(){}l.computeScale=function(f,e,h,l){if(!g(f)||!g(e))return!0;g(h)||(h=0);g(l)||(l=Number.MAX_VALUE);var d=f.context._us,m=f.camera._viewMatrix;new a;var p=d._viewport,d=d._projection,r=d[k.getElementIndex(0,0)]*p.width*.5,c=d[k.getElementIndex(2,0)]*p.width*.5+d[k.getElementIndex(2,3)]*p.width*.5,r=new b(m[k.getElementIndex(0,0)]*r+m[k.getElementIndex(0,2)]*c,m[k.getElementIndex(1,0)]*r+m[k.getElementIndex(1,2)]*c,m[k.getElementIndex(2,0)]*r+m[k.getElementIndex(2,2)]*c),c=d[k.getElementIndex(1,1)]*p.height*.5,p=d[k.getElementIndex(2,1)]*p.height*.5+d[k.getElementIndex(2,3)]*p.height*.5,p=new b(m[k.getElementIndex(0,1)]*c+m[k.getElementIndex(0,2)]*p,m[k.getElementIndex(1,1)]*c+m[k.getElementIndex(1,2)]*p,m[k.getElementIndex(2,1)]*c+m[k.getElementIndex(2,2)]*p),c=d[k.getElementIndex(2,3)],d=d[k.getElementIndex(3,3)],m=new a(m[k.getElementIndex(0,2)]*c,m[k.getElementIndex(1,2)]*c,m[k.getElementIndex(2,2)]*c,m[k.getElementIndex(3,2)]*c+m[k.getElementIndex(3,3)]*d),d=.7071067811/Math.sqrt(b.magnitudeSquared(r)+b.magnitudeSquared(p));m.x*=d;m.y*=d;m.z*=d;m.w*=d;e=e instanceof b?e:e instanceof a?e:b.fromDegrees(e[0],e[1],e[2]);b.distance(f.camera.position,e);f=new a(e.x,e.y,e.z,1);f=1/(.48/a.dot(f,m));h>=f?f=h:l<f&&(f=l);return f};return l});F("FeShadersEx/FeCloundFS",[],function(){return"#ifdef GL_ES\nprecision mediump float;\n#endif\nuniform sampler2D u_Sampler;\nuniform vec4 u_translucencyByDistance;\nuniform bool u_enableLighting;\nvarying vec3 v_positionMC;\nvarying vec3 v_PositionEC;\nconst float fInnerRadius \x3d 6378137.0;\nconst float fOuterRadius \x3d 6378137.0 * 1.025;\nconst float fOuterRadius2 \x3d fOuterRadius * fOuterRadius;\n\nconst float Kr \x3d 0.0025;\nconst float Km \x3d 0.0015;\nconst float ESun \x3d 15.0;\n\nconst float fKrESun \x3d Kr * ESun;\nconst float fKmESun \x3d Km * ESun;\nconst float fKr4PI \x3d Kr * 4.0 * czm_pi;\nconst float fKm4PI \x3d Km * 4.0 * czm_pi;\n\nconst float fScale \x3d 1.0 / (fOuterRadius - fInnerRadius);\nconst float fScaleDepth \x3d 0.25;\nconst float fScaleOverScaleDepth \x3d fScale / fScaleDepth;\nstruct AtmosphereColor\n{\n    vec3 mie;\n    vec3 rayleigh;\n};\n\nconst int nSamples \x3d 2;\nconst float fSamples \x3d 2.0;\n\nfloat scale(float fCos)\n{\n    float x \x3d 1.0 - fCos;\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\n\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool useSunLighting)\n{\n\tvec3 v3InvWavelength \x3d vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\n\n    // Get the ray from the camera to the vertex and its length (which is the far point of the ray passing through the atmosphere)\n    vec3 v3Ray \x3d v3Pos - czm_viewerPositionWC;\n    float fFar \x3d length(v3Ray);\n    v3Ray /\x3d fFar;\n\n    float fCameraHeight \x3d length(czm_viewerPositionWC);\n    float fCameraHeight2 \x3d fCameraHeight * fCameraHeight;\n\n    // This next line is an ANGLE workaround. It is equivalent to B \x3d 2.0 * dot(czm_viewerPositionWC, v3Ray),\n    // which is what it should be, but there are problems at the poles.\n    float B \x3d 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\n    float C \x3d fCameraHeight2 - fOuterRadius2;\n    float fDet \x3d max(0.0, B*B - 4.0 * C);\n    float fNear \x3d 0.5 * (-B - sqrt(fDet));\n\n    // Calculate the ray's starting position, then calculate its scattering offset\n    vec3 v3Start \x3d czm_viewerPositionWC + v3Ray * fNear;\n    fFar -\x3d fNear;\n    float fDepth \x3d exp((fInnerRadius - fOuterRadius) / fScaleDepth);\n\n    // The light angle based on the sun position would be:\n    //    dot(czm_sunDirectionWC, v3Pos) / length(v3Pos);\n    // When we want the atmosphere to be uniform over the globe so it is set to 1.0.\n    float fLightAngle \x3d useSunLighting ? dot(czm_sunDirectionWC, v3Pos) / length(v3Pos) : 1.0;\n    float fCameraAngle \x3d dot(-v3Ray, v3Pos) / length(v3Pos);\n    float fCameraScale \x3d scale(fCameraAngle);\n    float fLightScale \x3d scale(fLightAngle);\n    float fCameraOffset \x3d fDepth*fCameraScale;\n    float fTemp \x3d (fLightScale + fCameraScale);\n\n    // Initialize the scattering loop variables\n    float fSampleLength \x3d fFar / fSamples;\n    float fScaledLength \x3d fSampleLength * fScale;\n    vec3 v3SampleRay \x3d v3Ray * fSampleLength;\n    vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\n\n    // Now loop through the sample rays\n    vec3 v3FrontColor \x3d vec3(0.0);\n    vec3 v3Attenuate \x3d vec3(0.0);\n    for(int i\x3d0; i\x3cnSamples; i++)\n    {\n        float fHeight \x3d length(v3SamplePoint);\n        float fDepth \x3d exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\n        float fScatter \x3d fDepth*fTemp - fCameraOffset;\n        v3Attenuate \x3d exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\n        v3FrontColor +\x3d v3Attenuate * (fDepth * fScaledLength);\n        v3SamplePoint +\x3d v3SampleRay;\n    }\n\n    AtmosphereColor color;\n    color.mie \x3d v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\n    color.rayleigh \x3d v3Attenuate; // Calculate the attenuation factor for the ground\n\n    return color;\n}\nvoid main() {\n\tvec3 normalMC \x3d czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));\n\tvec2 ellipsoidTextureCoordinates \x3d czm_ellipsoidWgs84TextureCoordinates(normalMC);\n\tvec2 ellipsoidFlippedTextureCoordinates \x3d czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\n\t\tellipsoidFlippedTextureCoordinates.x \x3d 1.0-ellipsoidFlippedTextureCoordinates.x;\n\tvec4 fColor \x3d texture2D(u_Sampler, ellipsoidFlippedTextureCoordinates);\n\tgl_FragColor \x3d fColor;\n\tfloat distance \x3d length(v_PositionEC);\n\tvec4 alphaToDis \x3d u_translucencyByDistance;\n\tfloat maxValue \x3d max(alphaToDis[1],alphaToDis[3]);\n\tfloat minValue \x3d min(alphaToDis[1],alphaToDis[3]);\n\tgl_FragColor.a \x3d gl_FragColor.a*clamp(alphaToDis[1]+(distance-alphaToDis[0])*(alphaToDis[3]-alphaToDis[1])/(alphaToDis[2]-alphaToDis[1]),minValue,maxValue);\n\tif( u_enableLighting ){\n\t\tvec3 normalMCLight \x3d czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));\n\tvec2 ellipsoidTextureCoordinatesLight \x3d czm_ellipsoidWgs84TextureCoordinates(normalMCLight);\n\tvec3 normalECLight \x3d czm_normal3D * normalMCLight;\n\tfloat diffuseIntensityLight \x3d clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalECLight) * 3.0 + 0.4 , 0.0, 1.0);\n\tgl_FragColor \x3d vec4(gl_FragColor.rgb * diffuseIntensityLight, gl_FragColor.a);\n\tczm_ellipsoid ellipsoid \x3d czm_getWgs84EllipsoidEC();\n\tfloat mpp \x3d czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0));\n\tvec2 xy \x3d gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\n\txy *\x3d czm_viewport.zw * mpp * 0.5;\n\tvec3 direction \x3d normalize(vec3(xy, -czm_currentFrustum.x));\n\tczm_ray ray \x3d czm_ray(vec3(0.0), direction);\n\tvec3 ellipsoid_center \x3d ellipsoid.center;\n\tvec3 ellipsoid_inverseRadii \x3d ellipsoid.inverseRadii;\n\tczm_raySegment intersection \x3d czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center,ellipsoid_inverseRadii);\n\tvec3 ellipsoidPosition \x3d czm_pointAlongRay(ray, intersection.start);\n\tellipsoidPosition \x3d (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\n\tAtmosphereColor atmosColor \x3d computeGroundAtmosphereFromSpace(ellipsoidPosition, true);\n\tvec3 groundAtmosphereColor \x3d atmosColor.mie + gl_FragColor.rgb * atmosColor.rayleigh;\n\tgl_FragColor \x3d vec4(groundAtmosphereColor, gl_FragColor.a*diffuseIntensityLight*diffuseIntensityLight);\n}\n}"});F("FeSceneEx/FeClound","../Core/buildModuleUrl ../Core/defaultValue ../Core/defineProperties ../Core/defined ../Core/Color ../Core/Cartesian4 ../Core/Cartesian3 ../Core/Cartesian2 ../Core/Matrix3 ../Core/Matrix4 ../Core/Math ../Core/Resource ../Core/IndexDatatype ../Core/ComponentDatatype ../Core/PrimitiveType ../Core/BoundingSphere ../Core/WebGLConstants ../Scene/SceneMode ../Core/DistanceDisplayCondition ../ThirdParty/when ../Core/Ellipsoid ../Scene/Material ../Scene/CullFace ../FeShadersEx/FeCloundFS ../Scene/BlendingState ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/VertexArray ../Renderer/Texture ../Renderer/DrawCommand".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K){function P(d){d=a(d,a.EMPTY_OBJECT);this._cloundImageResourceDirty=!0;var e=d.textureUrl;k(e)||(e=b("Assets/Textures/cloud.png"),this._cloundImageResource=new q({url:b("Assets/Textures/cloud.png")}));this.cloundTexture=void 0;this.scene=d.scene;this._drawCommand=new K({primitiveType:c.TRIANGLES,boundingVolume:new u,owner:this});var f=this;this.rotMat4=new p;e=h.fromRotationY(-Math.PI/2,new h);this.rotMat4=p.fromRotationTranslation(e,new m(0,0,0),this.rotMat4);this._drawCommand.modelMatrix=this.rotMat4;this._drawCommand.uniformMap={u_Sampler:function(){return f.cloundTexture},u_translucencyByDistance:function(){return f.translucencyByDistance},u_enableLighting:function(){return f.scene.globe.enableLighting}};this.attributeLocations={vertices:0};this._rs=this._sp=this._va=void 0;this.show=a(d.show,!1);this.scale=1.01;this.radii=a(d.radii,[6378137*this.scale,6378137*this.scale,6356752.314245179*this.scale]);this.step=3;this.translucencyByDistance=new l(2E6,0,15E6,1)}function N(a,b){for(var c=180/a.step+1,e=360/a.step+1,f=[],g=0,h,k=a.radii[0],l=a.radii[1],m=a.radii[2],p,q;180>=g;g+=a.step)for(h=0,p=d.toRadians(g);360>=h;h+=a.step)q=d.toRadians(h),f.push(k*Math.sin(p)*Math.cos(q)),f.push(l*Math.sin(p)*Math.sin(q)),f.push(m*Math.cos(p));g=new Float32Array(f.length);for(h=0;h<f.length;++h)g[h]=f[h];f=g;k=[];for(g=0;g<c-1;g++)for(h=0;h<e-1;h++)k.push(g*e+h),k.push((g+1)*e+h),k.push(g*e+(h+1)),k.push(g*e+(h+1)),k.push((g+1)*e+h),k.push((g+1)*e+(h+1));g=new Uint16Array(k.length);for(h=0;h<k.length;++h)g[h]=k[h];c=w.createIndexBuffer({context:b,typedArray:g,usage:G.STATIC_DRAW,indexDatatype:t.UNSIGNED_SHORT});f=w.createVertexBuffer({context:b,typedArray:f,usage:G.STATIC_DRAW});return new E({context:b,attributes:[{index:a.attributeLocations.vertices,vertexBuffer:f,componentsPerAttribute:3,componentDatatype:r.FLOAT}],indexBuffer:c})}f(P.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},cloundImageResource:{get:function(){return this._cloundImageResource.url},set:function(a){this._cloundImageResource.url=a;this._cloundImageResourceDirty=!0}}});P.prototype.update=function(a){if(this.show&&a.context._us._mode==A.SCENE3D){var b=a.context;if(this._cloundImageResourceDirty){this._cloundImageResourceDirty=!1;var c=this._cloundImageResource,d=this;x(c.fetchImage(),function(b){c.url===d._cloundImageResource.url&&(d.cloundTexture=d.cloundTexture&&d.cloundTexture.destroy(),d.cloundTexture=new L({context:a.context,source:b}))})}if(this.cloundTexture)return k(this._va)||(this._va=N(this,b),this._drawCommand.vertexArray=this._va),k(this._sp)||(this._sp=J.fromCache({context:b,vertexShaderSource:"attribute vec4 a_Position;\nvarying vec3 v_positionMC;\nvarying vec3 v_PositionEC;\nuniform mat4 u_rotMat4;\nvoid main() {\n  gl_Position \x3d czm_modelViewProjection * a_Position;\n  v_PositionEC \x3d (czm_modelView * a_Position).xyz;\n  v_positionMC \x3d a_Position.xyz;\n}\n",fragmentShaderSource:C,attributeLocations:this.attributeLocations}),this._drawCommand.shaderProgram=this._sp),k(this._rs)||(this._rs=H.fromCache({blending:I.ALPHA_BLEND,cull:{enabled:!0,face:y.BACK}}),this._drawCommand.renderState=this._rs),this._drawCommand}};P.prototype.destroy=function(){this.cloundTexture=this.cloundTexture&&this.cloundTexture.destroy();return destroyObject(this)};return P});F("FeShadersEx/FeConstellationVS",[],function(){return"attribute vec3 position;\nattribute float plx;\nuniform bool useLogDepth;\nuniform float maxPlx;\nuniform float scalar;\nvarying vec3 v_positionEC;\nconst float skyRadius \x3d 6378137.0* 8000000000.0;\n\n\nvoid main()\n{\n\tvec3 positionWC \x3d position.xyz*(skyRadius/plx);\n\tgl_Position \x3d czm_modelViewProjection * vec4(positionWC.xyz,1.0);\n\tv_positionEC \x3d (czm_view * vec4(positionWC.xyz,1.0)).xyz;\n\tif(useLogDepth){\n\t\tgl_Position.z \x3d log2(max(1e-6, 1.0 + gl_Position.w)) * czm_log2FarDistance - 1.0;\n\t\tgl_Position.z *\x3d gl_Position.w;\n\t}\n}"});F("FeShadersEx/FeConstellationFS",[],function(){return"precision mediump float;\n\tuniform vec2 visibleDistance;\n\tuniform vec4 color;\n\tvarying vec3 v_positionEC;\n\nvoid main()\n{\n\t//float distance \x3d length(v_positionEC);\n\t//if(distance \x3e\x3d visibleDistance.x \x26\x26 distance \x3c\x3d visibleDistance.y){\n\t//\tgl_FragColor \x3d color;\n\t//}else{\n\t//\t//discard;\n\t//}\n\tgl_FragColor \x3d color;\n}"});F("FeSceneEx/FeConstellation","../Core/buildModuleUrl ../Core/defaultValue ../Core/defineProperties ../Core/defined ../Core/Color ../Core/Cartesian4 ../Core/Cartesian3 ../Core/Cartesian2 ../Core/Matrix3 ../Core/Matrix4 ../Core/Math ../Core/Resource ../Core/IndexDatatype ../Core/ComponentDatatype ../Core/PrimitiveType ../Core/BoundingSphere ../Core/WebGLConstants ../Scene/SceneMode ../Core/DistanceDisplayCondition ../ThirdParty/when ../Core/Ellipsoid ../Scene/Material ../Scene/CullFace ../Scene/BlendingState ../Scene/LabelCollection ../Scene/Label ../FeShadersEx/FeConstellationVS ../FeShadersEx/FeConstellationFS ../Renderer/RenderState ../Renderer/Pass ../Renderer/ShaderProgram ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/VertexArray ../Renderer/Texture ../Renderer/DrawCommand".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z){function aa(d){d=a(d,a.EMPTY_OBJECT);this.scene=d.scene;this._constellationUrl=a(d.starUrl,b("Assets/Constellations.json"));this._show=a(d.show,!1);this._labelShow=a(d.labelShow,!1);this.constellationInfo={};this.constellationPositionArr=[];this.constellationNameArr=[];this._constellationFirstPointArr=[];this.plxArr=[];this.constellationIndexArr=[];this.skyRadius=6378137*8E9;this._color=a(d.color,g.fromCssColorString("rgba(0.0,203.0,203.0,0.1)"));this.constellationLoadingSuccess=!1;this.visibleDistance=new e(0,.06*this.skyRadius);this._useLogDepth=!0;var f=[];this.labelCollection=this.scene.primitives.add(new I({scene:this.scene}));var h=this,k=new m;q.fetchJson({url:this._constellationUrl}).then(function(a){for(var b=0,c=a.length,d=0;d<c;++d){var l=a[d],p=l.connections,l=l.name;h.constellationNameArr.push(l);var q=p.length;f=[];for(var r=0;r<q;++r){var w=p[r],t=w.source,v=t.GLon,y=t.GLat,t=t.Plx;h.plxArr.push(t);t=h.skyRadius/t;k.x=Math.cos(v)*Math.cos(y);k.y=Math.sin(v)*Math.cos(y);k.z=Math.sin(y);h.constellationPositionArr.push(k.x);h.constellationPositionArr.push(k.y);h.constellationPositionArr.push(k.z);f.push(new m(k.x*t,k.y*t,k.z*t));0<r&&(h.constellationIndexArr.push(b-1),h.constellationIndexArr.push(b));h.constellationIndexArr.push(b);b++;y=w.target;w=y.GLon;v=y.GLat;y=y.Plx;h.plxArr.push(y);y=h.skyRadius/y;k.x=Math.cos(w)*Math.cos(v);k.y=Math.sin(w)*Math.cos(v);k.z=Math.sin(v);h.constellationPositionArr.push(k.x);h.constellationPositionArr.push(k.y);h.constellationPositionArr.push(k.z);h.constellationIndexArr.push(b);f.push(new m(k.x*y,k.y*y,k.z*y));b++}p=u.fromPoints(f);h._constellationFirstPointArr.push({x:p.center.x,y:p.center.y,z:p.center.z});h.labelCollection.add({position:new m(p.center.x,p.center.y,p.center.z),show:h._labelShow,text:l,pixelOffset:new e(20,20),font:"14px \u9ed1\u4f53",fillColor:g.fromCssColorString("rgba(0.0,203.0,203.0,0.2)")})}h.constellationLoadingSuccess=!0});this._drawCommand=new Z({primitiveType:c.LINES,modelMatrix:p.clone(p.IDENTITY),owner:this});this._drawCommand.uniformMap={useLogDepth:function(){return h._useLogDepth},color:function(){return h.color},scalar:function(){return h.skyRadius},visibleDistance:function(){return h.visibleDistance}};this.attributeLocations={vertices:0,plx:1};this._rs=this._sp=this._va=void 0}f(aa.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}},labelShow:{get:function(){return this._labelShow},set:function(a){if(a!==this._labelShow){this._labelShow=a;for(var b=this.labelCollection.length,c=0;c<b;++c)this.labelCollection.get(c).show=a}}},color:{get:function(){return this._color},set:function(a){this._color=g.fromCssColorString(a)}},constellationFirstPointArr:{get:function(){return this._constellationFirstPointArr}}});aa.prototype.update=function(a){if(a.context._us._mode!=A.SCENE3D)this.labelShow=!1;else if(this.show&&(this.labelShow=!0,a.passes.render&&this.constellationLoadingSuccess)){var b=a.context;this._useLogDepth=a.useLogDepth;if(!k(this._va)){var c=new Float32Array(this.constellationPositionArr);a=new Float32Array(this.plxArr);c=K.createVertexBuffer({context:b,typedArray:c,usage:P.STATIC_DRAW});a=K.createVertexBuffer({context:b,typedArray:a,usage:P.STATIC_DRAW});this._va=new N({context:b,attributes:[{index:this.attributeLocations.vertices,vertexBuffer:c,componentsPerAttribute:3,componentDatatype:r.FLOAT},{index:this.attributeLocations.plx,vertexBuffer:a,componentsPerAttribute:1,componentDatatype:r.FLOAT}]});this._drawCommand.vertexArray=this._va}k(this._sp)||(this._sp=L.fromCache({context:b,vertexShaderSource:J,fragmentShaderSource:w,attributeLocations:this.attributeLocations}),this._drawCommand.shaderProgram=this._sp);k(this._rs)||(this._rs=G.fromCache({lineWidth:1,blending:{enabled:!0,functionSourceRgb:y.SRC_ALPHA,functionDestinationRgb:y.ONE_MINUS_SRC_ALPHA},depthTest:{enabled:!0,func:y.LESS},cull:{enabled:!0,face:y.FRONT_AND_BACK}}),this._drawCommand.renderState=this._rs);return this._drawCommand}};aa.prototype.destroy=function(){this.starInfo=[];this.constellationInfo=[];this.starPositionArr=[];this.starSizeArr=[];this.starSizeArr=this.starPositionArr=this.constellationInfo=this.starInfo=void 0;var a=this._drawCommand;a.vertexArray=a.vertexArray&&a.vertexArray.destroy();a.shaderProgram=a.shaderProgram&&a.shaderProgram.destroy();return destroyObject(this)};return aa});F("FeSceneEx/FeDrawCommand",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/PrimitiveType"],function(b,a,f,k){function g(a){a=b(a,b.EMPTY_OBJECT);this._primitive=a.primitive;this._boundingVolume=a.boundingVolume;this._orientedBoundingBox=a.orientedBoundingBox;this._cull=b(a.cull,!0);this._modelMatrix=a.modelMatrix;this._primitiveType=b(a.primitiveType,k.TRIANGLES);this._vertexArray=a.vertexArray;this._count=a.count;this._offset=b(a.offset,0);this._instanceCount=b(a.instanceCount,0);this._shaderProgram=a.shaderProgram;this._uniformMap=a.uniformMap;this._renderState=a.renderState;this._framebuffer=a.framebuffer;this._pass=a.pass;this._executeInClosestFrustum=b(a.executeInClosestFrustum,!1);this._owner=a.owner;this._debugShowBoundingVolume=b(a.debugShowBoundingVolume,!1);this._debugOverlappingFrustums=0;this._castShadows=b(a.castShadows,!1);this._receiveShadows=b(a.receiveShadows,!1);this.dirty=!0;this.lastDirtyTime=0;this.name="FeDrawCommand"}f(g.prototype,{boundingVolume:{get:function(){return this._boundingVolume},set:function(a){this._boundingVolume!==a&&(this._boundingVolume=a,this.dirty=!0)}},orientedBoundingBox:{get:function(){return this._orientedBoundingBox},set:function(a){this._orientedBoundingBox!==a&&(this._orientedBoundingBox=a,this.dirty=!0)}},cull:{get:function(){return this._cull},set:function(a){this._cull!==a&&(this._cull=a,this.dirty=!0)}},modelMatrix:{get:function(){return this._modelMatrix},set:function(a){this._modelMatrix!==a&&(this._modelMatrix=a,this.dirty=!0)}},primitiveType:{get:function(){return this._primitiveType},set:function(a){this._primitiveType!==a&&(this._primitiveType=a,this.dirty=!0)}},vertexArray:{get:function(){return this._vertexArray},set:function(a){this._vertexArray!==a&&(this._vertexArray=a,this.dirty=!0)}},count:{get:function(){return this._count},set:function(a){this._count!==a&&(this._count=a,this.dirty=!0)}},offset:{get:function(){return this._offset},set:function(a){this._offset!==a&&(this._offset=a,this.dirty=!0)}},instanceCount:{get:function(){return this._instanceCount},set:function(a){this._instanceCount!==a&&(this._instanceCount=a,this.dirty=!0)}},shaderProgram:{get:function(){return this._shaderProgram},set:function(a){this._shaderProgram!==a&&(this._shaderProgram=a,this.dirty=!0)}},castShadows:{get:function(){return this._castShadows},set:function(a){this._castShadows!==a&&(this._castShadows=a,this.dirty=!0)}},receiveShadows:{get:function(){return this._receiveShadows},set:function(a){this._receiveShadows!==a&&(this._receiveShadows=a,this.dirty=!0)}},uniformMap:{get:function(){return this._uniformMap},set:function(a){this._uniformMap!==a&&(this._uniformMap=a,this.dirty=!0)}},renderState:{get:function(){return this._renderState},set:function(a){this._renderState!==a&&(this._renderState=a,this.dirty=!0)}},framebuffer:{get:function(){return this._framebuffer},set:function(a){this._framebuffer!==a&&(this._framebuffer=a,this.dirty=!0)}},pass:{get:function(){return this._pass},set:function(a){this._pass!==a&&(this._pass=a,this.dirty=!0)}},executeInClosestFrustum:{get:function(){return this._executeInClosestFrustum},set:function(a){this._executeInClosestFrustum!==a&&(this._executeInClosestFrustum=a,this.dirty=!0)}},owner:{get:function(){return this._owner},set:function(a){this._owner!==a&&(this._owner=a,this.dirty=!0)}},debugShowBoundingVolume:{get:function(){return this._debugShowBoundingVolume},set:function(a){this._debugShowBoundingVolume!==a&&(this._debugShowBoundingVolume=a,this.dirty=!0)}},debugOverlappingFrustums:{get:function(){return this._debugOverlappingFrustums},set:function(a){this._debugOverlappingFrustums!==a&&(this._debugOverlappingFrustums=a,this.dirty=!0)}}});g.shallowClone=function(b,f){if(a(b))return a(f)||(f=new g),f._primitive=b.primitive,f._boundingVolume=b._boundingVolume,f._orientedBoundingBox=b._orientedBoundingBox,f._cull=b._cull,f._modelMatrix=b._modelMatrix,f._primitiveType=b._primitiveType,f._vertexArray=b._vertexArray,f._count=b._count,f._offset=b._offset,f._instanceCount=b._instanceCount,f._shaderProgram=b._shaderProgram,f._uniformMap=b._uniformMap,f._renderState=b._renderState,f._framebuffer=b._framebuffer,f._pass=b._pass,f._executeInClosestFrustum=b._executeInClosestFrustum,f._owner=b._owner,f._debugShowBoundingVolume=b._debugShowBoundingVolume,f._debugOverlappingFrustums=b._debugOverlappingFrustums,f._castShadows=b._castShadows,f._receiveShadows=b._receiveShadows,f.dirty=!0,f.lastDirtyTime=0,f};g.prototype.execute=function(b,f){a(this._primitive)&&this._primitive.draw(b,f)};return g});F("FeShadersEx/FeFlatCloundVS",[],function(){return"precision mediump float;\nattribute vec3 position;\nattribute vec2 texCoord;\nuniform mat4 modelVertexMatrix;\nuniform float log2FarDistance;\nuniform bool useLogDepth;\n\nvarying vec2 oUV0;\nvarying vec3 oUV1;\nvarying float oUV2;\nvarying vec4 oUV3;\nvarying vec3 v_position;\nvarying vec3 v_positionEC;\n\nvoid main()\n{\n\tgl_Position \x3d (czm_viewProjection * modelVertexMatrix) * vec4(position,1.0);\n\t//gl_Position \x3d modelVertexMatrix * vec4(position,1.0);\n\tif(useLogDepth){\n\t\t//gl_Position.z \x3dlog2(max(1e-6,1.0 + gl_Position.w))*log2FarDistance - 1.0;\n\t\t//gl_Position.z *\x3d gl_Position.w;\n\t\tgl_Position.z \x3d log2(max(1e-6, 1.0 + gl_Position.w)) * czm_log2FarDistance - 1.0;\n\t\tgl_Position.z *\x3d gl_Position.w;\n\t}\n\n\tvec4 positionEC \x3d czm_view3D * vec4(position,1.0);\n\tv_positionEC \x3d positionEC.xyz;\n\toUV3 \x3d vec4(position,1.0);\n\toUV0 \x3d texCoord;\n\n\toUV1 \x3d normalize (oUV3.xyz);\n\tv_position \x3d position.xyz;\n\n\toUV2 \x3d dot (oUV1, normalize (-czm_sunDirectionWC));\n}"});F("FeShadersEx/FeFlatCloundFS",[],function(){return"precision mediump float;\n\nvarying vec2 oUV0;\nvarying vec3 oUV1;\nvarying float oUV2;\nvarying vec4 oUV3;\nvarying vec3 v_position;\nvarying vec3 v_positionEC;\n\nconst float cloudMassInvScale \x3d 1.2;\nconst float cloudDetailInvScale \x3d 4.8;\nconst float cloudSharpness \x3d 4.0;\nconst float cloudThickness \x3d 3.0;\nconst float cloudDetailBlend \x3d 0.5;\nconst float cloudUVFactor \x3d 2.0;\nconst float nearFadeDist \x3d 6000000.0;\nconst float farFadeDist \x3d 7000000.0;\nconst float alpha \x3d 1.0;\nconst vec3 fadeDistMeasurementVector \x3d vec3(1.0,1.0,0.0);\n//const vec3 radii \x3d vec3(6378137,6378137,6356752.314245179);\nconst vec3 radii \x3d vec3(6356752.314245179,6356752.314245179,6356752.314245179);\nconst vec3 ellipsoidCenter \x3d vec3(0.0,0.0,0.0);\n\n\nuniform vec2  cloudMassOffset;\nuniform vec2  cloudDetailOffset;\nuniform float  cloudMassBlend;\nuniform float  cloudBlendPos;\nuniform float  cloudCoverageThreshold;\n\n\nuniform vec4  sunLightColour;\nuniform vec4  sunSphereColour;\nuniform vec4  fogColour;\n\n\nuniform vec3 camPosition;\n\n\nuniform sampler2D textureNoise1;\nuniform sampler2D textureNoise2;\nuniform sampler2D textureNoise3;\nuniform sampler2D textureNoise4;\n// uniform sampler2D texNoise1;\n// uniform sampler2D texNoise2;\n// uniform sampler2D texReference;\n\nvec3 YUVfromRGB(vec3 col)\n{\n    return vec3(dot(col, vec3(0.299,0.587,0.114)),\n\t\t\t\t  dot(col, vec3(-0.14713,-0.28886,0.436)),\n\t\t\t\t  dot(col, vec3(0.615,-0.51499,-0.10001)));\n}\n\nvec3 RGBfromYUV(vec3 col)\n{\n    return vec3(dot(col,vec3(1,0,1.13983)),\n\t\t\t\t  dot(col,vec3(1,-0.39465,-0.58060)),\n\t\t\t\t  dot(col,vec3(1,2.03211,0)));\n}\n\nvec3 MagicColorMix(vec3 col1, vec3 col2)\n{\n    return clamp(RGBfromYUV(vec3(YUVfromRGB(col1).x, YUVfromRGB(col2).yz)),0.0,1.0);\n}\n\nfloat LayeredClouds_intensity\n(\n        vec2   pos,\n        float       cloudMassInvScale,\n        float       cloudDetailInvScale,\n        vec2      cloudMassOffset,\n        vec2      cloudDetailOffset,\n        float       cloudMassBlend,\n        float       cloudDetailBlend,\n        float       cloudCoverageThreshold\n)\n{\n\t// Calculate the base alpha\n\tvec2 finalMassOffset \x3d cloudMassOffset + pos;\n\tfloat currentTexIndex \x3d floor(cloudBlendPos);\n\tcurrentTexIndex \x3d mod((mod(currentTexIndex,4.0) + 4.0),4.0);\n\tfloat x,y;\n\tif( currentTexIndex \x3c 1.0 ){\n\t\tx \x3d texture2D(textureNoise1, finalMassOffset * cloudMassInvScale).r;\n\t\ty \x3d texture2D(textureNoise2, finalMassOffset * cloudMassInvScale).r;\n\t}else if( currentTexIndex \x3c 2.0 ){\n\t\tx \x3d texture2D(textureNoise2, finalMassOffset * cloudMassInvScale).r;\n\t\ty \x3d texture2D(textureNoise3, finalMassOffset * cloudMassInvScale).r;\n\t}else if( currentTexIndex \x3c 3.0 ){\n\t\tx \x3d texture2D(textureNoise3, finalMassOffset * cloudMassInvScale).r;\n\t\ty \x3d texture2D(textureNoise4, finalMassOffset * cloudMassInvScale).r;\n\t}else{\n\t\tx \x3d texture2D(textureNoise4, finalMassOffset * cloudMassInvScale).r;\n\t\ty \x3d texture2D(textureNoise1, finalMassOffset * cloudMassInvScale).r;\n\t}\n\t//float x \x3d texture2D(texNoise1, finalMassOffset * cloudMassInvScale).r;\n\t//float y \x3d texture2D(texNoise2, finalMassOffset * cloudMassInvScale).r;\n\tfloat aCloud\x3dx+cloudMassBlend*(y-x);\n\tfloat aDetail \x3d texture2D(textureNoise4, (cloudDetailOffset + pos) * cloudDetailInvScale).r;\n\taCloud \x3d (aCloud + aDetail * cloudDetailBlend)/(1.0 + cloudDetailBlend);\n\treturn max(0.0, aCloud - cloudCoverageThreshold);\n}\n\nvec4 OldCloudColor\n(\n\t\tvec2       uv,\n\t\tvec3       relPosition,\n\t\tfloat        sunGlow\n) {\n    // Initialize output.\n\tvec4 oCol \x3d vec4(1.0, 1.0, 1.0, 0.0);\n\n\t// Get cloud intensity.\n\tfloat intensity \x3d LayeredClouds_intensity\n    (\n            uv,\n            cloudMassInvScale,\n            cloudDetailInvScale,\n            cloudMassOffset,\n            cloudDetailOffset,\n            cloudMassBlend,\n            cloudDetailBlend,\n            cloudCoverageThreshold\n    );\n\n\t// Opacity is exponential.\n\tfloat aCloud \x3d clamp((exp(cloudSharpness * intensity) - 1.0),0.0,1.0);\n\n\tfloat shine \x3d pow(clamp(sunGlow,0.0,1.0), 8.0) / 4.0;\n\tvec4 tempColor\x3dsunLightColour;\n\ttempColor.rgb *\x3d 1.5;\n\tvec3 cloudColour \x3d fogColour.rgb * (1.0 - intensity / 3.0);\n\tfloat thickness \x3d clamp((0.8 - exp(-cloudThickness * (intensity + 0.2 - shine))),0.0,1.0);\n\n\toCol.rgb \x3d tempColor.rgb+thickness*(cloudColour.rgb-tempColor.rgb);\n\toCol.a \x3d aCloud;\n\n\treturn oCol;\n}\n\nvoid main(void)\n{\n\n\tczm_ellipsoid ellipsoid \x3d czm_getWgs84EllipsoidEC();\n\tvec4 positionEC \x3d czm_windowToEyeCoordinates(gl_FragCoord);\n\tvec3 direction \x3d normalize(positionEC.xyz);\n    czm_ray ray \x3d czm_ray(vec3(0.0), direction);\n\tczm_raySegment intersection \x3d czm_rayEllipsoidIntersectionInterval(ray, ellipsoid);\n    //if (length(positionEC.xyz) \x3e length(v_positionEC.xyz) )\n\tif (!czm_isEmpty(intersection))\n    {\n        discard;\n    }\n\t// czm_ellipsoid ellipsoid \x3d czm_ellipsoidNew(ellipsoidCenter, radii);\n\t// if( czm_ellipsoidContainsPoint(ellipsoid, v_position.xyz)){\n\t//\t discard;\n\t// }\n\tvec2 temp\x3doUV0 *cloudUVFactor;\n\n    gl_FragColor \x3d OldCloudColor(\n            temp, oUV1, oUV2);\n\n\tfloat dist \x3d distance(oUV3.xyz, fadeDistMeasurementVector.xyz);\n\tfloat aMod \x3d 1.0;\n\tif (dist \x3e nearFadeDist) {\n\t\taMod \x3d clamp((farFadeDist - dist) / (farFadeDist - nearFadeDist),0.0,1.0);\n    }\n    float alfa \x3d gl_FragColor.a * aMod;\n\n\tvec3 cloudDir \x3d normalize(oUV3.xyz - camPosition);\n\t//float angleDiff \x3d clamp(dot(cloudDir, normalize(czm_sunDirectionWC.xyz)),0.0,1.0);\n\tfloat angleDiff \x3d dot(cloudDir, normalize(czm_sunDirectionWC.xyz));\n\n\tvec3 lCol \x3d gl_FragColor.rgb+angleDiff*(MagicColorMix(gl_FragColor.rgb, sunSphereColour.rgb)-gl_FragColor.rgb);\n\t//vec3 lCol \x3d fogColour.rgb;\n\tgl_FragColor.rgb \x3d lCol+alfa*(gl_FragColor.rgb-lCol);\n\tif(gl_FragColor.r \x3c 0.1 \x26\x26 gl_FragColor.g \x3c 0.1 \x26\x26 gl_FragColor.b \x3c 0.1)\n\t{\n\t    gl_FragColor.a \x3d 0.0;\n\t}\n\telse\n\t{\n\t   gl_FragColor.a \x3d alfa * alpha;\n\t}\n\t//gl_FragColor \x3d vec4(1.0,0.0,0.0,0.5);\n\t//gl_FragColor \x3d texture2D(texReference,oUV0);\n}"});F("FeSceneEx/FeFlatClound","../Core/buildModuleUrl ../Core/defaultValue ../Core/defineProperties ../Core/defined ../Core/Color ../Core/Cartesian4 ../Core/Cartesian3 ../Core/Cartesian2 ../Core/Matrix3 ../Core/Matrix4 ../Core/Math ../Core/Resource ../Core/IndexDatatype ../Core/ComponentDatatype ../Core/PrimitiveType ../Core/BoundingSphere ../Core/WebGLConstants ../Core/Transforms ../Core/getTimestamp ../Scene/SceneMode ../Core/DistanceDisplayCondition ../ThirdParty/when ../Core/Ellipsoid ../Scene/Material ../Scene/CullFace ../FeShadersEx/FeFlatCloundVS ../FeShadersEx/FeFlatCloundFS ../Scene/BlendingState ../Renderer/RenderState ../Renderer/Sampler ../Renderer/TextureWrap ../Renderer/TextureMinificationFilter ../Renderer/TextureMagnificationFilter ../Renderer/ShaderProgram ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/VertexArray ../Renderer/Texture ../Renderer/DrawCommand".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W){function M(d){d=a(d,a.EMPTY_OBJECT);this._cloundImageResourceDirty=!0;this._imageResourceNoise1=new q({url:b("Assets/Textures/FlatClound/noise1.png")});this._imageResourceNoise2=new q({url:b("Assets/Textures/FlatClound/noise2.png")});this._imageResourceNoise3=new q({url:b("Assets/Textures/FlatClound/noise3.png")});this._imageResourceNoise4=new q({url:b("Assets/Textures/FlatClound/noise4.png")});this._textureNoise4=this._textureNoise3=this._textureNoise2=this._textureNoise1=void 0;this.scene=d.scene;this.camera=this.scene.camera;this.modelVertexMatrix=p.IDENTITY.clone();var f=this.scene.context,g=new E({wrapS:L.REPEAT,wrapT:L.REPEAT,minificationFilter:K.LINEAR,magnificationFilter:P.LINEAR});this._texArr=[];var h=this;v(h._imageResourceNoise1.fetchImage(),function(a){h._textureNoise1=h._textureNoise1&&h._textureNoise1.destroy();h._textureNoise1=new U({flipY:!0,context:f,source:a,sampler:g});h._texArr[0]=h._textureNoise1});v(h._imageResourceNoise2.fetchImage(),function(a){h._textureNoise2=h._textureNoise2&&h._textureNoise2.destroy();h._textureNoise2=new U({flipY:!0,context:f,source:a,sampler:g});h._texArr[1]=h._textureNoise2});v(h._imageResourceNoise3.fetchImage(),function(a){h._textureNoise3=h._textureNoise3&&h._textureNoise3.destroy();h._textureNoise3=new U({flipY:!0,context:f,source:a,sampler:g});h._texArr[2]=h._textureNoise3});v(h._imageResourceNoise4.fetchImage(),function(a){h._textureNoise4=h._textureNoise4&&h._textureNoise4.destroy();h._textureNoise4=new U({flipY:!0,context:f,source:a,sampler:g});h._texArr[3]=h._textureNoise4});this._drawCommand=new W({primitiveType:c.TRIANGLES,modelMatrix:p.clone(p.IDENTITY),owner:this});this._cloudSpeed=new e(2E-6,2E-6);this._cloudCover=.5;this._cloudCoverVisibilityThreshold=.001;this._cloudBlendTime=86400;this._cloudBlendPos=.5;this._cloudCoverageThreshold=.4;this._sunLightColour=new l(1,1,1,1);this._sunSphereColour=new l(1,1,1,1);this._fogColour=new l(.02,.02,.02,.9);this._log2FarDistance=0;this._useLogDepth=!0;this.radius=6378137;this._cloudMassOffset=new e;this._cloudDetailOffset=new e;this._camPosition=new m;this._camPosition=m.clone(this.scene.camera.positionWC,this._camPosition);this._texReference=this._texNoise2=this._texNoise1=void 0;this._drawCommand.uniformMap={modelVertexMatrix:function(){return h.modelVertexMatrix},cloudMassOffset:function(){return h._cloudMassOffset},cloudDetailOffset:function(){return h._cloudDetailOffset},cloudMassBlend:function(){return h._cloudBlendPos%1},cloudBlendPos:function(){return h._cloudBlendPos},cloudCoverageThreshold:function(){return h._cloudCoverageThreshold},sunLightColour:function(){return h._sunLightColour},sunSphereColour:function(){return h._sunSphereColour},fogColour:function(){return h._fogColour},camPosition:function(){return h._camPosition},log2FarDistance:function(){return h._log2FarDistance},useLogDepth:function(){return h._useLogDepth},textureNoise1:function(){return h._textureNoise1},textureNoise2:function(){return h._textureNoise2},textureNoise3:function(){return h._textureNoise3},textureNoise4:function(){return h._textureNoise4}};this.attributeLocations={position:0,textureCoordinates:1};this._lastTimeStamp=this.renderState=this.shaderProgram=this.vertexArray=void 0;this._show=a(d.show,!1)}f(M.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}}});var R=new m,Y=new m(1,1,1),Q=new h,F=new h,ca=new h,T=new p;M.prototype.update=function(a){if(this.show&&this.scene.mode==x.SCENE3D){var b=a.camera,c=B.WGS84.cartesianToCartographic(b.position),e=d.toDegrees(c.longitude),f=d.toDegrees(c.latitude),g=c.height,l=b.direction;R=m.normalize(b.position,R);b=m.dot(l,R);if(!(-10>d.toDegrees(b)||25E3<g)){var g=this.radius,l=h.fromRotationZ(0),q=h.fromRotationY(d.toRadians(0)),b=h.fromRotationX(d.toRadians(90)),l=h.multiply(l,q,Q),b=h.multiply(l,b,F),c=this.scene.globe.getHeight(c);k(c)||(c=0);l=h.fromScale(Y);this.modelVertexMatrix=p.multiplyByMatrix3(A.eastNorthUpToFixedFrame(m.fromDegrees(e,f,-g*Math.cos(d.toRadians(50))+c)),h.multiply(b,l,ca),T);e=a.context;this._log2FarDistance=e._us.log2FarDistance;this._useLogDepth=a.useLogDepth;if(k(this._textureNoise1)&&k(this._textureNoise2)&&k(this._textureNoise3)&&k(this._textureNoise4)){a=z();k(this._lastTimeStamp)||(this._lastTimeStamp=a);f=a-this._lastTimeStamp;this._cloudMassOffset.x+=f*this._cloudSpeed.x;this._cloudMassOffset.y+=f*this._cloudSpeed.y;this._cloudDetailOffset.x-=f*this._cloudSpeed.x;this._cloudDetailOffset.y-=f*this._cloudSpeed.y;this._cloudBlendPos+=f/this._cloudBlendTime;this._lastTimeStamp=a;this._camPosition=m.clone(this.scene.camera.position,this._camPosition);if(!k(this.vertexArray)){a=[];for(var g=this.radius,b=d.toRadians(120),l=d.toRadians(120),q=d.toRadians(5),w=d.toRadians(5),t=0,f=-l/2;f<l/2;f+=w)for(c=-b/2;c<b/2;c+=q){var u=g*Math.cos(f)*Math.sin(c),v=g*Math.cos(f)*Math.cos(c),E=g*Math.sin(f),C=g*Math.cos(f+w)*Math.sin(c),D=g*Math.cos(f+w)*Math.cos(c),L=g*Math.sin(f+w),K=g*Math.cos(f)*Math.sin(c+q),I=g*Math.cos(f)*Math.cos(c+q),M=g*Math.sin(f),P=g*Math.cos(f+w)*Math.sin(c+q),W=g*Math.cos(f+w)*Math.cos(c+q),U=g*Math.sin(f+w);a[t++]=u;a[t++]=v;a[t++]=E;a[t++]=C;a[t++]=D;a[t++]=L;a[t++]=K;a[t++]=I;a[t++]=M;a[t++]=K;a[t++]=I;a[t++]=M;a[t++]=C;a[t++]=D;a[t++]=L;a[t++]=P;a[t++]=W;a[t++]=U}b=0;l=1/24;q=1/24;g=new Float32Array(a.length/3*2);for(c=0;24>c;++c)for(f=0;24>f;++f)g[b++]=l*f,g[b++]=q*c,g[b++]=l*f,g[b++]=q*(c+1),g[b++]=l*(f+1),g[b++]=q*c,g[b++]=l*(f+1),g[b++]=q*c,g[b++]=l*f,g[b++]=q*(c+1),g[b++]=l*(f+1),g[b++]=q*(c+1);a=new Float32Array(a);f=new Float32Array(g);a=O.createVertexBuffer({context:e,typedArray:a,usage:Z.STATIC_DRAW});f=O.createVertexBuffer({context:e,typedArray:f,usage:Z.STATIC_DRAW});this.vertexArray=new aa({context:e,attributes:[{index:this.attributeLocations.position,vertexBuffer:a,componentsPerAttribute:3,componentDatatype:r.FLOAT},{index:this.attributeLocations.textureCoordinates,vertexBuffer:f,componentsPerAttribute:2,componentDatatype:r.FLOAT}]});this._drawCommand.vertexArray=this.vertexArray}k(this.shaderProgram)||(this.shaderProgram=N.fromCache({context:e,vertexShaderSource:H,fragmentShaderSource:J,attributeLocations:this.attributeLocations}),this._drawCommand.shaderProgram=this.shaderProgram);k(this.renderState)||(this.renderState=G.fromCache({blending:{enabled:!0,functionSourceRgb:y.SRC_ALPHA,functionDestinationRgb:y.ONE_MINUS_SRC_ALPHA},depthTest:{enabled:!0,func:y.LESS}}),this._drawCommand.renderState=this.renderState);k(this._texReference)||(this._texNoise1=this._texArr[0],this._texNoise2=this._texArr[1],this._texReference=this._texArr[3]);return this._drawCommand}}}};M.prototype.destroy=function(){var a=this._drawCommand;a.vertexArray=a.vertexArray&&a.vertexArray.destroy();a.shaderProgram=a.shaderProgram&&a.shaderProgram.destroy();this._textureNoise1=this._textureNoise1&&this._textureNoise1.destroy();this._textureNoise2=this._textureNoise2&&this._textureNoise2.destroy();this._textureNoise3=this._textureNoise3&&this._textureNoise3.destroy();this._textureNoise4=this._textureNoise4&&this._textureNoise4.destroy();return destroyObject(this)};return M});F("FeShadersEx/FeFlyLineFS",[],function(){return"\nprecision mediump float;\nvarying float vAlpha;\nvarying vec2  vST;\nvarying float vWidth;\nvarying vec4 vColor;\n\nvoid main()\n{\n    vec3 diffuse \x3d vec3(0.0);\n    float specular \x3d 0.0;\n    float shininess \x3d 1.0;\n    vec3 emission \x3d vec3(0.0);\n    float alpha \x3d 1.0;\n\tfloat glowPower_1 \x3d vColor.w;\n\n\tvec2 st \x3d vST;\n    float glow \x3d glowPower_1 / abs(st.t - 0.5) - (glowPower_1 / 0.5);\n\tvec4 color_0 \x3d vec4(vColor.xyz, vAlpha);\n\n    emission \x3d max(vec3(glow - 1.0 + color_0.rgb), color_0.rgb);\n    alpha \x3d clamp(0.0, 1.0, glow) * color_0.a;\n\n\tgl_FragColor \x3d vec4(diffuse + emission, alpha);\n}"});F("FeShadersEx/FeFlyLineVS",[],function(){return"precision mediump float;\nattribute vec4 v_position;\nattribute vec4 v_prePosition;\nattribute vec4 v_nextPosition;\nattribute vec2 v_alphaAndWidth;\nattribute vec4 v_color;\nvarying float vAlpha;\nvarying vec2  vST;\nvarying float vWidth;\nvarying vec4 vColor;\nuniform mat4 uMVPMatrix;\nuniform mat4 uModelViewRelativeToEye;\nuniform mat4 uProjMatrix;\nuniform mat4 uViewportTransformation;\nuniform mat4 uViewportOrthographic;\nuniform vec3 uCamPos;\nuniform vec2 uCurrentFrustum;\nuniform float uResolutionScale;\nuniform float uIs2D;\nconst float radiusEquator \x3d 6378137.0;\nconst float radiusPolar \x3d 6356752.3;\nvec3 ECEF_TO_2D(in vec3 xyz)\n{\n    float p \x3d sqrt(xyz.x * xyz.x + xyz.y * xyz.y);\n\tfloat theta \x3d atan(xyz.z * radiusEquator,(p * radiusPolar));\n\tfloat eDashSquared \x3d (radiusEquator * radiusEquator - radiusPolar * radiusPolar)/(radiusPolar * radiusPolar);\n\tfloat sin_theta \x3d sin(theta);\n\tfloat cos_theta \x3d cos(theta);\n\tfloat flattening \x3d (radiusEquator - radiusPolar)/radiusEquator;\n\tfloat eccentricitySquared \x3d 2.0 * flattening - flattening * flattening;\n\tfloat latitude \x3d atan((xyz.z + eDashSquared * radiusPolar * sin_theta * sin_theta * sin_theta)/(p - eccentricitySquared * radiusEquator * cos_theta * cos_theta * cos_theta));\n\tfloat longitude \x3d atan(xyz.y,xyz.x);\n\tfloat sin_latitude \x3d sin(latitude);\n\tfloat N \x3d radiusEquator /sqrt(1.0 - eccentricitySquared * sin_latitude * sin_latitude);\n    float h \x3d p/cos(latitude) - N;\n\tlatitude \x3d latitude * radiusEquator;\n\tlongitude \x3d longitude * radiusEquator;\n\treturn vec3(h, longitude, latitude) - uCamPos;\n}\nvec4 eyeToWindowCoordinates(vec4 positionEC)\n{\n\tvec4 q \x3d uProjMatrix * positionEC;\n\tq.xyz /\x3d q.w;\n\tq.xyz \x3d (uViewportTransformation * vec4(q.xyz, 1.0)).xyz;\n\treturn q;\n}\nvoid clipLineSegmentToNearPlane(\n\tvec3 p0,\n\tvec3 p1,\n\tout vec4 positionWC,\n\tout bool clipped,\n\tout bool culledByNearPlane)\n{\n\tculledByNearPlane \x3d false;\n\tclipped \x3d false;\n \n\tvec3 p1ToP0 \x3d p1 - p0;\n\tfloat magnitude \x3d length(p1ToP0);\n\tvec3 direction \x3d normalize(p1ToP0);\n\tfloat endPoint0Distance \x3d  -(uCurrentFrustum.x + p0.z);\n\tfloat denominator \x3d -direction.z;\n \n\tif (endPoint0Distance \x3c 0.0 \x26\x26 abs(denominator) \x3c 0.0000001)\n\t{\n\t\tculledByNearPlane \x3d true;\n\t}\n\telse if (endPoint0Distance \x3c 0.0 \x26\x26 abs(denominator) \x3e 0.0000001)\n\t{\n\t\t// t \x3d (-plane distance - dot(plane normal, ray origin)) / dot(plane normal, ray direction)\n\t\tfloat t \x3d (uCurrentFrustum.x + p0.z) / denominator;\n\t\tif (t \x3c 0.0 || t \x3e magnitude)\n\t\t{\n\t\t\tculledByNearPlane \x3d true;\n\t\t}\n\t\telse \n\t\t{\n\t\t\tp0 \x3d p0 + t * direction;\n\t\t\tclipped \x3d true;\n\t\t}\n\t}\n \n\tpositionWC \x3d eyeToWindowCoordinates(vec4(p0, 1.0));\n}\nbool equalsEpsilon(vec3 left, vec3 right, float epsilon) {\n\treturn all(lessThanEqual(abs(left - right), vec3(epsilon)));\n}\n \nbool equalsEpsilon(vec2 left, vec2 right, float epsilon) {\n\treturn all(lessThanEqual(abs(left - right), vec2(epsilon)));\n}\n \nvec4 getPolylineWindowCoordinates(vec4 position, vec4 previous, vec4 next, float expandDirection, float width, bool usePrevious, out float angle) {\n\tvec4 endPointWC, p0, p1;\n\tbool culledByNearPlane, clipped;\n \n\tvec4 positionEC \x3d uModelViewRelativeToEye * position;\n\tvec4 prevEC \x3d uModelViewRelativeToEye * previous;\n\tvec4 nextEC \x3d uModelViewRelativeToEye * next;\n \n\t// Compute the window coordinates of the points.\n\tvec4 positionWindow \x3d eyeToWindowCoordinates(positionEC);\n\tvec4 previousWindow \x3d eyeToWindowCoordinates(prevEC);\n\tvec4 nextWindow \x3d eyeToWindowCoordinates(nextEC);\n \n\tclipLineSegmentToNearPlane(prevEC.xyz, positionEC.xyz, p0, clipped, culledByNearPlane);\n\tclipLineSegmentToNearPlane(nextEC.xyz, positionEC.xyz, p1, clipped, culledByNearPlane);\n\tclipLineSegmentToNearPlane(positionEC.xyz, usePrevious ? prevEC.xyz : nextEC.xyz, endPointWC, clipped, culledByNearPlane);\n \n\tif (culledByNearPlane)\n\t{\n\t\treturn vec4(0.0, 0.0, 0.0, 1.0);\n\t}\n \n\tvec2 prevWC \x3d normalize(p0.xy - endPointWC.xy);\n\tvec2 nextWC \x3d normalize(p1.xy - endPointWC.xy);\n \n\tfloat expandWidth \x3d width * 0.5;\n\tvec2 direction;\n \n\tif (equalsEpsilon(previous.xyz - position.xyz, vec3(0.0), 0.1) || equalsEpsilon(prevWC, -nextWC, 0.1))\n\t{\n\t\tdirection \x3d vec2(-nextWC.y, nextWC.x);\n\t}\n\telse if (equalsEpsilon(next.xyz - position.xyz, vec3(0.0), 0.1) || clipped)\n\t{\n\t\tdirection \x3d vec2(prevWC.y, -prevWC.x);\n\t}\n\telse \n\t{\n\t\tvec2 normal \x3d vec2(-nextWC.y, nextWC.x);\n\t\tdirection \x3d normalize((nextWC + prevWC) * 0.5);\n\t\tif (dot(direction, normal) \x3c 0.0)\n\t\t{\n\t\t\tdirection \x3d -direction;\n\t\t}\n \n\t\t// The sine of the angle between the two vectors is given by the formula \n\t\t//         |a x b| \x3d |a||b|sin(theta)\n\t\t// which is \n\t\t//     float sinAngle \x3d length(cross(vec3(direction, 0.0), vec3(nextWC, 0.0)));\n\t\t// Because the z components of both vectors are zero, the x and y coordinate will be zero.\n\t\t// Therefore, the sine of the angle is just the z component of the cross product.\n\t\tfloat sinAngle \x3d abs(direction.x * nextWC.y - direction.y * nextWC.x);\n\t\texpandWidth \x3d clamp(expandWidth / sinAngle, 0.0, width * 2.0);\n\t}\n \n\tvec2 offset \x3d direction * expandDirection * expandWidth * uResolutionScale;\n\treturn vec4(endPointWC.xy + offset, -endPointWC.z, 1.0);\n}\nvoid main()\n{\n    vec4 p; \n    vec4 prev; \n    vec4 next; \n    if (uIs2D \x3d\x3d 2.0 || uIs2D \x3d\x3d 1.0) {\n        p \x3d    vec4(ECEF_TO_2D(v_position.xyz), 1.0); \n        prev \x3d  vec4(ECEF_TO_2D(v_prePosition.xyz), 1.0); \n        next \x3d  vec4(ECEF_TO_2D(v_nextPosition.xyz), 1.0); \n    } else { \n        p.xyz \x3d v_position.xyz - uCamPos;\n        p.w \x3d 1.0;\n        prev.xyz \x3d v_prePosition.xyz - uCamPos;\n        prev.w \x3d 1.0;\n        next.xyz \x3d v_nextPosition.xyz - uCamPos;\n        next.w \x3d 1.0;\n    }\n\tfloat expandDir \x3d v_nextPosition.w;\n\tfloat width \x3d v_alphaAndWidth.y;\n\tbool usePrev \x3d v_prePosition.w \x3c 0.0;\n\tfloat vPolylineAngle;\n\tvec4 positionWC \x3d getPolylineWindowCoordinates(p, prev, next, expandDir, width, usePrev, vPolylineAngle);\n    gl_Position \x3d uViewportOrthographic * positionWC;\n\tvAlpha \x3d v_alphaAndWidth.x;\n\tfloat texCoord \x3d v_position.w;\n\tvST \x3d vec2(texCoord, clamp(expandDir, 0.0, 1.0));\n\tvWidth \x3d width;\n\tvColor \x3d v_color;\n}"});F("FeSceneEx/FeFlyLine","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../FeSceneEx/FeDrawCommand ../Renderer/Pass ../Renderer/ShaderProgram ../FeShadersEx/FeFlyLineFS ../FeShadersEx/FeFlyLineVS ../Core/WebGLConstants ../Renderer/RenderState ../Core/Matrix4 ../Core/Matrix3 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Math ../Core/Quaternion ../Core/Color ../Core/CatmullRomSpline ../Core/Cartographic ../Core/HermiteSpline ../Core/GeographicProjection ../Core/WebMercatorProjection".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a){a=b(a,b.EMPTY_OBJECT);this._pass=l.OPAQUE;this._receiveShadows=!1;this._shaderProgram=void 0;this._drawCommand=new g({primitive:this,pass:this._pass,receiveShadows:this._receiveShadows});this._renderState=new d;this._renderState.depthTest.enabled=!0;this._renderState.blending.enabled=!0;this._renderState.blending.functionSourceRgb=p.SRC_ALPHA;this._renderState.blending.functionDestinationRgb=p.ONE_MINUS_SRC_ALPHA;this._needUpdateGeometry=!1;this._indexBuffer=this._alphaBuffer=this._colorBuffer=this._nextPositionBuffer=this._prePositionBuffer=this._positionArr=this._positionBuffer=this._vao=void 0;this._elementNum=0;this._posArrReady=!1;this._camPos=new r;this._uViewportOrthographic=this._uResolutionScale=this._uCurrentFrustum=this._uViewportTransformation=this._uProjMatrix=this._uModelViewRelativeToEye=this._uCamPos=this._uMVPMat=void 0;this._centerLineParamArr=[];this._speed=b(a.speed,1);this._defaultLineWidth=b(a.width,10);this._defaultLineColor=b(a.color,A.fromCssColorString("rgba(255.0,255.0,255.0,1.0)"));this._defaultGlowPower=b(a.glowPower,.1);this._fact=b(a.fact,.5);this._pointNum=b(a.pointNum,200);this._onOrOff=b(a.onOrOff,!0);this._times=b(a.times,void 0);this._show=b(a.show,!0)}function I(a,b){var c,d;b?(c=a.createShader(a.VERTEX_SHADER),d=h):(c=a.createShader(a.FRAGMENT_SHADER),d=e);a.shaderSource(c,d);a.compileShader(c);if(a.getShaderParameter(c,a.COMPILE_STATUS))return c;c=a.getShaderInfoLog(c);alert(c)}function H(a,b,c,e){var f=a._currentRenderState,g=a._currentPassState;a._currentRenderState=b;a._currentPassState=c;d.partialApply(a._gl,f,b,g,c,e)}f(C.prototype,{times:{get:function(){return this._times},set:function(a){this._times=a}},onOrOff:{get:function(){return this._onOrOff},set:function(a){this._onOrOff=a}},show:{get:function(){return this._show},set:function(a){this._show=a}}});C.prototype.dirty=function(){this._needUpdateGeometry=!0};C.prototype.add=function(c){if(a(c.positions)){var d={},e;var f=c.positions;if(2!==f.length)console.info("positions length must equal two"),e=void 0;else{e=f[0];2===e.length&&(e[2]=0);e=r.fromDegrees(e[0],e[1],e[2]);f=f[1];2===f.length&&(f[2]=0);var f=r.fromDegrees(f[0],f[1],f[2]),g=r.distance(e,f),h=b(c.fact,this._fact),g=a(c.height)?c.height:.5*g*h,h=new z({times:[0,1],points:[e,f]}),h=x.fromCartesian(h.evaluate(.5));e=D.createNaturalCubic({times:[0,.5,1],points:[e,r.fromRadians(h.longitude,h.latitude,g),f]});for(var f=[],h=b(c.pointNum,this._pointNum),k=0;k<h;++k)g=e.evaluate(1*k/h),f.push(g);e=f}d.pointArr=e;d.flyLineNum=e.length;d.curFlyIndex=0;d.lastFlyIndex=0;d.lineWidth=a(c.width)?c.width:this._defaultLineWidth;d.lineColor=a(c.color)?c.color:this._defaultLineColor;d.glowPower=a(c.glowPower)?c.glowPower:this._defaultGlowPower;d.speed=a(c.speed)?c.speed:this._speed;this._centerLineParamArr.push(d)}};C.prototype.update=function(a){if(this.show){for(var b=this._centerLineParamArr.length,c=0;c<b;c++)this._centerLineParamArr[c].curFlyIndex+=this._centerLineParamArr[c].speed+1,this._centerLineParamArr[c].curFlyIndex>this._centerLineParamArr[c].pointArr.length-1+this._centerLineParamArr[c].flyLineNum&&(this._centerLineParamArr[c].curFlyIndex=0);r.clone(a.camera.position,this._camPos);a.commandList.push(this._drawCommand)}};var J;"undefined"!==typeof WebGLRenderingContext&&(J=[p.BACK]);C.prototype.destroy=function(){this._centerLineParamArr=[];return k(this)};C.prototype.draw=function(b,c){if(this._needUpdateGeometry){if(b.vertexArrayObject){this._vao=b.glCreateVertexArray();b.glBindVertexArray(this._vao);for(var d=new r,e=new r,f=new r,g=new r,h=[],k=[],l=[],m=[],p=[],t=0;t<this._centerLineParamArr.length;t++)for(var w=0;w<this._centerLineParamArr[t].pointArr.length;w++){0===w?(r.subtract(this._centerLineParamArr[t].pointArr[0],this._centerLineParamArr[t].pointArr[1],d),r.add(this._centerLineParamArr[t].pointArr[0],d,d)):d=this._centerLineParamArr[t].pointArr[w-1];r.clone(d,e);r.clone(this._centerLineParamArr[t].pointArr[w],f);var u=this._centerLineParamArr[t].pointArr.length;w===u-1?(r.subtract(this._centerLineParamArr[t].pointArr[u-1],this._centerLineParamArr[t].pointArr[u-2],d),r.add(this._centerLineParamArr[t].pointArr[u-1],d,d)):d=this._centerLineParamArr[t].pointArr[w+1];r.clone(d,g);for(var u=w===u-1?2:4,v=this._centerLineParamArr[t].lineColor,y=this._centerLineParamArr[t].glowPower,z=0===w?2:0;z<u;++z){var A=0>z-2?-1:1,C=w/(this._centerLineParamArr[t].pointArr.length-1),B=z%2*2-1;h.push(e.x);h.push(e.y);h.push(e.z);h.push(A);k.push(f.x);k.push(f.y);k.push(f.z);k.push(C);l.push(g.x);l.push(g.y);l.push(g.z);l.push(B);m.push(0);m.push(0);p.push(v.red);p.push(v.green);p.push(v.blue);p.push(y)}}d=new Float32Array(h);k=new Float32Array(k);l=new Float32Array(l);m=new Float32Array(m);p=new Float32Array(p);e=b._gl;this._positionBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._positionBuffer);e.bufferData(e.ARRAY_BUFFER,k,e.STATIC_DRAW);this._prePositionBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._prePositionBuffer);e.bufferData(e.ARRAY_BUFFER,d,e.STATIC_DRAW);this._nextPositionBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._nextPositionBuffer);e.bufferData(e.ARRAY_BUFFER,l,e.STATIC_DRAW);this._alphaBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._alphaBuffer);e.bufferData(e.ARRAY_BUFFER,m,e.STATIC_DRAW);this._colorBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer);e.bufferData(e.ARRAY_BUFFER,p,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);m=0;p=[];for(l=0;l<this._centerLineParamArr.length;l++)for(k=0;k<this._centerLineParamArr[l].pointArr.length-1;k++)p.push(m,m+2,m+1),p.push(m+1,m+2,m+3),m+=4;m=b._gl;p=new Uint32Array(p);this._elementNum=p.length;this._indexBuffer=m.createBuffer();m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,this._indexBuffer);m.bufferData(m.ELEMENT_ARRAY_BUFFER,p,m.STATIC_DRAW);m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,null);b.glBindVertexArray(null)}this._needUpdateGeometry=!1}if(a(this._vao)&&(a(this._shaderProgram)||(p=b._gl,m=I(p,!0),l=I(p,!1),this._shaderProgram=p.createProgram(),p.attachShader(this._shaderProgram,m),p.attachShader(this._shaderProgram,l),p.linkProgram(this._shaderProgram),p.getProgramParameter(this._shaderProgram,p.LINK_STATUS)||(p=p.getProgramInfoLog(this._shaderProgram),alert(p),this._shaderProgram=void 0),p=b._gl,this._uMVPMat=p.getUniformLocation(this._shaderProgram,"uMVPMatrix"),this._uCamPos=p.getUniformLocation(this._shaderProgram,"uCamPos"),this._uModelViewRelativeToEye=p.getUniformLocation(this._shaderProgram,"uModelViewRelativeToEye"),this._uProjMatrix=p.getUniformLocation(this._shaderProgram,"uProjMatrix"),this._uViewportTransformation=p.getUniformLocation(this._shaderProgram,"uViewportTransformation"),this._uCurrentFrustum=p.getUniformLocation(this._shaderProgram,"uCurrentFrustum"),this._uResolutionScale=p.getUniformLocation(this._shaderProgram,"uResolutionScale"),this._uViewportOrthographic=p.getUniformLocation(this._shaderProgram,"uViewportOrthographic"),this._uIs2D=p.getUniformLocation(this._shaderProgram,"uIs2D")),p=b._gl,a(p))){p.useProgram(this._shaderProgram);m=b._us;l=b._gl;a(this._uMVPMat)&&(d=m.viewProjection,k=new Float32Array(16),e=new r(1,1,1),e=q.fromScale(e),f=new r(0,0,6378137),g=q.fromTranslation(f),f=new q,q.multiply(g,e,f),e=new q,q.multiply(d,f,e),q.toArray(d,k),l.uniformMatrix4fv(this._uMVPMat,!1,k));a(this._uCamPos)&&l.uniform3f(this._uCamPos,m._cameraPosition.x,m._cameraPosition.y,m._cameraPosition.z);a(this._uModelViewRelativeToEye)&&(d=m.modelViewRelativeToEye,k=new Float32Array(16),q.toArray(d,k),l.uniformMatrix4fv(this._uModelViewRelativeToEye,!1,k));a(this._uProjMatrix)&&(d=m.projection,k=new Float32Array(16),q.toArray(d,k),l.uniformMatrix4fv(this._uProjMatrix,!1,k));a(this._uViewportTransformation)&&(d=m.viewportTransformation,k=new Float32Array(16),q.toArray(d,k),l.uniformMatrix4fv(this._uViewportTransformation,!1,k));a(this._uCurrentFrustum)&&(k=m.currentFrustum,l.uniform2f(this._uCurrentFrustum,k.x,k.y));a(this._uResolutionScale)&&(k=m.resolutionScale,l.uniform1f(this._uResolutionScale,k));a(this._uViewportOrthographic)&&(d=m.viewportOrthographic,k=new Float32Array(16),q.toArray(d,k),l.uniformMatrix4fv(this._uViewportOrthographic,!1,k));a(this._uIs2D)&&l.uniform1f(this._uIs2D,m._mode);m=[];for(l=0;l<this._centerLineParamArr.length;l++)for(k=this._centerLineParamArr[l].curFlyIndex,d=this._centerLineParamArr[l].flyLineNum,e=this._centerLineParamArr[l].lineWidth,f=0;f<this._centerLineParamArr[l].pointArr.length;f++)for(f>k?g=0:(g=k-f,h=parseInt(d/2),g>h&&(g=d-g),g/=h,0>=g&&(g=0),1<=g&&(g=1)),h=e,t=f===this._centerLineParamArr[l].pointArr.length-1?2:4,w=0===f?2:0;w<t;++w)m.push(g),m.push(h);m=new Float32Array(m);p.bindBuffer(p.ARRAY_BUFFER,this._alphaBuffer);p.bufferSubData(p.ARRAY_BUFFER,0,m);p.bindBuffer(p.ARRAY_BUFFER,null);m=c.framebuffer;if(m!==b._currentFramebuffer){b._currentFramebuffer=m;l=J;if(a(m)){m._bind();if(b.validateFramebuffer&&(l=b._gl,k=l.checkFramebufferStatus(l.FRAMEBUFFER),k!==l.FRAMEBUFFER_COMPLETE)){var G;switch(k){case l.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:G="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case l.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:G="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case l.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:G="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case l.FRAMEBUFFER_UNSUPPORTED:G="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new DeveloperError(G);}l=m._getActiveColorAttachments()}else G=b._gl,G.bindFramebuffer(G.FRAMEBUFFER,null);b.drawBuffers&&b.glDrawBuffers(l)}G=b._currentRenderState;m=b._currentPassState;H(b,this._renderState,c,!1);b.glBindVertexArray(this._vao);l=p.getAttribLocation(this._shaderProgram,"v_position");p.enableVertexAttribArray(l);p.bindBuffer(p.ARRAY_BUFFER,this._positionBuffer);p.vertexAttribPointer(l,4,p.FLOAT,!1,0,0);l=p.getAttribLocation(this._shaderProgram,"v_prePosition");p.enableVertexAttribArray(l);p.bindBuffer(p.ARRAY_BUFFER,this._prePositionBuffer);p.vertexAttribPointer(l,4,p.FLOAT,!1,0,0);l=p.getAttribLocation(this._shaderProgram,"v_nextPosition");p.enableVertexAttribArray(l);p.bindBuffer(p.ARRAY_BUFFER,this._nextPositionBuffer);p.vertexAttribPointer(l,4,p.FLOAT,!1,0,0);l=p.getAttribLocation(this._shaderProgram,"v_alphaAndWidth");p.enableVertexAttribArray(l);p.bindBuffer(p.ARRAY_BUFFER,this._alphaBuffer);p.vertexAttribPointer(l,2,p.FLOAT,!1,0,0);l=p.getAttribLocation(this._shaderProgram,"v_color");p.enableVertexAttribArray(l);p.bindBuffer(p.ARRAY_BUFFER,this._colorBuffer);p.vertexAttribPointer(l,4,p.FLOAT,!1,0,0);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,this._indexBuffer);p.drawElements(p.TRIANGLES,this._elementNum,p.UNSIGNED_INT,0);p.bindBuffer(p.ARRAY_BUFFER,null);p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,null);b.glBindVertexArray(null);p.bindTexture(p.TEXTURE_2D,null);H(b,G,m,!1)}};return C});F("FeSceneEx/FeGeometry",["../Core/defineProperties"],function(b){function a(){this._textureArray=this._indexArray=this._vertexArray=void 0}b(a.prototype,{vertexArray:{get:function(){return this._vertexArray},set:function(a){this._vertexArray=a}},indexArray:{get:function(){return this._indexArray},set:function(a){this._indexArray=a}},textureArray:{get:function(){return this._textureArray},set:function(a){this._textureArray=a}}});return a});F("FeSceneEx/FeGeometryCreator","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Ellipsoid ../Core/Geometry ../Core/GeometryAttribute ../Core/GeometryAttributes ../Core/GeometryInstance ../Core/GeometryPipeline ../Core/IndexDatatype ../Core/Math ../Core/Matrix3 ../Core/PolygonPipeline ../Core/PrimitiveType ../Core/Quaternion ../Core/Rectangle ../Core/RectangleGeometryLibrary ../Core/VertexFormat".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I){function H(a){a=m(a,m.EMPTY_OBJECT);var b=a.feGeometry;e(b)&&(this._feGeometry=b,this._ellipsoid=d.clone(m(a.ellipsoid,d.WGS84)),this._vertexFormat=I.clone(m(a.vertexFormat,I.DEFAULT)),this._workerName="createFeGeometry",this._primitiveType=m(a.primitiveType,D.TRIANGLES))}H.createGeometry=function(a){var c=a._vertexFormat,d=new q({attributes:new r,primitiveType:a._primitiveType});d.attributes.position=new t({componentDatatype:l.DOUBLE,componentsPerAttribute:3,values:a._feGeometry._vertexArray});c.st&&(d.attributes.st=new t({componentDatatype:l.FLOAT,componentsPerAttribute:2,values:a._feGeometry._textureArray}));d.indices=a._feGeometry._indexArray;a=b.fromVertices(d.attributes.position.values,f.ZERO,3);return new q({attributes:d.attributes,indices:d.indices,primitiveType:d.primitiveType,boundingSphere:a})};return H});F("FeSceneEx/FePlaceMarkGroup","../Core/defaultValue ../Core/defineProperties ../Core/defined ../Scene/BillboardCollection ../Scene/LabelCollection ../DataSources/Property ../Core/Color ../Core/Cartesian3 ../Scene/HeightReference ../Core/Cartesian2 ../Scene/HorizontalOrigin ../Scene/VerticalOrigin ../Scene/SceneMode ../Core/NearFarScalar ../Core/BoundingRectangle ../Core/DistanceDisplayCondition ../Core/DefaultProxy ../Core/Rectangle ../ThirdParty/when ../Scene/LabelStyle ../Core/BoundingSphere ../Core/Ellipsoid ../Core/Intersect ../Core/EllipsoidTerrainProvider ../Core/Ray ../Core/Cartographic ./FePlaceMarkGroupManager".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a){a=b(a,b.EMPTY_OBJECT);this._fePlaceMarkGroupManager=a.fePlaceMarkGroupManager;this._name=this._fePlaceMarkGroupManager._name;this._proxy=this._fePlaceMarkGroupManager._proxy;this._level=a.level;this._minLat=a.minLat;this._maxLat=a.maxLat;this._minLon=a.minLon;this._maxLon=a.maxLon;this._minRange=a.minRange;this._maxRange=a.maxRange;this._center=a.center;this._isLeaf=a.isLeaf;this._boundingSphere=a.boundingSphere;this._entityArray=this._childArray=void 0;this._frameNumber=-1;this._labelCollection=this._billboardCollection=void 0;this._isEmpty=!1;this._url=this._fePlaceMarkGroupManager._url;this._loading=!1}function G(a){var b=z.defer(),c=a._fePlaceMarkGroupManager;if(f(c)){var d=a._minLon+","+a._minLat+","+a._maxLon+","+a._maxLat,c=c._url+"?request\x3dgetfeature\x26version\x3d1.0.0\x26service\x3dwfs",c=c+("\x26typename\x3d"+a._name+"\x26bbox\x3d");$.ajax({url:c+d,dataType:"xml",cache:"false",async:!0,success:function(a){b.resolve(a)},error:function(){b.reject()}});a._loading=!0}return b.promise}var E=new m(.165,.165,.165,.8),L=new p(7,5),K=new p(10),P=e.ZERO,N=h.NONE,O=d.LEFT,F=q.CENTER;w.prototype.addEntity=function(a){if(f(a._spherePos)&&f(this._fePlaceMarkGroupManager)&&f(a.visibleLevel)){var b=a.visibleLevel;if(!(0>b)){var c=!1;this._level==b&&(c=!0);var d=!1;a._spherePos.x>=this._minLon&&a._spherePos.x<=this._maxLon&&a._spherePos.y>=this._minLat&&a._spherePos.y<=this._maxLat&&(d=!0);if(d)if(c)f(this._entityArray)||(this._entityArray=[]),this._entityArray.push(a);else if(b>this._level&&f(this._childArray))for(b=0;b<this._childArray.length;b++)this._childArray[b].addEntity(a)}}};w.prototype.destroy=function(){this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy();this._labelCollection=this._labelCollection&&this._labelCollection.destroy();return destroyObject(this)};w.prototype.update=function(a){if(f(this._fePlaceMarkGroupManager)){var b=a.camera.position,c=!1,c=A.fromDegrees(this._minLon,this._minLat,this._maxLon,this._maxLat),d=new Cesium.Cartesian3,l=new Cesium.Cartesian3,m=new Cesium.Cartesian2,p=new Cesium.Rectangle,q=new Cesium.Rectangle,r=void 0,w=this._fePlaceMarkGroupManager._feLodPlaceMark._scene;if(a.mode===t.SCENE3D)r=a.camera.computeViewRectangle();else{var r=w.globe.ellipsoid,u=w.canvas.width,w=w.canvas.height;m.x=0;m.y=0;d=a.camera.pickEllipsoid(m,r,d);if(!Cesium.defined(d))return;d=H.fromCartesian(d);m.x=u;m.y=w;l=a.camera.pickEllipsoid(m,r,l);if(!Cesium.defined(l))return;l=H.fromCartesian(l);p.west=d.longitude;p.north=d.latitude;p.east=l.longitude;p.south=l.latitude;r=Cesium.Rectangle.clone(p,q)}if(f(r)&&(c=A.intersection(c,r),f(c))){var c=!0,p=this._fePlaceMarkGroupManager._name,q=p.indexOf(":"),v=p.substring(0,q),p=a.camera._positionCartographic.height;e.distance(b,this._center);if(p<=this._maxRange&&p>=this._minRange&&c)if(f(this._billboardCollection)&&f(this._labelCollection))this._frameNumber=a.frameNumber,this._billboardCollection.update(a),this._labelCollection.update(a),a=this._level.toString()+this._minLat.toString()+this._maxLat.toString()+this._minLon.toString()+this._maxLon.toString(),this._fePlaceMarkGroupManager._placeMarkGroupMap.has(a)||this._fePlaceMarkGroupManager._placeMarkGroupMap.set(a,this);else if(this._isLeaf&&!this._isEmpty&&!this._loading){var y=this;z(G(y)).then(function(a){var b=[];a=a.getElementsByTagName("gml:featureMember");for(var c=a.length,d=v+":NAME",l=v+":Name",m=v+":name",p=0;p<c;++p){var q;if(a[p].getElementsByTagName(d)&&0<a[p].getElementsByTagName(d).length)q=a[p].getElementsByTagName(d);else if(a[p].getElementsByTagName(l)&&0<a[p].getElementsByTagName(l).length)q=a[p].getElementsByTagName(l);else if(a[p].getElementsByTagName(m)&&0<a[p].getElementsByTagName(m).length)q=a[p].getElementsByTagName(m);else{console.log("\u5339\u914d\u5b57\u6bb5\u540d\u5931\u8d25 at FePlaceMarkGroup.update");return}q=q[0].firstChild.nodeValue;var r=a[p].getElementsByTagName("gml:coordinates")[0].firstChild.nodeValue,t=r.indexOf(","),w=r.lastIndexOf(","),u=parseFloat(r.substring(0,t)),t=parseFloat(r.substring(t+1,w)),r=parseFloat(r.substring(w+1));b.push({position:{x:u,y:t,z:r},placeName:q})}if(f(b)&&0<b.length){a=b.length;c=y._fePlaceMarkGroupManager;if(f(c)&&f(c._feLodPlaceMark))for(y._billboardCollection=new k({scene:c._feLodPlaceMark._scene}),d=0;d<a;d++)l=y._billboardCollection.add(),l.image=c._image,m=b[d],p=c._feLodPlaceMark._scene,c._feLodPlaceMark._scene.globe.terrainProvider instanceof C?(l.disableDepthTestDistance=0,l.position=e.fromDegrees(m.position.x,m.position.y,m.position.z),!0===p.globe.depthTestAgainstTerrain&&(l.disableDepthTestDistance=Number.MAX_VALUE)):(q=e.fromDegrees(m.position.x,m.position.y,2E5),u=e.fromDegrees(m.position.x,m.position.y,-2E5),u=e.subtract(u,q,u),u=e.normalize(u,u),q=new I(q,u),p=p.globe.pick(q,p),f(p)||(p=e.fromDegrees(m.position.x,m.position.y,10)),p=H.fromCartesian(p).height,l.disableDepthTestDistance=0,l.position=e.fromDegrees(m.position.x,m.position.y,p)),l.heightReference=h.CLAMP_TO_GROUND;a=b.length;c=y._fePlaceMarkGroupManager;if(f(c)&&f(c._feLodPlaceMark))for(y._labelCollection=new g({scene:c._feLodPlaceMark._scene}),d=0;d<a;d++)l=b[d],m=y._labelCollection.add(),m.show=!0,p=c._feLodPlaceMark._scene,c._feLodPlaceMark._scene.globe.terrainProvider instanceof C?(m.disableDepthTestDistance=0,m.position=e.fromDegrees(l.position.x,l.position.y,l.position.z),!0===p.globe.depthTestAgainstTerrain&&(m.disableDepthTestDistance=Number.MAX_VALUE)):(q=e.fromDegrees(l.position.x,l.position.y,2E4),u=e.fromDegrees(l.position.x,l.position.y,0),u=e.subtract(u,q,u),u=e.normalize(u,u),q=new I(q,u),p=p.globe.pick(q,p),f(p)||(p=e.fromDegrees(l.position.x,l.position.y,10)),p=H.fromCartesian(p).height,m.disableDepthTestDistance=0,m.position=e.fromDegrees(l.position.x,l.position.y,p)),m.text=l.placeName,m.scale=1,m.font=c._font,m.style=c._style,m.fillColor=c._fillColor,m.outlineColor=c._outlineColor,m.outlineWidth=c._strokeWidth,m.showBackground=!1,m.backgroundColor=E,m.backgroundPadding=L,m.pixelOffset=K,m.eyeOffset=P,m.heightReference=N,m.horizontalOrigin=O,m.verticalOrigin=F}else y._isEmpty=!0;y._loading=!1})}else if(f(this._childArray))for(b=0;b<this._childArray.length;b++)this._childArray[b].update(a)}}};w.prototype.trim=function(){f(this._labelCollection)&&(this._labelCollection=this._labelCollection.destroy());f(this._billboardCollection)&&(this._billboardCollection=this._billboardCollection.destroy())};return w});F("FeSceneEx/FePlaceMarkGroupManager","../Core/defined ../Core/defaultValue ../Scene/BillboardCollection ./FeLodPlaceMark ./FePlaceMarkGroup ../Core/Cartesian3 ../Core/Math ../ThirdParty/when ../Core/BoundingSphere ../Core/Color ../Core/CullingVolume ../Core/DefaultProxy ../Core/defineProperties".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(b){b=a(b,a.EMPTY_OBJECT);this._feLodPlaceMark=b.feLodPlaceMark;this._url=a(b.dataSource.url,"");this._proxy=a(b.dataSource.proxy,"");this._minRange=a(b.dataSource.minHeight,0);this._maxRange=a(b.dataSource.maxHeight,1E3);this._name=a(b.dataSource.name,"");this._image=a(b.dataSource.image,"");this._lodLevel=a(b.dataSource.level,3);this._font=a(b.dataSource.font,"32px sans-serif");this._fillColor=a(b.dataSource.fillColor,p.fromCssColorString("rgba(0.0,255,255,1.0)"));this._outlineColor=a(b.dataSource.outlineColor,p.fromCssColorString("rgba(255.0,255,255,1.0)"));var c=a(b.dataSource.style,"fill");this._style="outline"==c?1:"fill_and_outline"==c?2:0;this._strokeWidth=a(b.dataSource.strokeWidth,1);this._minLat=-90;this._maxLat=90;this._minLon=-180;this._maxLon=180;this._maxLodLevel=2;this._startLodLevel=0;this._fePlaceMarkGroup=void 0;this._rangeScale=1.1;this._placeMarkGroupMap=new Map;this._cullingVolume=new d}function c(a,b,c,d,e){var f=new l(b,e,0),g=new l;l.subtract(l.fromDegrees(f.x,f.y,0),a,g);f=new l(c,e,0);e=new l;l.subtract(l.fromDegrees(f.x,f.y,0),a,e);f=new l(c,d,0);c=new l;l.subtract(l.fromDegrees(f.x,f.y,0),a,c);d=new l(b,d,0);b=new l;l.subtract(l.fromDegrees(d.x,d.y,0),a,b);d=[];d.push(g);d.push(e);d.push(c);d.push(b);g=h.fromPoints(d);l.add(g.center,a,g.center);return g}function u(a){if(b(a)&&b(a._fePlaceMarkGroupManager)&&a._level<a._fePlaceMarkGroupManager._maxLodLevel&&!b(a._childArray)){a._childArray=Array(4);var d=(a._maxLat+a._minLat)/2,e=(a._maxLon+a._minLon)/2,f=!1,h=a._level+1;h==a._fePlaceMarkGroupManager._maxLodLevel&&(f=!0);for(var k=0;4>k;k++){switch(k){case 0:var m=new l((a._minLon+e)/2,(d+a._maxLat)/2,0),m=l.fromDegrees(m.x,m.y,0),p=a._minRange,q=a._maxRange,r=a._minLon,t=e,y=d,E=a._maxLat,A=c(m,r,t,y,E);a._childArray[k]=new g({fePlaceMarkGroupManager:a._fePlaceMarkGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f});break;case 1:m=new l((e+a._maxLon)/2,(d+a._maxLat)/2,0);m=l.fromDegrees(m.x,m.y,0);p=a._minRange;q=a._maxRange;r=e;t=a._maxLon;y=d;E=a._maxLat;A=c(m,r,t,y,E);a._childArray[k]=new g({fePlaceMarkGroupManager:a._fePlaceMarkGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f});break;case 2:m=new l((a._minLon+e)/2,(a._minLat+d)/2,0);m=l.fromDegrees(m.x,m.y,0);p=a._minRange;q=a._maxRange;r=a._minLon;t=e;y=a._minLat;E=d;A=c(m,r,t,y,E);a._childArray[k]=new g({fePlaceMarkGroupManager:a._fePlaceMarkGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f});break;case 3:m=new l((e+a._maxLon)/2,(a._minLat+d)/2,0),m=l.fromDegrees(m.x,m.y,0),p=a._minRange,q=a._maxRange,r=e,t=a._maxLon,y=a._minLat,E=d,A=c(m,r,t,y,E),a._childArray[k]=new g({fePlaceMarkGroupManager:a._fePlaceMarkGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f})}u(a._childArray[k])}}}function y(a){var b=e.defer();$.ajax({url:a._url+"?service\x3dwfs\x26request\x3dgetcapabilities",dataType:"xml",cache:!1,async:!0,success:function(a){b.resolve(a)},error:function(){b.reject()}});return b.promise}r.prototype.createPlaceMarkGroup=function(){var a=e.defer();this._maxLodLevel=this._lodLevel;var b=y(this),d=this;e(b).then(function(b){b.getElementsByTagName("FeatureTypeList");b=b.getElementsByTagName("FeatureType");for(var e=d._name,e=e.split(":")[1],f=b.length,k=0;k<f;++k){var m=b[k].getElementsByTagName("Name")[0].firstChild.nodeValue;if(e==m){e=b[k].lastChild;b=e.childNodes[0].firstChild.nodeValue;e=e.childNodes[1].firstChild.nodeValue;f=b.indexOf(" ");d._minLon=parseFloat(b.substring(0,f));d._minLat=parseFloat(b.substring(f+1));f=e.indexOf(" ");d._maxLon=parseFloat(e.substring(0,f));d._maxLat=parseFloat(e.substring(f+1));break}}b=new l((d._minLon+d._maxLon)/2,(d._minLat+d._maxLat)/2,0);b=l.fromDegrees(b.x,b.y,0);e=new h;h.expand(e,b);e=c(b,d._minLon,d._maxLon,d._minLat,d._maxLat);d._fePlaceMarkGroup=new g({fePlaceMarkGroupManager:d,minLon:d._minLon,maxLon:d._maxLon,minLat:d._minLat,maxLat:d._maxLat,minRange:d._minRange,maxRange:d._maxRange,center:b,boundingSphere:e,level:0});u(d._fePlaceMarkGroup);a.resolve()});return a.promise};r.prototype.trim=function(a){if(b(this._placeMarkGroupMap)&&0<this._placeMarkGroupMap.size){var c=a.frameNumber,d=[];this._placeMarkGroupMap.forEach(function(a,e,f){b(a)&&500<c-a._frameNumber&&(a.trim(),d.push(e))});for(a=0;a<d.length;a++)this._placeMarkGroupMap["delete"](d[a])}};r.prototype.destroy=function(){if(b(this._placeMarkGroupMap)&&0<this._placeMarkGroupMap.size){var a=[];this._placeMarkGroupMap.forEach(function(a,c,d){b(a)&&b(a)&&a.trim()});for(var c=0;c<a.length;c++)this._placeMarkGroupMap["delete"](a[c])}};r.prototype.updateCullingVolume=function(a){a=a.camera;var b=a.positionWC.clone();l.normalize(b,b);l.multiplyByScalar(b,-1,b);var c=new l(0,0,1),d=new l;l.cross(c,b,d);l.normalize(d,d);this._cullingVolume=a.frustum.clone().computeCullingVolume(a.positionWC,b,d)};r.prototype.update=function(a){b(this._fePlaceMarkGroup)&&(this.trim(a),this.updateCullingVolume(a),this._fePlaceMarkGroup.update(a))};return r});F("FeSceneEx/FeLodPlaceMark","../Core/defined ../ThirdParty/when ../Core/defaultValue ../Scene/BillboardCollection ../Core/Color ../Core/Cartesian3 ../Scene/HeightReference ../Core/Cartesian2 ../Scene/HorizontalOrigin ../Scene/VerticalOrigin ../Core/NearFarScalar ../DataSources/BoundingSphereState ../DataSources/Property ../Core/BoundingRectangle ../Core/DistanceDisplayCondition ../Core/defineProperties ../Core/destroyObject ./FePlaceMarkGroupManager".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(a){a=f(a,f.EMPTY_OBJECT);this.map=a.map;this._scene=this.map.scene;this._show=f(a.show,!0);this._dataSourceArray=[];this._fePlaceMarkGroupManagerArray=[]}new l;new g;new l;new e;new d;new d;new d;new r;new c;u(z.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}}});z.prototype.addDataSource=function(a){if(!b(a))throw new DeveloperError("dataSource is required.");this._dataSourceArray.push(a)};z.prototype.destroy=function(){if(0<this._fePlaceMarkGroupManagerArray.length)for(var a=0;a<this._fePlaceMarkGroupManagerArray.length;a++)this._fePlaceMarkGroupManagerArray[a].destroy();return y(this)};z.prototype.setVisible=function(a){this._show=a};z.prototype.getVisible=function(){return this._show};z.prototype.update=function(c){if(this._show){if(0<this._dataSourceArray.length){var d=this._dataSourceArray.pop();if(b(d)){var e=new A({feLodPlaceMark:this,dataSource:d}),f=this;a(e.createPlaceMarkGroup()).then(function(){f._fePlaceMarkGroupManagerArray.push(e)})}}if(0<this._fePlaceMarkGroupManagerArray.length)for(d=0;d<this._fePlaceMarkGroupManagerArray.length;d++)this._fePlaceMarkGroupManagerArray[d].update(c)}};return z});F("FeSceneEx/FeVecLineGroup","../Core/defaultValue ../Core/defineProperties ../Core/defined ../Scene/BillboardCollection ../Scene/LabelCollection ../DataSources/Property ../Core/Color ../Core/Cartesian3 ../Scene/HeightReference ../Core/Cartesian2 ../Scene/HorizontalOrigin ../Scene/VerticalOrigin ../Scene/SceneMode ../Core/NearFarScalar ../Core/BoundingRectangle ../Core/DistanceDisplayCondition ../Core/DefaultProxy ../Core/Rectangle ../ThirdParty/when ../Scene/LabelStyle ../Core/BoundingSphere ../Core/Ellipsoid ../Core/Intersect ../Core/EllipsoidTerrainProvider ../Core/Ray ../Core/Cartographic ./FeVecLineGroupManager".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a){a=b(a,b.EMPTY_OBJECT);this._feVecLineGroupManager=a.feVecLineGroupManager;this._name=this._feVecLineGroupManager._name;this._level=a.level;this._minLat=a.minLat;this._maxLat=a.maxLat;this._minLon=a.minLon;this._maxLon=a.maxLon;this._minRange=a.minRange;this._maxRange=a.maxRange;this._center=a.center;this._isLeaf=a.isLeaf;this._boundingSphere=a.boundingSphere;this._entityArray=this._childArray=void 0;this._frameNumber=-1;this._vecLineInstances=[];this.curPrimitiveLine=void 0;this._isEmpty=!1;this._url=this._feVecLineGroupManager._url;this._loading=!1}function G(a){var b=z.defer(),c=a._feVecLineGroupManager;if(f(c)){var d=a._minLon+","+a._minLat+","+a._maxLon+","+a._maxLat,c=c._url+"?request\x3dgetfeature\x26version\x3d1.0.0\x26service\x3dwfs",c=c+("\x26typename\x3d"+a._name+"\x26bbox\x3d");$.ajax({url:c+d,dataType:"xml",cache:"false",async:!0,success:function(a){b.resolve(a)},error:function(){b.reject()}});a._loading=!0}return b.promise}function E(a,b){var c=b.length,d=a._feVecLineGroupManager;if(f(d)&&f(d._feLodVecLine)){for(var e=0;e<c;e++){for(var g=b[e].posString.replace(/\s/g,",").split(","),h=[],k=0;k<g.length;k+=1)h.push(parseFloat(g[k]));g=new Cesium.Cartesian3.fromDegreesArray(h);g=new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:g,width:d._width,vertexFormat:Cesium.PolylineMaterialAppearance.VERTEX_FORMAT}),attributes:{distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a._minRange,a._maxRange)},id:"GroundPolylineGeometry"});a._vecLineInstances.push(g)}a.curPrimitiveLine=new Cesium.GroundPolylinePrimitive({geometryInstances:a._vecLineInstances,appearance:new Cesium.PolylineMaterialAppearance({material:new Cesium.Material({fabric:{type:"PolylineOutline",uniforms:{color:d._color,outlineWidth:0}}})}),asynchronous:!0,allowPicking:!1,show:d._show});a.curPrimitiveLine.readyPromise.then(function(a){--d.waitPrimitiveNumber;0==d.waitPrimitiveNumber&&d.allDataDeferred.resolve()});d.map.scene.primitives.add(a.curPrimitiveLine);d._vecLinePrimitives.push(a.curPrimitiveLine)}}new m(.165,.165,.165,.8);new p(7,5);new p(10);w.prototype.destroy=function(){var a=this._feVecLineGroupManager;if(a._vecLinePrimitives.length){for(var b=0;b<a._vecLinePrimitives.length;++b)a.map.scene.primitives.remove(a._vecLinePrimitives[b]);a._vecLinePrimitives=[]}};w.prototype.update=function(a){if(f(this._feVecLineGroupManager)){var b=a.camera.position,c=A.fromDegrees(this._minLon,this._minLat,this._maxLon,this._maxLat),d=new Cesium.Cartesian3,g=new Cesium.Cartesian3,h=new Cesium.Cartesian2,k=new Cesium.Rectangle,l=new Cesium.Rectangle,m=void 0,p=this._feVecLineGroupManager._feLodVecLine._scene;if(a.mode===t.SCENE3D)m=a.camera.computeViewRectangle();else{var m=p.globe.ellipsoid,q=p.canvas.width,p=p.canvas.height;h.x=0;h.y=0;d=a.camera.pickEllipsoid(h,m,d);if(!Cesium.defined(d))return;d=H.fromCartesian(d);h.x=q;h.y=p;g=a.camera.pickEllipsoid(h,m,g);if(!Cesium.defined(g))return;g=H.fromCartesian(g);k.west=d.longitude;k.north=d.latitude;k.east=g.longitude;k.south=g.latitude;m=Cesium.Rectangle.clone(k,l)}if(f(m)&&(c=A.intersection(c,m),f(c)))if(c=this._feVecLineGroupManager._name,k=c.indexOf(":"),c.substring(0,k),e.distance(b,this._center),f(this.curPrimitiveLine))this._frameNumber=a.frameNumber,a=this._level.toString()+this._minLat.toString()+this._maxLat.toString()+this._minLon.toString()+this._maxLon.toString(),this._feVecLineGroupManager._vecLineGroupMap.has(a)||this._feVecLineGroupManager._vecLineGroupMap.set(a,this);else if(this._isLeaf&&!this._isEmpty&&!this._loading){var r=this;z(G(r)).then(function(a){var b=[];a=a.getElementsByTagName("gml:featureMember");for(var c=a.length,d,e=0;e<c;++e)for(var g=a[e].getElementsByTagName("gml:coordinates").length,h=1;h<g;++h)d=a[e].getElementsByTagName("gml:coordinates")[h].firstChild.nodeValue,b.push({posString:d});f(b)&&0<b.length?E(r,b):r._isEmpty=!0;r._loading=!1})}else if(f(this._childArray))for(b=0;b<this._childArray.length;b++)this._childArray[b].update(a)}};w.prototype.trim=function(){};return w});F("FeSceneEx/FeVecLineGroupManager","../Core/defined ../Core/defaultValue ../Scene/BillboardCollection ./FeLodVecLine ./FeVecLineGroup ../Core/Cartesian3 ../Core/Math ../ThirdParty/when ../Core/BoundingSphere ../Core/Color ../Core/CullingVolume ../Core/DefaultProxy ../Core/defineProperties".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(b){b=a(b,a.EMPTY_OBJECT);this._feLodVecLine=b.feLodVecLine;this.map=a(b.mapObject,void 0);this._show=a(b.show,!1);this._url=a(b.dataSource.url,"");this._minRange=a(b.dataSource.minHeight,0);this._maxRange=a(b.dataSource.maxHeight,1E3);this._name=a(b.dataSource.name,"");this._lodLevel=a(b.dataSource.level,1);this.allDataDeferred=a(b.allDataDeferred,void 0);"number"==typeof this._lodLevel&&(this.waitPrimitiveNumber=1);this._color=a(b.dataSource.color,p.fromCssColorString("rgba(255.0,255,255,1.0)"));this._width=a(b.dataSource.width,1);this._minLat=-90;this._maxLat=90;this._minLon=-180;this._maxLon=180;this._maxLodLevel=2;this._startLodLevel=0;this._feVecLineGroup=void 0;this._rangeScale=1.1;this._vecLineGroupMap=new Map;this._cullingVolume=new d;this._vecLinePrimitives=[]}function c(a,b,c,d,e){var f=new l(b,e,0),g=new l;l.subtract(l.fromDegrees(f.x,f.y,0),a,g);f=new l(c,e,0);e=new l;l.subtract(l.fromDegrees(f.x,f.y,0),a,e);f=new l(c,d,0);c=new l;l.subtract(l.fromDegrees(f.x,f.y,0),a,c);d=new l(b,d,0);b=new l;l.subtract(l.fromDegrees(d.x,d.y,0),a,b);d=[];d.push(g);d.push(e);d.push(c);d.push(b);g=h.fromPoints(d);l.add(g.center,a,g.center);return g}function u(a){if(b(a)&&b(a._feVecLineGroupManager)&&a._level<a._feVecLineGroupManager._maxLodLevel&&!b(a._childArray)){a._childArray=Array(1);var d=(a._maxLat+a._minLat)/2,e=(a._maxLon+a._minLon)/2,f=!1,h=a._level+1;h==a._feVecLineGroupManager._maxLodLevel&&(f=!0);for(var k=0;1>k;k++){switch(k){case 0:var m=new l((a._minLon+e)/2,(d+a._maxLat)/2,0),m=l.fromDegrees(m.x,m.y,0),p=a._minRange,q=a._maxRange,r=a._minLon,t=a._maxLon,y=a._minLat,E=a._maxLat,A=c(m,r,t,y,E);a._childArray[k]=new g({feVecLineGroupManager:a._feVecLineGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f});break;case 1:m=new l((e+a._maxLon)/2,(d+a._maxLat)/2,0);m=l.fromDegrees(m.x,m.y,0);p=a._minRange;q=a._maxRange;r=e;t=a._maxLon;y=d;E=a._maxLat;A=c(m,r,t,y,E);a._childArray[k]=new g({feVecLineGroupManager:a._feVecLineGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f});break;case 2:m=new l((a._minLon+e)/2,(a._minLat+d)/2,0);m=l.fromDegrees(m.x,m.y,0);p=a._minRange;q=a._maxRange;r=a._minLon;t=e;y=a._minLat;E=d;A=c(m,r,t,y,E);a._childArray[k]=new g({feVecLineGroupManager:a._feVecLineGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f});break;case 3:m=new l((e+a._maxLon)/2,(a._minLat+d)/2,0),m=l.fromDegrees(m.x,m.y,0),p=a._minRange,q=a._maxRange,r=e,t=a._maxLon,y=a._minLat,E=d,A=c(m,r,t,y,E),a._childArray[k]=new g({feVecLineGroupManager:a._feVecLineGroupManager,minLon:r,maxLon:t,minLat:y,maxLat:E,minRange:p,maxRange:q,center:m,level:h,boundingSphere:A,isLeaf:f})}u(a._childArray[k])}}}function y(a){var b=e.defer();$.ajax({url:a._url+"?service\x3dwfs\x26request\x3dgetcapabilities",dataType:"xml",cache:!1,async:!0,success:function(a){b.resolve(a)},error:function(){b.reject()}});return b.promise}r.prototype.createVecLineGroup=function(){var a=e.defer();this._maxLodLevel=this._lodLevel;var b=y(this),d=this;e(b).then(function(b){b.getElementsByTagName("FeatureTypeList");b=b.getElementsByTagName("FeatureType");for(var e=d._name,e=e.split(":")[1],f=b.length,k=0;k<f;++k){var m=b[k].getElementsByTagName("Name")[0].firstChild.nodeValue;if(e==m){e=b[k].lastChild;b=e.childNodes[0].firstChild.nodeValue;e=e.childNodes[1].firstChild.nodeValue;f=b.indexOf(" ");d._minLon=parseFloat(b.substring(0,f));d._minLat=parseFloat(b.substring(f+1));f=e.indexOf(" ");d._maxLon=parseFloat(e.substring(0,f));d._maxLat=parseFloat(e.substring(f+1));break}}b=new l((d._minLon+d._maxLon)/2,(d._minLat+d._maxLat)/2,0);b=l.fromDegrees(b.x,b.y,0);e=new h;h.expand(e,b);e=c(b,d._minLon,d._maxLon,d._minLat,d._maxLat);d._feVecLineGroup=new g({feVecLineGroupManager:d,minLon:d._minLon,maxLon:d._maxLon,minLat:d._minLat,maxLat:d._maxLat,minRange:d._minRange,maxRange:d._maxRange,center:b,boundingSphere:e,level:0});u(d._feVecLineGroup);a.resolve()});return a.promise};r.prototype.destroy=function(){this._feVecLineGroup.destroy()};r.prototype.updateCullingVolume=function(a){a=a.camera;var b=a.positionWC.clone();l.normalize(b,b);l.multiplyByScalar(b,-1,b);var c=new l(0,0,1),d=new l;l.cross(c,b,d);l.normalize(d,d);this._cullingVolume=a.frustum.clone().computeCullingVolume(a.positionWC,b,d)};r.prototype.update=function(a){b(this._feVecLineGroup)&&(this.updateCullingVolume(a),this._feVecLineGroup.update(a))};r.prototype.setVisible=function(a){this._show=a;for(var b=0;b<this._vecLinePrimitives.length;++b)this._vecLinePrimitives[b].show=a};return r});F("FeSceneEx/FeLodVecLine","../Core/defined ../ThirdParty/when ../Core/defaultValue ../Scene/BillboardCollection ../Core/Color ../Core/Cartesian3 ../Scene/HeightReference ../Core/Cartesian2 ../Scene/HorizontalOrigin ../Scene/VerticalOrigin ../Core/NearFarScalar ../DataSources/BoundingSphereState ../DataSources/Property ../Core/BoundingRectangle ../Core/DistanceDisplayCondition ../Core/defineProperties ../Core/destroyObject ./FeVecLineGroupManager".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(a){a=f(a,f.EMPTY_OBJECT);this.map=a.map;this._scene=this.map.scene;this._show=f(a.show,!0);this._dataSourceArray=[];this._feVecLineGroupManager=[];this.allDataDeferred=f(a.allDataDeferred,void 0)}new l;new g;new l;new e;new d;new d;new d;new r;new c;u(z.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}}});z.prototype.addDataSource=function(a){if(!b(a))throw new DeveloperError("dataSource is required.");this._dataSourceArray.push(a)};z.prototype.setVisible=function(a){this._show=a;if(0<this._feVecLineGroupManager.length)for(var b=0;b<this._feVecLineGroupManager.length;b++)this._feVecLineGroupManager[b].setVisible(a)};z.prototype.destroy=function(){if(0<this._feVecLineGroupManager.length)for(var a=0;a<this._feVecLineGroupManager.length;a++)this._feVecLineGroupManager[a].destroy();return y(this)};z.prototype.update=function(c){if(0<this._dataSourceArray.length){var d=this._dataSourceArray.pop();if(b(d)){var e=new A({feLodVecLine:this,dataSource:d,mapObject:this.map,show:this._show,allDataDeferred:this.allDataDeferred}),f=this;a(e.createVecLineGroup()).then(function(){f._feVecLineGroupManager.push(e)})}}if(0<this._feVecLineGroupManager.length)for(d=0;d<this._feVecLineGroupManager.length;d++)this._feVecLineGroupManager[d].update(c)};return z});F("FeSceneEx/FeOctreeTriangleSelector","../Core/Cartesian3 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Core/Interval ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/QuadraticRealPolynomial ../Core/QuarticRealPolynomial ../Core/Ray ../Core/BoundingSphere ../Scene/SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(){this.MinEdge=new b(0,0,0);this.MaxEdge=new b(0,0,0)}function u(a,c,d,e){e=b.subtract(e,d,B);var f=b.clone(e),f=b.cross(e,b.subtract(a,d,C),f);a=b.clone(e);a=b.cross(e,b.subtract(c,d,I),a);return 0<=f.x*a.x+f.y*a.y+f.z*a.z}function y(a){this.Normal=f(a.normal,new b(0,1,0));this.D=f(a.d,0);a.MPoint&&this.recalculateD(a.MPoint)}function A(a){var c=a.p0,d=a.p2;b.subtract(a.p1,c,H);b.subtract(d,c,J);b.cross(H,J,w);0<b.magnitude(w)?b.normalize(w,w):w=b.clone(b.ZERO);a={normal:b.clone(w),MPoint:b.clone(c)};return new y(a)}function z(){this.Triangles=new Map;this.Child={};this.Box=new c}function x(a){a=f(a,f.EMPTY_OBJECT);this.worldMatrix=f(a.modelMatrix,h.IDENTITY);this.TotalTriangleCount=f(a.totalTriangleCount,0);this.TrianglesList=f(a.triangleList,void 0);this.Root=void 0;this.minimalPolysPerNode=f(a.minimalPolysPerNode,100);this.max=f(a.max,void 0);this.min=f(a.min,void 0);this.trianglesWritten=this.recursionDepth=0;this.tileTerrainMap=new Map}function D(a,c,d,e,f,g){a.decodePosition(e,f,g);k(c)&&c!==r.SCENE3D&&(a=d.ellipsoid.cartesianToCartographic(g),d.project(a,g),b.fromElements(g.z,g.x,g.y,g));return g}var v=new b;c.prototype.reset=function(a,b,c){this.MaxEdge.x=a;this.MaxEdge.y=b;this.MaxEdge.z=c;this.MinEdge.x=a;this.MinEdge.y=b;this.MinEdge.z=c};c.prototype.addInternalPoint=function(a,b,c){a>this.MaxEdge.x&&(this.MaxEdge.x=a);b>this.MaxEdge.y&&(this.MaxEdge.y=b);c>this.MaxEdge.z&&(this.MaxEdge.z=c);a<this.MinEdge.x&&(this.MinEdge.x=a);b<this.MinEdge.y&&(this.MinEdge.y=b);c<this.MinEdge.z&&(this.MinEdge.z=c)};c.prototype.getCenter=function(){var a=new b;a.x=(this.MinEdge.x+this.MaxEdge.x)/2;a.y=(this.MinEdge.y+this.MaxEdge.y)/2;a.z=(this.MinEdge.z+this.MaxEdge.z)/2;return a};c.prototype.getExtent=function(){var a=new b;a.x=this.MaxEdge.x-this.MinEdge.x;a.y=this.MaxEdge.y-this.MinEdge.y;a.z=this.MaxEdge.z-this.MinEdge.z;return a};c.prototype.isEmpty=function(){return b.equals(this.MinEdge,this.MaxEdge)};c.prototype.getEdges=function(){var a=this.getCenter(),c=b.subtract(a,this.MaxEdge,v),d={};d[0]=new b;d[1]=new b;d[2]=new b;d[3]=new b;d[4]=new b;d[5]=new b;d[6]=new b;d[7]=new b;d[0].x=a.x+c.x;d[0].y=a.y+c.y;d[0].z=a.z+c.z;d[1].x=a.x+c.x;d[1].y=a.y-c.y;d[1].z=a.z+c.z;d[2].x=a.x+c.x;d[2].y=a.y+c.y;d[2].z=a.z-c.z;d[3].x=a.x+c.x;d[3].y=a.y-c.y;d[3].z=a.z-c.z;d[4].x=a.x-c.x;d[4].y=a.y+c.y;d[4].z=a.z+c.z;d[5].x=a.x-c.x;d[5].y=a.y-c.y;d[5].z=a.z+c.z;d[6].x=a.x-c.x;d[6].y=a.y+c.y;d[6].z=a.z-c.z;d[7].x=a.x-c.x;d[7].y=a.y-c.y;d[7].z=a.z-c.z;return d};c.prototype.intersectsWithBox=function(a){return this.MinEdge.x<=a.MaxEdge.x&&this.MinEdge.y<=a.MaxEdge.y&&this.MinEdge.z<=a.MaxEdge.z&&this.MaxEdge.x>=a.MinEdge.x&&this.MaxEdge.y>=a.MinEdge.y&&this.MaxEdge.z>=a.MinEdge.z};c.prototype.isPointInside=function(a){return a.x>=this.MinEdge.x&&a.x<=this.MaxEdge.x&&a.y>=this.MinEdge.y&&a.y<=this.MaxEdge.y&&a.z>=this.MinEdge.z&&a.z<=this.MaxEdge.z};var B=new b,C=new b,I=new b;y.prototype.recalculateD=function(a){this.D=-(a.x*this.Normal.x+a.y*this.Normal.y+a.z*this.Normal.z)};y.prototype.getDistanceTo=function(a){return a.x*this.Normal.x+a.y*this.Normal.y+a.z*this.Normal.z+this.D};y.prototype.isFrontFacing=function(a){return 0>=a.x*this.Normal.x+a.y*this.Normal.y+a.z*this.Normal.z};var H=new b,J=new b,w=new b,G=new b,E=new b,L=new b;new b;var K=new b,P=new b;x.prototype.ConstructTriangleOctreeWithTerrain=function(a){this.TotalTriangleCount=0;this.min=this.max=this.Root=this.TrianglesList=void 0;this.trianglesWritten=this.recursionDepth=0;this.tileTerrainMap.clear();var c=a.mode,d=a.mapProjection,e=a.camera;a=a.globe._surface._tilesToRender;if(k(a)&&c===r.SCENE3D){b.clone(b.ZERO,K);b.clone(b.ZERO,P);var f=a.length,g,h;for(h=0;h<f;++h)if(g=a[h],g=g.data,k(g)){var l=g.renderedMesh;if(!k(l))return;t.clone(l.boundingSphere3D,boundingVolume);if(t.distanceSquaredTo(boundingVolume,e.position)<=boundingVolume.radius){g=l.indices;var m=l.vertices,l=l.encoding,f=g.length;for(h=0;h<f;h+=3){var p=g[h+1],q=g[h+2],w=D(l,c,d,m,g[h],G),p=D(l,c,d,m,p,E),q=D(l,c,d,m,q,L);w.x>K.x&&(K.x=w.x);p.y>K.y&&(K.y=p.y);q.z>K.z&&(K.z=q.z);w.x<P.x&&(P.x=w.x);p.y<P.y&&(P.y=p.y);q.z<P.z&&(P.z=q.z);w={p0:w,p1:p,p2:q};this.tileTerrainMap.set(this.TotalTriangleCount++,w)}}}this.max=K.clone();this.min=P.clone();this.TrianglesList=this.tileTerrainMap;this.ConstructTriangleOctree()}};x.prototype.ConstructTriangleOctree=function(){this.Root=new z;this.Root.Box.addInternalPoint(this.max.x,this.max.y,this.max.z);this.Root.Box.addInternalPoint(this.min.x,this.min.y,this.min.z);0<this.TotalTriangleCount&&(this.Root.Triangles=this.TrianglesList,this.ConstructOctree(this.Root))};x.prototype.ConstructOctree=function(a){var b=a.Box.getCenter(),d=a.Box.getEdges(),e=new c,f=new Map;if(!a.Box.isEmpty()&&a.Triangles.size>this.minimalPolysPerNode)for(var g=0;8>g;++g)e.reset(b.x,b.y,b.z),e.addInternalPoint(d[g].x,d[g].y,d[g].z),a.Child[g]=new z,a.Triangles.forEach(function(b,c){var d=b.p1,h=b.p2;e.isPointInside(b.p0)&&e.isPointInside(d)&&e.isPointInside(h)?(a.Child[g].Triangles.has(c)||a.Child[g].Triangles.set(c,b),f.has(c)&&f["delete"](c),1===a.Child[g].Triangles.size&&a.Child[g].Box.reset(b.p0.x,b.p0.y,b.p0.z),a.Child[g].Box.addInternalPoint(b.p0.x,b.p0.y,b.p0.z),a.Child[g].Box.addInternalPoint(b.p1.x,b.p1.y,b.p1.z),a.Child[g].Box.addInternalPoint(b.p2.x,b.p2.y,b.p2.z)):f.has(c)||f.set(c,b)}),a.Triangles=f,0===a.Child[g].Triangles.size?a.Child[g]=void 0:this.ConstructOctree(a.Child[g])};var N={R3Position:void 0,R3Velocity:void 0,eRadius:void 0,nearestDistance:Number.MAX_VALUE,slidingSpeed:void 0,intersectionPoint:new b,triangleHits:0,triangleIndex:-1},O=new b,F=new b;x.prototype.getCollisionResultPositionWithModel=function(a,c,d,e,f,g,h,k){this.recursionDepth=0;if(0==c.x||0==c.y||0==c.z)return a;N.R3Position=b.clone(a);N.R3Velocity=b.clone(d);N.eRadius=b.clone(c);N.nearestDistance=Number.MAX_VALUE;N.slidingSpeed=g;N.triangleHits=0;N.triangleIndex=-1;O.x=N.R3Position.x/N.eRadius.x;O.y=N.R3Position.y/N.eRadius.y;O.z=N.R3Position.z/N.eRadius.z;F.x=N.R3Velocity.x/N.eRadius.x;F.y=N.R3Velocity.y/N.eRadius.y;F.z=N.R3Velocity.z/N.eRadius.z;a=this.collideWithModel(0,N,O,F,k);k.outFalling=!1;0<b.magnitude(h)&&(N.R3Position.x=a.x*N.eRadius.x,N.R3Position.y=a.y*N.eRadius.y,N.R3Position.z=a.z*N.eRadius.z,N.R3Velocity=b.clone(h),N.triangleHits=0,F.x=h.x/N.eRadius.x,F.y=h.y/N.eRadius.y,F.z=h.z/N.eRadius.z,this.recursionDepth=0,a=this.collideWithModel(0,N,a,F,k),k.outFalling=0==N.triangleHits);a.x*=N.eRadius.x;a.y*=N.eRadius.y;a.z*=N.eRadius.z;f.x=N.intersectionPoint.x*N.eRadius.x;f.y=N.intersectionPoint.y*N.eRadius.y;f.z=N.intersectionPoint.z*N.eRadius.z;return a};new b;var aa=new b,U=new b;x.prototype.collideWithModel=function(a,d,e,f,g){var k=new b,l=d.slidingSpeed;if(5<a)return k.x=e.x,k.y=e.y,k.z=e.z,k;d.velocity=b.clone(f);d.normalizedVelocity=0<b.magnitude(f)?b.normalize(f,new b):new b;d.basePoint=b.clone(e);d.foundCollision=!1;d.nearestDistance=Number.MAX_VALUE;a=new c;a.reset(d.R3Position.x,d.R3Position.y,d.R3Position.z);a.addInternalPoint(d.R3Position.x+d.R3Velocity.x,d.R3Position.y+d.R3Velocity.y,d.R3Position.z+d.R3Velocity.z);b.subtract(a.MinEdge,d.eRadius,a.MinEdge);b.add(a.MaxEdge,d.eRadius,a.MaxEdge);var m=this.TrianglesList.size,p=new Map,q=h.fromScale(new b(1/d.eRadius.x,1/d.eRadius.y,1/d.eRadius.z));this.trianglesWritten=0;this.GetTrianglesFromOctree(this.Root,this.trianglesWritten,m,a,q,p);var r=this;p.forEach(function(a,b){r.testTriangleIntersectionWithModel(d,a)});g.foundCollision=d.foundCollision;if(!d.foundCollision)return k.x=e.x+f.x,k.y=e.y+f.y,k.z=e.z+f.z,k;k=new b;k.x=e.x+f.x;k.y=e.y+f.y;k.z=e.z+f.z;e=b.clone(e,new b);d.nearestDistance>=l&&(f=b.clone(f),b.normalize(f,f),f.x*=d.nearestDistance-l,f.y*=d.nearestDistance-l,f.z*=d.nearestDistance-l,e.x=d.basePoint.x+f.x,e.y=d.basePoint.y+f.y,e.z=d.basePoint.z+f.z,b.normalize(f,f),d.intersectionPoint.x-=f.x*l,d.intersectionPoint.y-=f.y*l,d.intersectionPoint.z-=f.z*l);a=b.clone(d.intersectionPoint);aa.x=e.x-d.intersectionPoint.x;aa.y=e.y-d.intersectionPoint.y;aa.z=e.z-d.intersectionPoint.z;b.normalize(aa,aa);f=b.clone(aa);a=(new y({Normal:f,MPoint:a})).getDistanceTo(k);U.x=k.x-f.x*a;U.y=k.y-f.y*a;U.z=k.z-f.z*a;f=new b;f.x=U.x-d.intersectionPoint.x;f.y=U.y-d.intersectionPoint.y;f.z=U.z-d.intersectionPoint.z;if(b.magnitude(f)<l)return e;this.recursionDepth+=1;return this.collideWithModel(this.recursionDepth,d,e,f,g)};x.prototype.GetTrianglesFromOctree=function(a,c,d,e,f,g){if(e.intersectsWithBox(a.Box)){var k=a.Triangles.size;k+c>d&&(k-=k+c-d);var l=0,m=this;a.Triangles.forEach(function(a,c){if(l<k){var d=h.multiplyByPoint(f,a.p0,new b),e=h.multiplyByPoint(f,a.p1,new b),p=h.multiplyByPoint(f,a.p2,new b),q={};q.p0=d;q.p1=e;q.p2=p;g.has(c)||(g.set(c,q),m.trianglesWritten++);l++}});for(l=0;8>l;++l)a.Child[l]&&this.GetTrianglesFromOctree(a.Child[l],m.trianglesWritten,d,e,f,g)}};new b;new b;new b;x.prototype.testTriangleIntersectionWithModel=function(a,c){var d=new b;A(c).isFrontFacing(a.normalizedVelocity)||(c={p0:c.p0,p1:c.p2,p2:c.p1});var e=A(c),f,g,h=!1;f=e.getDistanceTo(a.basePoint);if(0>f)return!1;var k=b.dot(e.Normal,a.velocity);if(1E-6>=Math.abs(k)){if(1<=Math.abs(f))return!1;h=!0;g=0}else{g=(-1-f)/k;f=(1-f)/k;g>f&&(k=f,f=g,g=k);if(1<g||0>f)return!1;g=m.clamp(g,0,1);m.clamp(f,0,1)}f=!1;k=1;if(!h){e=b.subtract(a.basePoint,e.Normal,new b);e.x+=a.velocity.x*g;e.y+=a.velocity.y*g;e.z+=a.velocity.z*g;var h=c.p0,l=c.p1,p=c.p2;u(e,h,l,p)&&u(e,l,h,p)&&u(e,p,h,l)&&(f=!0,k=g,d=e)}if(!f){g=b.clone(a.velocity);var e=b.clone(a.basePoint),h=b.magnitudeSquared(g),q,r,l=0,p=h;q=2*b.dot(g,b.subtract(e,c.p0,new b));var t=b.subtract(c.p0,e,new b);r=b.magnitudeSquared(t)-1;q=this.getLowestRoot(p,q,r,k,l);l=q.root;q.flag&&(k=l,f=!0,d=b.clone(c.p0));f||(q=2*b.dot(g,b.subtract(e,c.p1,new b)),t=b.subtract(c.p1,e,new b),r=b.magnitudeSquared(t)-1,q=this.getLowestRoot(p,q,r,k,l),l=q.root,q.flag&&(k=l,f=!0,d=b.clone(c.p1)));f||(q=2*b.dot(g,b.subtract(e,c.p2,new b)),t=b.subtract(c.p2,e,new b),r=b.magnitudeSquared(t)-1,q=this.getLowestRoot(p,q,r,k,l),l=q.root,q.flag&&(k=l,f=!0,d=b.clone(c.p2)));var t=b.subtract(c.p1,c.p0,new b),w=b.subtract(c.p0,e,new b),v=b.magnitudeSquared(t),y=b.dot(t,g),z=b.dot(t,w),p=v*-h+y*y;q=2*v*b.dot(g,w)-2*y*z;r=v*(1-b.magnitudeSquared(w))+z*z;q=this.getLowestRoot(p,q,r,k,l);l=q.root;q.flag&&(p=(y*l-z)/v,0<=p&&1>=p&&(k=l,f=!0,d.x=c.p0.x+t.x*p,d.y=c.p0.y+t.y*p,d.z=c.p0.z+t.z*p));t.x=c.p2.x-c.p1.x;t.y=c.p2.y-c.p1.y;t.z=c.p2.z-c.p1.z;w.x=c.p1.x-e.x;w.y=c.p1.y-e.y;w.z=c.p1.z-e.z;v=b.magnitudeSquared(t);y=b.dot(t,g);z=b.dot(t,w);p=v*-h+y*y;q=2*v*b.dot(g,w)-2*y*z;r=v*(1-b.magnitudeSquared(w))+z*z;q=this.getLowestRoot(p,q,r,k,l);l=q.root;q.flag&&(p=(y*l-z)/v,0<=p&&1>=p&&(k=l,f=!0,d.x=c.p1.x+t.x*p,d.y=c.p1.y+t.y*p,d.z=c.p1.z+t.z*p));t.x=c.p0.x-c.p2.x;t.y=c.p0.y-c.p2.y;t.z=c.p0.z-c.p2.z;w.x=c.p2.x-e.x;w.y=c.p2.y-e.y;w.z=c.p2.z-e.z;v=b.magnitudeSquared(t);y=b.dot(t,g);z=b.dot(t,w);p=v*-h+y*y;q=2*v*b.dot(g,w)-2*y*z;r=v*(1-b.magnitudeSquared(w))+z*z;q=this.getLowestRoot(p,q,r,k,l);l=q.root;q.flag&&(p=(y*l-z)/v,0<=p&&1>=p&&(k=l,f=!0,d.x=c.p2.x+t.x*p,d.y=c.p2.y+t.y*p,d.z=c.p2.z+t.z*p))}return f&&(f=k*b.magnitude(a.velocity),!a.foundCollision||f<a.nearestDistance)?(a.nearestDistance=f,a.intersectionPoint=b.clone(d),a.foundCollision=!0,a.intersectionTriangle=c,++a.triangleHits,!0):!1};x.prototype.getLowestRoot=function(a,b,c,d,e){c=b*b-4*a*c;if(0>c)return{root:e,flag:!1};var f=Math.sqrt(c);c=(-b-f)/(2*a);a=(-b+f)/(2*a);c>a&&(b=a,a=c,c=b);return 0<c&&c<d?{root:c,flag:!0}:0<a&&a<d?{root:a,flag:!0}:{root:e,flag:!1}};x.prototype.destroy=function(){this.Root=this.TrianglesList=void 0};return x});F("FeShadersEx/FePrecipitationFS",[],function(){return"precision mediump float;\nuniform sampler2D u_baseTexture;\nvarying vec4 colour;\nvarying vec2 texCoord;\nvoid main()\n{\n\tvec4 color \x3d texture2D( u_baseTexture, texCoord);\n\tif( color.a \x3e 0.1 ){\n\t\tgl_FragColor \x3d colour * color;\n\t}else{\n\t\tdiscard;\n\t}\n}"});F("FeShadersEx/FePrecipitationVS",[],function(){return"attribute vec3 v_position;\nattribute vec2 v_texCoord;\nuniform mat4 u_modelViewMatrix;\nuniform mat4 u_projMatrix;\nuniform float u_inversePeriod;\nuniform vec4 u_particleColour;\nuniform float u_particleSize;\nuniform float u_simulationTime;\nuniform float u_deltaSimulationTime;\nuniform float u_startTime;\nvarying vec4 colour;\nvarying vec2 texCoord;\nvoid main()\n{\n\tfloat offset \x3d v_position.z;\n\tfloat startTime \x3d u_startTime;\n\ttexCoord \x3d v_texCoord;\n\tvec4 v_previous \x3d vec4(v_position,1.0);\n\tv_previous.z \x3d fract((u_simulationTime - startTime) * u_inversePeriod - offset);\n\tvec4 v_current \x3d  v_previous;\n\tv_current.z +\x3d (u_deltaSimulationTime * u_inversePeriod);\n\tcolour \x3d u_particleColour;\n\tvec4 v1 \x3d u_modelViewMatrix * v_current;\n\tvec4 v2 \x3d u_modelViewMatrix * v_previous;\n\tvec3 dv \x3d v2.xyz - v1.xyz;\n\tvec2 dv_normalized \x3d normalize(dv.xy);\n\tdv.xy +\x3d dv_normalized * u_particleSize;\n\tvec2 dp \x3d vec2( -dv_normalized.y, dv_normalized.x ) * u_particleSize;\n\tfloat area \x3d length(dv.xy);\n\tcolour.a \x3d 0.05 + (u_particleSize) / area;\n\tv1.xyz +\x3d dv * texCoord.y;\n\tv1.xy +\x3d dp * texCoord.x;\n\tgl_Position \x3d u_projMatrix * v1;\n}"});F("FeSceneEx/FePrecipitation","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/clone ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/FeatureDetection ../Core/Geometry ../Core/GeometryAttribute ../Core/GeometryAttributes ../Core/isArray ../Core/Matrix4 ../Core/Matrix3 ../Core/RuntimeError ../Core/subdivideArray ../Core/TaskProcessor ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../FeSceneEx/FeDrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../ThirdParty/when ../Scene/BatchTable ../Scene/CullFace ../Scene/DepthFunction ../Scene/PrimitivePipeline ../Scene/PrimitiveState ../Scene/SceneMode ../Scene/ShadowMode ../FeShadersEx/FePrecipitationFS ../FeShadersEx/FePrecipitationVS ../Core/Ellipsoid ../Core/Transforms ../Core/Quaternion ../Core/Math ../Core/getTimestamp ../Core/WebGLConstants ../Core/buildModuleUrl ../Core/Intersect ../Core/Rectangle ../Core/isCrossOriginUrl".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,F,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga,ka,na){function Z(a){this._pass=E.OPAQUE;this._receiveShadows=!1;var c=new b(new f,63781370);this._drawCommand=new G({primitive:this,pass:this._pass,receiveShadows:this._receiveShadows,boundingVolume:c});a=p(a,p.EMPTY_OBJECT);this._vao=this._us=this._gl=void 0;this._isGeometryCreate=!1;this._uSpotLightTex=this._uStartTime=this._uDeltaSimulationTime=this._uSimulationTime=this._uParticleSize=this._uParticleColour=this._uInversePeriod=this._uProjMat=this._uModelViewMat=this._shaderProgram=this._indexBuffer=this._texCoordBuffer=this._positionBuffer=void 0;this._renderState=new L;this._renderState.depthTest.enabled=!0;this._renderState.blending.enabled=!0;this._renderState.blending.functionSourceRgb=X.SRC_ALPHA;this._renderState.blending.functionDestinationRgb=X.ONE_MINUS_SRC_ALPHA;this._maxParticlesPerCell=1024;this._vertexNum=4*this._maxParticlesPerCell;this._elementNum=6*this._maxParticlesPerCell;this._camPosition=new f(0,0,0);this._camSpherePos=void 0;this._numParticlesPerCell=0;this._texCoordArr=this._positionArr=void 0;this._wind=new f;this._particleSize=this._particleSpeed=0;this._particleColor=new k;this._maximumParticleDensity=0;this._cellSize=new f;this._farTransition=this._nearTransition=0;this._useFarLineSegments=!1;this._dirty=!0;this._period=0;this._du=new f;this._dv=new f;this._dw=new f;this._inverse_du=new f;this._inverse_dv=new f;this._inverse_dw=new f;this._spotLightTex=void 0;this._origin=new f(0,0,0);this._deltaFrameTime=this._previousFrameTime=void 0;this._matrixArr=[];this._worldMat=new D;this._cullingVolume=void 0;this._visibleHeight=p(a.visibleHeight,5E3);this._density=p(a.density,.5);this._speed=p(a.speed,1);this._url=p(a.url,void 0);this._show=p(a.show,!0);this._scope=p(a.scope,void 0);d(this._scope)?this._rectangle=ka.fromDegrees(this._scope[0],this._scope[1],this._scope[2],this._scope[3]):this._rectangle=ka.fromDegrees(-180,-90,180,90);this._type=p(a.type,0);1===this._type?oa(this,this._density):qa(this,this._density)}function la(a,b){a._spotLightTex=b.createTexture();b.bindTexture(b.TEXTURE_2D,a._spotLightTex);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);for(var c=new Uint8Array(4096),d=0,e=new k(1,1,1,1),f=new k(1,1,1,0),g=0;32>g;++g)for(var h=0;32>h;++h){var l=.0625*(h-15.5),m=.0625*(g-15.5),p=1-Math.sqrt(l*l+m*m);0>p&&(p=0);l=new k;k.multiplyByScalar(e,p,l);m=new k;k.multiplyByScalar(f,1-p,m);p=new k;k.add(l,m,p);c[d++]=255*p.x;c[d++]=255*p.y;c[d++]=255*p.z;c[d++]=255*p.w}b.texImage2D(b.TEXTURE_2D,0,b.RGBA,32,32,0,b.RGBA,b.UNSIGNED_BYTE,c,0);b.bindTexture(b.TEXTURE_2D,null)}function ha(a,b){if(a._url){var c=new Image;c.onload=function(){a._spotLightTex=b.createTexture();b.bindTexture(b.TEXTURE_2D,a._spotLightTex);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR);b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR);var d=c.width,e=c.height,f=new Uint8Array(d*e*4),g=0;new k(1,1,1,1);new k(1,1,1,0);var h=document.createElement("canvas").getContext("2d");h.drawImage(c,0,0);for(var h=h.getImageData(0,0,d,e).data,l=h.length,m=0;m<l;++m)f[g++]=h[m];b.texImage2D(b.TEXTURE_2D,0,b.RGBA,d,e,0,b.RGBA,b.UNSIGNED_BYTE,f,0);b.bindTexture(b.TEXTURE_2D,null)};c.src=a._url}else la(a,b)}function pa(a){a._dirty=!1;var b=a._cellSize.x,c=a._cellSize.y,d=a._cellSize.z;a._period=Math.abs(a._cellSize.z/a._particleSpeed);a._du.x=b;a._du.y=0;a._du.z=0;a._dv.x=0;a._dv.y=c;a._dv.z=0;a._dw.x=0;a._dw.y=0;a._dw.z=d;a._inverse_du.x=1/b;a._inverse_du.y=0;a._inverse_du.z=0;a._inverse_dv.x=0;a._inverse_dv.y=1/c;a._inverse_dv.z=0;a._inverse_dw.x=0;a._inverse_dw.y=0;a._inverse_dw.z=1/d}function oa(a,b){a._wind.x=0;a._wind.y=0;a._wind.z=0;a._particleSpeed=-2-5*a._speed;a._particleSize=.01+.02*b;var c=new k(.1,.1,.1,1),d=new k;f.multiplyByScalar(c,b,d);c=new k(.6,.6,.6,1);f.subtract(c,d,a._particleColor);a._maximumParticleDensity=8.5*b;a._cellSize.x=5/(.25+b);a._cellSize.y=5/(.25+b);a._cellSize.z=5;a._nearTransition=25;a._farTransition=80-60*Math.sqrt(b);a._useFarLineSegments=!1;a._dirty=!0;pa(a)}function qa(a,b){a._wind.x=0;a._wind.y=0;a._wind.z=0;a._particleSpeed=-.5-.5*a._speed;a._particleSize=.02+.01*b;var c=new k(.1,.1,.1,1),d=new k;f.multiplyByScalar(c,b,d);c=new k(1,1,1,1);f.subtract(c,d,a._particleColor);a._maximumParticleDensity=8.2*b;a._cellSize.x=5/(.25+b);a._cellSize.y=5/(.25+b);a._cellSize.z=5;a._nearTransition=25;a._farTransition=80-60*Math.sqrt(b);a._useFarLineSegments=!1;a._dirty=!0;pa(a)}function ua(a,b){var c,d;b?(c=a.createShader(a.VERTEX_SHADER),d=S):(c=a.createShader(a.FRAGMENT_SHADER),d=Q);a.shaderSource(c,d);a.compileShader(c);if(a.getShaderParameter(c,a.COMPILE_STATUS))return c;c=a.getShaderInfoLog(c);alert(c)}function ta(a,b,c,d){var e=a._currentRenderState,f=a._currentPassState;a._currentRenderState=b;a._currentPassState=c;L.partialApply(a._gl,e,b,f,c,d)}function wa(a,b){return a.depth-b.depth}q(Z.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}},visibleHeight:{get:function(){return this._visibleHeight},set:function(a){this._visibleHeight=a}},density:{get:function(){return this._density},set:function(a){this._density=a;1===this._type?oa(this,this._density):qa(this,this._density)}},speed:{get:function(){return this._speed},set:function(a){this._speed=a}},scope:{get:function(){return this._scope},set:function(a){this._scope=a;this._rectangle=ka.fromDegrees(this._scope[0],this._scope[1],this._scope[2],this._scope[3])}}});Z.prototype.update=function(a){if(this._show){this._us=a.context._us;this._cullingVolume=a.cullingVolume;f.clone(a.camera.position,this._camPosition);this._camSpherePos=ca.WGS84.cartesianToCartographic(this._camPosition);this._worldMat=T.eastNorthUpToFixedFrame(this._camPosition);var c=ba()/1E3;d(this._previousFrameTime)||(this._previousFrameTime=c);this._deltaFrameTime=c-this._previousFrameTime;var e=new f;f.multiplyByScalar(this._wind,this._deltaFrameTime,e);f.add(this._origin,e,this._origin);this._previousFrameTime=c;this._matrixArr=[];if(d(this._camSpherePos)&&!(this._camSpherePos.height>this._visibleHeight)){this._numParticlesPerCell=parseInt(this._maximumParticleDensity*this._cellSize.x*this._cellSize.y*this._cellSize.z);c=new f(0,0,0);e=new f;f.subtract(c,this._origin,e);var h=f.dot(e,this._inverse_dw),l=new f;f.multiplyByScalar(this._dw,h,l);e=new f;f.subtract(c,l,e);l=new f;f.subtract(e,this._origin,l);for(var m=f.dot(l,this._inverse_du),p=f.dot(l,this._inverse_dv),q=this._farTransition*this._inverse_du.x,r=this._farTransition*this._inverse_dv.y,t=parseInt(Math.floor(m-q)),e=parseInt(Math.floor(p-r)),l=parseInt(Math.floor(h-1)),m=parseInt(Math.ceil(m+q)),p=parseInt(Math.ceil(p+r)),h=parseInt(Math.ceil(h+1));t<=m;++t)for(r=e;r<=p;++r)for(q=l;q<=h;++q){var w=.43*t+.64*r,w=(w-Math.floor(w))*this._period,u=c,v=t,y=r,z=q,E=new f,v=new f(v*this._du.x,y*this._dv.y,(z+1)*this._dw.z);f.add(this._origin,v,E);v=new f(this._du.x,this._dv.y,-this._dw.z);z=new f;f.multiplyByScalar(v,.5,z);y=new f;f.add(E,z,y);var A=new f(E.x,E.y,E.z+v.z),C=new f(E.x+v.x,E.y+v.y,E.z),z=new f;f.subtract(A,y,z);A=new f;f.subtract(C,y,A);C=[];C.push(z);C.push(A);z=b.fromPoints(C);C=new f;f.add(z.center,y,C);A=new k(C.x,C.y,C.z,1);D.multiplyByVector(this._worldMat,A,A);C.x=A.x;C.y=A.y;C.z=A.z;z.center=C;C=g.fromCartesian(C);z=ka.contains(this._rectangle,C)?this._cullingVolume.computeVisibility(z)!==ga.OUTSIDE?!0:!1:!1;z&&(z=new f,f.subtract(y,u,z),u=f.magnitude(z),v=D.fromScale(v),z=D.fromTranslation(E),E=this._us.view,y=new D,D.multiply(z,v,y),v=new D,D.multiply(this._worldMat,y,v),y=new D,D.multiply(E,v,y),E={},E.depth=u,E.startTime=w,E.modelview=y,this._matrixArr.push(E))}}a.commandList.push(this._drawCommand)}};var za;"undefined"!==typeof WebGLRenderingContext&&(za=[X.BACK]);Z.prototype.destroy=function(){return t(this)};Z.prototype.draw=function(a,b){if(d(a)){var c=a._gl;if(d(c)){this._gl=c;if(!this._isGeometryCreate){if(a.vertexArrayObject){this._vao=a.glCreateVertexArray();a.glBindVertexArray(this._vao);var e=a._gl;this._positionBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._positionBuffer);for(var f=new Float32Array(3*this._vertexNum),g=0,h=0;h<this._maxParticlesPerCell;++h)for(var k=Math.random(),l=Math.random(),m=Math.random(),p=0;4>p;++p)f[g++]=k,f[g++]=l,f[g++]=m;this._positionArr=f;e.bufferData(e.ARRAY_BUFFER,this._positionArr,e.STATIC_DRAW);this._texCoordBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._texCoordBuffer);f=new Float32Array(2*this._vertexNum);for(h=g=0;h<this._maxParticlesPerCell;++h)f[g++]=0,f[g++]=0,f[g++]=1,f[g++]=0,f[g++]=0,f[g++]=1,f[g++]=1,f[g++]=1;this._texCoordArr=f;e.bufferData(e.ARRAY_BUFFER,this._texCoordArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._indexBuffer=e.createBuffer();e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);f=new Uint32Array(this._elementNum);for(h=g=0;h<this._maxParticlesPerCell;++h)f[g++]=4*h+1,f[g++]=4*h+0,f[g++]=4*h+2,f[g++]=4*h+1,f[g++]=4*h+2,f[g++]=4*h+3;e.bufferData(e.ELEMENT_ARRAY_BUFFER,f,e.STATIC_DRAW);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);a.glBindVertexArray(null)}this._isGeometryCreate=!0}d(this._spotLightTex)||ha(this,c);if(d(this._shaderProgram)){c.useProgram(this._shaderProgram);e=this._gl;d(this._uSpotLightTex)&&e.uniform1i(this._uSpotLightTex,0);d(this._uInversePeriod)&&e.uniform1f(this._uInversePeriod,1/this._period);d(this._uParticleColour)&&e.uniform4f(this._uParticleColour,this._particleColor.x,this._particleColor.y,this._particleColor.z,this._particleColor.w);d(this._uParticleSize)&&e.uniform1f(this._uParticleSize,this._particleSize);d(this._uProjMat)&&(f=this._us.projection,g=new Float32Array(16),D.toArray(f,g),e.uniformMatrix4fv(this._uProjMat,!1,g));d(this._uSimulationTime)&&e.uniform1f(this._uSimulationTime,this._previousFrameTime);d(this._uDeltaSimulationTime)&&e.uniform1f(this._uDeltaSimulationTime,this._deltaFrameTime);e=b.framebuffer;if(e!==a._currentFramebuffer){a._currentFramebuffer=e;f=za;if(d(e)){e._bind();if(a.validateFramebuffer&&(f=a._gl,g=f.checkFramebufferStatus(f.FRAMEBUFFER),g!==f.FRAMEBUFFER_COMPLETE)){var q;switch(g){case f.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:q="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case f.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:q="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case f.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:q="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case f.FRAMEBUFFER_UNSUPPORTED:q="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new r(q);}f=e._getActiveColorAttachments()}else q=a._gl,q.bindFramebuffer(q.FRAMEBUFFER,null);a.drawBuffers&&a.glDrawBuffers(f)}q=a._currentRenderState;e=a._currentPassState;ta(a,this._renderState,b,!1);a.glBindVertexArray(this._vao);f=c.getAttribLocation(this._shaderProgram,"v_position");c.enableVertexAttribArray(f);c.bindBuffer(c.ARRAY_BUFFER,this._positionBuffer);c.vertexAttribPointer(f,3,c.FLOAT,!1,0,0);f=c.getAttribLocation(this._shaderProgram,"v_texCoord");c.enableVertexAttribArray(f);c.bindBuffer(c.ARRAY_BUFFER,this._texCoordBuffer);c.vertexAttribPointer(f,2,c.FLOAT,!1,0,0);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,this._indexBuffer);c.activeTexture(c.TEXTURE0);c.bindTexture(c.TEXTURE_2D,this._spotLightTex);this._matrixArr.sort(wa);for(f=0;f<this._matrixArr.length;++f)g=this._matrixArr[f],d(this._uModelViewMat)&&(h=new Float32Array(16),D.toArray(g.modelview,h),this._gl.uniformMatrix4fv(this._uModelViewMat,!1,h)),d(this._uStartTime)&&this._gl.uniform1f(this._uStartTime,g.startTime),c.drawElements(c.TRIANGLES,6*(this._numParticlesPerCell<this._maxParticlesPerCell?this._numParticlesPerCell:this._maxParticlesPerCell),c.UNSIGNED_INT,0);c.bindBuffer(c.ARRAY_BUFFER,null);c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null);a.glBindVertexArray(null);c.bindTexture(c.TEXTURE_2D,null);ta(a,q,e,!1)}else c=this._gl,q=ua(c,!0),e=ua(c,!1),this._shaderProgram=c.createProgram(),c.attachShader(this._shaderProgram,q),c.attachShader(this._shaderProgram,e),c.linkProgram(this._shaderProgram),c.getProgramParameter(this._shaderProgram,c.LINK_STATUS)||(c=c.getProgramInfoLog(this._shaderProgram),alert(c),this._shaderProgram=void 0),c=this._gl,this._uModelViewMat=c.getUniformLocation(this._shaderProgram,"u_modelViewMatrix"),this._uProjMat=c.getUniformLocation(this._shaderProgram,"u_projMatrix"),this._uInversePeriod=c.getUniformLocation(this._shaderProgram,"u_inversePeriod"),this._uParticleColour=c.getUniformLocation(this._shaderProgram,"u_particleColour"),this._uParticleSize=c.getUniformLocation(this._shaderProgram,"u_particleSize"),this._uSimulationTime=c.getUniformLocation(this._shaderProgram,"u_simulationTime"),this._uDeltaSimulationTime=c.getUniformLocation(this._shaderProgram,"u_deltaSimulationTime"),this._uStartTime=c.getUniformLocation(this._shaderProgram,"u_startTime"),this._uSpotLightTex=c.getUniformLocation(this._shaderProgram,"u_baseTexture")}}};return Z});F("FeShadersEx/FeRadarAppearanceFS",[],function(){return"#define MAXNUMWAVE 10\nvarying vec4 v_localPos;\nuniform float u_length;\nuniform float u_startlength[MAXNUMWAVE];\nuniform float u_waveWidth;\nuniform vec4 u_baseColor;\nuniform vec4 u_waveColor;\n\nvoid main()\n{\n    float waveAlpha \x3d 0.0;\n\tfor(int i \x3d 0; i \x3c MAXNUMWAVE; i++)\n\t{\n\t    float curLength \x3d length(v_localPos.xyz);\n\t    float curWidth \x3d u_waveWidth;\n\t\tif( u_startlength[i] \x3c 0.001){\n\t\t\tcontinue;\n\t\t}\n\t    float endLength \x3d u_startlength[i] + curWidth;\n\t    float startLength \x3d u_startlength[i];\n\t    if(curLength \x3e startLength \x26\x26 curLength \x3c endLength)\n\t    {\n\t\t   float halfWidth \x3d curWidth / 2.0; \n\t\t   float centerLength \x3d startLength + halfWidth;\n\t\t   float disToCenter \x3d abs(curLength - centerLength);\n\t\t   float maxAlpha \x3d 1.0;\n\t\t   float minAlpha \x3d u_baseColor.a;\n\t\t   waveAlpha \x3d (minAlpha - maxAlpha) * disToCenter / halfWidth + maxAlpha;\n\t       continue; \n\t    }\n\t}\n\tif(waveAlpha \x3e 0.0)\n\t{\n\t    gl_FragColor \x3d vec4(u_waveColor.xyz,waveAlpha);\n\t}\n\telse\n\t{\n\t    gl_FragColor \x3d u_baseColor;\n\t}\n}"});F("FeShadersEx/FeRadarAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec3 normal;\nattribute vec4 color;\nattribute float batchId;\n\nvarying vec4 v_localPos;\n\nvoid main() \n{\n\tvec3 highDifference \x3d position3DHigh - czm_encodedCameraPositionMCHigh;\n    vec3 lowDifference \x3d position3DLow - czm_encodedCameraPositionMCLow;\n    vec4 p \x3d vec4(highDifference + lowDifference, 1.0);\n\tv_localPos \x3d vec4(position3DHigh + position3DLow, 1.0);\n    gl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}"});F("FeSceneEx/FeRadarAppearance","../Core/defaultValue ../Core/defineProperties ../Core/VertexFormat ../FeShadersEx/FeRadarAppearanceFS ../FeShadersEx/FeRadarAppearanceVS ../Scene/Appearance".split(" "),function(b,a,f,k,g,l){function m(a){a=b(a,b.EMPTY_OBJECT);var e=b(a.translucent,!0),f=b(a.closed,!1),d=m.VERTEX_FORMAT;this.material=void 0;this.translucent=e;this._vertexShaderSource=b(a.vertexShaderSource,g);this._fragmentShaderSource=b(a.fragmentShaderSource,k);this._renderState=l.getDefaultRenderState(e,f,a.renderState);this._closed=f;this._vertexFormat=d;this._faceForward=b(a.faceForward,!f);this._uTest=!0}a(m.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return this._vertexFormat}},uniforms:{get:function(){return this._uniforms}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}}});m.prototype.update=function(a,b,f){};m.VERTEX_FORMAT=f.POSITION_AND_NORMAL;m.prototype.getFragmentShaderSource=l.prototype.getFragmentShaderSource;m.prototype.isTranslucent=l.prototype.isTranslucent;m.prototype.getRenderState=l.prototype.getRenderState;return m});F("FeSceneEx/FeRadarEffect","../Scene/PrimitiveState ../Scene/SceneMode ../Core/defined ./FeGeometryCreator ./FeGeometry ../Core/FeatureDetection ../Core/TaskProcessor ../Core/defaultValue ../ThirdParty/when ../Core/subdivideArray ../Core/Matrix4 ../Core/GeometryInstance ../Core/HeadingPitchRoll ../Scene/PrimitivePipeline ../Renderer/VertexArray ../Renderer/BufferUsage ../Renderer/ContextLimits ../Core/BoundingSphere ./FeRadarAppearance ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/Pass ../Renderer/DrawCommand ../Scene/ShadowMode ../Scene/BatchTable ../Core/IndexDatatype ../Core/clone ../Core/combine ../Core/defineProperties ../Core/Transforms ../Core/Color ../Core/Math ../Core/Matrix3 ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/EncodedCartesian3 ../Core/isArray ../Core/ComponentDatatype ../Core/destroyObject".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,F,aa,U,W,M,R,Y){function Q(a){a=e(a,e.EMPTY_OBJECT);this.geometryInstances=a.geometryInstances;this.appearance=a.appearance;this._material=this._appearance=void 0;this.depthFailAppearance=a.depthFailAppearance;this._depthFailMaterial=this._depthFailAppearance=void 0;this.modelMatrix=d.clone(e(a.modelMatrix,d.IDENTITY));this._modelMatrix=new d;this.show=e(a.show,!0);this._vertexCacheOptimize=e(a.vertexCacheOptimize,!1);this._interleave=e(a.interleave,!1);this._releaseGeometryInstances=e(a.releaseGeometryInstances,!0);this._allowPicking=e(a.allowPicking,!0);this._asynchronous=e(a.asynchronous,!0);this._compressVertices=e(a.compressVertices,!0);this.cull=e(a.cull,!0);this.debugShowBoundingVolume=e(a.debugShowBoundingVolume,!1);this.rtcCenter=a.rtcCenter;if(f(this.rtcCenter)&&(!f(this.geometryInstances)||M(this.geometryInstances)&&1!==this.geometryInstances))throw new DeveloperError("Relative-to-center rendering only supports one geometry instance.");this.shadows=e(a.shadows,I.DISABLED);this._translucent=void 0;this._state=b.READY;this._geometries=[];this._error=void 0;this._numberOfInstances=0;this._boundingSpheres=[];this._boundingSphereWC=[];this._boundingSphereCV=[];this._boundingSphere2D=[];this._boundingSphereMorph=[];this._perInstanceAttributeCache=[];this._instanceIds=[];this._lastPerInstanceAttributeIndex=0;this._va=[];this._backFaceDepthFailRS=this._frontFaceDepthFailRS=this._spDepthFail=this._depthFailAppearance=this._sp=this._backFaceRS=this._frontFaceRS=this._primitiveType=this._attributeLocations=void 0;this._pickIds=[];this._colorCommands=[];this._pickCommands=[];this._readOnlyInstanceAttributes=a._readOnlyInstanceAttributes;this._createBoundingVolumeFunction=a._createBoundingVolumeFunction;this._createRenderStatesFunction=a._createRenderStatesFunction;this._createShaderProgramFunction=a._createShaderProgramFunction;this._createCommandsFunction=a._createCommandsFunction;this._updateAndQueueCommandsFunction=a._updateAndQueueCommandsFunction;this._createPickOffsets=a._createPickOffsets;this._createGeometryResults=this._pickOffsets=void 0;this._ready=!1;this._readyPromise=h.defer();this._batchTableOffsetAttribute2DIndex=this._offsetInstanceExtend=this._batchTableAttributeIndices=this._batchTable=void 0;this._batchTableOffsetsUpdated=!1;this._tempBoundingSpheres=this._instanceBoundingSpheresCV=this._instanceBoundingSpheres=void 0;this._batchTableBoundingSpheresUpdated=this._recomputeBoundingSpheres=!1;this._geometryCreator=this._batchTableBoundingSphereAttributeIndices=void 0;this.zScale=this.yScale=this.xScale=this._scale=1;var c=e(a.position,void 0);if(f(c)&&c instanceof Array){2===c.length&&c.push(0);this._position=F.fromDegrees(c[0],c[1],c[2]);this._type=e(a.type,0);this.appearance=new z({});this._angleDegree=e(a.angle,30);this._circlePoint=e(a.circlePoint,120);this._radarLength=e(a.length,1E6);this._radius=e(a.radius,5E3);this._feGeometry=ca(this);c=f(this._feGeometry)?new k({feGeometry:this._feGeometry}):void 0;this._feGeometry=c;this.geometryInstances=[new q({geometry:this._feGeometry,appearance:new z({})})];this._animation=e(a.animation,!0);this._show=e(a.show,!0);this._heading=e(a.heading,0);this._pitch=e(a.pitch,0);this._roll=e(a.roll,0);this._maxWaveNum=10;this._waveNum=e(a.waveNum,this._maxWaveNum);this._edgeLength=this._radarLength/Math.cos(P.toRadians(this._angleDegree/2));this._waveWidth=e(a.waveWidth,1);this._waveWidth=0===this._type||1===this._type?.02*this._edgeLength*this._waveWidth:.02*this._radius*this._waveWidth;this._widthBetweenWave=5*this._waveWidth;this._waveStartOffset=0;this._moveSpeed=e(a.speed,1E5);this._startLengthArr=new Float32Array(this._maxWaveNum);this._baseColor=e(a.color,K.fromCssColorString("rgba(255,255,255,0.1)"));this._waveColor=e(a.waveColor,K.fromCssColorString("rgba(0,255,0,1.0)"));this._curStartLengthArr=new Float32Array(this._maxWaveNum);0!==this._type&&2!==this._type||Z(this);this._preTime=void 0;var g=this;this._uniforms={u_length:function(){return 0===this._type||1===this._type?g._edgeLength:g._radius},u_startlength:function(){return g._curStartLengthArr},u_waveWidth:function(){return g._waveWidth},u_baseColor:function(){return g._baseColor},u_waveColor:function(){return g._waveColor}}}}function Z(a){var b;b=0===a._type||1===a._type?a._edgeLength/a._waveNum:a._radius/a._waveNum;for(var c=0;c<a._maxWaveNum;++c)a._startLengthArr[c]=0,a._curStartLengthArr[c]=0;for(c=0;c<a._waveNum;c++)a._startLengthArr[c]=b*c+.5*b,a._curStartLengthArr[c]=a._startLengthArr[c]}function ca(a){var b=new g,c;c=0===a._type||1===a._type?a._radarLength*Math.tan(P.toRadians(a._angleDegree/2)):a._radius;var d,e=a._circlePoint;0===a._type||1===a._type?d=P.TWO_PI/(a._circlePoint-1):(e=Math.ceil(a._angleDegree/360*e),d=a._angleDegree/360*P.TWO_PI/(e-1));var f=e+1,h=3*f;c=new F(0,c,0);var k=0,l=0,m=3*(e-1),h=new Float64Array(h),m=J.createTypedArray(f,m),f=new Float32Array(2*f);h[k++]=0;h[k++]=0;h[k++]=1E-5;for(var p=a._angleDegree/360*.5,q=0;q<e;q++){var r=N.fromRotationZ(q*d-p),t=new F(0,0,0);N.multiplyByVector(r,c,t);if(0===a._type||1===a._type)t.z+=a._radarLength;h[k++]=t.x;h[k++]=t.y;h[k++]=t.z;0<q&&(m[l++]=0,m[l++]=q+1,m[l++]=q)}b.vertexArray=h;b.indexArray=m;b.textureArray=f;return b}function T(a,c){var g,k,l,q=a._instanceIds;if(a._state===b.READY){g=M(a.geometryInstances)?a.geometryInstances:[a.geometryInstances];var t=a._numberOfInstances=g.length,w=[],u=[];for(l=0;l<t;++l){k=g[l].geometry;q.push(g[l].id);if(!f(k._workerName))throw new DeveloperError("_workerName must be defined for asynchronous geometry.");u.push({moduleName:k._workerName,geometry:k})}if(!f(ta))for(ta=Array(ua),l=0;l<ua;l++)ta[l]=new m("createGeometry",Number.POSITIVE_INFINITY);u=p(u,ua);for(l=0;l<u.length;l++){var v=0,t=u[l],y=t.length;for(g=0;g<y;++g)q=t[g],k=q.geometry,f(k.constructor.pack)&&(q.offset=v,v+=e(k.constructor.packedLength,k.packedLength));var z;if(0<v)for(v=new Float64Array(v),z=[v.buffer],g=0;g<y;++g)q=t[g],k=q.geometry,f(k.constructor.pack)&&(k.constructor.pack(k,v,q.offset),q.geometry=v);w.push(ta[l].scheduleTask({subTasks:u[l]},z))}a._state=b.CREATING;h.all(w,function(c){a._createGeometryResults=c;a._state=b.CREATED}).otherwise(function(d){la(a,c,b.FAILED,d)})}else a._state===b.CREATED&&(k=[],g=M(a.geometryInstances)?a.geometryInstances:[a.geometryInstances],l=c.mapProjection,k=wa.scheduleTask(r.packCombineGeometryParameters({createGeometryResults:a._createGeometryResults,instances:g,ellipsoid:l.ellipsoid,projection:l,elementIndexUintSupported:c.context.elementIndexUint,scene3DOnly:c.scene3DOnly,vertexCacheOptimize:a._vertexCacheOptimize,compressVertices:a._compressVertices,modelMatrix:a.modelMatrix,createPickOffsets:a._createPickOffsets},k),k),a._createGeometryResults=void 0,a._state=b.COMBINING,h(k,function(e){e=r.unpackCombineGeometryResults(e);a._geometries=e.geometries;a._attributeLocations=e.attributeLocations;a.modelMatrix=d.clone(e.modelMatrix,a.modelMatrix);a._pickOffsets=e.pickOffsets;a._offsetInstanceExtend=e.offsetInstanceExtend;a._instanceBoundingSpheres=e.boundingSpheres;a._instanceBoundingSpheresCV=e.boundingSpheresCV;f(a._geometries)&&0<a._geometries.length?(a._recomputeBoundingSpheres=!0,a._state=b.COMBINED):la(a,c,b.FAILED,void 0)}).otherwise(function(d){la(a,c,b.FAILED,d)}))}function da(a,b,c){var d=b.context,e=a._attributeLocations,g=c.vertexShaderSource;c=c.getFragmentShaderSource();a._sp=D.replaceCache({context:d,shaderProgram:a._sp,vertexShaderSource:g,fragmentShaderSource:c,attributeLocations:e});ba(a._sp,e);if(f(a._depthFailAppearance)){g=a._batchTable.getVertexShaderCallback()(a._depthFailAppearance.vertexShaderSource);g=Q._appendShowToShader(a,g);g=Q._appendDistanceDisplayConditionToShader(a,g,b.scene3DOnly);g=v.replaceMain(g,"czm_non_pick_main")+"\nvarying vec4 v_pickColor; \nvoid main() \n{ \n    czm_non_pick_main(); \n    v_pickColor \x3d czm_batchTable_pickColor(batchId); \n}";g=Primitive._updateColorAttribute(a,g,!0);var h=g;if(a.compressVertices){var k=-1!==h.search(/attribute\s+vec3\s+normal;/g),l=-1!==h.search(/attribute\s+vec2\s+st;/g);if(k||l){var m=-1!==h.search(/attribute\s+vec3\s+tangent;/g),p=-1!==h.search(/attribute\s+vec3\s+bitangent;/g),q;q=(l&&k?2:1)+(m||p?1:0);var g="attribute "+(1<q?"vec"+q:"float")+" compressedAttributes;",r=c="";l&&(c+="vec2 st;\n",r+="    st \x3d czm_decompressTextureCoordinates("+(1<q?"compressedAttributes.x":"compressedAttributes")+");\n");k&&m&&p?(c+="vec3 normal;\nvec3 tangent;\nvec3 bitangent;\n",r+="    czm_octDecode(compressedAttributes."+(l?"yz":"xy")+", normal, tangent, bitangent);\n"):(k&&(c+="vec3 normal;\n",r+="    normal \x3d czm_octDecode(compressedAttributes"+(1<q?"."+(l?"y":"x"):"")+");\n"),m&&(c+="vec3 tangent;\n",r+="    tangent \x3d czm_octDecode(compressedAttributes."+(l&&k?"z":"y")+");\n"),p&&(c+="vec3 bitangent;\n",r+="    bitangent \x3d czm_octDecode(compressedAttributes."+(l&&k?"z":"y")+");\n"));h=h.replace(/attribute\s+vec3\s+normal;/g,"");h=h.replace(/attribute\s+vec2\s+st;/g,"");h=h.replace(/attribute\s+vec3\s+tangent;/g,"");h=h.replace(/attribute\s+vec3\s+bitangent;/g,"");h=v.replaceMain(h,"czm_non_compressed_main");g=[g,c,h,"void main() \n{ \n"+r+"    czm_non_compressed_main(); \n}"].join("\n")}else g=h}else g=h;g=Primitive._modifyShaderPosition(a,g,b.scene3DOnly);g=v.replaceMain(g,"czm_non_depth_clamp_main")+"varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n    vec4 position \x3d gl_Position;\n    v_WindowZ \x3d (0.5 * (position.z / position.w) + 0.5) * position.w;\n    position.z \x3d min(position.z, position.w);\n    gl_Position \x3d position;\n}\n";c=a._depthFailAppearance.getFragmentShaderSource();c="#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n"+(v.replaceMain("varying vec4 v_pickColor;\n"+c,"czm_non_depth_clamp_main")+"varying float v_WindowZ;\nvoid main() {\n    czm_non_depth_clamp_main();\n#if defined(GL_EXT_frag_depth) \x26\x26 !defined(LOG_DEPTH)\n    gl_FragDepthEXT \x3d min(v_WindowZ * gl_FragCoord.w, 1.0);\n#endif\n}\n");a._spDepthFail=D.replaceCache({context:d,shaderProgram:a._spDepthFail,vertexShaderSource:g,fragmentShaderSource:c,attributeLocations:e});ba(a._spDepthFail,e)}}function V(a){var b=a.length;if(1===b)return a[0];if(2===b)return O.unpack(a,0,ha);if(3===b)return F.unpack(a,0,pa);if(4===b)return aa.unpack(a,0,oa)}function ba(a,b){var c=a.vertexAttributes,d;for(d in c)if(c.hasOwnProperty(d)&&!f(b[d]))throw new DeveloperError("Appearance/Geometry mismatch.  The appearance requires vertex shader attribute input '"+d+"', which was not computed as part of the Geometry.  Use the appearance's vertexFormat property when constructing the geometry.");}function X(a,b){return function(){return a[b]}}function fa(a,b){if(f(a._batchTableAttributeIndices.offset)&&!a._batchTableOffsetsUpdated&&!b.scene3DOnly){for(var c=a._batchTableOffsetAttribute2DIndex,d=b.mapProjection,e=d.ellipsoid,g=a._batchTable,h=a._instanceBoundingSpheres,k=h.length,l=0;l<k;++l){var m=h[l];if(f(m)){var p=g.getBatchedAttribute(l,a._batchTableAttributeIndices.offset);if(F.equals(p,F.ZERO))g.setBatchedAttribute(l,c,F.ZERO);else{var q=a.modelMatrix;f(q)&&(m=A.transform(m,q,ra));var r=m.center,r=e.scaleToGeodeticSurface(r,Ga),q=e.cartesianToCartographic(r,Da),m=d.project(q,Ba),p=F.add(p,r,Ea),q=e.cartesianToCartographic(p,q),p=d.project(q,Ea),p=F.subtract(p,m,Ea),m=p.x;p.x=p.z;p.z=p.y;p.y=m;g.setBatchedAttribute(l,c,p)}}}a._batchTableOffsetsUpdated=!0}}function ga(a,b,c,d){b=c.getRenderState();d?(c=w(b,!1),c.cull={enabled:!0,face:CullFace.BACK},a._frontFaceRS=x.fromCache(c),c.cull.face=CullFace.FRONT,a._backFaceRS=x.fromCache(c)):(a._frontFaceRS=x.fromCache(b),a._backFaceRS=a._frontFaceRS);c=w(b,!1);f(a._depthFailAppearance)&&(c.depthTest.enabled=!1);f(a._depthFailAppearance)&&(b=a._depthFailAppearance.getRenderState(),c=w(b,!1),c.depthTest.func=DepthFunction.GREATER,d?(c.cull={enabled:!0,face:CullFace.BACK},a._frontFaceDepthFailRS=x.fromCache(c),c.cull.face=CullFace.FRONT,a._backFaceDepthFailRS=x.fromCache(c)):(a._frontFaceDepthFailRS=x.fromCache(c),a._backFaceDepthFailRS=a._frontFaceRS))}function ka(a,b,c,e){c=f(c)?c._uniforms:void 0;var g={};b=b.uniforms;if(f(b))for(var h in b)if(b.hasOwnProperty(h)){if(f(c)&&f(c[h]))throw new DeveloperError("Appearance and material have a uniform with the same name: "+h);g[h]=X(b,h)}h=G(g,c);h=a._batchTable.getUniformMapCallback()(h);f(a.rtcCenter)&&(h.u_modifiedModelView=function(){d.multiply(e.context.uniformState.view,a._modelMatrix,Ca);d.multiplyByPoint(Ca,a.rtcCenter,ya);d.setTranslation(Ca,ya,Ca);return Ca});return h}function na(a,b,c,d,e,g,h,k){b=a._uniforms;var l;f(a._depthFailAppearance)&&(l=ka(a,a._depthFailAppearance,a._depthFailAppearance.material,k));d=d?B.TRANSLUCENT:B.OPAQUE;k=(e?2:1)*(f(a._depthFailAppearance)?2:1);g.length=a._va.length*k;k=g.length;for(h=c=0;h<k;++h){var m;e&&(m=g[h],f(m)||(m=g[h]=new C({owner:a,primitiveType:a._primitiveType})),m.vertexArray=a._va[c],m.renderState=a._backFaceRS,m.shaderProgram=a._sp,m.uniformMap=b,m.pass=d,++h);m=g[h];f(m)||(m=g[h]=new C({owner:a,primitiveType:a._primitiveType}));m.vertexArray=a._va[c];m.renderState=a._frontFaceRS;m.shaderProgram=a._sp;m.uniformMap=b;m.pass=d;f(a._depthFailAppearance)&&(e&&(++h,m=g[h],f(m)||(m=g[h]=new C({owner:a,primitiveType:a._primitiveType})),m.vertexArray=a._va[c],m.renderState=a._backFaceDepthFailRS,m.shaderProgram=a._spDepthFail,m.uniformMap=l,m.pass=d),++h,m=g[h],f(m)||(m=g[h]=new C({owner:a,primitiveType:a._primitiveType})),m.vertexArray=a._va[c],m.renderState=a._frontFaceDepthFailRS,m.shaderProgram=a._spDepthFail,m.uniformMap=l,m.pass=d);++c}}function ia(b,c,e,g,h,k,l,m){if(c.mode!==a.SCENE3D&&!d.equals(h,d.IDENTITY))throw new DeveloperError("Primitive.modelMatrix is only supported in 3D mode.");Q._updateBoundingVolumes(b,c,h);var p;c.mode===a.SCENE3D?p=b._boundingSphereWC:c.mode===a.COLUMBUS_VIEW?p=b._boundingSphereCV:c.mode===a.SCENE2D&&f(b._boundingSphere2D)?p=b._boundingSphere2D:f(b._boundingSphereMorph)&&(p=b._boundingSphereMorph);g=c.commandList;c=c.passes;if(c.render||c.pick){c=b.allowPicking;var q=I.castShadows(b.shadows),r=I.receiveShadows(b.shadows),t=e.length;b=(m?2:1)*(f(b._depthFailAppearance)?2:1);for(m=0;m<t;++m){var w=Math.floor(m/b),u=e[m];u.modelMatrix=h;u.boundingVolume=p[w];u.cull=k;u.debugShowBoundingVolume=l;u.castShadows=q;u.receiveShadows=r;u.pickId=c?"v_pickColor":void 0;g.push(u)}}}function la(a,c,d,e){a._error=e;a._state=d;c.afterRender.push(function(){a._ready=a._state===b.COMPLETE||a._state===b.FAILED;f(e)?a._readyPromise.reject(e):a._readyPromise.resolve(a)})}E(Q.prototype,{position:{get:function(){return this._position},set:function(a){this._position=a}},show:{get:function(){return this._show},set:function(a){this._show=a}},animation:{get:function(){return this._animation},set:function(a){this._animation=a}},baseColor:{get:function(){return this._baseColor},set:function(a){this._baseColor=K.fromCssColorString(a)}},waveColor:{get:function(){return this._waveColor},set:function(a){this._waveColor=K.fromCssColorString(a)}},scale:{get:function(){return this._scale},set:function(a){this._scale=a}},speed:{get:function(){return this._moveSpeed},set:function(a){this._moveSpeed=a}},heading:{get:function(){return this._heading},set:function(a){this._heading=a}},pitch:{get:function(){return this._pitch},set:function(a){this._pitch=a}},roll:{get:function(){return this._roll},set:function(a){this._roll=a}},waveNum:{get:function(){return this._waveNum},set:function(a){this._waveNum=Math.min(a,this._maxWaveNum);Z(this)}},waveWidth:{get:function(){return this._waveWidth},set:function(a){this._waveWidth=0===this._type||1===this._type?.02*this._edgeLength*a:.02*this._radius*a}},waveStartOffset:{get:function(){return this._widthBetweenWave},set:function(a){this._widthBetweenWave=a;0!==this._type&&2!==this._type||Z(this)}},widthBetweenWave:{get:function(){return this._waveStartOffset},set:function(a){this._waveStartOffset=a;0!==this._type&&2!==this._type||Z(this)}}});var ha=new O,pa=new F,oa=new aa,qa=/attribute\s+vec(?:3|4)\s+(.*)3DHigh;/g;Q._modifyShaderPosition=function(a,b,c){for(var d,e="",g="",h="";null!==(d=qa.exec(b));){d=d[1];var k="vec4 czm_compute"+d[0].toUpperCase()+d.substr(1)+"()";"vec4 czm_computePosition()"!==k&&(e+=k+";\n");f(a.rtcCenter)?(b=b.replace(/attribute\s+vec(?:3|4)\s+position3DHigh;/g,""),b=b.replace(/attribute\s+vec(?:3|4)\s+position3DLow;/g,""),e+="uniform mat4 u_modifiedModelView;\n",g+="attribute vec4 position;\n",h+=k+"\n{\n    return u_modifiedModelView * position;\n}\n\n",b=b.replace(/czm_modelViewRelativeToEye\s+\*\s+/g,""),b=b.replace(/czm_modelViewProjectionRelativeToEye/g,"czm_projection")):c?h+=k+"\n{\n    return czm_translateRelativeToEye("+d+"3DHigh, "+d+"3DLow);\n}\n\n":(g+="attribute vec3 "+d+"2DHigh;\nattribute vec3 "+d+"2DLow;\n",h+=k+"\n{\n    vec4 p;\n    if (czm_morphTime \x3d\x3d 1.0)\n    {\n        p \x3d czm_translateRelativeToEye("+d+"3DHigh, "+d+"3DLow);\n    }\n    else if (czm_morphTime \x3d\x3d 0.0)\n    {\n        p \x3d czm_translateRelativeToEye("+d+"2DHigh.zxy, "+d+"2DLow.zxy);\n    }\n    else\n    {\n        p \x3d czm_columbusViewMorph(\n                czm_translateRelativeToEye("+d+"2DHigh.zxy, "+d+"2DLow.zxy),\n                czm_translateRelativeToEye("+d+"3DHigh, "+d+"3DLow),\n                czm_morphTime);\n    }\n    return p;\n}\n\n")}return[e,g,b,h].join("\n")};Q._appendShowToShader=function(a,b){return f(a._batchTableAttributeIndices.show)?v.replaceMain(b,"czm_non_show_main")+"\nvoid main() \n{ \n    czm_non_show_main(); \n    gl_Position *\x3d czm_batchTable_show(batchId); \n}":b};Q._updateColorAttribute=function(a,b,c){if(!f(a._batchTableAttributeIndices.color)&&!f(a._batchTableAttributeIndices.depthFailColor)||-1===b.search(/attribute\s+vec4\s+color;/g))return b;if(c&&!f(a._batchTableAttributeIndices.depthFailColor))throw new DeveloperError("A depthFailColor per-instance attribute is required when using a depth fail appearance that uses a color attribute.");a=b.replace(/attribute\s+vec4\s+color;/g,"");return a=c?a.replace(/(\b)color(\b)/g,"$1czm_batchTable_depthFailColor(batchId)$2"):a.replace(/(\b)color(\b)/g,"$1czm_batchTable_color(batchId)$2")};Q._updatePickColorAttribute=function(a){a=a.replace(/attribute\s+vec4\s+pickColor;/g,"");return a=a.replace(/(\b)pickColor(\b)/g,"$1czm_batchTable_pickColor(batchId)$2")};Q._appendOffsetToShader=function(a,b){if(!f(a._batchTableAttributeIndices.offset))return b;var c=b.replace(/attribute\s+float\s+batchId;/g,"attribute float batchId;\nattribute float applyOffset;");return c=c.replace(/vec4\s+([A-Za-z0-9_]+)\s+=\s+czm_computePosition\(\);/g,"vec4 $1 \x3d czm_computePosition();\n    if (czm_sceneMode \x3d\x3d czm_sceneMode3D)\n    {\n        $1 \x3d $1 + vec4(czm_batchTable_offset(batchId) * applyOffset, 0.0);    }\n    else\n    {\n        $1 \x3d $1 + vec4(czm_batchTable_offset2D(batchId) * applyOffset, 0.0);    }\n")};Q._appendDistanceDisplayConditionToShader=function(a,b,c){if(!f(a._batchTableAttributeIndices.distanceDisplayCondition))return b;a=v.replaceMain(b,"czm_non_distanceDisplayCondition_main");b="void main() \n{ \n    czm_non_distanceDisplayCondition_main(); \n    vec2 distanceDisplayCondition \x3d czm_batchTable_distanceDisplayCondition(batchId);\n    vec3 boundingSphereCenter3DHigh \x3d czm_batchTable_boundingSphereCenter3DHigh(batchId);\n    vec3 boundingSphereCenter3DLow \x3d czm_batchTable_boundingSphereCenter3DLow(batchId);\n    float boundingSphereRadius \x3d czm_batchTable_boundingSphereRadius(batchId);\n";return a+"\n"+((c?b+"    vec4 centerRTE \x3d czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n":b+"    vec3 boundingSphereCenter2DHigh \x3d czm_batchTable_boundingSphereCenter2DHigh(batchId);\n    vec3 boundingSphereCenter2DLow \x3d czm_batchTable_boundingSphereCenter2DLow(batchId);\n    vec4 centerRTE;\n    if (czm_morphTime \x3d\x3d 1.0)\n    {\n        centerRTE \x3d czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow);\n    }\n    else if (czm_morphTime \x3d\x3d 0.0)\n    {\n        centerRTE \x3d czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy);\n    }\n    else\n    {\n        centerRTE \x3d czm_columbusViewMorph(\n                czm_translateRelativeToEye(boundingSphereCenter2DHigh.zxy, boundingSphereCenter2DLow.zxy),\n                czm_translateRelativeToEye(boundingSphereCenter3DHigh, boundingSphereCenter3DLow),\n                czm_morphTime);\n    }\n")+"    float radiusSq \x3d boundingSphereRadius * boundingSphereRadius; \n    float distanceSq; \n    if (czm_sceneMode \x3d\x3d czm_sceneMode2D) \n    { \n        distanceSq \x3d czm_eyeHeight2D.y - radiusSq; \n    } \n    else \n    { \n        distanceSq \x3d dot(centerRTE.xyz, centerRTE.xyz) - radiusSq; \n    } \n    distanceSq \x3d max(distanceSq, 0.0); \n    float nearSq \x3d distanceDisplayCondition.x * distanceDisplayCondition.x; \n    float farSq \x3d distanceDisplayCondition.y * distanceDisplayCondition.y; \n    float show \x3d (distanceSq \x3e\x3d nearSq \x26\x26 distanceSq \x3c\x3d farSq) ? 1.0 : 0.0; \n    gl_Position *\x3d show; \n}")};var ua=Math.max(l.hardwareConcurrency-1,1),ta,wa=new m("combineGeometry",Number.POSITIVE_INFINITY),za=new W,Da=new U,Ba=new F,ra=new A,Ea=new F,Ga=new F,Ca=new d,ya=new F;Q._updateBoundingVolumes=function(a,b,c,e){var g,h;if(e||!d.equals(c,a._modelMatrix))for(d.clone(c,a._modelMatrix),g=a._boundingSpheres.length,e=0;e<g;++e)h=a._boundingSpheres[e],f(h)&&(a._boundingSphereWC[e]=A.transform(h,c,a._boundingSphereWC[e]),b.scene3DOnly||(a._boundingSphere2D[e]=A.clone(a._boundingSphereCV[e],a._boundingSphere2D[e]),a._boundingSphere2D[e].center.x=0,a._boundingSphereMorph[e]=A.union(a._boundingSphereWC[e],a._boundingSphereCV[e])));c=a.appearance.pixelSize;if(f(c))for(g=a._boundingSpheres.length,e=0;e<g;++e){h=a._boundingSpheres[e];var k=a._boundingSphereWC[e],l=b.camera.getPixelSize(h,b.context.drawingBufferWidth,b.context.drawingBufferHeight)*c;k.radius=h.radius+l}};Q.prototype.update=function(g){if(!(!f(this.geometryInstances)&&0===this._va.length||f(this.geometryInstances)&&M(this.geometryInstances)&&0===this.geometryInstances.length||!f(this.appearance)||g.mode!==a.SCENE3D&&g.scene3DOnly||!g.passes.render&&!g.passes.pick)){if(f(this._error))throw this._error;if(f(this.rtcCenter)&&!g.scene3DOnly)throw new DeveloperError("RTC rendering is only available for 3D only scenes.");if(this._state!==b.FAILED){var h=g.context;if(!f(this._batchTable)){var k=this.geometryInstances,k=M(k)?k:[k],l=k.length;if(0!==l){var m=k.length,p=[],q=k[0].attributes,r;for(r in q)if(q.hasOwnProperty(r)&&f(q[r])){for(var w=q[r],v=!0,z=1;z<m;++z){var E=k[z].attributes[r];if(!f(E)||w.componentDatatype!==E.componentDatatype||w.componentsPerAttribute!==E.componentsPerAttribute||w.normalize!==E.normalize){v=!1;break}}v&&p.push(r)}r=p.length;for(var z=[],m={},q={},C,E=k[0].attributes,B,G,w=0;w<r;++w)B=p[w],G=E[B],m[B]=w,z.push({functionName:"czm_batchTable_"+B,componentDatatype:G.componentDatatype,componentsPerAttribute:G.componentsPerAttribute,normalize:G.normalize});-1!==p.indexOf("distanceDisplayCondition")&&(z.push({functionName:"czm_batchTable_boundingSphereCenter3DHigh",componentDatatype:R.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter3DLow",componentDatatype:R.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DHigh",componentDatatype:R.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereCenter2DLow",componentDatatype:R.FLOAT,componentsPerAttribute:3},{functionName:"czm_batchTable_boundingSphereRadius",componentDatatype:R.FLOAT,componentsPerAttribute:1}),q.center3DHigh=z.length-5,q.center3DLow=z.length-4,q.center2DHigh=z.length-3,q.center2DLow=z.length-2,q.radius=z.length-1);-1!==p.indexOf("offset")&&(z.push({functionName:"czm_batchTable_offset2D",componentDatatype:R.FLOAT,componentsPerAttribute:3}),C=z.length-1);z.push({functionName:"czm_batchTable_pickColor",componentDatatype:R.UNSIGNED_BYTE,componentsPerAttribute:4,normalize:!0});v=z.length;z=new H(h,z,l);for(w=0;w<l;++w){for(var D=k[w],E=D.attributes,x=0;x<r;++x)B=p[x],G=E[B],G=V(G.value),z.setBatchedAttribute(w,m[B],G);E={primitive:e(D.pickPrimitive,this)};f(D.id)&&(E.id=D.id);E=h.createPickId(E);this._pickIds.push(E);E=E.color;B=oa;B.x=K.floatToByte(E.red);B.y=K.floatToByte(E.green);B.z=K.floatToByte(E.blue);B.w=K.floatToByte(E.alpha);z.setBatchedAttribute(w,v-1,B)}this._batchTable=z;this._batchTableAttributeIndices=m;this._batchTableBoundingSphereAttributeIndices=q;this._batchTableOffsetAttribute2DIndex=C}}if(0<this._batchTable.attributes.length){if(0===y.maximumVertexTextureImageUnits)throw new RuntimeError("Vertex texture fetch support is required to render primitives with per-instance attributes. The maximum number of vertex texture image units must be greater than zero.");this._batchTable.update(g)}this._state!==b.COMPLETE&&this._state!==b.COMBINED&&this._asynchronous&&T(this,g);if(this._state===b.COMBINED){if(f(this._batchTableAttributeIndices.distanceDisplayCondition)&&!this._batchTableBoundingSpheresUpdated){r=this._batchTableBoundingSphereAttributeIndices;C=r.center3DHigh;k=r.center3DLow;l=r.center2DHigh;p=r.center2DLow;r=r.radius;m=g.mapProjection;q=m.ellipsoid;w=this._batchTable;v=this._instanceBoundingSpheres;z=v.length;for(E=0;E<z;++E)B=v[E],f(B)&&(D=this.modelMatrix,f(D)&&(B=A.transform(B,D,ra)),D=B.center,B=B.radius,G=W.fromCartesian(D,za),w.setBatchedAttribute(E,C,G.high),w.setBatchedAttribute(E,k,G.low),g.scene3DOnly||(D=q.cartesianToCartographic(D,Da),D=m.project(D,Ba),G=W.fromCartesian(D,za),w.setBatchedAttribute(E,l,G.high),w.setBatchedAttribute(E,p,G.low)),w.setBatchedAttribute(E,r,B));this._batchTableBoundingSpheresUpdated=!0}fa(this,g);C=this._attributeLocations;k=this._geometries;l=g.scene3DOnly;p=g.context;r=[];m=k.length;for(q=0;q<m;++q)w=k[q],r.push(c.fromGeometry({context:p,geometry:w,attributeLocations:C,bufferUsage:u.STATIC_DRAW,interleave:this._interleave})),f(this._createBoundingVolumeFunction)?this._createBoundingVolumeFunction(g,w):(this._boundingSpheres.push(A.clone(w.boundingSphere)),this._boundingSphereWC.push(new A),l||(v=w.boundingSphereCV.center,z=v.x,E=v.y,v.x=v.z,v.y=z,v.z=E,this._boundingSphereCV.push(A.clone(w.boundingSphereCV)),this._boundingSphere2D.push(new A),this._boundingSphereMorph.push(new A)));this._va=r;this._primitiveType=k[0].primitiveType;this.releaseGeometryInstances&&(this.geometryInstances=void 0);this._geometries=void 0;la(this,g,b.COMPLETE,void 0)}if(this.show&&this._state===b.COMPLETE){this._batchTableOffsetsUpdated||fa(this,g);if(this._recomputeBoundingSpheres){p=this._batchTableAttributeIndices.offset;if(this._recomputeBoundingSpheres&&f(p)){r=this._instanceBoundingSpheres;k=r.length;l=this._tempBoundingSpheres;if(!f(l)){l=Array(k);for(C=0;C<k;C++)l[C]=new A;this._tempBoundingSpheres=l}for(C=0;C<k;++C)m=l[C],this._batchTable.getBatchedAttribute(C,p,new F),r[C].clone(m);p=[];r=[];m=[];for(C=0;C<k;++C)q=l[C],0<q.center.x-q.radius||A.intersectPlane(q,Plane.ORIGIN_ZX_PLANE)!==Intersect.INTERSECTING?p.push(q):(r.push(q),m.push(q));k=p[0];l=m[0];q=r[0];for(C=1;C<p.length;C++)k=A.union(k,p[C]);for(C=1;C<m.length;C++)l=A.union(l,m[C]);for(C=1;C<r.length;C++)q=A.union(q,r[C]);p=[];f(k)&&p.push(k);f(l)&&p.push(l);f(q)&&p.push(q);for(C=0;C<p.length;C++)k=p[C].clone(this._boundingSpheres[C]),this._boundingSpheres[C]=k,this._boundingSphereCV[C]=A.projectTo2D(k,g.mapProjection,this._boundingSphereCV[C]);Primitive._updateBoundingVolumes(this,g,this.modelMatrix,!0)}this._recomputeBoundingSpheres=!1}k=this.appearance;l=k.material;r=p=!1;this._appearance!==k?(this._appearance=k,this._material=l,r=p=!0):this._material!==l&&(this._material=l,r=!0);C=this.depthFailAppearance;m=f(C)?C.material:void 0;this._depthFailAppearance!==C?(this._depthFailAppearance=C,this._depthFailMaterial=m,r=p=!0):this._depthFailMaterial!==m&&(this._depthFailMaterial=m,r=!0);m=this._appearance.isTranslucent();this._translucent!==m&&(this._translucent=m,p=!0);f(this._material)&&this._material.update(h);C=k.closed&&m;p&&e(this._createRenderStatesFunction,ga)(this,h,k,C);r&&e(this._createShaderProgramFunction,da)(this,g,k);(p||r)&&e(this._createCommandsFunction,na)(this,k,l,m,C,this._colorCommands,this._pickCommands,g);h=d.clone(d.IDENTITY);k=Cesium.Matrix3.fromScale(new Cesium.Cartesian3(this.xScale,this.yScale,this.zScale));d.multiplyByMatrix3(h,k,h);k=0===this._type||1===this._type?N.fromHeadingPitchRoll(new t(P.toRadians(this._heading-90),P.toRadians(this._pitch-90),P.toRadians(this._roll)),new N):N.fromHeadingPitchRoll(new t(P.toRadians(this._heading),P.toRadians(this._pitch),P.toRadians(this._roll)),new N);d.multiplyByMatrix3(h,k,h);d.multiplyByUniformScale(h,this.scale,h);k=L.eastNorthUpToFixedFrame(this.position);d.multiply(k,h,h);this.modelMatrix=d.clone(h);if((0===this._type||2===this._type)&&this._animation){h=g.time.secondsOfDay;f(this._preTime)||(this._preTime=h);k=Math.abs(h-this._preTime);for(l=0;l<this._waveNum;l++)this._curStartLengthArr[l]=0===this._type||1===this._type?(this._curStartLengthArr[l]+k*this._moveSpeed)%this._edgeLength:(this._curStartLengthArr[l]+k*this._moveSpeed)%this._radius;this._preTime=h}e(this._updateAndQueueCommandsFunction,ia)(this,g,this._colorCommands,this._pickCommands,this.modelMatrix,this.cull,this.debugShowBoundingVolume,C)}}}};new A;new A;new F;Q.prototype.getGeometryInstanceAttributes=function(a){};Q.prototype.isDestroyed=function(){};Q.prototype.destroy=function(){};return Q});F("FeSceneEx/FeSatelliteManager","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/OrthographicFrustum ../Core/Intersect ../Core/EllipsoidalOccluder ../Core/BoundingSphere ../DataSources/Entity ../ThirdParty/when ../Scene/ShadowMode ../Scene/PointPrimitive ../Scene/Billboard ../Scene/Model ../Core/TaskProcessor ../Core/ScreenSpaceEventType ../Core/Matrix4 ../Core/Matrix3 ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/HeadingPitchRoll ../Core/Math ../Core/Quaternion ../Core/Transforms ../Core/Resource ../Core/Color ../Core/JulianDate ../Core/getTimestamp ../Core/Ellipsoid ../Core/DistanceDisplayCondition ../Core/buildModuleUrl ../Core/isCrossOriginUrl ../Core/Cartographic".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N){function O(d){function e(a){for(var b=0;b<a.length;++b)h.resourceMap.has(a[b].type)||h.resourceMap.set(a[b].type,[]),h.resourceMap.get(a[b].type).push(a[b])}function f(a){for(var b=[],c=[],d=0;d<a.length;++d){var e=a[d].split(".")[1];"json"==e?c.push(H.fetchJson({url:a[d]}).then(function(a){return[a]})):"tle"==e&&function(b){var d=a[b].slice(a[b].lastIndexOf("/")+1,a[b].lastIndexOf("."));c.push(H.fetchText({url:a[b]}).then(function(a){return[a,d]}))}(d)}return p.all(c).then(function(a){for(var c=0;c<a.length;++c)if("object"==typeof a[c][0])b=b.concat(a[c][0]);else if("string"==typeof a[c][0]){var d;d=a[c][0];var e=a[c][1];d=d.split("\n");var f="",h;for(h=0;h<d.length;h+=3)var k=""+d[h+1],k=k.substr(2,6).trim(),l=""+d[h+1],l=l.trim("\n"),m=""+d[h+2],m=m.trim("\n"),p=""+d[h],p="0"==d[h][0]&&" "==d[h][1]?p.slice(2,p.length).trim("\n"):p.trim("\n"),f=f+(0==h?'{\n    "intldes":"'+k+'",\n    "name":"'+p+'",\n    "type": "'+e+'",\n    "tle1":"'+l+'",\n    "tle2":"'+m+'"\n}':',{\n    "intldes":"'+k+'",\n    "name":"'+p+'",\n    "type": "'+e+'",\n    "tle1":"'+l+'",\n    "tle2":"'+m+'"\n}');d=f;d="["+d+"]";d=JSON.parse(d);b=b.concat(d)}return g(b)})}function g(a){for(var b=[],c=new Map,d={},e=0;e<a.length;d={type:d.type},++e)if(d.type=a[e].type,"DEBRIS"!=d.type&&"TBA"!=d.type){if("PAYLOAD"==d.type||"ROCKET BODY"==d.type)a[e].type="debris",d.type="debris";var f=h.resourceMap.get(d.type);if(!f){for(var f=h._map.modelConfig.satelliteList,g=[],k=0;k<f.length;++k)f[k].type==d.type&&g.push(f[k]);if(0<g.length)f=g;else{c.set(d.type,d.type+"\u7c7b\u578b\u6ca1\u6709\u5339\u914d\u5230\u8d44\u6e90\u6587\u4ef6");continue}}g=f.length;for(k=-1;0>k||k>g-1;)k=Math.floor(10*Math.random());g=f[k];h.tleInfoMap.has(d.type)||(h.allSatelliteType.push(d.type),h.tleInfoMap.set(d.type,[]));f=64;"debris"==d.type&&(f=18);h.entityModelMap.has(d.type)||(k=h._map.entities.add({show:!1,position:new Cesium.CallbackProperty(function(a){return function(b,c){var d=h.entityModelMap.get(a.type).position;return d?d:void 0}}(d),!1),orientation:new Cesium.CallbackProperty(function(a){return function(b,c){var d=h.entityModelMap.get(a.type).orientation;return d?d:void 0}}(d),!1),model:{uri:g.modelUrl,minimumPixelSize:f}}),k.getType=function(){return"model"},k.getEntity=function(){return this},k.setVisible=function(a){this.show=a},h.entityModelMap.set(d.type,{entityModel:k,position:x.fromDegrees(130,40,1E4),orientation:C.clone(C.IDENTITY)}));if(!h.billboardModelMap.has(d.type)){k=new Cesium.BillboardCollection;h._map.scene.primitives.add(k);var l=new Cesium.PrimitiveCollection;h._map.scene.primitives.add(l);h.billboardModelMap.set(d.type,{billboards:k,models:l})}var l=h.billboardHeight,m=h.billboardWidth;"debris"==d.type&&(l*=.6,m*=.6);var k=g.modelUrl,q=void 0;k&&(q=new L(h.visibleDistance[1]));var g=h.billboardModelMap.get(d.type).billboards.add({show:!0,position:new x(1E3,0,0),image:g.imageUrl,height:l,width:m,distanceDisplayCondition:q}),t;k&&(t=h.billboardModelMap.get(d.type).models.add(r.fromGltf({url:k,show:!0,modelMatrix:y.clone(y.IDENTITY),scale:1,minimumPixelSize:f,allowPicking:!0,debugShowBoundingVolume:!1,debugWireframe:!1,asynchronous:!1,distanceDisplayCondition:new L(h.visibleDistance[0],h.visibleDistance[1])})),b.push(t.readyPromise));f=new F({billboard:g,model:t,type:d.type,tleInfo:a[e],sateInfo:{sateName:a[e].name}});g.sateObj=f;t.sateObj=f;h.sateObjArr.push(f);f.tleInfo.sateObjArrIndex=h.sateObjArr.length-1;a[e].geoPosition=void 0;(g=h.tleInfoMap.get(d.type))&&g.push(f.tleInfo)}c.forEach(function(a){console.log(a)});a=p.all(b).then(function(a){h.loadFinished=!0});return[h,a]}d=b(d,b.EMPTY_OBJECT);var h=this;this.configUrl=b(d.configUrl,void 0);if(a(this.configUrl)){this.corridinateSystem=b(d.corridinateSystem,W.ECI);this._map=b(d.mapObject,void 0);this.onlyOrbit=void 0;this.onlyOrbitPositions=[];this.allSatelliteType=[];this.needUpdateType=[];this.resourceMap=new Map;this.tleInfoMap=new Map;this.threadResGroup=[];this.billboardModelMap=new Map;this.entityModelMap=new Map;this.entityModelPositionArr=[];this.sateObjArr=[];this.loadFinished=!1;this._sateliteNameArr=[];this._mapSateliteInfo=new Map;this.visibleDistance=b(d.visibleDistance,[0,6E6]);this._satePosArrReady=this._satePosArrUpdating=!1;this.orbitSateObj=this.focusSateObj=this.curHoverSate=void 0;this.billboardHeight=b(d.billboardHeight,10);this.billboardWidth=b(d.billboardWidth,10);this.orbitWidth=b(d.orbitWidth,2);this.orbitColor=b(d.orbitColor,"rgba(0,255,0,1)");this.ECEFTaskProcessor=new c("FeECEFUpdateSateliteRealPosition");this.ECITaskProcessorPool=[];this.ECIPoolIndex=0;this.ECITaskProcessorPool.push(new c("FeECIUpdateSateliteRealPosition",3));this.ECIOrbitTaskProcessor=new c("FeECIUpdateOrbit");if("string"==typeof h.configUrl)return H.fetchJson({url:h.configUrl}).then(function(a){e(a.satelliteList);return f(a.satelliteTleUrl)});if("object"==typeof h.configUrl)return e(h.configUrl.satelliteList),f(h.configUrl.satelliteTleUrl)}}function F(a){a=b(a,{});this._model=b(a.model,void 0);this._billboard=b(a.billboard,void 0);this._orbit=b(a.oribt,void 0);this.mountEffects=b(a.mountEffects,[]);this.randomRoll=180*Math.random()-90;this.type=b(a.type,void 0);this.tleInfo=b(a.tleInfo,void 0);this.isFocus=!1;this.sateInfo=b(a.sateInfo,{});this.parseTle();this.lastPosition=new x(1E4,0,0);this.orientation=C.clone(C.IDENTITY);this.visible=!0}function aa(a,b){a.onlyOrbitPositions=b;a.onlyOrbit||(a.onlyOrbit=a._map.entities.add(new h({polyline:{positions:new Cesium.CallbackProperty(function(b,c){return a.onlyOrbitPositions},!1),arcType:Cesium.ArcType.NONE,width:a.orbitWidth,material:J.fromCssColorString(a.orbitColor)}})));return a.onlyOrbit}function U(a){if(a instanceof Array){if(!(isNaN(a[0])||isNaN(a[1])||isNaN(a[2])||0==a[0]&&0==a[1]&&0==a[2]))return!1}else if(a instanceof Object&&!(isNaN(a.x)||isNaN(a.y)||isNaN(a.z)||0==a.x&&0==a.y&&0==a.z))return!1;return!0}function W(){}O.prototype.getTypeNameByType=function(a){if((a=this.resourceMap.get(a))&&!(0>=a.length)&&(a=a[0]))return a.name};O.prototype.getSateObjsByType=function(a){a=this.tleInfoMap.get(a);if(!a)return[];for(var b=[],c=0;c<a.length;++c)b.push(this.sateObjArr[a[c].sateObjArrIndex]);return b};O.prototype.focusSate=function(a){if(a&&a instanceof F){this.focusSateObj&&this.disFocusSate();this.focusSateObj=a;this.focusSateObj.isFocus=!0;this.setOrbitSateObj(this.focusSateObj);this.focusSateObj._model.show=!1;a=this.entityModelMap.get(this.focusSateObj.type).entityModel;a.primitiveModel=this.focusSateObj._model;a.show=!0;this._map.manipulator.setSelectModel(a);var b=new Cesium.BoundingSphere;this._map._dataSourceDisplay.getBoundingSphere(a,!1,b);0==b.radius?this._map.manipulator.setRangeHeight(250):this._map.manipulator.setRangeHeight(10*b.radius);this._map.manipulator.setType("third")}};O.prototype.disFocusSate=function(){this._map.manipulator.setType("freedom");if(this.focusSateObj){this.focusSateObj._model.show=!0;var a=this.entityModelMap.get(this.focusSateObj.type).entityModel;a.show=!1;a.primitiveModel=void 0;this.focusSateObj.isFocus=!1;this.focusSateObj=void 0}};O.prototype.getSateObjByID=function(a){for(var b=0;b<this.sateObjArr.length;++b)if(this.sateObjArr[b].sateInfo.noradID==a)return this.sateObjArr[b]};O.prototype.getPositionByID=function(a){if((a=this.getSateObjByID(a))&&a.getPosition)return a.getPosition()};f(O.prototype,{});O.prototype.getResourceByType=function(a){return this.resourceMap.get(a)};O.prototype.addResourceUrlByType=function(a,b){this.resourceMap.set(a,b)};F.prototype.hover=function(a){var b=!0;a||(b=!1);this._orbit&&(this._orbit.show=b);this.isHovering=a};F.prototype.setVisible=function(a){this.visible=a;this._billboard&&(this._billboard.show=a);this._model&&(this._model.notUpdate=!a);a=this.mountEffects;for(var b=0;b<a.length;++b)a[b].setVisible(this.visible)};F.prototype.setExclude=function(a){var b=!0;this.visible?b=a:this.visible||(b=!1);this._billboard&&(this._billboard.show=b);this._model&&(this._model.notUpdate=!b)};F.prototype.loadOrbit=function(a){};F.prototype.getSateInfo=function(){return this.sateInfo};F.prototype.addEffect=function(a){this.mountEffects.push(a)};F.prototype.deleteEffect=function(a){for(var b=0;b<this.mountEffects.length;++b)a==this.mountEffects[b]&&(this.mountEffects=this.mountEffects.slice(0,b).concat(this.mountEffects.slice(b+1,this.mountEffects.length)))};new A;var M=C.clone(C.IDENTITY),R=A.clone(A.IDENTITY),Y=A.clone(A.IDENTITY),Q=A.clone(A.IDENTITY),S=A.clone(A.IDENTITY),ca=new x(0,0,0),T=new x(0,0,0),da=new v(0,0,0);F.prototype.setPosition=function(a,b){T=a instanceof Array?x.fromRadians(a[0],a[1],a[2],E.WGS84,T):x.fromArray([a.x,a.y,a.z],0,T);for(var c,d=0;d<this.mountEffects.length;++d)c=this.mountEffects[d],this.showEffect&&c.setVisible(!0),c instanceof FeScanRibbon||c instanceof FeRibbon?c.addPositionAndHpr(T,this.hpr):c.setPositionAndHpr&&c.setPositionAndHpr(T,this.hpr?this.hpr:[0,0,0]);if(!x.equals(T,this.lastPosition)||b){this._billboard.position=T;c=I.eastNorthUpToFixedFrame(this._billboard.position,E.WGS84,new y);if(this.lastPosition){Y=y.getRotation(c,Y);if("debris"!=this.type){ca=b?x.subtract(new Cesium.Cartesian3(b.x,b.y,b.z),this._billboard.position,ca):x.subtract(this._billboard.position,this.lastPosition,ca);S=A.inverse(Y,S);ca=A.multiplyByVector(S,ca,ca);var e=x.UNIT_Y,f=x.normalize(ca,ca),d=x.cross(e,f,new x(0,0,0)),e=B.acosClamped(x.dot(e,f)/(x.magnitude(e)*x.magnitude(f))),d=C.fromAxisAngle(d,e,new C(0,0,0,0));Q=A.fromQuaternion(d,new A);M=C.fromRotationMatrix(Q,M);da=v.fromQuaternion(M,da);this.hpr=[B.toDegrees(da.heading),B.toDegrees(da.pitch),B.toDegrees(da.roll)];Q=A.multiply(Q,A.fromRotationZ(B.toRadians(-90)),Q);if("GLONASS"==this.type||"GALILEO"==this.type)Q=A.multiply(Q,A.fromRotationY(B.toRadians(90)),Q),Q=A.multiply(Q,A.fromRotationX(B.toRadians(180)),Q)}this.isFocus&&(R=A.multiply(Y,Q,R),this.orientation=C.fromRotationMatrix(R,this.orientation));c=y.multiplyByMatrix3(c,Q,c);this._model.modelMatrix=y.clone(c);this.lastPosition=this._billboard.position.clone(this.lastPosition)}this.tleInfo.geoPosition=this._billboard.position}};F.prototype.getPosition=function(){return this.tleInfo.geoPosition};F.prototype.getID=function(){return this.sateInfo.noradID};F.prototype.getType=function(){return this.type};F.prototype.parseTle=function(){var a=this.tleInfo.tle2;this.sateInfo.noradID=a.substr(2,5).trim();this.sateInfo.inclination=parseFloat(a.substr(8,8));this.sateInfo.rAscension=parseFloat(a.substr(17,8));this.sateInfo.eccentricity=parseFloat("0."+a.substr(26,7));this.sateInfo.perigee=parseFloat(a.substr(34,8));this.sateInfo.meanAnomaly=parseFloat(a.substr(44,7));this.sateInfo.epoch=parseFloat(a.substr(52,11))};new x;new x;new x;new E(6378137,6378137,6356752.314245179);new e(x.ZERO,1);O.prototype.setOrbitColor=function(a){this.onlyOrbit?this.onlyOrbit.polyline.material.color=J.fromCssColorString(a):this.orbitColor=a};O.prototype.getAllType=function(){return this.allSatelliteType};O.prototype.setVisibleByID=function(a,b){var c=this.getSateObjByID(b);c==this.focusSateObj&&this.disFocusSate();c==this.curHoverSate&&this.setCurHoverSate(void 0);c&&c.setVisible&&c.setVisible(a)};O.prototype.addNeedUpdateType=function(a){if("string"==typeof a){for(var b=0;b<this.needUpdateType.length;++b)if(this.needUpdateType[b]==a)return;this.needUpdateType.push(a);this.billboardModelMap.get(a).billboards.notUpdate=!1;this.billboardModelMap.get(a).models.show=!0}};O.prototype.deleteNotNeedUpdateType=function(a){this.curHoverSate&&this.curHoverSate.type==a&&this.setCurHoverSate(void 0);this.focusSateObj&&this.focusSateObj.type==a&&this.disFocusSate();for(var b=0;b<this.needUpdateType.length;++b)this.needUpdateType[b]==a&&(this.needUpdateType=this.needUpdateType.slice(0,b).concat(this.needUpdateType.slice(b+1,this.needUpdateType.length)),this.billboardModelMap.get(a).billboards.notUpdate=!0,this.billboardModelMap.get(a).models.show=!1)};O.prototype.setOrbitSateObj=function(a){a&&a instanceof F?(this.orbitSateObj&&(this.orbitSateObj.tleInfo.requestOrbit=!1),this.orbitSateObj=a,this.orbitSateObj.tleInfo.requestOrbit=!0,this.onlyOrbit&&(this.onlyOrbit._show=!0),a=this.getResourceByType(a.type),this.setOrbitColor(a[0].orbitColor)):(this.orbitSateObj&&(this.orbitSateObj.tleInfo.requestOrbit=!1),this.orbitSateObj=void 0,this.onlyOrbit&&(this.onlyOrbit._show=!1))};O.prototype.getCurHoverSate=function(a){return this.curHoverSate};O.prototype.setCurHoverSate=function(a){a&&a instanceof F?this.focusSateObj?this.curHoverSate=a:(this.curHoverSate&&this.curHoverSate!=a&&this.setOrbitSateObj(void 0),this.curHoverSate=a,this.setOrbitSateObj(this.curHoverSate)):this.focusSateObj||this.setOrbitSateObj(void 0)};W.ECEF="ECEF";W.ECI="ECI";O.prototype.update=function(b){function c(a){var b,c;if(a&&a.satelineInfoArr)for(var d=0;d<a.satelineInfoArr.length;++d)if(!e.orbitSateObj||e.orbitSateObj.tleInfo.sateObjArrIndex!=a.satelineInfoArr[d].sateObjArrIndex){var f;b=a.satelineInfoArr[d].sateObjArrIndex;b=e.sateObjArr[b];f=a.satelineInfoArr[d].geoPosition;c=a.satelineInfoArr[d].satelinePosArr;f&&!U(f)?b.setPosition(f):f||b.setVisible(!1);e.focusSateObj==b&&(e.entityModelMap.get(e.focusSateObj.type).position=e.focusSateObj._billboard.position,e.entityModelMap.get(e.focusSateObj.type).orientation=e.focusSateObj.orientation);c&&e.corridinateSystem==W.ECEF&&(e.focusSateObj==b?(c=aa(e,x.fromRadiansArrayHeights(c)),e.focusSateObj._orbit=c,e.focusSateObj._orbit._show=!0):e.curHoverSate==b?(c=aa(e,x.fromRadiansArrayHeights(c)),e.curHoverSate&&(e.curHoverSate._orbit=void 0),e.curHoverSate=b,b._orbit=c,e.curHoverSate.hover(!0)):e.onlyOrbit.show=!1)}}function d(a,b){for(var c=0,d=a[0].timestamp,e=1;e<a.length;++e)a[e].timestamp>d&&(c=e);return c}var e=this;if(e.loadFinished){e.focusSateObj&&"freedom"==e._map.manipulator.type&&(b=e.focusSateObj.sateInfo.noradID,e.disFocusSate(),e.setCurHoverSate(this.getSateObjByID(b)));var f=e._map.clock._currentTime;this.lastUpdateTime?f.equals(this.lastUpdateTime)?this.pause=!0:this.pause=!1:this.lastUpdateTime=f;this.lastUpdateTime=f;var g=Cesium.JulianDate.toDate(f).getTime(),h;b=[];var k=[];e.corridinateSystem==W.ECI?h=Cesium.JulianDate.toDate(f):e.corridinateSystem==W.ECEF&&(h=(g-288E5-946730761604)/864E5);(function(){function a(a,b){var c=b.init,d=b.ep,e=b.inclp,f=b.nodep,k=b.argpp,l=b.mp,m=b.opsmode,p,q,r,t,w,u,v,y,z,E,A,C,B,G,D,x,H;v=a.e3;var L=a.ee2;q=a.peo;p=a.pgho;r=a.pho;t=a.pinco;var K=a.plo;C=a.se2;var I=a.se3;B=a.sgh2;var J=a.sgh3,O=a.sgh4;G=a.sh2;var T=a.sh3;x=a.si2;var M=a.si3;H=a.sl2;var R=a.sl3,Q=a.sl4,P=a.t;y=a.xgh2;var N=a.xgh3,F=a.xgh4;z=a.xh2;var V=a.xh3;E=a.xi2;var da=a.xi3;A=a.xl2;var Y=a.xl3,Z=a.xl4,aa=a.zmol;u=a.zmos;w=u+1.19459E-5*P;"y"===c&&(w=u);u=w+.0335*Math.sin(w);D=Math.sin(u);w=.5*D*D-.25;u=-.5*D*Math.cos(u);C=C*w+I*u;x=x*w+M*u;H=H*w+R*u+Q*D;B=B*w+J*u+O*D;G=G*w+T*u;w=aa+1.5835218E-4*P;"y"===c&&(w=aa);u=w+.1098*Math.sin(w);D=Math.sin(u);w=.5*D*D-.25;u=-.5*D*Math.cos(u);E=x+(E*w+da*u);A=H+(A*w+Y*u+Z*D);y=B+(y*w+N*u+F*D);z=G+(z*w+V*u);"n"===c&&(E-=t,A-=K,y-=p,z-=r,e+=E,d+=C+(L*w+v*u)-q,r=Math.sin(e),q=Math.cos(e),.2<=e?(z/=r,k+=y-q*z,f+=z,l+=A):(t=Math.sin(f),p=Math.cos(f),c=r*t+(z*p+E*q*t),p=r*p+(-z*t+E*q*p),f%=h,0>f&&"a"===m&&(f+=h),r=A+y-E*f*r,k=l+k+q*f+r,r=f,f=Math.atan2(c,p),0>f&&"a"===m&&(f+=h),Math.abs(r-f)>g&&(f=f<r?f+h:f-h),l+=A,k=k-l-q*f));return{ep:d,inclp:e,nodep:f,argpp:k,mp:l}}function b(a){a=(a-2451545)/36525;a=(-6.2E-6*a*a*a+.093104*a*a+3.164400184812866E9*a+67310.54841)*k/240%h;0>a&&(a+=h);return a}function c(a,b,c,d,e,f){return 367*a-Math.floor(1.75*(a+Math.floor((b+9)/12)))+Math.floor(275*b/9)+c+1721013.5+((f/60+e)/60+d)/24}function d(b,c){var d,e,f,k,m,q,r,t,w,u,v,y,z,E,A,C,B,G,D,x,H,L,K,I,J,O,T,M,R,Q,P,N,F,V,da,Y,Z,aa,U,ba,S,X,W,ca,la,fa,wa,ra,ta,Ca,Ea,ha,za,Ga,oa,Ba,ga,ia,pa,ya,Aa,Da,qa,ka,sa,Ua,na,ua,Ob,lb,Va,Cb,wb,xb,rb,yb=0,oc=6378.137*l/60;b.t=c;b.error=0;lb=b.mo+b.mdot*b.t;var sb=b.argpo+b.argpdot*b.t;wb=b.nodeo+b.nodedot*b.t;V=sb;qa=lb;ca=b.t*b.t;sa=wb+b.nodecf*ca;ha=1-b.cc1*b.t;za=b.bstar*b.cc4*b.t;Ga=b.t2cof*ca;if(1!==b.isimp){R=b.omgcof*b.t;var Sb=1+b.eta*Math.cos(lb);M=b.xmcof*(Sb*Sb*Sb-b.delmo);ta=R+M;qa=lb+ta;V=sb-ta;la=ca*b.t;fa=la*b.t;ha=ha-b.d2*ca-b.d3*la-b.d4*fa;za+=b.bstar*b.cc5*(Math.sin(qa)-b.sinmao);Ga=Ga+b.t3cof*la+fa*(b.t4cof+b.t*b.t5cof)}ka=b.no;var Pb=b.ecco;Da=b.inclo;if("d"===b.method){wa=b.t;var $b,Pa,Db,Eb,eb,ea,Qb,bb,cb,Ya,Fb=b.irez,Ac=b.d2201,Xa=b.d2211,pc=b.d3210,ic=b.d3222,ob=b.d4410,Kb=b.d4422,Rb=b.d5220,ub=b.d5232,jc=b.d5421,jb=b.d5433,Jb=b.dedt,Gb=b.del1,kb=b.del2,Lb=b.del3,kc=b.didt,Vb=b.dmdt,Tb=b.dnodt,fb=b.domdt,zb=b.argpo,Mb=b.argpdot,$a=b.t,lc=b.xfact,qc=b.xlamo,mc=b.no,bc=b.atime,kd=Pb,Hc=V,pb=Da,Bb=b.xli,ld=qa,Wc=b.xni,Cc=sa,fd=ka,qd=0;Db=(b.gsto+.0043752690880113*wa)%h;kd+=Jb*$a;pb+=kc*$a;Hc+=fb*$a;Cc+=Tb*$a;ld+=Vb*$a;Pa=0;if(0!==Fb){if(0===bc||0>=$a*bc||Math.abs($a)<Math.abs(bc))bc=0,Wc=mc,Bb=qc;$b=0<$a?720:-720;for(var gd=381;381===gd;)2!==Fb?(cb=Gb*Math.sin(Bb-.13130908)+kb*Math.sin(2*(Bb-2.8843198))+Lb*Math.sin(3*(Bb-.37448087)),Qb=Wc+lc,bb=Gb*Math.cos(Bb-.13130908)+2*kb*Math.cos(2*(Bb-2.8843198))+3*Lb*Math.cos(3*(Bb-.37448087))):(Ya=zb+Mb*bc,eb=Ya+Ya,Eb=Bb+Bb,cb=Ac*Math.sin(eb+Bb-5.7686396)+Xa*Math.sin(Bb-5.7686396)+pc*Math.sin(Ya+Bb-.95240898)+ic*Math.sin(-Ya+Bb-.95240898)+ob*Math.sin(eb+Eb-1.8014998)+Kb*Math.sin(Eb-1.8014998)+Rb*Math.sin(Ya+Bb-1.050833)+ub*Math.sin(-Ya+Bb-1.050833)+jc*Math.sin(Ya+Eb-4.4108898)+jb*Math.sin(-Ya+Eb-4.4108898),Qb=Wc+lc,bb=Ac*Math.cos(eb+Bb-5.7686396)+Xa*Math.cos(Bb-5.7686396)+pc*Math.cos(Ya+Bb-.95240898)+ic*Math.cos(-Ya+Bb-.95240898)+Rb*Math.cos(Ya+Bb-1.050833)+ub*Math.cos(-Ya+Bb-1.050833)+2*(ob*Math.cos(eb+Eb-1.8014998)+Kb*Math.cos(Eb-1.8014998)+jc*Math.cos(Ya+Eb-4.4108898)+jb*Math.cos(-Ya+Eb-4.4108898))),bb*=Qb,720<=Math.abs($a-bc)?gd=381:(Pa=$a-bc,gd=0),381===gd&&(Bb=Bb+Qb*$b+259200*cb,Wc=Wc+cb*$b+259200*bb,bc+=$b);fd=Wc+cb*Pa+bb*Pa*Pa*.5;ea=Bb+Qb*Pa+cb*Pa*Pa*.5;ld=1!==Fb?ea-2*Cc+2*Db:ea-Cc-Hc+Db;qd=fd-mc;fd=mc+qd}d=kd;e=Hc;f=pb;k=ld;m=Cc;q=fd;Pb=d;V=e;Da=f;qa=k;sa=m;ka=q}if(0>=ka)return b.error=2,[!1,!1];r=Math.pow(l/ka,p)*ha*ha;ka=l/Math.pow(r,1.5);Pb-=za;if(1<=Pb||-.001>Pb)return b.error=1,[!1,!1];1E-6>Pb&&(Pb=1E-6);qa+=b.no*Ga;ua=qa+V+sa;sa%=h;V%=h;ua%=h;qa=(ua-V-sa)%h;y=Math.sin(Da);v=Math.cos(Da);var Qc=Pb;na=Da;da=V;rb=sa;Ob=qa;L=y;H=v;if("d"===b.method){var Xc=a(b,{inclo:b.inclo,init:"n",ep:Qc,inclp:na,nodep:rb,argpp:da,mp:Ob,opsmode:b.operationmod}),Qc=Xc.ep;na=Xc.inclp;rb=Xc.nodep;da=Xc.argpp;Ob=Xc.mp;0>na&&(na=-na,rb+=g,da-=g);if(0>Qc||1<Qc)return b.error=3,[!1,!1]}"d"===b.method&&(L=Math.sin(na),H=Math.cos(na),b.aycof=.0011694452793710002*L,1.5E-12<Math.abs(H+1)?b.xlcof=5.847226396855001E-4*L*(3+5*H)/(1+H):b.xlcof=5.847226396855001E-4*L*(3+5*H)/1.5E-12);t=Qc*Math.cos(da);ta=1/(r*(1-Qc*Qc));w=Qc*Math.sin(da)+ta*b.aycof;N=oa=(Ob+da+rb+ta*b.xlcof*t-rb)%h;ra=9999.9;for(var cd=1;1E-12<=Math.abs(ra)&&10>=cd;)G=Math.sin(N),B=Math.cos(N),ra=1-B*t-G*w,ra=(oa-w*B+t*G-N)/ra,.95<=Math.abs(ra)&&(ra=0<ra?.95:-.95),N+=ra,cd+=1;Q=t*B+w*G;F=t*G-w*B;P=t*t+w*w;Y=r*(1-P);if(0>Y)return b.error=4,[!1,!1];ba=r*(1-Q);U=Math.sqrt(r)*F/ba;X=Math.sqrt(Y)/ba;u=Math.sqrt(1-P);ta=F/(1+u);T=r/ba*(G-w-t*ta);O=r/ba*(B-t+w*ta);W=Math.atan2(T,O);C=(O+O)*T;A=1-2*T*T;ta=1/Y;Ca=5.41314994525E-4*ta;Ea=Ca*ta;"d"===b.method&&(K=H*H,b.con41=3*K-1,b.x1mth2=1-K,b.x7thm1=7*K-1);yb=ba*(1-1.5*Ea*u*b.con41)+.5*Ca*b.x1mth2*A;W-=.25*Ea*b.x7thm1*C;xb=rb+1.5*Ea*H*C;Ua=na+1.5*Ea*H*L*A;var Yc=U-ka*Ca*b.x1mth2*C/l;S=X+ka*Ca*(b.x1mth2*A+1.5*b.con41)/l;J=Math.sin(W);I=Math.cos(W);E=Math.sin(xb);z=Math.cos(xb);x=Math.sin(Ua);D=Math.cos(Ua);Va=-E*D;Cb=z*D;Ba=Va*J+z*I;ga=Cb*J+E*I;ia=x*J;pa=Va*I-z*J;ya=Cb*I-E*J;Aa=x*I;Z={x:0,y:0,z:0};Z.x=yb*Ba*6378.137;Z.y=yb*ga*6378.137;Z.z=yb*ia*6378.137;aa={x:0,y:0,z:0};aa.x=(Yc*Ba+S*pa)*oc;aa.y=(Yc*ga+S*ya)*oc;aa.z=(Yc*ia+S*Aa)*oc;return 1>yb?(b.error=6,{position:!1,velocity:!1}):{position:Z,velocity:aa}}function e(a){var b=a.longitude,c=a.latitude,d=a.height,e=6378.137/Math.sqrt(1-.006694380004260718*Math.sin(c)*Math.sin(c));a=(e+d)*Math.cos(c)*Math.cos(b);b=(e+d)*Math.cos(c)*Math.sin(b);c=(.9933056199957393*e+d)*Math.sin(c);return{x:a,y:b,z:c}}var f={version:"1.2"},g=Math.PI,h=2*g,k=g/180,l=60/Math.sqrt(6378.137*6378.137*6378.137/398600.5),m=1/l,p=2/3;f.gstime_from_jday=function(a){return b(a)};f.gstime_from_date=function(a,d,e,f,g,h){a=c(a,d,e,f,g,h);return b(a)};f.twoline2satrec=function(e,f){var q,r,t,w,u,v,y,z,E,A,C,B,G,D,x,H,L,K,I,J,O,T,M,R,Q,P,N,F,V,da,Y,Z,aa,U,ba,S,X,W,ca,la,fa,wa,ra,ta,Ca,Ea,ha,Ga,za,oa,Ba,ga,ia,pa,ya,Aa,Da,qa,ka,Ua,na,sa,ua,Va,Pa,Zb,Gc,Na,Ob,lb,nb,Cb,wb,xb,rb,yb,oc,sb,Sb,Pb,$b,Tc,Db,Eb=1440/(2*g),eb=0,ea={error:0};parseInt(e.substring(0,1),10);ea.satnum=e.substring(2,7);e.substring(7,8);e.substring(9,11);ea.epochyr=parseInt(e.substring(18,20),10);ea.epochdays=parseFloat(e.substring(20,32));ea.ndot=parseFloat(e.substring(33,43));ea.nddot=parseFloat("."+parseInt(e.substring(44,50),10)+"E"+e.substring(50,52));ea.bstar=parseFloat(e.substring(53,54)+"."+parseInt(e.substring(54,59),10)+"E"+e.substring(59,61));parseInt(e.substring(62,63),10);parseInt(e.substring(64,68),10);ea.inclo=parseFloat(f.substring(8,16));ea.nodeo=parseFloat(f.substring(17,25));ea.ecco=parseFloat("."+f.substring(26,33));ea.argpo=parseFloat(f.substring(34,42));ea.mo=parseFloat(f.substring(43,51));ea.no=parseFloat(f.substring(52,63));parseFloat(f.substring(63,68));ea.no/=Eb;ea.a=Math.pow(ea.no*m,-2/3);ea.ndot/=1440*Eb;ea.nddot/=2073600*Eb;ea.inclo*=k;ea.nodeo*=k;ea.argpo*=k;ea.mo*=k;ea.alta=ea.a*(1+ea.ecco)-1;ea.altp=ea.a*(1-ea.ecco)-1;var eb=57>ea.epochyr?ea.epochyr+2E3:ea.epochyr+1900,Qb=ea.epochdays,bb=[31,28,31,30,31,30,31,31,30,31,30,31],cb=Math.floor(Qb);0===eb%4&&(bb=[31,29,31,30,31,30,31,31,30,31,30,31]);for(var Ya=1,Fb=0;cb>Fb+bb[Ya-1]&&12>Ya;)Fb+=bb[Ya-1],Ya+=1;var Ac=Ya,Xa=cb-Fb,pc=24*(Qb-cb),ic=Math.floor(pc),pc=60*(pc-ic),ob=Math.floor(pc);ea.jdsatepoch=c(eb,Ac,Xa,ic,ob,60*(pc-ob));var Kb=ea.jdsatepoch-2433281.5,Rb=ea.bstar,ub=ea.ecco,jc=ea.argpo,jb=ea.inclo,Jb=ea.mo,Gb=ea.no,kb=ea.nodeo,Lb,kc,Vb,Tb,fb,zb,Mb,$a,lc,qc,mc,bc,kd,Hc,pb,Bb,ld,Wc,Cc,fd,qd;ea.isimp=0;ea.method="n";ea.aycof=0;ea.con41=0;ea.cc1=0;ea.cc4=0;ea.cc5=0;ea.d2=0;ea.d3=0;ea.d4=0;ea.delmo=0;ea.eta=0;ea.argpdot=0;ea.omgcof=0;ea.sinmao=0;ea.t=0;ea.t2cof=0;ea.t3cof=0;ea.t4cof=0;ea.t5cof=0;ea.x1mth2=0;ea.x7thm1=0;ea.mdot=0;ea.nodedot=0;ea.xlcof=0;ea.xmcof=0;ea.nodecf=0;ea.irez=0;ea.d2201=0;ea.d2211=0;ea.d3210=0;ea.d3222=0;ea.d4410=0;ea.d4422=0;ea.d5220=0;ea.d5232=0;ea.d5421=0;ea.d5433=0;ea.dedt=0;ea.del1=0;ea.del2=0;ea.del3=0;ea.didt=0;ea.dmdt=0;ea.dnodt=0;ea.domdt=0;ea.e3=0;ea.ee2=0;ea.peo=0;ea.pgho=0;ea.pho=0;ea.pinco=0;ea.plo=0;ea.se2=0;ea.se3=0;ea.sgh2=0;ea.sgh3=0;ea.sgh4=0;ea.sh2=0;ea.sh3=0;ea.si2=0;ea.si3=0;ea.sl2=0;ea.sl3=0;ea.sl4=0;ea.gsto=0;ea.xfact=0;ea.xgh2=0;ea.xgh3=0;ea.xgh4=0;ea.xh2=0;ea.xh3=0;ea.xi2=0;ea.xi3=0;ea.xl2=0;ea.xl3=0;ea.xl4=0;ea.xlamo=0;ea.zmol=0;ea.zmos=0;ea.atime=0;ea.xli=0;ea.xni=0;ea.bstar=Rb;ea.ecco=ub;ea.argpo=jc;ea.inclo=jb;ea.mo=Jb;ea.no=Gb;ea.nodeo=kb;ea.operationmode="i";var gd=78/6378.137+1,Qc=42/6378.137,Xc=Qc*Qc*Qc*Qc,cd=2/3;ea.init="y";ea.t=0;var Yc=ea.ecco,Bd=ea.inclo,md=ea.no,af=ea.operationmode,$d,Nd,Cd,Fd,hd,oe=Yc*Yc,yd=1-oe,pe=Math.sqrt(yd),ac=Math.cos(Bd),Uc=ac*ac;$d=Math.pow(l/md,p);Nd=8.119724917875E-4*(3*Uc-1)/(pe*yd);var id=Nd/($d*$d);Cd=$d*(1-id*id-id*(1/3+134*id*id/81));var id=Nd/(Cd*Cd),md=md/(1+id),Zc=Math.pow(l/md,p),Dd=Math.sin(Bd);Fd=Zc*yd;var zd=1-5*Uc,rd=-zd-Uc-Uc,sd=Fd*Fd,nd=Zc*(1-Yc);if("a"===af){var dd=Kb-7305,He=Math.floor(dd+1E-8);hd=(1.7321343856509375+.017202791694070362*He+(.017202791694070362+h)*(dd-He)+dd*dd*5.075514194322695E-15)%h;0>hd&&(hd+=h)}else hd=b(Kb+2433281.5);Tc=md;Db=hd;ea.no=Tc;ea.con41=rd;ea.gsto=Db;ea.error=0;if(0<=yd||0<=ea.no){ea.isimp=0;nd<220/6378.137+1&&(ea.isimp=1);Hc=gd;kd=Xc;qc=6378.137*(nd-1);if(156>qc){Hc=qc-78;98>qc&&(Hc=20);var Od=(120-Hc)/6378.137;kd=Od*Od*Od*Od;Hc=Hc/6378.137+1}mc=1/sd;Cc=1/(Zc-Hc);ea.eta=Zc*ea.ecco*Cc;$a=ea.eta*ea.eta;Mb=ea.ecco*ea.eta;bc=Math.abs(1-$a);Tb=kd*Math.pow(Cc,4);fb=Tb/Math.pow(bc,3.5);kc=fb*ea.no*(Zc*(1+1.5*$a+Mb*(4+$a))+4.0598624589375E-4*Cc/bc*ea.con41*(8+3*$a*(8+$a)));ea.cc1=ea.bstar*kc;Vb=0;1E-4<ea.ecco&&(Vb=-2*Tb*Cc*-.0023388905587420003*ea.no*Dd/ea.ecco);ea.x1mth2=1-Uc;ea.cc4=2*ea.no*fb*Zc*yd*(ea.eta*(2+.5*$a)+ea.ecco*(.5+2*$a)-.00108262998905*Cc/(Zc*bc)*(-3*ea.con41*(1-2*Mb+$a*(1.5-.5*Mb))+.75*ea.x1mth2*(2*$a-Mb*(1+$a))*Math.cos(2*ea.argpo)));ea.cc5=2*fb*Zc*yd*(1+2.75*($a+Mb)+Mb*$a);zb=Uc*Uc;Bb=.001623944983575*mc*ea.no;ld=5.41314994525E-4*Bb*mc;Wc=7.551504421875001E-7*mc*mc*ea.no;ea.mdot=ea.no+.5*Bb*pe*ea.con41+.0625*ld*pe*(13-78*Uc+137*zb);ea.argpdot=-.5*Bb*zd+.0625*ld*(7-114*Uc+395*zb)+Wc*(3-36*Uc+49*zb);qd=-Bb*ac;ea.nodedot=qd+(.5*ld*(4-19*Uc)+2*Wc*(3-7*Uc))*ac;fd=ea.argpdot+ea.nodedot;ea.omgcof=ea.bstar*Vb*Math.cos(ea.argpo);ea.xmcof=0;1E-4<ea.ecco&&(ea.xmcof=-cd*Tb*ea.bstar/Mb);ea.nodecf=3.5*yd*qd*ea.cc1;ea.t2cof=1.5*ea.cc1;1.5E-12<Math.abs(ac+1)?ea.xlcof=5.847226396855001E-4*Dd*(3+5*ac)/(1+ac):ea.xlcof=5.847226396855001E-4*Dd*(3+5*ac)/1.5E-12;ea.aycof=.0011694452793710002*Dd;var bf=1+ea.eta*Math.cos(ea.mo);ea.delmo=bf*bf*bf;ea.sinmao=Math.sin(ea.mo);ea.x7thm1=7*Uc-1;if(225<=2*g/ea.no){ea.method="d";ea.isimp=1;lc=ea.inclo;var ae=ea.argpo,od=ea.inclo,qe=ea.nodeo,be=ea.e3,ce=ea.ee2,Gd=ea.peo,Mf=ea.pgho,Nf=ea.pho,Of=ea.pinco,Pf=ea.plo,Qf=ea.se2,Rf=ea.se3,Sf=ea.sgh2,Tf=ea.sgh3,Uf=ea.sgh4,Vf=ea.sh2,Wf=ea.sh3,Xf=ea.si2,Yf=ea.si3,Zf=ea.sl2,$f=ea.sl3,ag=ea.sl4,bg=ea.xgh2,cg=ea.xgh3,dg=ea.xgh4,eg=ea.xh2,fg=ea.xh3,gg=ea.xi2,hg=ea.xi3,ig=ea.xl2,jg=ea.xl3,kg=ea.xl4,lg=ea.zmol,mg=ea.zmos,Hd,Id,Jd,Kd,Pd,Qd,cf,df,ef,ff,re,gf,hf,Ie,td,ud,vd,wd,se,te,ue,ve,Je,ng,Rd,Sd,og,pg,de,ee,Ke,fe,ge,Le,Me,Ne,Td,Oe,he,we,xe,qg,rg,sg,jf,tg,kf,lf,ug,mf,nf,vg,of,pf,wg,qf,ye,Ud,Ld,Vd,rf,sf,tf,Wd,ie,Xd,Pe,uf,Qe,Re,vf,Se,je,ze,ke,xg=ea.no,Te=ea.ecco,wf=Math.sin(qe),xf=Math.cos(qe),le=Math.sin(ae),me=Math.cos(ae),Ic=Math.sin(od),rc=Math.cos(od),jd=Te*Te;re=1-jd;var yg=Math.sqrt(re),Nf=Mf=Pf=Of=Gd=0,Ue=Kb+18261.5+0;Je=(4.523602-9.2422029E-4*Ue)%h;Ie=Math.sin(Je);hf=Math.cos(Je);Me=.91375164-.03568096*hf;Ne=Math.sqrt(1-Me*Me);fe=.089683511*Ie/Ne;Ke=Math.sqrt(1-fe*fe);var zg=5.8351514+.001944368*Ue;Td=.39785416*Ie/Ne;Td=Math.atan2(Td,Ke*hf+.91744867*fe*Ie);Td=zg+Td-Je;og=Math.cos(Td);pg=Math.sin(Td);Rd=.1945905;Sd=-.98088458;ge=.91744867;Le=.39785416;de=xf;ee=wf;gf=2.9864797E-6;ng=1/xg;for(var yf=0;2>yf;)yf+=1,Hd=Rd*de+Sd*ge*ee,Jd=-Sd*de+Rd*ge*ee,cf=-Rd*ee+Sd*ge*de,df=Sd*Le,ef=Sd*ee+Rd*ge*de,ff=Rd*Le,Id=rc*cf+Ic*df,Kd=rc*ef+Ic*ff,Pd=-Ic*cf+rc*df,Qd=-Ic*ef+rc*ff,td=Hd*me+Id*le,ud=Jd*me+Kd*le,vd=-Hd*le+Id*me,wd=-Jd*le+Kd*me,se=Pd*le,te=Qd*le,ue=Pd*me,ve=Qd*me,je=12*td*td-3*vd*vd,ze=24*td*ud-6*vd*wd,ke=12*ud*ud-3*wd*wd,Wd=3*(Hd*Hd+Id*Id)+je*jd,ie=6*(Hd*Jd+Id*Kd)+ze*jd,Xd=3*(Jd*Jd+Kd*Kd)+ke*jd,Pe=-6*Hd*Pd+jd*(-24*td*ue-6*vd*se),uf=-6*(Hd*Qd+Jd*Pd)+jd*(-24*(ud*ue+td*ve)+-6*(vd*te+wd*se)),Qe=-6*Jd*Qd+jd*(-24*ud*ve-6*wd*te),Re=6*Id*Pd+jd*(24*td*se-6*vd*ue),vf=6*(Kd*Pd+Id*Qd)+jd*(24*(ud*se+td*te)-6*(wd*ue+vd*ve)),Se=6*Kd*Qd+jd*(24*ud*te-6*wd*ve),Wd=Wd+Wd+re*je,ie=ie+ie+re*ze,Xd=Xd+Xd+re*ke,Ld=gf*ng,Ud=-.5*Ld/yg,Vd=Ld*yg,ye=-15*Te*Vd,rf=td*vd+ud*wd,sf=ud*vd+td*wd,tf=ud*wd-td*vd,1===yf&&(Oe=ye,he=Ud,we=Ld,xe=Vd,qg=rf,rg=sf,sg=tf,jf=Wd,tg=ie,kf=Xd,lf=Pe,ug=uf,mf=Qe,nf=Re,vg=vf,of=Se,pf=je,wg=ze,qf=ke,Rd=og,Sd=pg,ge=Me,Le=Ne,de=Ke*xf+fe*wf,ee=wf*Ke-xf*fe,gf=4.7968065E-7);lg=(4.7199672+.2299715*Ue-zg)%h;mg=(6.2565837+.017201977*Ue)%h;Qf=2*Oe*rg;Rf=2*Oe*sg;Xf=2*he*ug;Yf=2*he*(mf-lf);Zf=-2*we*tg;$f=-2*we*(kf-jf);ag=-2*we*(-21-9*jd)*.01675;Sf=2*xe*wg;Tf=2*xe*(qf-pf);Uf=-.3015*xe;Vf=-2*he*vg;Wf=-2*he*(of-nf);ce=2*ye*sf;be=2*ye*tf;gg=2*Ud*uf;hg=2*Ud*(Qe-Pe);ig=-2*Ld*ie;jg=-2*Ld*(Xd-Wd);kg=-2*Ld*(-21-9*jd)*.0549;bg=2*Vd*ze;cg=2*Vd*(ke-je);dg=-.9882*Vd;eg=-2*Ud*vf;fg=-2*Ud*(Se-Re);Q=be;P=ce;N=Gd;F=Mf;V=Nf;da=Of;Y=Pf;Z=Qf;aa=Rf;U=Sf;ba=Tf;S=Uf;X=Vf;W=Wf;ca=Xf;la=Yf;fa=Zf;wa=$f;ra=ag;ta=ye;Ca=Ud;Ea=Ld;ha=Vd;Ga=rf;za=Oe;oa=he;Ba=we;ga=xe;ia=qg;pa=jf;ya=kf;Aa=lf;Da=mf;qa=nf;ka=of;Ua=pf;na=qf;sa=bg;ua=cg;Va=dg;Pa=eg;Zb=fg;Gc=gg;Na=hg;Ob=ig;lb=jg;nb=kg;Cb=Wd;wb=Xd;xb=Pe;rb=Qe;yb=Re;oc=Se;sb=je;Sb=ke;Pb=lg;$b=mg;ea.e3=Q;ea.ee2=P;ea.peo=N;ea.pgho=F;ea.pho=V;ea.pinco=da;ea.plo=Y;ea.se2=Z;ea.se3=aa;ea.sgh2=U;ea.sgh3=ba;ea.sgh4=S;ea.sh2=X;ea.sh3=W;ea.si2=ca;ea.si3=la;ea.sl2=fa;ea.sl3=wa;ea.sl4=ra;ea.xgh2=sa;ea.xgh3=ua;ea.xgh4=Va;ea.xh2=Pa;ea.xh3=Zb;ea.xi2=Gc;ea.xi3=Na;ea.xl2=Ob;ea.xl3=lb;ea.xl4=nb;ea.zmol=Pb;ea.zmos=$b;var Ae=a(ea,{inclo:lc,init:ea.init,ep:ea.ecco,inclp:ea.inclo,nodep:ea.nodeo,argpp:ea.argpo,mp:ea.mo,opsmode:ea.operationmode});ea.ecco=Ae.ep;ea.inclo=Ae.inclp;ea.nodeo=Ae.nodep;ea.argpo=Ae.argpp;ea.mo=Ae.mp;var Ub=jd,gh=ea.argpo,Ag=ea.t,hh=ea.gsto,Bg=ea.mo,Cg=ea.mdot,Ve=ea.no,zf=ea.nodeo,ih=ea.nodedot,jh=ea.ecco,Wb=Te,Be=lc,Md=xg,Yd=ea.irez,Dg=ea.atime,Eg=ea.d2201,Fg=ea.d2211,Gg=ea.d3210,Hg=ea.d3222,Ig=ea.d4410,Jg=ea.d4422,Kg=ea.d5220,Lg=ea.d5232,Mg=ea.d5421,Ng=ea.d5433,Af=ea.dedt,Bf=ea.didt,We=ea.dmdt,Ce=ea.dnodt,Xe=ea.domdt,ne=ea.del1,Og=ea.del2,Pg=ea.del3,Cf=ea.xfact,Ye=ea.xlamo,Qg=ea.xli,Rg=ea.xni,De,Sg,Tg,Ug,Vg,Ee,Wg,Xg,Yg,Zg,$g,ah,bh,ch,Df,dh,Fe,Ef,Ff,Gf,Hf,If,Jf,Kf,Zd,$c,Ed,Ze,eh,fh,Ad,pd,Nc,kh=2/3,Yd=0;.0034906585<Md<.0052359877&&(Yd=1);.00826<=Md<=.00924&&.5<=Wb&&(Yd=2);var lh=1.19459E-5*za*ia,mh=1.19459E-5*oa*(Aa+Da),nh=-1.19459E-5*Ba*(pa+ya-14-6*Ub),oh=1.19459E-5*ga*(Ua+na-6),$e=-1.19459E-5*oa*(qa+ka);if(.052359877>Be||Be>g-.052359877)$e=0;0!==Ic&&($e/=Ic);var ph=oh-rc*$e,Af=lh+1.5835218E-4*ta*Ga,Bf=mh+1.5835218E-4*Ca*(xb+rb),We=nh-1.5835218E-4*Ea*(Cb+wb-14-6*Ub),qh=1.5835218E-4*ha*(sb+Sb-6),Lf=-1.5835218E-4*Ca*(yb+oc);if(.052359877>Be||Be>g-.052359877)Lf=0;Xe=ph+qh;Ce=$e;0!==Ic&&(Xe-=rc/Ic*Lf,Ce+=Lf/Ic);Ze=(hh+0)%h;Wb+=Af*Ag;Be+=Bf*Ag;if(0!==Yd){Ad=Math.pow(Md/l,kh);if(2===Yd){pd=rc*rc;var rh=Wb,Wb=jh,sh=Ub,Ub=oe;Nc=Wb*Ub;ch=-.306-.44*(Wb-.64);.65>=Wb?(Df=3.616-13.247*Wb+16.29*Ub,Fe=-19.302+117.39*Wb-228.419*
Ub+156.591*Nc,Ef=-18.9068+109.7927*Wb-214.6334*Ub+146.5816*Nc,Ff=-41.122+242.694*Wb-471.094*Ub+313.953*Nc,Gf=-146.407+841.88*Wb-1629.014*Ub+1083.435*Nc,Hf=-532.114+3017.977*Wb-5740.032*Ub+3708.276*Nc):(Df=-72.099+331.819*Wb-508.738*Ub+266.724*Nc,Fe=-346.844+1582.851*Wb-2415.925*Ub+1246.113*Nc,Ef=-342.585+1554.908*Wb-2366.899*Ub+1215.972*Nc,Ff=-1052.797+4758.686*Wb-7193.992*Ub+3651.957*Nc,Gf=-3581.69+16178.11*Wb-24462.77*Ub+12422.52*Nc,Hf=.715<Wb?-5149.66+29936.92*Wb-54087.36*Ub+31324.56*Nc:1464.74-4664.75*Wb+3763.64*Ub);.7>Wb?(Kf=-919.2277+4988.61*Wb-9064.77*Ub+5542.21*Nc,If=-822.71072+4568.6173*Wb-8491.4146*Ub+5337.524*Nc,Jf=-853.666+4690.25*Wb-8624.77*Ub+5341.4*Nc):(Kf=-37995.78+161616.52*Wb-229838.2*Ub+109377.94*Nc,If=-51752.104+218913.95*Wb-309468.16*Ub+146349.42*Nc,Jf=-40023.88+170470.89*Wb-242699.48*Ub+115605.82*Nc);Zd=Ic*Ic;De=.75*(1+2*rc+pd);Sg=1.5*Zd;Ug=1.875*Ic*(1-2*rc-3*pd);Vg=-1.875*Ic*(1+2*rc-3*pd);Wg=35*Zd*De;Xg=39.375*Zd*Zd;Yg=9.84375*Ic*(Zd*(1-2*rc-5*pd)+.33333333*(-2+4*rc+6*pd));Zg=Ic*(4.92187512*Zd*(-2-4*rc+10*pd)+6.56250012*(1+2*rc-3*pd));$g=29.53125*Ic*(2-8*rc+pd*(-12+8*rc+10*pd));ah=29.53125*Ic*(-2-8*rc+pd*(12+8*rc-10*pd));eh=Md*Md;fh=Ad*Ad;Ed=3*eh*fh;$c=1.7891679E-6*Ed;Eg=$c*De*ch;Fg=$c*Sg*Df;Ed*=Ad;$c=3.7393792E-7*Ed;Gg=$c*Ug*Fe;Hg=$c*Vg*Ef;Ed*=Ad;$c=1.47273906E-8*Ed;Ig=$c*Wg*Ff;Jg=$c*Xg*Gf;Ed*=Ad;$c=1.1428639E-7*Ed;Kg=$c*Yg*Hf;Lg=$c*Zg*Jf;$c=4.3531606E-9*Ed;Mg=$c*$g*If;Ng=$c*ah*Kf;Ye=(Bg+zf+zf-Ze-Ze)%h;Cf=Cg+We+2*(ih+Ce-.0043752690880113)-Ve;Wb=rh;Ub=sh}1===Yd&&(bh=1+Ub*(-2.5+.8125*Ub),Fe=1+2*Ub,dh=1+Ub*(-6+6.60937*Ub),De=.75*(1+rc)*(1+rc),Tg=.9375*Ic*Ic*(1+3*rc)-.75*(1+rc),Ee=1+rc,Ee*=1.875*Ee*Ee,ne=3*Md*Md*Ad*Ad,Og=2*ne*De*bh*1.7891679E-6,Pg=3*ne*Ee*dh*2.2123015E-7*Ad,ne=ne*Tg*Fe*2.1460748E-6*Ad,Ye=(Bg+zf+gh-Ze)%h,Cf=Cg+fd-.0043752690880113+We+Xe+Ce-Ve);Qg=Ye;Rg=Ve;Dg=0;Md=Ve+0}q=Yd;r=Dg;t=Eg;w=Fg;u=Gg;v=Hg;y=Ig;z=Jg;E=Kg;A=Lg;C=Mg;B=Ng;G=Af;D=Bf;x=We;H=Ce;L=Xe;K=ne;I=Og;J=Pg;O=Cf;T=Ye;M=Qg;R=Rg;ea.irez=q;ea.atime=r;ea.d2201=t;ea.d2211=w;ea.d3210=u;ea.d3222=v;ea.d4410=y;ea.d4422=z;ea.d5220=E;ea.d5232=A;ea.d5421=C;ea.d5433=B;ea.dedt=G;ea.didt=D;ea.dmdt=x;ea.dnodt=H;ea.domdt=L;ea.del1=K;ea.del2=I;ea.del3=J;ea.xfact=O;ea.xlamo=T;ea.xli=M;ea.xni=R}1!==ea.isimp&&(Lb=ea.cc1*ea.cc1,ea.d2=4*Zc*Cc*Lb,pb=ea.d2*Cc*ea.cc1/3,ea.d3=(17*Zc+Hc)*pb,ea.d4=.5*pb*Zc*Cc*(221*Zc+31*Hc)*ea.cc1,ea.t3cof=ea.d2+2*Lb,ea.t4cof=.25*(3*ea.d3+ea.cc1*(12*ea.d2+10*Lb)),ea.t5cof=.2*(3*ea.d4+12*ea.cc1*ea.d3+6*ea.d2*ea.d2+15*Lb*(2*ea.d2+Lb)))}d(ea,0);ea.init="n";return ea};f.propagate=function(a,b,e,f,g,h,k){b=1440*(c(b,e,f,g,h,k)-a.jdsatepoch);return d(a,b)};f.sgp4=function(a,b){return d(a,b)};f.eci_to_geodetic=function(a,b){for(var c=Math.sqrt(a.x*a.x+a.y*a.y),d=Math.atan2(a.y,a.x)-b,e=0,f=Math.atan2(a.z,Math.sqrt(a.x*a.x+a.y*a.y)),g;20>e;)g=1/Math.sqrt(1-.006694380004260718*Math.sin(f)*Math.sin(f)),f=Math.atan2(a.z+42.69767279723544*g*Math.sin(f),c),e+=1;c=c/Math.cos(f)-6378.137*g;return{longitude:d,latitude:f,height:c}};f.ecf_to_look_angles=function(a,b){var c,d=a.longitude,f=a.latitude,h=e(a);c=b.x-h.x;var k=b.y-h.y,l=b.z-h.z,h=Math.sin(f)*Math.cos(d)*c+Math.sin(f)*Math.sin(d)*k-Math.cos(f)*l,m=-Math.sin(d)*c+Math.cos(d)*k,d=Math.cos(f)*Math.cos(d)*c+Math.cos(f)*Math.sin(d)*k+Math.sin(f)*l;c={top_s:h,top_e:m,top_z:d};d=c.top_s;f=c.top_e;k=c.top_z;c=Math.sqrt(d*d+f*f+k*k);k=Math.asin(k/c);return{azimuth:Math.atan2(-f,d)+g,elevation:k,range_sat:c}};f.geodetic_to_ecf=function(a){return e(a)};f.ecf_to_eci=function(a,b){return{x:a.x*Math.cos(b)-a.y*Math.sin(b),y:a.x*Math.sin(b)+a.y*Math.cos(b),z:a.z}};f.eci_to_ecf=function(a,b){return{x:a.x*Math.cos(b)+a.y*Math.sin(b),y:a.x*-Math.sin(b)+a.y*Math.cos(b),z:a.z}};f.degrees_lat=function(a){return a=a>g/2||a<-g/2?"Err":a/g*180};f.degrees_long=function(a){a=a/g*180%360;180<a?a=360-a:-180>a&&(a=360+a);return a};f.doppler_factor=function(a,b,c){var d=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)+Math.pow(b.z-a.z,2));b={x:b.x+c.x,y:b.y+c.y,z:b.z+c.z};a=Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2)+Math.pow(b.z-a.z,2))-d;return 1+a*(0<=a?1:-1)/299792.458};return f})();for(var l=[],f=[],m=0;m<e.needUpdateType.length&&!e.pause;++m)var q=e.tleInfoMap.get(e.needUpdateType[m]),l=l.concat(q);for(var q=e.ECITaskProcessorPool.length,r=Math.ceil(l.length/q),t=0;t<q;++t)b.push({timestamp:g,realTime:h,satelineInfoArr:l.slice(t*r,(t+1)*r<=l.length?(t+1)*r:l.length)});if(0<e.threadResGroup.length)for(m=0;m<e.threadResGroup.length;++m)if(e.threadResGroup[m]&&e.threadResGroup[m].pop){for(q=0;q<e.threadResGroup[m].length;++q)0>=e.threadResGroup[m].length?c(e.threadResGroup[m].pop()):c(e.threadResGroup[m][d(e.threadResGroup[m],g)]);e.threadResGroup[m].length=0}if(0<l.length){if(e.corridinateSystem==W.ECI)for(g=0;g<b.length;++g){var w=e.ECITaskProcessorPool[g].scheduleTask({data:b[g]});w&&k.push(w)}else e.corridinateSystem==W.ECEF&&(w=e.ECEFTaskProcessor.scheduleTask({data:void 0}));if(a(k)&&0<k.length)for(m=0;m<k.length;++m)p(k[m],function(a){console.log("group.length: "+e.threadResGroup.length);e.threadResGroup[m]&&e.threadResGroup[m]instanceof Array||(e.threadResGroup[m]=[]);e.threadResGroup[m].push(a)})}e.orbitSateObj&&e.corridinateSystem==W.ECI&&(w=e.ECIOrbitTaskProcessor.scheduleTask({data:{realTime:h,satelineInfoArr:[e.orbitSateObj.tleInfo]}}),a(w)&&p(w,function(a){for(var b,c,d=0;d<a.satelineInfoArr.length;++d){var f,g;b=a.satelineInfoArr[d].sateObjArrIndex;f=e.sateObjArr[b];g=a.satelineInfoArr[d].geoPosition;b=a.satelineInfoArr[d].satelinePosArr;c=a.satelineInfoArr[d].nextPosition;g&&!U(g)?f.setPosition(g,c):g||f.setVisible(!1);e.focusSateObj==f&&(e.entityModelMap.get(e.focusSateObj.type).position=e.focusSateObj._billboard.position,e.entityModelMap.get(e.focusSateObj.type).orientation=e.focusSateObj.orientation);if(b){c=[];if(e.onlyOrbit)for(f=0;f<e.onlyOrbitPositions.length;++f)e.onlyOrbitPositions[f].x=b[3*f+0],e.onlyOrbitPositions[f].y=b[3*f+1],e.onlyOrbitPositions[f].z=b[3*f+2];else{for(f=0;f<b.length;f+=3)0==b[f+0]&&0==b[f+1]&&0==b[f+2]||c.push(new x(b[f+0],b[f+1],b[f+2]));aa(e,c)}e.focusSateObj==e.orbitSateObj?(e.focusSateObj._orbit=e.onlyOrbit,e.focusSateObj._orbit._show=!0):e.curHoverSate==e.orbitSateObj?(e.curHoverSate&&(e.curHoverSate._orbit=void 0),e.curHoverSate=e.orbitSateObj,e.orbitSateObj._orbit=e.onlyOrbit,e.curHoverSate.hover(!0)):e.onlyOrbit.show=!1}}}));0<f.length&&(e.corridinateSystem==W.ECI?(w=e.ECITaskProcessorPool[e.ECIPoolIndex].scheduleTask({data:{realTime:h,satelineInfoArr:f}}),e.ECIPoolIndex=++e.ECIPoolIndex%e.ECITaskProcessorPool.length):e.corridinateSystem==W.ECEF&&(w=e.ECEFTaskProcessor.scheduleTask({data:{realTime:h,satelineInfoArr:f}})),a(w)&&p(w,function(a){for(var b,c=0;c<a.satelineInfoArr.length;++c){b=a.satelineInfoArr[c].sateObjArrIndex;b=e.sateObjArr[b];var d=a.satelineInfoArr[c].geoPosition;d&&!U(d)&&b.setPosition(d);e.focusSateObj==b&&(e.entityModelMap.get(e.focusSateObj.type).position=e.focusSateObj._billboard.position,e.entityModelMap.get(e.focusSateObj.type).orientation=e.focusSateObj.orientation)}}))}};O.prototype.destroy=function(){for(var a,b=0;b<this.allSatelliteType.length;++b)a=this.billboardModelMap.get(this.allSatelliteType[b]).billboards,a.removeAll(),this._map.scene.primitives.remove(a),a=this.billboardModelMap.get(this.allSatelliteType[b]).models,a.removeAll(),this._map.scene.primitives.remove(a),a=this.entityModelMap.get(this.allSatelliteType[b]).entityModel,this._map.entities.remove(a);for(b=0;b<this.sateObjArr.length;++b){a=this.sateObjArr[b].mountEffects;for(var c=0;c<a.length;++c)this._map.removeEffect(a[c])}this.billboardModelMap.clear();this.onlyOrbit&&this._map.entities.remove(this.onlyOrbit);return k(this)};return O});F("FeShadersEx/FeScanRadarFS",[],function(){return"precision mediump float;\nvarying vec4 v_color;\nvoid main()\n{\n\tgl_FragColor \x3d v_color;\n}\n\n"});F("FeShadersEx/FeScanRadarVS",[],function(){return"precision mediump float;\nattribute vec4 a_position;\nattribute vec4 a_color;\nuniform mat4 uMVPMatrix;\nvarying vec4 v_color;\nvoid main()\n{\n\tgl_Position \x3d uMVPMatrix * a_position;\n\tv_color \x3d a_color;\n\tgl_PointSize \x3d 5.0;\n}"});F("FeSceneEx/FeScanRadarPrimitive","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/clone ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/FeatureDetection ../Core/Geometry ../Core/GeometryAttribute ../Core/GeometryAttributes ../Core/isArray ../Core/Matrix4 ../Core/Matrix3 ../Core/RuntimeError ../Core/subdivideArray ../Core/TaskProcessor ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../FeSceneEx/FeDrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../ThirdParty/when ../Scene/BatchTable ../Scene/CullFace ../Scene/DepthFunction ../Scene/PrimitivePipeline ../Scene/PrimitiveState ../Scene/SceneMode ../Scene/ShadowMode ../FeShadersEx/FeScanRadarFS ../FeShadersEx/FeScanRadarVS ../Core/Ellipsoid ../Core/Transforms ../Core/Quaternion ../Core/Math ../Core/getTimestamp ../Core/WebGLConstants ../Core/buildModuleUrl ../Core/isCrossOriginUrl ../FeSceneEx/FeAutoTransForm".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,F,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga,ka){function Z(a){this._pass=E.OPAQUE;this._receiveShadows=!1;this._shaderProgram=new K({vertexShaderText:"",fragmentShaderText:""});this._drawCommand=new G({primitive:this,pass:this._pass,receiveShadows:this._receiveShadows,shaderProgram:this._shaderProgram});a=p(a,p.EMPTY_OBJECT);this._vao=void 0;this._isGeometryCreate=!1;this._aColor=this._uMVPMat=this._shaderProgram=this._indexBuffer=this._alphaBuffer=this._positionBuffer=void 0;this._renderState=new L;this._renderState.depthTest.enabled=!1;this._renderState.lineWidth=1.5;this._renderState.blending.enabled=!0;this._renderState.blending.functionSourceRgb=X.SRC_ALPHA;this._renderState.blending.functionDestinationRgb=X.ONE_MINUS_SRC_ALPHA;this._renderState.polygonOffset.enabled=!1;this._renderState.polygonOffset.factor=1;this._renderState.polygonOffset.units=1;this._positionArr=void 0;this._visibleAngle=2*V.PI;this._gl=this._updateWorker=void 0;this._position=p(a.position,[-120.3,40.5,100]);this._hStep=p(a.hStep,1);this._vStep=p(a.vStep,1);this._radius=p(a.radius,1E6);this._angleVert=p(a.angleVert,30);this._angleHori=p(a.angleHori,60);this._scanHoriFacePosArr=this._scanHoriFacePosBuffer=this._scanVertFacePosArr=this._scanVertFacePosBuffer=this._scanHoriLURDPosArr=this._scanHoriLURDPosBuffer=this._scanVertLURDPosArr=this._scanVertLURDPosBuffer=this._facePosArr=this._facePosBuffer=this._colorArr=this._colorBuffer=this._LURDPosArr=this._LURDPosBuffer=this._gridPosArr=this._gridPosArrBuffer=void 0;this._posBuuferReady=this._posArrReady=!1;this._color=p(a.color,"rgba(255,255,0,0.5)");this._scanColor=p(a.scanColor,"rgba(0,110,110,0.5)");this._scanFaceColor=p(a.scanFaceColor,"rgba(0,255,110,0.5)");this._centerColor=p(a.centerColor,"rgba(0,0,255,0.5)");this._speed=p(a.speed,5);this._speedVert=p(a.speed,5);this._speedHori=p(a.speed,5);this._scanActive=p(a.horizontal,!0);this._horiActive=p(a.horizontal,!0);this._vertActive=p(a.vertical,!0);this.lastTime=void 0;this.scanStepVert=this._angleVert/this._speedVert;this.scanStepHori=this._angleHori/this._speedHori;this.scanAngleVert=this.scanAngleHori=0;this.scanVertFlag=this.scanHoriFlag=!1;this.heading=p(a.heading,0);this.pitch=p(a.pitch,0);this.roll=p(a.roll,0);this.scale=p(a.scale,1);this._modelMatrix=D.clone(D.IDENTITY);this._show=p(a.show,!0);this.scanFlag=!0;this.scanTime=0;this.minimumScale=p(a.minimumScale,0);this.maximumScale=p(a.maximumScale,Number.MAX_VALUE);this._boundingSphere=new b;this._needUpdateBoundingSphere=!0;this.autoScale=p(a.autoScale,!1)}function ia(a){var b=a.radius,c=V.toRadians(a._hStep),d=V.toRadians(a._vStep);V.toRadians(a._angleVert);var e=V.toRadians(a._angleHori),f=[];f.push(0);f.push(0);f.push(1E-5);f.push(1);for(var g=V.toRadians(a.scanAngleVert);g<=d+V.toRadians(a.scanAngleVert);g+=d){var h=b*Math.cos(g)*Math.sin(-e/2),k=b*Math.cos(g)*Math.cos(-e/2),l=b*Math.sin(g);f.push(h);f.push(k);f.push(l);f.push(1)}for(g=-e/2;g<=e/2;g+=c)h=b*Math.cos(d+V.toRadians(a.scanAngleVert))*Math.sin(g),k=b*Math.cos(d+V.toRadians(a.scanAngleVert))*Math.cos(g),l=b*Math.sin(d+V.toRadians(a.scanAngleVert)),f.push(h),f.push(k),f.push(l),f.push(1);for(g=d+V.toRadians(a.scanAngleVert);g>=V.toRadians(a.scanAngleVert);g-=d)h=b*Math.cos(g)*Math.sin(e/2),k=b*Math.cos(g)*Math.cos(e/2),l=b*Math.sin(g),f.push(h),f.push(k),f.push(l),f.push(1);for(g=e/2;g>=-e/2;g-=c)h=b*Math.cos(V.toRadians(a.scanAngleVert))*Math.sin(g),k=b*Math.cos(V.toRadians(a.scanAngleVert))*Math.cos(g),l=b*Math.sin(V.toRadians(a.scanAngleVert)),f.push(h),f.push(k),f.push(l),f.push(1);h=b*Math.cos(V.toRadians(a.scanAngleVert))*Math.sin(-e/2);k=b*Math.cos(V.toRadians(a.scanAngleVert))*Math.cos(-e/2);l=b*Math.sin(V.toRadians(a.scanAngleVert));f.push(h);f.push(k);f.push(l);f.push(1);a=new Float32Array(f.length);for(g=0;g<f.length;++g)a[g]=f[g];return a}function la(a){var b=a.radius,c=V.toRadians(a._hStep),d=V.toRadians(a._vStep),e;V.toRadians(a._angleVert);var f=V.toRadians(a._angleHori);e=d+V.toRadians(a.scanAngleVert);a=[];var g,h;for(g=e;g>=e;g-=d){for(h=-f/2;h<=f/2-c;h+=c){var k=b*Math.cos(g)*Math.sin(h),l=b*Math.cos(g)*Math.cos(h),m=b*Math.sin(g),p=b*Math.cos(g-d)*Math.sin(h),q=b*Math.cos(g-d)*Math.cos(h),r=b*Math.sin(g-d),t=b*Math.cos(g)*Math.sin(h+c),w=b*Math.cos(g)*Math.cos(h+c),u=b*Math.sin(g),v=b*Math.cos(g-d)*Math.sin(h+c),y=b*Math.cos(g-d)*Math.cos(h+c),z=b*Math.sin(g-d);a.push(k);a.push(l);a.push(m);a.push(1);a.push(p);a.push(q);a.push(r);a.push(1);a.push(v);a.push(y);a.push(z);a.push(1);a.push(k);a.push(l);a.push(m);a.push(1);a.push(v);a.push(y);a.push(z);a.push(1);a.push(t);a.push(w);a.push(u);a.push(1)}k=b*Math.cos(g)*Math.sin(h);l=b*Math.cos(g)*Math.cos(h);m=b*Math.sin(g);p=b*Math.cos(g-d)*Math.sin(h);q=b*Math.cos(g-d)*Math.cos(h);r=b*Math.sin(g-d);t=b*Math.cos(g)*Math.sin(f/2);w=b*Math.cos(g)*Math.cos(f/2);u=b*Math.sin(g);v=b*Math.cos(g-d)*Math.sin(f/2);y=b*Math.cos(g-d)*Math.cos(f/2);z=b*Math.sin(g-d);a.push(k);a.push(l);a.push(m);a.push(1);a.push(p);a.push(q);a.push(r);a.push(1);a.push(v);a.push(y);a.push(z);a.push(1);a.push(k);a.push(l);a.push(m);a.push(1);a.push(v);a.push(y);a.push(z);a.push(1);a.push(t);a.push(w);a.push(u);a.push(1)}b=a.length;c=new Float32Array(b);for(g=0;g<b;++g)c[g]=a[g];return c}function ha(a,b){var c=a.radius,d=V.toRadians(a._hStep),e=V.toRadians(a._vStep),f=V.toRadians(a._angleVert),g=V.toRadians(a._angleHori);1==b?f=e:2==b&&(g=d);var h=[];h.push(0);h.push(0);h.push(1E-5);h.push(1);for(var k=0;k<f;k+=e){var l=c*Math.cos(k)*Math.sin(-g/2),m=c*Math.cos(k)*Math.cos(-g/2),p=c*Math.sin(k);h.push(l);h.push(m);h.push(p);h.push(1)}for(k=-g/2;k<g/2;k+=d)l=c*Math.cos(f)*Math.sin(k),m=c*Math.cos(f)*Math.cos(k),p=c*Math.sin(f),h.push(l),h.push(m),h.push(p),h.push(1);for(k=f;0<k;k-=e)l=c*Math.cos(k)*Math.sin(g/2),m=c*Math.cos(k)*Math.cos(g/2),p=c*Math.sin(k),h.push(l),h.push(m),h.push(p),h.push(1);for(k=g/2;k>-g/2;k-=d)l=c*Math.sin(k),m=c*Math.cos(k),p=c*Math.sin(0),h.push(l),h.push(m),h.push(p),h.push(1);l=c*Math.sin(-g/2);m=c*Math.cos(-g/2);p=c*Math.sin(0);h.push(l);h.push(m);h.push(p);h.push(1);c=new Float32Array(h.length);for(k=0;k<h.length;++k)c[k]=h[k];return c}function pa(a,b){var c=a.radius,d=V.toRadians(a._hStep),e=V.toRadians(a._vStep),f=V.toRadians(a._angleVert),g=V.toRadians(a._angleHori);1==b?f=e:2==b&&(g=d);for(var h=[],k;f>=e;f-=e){for(k=-g/2;k<=g/2-d;k+=d){var l=c*Math.cos(f)*Math.sin(k),m=c*Math.cos(f)*Math.cos(k),p=c*Math.sin(f),q=c*Math.cos(f-e)*Math.sin(k),r=c*Math.cos(f-e)*Math.cos(k),t=c*Math.sin(f-e),w=c*Math.cos(f)*Math.sin(k+d),u=c*Math.cos(f)*Math.cos(k+d),v=c*Math.sin(f),y=c*Math.cos(f-e)*Math.sin(k+d),z=c*Math.cos(f-e)*Math.cos(k+d),E=c*Math.sin(f-e);h.push(l);h.push(m);h.push(p);h.push(1);h.push(q);h.push(r);h.push(t);h.push(1);h.push(y);h.push(z);h.push(E);h.push(1);h.push(l);h.push(m);h.push(p);h.push(1);h.push(y);h.push(z);h.push(E);h.push(1);h.push(w);h.push(u);h.push(v);h.push(1)}k<g/2&&(l=c*Math.cos(f)*Math.sin(k),m=c*Math.cos(f)*Math.cos(k),p=c*Math.sin(f),q=c*Math.cos(f-e)*Math.sin(k),r=c*Math.cos(f-e)*Math.cos(k),t=c*Math.sin(f-e),w=c*Math.cos(f)*Math.sin(g/2),u=c*Math.cos(f)*Math.cos(g/2),v=c*Math.sin(f),y=c*Math.cos(f-e)*Math.sin(g/2),z=c*Math.cos(f-e)*Math.cos(g/2),E=c*Math.sin(f-e),h.push(l),h.push(m),h.push(p),h.push(1),h.push(q),h.push(r),h.push(t),h.push(1),h.push(y),h.push(z),h.push(E),h.push(1),h.push(l),h.push(m),h.push(p),h.push(1),h.push(y),h.push(z),h.push(E),h.push(1),h.push(w),h.push(u),h.push(v),h.push(1))}if(0<f){for(k=-g/2;k<=g/2-d;k+=d)l=c*Math.cos(f)*Math.sin(k),m=c*Math.cos(f)*Math.cos(k),p=c*Math.sin(f),q=c*Math.sin(k),r=c*Math.cos(k),t=c*Math.sin(0),w=c*Math.cos(f)*Math.sin(k+d),u=c*Math.cos(f)*Math.cos(k+d),v=c*Math.sin(f),y=c*Math.sin(k+d),z=c*Math.cos(k+d),E=c*Math.sin(0),h.push(l),h.push(m),h.push(p),h.push(1),h.push(q),h.push(r),h.push(t),h.push(1),h.push(y),h.push(z),h.push(E),h.push(1),h.push(l),h.push(m),h.push(p),h.push(1),h.push(y),h.push(z),h.push(E),h.push(1),h.push(w),h.push(u),h.push(v),h.push(1);k<g/2&&(l=c*Math.cos(f)*Math.sin(k),m=c*Math.cos(f)*Math.cos(k),p=c*Math.sin(f),q=c*Math.sin(k),r=c*Math.cos(k),t=c*Math.sin(0),w=c*Math.cos(f)*Math.sin(g/2),u=c*Math.cos(f)*Math.cos(g/2),v=c*Math.sin(f),y=c*Math.sin(g/2),z=c*Math.cos(g/2),E=c*Math.sin(0),h.push(l),h.push(m),h.push(p),h.push(1),h.push(q),h.push(r),h.push(t),h.push(1),h.push(y),h.push(z),h.push(E),h.push(1),h.push(l),h.push(m),h.push(p),h.push(1),h.push(y),h.push(z),h.push(E),h.push(1),h.push(w),h.push(u),h.push(v),h.push(1))}c=h.length;d=new Float32Array(c);for(f=0;f<c;++f)d[f]=h[f];return d}function oa(a,b){var c,d;b?(c=a.createShader(a.VERTEX_SHADER),d=S):(c=a.createShader(a.FRAGMENT_SHADER),d=Q);a.shaderSource(c,d);a.compileShader(c);if(a.getShaderParameter(c,a.COMPILE_STATUS))return c;c=a.getShaderInfoLog(c);alert(c)}function qa(a,b){var c=a._us,e=a._gl;if(d(b._uMVPMat)){var g=c.viewProjection,c=new Float32Array(16),h=v.fromRotationZ(V.toRadians(b.heading)),k=v.fromRotationX(V.toRadians(b.pitch)),l=v.fromRotationY(V.toRadians(b.roll)),h=v.multiply(h,k,new v),h=v.multiply(h,l,new v),l=1;b.autoScale&&(l=ka.computeScale(a,b.position,b.minimumScale,b.maximumScale));if(b.position instanceof Array)var m=f.fromDegrees(b.position[0],b.position[1],b.position[2]);else b.position instanceof f&&(m=b.position);l=v.fromScale(new f(b.scale*l,b.scale*l,b.scale*l));b._modelMatrix=D.multiplyByMatrix3(T.eastNorthUpToFixedFrame(m),v.multiply(h,l,new v),new D);m=b._modelMatrix;l=ba();b.scanFlag&&(b.scanAngleHori+=(l-b.lastTime)*b.scanStepHori/1E3);b.scanFlag||(b.scanAngleVert+=(l-b.lastTime)*b.scanStepVert/1E3);b.lastTime=l;b._horiActive&&b.scanHoriFlag&&b.scanFlag&&(m=v.fromRotationZ(V.toRadians(b.scanAngleHori),new v),m=D.multiplyByMatrix3(b._modelMatrix,m,new D));b.scanAngleHori>b._angleHori/2&&(b.scanAngleHori=b._angleHori/2,b.scanStepHori*=-1,b.scanTime+=1,2<=b.scanTime&&(b.scanFlag=!1,b.scanAngleVert=0,b.scanStepVert=Math.abs(b.scanStepVert),b.scanTime=0));b.scanAngleHori<-b._angleHori/2&&(b.scanAngleHori=-b._angleHori/2,b.scanStepHori*=-1,b.scanTime+=1,2<=b.scanTime&&(b.scanFlag=!1,b.scanAngleVert=0,b.scanStepVert=Math.abs(b.scanStepVert),b.scanTime=0));b.scanAngleVert>b._angleVert&&(b.scanAngleVert=b._angleVert,b.scanStepVert*=-1,b.scanTime+=1,2<=b.scanTime&&(b.scanFlag=!0,b.scanAngleHori=b._AngleHori/2,b.scanStepHori=Math.abs(b.scanStepHori),b.scanTime=0));0>b.scanAngleVert&&(b.scanAngleVert=0,b.scanStepVert*=-1,b.scanTime+=1,2<=b.scanTime&&(b.scanFlag=!0,b.scanAngleHori=-b._angleHori/2,b.scanStepHori=Math.abs(b.scanStepHori),b.scanTime=0));g=D.multiply(g,m,new D);D.toArray(g,c);e.uniformMatrix4fv(b._uMVPMat,!1,c)}}function ua(a,b,c,d){var e=a._currentRenderState,f=a._currentPassState;a._currentRenderState=b;a._currentPassState=c;L.partialApply(a._gl,e,b,f,c,d)}q(Z.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}},position:{get:function(){return this._position},set:function(a){this._position=a}},radius:{get:function(){return this._radius},set:function(a){this._radius=a}},angleVert:{get:function(){return this._angleVert},set:function(a){this._angleVert=a;this._isGeometryCreate=!1}},angleHori:{get:function(){return this._angleHori},set:function(a){this._angleHori=a;this._isGeometryCreate=!1}},color:{get:function(){return this._color},set:function(a){this._color=a}},scanColor:{get:function(){return this._scanColor},set:function(a){this._scanColor=a}},scanFaceColor:{get:function(){return this._scanFaceColor},set:function(a){this._scanFaceColor=a}},centerColor:{get:function(){return this._centerColor},set:function(a){this._centerColor=a}},speed:{get:function(){return this._speed},set:function(a){this._speedHori=this._speed=a;this.scanStepHori=this._angleHori/this._speedHori;this._speedVert=a;this.scanStepVert=this._angleVert/this._speedVert}},boundingSphere:{get:function(){if(this._needUpdateBoundingSphere){for(var a=[],c=0;c<this._LURDPosArr.length;c+=3){var d=new f(this._LURDPosArr[c],this._LURDPosArr[c+1],this._LURDPosArr[c+2]);a.push(d)}this._boundingSphere=b.fromPoints(a,new b);this._needUpdateBoundingSphere=!1}return this._boundingSphere}}});Z.prototype.destroy=function(){this._currentData&&(this._currentData=[]);this._currentData=void 0;this._currentParticleArr&&(this._currentParticleArr=[]);this._currentParticleArr=void 0;this._currentParticleArrForWorker&&(this._currentParticleArrForWorker=[]);this._currentParticleArrForWorker=void 0;return t(this)};Z.prototype.update=function(a){if(this._show&&a.mode==R.SCENE3D){this._camPosition=a.camera.position;var b=ca.WGS84.cartesianToCartographic(this._camPosition),c=f.magnitude(this._camPosition);this._visibleAngle=Math.acos((c-b.height)/c);if(this._position instanceof Array)var d=f.fromDegrees(this._position[0],this._position[1],this._position[2]);else this._position instanceof f&&(d=this._position);c=d;1>f.magnitudeSquared(c)?b=!1:(b=new f,f.clone(c,b),f.normalize(b,b),c=new f,f.clone(this._camPosition,c),f.normalize(c,c),b=f.dot(b,c),-1>=b&&(b=-1),1<=b&&(b=1),b=V.acosClamped(b)>this._visibleAngle?!1:!0);b&&(a=a.commandList,this._mode!=R.MORPHING&&a.push(this._drawCommand))}};Z.prototype.draw=function(a,b){if(d(a)){var c=a._gl;if(d(c))if(this._gl=c,void 0==this.lastTime)this.lastTime=ba();else{if(!this._isGeometryCreate){if(a.vertexArrayObject){this._vao=a.glCreateVertexArray();a.glBindVertexArray(this._vao);var e=a._gl;this._LURDPosBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._LURDPosBuffer);this._LURDPosArr=ha(this,0);e.bufferData(e.ARRAY_BUFFER,this._LURDPosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._colorBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._colorBuffer);var f=[];if(void 0!=this._LURDPosArr){var g=m.fromCssColorString(this.centerColor);f.push(g.red);f.push(g.green);f.push(g.blue);f.push(g.alpha);for(var h=m.fromCssColorString(this.color),g=1;g<this._LURDPosArr.length/4;++g)f.push(h.red),f.push(h.green),f.push(h.blue),f.push(h.alpha)}for(var h=f.length,k=new Float32Array(h),g=0;g<h;++g)k[g]=f[g];this._colorArr=k;e.bufferData(e.ARRAY_BUFFER,this._colorArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._facePosBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._facePosBuffer);this._facePosArr=pa(this,0);e.bufferData(e.ARRAY_BUFFER,this._facePosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._scanVertLURDPosBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._scanVertLURDPosBuffer);this._scanVertLURDPosArr=ia(this);e.bufferData(e.ARRAY_BUFFER,this._scanVertLURDPosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._scanVertFacePosBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._scanVertFacePosBuffer);this._scanVertFacePosArr=la(this);e.bufferData(e.ARRAY_BUFFER,this._scanVertFacePosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._scanHoriLURDPosBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._scanHoriLURDPosBuffer);this._scanHoriLURDPosArr=ha(this,2);e.bufferData(e.ARRAY_BUFFER,this._scanHoriLURDPosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._scanHoriFacePosBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._scanHoriFacePosBuffer);this._scanHoriFacePosArr=pa(this,2);e.bufferData(e.ARRAY_BUFFER,this._scanHoriFacePosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);this._gridPosArrBuffer=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this._gridPosArrBuffer);for(var h=this.radius,k=V.toRadians(5*this._hStep),l=V.toRadians(5*this._vStep),p=V.toRadians(this._angleVert),q=V.toRadians(this._angleHori),f=[],r,g=p;0<g;g-=l){for(r=-q/2;r<=q/2-k;r+=k){var t=h*Math.cos(g)*Math.sin(r),w=h*Math.cos(g)*Math.cos(r),u=h*Math.sin(g),v=h*Math.cos(g)*Math.sin(r+k),y=h*Math.cos(g)*Math.cos(r+k),z=h*Math.sin(g);f.push(t);f.push(w);f.push(u);f.push(v);f.push(y);f.push(z)}r<q/2&&(t=h*Math.cos(g)*Math.sin(r),w=h*Math.cos(g)*Math.cos(r),u=h*Math.sin(g),v=h*Math.cos(g)*Math.sin(q/2),y=h*Math.cos(g)*Math.cos(q/2),z=h*Math.sin(g),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z))}if(0>=g){for(r=-q/2;r<q/2-k;r+=k)t=h*Math.sin(r),w=h*Math.cos(r),u=h*Math.sin(0),v=h*Math.sin(r+k),y=h*Math.cos(r+k),z=h*Math.sin(0),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z);r>=q/2-k&&(t=h*Math.sin(r),w=h*Math.cos(r),u=h*Math.sin(0),v=h*Math.sin(q/2),y=h*Math.cos(q/2),z=h*Math.sin(0),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z))}for(g=-q/2;g<q/2;g+=k){for(r=p;r>l;r-=l)t=h*Math.cos(r)*Math.sin(g),w=h*Math.cos(r)*Math.cos(g),u=h*Math.sin(r),v=h*Math.cos(r-l)*Math.sin(g),y=h*Math.cos(r-l)*Math.cos(g),z=h*Math.sin(r-l),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z);r<=l&&(t=h*Math.cos(r)*Math.sin(g),w=h*Math.cos(r)*Math.cos(g),u=h*Math.sin(r),v=h*Math.sin(g),y=h*Math.cos(g),z=h*Math.sin(0),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z))}if(g>=q/2){for(r=p;r>l;r-=l)t=h*Math.cos(r)*Math.sin(q/2),w=h*Math.cos(r)*Math.cos(q/2),u=h*Math.sin(r),v=h*Math.cos(r-l)*Math.sin(q/2),y=h*Math.cos(r-l)*Math.cos(q/2),z=h*Math.sin(r-l),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z);r<=l&&(t=h*Math.cos(r)*Math.sin(q/2),w=h*Math.cos(r)*Math.cos(q/2),u=h*Math.sin(r),v=h*Math.sin(q/2),y=h*Math.cos(q/2),z=h*Math.sin(0),f.push(t),f.push(w),f.push(u),f.push(v),f.push(y),f.push(z))}h=f.length;k=new Float32Array(h);for(g=0;g<h;++g)k[g]=f[g];this._gridPosArr=k;e.bufferData(e.ARRAY_BUFFER,this._gridPosArr,e.STATIC_DRAW);e.bindBuffer(e.ARRAY_BUFFER,null);a.glBindVertexArray(null)}this._isGeometryCreate=!0}d(this._shaderProgram)?(c.useProgram(this._shaderProgram),qa(a,this),e=a._currentRenderState,f=a._currentPassState,ua(a,this._renderState,b,!1),a.glBindVertexArray(this._vao),g=c.getAttribLocation(this._shaderProgram,"a_color"),c.bindBuffer(c.ARRAY_BUFFER,this._colorBuffer),c.enableVertexAttribArray(g),c.vertexAttribPointer(g,4,c.FLOAT,!1,0,0),h=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(h),c.bindBuffer(c.ARRAY_BUFFER,this._LURDPosBuffer),c.vertexAttribPointer(h,4,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLE_FAN,0,this._LURDPosArr.length/4),c.bindBuffer(c.ARRAY_BUFFER,null),c.disableVertexAttribArray(g),g=c.getAttribLocation(this._shaderProgram,"a_color"),h=m.fromCssColorString(this.color),c.vertexAttrib4f(g,h.red,h.green,h.blue,h.alpha),g=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(g),c.bindBuffer(c.ARRAY_BUFFER,this._facePosBuffer),c.vertexAttribPointer(g,4,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,this._facePosArr.length/4),g=c.getAttribLocation(this._shaderProgram,"a_color"),h=m.fromCssColorString(this.color),c.vertexAttrib4f(g,1,0,0,h.alpha),g=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(g),c.bindBuffer(c.ARRAY_BUFFER,this._gridPosArrBuffer),c.vertexAttribPointer(g,3,c.FLOAT,!1,0,0),c.drawArrays(c.LINES,0,this._gridPosArr.length/3),this._vertActive&&!this.scanFlag&&(this.scanVertFlag=!0,qa(a,this),g=c.getAttribLocation(this._shaderProgram,"a_color"),h=m.fromCssColorString(this._scanColor),c.vertexAttrib4f(g,h.red,h.green,h.blue,h.alpha),h=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(h),c.bindBuffer(c.ARRAY_BUFFER,this._scanVertLURDPosBuffer),this._scanVertLURDPosArr=ia(this),c.bufferData(c.ARRAY_BUFFER,this._scanVertLURDPosArr,c.STATIC_DRAW),c.vertexAttribPointer(h,4,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLE_FAN,0,this._scanVertLURDPosArr.length/4),c.bindBuffer(c.ARRAY_BUFFER,null),g=c.getAttribLocation(this._shaderProgram,"a_color"),h=m.fromCssColorString(this.scanFaceColor),c.vertexAttrib4f(g,h.red,h.green,h.blue,h.alpha),g=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(g),c.bindBuffer(c.ARRAY_BUFFER,this._scanVertFacePosBuffer),this._scanVertFacePosArr=la(this),c.bufferData(c.ARRAY_BUFFER,this._scanVertFacePosArr,c.STATIC_DRAW),c.vertexAttribPointer(g,4,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,this._scanVertFacePosArr.length/4),this.scanVertFlag=!1),this._horiActive&&this.scanFlag&&(this.scanHoriFlag=!0,qa(a,this),g=c.getAttribLocation(this._shaderProgram,"a_color"),h=m.fromCssColorString(this._scanColor),c.vertexAttrib4f(g,h.red,h.green,h.blue,h.alpha),h=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(h),c.bindBuffer(c.ARRAY_BUFFER,this._scanHoriLURDPosBuffer),c.vertexAttribPointer(h,4,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLE_FAN,0,this._scanHoriLURDPosArr.length/4),c.bindBuffer(c.ARRAY_BUFFER,null),g=c.getAttribLocation(this._shaderProgram,"a_color"),h=m.fromCssColorString(this.scanFaceColor),c.vertexAttrib4f(g,h.red,h.green,h.blue,h.alpha),g=c.getAttribLocation(this._shaderProgram,"a_position"),c.enableVertexAttribArray(g),c.bindBuffer(c.ARRAY_BUFFER,this._scanHoriFacePosBuffer),c.vertexAttribPointer(g,4,c.FLOAT,!1,0,0),c.drawArrays(c.TRIANGLES,0,this._scanHoriFacePosArr.length/4),this.scanHoriFlag=!1),c.bindBuffer(c.ARRAY_BUFFER,null),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,null),a.glBindVertexArray(null),c.bindTexture(c.TEXTURE_2D,null),ua(a,e,f,!1)):(c=a._gl,e=oa(c,!0),f=oa(c,!1),this._shaderProgram=c.createProgram(),c.attachShader(this._shaderProgram,e),c.attachShader(this._shaderProgram,f),c.linkProgram(this._shaderProgram),c.getProgramParameter(this._shaderProgram,c.LINK_STATUS)||(c=c.getProgramInfoLog(this._shaderProgram),alert(c),this._shaderProgram=void 0),this._uMVPMat=a._gl.getUniformLocation(this._shaderProgram,"uMVPMatrix"))}}};return Z});F("FeShadersEx/FeStarConstellationVS",[],function(){return"attribute vec3 position;\nattribute float pointSize;\nattribute float plx;\nattribute vec3 increment;\nuniform bool useLogDepth;\nuniform float maxPlx;\nuniform float scalar;\nvarying float alpha;\nvarying vec3 v_positionEC;\nconst float skyRadius \x3d 6378137.0* 8000000000.0;\nconst float distanceScaleFactor \x3d 0.25;\n\n#define MAX_1000_DIV_PLX 1283.0\n#define POSITION_FACTOR 100000.0/MAX_1000_DIV_PLX\nvec3 ortho( vec3 v,float t1,vec3 increment,float plx ){\n\tfloat d \x3d 1000.0/plx;\n\tvec3 xyz \x3d v*d*POSITION_FACTOR;\n\txyz \x3d xyz + (t1 * increment * POSITION_FACTOR);\n\treturn xyz;\n}\n\n\n\nvoid main()\n{\n\tfloat t \x3d 20.0;\n\tvec3 positionWC \x3d position.xyz*(skyRadius/plx);\n\tgl_Position \x3d czm_modelViewProjection * vec4(positionWC.xyz,1.0);\n\tvec3 ref \x3d ortho(position.xyz, 0.0, increment,plx);\n\tvec3 orig \x3d ortho(position.xyz, 0.0, increment,plx);\n\tvec3 target \x3d ortho(position.xyz, 0.0, increment,plx);\n\tfloat d_ref \x3d sqrt(pow(ref.x, 2.0) + pow(ref.y, 2.0) + pow(ref.z, 2.0));\n\tfloat d_orig \x3d sqrt(pow(orig.x, 2.0) + pow(orig.y, 2.0) + pow(orig.z, 2.0));\n\tfloat d_target \x3d sqrt(pow(target.x, 2.0) + pow(target.y, 2.0) + pow(target.z, 2.0));\n\tfloat MAX_POINT_SIZE \x3d 25.0;\n\tfloat POINT_SCALE_FACTOR \x3d .3;\n\tfloat Vt0 \x3d pointSize + 5.0 * log(d_orig/d_ref) * distanceScaleFactor;\n\tfloat Vt1 \x3d pointSize + 5.0 * log(d_target/d_ref) * distanceScaleFactor;\n\tfloat Vt \x3d Vt0 + (t * (Vt1 - Vt0));\n\tfloat V \x3d MAX_POINT_SIZE/pow(pow(100.0,0.2), Vt * POINT_SCALE_FACTOR);\n\tvec3 mvPosition \x3d (czm_view * vec4(position.xyz,1.0)).xyz;\n\tgl_PointSize \x3d V * (1.0 + 100.0/length(mvPosition.xyz))*0.6;\n\tv_positionEC \x3d (czm_view * vec4(positionWC.xyz,1.0)).xyz;\n\tif( pointSize \x3e\x3d 6.0 ){\n\t\talpha \x3d 0.0;\n\t}else{\n\t\talpha \x3d 1.0;\n\t}\n\tif( pointSize \x3c\x3d 4.0 ){\n\t\tgl_PointSize \x3d gl_PointSize*0.6;\n\t}\n\tif(useLogDepth){\n\t\tgl_Position.z \x3d log2(max(1e-6, 1.0 + gl_Position.w)) * czm_log2FarDistance - 1.0;\n\t\tgl_Position.z *\x3d gl_Position.w;\n\t}\n}"});F("FeShadersEx/FeStarConstellationFS",[],function(){return"precision mediump float;\n\tuniform sampler2D starTexture;\n\tuniform vec2 visibleDistance;\n\tvarying float alpha;\n\tvarying vec3 v_positionEC;\n\nvoid main()\n{\n\tvec4 color \x3d texture2D(starTexture, gl_PointCoord);\n\tif(color.a \x3c\x3d czm_epsilon7 ){\n\t\tdiscard;\n\t}\n\tgl_FragColor \x3d color;\n\tgl_FragColor.a \x3d gl_FragColor.a*alpha;\n}"});F("FeSceneEx/FeSkyStar","../Core/buildModuleUrl ../Core/defaultValue ../Core/defineProperties ../Core/defined ../Core/Color ../Core/Cartesian4 ../Core/Cartesian3 ../Core/Cartesian2 ../Core/Matrix3 ../Core/Matrix4 ../Core/Math ../Core/Resource ../Core/IndexDatatype ../Core/ComponentDatatype ../Core/PrimitiveType ../Core/BoundingSphere ../Core/WebGLConstants ../Scene/SceneMode ../Core/DistanceDisplayCondition ../ThirdParty/when ../Core/Ellipsoid ../Scene/Material ../Scene/CullFace ../Scene/BlendingState ../FeShadersEx/FeStarConstellationVS ../FeShadersEx/FeStarConstellationFS ../Renderer/RenderState ../Renderer/Pass ../Renderer/ShaderProgram ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/VertexArray ../Renderer/Texture ../Renderer/DrawCommand".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N){function O(d){d=a(d,a.EMPTY_OBJECT);this.scene=d.scene;this._starUrl=a(d.starUrl,b("Assets/HIP_STAR.dat"));this._starImageUrl=a(d.starImageUrl,b("Assets/Textures/star.png"));this.starTexture=void 0;this.starInfo=[];this.starPositionArr=[];this.starSizeArr=[];this.plxArr=[];this.incrementArr=[];this.skyRadius=5102509600;this.constellationLoadingSuccess=this.starLoadingSuccess=!1;this._useLogDepth=!0;this.maxPlx=1;this.visibleDistance=new e(0,.06*this.skyRadius);var f=this.scene.context,g=this,h=new q({url:this._starImageUrl});x(h.fetchImage(),function(a){g.starTexture=g.starTexture&&g.starTexture.destroy();g.starTexture=new P({flipY:!0,context:f,source:a})});var k=new m;q.fetchText({url:this._starUrl}).then(function(a){a=a.split("\n");for(var b=a.length-1,c=0;c<b;++c){var d=a[c].split(","),e={};e.HIP=parseInt(d[0]);var f=parseFloat(d[1]),f=parseFloat(f.toFixed(10));e.GLon=f;var h=parseFloat(d[2]),h=parseFloat(h.toFixed(10));e.GLat=parseFloat(h.toFixed(10));var l=parseFloat(d[3]);e.Vmag=l;e.VMag=parseFloat(d[4]);e.Temp=parseFloat(d[5]);e.BV=parseFloat(d[6]);e.Name=d[7];var m=parseFloat(d[8]);e.Plx=m;e.inc_x=parseFloat(d[9]);e.inc_y=parseFloat(d[10]);e.inc_z=parseFloat(d[11]);g.starInfo.push(e);g.plxArr.push(m);k.x=Math.cos(f)*Math.cos(h);k.y=Math.sin(f)*Math.cos(h);k.z=Math.sin(h);g.starPositionArr.push(k.x);g.starPositionArr.push(k.y);g.starPositionArr.push(k.z);g.incrementArr.push(e.inc_x);g.incrementArr.push(e.inc_y);g.incrementArr.push(e.inc_z);g.starSizeArr.push(l)}g.maxPlx=g.starSizeArr[b-1];g.starLoadingSuccess=!0});this._drawCommand=new N({primitiveType:c.POINTS,modelMatrix:p.clone(p.IDENTITY),owner:this});this._drawCommand.uniformMap={useLogDepth:function(){return g._useLogDepth},maxPlx:function(){return g.maxPlx},scalar:function(){return g.skyRadius},starTexture:function(){return g.starTexture},visibleDistance:function(){return g.visibleDistance}};this.attributeLocations={vertices:0,pointSize:1,plx:2,increment:3};this._rs=this._sp=this._va=void 0;this.show=a(d.show,!1);this.translucencyByDistance=new l(2E6,0,15E6,1)}f(O.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});O.prototype.update=function(a){if(this.show&&a.context._us._mode==A.SCENE3D&&a.passes.render&&(this._useLogDepth=a.useLogDepth,this.starLoadingSuccess)){a=a.context;if(!k(this._va)){var b=new Float32Array(this.starPositionArr),c=new Float32Array(this.starSizeArr),d=new Float32Array(this.plxArr),e=new Float32Array(this.incrementArr),b=E.createVertexBuffer({context:a,typedArray:b,usage:L.STATIC_DRAW}),c=E.createVertexBuffer({context:a,typedArray:c,usage:L.STATIC_DRAW}),d=E.createVertexBuffer({context:a,typedArray:d,usage:L.STATIC_DRAW}),e=E.createVertexBuffer({context:a,typedArray:e,usage:L.STATIC_DRAW});this._va=new K({context:a,attributes:[{index:this.attributeLocations.vertices,vertexBuffer:b,componentsPerAttribute:3,componentDatatype:r.FLOAT},{index:this.attributeLocations.pointSize,vertexBuffer:c,componentsPerAttribute:1,componentDatatype:r.FLOAT},{index:this.attributeLocations.plx,vertexBuffer:d,componentsPerAttribute:1,componentDatatype:r.FLOAT},{index:this.attributeLocations.increment,vertexBuffer:e,componentsPerAttribute:3,componentDatatype:r.FLOAT}]});this._drawCommand.vertexArray=this._va}k(this._sp)||(this._sp=G.fromCache({context:a,vertexShaderSource:I,fragmentShaderSource:H,attributeLocations:this.attributeLocations}),this._drawCommand.shaderProgram=this._sp);k(this._rs)||(this._rs=J.fromCache({blending:{enabled:!0,functionSourceRgb:y.SRC_ALPHA,functionDestinationRgb:y.ONE_MINUS_SRC_ALPHA},depthTest:{enabled:!0,func:y.LESS},cull:{enabled:!0,face:y.FRONT_AND_BACK}}),this._drawCommand.renderState=this._rs);return this._drawCommand}};O.prototype.destroy=function(){this.starInfo=[];this.constellationInfo=[];this.starPositionArr=[];this.starSizeArr=[];this.starSizeArr=this.starPositionArr=this.constellationInfo=this.starInfo=void 0;var a=this._drawCommand;a.vertexArray=a.vertexArray&&a.vertexArray.destroy();a.shaderProgram=a.shaderProgram&&a.shaderProgram.destroy();return destroyObject(this)};return O});F("FeShadersEx/FeWindFS",[],function(){return"precision mediump float;\nvarying float vAlpha;\nvarying vec4 vWPos;\nuniform sampler2D u_transferTex;\nuniform sampler2D u_tempTex;\nuniform float u_minDepth;\nuniform float u_maxDepth;\nuniform float u_minLat;\nuniform float u_maxLat;\nuniform float u_minLon;\nuniform float u_maxLon;\nuniform float u_minTemp;\nuniform float u_maxTemp;\nvarying float colorValue;\n\nconst float radiusEquator \x3d 6378137.0;\nconst float radiusPolar \x3d 6356752.3;\nvec3 ECEF_TO_LLH(in vec3 xyz)\n{\n    float p \x3d sqrt(xyz.x * xyz.x + xyz.y * xyz.y);\n\tfloat theta \x3d atan(xyz.z * radiusEquator,(p * radiusPolar));\n\tfloat eDashSquared \x3d (radiusEquator * radiusEquator - radiusPolar * radiusPolar)/(radiusPolar * radiusPolar);\n\tfloat sin_theta \x3d sin(theta);\n\tfloat cos_theta \x3d cos(theta);\n\tfloat flattening \x3d (radiusEquator - radiusPolar)/radiusEquator;\n\tfloat eccentricitySquared \x3d 2.0 * flattening - flattening * flattening;\n\tfloat latitude \x3d atan((xyz.z + eDashSquared * radiusPolar * sin_theta * sin_theta * sin_theta)/(p - eccentricitySquared * radiusEquator * cos_theta * cos_theta * cos_theta));\n\tfloat longitude \x3d atan(xyz.y,xyz.x);\n\tfloat sin_latitude \x3d sin(latitude);\n\tfloat N \x3d radiusEquator /sqrt(1.0 - eccentricitySquared * sin_latitude * sin_latitude);\n\tfloat h \x3d p/cos(latitude) - N;\n\tlatitude \x3d degrees(latitude);\n\tlongitude \x3d degrees(longitude);\n\tif(longitude \x3c\x3d 0.0)\n\t{\n\t    longitude +\x3d 360.0;\n\t}\n\treturn vec3(latitude, longitude, h);\n}\nvoid main()\n{\n\tfloat alpha \x3d vAlpha / 255.0;\n\talpha \x3d clamp(alpha,0.0,1.0);\n\t//gl_FragColor \x3d vec4(uColor.x, uColor.y, uColor.z, alpha);\n\tgl_FragColor \x3d vec4(colorValue/255.0, colorValue/255.0, colorValue/255.0, alpha);\n}"});F("FeShadersEx/FeWindVS",[],function(){return"precision mediump float;\nattribute vec4 v_position;\nattribute float v_alpha;\nuniform mat4 uMVPMatrix;\nuniform mat4 u_viewportTransformationMat;\nuniform mat4 u_viewportOrthographicMat;\nuniform bool u_is3d;\nvarying float vAlpha;\nvarying vec4 vWPos;\nvarying float colorValue;\nvoid main()\n{\n\tvec4 position \x3d vec4(v_position.xyz,1.0);\n\tif(u_is3d)\n\t{\n\t\tgl_Position \x3d uMVPMatrix * position;\n\t}\n\telse\n\t{\n\t\tvec4 pos \x3d vec4(position.zxy,1.0);\n\t\tgl_Position \x3d uMVPMatrix * pos;\n\t}\n\tvAlpha \x3d v_alpha;\n\tvWPos \x3d position;\n\tcolorValue \x3d v_position.w;\n}"});F("FeSceneEx/FeWindPrimitive","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/clone ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EncodedCartesian3 ../Core/FeatureDetection ../Core/Geometry ../Core/GeometryAttribute ../Core/GeometryAttributes ../Core/isArray ../Core/Matrix4 ../Core/Matrix3 ../Core/RuntimeError ../Core/subdivideArray ../Core/TaskProcessor ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../FeSceneEx/FeDrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Renderer/Texture ../Core/PixelFormat ../Renderer/PixelDatatype ../ThirdParty/when ../Scene/BatchTable ../Scene/CullFace ../Scene/DepthFunction ../Scene/PrimitivePipeline ../Scene/PrimitiveState ../Scene/SceneMode ../Scene/ShadowMode ../FeShadersEx/FeWindFS ../FeShadersEx/FeWindVS ../Core/Ellipsoid ../Core/Transforms ../Core/Quaternion ../Core/Math ../Core/getTimestamp ../Core/WebGLConstants ../Core/buildModuleUrl ../Core/isCrossOriginUrl".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,F,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga,ka,na,ia){function Z(a){this._pass=E.OPAQUE;this._receiveShadows=!1;this._shaderProgram=new K({vertexShaderText:"",fragmentShaderText:""});this._drawCommand=new G({primitive:this,pass:this._pass,receiveShadows:this._receiveShadows,shaderProgram:this._shaderProgram});a=p(a,p.EMPTY_OBJECT);this._vao=void 0;this._isGeometryCreate=!1;this._uViewportOrthographicMat=this._uViewportTransformationMat=this._uIs3d=this._uMaxDepth=this._uMinDepth=this._uMaxTemp=this._uMinTemp=this._uMaxLon=this._uMinLon=this._uMaxLat=this._uMinLat=this._uColor=this._uMVPMat=this._shaderProgram=this._indexBuffer=this._alphaBuffer=this._positionBuffer=void 0;this._renderState=new L;this._renderState.depthTest.enabled=!1;this._renderState.lineWidth=1.5;this._renderState.blending.enabled=!0;this._renderState.blending.functionSourceRgb=ka.SRC_ALPHA;this._renderState.blending.functionDestinationRgb=ka.ONE_MINUS_SRC_ALPHA;this._renderState.polygonOffset.enabled=!1;this._renderState.polygonOffset.factor=1;this._renderState.polygonOffset.units=1;this._dataLoaded=!1;this._currentData=void 0;this._numCurrent=5E3;this._numCurrentPoint=100;this._maxIntensity=17;this._colorStyles=[];for(var c=85;255>=c;c+=10)this._colorStyles.push(c);this._numCurrent=5E3;this._numCurrentPoint=100;this._vertexNum=this._numCurrent*this._numCurrentPoint;this._elementNum=this._numCurrent*(this._numCurrentPoint-1)*2;this._currentParticleArr=[];this._currentParticleArrForWorker=[];this._viewMaxLon=this._viewMinLon=this._viewMaxLat=this._viewMinLat=this._currentMaxLon=this._currentMinLon=this._currentMaxLat=this._currentMinLat=0;this._camPosition=new f(0,0,0);this._camSpherePos=new f;this._waterVScale=this._waterUScale=1E5;this._waterVFillValue=this._waterUFillValue=-3E4;this._currentFadeSpeed=10;this._alphaArr=this._positionArr=void 0;this._visibleAngle=2*fa.PI;this._updateWorker=void 0;this._alphaArrUpdating=!1;this._gl=void 0;this._alphaArrReady=this._posArrReady=!1;this._maxWaterRate=200;this._maxWaterRateSquared=4E4;this._waterPixelRate=60;this._waterRate=0;this._velocityScale=1;this._stepOver360Lon=!1;this._stepOverLon=0;this._mode=S.SCENE3D;this._projection=void 0;var c=new b,e=[];e.push(new f(0,0,0));e.push(new f(1E9,1E9,1E9));b.fromPoints(e,c);this._boundBox3d=c;this._boundBox2d=void 0;this._updateRangeMaxHeight=13E6;this._updateRangeMinHeight=2E3;this._show=p(a.show,!0);this._url=p(a.url,"");this._visibleHeight=p(a.visibleHeight,[2E3,13E6]);this._updateRangeMinHeight=this._visibleHeight[0];this._updateRangeMaxHeight=this._visibleHeight[1];this._color=p(a.color,m.WHITE);this._imgU=new Uint8Array(261364);this._imgV=new Uint8Array(261364);this._textureV=this._textureU=void 0;this._showBackGround=p(a.showBackGround,!0);this._header={};this._grid=void 0;this.taskProcessor=new I("FeUpdateCurrentBuffer");var g=this;U(wa(g)).then(function(a){if(d(a)){g._dataLoaded=!0;g._currentData=a;g._currentData[0].startLat=g._currentData[0].header.la1;g._currentData[0].latOffset=-g._currentData[0].header.dy;g._currentData[0].latLength=g._currentData[0].header.ny;g._currentData[0].endLat=g._currentData[0].header.la2;g._currentData[0].startLon=g._currentData[0].header.lo1;g._currentData[0].lonOffset=g._currentData[0].header.dx;g._currentData[0].lonLength=g._currentData[0].header.nx;g._currentData[0].endLon=g._currentData[0].header.lo2;a=g._currentData;var c=a[0].header;g._header.\u03bb0=c.lo1;g._header.\u03c60=c.la1;g._header.\u0394\u03bb=c.dx;g._header.\u0394\u03c6=c.dy;g._header.ni=c.nx;g._header.nj=c.ny;for(var c=[],e=0,h=0,k=360<=Math.floor(g._header.ni*g._header.\u0394\u03bb),l=0;l<g._header.nj;l++){for(var m,p,q,r,t,w,u,v,y=[],z=0;z<g._header.ni;z++,e++,h++){y[z]=[a[0].data[e],a[1].data[e]];var E=a[0].data[e],A=parseInt(E),C=1;0>A&&(C=0);var E=E.toString(),B=E.indexOf("."),G=0;-1<B&&(G=E.substring(B+1),G=parseInt(G));g._imgU[4*h+0]=Math.abs(A);g._imgU[4*h+1]=G;g._imgU[4*h+2]=C;g._imgU[4*h+2]=0;0===z&&(m=Math.abs(A),p=G,q=C,r=0);E=a[1].data[e];A=parseInt(E);C=1;0>A&&(C=0);E=E.toString();B=E.indexOf(".");G=0;-1<B&&(G=E.substring(B+1),G=parseInt(G));g._imgV[4*h+0]=Math.abs(A);g._imgV[4*h+1]=G;g._imgV[4*h+2]=C;g._imgV[4*h+2]=0;0===z&&(t=Math.abs(A),w=G,u=C,v=0)}k&&(y.push(y[0]),g._imgU[4*h+0]=m,g._imgU[4*h+1]=p,g._imgU[4*h+2]=q,g._imgU[4*h+2]=r,g._imgV[4*h+0]=t,g._imgV[4*h+1]=w,g._imgV[4*h+2]=u,g._imgV[4*h+2]=v,h++);c[l]=y}g._grid=c;for(m=0;m<g._numCurrent;++m)p={},za(g,p),g._currentParticleArr.push(p),q={},q.age=p.age,q.wPos={},g._currentParticleArrForWorker.push(q);q={};t=(g._currentData[0].endLon+g._currentData[0].startLon)/2;180<t&&(t-=360);q.longitude=fa.toRadians(t);q.latitude=fa.toRadians((g._currentData[0].endLat+g._currentData[0].startLat)/2);q.height=0;m=V.WGS84.cartographicToCartesian(q);t=g._currentData[0].startLon;180<t&&(t-=360);q.longitude=fa.toRadians(t);q.latitude=fa.toRadians(g._currentData[0].endLat);q.height=0;w=V.WGS84.cartographicToCartesian(q);t=g._currentData[0].endLon;180<t&&(t-=360);q.longitude=fa.toRadians(t);q.latitude=fa.toRadians(g._currentData[0].endLat);q.height=0;r=V.WGS84.cartographicToCartesian(q);t=g._currentData[0].endLon;180<t&&(t-=360);q.longitude=fa.toRadians(t);q.latitude=fa.toRadians(g._currentData[0].startLat);q.height=0;p=V.WGS84.cartographicToCartesian(q);t=g._currentData[0].startLon;180<t&&(t-=360);q.longitude=fa.toRadians(t);q.latitude=fa.toRadians(g._currentData[0].startLat);q.height=0;t=V.WGS84.cartographicToCartesian(q);q=new f;f.subtract(w,m,q);w=new f;f.subtract(r,m,w);r=new f;f.subtract(p,m,r);p=new f;f.subtract(t,m,p);t=[];t.push(q);t.push(w);t.push(r);t.push(p);p=b.fromPoints(t);f.add(p.center,m,p.center);g._boundBox3d=p}})}function ha(a,b,c,e){var g=new f,h=a.camera.frustum;if(d(h.aspectRatio)&&d(h.fov)&&d(h.near)){a=a.camera;var h=a._scene.canvas,k=h.clientWidth,l=h.clientHeight,h=Math.tan(.5*a.frustum.fovy),m=a.frustum.aspectRatio*h;b=2/k*b-1;c=2/l*(l-c)-1;l=a.positionWC;k=new f;f.multiplyByScalar(a.directionWC,e,k);f.add(l,k,k);l=new f;f.multiplyByScalar(a.rightWC,b*e*m,l);m=new f;f.multiplyByScalar(a.upWC,c*e*h,m);f.add(k,l,g);f.add(g,m,g)}else a=a.camera,h=a._scene.canvas,k=h.clientWidth,l=h.clientHeight,h=a.frustum,d(h._offCenterFrustum)&&(h=h._offCenterFrustum),b=.5*(2/k*b-1)*(h.right-h.left),c=.5*(2/l*(l-c)-1)*(h.top-h.bottom),f.clone(a.position,g),e=new f,f.multiplyByScalar(a.right,b,e),f.add(e,g,g),f.multiplyByScalar(a.up,c,e),f.add(e,g,g),a._mode===S.COLUMBUS_VIEW&&f.fromElements(g.z,g.x,g.y,g);return g}function pa(a,b,c){a<=b&&(a=b);a>=c&&(a=c);return a}function oa(a,b){return 1E-5>Math.abs(a-b)?!0:!1}function qa(a){if(d(a.taskProcessor)&&!1===a._alphaArrUpdating&&!1===a._alphaArrReady){var b=a.taskProcessor.scheduleTask({currentParticleArr:a._currentParticleArrForWorker,numCurrentPoint:a._numCurrentPoint,alphaArr:a._alphaArr,currentFadeSpeed:a._currentFadeSpeed,camPosition:a._camPosition,visibleAngle:a._visibleAngle,is3d:a._mode==S.SCENE3D?!0:!1});a._alphaArrUpdating=!0;d(b)&&U(b,function(b){a._alphaArr=new Uint8Array(b.alphaArr);a._alphaArrReady=!0;a._alphaArrUpdating=!1})}}function ua(a,b){var c,d;b?(c=a.createShader(a.VERTEX_SHADER),d=da):(c=a.createShader(a.FRAGMENT_SHADER),d=T);a.shaderSource(c,d);a.compileShader(c);if(a.getShaderParameter(c,a.COMPILE_STATUS))return c;c=a.getShaderInfoLog(c);alert(c)}function ta(a,b,c,d){var e=a._currentRenderState,f=a._currentPassState;a._currentRenderState=b;a._currentPassState=c;L.partialApply(a._gl,e,b,f,c,d)}function wa(a){var b=U.defer(),c=new XMLHttpRequest;c.open("GET",a._url,!0);c.onload=function(){if(200==c.status){var a=JSON.parse(c.response);b.resolve(a)}};c.send(null);c.onerror=function(a){b.reject()};return b.promise}function za(a,b){b.age=Math.round(Da(0,a._numCurrentPoint-2));b.pos=new f;b.pos.x=0;var c,d,e=0,g,h=0,k=a._colorStyles[0];do{d=Da(a._currentMinLat,a._currentMaxLat);c=Da(a._currentMinLon,a._currentMaxLon);360<c&&(c-=360);a:{var l=a;g=c-l._header.\u03bb0;g-=360*Math.floor(g/360);var m=(360===g?0:g)/l._header.\u0394\u03bb,p=(l._header.\u03c60-(90-d))/l._header.\u0394\u03c6,q=Math.floor(m),r=q+1,t=Math.floor(p),w;if(w=l._grid[t]){g=w[q];var u=w[r];if(g&&u&&(w=l._grid[t+1])&&(l=w[q],r=w[r],l&&r)){m-=q;q=p-t;w=1-m;t=1-q;p=w*t;t*=m;w*=q;q*=m;m=g[0]*p+u[0]*t+l[0]*w+r[0]*q;g=g[1]*p+u[1]*t+l[1]*w+r[1]*q;g=[m,g,Math.sqrt(m*m+g*g)];break a}}g=void 0}g&&h<g[2]&&(h=g[2])}while(g&&4>g[2]&&30>e++);g?(k=Math.max(h,4)-4,b.age=Math.floor(Math.abs(1-k/a._maxIntensity)*(a._numCurrentPoint-2)),b.age=Math.min(b.age,a._numCurrentPoint-2)):b.age=0;b.pos.y=d;b.pos.z=c;b.color=a._colorStyles[Math.floor(Math.min(k+4,a._maxIntensity)/a._maxIntensity*(a._colorStyles.length-1))];b.pos.z>a._currentData[0].lonLength&&(b.pos.z-=a._currentData[0].lonLength);b.dir=new f;b.lastTime=-1;b.firstTime=!0}function Da(a,b){return a+Math.random()*(b-a)}q(Z.prototype,{show:{get:function(){return this._show},set:function(a){this._show=a}},visibleHeight:{get:function(){return this._visibleHeight},set:function(a){this._visibleHeight=a;this._updateRangeMinHeight=this._visibleHeight[0];this._updateRangeMaxHeight=this._visibleHeight[1]}},color:{get:function(){return this._color},set:function(a){this._color=a}}});Z.prototype.update=function(c){if(c.mode==S.SCENE3D){if(d(this._grid)){if(this._imgU&&!d(this._textureU)){var e={};e.windFieldBuffer=this._imgU;this._textureU=new O({context:c.context,flipY:!0,width:361,height:181,source:e,pixelFormat:F.RGBA,pixelDatatype:aa.UNSIGNED_BYTE})}this._imgV&&!d(this._textureV)&&(e={},e.windFieldBuffer=this._imgV,this._textureV=new O({context:c.context,flipY:!0,width:361,height:181,source:e,pixelFormat:F.RGBA,pixelDatatype:aa.UNSIGNED_BYTE}));c.context.uniformState.windField.texWindU=this._textureU;c.context.uniformState.windField.texWindV=this._textureV;if(this.show)c.context.uniformState.windField.enable=this._showBackGround;else{c.context.uniformState.windField.enable=!1;return}}if(this._dataLoaded){f.clone(c.camera.position,this._camPosition);this._camSpherePos=V.WGS84.cartesianToCartographic(this._camPosition);e=c.context._us._viewport;if(!(this._camSpherePos.height<this._updateRangeMinHeight))if(this._mode==S.SCENE3D){var g=new a(1,1),h=new a(e.width-1,1),l=new a(e.width-1,e.height-1),m=new a(1,e.height-1),e=Array(4),g=c.camera.pickEllipsoid(g);d(g)&&(e[0]=V.WGS84.cartesianToCartographic(g),e[0].longitude=fa.toDegrees(e[0].longitude),e[0].latitude=fa.toDegrees(e[0].latitude),0>e[0].longitude&&(e[0].longitude+=360));h=c.camera.pickEllipsoid(h);d(h)&&(e[1]=V.WGS84.cartesianToCartographic(h),e[1].longitude=fa.toDegrees(e[1].longitude),e[1].latitude=fa.toDegrees(e[1].latitude),0>e[1].longitude&&(e[1].longitude+=360));l=c.camera.pickEllipsoid(l);d(l)&&(e[2]=V.WGS84.cartesianToCartographic(l),e[2].longitude=fa.toDegrees(e[2].longitude),e[2].latitude=fa.toDegrees(e[2].latitude),0>e[2].longitude&&(e[2].longitude+=360));l=c.camera.pickEllipsoid(m);d(l)&&(e[3]=V.WGS84.cartesianToCartographic(l),e[3].longitude=fa.toDegrees(e[3].longitude),e[3].latitude=fa.toDegrees(e[3].latitude),0>e[3].longitude&&(e[3].longitude+=360));if(d(e[0])&&d(e[1])&&d(e[2])&&d(e[3])){for(var m=e[0].latitude,h=e[0].latitude,l=e[0].longitude,g=e[0].longitude,p=0;4>p;++p)e[p].longitude<l&&(l=e[p].longitude),e[p].longitude>g&&(g=e[p].longitude),e[p].latitude<m&&(m=e[p].latitude),e[p].latitude>h&&(h=e[p].latitude);this._viewMinLat=m;this._viewMaxLat=h;this._viewMinLon=l;this._viewMaxLon=g}else{l=ba.eastNorthUpToFixedFrame(this._camPosition);e=new k(1,0,0,1);m=new k;D.multiplyByVector(l,e,m);h=new k(0,1,0,1);e=new k;D.multiplyByVector(l,h,e);l=new f(m.x,m.y,m.z);g=new f;f.subtract(l,this._camPosition,g);f.normalize(g,g);e=new f(e.x,e.y,e.z);l=new f;f.subtract(e,this._camPosition,l);f.normalize(l,l);m=new f;f.clone(this._camPosition,m);f.normalize(m,m);h=f.magnitude(this._camPosition);e=V.WGS84.cartesianToCartographic(this._camPosition);e.height=0;e=V.WGS84.cartographicToCartesian(e);e=f.magnitude(e);h<=e+10&&(h=e+10);var q=Math.acos(e/h),h=new f,p=new f(-g.x,-g.y,-g.z),r=X.fromAxisAngle(p,q),p=v.fromQuaternion(r);v.multiplyByVector(p,m,h);f.normalize(h,h);p=new f;r=X.fromAxisAngle(g,q);g=v.fromQuaternion(r);v.multiplyByVector(g,m,p);f.normalize(p,p);var g=new f,t=new f(-l.x,-l.y,-l.z),r=X.fromAxisAngle(t,q),t=v.fromQuaternion(r);v.multiplyByVector(t,m,g);f.normalize(g,g);t=new f;r=X.fromAxisAngle(l,q);l=v.fromQuaternion(r);v.multiplyByVector(l,m,t);f.normalize(t,t);l=new f;f.multiplyByScalar(h,e,l);m=new f;f.multiplyByScalar(p,e,m);h=new f;f.multiplyByScalar(g,e,h);g=new f;f.multiplyByScalar(t,e,g);e=V.WGS84.cartesianToCartographic(l);e.longitude=fa.toDegrees(e.longitude);e.latitude=fa.toDegrees(e.latitude);l=V.WGS84.cartesianToCartographic(m);l.longitude=fa.toDegrees(l.longitude);l.latitude=fa.toDegrees(l.latitude);m=V.WGS84.cartesianToCartographic(h);m.longitude=fa.toDegrees(m.longitude);m.latitude=fa.toDegrees(m.latitude);h=V.WGS84.cartesianToCartographic(g);h.longitude=fa.toDegrees(h.longitude);h.latitude=fa.toDegrees(h.latitude);e=e.latitude;l=l.latitude;m=m.longitude;0>m&&(m+=360);h=h.longitude;0>h&&(h+=360);this._viewMinLat=l<e?l:e;this._viewMaxLat=e>l?e:l;this._viewMinLon=m<h?m:h;this._viewMaxLon=h>m?h:m}l=fa.toDegrees(this._camSpherePos.longitude);0>l&&(l+=360);e=fa.toDegrees(this._camSpherePos.latitude);l<this._viewMinLon||l>this._viewMaxLon?(l=this._viewMinLon,this._viewMinLon=this._viewMaxLon,this._viewMaxLon=l+360,this._stepOver360Lon=!0,this._stepOverLon=l):this._stepOver360Lon=!1;if(e<this._viewMinLat||e>this._viewMaxLat)0>e?this._viewMinLat=-90:this._viewMaxLat=90,this._viewMinLon=0,this._viewMaxLon=360}else this._viewMinLat=-90,this._viewMaxLat=90,this._viewMinLon=0,this._viewMaxLon=360;e=0;this._stepOver360Lon&&(e=360);this._currentMaxLat=this._viewMinLat>this._currentData[0].startLat||this._viewMinLat<this._currentData[0].endLat?this._currentData[0].latLength-1:(this._viewMinLat-this._currentData[0].startLat)/this._currentData[0].latOffset;this._currentMinLat=this._viewMaxLat>this._currentData[0].startLat||this._viewMaxLat<this._currentData[0].endLat?0:(this._viewMaxLat-this._currentData[0].startLat)/this._currentData[0].latOffset;this._currentMinLon=this._viewMinLon<this._currentData[0].startLon||this._viewMinLon>this._currentData[0].endLon+e?0:(this._viewMinLon-this._currentData[0].startLon)/this._currentData[0].lonOffset;this._currentMaxLon=this._viewMaxLon<this._currentData[0].startLon||this._viewMaxLon>this._currentData[0].endLon+e?this._currentData[0].lonLength-1:(this._viewMaxLon-this._currentData[0].startLon)/this._currentData[0].lonOffset;e=V.WGS84.cartesianToCartographic(this._camPosition);l=f.magnitude(this._camPosition);this._visibleAngle=Math.acos((l-e.height)/l);l=this._camSpherePos.height;e=ha(c,0,0,l);l=ha(c,this._waterPixelRate,0,l);m=new f;f.subtract(l,e,m);this._waterRate=f.magnitude(m);this._waterRate=pa(this._waterRate,100,35E4);this._waterVScale=this._waterUScale=this._velocityScale;this._mode=c.mode;this._projection=c.mapProjection;this._drawCommand.boundingVolume=this._mode==S.SCENE3D?this._boundBox3d:this._boundBox2d}c=c.commandList;this._mode!=S.MORPHING&&(this._drawCommand._boundingVolume=new b(this._camSpherePos,6.356752031424518E7),c.push(this._drawCommand))}};var Ba;"undefined"!==typeof WebGLRenderingContext&&(Ba=[ka.BACK]);Z.prototype.destroy=function(){this._currentData&&(this._currentData=[]);this._currentData=void 0;this._currentParticleArr&&(this._currentParticleArr=[]);this._currentParticleArr=void 0;this._currentParticleArrForWorker&&(this._currentParticleArrForWorker=[]);this._currentParticleArrForWorker=void 0;this._textureU&&(this._textureU.destroy(),this._textureU=void 0);this._textureV&&(this._textureV.destroy(),this._textureV=void 0);return t(this)};Z.prototype.draw=function(b,c){if(this._dataLoaded&&d(b)){var e=b._gl;if(d(e)){this._gl=e;if(!this._isGeometryCreate){if(b.vertexArrayObject){this._vao=b.glCreateVertexArray();b.glBindVertexArray(this._vao);var g=b._gl;this._positionBuffer=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,this._positionBuffer);for(var h=new Float32Array(4*this._vertexNum),k=0,l=0;l<this._vertexNum;++l)h[k++]=0,h[k++]=0,h[k++]=0,h[k++]=1;this._positionArr=h;g.bufferData(g.ARRAY_BUFFER,this._positionArr,g.STATIC_DRAW);this._alphaBuffer=g.createBuffer();g.bindBuffer(g.ARRAY_BUFFER,this._alphaBuffer);h=new Uint8Array(this._vertexNum);for(l=k=0;l<this._vertexNum;++l)h[k++]=0;this._alphaArr=h;g.bufferData(g.ARRAY_BUFFER,this._alphaArr,g.STATIC_DRAW);g.bindBuffer(g.ARRAY_BUFFER,null);this._indexBuffer=g.createBuffer();g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,this._indexBuffer);h=new Uint32Array(this._elementNum);for(l=k=0;l<this._numCurrent;++l)for(var m=0;m<this._numCurrentPoint-1;++m)h[k++]=this._numCurrentPoint*l+m,h[k++]=this._numCurrentPoint*l+m+1;g.bufferData(g.ELEMENT_ARRAY_BUFFER,h,g.STATIC_DRAW);g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,null);b.glBindVertexArray(null)}this._isGeometryCreate=!0}if(d(this._shaderProgram)){e.useProgram(this._shaderProgram);g=b._us;h=b._gl;d(this._uMVPMat)&&(l=g.viewProjection,k=new Float32Array(16),D.toArray(l,k),h.uniformMatrix4fv(this._uMVPMat,!1,k));d(this._uViewportTransformationMat)&&(l=g.viewportTransformation,k=new Float32Array(16),D.toArray(l,k),h.uniformMatrix4fv(this._uViewportTransformationMat,!1,k));d(this._uViewportOrthographicMat)&&(l=g.viewportOrthographic,k=new Float32Array(16),D.toArray(l,k),h.uniformMatrix4fv(this._uViewportOrthographicMat,!1,k));d(this._uMinLat)&&h.uniform1f(this._uMinLat,this._currentData[0].startLat);d(this._uMaxLat)&&h.uniform1f(this._uMaxLat,this._currentData[0].endLat);d(this._uMinLon)&&h.uniform1f(this._uMinLon,this._currentData[0].startLon-.5);d(this._uMaxLon)&&h.uniform1f(this._uMaxLon,this._currentData[0].endLon+.5);d(this._uIs3d)&&h.uniform1i(this._uIs3d,this._mode==S.SCENE3D?1:0);if(!this._posArrReady){for(g=0;g<this._currentParticleArr.length;++g)if(this._currentParticleArr[g].age<this._numCurrentPoint){h=ga()/1E3;this._currentParticleArr[g].firstTime||(k=h-this._currentParticleArr[g].lastTime,1<k&&(k=.25),l=new f,f.clone(this._currentParticleArr[g].dir,l),l=new a(l.x,l.y),a.normalize(l,l),a.multiplyByScalar(l,this._waterRate,l),m=l.x*k*this._waterUScale/(this._currentData[0].lonOffset/360*fa.PI*12756274),this._currentParticleArr[g].pos.y-=l.y*k*this._waterVScale/(this._currentData[0].lonOffset/360*fa.PI*1.27135046284E7),this._currentParticleArr[g].pos.z+=m,this._mode==S.SCENE3D&&(0>this._currentParticleArr[g].pos.z&&(this._currentParticleArr[g].pos.z+=this._currentData[0].lonLength),this._currentParticleArr[g].pos.z>this._currentData[0].lonLength-1&&(this._currentParticleArr[g].pos.z-=this._currentData[0].lonLength)));this._currentParticleArr[g].lastTime=h;l=new f;f.clone(this._currentParticleArr[g].pos,l);var p=Math.floor(l.y),p=pa(p,0,parseInt(this._currentData[0].latLength-1)),m=p+1,m=pa(m,0,parseInt(this._currentData[0].latLength-1)),q=l.y-p,k=Math.floor(l.z),k=pa(k,0,parseInt(this._currentData[0].lonLength-1)),h=k+1,h=pa(h,0,parseInt(this._currentData[0].lonLength-1)),l=l.z-k,t=p,w=m,u=k,v=h,y=this._currentData[0].lonLength*t+u,z=this._currentData[0].data[y];oa(z,this._waterUFillValue)&&(z=0);var E=this._currentData[1].data[y];oa(E,this._waterVFillValue)&&(E=0);var y=this._currentData[0].lonLength*t+v,A=this._currentData[0].data[y];oa(A,this._waterUFillValue)&&(A=0);t=this._currentData[1].data[y];oa(t,this._waterVFillValue)&&(t=0);y=this._currentData[0].lonLength*w+u;u=this._currentData[0].data[y];oa(u,this._waterUFillValue)&&(u=0);var C=this._currentData[1].data[y];oa(C,this._waterVFillValue)&&(C=0);y=this._currentData[0].lonLength*w+v;w=this._currentData[0].data[y];oa(w,this._waterUFillValue)&&(w=0);y=this._currentData[1].data[y];oa(y,this._waterVFillValue)&&(y=0);z+=(A-z)*l;E+=(t-E)*l;E+=(C+(y-C)*l-E)*q;this._currentParticleArr[g].dir.x=z+(u+(w-u)*l-z)*q;this._currentParticleArr[g].dir.y=E;p=this._currentData[0].startLat+p*this._currentData[0].latOffset;m=p+(this._currentData[0].startLat+m*this._currentData[0].latOffset-p)*q;k=this._currentData[0].startLon+k*this._currentData[0].lonOffset;k+=(this._currentData[0].startLon+h*this._currentData[0].lonOffset-k)*l;180<k&&(k-=360);h={};h.longitude=fa.toRadians(k);h.latitude=fa.toRadians(m);h.height=0;k=new f;this._mode==S.SCENE3D?k=V.WGS84.cartographicToCartesian(h):this._mode!=S.SCENE2D&&this._mode!=S.MORPHING||!d(this._projection)||(k=this._projection.project(h));h=4*(g*this._numCurrentPoint+this._currentParticleArr[g].age);this._positionArr[h++]=k.x;this._positionArr[h++]=k.y;this._positionArr[h++]=k.z;this._positionArr[h++]=this._currentParticleArr[g].color;this._currentParticleArr[g].age<this._numCurrentPoint-1&&(this._positionArr[h++]=k.x,this._positionArr[h++]=k.y,this._positionArr[h++]=k.z,this._positionArr[h++]=this._currentParticleArr[g].color);this._currentParticleArr[g].firstTime&&0<this._currentParticleArr[g].age&&(h-=12,this._positionArr[h++]=k.x,this._positionArr[h++]=k.y,this._positionArr[h++]=k.z,this._positionArr[h++]=this._currentParticleArr[g].color);this._currentParticleArrForWorker[g].wPos.x=k.x;this._currentParticleArrForWorker[g].wPos.y=k.y;this._currentParticleArrForWorker[g].wPos.z=k.z;this._currentParticleArrForWorker[g].age=this._currentParticleArr[g].age;this._currentParticleArr[g].age++;this._currentParticleArr[g].firstTime=!1}else h=g*this._numCurrentPoint,this._currentParticleArrForWorker[g].age=this._currentParticleArr[g].age,oa(0,this._alphaArr[h+this._numCurrentPoint-1])?za(this,this._currentParticleArr[g]):(h=4*(g*this._numCurrentPoint+this._numCurrentPoint-1),this._currentParticleArrForWorker[g].wPos.x=this._positionArr[h++],this._currentParticleArrForWorker[g].wPos.y=this._positionArr[h++],this._currentParticleArrForWorker[g].wPos.z=this._positionArr[h++]);this._posArrReady=!0}qa(this);this._posArrReady&&this._alphaArrReady&&(e.bindBuffer(e.ARRAY_BUFFER,this._positionBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._positionArr),e.bindBuffer(e.ARRAY_BUFFER,this._alphaBuffer),e.bufferSubData(e.ARRAY_BUFFER,0,this._alphaArr),e.bindBuffer(e.ARRAY_BUFFER,null),this._alphaArrReady=this._posArrReady=!1);if(!(this._camSpherePos.height>this._updateRangeMaxHeight||this._camSpherePos.height<this._updateRangeMinHeight)){g=c.framebuffer;if(g!==b._currentFramebuffer){b._currentFramebuffer=g;h=Ba;if(d(g)){g._bind();if(b.validateFramebuffer&&(h=b._gl,k=h.checkFramebufferStatus(h.FRAMEBUFFER),k!==h.FRAMEBUFFER_COMPLETE)){var B;switch(k){case h.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:B="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case h.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:B="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case h.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:B="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case h.FRAMEBUFFER_UNSUPPORTED:B="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new r(B);}h=g._getActiveColorAttachments()}else B=b._gl,B.bindFramebuffer(B.FRAMEBUFFER,null);b.drawBuffers&&b.glDrawBuffers(h)}B=b._currentRenderState;g=b._currentPassState;ta(b,this._renderState,c,!1);h=e.isEnabled(e.DEPTH_TEST);e.disable(e.DEPTH_TEST);b.glBindVertexArray(this._vao);k=e.getAttribLocation(this._shaderProgram,"v_position");e.enableVertexAttribArray(k);e.bindBuffer(e.ARRAY_BUFFER,this._positionBuffer);e.vertexAttribPointer(k,4,e.FLOAT,!1,0,0);k=e.getAttribLocation(this._shaderProgram,"v_alpha");e.enableVertexAttribArray(k);e.bindBuffer(e.ARRAY_BUFFER,this._alphaBuffer);e.vertexAttribPointer(k,1,e.UNSIGNED_BYTE,!1,0,0);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this._indexBuffer);e.activeTexture(e.TEXTURE0);e.bindTexture(e.TEXTURE_2D,this._transferTex);e.drawElements(e.LINES,this._elementNum,e.UNSIGNED_INT,0);e.bindBuffer(e.ARRAY_BUFFER,null);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null);b.glBindVertexArray(null);e.bindTexture(e.TEXTURE_2D,null);ta(b,B,g,!1);h&&e.enable(e.DEPTH_TEST)}}else e=b._gl,B=ua(e,!0),g=ua(e,!1),this._shaderProgram=e.createProgram(),e.attachShader(this._shaderProgram,B),e.attachShader(this._shaderProgram,g),e.linkProgram(this._shaderProgram),e.getProgramParameter(this._shaderProgram,e.LINK_STATUS)||(e=e.getProgramInfoLog(this._shaderProgram),alert(e),this._shaderProgram=void 0),e=b._gl,this._uMVPMat=e.getUniformLocation(this._shaderProgram,"uMVPMatrix"),this._uMinLat=e.getUniformLocation(this._shaderProgram,"u_minLat"),this._uMaxLat=e.getUniformLocation(this._shaderProgram,"u_maxLat"),this._uMinLon=e.getUniformLocation(this._shaderProgram,"u_minLon"),this._uMaxLon=e.getUniformLocation(this._shaderProgram,"u_maxLon"),this._uIs3d=e.getUniformLocation(this._shaderProgram,"u_is3d"),this._uViewportTransformationMat=e.getUniformLocation(this._shaderProgram,"u_viewportTransformationMat"),this._uViewportOrthographicMat=e.getUniformLocation(this._shaderProgram,"u_viewportOrthographicMat")}}};return Z});F("Renderer/ClearCommand",["../Core/Color","../Core/defaultValue","../Core/freezeObject"],function(b,a,f){function k(b){b=a(b,a.EMPTY_OBJECT);this.color=b.color;this.depth=b.depth;this.stencil=b.stencil;this.renderState=b.renderState;this.framebuffer=b.framebuffer;this.owner=b.owner;this.pass=b.pass}k.ALL=f(new k({color:new b(0,0,0,0),depth:1,stencil:0}));k.prototype.execute=function(a,b){a.clear(this,b)};return k});F("Shaders/ViewportQuadVS",[],function(){return"attribute vec4 position;\nattribute vec2 textureCoordinates;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_Position \x3d position;\nv_textureCoordinates \x3d textureCoordinates;\n}\n"});F("Renderer/ComputeEngine","../Core/BoundingRectangle ../Core/Check ../Core/Color ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/PrimitiveType ../Shaders/ViewportQuadVS ./ClearCommand ./DrawCommand ./Framebuffer ./RenderState ./ShaderProgram".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._context=a}var c,u=new p({primitiveType:m.TRIANGLES}),y=new h({color:new f(0,0,0,0)});r.prototype.execute=function(f){a.defined("computeCommand",f);k(f.preExecute)&&f.preExecute(f);if(!k(f.fragmentShaderSource)&&!k(f.shaderProgram))throw new l("computeCommand.fragmentShaderSource or computeCommand.shaderProgram is required.");a.defined("computeCommand.outputTexture",f.outputTexture);var g=f.outputTexture,h=g.width,m=g.height,p=this._context,r=k(f.vertexArray)?f.vertexArray:p.getViewportQuadVertexArray(),A=k(f.shaderProgram)?f.shaderProgram:t.fromCache({context:p,vertexShaderSource:e,fragmentShaderSource:f.fragmentShaderSource,attributeLocations:{position:0,textureCoordinates:1}}),I=new d({context:p,colorTextures:[g],destroyAttachments:!1});k(c)&&c.viewport.width===h&&c.viewport.height===m||(c=q.fromCache({viewport:new b(0,0,h,m)}));h=c;m=f.uniformMap;y.framebuffer=I;y.renderState=h;y.execute(p);u.vertexArray=r;u.renderState=h;u.shaderProgram=A;u.uniformMap=m;u.framebuffer=I;u.execute(p);I.destroy();f.persists||(A.destroy(),k(f.vertexArray)&&r.destroy());k(f.postExecute)&&f.postExecute(g)};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){return g(this)};return r});F("Renderer/PassState",[],function(){return function(b){this.context=b;this.viewport=this.scissorTest=this.blendingEnabled=this.framebuffer=void 0}});F("Renderer/ShaderCache",["../Core/defined","../Core/defineProperties","../Core/destroyObject","./ShaderProgram","./ShaderSource"],function(b,a,f,k,g){function l(a){this._context=a;this._shaders={};this._numberOfShaders=0;this._shadersToRelease={}}function m(a,b){for(var e=b.derivedKeywords,d=e.length,f=0;f<d;++f)m(a,a._shaders[e[f]+b.keyword]);delete a._shaders[b.keyword];b.shaderProgram.finalDestroy()}a(l.prototype,{numberOfShaders:{get:function(){return this._numberOfShaders}}});l.prototype.replaceShaderProgram=function(a){b(a.shaderProgram)&&a.shaderProgram.destroy();return this.getShaderProgram(a)};l.prototype.getShaderProgram=function(a){var e=a.vertexShaderSource,f=a.fragmentShaderSource,d=a.attributeLocations;"string"===typeof e&&(e=new g({sources:[e]}));"string"===typeof f&&(f=new g({sources:[f]}));var l=e.createCombinedVertexShader(this._context),m=f.createCombinedFragmentShader(this._context);a=l+m+JSON.stringify(d);if(b(this._shaders[a]))e=this._shaders[a],delete this._shadersToRelease[a];else{var r=this._context,f=new k({gl:r._gl,logShaderCompilation:r.logShaderCompilation,debugShaders:r.debugShaders,vertexShaderSource:e,vertexShaderText:l,fragmentShaderSource:f,fragmentShaderText:m,attributeLocations:d}),e={cache:this,shaderProgram:f,keyword:a,derivedKeywords:[],count:0};f._cachedShader=e;this._shaders[a]=e;++this._numberOfShaders}++e.count;return e.shaderProgram};l.prototype.replaceDerivedShaderProgram=function(a,f,g){var d=a._cachedShader,e=this._shaders[f+d.keyword];b(e)&&(m(this,e),e=d.derivedKeywords.indexOf(f),-1<e&&d.derivedKeywords.splice(e,1));return this.createDerivedShaderProgram(a,f,g)};l.prototype.getDerivedShaderProgram=function(a,f){var e=this._shaders[f+a._cachedShader.keyword];if(b(e))return e.shaderProgram};l.prototype.createDerivedShaderProgram=function(a,b,f){a=a._cachedShader;var d=b+a.keyword,e=f.vertexShaderSource,h=f.fragmentShaderSource;f=f.attributeLocations;"string"===typeof e&&(e=new g({sources:[e]}));"string"===typeof h&&(h=new g({sources:[h]}));var l=this._context,c=e.createCombinedVertexShader(l),m=h.createCombinedFragmentShader(l),e=new k({gl:l._gl,logShaderCompilation:l.logShaderCompilation,debugShaders:l.debugShaders,vertexShaderSource:e,vertexShaderText:c,fragmentShaderSource:h,fragmentShaderText:m,attributeLocations:f}),h={cache:this,shaderProgram:e,keyword:d,derivedKeywords:[],count:0};a.derivedKeywords.push(b);e._cachedShader=h;this._shaders[d]=h;return e};l.prototype.destroyReleasedShaderPrograms=function(){var a=this._shadersToRelease,b;for(b in a)a.hasOwnProperty(b)&&(m(this,a[b]),--this._numberOfShaders);this._shadersToRelease={}};l.prototype.releaseShaderProgram=function(a){b(a)&&(a=a._cachedShader)&&0===--a.count&&(this._shadersToRelease[a.keyword]=a)};l.prototype.isDestroyed=function(){return!1};l.prototype.destroy=function(){var a=this._shaders,b;for(b in a)a.hasOwnProperty(b)&&a[b].shaderProgram.finalDestroy();return f(this)};return l});F("Renderer/TextureCache",["../Core/defined","../Core/defineProperties","../Core/destroyObject"],function(b,a,f){function k(){this._textures={};this._numberOfTextures=0;this._texturesToRelease={}}a(k.prototype,{numberOfTextures:{get:function(){return this._numberOfTextures}}});k.prototype.getTexture=function(a){var f=this._textures[a];if(b(f))return delete this._texturesToRelease[a],++f.count,f.texture};k.prototype.addTexture=function(a,b){var f={texture:b,count:1};b.finalDestroy=b.destroy;var e=this;b.destroy=function(){0===--f.count&&(e._texturesToRelease[a]=f)};this._textures[a]=f;++this._numberOfTextures};k.prototype.destroyReleasedTextures=function(){var a=this._texturesToRelease,b;for(b in a)if(a.hasOwnProperty(b)){var f=a[b];delete this._textures[b];f.texture.finalDestroy();--this._numberOfTextures}this._texturesToRelease={}};k.prototype.isDestroyed=function(){return!1};k.prototype.destroy=function(){var a=this._textures,b;for(b in a)a.hasOwnProperty(b)&&a[b].texture.finalDestroy();return f(this)};return k});F("Renderer/UniformState","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/EncodedCartesian3 ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/Simon1994PlanetaryPositions ../Core/Transforms ../Scene/SceneMode ./Sampler".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(){this.gamma=this.globeDepthTexture=void 0;this._viewport=new b;this._viewportCartesian4=new k;this._viewportDirty=!1;this._viewportOrthographicMatrix=t.clone(t.IDENTITY);this._viewportTransformation=t.clone(t.IDENTITY);this._model=t.clone(t.IDENTITY);this._view=t.clone(t.IDENTITY);this._inverseView=t.clone(t.IDENTITY);this._projection=t.clone(t.IDENTITY);this._infiniteProjection=t.clone(t.IDENTITY);this._entireFrustum=new a;this._currentFrustum=new a;this._frustumPlanes=new k;this._frameState=this._log2NearDistance=this._log2FarPlusOne=this._log2FarDistance=void 0;this._temeToPseudoFixed=q.clone(t.IDENTITY);this._view3DDirty=!0;this._view3D=new t;this._inverseView3DDirty=!0;this._inverseView3D=new t;this._inverseModelDirty=!0;this._inverseModel=new t;this._inverseTransposeModelDirty=!0;this._inverseTransposeModel=new q;this._viewRotation=new q;this._inverseViewRotation=new q;this._viewRotation3D=new q;this._inverseViewRotation3D=new q;this._inverseProjectionDirty=!0;this._inverseProjection=new t;this._modelViewDirty=!0;this._modelView=new t;this._modelView3DDirty=!0;this._modelView3D=new t;this._modelViewRelativeToEyeDirty=!0;this._modelViewRelativeToEye=new t;this._inverseModelViewDirty=!0;this._inverseModelView=new t;this._inverseModelView3DDirty=!0;this._inverseModelView3D=new t;this._viewProjectionDirty=!0;this._viewProjection=new t;this._inverseViewProjectionDirty=!0;this._inverseViewProjection=new t;this._modelViewProjectionDirty=!0;this._modelViewProjection=new t;this._inverseModelViewProjectionDirty=!0;this._inverseModelViewProjection=new t;this._modelViewProjectionRelativeToEyeDirty=!0;this._modelViewProjectionRelativeToEye=new t;this._modelViewInfiniteProjectionDirty=!0;this._modelViewInfiniteProjection=new t;this._normalDirty=!0;this._normal=new q;this._normal3DDirty=!0;this._normal3D=new q;this._inverseNormalDirty=!0;this._inverseNormal=new q;this._inverseNormal3DDirty=!0;this._inverseNormal3D=new q;this._encodedCameraPositionMCDirty=!0;this._encodedCameraPositionMC=new p;this._cameraPosition=new f;this._sunPositionWC=new f;this._sunPositionColumbusView=new f;this._sunDirectionWC=new f;this._sunDirectionEC=new f;this._sunColor=new f;this._moonDirectionEC=new f;this._mapProjection=this._mode=this._pass=void 0;this._cameraDirection=new f;this._cameraRight=new f;this._cameraUp=new f;this._frustum2DWidth=0;this._eyeHeight2D=new a;this._resolutionScale=1;this._orthographicIn3D=!1;this._backgroundColor=new l;this._specularEnvironmentMaps=this._sphericalHarmonicCoefficients=this._environmentMap=this._brdfLut=void 0;this._specularEnvironmentMapsDimensions=new a;this._invertClassificationColor=this._fogDensity=this._specularEnvironmentMapsMaximumLOD=void 0;this._imagerySplitPosition=0;this._minimumDisableDepthTestDistance=this._geometricToleranceOverMeter=this._pixelSizePerMeter=void 0;this._windField={texWindU:void 0,texWindV:void 0,enable:!1};this._surfaceTansparency={enable:!1,tansparency:1}}function x(a){if(a._viewportDirty){var b=a._viewport;t.computeOrthographicOffCenter(b.x,b.x+b.width,b.y,b.y+b.height,0,1,a._viewportOrthographicMatrix);t.computeViewportTransformation(b,0,1,a._viewportTransformation);a._viewportDirty=!1}}function D(a){a._encodedCameraPositionMCDirty&&(a._encodedCameraPositionMCDirty=!1,t.multiplyByPoint(a.inverseModel,a._cameraPosition,J),p.fromCartesian(J,a._encodedCameraPositionMC))}function v(a){if(a._view3DDirty){if(a._mode===y.SCENE3D)t.clone(a._view,a._view3D);else{var b=a._cameraPosition,c=a._cameraDirection,g=a._cameraRight,h=a._cameraUp,k=a._frustum2DWidth,l=a._mode,m=a._mapProjection,p=a._view3D,q=w;q.x=b.y;q.y=b.z;q.z=b.x;b=G;b.x=g.y;b.y=g.z;b.z=g.x;g=E;g.x=h.y;g.y=h.z;g.z=h.x;h=L;h.x=c.y;h.y=c.z;h.z=c.x;l===y.SCENE2D&&(q.z=.5*k);c=m.unproject(q,K);c.longitude=d.clamp(c.longitude,-Math.PI,Math.PI);c.latitude=d.clamp(c.latitude,-d.PI_OVER_TWO,d.PI_OVER_TWO);m=m.ellipsoid;c=m.cartographicToCartesian(c,P);m=u.eastNorthUpToFixedFrame(c,m,N);t.multiplyByPointAsVector(m,b,b);t.multiplyByPointAsVector(m,g,g);t.multiplyByPointAsVector(m,h,h);e(p)||(p=new t);p[0]=b.x;p[1]=g.x;p[2]=-h.x;p[3]=0;p[4]=b.y;p[5]=g.y;p[6]=-h.y;p[7]=0;p[8]=b.z;p[9]=g.z;p[10]=-h.z;p[11]=0;p[12]=-f.dot(b,c);p[13]=-f.dot(g,c);p[14]=f.dot(h,c);p[15]=1}t.getRotation(a._view3D,a._viewRotation3D);a._view3DDirty=!1}}function B(a){a._inverseView3DDirty&&(t.inverseTransformation(a.view3D,a._inverseView3D),t.getRotation(a._inverseView3D,a._inverseViewRotation3D),a._inverseView3DDirty=!1)}h(z.prototype,{frameState:{get:function(){return this._frameState}},viewport:{get:function(){return this._viewport},set:function(a){if(!b.equals(a,this._viewport)){b.clone(a,this._viewport);a=this._viewport;var c=this._viewportCartesian4;c.x=a.x;c.y=a.y;c.z=a.width;c.w=a.height;this._viewportDirty=!0}}},viewportCartesian4:{get:function(){return this._viewportCartesian4}},viewportOrthographic:{get:function(){x(this);return this._viewportOrthographicMatrix}},viewportTransformation:{get:function(){x(this);return this._viewportTransformation}},model:{get:function(){return this._model},set:function(a){t.clone(a,this._model);this._encodedCameraPositionMCDirty=this._inverseNormal3DDirty=this._normal3DDirty=this._inverseNormalDirty=this._normalDirty=this._modelViewInfiniteProjectionDirty=this._modelViewProjectionRelativeToEyeDirty=this._inverseModelViewProjectionDirty=this._modelViewProjectionDirty=this._inverseModelViewDirty=this._modelViewRelativeToEyeDirty=this._inverseModelViewDirty=this._modelViewDirty=this._inverseTransposeModelDirty=this._inverseModelDirty=this._inverseModelView3DDirty=this._modelView3DDirty=!0}},inverseModel:{get:function(){this._inverseModelDirty&&(this._inverseModelDirty=!1,t.inverse(this._model,this._inverseModel));return this._inverseModel}},inverseTransposeModel:{get:function(){var a=this._inverseTransposeModel;this._inverseTransposeModelDirty&&(this._inverseTransposeModelDirty=!1,t.getRotation(this.inverseModel,a),q.transpose(a,a));return a}},view:{get:function(){return this._view}},view3D:{get:function(){v(this);return this._view3D}},viewRotation:{get:function(){v(this);return this._viewRotation}},viewRotation3D:{get:function(){v(this);return this._viewRotation3D}},inverseView:{get:function(){return this._inverseView}},inverseView3D:{get:function(){B(this);return this._inverseView3D}},inverseViewRotation:{get:function(){return this._inverseViewRotation}},inverseViewRotation3D:{get:function(){B(this);return this._inverseViewRotation3D}},projection:{get:function(){return this._projection}},inverseProjection:{get:function(){this._inverseProjectionDirty&&(this._inverseProjectionDirty=!1,this._mode===y.SCENE2D||this._mode===y.MORPHING||this._orthographicIn3D?t.clone(t.ZERO,this._inverseProjection):t.inverse(this._projection,this._inverseProjection));return this._inverseProjection}},infiniteProjection:{get:function(){return this._infiniteProjection}},modelView:{get:function(){this._modelViewDirty&&(this._modelViewDirty=!1,t.multiplyTransformation(this._view,this._model,this._modelView));return this._modelView}},modelView3D:{get:function(){this._modelView3DDirty&&(this._modelView3DDirty=!1,t.multiplyTransformation(this.view3D,this._model,this._modelView3D));return this._modelView3D}},modelViewRelativeToEye:{get:function(){if(this._modelViewRelativeToEyeDirty){this._modelViewRelativeToEyeDirty=!1;var a=this.modelView,b=this._modelViewRelativeToEye;b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=0;b[13]=0;b[14]=0;b[15]=a[15]}return this._modelViewRelativeToEye}},inverseModelView:{get:function(){this._inverseModelViewDirty&&(this._inverseModelViewDirty=!1,t.inverse(this.modelView,this._inverseModelView));return this._inverseModelView}},inverseModelView3D:{get:function(){this._inverseModelView3DDirty&&(this._inverseModelView3DDirty=!1,t.inverse(this.modelView3D,this._inverseModelView3D));return this._inverseModelView3D}},viewProjection:{get:function(){this._viewProjectionDirty&&(this._viewProjectionDirty=!1,t.multiply(this._projection,this._view,this._viewProjection));return this._viewProjection}},inverseViewProjection:{get:function(){this._inverseViewProjectionDirty&&(this._inverseViewProjectionDirty=!1,t.inverse(this.viewProjection,this._inverseViewProjection));return this._inverseViewProjection}},modelViewProjection:{get:function(){this._modelViewProjectionDirty&&(this._modelViewProjectionDirty=!1,t.multiply(this._projection,this.modelView,this._modelViewProjection));return this._modelViewProjection}},inverseModelViewProjection:{get:function(){this._inverseModelViewProjectionDirty&&(this._inverseModelViewProjectionDirty=!1,t.inverse(this.modelViewProjection,this._inverseModelViewProjection));return this._inverseModelViewProjection}},modelViewProjectionRelativeToEye:{get:function(){this._modelViewProjectionRelativeToEyeDirty&&(this._modelViewProjectionRelativeToEyeDirty=!1,t.multiply(this._projection,this.modelViewRelativeToEye,this._modelViewProjectionRelativeToEye));return this._modelViewProjectionRelativeToEye}},modelViewInfiniteProjection:{get:function(){this._modelViewInfiniteProjectionDirty&&(this._modelViewInfiniteProjectionDirty=!1,t.multiply(this._infiniteProjection,this.modelView,this._modelViewInfiniteProjection));return this._modelViewInfiniteProjection}},normal:{get:function(){if(this._normalDirty){this._normalDirty=!1;var a=this._normal;t.getRotation(this.inverseModelView,a);q.transpose(a,a)}return this._normal}},normal3D:{get:function(){if(this._normal3DDirty){this._normal3DDirty=!1;var a=this._normal3D;t.getRotation(this.inverseModelView3D,a);q.transpose(a,a)}return this._normal3D}},inverseNormal:{get:function(){this._inverseNormalDirty&&(this._inverseNormalDirty=!1,t.getRotation(this.inverseModelView,this._inverseNormal));return this._inverseNormal}},inverseNormal3D:{get:function(){this._inverseNormal3DDirty&&(this._inverseNormal3DDirty=!1,t.getRotation(this.inverseModelView3D,this._inverseNormal3D));return this._inverseNormal3D}},entireFrustum:{get:function(){return this._entireFrustum}},currentFrustum:{get:function(){return this._currentFrustum}},frustumPlanes:{get:function(){return this._frustumPlanes}},log2FarDistance:{get:function(){return this._log2FarDistance}},log2FarPlusOne:{get:function(){return this._log2FarPlusOne}},log2NearDistance:{get:function(){return this._log2NearDistance}},eyeHeight2D:{get:function(){return this._eyeHeight2D}},sunPositionWC:{get:function(){return this._sunPositionWC}},sunPositionColumbusView:{get:function(){return this._sunPositionColumbusView}},sunDirectionWC:{get:function(){return this._sunDirectionWC}},sunDirectionEC:{get:function(){return this._sunDirectionEC}},sunColor:{get:function(){return this._sunColor}},moonDirectionEC:{get:function(){return this._moonDirectionEC}},encodedCameraPositionMCHigh:{get:function(){D(this);return this._encodedCameraPositionMC.high}},encodedCameraPositionMCLow:{get:function(){D(this);return this._encodedCameraPositionMC.low}},temeToPseudoFixedMatrix:{get:function(){return this._temeToPseudoFixed}},resolutionScale:{get:function(){return this._resolutionScale}},fogDensity:{get:function(){return this._fogDensity}},geometricToleranceOverMeter:{get:function(){return this._geometricToleranceOverMeter}},pass:{get:function(){return this._pass}},backgroundColor:{get:function(){return this._backgroundColor}},brdfLut:{get:function(){return this._brdfLut}},environmentMap:{get:function(){return this._environmentMap}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps}},specularEnvironmentMapsDimensions:{get:function(){return this._specularEnvironmentMapsDimensions}},specularEnvironmentMapsMaximumLOD:{get:function(){return this._specularEnvironmentMapsMaximumLOD}},imagerySplitPosition:{get:function(){return this._imagerySplitPosition}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance}},invertClassificationColor:{get:function(){return this._invertClassificationColor}},windField:{get:function(){return this._windField}},surfaceTansparency:{get:function(){return this._surfaceTansparency}},nightLightMap:{get:function(){return this._frameState.nightLightMap}},orthographicIn3D:{get:function(){return this._orthographicIn3D}}});var C=new q,I=new g;z.prototype.updateCamera=function(a){var b=a.viewMatrix;t.clone(b,this._view);t.getRotation(b,this._viewRotation);this._inverseNormal3DDirty=this._normal3DDirty=this._inverseNormalDirty=this._normalDirty=this._modelViewInfiniteProjectionDirty=this._modelViewProjectionRelativeToEyeDirty=this._modelViewProjectionDirty=this._inverseViewProjectionDirty=this._viewProjectionDirty=this._inverseModelView3DDirty=this._inverseModelViewDirty=this._modelViewRelativeToEyeDirty=this._modelView3DDirty=this._modelViewDirty=this._inverseView3DDirty=this._view3DDirty=!0;b=a.inverseViewMatrix;t.clone(b,this._inverseView);t.getRotation(b,this._inverseViewRotation);f.clone(a.positionWC,this._cameraPosition);f.clone(a.directionWC,this._cameraDirection);f.clone(a.rightWC,this._cameraRight);f.clone(a.upWC,this._cameraUp);this._encodedCameraPositionMCDirty=!0;this._entireFrustum.x=a.frustum.near;this._entireFrustum.y=a.frustum.far;this.updateFrustum(a.frustum);this._orthographicIn3D=this._mode!==y.SCENE2D&&a.frustum instanceof r};z.prototype.updateFrustum=function(a){t.clone(a.projectionMatrix,this._projection);this._modelViewProjectionRelativeToEyeDirty=this._modelViewProjectionDirty=this._inverseViewProjectionDirty=this._viewProjectionDirty=this._inverseProjectionDirty=!0;e(a.infiniteProjectionMatrix)&&(t.clone(a.infiniteProjectionMatrix,this._infiniteProjection),this._modelViewInfiniteProjectionDirty=!0);this._currentFrustum.x=a.near;this._currentFrustum.y=a.far;this._log2FarDistance=2/d.log2(a.far+1);this._log2FarPlusOne=d.log2(a.far+1);this._log2NearDistance=d.log2(a.near);e(a._offCenterFrustum)&&(a=a._offCenterFrustum);this._frustumPlanes.x=a.top;this._frustumPlanes.y=a.bottom;this._frustumPlanes.z=a.left;this._frustumPlanes.w=a.right};z.prototype.updatePass=function(a){this._pass=a};var H=[];z.prototype.update=function(b){this._mode=b.mode;this._mapProjection=b.mapProjection;var d=b.context._canvas;this._resolutionScale=d.width/d.clientWidth;d=b.camera;this.updateCamera(d);b.mode===y.SCENE2D?(this._frustum2DWidth=d.frustum.right-d.frustum.left,this._eyeHeight2D.x=.5*this._frustum2DWidth,this._eyeHeight2D.y=this._eyeHeight2D.x*this._eyeHeight2D.x):(this._frustum2DWidth=0,this._eyeHeight2D.x=0,this._eyeHeight2D.y=0);e(u.computeIcrfToFixedMatrix(b.time,C))||(C=u.computeTemeToPseudoFixedMatrix(b.time,C));var g=c.computeSunPositionInEarthInertialFrame(b.time,this._sunPositionWC);q.multiplyByVector(C,g,g);f.normalize(g,this._sunDirectionWC);g=q.multiplyByVector(this.viewRotation3D,g,this._sunDirectionEC);f.normalize(g,g);g=c.computeMoonPositionInEarthInertialFrame(b.time,this._moonDirectionEC);q.multiplyByVector(C,g,g);q.multiplyByVector(this.viewRotation3D,g,g);f.normalize(g,g);var g=b.mapProjection,h=g.ellipsoid.cartesianToCartographic(this._sunPositionWC,I);g.project(h,this._sunPositionColumbusView);this._sunColor=f.clone(b.sunColor,this._sunColor);g=b.brdfLutGenerator;this._brdfLut=e(g)?g.colorTexture:void 0;this._environmentMap=m(b.environmentMap,b.context.defaultCubeMap);this._sphericalHarmonicCoefficients=m(b.sphericalHarmonicCoefficients,H);this._specularEnvironmentMaps=b.specularEnvironmentMaps;this._specularEnvironmentMapsMaximumLOD=b.specularEnvironmentMapsMaximumLOD;e(this._specularEnvironmentMaps)&&a.clone(this._specularEnvironmentMaps.dimensions,this._specularEnvironmentMapsDimensions);this._fogDensity=b.fog.density;this._invertClassificationColor=b.invertClassificationColor;this._frameState=b;this._temeToPseudoFixed=u.computeTemeToPseudoFixedMatrix(b.time,this._temeToPseudoFixed);this._imagerySplitPosition=b.imagerySplitPosition*b.context.drawingBufferWidth;d=d.frustum.fov;g=this._viewport;this._geometricToleranceOverMeter=(g.height>g.width?2*Math.tan(.5*d)/g.height:2*Math.tan(.5*d)/g.width)*b.maximumScreenSpaceError;l.clone(b.backgroundColor,this._backgroundColor);this._minimumDisableDepthTestDistance=b.minimumDisableDepthTestDistance;this._minimumDisableDepthTestDistance*=this._minimumDisableDepthTestDistance;this._minimumDisableDepthTestDistance===Number.POSITIVE_INFINITY&&(this._minimumDisableDepthTestDistance=-1)};var J=new f,w=new f,G=new f,E=new f,L=new f,K=new g,P=new f,N=new t;return z});F("Renderer/Context","../Core/Check ../Core/clone ../Core/Color ../Core/ComponentDatatype ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Geometry ../Core/GeometryAttribute ../Core/Matrix4 ../Core/PixelFormat ../Core/PrimitiveType ../Core/RuntimeError ../Core/WebGLConstants ../Shaders/ViewportQuadVS ./BufferUsage ./ClearCommand ./ContextLimits ./CubeMap ./DrawCommand ./PassState ./PixelDatatype ./RenderState ./ShaderCache ./ShaderProgram ./Texture ./TextureCache ./UniformState ./VertexArray".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K){function P(a,b,c){var d=a.getError();if(d!==a.NO_ERROR){var e="WebGL Error:  ";switch(d){case a.INVALID_ENUM:e+="INVALID_ENUM";break;case a.INVALID_VALUE:e+="INVALID_VALUE";break;case a.INVALID_OPERATION:e+="INVALID_OPERATION";break;case a.OUT_OF_MEMORY:e+="OUT_OF_MEMORY";break;case a.CONTEXT_LOST_WEBGL:e+="CONTEXT_LOST_WEBGL lost";break;default:e+="Unknown ("+d+")"}a=e+": "+b.name+"(";for(b=0;b<c.length;++b)0!==b&&(a+=", "),a+=c[b];throw new u(a+");");}}function N(a,b,c){return{get:function(){c(a,"get: "+b,a[b]);return a[b]},set:function(d){a[b]=d;c(a,"set: "+b,d)}}}function O(a,b){function c(c){return function(){var d=c.apply(a,arguments);b(a,c,arguments);return d}}if(!m(b))return a;var d={},e;for(e in a){var f=a[e];f instanceof Function?d[e]=c(f):Object.defineProperty(d,e,N(a,e,b))}return d}function F(a,b){for(var c=b.length,d=0;d<c;++d){var e=a.getExtension(b[d]);if(e)return e}}function aa(c,d){if("undefined"===typeof WebGLRenderingContext)throw new u("The browser does not support WebGL.  Visit http://get.webgl.org.");b.defined("canvas",c);this._canvas=c;d=a(d,!0);d=l(d,{});d.allowTextureFilterAnisotropic=l(d.allowTextureFilterAnisotropic,!0);var e=l(d.webgl,{});e.alpha=l(e.alpha,!1);e.stencil=l(e.stencil,!0);var h=l(d.requestWebgl2,!1)&&"undefined"!==typeof WebGL2RenderingContext,k=!1,p,q=d.getWebGLStub;if(m(q))p=q(c,e);else if(h&&(p=c.getContext("webgl2",e)||c.getContext("experimental-webgl2",e)||void 0,m(p)&&(k=!0)),m(p)||(p=c.getContext("webgl",e)||c.getContext("experimental-webgl",e)||void 0),!m(p))throw new u("The browser supports WebGL, but initialization failed.");this._gl=this._originalGLContext=p;this._webgl2=k;this._id=g();this._throwOnWebGLError=this.logShaderCompilation=this.validateShaderProgram=this.validateFramebuffer=!1;this._shaderCache=new J(this);this._textureCache=new E;var r=p;this._stencilBits=r.getParameter(r.STENCIL_BITS);D._maximumCombinedTextureImageUnits=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);D._maximumCubeMapSize=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE);D._maximumFragmentUniformVectors=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS);D._maximumTextureImageUnits=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS);D._maximumRenderbufferSize=r.getParameter(r.MAX_RENDERBUFFER_SIZE);D._maximumTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE);D._maximumVaryingVectors=r.getParameter(r.MAX_VARYING_VECTORS);D._maximumVertexAttributes=r.getParameter(r.MAX_VERTEX_ATTRIBS);D._maximumVertexTextureImageUnits=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS);D._maximumVertexUniformVectors=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS);e=r.getParameter(r.ALIASED_LINE_WIDTH_RANGE);D._minimumAliasedLineWidth=e[0];D._maximumAliasedLineWidth=e[1];e=r.getParameter(r.ALIASED_POINT_SIZE_RANGE);D._minimumAliasedPointSize=e[0];D._maximumAliasedPointSize=e[1];e=r.getParameter(r.MAX_VIEWPORT_DIMS);D._maximumViewportWidth=e[0];D._maximumViewportHeight=e[1];e=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT);D._highpFloatSupported=0!==e.precision;e=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_INT);D._highpIntSupported=0!==e.rangeMax;this._antialias=r.getContextAttributes().antialias;this._standardDerivatives=!!F(r,["OES_standard_derivatives"]);this._blendMinmax=!!F(r,["EXT_blend_minmax"]);this._elementIndexUint=!!F(r,["OES_element_index_uint"]);this._depthTexture=!!F(r,["WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]);this._fragDepth=!!F(r,["EXT_frag_depth"]);this._debugShaders=F(r,["WEBGL_debug_shaders"]);this._textureFloat=!!F(r,["OES_texture_float"]);this._textureHalfFloat=!!F(r,["OES_texture_half_float"]);this._textureFloatLinear=!!F(r,["OES_texture_float_linear"]);this._textureHalfFloatLinear=!!F(r,["OES_texture_half_float_linear"]);this._colorBufferFloat=!!F(r,["EXT_color_buffer_float","WEBGL_color_buffer_float"]);this._colorBufferHalfFloat=!!F(r,["EXT_color_buffer_half_float"]);this._s3tc=!!F(r,["WEBGL_compressed_texture_s3tc","MOZ_WEBGL_compressed_texture_s3tc","WEBKIT_WEBGL_compressed_texture_s3tc"]);this._pvrtc=!!F(r,["WEBGL_compressed_texture_pvrtc","WEBKIT_WEBGL_compressed_texture_pvrtc"]);this._etc1=!!F(r,["WEBGL_compressed_texture_etc1"]);this._textureFilterAnisotropic=e=d.allowTextureFilterAnisotropic?F(r,["EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic"]):void 0;D._maximumTextureFilterAnisotropy=m(e)?r.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1;var t,w,v,z,A,B,G,x,K,I;if(k){var M=this;t=function(){return M._gl.createVertexArray()};w=function(a){M._gl.bindVertexArray(a)};v=function(a){M._gl.deleteVertexArray(a)};z=function(a,b,c,d,e){r.drawElementsInstanced(a,b,c,d,e)};A=function(a,b,c,d){r.drawArraysInstanced(a,b,c,d)};B=function(a,b){r.vertexAttribDivisor(a,b)};G=function(a){r.drawBuffers(a)}}else x=F(r,["OES_vertex_array_object"]),m(x)&&(t=function(){return x.createVertexArrayOES()},w=function(a){x.bindVertexArrayOES(a)},v=function(a){x.deleteVertexArrayOES(a)}),K=F(r,["ANGLE_instanced_arrays"]),m(K)&&(z=function(a,b,c,d,e){K.drawElementsInstancedANGLE(a,b,c,d,e)},A=function(a,b,c,d){K.drawArraysInstancedANGLE(a,b,c,d)},B=function(a,b){K.vertexAttribDivisorANGLE(a,b)}),I=F(r,["WEBGL_draw_buffers"]),m(I)&&(G=function(a){I.drawBuffersWEBGL(a)});this.glCreateVertexArray=t;this.glBindVertexArray=w;this.glDeleteVertexArray=v;this.glDrawElementsInstanced=z;this.glDrawArraysInstanced=A;this.glVertexAttribDivisor=B;this.glDrawBuffers=G;this._vertexArrayObject=!!x;this._instancedArrays=!!K;this._drawBuffers=!!I;D._maximumDrawBuffers=this.drawBuffers?r.getParameter(y.MAX_DRAW_BUFFERS):1;D._maximumColorAttachments=this.drawBuffers?r.getParameter(y.MAX_COLOR_ATTACHMENTS):1;this._clearColor=new f(0,0,0,0);this._clearDepth=1;this._clearStencil=0;w=new L;k=new C(this);t=H.fromCache();this._defaultPassState=k;this._defaultRenderState=t;this._defaultCubeMap=this._defaultTexture=void 0;this._us=w;this._currentRenderState=t;this._currentPassState=k;this._currentFramebuffer=void 0;this._maxFrameTextureUnitIndex=0;this._vertexAttribDivisors=[];this._previousDrawInstanced=!1;for(w=0;w<D._maximumVertexAttributes;w++)this._vertexAttribDivisors.push(0);this._pickObjects={};this._nextPickColor=new Uint32Array(1);this.options=d;this.cache={};H.apply(r,t,k)}function U(a,b,c,d){var e=a._currentRenderState,f=a._currentPassState;a._currentRenderState=b;a._currentPassState=c;H.partialApply(a._gl,e,b,f,c,d)}function W(a,b){if(b!==a._currentFramebuffer){a._currentFramebuffer=b;var c=Y;if(m(b)){b._bind();if(a.validateFramebuffer){var c=a._gl,d=c.checkFramebufferStatus(c.FRAMEBUFFER);if(d!==c.FRAMEBUFFER_COMPLETE){var e;switch(d){case c.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:e="Framebuffer is not complete.  Incomplete attachment: at least one attachment point with a renderbuffer or texture attached has its attached object no longer in existence or has an attached image with a width or height of zero, or the color attachment point has a non-color-renderable image attached, or the depth attachment point has a non-depth-renderable image attached, or the stencil attachment point has a non-stencil-renderable image attached.  Color-renderable formats include GL_RGBA4, GL_RGB5_A1, and GL_RGB565. GL_DEPTH_COMPONENT16 is the only depth-renderable format. GL_STENCIL_INDEX8 is the only stencil-renderable format.";break;case c.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:e="Framebuffer is not complete.  Incomplete dimensions: not all attached images have the same width and height.";break;case c.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:e="Framebuffer is not complete.  Missing attachment: no images are attached to the framebuffer.";break;case c.FRAMEBUFFER_UNSUPPORTED:e="Framebuffer is not complete.  Unsupported: the combination of internal formats of the attached images violates an implementation-dependent set of restrictions."}throw new p(e);}}c=b._getActiveColorAttachments()}else e=a._gl,e.bindFramebuffer(e.FRAMEBUFFER,null);a.drawBuffers&&a.glDrawBuffers(c)}}function M(a,b,c){this._pickObjects=a;this.key=b;this.color=c}var R={};e(aa.prototype,{id:{get:function(){return this._id}},webgl2:{get:function(){return this._webgl2}},canvas:{get:function(){return this._canvas}},shaderCache:{get:function(){return this._shaderCache}},textureCache:{get:function(){return this._textureCache}},uniformState:{get:function(){return this._us}},stencilBits:{get:function(){return this._stencilBits}},stencilBuffer:{get:function(){return 8<=this._stencilBits}},antialias:{get:function(){return this._antialias}},standardDerivatives:{get:function(){return this._standardDerivatives||this._webgl2}},blendMinmax:{get:function(){return this._blendMinmax||this._webgl2}},elementIndexUint:{get:function(){return this._elementIndexUint||this._webgl2}},depthTexture:{get:function(){return this._depthTexture||this._webgl2}},floatingPointTexture:{get:function(){return this._webgl2||this._textureFloat}},halfFloatingPointTexture:{get:function(){return this._webgl2||this._textureHalfFloat}},textureFloatLinear:{get:function(){return this._textureFloatLinear}},textureHalfFloatLinear:{get:function(){return this._webgl2&&this._textureFloatLinear||!this._webgl2&&this._textureHalfFloatLinear}},textureFilterAnisotropic:{get:function(){return!!this._textureFilterAnisotropic}},s3tc:{get:function(){return this._s3tc}},pvrtc:{get:function(){return this._pvrtc}},etc1:{get:function(){return this._etc1}},vertexArrayObject:{get:function(){return this._vertexArrayObject||this._webgl2}},fragmentDepth:{get:function(){return this._fragDepth||this._webgl2}},instancedArrays:{get:function(){return this._instancedArrays||this._webgl2}},colorBufferFloat:{get:function(){return this._colorBufferFloat}},colorBufferHalfFloat:{get:function(){return this._webgl2&&this._colorBufferFloat||!this._webgl2&&this._colorBufferHalfFloat}},drawBuffers:{get:function(){return this._drawBuffers||this._webgl2}},debugShaders:{get:function(){return this._debugShaders}},throwOnWebGLError:{get:function(){return this._throwOnWebGLError},set:function(a){this._throwOnWebGLError=a;this._gl=O(this._originalGLContext,a?P:void 0)}},defaultTexture:{get:function(){void 0===this._defaultTexture&&(this._defaultTexture=new G({context:this,source:{width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])},flipY:!1}));return this._defaultTexture}},defaultCubeMap:{get:function(){if(void 0===this._defaultCubeMap){var a={width:1,height:1,arrayBufferView:new Uint8Array([255,255,255,255])};this._defaultCubeMap=new v({context:this,source:{positiveX:a,negativeX:a,positiveY:a,negativeY:a,positiveZ:a,negativeZ:a},flipY:!1})}return this._defaultCubeMap}},drawingBufferHeight:{get:function(){return this._gl.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._gl.drawingBufferWidth}},defaultFramebuffer:{get:function(){return R}}});var Y;"undefined"!==typeof WebGLRenderingContext&&(Y=[y.BACK]);var Q=new x;aa.prototype.clear=function(a,b){a=l(a,Q);b=l(b,this._defaultPassState);var c=this._gl,d=0,e=a.color,g=a.depth,h=a.stencil;m(e)&&(f.equals(this._clearColor,e)||(f.clone(e,this._clearColor),c.clearColor(e.red,e.green,e.blue,e.alpha)),d|=c.COLOR_BUFFER_BIT);m(g)&&(g!==this._clearDepth&&(this._clearDepth=g,c.clearDepth(g)),d|=c.DEPTH_BUFFER_BIT);m(h)&&(h!==this._clearStencil&&(this._clearStencil=h,c.clearStencil(h)),d|=c.STENCIL_BUFFER_BIT);e=l(a.renderState,this._defaultRenderState);U(this,e,b,!0);e=l(a.framebuffer,b.framebuffer);W(this,e);c.clear(d)};aa.prototype.draw=function(a,d,e,f){b.defined("drawCommand",a);b.defined("drawCommand.shaderProgram",a._shaderProgram);d=l(d,this._defaultPassState);var g=l(a._framebuffer,d.framebuffer),h=l(a._renderState,this._defaultRenderState);e=l(e,a._shaderProgram);f=l(f,a._uniformMap);var k=e;if(m(g)&&h.depthTest&&h.depthTest.enabled&&!g.hasDepthAttachment)throw new p("The depth test can not be enabled (drawCommand.renderState.depthTest.enabled) because the framebuffer (drawCommand.framebuffer) does not have a depth or depth-stencil renderbuffer.");W(this,g);U(this,h,d,!1);k._bind();this._maxFrameTextureUnitIndex=Math.max(this._maxFrameTextureUnitIndex,k.maximumTextureUnitIndex);var q=f;f=a._primitiveType;g=a._vertexArray;h=a._offset;d=a._count;k=a.instanceCount;if(!c.validate(f))throw new p("drawCommand.primitiveType is required and must be valid.");b.defined("drawCommand.vertexArray",g);b.typeOf.number.greaterThanOrEquals("drawCommand.offset",h,0);m(d)&&b.typeOf.number.greaterThanOrEquals("drawCommand.count",d,0);b.typeOf.number.greaterThanOrEquals("drawCommand.instanceCount",k,0);if(0<k&&!this.instancedArrays)throw new p("Instanced arrays extension is not supported");this._us.model=l(a._modelMatrix,t.IDENTITY);e._setUniforms(q,this._us,this.validateShaderProgram);g._bind();a=g.indexBuffer;m(a)?(h*=a.bytesPerIndex,d=l(d,a.numberOfIndices),0===k?this._gl.drawElements(f,d,a.indexDatatype,h):this.glDrawElementsInstanced(f,d,a.indexDatatype,h,k)):(d=l(d,g.numberOfVertices),0===k?this._gl.drawArrays(f,h,d):this.glDrawArraysInstanced(f,h,d,k));g._unBind()};aa.prototype.endFrame=function(){var a=this._gl;a.useProgram(null);this._currentFramebuffer=void 0;a.bindFramebuffer(a.FRAMEBUFFER,null);var b=Y;this.drawBuffers&&this.glDrawBuffers(b);for(var b=this._maxFrameTextureUnitIndex,c=this._maxFrameTextureUnitIndex=0;c<b;++c)a.activeTexture(a.TEXTURE0+c),a.bindTexture(a.TEXTURE_2D,null),a.bindTexture(a.TEXTURE_CUBE_MAP,null)};aa.prototype.readPixels=function(a){var c=this._gl;a=l(a,l.EMPTY_OBJECT);var d=Math.max(l(a.x,0),0),e=Math.max(l(a.y,0),0),f=l(a.width,c.drawingBufferWidth),g=l(a.height,c.drawingBufferHeight);a=a.framebuffer;b.typeOf.number.greaterThan("readState.width",f,0);b.typeOf.number.greaterThan("readState.height",g,0);var h=I.UNSIGNED_BYTE;m(a)&&0<a.numberOfColorAttachments&&(h=a.getColorTexture(0).pixelDatatype);var k=r.createTypedArray(r.RGBA,h,f,g);W(this,a);c.readPixels(d,e,f,g,r.RGBA,h,k);return k};var S={position:0,textureCoordinates:1};aa.prototype.getViewportQuadVertexArray=function(){var a=this.cache.viewportQuad_vertexArray;m(a)||(a=new d({attributes:{position:new q({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:[-1,-1,1,-1,1,1,-1,1]}),textureCoordinates:new q({componentDatatype:k.FLOAT,componentsPerAttribute:2,values:[0,0,1,0,1,1,0,1]})},indices:new Uint16Array([0,1,2,0,2,3]),primitiveType:c.TRIANGLES}),a=K.fromGeometry({context:this,geometry:a,attributeLocations:S,bufferUsage:z.STATIC_DRAW,interleave:!0}),this.cache.viewportQuad_vertexArray=a);return a};aa.prototype.createViewportQuadCommand=function(a,b){b=l(b,l.EMPTY_OBJECT);return new B({vertexArray:this.getViewportQuadVertexArray(),primitiveType:c.TRIANGLES,renderState:b.renderState,shaderProgram:w.fromCache({context:this,vertexShaderSource:A,fragmentShaderSource:a,attributeLocations:S}),uniformMap:b.uniformMap,owner:b.owner,framebuffer:b.framebuffer,pass:b.pass})};aa.prototype.getObjectByPickColor=function(a){b.defined("pickColor",a);return this._pickObjects[a.toRgba()]};e(M.prototype,{object:{get:function(){return this._pickObjects[this.key]},set:function(a){this._pickObjects[this.key]=a}}});M.prototype.destroy=function(){delete this._pickObjects[this.key]};aa.prototype.createPickId=function(a){b.defined("object",a);++this._nextPickColor[0];var c=this._nextPickColor[0];if(0===c)throw new u("Out of unique Pick IDs.");this._pickObjects[c]=a;return new M(this._pickObjects,c,f.fromRgba(c))};aa.prototype.isDestroyed=function(){return!1};aa.prototype.destroy=function(){var a=this.cache,b;for(b in a)if(a.hasOwnProperty(b)){var c=a[b];m(c.destroy)&&c.destroy()}this._shaderCache=this._shaderCache.destroy();this._textureCache=this._textureCache.destroy();this._defaultTexture=this._defaultTexture&&this._defaultTexture.destroy();this._defaultCubeMap=this._defaultCubeMap&&this._defaultCubeMap.destroy();return h(this)};return aa});F("Renderer/loadCubeMap","../Core/Check ../Core/defined ../Core/DeveloperError ../Core/Resource ../ThirdParty/when ./CubeMap".split(" "),function(b,a,f,k,g,l){return function(m,e){b.defined("context",m);if(!(a(e)&&a(e.positiveX)&&a(e.negativeX)&&a(e.positiveY)&&a(e.negativeY)&&a(e.positiveZ)&&a(e.negativeZ)))throw new f("urls is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");var h={flipY:!0,preferImageBitmap:!0},h=[k.createIfNeeded(e.positiveX).fetchImage(h),k.createIfNeeded(e.negativeX).fetchImage(h),k.createIfNeeded(e.positiveY).fetchImage(h),k.createIfNeeded(e.negativeY).fetchImage(h),k.createIfNeeded(e.positiveZ).fetchImage(h),k.createIfNeeded(e.negativeZ).fetchImage(h)];return g.all(h,function(a){return new l({context:m,source:{positiveX:a[0],negativeX:a[1],positiveY:a[2],negativeY:a[3],positiveZ:a[4],negativeZ:a[5]}})})}});F("Renderer/RenderbufferFormat",["../Core/freezeObject","../Core/WebGLConstants"],function(b,a){var f={RGBA4:a.RGBA4,RGB5_A1:a.RGB5_A1,RGB565:a.RGB565,DEPTH_COMPONENT16:a.DEPTH_COMPONENT16,STENCIL_INDEX8:a.STENCIL_INDEX8,DEPTH_STENCIL:a.DEPTH_STENCIL,validate:function(a){return a===f.RGBA4||a===f.RGB5_A1||a===f.RGB565||a===f.DEPTH_COMPONENT16||a===f.STENCIL_INDEX8||a===f.DEPTH_STENCIL}};return b(f)});F("Renderer/Renderbuffer","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ./ContextLimits ./RenderbufferFormat".split(" "),function(b,a,f,k,g,l,m,e){function h(g){g=a(g,a.EMPTY_OBJECT);b.defined("options.context",g.context);var d=g.context._gl,h=m.maximumRenderbufferSize,k=a(g.format,e.RGBA4),p=f(g.width)?g.width:d.drawingBufferWidth;g=f(g.height)?g.height:d.drawingBufferHeight;if(!e.validate(k))throw new l("Invalid format.");b.typeOf.number.greaterThan("width",p,0);if(p>h)throw new l("Width must be less than or equal to the maximum renderbuffer size ("+h+").  Check maximumRenderbufferSize.");b.typeOf.number.greaterThan("height",g,0);if(g>h)throw new l("Height must be less than or equal to the maximum renderbuffer size ("+h+").  Check maximumRenderbufferSize.");this._gl=d;this._format=k;this._width=p;this._height=g;this._renderbuffer=this._gl.createRenderbuffer();d.bindRenderbuffer(d.RENDERBUFFER,this._renderbuffer);d.renderbufferStorage(d.RENDERBUFFER,k,p,g);d.bindRenderbuffer(d.RENDERBUFFER,null)}k(h.prototype,{format:{get:function(){return this._format}},width:{get:function(){return this._width}},height:{get:function(){return this._height}}});h.prototype._getRenderbuffer=function(){return this._renderbuffer};h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){this._gl.deleteRenderbuffer(this._renderbuffer);return g(this)};return h});F("Scene/DiscardMissingTileImagePolicy",["../Core/defaultValue","../Core/defined","../Core/DeveloperError","../Core/getImagePixels","../Core/Resource"],function(b,a,f,k,g){function l(l){l=b(l,b.EMPTY_OBJECT);if(!a(l.missingImageUrl))throw new f("options.missingImageUrl is required.");if(!a(l.pixelsToCheck))throw new f("options.pixelsToCheck is required.");this._pixelsToCheck=l.pixelsToCheck;this._missingImageByteLength=this._missingImagePixels=void 0;this._isReady=!1;var e=this;g.createIfNeeded(l.missingImageUrl).fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}).then(function(b){a(b.blob)&&(e._missingImageByteLength=b.blob.size);var f=k(b);if(l.disableCheckIfAllPixelsAreTransparent){var d=!0;b=b.width;for(var g=l.pixelsToCheck,h=0,m=g.length;d&&h<m;++h){var c=g[h];0<f[4*c.x+c.y*b+3]&&(d=!1)}d&&(f=void 0)}e._missingImagePixels=f;e._isReady=!0}).otherwise(function(){e._missingImagePixels=void 0;e._isReady=!0})}l.prototype.isReady=function(){return this._isReady};l.prototype.shouldDiscardImage=function(b){if(!this._isReady)throw new f("shouldDiscardImage must not be called before the discard policy is ready.");var e=this._pixelsToCheck,g=this._missingImagePixels;if(!a(g)||a(b.blob)&&b.blob.size!==this._missingImageByteLength)return!1;var l=k(b);b=b.width;for(var d=0,m=e.length;d<m;++d)for(var t=e[d],t=4*t.x+t.y*b,r=0;4>r;++r){var c=t+r;if(l[c]!==g[c])return!1}return!0};return l});F("Scene/ImageryLayerFeatureInfo",["../Core/defined"],function(b){function a(){this.imageryLayer=this.data=this.position=this.description=this.name=void 0}a.prototype.configureNameFromProperties=function(a){var f=10,g,l;for(l in a)if(a.hasOwnProperty(l)&&a[l]){var m=l.toLowerCase();1<f&&"name"===m?(f=1,g=l):2<f&&"title"===m?(f=2,g=l):3<f&&/name/i.test(l)?(f=3,g=l):4<f&&/title/i.test(l)&&(f=4,g=l)}b(g)&&(this.name=a[g])};a.prototype.configureDescriptionFromProperties=function(a){function f(a){var g='\x3ctable class\x3d"cesium-infoBox-defaultTable"\x3e',k;for(k in a)if(a.hasOwnProperty(k)){var e=a[k];b(e)&&(g="object"===typeof e?g+("\x3ctr\x3e\x3ctd\x3e"+k+"\x3c/td\x3e\x3ctd\x3e"+f(e)+"\x3c/td\x3e\x3c/tr\x3e"):g+("\x3ctr\x3e\x3ctd\x3e"+k+"\x3c/td\x3e\x3ctd\x3e"+e+"\x3c/td\x3e\x3c/tr\x3e"))}return g+"\x3c/table\x3e"}this.description=f(a)};return a});F("Scene/ImageryProvider","../Core/Check ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/loadCRN ../Core/loadKTX ../Core/Resource".split(" "),function(b,a,f,k,g,l,m){function e(){this.defaultMagnificationFilter=this.defaultMinificationFilter=this.defaultGamma=this.defaultSaturation=this.defaultHue=this.defaultContrast=this.defaultBrightness=this.defaultAlpha=void 0;k.throwInstantiationError()}f(e.prototype,{ready:{get:k.throwInstantiationError},readyPromise:{get:k.throwInstantiationError},rectangle:{get:k.throwInstantiationError},tileWidth:{get:k.throwInstantiationError},tileHeight:{get:k.throwInstantiationError},maximumLevel:{get:k.throwInstantiationError},minimumLevel:{get:k.throwInstantiationError},tilingScheme:{get:k.throwInstantiationError},tileDiscardPolicy:{get:k.throwInstantiationError},errorEvent:{get:k.throwInstantiationError},credit:{get:k.throwInstantiationError},proxy:{get:k.throwInstantiationError},hasAlphaChannel:{get:k.throwInstantiationError}});e.prototype.getTileCredits=k.throwInstantiationError;e.prototype.requestImage=k.throwInstantiationError;e.prototype.pickFeatures=k.throwInstantiationError;var h=/\.ktx$/i,p=/\.crn$/i;e.loadImage=function(d,e){b.defined("url",e);var f=m.createIfNeeded(e);return h.test(f)?l(f):p.test(f)?g(f):a(d.tileDiscardPolicy)?f.fetchImage({preferBlob:!0,preferImageBitmap:!0,flipY:!0}):f.fetchImage({preferImageBitmap:!0,flipY:!0})};return e});F("Scene/ArcGisMapServerImageryProvider","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/GeographicProjection ../Core/GeographicTilingScheme ../Core/Math ../Core/Rectangle ../Core/Resource ../Core/RuntimeError ../Core/TileProviderError ../Core/WebMercatorProjection ../Core/WebMercatorTilingScheme ../ThirdParty/when ./DiscardMissingTileImagePolicy ./ImageryLayerFeatureInfo ./ImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v){function B(f){function m(c){var e=c.tileInfo;if(l(e)){E._tileWidth=e.rows;E._tileHeight=e.cols;if(102100===e.spatialReference.wkid||102113===e.spatialReference.wkid)E._tilingScheme=new A({ellipsoid:f.ellipsoid});else if(4326===c.tileInfo.spatialReference.wkid)E._tilingScheme=new d({ellipsoid:f.ellipsoid});else{B=u.handleError(B,E,E._errorEvent,"Tile spatial reference WKID "+c.tileInfo.spatialReference.wkid+" is not supported.",void 0,void 0,void 0,q);return}E._maximumLevel=c.tileInfo.lods.length-1;if(l(c.fullExtent)){if(l(c.fullExtent.spatialReference)&&l(c.fullExtent.spatialReference.wkid))if(102100===c.fullExtent.spatialReference.wkid||102113===c.fullExtent.spatialReference.wkid){var g=new y,h=c.fullExtent,e=g.unproject(new a(Math.max(h.xmin,-E._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.max(h.ymin,-E._tilingScheme.ellipsoid.maximumRadius*Math.PI),0)),g=g.unproject(new a(Math.min(h.xmax,E._tilingScheme.ellipsoid.maximumRadius*Math.PI),Math.min(h.ymax,E._tilingScheme.ellipsoid.maximumRadius*Math.PI),0));E._rectangle=new t(e.longitude,e.latitude,g.longitude,g.latitude)}else if(4326===c.fullExtent.spatialReference.wkid)E._rectangle=t.fromDegrees(c.fullExtent.xmin,c.fullExtent.ymin,c.fullExtent.xmax,c.fullExtent.ymax);else{B=u.handleError(B,E,E._errorEvent,"fullExtent.spatialReference WKID "+c.fullExtent.spatialReference.wkid+" is not supported.",void 0,void 0,void 0,q);return}}else E._rectangle=E._tilingScheme.rectangle;l(E._tileDiscardPolicy)||(E._tileDiscardPolicy=new x({missingImageUrl:C(E,0,0,E._maximumLevel).url,pixelsToCheck:[new b(0,0),new b(200,20),new b(20,200),new b(80,110),new b(160,130)],disableCheckIfAllPixelsAreTransparent:!0}));E._useTiles=!0}else E._useTiles=!1;l(c.copyrightText)&&0<c.copyrightText.length&&(E._credit=new k(c.copyrightText));E._ready=!0;E._readyPromise.resolve(!0);u.handleSuccess(B)}function p(a){a="An error occurred while accessing "+E._resource.url+".";B=u.handleError(B,E,E._errorEvent,a,void 0,void 0,void 0,q);E._readyPromise.reject(new c(a))}function q(){var a=E._resource.getDerivedResource({queryParameters:{f:"json"}}).fetchJsonp();z(a,m,p)}f=g(f,{});if(!l(f.url))throw new e("options.url is required.");var v=r.createIfNeeded(f.url);v.appendForwardSlash();l(f.token)&&v.setQueryParameters({token:f.token});this._resource=v;this._tileDiscardPolicy=f.tileDiscardPolicy;this._tileWidth=g(f.tileWidth,256);this._tileHeight=g(f.tileHeight,256);this._maximumLevel=f.maximumLevel;this._tilingScheme=g(f.tilingScheme,new d({ellipsoid:f.ellipsoid}));this._useTiles=g(f.usePreCachedTilesIfAvailable,!0);this._rectangle=g(f.rectangle,this._tilingScheme.rectangle);this._layers=f.layers;v=f.credit;"string"===typeof v&&(v=new k(v));this._credit=v;this.enablePickFeatures=g(f.enablePickFeatures,!0);this._errorEvent=new h;this._ready=!1;this._readyPromise=z.defer();var E=this,B;this._useTiles?q():(this._ready=!0,this._readyPromise.resolve(!0))}function C(a,b,c,d,e){a._useTiles?a=a._resource.getDerivedResource({url:"tile/"+d+"/"+c+"/"+b,request:e}):(b=a._tilingScheme.tileXYToNativeRectangle(b,c,d),b={bbox:b.west+","+b.south+","+b.east+","+b.north,size:a._tileWidth+","+a._tileHeight,format:"png",transparent:!0,f:"image"},a._tilingScheme.projection instanceof p?(b.bboxSR=4326,b.imageSR=4326):(b.bboxSR=3857,b.imageSR=3857),a.layers&&(b.layers="show:"+a.layers),a=a._resource.getDerivedResource({url:"export",request:e,queryParameters:b}));return a}m(B.prototype,{url:{get:function(){return this._resource._url}},token:{get:function(){return this._resource.queryParameters.token}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new e("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new e("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new e("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new e("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new e("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new e("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new e("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}});B.prototype.getTileCredits=function(a,b,c){};B.prototype.requestImage=function(a,b,c,d){if(!this._ready)throw new e("requestImage must not be called before the imagery provider is ready.");return v.loadImage(this,C(this,a,b,c,d))};B.prototype.pickFeatures=function(b,c,d,g,h){if(!this._ready)throw new e("pickFeatures must not be called before the imagery provider is ready.");if(this.enablePickFeatures)return b=this._tilingScheme.tileXYToNativeRectangle(b,c,d),this._tilingScheme.projection instanceof p?(g=q.toDegrees(g),h=q.toDegrees(h),c="4326"):(h=this._tilingScheme.projection.project(new f(g,h,0)),g=h.x,h=h.y,c="3857"),d="visible",l(this._layers)&&(d+=":"+this._layers),this._resource.getDerivedResource({url:"identify",queryParameters:{f:"json",tolerance:2,geometryType:"esriGeometryPoint",geometry:g+","+h,mapExtent:b.west+","+b.south+","+b.east+","+b.north,imageDisplay:this._tileWidth+","+this._tileHeight+",96",sr:c,layers:d}}).fetchJson().then(function(b){var c=[];b=b.results;if(!l(b))return c;for(var d=0;d<b.length;++d){var e=b[d],g=new D;g.data=e;g.name=e.value;g.properties=e.attributes;g.configureDescriptionFromProperties(e.attributes);if("esriGeometryPoint"===e.geometryType&&e.geometry){var h=e.geometry.spatialReference&&e.geometry.spatialReference.wkid?e.geometry.spatialReference.wkid:4326;if(4326===h||4283===h)g.position=f.fromDegrees(e.geometry.x,e.geometry.y,e.geometry.z);else if(102100===h||900913===h||3857===h)h=new y,g.position=h.unproject(new a(e.geometry.x,e.geometry.y,e.geometry.z))}c.push(g)}return c})};return B});F("Scene/AutoExposure","../Core/Cartesian2 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/PixelFormat ../Renderer/ClearCommand ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(){this._depthTexture=this._colorTexture=this._command=this._uniformMap=void 0;this._ready=!1;this._name="czm_autoexposure";this._clearCommand=this._commands=this._previousLuminance=this._framebuffers=this._useLogDepth=this._logDepthChanged=void 0;this._minMaxLuminance=new b;this._enabled=this.enabled=!0;this.minimumLuminance=.1;this.maximumLuminance=10}function y(a){var b=a._framebuffers;if(k(b)){for(var c=b.length,d=0;d<c;++d)b[d].destroy();a._framebuffers=void 0;a._previousLuminance.destroy();a._previousLuminance=void 0}}function A(a){var b=a._commands;if(k(b)){for(var c=b.length,d=0;d<c;++d)b[d].shaderProgram.destroy();a._commands=void 0}}function z(a,b){var c;if(0===b)c={colorTexture:function(){return a._colorTexture},colorTextureDimensions:function(){return a._colorTexture.dimensions}};else{var d=a._framebuffers[b-1].getColorTexture(0);c={colorTexture:function(){return d},colorTextureDimensions:function(){return d.dimensions}}}c.minMaxLuminance=function(){return a._minMaxLuminance};c.previousLuminance=function(){return a._previousLuminance.getColorTexture(0)};return c}function x(a,b){var c="uniform sampler2D colorTexture; \nvarying vec2 v_textureCoordinates; \nfloat sampleTexture(vec2 offset) { \n",c=(0===a?c+"    vec4 color \x3d texture2D(colorTexture, v_textureCoordinates + offset); \n    return czm_luminance(color.rgb); \n":c+"    return texture2D(colorTexture, v_textureCoordinates + offset).r; \n")+"}\n\nuniform vec2 colorTextureDimensions; \nuniform vec2 minMaxLuminance; \nuniform sampler2D previousLuminance; \nvoid main() { \n    float color \x3d 0.0; \n    float xStep \x3d 1.0 / colorTextureDimensions.x; \n    float yStep \x3d 1.0 / colorTextureDimensions.y; \n    int count \x3d 0; \n    for (int i \x3d 0; i \x3c 3; ++i) { \n        for (int j \x3d 0; j \x3c 3; ++j) { \n            vec2 offset; \n            offset.x \x3d -xStep + float(i) * xStep; \n            offset.y \x3d -yStep + float(j) * yStep; \n            if (offset.x \x3c 0.0 || offset.x \x3e 1.0 || offset.y \x3c 0.0 || offset.y \x3e 1.0) { \n                continue; \n            } \n            color +\x3d sampleTexture(offset); \n            ++count; \n        } \n    } \n    if (count \x3e 0) { \n        color /\x3d float(count); \n    } \n";a===b-1&&(c+="    float previous \x3d texture2D(previousLuminance, vec2(0.5)).r; \n    color \x3d clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n    color \x3d previous + (color - previous) / (60.0 * 1.5); \n    color \x3d clamp(color, minMaxLuminance.x, minMaxLuminance.y); \n");return c+"    gl_FragColor \x3d vec4(color); \n} \n"}g(u.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},outputTexture:{get:function(){var a=this._framebuffers;if(k(a))return a[a.length-1].getColorTexture(0)}}});u.prototype.clear=function(b){var c=this._framebuffers;if(k(c)){var d=this._clearCommand;k(d)||(d=this._clearCommand=new e({color:new a(0,0,0,0),framebuffer:void 0}));for(var f=c.length,g=0;g<f;++g)d.framebuffer=c[g],d.execute(b)}};u.prototype.update=function(a){var b=a.drawingBufferWidth,e=a.drawingBufferHeight;if(b!==this._width||e!==this._height){this._width=b;this._height=e;y(this);for(var f=this._width,g=this._height,b=m.RGBA,e=a.halfFloatingPointTexture?p.HALF_FLOAT:p.FLOAT,k=new d({wrapS:c.CLAMP_TO_EDGE,wrapT:c.CLAMP_TO_EDGE,minificationFilter:r.NEAREST,magnificationFilter:t.NEAREST}),l=Math.ceil(Math.log(Math.max(f,g))/Math.log(3)),w=Array(l),u=0;u<l;++u)f=Math.max(Math.ceil(f/3),1),g=Math.max(Math.ceil(g/3),1),w[u]=new h({context:a,colorTextures:[new q({context:a,width:f,height:g,pixelFormat:b,pixelDatatype:e,sampler:k})]});f=w[l-1].getColorTexture(0);this._previousLuminance=new h({context:a,colorTextures:[new q({context:a,width:f.width,height:f.height,pixelFormat:b,pixelDatatype:e,sampler:k})]});this._framebuffers=w;A(this);b=this._framebuffers;e=b.length;k=Array(e);for(w=0;w<e;++w)k[w]=a.createViewportQuadCommand(x(w,e),{framebuffer:b[w],uniformMap:z(this,w)});this._commands=k;this._ready||(this._ready=!0)}this._minMaxLuminance.x=this.minimumLuminance;this._minMaxLuminance.y=this.maximumLuminance;a=this._framebuffers;b=a[a.length-1];a[a.length-1]=this._previousLuminance;this._commands[this._commands.length-1].framebuffer=this._previousLuminance;this._previousLuminance=b};u.prototype.execute=function(a,b){this._colorTexture=b;var c=this._commands;if(k(c))for(var d=c.length,e=0;e<d;++e)c[e].execute(a)};u.prototype.isDestroyed=function(){return!1};u.prototype.destroy=function(){y(this);A(this);return l(this)};return u});F("Scene/Cesium3DTileColorBlendMode",["../Core/freezeObject"],function(b){return b({HIGHLIGHT:0,REPLACE:1,MIX:2})});F("Scene/getBinaryAccessor","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/ComponentDatatype ../Core/Matrix2 ../Core/Matrix3 ../Core/Matrix4".split(" "),function(b,a,f,k,g,l,m){var e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},h={SCALAR:void 0,VEC2:b,VEC3:a,VEC4:f,MAT2:g,MAT3:l,MAT4:m};return function(a){var b=a.componentType,f;f="string"===typeof b?k.fromName(b):b;var g=e[a.type];return{componentsPerAttribute:g,classType:h[a.type],createArrayBufferView:function(a,b,d){return k.createArrayBufferView(f,a,b,g*d)}}}});F("Scene/Cesium3DTileBatchTable","../Core/arrayFill ../Core/Cartesian2 ../Core/Cartesian4 ../Core/Check ../Core/clone ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/DeveloperError ../Core/Math ../Core/PixelFormat ../Core/RuntimeError ../Core/getTimestamp ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/Sampler ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ./AttributeType ./BlendingState ./Cesium3DTileColorBlendMode ./CullFace ./getBinaryAccessor ./StencilConstants ./StencilFunction ./StencilOperation".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,F){function aa(c,d,k,l,q){this.featuresLength=d;this._translucentFeaturesLength=0;var r;p(k)&&(r=k.extensions);this._extensions=h(r,{});r={};if(p(k))for(var t in k)k.hasOwnProperty(t)&&"HIERARCHY"!==t&&"extensions"!==t&&"extras"!==t&&(r[t]=g(k[t],!0));this._properties=r;var w;if(p(k)){var u=this._extensions["3DTILES_batch_table_hierarchy"];k=k.HIERARCHY;p(k)&&(aa._deprecationWarning("batchTableHierarchyExtension","The batch table HIERARCHY property has been moved to an extension. Use extensions.3DTILES_batch_table_hierarchy instead."),u=this._extensions["3DTILES_batch_table_hierarchy"]=k);if(p(u)){var v,y;k=u.instancesLength;t=u.classes;var E=u.classIds,A=u.parentCounts,u=u.parentIds;y=k;p(E.byteOffset)&&(E.componentType=h(E.componentType,e.UNSIGNED_SHORT),E.type=G.SCALAR,v=P(E),E=v.createArrayBufferView(l.buffer,l.byteOffset+E.byteOffset,k));if(p(A))for(p(A.byteOffset)&&(A.componentType=h(A.componentType,e.UNSIGNED_SHORT),A.type=G.SCALAR,v=P(A),A=v.createArrayBufferView(l.buffer,l.byteOffset+A.byteOffset,k)),w=new Uint16Array(k),v=y=0;v<k;++v)w[v]=y,y+=A[v];p(u)&&p(u.byteOffset)&&(u.componentType=h(u.componentType,e.UNSIGNED_SHORT),u.type=G.SCALAR,v=P(u),u=v.createArrayBufferView(l.buffer,l.byteOffset+u.byteOffset,y));y=t.length;for(v=0;v<y;++v){var C=t[v].instances,B=Z(t[v].length,C,l);t[v].instances=m(B,C)}C=b(Array(y),0);B=new Uint16Array(k);for(v=0;v<k;++v)y=E[v],B[v]=C[y],++C[y];w={classes:t,classIds:E,classIndexes:B,parentCounts:A,parentIndexes:w,parentIds:u};k=qa;k.length=0;t=w.classIds.length;for(E=0;E<t;++E)U(w,E,k)}else w=void 0}else w=void 0;this._batchTableHierarchy=w;this._batchTableBinaryProperties=Z(d,r,l);this._batchValues=this._showAlphaProperties=void 0;this._batchValuesDirty=!1;this._lastTime=this._maxIndex=this._maxValue=this._curBatchHeightValues=this._batchDynamicHeightValues=this._batchDynamicHeightTexture=this._batchHeightValues=this._batchHeightTexture=this._defaultTexture=this._batchTexture=void 0;this._effectType=0;this._initAnimation=!0;this._time=2E3;this._pickTexture=this._dataType=void 0;this._pickIds=[];this._content=c;this._colorChangedCallback=q;var D,x;0<d&&(D=Math.min(d,z.maximumTextureSize),x=Math.ceil(d/z.maximumTextureSize),d=1/D,c=.5*d,l=1/x,q=.5*l,D=new a(D,x),x=new f(d,c,l,q));this._textureDimensions=D;this._textureStep=x}function U(a,b,c){var d=a.parentCounts,e=a.parentIds,f=a.parentIndexes,g=a.classIds.length;if(p(e)){if(b>=g)throw new r("Parent index "+b+" exceeds the total number of instances: "+g);if(-1<c.indexOf(b))throw new r("Circular dependency detected in the batch table hierarchy.");c.push(b);g=p(d)?d[b]:1;d=p(d)?f[b]:b;for(f=0;f<g;++f){var h=e[d+f];h!==b&&U(a,h,c)}c.pop(b)}}function Z(a,b,c){var d,e;for(e in b)if(b.hasOwnProperty(e)){var f=b[e],g=f.byteOffset;if(p(g)){var h=f.type;if(!p(f.componentType))throw new y("componentType is required.");if(!p(h))throw new y("type is required.");if(!p(c))throw new y("Property "+e+" requires a batch table binary.");var k=P(f),f=k.componentsPerAttribute,h=k.classType,g=k.createArrayBufferView(c.buffer,c.byteOffset+g,a);p(d)||(d={});d[e]={typedArray:g,componentCount:f,type:h}}}return d}function M(a){a=a._textureDimensions;return a.x*a.y*4}function R(a){if(!p(a._batchValues)){var c=M(a),c=new Uint8Array(c);b(c,255);a._batchValues=c}return a._batchValues}function Y(a){if(!p(a._batchHeightValues)){var c=M(a),c=new Uint8Array(c);b(c,255);a._batchHeightValues=c}return a._batchHeightValues}function Q(a){if(!p(a._batchDynamicHeightValues)){var c=M(a),c=new Uint8Array(c);b(c,0);a._batchDynamicHeightValues=c}return a._batchDynamicHeightValues}function S(a){if(!p(a._showAlphaProperties)){var c=new Uint8Array(2*a.featuresLength);b(c,255);a._showAlphaProperties=c}return a._showAlphaProperties}function ca(a,b){if(!p(a)||0>a||a>b)throw new r("batchId is required and between zero and featuresLength - 1 ("+b-NaN);}function T(a,b){var c=a.typedArray,d=a.componentCount;return 1===d?c[b]:a.type.unpack(c,b*d)}function da(a,b,c){var d=a.typedArray,e=a.componentCount;1===e?d[b]=c:a.type.pack(c,d,b*e)}function V(a,b,c){var d=a.parentCounts;if(!p(a.parentIds))return c(a,b);if(p(d)){a:{var d=a.parentCounts,e=a.parentIds,f=a.parentIndexes,g=wa;g.length=Math.max(g.length,a.classIds.length);var h=++Da,k=za;k.length=0;for(k.push(b);0<k.length;)if(b=k.pop(),g[b]!==h){g[b]=h;var l=c(a,b);if(p(l)){a=l;break a}for(var l=d[b],m=f[b],q=0;q<l;++q){var r=e[m+q];r!==b&&k.push(r)}}a=void 0}return a}a:{d=b;for(e=!0;e;){e=c(a,d);if(p(e)){a=e;break a}f=a.parentIds[d];e=f!==d;d=f}a=void 0}return a}function ba(a,b,c){a=V(a._batchTableHierarchy,b,function(a,b){if(p(a.classes[a.classIds[b]].instances[c]))return!0});return p(a)}function X(a,b,c){V(a._batchTableHierarchy,b,function(a,b){var d=a.classes[a.classIds[b]].instances,e;for(e in d)d.hasOwnProperty(e)&&-1===c.indexOf(e)&&c.push(e)})}function fa(a,b,c){return V(a._batchTableHierarchy,b,function(a,b){var d=a.classIndexes[b],e=a.classes[a.classIds[b]].instances[c];if(p(e))return p(e.typedArray)?T(e,d):g(e[d],!0)})}function ga(a,b,c,d){a=V(a._batchTableHierarchy,b,function(a,e){var f=a.classIndexes[e],h=a.classes[a.classIds[e]].instances[c];if(p(h)){if(e!==b)throw new r('Inherited property "'+c+'" is read-only.');p(h.typedArray)?da(h,f,d):h[f]=g(d,!0);return!0}});return p(a)}function ka(a,b){a=I.replaceMain(a,"tile_main");return b?a+"uniform float tile_colorBlend; \nvoid tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n    tile_featureColor \x3d czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *\x3d tile_featureColor.a; \n    float highlight \x3d ceil(tile_colorBlend); \n    gl_FragColor.rgb *\x3d mix(tile_featureColor.rgb, vec3(1.0), highlight); \n} \n":a+"void tile_color(vec4 tile_featureColor) \n{ \n    tile_main(); \n} \n"}function na(a,b,c){if(!p(b))return ka(a,c);var d=new RegExp("(uniform|attribute|in)\\s+(vec[34]|sampler2D)\\s+"+b+";"),d=a.match(d);if(!p(d))return ka(a,c);var e=d[0],f=d[2];a=I.replaceMain(a,"tile_main");a=a.replace(e,"");var g;if("vec3"===f||"vec4"===f){var h="vec3"===f?"vec4("+b+", 1.0)":b,d=new RegExp(b,"g");a=a.replace(d,"vec3"===f?"tile_diffuse.xyz":"tile_diffuse");g="    vec4 source \x3d "+h+"; \n    tile_diffuse \x3d tile_diffuse_final(source, tile_featureColor); \n    tile_main(); \n"}else if("sampler2D"===f){b="texture2D("+b;for(d=a.indexOf(b,0);-1<d;){f=0;for(g=d;g<a.length;++g){var k=a.charAt(g);if("("===k)++f;else if(")"===k&&(--f,0===f)){h=g+1;break}}f="tile_diffuse_final("+a.slice(d,h)+", tile_diffuse)";a=a.slice(0,d)+f+a.slice(h);d+=f.length;d=a.indexOf(b,d)}g="    tile_diffuse \x3d tile_featureColor; \n    tile_main(); \n"}a="uniform float tile_colorBlend; \nvec4 tile_diffuse \x3d vec4(1.0); \nbool isWhite(vec3 color) \n{ \n    return all(greaterThan(color, vec3(1.0 - czm_epsilon3))); \n} \nvec4 tile_diffuse_final(vec4 sourceDiffuse, vec4 tileDiffuse) \n{ \n    vec4 blendDiffuse \x3d mix(sourceDiffuse, tileDiffuse, tile_colorBlend); \n    vec4 diffuse \x3d isWhite(tileDiffuse.rgb) ? sourceDiffuse : blendDiffuse; \n    return vec4(diffuse.rgb, sourceDiffuse.a); \n} \n"+e+"\n"+a+"\nvoid tile_color(vec4 tile_featureColor) \n{ \n"+g;c&&(a+="    tile_featureColor \x3d czm_gammaCorrect(tile_featureColor); \n    gl_FragColor.a *\x3d tile_featureColor.a; \n    float highlight \x3d ceil(tile_colorBlend); \n    gl_FragColor.rgb *\x3d mix(tile_featureColor.rgb, vec3(1.0), highlight); \n");return a+"} \n"}function ia(a){a=x.shallowClone(a);var b=a.pass===D.TRANSLUCENT;a.uniformMap=p(a.uniformMap)?a.uniformMap:{};a.uniformMap.tile_translucentCommand=function(){return b};return a}function la(a,b,c){a=a._textureDimensions;return new H({context:b,pixelFormat:u.RGBA,pixelDatatype:v.UNSIGNED_BYTE,source:{width:a.x,height:a.y,arrayBufferView:c},flipY:!1,sampler:new C({minificationFilter:w.NEAREST,magnificationFilter:J.NEAREST})})}function ha(a){var b=a._textureDimensions;a._batchHeightTexture.copyFrom({width:b.x,height:b.y,arrayBufferView:a._batchHeightValues})}function pa(a){a*=100;var b=Math.floor(a/256),c=Math.floor((a-256*b)/256),d=Math.floor((a-256*b-65536*c)/256);return[b,c,d,Math.floor(a-256*b-65536*c-16777216*d)]}var oa=l.WHITE;aa._deprecationWarning=q;d(aa.prototype,{memorySizeInBytes:{get:function(){var a=0;p(this._pickTexture)&&(a+=this._pickTexture.sizeInBytes);p(this._batchTexture)&&(a+=this._batchTexture.sizeInBytes);return a}}});var qa=[];aa.getBinaryProperties=function(a,b,c){return Z(a,b,c)};aa.prototype.setShow=function(a,b){ca(a,this.featuresLength);k.typeOf.bool("show",b);if(!b||p(this._showAlphaProperties)){var c=S(this),d=2*a,e=b?255:0;c[d]!==e&&(c[d]=e,R(this)[4*a+3]=b?c[d+1]:0,this._batchValuesDirty=!0)}};aa.prototype.setAllShow=function(a){k.typeOf.bool("show",a);for(var b=this.featuresLength,c=0;c<b;++c)this.setShow(c,a)};aa.prototype.getShow=function(a){ca(a,this.featuresLength);return p(this._showAlphaProperties)?255===this._showAlphaProperties[2*a]:!0};var ua=Array(4);aa.prototype.setColor=function(a,b){ca(a,this.featuresLength);k.typeOf.object("color",b);if(!l.equals(b,oa)||p(this._batchValues)){var c=b.toBytes(ua),d=c[3],e=R(this),f=4*a,g=S(this),h=2*a;if(e[f]!==c[0]||e[f+1]!==c[1]||e[f+2]!==c[2]||g[h+1]!==d)e[f]=c[0],e[f+1]=c[1],e[f+2]=c[2],c=255!==g[h+1],e[f+3]=0!==g[h]?d:0,g[h+1]=d,(d=255!==d)&&!c?++this._translucentFeaturesLength:!d&&c&&--this._translucentFeaturesLength,this._batchValuesDirty=!0,p(this._colorChangedCallback)&&this._colorChangedCallback(a,b)}};aa.prototype.setAllColor=function(a){k.typeOf.object("color",a);for(var b=this.featuresLength,c=0;c<b;++c)this.setColor(c,a)};aa.prototype.getColor=function(a,b){ca(a,this.featuresLength);k.typeOf.object("result",b);if(!p(this._batchValues))return l.clone(oa,b);var c=this._batchValues,d=4*a;return l.fromBytes(c[d],c[d+1],c[d+2],this._showAlphaProperties[2*a+1],b)};aa.prototype.getPickColor=function(a){ca(a,this.featuresLength);return this._pickIds[a]};var ta=new l;aa.prototype.applyStyle=function(a){if(p(a))for(var b=this._content,c=this.featuresLength,d=0;d<c;++d){var e=b.getFeature(d),f=p(a.color)?a.color.evaluateColor(e,ta):oa,e=p(a.show)?a.show.evaluate(e):!0;this.setColor(d,f);this.setShow(d,e)}else this.setAllColor(oa),this.setAllShow(!0)};var wa=[],za=[],Da=0;aa.prototype.isClass=function(a,b){ca(a,this.featuresLength);k.typeOf.string("className",b);var c=this._batchTableHierarchy;if(!p(c))return!1;c=V(c,a,function(a,c){if(a.classes[a.classIds[c]].name===b)return!0});return p(c)};aa.prototype.isExactClass=function(a,b){k.typeOf.string("className",b);return this.getExactClassName(a)===b};aa.prototype.getExactClassName=function(a){ca(a,this.featuresLength);var b=this._batchTableHierarchy;if(p(b))return b.classes[b.classIds[a]].name};aa.prototype.hasProperty=function(a,b){ca(a,this.featuresLength);k.typeOf.string("name",b);return p(this._properties[b])||p(this._batchTableHierarchy)&&ba(this,a,b)};aa.prototype.getPropertyNames=function(a,b){ca(a,this.featuresLength);b=p(b)?b:[];b.length=0;var c=Object.keys(this._properties);b.push.apply(b,c);p(this._batchTableHierarchy)&&X(this,a,b);return b};aa.prototype.getProperty=function(a,b){ca(a,this.featuresLength);k.typeOf.string("name",b);if(p(this._batchTableBinaryProperties)){var c=this._batchTableBinaryProperties[b];if(p(c))return T(c,a)}c=this._properties[b];if(p(c))return g(c[a],!0);if(p(this._batchTableHierarchy)&&(c=fa(this,a,b),p(c)))return c};aa.prototype.setProperty=function(a,b,c){var d=this.featuresLength;ca(a,d);k.typeOf.string("name",b);if(p(this._batchTableBinaryProperties)){var e=this._batchTableBinaryProperties[b];if(p(e)){da(e,a,c);return}}p(this._batchTableHierarchy)&&ga(this,a,b,c)||(e=this._properties[b],p(e)||(this._properties[b]=Array(d),e=this._properties[b]),e[a]=g(c,!0))};aa.prototype.getVertexShaderCallback=function(a,b,c){if(0!==this.featuresLength){var d=this;return function(e){e=na(e,c,!1);var f;0<z.maximumVertexTextureImageUnits?(f="",a&&(f+="uniform bool tile_translucentCommand; \n"),f+="uniform sampler2D tile_batchTexture; \nvarying vec4 tile_featureColor; \nvarying vec2 tile_featureSt; \n","tilt"!==d._dataType&&"model"===d._dataType&&(f+="varying vec3 localPosition; \nvarying vec4 localPositionEC; \n"),f+="void main() \n{ \n","tilt"!==d._dataType&&"model"===d._dataType&&(f+="      vec4 posEC \x3d u_modelViewMatrix * vec4(a_position,1.0); \n      localPosition \x3d a_position.xyz; \n      localPositionEC \x3d posEC; \n"),f+="    vec2 st \x3d computeSt("+b+"); \n    vec4 featureProperties \x3d texture2D(tile_batchTexture, st); \n    tile_color(featureProperties); \n    float show \x3d ceil(featureProperties.a); \n    gl_Position *\x3d show; \n",a&&(f+="    bool isStyleTranslucent \x3d (featureProperties.a !\x3d 1.0); \n    if (czm_pass \x3d\x3d czm_passTranslucent) \n    { \n        if (!isStyleTranslucent \x26\x26 !tile_translucentCommand) \n        { \n            gl_Position *\x3d 0.0; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            gl_Position *\x3d 0.0; \n        } \n    } \n"),f+="    tile_featureColor \x3d featureProperties; \n    tile_featureSt \x3d st; \n}"):f="varying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_color(vec4(1.0)); \n    tile_featureSt \x3d computeSt("+b+"); \n}";var g;g=1===d._textureDimensions.y?"uniform vec4 tile_textureStep; \nvec2 computeSt(float batchId) \n{ \n    float stepX \x3d tile_textureStep.x; \n    float centerX \x3d tile_textureStep.y; \n    return vec2(centerX + (batchId * stepX), 0.5); \n} \n":"uniform vec4 tile_textureStep; \nuniform vec2 tile_textureDimensions; \nvec2 computeSt(float batchId) \n{ \n    float stepX \x3d tile_textureStep.x; \n    float centerX \x3d tile_textureStep.y; \n    float stepY \x3d tile_textureStep.z; \n    float centerY \x3d tile_textureStep.w; \n    float xId \x3d mod(batchId, tile_textureDimensions.x); \n    float yId \x3d floor(batchId / tile_textureDimensions.x); \n    return vec2(centerX + (xId * stepX), centerY + (yId * stepY)); \n} \n";return e+"\n"+g+f}}};aa.prototype.getFragmentShaderCallback=function(a,b){if(0!==this.featuresLength){var c=this;return function(d){d=na(d,b,!0);0<z.maximumVertexTextureImageUnits?(d+="uniform sampler2D tile_pickTexture; \n","tilt"!==c._dataType&&"model"===c._dataType&&(d+="uniform sampler2D tile_batchHeightTexture; \nuniform bool tile_animation; \nuniform int tile_effectType; \nvarying vec3 localPosition; \nvarying vec4 localPositionEC; \n"),d+="varying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_color(tile_featureColor); \n","tilt"!==c._dataType&&"model"===c._dataType&&(d+="    if( tile_effectType \x3d\x3d 1){ \n   \tvec4 featureHeight \x3d texture2D(tile_batchHeightTexture, tile_featureSt); \n   \tvec4 vecHeight \x3d featureHeight*256.0;\n   \tfloat height \x3d (vecHeight.x*256.0 + vecHeight.y*256.0*265.0 + vecHeight.z*256.0*256.0*256.0 + vecHeight.w)/100.0;\n   \tvec3 llh \x3d localPosition.xyz; \n   \tfloat alpha \x3d gl_FragColor.a; \n   \tif( height \x3c czm_epsilon1){ \n\t\t\theight \x3d 1.0; \n\t\t} \n       if(tile_animation){\n        \tif( llh.z \x3c height ){\n           gl_FragColor.a \x3d pow(0.005,abs(1.0 - clamp(llh.z/height,0.0,1.0)))*alpha;\n\t     \t}else{\n\t\t     \tgl_FragColor.a \x3d 0.0;\n        \t}\n   \t\tif( abs(llh.z - height) \x3c\x3d 0.3 ){ \n\t\t\t\tgl_FragColor.a *\x3d 0.0; \n\t\t\t} \n\t \t}else{\n           gl_FragColor.a \x3d pow(0.005,abs(1.0 - clamp(llh.z/height,0.0,1.0)))*alpha;\n\t \t}\n   } \n"),d+="}"):(a&&(d+="uniform bool tile_translucentCommand; \n"),d+="uniform sampler2D tile_pickTexture; \nuniform sampler2D tile_batchTexture; \nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    vec4 featureProperties \x3d texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a \x3d\x3d 0.0) { \n        discard; \n    } \n",a&&(d+="    bool isStyleTranslucent \x3d (featureProperties.a !\x3d 1.0); \n    if (czm_pass \x3d\x3d czm_passTranslucent) \n    { \n        if (!isStyleTranslucent \x26\x26 !tile_translucentCommand) \n        { \n            discard; \n        } \n    } \n    else \n    { \n        if (isStyleTranslucent) \n        { \n            discard; \n        } \n    } \n"),d+="    tile_color(featureProperties); \n} \n");return d}}};aa.prototype.getClassificationFragmentShaderCallback=function(){if(0!==this.featuresLength)return function(a){a=I.replaceMain(a,"tile_main");return a=0<z.maximumVertexTextureImageUnits?a+"uniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvarying vec4 tile_featureColor; \nvoid main() \n{ \n    tile_main(); \n    gl_FragColor \x3d tile_featureColor; \n}":a+"uniform sampler2D tile_batchTexture; \nuniform sampler2D tile_pickTexture;\nvarying vec2 tile_featureSt; \nvoid main() \n{ \n    tile_main(); \n    vec4 featureProperties \x3d texture2D(tile_batchTexture, tile_featureSt); \n    if (featureProperties.a \x3d\x3d 0.0) { \n        discard; \n    } \n    gl_FragColor \x3d featureProperties; \n} \n"}};aa.prototype.getUniformMapCallback=function(){if(0!==this.featuresLength){var a=this;return function(b){return m(b,{tile_batchTexture:function(){return h(a._batchTexture,a._defaultTexture)},tile_textureDimensions:function(){return a._textureDimensions},tile_textureStep:function(){return a._textureStep},tile_colorBlend:function(){var b;var d=a._content.tileset;b=d.colorBlendMode;d=d.colorBlendAmount;if(b===L.HIGHLIGHT)b=0;else if(b===L.REPLACE)b=1;else if(b===L.MIX)b=c.clamp(d,c.EPSILON4,1);else throw new r('Invalid color blend mode "'+b+'".');return b},tile_batchHeightTexture:function(){return h(a._batchHeightTexture,a._defaultTexture)},tile_animation:function(){return a._initAnimation},tile_effectType:function(){return a._effectType},tile_pickTexture:function(){return a._pickTexture}})}}};aa.prototype.getPickId=function(){return"texture2D(tile_pickTexture, tile_featureSt)"};aa.prototype.addDerivedCommands=function(a,b){var c=a.commandList,d=c.length,e=this._content._tile,f=e._finalResolution,h=e.tileset,k=h._skipLevelOfDetail&&h._hasMixedContent&&a.context.stencilBuffer,l;l=this._translucentFeaturesLength;l=0===l?0:l===this.featuresLength?1:2;for(var m=b;m<d;++m){var q=c[m],r=q.derivedCommands.tileset;if(!p(r)||q.dirty)r={},q.derivedCommands.tileset=r,r.originalCommand=ia(q),q.dirty=!1;var t=r.originalCommand;if(0!==l&&q.pass!==D.TRANSLUCENT&&!p(r.translucent)){var w=r,u=t,v=x.shallowClone(u);v.pass=D.TRANSLUCENT;u=g(u.renderState,!0);u.cull.enabled=!1;u.depthTest.enabled=!0;u.depthMask=!1;u.blending=E.ALPHA_BLEND;u=B.fromCache(u);v.renderState=u;w.translucent=v}if(1!==l&&q.pass!==D.TRANSLUCENT&&(p(r.opaque)||(w=r,u=t,v=x.shallowClone(u),u=g(u.renderState,!0),u.stencilTest=N.setCesium3DTileBit(),u.stencilMask=N.CESIUM_3D_TILE_MASK,u=B.fromCache(u),v.renderState=u,w.opaque=v),k)){if(!f){if(!p(r.zback)){var w=r,u=a.context,y=t,v=x.shallowClone(y),z=g(v.renderState,!0);z.cull.enabled=!0;z.cull.face=K.FRONT;z.colorMask={red:!1,green:!1,blue:!1,alpha:!1};z.polygonOffset={enabled:!0,factor:5,units:5};z.stencilTest=N.setCesium3DTileBit();z.stencilMask=N.CESIUM_3D_TILE_MASK;v.renderState=B.fromCache(z);v.castShadows=!1;v.receiveShadows=!1;y=y.shaderProgram;z=u.shaderCache.getDerivedShaderProgram(y,"zBackfaceLogDepth");p(z)||(z=y.fragmentShaderSource.clone(),z.defines=p(z.defines)?z.defines.slice(0):[],z.defines.push("DISABLE_LOG_DEPTH_FRAGMENT_WRITE"),z=u.shaderCache.createDerivedShaderProgram(y,"zBackfaceLogDepth",{vertexShaderSource:y.vertexShaderSource,fragmentShaderSource:z,attributeLocations:y._attributeLocations}));v.shaderProgram=z;w.zback=v}h._backfaceCommands.push(r.zback)}(w=!p(r.stencil))||(w=e._selectionDepth!==(r.stencil.renderState.stencilTest.reference&N.SKIP_LOD_MASK)>>>N.SKIP_LOD_BIT_SHIFT);w&&(q.renderState.depthMask?(w=r,v=e._selectionDepth,u=x.shallowClone(t),y=g(u.renderState,!0),y.stencilTest.enabled=!0,y.stencilTest.mask=N.SKIP_LOD_MASK,y.stencilTest.reference=N.CESIUM_3D_TILE_MASK|v<<N.SKIP_LOD_BIT_SHIFT,y.stencilTest.frontFunction=O.GREATER_OR_EQUAL,y.stencilTest.frontOperation.zPass=F.REPLACE,y.stencilTest.backFunction=O.GREATER_OR_EQUAL,y.stencilTest.backOperation.zPass=F.REPLACE,y.stencilMask=N.CESIUM_3D_TILE_MASK|N.SKIP_LOD_MASK,u.renderState=B.fromCache(y),w.stencil=u):r.stencil=r.opaque)}w=k?r.stencil:r.opaque;r=r.translucent;q.pass!==D.TRANSLUCENT?(0===l&&(c[m]=w),1===l&&(c[m]=r),2===l&&(c[m]=w,c.push(r))):c[m]=t}};aa.prototype.update=function(a,b){var c=b.context;this._defaultTexture=c.defaultTexture;var d=b.passes;if(d.pick||d.postProcess)if(d=this.featuresLength,!p(this._pickTexture)&&0<d){for(var e=this._pickIds,f=M(this),f=new Uint8Array(f),g=this._content,h=0;h<d;++h){var k=c.createPickId(g.getFeature(h));e.push(k);var k=k.color,m=4*h;f[m]=l.floatToByte(k.red);f[m+1]=l.floatToByte(k.green);f[m+2]=l.floatToByte(k.blue);f[m+3]=l.floatToByte(k.alpha)}this._pickTexture=la(this,c,f);g.tileset._statistics.batchTableByteLength+=this._pickTexture.sizeInBytes}if(this._batchValuesDirty){this._batchValuesDirty=!1;p(this._batchTexture)||(this._batchTexture=la(this,c,this._batchValues),a._statistics.batchTableByteLength+=this._batchTexture.sizeInBytes);d=this._textureDimensions;this._batchTexture.copyFrom({width:d.x,height:d.y,arrayBufferView:this._batchValues});p(this._curBatchHeightValues)||(this._curBatchHeightValues=Array(this.featuresLength));if(this._properties.height&&!p(this._batchHeightValues))if(this._initAnimation)this._batchHeightValues=Q(this),this._curBatchHeightValues.fill(0);else for(d=this._properties.height,this._curBatchHeightValues=d.slice(0),e=Y(this),f=this.featuresLength,g=0;g<f;++g)h=pa(d[g]),k=4*g,e[k]=h[0],e[k+1]=h[1],e[k+2]=h[2],e[k+3]=h[3];else if(this._properties.floor&&!p(this._batchHeightValues))if(this._initAnimation)this._batchHeightValues=Q(this),this._curBatchHeightValues.fill(0);else for(d=this._batchTableBinaryProperties.floor,d=d.typedArray,this._curBatchHeightValues=d.slice(0),e=Y(this),f=this.featuresLength,g=0;g<f;++g)h=pa(3*d[g]),this._curBatchHeightValues[g]=3*d[g],k=4*g,e[k]=h[0],e[k+1]=h[1],e[k+2]=h[2],e[k+3]=h[3];p(this._batchHeightTexture)||(d=this._textureDimensions,this._batchHeightTexture=new H({context:c,pixelFormat:u.RGBA,pixelDatatype:v.UNSIGNED_BYTE,source:{width:d.x,height:d.y,arrayBufferView:this._batchHeightValues},flipY:!1,sampler:new C({minificationFilter:w.NEAREST,magnificationFilter:J.NEAREST})}));ha(this)}if(this._initAnimation&&this._batchHeightValues){p(this._lastTime)||(this._lastTime=A());c=(A()-this._lastTime)/1;this._lastTime=A();d=void 0;this._properties.height?d=this._properties.height:this._properties.floor&&(d=this._batchTableBinaryProperties.floor,d=d.typedArray);if(!p(this._maxValue)){e=d[0];for(g=f=0;g<this.featuresLength;++g)d[g]>e&&(e=d[g],f=g);this._maxValue=e;this._maxIndex=f}f=this.featuresLength;e=this._batchHeightValues;m=this._maxValue;for(g=0;g<f;++g){h=d[g];this._properties.floor&&(h*=3,m=3*this._maxValue);0==h&&(h=1);this._curBatchHeightValues[g]+=h/this._time*c;this._curBatchHeightValues[g]=Math.min(this._curBatchHeightValues[g],h);var q=this._curBatchHeightValues[g],h=pa(q),k=4*g;e[k]=h[0];e[k+1]=h[1];e[k+2]=h[2];e[k+3]=h[3];g==this._maxIndex&&q==m&&(this._initAnimation=!1)}ha(this)}};aa.prototype.isDestroyed=function(){return!1};aa.prototype.destroy=function(){this._batchTexture=this._batchTexture&&this._batchTexture.destroy();this._pickTexture=this._pickTexture&&this._pickTexture.destroy();this._batchHeightTexture=this._batchHeightTexture&&this._batchHeightTexture.destroy();this._curBatchHeightValues=[];this._curBatchHeightValues=void 0;for(var a=this._pickIds,b=a.length,c=0;c<b;++c)a[c].destroy();return t(this)};return aa});F("Scene/Cesium3DTileFeature",["../Core/Color","../Core/defined","../Core/defineProperties"],function(b,a,f){function k(a,b){this._content=a;this._batchId=b;this._color=void 0}f(k.prototype,{show:{get:function(){return this._content.batchTable.getShow(this._batchId)},set:function(a){this._content.batchTable.setShow(this._batchId,a)}},color:{get:function(){a(this._color)||(this._color=new b);return this._content.batchTable.getColor(this._batchId,this._color)},set:function(a){this._content.batchTable.setColor(this._batchId,a)}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickId:{get:function(){return this._content.batchTable.getPickColor(this._batchId)}}});k.prototype.hasProperty=function(a){return this._content.batchTable.hasProperty(this._batchId,a)};k.prototype.getPropertyNames=function(a){return this._content.batchTable.getPropertyNames(this._batchId,a)};k.prototype.getProperty=function(a){return this._content.batchTable.getProperty(this._batchId,a)};k.prototype.setProperty=function(a,b){this._content.batchTable.setProperty(this._batchId,a,b);this._content.featurePropertiesDirty=!0};k.prototype.isExactClass=function(a){return this._content.batchTable.isExactClass(this._batchId,a)};k.prototype.isClass=function(a){return this._content.batchTable.isClass(this._batchId,a)};k.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};return k});F("Scene/Cesium3DTileFeatureTable",["../Core/ComponentDatatype","../Core/defaultValue","../Core/defined"],function(b,a,f){function k(a,b){this.json=a;this.buffer=b;this._cachedTypedArrays={};this.featuresLength=0}function g(a,g,e,h,k,d){var l=a._cachedTypedArrays,m=l[g];f(m)||(m=b.createArrayBufferView(e,a.buffer.buffer,a.buffer.byteOffset+d,k*h),l[g]=m);return m}k.prototype.getGlobalProperty=function(k,m,e){var h=this.json[k];if(f(h))return f(h.byteOffset)?(m=a(m,b.UNSIGNED_INT),e=a(e,1),g(this,k,m,e,1,h.byteOffset)):h};k.prototype.getPropertyArray=function(a,k,e){var h=this.json[a];if(f(h)){if(f(h.byteOffset))return f(h.componentType)&&(k=b.fromName(h.componentType)),g(this,a,k,e,this.featuresLength,h.byteOffset);e=this._cachedTypedArrays;var l=e[a];f(l)||(l=b.createTypedArray(k,h),e[a]=l);return l}};k.prototype.getProperty=function(a,b,e,g,k){if(f(this.json[a])){a=this.getPropertyArray(a,b,e);if(1===e)return a[g];for(b=0;b<e;++b)k[b]=a[e*g+b];return k}};return k});F("Scene/Vector3DTileBatch",[],function(){return function(b){this.offset=b.offset;this.count=b.count;this.color=b.color;this.batchIds=b.batchIds}});F("Shaders/VectorTileVS",[],function(){return"attribute vec3 position;\nattribute float a_batchId;\nuniform mat4 u_modifiedModelViewProjection;\nvoid main()\n{\ngl_Position \x3d czm_depthClampFarPlane(u_modifiedModelViewProjection * vec4(position, 1.0));\n}\n"});F("ThirdParty/jsep",[],function(){(function(b){var a=function(a,b){var c=Error(a+" at character "+b);c.index=b;c.description=a;throw c;},f={"-":!0,"!":!0,"~":!0,"+":!0},k={"||":1,"\x26\x26":2,"|":3,"^":4,"\x26":5,"\x3d\x3d":6,"!\x3d":6,"\x3d\x3d\x3d":6,"!\x3d\x3d":6,"\x3c":7,"\x3e":7,"\x3c\x3d":7,"\x3e\x3d":7,"\x3c\x3c":8,"\x3e\x3e":8,"\x3e\x3e\x3e":8,"+":9,"-":9,"*":10,"/":10,"%":10},g=function(a){var b=0,d,e;for(e in a)(d=e.length)>b&&a.hasOwnProperty(e)&&(b=d);return b},l=g(f),m=g(k),e={"true":!0,"false":!1,"null":null},h=function(a,b,d){return{type:"||"===a||"\x26\x26"===a?"LogicalExpression":"BinaryExpression",operator:a,left:b,right:d}},p=function(a){return 48<=a&&57>=a},d=function(a){return 36===a||95===a||65<=a&&90>=a||97<=a&&122>=a||128<=a&&!k[String.fromCharCode(a)]},q=function(b){for(var c=0,g=b.charAt,q=b.charCodeAt,r=function(a){return g.call(b,a)},t=function(a){return q.call(b,a)},x=b.length,D=function(){for(var a=t(c);32===a||9===a;)a=t(++c)},v=function(){var b;var d,e,f,g,l;d=C();if(e=B()){g={value:e,prec:k[e]||0};(l=C())||a("Expected expression after "+e,c);for(b=[d,g,l];e=B();){f=k[e]||0;if(0===f)break;for(g={value:e,prec:f};2<b.length&&f<=b[b.length-2].prec;)l=b.pop(),e=b.pop().value,d=b.pop(),d=h(e,d,l),b.push(d);(d=C())||a("Expected expression after "+e,c);b.push(g,d)}e=b.length-1;for(d=b[e];1<e;)d=h(b[e-1].value,b[e-2],d),e-=2}b=d;D();if(63===t(c)){c++;(e=v())||a("Expected expression",c);D();if(58===t(c))return c++,(f=v())||a("Expected expression",c),{type:"ConditionalExpression",test:b,consequent:e,alternate:f};a("Expected :",c)}else return b},B=function(){D();for(var a=b.substr(c,m),d=a.length;0<d;){if(k.hasOwnProperty(a))return c+=d,a;a=a.substr(0,--d)}return!1},C=function(){var e,g;D();e=t(c);if(p(e)||46===e){for(e="";p(t(c));)e+=r(c++);if(46===t(c))for(e+=r(c++);p(t(c));)e+=r(c++);g=r(c);if("e"===g||"E"===g){e+=r(c++);g=r(c);if("+"===g||"-"===g)e+=r(c++);for(;p(t(c));)e+=r(c++);p(t(c-1))||a("Expected exponent ("+e+r(c)+")",c)}g=t(c);d(g)?a("Variable names cannot start with a number ("+e+r(c)+")",c):46===g&&a("Unexpected period",c);return{type:"Literal",value:parseFloat(e),raw:e}}if(39===e||34===e){e="";g=r(c++);for(var h=!1,k;c<x;)if(k=r(c++),k===g){h=!0;break}else if("\\"===k)switch(k=r(c++),k){case "n":e+="\n";break;case "r":e+="\r";break;case "t":e+="\t";break;case "b":e+="\b";break;case "f":e+="\f";break;case "v":e+="\x0B";break;default:e+="\\"+k}else e+=k;h||a('Unclosed quote after "'+e+'"',c);return{type:"Literal",value:e,raw:g+e+g}}if(d(e)||40===e){e=t(c);40===e?(c++,e=v(),D(),41===t(c)?c++:(a("Unclosed (",c),e=void 0)):e=I();g=e;D();for(e=t(c);46===e||91===e||40===e;)c++,46===e?(D(),g={type:"MemberExpression",computed:!1,object:g,property:I()}):91===e?(g={type:"MemberExpression",computed:!0,object:g,property:v()},D(),e=t(c),93!==e&&a("Unclosed [",c),c++):40===e&&(g={type:"CallExpression",arguments:H(41),callee:g}),D(),e=t(c);return g}if(91===e)return c++,{type:"ArrayExpression",elements:H(93)};e=b.substr(c,l);for(g=e.length;0<g;){if(f.hasOwnProperty(e))return c+=g,{type:"UnaryExpression",operator:e,argument:C(),prefix:!0};e=e.substr(0,--g)}return!1},I=function(){var f=t(c),g=c;for(d(f)?c++:a("Unexpected "+r(c),c);c<x;)if(f=t(c),36===f||95===f||65<=f&&90>=f||97<=f&&122>=f||48<=f&&57>=f||128<=f&&!k[String.fromCharCode(f)])c++;else break;f=b.slice(g,c);return e.hasOwnProperty(f)?{type:"Literal",value:e[f],raw:f}:"this"===f?{type:"ThisExpression"}:{type:"Identifier",name:f}},H=function(b){for(var d,e=[],f=!1;c<x;)if(D(),d=t(c),d===b){f=!0;c++;break}else 44===d?c++:((d=v())&&"Compound"!==d.type||a("Expected comma",c),e.push(d));f||a("Expected "+String.fromCharCode(b),c);return e},J=[],w,G;c<x;)w=t(c),59===w||44===w?c++:(G=v())?J.push(G):c<x&&a('Unexpected "'+r(c)+'"',c);return 1===J.length?J[0]:{type:"Compound",body:J}};q.version="0.3.1";q.toString=function(){return"JavaScript Expression Parser (JSEP) v"+q.version};q.addUnaryOp=function(a){l=Math.max(a.length,l);f[a]=!0;return this};q.addBinaryOp=function(a,b){m=Math.max(a.length,m);k[a]=b;return this};q.addLiteral=function(a,b){e[a]=b;return this};q.removeUnaryOp=function(a){delete f[a];a.length===l&&(l=g(f));return this};q.removeAllUnaryOps=function(){f={};l=0;return this};q.removeBinaryOp=function(a){delete k[a];a.length===m&&(m=g(k));return this};q.removeAllBinaryOps=function(){k={};m=0;return this};q.removeLiteral=function(a){delete e[a];return this};q.removeAllLiterals=function(){e={};return this};if("undefined"===typeof exports){var t=b.jsep;b.jsep=q;q.noConflict=function(){b.jsep===q&&(b.jsep=t);return q}}else"undefined"!==typeof module&&module.exports?exports=module.exports=q:exports.parse=q})(this);if("undefined"!==typeof jsep)return jsep.noConflict()});F("Scene/ExpressionNodeType",["../Core/freezeObject"],function(b){return b({VARIABLE:0,UNARY:1,BINARY:2,TERNARY:3,CONDITIONAL:4,MEMBER:5,FUNCTION_CALL:6,ARRAY:7,REGEX:8,VARIABLE_IN_STRING:9,LITERAL_NULL:10,LITERAL_BOOLEAN:11,LITERAL_NUMBER:12,LITERAL_STRING:13,LITERAL_COLOR:14,LITERAL_VECTOR:15,LITERAL_REGEX:16,LITERAL_UNDEFINED:17,BUILTIN_VARIABLE:18})});F("Scene/Expression","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Check ../Core/Color ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/isArray ../Core/Math ../Core/RuntimeError ../ThirdParty/jsep ./ExpressionNodeType".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a,b){k.typeOf.string("expression",a);this._expression=a;var c=a;if(l(b))for(var e in b)if(b.hasOwnProperty(e)){var f=new RegExp("\\$\\{"+e+"\\}","g"),g="("+b[e]+")";l(g)&&(c=c.replace(f,g))}c=c.replace(W,M);e="";for(f=c.indexOf("${");0<=f;){var g=c.indexOf("'"),h=c.indexOf('"');if(0<=g&&g<f)f=c.indexOf("'",g+1),e+=c.substr(0,f+1),c=c.substr(f+1);else if(0<=h&&h<f)f=c.indexOf('"',h+1),e+=c.substr(0,f+1),c=c.substr(f+1);else{e+=c.substr(0,f);g=c.indexOf("}");if(0>g)throw new d("Unmatched {.");e+="czm_"+c.substr(f+2,g-(f+2));c=c.substr(g+1)}f=c.indexOf("${")}a=e+c;q.addBinaryOp("\x3d~",0);q.addBinaryOp("!~",0);var m;try{m=q(a)}catch(na){throw new d(na);}this._runtimeAst=C(this,m)}function c(c){return function(e,g){if("number"===typeof g)return c(g);if(g instanceof b)return b.fromElements(c(g.x),c(g.y),O.getCartesian2());if(g instanceof a)return a.fromElements(c(g.x),c(g.y),c(g.z),O.getCartesian3());if(g instanceof f)return f.fromElements(c(g.x),c(g.y),c(g.z),c(g.w),O.getCartesian4());throw new d('Function "'+e+'" requires a vector or number argument. Argument is '+g+".");}}function u(c,e){return function(g,h,k){if(e&&"number"===typeof k){if("number"===typeof h)return c(h,k);if(h instanceof b)return b.fromElements(c(h.x,k),c(h.y,k),O.getCartesian2());if(h instanceof a)return a.fromElements(c(h.x,k),c(h.y,k),c(h.z,k),O.getCartesian3());if(h instanceof f)return f.fromElements(c(h.x,k),c(h.y,k),c(h.z,k),c(h.w,k),O.getCartesian4())}if("number"===typeof h&&"number"===typeof k)return c(h,k);if(h instanceof b&&k instanceof b)return b.fromElements(c(h.x,k.x),c(h.y,k.y),O.getCartesian2());if(h instanceof a&&k instanceof a)return a.fromElements(c(h.x,k.x),c(h.y,k.y),c(h.z,k.z),O.getCartesian3());if(h instanceof f&&k instanceof f)return f.fromElements(c(h.x,k.x),c(h.y,k.y),c(h.z,k.z),c(h.w,k.w),O.getCartesian4());throw new d('Function "'+g+'" requires vector or number arguments of matching types. Arguments are '+h+" and "+k+".");}}function y(c,e){return function(g,h,k,l){if(e&&"number"===typeof l){if("number"===typeof h&&"number"===typeof k)return c(h,k,l);if(h instanceof b&&k instanceof b)return b.fromElements(c(h.x,k.x,l),c(h.y,k.y,l),O.getCartesian2());if(h instanceof a&&k instanceof a)return a.fromElements(c(h.x,k.x,l),c(h.y,k.y,l),c(h.z,k.z,l),O.getCartesian3());if(h instanceof f&&k instanceof f)return f.fromElements(c(h.x,k.x,l),c(h.y,k.y,l),c(h.z,k.z,l),c(h.w,k.w,l),O.getCartesian4())}if("number"===typeof h&&"number"===typeof k&&"number"===typeof l)return c(h,k,l);if(h instanceof b&&k instanceof b&&l instanceof b)return b.fromElements(c(h.x,k.x,l.x),c(h.y,k.y,l.y),O.getCartesian2());if(h instanceof a&&k instanceof a&&l instanceof a)return a.fromElements(c(h.x,k.x,l.x),c(h.y,k.y,l.y),c(h.z,k.z,l.z),O.getCartesian3());if(h instanceof f&&k instanceof f&&l instanceof f)return f.fromElements(c(h.x,k.x,l.x),c(h.y,k.y,l.y),c(h.z,k.z,l.z),c(h.w,k.w,l.w),O.getCartesian4());throw new d('Function "'+g+'" requires vector or number arguments of matching types. Arguments are '+h+", "+k+", and "+l+".");}}function A(a,b,c,d,e){this._type=a;this._value=b;this._left=c;this._right=d;this._test=e;this.evaluate=void 0;this._type===t.CONDITIONAL?this.evaluate=this._evaluateConditional:this._type===t.FUNCTION_CALL?"test"===this._value?this.evaluate=this._evaluateRegExpTest:"exec"===this._value?this.evaluate=this._evaluateRegExpExec:"toString"===this._value&&(this.evaluate=this._evaluateToString):this._type===t.UNARY?"!"===this._value?this.evaluate=this._evaluateNot:"-"===this._value?this.evaluate=this._evaluateNegative:"+"===this._value?this.evaluate=this._evaluatePositive:"isNaN"===this._value?this.evaluate=this._evaluateNaN:"isFinite"===this._value?this.evaluate=this._evaluateIsFinite:"isExactClass"===this._value?this.evaluate=this._evaluateIsExactClass:"isClass"===this._value?this.evaluate=this._evaluateIsClass:"getExactClassName"===this._value?this.evaluate=this._evaluateGetExactClassName:"Boolean"===this._value?this.evaluate=this._evaluateBooleanConversion:"Number"===this._value?this.evaluate=this._evaluateNumberConversion:"String"===this._value?this.evaluate=this._evaluateStringConversion:l(Q[this._value])&&(this.evaluate=H(this._value)):this._type===t.BINARY?"+"===this._value?this.evaluate=this._evaluatePlus:"-"===this._value?this.evaluate=this._evaluateMinus:"*"===this._value?this.evaluate=this._evaluateTimes:"/"===this._value?this.evaluate=this._evaluateDivide:"%"===this._value?this.evaluate=this._evaluateMod:"\x3d\x3d\x3d"===this._value?this.evaluate=this._evaluateEqualsStrict:"!\x3d\x3d"===this._value?this.evaluate=this._evaluateNotEqualsStrict:"\x3c"===this._value?this.evaluate=this._evaluateLessThan:"\x3c\x3d"===this._value?this.evaluate=this._evaluateLessThanOrEquals:"\x3e"===this._value?this.evaluate=this._evaluateGreaterThan:"\x3e\x3d"===this._value?this.evaluate=this._evaluateGreaterThanOrEquals:"\x26\x26"===this._value?this.evaluate=this._evaluateAnd:"||"===this._value?this.evaluate=this._evaluateOr:"\x3d~"===this._value?this.evaluate=this._evaluateRegExpMatch:"!~"===this._value?this.evaluate=this._evaluateRegExpNotMatch:l(S[this._value])&&(this.evaluate=J(this._value)):this._type===t.TERNARY?this.evaluate=w(this._value):this._type===t.MEMBER?this.evaluate="brackets"===this._value?this._evaluateMemberBrackets:this._evaluateMemberDot:this._type===t.ARRAY?this.evaluate=this._evaluateArray:this._type===t.VARIABLE?this.evaluate=this._evaluateVariable:this._type===t.VARIABLE_IN_STRING?this.evaluate=this._evaluateVariableString:this._type===t.LITERAL_COLOR?this.evaluate=this._evaluateLiteralColor:this._type===t.LITERAL_VECTOR?this.evaluate=this._evaluateLiteralVector:this._type===t.LITERAL_STRING?this.evaluate=this._evaluateLiteralString:this._type===t.REGEX?this.evaluate=this._evaluateRegExp:this._type===t.BUILTIN_VARIABLE?"tiles3d_tileset_time"===this._value&&(this.evaluate=I):this.evaluate=this._evaluateLiteral}function z(a){var b=typeof a.value;if(null===a.value)return new A(t.LITERAL_NULL,null);if("boolean"===b)return new A(t.LITERAL_BOOLEAN,a.value);if("number"===b)return new A(t.LITERAL_NUMBER,a.value);if("string"===b)return 0<=a.value.indexOf("${")?new A(t.VARIABLE_IN_STRING,a.value):new A(t.LITERAL_STRING,a.value.replace(R,"\\"))}function x(a,b){var c=b.arguments,e=c.length,f,g;if("MemberExpression"===b.callee.type){f=b.callee.property.name;g=b.callee.object;if("test"===f||"exec"===f){if("regExp"!==g.callee.name)throw new d(f+" is not a function.");if(0===e)return"test"===f?new A(t.LITERAL_BOOLEAN,!1):new A(t.LITERAL_NULL,null);e=C(a,g);g=C(a,c[0]);return new A(t.FUNCTION_CALL,f,e,g)}if("toString"===f)return g=C(a,g),new A(t.FUNCTION_CALL,f,g);throw new d('Unexpected function call "'+f+'".');}f=b.callee.name;if("color"===f){if(0===e)return new A(t.LITERAL_COLOR,f);g=C(a,c[0]);return l(c[1])?(c=C(a,c[1]),new A(t.LITERAL_COLOR,f,[g,c])):new A(t.LITERAL_COLOR,f,[g])}if("rgb"===f||"hsl"===f){if(3>e)throw new d(f+" requires three arguments.");g=[C(a,c[0]),C(a,c[1]),C(a,c[2])];return new A(t.LITERAL_COLOR,f,g)}if("rgba"===f||"hsla"===f){if(4>e)throw new d(f+" requires four arguments.");g=[C(a,c[0]),C(a,c[1]),C(a,c[2]),C(a,c[3])];return new A(t.LITERAL_COLOR,f,g)}if("vec2"===f||"vec3"===f||"vec4"===f){g=Array(e);for(var h=0;h<e;++h)g[h]=C(a,c[h]);return new A(t.LITERAL_VECTOR,f,g)}if("isNaN"===f||"isFinite"===f){if(0===e)return"isNaN"===f?new A(t.LITERAL_BOOLEAN,!0):new A(t.LITERAL_BOOLEAN,!1);g=C(a,c[0]);return new A(t.UNARY,f,g)}if("isExactClass"===f||"isClass"===f){if(1>e||1<e)throw new d(f+" requires exactly one argument.");g=C(a,c[0]);return new A(t.UNARY,f,g)}if("getExactClassName"===f){if(0<e)throw new d(f+" does not take any argument.");return new A(t.UNARY,f)}if(l(Q[f])){if(1!==e)throw new d(f+" requires exactly one argument.");g=C(a,c[0]);return new A(t.UNARY,f,g)}if(l(S[f])){if(2!==e)throw new d(f+" requires exactly two arguments.");e=C(a,c[0]);g=C(a,c[1]);return new A(t.BINARY,f,e,g)}if(l(ca[f])){if(3!==e)throw new d(f+" requires exactly three arguments.");e=C(a,c[0]);g=C(a,c[1]);c=C(a,c[2]);return new A(t.TERNARY,f,e,g,c)}if("Boolean"===f){if(0===e)return new A(t.LITERAL_BOOLEAN,!1);g=C(a,c[0]);return new A(t.UNARY,f,g)}if("Number"===f){if(0===e)return new A(t.LITERAL_NUMBER,0);g=C(a,c[0]);return new A(t.UNARY,f,g)}if("String"===f){if(0===e)return new A(t.LITERAL_STRING,"");g=C(a,c[0]);return new A(t.UNARY,f,g)}if("regExp"===f)return D(a,b);throw new d('Unexpected function call "'+f+'".');}function D(a,b){var c=b.arguments;if(0===c.length)return new A(t.LITERAL_REGEX,RegExp());var e=C(a,c[0]),f;if(1<c.length){c=C(a,c[1]);if(e._type>=t.LITERAL_NULL&&c._type>=t.LITERAL_NULL){try{f=new RegExp(String(e._value).replace(R,"\\"),c._value)}catch(fa){throw new d(fa);}return new A(t.LITERAL_REGEX,f)}return new A(t.REGEX,e,c)}if(e._type>=t.LITERAL_NULL){try{f=new RegExp(String(e._value).replace(R,"\\"))}catch(fa){throw new d(fa);}return new A(t.LITERAL_REGEX,f)}return new A(t.REGEX,e)}function v(a){if("czm_"===a.name.substr(0,4))return a=a.name.substr(4),"tiles3d_"===a.substr(0,8)?new A(t.BUILTIN_VARIABLE,a):new A(t.VARIABLE,a);if("NaN"===a.name)return new A(t.LITERAL_NUMBER,NaN);if("Infinity"===a.name)return new A(t.LITERAL_NUMBER,Infinity);if("undefined"===a.name)return new A(t.LITERAL_UNDEFINED,void 0);throw new d(a.name+" is not defined.");}function B(a,b){if("Math"===b.object.name){var c;c=b.property.name;c="PI"===c?new A(t.LITERAL_NUMBER,Math.PI):"E"===c?new A(t.LITERAL_NUMBER,Math.E):void 0;return c}if("Number"===b.object.name)return c="POSITIVE_INFINITY"===b.property.name?new A(t.LITERAL_NUMBER,Number.POSITIVE_INFINITY):void 0,c;var d=C(a,b.object);if(b.computed)return c=C(a,b.property),new A(t.MEMBER,"brackets",d,c);c=new A(t.LITERAL_STRING,b.property.name);return new A(t.MEMBER,"dot",d,c)}function C(a,b){var c,e,f,g;if("Literal"===b.type)c=z(b);else if("CallExpression"===b.type)c=x(a,b);else if("Identifier"===b.type)c=v(b);else if("UnaryExpression"===b.type)if(e=b.operator,f=C(a,b.argument),-1<Z.indexOf(e))c=new A(t.UNARY,e,f);else throw new d('Unexpected operator "'+e+'".');else if("BinaryExpression"===b.type)if(e=b.operator,f=C(a,b.left),g=C(a,b.right),-1<aa.indexOf(e))c=new A(t.BINARY,e,f,g);else throw new d('Unexpected operator "'+e+'".');else if("LogicalExpression"===b.type)e=b.operator,f=C(a,b.left),g=C(a,b.right),-1<aa.indexOf(e)&&(c=new A(t.BINARY,e,f,g));else if("ConditionalExpression"===b.type)e=C(a,b.test),f=C(a,b.consequent),g=C(a,b.alternate),c=new A(t.CONDITIONAL,"?",f,g,e);else if("MemberExpression"===b.type)c=B(a,b);else if("ArrayExpression"===b.type){e=[];for(f=0;f<b.elements.length;f++)e[f]=C(a,b.elements[f]);c=new A(t.ARRAY,e)}else{if("Compound"===b.type)throw new d("Provide exactly one expression.");throw new d("Cannot parse expression.");}return c}function I(a){return l(a)?a.content.tileset.timeSinceLoad:0}function H(a){var b=Q[a];return function(c){c=this._left.evaluate(c);return b(a,c)}}function J(a){var b=S[a];return function(c){var d=this._left.evaluate(c);c=this._right.evaluate(c);return b(a,d,c)}}function w(a){var b=ca[a];return function(c){var d=this._left.evaluate(c),e=this._right.evaluate(c);c=this._test.evaluate(c);return b(a,d,e,c)}}function G(a,b){if(l(a))return a.getProperty(b)}function E(a){a=a._left;for(var b=a.length,c=0;c<b;++c)if(a[c]._type!==t.LITERAL_NUMBER)return;return g.fromHsl(a[0]._value,a[1]._value,a[2]._value,4===b?a[3]._value:1,Y)}function L(a){a=a._left;for(var b=a.length,c=0;c<b;++c)if(a[c]._type!==t.LITERAL_NUMBER)return;c=Y;c.red=a[0]._value/255;c.green=a[1]._value/255;c.blue=a[2]._value/255;c.alpha=4===b?a[3]._value:1;return c}function K(a){return 0===a%1?a.toFixed(1):a.toString()}function P(a){var b=K(a.red),c=K(a.green),d=K(a.blue);a=K(a.alpha);return"vec4("+b+", "+c+", "+d+", "+a+")"}function F(a,b,c,d){for(var e=a.length,f=Array(e),g=0;g<e;++g)f[g]=a[g].getShaderExpression(b,c,d);return f}m(r.prototype,{expression:{get:function(){return this._expression}}});var O={arrayIndex:0,arrayArray:[[]],cartesian2Index:0,cartesian3Index:0,cartesian4Index:0,cartesian2Array:[new b],cartesian3Array:[new a],cartesian4Array:[new f],reset:function(){this.cartesian4Index=this.cartesian3Index=this.cartesian2Index=this.arrayIndex=0},getArray:function(){this.arrayIndex>=this.arrayArray.length&&this.arrayArray.push([]);var a=this.arrayArray[this.arrayIndex++];a.length=0;return a},getCartesian2:function(){this.cartesian2Index>=this.cartesian2Array.length&&this.cartesian2Array.push(new b);return this.cartesian2Array[this.cartesian2Index++]},getCartesian3:function(){this.cartesian3Index>=this.cartesian3Array.length&&this.cartesian3Array.push(new a);return this.cartesian3Array[this.cartesian3Index++]},getCartesian4:function(){this.cartesian4Index>=this.cartesian4Array.length&&this.cartesian4Array.push(new f);return this.cartesian4Array[this.cartesian4Index++]}};r.prototype.evaluate=function(c,d){O.reset();var e=this._runtimeAst.evaluate(c);return d instanceof g&&e instanceof f?g.fromCartesian4(e,d):e instanceof b||e instanceof a||e instanceof f?e.clone(d):e};r.prototype.evaluateColor=function(a,b){O.reset();var c=this._runtimeAst.evaluate(a);return g.fromCartesian4(c,b)};r.prototype.getShaderFunction=function(a,b,c,d){b=this.getShaderExpression(b,c);return d+" "+a+"() \n{ \n    return "+b+"; \n} \n"};r.prototype.getShaderExpression=function(a,b){return this._runtimeAst.getShaderExpression(a,b)};var Z=["!","-","+"],aa="+ - * / % \x3d\x3d\x3d !\x3d\x3d \x3e \x3e\x3d \x3c \x3c\x3d \x26\x26 || !~ \x3d~".split(" "),U=/\${(.*?)}/g,W=/\\/g,M="@#%",R=/@#%/g,Y=new g,Q={abs:c(Math.abs),sqrt:c(Math.sqrt),cos:c(Math.cos),sin:c(Math.sin),tan:c(Math.tan),acos:c(Math.acos),asin:c(Math.asin),atan:c(Math.atan),radians:c(p.toRadians),degrees:c(p.toDegrees),sign:c(p.sign),floor:c(Math.floor),ceil:c(Math.ceil),round:c(Math.round),exp:c(Math.exp),exp2:c(function(a){return Math.pow(2,a)}),log:c(Math.log),log2:c(function(a){return p.log2(a)}),fract:c(function(a){return a-Math.floor(a)}),length:function(c,e){if("number"===typeof e)return Math.abs(e);if(e instanceof b)return b.magnitude(e);if(e instanceof a)return a.magnitude(e);if(e instanceof f)return f.magnitude(e);throw new d('Function "'+c+'" requires a vector or number argument. Argument is '+e+".");},normalize:function(c,e){if("number"===typeof e)return 1;if(e instanceof b)return b.normalize(e,O.getCartesian2());if(e instanceof a)return a.normalize(e,O.getCartesian3());if(e instanceof f)return f.normalize(e,O.getCartesian4());throw new d('Function "'+c+'" requires a vector or number argument. Argument is '+e+".");}},S={atan2:u(Math.atan2,!1),pow:u(Math.pow,!1),min:u(Math.min,!0),max:u(Math.max,!0),distance:function(c,e,g){if("number"===typeof e&&"number"===typeof g)return Math.abs(e-g);if(e instanceof b&&g instanceof b)return b.distance(e,g);if(e instanceof a&&g instanceof a)return a.distance(e,g);if(e instanceof f&&g instanceof f)return f.distance(e,g);throw new d('Function "'+c+'" requires vector or number arguments of matching types. Arguments are '+e+" and "+g+".");},dot:function(c,e,g){if("number"===typeof e&&"number"===typeof g)return e*g;if(e instanceof b&&g instanceof b)return b.dot(e,g);if(e instanceof a&&g instanceof a)return a.dot(e,g);if(e instanceof f&&g instanceof f)return f.dot(e,g);throw new d('Function "'+c+'" requires vector or number arguments of matching types. Arguments are '+e+" and "+g+".");},cross:function(b,c,e){if(c instanceof a&&e instanceof a)return a.cross(c,e,O.getCartesian3());throw new d('Function "'+b+'" requires vec3 arguments. Arguments are '+c+" and "+e+".");}},ca={clamp:y(p.clamp,!0),mix:y(p.lerp,!0)};A.prototype._evaluateLiteral=function(){return this._value};A.prototype._evaluateLiteralColor=function(a){var b=Y,c=this._left;if("color"===this._value)l(c)?1<c.length?(g.fromCssColorString(c[0].evaluate(a),b),b.alpha=c[1].evaluate(a)):g.fromCssColorString(c[0].evaluate(a),b):g.fromBytes(255,255,255,255,b);else if("rgb"===this._value)g.fromBytes(c[0].evaluate(a),c[1].evaluate(a),c[2].evaluate(a),255,b);else if("rgba"===this._value){var d=255*c[3].evaluate(a);g.fromBytes(c[0].evaluate(a),c[1].evaluate(a),c[2].evaluate(a),d,b)}else"hsl"===this._value?g.fromHsl(c[0].evaluate(a),c[1].evaluate(a),c[2].evaluate(a),1,b):"hsla"===this._value&&g.fromHsl(c[0].evaluate(a),c[1].evaluate(a),c[2].evaluate(a),c[3].evaluate(a),b);return f.fromColor(b,O.getCartesian4())};A.prototype._evaluateLiteralVector=function(c){for(var e=O.getArray(),g=this._value,h=this._left,k=h.length,l=0;l<k;++l){var m=h[l].evaluate(c);if("number"===typeof m)e.push(m);else if(m instanceof b)e.push(m.x,m.y);else if(m instanceof a)e.push(m.x,m.y,m.z);else if(m instanceof f)e.push(m.x,m.y,m.z,m.w);else throw new d(g+" argument must be a vector or number. Argument is "+m+".");}c=e.length;h=parseInt(g.charAt(3));if(0===c)throw new d("Invalid "+g+" constructor. No valid arguments.");if(c<h&&1<c)throw new d("Invalid "+g+" constructor. Not enough arguments.");if(c>h&&1<k)throw new d("Invalid "+g+" constructor. Too many arguments.");1===c&&(k=e[0],e.push(k,k,k));if("vec2"===g)return b.fromArray(e,0,O.getCartesian2());if("vec3"===g)return a.fromArray(e,0,O.getCartesian3());if("vec4"===g)return f.fromArray(e,0,O.getCartesian4())};A.prototype._evaluateLiteralString=function(){return this._value};A.prototype._evaluateVariableString=function(a){for(var b=this._value,c=U.exec(b);null!==c;){var d=c[0],c=G(a,c[1]);l(c)||(c="");b=b.replace(d,c);c=U.exec(b)}return b};A.prototype._evaluateVariable=function(a){return G(a,this._value)};A.prototype._evaluateMemberDot=function(c){if("feature"===this._left._value)return G(c,this._right.evaluate(c));var d=this._left.evaluate(c);if(l(d)){c=this._right.evaluate(c);if(d instanceof b||d instanceof a||d instanceof f){if("r"===c)return d.x;if("g"===c)return d.y;if("b"===c)return d.z;if("a"===c)return d.w}return d[c]}};A.prototype._evaluateMemberBrackets=function(c){if("feature"===this._left._value)return G(c,this._right.evaluate(c));var d=this._left.evaluate(c);if(l(d)){c=this._right.evaluate(c);if(d instanceof b||d instanceof a||d instanceof f){if(0===c||"r"===c)return d.x;if(1===c||"g"===c)return d.y;if(2===c||"b"===c)return d.z;if(3===c||"a"===c)return d.w}return d[c]}};A.prototype._evaluateArray=function(a){for(var b=[],c=0;c<this._value.length;c++)b[c]=this._value[c].evaluate(a);return b};A.prototype._evaluateNot=function(a){a=this._left.evaluate(a);if("boolean"!==typeof a)throw new d('Operator "!" requires a boolean argument. Argument is '+a+".");return!a};A.prototype._evaluateNegative=function(c){c=this._left.evaluate(c);if(c instanceof b)return b.negate(c,O.getCartesian2());if(c instanceof a)return a.negate(c,O.getCartesian3());if(c instanceof f)return f.negate(c,O.getCartesian4());if("number"===typeof c)return-c;throw new d('Operator "-" requires a vector or number argument. Argument is '+c+".");};A.prototype._evaluatePositive=function(c){c=this._left.evaluate(c);if(!(c instanceof b||c instanceof a||c instanceof f||"number"===typeof c))throw new d('Operator "+" requires a vector or number argument. Argument is '+c+".");return c};A.prototype._evaluateLessThan=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if("number"!==typeof b||"number"!==typeof a)throw new d('Operator "\x3c" requires number arguments. Arguments are '+b+" and "+a+".");return b<a};A.prototype._evaluateLessThanOrEquals=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if("number"!==typeof b||"number"!==typeof a)throw new d('Operator "\x3c\x3d" requires number arguments. Arguments are '+b+" and "+a+".");return b<=a};A.prototype._evaluateGreaterThan=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if("number"!==typeof b||"number"!==typeof a)throw new d('Operator "\x3e" requires number arguments. Arguments are '+b+" and "+a+".");return b>a};A.prototype._evaluateGreaterThanOrEquals=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if("number"!==typeof b||"number"!==typeof a)throw new d('Operator "\x3e\x3d" requires number arguments. Arguments are '+b+" and "+a+".");return b>=a};A.prototype._evaluateOr=function(a){var b=this._left.evaluate(a);if("boolean"!==typeof b)throw new d('Operator "||" requires boolean arguments. First argument is '+b+".");if(b)return!0;a=this._right.evaluate(a);if("boolean"!==typeof a)throw new d('Operator "||" requires boolean arguments. Second argument is '+a+".");return b||a};A.prototype._evaluateAnd=function(a){var b=this._left.evaluate(a);if("boolean"!==typeof b)throw new d('Operator "\x26\x26" requires boolean arguments. First argument is '+b+".");if(!b)return!1;a=this._right.evaluate(a);if("boolean"!==typeof a)throw new d('Operator "\x26\x26" requires boolean arguments. Second argument is '+a+".");return b&&a};A.prototype._evaluatePlus=function(c){var e=this._left.evaluate(c);c=this._right.evaluate(c);if(c instanceof b&&e instanceof b)return b.add(e,c,O.getCartesian2());if(c instanceof a&&e instanceof a)return a.add(e,c,O.getCartesian3());if(c instanceof f&&e instanceof f)return f.add(e,c,O.getCartesian4());if("string"===typeof e||"string"===typeof c||"number"===typeof e&&"number"===typeof c)return e+c;throw new d('Operator "+" requires vector or number arguments of matching types, or at least one string argument. Arguments are '+e+" and "+c+".");};A.prototype._evaluateMinus=function(c){var e=this._left.evaluate(c);c=this._right.evaluate(c);if(c instanceof b&&e instanceof b)return b.subtract(e,c,O.getCartesian2());if(c instanceof a&&e instanceof a)return a.subtract(e,c,O.getCartesian3());if(c instanceof f&&e instanceof f)return f.subtract(e,c,O.getCartesian4());if("number"===typeof e&&"number"===typeof c)return e-c;throw new d('Operator "-" requires vector or number arguments of matching types. Arguments are '+e+" and "+c+".");};A.prototype._evaluateTimes=function(c){var e=this._left.evaluate(c);c=this._right.evaluate(c);if(c instanceof b&&e instanceof b)return b.multiplyComponents(e,c,O.getCartesian2());if(c instanceof b&&"number"===typeof e)return b.multiplyByScalar(c,e,O.getCartesian2());if(e instanceof b&&"number"===typeof c)return b.multiplyByScalar(e,c,O.getCartesian2());if(c instanceof a&&e instanceof a)return a.multiplyComponents(e,c,O.getCartesian3());if(c instanceof a&&"number"===typeof e)return a.multiplyByScalar(c,e,O.getCartesian3());if(e instanceof a&&"number"===typeof c)return a.multiplyByScalar(e,c,O.getCartesian3());if(c instanceof f&&e instanceof f)return f.multiplyComponents(e,c,O.getCartesian4());if(c instanceof f&&"number"===typeof e)return f.multiplyByScalar(c,e,O.getCartesian4());if(e instanceof f&&"number"===typeof c)return f.multiplyByScalar(e,c,O.getCartesian4());if("number"===typeof e&&"number"===typeof c)return e*c;throw new d('Operator "*" requires vector or number arguments. If both arguments are vectors they must be matching types. Arguments are '+e+" and "+c+".");};A.prototype._evaluateDivide=function(c){var e=this._left.evaluate(c);c=this._right.evaluate(c);if(c instanceof b&&e instanceof b)return b.divideComponents(e,c,O.getCartesian2());if(e instanceof b&&"number"===typeof c)return b.divideByScalar(e,c,O.getCartesian2());if(c instanceof a&&e instanceof a)return a.divideComponents(e,c,O.getCartesian3());if(e instanceof a&&"number"===typeof c)return a.divideByScalar(e,c,O.getCartesian3());if(c instanceof f&&e instanceof f)return f.divideComponents(e,c,O.getCartesian4());if(e instanceof f&&"number"===typeof c)return f.divideByScalar(e,c,O.getCartesian4());if("number"===typeof e&&"number"===typeof c)return e/c;throw new d('Operator "/" requires vector or number arguments of matching types, or a number as the second argument. Arguments are '+e+" and "+c+".");};A.prototype._evaluateMod=function(c){var e=this._left.evaluate(c);c=this._right.evaluate(c);if(c instanceof b&&e instanceof b)return b.fromElements(e.x%c.x,e.y%c.y,O.getCartesian2());if(c instanceof a&&e instanceof a)return a.fromElements(e.x%c.x,e.y%c.y,e.z%c.z,O.getCartesian3());if(c instanceof f&&e instanceof f)return f.fromElements(e.x%c.x,e.y%c.y,e.z%c.z,e.w%c.w,O.getCartesian4());if("number"===typeof e&&"number"===typeof c)return e%c;throw new d('Operator "%" requires vector or number arguments of matching types. Arguments are '+e+" and "+c+".");};A.prototype._evaluateEqualsStrict=function(c){var d=this._left.evaluate(c);c=this._right.evaluate(c);return c instanceof b&&d instanceof b||c instanceof a&&d instanceof a||c instanceof f&&d instanceof f?d.equals(c):d===c};A.prototype._evaluateNotEqualsStrict=function(c){var d=this._left.evaluate(c);c=this._right.evaluate(c);return c instanceof b&&d instanceof b||c instanceof a&&d instanceof a||c instanceof f&&d instanceof f?!d.equals(c):d!==c};A.prototype._evaluateConditional=function(a){var b=this._test.evaluate(a);if("boolean"!==typeof b)throw new d("Conditional argument of conditional expression must be a boolean. Argument is "+b+".");return b?this._left.evaluate(a):this._right.evaluate(a)};A.prototype._evaluateNaN=function(a){return isNaN(this._left.evaluate(a))};A.prototype._evaluateIsFinite=function(a){return isFinite(this._left.evaluate(a))};A.prototype._evaluateIsExactClass=function(a){return l(a)?a.isExactClass(this._left.evaluate(a)):!1};A.prototype._evaluateIsClass=function(a){return l(a)?a.isClass(this._left.evaluate(a)):!1};A.prototype._evaluateGetExactClassName=function(a){if(l(a))return a.getExactClassName()};A.prototype._evaluateBooleanConversion=function(a){return!!this._left.evaluate(a)};A.prototype._evaluateNumberConversion=function(a){return Number(this._left.evaluate(a))};A.prototype._evaluateStringConversion=function(a){return String(this._left.evaluate(a))};A.prototype._evaluateRegExp=function(a){var b=this._value.evaluate(a),c="";l(this._left)&&(c=this._left.evaluate(a));var e;try{e=new RegExp(b,c)}catch(X){throw new d(X);}return e};A.prototype._evaluateRegExpTest=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if(!(b instanceof RegExp&&"string"===typeof a))throw new d("RegExp.test requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+b+" and "+a+".");return b.test(a)};A.prototype._evaluateRegExpMatch=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if(b instanceof RegExp&&"string"===typeof a)return b.test(a);if(a instanceof RegExp&&"string"===typeof b)return a.test(b);throw new d('Operator "\x3d~" requires one RegExp argument and one string argument. Arguments are '+b+" and "+a+".");};A.prototype._evaluateRegExpNotMatch=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if(b instanceof RegExp&&"string"===typeof a)return!b.test(a);if(a instanceof RegExp&&"string"===typeof b)return!a.test(b);throw new d('Operator "!~" requires one RegExp argument and one string argument. Arguments are '+b+" and "+a+".");};A.prototype._evaluateRegExpExec=function(a){var b=this._left.evaluate(a);a=this._right.evaluate(a);if(!(b instanceof RegExp&&"string"===typeof a))throw new d("RegExp.exec requires the first argument to be a RegExp and the second argument to be a string. Arguments are "+b+" and "+a+".");b=b.exec(a);return l(b)?b[1]:null};A.prototype._evaluateToString=function(c){c=this._left.evaluate(c);if(c instanceof RegExp||c instanceof b||c instanceof a||c instanceof f)return String(c);throw new d('Unexpected function call "'+this._value+'".');};A.prototype.getShaderExpression=function(a,b,c){var f,k,m,p,q=this._type;f=this._value;l(this._left)&&(k=h(this._left)?F(this._left,a,b,this):this._left.getShaderExpression(a,b,this));l(this._right)&&(m=this._right.getShaderExpression(a,b,this));l(this._test)&&(p=this._test.getShaderExpression(a,b,this));h(this._value)&&(f=F(this._value,a,b,this));switch(q){case t.VARIABLE:return a+f;case t.UNARY:if("Boolean"===f)return"bool("+k+")";if("Number"===f)return"float("+k+")";if("round"===f)return"floor("+k+" + 0.5)";if(l(Q[f]))return f+"("+k+")";if("isNaN"===f||"isFinite"===f||"String"===f||"isExactClass"===f||"isClass"===f||"getExactClassName"===f)throw new d('Error generating style shader: "'+f+'" is not supported.');return l(Q[f])?f+"("+k+")":f+k;case t.BINARY:return"%"===f?"mod("+k+", "+m+")":"\x3d\x3d\x3d"===f?"("+k+" \x3d\x3d "+m+")":"!\x3d\x3d"===f?"("+k+" !\x3d "+m+")":"atan2"===f?"atan("+k+", "+m+")":l(S[f])?f+"("+k+", "+m+")":"("+k+" "+f+" "+m+")";case t.TERNARY:if(l(ca[f]))return f+"("+k+", "+m+", "+p+")";break;case t.CONDITIONAL:return"("+p+" ? "+k+" : "+m+")";case t.MEMBER:return"r"===m||"x"===m||"0.0"===m?k+"[0]":"g"===m||"y"===m||"1.0"===m?k+"[1]":"b"===m||"z"===m||"2.0"===m?k+"[2]":"a"===m||"w"===m||"3.0"===m?k+"[3]":k+"[int("+m+")]";case t.FUNCTION_CALL:throw new d('Error generating style shader: "'+f+'" is not supported.');case t.ARRAY:if(4===f.length)return"vec4("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";if(3===f.length)return"vec3("+f[0]+", "+f[1]+", "+f[2]+")";if(2===f.length)return"vec2("+f[0]+", "+f[1]+")";throw new d("Error generating style shader: Invalid array length. Array length should be 2, 3, or 4.");case t.REGEX:throw new d("Error generating style shader: Regular expressions are not supported.");case t.VARIABLE_IN_STRING:throw new d("Error generating style shader: Converting a variable to a string is not supported.");case t.LITERAL_NULL:throw new d("Error generating style shader: null is not supported.");case t.LITERAL_BOOLEAN:return f?"true":"false";case t.LITERAL_NUMBER:return K(f);case t.LITERAL_STRING:if(l(c)&&c._type===t.MEMBER&&("r"===f||"g"===f||"b"===f||"a"===f||"x"===f||"y"===f||"z"===f||"w"===f))return f;f=g.fromCssColorString(f,Y);if(l(f))return b=K(f.red),k=K(f.green),f=K(f.blue),"vec3("+b+", "+k+", "+f+")";throw new d("Error generating style shader: String literals are not supported.");case t.LITERAL_COLOR:if("color"===f)return l(k)?1<k.length?(f=k[0],k=k[1],"1.0"!==k&&(b.translucent=!0),"vec4("+f+", "+k+")"):"vec4("+k[0]+", 1.0)":"vec4(1.0)";if("rgb"===f)return f=L(this),l(f)?P(f):"vec4("+k[0]+" / 255.0, "+k[1]+" / 255.0, "+k[2]+" / 255.0, 1.0)";if("rgba"===f)return"1.0"!==k[3]&&(b.translucent=!0),f=L(this),l(f)?P(f):"vec4("+k[0]+" / 255.0, "+k[1]+" / 255.0, "+k[2]+" / 255.0, "+k[3]+")";if("hsl"===f)return f=E(this),l(f)?P(f):"vec4(czm_HSLToRGB(vec3("+k[0]+", "+k[1]+", "+k[2]+")), 1.0)";if("hsla"===f){f=E(this);if(l(f))return 1!==f.alpha&&(b.translucent=!0),P(f);"1.0"!==k[3]&&(b.translucent=!0);return"vec4(czm_HSLToRGB(vec3("+k[0]+", "+k[1]+", "+k[2]+")), "+k[3]+")"}break;case t.LITERAL_VECTOR:if(!l(k))throw new e("left should always be defined for type ExpressionNodeType.LITERAL_VECTOR");b=k.length;f+="(";for(a=0;a<b;++a)f+=k[a],a<b-1&&(f+=", ");return f+")";case t.LITERAL_REGEX:throw new d("Error generating style shader: Regular expressions are not supported.");case t.LITERAL_UNDEFINED:throw new d("Error generating style shader: undefined is not supported.");case t.BUILTIN_VARIABLE:if("tiles3d_tileset_time"===f)return"u_time"}};return r});F("Scene/Vector3DTilePrimitive","../Core/Cartesian3 ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/IndexDatatype ../Core/Matrix4 ../Core/PrimitiveType ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Shaders/ShadowVolumeFS ../Shaders/VectorTileVS ./BlendingState ./Cesium3DTileFeature ./ClassificationType ./DepthFunction ./Expression ./StencilConstants ./StencilFunction ./StencilOperation ./Vector3DTileBatch".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G){function E(c){c=k(c,k.EMPTY_OBJECT);this._batchTable=c.batchTable;this._batchIds=c.batchIds;this._positions=c.positions;this._vertexBatchIds=c.vertexBatchIds;this._indices=c.indices;this._indexCounts=c.indexCounts;this._indexOffsets=c.indexOffsets;this._batchedIndices=c.batchedIndices;this._boundingVolume=c.boundingVolume;this._boundingVolumes=c.boundingVolumes;this._center=k(c.center,b.ZERO);this._rsWireframe=this._rsPickPass=this._rsColorPass=this._rsStencilDepthPass3DTiles=this._rsStencilDepthPass=this._rsStencilPreloadPass3DTiles=this._rsStencilPreloadPass=this._vaSwap=this._uniformMap=this._spPick=this._spStencil=this._sp=this._va=void 0;this._commands=[];this._commandsIgnoreShow=[];this._pickCommands=[];this._highlightColor=this._constantColor=a.clone(a.WHITE);this._pickCommandsDirty=this._batchDirty=!0;this._framesSinceLastRebatch=0;this._updatingAllCommands=!1;this._trianglesLength=this._indices.length/3;this._geometryByteLength=this._indices.byteLength+this._positions.byteLength+this._vertexBatchIds.byteLength;this.forceRebatch=this._wireframeDirty=this._debugWireframe=this.debugWireframe=!1;this.classificationType=k(c.classificationType,B.BOTH);this._vertexShaderSource=c._vertexShaderSource;this._fragmentShaderSource=c._fragmentShaderSource;this._attributeLocations=c._attributeLocations;this._uniformMap=c._uniformMap;this._pickId=c._pickId;this._modelMatrix=c._modelMatrix;this._boundingSphere=c._boundingSphere;this._batchIdLookUp={};c=this._batchIds.length;for(var d=0;d<c;++d)this._batchIdLookUp[this._batchIds[d]]=d}function L(a){a=a?J.EQUAL:J.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:a,frontOperation:{fail:w.KEEP,zFail:w.DECREMENT_WRAP,zPass:w.DECREMENT_WRAP},backFunction:a,backOperation:{fail:w.KEEP,zFail:w.INCREMENT_WRAP,zPass:w.INCREMENT_WRAP},reference:H.CESIUM_3D_TILE_MASK,mask:H.CESIUM_3D_TILE_MASK},stencilMask:H.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1}}function K(a){a=a?J.EQUAL:J.ALWAYS;return{colorMask:{red:!1,green:!1,blue:!1,alpha:!1},stencilTest:{enabled:!0,frontFunction:a,frontOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.INCREMENT_WRAP},backFunction:a,backOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.DECREMENT_WRAP},reference:H.CESIUM_3D_TILE_MASK,mask:H.CESIUM_3D_TILE_MASK},stencilMask:H.CLASSIFICATION_MASK,depthTest:{enabled:!0,func:C.LESS_OR_EQUAL},depthMask:!1}}function P(a,b){g(a._uniformMap)||(a._uniformMap=a._batchTable.getUniformMapCallback()({u_modifiedModelViewProjection:function(){var c=b.uniformState.projection;h.clone(b.uniformState.view,R);h.multiplyByPoint(R,a._center,Y);h.setTranslation(R,Y,R);h.multiply(c,R,R);return R},u_highlightColor:function(){return a._highlightColor}}))}function F(a,b,c,d,e,f,g){for(var h=a.constructor.BYTES_PER_ELEMENT,k=f.length,l=0;l<k;++l){var m=g[f[l]],p=e[m],q=new a.constructor(a.buffer,h*d[m],p);b.set(q,c);d[m]=c;c+=p}return c}function O(a,b,c,d,e,f,g){for(var h=a.bytesPerIndex,k=f.length,l=0;l<k;++l){var m=g[f[l]],p=e[m];b.copyFromBuffer(a,d[m]*h,c*h,p*h);d[m]=c;c+=p}return c}function Z(a,b){return b.color.toRgba()-a.color.toRgba()}function aa(a,b,c,d){var e=a.classificationType;a=e!==B.CESIUM_3D_TILE;var e=e!==B.TERRAIN,f=b.commandList,h=c.length,k,l;for(l=0;l<h;++l)a&&(k=c[l],k.pass=r.TERRAIN_CLASSIFICATION,f.push(k)),e&&(k=c[l].derivedCommands.tileset,k.pass=r.CESIUM_3D_TILE_CLASSIFICATION,f.push(k));if(b.invertClassification&&g(d))for(h=d.length,l=0;l<h;++l)f.push(d[l])}l(E.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}}});var U={position:0,a_batchId:1},W={stencilTest:{enabled:!0,frontFunction:J.NOT_EQUAL,frontOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.DECREMENT_WRAP},backFunction:J.NOT_EQUAL,backOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.DECREMENT_WRAP},reference:0,mask:H.CLASSIFICATION_MASK},stencilMask:H.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1,blending:D.ALPHA_BLEND},M={stencilTest:{enabled:!0,frontFunction:J.NOT_EQUAL,frontOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.DECREMENT_WRAP},backFunction:J.NOT_EQUAL,backOperation:{fail:w.KEEP,zFail:w.KEEP,zPass:w.DECREMENT_WRAP},reference:0,mask:H.CLASSIFICATION_MASK},stencilMask:H.CLASSIFICATION_MASK,depthTest:{enabled:!1},depthMask:!1},R=new h,Y=new b;E.prototype.createFeatures=function(a,b){for(var c=this._batchIds,d=c.length,e=0;e<d;++e){var f=c[e];b[f]=new v(a,f)}};E.prototype.applyDebugSettings=function(a,b){this._highlightColor=a?b:this._constantColor};var Q=new a,S=a.WHITE,ca=/\$/;E.prototype.applyStyle=function(b,c){if(g(b)){var d=b.color,e=d instanceof I&&!ca.test(d.expression);this._updatingAllCommands=e;var f=this._batchIds,d=f.length,h;for(h=0;h<d;++h){var k=c[f[h]];k.color=g(b.color)?b.color.evaluateColor(k,Q):S;k.show=g(b.show)?b.show.evaluate(k):!0}if(e){e=this._batchedIndices;d=e.length;for(h=0;h<d;++h)e[h].color=a.clone(a.WHITE);this._updatingAllCommands=!1;this._batchDirty=!0}}else{this._updatingAllCommands=!0;e=this._batchIds;d=e.length;for(h=0;h<d;++h)f=c[e[h]],f.show=!0,f.color=a.WHITE;e=this._batchedIndices;d=e.length;for(h=0;h<d;++h)e[h].color=a.clone(a.WHITE);this._updatingAllCommands=!1;this._batchDirty=!0}};E.prototype.updateCommands=function(b,c){if(!this._updatingAllCommands){var d=this._batchIdLookUp,e=d[b];if(g(e)){var f=this._indexOffsets,h=f[e],e=this._indexCounts[e],k=this._batchedIndices,l=k.length,m;for(m=0;m<l;++m){var p=k[m].offset,q=k[m].count;if(h>=p&&h<p+q)break}k.push(new G({color:a.clone(c),offset:h,count:e,batchIds:[b]}));for(var l=[],p=[],q=k[m].batchIds,r=q.length,t=0;t<r;++t){var w=q[t];w!==b&&(f[d[w]]<h?l.push(w):p.push(w))}0!==p.length&&k.push(new G({color:a.clone(k[m].color),offset:h+e,count:k[m].offset+k[m].count-(h+e),batchIds:p}));0!==l.length?(k[m].count=h-k[m].offset,k[m].batchIds=l):k.splice(m,1);this._batchDirty=!0}}};E.prototype.update=function(b){var l=b.context;if(!g(this._va)){var m=d.createVertexBuffer({context:l,typedArray:this._positions,usage:q.STATIC_DRAW}),w=d.createVertexBuffer({context:l,typedArray:this._vertexBatchIds,usage:q.STATIC_DRAW}),v=d.createIndexBuffer({context:l,typedArray:this._indices,usage:q.DYNAMIC_DRAW,indexDatatype:2===this._indices.BYTES_PER_ELEMENT?e.UNSIGNED_SHORT:e.UNSIGNED_INT}),m=[{index:0,vertexBuffer:m,componentDatatype:f.fromTypedArray(this._positions),componentsPerAttribute:3},{index:1,vertexBuffer:w,componentDatatype:f.fromTypedArray(this._vertexBatchIds),componentsPerAttribute:1}];this._va=new A({context:l,attributes:m,indexBuffer:v});l.webgl2&&(this._vaSwap=new A({context:l,attributes:m,indexBuffer:d.createIndexBuffer({context:l,sizeInBytes:v.sizeInBytes,usage:q.DYNAMIC_DRAW,indexDatatype:v.indexDatatype})}));this._verticesPromise=this._vertexBatchIds=this._transferrableBatchIds=this._batchedPositions=void 0}if(!g(this._sp)){var E=this._batchTable,v=k(this._attributeLocations,U),m=this._pickId,w=this._vertexShaderSource,C=this._fragmentShaderSource;if(g(w))this._spStencil=this._sp=u.fromCache({context:l,vertexShaderSource:w,fragmentShaderSource:C,attributeLocations:v}),C=y.replaceMain(C,"czm_non_pick_main"),this._spPick=u.fromCache({context:l,vertexShaderSource:w,fragmentShaderSource:C+"void main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor \x3d "+m+"; \n} \n",attributeLocations:v});else{var C=E.getVertexShaderCallback(!1,"a_batchId",void 0)(x),w=E.getFragmentShaderCallback()(z,!1,void 0),m=E.getPickId(),E=new y({sources:[C]}),G=new y({defines:["VECTOR_TILE"],sources:[w]});this._sp=u.fromCache({context:l,vertexShaderSource:E,fragmentShaderSource:G,attributeLocations:v});E=new y({sources:[x]});G=new y({defines:["VECTOR_TILE"],sources:[z]});this._spStencil=u.fromCache({context:l,vertexShaderSource:E,fragmentShaderSource:G,attributeLocations:v});w=y.replaceMain(w,"czm_non_pick_main");w=w+"\nvoid main() \n{ \n    czm_non_pick_main(); \n    gl_FragColor \x3d "+m+"; \n} \n";m=new y({sources:[C]});w=new y({defines:["VECTOR_TILE"],sources:[w]});this._spPick=u.fromCache({context:l,vertexShaderSource:m,fragmentShaderSource:w,attributeLocations:v})}}g(this._rsStencilPreloadPass)||(this._rsStencilPreloadPass=c.fromCache(L(!1)),this._rsStencilPreloadPass3DTiles=c.fromCache(L(!0)),this._rsStencilDepthPass=c.fromCache(K(!1)),this._rsStencilDepthPass3DTiles=c.fromCache(K(!0)),this._rsColorPass=c.fromCache(W),this._rsPickPass=c.fromCache(M));P(this,l);v=b.passes;if(v.render){if(this._batchDirty){m=this._batchedIndices;w=m.length;E=!1;C={};for(G=0;G<w;++G){var D=m[G].color.toRgba();if(g(C[D])){E=!0;break}else C[D]=!0}if(E)if(E&&!this.forceRebatch&&120>this._framesSinceLastRebatch)++this._framesSinceLastRebatch,E=void 0;else{m.sort(Z);if(l.webgl2){var w=this._indexOffsets,E=this._indexCounts,C=this._batchIdLookUp,H=m.pop(),l=[H],G=this._va.indexBuffer,D=this._vaSwap.indexBuffer,I=O(G,D,0,w,E,H.batchIds,C);H.offset=0;for(H.count=I;0<m.length;){var J=m.pop();a.equals(J.color,H.color)?(I=O(G,D,I,w,E,J.batchIds,C),H.batchIds=H.batchIds.concat(J.batchIds),H.count=I-H.offset):(H=I,I=O(G,D,I,w,E,J.batchIds,C),J.offset=H,J.count=I-H,l.push(J),H=J)}m=this._va;this._va=this._vaSwap;this._vaSwap=m;this._batchedIndices=l}else{l=this._indices;w=this._indexOffsets;E=this._indexCounts;C=this._batchIdLookUp;G=new l.constructor(l.length);H=m.pop();D=[H];I=F(l,G,0,w,E,H.batchIds,C);H.offset=0;for(H.count=I;0<m.length;)J=m.pop(),a.equals(J.color,H.color)?(I=F(l,G,I,w,E,J.batchIds,C),H.batchIds=H.batchIds.concat(J.batchIds),H.count=I-H.offset):(H=I,I=F(l,G,I,w,E,J.batchIds,C),J.offset=H,J.count=I-H,D.push(J),H=J);this._va.indexBuffer.copyFromArrayView(G);this._indices=G;this._batchedIndices=D}this._framesSinceLastRebatch=0;this._batchDirty=!1;E=this._wireframeDirty=this._pickCommandsDirty=!0}else E=this._batchDirty=!1}else E=!1;m=this._commands;l=this._batchedIndices;w=l.length;C=3*w;if(!g(m)||E||m.length!==C){m.length=C;E=this._va;C=this._sp;G=k(this._modelMatrix,h.IDENTITY);D=this._uniformMap;I=this._boundingVolume;for(J=0;J<w;++J){var H=l[J].offset,R=l[J].count,Q=m[3*J];g(Q)||(Q=m[3*J]=new t({owner:this}));Q.vertexArray=E;Q.modelMatrix=G;Q.offset=H;Q.count=R;Q.renderState=this._rsStencilPreloadPass;Q.shaderProgram=C;Q.uniformMap=D;Q.boundingVolume=I;Q.cull=!1;Q.pass=r.TERRAIN_CLASSIFICATION;var N=t.shallowClone(Q,Q.derivedCommands.tileset);N.renderState=this._rsStencilPreloadPass3DTiles;N.pass=r.CESIUM_3D_TILE_CLASSIFICATION;Q.derivedCommands.tileset=N;Q=m[3*J+1];g(Q)||(Q=m[3*J+1]=new t({owner:this}));Q.vertexArray=E;Q.modelMatrix=G;Q.offset=H;Q.count=R;Q.renderState=this._rsStencilDepthPass;Q.shaderProgram=C;Q.uniformMap=D;Q.boundingVolume=I;Q.cull=!1;Q.pass=r.TERRAIN_CLASSIFICATION;N=t.shallowClone(Q,Q.derivedCommands.tileset);N.renderState=this._rsStencilDepthPass3DTiles;N.pass=r.CESIUM_3D_TILE_CLASSIFICATION;Q.derivedCommands.tileset=N;Q=m[3*J+2];g(Q)||(Q=m[3*J+2]=new t({owner:this}));Q.vertexArray=E;Q.modelMatrix=G;Q.offset=H;Q.count=R;Q.renderState=this._rsColorPass;Q.shaderProgram=C;Q.uniformMap=D;Q.boundingVolume=I;Q.cull=!1;Q.pass=r.TERRAIN_CLASSIFICATION;H=t.shallowClone(Q,Q.derivedCommands.tileset);H.pass=r.CESIUM_3D_TILE_CLASSIFICATION;Q.derivedCommands.tileset=H}this._commandsDirty=!0}if(this.classificationType!==B.TERRAIN&&b.invertClassification&&(!g(this._commandsIgnoreShow)||this._commandsDirty)){m=this._commands;l=this._commandsIgnoreShow;w=this._spStencil;E=l.length=m.length/3*2;for(G=C=0;G<E;G+=2)D=l[G]=t.shallowClone(m[C],l[G]),D.shaderProgram=w,D.pass=r.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,D=l[G+1]=t.shallowClone(m[C+1],l[G+1]),D.shaderProgram=w,D.pass=r.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW,C+=3;this._commandsDirty=!1}m=(m=this.debugWireframe===this._debugWireframe)&&!(this.debugWireframe&&this._wireframeDirty);if(!m){g(this._rsWireframe)||(this._rsWireframe=c.fromCache({}));this.debugWireframe?(m=this._rsWireframe,l=p.LINES):(m=this._rsColorPass,l=p.TRIANGLES);w=this._commands;E=w.length;for(C=0;C<E;C+=3)G=w[C+2],G.renderState=m,G.primitiveType=l;this._debugWireframe=this.debugWireframe;this._wireframeDirty=!1}if(this._debugWireframe)for(m=this._commands,l=b.commandList,w=m.length,E=0;E<w;E+=3)C=m[E+2],C.pass=r.OPAQUE,l.push(C);else aa(this,b,this._commands,this._commandsIgnoreShow)}if(v.pick){if(this._pickCommandsDirty){v=this._indexOffsets.length;m=this._pickCommands;m.length=3*v;l=this._va;w=this._spStencil;E=this._spPick;C=k(this._modelMatrix,h.IDENTITY);G=this._uniformMap;for(D=0;D<v;++D)I=this._indexOffsets[D],J=this._indexCounts[D],H=g(this._boundingVolumes)?this._boundingVolumes[D]:this.boundingVolume,R=m[3*D],g(R)||(R=m[3*D]=new t({owner:this,pickOnly:!0})),R.vertexArray=l,R.modelMatrix=C,R.offset=I,R.count=J,R.renderState=this._rsStencilPreloadPass,R.shaderProgram=w,R.uniformMap=G,R.boundingVolume=H,R.pass=r.TERRAIN_CLASSIFICATION,Q=t.shallowClone(R,R.derivedCommands.tileset),Q.renderState=this._rsStencilPreloadPass3DTiles,Q.pass=r.CESIUM_3D_TILE_CLASSIFICATION,R.derivedCommands.tileset=Q,R=m[3*D+1],g(R)||(R=m[3*D+1]=new t({owner:this,pickOnly:!0})),R.vertexArray=l,R.modelMatrix=C,R.offset=I,R.count=J,R.renderState=this._rsStencilDepthPass,R.shaderProgram=w,R.uniformMap=G,R.boundingVolume=H,R.pass=r.TERRAIN_CLASSIFICATION,Q=t.shallowClone(R,R.derivedCommands.tileset),Q.renderState=this._rsStencilDepthPass3DTiles,Q.pass=r.CESIUM_3D_TILE_CLASSIFICATION,R.derivedCommands.tileset=Q,R=m[3*D+2],g(R)||(R=m[3*D+2]=new t({owner:this,pickOnly:!0})),R.vertexArray=l,R.modelMatrix=C,R.offset=I,R.count=J,R.renderState=this._rsPickPass,R.shaderProgram=E,R.uniformMap=G,R.boundingVolume=H,R.pass=r.TERRAIN_CLASSIFICATION,I=t.shallowClone(R,R.derivedCommands.tileset),I.pass=r.CESIUM_3D_TILE_CLASSIFICATION,R.derivedCommands.tileset=I;this._pickCommandsDirty=!1}aa(this,b,this._pickCommands)}};E.prototype.isDestroyed=function(){return!1};E.prototype.destroy=function(){this._va=this._va&&this._va.destroy();this._sp=this._sp&&this._sp.destroy();this._spPick=this._spPick&&this._spPick.destroy();this._vaSwap=this._vaSwap&&this._vaSwap.destroy();return m(this)};return E});F("Scene/ClassificationModel","../Core/arraySlice ../Core/BoundingSphere ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/FeatureDetection ../Core/IndexDatatype ../Core/Matrix4 ../Core/PrimitiveType ../Core/RuntimeError ../Core/Transforms ../Core/WebGLConstants ../ThirdParty/GltfPipeline/addDefaults ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/GltfPipeline/getAccessorByteStride ../ThirdParty/GltfPipeline/numberOfComponentsForType ../ThirdParty/GltfPipeline/parseGlb ../ThirdParty/GltfPipeline/updateVersion ../ThirdParty/when ./Axis ./ClassificationType ./ModelLoadResources ./ModelUtility ./processModelMaterialsCommon ./processPbrMaterials ./SceneMode ./Vector3DTileBatch ./Vector3DTilePrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,F,N,O){function P(b){b=e(b,e.EMPTY_OBJECT);var d=b.gltf;d instanceof ArrayBuffer&&(d=new Uint8Array(d));if(d instanceof Uint8Array)d=C(d),I(d),x(d),L(d),K(d);else throw new y("Only binary glTF is supported as a classifier.");D.buffer(d,function(a){if(!h(a.extras._pipeline.source))throw new y("Buffer data must be embedded in the binary gltf.");});var f=d.nodes,g=d.meshes,k=f[0].mesh;if(1!==f.length||!h(k))throw new y("Only one node is supported for classification and it must have a mesh.");if(1!==g.length)throw new y("Only one mesh is supported when using b3dm for classification.");f=g[0].primitives;if(1!==f.length)throw new y("Only one primitive per mesh is supported when using b3dm for classification.");if(!h(f[0].attributes.POSITION))throw new y("The mesh must have a position attribute.");if(!h(f[0].attributes._BATCHID))throw new y("The mesh must have a batch id attribute.");this._gltf=d;this.show=e(b.show,!0);this.modelMatrix=c.clone(e(b.modelMatrix,c.IDENTITY));this._modelMatrix=c.clone(this.modelMatrix);this._ready=!1;this._readyPromise=H.defer();this.debugShowBoundingVolume=e(b.debugShowBoundingVolume,!1);this._debugShowBoundingVolume=!1;this.debugWireframe=e(b.debugWireframe,!1);this._debugWireframe=!1;this._classificationType=b.classificationType;this._vertexShaderLoaded=b.vertexShaderLoaded;this._classificationShaderLoaded=b.classificationShaderLoaded;this._uniformMapLoaded=b.uniformMapLoaded;this._pickIdLoaded=b.pickIdLoaded;this._ignoreCommands=e(b.ignoreCommands,!1);this._upAxis=e(b.upAxis,J.Y);this._batchTable=b.batchTable;this._computedModelMatrix=new c;this._boundingSphere=this._initialRadius=void 0;this._scaledBoundingSphere=new a;this._state=ca.NEEDS_LOAD;this._mode=this._loadResources=void 0;this._dirty=!1;this._nodeMatrix=new c;this._quantizedUniforms=this._extensionsRequired=this._extensionsUsed=this._primitive=void 0;this._buffers={};this._uniformMap=this._shaderProgram=this._vertexArray=void 0;this._trianglesLength=this._geometryByteLength=0;this._rtcCenter2D=this._rtcCenter3D=this._rtcCenterEye=this._rtcCenter=void 0}function aa(a){var b=a._loadResources;D.buffer(a.gltf,function(a,c){b.buffers[c]=a.extras._pipeline.source})}function U(a){var b=a.gltf.bufferViews,c=a._loadResources.vertexBuffersToCreate;D.bufferView(a.gltf,function(a,b){a.target===z.ARRAY_BUFFER&&c.enqueue(b)});var d=a._loadResources.indexBuffersToCreate,e={};D.accessor(a.gltf,function(a){var c=a.bufferView;b[c].target!==z.ELEMENT_ARRAY_BUFFER||h(e[c])||(e[c]=!0,d.enqueue({id:c,componentType:a.componentType}))})}function W(a,b){h(b)&&(a=b(a));return a}function M(a){if(a._loadResources.finishedBuffersCreation()&&!h(a._vertexArray)){var b=a._buffers,c=a.gltf,d=c.accessors,e=c.meshes[0].primitives[0],f={POSITION:0,_BATCHID:1},g={};D.meshPrimitiveAttribute(e,function(a,e){var k=f[e];if(h(k)){var l=d[a];g[e]={index:k,vertexBuffer:b[l.bufferView],componentsPerAttribute:B(l.type),componentDatatype:l.componentType,offsetInBytes:l.byteOffset,strideInBytes:v(c,l)}}});var k;h(e.indices)&&(k=b[d[e.indices].bufferView]);a._vertexArray={attributes:g,indexBuffer:k}}}function R(a,b){if(!h(a._uniformMap)){var c={};D.technique(a.gltf,function(d){D.techniqueUniform(d,function(d,e){h(d.semantic)&&h(T[d.semantic])&&(c[e]=T[d.semantic](b.uniformState,a))})});a._uniformMap=c}}function Y(d,e){var k=e.context;E.checkSupportedGlExtensions(d.gltf.glExtensionsUsed,k);var p=d._loadResources;if(0===p.pendingBufferLoads){for(var q=p.vertexBuffersToCreate,p=p.indexBuffersToCreate;0<q.length;){var t=q.dequeue(),w=d,v=w._loadResources.getBuffer(w.gltf.bufferViews[t]);w._buffers[t]=v;w._geometryByteLength+=v.byteLength}for(;0<p.length;)t=p.dequeue(),q=t.id,w=t.componentType,t=d,w={typedArray:t._loadResources.getBuffer(t.gltf.bufferViews[q]),indexDatatype:w},t._buffers[q]=w,t._geometryByteLength+=w.typedArray.byteLength}w=d.gltf;q=E.getAttributeOrUniformBySemantic(w,"POSITION");t=E.getAttributeOrUniformBySemantic(w,"_BATCHID");p={};p[q]=0;p[t]=1;var y=E.getAttributeOrUniformBySemantic(w,"MODELVIEWPROJECTION");if(h(y))v="uniform mat4 "+y+";\n",w=y+" * vec4("+q+", 1.0)";else{var y=E.getAttributeOrUniformBySemantic(w,"PROJECTION"),z=E.getAttributeOrUniformBySemantic(w,"MODELVIEW");h(z)||(z=E.getAttributeOrUniformBySemantic(w,"CESIUM_RTC_MODELVIEW"));v="uniform mat4 "+z+";\nuniform mat4 "+y+";\n";w=y+" * "+z+" * vec4("+q+", 1.0)"}q="attribute vec3 "+q+";\nattribute float "+t+";\n"+v+"void main() {\n"+("    vec4 positionInClipCoords \x3d "+w+";\n")+"    gl_Position \x3d czm_depthClampFarPlane(positionInClipCoords);\n}\n";d.extensionsUsed.WEB3D_quantized_attributes&&(q=E.modifyShaderForQuantizedAttributes(d.gltf,d.gltf.meshes[0].primitives[0],q),d._quantizedUniforms=q.uniforms,q=q.shader);q=W(q,d._vertexShaderLoaded);t=W("#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\nvoid main() \n{ \n    gl_FragColor \x3d vec4(1.0); \n    czm_writeDepthClampedToFarPlane();\n}\n",d._classificationShaderLoaded);q=E.modifyVertexShaderForLogDepth(q,w);t=E.modifyFragmentShaderForLogDepth(t);d._shaderProgram={vertexShaderSource:q,fragmentShaderSource:t,attributeLocations:p};M(d);R(d,k);if(d._loadResources.finished()&&!h(d._primitive)){d._nodeMatrix=E.getTransform(d.gltf.nodes[0],d._nodeMatrix);k=d._batchTable;p=d._uniformMap;v=d._vertexArray;q=d.gltf;y=q.accessors;t=q.meshes[0].primitives[0];w=y[t.indices];q=E.getAccessorMinMax(q,t.attributes.POSITION);q=a.fromCornerPoints(f.fromArray(q.min),f.fromArray(q.max));h(w)?(y=w.count,z=w.byteOffset/r.getSizeInBytes(w.componentType)):(y=y[t.attributes.POSITION].count,z=0);var w=d._trianglesLength,C;b:switch(t.mode){case u.TRIANGLES:C=y/3;break b;case u.TRIANGLE_STRIP:case u.TRIANGLE_FAN:C=Math.max(y-2,0);break b;default:C=0}d._trianglesLength=w+C;h(d._uniformMapLoaded)&&(p=d._uniformMapLoaded(p));d.extensionsUsed.WEB3D_quantized_attributes&&(t=E.createUniformsForQuantizedAttributes(d.gltf,t,d._quantizedUniforms),p=l(p,t));C=v.attributes.POSITION;w=C.componentDatatype;C=C.vertexBuffer;var A=C.byteOffset,G=C.byteLength/m.getSizeInBytes(w),t=m.createArrayBufferView(w,C.buffer,A,G);C=v.attributes._BATCHID;w=C.componentDatatype;C=C.vertexBuffer;A=C.byteOffset;G=C.byteLength/m.getSizeInBytes(w);w=m.createArrayBufferView(w,C.buffer,A,G);C=v.indexBuffer.typedArray;v=v.indexBuffer.indexDatatype===r.UNSIGNED_SHORT?new Uint16Array(C.buffer,C.byteOffset,C.byteLength/Uint16Array.BYTES_PER_ELEMENT):new Uint32Array(C.buffer,C.byteOffset,C.byteLength/Uint32Array.BYTES_PER_ELEMENT);t=b(t);w=b(w);v=b(v,z,z+y);y=[];z=[];C=[];A=[];G=w[v[0]];y.push(G);C.push(0);for(var B,D,x,H=v.length,K=1;K<H;++K)B=w[v[K]],B!==G&&(D=C[C.length-1],x=K-D,y.push(B),z.push(x),C.push(K),A.push(new N({offset:D,count:x,batchIds:[G],color:g.WHITE})),G=B);D=C[C.length-1];x=H-D;z.push(x);A.push(new N({offset:D,count:x,batchIds:[G],color:g.WHITE}));D=d._shaderProgram;G=D.vertexShaderSource;B=D.fragmentShaderSource;D=D.attributeLocations;x=h(d._pickIdLoaded)?d._pickIdLoaded():void 0;d._primitive=new O({classificationType:d._classificationType,positions:t,indices:v,indexOffsets:C,indexCounts:z,batchIds:y,vertexBatchIds:w,batchedIndices:A,batchTable:k,boundingVolume:new a,_vertexShaderSource:G,_fragmentShaderSource:B,_attributeLocations:D,_uniformMap:p,_pickId:x,_modelMatrix:new c,_boundingSphere:q});d._buffers=void 0;d._vertexArray=void 0;d._shaderProgram=void 0;d._uniformMap=void 0}}function Q(b,d,e,g){var l=b._computedModelMatrix;if(b._mode!==F.SCENE3D&&!b._ignoreCommands){var m=c.getColumn(l,3,da);k.equals(m,k.UNIT_W)?(g=A.wgs84To2DModelMatrix(g,b.boundingSphere.center,V),l=c.multiply(g,l,V),h(b._rtcCenter)&&(c.setTranslation(l,k.UNIT_W,l),b._rtcCenter=b._rtcCenter2D)):(l=A.basisTo2D(g,l,V),b._rtcCenter=b._rtcCenter3D)}g=b._primitive;if(d||e)c.multiplyTransformation(l,b._nodeMatrix,g._modelMatrix),a.transform(g._boundingSphere,g._modelMatrix,g._boundingVolume),h(b._rtcCenter)&&f.add(b._rtcCenter,g._boundingVolume.center,g._boundingVolume.center)}if(!t.supportsTypedArrays())return{};var S=new f,ca=E.ModelState;p(P.prototype,{gltf:{get:function(){return this._gltf}},boundingSphere:{get:function(){if(this._state!==ca.LOADED)throw new q("The model is not loaded.  Use ClassificationModel.readyPromise or wait for ClassificationModel.ready to be true.");var a=c.getScale(this.modelMatrix,S),b=this._scaledBoundingSphere;b.center=f.multiplyComponents(this._boundingSphere.center,a,b.center);b.radius=f.maximumComponent(a)*this._initialRadius;h(this._rtcCenter)&&f.add(this._rtcCenter,b.center,b.center);return b}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},dirty:{get:function(){return this._dirty}},extensionsUsed:{get:function(){h(this._extensionsUsed)||(this._extensionsUsed=E.getUsedExtensions(this.gltf));return this._extensionsUsed}},extensionsRequired:{get:function(){h(this._extensionsRequired)||(this._extensionsRequired=E.getRequiredExtensions(this.gltf));return this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return 0}},classificationType:{get:function(){return this._classificationType}}});var T={PROJECTION:function(a,b){return E.getGltfSemanticUniforms().PROJECTION(a,b)},MODELVIEW:function(a,b){return E.getGltfSemanticUniforms().MODELVIEW(a,b)},CESIUM_RTC_MODELVIEW:function(a,b){return E.getGltfSemanticUniforms().CESIUM_RTC_MODELVIEW(a,b)},MODELVIEWPROJECTION:function(a,b){return E.getGltfSemanticUniforms().MODELVIEWPROJECTION(a,b)}},da=new k,V=new c;P.prototype.updateCommands=function(a,b){this._primitive.updateCommands(a,b)};P.prototype.update=function(a){if(a.mode!==F.MORPHING)if(t.supportsWebP.initialized){var b=t.supportsWebP();if(this._state===ca.NEEDS_LOAD&&h(this.gltf)&&(this._state=ca.LOADING,this._state!==ca.FAILED)){var d=this.gltf.extensions;if(h(d)&&h(d.CESIUM_RTC)&&(d=f.fromArray(d.CESIUM_RTC.center),!f.equals(d,f.ZERO))){this._rtcCenter3D=d;var d=a.mapProjection,e=d.ellipsoid.cartesianToCartographic(this._rtcCenter3D),d=d.project(e);f.fromElements(d.z,d.x,d.y,d);this._rtcCenter2D=d;this._rtcCenterEye=new f;this._rtcCenter=this._rtcCenter3D}this._loadResources=new G;E.parseBuffers(this)}e=this._loadResources;d=!1;this._state===ca.LOADING&&(0===e.pendingBufferLoads&&(E.checkSupportedExtensions(this.extensionsRequired,b),aa(this),U(this),this._boundingSphere=E.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,Y(this,a)),e.finished()&&(this._state=ca.LOADED,d=!0));h(e)&&this._state===ca.LOADED&&(d||Y(this,a),e.finished()&&(this._loadResources=void 0));if((b=this.show)&&this._state===ca.LOADED||d){this._dirty=!1;var e=this.modelMatrix,g=a.mode!==this._mode;this._mode=a.mode;if((g=!c.equals(this._modelMatrix,e)||g)||d){c.clone(e,this._modelMatrix);var k=this._computedModelMatrix;c.clone(e,k);this._upAxis===J.Y?c.multiplyTransformation(k,J.Y_UP_TO_Z_UP,k):this._upAxis===J.X&&c.multiplyTransformation(k,J.X_UP_TO_Z_UP,k)}if(g||d)Q(this,g,d,a.mapProjection),this._dirty=!0}if(d){var l=this;a.afterRender.push(function(){l._ready=!0;l._readyPromise.resolve(l)})}else b&&!this._ignoreCommands&&(this._primitive.debugShowBoundingVolume=this.debugShowBoundingVolume,this._primitive.debugWireframe=this.debugWireframe,this._primitive.update(a))}else t.supportsWebP.initialize()};P.prototype.isDestroyed=function(){return!1};P.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();return d(this)};return P});F("Scene/Batched3DModel3DTileContent","../Core/Cartesian3 ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/DeveloperError ../Core/FeatureDetection ../Core/getStringFromTypedArray ../Core/Matrix4 ../Core/RequestType ../Core/RuntimeError ../Core/Transforms ../Renderer/Pass ./Axis ./Cesium3DTileBatchTable ./Cesium3DTileFeature ./Cesium3DTileFeatureTable ./ClassificationModel ./Model ./ModelUtility".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a,c,e,h,l){this._tileset=a;this._tile=c;this._resource=e;this._batchIdAttributeName=this._features=this._batchTable=this._model=void 0;this._diffuseAttributeOrUniformName={};this._contentModelMatrix=this._rtcCenterTransform=void 0;this.featurePropertiesDirty=!1;a=this._tileset;c=this._tile;e=this._resource;var m=k(l,0);l=m;var p=new Uint8Array(h),z=new DataView(h);l+=E;var B=z.getUint32(l,!0);if(1!==B)throw new r("Only Batched 3D Model version 1 is supported.  Version "+B+" is not.");l+=E;B=z.getUint32(l,!0);l+=E;var L=z.getUint32(l,!0);l+=E;var K=z.getUint32(l,!0);l+=E;var O=z.getUint32(l,!0);l+=E;z=z.getUint32(l,!0);l+=E;var F;570425344<=O?(l-=2*E,F=L,O=K,K=L=z=0,C._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchLength] [batchTableByteLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/Batched3DModel.")):570425344<=z&&(l-=E,F=O,O=L,z=K,K=L=0,C._deprecationWarning("b3dm-legacy-header","This b3dm header is using the legacy format [batchTableJsonByteLength] [batchTableBinaryByteLength] [batchLength]. The new format is [featureTableJsonByteLength] [featureTableBinaryByteLength] [batchTableJsonByteLength] [batchTableBinaryByteLength] from https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/TileFormats/Batched3DModel."));0===L?F={BATCH_LENGTH:k(F,0)}:(F=d(p,l,L),F=JSON.parse(F),l+=L);L=new Uint8Array(h,l,K);l+=K;K=new x(F,L);F=K.getGlobalProperty("BATCH_LENGTH");K.featuresLength=F;var P,N;0<O&&(P=d(p,l,O),P=JSON.parse(P),l+=O,0<z&&(N=new Uint8Array(h,l,z),N=new Uint8Array(N),l+=z));var Z;g(a.classificationType)&&(Z=G(this));this._batchTable=N=new A(this,F,P,N,Z);N._initAnimation=a.initAnimation;N._effectType=a.effectType;N._time=a.time;N._dataType=a.dataType;Z=m+B-l;if(0===Z)throw new r("glTF byte length must be greater than 0.");0===l%4?h=new Uint8Array(h,l,Z):(C._deprecationWarning("b3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),h=new Uint8Array(p.subarray(l,l+Z)));Z={content:this,primitive:a};this._rtcCenterTransform=q.IDENTITY;P=K.getGlobalProperty("RTC_CENTER",f.FLOAT,3);g(P)&&(this._rtcCenterTransform=q.fromTranslation(b.fromArray(P)));this._contentModelMatrix=q.multiply(c.computedTransform,this._rtcCenterTransform,new q);g(a.classificationType)?this._model=new D({gltf:h,cull:!1,basePath:e,requestType:t.TILES3D,modelMatrix:this._contentModelMatrix,upAxis:a._gltfUpAxis,forwardAxis:y.X,debugWireframe:a.debugWireframe,vertexShaderLoaded:I(this),classificationShaderLoaded:w(this),uniformMapLoaded:N.getUniformMapCallback(),pickIdLoaded:J(this),classificationType:a._classificationType,batchTable:N}):this._model=new v({gltf:h,cull:!1,releaseGltfJson:!0,opaquePass:u.CESIUM_3D_TILE,basePath:e,requestType:t.TILES3D,modelMatrix:this._contentModelMatrix,upAxis:a._gltfUpAxis,forwardAxis:y.X,shadows:a.shadows,debugWireframe:a.debugWireframe,incrementallyLoadTextures:!1,vertexShaderLoaded:I(this),fragmentShaderLoaded:H(this),uniformMapLoaded:N.getUniformMapCallback(),pickIdLoaded:J(this),addBatchIdToGeneratedShaders:0<F,pickObject:Z,imageBasedLightingFactor:a.imageBasedLightingFactor,lightColor:a.lightColor,luminanceAtZenith:a.luminanceAtZenith,sphericalHarmonicCoefficients:a.sphericalHarmonicCoefficients,specularEnvironmentMaps:a.specularEnvironmentMaps})}function I(a){return function(b,c){var d=a._batchTable,e=!g(a._tileset.classificationType),f=a._model.gltf;if(g(f)){var h=B.getAttributeOrUniformBySemantic(f,"_BATCHID");g(h)||(h=B.getAttributeOrUniformBySemantic(f,"BATCHID"),g(h)&&C._deprecationWarning("b3dm-legacy-batchid","The glTF in this b3dm uses the semantic `BATCHID`. Application-specific semantics should be prefixed with an underscore: `_BATCHID`."));a._batchIdAttributeName=h;a._diffuseAttributeOrUniformName[c]=B.getDiffuseAttributeOrUniform(f,c)}d=d.getVertexShaderCallback(e,a._batchIdAttributeName,a._diffuseAttributeOrUniformName[c]);return g(d)?d(b):b}}function H(a){return function(b,c){var d=a._batchTable,e=!g(a._tileset.classificationType),f=a._model.gltf;g(f)&&(a._diffuseAttributeOrUniformName[c]=B.getDiffuseAttributeOrUniform(f,c));d=d.getFragmentShaderCallback(e,a._diffuseAttributeOrUniformName[c]);return g(d)?d(b):b}}function J(a){return function(){return a._batchTable.getPickId()}}function w(a){return function(b){var c=a._batchTable.getClassificationFragmentShaderCallback();return g(c)?c(b):b}}function G(a){return function(b,c){a._model.updateCommands(b,c)}}if(!p.supportsTypedArrays())return{};C._deprecationWarning=m;l(C.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return this._model.trianglesLength}},geometryByteLength:{get:function(){return this._model.geometryByteLength}},texturesByteLength:{get:function(){return this._model.texturesByteLength}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._model.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var E=Uint32Array.BYTES_PER_ELEMENT;C.prototype.hasProperty=function(a,b){return this._batchTable.hasProperty(a,b)};C.prototype.getFeature=function(a){var b=this.featuresLength;if(!g(a)||0>a||a>=b)throw new h("batchId is required and between zero and featuresLength - 1 ("+(b-1)+").");b=this.featuresLength;if(!g(this._features)&&0<b){for(var c=Array(b),d=0;d<b;++d)c[d]=new z(this,d);this._features=c}return this._features[a]};C.prototype.applyDebugSettings=function(b,c){c=b?c:a.WHITE;0===this.featuresLength?this._model.color=c:this._batchTable.setAllColor(c)};var L=new a;C.prototype.applyStyle=function(b){if(0===this.featuresLength){var c=g(b)&&g(b.color),d=g(b)&&g(b.show);this._model.color=c?b.color.evaluateColor(void 0,L):a.WHITE;this._model.show=d?b.show.evaluate(void 0):!0}else this._batchTable.applyStyle(b)};C.prototype.update=function(a,b){var c=b.commandList.length;this._batchTable.update(a,b);this._contentModelMatrix=q.multiply(this._tile.computedTransform,this._rtcCenterTransform,this._contentModelMatrix);this._model.modelMatrix=this._contentModelMatrix;this._model.shadows=this._tileset.shadows;this._model.imageBasedLightingFactor=this._tileset.imageBasedLightingFactor;this._model.lightColor=this._tileset.lightColor;this._model.luminanceAtZenith=this._tileset.luminanceAtZenith;this._model.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients;this._model.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps;this._model.debugWireframe=this._tileset.debugWireframe;var d=this._tileset.clippingPlanes;this._model.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix;g(d)&&this._tile.clippingPlanesDirty&&(this._model._clippingPlanes=d.enabled&&this._tile._isClipped?d:void 0);g(d)&&g(this._model._clippingPlanes)&&this._model._clippingPlanes!==d&&(this._model._clippingPlanes=d);this._model.update(b);c<b.commandList.length&&(b.passes.render||b.passes.pick)&&!g(a.classificationType)&&this._batchTable.addDerivedCommands(b,c)};C.prototype.isDestroyed=function(){return!1};C.prototype.destroy=function(){this._model=this._model&&this._model.destroy();this._batchTable=this._batchTable&&this._batchTable.destroy();return e(this)};return C});F("Scene/BingMapsStyle",["../Core/freezeObject"],function(b){return b({AERIAL:"Aerial",AERIAL_WITH_LABELS:"AerialWithLabels",AERIAL_WITH_LABELS_ON_DEMAND:"AerialWithLabelsOnDemand",ROAD:"Road",ROAD_ON_DEMAND:"RoadOnDemand",CANVAS_DARK:"CanvasDark",CANVAS_LIGHT:"CanvasLight",CANVAS_GRAY:"CanvasGray",ORDNANCE_SURVEY:"OrdnanceSurvey",COLLINS_BART:"CollinsBart"})});F("Scene/DiscardEmptyTileImagePolicy",["../Core/defined","../Core/defineProperties"],function(b,a){function f(a){}f.prototype.isReady=function(){return!0};f.prototype.shouldDiscardImage=function(a){return f.EMPTY_IMAGE===a};var k;a(f,{EMPTY_IMAGE:{get:function(){b(k)||(k=new Image,k.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII\x3d");return k}}});return f});F("Scene/BingMapsImageryProvider","../Core/BingMapsApi ../Core/buildModuleUrl ../Core/Check ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/Math ../Core/Rectangle ../Core/Resource ../Core/RuntimeError ../Core/TileProviderError ../Core/WebMercatorTilingScheme ../ThirdParty/when ./BingMapsStyle ./DiscardEmptyTileImagePolicy ./ImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(a){function f(a){if(1!==a.resourceSets.length)m();else{a=a.resourceSets[0].resources[0];z._tileWidth=a.imageWidth;z._tileHeight=a.imageHeight;z._maximumLevel=a.zoomMax-1;z._imageUrlSubdomains=a.imageUrlSubdomains;z._imageUrlTemplate=a.imageUrl;a=z._attributionList=a.imageryProviders;a||(a=z._attributionList=[]);for(var b=0,c=a.length;b<c;++b){var e=a[b];if(e.credit instanceof k)break;e.credit=new k(e.attribution);for(var f=e.coverageAreas,g=0,e=e.coverageAreas.length;g<e;++g){var h=f[g],l=h.bbox;h.bbox=new d(p.toRadians(l[1]),p.toRadians(l[0]),p.toRadians(l[3]),p.toRadians(l[2]))}}z._ready=!0;z._readyPromise.resolve(!0);r.handleSuccess(E)}}function m(a){a="An error occurred while accessing "+w.url+".";E=r.handleError(E,z,z._errorEvent,a,void 0,void 0,void 0,v);z._readyPromise.reject(new t(a))}function v(){var a=w.fetchJsonp("jsonp");x._metadataCache[C]=a;a.then(f).otherwise(m)}a=g(a,{});if(!l(a.url))throw new e("options.url is required.");this._key=b.getKey(a.key);this._resource=q.createIfNeeded(a.url);this._resource.appendForwardSlash();this._tileProtocol=a.tileProtocol;this._mapStyle=g(a.mapStyle,y.AERIAL);this._culture=g(a.culture,"");this._tileDiscardPolicy=a.tileDiscardPolicy;l(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new A);this._proxy=a.proxy;this._credit=new k('\x3ca href\x3d"http://www.bing.com"\x3e\x3cimg src\x3d"'+x.logoUrl+'" title\x3d"Bing Imagery"/\x3e\x3c/a\x3e');this.defaultGamma=1;this._tilingScheme=new c({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:a.ellipsoid});this._imageUrlSubdomains=this._imageUrlTemplate=this._maximumLevel=this._tileHeight=this._tileWidth=void 0;this._errorEvent=new h;this._ready=!1;this._readyPromise=u.defer();a=this._tileProtocol;l(a)?0<a.length&&":"===a[a.length-1]&&(a=a.substr(0,a.length-1)):a="http:"===document.location.protocol?"http":"https";var w=this._resource.getDerivedResource({url:"REST/v1/Imagery/Metadata/"+this._mapStyle,queryParameters:{incl:"ImageryProviders",key:this._key,uriScheme:a}}),z=this,E,C=w.url;a=x._metadataCache[C];l(a)?a.then(f).otherwise(m):v()}function D(a,b,c,d,e){var f=a._imageUrlSubdomains,g=(b+c+d)%f.length;return a._resource.getDerivedResource({url:a._imageUrlTemplate,request:e,templateValues:{quadkey:x.tileXYToQuadKey(b,c,d),subdomain:f[g],culture:a._culture},queryParameters:{n:"z"}})}m(x.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},key:{get:function(){return this._key}},mapStyle:{get:function(){return this._mapStyle}},culture:{get:function(){return this._culture}},tileWidth:{get:function(){if(!this._ready)throw new e("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new e("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new e("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new e("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new e("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new e("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new e("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}});var v=new d;x.prototype.getTileCredits=function(a,b,c){if(!this._ready)throw new e("getTileCredits must not be called before the imagery provider is ready.");a=this._tilingScheme.tileXYToRectangle(a,b,c,v);b=this._attributionList;++c;for(var f=[],g=0,h=b.length;g<h;++g){for(var k=b[g],m=k.coverageAreas,p=!1,q=0,r=k.coverageAreas.length;!p&&q<r;++q){var t=m[q];c>=t.zoomMin&&c<=t.zoomMax&&(t=d.intersection(a,t.bbox,B),l(t)&&(p=!0))}p&&f.push(k.credit)}return f};x.prototype.requestImage=function(a,b,c,d){if(!this._ready)throw new e("requestImage must not be called before the imagery provider is ready.");a=z.loadImage(this,D(this,a,b,c,d));if(l(a))return a.otherwise(function(a){return l(a.blob)&&0===a.blob.size?A.EMPTY_IMAGE:u.reject(a)})};x.prototype.pickFeatures=function(a,b,c,d,e){};x.tileXYToQuadKey=function(a,b,c){for(var d="";0<=c;--c){var e=1<<c,f=0;0!==(a&e)&&(f|=1);0!==(b&e)&&(f|=2);d+=f}return d};x.quadKeyToTileXY=function(a){for(var b=0,c=0,d=a.length-1,e=d;0<=e;--e){var f=1<<e,g=+a[d-e];0!==(g&1)&&(b|=f);0!==(g&2)&&(c|=f)}return{x:b,y:c,level:d}};x._logoUrl=void 0;m(x,{logoUrl:{get:function(){l(x._logoUrl)||(x._logoUrl=a("Assets/Images/bing_maps_credit.png"));return x._logoUrl},set:function(a){f.defined("value",a);x._logoUrl=a}}});var B=new d;x._metadataCache={};return x});F("Scene/BoxEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(b,a,f,k,g){function l(e){e=f(e,m);a.defined("dimensions",e);a.typeOf.number.greaterThanOrEquals("dimensions.x",e.x,0);a.typeOf.number.greaterThanOrEquals("dimensions.y",e.y,0);a.typeOf.number.greaterThanOrEquals("dimensions.z",e.z,0);this._dimensions=b.clone(e)}var m=new b(1,1,1);k(l.prototype,{dimensions:{get:function(){return this._dimensions},set:function(e){a.defined("value",e);a.typeOf.number.greaterThanOrEquals("value.x",e.x,0);a.typeOf.number.greaterThanOrEquals("value.y",e.y,0);a.typeOf.number.greaterThanOrEquals("value.z",e.z,0);b.clone(e,this._dimensions)}}});var e=new b;l.prototype.emit=function(a){var f=b.multiplyByScalar(this._dimensions,.5,e),d=g.randomBetween(-f.x,f.x),h=g.randomBetween(-f.y,f.y),f=g.randomBetween(-f.z,f.z);a.position=b.fromElements(d,h,f,a.position);a.velocity=b.normalize(a.position,a.velocity)};return l});F("Shaders/BrdfLutGeneratorFS",[],function(){return"varying vec2 v_textureCoordinates;\nconst float M_PI \x3d 3.141592653589793;\nfloat vdcRadicalInverse(int i)\n{\nfloat r;\nfloat base \x3d 2.0;\nfloat value \x3d 0.0;\nfloat invBase \x3d 1.0 / base;\nfloat invBi \x3d invBase;\nfor (int x \x3d 0; x \x3c 100; x++)\n{\nif (i \x3c\x3d 0)\n{\nbreak;\n}\nr \x3d mod(float(i), base);\nvalue +\x3d r * invBi;\ninvBi *\x3d invBase;\ni \x3d int(float(i) * invBase);\n}\nreturn value;\n}\nvec2 hammersley2D(int i, int N)\n{\nreturn vec2(float(i) / float(N), vdcRadicalInverse(i));\n}\nvec3 importanceSampleGGX(vec2 xi, float roughness, vec3 N)\n{\nfloat a \x3d roughness * roughness;\nfloat phi \x3d 2.0 * M_PI * xi.x;\nfloat cosTheta \x3d sqrt((1.0 - xi.y) / (1.0 + (a * a - 1.0) * xi.y));\nfloat sinTheta \x3d sqrt(1.0 - cosTheta * cosTheta);\nvec3 H \x3d vec3(sinTheta * cos(phi), sinTheta * sin(phi), cosTheta);\nvec3 upVector \x3d abs(N.z) \x3c 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);\nvec3 tangentX \x3d normalize(cross(upVector, N));\nvec3 tangentY \x3d cross(N, tangentX);\nreturn tangentX * H.x + tangentY * H.y + N * H.z;\n}\nfloat G1_Smith(float NdotV, float k)\n{\nreturn NdotV / (NdotV * (1.0 - k) + k);\n}\nfloat G_Smith(float roughness, float NdotV, float NdotL)\n{\nfloat k \x3d roughness * roughness / 2.0;\nreturn G1_Smith(NdotV, k) * G1_Smith(NdotL, k);\n}\nvec2 integrateBrdf(float roughness, float NdotV)\n{\nvec3 V \x3d vec3(sqrt(1.0 - NdotV * NdotV), 0.0, NdotV);\nfloat A \x3d 0.0;\nfloat B \x3d 0.0;\nconst int NumSamples \x3d 1024;\nfor (int i \x3d 0; i \x3c NumSamples; i++)\n{\nvec2 xi \x3d hammersley2D(i, NumSamples);\nvec3 H \x3d importanceSampleGGX(xi, roughness, vec3(0.0, 0.0, 1.0));\nvec3 L \x3d 2.0 * dot(V, H) * H - V;\nfloat NdotL \x3d clamp(L.z, 0.0, 1.0);\nfloat NdotH \x3d clamp(H.z, 0.0, 1.0);\nfloat VdotH \x3d clamp(dot(V, H), 0.0, 1.0);\nif (NdotL \x3e 0.0)\n{\nfloat G \x3d G_Smith(roughness, NdotV, NdotL);\nfloat G_Vis \x3d G * VdotH / (NdotH * NdotV);\nfloat Fc \x3d pow(1.0 - VdotH, 5.0);\nA +\x3d (1.0 - Fc) * G_Vis;\nB +\x3d Fc * G_Vis;\n}\n}\nreturn vec2(A, B) / float(NumSamples);\n}\nvoid main()\n{\ngl_FragColor \x3d vec4(integrateBrdf(1.0 - v_textureCoordinates.y, v_textureCoordinates.x), 0.0, 1.0);\n}\n"});F("Scene/BrdfLutGenerator","../Core/BoundingRectangle ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/PixelFormat ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Shaders/BrdfLutGeneratorFS".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(){this._drawCommand=this._colorTexture=this._framebuffer=void 0}f(c.prototype,{colorTexture:{get:function(){return this._colorTexture}}});c.prototype.update=function(c){if(!a(this._colorTexture)){c=c.context;var f=new p({context:c,width:256,height:256,pixelFormat:g.RGBA,pixelDatatype:m.UNSIGNED_BYTE,sampler:new h({wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,minificationFilter:q.NEAREST,magnificationFilter:d.NEAREST})});this._colorTexture=f;this._framebuffer=new l({context:c,colorTextures:[f],destroyAttachments:!1});this._drawCommand=c.createViewportQuadCommand(r,{framebuffer:this._framebuffer,renderState:e.fromCache({viewport:new b(0,0,256,256)})});this._drawCommand.execute(c);this._framebuffer=this._framebuffer&&this._framebuffer.destroy();this._drawCommand.shaderProgram=this._drawCommand.shaderProgram&&this._drawCommand.shaderProgram.destroy()}};c.prototype.isDestroyed=function(){return!1};c.prototype.destroy=function(){this._colorTexture=this._colorTexture&&this._colorTexture.destroy();return k(this)};return c});F("Scene/CameraFlightPath","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Core/EasingFunction ../Core/Math ../Core/PerspectiveFrustum ../Core/PerspectiveOffCenterFrustum ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a,b,c){var d,e;return a instanceof h?(e=Math.tan(.5*a.fovy),d=a.near,e*=a.near,a=a.aspectRatio*e,Math.max(b*d/a,c*d/e)):a instanceof p?(d=a.near,e=a.top,a=a.right,Math.max(b*d/a,c*d/e)):Math.max(b,c)}function t(a,b,c,d){if(g(d)&&c(.5)>d){var f=c(0),h=c(1);d=c(.5);var k=d-f,l=d-h;return function(d){var g=c(d);return.5>=d?e.lerp(a,-e.PI_OVER_TWO,(g-f)/k):e.lerp(-e.PI_OVER_TWO,b,1-(g-h)/l)}}return function(c){return e.lerp(a,b,c)}}function r(b,c,d,f,h){var k=h;h=Math.max(d,f);if(!g(k)){var l=b.up,m=b.right,p=b.frustum;b=a.subtract(b.position,c,C);c=a.magnitude(a.multiplyByScalar(l,a.dot(b,l),I));m=a.magnitude(a.multiplyByScalar(m,a.dot(b,m),I));k=Math.min(.2*q(p,c,m),1E9)}if(h<k){var r=-Math.pow(1E6*(k-d),.125),t=Math.pow(1E6*(k-f),.125);return function(a){return-Math.pow(a*(t-r)+r,8)/1E6+k}}return function(a){return e.lerp(d,f,a)}}function c(a,b){e.equalsEpsilon(a,e.TWO_PI,e.EPSILON11)&&(a=0);b>a+Math.PI?a+=e.TWO_PI:b<a-Math.PI&&(a-=e.TWO_PI);return a}function u(d,f,g,h,k,l,m){var p=d.camera,q=a.clone(p.position,H),t=p.pitch,w=c(p.heading,h),u=c(p.roll,l),v=r(p,g,q.z,g.z,m);return function(a){a=a.time/f;p.setView({orientation:{heading:e.lerp(w,h,a),pitch:e.lerp(t,k,a),roll:e.lerp(u,l,a)}});b.lerp(q,g,a,p.position);p.position.z=v(a)}}function y(a,b){a.longitude<b.longitude?a.longitude+=e.TWO_PI:b.longitude+=e.TWO_PI}function A(a,b){var c=a.longitude-b.longitude;c<-e.PI?a.longitude+=e.TWO_PI:c>e.PI&&(b.longitude+=e.TWO_PI)}function z(b,d,h,k,l,m,p,q,u,v){var z=b.camera,E=b.mapProjection.ellipsoid,C=f.clone(z.positionCartographic,J);b=z.pitch;var B=c(z.heading,k),G=c(z.roll,m),D=E.cartesianToCartographic(h,w);C.longitude=e.zeroToTwoPi(C.longitude);D.longitude=e.zeroToTwoPi(D.longitude);E=!1;if(g(q)){q=e.zeroToTwoPi(q);var x=Math.max(C.longitude,D.longitude);q=q>=Math.min(C.longitude,D.longitude)&&q<=x;if(g(u)){var x=Math.abs(C.longitude-D.longitude),H=e.TWO_PI-x;(q?x:H)<(q?H:x)*u&&!q&&(E=!0)}else q||(E=!0)}E?y(C,D):A(C,D);var I=r(z,h,C.height,D.height,p),L=t(b,l,I,v);return function(){var b=C.longitude,c=D.longitude,f=C.latitude,g=D.latitude;return function(h){h=h.time/d;var l=a.fromRadians(e.lerp(b,c,h),e.lerp(f,g,h),I(h));z.setView({destination:l,orientation:{heading:e.lerp(B,k,h),pitch:L(h),roll:e.lerp(G,m,h)}})}}()}function x(d,f,g,h,k,l,m){var p=d.camera,q=a.clone(p.position,H),t=c(p.heading,h),w=r(p,g,p.frustum.right-p.frustum.left,g.z,m);return function(a){a=a.time/f;p.setView({orientation:{heading:e.lerp(t,h,a)}});b.lerp(q,g,a,p.position);var c=w(a);a=p.frustum;var d=a.top/a.right,c=.5*(c-(a.right-a.left));a.right+=c;a.left-=c;a.top=d*a.right;a.bottom=-a.top}}function D(a,b){return{startObject:{},stopObject:{},duration:0,complete:a,cancel:b}}function v(a,b){return function(){"function"===typeof b&&b();a.enableInputs=!0}}var B={},C=new a,I=new a,H=new a,J=new f,w=new f,G=new f,E=new a;B.createTween=function(c,f){f=k(f,k.EMPTY_OBJECT);var h=f.destination;if(!g(c))throw new l("scene is required.");if(!g(h))throw new l("destination is required.");var p=c.mode;if(p===d.MORPHING)return D();var q=k(f.convert,!0),r=c.mapProjection,t=r.ellipsoid,w=f.maximumHeight,y=f.flyOverLongitude,C=f.flyOverLongitudeWeight,A=f.pitchAdjustHeight,B=f.easingFunction;q&&p!==d.SCENE3D&&(t.cartesianToCartographic(h,G),h=r.project(G,E));r=c.camera;q=f.endTransform;g(q)&&r._setTransform(q);q=f.duration;g(q)||(q=Math.ceil(a.distance(r.position,h)/1E6)+2,q=Math.min(q,3));var H=k(f.heading,0),I=k(f.pitch,-e.PI_OVER_TWO),L=k(f.roll,0),K=c.screenSpaceCameraController;K.enableInputs=!1;var J=v(K,f.complete),K=v(K,f.cancel),F=r.frustum,ba=c.mode===d.SCENE2D;if(ba=(ba=(ba=(ba=ba&&b.equalsEpsilon(r.position,h,e.EPSILON6))&&e.equalsEpsilon(Math.max(F.right-F.left,F.top-F.bottom),h.z,e.EPSILON6))||c.mode!==d.SCENE2D&&a.equalsEpsilon(h,r.position,e.EPSILON10))&&e.equalsEpsilon(e.negativePiToPi(H),e.negativePiToPi(r.heading),e.EPSILON10)&&e.equalsEpsilon(e.negativePiToPi(I),e.negativePiToPi(r.pitch),e.EPSILON10)&&e.equalsEpsilon(e.negativePiToPi(L),e.negativePiToPi(r.roll),e.EPSILON10))return D(J,K);var X=Array(4);X[d.SCENE2D]=x;X[d.SCENE3D]=z;X[d.COLUMBUS_VIEW]=u;if(0>=q)return D(function(){X[p](c,1,h,H,I,L,w,y,C,A)({time:1});"function"===typeof J&&J()},K);F=X[p](c,q,h,H,I,L,w,y,C,A);g(B)||(B=r.positionCartographic.height,t=p===d.SCENE3D?t.cartesianToCartographic(h).height:h.z,B=B>t&&11500<B?m.CUBIC_OUT:m.QUINTIC_IN_OUT);return{duration:q,easingFunction:B,startObject:{time:0},stopObject:{time:q},update:F,complete:J,cancel:K}};return B});F("Scene/MapMode2D",["../Core/freezeObject"],function(b){return b({ROTATE:0,INFINITE_SCROLL:1})});F("Scene/Camera","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/EasingFunction ../Core/Ellipsoid ../Core/EllipsoidGeodesic ../Core/Event ../Core/getTimestamp ../Core/HeadingPitchRange ../Core/HeadingPitchRoll ../Core/Intersect ../Core/IntersectionTests ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Core/PerspectiveFrustum ../Core/Quaternion ../Core/Ray ../Core/Rectangle ../Core/Transforms ./CameraFlightPath ./MapMode2D ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L){function K(a){if(!m(a))throw new h("scene is required.");this._scene=a;this._transform=D.clone(D.IDENTITY);this._invTransform=D.clone(D.IDENTITY);this._actualTransform=D.clone(D.IDENTITY);this._actualInvTransform=D.clone(D.IDENTITY);this._transformChanged=!1;this.position=new f;this._position=new f;this._positionWC=new f;this._positionCartographic=new g;this._oldPositionWC=void 0;this._lastMovedTimestamp=this.timeSinceMoved=this.positionWCDeltaMagnitudeLastFrame=this.positionWCDeltaMagnitude=0;this.direction=new f;this._direction=new f;this._directionWC=new f;this.up=new f;this._up=new f;this._upWC=new f;this.right=new f;this._right=new f;this._rightWC=new f;this.frustum=new C;this.frustum.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight;this.frustum.fov=z.toRadians(60);this.defaultMoveAmount=1E5;this.defaultLookAmount=Math.PI/60;this.defaultRotateAmount=Math.PI/3600;this.defaultZoomAmount=1E5;this.constrainedAxis=void 0;this.maximumZoomFactor=1.5;this._moveStart=new t;this._moveEnd=new t;this._changed=new t;this._changedFrustum=this._changedDirection=this._changedPosition=void 0;this.percentageChanged=.5;this._viewMatrix=new D;this._invViewMatrix=new D;F(this);this._mode=L.SCENE3D;this._modeChanged=!0;this._projection=a=a.mapProjection;this._maxCoord=a.project(new g(Math.PI,z.PI_OVER_TWO));this._max2Dfrustum=void 0;this._suspendTerrainAdjustment=!1;S(this,K.DEFAULT_VIEW_RECTANGLE,this.position,!0);a=f.magnitude(this.position);a+=a*K.DEFAULT_VIEW_FACTOR;f.normalize(this.position,this.position);f.multiplyByScalar(this.position,a,this.position)}function F(a){D.computeView(a._position,a._direction,a._up,a._right,a._viewMatrix);D.multiply(a._viewMatrix,a._actualInvTransform,a._viewMatrix);D.inverseTransformation(a._viewMatrix,a._invViewMatrix)}function N(a){var b=a._mode,c=!1,d=0;b===L.SCENE2D&&(d=a.frustum.right-a.frustum.left,c=d!==a._positionCartographic.height);var e=a._position;(c=!f.equals(e,a.position)||c)&&(e=f.clone(a.position,a._position));var g=a._direction,h=!f.equals(g,a.direction);h&&(f.normalize(a.direction,a.direction),g=f.clone(a.direction,a._direction));var l=a._up,m=!f.equals(l,a.up);m&&(f.normalize(a.up,a.up),l=f.clone(a.up,a._up));var p=a._right,q=!f.equals(p,a.right);q&&(f.normalize(a.right,a.right),p=f.clone(a.right,a._right));var r=a._transformChanged||a._modeChanged;a._transformChanged=!1;if(r){D.inverseTransformation(a._transform,a._invTransform);if(a._mode===L.COLUMBUS_VIEW||a._mode===L.SCENE2D)if(D.equals(D.IDENTITY,a._transform))D.clone(K.TRANSFORM_2D,a._actualTransform);else if(a._mode===L.COLUMBUS_VIEW)w.basisTo2D(a._projection,a._transform,a._actualTransform);else{var t=a._projection,u=t.ellipsoid,v=D.getColumn(a._transform,3,ka),y=u.cartesianToCartographic(v,X),E=t.project(y,fa),C=na;C.x=E.z;C.y=E.x;C.z=E.y;C.w=1;var A=k.clone(k.UNIT_X,ha),B=k.add(D.getColumn(a._transform,0,ga),v,ga);u.cartesianToCartographic(B,y);t.project(y,E);B=ia;B.x=E.z;B.y=E.x;B.z=E.y;B.w=0;f.subtract(B,C,B);B.x=0;var G=la;f.magnitudeSquared(B)>z.EPSILON10?f.cross(A,B,G):(v=k.add(D.getColumn(a._transform,1,ga),v,ga),u.cartesianToCartographic(v,y),t.project(y,E),G.x=E.z,G.y=E.x,G.z=E.y,G.w=0,f.subtract(G,C,G),G.x=0,f.magnitudeSquared(G)<z.EPSILON10&&(k.clone(k.UNIT_Y,B),k.clone(k.UNIT_Z,G)));f.cross(G,A,B);f.normalize(B,B);f.cross(A,B,G);f.normalize(G,G);D.setColumn(a._actualTransform,0,B,a._actualTransform);D.setColumn(a._actualTransform,1,G,a._actualTransform);D.setColumn(a._actualTransform,2,A,a._actualTransform);D.setColumn(a._actualTransform,3,C,a._actualTransform)}else D.clone(a._transform,a._actualTransform);D.inverseTransformation(a._actualTransform,a._actualInvTransform);a._modeChanged=!1}t=a._actualTransform;if(c||r)a._positionWC=D.multiplyByPoint(t,e,a._positionWC),b===L.SCENE3D||b===L.MORPHING?a._positionCartographic=a._projection.ellipsoid.cartesianToCartographic(a._positionWC,a._positionCartographic):(e=pa,e.x=a._positionWC.y,e.y=a._positionWC.z,e.z=a._positionWC.x,b===L.SCENE2D&&(e.z=d),a._projection.unproject(e,a._positionCartographic));if(h||m||q)b=f.dot(g,f.cross(l,p,pa)),Math.abs(1-b)>z.EPSILON2&&(b=1/f.magnitudeSquared(l),b*=f.dot(l,g),b=f.multiplyByScalar(g,b,pa),l=f.normalize(f.subtract(l,b,a._up),a._up),f.clone(l,a.up),p=f.cross(g,l,a._right),f.clone(p,a.right));if(h||r)a._directionWC=D.multiplyByPointAsVector(t,g,a._directionWC),f.normalize(a._directionWC,a._directionWC);if(m||r)a._upWC=D.multiplyByPointAsVector(t,l,a._upWC),f.normalize(a._upWC,a._upWC);if(q||r)a._rightWC=D.multiplyByPointAsVector(t,p,a._rightWC),f.normalize(a._rightWC,a._rightWC);(c||h||m||q||r)&&F(a)}function O(a,b){var c;c=z.equalsEpsilon(Math.abs(a.z),1,z.EPSILON3)?Math.atan2(b.y,b.x)-z.PI_OVER_TWO:Math.atan2(a.y,a.x)-z.PI_OVER_TWO;return z.TWO_PI-z.zeroToTwoPi(c)}function Z(a,b,c){var d=0;z.equalsEpsilon(Math.abs(a.z),1,z.EPSILON3)||(d=Math.atan2(-c.z,b.z),d=z.zeroToTwoPi(d+z.TWO_PI));return d}function aa(a,b,c,d){var e=f.clone(c.direction,sa);c=f.clone(c.up,Va);a._scene.mode===L.SCENE3D&&(a=w.eastNorthUpToFixedFrame(b,a._projection.ellipsoid,oa),a=D.inverseTransformation(a,qa),D.multiplyByPointAsVector(a,e,e),D.multiplyByPointAsVector(a,c,c));a=f.cross(e,c,xa);d.heading=O(e,c);d.pitch=z.PI_OVER_TWO-z.acosClamped(e.z);d.roll=Z(e,c,a);return d}function U(a,b){var c=a._maxCoord.x,d=a._maxCoord.y,e,f;a._scene.mapMode2D===E.ROTATE?(f=c,e=-f):(f=b.x-2*c,e=b.x+2*c);b.x>c&&(b.x=f);b.x<-c&&(b.x=e);b.y>d&&(b.y=d);b.y<-d&&(b.y=-d)}function W(a,b){var c=a.position;if(!(1E-5>Math.abs(c.x)&&1E-5>Math.abs(c.y)&&1E-5>Math.abs(c.z)))if(m(a.constrainedAxis)&&!f.equalsEpsilon(a.position,f.ZERO,z.EPSILON2)){var c=f.normalize(c,Sa),d=f.equalsEpsilon(c,a.constrainedAxis,z.EPSILON2),e=f.equalsEpsilon(c,f.negate(a.constrainedAxis,Ka),z.EPSILON2);d||e?(d&&0>b||e&&0<b)&&a.rotate(a.right,b):(d=f.normalize(a.constrainedAxis,Oa),e=f.dot(c,d),e=z.acosClamped(e),0<b&&b>e&&(b=e-z.EPSILON4),e=f.dot(c,f.negate(d,Ka)),e=z.acosClamped(e),0>b&&-b>e&&(b=-e+z.EPSILON4),c=f.cross(d,c,Ta),a.rotate(c,b))}else a.rotate(a.right,b)}function M(a,b){m(a.constrainedAxis)?a.rotate(a.constrainedAxis,b):a.rotate(a.up,b)}function R(a,b){var c=a.frustum;if(!(c instanceof B&&m(c.left)&&m(c.right)&&m(c.bottom)&&m(c.top)))throw new h("The camera frustum is expected to be orthographic for 2D camera control.");var d;b*=.5;if(Math.abs(c.top)+Math.abs(c.bottom)>Math.abs(c.left)+Math.abs(c.right)){var e=c.top-b,f=c.bottom+b;d=a._maxCoord.y;a._scene.mapMode2D===E.ROTATE&&(d*=a.maximumZoomFactor);f>d&&(f=d,e=-d);e<=f&&(e=1,f=-1);d=c.right/c.top;c.top=e;c.bottom=f;c.right=c.top*d;c.left=-c.right}else e=c.right-b,f=c.left+b,d=a._maxCoord.x,a._scene.mapMode2D===E.ROTATE&&(d*=a.maximumZoomFactor),e>d&&(e=d,f=-d),e<=f&&(e=1,f=-1),d=c.top/c.right,c.right=e,c.left=f,c.top=c.right*d,c.bottom=-c.top}function Y(a,b,c){b=z.clamp(b,-z.PI_OVER_TWO,z.PI_OVER_TWO);a=z.zeroToTwoPi(a)-z.PI_OVER_TWO;b=I.fromAxisAngle(f.UNIT_Y,-b,Nb);a=I.fromAxisAngle(f.UNIT_Z,-a,hb);a=I.multiply(a,b,a);a=x.fromQuaternion(a,Hb);b=f.clone(f.UNIT_X,Ra);x.multiplyByVector(a,b,b);f.negate(b,b);f.multiplyByScalar(b,c,b);return b}function Q(a,b,c,d){return Math.abs(f.dot(b,c))/d-f.dot(a,c)}function S(a,b,c,d){var e=a._projection.ellipsoid,g=d?a:ja,h=b.north,k=b.south;d=b.east;var l=b.west;l>d&&(d+=z.TWO_PI);var p=.5*(l+d);if(k<-z.PI_OVER_TWO+z.RADIANS_PER_DEGREE&&h>z.PI_OVER_TWO-z.RADIANS_PER_DEGREE)b=0;else{b=db;b.longitude=p;b.latitude=h;b.height=0;var r=tb;r.longitude=p;r.latitude=k;r.height=0;var t=uc;m(t)&&t.ellipsoid===e||(uc=t=new q(void 0,void 0,e));t.setEndPoints(b,r);b=t.interpolateUsingFraction(.5,db).latitude}r=db;r.longitude=p;r.latitude=b;r.height=0;b=e.cartographicToCartesian(r,Xb);var w=db;w.longitude=d;w.latitude=h;r=e.cartographicToCartesian(w,Pa);w.longitude=l;t=e.cartographicToCartesian(w,sc);w.longitude=p;var u=e.cartographicToCartesian(w,tc);w.latitude=k;var y=e.cartographicToCartesian(w,wc);w.longitude=d;var E=e.cartographicToCartesian(w,Za);w.longitude=l;var C=e.cartographicToCartesian(w,cc);f.subtract(t,b,t);f.subtract(E,b,E);f.subtract(r,b,r);f.subtract(C,b,C);f.subtract(u,b,u);f.subtract(y,b,y);p=e.geodeticSurfaceNormal(b,g.direction);f.negate(p,p);w=f.cross(p,f.UNIT_Z,g.right);f.normalize(w,w);g=f.cross(w,p,g.up);if(a.frustum instanceof v)e=Math.max(f.distance(r,t),f.distance(E,C)),d=Math.max(f.distance(r,E),f.distance(t,C)),a=a.frustum._offCenterFrustum.right/a.frustum._offCenterFrustum.top,h=d*a,e>h?d=e/a:e=h,r=Math.max(e,d);else{var A=Math.tan(.5*a.frustum.fovy);a=a.frustum.aspectRatio*A;r=Math.max(Q(p,g,t,A),Q(p,g,E,A),Q(p,g,r,A),Q(p,g,C,A),Q(p,g,u,A),Q(p,g,y,A),Q(p,w,t,a),Q(p,w,E,a),Q(p,w,r,a),Q(p,w,C,a),Q(p,w,u,a),Q(p,w,y,a));0>k&&0<h&&(h=db,h.longitude=l,h.latitude=0,h.height=0,k=e.cartographicToCartesian(h,dc),f.subtract(k,b,k),r=Math.max(r,Q(p,g,k,A),Q(p,w,k,a)),h.longitude=d,k=e.cartographicToCartesian(h,dc),f.subtract(k,b,k),r=Math.max(r,Q(p,g,k,A),Q(p,w,k,a)))}return f.add(b,f.multiplyByScalar(p,-r,dc),c)}function ca(a,b,c,d,e,g){var h=f.clone(b);c.y>d?h.y-=c.y-d:c.y<-d&&(h.y+=-d-c.y);c.z>e?h.z-=c.z-e:c.z<-e&&(h.z+=-e-c.z);return{easingFunction:p.EXPONENTIAL_OUT,startObject:{time:0},stopObject:{time:1},duration:g,update:function(c){c=f.lerp(b,h,c.time,new f);a.worldToCameraCoordinatesPoint(c,a.position)}}}function T(a,b,d){m(d)||(d=c.clone(K.DEFAULT_OFFSET));var e=a._scene.screenSpaceCameraController.minimumZoomDistance,f=a._scene.screenSpaceCameraController.maximumZoomDistance,g=d.range;if(!m(g)||0===g){b=b.radius;if(0===b)d.range=100;else if(a.frustum instanceof v||a._mode===L.SCENE2D){g=d;a=a.frustum;m(a._offCenterFrustum)&&(a=a._offCenterFrustum);a=a.right/a.top;var h=b*a;b>h?a=b/a:(a=b,b=h);g.range=1.5*Math.max(b,a)}else g=a.frustum,a=Math.tan(.5*g.fovy),d.range=Math.max(b/(g.aspectRatio*a),b/a);d.range=z.clamp(d.range,e,f)}return d}function da(a,b,c,d,e,f){Zb.x=a;Zb.y=b;a=d.pickEllipsoid(Zb,e,Gc);if(m(a))return Na[c]=e.cartesianToCartographic(a,Na[c]),1;Na[c]=e.cartesianToCartographic(f[c],Na[c]);return 0}K.TRANSFORM_2D=new D(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1);K.TRANSFORM_2D_INVERSE=D.inverseTransformation(K.TRANSFORM_2D,new D);K.DEFAULT_VIEW_RECTANGLE=J.fromDegrees(-95,-20,-70,90);K.DEFAULT_VIEW_FACTOR=.5;K.DEFAULT_OFFSET=new c(0,-z.PI_OVER_FOUR,0);K.prototype.hasCurrentFlight=function(){return m(this._currentFlight)&&m(this._scene.preloadFlightCamera)};K.prototype._updateCameraChanged=function(){if(m(this._oldPositionWC)){this.positionWCDeltaMagnitudeLastFrame=this.positionWCDeltaMagnitude;var a=f.subtract(this.positionWC,this._oldPositionWC,this._oldPositionWC);this.positionWCDeltaMagnitude=f.magnitude(a);this._oldPositionWC=f.clone(this.positionWC,this._oldPositionWC);0<this.positionWCDeltaMagnitude?(this.timeSinceMoved=0,this._lastMovedTimestamp=r()):this.timeSinceMoved=Math.max(r()-this._lastMovedTimestamp,0)/1E3}else this._oldPositionWC=f.clone(this.positionWC,this._oldPositionWC);if(0!==this._changed.numberOfListeners)if(a=this.percentageChanged,this._mode===L.SCENE2D)if(m(this._changedFrustum)){var b=this.position,c=this._changedPosition,d=this.frustum,e=this._changedFrustum,g=b.x+d.left,h=b.x+d.right,k=c.x+e.left,l=c.x+e.right,p=b.y+d.bottom,b=b.y+d.top,q=c.y+e.bottom,c=c.y+e.top,t=Math.max(g,k),w=Math.min(h,l),u=Math.max(p,q),v=Math.min(b,c);t>=w||u>=b?d=1:(g<k&&h>l&&p<q&&b>c&&(e=d),d=1-(w-t)*(v-u)/((e.right-e.left)*(e.top-e.bottom)));d>a&&(this._changed.raiseEvent(d),this._changedPosition=f.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone(this._changedFrustum))}else this._changedPosition=f.clone(this.position,this._changedPosition),this._changedFrustum=this.frustum.clone();else if(m(this._changedDirection)){if(d=z.acosClamped(f.dot(this.directionWC,this._changedDirection)),d=m(this.frustum.fovy)?d/(.5*this.frustum.fovy):d,g=f.distance(this.positionWC,this._changedPosition)/this.positionCartographic.height,d>a||g>a)this._changed.raiseEvent(Math.max(d,g)),this._changedPosition=f.clone(this.positionWC,this._changedPosition),this._changedDirection=f.clone(this.directionWC,this._changedDirection)}else this._changedPosition=f.clone(this.positionWC,this._changedPosition),this._changedDirection=f.clone(this.directionWC,this._changedDirection)};var V=new D,ba=new g;K.prototype._adjustHeightForTerrain=function(){var a=this._scene,b=a.screenSpaceCameraController,c=b.enableCollisionDetection,d=b.minimumCollisionTerrainHeight,b=b.minimumZoomDistance;if(!this._suspendTerrainAdjustment&&c){var c=this._mode,e=a.globe;if(m(e)&&c!==L.SCENE2D&&c!==L.MORPHING){var g=e.ellipsoid,a=a.mapProjection,h,k;D.equals(this.transform,D.IDENTITY)||(h=D.clone(this.transform,V),k=f.magnitude(this.position),this._setTransform(D.IDENTITY));c===L.SCENE3D?g.cartesianToCartographic(this.position,ba):a.unproject(this.position,ba);var l=!1;ba.height<d&&(d=e.getHeight(ba),m(d)&&(d+=b,ba.height<d&&(ba.height=d,c===L.SCENE3D?g.cartographicToCartesian(ba,this.position):a.project(ba,this.position),l=!0)));m(h)&&(this._setTransform(h),l&&(f.normalize(this.position,this.position),f.negate(this.position,this.direction),f.multiplyByScalar(this.position,Math.max(k,b),this.position),f.normalize(this.direction,this.direction),f.cross(this.direction,this.up,this.right),f.cross(this.right,this.direction,this.up)))}}};var X=new g,fa=new f,ga=new f,ka=new k,na=new k,ia=new k,la=new k,ha=new k,pa=new f,oa=new D,qa=new D;e(K.prototype,{transform:{get:function(){return this._transform}},inverseTransform:{get:function(){N(this);return this._invTransform}},viewMatrix:{get:function(){N(this);return this._viewMatrix}},inverseViewMatrix:{get:function(){N(this);return this._invViewMatrix}},positionCartographic:{get:function(){N(this);return this._positionCartographic}},positionWC:{get:function(){N(this);return this._positionWC}},directionWC:{get:function(){N(this);return this._directionWC}},upWC:{get:function(){N(this);return this._upWC}},rightWC:{get:function(){N(this);return this._rightWC}},heading:{get:function(){if(this._mode!==L.MORPHING){var a=this._projection.ellipsoid,b=D.clone(this._transform,oa),a=w.eastNorthUpToFixedFrame(this.positionWC,a,qa);this._setTransform(a);a=O(this.direction,this.up);this._setTransform(b);return a}}},compassDirection:{get:function(){if(this._mode!==L.MORPHING){var a=w.eastNorthUpToFixedFrame(this.positionWC,this._projection.ellipsoid,new D),b=f.clone(this.upWC,new f),c=f.clone(this.directionWC,new f),a=D.inverseTransformation(a,new D);D.multiplyByPointAsVector(a,c,c);D.multiplyByPointAsVector(a,b,b);b=z.equalsEpsilon(Math.abs(c.z),1,2*z.EPSILON1)?Math.atan2(b.y,b.x)-z.PI_OVER_TWO:Math.atan2(c.y,c.x)-z.PI_OVER_TWO;return b=z.zeroToTwoPi(b)}}},pitch:{get:function(){if(this._mode!==L.MORPHING){var a=this._projection.ellipsoid,b=D.clone(this._transform,oa),a=w.eastNorthUpToFixedFrame(this.positionWC,a,qa);this._setTransform(a);a=z.PI_OVER_TWO-z.acosClamped(this.direction.z);this._setTransform(b);return a}}},roll:{get:function(){if(this._mode!==L.MORPHING){var a=this._projection.ellipsoid,b=D.clone(this._transform,oa),a=w.eastNorthUpToFixedFrame(this.positionWC,a,qa);this._setTransform(a);a=Z(this.direction,this.up,this.right);this._setTransform(b);return a}}},moveStart:{get:function(){return this._moveStart}},moveEnd:{get:function(){return this._moveEnd}},changed:{get:function(){return this._changed}}});K.prototype.update=function(a){if(!m(a))throw new h("mode is required.");if(a===L.SCENE2D&&!(this.frustum instanceof B))throw new h("An OrthographicOffCenterFrustum is required in 2D.");if(!(a!==L.SCENE3D&&a!==L.COLUMBUS_VIEW||this.frustum instanceof C||this.frustum instanceof v))throw new h("A PerspectiveFrustum or OrthographicFrustum is required in 3D and Columbus view");var b=!1;a!==this._mode&&(this._mode=a,this._modeChanged=a!==L.MORPHING,b=this._mode===L.SCENE2D);if(b){a=this._max2Dfrustum=this.frustum.clone();if(!(a instanceof B))throw new h("The camera frustum is expected to be orthographic for 2D camera control.");b=a.top/a.right;a.right=2*this._maxCoord.x;a.left=-a.right;a.top=b*a.right;a.bottom=-a.top}this._mode===L.SCENE2D&&U(this,this.position);a=this._scene.globe;a=!m(a)||a._surface.tileProvider.ready&&0===a._surface._tileLoadQueueHigh.length&&0===a._surface._tileLoadQueueMedium.length&&0===a._surface._tileLoadQueueLow.length&&0===a._surface._debug.tilesWaitingForChildren;this._suspendTerrainAdjustment&&(this._suspendTerrainAdjustment=!a);a&&this._adjustHeightForTerrain()};var ua=new f,ta=new f,wa=new f;K.prototype._setTransform=function(a){var b=f.clone(this.positionWC,ua),c=f.clone(this.upWC,ta),d=f.clone(this.directionWC,wa);D.clone(a,this._transform);this._transformChanged=!0;N(this);a=this._actualInvTransform;D.multiplyByPoint(a,b,this.position);D.multiplyByPointAsVector(a,d,this.direction);D.multiplyByPointAsVector(a,c,this.up);f.cross(this.direction,this.up,this.right);N(this)};var za=new a,Da=new H,Ba=new f,ra=new f;K.prototype._adjustOrthographicFrustum=function(a){if(this.frustum instanceof v&&(a||!(15E4>this._positionCartographic.height)))if(D.equals(D.IDENTITY,this.transform)){var b=this._scene;a=b.globe;var c,d;if(m(a))if(za.x=b.drawingBufferWidth/2,za.y=b.drawingBufferHeight/2,c=this.getPickRay(za,Da),c=a.pickWorldCoordinates(c,b,Ba),b.pickPositionSupported&&(d=b.pickPositionWorldCoordinates(za,ra)),m(c)&&m(d)){var b=m(d)?f.distance(d,this.positionWC):Number.POSITIVE_INFINITY,e=m(c)?f.distance(c,this.positionWC):Number.POSITIVE_INFINITY;this.frustum.width=Math.min(b,e)}else m(d)?this.frustum.width=f.distance(d,this.positionWC):m(c)&&(this.frustum.width=f.distance(c,this.positionWC));m(a)&&(m(c)||m(d))||(this.frustum.width=Math.max(this.positionCartographic.height,0))}else this.frustum.width=f.magnitude(this.position)};var Ea=new f,Ga=new D,Ca=new D,ya=new I,Aa=new x,Ua=new g,sa=new f,Va=new f,xa=new f,Ha={destination:void 0,orientation:{direction:void 0,up:void 0,heading:void 0,pitch:void 0,roll:void 0},convert:void 0,endTransform:void 0},Ma=new u;K.prototype.setView=function(b){b=l(b,l.EMPTY_OBJECT);var c=l(b.orientation,l.EMPTY_OBJECT),d=this._mode;if(d!==L.MORPHING){m(b.endTransform)&&this._setTransform(b.endTransform);var e=l(b.convert,!0);b=l(b.destination,f.clone(this.positionWC,Ea));m(b)&&m(b.west)&&(b=this.getRectangleCameraCoordinates(b,Ea),e=!1);m(c.direction)&&(c=aa(this,b,c,Ha.orientation));Ma.heading=l(c.heading,0);Ma.pitch=l(c.pitch,-z.PI_OVER_TWO);Ma.roll=l(c.roll,0);this._suspendTerrainAdjustment=!0;if(d===L.SCENE3D)c=b,e=D.clone(this.transform,Ga),c=w.eastNorthUpToFixedFrame(c,this._projection.ellipsoid,Ca),this._setTransform(c),f.clone(f.ZERO,this.position),Ma.heading-=z.PI_OVER_TWO,c=I.fromHeadingPitchRoll(Ma,ya),c=x.fromQuaternion(c,Aa),x.getColumn(c,0,this.direction),x.getColumn(c,2,this.up),f.cross(this.direction,this.up,this.right),this._setTransform(e),this._adjustOrthographicFrustum(!0);else if(d===L.SCENE2D){c=b;d=e;e=D.clone(this.transform,Ga);this._setTransform(D.IDENTITY);if(!f.equals(c,this.positionWC)&&(d&&(d=this._projection,c=d.ellipsoid.cartesianToCartographic(c,Ua),c=d.project(c,Ea)),a.clone(c,this.position),c=.5*-c.z,d=-c,b=this.frustum,d>c)){var g=b.top/b.right;b.right=d;b.left=c;b.top=b.right*g;b.bottom=-b.top}this._scene.mapMode2D===E.ROTATE&&(Ma.heading-=z.PI_OVER_TWO,Ma.pitch=-z.PI_OVER_TWO,Ma.roll=0,c=I.fromHeadingPitchRoll(Ma,ya),c=x.fromQuaternion(c,Aa),x.getColumn(c,2,this.up),f.cross(this.direction,this.up,this.right));this._setTransform(e)}else c=b,d=e,e=D.clone(this.transform,Ga),this._setTransform(D.IDENTITY),f.equals(c,this.positionWC)||(d&&(d=this._projection,c=d.ellipsoid.cartesianToCartographic(c,Ua),c=d.project(c,Ea)),f.clone(c,this.position)),Ma.heading-=z.PI_OVER_TWO,c=I.fromHeadingPitchRoll(Ma,ya),c=x.fromQuaternion(c,Aa),x.getColumn(c,0,this.direction),x.getColumn(c,2,this.up),f.cross(this.direction,this.up,this.right),this._setTransform(e),this._adjustOrthographicFrustum(!0)}};var Ia=new f;K.prototype.flyHome=function(a){var b=this._mode;b===L.MORPHING&&this._scene.completeMorph();if(b===L.SCENE2D)this.flyTo({destination:K.DEFAULT_VIEW_RECTANGLE,duration:a,endTransform:D.IDENTITY});else if(b===L.SCENE3D){var b=this.getRectangleCameraCoordinates(K.DEFAULT_VIEW_RECTANGLE),c=f.magnitude(b),c=c+c*K.DEFAULT_VIEW_FACTOR;f.normalize(b,b);f.multiplyByScalar(b,c,b);this.flyTo({destination:b,duration:a,endTransform:D.IDENTITY})}else b===L.COLUMBUS_VIEW&&(b=this._projection.ellipsoid.maximumRadius,c=new f(0,-1,1),c=f.multiplyByScalar(f.normalize(c,c),5*b,c),this.flyTo({destination:c,duration:a,orientation:{heading:0,pitch:-Math.acos(f.normalize(c,Ia).z),roll:0},endTransform:D.IDENTITY,convert:!1}))};K.prototype.worldToCameraCoordinates=function(a,b){if(!m(a))throw new h("cartesian is required.");m(b)||(b=new k);N(this);return D.multiplyByVector(this._actualInvTransform,a,b)};K.prototype.worldToCameraCoordinatesPoint=function(a,b){if(!m(a))throw new h("cartesian is required.");m(b)||(b=new f);N(this);return D.multiplyByPoint(this._actualInvTransform,a,b)};K.prototype.worldToCameraCoordinatesVector=function(a,b){if(!m(a))throw new h("cartesian is required.");m(b)||(b=new f);N(this);return D.multiplyByPointAsVector(this._actualInvTransform,a,b)};K.prototype.cameraToWorldCoordinates=function(a,b){if(!m(a))throw new h("cartesian is required.");m(b)||(b=new k);N(this);return D.multiplyByVector(this._actualTransform,a,b)};K.prototype.cameraToWorldCoordinatesPoint=function(a,b){if(!m(a))throw new h("cartesian is required.");m(b)||(b=new f);N(this);return D.multiplyByPoint(this._actualTransform,a,b)};K.prototype.cameraToWorldCoordinatesVector=function(a,b){if(!m(a))throw new h("cartesian is required.");m(b)||(b=new f);N(this);return D.multiplyByPointAsVector(this._actualTransform,a,b)};var La=new f;K.prototype.move=function(a,b){if(!m(a))throw new h("direction is required.");var c=this.position;f.multiplyByScalar(a,b,La);f.add(c,La,c);this._mode===L.SCENE2D&&U(this,c);this._adjustOrthographicFrustum(!0)};K.prototype.moveForward=function(a){a=l(a,this.defaultMoveAmount);this._mode===L.SCENE2D?R(this,a):this.move(this.direction,a)};K.prototype.moveBackward=function(a){a=l(a,this.defaultMoveAmount);this._mode===L.SCENE2D?R(this,-a):this.move(this.direction,-a)};K.prototype.moveUp=function(a){a=l(a,this.defaultMoveAmount);this.move(this.up,a)};K.prototype.moveDown=function(a){a=l(a,this.defaultMoveAmount);this.move(this.up,-a)};K.prototype.moveRight=function(a){a=l(a,this.defaultMoveAmount);this.move(this.right,a)};K.prototype.moveLeft=function(a){a=l(a,this.defaultMoveAmount);this.move(this.right,-a)};K.prototype.lookLeft=function(a){a=l(a,this.defaultLookAmount);this._mode!==L.SCENE2D&&this.look(this.up,-a)};K.prototype.lookRight=function(a){a=l(a,this.defaultLookAmount);this._mode!==L.SCENE2D&&this.look(this.up,a)};K.prototype.lookUp=function(a){a=l(a,this.defaultLookAmount);this._mode!==L.SCENE2D&&this.look(this.right,-a)};K.prototype.lookDown=function(a){a=l(a,this.defaultLookAmount);this._mode!==L.SCENE2D&&this.look(this.right,a)};var Fa=new I,Ja=new x;K.prototype.look=function(a,b){if(!m(a))throw new h("axis is required.");var c=l(b,this.defaultLookAmount),c=I.fromAxisAngle(a,-c,Fa),c=x.fromQuaternion(c,Ja),d=this.direction,e=this.up,f=this.right;x.multiplyByVector(c,d,d);x.multiplyByVector(c,e,e);x.multiplyByVector(c,f,f)};K.prototype.twistLeft=function(a){a=l(a,this.defaultLookAmount);this.look(this.direction,a)};K.prototype.twistRight=function(a){a=l(a,this.defaultLookAmount);this.look(this.direction,-a)};var Qa=new I,va=new x;K.prototype.rotate=function(a,b){if(!m(a))throw new h("axis is required.");var c=l(b,this.defaultRotateAmount),c=I.fromAxisAngle(a,-c,Qa),c=x.fromQuaternion(c,va);x.multiplyByVector(c,this.position,this.position);x.multiplyByVector(c,this.direction,this.direction);x.multiplyByVector(c,this.up,this.up);f.cross(this.direction,this.up,this.right);f.cross(this.right,this.direction,this.up);this._adjustOrthographicFrustum(!1)};K.prototype.rotateDown=function(a){a=l(a,this.defaultRotateAmount);W(this,a)};K.prototype.rotateUp=function(a){a=l(a,this.defaultRotateAmount);W(this,-a)};var Sa=new f,Oa=new f,Ta=new f,Ka=new f;K.prototype.rotateRight=function(a){a=l(a,this.defaultRotateAmount);M(this,-a)};K.prototype.rotateLeft=function(a){a=l(a,this.defaultRotateAmount);M(this,a)};K.prototype.zoomIn=function(a){a=l(a,this.defaultZoomAmount);this._mode===L.SCENE2D?R(this,a):this.move(this.direction,a)};K.prototype.zoomOut=function(a){a=l(a,this.defaultZoomAmount);this._mode===L.SCENE2D?R(this,-a):this.move(this.direction,-a)};K.prototype.getMagnitude=function(){if(this._mode===L.SCENE3D)return f.magnitude(this.position);if(this._mode===L.COLUMBUS_VIEW)return Math.abs(this.position.z);if(this._mode===L.SCENE2D)return Math.max(this.frustum.right-this.frustum.left,this.frustum.top-this.frustum.bottom)};var Wa=new D;K.prototype.lookAt=function(a,b){if(!m(a))throw new h("target is required");if(!m(b))throw new h("offset is required");if(this._mode===L.MORPHING)throw new h("lookAt is not supported while morphing.");var c=w.eastNorthUpToFixedFrame(a,d.WGS84,Wa);this.lookAtTransform(c,b)};var Ra=new f,Nb=new I,hb=new I,Hb=new x;K.prototype.lookAtTransform=function(b,c){if(!m(b))throw new h("transform is required");if(this._mode===L.MORPHING)throw new h("lookAtTransform is not supported while morphing.");this._setTransform(b);if(m(c)){var d;d=m(c.heading)?Y(c.heading,c.pitch,c.range):c;if(this._mode===L.SCENE2D){a.clone(a.ZERO,this.position);f.negate(d,this.up);this.up.z=0;f.magnitudeSquared(this.up)<z.EPSILON10&&f.clone(f.UNIT_Y,this.up);f.normalize(this.up,this.up);this._setTransform(D.IDENTITY);f.negate(f.UNIT_Z,this.direction);f.cross(this.direction,this.up,this.right);f.normalize(this.right,this.right);var e=this.frustum,g=e.top/e.right;e.right=.5*f.magnitude(d);e.left=-e.right;e.top=g*e.right;e.bottom=-e.top;this._setTransform(b)}else f.clone(d,this.position),f.negate(this.position,this.direction),f.normalize(this.direction,this.direction),f.cross(this.direction,f.UNIT_Z,this.right),f.magnitudeSquared(this.right)<z.EPSILON10&&f.clone(f.UNIT_X,this.right),f.normalize(this.right,this.right),f.cross(this.right,this.direction,this.up),f.normalize(this.up,this.up),this._adjustOrthographicFrustum(!0)}};var db=new g,tb=new g,Pa=new f,cc=new f,sc=new f,Za=new f,tc=new f,wc=new f,Xb=new f,dc=new f,ja={direction:new f,right:new f,up:new f},uc,ec=new g,ad=new f,Dc=new f,fc=new g,pb=new f,Vc=new f;K.prototype.getRectangleCameraCoordinates=function(a,b){if(!m(a))throw new h("rectangle is required");var c=this._mode;m(b)||(b=new f);if(c===L.SCENE3D)return S(this,a,b);if(c===L.COLUMBUS_VIEW){var d=a,c=b,e=this._projection;d.west>d.east&&(d=J.MAX_VALUE);var g=this._actualTransform,k=this._actualInvTransform;ec.longitude=d.east;ec.latitude=d.north;var l=e.project(ec,ad);D.multiplyByPoint(g,l,l);D.multiplyByPoint(k,l,l);ec.longitude=d.west;ec.latitude=d.south;d=e.project(ec,Dc);D.multiplyByPoint(g,d,d);D.multiplyByPoint(k,d,d);c.x=.5*(l.x-d.x)+d.x;c.y=.5*(l.y-d.y)+d.y;m(this.frustum.fovy)?(g=Math.tan(.5*this.frustum.fovy),c.z=.5*Math.max((l.x-d.x)/(this.frustum.aspectRatio*g),(l.y-d.y)/g)):c.z=Math.max(l.x-d.x,l.y-d.y);return c}if(c===L.SCENE2D){d=a;c=b;l=this._projection;d.west>d.east&&(d=J.MAX_VALUE);g=fc;g.longitude=d.east;g.latitude=d.north;k=l.project(g,pb);g.longitude=d.west;g.latitude=d.south;var d=l.project(g,Vc),p=.5*Math.abs(k.x-d.x),q=.5*Math.abs(k.y-d.y),r,e=this.frustum.right/this.frustum.top;r=q*e;p>r?(r=p,e=r/e):e=q;q=Math.max(2*r,2*e);c.x=.5*(k.x-d.x)+d.x;c.y=.5*(k.y-d.y)+d.y;g=l.unproject(c,g);g.height=q;return c=l.project(g,c)}};var xc=new H,Kc=new H,Lc=new H;K.prototype.pickEllipsoid=function(a,b,c){if(!m(a))throw new h("windowPosition is required.");var e=this._scene.canvas;if(0!==e.clientWidth&&0!==e.clientHeight){m(c)||(c=new f);b=l(b,d.WGS84);if(this._mode===L.SCENE3D)b=l(b,d.WGS84),a=this.getPickRay(a,xc),c=(b=A.rayEllipsoid(a,b))?H.getPoint(a,0<b.start?b.start:b.stop,c):void 0;else if(this._mode===L.SCENE2D)b=this._projection,a=this.getPickRay(a,Kc).origin,a=f.fromElements(a.y,a.z,0,a),a=b.unproject(a),c=a.latitude<-z.PI_OVER_TWO||a.latitude>z.PI_OVER_TWO?void 0:b.ellipsoid.cartographicToCartesian(a,c);else if(this._mode===L.COLUMBUS_VIEW)b=this._projection,a=this.getPickRay(a,Lc),H.getPoint(a,-a.origin.x/a.direction.x,c),a=b.unproject(new f(c.y,c.z,0)),c=a.latitude<-z.PI_OVER_TWO||a.latitude>z.PI_OVER_TWO||a.longitude<-Math.PI||a.longitude>Math.PI?void 0:b.ellipsoid.cartographicToCartesian(a,c);else return;return c}};var Oc=new f,ed=new f,Rc=new f,Pc=new f;K.prototype.getPickRay=function(a,b){if(!m(a))throw new h("windowPosition is required.");m(b)||(b=new H);var c=this.frustum;if(m(c.aspectRatio)&&m(c.fov)&&m(c.near)){var c=b,d=this._scene.canvas,e=d.clientHeight,g=Math.tan(.5*this.frustum.fovy),k=this.frustum.aspectRatio*g,l=this.frustum.near,p=2/d.clientWidth*a.x-1,q=2/e*(e-a.y)-1,e=this.positionWC;f.clone(e,c.origin);d=f.multiplyByScalar(this.directionWC,l,Oc);f.add(e,d,d);k=f.multiplyByScalar(this.rightWC,p*l*k,ed);g=f.multiplyByScalar(this.upWC,q*l*g,Rc);l=f.add(d,k,c.direction);f.add(l,g,l);f.subtract(l,e,l);f.normalize(l,l);return c}c=b;g=this._scene.canvas;l=g.clientWidth;e=g.clientHeight;g=this.frustum;m(g._offCenterFrustum)&&(g=g._offCenterFrustum);l=2/l*a.x-1;l*=.5*(g.right-g.left);e=2/e*(e-a.y)-1;e*=.5*(g.top-g.bottom);g=c.origin;f.clone(this.position,g);f.multiplyByScalar(this.right,l,Pc);f.add(Pc,g,g);f.multiplyByScalar(this.up,e,Pc);f.add(Pc,g,g);f.clone(this.directionWC,c.direction);this._mode!==L.COLUMBUS_VIEW&&this._mode!==L.SCENE2D||f.fromElements(c.origin.z,c.origin.x,c.origin.y,c.origin);return c};var bd=new f,Mc=new f;K.prototype.distanceToBoundingSphere=function(a){if(!m(a))throw new h("boundingSphere is required.");var b=f.subtract(this.positionWC,a.center,bd),b=f.multiplyByScalar(this.directionWC,f.dot(b,this.directionWC),Mc);return Math.max(0,f.magnitude(b)-a.radius)};var Yb=new a;K.prototype.getPixelSize=function(a,b,c){if(!m(a))throw new h("boundingSphere is required.");if(!m(b))throw new h("drawingBufferWidth is required.");if(!m(c))throw new h("drawingBufferHeight is required.");a=this.distanceToBoundingSphere(a);b=this.frustum.getPixelDimensions(b,c,a,Yb);return Math.max(b.x,b.y)};var Sc=new f,ab=new f,Ab=new f,qb=new f;K.prototype.createCorrectPositionTween=function(a){if(!m(a))throw new h("duration is required.");if(this._mode===L.COLUMBUS_VIEW){a:{var b=this.position,c=this.direction,d=this.worldToCameraCoordinatesVector(f.UNIT_X,Sc),d=-f.dot(d,b)/f.dot(d,c),c=f.add(b,f.multiplyByScalar(c,d,ab),ab);this.cameraToWorldCoordinatesPoint(c,c);var b=this.cameraToWorldCoordinatesPoint(this.position,Ab),d=Math.tan(.5*this.frustum.fovy),e=this.frustum.aspectRatio*d,g=f.magnitude(f.subtract(b,c,qb)),k=this._maxCoord.x,l=this._maxCoord.y,e=Math.max(e*g-k,k),d=Math.max(d*g-l,l);if(b.z<-e||b.z>e||b.y<-d||b.y>d)if(g=c.z<-d||c.z>d,c.y<-e||c.y>e||g){a=ca(this,b,c,e,d,a);break a}a=void 0}return a}};var yc=new f,vb={destination:void 0,heading:void 0,pitch:void 0,roll:void 0,duration:void 0,complete:void 0,cancel:void 0,endTransform:void 0,maximumHeight:void 0,easingFunction:void 0};K.prototype.cancelFlight=function(){m(this._currentFlight)&&(this._currentFlight.cancelTween(),this._currentFlight=void 0)};K.prototype.flyTo=function(a){a=l(a,l.EMPTY_OBJECT);var b=a.destination;if(!m(b))throw new h("destination is required.");if(this._mode!==L.MORPHING){this.cancelFlight();var c=l(a.orientation,l.EMPTY_OBJECT);m(c.direction)&&(c=aa(this,b,c,Ha.orientation));if(m(a.duration)&&0>=a.duration)Ha.destination=a.destination,Ha.orientation.heading=c.heading,Ha.orientation.pitch=c.pitch,Ha.orientation.roll=c.roll,Ha.convert=a.convert,Ha.endTransform=a.endTransform,this.setView(Ha),"function"===typeof a.complete&&a.complete();else{var d=m(b.west);d&&(b=this.getRectangleCameraCoordinates(b,yc));var e=this,f;vb.destination=b;vb.heading=c.heading;vb.pitch=c.pitch;vb.roll=c.roll;vb.duration=a.duration;vb.complete=function(){f===e._currentFlight&&(e._currentFlight=void 0);m(a.complete)&&a.complete()};vb.cancel=a.cancel;vb.endTransform=a.endTransform;vb.convert=d?!1:a.convert;vb.maximumHeight=a.maximumHeight;vb.pitchAdjustHeight=a.pitchAdjustHeight;vb.flyOverLongitude=a.flyOverLongitude;vb.flyOverLongitudeWeight=a.flyOverLongitudeWeight;vb.easingFunction=a.easingFunction;d=this._scene;this._currentFlight=f=d.tweens.add(G.createTween(d,vb));d=this._scene.preloadFlightCamera;this._mode!==L.SCENE2D?(m(d)||(d=K.clone(this)),d.setView({destination:b,orientation:c}),this._scene.preloadFlightCullingVolume=d.frustum.computeCullingVolume(d.positionWC,d.directionWC,d.upWC)):d=void 0}}};K.prototype.viewBoundingSphere=function(a,b){if(!m(a))throw new h("boundingSphere is required.");if(this._mode===L.MORPHING)throw new h("viewBoundingSphere is not supported while morphing.");b=T(this,a,b);this.lookAt(a.center,b)};var vc=new D,ma=new f,Ib=new f,ib=new f,zc=new f,Bc=new k,Ec=new I,nc=new x;K.prototype.flyToBoundingSphere=function(a,b){if(!m(a))throw new h("boundingSphere is required.");b=l(b,l.EMPTY_OBJECT);var c=this._mode===L.SCENE2D||this._mode===L.COLUMBUS_VIEW;this._setTransform(D.IDENTITY);var e=T(this,a,b.offset),g;g=c?f.multiplyByScalar(f.UNIT_Z,e.range,ma):Y(e.heading,e.pitch,e.range);var k=w.eastNorthUpToFixedFrame(a.center,d.WGS84,vc);D.multiplyByPoint(k,g,g);var p,q;c||(p=f.subtract(a.center,g,Ib),f.normalize(p,p),q=D.multiplyByPointAsVector(k,f.UNIT_Z,ib),1-Math.abs(f.dot(p,q))<z.EPSILON6&&(c=I.fromAxisAngle(p,e.heading,Ec),c=x.fromQuaternion(c,nc),f.fromCartesian4(D.getColumn(k,1,Bc),q),x.multiplyByVector(c,q,q)),k=f.cross(p,q,zc),f.cross(k,p,q),f.normalize(q,q));this.flyTo({destination:g,orientation:{direction:p,up:q},duration:b.duration,complete:b.complete,cancel:b.cancel,endTransform:b.endTransform,maximumHeight:b.maximumHeight,easingFunction:b.easingFunction,flyOverLongitude:b.flyOverLongitude,flyOverLongitudeWeight:b.flyOverLongitudeWeight,pitchAdjustHeight:b.pitchAdjustHeight})};var gc=new f,hc=new f,Fc=new f,mb=new f,gb=[new f,new f,new f,new f],Zb=new a,Gc=new f,Na=[new g,new g,new g,new g];K.prototype.computeViewRectangle=function(a,c){a=l(a,d.WGS84);var e=this.frustum.computeCullingVolume(this.positionWC,this.directionWC,this.upWC),g=new b(f.ZERO,a.maximumRadius);if(e.computeVisibility(g)!==y.OUTSIDE){var g=this._scene.canvas,e=g.clientWidth,g=g.clientHeight,h=0,k=a.radii,m=f.multiplyComponents(a.oneOverRadii,this.positionWC,gc),p=f.magnitude(m),q=f.normalize(m,hc),r,t;f.equalsEpsilon(q,f.UNIT_Z,z.EPSILON10)?(r=new f(0,1,0),t=new f(0,0,1)):(r=f.normalize(f.cross(f.UNIT_Z,q,Fc),Fc),t=f.normalize(f.cross(q,r,mb),mb));m=Math.sqrt(f.magnitudeSquared(m)-1);q=f.multiplyByScalar(q,1/p,gc);p=m/p;r=f.multiplyByScalar(r,p,hc);t=f.multiplyByScalar(t,p,Fc);p=f.add(q,t,gb[0]);f.subtract(p,r,p);f.multiplyComponents(k,p,p);p=f.subtract(q,t,gb[1]);f.subtract(p,r,p);f.multiplyComponents(k,p,p);p=f.subtract(q,t,gb[2]);f.add(p,r,p);f.multiplyComponents(k,p,p);q=f.add(q,t,gb[3]);f.add(q,r,q);f.multiplyComponents(k,q,q);h+=da(0,0,0,this,a,gb);h+=da(0,g,1,this,a,gb);h+=da(e,g,2,this,a,gb);h+=da(e,0,3,this,a,gb);if(2>h)return J.MAX_VALUE;c=J.fromCartographicArray(Na,c);e=0;k=Na[3].longitude;for(g=0;4>g;++g)h=Na[g].longitude,k=Math.abs(h-k),e=k>z.PI?e+(z.TWO_PI-k):e+k,k=h;z.equalsEpsilon(Math.abs(e),z.TWO_PI,z.EPSILON9)&&(c.west=-z.PI,c.east=z.PI,0<=Na[0].latitude?c.north=z.PI_OVER_TWO:c.south=-z.PI_OVER_TWO);return c}};K.prototype.switchToPerspectiveFrustum=function(){if(!(this._mode===L.SCENE2D||this.frustum instanceof C)){var a=this._scene;this.frustum=new C;this.frustum.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight;this.frustum.fov=z.toRadians(60)}};K.prototype.switchToOrthographicFrustum=function(){if(!(this._mode===L.SCENE2D||this.frustum instanceof v)){var a=this._scene;this.frustum=new v;this.frustum.aspectRatio=a.drawingBufferWidth/a.drawingBufferHeight;this.frustum.width=f.magnitude(this.position);m(this.frustum.projectionMatrix)&&this._adjustOrthographicFrustum(!0)}};K.clone=function(a,b){m(b)||(b=new K(a._scene));f.clone(a.position,b.position);f.clone(a.direction,b.direction);f.clone(a.up,b.up);f.clone(a.right,b.right);D.clone(a._transform,b.transform);b._transformChanged=!0;b.frustum=a.frustum.clone();return b};return K});F("Scene/CameraEventType",["../Core/freezeObject"],function(b){return b({LEFT_DRAG:0,RIGHT_DRAG:1,MIDDLE_DRAG:2,WHEEL:3,PINCH:4})});F("Scene/CameraEventAggregator","../Core/Cartesian2 ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/KeyboardEventModifier ../Core/Math ../Core/ScreenSpaceEventHandler ../Core/ScreenSpaceEventType ./CameraEventType".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(b,c){var d=b;a(c)&&(d+="+"+c);return d}function q(c,e,f){var g=d(p.PINCH,e),k=c._update,l=c._isDown,m=c._eventStartPosition,q=c._pressTime,r=c._releaseTime;k[g]=!0;l[g]=!1;m[g]=new b;var t=c._movement[g];a(t)||(t=c._movement[g]={});t.distance={startPosition:new b,endPosition:new b};t.angleAndHeight={startPosition:new b,endPosition:new b};t.prevAngle=0;c._eventHandler.setInputAction(function(a){c._buttonsDown++;l[g]=!0;q[g]=new Date;b.lerp(a.position1,a.position2,.5,m[g])},h.PINCH_START,e);c._eventHandler.setInputAction(function(){c._buttonsDown=Math.max(c._buttonsDown-1,0);l[g]=!1;r[g]=new Date},h.PINCH_END,e);c._eventHandler.setInputAction(function(a){if(l[g]){if(k[g]){var c=t;b.clone(a.distance.startPosition,c.distance.startPosition);b.clone(a.distance.endPosition,c.distance.endPosition);b.clone(a.angleAndHeight.startPosition,c.angleAndHeight.startPosition);b.clone(a.angleAndHeight.endPosition,c.angleAndHeight.endPosition);k[g]=!1;t.prevAngle=t.angleAndHeight.startPosition.x}else b.clone(a.distance.endPosition,t.distance.endPosition),b.clone(a.angleAndHeight.endPosition,t.angleAndHeight.endPosition);a=t.angleAndHeight.endPosition.x;for(var c=t.prevAngle,d=2*Math.PI;a>=c+Math.PI;)a-=d;for(;a<c-Math.PI;)a+=d;t.angleAndHeight.endPosition.x=-a*f.clientWidth/12;t.angleAndHeight.startPosition.x=-c*f.clientWidth/12}},h.PINCH_MOVE,e)}function t(c,e){var f=d(p.WHEEL,e),g=c._update;g[f]=!0;var k=c._movement[f];a(k)||(k=c._movement[f]={});k.startPosition=new b;k.endPosition=new b;c._eventHandler.setInputAction(function(a){a=15*m.toRadians(a);g[f]?(b.clone(b.ZERO,k.startPosition),k.endPosition.x=0,k.endPosition.y=a,g[f]=!1):k.endPosition.y+=a},h.WHEEL,e)}function r(c,e,f){var g=d(f,e),k=c._isDown,l=c._eventStartPosition,m=c._pressTime,q=c._releaseTime;k[g]=!1;l[g]=new b;var r=c._lastMovement[g];a(r)||(r=c._lastMovement[g]={startPosition:new b,endPosition:new b,valid:!1});var t,u;f===p.LEFT_DRAG?(t=h.LEFT_DOWN,u=h.LEFT_UP):f===p.RIGHT_DRAG?(t=h.RIGHT_DOWN,u=h.RIGHT_UP):f===p.MIDDLE_DRAG&&(t=h.MIDDLE_DOWN,u=h.MIDDLE_UP);c._eventHandler.setInputAction(function(a){c._buttonsDown++;r.valid=!1;k[g]=!0;m[g]=new Date;b.clone(a.position,l[g])},t,e);c._eventHandler.setInputAction(function(){c._buttonsDown=Math.max(c._buttonsDown-1,0);k[g]=!1;q[g]=new Date},u,e)}function c(c,e){var f=c._update,g=c._movement,k=c._lastMovement,l=c._isDown,m;for(m in p)if(p.hasOwnProperty(m)){var q=p[m];a(q)&&(q=d(q,e),f[q]=!0,a(c._lastMovement[q])||(c._lastMovement[q]={startPosition:new b,endPosition:new b,valid:!1}),a(c._movement[q])||(c._movement[q]={startPosition:new b,endPosition:new b}))}c._eventHandler.setInputAction(function(h){for(var m in p)if(p.hasOwnProperty(m)){var q=p[m];if(a(q)&&(q=d(q,e),l[q]))if(f[q]){var r=g[q],t=k[q];b.clone(r.startPosition,t.startPosition);b.clone(r.endPosition,t.endPosition);k[q].valid=!0;r=h;t=g[q];b.clone(r.startPosition,t.startPosition);b.clone(r.endPosition,t.endPosition);f[q]=!1}else b.clone(h.endPosition,g[q].endPosition)}b.clone(h.endPosition,c._currentMousePosition)},h.MOUSE_MOVE,e)}function u(d){if(!a(d))throw new g("canvas is required.");this._eventHandler=new e(d,!0);this._update={};this._movement={};this._lastMovement={};this._isDown={};this._eventStartPosition={};this._pressTime={};this._releaseTime={};this._buttonsDown=0;this._currentMousePosition=new b;t(this,void 0);q(this,void 0,d);r(this,void 0,p.LEFT_DRAG);r(this,void 0,p.RIGHT_DRAG);r(this,void 0,p.MIDDLE_DRAG);c(this,void 0);for(var f in l)if(l.hasOwnProperty(f)){var h=l[f];a(h)&&(t(this,h),q(this,h,d),r(this,h,p.LEFT_DRAG),r(this,h,p.RIGHT_DRAG),r(this,h,p.MIDDLE_DRAG),c(this,h))}}f(u.prototype,{currentMousePosition:{get:function(){return this._currentMousePosition}},anyButtonDown:{get:function(){var a=!this._update[d(p.WHEEL)]||!this._update[d(p.WHEEL,l.SHIFT)]||!this._update[d(p.WHEEL,l.CTRL)]||!this._update[d(p.WHEEL,l.ALT)];return 0<this._buttonsDown||a}}});u.prototype.isMoving=function(b,c){if(!a(b))throw new g("type is required.");var e=d(b,c);return!this._update[e]};u.prototype.getMovement=function(b,c){if(!a(b))throw new g("type is required.");var e=d(b,c);return this._movement[e]};u.prototype.getLastMovement=function(b,c){if(!a(b))throw new g("type is required.");var e=d(b,c),e=this._lastMovement[e];if(e.valid)return e};u.prototype.isButtonDown=function(b,c){if(!a(b))throw new g("type is required.");var e=d(b,c);return this._isDown[e]};u.prototype.getStartMousePosition=function(b,c){if(!a(b))throw new g("type is required.");if(b===p.WHEEL)return this._currentMousePosition;var e=d(b,c);return this._eventStartPosition[e]};u.prototype.getButtonPressTime=function(b,c){if(!a(b))throw new g("type is required.");var e=d(b,c);return this._pressTime[e]};u.prototype.getButtonReleaseTime=function(b,c){if(!a(b))throw new g("type is required.");var e=d(b,c);return this._releaseTime[e]};u.prototype.reset=function(){for(var a in this._update)this._update.hasOwnProperty(a)&&(this._update[a]=!0)};u.prototype.isDestroyed=function(){return!1};u.prototype.destroy=function(){this._eventHandler=this._eventHandler&&this._eventHandler.destroy();return k(this)};return u});F("Scene/Composite3DTileContent","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/FeatureDetection ../Core/getMagic ../Core/RuntimeError ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e){function h(a,b,d,c,f,g){this._tileset=a;this._tile=b;this._resource=d;this._contents=[];this._readyPromise=e.defer();p(this,c,f,g)}function p(f,g,h,c){h=b(h,0);var k=new Uint8Array(g),p=new DataView(g);h+=d;var q=p.getUint32(h,!0);if(1!==q)throw new m("Only Composite Tile version 1 is supported. Version "+q+" is not.");h+=d;h+=d;q=p.getUint32(h,!0);h+=d;for(var r=[],t=0;t<q;++t){var D=l(k,h),v=p.getUint32(h+2*d,!0),B=c[D];if(a(B))D=B(f._tileset,f._tile,f._resource,g,h),f._contents.push(D),r.push(D.readyPromise);else throw new m("Unknown tile content type, "+D+", inside Composite tile");h+=v}e.all(r).then(function(){f._readyPromise.resolve(f)}).otherwise(function(a){f._readyPromise.reject(a)})}if(!g.supportsTypedArrays())return{};f(h.prototype,{featurePropertiesDirty:{get:function(){for(var a=this._contents,b=a.length,d=0;d<b;++d)if(a[d].featurePropertiesDirty)return!0;return!1},set:function(a){for(var b=this._contents,d=b.length,c=0;c<d;++c)b[c].featurePropertiesDirty=a}},featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){return this._contents}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});var d=Uint32Array.BYTES_PER_ELEMENT;h.prototype.hasProperty=function(a,b){return!1};h.prototype.getFeature=function(a){};h.prototype.applyDebugSettings=function(a,b){for(var d=this._contents,c=d.length,e=0;e<c;++e)d[e].applyDebugSettings(a,b)};h.prototype.applyStyle=function(a){for(var b=this._contents,d=b.length,c=0;c<d;++c)b[c].applyStyle(a)};h.prototype.update=function(a,b){for(var d=this._contents,c=d.length,e=0;e<c;++e)d[e].update(a,b)};h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){for(var a=this._contents,b=a.length,d=0;d<b;++d)a[d].destroy();return k(this)};return h});F("Scene/Vector3DTileGeometry","../Core/arraySlice ../Core/BoundingSphere ../Core/Cartesian3 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Matrix4 ../Core/TaskProcessor ../ThirdParty/when ./ClassificationType ./Vector3DTileBatch ./Vector3DTilePrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a){this._boxes=a.boxes;this._boxBatchIds=a.boxBatchIds;this._cylinders=a.cylinders;this._cylinderBatchIds=a.cylinderBatchIds;this._ellipsoids=a.ellipsoids;this._ellipsoidBatchIds=a.ellipsoidBatchIds;this._spheres=a.spheres;this._sphereBatchIds=a.sphereBatchIds;this._modelMatrix=a.modelMatrix;this._batchTable=a.batchTable;this._boundingVolume=a.boundingVolume;this._center=a.center;l(this._center)||(l(this._boundingVolume)?this._center=f.clone(this._boundingVolume.center):this._center=f.clone(f.ZERO));this._packedBuffer=this._batchTableColors=this._batchIds=this._vertexBatchIds=this._positions=this._indexCounts=this._indexOffsets=this._indices=this._batchedIndices=this._boundingVolumes=void 0;this._ready=!1;this._readyPromise=d.defer();this._primitive=this._verticesPromise=void 0;this.forceRebatch=this.debugWireframe=!1;this.classificationType=q.BOTH}function u(a){var b=new Float64Array(h.packedLength+f.packedLength),c=0;f.pack(a._center,b,c);c+=f.packedLength;h.pack(a._modelMatrix,b,c);return b}function y(c){if(!l(c._primitive)){if(!l(c._verticesPromise)){var d=c._boxes,e=c._boxBatchIds,f=c._cylinders,h=c._cylinderBatchIds,m=c._ellipsoids,p=c._ellipsoidBatchIds,q=c._spheres,w=c._sphereBatchIds,y=c._batchTableColors,E=c._packedBuffer;if(!l(y)){var x=0;l(c._boxes)&&(d=c._boxes=b(d),e=c._boxBatchIds=b(e),x+=e.length);l(c._cylinders)&&(f=c._cylinders=b(f),h=c._cylinderBatchIds=b(h),x+=h.length);l(c._ellipsoids)&&(m=c._ellipsoids=b(m),p=c._ellipsoidBatchIds=b(p),x+=p.length);l(c._spheres)&&(q=c._sphere=b(q),w=c._sphereBatchIds=b(w),x+=w.length);for(var y=c._batchTableColors=new Uint32Array(x),E=c._batchTable,K=0;K<x;++K){var F=E.getColor(K,z);y[K]=F.toRgba()}E=c._packedBuffer=u(c)}x=[];l(d)&&x.push(d.buffer,e.buffer);l(f)&&x.push(f.buffer,h.buffer);l(m)&&x.push(m.buffer,p.buffer);l(q)&&x.push(q.buffer,w.buffer);x.push(y.buffer,E.buffer);d={boxes:l(d)?d.buffer:void 0,boxBatchIds:l(d)?e.buffer:void 0,cylinders:l(f)?f.buffer:void 0,cylinderBatchIds:l(f)?h.buffer:void 0,ellipsoids:l(m)?m.buffer:void 0,ellipsoidBatchIds:l(m)?p.buffer:void 0,spheres:l(q)?q.buffer:void 0,sphereBatchIds:l(q)?w.buffer:void 0,batchTableColors:y.buffer,packedBuffer:E.buffer};d=c._verticesPromise=A.scheduleTask(d,x);if(!l(d))return;d.then(function(b){for(var d=new Float64Array(b.packedBuffer),e=0,f=d[e++],g=d[e++],h=c._boundingVolumes=Array(g),l=0;l<g;++l)h[l]=a.unpack(d,e),e+=a.packedLength;g=d[e++];h=c._batchedIndices=Array(g);for(l=0;l<g;++l){for(var m=k.unpack(d,e),e=e+k.packedLength,p=d[e++],q=d[e++],r=d[e++],w=Array(r),u=0;u<r;++u)w[u]=d[e++];h[l]=new t({color:m,offset:p,count:q,batchIds:w})}c._indices=2===f?new Uint16Array(b.indices):new Uint32Array(b.indices);c._indexOffsets=new Uint32Array(b.indexOffsets);c._indexCounts=new Uint32Array(b.indexCounts);c._positions=new Float32Array(b.positions);c._vertexBatchIds=new Uint16Array(b.vertexBatchIds);c._batchIds=new Uint16Array(b.batchIds);c._ready=!0})}c._ready&&!l(c._primitive)&&(c._primitive=new r({batchTable:c._batchTable,positions:c._positions,batchIds:c._batchIds,vertexBatchIds:c._vertexBatchIds,indices:c._indices,indexOffsets:c._indexOffsets,indexCounts:c._indexCounts,batchedIndices:c._batchedIndices,boundingVolume:c._boundingVolume,boundingVolumes:c._boundingVolumes,center:c._center,pickObject:g(c._pickObject,c)}),c._boxes=void 0,c._boxBatchIds=void 0,c._cylinders=void 0,c._cylinderBatchIds=void 0,c._ellipsoids=void 0,c._ellipsoidBatchIds=void 0,c._spheres=void 0,c._sphereBatchIds=void 0,c._center=void 0,c._modelMatrix=void 0,c._batchTable=void 0,c._boundingVolume=void 0,c._boundingVolumes=void 0,c._batchedIndices=void 0,c._indices=void 0,c._indexOffsets=void 0,c._indexCounts=void 0,c._positions=void 0,c._vertexBatchIds=void 0,c._batchIds=void 0,c._batchTableColors=void 0,c._packedBuffer=void 0,c._verticesPromise=void 0,c._readyPromise.resolve())}}m(c.prototype,{trianglesLength:{get:function(){return l(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return l(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});c.packedBoxLength=h.packedLength+f.packedLength;c.packedCylinderLength=h.packedLength+2;c.packedEllipsoidLength=h.packedLength+f.packedLength;c.packedSphereLength=f.packedLength+1;var A=new p("createVectorTileGeometries"),z=new k;c.prototype.createFeatures=function(a,b){this._primitive.createFeatures(a,b)};c.prototype.applyDebugSettings=function(a,b){this._primitive.applyDebugSettings(a,b)};c.prototype.applyStyle=function(a,b){this._primitive.applyStyle(a,b)};c.prototype.updateCommands=function(a,b){this._primitive.updateCommands(a,b)};c.prototype.update=function(a){y(this);this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(a))};c.prototype.isDestroyed=function(){return!1};c.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();return e(this)};return c});F("Scene/Geometry3DTileContent","../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Ellipsoid ../Core/FeatureDetection ../Core/getMagic ../Core/getStringFromTypedArray ../Core/Math ../Core/Matrix4 ../Core/Rectangle ../Core/RuntimeError ../ThirdParty/when ./Cesium3DTileBatchTable ./Vector3DTileGeometry".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(d,e,g,h,k){var l,m,t,v;this._tileset=d;this._tile=e;this._resource=g;this._contentReadyPromise=this._geometries=void 0;this._readyPromise=c.defer();this._features=this._batchTable=void 0;this.featurePropertiesDirty=!1;g=a(k,0);k=new Uint8Array(h);d=new DataView(h);g+=D;e=d.getUint32(g,!0);if(1!==e)throw new r("Only Geometry tile version 1 is supported.  Version "+e+" is not.");g+=D;e=d.getUint32(g,!0);g+=D;if(0===e)this._readyPromise.resolve(this);else{e=d.getUint32(g,!0);g+=D;if(0===e)throw new r("Feature table must have a byte length greater than zero");var C=d.getUint32(g,!0);g+=D;var A=d.getUint32(g,!0);g+=D;var B=d.getUint32(g,!0);g+=D;d=p(k,g,e);d=JSON.parse(d);g+=e;e=new Uint8Array(h,g,C);g+=C;var H,x;0<A&&(H=p(k,g,A),H=JSON.parse(H),g+=A,0<B&&(x=new Uint8Array(h,g,B),x=new Uint8Array(x)));h=a(d.BOXES_LENGTH,0);g=a(d.CYLINDERS_LENGTH,0);k=a(d.ELLIPSOIDS_LENGTH,0);A=a(d.SPHERES_LENGTH,0);C=h+g+k+A;this._batchTable=x=new u(this,C,H,x,z(this));if(0!==C){H=this.tile.computedTransform;var I;f(d.RTC_CENTER)&&(I=b.unpack(d.RTC_CENTER),q.multiplyByPoint(H,I,I));var F,C=a(d.BOXES_LENGTH,0),B=a(d.CYLINDERS_LENGTH,0),U=a(d.ELLIPSOIDS_LENGTH,0),W=a(d.SPHERES_LENGTH,0);0<C&&f(d.BOX_BATCH_IDS)&&(l=new Uint16Array(e.buffer,e.byteOffset+d.BOX_BATCH_IDS.byteOffset,C));0<B&&f(d.CYLINDER_BATCH_IDS)&&(m=new Uint16Array(e.buffer,e.byteOffset+d.CYLINDER_BATCH_IDS.byteOffset,B));0<U&&f(d.ELLIPSOID_BATCH_IDS)&&(t=new Uint16Array(e.buffer,e.byteOffset+d.ELLIPSOID_BATCH_IDS.byteOffset,U));0<W&&f(d.SPHERE_BATCH_IDS)&&(v=new Uint16Array(e.buffer,e.byteOffset+d.SPHERE_BATCH_IDS.byteOffset,W));F=f(l)||f(m)||f(t)||f(v);var M=0<C&&!f(l)||0<B&&!f(m)||0<U&&!f(t)||0<W&&!f(v);if(F&&M)throw new r("If one group of batch ids is defined, then all batch ids must be defined.");if(!(f(l)||f(m)||f(t)||f(v))){M=0;if(!f(l)&&0<C)for(l=new Uint16Array(C),F=0;F<C;++F)l[F]=M++;if(!f(m)&&0<B)for(m=new Uint16Array(B),F=0;F<B;++F)m[F]=M++;if(!f(t)&&0<U)for(t=new Uint16Array(U),F=0;F<U;++F)t[F]=M++;if(!f(v)&&0<W)for(v=new Uint16Array(W),F=0;F<W;++F)v[F]=M++}if(0<h||0<g||0<k||0<A){var R,Y,Q,S;0<h&&(R=new Float32Array(e.buffer,e.byteOffset+d.BOXES.byteOffset,y.packedBoxLength*h));0<g&&(Y=new Float32Array(e.buffer,e.byteOffset+d.CYLINDERS.byteOffset,y.packedCylinderLength*g));0<k&&(Q=new Float32Array(e.buffer,e.byteOffset+d.ELLIPSOIDS.byteOffset,y.packedEllipsoidLength*k));0<A&&(S=new Float32Array(e.buffer,e.byteOffset+d.SPHERES.byteOffset,y.packedSphereLength*A));this._geometries=new y({boxes:R,boxBatchIds:l,cylinders:Y,cylinderBatchIds:m,ellipsoids:Q,ellipsoidBatchIds:t,spheres:S,sphereBatchIds:v,center:I,modelMatrix:H,batchTable:x,boundingVolume:this.tile.boundingVolume.boundingVolume})}}}}function z(a){return function(b,c){f(a._geometries)&&a._geometries.updateCommands(b,c)}}function x(a){var b=a.featuresLength;!f(a._features)&&0<b&&(b=Array(b),f(a._geometries)&&a._geometries.createFeatures(a,b),a._features=b)}if(!e.supportsTypedArrays())return{};k(A.prototype,{featuresLength:{get:function(){return f(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return f(this._geometries)?this._geometries.trianglesLength:0}},geometryByteLength:{get:function(){return f(this._geometries)?this._geometries.geometryByteLength:0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return f(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var D=Uint32Array.BYTES_PER_ELEMENT;A.prototype.hasProperty=function(a,b){return this._batchTable.hasProperty(a,b)};A.prototype.getFeature=function(a){var b=this.featuresLength;if(!f(a)||0>a||a>=b)throw new l("batchId is required and between zero and featuresLength - 1 ("+(b-1)+").");x(this);return this._features[a]};A.prototype.applyDebugSettings=function(a,b){f(this._geometries)&&this._geometries.applyDebugSettings(a,b)};A.prototype.applyStyle=function(a){x(this);f(this._geometries)&&this._geometries.applyStyle(a,this._features)};A.prototype.update=function(a,b){f(this._geometries)&&(this._geometries.classificationType=this._tileset.classificationType,this._geometries.debugWireframe=this._tileset.debugWireframe,this._geometries.update(b));f(this._batchTable)&&this._geometries._ready&&this._batchTable.update(a,b);if(!f(this._contentReadyPromise)){var c=this;this._contentReadyPromise=this._geometries.readyPromise.then(function(){c._readyPromise.resolve(c)})}};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){this._geometries=this._geometries&&this._geometries.destroy();this._batchTable=this._batchTable&&this._batchTable.destroy();return g(this)};return A});F("Scene/ModelInstance",["../Core/defineProperties","../Core/Matrix4"],function(b,a){function f(b,f,l){this.primitive=b;this._modelMatrix=a.clone(f);this._instanceId=l}b(f.prototype,{instanceId:{get:function(){return this._instanceId}},model:{get:function(){return this.primitive._model}},modelMatrix:{get:function(){return a.clone(this._modelMatrix)},set:function(b){a.clone(b,this._modelMatrix);this.primitive.expandBoundingSphere(this._modelMatrix);this.primitive._dirty=!0}}});return f});F("Scene/ModelInstanceCollection","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Check ../Core/clone ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Matrix4 ../Core/PrimitiveType ../Core/Resource ../Core/RuntimeError ../Core/Transforms ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/ShaderSource ../ThirdParty/GltfPipeline/ForEach ../ThirdParty/when ./Model ./ModelInstance ./ModelUtility ./SceneMode ./ShadowMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G){function E(d){d=e(d,e.EMPTY_OBJECT);if(!h(d.gltf)&&!h(d.url))throw new q("Either options.gltf or options.url is required.");if(h(d.gltf)&&h(d.url))throw new q("Cannot pass in both options.gltf and options.url.");this.show=e(d.show,!0);this._instancingSupported=!1;this._dynamic=e(d.dynamic,!1);this._allowPicking=e(d.allowPicking,!0);this._ready=!1;this._readyPromise=C.defer();this._state=ka.NEEDS_LOAD;this._dirty=!1;this._cull=e(d.cull,!0);this._opaquePass=e(d.opaquePass,D.OPAQUE);for(var g=d.instances,g=e(g,[]),k=g.length,l=Array(k),m=0;m<k;++m){var p=g[m],r=p.modelMatrix,p=e(p.batchId,m);l[m]=new H(this,r,p)}this._instances=l;this._batchTable=d.batchTable;this._instancedUniformsByProgram=this._batchIdBuffer=this._vertexBuffer=this._vertexBufferTypedArray=this._model=void 0;this._drawCommands=[];this._modelCommands=void 0;g=this.length;k=Array(g);for(l=0;l<g;++l)k[l]=t.getTranslation(this._instances[l]._modelMatrix,new f);this._boundingSphere=b.fromPoints(k);this._center=f.clone(this._boundingSphere.center);this._rtcTransform=new t;this._rtcModelView=new t;this._mode=void 0;this.modelMatrix=t.clone(t.IDENTITY);this._modelMatrix=t.clone(this.modelMatrix);this._url=c.createIfNeeded(d.url);this._requestType=d.requestType;this._gltf=d.gltf;this._basePath=c.createIfNeeded(d.basePath);this._asynchronous=d.asynchronous;this._incrementallyLoadTextures=d.incrementallyLoadTextures;this._upAxis=d.upAxis;this._forwardAxis=d.forwardAxis;this._shadows=this.shadows=e(d.shadows,G.ENABLED);this._pickIdLoaded=d.pickIdLoaded;this.debugShowBoundingVolume=e(d.debugShowBoundingVolume,!1);this._debugShowBoundingVolume=!1;this.debugWireframe=e(d.debugWireframe,!1);this._debugWireframe=!1;this._imageBasedLightingFactor=new a(1,1);a.clone(d.imageBasedLightingFactor,this._imageBasedLightingFactor);this.lightColor=d.lightColor;this.luminanceAtZenith=d.luminanceAtZenith;this.sphericalHarmonicCoefficients=d.sphericalHarmonicCoefficients;this.specularEnvironmentMaps=d.specularEnvironmentMaps}function L(a,b,c,d){return function(e,f){var g=e.semantic;if(h(g)&&-1<a.indexOf(g))if(-1<b.indexOf(g))d[f]=g;else throw new u('Shader program cannot be optimized for instancing. Uniform "'+f+'" in program "'+c+'" uses unsupported semantic "'+g+'"');}}function K(a,b){if(h(a._instancedUniformsByProgram))return a._instancedUniformsByProgram[b];var c={};a._instancedUniformsByProgram=c;var d="MODEL MODELVIEW CESIUM_RTC_MODELVIEW MODELVIEWPROJECTION MODELINVERSE MODELVIEWINVERSE MODELVIEWPROJECTIONINVERSE MODELINVERSETRANSPOSE MODELVIEWINVERSETRANSPOSE".split(" "),e=["MODELVIEW","CESIUM_RTC_MODELVIEW","MODELVIEWPROJECTION","MODELVIEWINVERSETRANSPOSE"],f=a._model._sourceTechniques,g;for(g in f)if(f.hasOwnProperty(g)){var k=f[g],l=k.program;if(!h(c[l])){var m={};c[l]=m;B.techniqueUniform(k,L(d,e,b,m))}}return c[b]}function F(a){return function(b,c){var d=K(a,c),e=h(a._batchTable),f=v.replaceMain(b,"czm_instancing_main"),g="",k="",l;for(l in d)if(d.hasOwnProperty(l)){var m=d[l],p;"MODELVIEW"===m||"CESIUM_RTC_MODELVIEW"===m?p="czm_instanced_modelView":"MODELVIEWPROJECTION"===m?(p="czm_instanced_modelViewProjection",g+="mat4 czm_instanced_modelViewProjection;\n",k+="czm_instanced_modelViewProjection \x3d czm_projection * czm_instanced_modelView;\n"):"MODELVIEWINVERSETRANSPOSE"===m&&(p="czm_instanced_modelViewInverseTranspose",g+="mat3 czm_instanced_modelViewInverseTranspose;\n",k+="czm_instanced_modelViewInverseTranspose \x3d mat3(czm_instanced_modelView);\n");m=new RegExp("uniform.*"+l+".*");f=f.replace(m,"");m=new RegExp(l+"\\b","g");f=f.replace(m,p)}e?(d="attribute float a_batchId;\n",p=l=""):(d="",l="attribute vec4 pickColor;\nvarying vec4 v_pickColor;\n",p="    v_pickColor \x3d pickColor;\n");f="uniform mat4 czm_instanced_modifiedModelView;\nuniform mat4 czm_instanced_nodeTransform;\n"+g+"mat4 czm_instanced_modelView;\nattribute vec4 czm_modelMatrixRow0;\nattribute vec4 czm_modelMatrixRow1;\nattribute vec4 czm_modelMatrixRow2;\n"+d+l+f+"void main()\n{\n    mat4 czm_instanced_model \x3d mat4(czm_modelMatrixRow0.x, czm_modelMatrixRow1.x, czm_modelMatrixRow2.x, 0.0, czm_modelMatrixRow0.y, czm_modelMatrixRow1.y, czm_modelMatrixRow2.y, 0.0, czm_modelMatrixRow0.z, czm_modelMatrixRow1.z, czm_modelMatrixRow2.z, 0.0, czm_modelMatrixRow0.w, czm_modelMatrixRow1.w, czm_modelMatrixRow2.w, 1.0);\n    czm_instanced_modelView \x3d czm_instanced_modifiedModelView * czm_instanced_model * czm_instanced_nodeTransform;\n"+k+"    czm_instancing_main();\n"+p+"}\n";e&&(e=J.getDiffuseAttributeOrUniform(a._model.gltf,c),f=a._batchTable.getVertexShaderCallback(!0,"a_batchId",e)(f));return f}}function N(a){return function(b,c){var d=a._batchTable;if(h(d)){var e=J.getDiffuseAttributeOrUniform(a._model.gltf,c);b=d.getFragmentShaderCallback(!0,e)(b)}else b="varying vec4 v_pickColor;\n"+b;return b}}function O(a,b){return function(){return t.multiply(b.uniformState.view,a._rtcTransform,a._rtcModelView)}}function Z(a){return function(){return a.computedMatrix}}function aa(a,b){return function(c,d,e){c=g(c);c.czm_instanced_modifiedModelView=O(a,b);c.czm_instanced_nodeTransform=Z(e);d=K(a,d);for(var f in d)d.hasOwnProperty(f)&&delete c[f];h(a._batchTable)&&(c=a._batchTable.getUniformMapCallback()(c));return c}}function U(a){return function(b,c){if(h(a._batchTable)){var d=J.getDiffuseAttributeOrUniform(a._model.gltf,c);b=a._batchTable.getVertexShaderCallback(!0,"a_batchId",d)(b);b="uniform float a_batchId\n;"+b}return b}}function W(a){return function(b,c){var d=a._batchTable;if(h(d)){var e=J.getDiffuseAttributeOrUniform(a._model.gltf,c);b=d.getFragmentShaderCallback(!0,e)(b)}else b="uniform vec4 czm_pickColor;\n"+b;return b}}function M(a){return function(b){h(a._batchTable)&&(b=a._batchTable.getUniformMapCallback()(b));return b}}function R(a){var b=a._instances,c=a.length,d=a._center,e=a._vertexBufferTypedArray;h(e)||(e=new Float32Array(12*c));a._dynamic&&(a._vertexBufferTypedArray=e);for(a=0;a<c;++a){var f=t.clone(b[a]._modelMatrix,ia);f[12]-=d.x;f[13]-=d.y;f[14]-=d.z;var g=12*a;e[g+0]=f[0];e[g+1]=f[4];e[g+2]=f[8];e[g+3]=f[12];e[g+4]=f[1];e[g+5]=f[5];e[g+6]=f[9];e[g+7]=f[13];e[g+8]=f[2];e[g+9]=f[6];e[g+10]=f[10];e[g+11]=f[14]}return e}function Y(a){var b=R(a);a._vertexBuffer.copyFromArrayView(b)}function Q(a,b){var c=a._instancingSupported,d=h(a._batchTable),e={url:a._url,requestType:a._requestType,gltf:a._gltf,basePath:a._basePath,shadows:a._shadows,cacheKey:void 0,asynchronous:a._asynchronous,allowPicking:a._allowPicking,incrementallyLoadTextures:a._incrementallyLoadTextures,upAxis:a._upAxis,forwardAxis:a._forwardAxis,precreatedAttributes:void 0,vertexShaderLoaded:void 0,fragmentShaderLoaded:void 0,uniformMapLoaded:void 0,pickIdLoaded:a._pickIdLoaded,ignoreCommands:!0,opaquePass:a._opaquePass,imageBasedLightingFactor:a.imageBasedLightingFactor,lightColor:a.lightColor,luminanceAtZenith:a.luminanceAtZenith,sphericalHarmonicCoefficients:a.sphericalHarmonicCoefficients,specularEnvironmentMaps:a.specularEnvironmentMaps};if(!d){for(var f=a._instances,g=f.length,k=Array(g),p=0;p<g;++p)k[p]=b.createPickId(f[p]);a._pickIds=k}if(c){k=a._instances;g=a.length;c=a._dynamic;if(p=h(a._batchTable)){for(var q=new Uint16Array(g),f=0;f<g;++f)q[f]=k[f]._instanceId;a._batchIdBuffer=A.createVertexBuffer({context:b,typedArray:q,usage:z.STATIC_DRAW})}if(!p){k=new Uint8Array(4*g);for(f=0;f<g;++f)p=a._pickIds[f].color,q=4*f,k[q]=l.floatToByte(p.red),k[q+1]=l.floatToByte(p.green),k[q+2]=l.floatToByte(p.blue),k[q+3]=l.floatToByte(p.alpha);a._pickIdBuffer=A.createVertexBuffer({context:b,typedArray:k,usage:z.STATIC_DRAW})}f=R(a);a._vertexBuffer=A.createVertexBuffer({context:b,typedArray:f,usage:c?z.STREAM_DRAW:z.STATIC_DRAW});c=m.getSizeInBytes(m.FLOAT);c={czm_modelMatrixRow0:{index:0,vertexBuffer:a._vertexBuffer,componentsPerAttribute:4,componentDatatype:m.FLOAT,normalize:!1,offsetInBytes:0,strideInBytes:12*c,instanceDivisor:1},czm_modelMatrixRow1:{index:0,vertexBuffer:a._vertexBuffer,componentsPerAttribute:4,componentDatatype:m.FLOAT,normalize:!1,offsetInBytes:4*c,strideInBytes:12*c,instanceDivisor:1},czm_modelMatrixRow2:{index:0,vertexBuffer:a._vertexBuffer,componentsPerAttribute:4,componentDatatype:m.FLOAT,normalize:!1,offsetInBytes:8*c,strideInBytes:12*c,instanceDivisor:1}};d&&(c.a_batchId={index:0,vertexBuffer:a._batchIdBuffer,componentsPerAttribute:1,componentDatatype:m.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});d||(c.pickColor={index:0,vertexBuffer:a._pickIdBuffer,componentsPerAttribute:4,componentDatatype:m.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0,instanceDivisor:1});e.precreatedAttributes=c;e.vertexShaderLoaded=F(a);e.fragmentShaderLoaded=N(a);e.uniformMapLoaded=aa(a,b);h(a._url)&&(e.cacheKey=a._url.getUrlComponent()+"#instanced")}else e.vertexShaderLoaded=U(a),e.fragmentShaderLoaded=W(a),e.uniformMapLoaded=M(a,b);h(a._url)?a._model=I.fromGltf(e):a._model=new I(e)}function S(a){if(a._debugWireframe!==a.debugWireframe){var b=(a._debugWireframe=a.debugWireframe)?r.LINES:r.TRIANGLES;a=a._drawCommands;for(var c=a.length,d=0;d<c;++d)a[d].primitiveType=b}}function ca(a){if(a.debugShowBoundingVolume!==a._debugShowBoundingVolume){a._debugShowBoundingVolume=a.debugShowBoundingVolume;for(var b=a._drawCommands,c=b.length,d=0;d<c;++d)b[d].debugShowBoundingVolume=a.debugShowBoundingVolume}}function T(a){return function(){return a}}function da(a){return function(){return a}}function V(a){for(var c=a._modelCommands,d=c.length,e=a.length,f=a._rtcTransform,g=a._center,h=0;h<d;++h)for(var k=c[h],l=0;l<e;++l){var m=a._drawCommands[h*e+l],p=t.clone(a._instances[l]._modelMatrix,ia);p[12]-=g.x;p[13]-=g.y;p[14]-=g.z;p=t.multiply(f,p,ia);t.multiply(p,k.modelMatrix,m.modelMatrix);b.transform(k.boundingVolume,p,m.boundingVolume)}}function ba(a){a=a._nodeCommands;for(var b=a.length,c=[],d=0;d<b;++d){var e=a[d];e.show&&c.push(e.command)}return c}function X(a){a=a._nodeCommands;for(var b=a.length,c=0;c<b;c++)if(a[c].command.dirty)return!0;return!1}function fa(a,c){a._drawCommands=[];var d=ba(a._model);if(c)for(var e=d.length,f=a.length,k=a._boundingSphere,l=a._cull,m=0;m<e;++m){var p=x.shallowClone(d[m]);p.instanceCount=f;p.boundingVolume=k;p.cull=l;h(a._batchTable)?p.pickId=a._batchTable.getPickId():p.pickId="v_pickColor";a._drawCommands.push(p)}else{e=a._instances;f=d.length;k=a.length;l=h(a._batchTable);m=a._cull;for(p=0;p<f;++p)for(var q=0;q<k;++q){var r=x.shallowClone(d[p]);r.modelMatrix=new t;r.boundingVolume=new b;r.cull=m;r.uniformMap=g(r.uniformMap);l?r.uniformMap.a_batchId=T(e[q]._instanceId):r.uniformMap.czm_pickColor=da(a._pickIds[q].color);a._drawCommands.push(r)}V(a)}}function ga(a){if(a.shadows!==a._shadows){a._shadows=a.shadows;var b=G.castShadows(a.shadows),c=G.receiveShadows(a.shadows);a=a._drawCommands;for(var d=a.length,e=0;e<d;++e){var f=a[e];f.castShadows=b;f.receiveShadows=c}}}var ka={NEEDS_LOAD:0,LOADING:1,LOADED:2,FAILED:3};p(E.prototype,{allowPicking:{get:function(){return this._allowPicking}},length:{get:function(){return this._instances.length}},activeAnimations:{get:function(){return this._model.activeAnimations}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(b){k.typeOf.object("imageBasedLightingFactor",b);k.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",b.x,0);k.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",b.x,1);k.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",b.y,0);k.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",b.y,1);a.clone(b,this._imageBasedLightingFactor)}}});var na=new f,ia=new t;E.prototype.expandBoundingSphere=function(a){a=t.getTranslation(a,na);b.expand(this._boundingSphere,a,this._boundingSphere)};E.prototype.update=function(a){if(a.mode!==w.MORPHING&&this.show&&0!==this.length){var b=a.context;if(this._state===ka.NEEDS_LOAD){this._state=ka.LOADING;this._instancingSupported=b.instancedArrays;Q(this,b);var c=this;this._model.readyPromise.otherwise(function(a){c._state=ka.FAILED;c._readyPromise.reject(a)})}var b=this._instancingSupported,d=this._model;d.imageBasedLightingFactor=this.imageBasedLightingFactor;d.lightColor=this.lightColor;d.luminanceAtZenith=this.luminanceAtZenith;d.sphericalHarmonicCoefficients=this.sphericalHarmonicCoefficients;d.specularEnvironmentMaps=this.specularEnvironmentMaps;d.update(a);if(d.ready&&this._state===ka.LOADING)this._state=ka.LOADED,this._ready=!0,a=d.boundingSphere.radius+f.magnitude(d.boundingSphere.center),this._boundingSphere.radius+=a,this._modelCommands=ba(d),fa(this,b),this._readyPromise.resolve(this);else if(this._state===ka.LOADED){var e=a.mode!==this._mode,g=this.modelMatrix,h=!t.equals(this._modelMatrix,g);if(e||h)this._mode=a.mode,t.clone(g,this._modelMatrix),g=t.multiplyByTranslation(this._modelMatrix,this._center,this._rtcTransform),this._mode!==w.SCENE3D&&(g=y.basisTo2D(a.mapProjection,g,g)),t.getTranslation(g,this._boundingSphere.center);b&&this._dirty&&(this._dynamic=!0,this._dirty=!1,Y(this));X(d)&&fa(this,b);!b&&(d.dirty||this._dirty||e||h)&&V(this);ga(this);S(this);ca(this);b=a.passes;if(b.render||b.pick)for(a=a.commandList,b=this._drawCommands,d=b.length,e=0;e<d;++e)a.push(b[e])}}};E.prototype.isDestroyed=function(){return!1};E.prototype.destroy=function(){this._model=this._model&&this._model.destroy();var a=this._pickIds;if(h(a))for(var b=a.length,c=0;c<b;++c)a[c].destroy();return d(this)};return E});F("Scene/Instanced3DModel3DTileContent","../Core/AttributeCompression ../Core/Cartesian3 ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/DeveloperError ../Core/Ellipsoid ../Core/FeatureDetection ../Core/getBaseUri ../Core/getStringFromTypedArray ../Core/Matrix3 ../Core/Matrix4 ../Core/Quaternion ../Core/RequestType ../Core/RuntimeError ../Core/Transforms ../Core/TranslationRotationScale ../Renderer/Pass ./Axis ./Cesium3DTileBatchTable ./Cesium3DTileFeature ./Cesium3DTileFeatureTable ./ModelInstanceCollection".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(e,f,h,m,p){this._tileset=e;this._tile=f;this._resource=h;this._features=this._batchTable=this._modelInstanceCollection=void 0;this.featurePropertiesDirty=!1;var q=g(p,0);p=q;var t=new Uint8Array(m);h=new DataView(m);p+=E;e=h.getUint32(p,!0);if(1!==e)throw new z("Only Instanced 3D Model version 1 is supported. Version "+e+" is not.");p+=E;var I=h.getUint32(p,!0);p+=E;f=h.getUint32(p,!0);if(0===f)throw new z("featureTableJsonByteLength is zero, the feature table must be defined.");p+=E;e=h.getUint32(p,!0);p+=E;var R=h.getUint32(p,!0);p+=E;var O=h.getUint32(p,!0);p+=E;h=h.getUint32(p,!0);if(1!==h&&0!==h)throw new z("Only glTF format 0 (uri) or 1 (embedded) are supported. Format "+h+" is not.");p+=E;var Q=r(t,p,f),Q=JSON.parse(Q);p+=f;f=new Uint8Array(m,p,e);p+=e;e=new H(Q,f);f=e.getGlobalProperty("INSTANCES_LENGTH");e.featuresLength=f;if(!l(f))throw new z("Feature table global property: INSTANCES_LENGTH must be defined");var F,N;0<R&&(F=r(t,p,R),F=JSON.parse(F),p+=R,0<O&&(N=new Uint8Array(m,p,O),N=new Uint8Array(N),p+=O));this._batchTable=new C(this,f,F,N);N=q+I-p;if(0===N)throw new z("glTF byte length is zero, i3dm must have a glTF to instance.");0===p%4?N=new Uint8Array(m,p,N):(w._deprecationWarning("i3dm-glb-unaligned","The embedded glb is not aligned to a 4-byte boundary."),N=new Uint8Array(t.subarray(p,p+N)));m=this._tileset;m={instances:Array(f),batchTable:this._batchTable,cull:!1,url:void 0,requestType:A.TILES3D,gltf:void 0,basePath:void 0,incrementallyLoadTextures:!1,upAxis:m._gltfUpAxis,forwardAxis:B.X,opaquePass:v.CESIUM_3D_TILE,pickIdLoaded:G(this),imageBasedLightingFactor:m.imageBasedLightingFactor,lightColor:m.lightColor,luminanceAtZenith:m.luminanceAtZenith,sphericalHarmonicCoefficients:m.sphericalHarmonicCoefficients,specularEnvironmentMaps:m.specularEnvironmentMaps};0===h?(N=r(N),N=N.replace(/[\s\0]+$/,""),m.url=this._resource.getDerivedResource({url:N})):(m.gltf=N,m.basePath=this._resource.clone());N=e.getGlobalProperty("EAST_NORTH_UP");var P;F=e.getGlobalProperty("RTC_CENTER",k.FLOAT,3);l(F)&&(P=a.unpack(F));F=m.instances;h=new a;p=Array(3);for(var t=new a,q=new a,I=new a,R=new c,O=new y,Q=new a,aa=new D,Z=new u,ba=0;ba<f;ba++){var X=e.getProperty("POSITION",k.FLOAT,3,ba,L);if(!l(X)){var X=p,fa=e.getProperty("POSITION_QUANTIZED",k.UNSIGNED_SHORT,3,ba,L);if(!l(fa))throw new z("Either POSITION or POSITION_QUANTIZED must be defined for each instance.");var ga=e.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",k.FLOAT,3);if(!l(ga))throw new z("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");var ka=e.getGlobalProperty("QUANTIZED_VOLUME_SCALE",k.FLOAT,3);if(!l(ka))throw new z("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(var na=0;3>na;na++)X[na]=fa[na]/65535*ka[na]+ga[na]}a.unpack(X,0,h);l(P)&&a.add(h,P,h);aa.translation=h;fa=e.getProperty("NORMAL_UP",k.FLOAT,3,ba,L);ga=e.getProperty("NORMAL_RIGHT",k.FLOAT,3,ba,K);X=!1;if(l(fa)){if(!l(ga))throw new z("To define a custom orientation, both NORMAL_UP and NORMAL_RIGHT must be defined.");a.unpack(fa,0,q);a.unpack(ga,0,t);X=!0}else if(fa=e.getProperty("NORMAL_UP_OCT32P",k.UNSIGNED_SHORT,2,ba,L),ga=e.getProperty("NORMAL_RIGHT_OCT32P",k.UNSIGNED_SHORT,2,ba,K),l(fa)){if(!l(ga))throw new z("To define a custom orientation with oct-encoded vectors, both NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P must be defined.");b.octDecodeInRange(fa[0],fa[1],65535,q);b.octDecodeInRange(ga[0],ga[1],65535,t);X=!0}else N?(x.eastNorthUpToFixedFrame(h,d.WGS84,Z),u.getRotation(Z,R)):c.clone(c.IDENTITY,R);X&&(a.cross(t,q,I),a.normalize(I,I),c.setColumn(R,0,t,R),c.setColumn(R,1,q,R),c.setColumn(R,2,I,R));y.fromRotationMatrix(R,O);aa.rotation=O;Q=a.fromElements(1,1,1,Q);X=e.getProperty("SCALE",k.FLOAT,1,ba);l(X)&&a.multiplyByScalar(Q,X,Q);X=e.getProperty("SCALE_NON_UNIFORM",k.FLOAT,3,ba,L);l(X)&&(Q.x*=X[0],Q.y*=X[1],Q.z*=X[2]);aa.scale=Q;X=e.getProperty("BATCH_ID",k.UNSIGNED_SHORT,1,ba);l(X)||(X=ba);u.fromTranslationRotationScale(aa,Z);fa=Z.clone();F[ba]={modelMatrix:fa,batchId:X}}this._modelInstanceCollection=new J(m)}function G(a){return function(){return a._batchTable.getPickId()}}if(!q.supportsTypedArrays())return{};w._deprecationWarning=e;m(w.prototype,{featuresLength:{get:function(){return this._batchTable.featuresLength}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){var a=this._modelInstanceCollection._model;return l(a)?a.trianglesLength:0}},geometryByteLength:{get:function(){var a=this._modelInstanceCollection._model;return l(a)?a.geometryByteLength:0}},texturesByteLength:{get:function(){var a=this._modelInstanceCollection._model;return l(a)?a.texturesByteLength:0}},batchTableByteLength:{get:function(){return this._batchTable.memorySizeInBytes}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._modelInstanceCollection.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var E=Uint32Array.BYTES_PER_ELEMENT,L=Array(4),K=Array(4);w.prototype.hasProperty=function(a,b){return this._batchTable.hasProperty(a,b)};w.prototype.getFeature=function(a){var b=this.featuresLength;if(!l(a)||0>a||a>=b)throw new p("batchId is required and between zero and featuresLength - 1 ("+(b-1)+").");b=this.featuresLength;if(!l(this._features)&&0<b){for(var c=Array(b),d=0;d<b;++d)c[d]=new I(this,d);this._features=c}return this._features[a]};w.prototype.applyDebugSettings=function(a,b){b=a?b:f.WHITE;this._batchTable.setAllColor(b)};w.prototype.applyStyle=function(a){this._batchTable.applyStyle(a)};w.prototype.update=function(a,b){var c=b.commandList.length;this._batchTable.update(a,b);this._modelInstanceCollection.modelMatrix=this._tile.computedTransform;this._modelInstanceCollection.shadows=this._tileset.shadows;this._modelInstanceCollection.lightColor=this._tileset.lightColor;this._modelInstanceCollection.luminanceAtZenith=this._tileset.luminanceAtZenith;this._modelInstanceCollection.sphericalHarmonicCoefficients=this._tileset.sphericalHarmonicCoefficients;this._modelInstanceCollection.specularEnvironmentMaps=this._tileset.specularEnvironmentMaps;this._modelInstanceCollection.debugWireframe=this._tileset.debugWireframe;var d=this._modelInstanceCollection._model;if(l(d)){var e=this._tileset.clippingPlanes;d.clippingPlanesOriginMatrix=this._tileset.clippingPlanesOriginMatrix;l(e)&&this._tile.clippingPlanesDirty&&(d._clippingPlanes=e.enabled&&this._tile._isClipped?e:void 0);l(e)&&l(d._clippingPlanes)&&d._clippingPlanes!==e&&(d._clippingPlanes=e)}this._modelInstanceCollection.update(b);c<b.commandList.length&&(b.passes.render||b.passes.pick)&&this._batchTable.addDerivedCommands(b,c,!1)};w.prototype.isDestroyed=function(){return!1};w.prototype.destroy=function(){this._modelInstanceCollection=this._modelInstanceCollection&&this._modelInstanceCollection.destroy();this._batchTable=this._batchTable&&this._batchTable.destroy();return h(this)};return w});F("Scene/Cesium3DTileRefine",["../Core/freezeObject"],function(b){return b({ADD:0,REPLACE:1})});F("Scene/PointCloud","../Core/arraySlice ../Core/BoundingSphere ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Math ../Core/Check ../Core/Color ../Core/combine ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/FeatureDetection ../Core/getStringFromTypedArray ../Core/Matrix4 ../Core/oneTimeWarning ../Core/OrthographicFrustum ../Core/Plane ../Core/PrimitiveType ../Core/RuntimeError ../Core/Transforms ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../ThirdParty/when ./BlendingState ./Cesium3DTileBatchTable ./Cesium3DTileFeature ./Cesium3DTileFeatureTable ./DracoLoader ./getClipAndStyleCode ./getClippingFunction ./SceneMode ./ShadowMode ./StencilConstants".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,F,N,O,Z,aa,U,W,M,R){function P(a){l.typeOf.object("options",a);l.typeOf.object("options.arrayBuffer",a.arrayBuffer);this._drawCommand=this._parsedContent=void 0;this._styleTranslucent=this._isTranslucent=!1;this._constantColor=m.clone(m.DARKGRAY);this._highlightColor=m.clone(m.WHITE);this._pointSize=1;this._styleableShaderAttributes=this._quantizedVolumeOffset=this._quantizedVolumeScale=this._rtcCenter=void 0;this._hasBatchIds=this._hasNormals=this._hasColors=this._isRGB565=this._isOctEncoded16P=this._isQuantized=!1;this._decodingState=X.READY;this._dequantizeInShader=!0;this._isOctEncodedDraco=this._isQuantizedDraco=!1;this._octEncodedRange=this._quantizedRange=0;this._backFaceCulling=this.backFaceCulling=!1;this._normalShading=this.normalShading=!0;this._mode=this._translucentRenderState=this._opaqueRenderState=void 0;this._ready=!1;this._readyPromise=L.defer();this._geometryByteLength=this._pointsLength=0;this._vertexShaderLoaded=a.vertexShaderLoaded;this._fragmentShaderLoaded=a.fragmentShaderLoaded;this._uniformMapLoaded=a.uniformMapLoaded;this._batchTableLoaded=a.batchTableLoaded;this._pickIdLoaded=a.pickIdLoaded;this._opaquePass=p(a.opaquePass,H.OPAQUE);this._cull=p(a.cull,!0);this._style=this.style=void 0;this.styleDirty=!1;this.modelMatrix=u.clone(u.IDENTITY);this._modelMatrix=u.clone(u.IDENTITY);this.time=0;this.shadows=M.ENABLED;this.clippingPlanes=this._boundingSphere=void 0;this.clippingPlanesDirty=this.isClipped=!1;this.clippingPlanesOriginMatrix=void 0;this._attenuation=this.attenuation=!1;this.geometricError=0;this.geometricErrorScale=1;this.maximumAttenuation=this._pointSize;var g=a.arrayBuffer,k=p(a.byteOffset,0),q=new Uint8Array(g);a=new DataView(g);var k=k+fa,r=a.getUint32(k,!0);if(1!==r)throw new D("Only Point Cloud tile version 1 is supported.  Version "+r+" is not.");k+=fa;k+=fa;r=a.getUint32(k,!0);if(0===r)throw new D("Feature table must have a byte length greater than zero");var k=k+fa,t=a.getUint32(k,!0),k=k+fa,w=a.getUint32(k,!0),k=k+fa,v=a.getUint32(k,!0),k=k+fa;a=c(q,k,r);a=JSON.parse(a);var k=k+r,r=new Uint8Array(g,k,t),k=k+t,y,z;0<w&&(y=c(q,k,w),y=JSON.parse(y),0<v&&(z=new Uint8Array(g,k+w,v)));k=new O(a,r);g=k.getGlobalProperty("POINTS_LENGTH");k.featuresLength=g;if(!d(g))throw new D("Feature table global property: POINTS_LENGTH must be defined");q=k.getGlobalProperty("RTC_CENTER",h.FLOAT,3);d(q)&&(this._rtcCenter=f.unpack(q));var E,C,A,G,B=!1,x=v=!1,I=!1,K=q=!1,t=w=!1,J,R,Q,N=d(a.extensions)?a.extensions["3DTILES_draco_point_compression"]:void 0,P=d(y)&&d(y.extensions)?y.extensions["3DTILES_draco_point_compression"]:void 0;d(P)&&(Q=P.properties);if(d(N)){R=N.properties;J=N.byteOffset;v=N.byteLength;if(!d(R)||!d(J)||!d(v))throw new D("Draco properties, byteOffset, and byteLength must be defined");J=b(r,J,J+v);B=d(R.POSITION);v=d(R.RGB)||d(R.RGBA);x=d(R.NORMAL);I=d(R.BATCH_ID);K=d(R.RGBA);this._decodingState=X.NEEDS_DECODE}var Y;d(J)&&(Y={buffer:J,featureTableProperties:R,batchTableProperties:Q,properties:e(R,Q),dequantizeInShader:this._dequantizeInShader});if(!B)if(d(a.POSITION))E=k.getPropertyArray("POSITION",h.FLOAT,3),B=!0;else if(d(a.POSITION_QUANTIZED)){E=k.getPropertyArray("POSITION_QUANTIZED",h.UNSIGNED_SHORT,3);B=q=!0;R=k.getGlobalProperty("QUANTIZED_VOLUME_SCALE",h.FLOAT,3);if(!d(R))throw new D("Global property: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");this._quantizedVolumeScale=f.unpack(R);this._quantizedRange=65535;R=k.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",h.FLOAT,3);if(!d(R))throw new D("Global property: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");this._quantizedVolumeOffset=f.unpack(R)}v||(d(a.RGBA)?(C=k.getPropertyArray("RGBA",h.UNSIGNED_BYTE,4),v=K=!0):d(a.RGB)?(C=k.getPropertyArray("RGB",h.UNSIGNED_BYTE,3),v=!0):d(a.RGB565)&&(C=k.getPropertyArray("RGB565",h.UNSIGNED_SHORT,1),v=w=!0));x||(d(a.NORMAL)?(A=k.getPropertyArray("NORMAL",h.FLOAT,3),x=!0):d(a.NORMAL_OCT16P)&&(A=k.getPropertyArray("NORMAL_OCT16P",h.UNSIGNED_BYTE,2),x=t=!0));!I&&d(a.BATCH_ID)&&(G=k.getPropertyArray("BATCH_ID",h.UNSIGNED_SHORT,1),I=!0);if(!B)throw new D("Either POSITION or POSITION_QUANTIZED must be defined.");d(a.CONSTANT_RGBA)&&(R=k.getGlobalProperty("CONSTANT_RGBA",h.UNSIGNED_BYTE,4),this._constantColor=m.fromBytes(R[0],R[1],R[2],R[3],this._constantColor));if(I){R=k.getGlobalProperty("BATCH_LENGTH");if(!d(R))throw new D("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");d(z)&&(z=new Uint8Array(z));d(this._batchTableLoaded)&&this._batchTableLoaded(R,y,z)}var U;!I&&d(z)&&(U=F.getBinaryProperties(g,y,z));this._parsedContent={positions:E,colors:C,normals:A,batchIds:G,styleableProperties:U,draco:Y};this._pointsLength=g;this._isQuantized=q;this._isOctEncoded16P=t;this._isRGB565=w;this._isTranslucent=K;this._hasColors=v;this._hasNormals=x;this._hasBatchIds=I}function Q(a,b){var c=h.fromTypedArray(a);return c===h.INT||c===h.UNSIGNED_INT||c===h.DOUBLE?(y("Cast pnts property to floats",'Point cloud property "'+b+'" will be casted to a float array because INT, UNSIGNED_INT, and DOUBLE are not valid WebGL vertex attribute types. Some precision may be lost.'),new Float32Array(a)):a}function S(a,b){var c=b.context,g=a._isQuantizedDraco,h=a._isOctEncodedDraco,k={u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier:function(){var d=la;d.x=a._attenuation?a.maximumAttenuation:a._pointSize;d.y=a.time;if(a._attenuation){var e=b.camera.frustum,e=b.mode===W.SCENE2D||e instanceof A?Number.POSITIVE_INFINITY:c.drawingBufferHeight/b.camera.frustum.sseDenominator;d.z=a.geometricError*a.geometricErrorScale;d.w=e}return d},u_highlightColor:function(){return a._highlightColor},u_constantColor:function(){return a._constantColor},u_clippingPlanes:function(){var b=a.clippingPlanes;return a.isClipped?b.texture:c.defaultTexture},u_clippingPlanesEdgeStyle:function(){var b=a.clippingPlanes;if(!d(b))return m.TRANSPARENT;var c=m.clone(b.edgeColor,pa);c.alpha=b.edgeWidth;return c},u_clippingPlanesMatrix:function(){var b=a.clippingPlanes;if(!d(b))return u.IDENTITY;var e=p(a.clippingPlanesOriginMatrix,a._modelMatrix);u.multiply(c.uniformState.view3D,e,oa);return u.multiply(oa,b.modelMatrix,oa)}};if(a._isQuantized||g||h)k=e(k,{u_quantizedVolumeScaleAndOctEncodedRange:function(){var b=ha;if(d(a._quantizedVolumeScale)){var c=f.clone(a._quantizedVolumeScale,b);f.divideByScalar(c,a._quantizedRange,b)}b.w=a._octEncodedRange;return b}});d(a._uniformMapLoaded)&&(k=a._uniformMapLoaded(k));a._drawCommand.uniformMap=k}function ca(a,b){for(var c=/czm_tiles3d_style_(\w+)/g,d=c.exec(a);null!==d;)d=d[1],-1===b.indexOf(d)&&b.push(d),d=c.exec(a)}function T(a,b){for(var c=a.numberOfAttributes,d=0;d<c;++d){var e=a.getAttribute(d);if(e.index===b)return e}}function da(a){for(var b=qa.length,c=0;c<b;++c){var d=qa[c],e="czm_tiles3d_style_"+d,d=d.toLowerCase();a=a.replace(new RegExp(e+"(\\W)","g"),d+"$1")}return a.replace("()","(vec3 position, vec3 position_absolute, vec4 color, vec3 normal)")}function V(a,b,c){var e,f,g,h=b.context,k=d(c),l=a._isQuantized,m=a._isQuantizedDraco,p=a._isOctEncoded16P,q=a._isOctEncodedDraco,r=a._isRGB565,t=a._isTranslucent,u=a._hasColors,v=a._hasNormals,y=a._hasBatchIds,z=a._backFaceCulling,E=a._normalShading,C=a._drawCommand.vertexArray,A=a.clippingPlanes,G=a._attenuation,B,H,x,I=t;k&&(k={translucent:!1},B=c.getColorShaderFunction("getColorFromStyle","czm_tiles3d_style_",k),H=c.getShowShaderFunction("getShowFromStyle","czm_tiles3d_style_",k),x=c.getPointSizeShaderFunction("getPointSizeFromStyle","czm_tiles3d_style_",k),d(B)&&k.translucent&&(I=!0));a._styleTranslucent=I;var I=d(B),k=d(H),L=d(x);c=a.isClipped;g=[];I&&(ca(B,g),B=da(B));k&&(ca(H,g),H=da(H));L&&(ca(x,g),x=da(x));var K=0<=g.indexOf("COLOR");e=0<=g.indexOf("NORMAL");var J=g.filter(function(a){return-1===qa.indexOf(a)});if(e&&!v)throw new D("Style references the NORMAL semantic but the point cloud does not have normals");var M=a._styleableShaderAttributes;for(f in M)if(M.hasOwnProperty(f)){g=M[f];var R=0<=J.indexOf(f);T(C,g.location).enabled=R}K=u&&(!I||K);u&&(T(C,1).enabled=K);u=v&&(E||z||e);v&&(T(C,2).enabled=u);v={a_position:0};K&&(v.a_color=1);u&&(v.a_normal=2);y&&(v.a_batchId=3);C="";R=J.length;for(e=0;e<R;++e){f=J[e];g=M[f];if(!d(g))throw new D('Style references a property "'+f+'" that does not exist or is not styleable.');var Q=g.componentCount;f="czm_tiles3d_style_"+f;C+="attribute "+(1===Q?"float":"vec"+Q)+" "+f+"; \n";v[f]=g.location}S(a,b);b="attribute vec3 a_position; \nvarying vec4 v_color; \nuniform vec4 u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier; \nuniform vec4 u_constantColor; \nuniform vec4 u_highlightColor; \nfloat u_pointSize; \nfloat u_time; \n";G&&(b+="float u_geometricError; \nfloat u_depthMultiplier; \n");b+=C;K&&(b=t?b+"attribute vec4 a_color; \n":r?b+"attribute float a_color; \nconst float SHIFT_RIGHT_11 \x3d 1.0 / 2048.0; \nconst float SHIFT_RIGHT_5 \x3d 1.0 / 32.0; \nconst float SHIFT_LEFT_11 \x3d 2048.0; \nconst float SHIFT_LEFT_5 \x3d 32.0; \nconst float NORMALIZE_6 \x3d 1.0 / 64.0; \nconst float NORMALIZE_5 \x3d 1.0 / 32.0; \n":b+"attribute vec3 a_color; \n");u&&(b=p||q?b+"attribute vec2 a_normal; \n":b+"attribute vec3 a_normal; \n");y&&(b+="attribute float a_batchId; \n");if(l||m||q)b+="uniform vec4 u_quantizedVolumeScaleAndOctEncodedRange; \n";I&&(b+=B);k&&(b+=H);L&&(b+=x);b+="void main() \n{ \n    u_pointSize \x3d u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.x; \n    u_time \x3d u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.y; \n";G&&(b+="    u_geometricError \x3d u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.z; \n    u_depthMultiplier \x3d u_pointSizeAndTimeAndGeometricErrorAndDepthMultiplier.w; \n");b=K?t?b+"    vec4 color \x3d a_color; \n":r?b+"    float compressed \x3d a_color; \n    float r \x3d floor(compressed * SHIFT_RIGHT_11); \n    compressed -\x3d r * SHIFT_LEFT_11; \n    float g \x3d floor(compressed * SHIFT_RIGHT_5); \n    compressed -\x3d g * SHIFT_LEFT_5; \n    float b \x3d compressed; \n    vec3 rgb \x3d vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5); \n    vec4 color \x3d vec4(rgb, 1.0); \n":b+"    vec4 color \x3d vec4(a_color, 1.0); \n":b+"    vec4 color \x3d u_constantColor; \n";b=(l||m?b+"    vec3 position \x3d a_position * u_quantizedVolumeScaleAndOctEncodedRange.xyz; \n":b+"    vec3 position \x3d a_position; \n")+"    vec3 position_absolute \x3d vec3(czm_model * vec4(position, 1.0)); \n";u?(b=p?b+"    vec3 normal \x3d czm_octDecode(a_normal); \n":q?b+"    vec3 normal \x3d czm_octDecode(a_normal, u_quantizedVolumeScaleAndOctEncodedRange.w).zxy; \n":b+"    vec3 normal \x3d a_normal; \n",b+="    vec3 normalEC \x3d czm_normal * normal; \n"):b+="    vec3 normal \x3d vec3(1.0); \n";I&&(b+="    color \x3d getColorFromStyle(position, position_absolute, color, normal); \n");k&&(b+="    float show \x3d float(getShowFromStyle(position, position_absolute, color, normal)); \n");b=L?b+"    gl_PointSize \x3d getPointSizeFromStyle(position, position_absolute, color, normal); \n":G?b+"    vec4 positionEC \x3d czm_modelView * vec4(position, 1.0); \n    float depth \x3d -positionEC.z; \n    gl_PointSize \x3d min((u_geometricError / depth) * u_depthMultiplier, u_pointSize); \n":b+"    gl_PointSize \x3d u_pointSize; \n";b+="    color \x3d color * u_highlightColor; \n";u&&E&&(b+="    float diffuseStrength \x3d czm_getLambertDiffuse(czm_sunDirectionEC, normalEC); \n    diffuseStrength \x3d max(diffuseStrength, 0.4); \n    color.xyz *\x3d diffuseStrength; \n");b+="    v_color \x3d color; \n    gl_Position \x3d czm_modelViewProjection * vec4(position, 1.0); \n";u&&z&&(b+="    float visible \x3d step(-normalEC.z, 0.0); \n    gl_Position *\x3d visible; \n    gl_PointSize *\x3d visible; \n");k&&(b+="    gl_Position *\x3d show; \n    gl_PointSize *\x3d show; \n");b+="} \n";l="varying vec4 v_color; \n";c&&(l=l+"uniform sampler2D u_clippingPlanes; \nuniform mat4 u_clippingPlanesMatrix; \nuniform vec4 u_clippingPlanesEdgeStyle; \n\n"+U(A,h),l+="\n");l+="void main() \n{ \n    gl_FragColor \x3d czm_gammaCorrect(v_color); \n";c&&(l+=aa("u_clippingPlanes","u_clippingPlanesMatrix","u_clippingPlanesEdgeStyle"));l+="} \n";d(a._vertexShaderLoaded)&&(b=a._vertexShaderLoaded(b));d(a._fragmentShaderLoaded)&&(l=a._fragmentShaderLoaded(l));a=a._drawCommand;d(a.shaderProgram)&&a.shaderProgram.destroy();a.shaderProgram=w.fromCache({context:h,vertexShaderSource:b,fragmentShaderSource:l,attributeLocations:v});try{a.shaderProgram._bind()}catch(tb){throw new D("Error generating style shader: this may be caused by a type mismatch, index out-of-bounds, or other syntax error.");}}function ba(a,b){if(a._decodingState===X.READY)return!1;if(a._decodingState===X.NEEDS_DECODE){var c=a._parsedContent,e=c.draco,g=Z.decodePointCloud(e,b);d(g)&&(a._decodingState=X.DECODING,g.then(function(b){a._decodingState=X.READY;var g=d(b.POSITION)?b.POSITION.array:void 0,h=d(b.RGB)?b.RGB.array:void 0,k=d(b.RGBA)?b.RGBA.array:void 0,l=d(b.NORMAL)?b.NORMAL.array:void 0,m=d(b.BATCH_ID)?b.BATCH_ID.array:void 0,q=d(g)&&d(b.POSITION.data.quantization),r=d(l)&&d(b.NORMAL.data.quantization);if(q){var q=b.POSITION.data.quantization,t=q.range;a._quantizedVolumeScale=f.fromElements(t,t,t);a._quantizedVolumeOffset=f.unpack(q.minValues);a._quantizedRange=(1<<q.quantizationBits)-1;a._isQuantizedDraco=!0}r&&(a._octEncodedRange=(1<<b.NORMAL.data.quantization.quantizationBits)-1,a._isOctEncodedDraco=!0);var r=c.styleableProperties,q=e.batchTableProperties,w;for(w in q)q.hasOwnProperty(w)&&(t=b[w],d(r)||(r={}),r[w]={typedArray:t.array,componentCount:t.data.componentsPerAttribute});c.positions=p(g,c.positions);c.colors=p(p(k,h),c.colors);c.normals=p(l,c.normals);c.batchIds=p(m,c.batchIds);c.styleableProperties=r}).otherwise(function(b){a._decodingState=X.FAILED;a._readyPromise.reject(b)}))}return!0}if(!r.supportsTypedArrays())return{};var X={NEEDS_DECODE:0,DECODING:1,READY:2,FAILED:3};q(P.prototype,{pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},color:{get:function(){return m.clone(this._highlightColor)},set:function(a){this._highlightColor=m.clone(a,this._highlightColor)}},boundingSphere:{get:function(){if(d(this._drawCommand))return this._drawCommand.boundingVolume},set:function(b){this._boundingSphere=a.clone(b)}}});var fa=Uint32Array.BYTES_PER_ELEMENT,ga=new f,ka=new f,na=new f,ia,la=new k,ha=new k,pa=new m,oa=new u,qa=["POSITION","COLOR","NORMAL","POSITION_ABSOLUTE"],ua=new k,ta=new f;P.prototype.update=function(b){if(!ba(this,b.context)){var c=!1,e=!u.equals(this._modelMatrix,this.modelMatrix);this._mode!==b.mode&&(this._mode=b.mode,e=!0);if(!d(this._drawCommand)){var l=b.context,e=this._parsedContent,c=this._pointsLength,m=e.positions,p=e.colors,q=e.normals,r=e.batchIds,t=e.styleableProperties,w=d(t),y=this._isQuantized,z=this._isQuantizedDraco,A=this._isOctEncoded16P,G=this._isOctEncodedDraco,D=this._quantizedRange,L=this._octEncodedRange,O=this._isRGB565,e=this._isTranslucent,F=this._hasColors,N=this._hasNormals,P=this._hasBatchIds,Y,U,S=[],aa={};this._styleableShaderAttributes=aa;if(w){var Z=4,T;for(T in t)if(t.hasOwnProperty(T)){U=t[T];var ca=Q(U.typedArray,T);Y=U.componentCount;U=h.fromTypedArray(ca);ca=B.createVertexBuffer({context:l,typedArray:ca,usage:C.STATIC_DRAW});this._geometryByteLength+=ca.sizeInBytes;S.push({index:Z,vertexBuffer:ca,componentsPerAttribute:Y,componentDatatype:U,normalize:!1,offsetInBytes:0,strideInBytes:0});aa[T]={location:Z,componentCount:Y};++Z}}t=B.createVertexBuffer({context:l,typedArray:m,usage:C.STATIC_DRAW});this._geometryByteLength+=t.sizeInBytes;var X;F&&(X=B.createVertexBuffer({context:l,typedArray:p,usage:C.STATIC_DRAW}),this._geometryByteLength+=X.sizeInBytes);var da;N&&(da=B.createVertexBuffer({context:l,typedArray:q,usage:C.STATIC_DRAW}),this._geometryByteLength+=da.sizeInBytes);var fa;P&&(r=Q(r,"batchIds"),fa=B.createVertexBuffer({context:l,typedArray:r,usage:C.STATIC_DRAW}),this._geometryByteLength+=fa.sizeInBytes);T=[];U=y?h.UNSIGNED_SHORT:z?255>=D?h.UNSIGNED_BYTE:h.UNSIGNED_SHORT:h.FLOAT;T.push({index:0,vertexBuffer:t,componentsPerAttribute:3,componentDatatype:U,normalize:!1,offsetInBytes:0,strideInBytes:0});if(this._cull){if(y||z)m=a.fromCornerPoints(f.ZERO,this._quantizedVolumeScale);else{p=m.length/3;q=Math.min(p,20);if(!d(ia))for(g.setRandomNumberSeed(0),ia=Array(20),y=0;20>y;++y)ia[y]=g.nextRandomNumber();y=ia;z=Number.MAX_VALUE;D=-Number.MAX_VALUE;z=f.fromElements(z,z,z,ga);D=f.fromElements(D,D,D,ka);for(U=0;U<q;++U)t=f.unpack(m,3*Math.floor(y[U]*p),na),f.minimumByComponent(z,t,z),f.maximumByComponent(D,t,D);m=a.fromCornerPoints(z,D);m.radius+=g.EPSILON2}this._boundingSphere=m}F&&(O?T.push({index:1,vertexBuffer:X,componentsPerAttribute:1,componentDatatype:h.UNSIGNED_SHORT,normalize:!1,offsetInBytes:0,strideInBytes:0}):T.push({index:1,vertexBuffer:X,componentsPerAttribute:e?4:3,componentDatatype:h.UNSIGNED_BYTE,normalize:!0,offsetInBytes:0,strideInBytes:0}));N&&(A?(Y=2,U=h.UNSIGNED_BYTE):G?(Y=2,U=255>=L?h.UNSIGNED_BYTE:h.UNSIGNED_SHORT):(Y=3,U=h.FLOAT),T.push({index:2,vertexBuffer:da,componentsPerAttribute:Y,componentDatatype:U,normalize:!1,offsetInBytes:0,strideInBytes:0}));P&&T.push({index:3,vertexBuffer:fa,componentsPerAttribute:1,componentDatatype:h.fromTypedArray(r),normalize:!1,offsetInBytes:0,strideInBytes:0});w&&(T=T.concat(S));X=new E({context:l,attributes:T});da={depthTest:{enabled:!0}};this._opaquePass===H.CESIUM_3D_TILE&&(da.stencilTest=R.setCesium3DTileBit(),da.stencilMask=R.CESIUM_3D_TILE_MASK);this._opaqueRenderState=J.fromCache(da);this._translucentRenderState=J.fromCache({depthTest:{enabled:!0},depthMask:!1,blending:K.ALPHA_BLEND});this._drawCommand=new I({boundingVolume:new a,cull:this._cull,modelMatrix:new u,primitiveType:x.POINTS,vertexArray:X,count:c,shaderProgram:void 0,uniformMap:void 0,renderState:e?this._translucentRenderState:this._opaqueRenderState,pass:e?H.TRANSLUCENT:this._opaquePass,owner:this,castShadows:!1,receiveShadows:!1,pickId:this._pickIdLoaded()});this._ready=c=e=!0;this._readyPromise.resolve(this);this._parsedContent=void 0}e&&(u.clone(this.modelMatrix,this._modelMatrix),X=this._drawCommand.modelMatrix,u.clone(this._modelMatrix,X),d(this._rtcCenter)&&u.multiplyByTranslation(X,this._rtcCenter,X),d(this._quantizedVolumeOffset)&&u.multiplyByTranslation(X,this._quantizedVolumeOffset,X),b.mode!==W.SCENE3D&&(da=b.mapProjection,fa=u.getColumn(X,3,ua),k.equals(fa,k.UNIT_W)||v.basisTo2D(da,X,X)),da=this._drawCommand.boundingVolume,a.clone(this._boundingSphere,da),this._cull&&(fa=da.center,u.multiplyByPoint(X,fa,fa),X=u.getScale(X,ta),da.radius*=f.maximumComponent(X)));this.clippingPlanesDirty&&(this.clippingPlanesDirty=!1,c=!0);this._attenuation!==this.attenuation&&(this._attenuation=this.attenuation,c=!0);this.backFaceCulling!==this._backFaceCulling&&(this._backFaceCulling=this.backFaceCulling,c=!0);this.normalShading!==this._normalShading&&(this._normalShading=this.normalShading,c=!0);if(this._style!==this.style||this.styleDirty)this._style=this.style,this.styleDirty=!1,c=!0;c&&V(this,b,this._style);this._drawCommand.castShadows=M.castShadows(this.shadows);this._drawCommand.receiveShadows=M.receiveShadows(this.shadows);c=1>this._highlightColor.alpha||1>this._constantColor.alpha||this._styleTranslucent;this._drawCommand.renderState=c?this._translucentRenderState:this._opaqueRenderState;this._drawCommand.pass=c?H.TRANSLUCENT:this._opaquePass;c=b.commandList;b=b.passes;(b.render||b.pick)&&c.push(this._drawCommand)}};P.prototype.isDestroyed=function(){return!1};P.prototype.destroy=function(){var a=this._drawCommand;d(a)&&(a.vertexArray=a.vertexArray&&a.vertexArray.destroy(),a.shaderProgram=a.shaderProgram&&a.shaderProgram.destroy());return t(this)};return P});F("Shaders/PostProcessStages/PointCloudEyeDomeLighting",[],function(){return"#extension GL_EXT_frag_depth : enable\nuniform sampler2D u_pointCloud_colorGBuffer;\nuniform sampler2D u_pointCloud_depthGBuffer;\nuniform vec3 u_distancesAndEdlStrength;\nvarying vec2 v_textureCoordinates;\nvec2 neighborContribution(float log2Depth, vec2 padding)\n{\nfloat depthOrLogDepth \x3d czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates + padding));\nif (depthOrLogDepth \x3d\x3d 0.0) {\nreturn vec2(0.0);\n}\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(v_textureCoordinates + padding, depthOrLogDepth);\nreturn vec2(max(0.0, log2Depth - log2(-eyeCoordinate.z / eyeCoordinate.w)), 1.0);\n}\nvoid main()\n{\nfloat depthOrLogDepth \x3d czm_unpackDepth(texture2D(u_pointCloud_depthGBuffer, v_textureCoordinates));\nvec4 eyeCoordinate \x3d czm_windowToEyeCoordinates(gl_FragCoord.xy, depthOrLogDepth);\neyeCoordinate /\x3d eyeCoordinate.w;\nfloat log2Depth \x3d log2(-eyeCoordinate.z);\nif (depthOrLogDepth \x3d\x3d 0.0)\n{\ndiscard;\n}\nvec4 color \x3d texture2D(u_pointCloud_colorGBuffer, v_textureCoordinates);\nfloat distX \x3d u_distancesAndEdlStrength.x;\nfloat distY \x3d u_distancesAndEdlStrength.y;\nvec2 responseAndCount \x3d vec2(0.0);\nresponseAndCount +\x3d neighborContribution(log2Depth, vec2(0, distY));\nresponseAndCount +\x3d neighborContribution(log2Depth, vec2(distX, 0));\nresponseAndCount +\x3d neighborContribution(log2Depth, vec2(0, -distY));\nresponseAndCount +\x3d neighborContribution(log2Depth, vec2(-distX, 0));\nfloat response \x3d responseAndCount.x / responseAndCount.y;\nfloat shade \x3d exp(-response * 300.0 * u_distancesAndEdlStrength.z);\ncolor.rgb *\x3d shade;\ngl_FragColor \x3d vec4(color);\n#ifdef LOG_DEPTH\nczm_writeLogDepth(1.0 + (czm_projection * vec4(eyeCoordinate.xyz, 1.0)).w);\n#else\ngl_FragDepthEXT \x3d czm_eyeToWindowCoordinates(vec4(eyeCoordinate.xyz, 1.0)).z;\n#endif\n}\n"});F("Scene/PointCloudEyeDomeLighting","../Core/Cartesian3 ../Core/Color ../Core/defined ../Core/destroyObject ../Core/FeatureDetection ../Core/PixelFormat ../Core/PrimitiveType ../Renderer/ClearCommand ../Renderer/DrawCommand ../Renderer/Framebuffer ../Renderer/Pass ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/Sampler ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Scene/BlendingState ../Scene/StencilConstants ../Shaders/PostProcessStages/PointCloudEyeDomeLighting".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v){function B(){this._clearCommand=this._drawCommand=this._depthTexture=this._depthGBuffer=this._colorGBuffer=this._framebuffer=void 0;this._radius=this._strength=1}function C(){return new r({wrapS:z.CLAMP_TO_EDGE,wrapT:z.CLAMP_TO_EDGE,minificationFilter:A.NEAREST,magnificationFilter:y.NEAREST})}function I(a){var b=a._framebuffer;f(b)&&(a._colorGBuffer.destroy(),a._depthGBuffer.destroy(),a._depthTexture.destroy(),b.destroy(),a._framebuffer=void 0,a._colorGBuffer=void 0,a._depthGBuffer=void 0,a._depthTexture=void 0,a._drawCommand=void 0,a._clearCommand=void 0)}function H(b,c){var f=t.fromCache({blending:x.ALPHA_BLEND,depthMask:!0,depthTest:{enabled:!0},stencilTest:D.setCesium3DTileBit(),stencilMask:D.CESIUM_3D_TILE_MASK});b._drawCommand=c.createViewportQuadCommand(v,{uniformMap:{u_pointCloud_colorGBuffer:function(){return b._colorGBuffer},u_pointCloud_depthGBuffer:function(){return b._depthGBuffer},u_distancesAndEdlStrength:function(){G.x=b._radius/c.drawingBufferWidth;G.y=b._radius/c.drawingBufferHeight;G.z=b._strength;return G}},renderState:f,pass:d.CESIUM_3D_TILE,owner:b});b._clearCommand=new e({framebuffer:b._framebuffer,color:new a(0,0,0,0),depth:1,renderState:t.fromCache(),pass:d.CESIUM_3D_TILE,owner:b})}function J(a){return a.drawBuffers&&a.fragmentDepth}function w(a,b){var d=a.shaderCache.getDerivedShaderProgram(b,"EC");if(!f(d)){var d=b._attributeLocations,e=b.fragmentShaderSource.clone();e.sources=e.sources.map(function(a){a=c.replaceMain(a,"czm_point_cloud_post_process_main");return a=a.replace(/gl_FragColor/g,"gl_FragData[0]")});e.sources.unshift("#extension GL_EXT_draw_buffers : enable \n");e.sources.push("void main() \n{ \n    czm_point_cloud_post_process_main(); \n    gl_FragData[1] \x3d czm_packDepth(gl_FragCoord.z); \n}");d=a.shaderCache.createDerivedShaderProgram(b,"EC",{vertexShaderSource:b.vertexShaderSource,fragmentShaderSource:e,attributeLocations:d})}return d}var G=new b;B.isSupported=J;B.prototype.update=function(a,b,c){if(J(a.context)){this._strength=c.eyeDomeLightingStrength;this._radius=c.eyeDomeLightingRadius;var e;c=a.context;var g=c.drawingBufferWidth,k=c.drawingBufferHeight;e=this._colorGBuffer;var r=!1,g=f(e)&&(e.width!==g||e.height!==k);if(!f(e)||g)I(this),g=c.drawingBufferWidth,k=c.drawingBufferHeight,e=new u({context:c,width:g,height:k,pixelFormat:l.RGBA,pixelDatatype:q.UNSIGNED_BYTE,sampler:C()}),r=new u({context:c,width:g,height:k,pixelFormat:l.RGBA,pixelDatatype:q.UNSIGNED_BYTE,sampler:C()}),g=new u({context:c,width:g,height:k,pixelFormat:l.DEPTH_COMPONENT,pixelDatatype:q.UNSIGNED_INT,sampler:C()}),this._framebuffer=new p({context:c,colorTextures:[e,r],depthTexture:g,destroyAttachments:!1}),this._colorGBuffer=e,this._depthGBuffer=r,this._depthTexture=g,H(this,c),r=!0;e=r;c=a.commandList;for(r=c.length;b<r;++b)if(g=c[b],g.primitiveType===m.POINTS&&g.pass!==d.TRANSLUCENT){k=g.derivedCommands.pointCloudProcessor;if(!f(k)||g.dirty||e||k.framebuffer!==this._framebuffer)k=h.shallowClone(g),g.derivedCommands.pointCloudProcessor=k,k.framebuffer=this._framebuffer,k.shaderProgram=w(a.context,g.shaderProgram),k.castShadows=!1,k.receiveShadows=!1;c[b]=k}a=this._clearCommand;c.push(this._drawCommand);c.push(a)}};B.prototype.isDestroyed=function(){return!1};B.prototype.destroy=function(){I(this);return k(this)};return B});F("Scene/PointCloudShading",["../Core/defaultValue","./PointCloudEyeDomeLighting"],function(b,a){function f(a){a=b(a,{});this.attenuation=b(a.attenuation,!1);this.geometricErrorScale=b(a.geometricErrorScale,1);this.maximumAttenuation=a.maximumAttenuation;this.baseResolution=a.baseResolution;this.eyeDomeLighting=b(a.eyeDomeLighting,!0);this.eyeDomeLightingStrength=b(a.eyeDomeLightingStrength,1);this.eyeDomeLightingRadius=b(a.eyeDomeLightingRadius,1);this.backFaceCulling=b(a.backFaceCulling,!1);this.normalShading=b(a.normalShading,!0)}f.isSupported=function(b){return a.isSupported(b.context)};return f});F("Scene/PointCloud3DTileContent","../Core/Color ../Core/combine ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/FeatureDetection ../Core/Math ../Renderer/Pass ../Renderer/ShaderSource ./Cesium3DTileBatchTable ./Cesium3DTileFeature ./Cesium3DTileRefine ./PointCloud ./PointCloudShading ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a,b,d,e,f){this._tileset=a;this._tile=b;this._resource=d;this._batchTable=this._pickId=void 0;this._styleDirty=!1;this._features=void 0;this.featurePropertiesDirty=!1;this._pointCloud=new c({arrayBuffer:e,byteOffset:f,cull:!1,opaquePass:p.CESIUM_3D_TILE,vertexShaderLoaded:z(this),fragmentShaderLoaded:x(this),uniformMapLoaded:D(this),batchTableLoaded:v(this),pickIdLoaded:B(this)})}function z(a){return function(b){return k(a._batchTable)?a._batchTable.getVertexShaderCallback(!1,"a_batchId",void 0)(b):b}}function x(a){return function(b){return k(a._batchTable)?a._batchTable.getFragmentShaderCallback(!1,void 0)(b):"uniform vec4 czm_pickColor;\n"+b}}function D(b){return function(c){return k(b._batchTable)?b._batchTable.getUniformMapCallback()(c):a(c,{czm_pickColor:function(){return b._pickId.color}})}}function v(a){return function(b,c,d){a._batchTable=new q(a,b,c,d)}}function B(a){return function(){return k(a._batchTable)?a._batchTable.getPickId():"czm_pickColor"}}g(A.prototype,{featuresLength:{get:function(){return k(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return this._pointCloud.pointsLength}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return this._pointCloud.geometryByteLength}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return k(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._pointCloud.readyPromise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});A.prototype.hasProperty=function(a,b){return k(this._batchTable)?this._batchTable.hasProperty(a,b):!1};A.prototype.getFeature=function(a){if(k(this._batchTable)){var b=this.featuresLength;if(!k(a)||0>a||a>=b)throw new m("batchId is required and between zero and featuresLength - 1 ("+(b-1)+").");b=this.featuresLength;if(!k(this._features)&&0<b){for(var c=Array(b),d=0;d<b;++d)c[d]=new t(this,d);this._features=c}return this._features[a]}};A.prototype.applyDebugSettings=function(a,c){this._pointCloud.color=a?c:b.WHITE};A.prototype.applyStyle=function(a){k(this._batchTable)?this._batchTable.applyStyle(a):this._styleDirty=!0};var C=new u;A.prototype.update=function(a,b){var c=this._pointCloud,d=f(a.pointCloudShading,C),e=this._tile,g=this._batchTable,l=b.mode,m=a.clippingPlanes;k(this._pickId)||k(g)||(this._pickId=b.context.createPickId({primitive:a,content:this}));k(g)&&g.update(a,b);var l=k(e._contentBoundingVolume)?l===y.SCENE3D?e._contentBoundingVolume.boundingSphere:e._contentBoundingVolume2D.boundingSphere:l===y.SCENE3D?e._boundingVolume.boundingSphere:e._boundingVolume2D.boundingSphere,p=this._styleDirty;this._styleDirty=!1;c.clippingPlanesOriginMatrix=a.clippingPlanesOriginMatrix;c.style=k(g)?void 0:a.style;c.styleDirty=p;c.modelMatrix=e.computedTransform;c.time=a.timeSinceLoad;c.shadows=a.shadows;c.boundingSphere=l;c.clippingPlanes=m;c.isClipped=k(m)&&m.enabled&&e._isClipped;c.clippingPlanesDirty=e.clippingPlanesDirty;c.attenuation=d.attenuation;c.backFaceCulling=d.backFaceCulling;c.normalShading=d.normalShading;g=this._tileset.pointCloudShading;m=this._tile.contentBoundingVolume.boundingSphere.volume();m=h.cbrt(m/this.pointsLength);l=this._tile.geometricError;0===l&&(l=k(g)&&k(g.baseResolution)?g.baseResolution:m);c.geometricError=l;c.geometricErrorScale=d.geometricErrorScale;k(d)&&k(d.maximumAttenuation)?c.maximumAttenuation=d.maximumAttenuation:c.maximumAttenuation=e.refine===r.ADD?5:a.maximumScreenSpaceError;c.update(b)};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){this._pickId=this._pickId&&this._pickId.destroy();this._pointCloud=this._pointCloud&&this._pointCloud.destroy();this._batchTable=this._batchTable&&this._batchTable.destroy();return l(this)};return A});F("Scene/Tileset3DTileContent","../Core/defaultValue ../Core/defineProperties ../Core/destroyObject ../Core/getStringFromTypedArray ../Core/RuntimeError ../ThirdParty/when".split(" "),function(b,a,f,k,g,l){function m(a,f,m,d,q){this._tileset=a;this._tile=f;this._resource=m;this._readyPromise=l.defer();this.featurePropertiesDirty=!1;a:{a=b(q,0);d=new Uint8Array(d);d=k(d,a);var e;try{e=JSON.parse(d)}catch(r){this._readyPromise.reject(new g("Invalid tile content."));break a}this._tileset.loadTileset(this._resource,e,this._tile);this._readyPromise.resolve(this)}}a(m.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){}}});m.prototype.hasProperty=function(a,b){return!1};m.prototype.getFeature=function(a){};m.prototype.applyDebugSettings=function(a,b){};m.prototype.applyStyle=function(a){};m.prototype.update=function(a,b){};m.prototype.isDestroyed=function(){return!1};m.prototype.destroy=function(){return f(this)};return m});F("Scene/Cesium3DTilePointFeature","../Core/Cartographic ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ./createBillboardPointCallback".split(" "),function(b,a,f,k,g,l){function m(a,b,f,g,h){this._content=a;this._billboard=f;this._label=g;this._polyline=h;this._batchId=b;this._heightOffset=this._pointOutlineWidth=this._pointOutlineColor=this._pointSize=this._color=this._pointSize=this._billboardSize=this._billboardOutlineWidth=this._billboardOutlineColor=this._billboardColor=this._billboardImage=void 0;this._pickIds=Array(3);e(this)}function e(b){var d=b._billboard;if(k(b._billboardImage)&&b._billboardImage!==d.image)d.image=b._billboardImage;else if(!k(b._billboardImage)){var e=f(b._color,m.defaultColor),g=f(b._pointOutlineColor,m.defaultPointOutlineColor),h=f(b._pointOutlineWidth,m.defaultPointOutlineWidth),c=f(b._pointSize,m.defaultPointSize),p=b._billboardOutlineColor,y=b._billboardOutlineWidth,A=b._billboardSize;a.equals(e,b._billboardColor)&&a.equals(g,p)&&h===y&&c===A||(b._billboardColor=a.clone(e,b._billboardColor),b._billboardOutlineColor=a.clone(g,b._billboardOutlineColor),b._billboardOutlineWidth=h,b._billboardSize=c,b=e.alpha,e=e.toCssColorString(),g=g.toCssColorString(),p=JSON.stringify([e,c,g,h]),d.setImage(p,l(b,e,g,h,c)))}}var h=new b;g(m.prototype,{show:{get:function(){return this._label.show},set:function(a){this._label.show=a;this._billboard.show=a;this._polyline.show=a}},color:{get:function(){return this._color},set:function(b){this._color=a.clone(b,this._color);e(this)}},pointSize:{get:function(){return this._pointSize},set:function(a){this._pointSize=a;e(this)}},pointOutlineColor:{get:function(){return this._pointOutlineColor},set:function(b){this._pointOutlineColor=a.clone(b,this._pointOutlineColor);e(this)}},pointOutlineWidth:{get:function(){return this._pointOutlineWidth},set:function(a){this._pointOutlineWidth=a;e(this)}},labelColor:{get:function(){return this._label.fillColor},set:function(a){this._label.fillColor=a;this._polyline.show=this._label.show&&0<a.alpha}},labelOutlineColor:{get:function(){return this._label.outlineColor},set:function(a){this._label.outlineColor=a}},labelOutlineWidth:{get:function(){return this._label.outlineWidth},set:function(a){this._label.outlineWidth=a}},font:{get:function(){return this._label.font},set:function(a){this._label.font=a}},labelStyle:{get:function(){return this._label.style},set:function(a){this._label.style=a}},labelText:{get:function(){return this._label.text},set:function(a){k(a)||(a="");this._label.text=a}},backgroundColor:{get:function(){return this._label.backgroundColor},set:function(a){this._label.backgroundColor=a}},backgroundPadding:{get:function(){return this._label.backgroundPadding},set:function(a){this._label.backgroundPadding=a}},backgroundEnabled:{get:function(){return this._label.showBackground},set:function(a){this._label.showBackground=a}},scaleByDistance:{get:function(){return this._label.scaleByDistance},set:function(a){this._label.scaleByDistance=a;this._billboard.scaleByDistance=a}},translucencyByDistance:{get:function(){return this._label.translucencyByDistance},set:function(a){this._label.translucencyByDistance=a;this._billboard.translucencyByDistance=a}},distanceDisplayCondition:{get:function(){return this._label.distanceDisplayCondition},set:function(a){this._label.distanceDisplayCondition=a;this._polyline.distanceDisplayCondition=a;this._billboard.distanceDisplayCondition=a}},heightOffset:{get:function(){return this._heightOffset},set:function(a){var b=f(this._heightOffset,0),e=this._content.tileset.ellipsoid,g=e.cartesianToCartographic(this._billboard.position,h);g.height=g.height-b+a;b=e.cartographicToCartesian(g);this._billboard.position=b;this._label.position=this._billboard.position;this._polyline.positions=[this._polyline.positions[0],b];this._heightOffset=a}},anchorLineEnabled:{get:function(){return this._polyline.show},set:function(a){this._polyline.show=a}},anchorLineColor:{get:function(){return this._polyline.material.uniforms.color},set:function(b){this._polyline.material.uniforms.color=a.clone(b,this._polyline.material.uniforms.color)}},image:{get:function(){return this._billboardImage},set:function(a){var b=this._billboardImage!==a;this._billboardImage=a;b&&e(this)}},disableDepthTestDistance:{get:function(){return this._label.disableDepthTestDistance},set:function(a){this._label.disableDepthTestDistance=a;this._billboard.disableDepthTestDistance=a}},horizontalOrigin:{get:function(){return this._billboard.horizontalOrigin},set:function(a){this._billboard.horizontalOrigin=a}},verticalOrigin:{get:function(){return this._billboard.verticalOrigin},set:function(a){this._billboard.verticalOrigin=a}},labelHorizontalOrigin:{get:function(){return this._label.horizontalOrigin},set:function(a){this._label.horizontalOrigin=a}},labelVerticalOrigin:{get:function(){return this._label.verticalOrigin},set:function(a){this._label.verticalOrigin=a}},content:{get:function(){return this._content}},tileset:{get:function(){return this._content.tileset}},primitive:{get:function(){return this._content.tileset}},pickIds:{get:function(){var a=this._pickIds;a[0]=this._billboard.pickId;a[1]=this._label.pickId;a[2]=this._polyline.pickId;return a}}});m.defaultColor=a.WHITE;m.defaultPointOutlineColor=a.BLACK;m.defaultPointOutlineWidth=0;m.defaultPointSize=8;m.prototype.hasProperty=function(a){return this._content.batchTable.hasProperty(this._batchId,a)};m.prototype.getPropertyNames=function(a){return this._content.batchTable.getPropertyNames(this._batchId,a)};m.prototype.getProperty=function(a){return this._content.batchTable.getProperty(this._batchId,a)};m.prototype.setProperty=function(a,b){this._content.batchTable.setProperty(this._batchId,a,b);this._content.featurePropertiesDirty=!0};m.prototype.isExactClass=function(a){return this._content.batchTable.isExactClass(this._batchId,a)};m.prototype.isClass=function(a){return this._content.batchTable.isClass(this._batchId,a)};m.prototype.getExactClassName=function(){return this._content.batchTable.getExactClassName(this._batchId)};return m});F("Scene/Vector3DTilePoints","../Core/arraySlice ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Color ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DistanceDisplayCondition ../Core/Ellipsoid ../Core/NearFarScalar ../Core/Rectangle ../Core/TaskProcessor ../ThirdParty/when ./BillboardCollection ./Cesium3DTilePointFeature ./HorizontalOrigin ./LabelCollection ./LabelStyle ./PolylineCollection ./VerticalOrigin".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(a){this._positions=a.positions;this._batchTable=a.batchTable;this._batchIds=a.batchIds;this._rectangle=a.rectangle;this._minHeight=a.minimumHeight;this._maxHeight=a.maximumHeight;this._packedBuffer=this._verticesPromise=this._polylineCollection=this._labelCollection=this._billboardCollection=void 0;this._ready=!1;this._readyPromise=t.defer();this._resolvedPromise=!1}function v(a,b){var c=a._rectangle,e=a._minHeight,f=a._maxHeight,g=new Float64Array(2+d.packedLength+h.packedLength),k=0;g[k++]=e;g[k++]=f;d.pack(c,g,k);k+=d.packedLength;h.pack(b,g,k);return g}function B(a,c){if(!g(a._billboardCollection)){var d;if(!g(a._verticesPromise)){d=a._positions;var e=a._packedBuffer;g(e)||(d=a._positions=b(d),a._batchIds=b(a._batchIds),e=a._packedBuffer=v(a,c));d=a._verticesPromise=C.scheduleTask({positions:d.buffer,packedBuffer:e.buffer},[d.buffer,e.buffer]);if(!g(d))return;d.then(function(b){a._positions=new Float64Array(b.positions);a._ready=!0})}if(a._ready&&!g(a._billboardCollection)){d=a._positions;var h=a._batchTable,e=a._batchIds,k=a._billboardCollection=new r({batchTable:h}),h=a._labelCollection=new y({batchTable:h}),l=a._polylineCollection=new z;l._useHighlightColor=!0;for(var m=d.length/3,p=0;p<m;++p){var q=e[p],t=f.unpack(d,3*p,I),w=k.add();w.position=t;w._batchIndex=q;w=h.add();w.text=" ";w.position=t;w._batchIndex=q;l.add().positions=[f.clone(t),f.clone(t)]}a._positions=void 0;a._packedBuffer=void 0}}}l(D.prototype,{pointsLength:{get:function(){return this._billboardCollection.length}},texturesByteLength:{get:function(){return this._billboardCollection.textureAtlas.texture.sizeInBytes+this._labelCollection._textureAtlas.texture.sizeInBytes}},readyPromise:{get:function(){return this._readyPromise.promise}}});var C=new q("createVectorTilePoints"),I=new f;D.prototype.createFeatures=function(a,b){for(var d=this._billboardCollection,e=this._labelCollection,f=this._polylineCollection,g=this._batchIds,h=g.length,k=0;k<h;++k){var l=g[k],m=d.get(k),p=e.get(k),q=f.get(k);b[l]=new c(a,l,m,p,q)}};D.prototype.applyDebugSettings=function(a,b){a?(k.clone(b,this._billboardCollection._highlightColor),k.clone(b,this._labelCollection._highlightColor),k.clone(b,this._polylineCollection._highlightColor)):(k.clone(k.WHITE,this._billboardCollection._highlightColor),k.clone(k.WHITE,this._labelCollection._highlightColor),k.clone(k.WHITE,this._polylineCollection._highlightColor))};var H=new k,J=new k,w=new k,G=new k,E=new k,L=new k,K=new p,F=new p,N=new e;D.prototype.applyStyle=function(b,d){if(g(b))for(var e=this._batchIds,f=e.length,h=0;h<f;++h){var l=d[e[h]];g(b.show)&&(l.show=b.show.evaluate(l));g(b.pointSize)&&(l.pointSize=b.pointSize.evaluate(l));g(b.color)&&(l.color=b.color.evaluateColor(l,H));g(b.pointOutlineColor)&&(l.pointOutlineColor=b.pointOutlineColor.evaluateColor(l,J));g(b.pointOutlineWidth)&&(l.pointOutlineWidth=b.pointOutlineWidth.evaluate(l));g(b.labelColor)&&(l.labelColor=b.labelColor.evaluateColor(l,w));g(b.labelOutlineColor)&&(l.labelOutlineColor=b.labelOutlineColor.evaluateColor(l,G));g(b.labelOutlineWidth)&&(l.labelOutlineWidth=b.labelOutlineWidth.evaluate(l));g(b.font)&&(l.font=b.font.evaluate(l));g(b.labelStyle)&&(l.labelStyle=b.labelStyle.evaluate(l));g(b.labelText)?l.labelText=b.labelText.evaluate(l):l.labelText=void 0;g(b.backgroundColor)&&(l.backgroundColor=b.backgroundColor.evaluateColor(l,E));g(b.backgroundPadding)&&(l.backgroundPadding=b.backgroundPadding.evaluate(l));g(b.backgroundEnabled)&&(l.backgroundEnabled=b.backgroundEnabled.evaluate(l));if(g(b.scaleByDistance)){var m=b.scaleByDistance.evaluate(l);K.near=m.x;K.nearValue=m.y;K.far=m.z;K.farValue=m.w;l.scaleByDistance=K}else l.scaleByDistance=void 0;g(b.translucencyByDistance)?(m=b.translucencyByDistance.evaluate(l),F.near=m.x,F.nearValue=m.y,F.far=m.z,F.farValue=m.w,l.translucencyByDistance=F):l.translucencyByDistance=void 0;g(b.distanceDisplayCondition)?(m=b.distanceDisplayCondition.evaluate(l),N.near=m.x,N.far=m.y,l.distanceDisplayCondition=N):l.distanceDisplayCondition=void 0;g(b.heightOffset)&&(l.heightOffset=b.heightOffset.evaluate(l));g(b.anchorLineEnabled)&&(l.anchorLineEnabled=b.anchorLineEnabled.evaluate(l));g(b.anchorLineColor)&&(l.anchorLineColor=b.anchorLineColor.evaluateColor(l,L));g(b.image)?l.image=b.image.evaluate(l):l.image=void 0;g(b.disableDepthTestDistance)&&(l.disableDepthTestDistance=b.disableDepthTestDistance.evaluate(l));g(b.horizontalOrigin)&&(l.horizontalOrigin=b.horizontalOrigin.evaluate(l));g(b.verticalOrigin)&&(l.verticalOrigin=b.verticalOrigin.evaluate(l));g(b.labelHorizontalOrigin)&&(l.labelHorizontalOrigin=b.labelHorizontalOrigin.evaluate(l));g(b.labelVerticalOrigin)&&(l.labelVerticalOrigin=b.labelVerticalOrigin.evaluate(l))}else for(e=this._batchIds,f=e.length,h=0;h<f;++h)l=d[e[h]],l.show=!0,l.pointSize=c.defaultPointSize,l.color=c.defaultColor,l.pointOutlineColor=c.defaultPointOutlineColor,l.pointOutlineWidth=c.defaultPointOutlineWidth,l.labelColor=k.WHITE,l.labelOutlineColor=k.WHITE,l.labelOutlineWidth=1,l.font="30px sans-serif",l.labelStyle=A.FILL,l.labelText=void 0,l.backgroundColor=new k(.165,.165,.165,.8),l.backgroundPadding=new a(7,5),l.backgroundEnabled=!1,l.scaleByDistance=void 0,l.translucencyByDistance=void 0,l.distanceDisplayCondition=void 0,l.heightOffset=0,l.anchorLineEnabled=!1,l.anchorLineColor=k.WHITE,l.image=void 0,l.disableDepthTestDistance=0,l.horizontalOrigin=u.CENTER,l.verticalOrigin=x.CENTER,l.labelHorizontalOrigin=u.RIGHT,l.labelVerticalOrigin=x.BASELINE};D.prototype.update=function(a){B(this,a.mapProjection.ellipsoid);this._ready&&(this._polylineCollection.update(a),this._billboardCollection.update(a),this._labelCollection.update(a),this._resolvedPromise||(this._readyPromise.resolve(),this._resolvedPromise=!0))};D.prototype.isDestroyed=function(){return!1};D.prototype.destroy=function(){this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy();this._labelCollection=this._labelCollection&&this._labelCollection.destroy();this._polylineCollection=this._polylineCollection&&this._polylineCollection.destroy();return m(this)};return D});F("Scene/Vector3DTilePolygons","../Core/arraySlice ../Core/Cartesian3 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Ellipsoid ../Core/IndexDatatype ../Core/OrientedBoundingBox ../Core/Rectangle ../Core/TaskProcessor ../ThirdParty/when ./ClassificationType ./Vector3DTileBatch ./Vector3DTilePrimitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(b){this._batchTable=b.batchTable;this._batchIds=b.batchIds;this._positions=b.positions;this._counts=b.counts;this._indices=b.indices;this._indexCounts=b.indexCounts;this._vertexBatchIds=this._transferrableBatchIds=this._batchedPositions=this._packedBuffer=this._batchTableColors=this._indexOffsets=void 0;this._ellipsoid=k(b.ellipsoid,e.WGS84);this._minimumHeight=b.minimumHeight;this._maximumHeight=b.maximumHeight;this._polygonMinimumHeights=b.polygonMinimumHeights;this._polygonMaximumHeights=b.polygonMaximumHeights;this._center=k(b.center,a.ZERO);this._rectangle=b.rectangle;this._center=void 0;this._boundingVolume=b.boundingVolume;this._batchedIndices=this._boundingVolumes=void 0;this._ready=!1;this._readyPromise=t.defer();this._primitive=this._verticesPromise=void 0;this.forceRebatch=this.debugWireframe=!1;this.classificationType=r.BOTH}function A(b){var c=new Float64Array(3+a.packedLength+e.packedLength+d.packedLength),f=0;c[f++]=b._indices.BYTES_PER_ELEMENT;c[f++]=b._minimumHeight;c[f++]=b._maximumHeight;a.pack(b._center,c,f);f+=a.packedLength;e.pack(b._ellipsoid,c,f);f+=e.packedLength;d.pack(b._rectangle,c,f);return c}function z(a){if(!g(a._primitive)){if(!g(a._verticesPromise)){var e=a._positions,k=a._counts,l=a._indexCounts,m=a._indices,q=a._transferrableBatchIds,r=a._batchTableColors,v=a._packedBuffer;if(!g(r)){e=a._positions=b(a._positions);k=a._counts=b(a._counts);l=a._indexCounts=b(a._indexCounts);m=a._indices=b(a._indices);a._center=a._ellipsoid.cartographicToCartesian(d.center(a._rectangle));for(var q=a._transferrableBatchIds=new Uint32Array(a._batchIds),r=a._batchTableColors=new Uint32Array(q.length),y=a._batchTable,v=r.length,z=0;z<v;++z){var K=y.getColor(z,D);r[z]=K.toRgba()}v=a._packedBuffer=A(a)}y=[e.buffer,k.buffer,l.buffer,m.buffer,q.buffer,r.buffer,v.buffer];e={packedBuffer:v.buffer,positions:e.buffer,counts:k.buffer,indexCounts:l.buffer,indices:m.buffer,batchIds:q.buffer,batchTableColors:r.buffer};k=a._polygonMinimumHeights;l=a._polygonMaximumHeights;g(k)&&g(l)&&(k=b(k),l=b(l),y.push(k.buffer,l.buffer),e.minimumHeights=k,e.maximumHeights=l);e=a._verticesPromise=x.scheduleTask(e,y);if(!g(e))return;t(e,function(b){a._positions=void 0;a._counts=void 0;a._polygonMinimumHeights=void 0;a._polygonMaximumHeights=void 0;for(var d=new Float64Array(b.packedBuffer),e=d[0],g=1,k=d[g++],l=a._boundingVolumes=Array(k),m=0;m<k;++m)l[m]=p.unpack(d,g),g+=p.packedLength;k=d[g++];l=a._batchedIndices=Array(k);for(m=0;m<k;++m){for(var q=f.unpack(d,g),g=g+f.packedLength,r=d[g++],t=d[g++],w=d[g++],u=Array(w),v=0;v<w;++v)u[v]=d[g++];l[m]=new c({color:q,offset:r,count:t,batchIds:u})}a._indices=2===h.getSizeInBytes(e)?new Uint16Array(b.indices):new Uint32Array(b.indices);a._indexOffsets=new Uint32Array(b.indexOffsets);a._indexCounts=new Uint32Array(b.indexCounts);a._batchedPositions=new Float32Array(b.positions);a._vertexBatchIds=new Uint16Array(b.batchIds);a._ready=!0})}a._ready&&!g(a._primitive)&&(a._primitive=new u({batchTable:a._batchTable,positions:a._batchedPositions,batchIds:a._batchIds,vertexBatchIds:a._vertexBatchIds,indices:a._indices,indexOffsets:a._indexOffsets,indexCounts:a._indexCounts,batchedIndices:a._batchedIndices,boundingVolume:a._boundingVolume,boundingVolumes:a._boundingVolumes,center:a._center}),a._batchTable=void 0,a._batchIds=void 0,a._positions=void 0,a._counts=void 0,a._indices=void 0,a._indexCounts=void 0,a._indexOffsets=void 0,a._batchTableColors=void 0,a._packedBuffer=void 0,a._batchedPositions=void 0,a._transferrableBatchIds=void 0,a._vertexBatchIds=void 0,a._ellipsoid=void 0,a._minimumHeight=void 0,a._maximumHeight=void 0,a._polygonMinimumHeights=void 0,a._polygonMaximumHeights=void 0,a._center=void 0,a._rectangle=void 0,a._boundingVolume=void 0,a._boundingVolumes=void 0,a._batchedIndices=void 0,a._verticesPromise=void 0,a._readyPromise.resolve())}}l(y.prototype,{trianglesLength:{get:function(){return g(this._primitive)?this._primitive.trianglesLength:0}},geometryByteLength:{get:function(){return g(this._primitive)?this._primitive.geometryByteLength:0}},readyPromise:{get:function(){return this._readyPromise.promise}}});var x=new q("createVectorTilePolygons"),D=new f;y.prototype.createFeatures=function(a,b){this._primitive.createFeatures(a,b)};y.prototype.applyDebugSettings=function(a,b){this._primitive.applyDebugSettings(a,b)};y.prototype.applyStyle=function(a,b){this._primitive.applyStyle(a,b)};y.prototype.updateCommands=function(a,b){this._primitive.updateCommands(a,b)};y.prototype.update=function(a){z(this);this._ready&&(this._primitive.debugWireframe=this.debugWireframe,this._primitive.forceRebatch=this.forceRebatch,this._primitive.classificationType=this.classificationType,this._primitive.update(a))};y.prototype.isDestroyed=function(){return!1};y.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();return m(this)};return y});F("Shaders/Vector3DTilePolylinesVS",[],function(){return"attribute vec4 currentPosition;\nattribute vec4 previousPosition;\nattribute vec4 nextPosition;\nattribute vec2 expandAndWidth;\nattribute float a_batchId;\nuniform mat4 u_modifiedModelView;\nvoid main()\n{\nfloat expandDir \x3d expandAndWidth.x;\nfloat width \x3d abs(expandAndWidth.y) + 0.5;\nbool usePrev \x3d expandAndWidth.y \x3c 0.0;\nvec4 p \x3d u_modifiedModelView * currentPosition;\nvec4 prev \x3d u_modifiedModelView * previousPosition;\nvec4 next \x3d u_modifiedModelView * nextPosition;\nfloat angle;\nvec4 positionWC \x3d getPolylineWindowCoordinatesEC(p, prev, next, expandDir, width, usePrev, angle);\ngl_Position \x3d czm_viewportOrthographic * positionWC;\n#ifdef LOG_DEPTH\nczm_vertexLogDepth(czm_projection * p);\n#endif\n}\n"});F("Scene/Vector3DTilePolylines","../Core/arraySlice ../Core/Cartesian3 ../Core/Color ../Core/ComponentDatatype ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Ellipsoid ../Core/FeatureDetection ../Core/IndexDatatype ../Core/Matrix4 ../Core/Rectangle ../Core/TaskProcessor ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Shaders/PolylineCommon ../Shaders/Vector3DTilePolylinesVS ../ThirdParty/when ./BlendingState ./Cesium3DTileFeature".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J){function w(a){this._positions=a.positions;this._widths=a.widths;this._counts=a.counts;this._batchIds=a.batchIds;this._ellipsoid=g(a.ellipsoid,h.WGS84);this._minimumHeight=a.minimumHeight;this._maximumHeight=a.maximumHeight;this._center=a.center;this._rectangle=a.rectangle;this._boundingVolume=a.boundingVolume;this._batchTable=a.batchTable;this._indices=this._vertexBatchIds=this._expandAndWidth=this._nextPositions=this._previousPositions=this._currentPositions=this._packedBuffer=this._transferrableBatchIds=this._command=this._uniformMap=this._rs=this._sp=this._va=void 0;this._highlightColor=this._constantColor=f.clone(f.WHITE);this._geometryByteLength=this._trianglesLength=0;this._ready=!1;this._readyPromise=I.defer();this._verticesPromise=void 0}function G(b){var c=b._rectangle,d=b._minimumHeight,e=b._maximumHeight,f=b._ellipsoid;b=b._center;var g=new Float64Array(2+t.packedLength+h.packedLength+a.packedLength),k=0;g[k++]=d;g[k++]=e;t.pack(c,g,k);k+=t.packedLength;h.pack(f,g,k);k+=h.packedLength;a.pack(b,g,k);return g}function E(a,e){if(!l(a._va)){if(!l(a._verticesPromise)){var f=a._positions,g=a._widths,h=a._counts,m=a._transferrableBatchIds,p=a._packedBuffer;l(p)||(f=a._positions=b(f),g=a._widths=b(g),h=a._counts=b(h),m=a._transferrableBatchIds=b(a._batchIds),p=a._packedBuffer=G(a));f=a._verticesPromise=K.scheduleTask({positions:f.buffer,widths:g.buffer,counts:h.buffer,batchIds:m.buffer,packedBuffer:p.buffer},[f.buffer,g.buffer,h.buffer,m.buffer,p.buffer]);if(!l(f))return;I(f,function(b){a._currentPositions=new Float32Array(b.currentPositions);a._previousPositions=new Float32Array(b.previousPositions);a._nextPositions=new Float32Array(b.nextPositions);a._expandAndWidth=new Float32Array(b.expandAndWidth);a._vertexBatchIds=new Uint16Array(b.batchIds);a._indices=b.indexDatatype===d.UNSIGNED_SHORT?new Uint16Array(b.indices):new Uint32Array(b.indices);a._ready=!0})}if(a._ready&&!l(a._va)){var p=a._currentPositions,h=a._previousPositions,q=a._nextPositions,m=a._expandAndWidth,g=a._vertexBatchIds,f=a._indices,r=h.byteLength+p.byteLength+q.byteLength,r=r+(m.byteLength+g.byteLength+f.byteLength);a._trianglesLength=f.length/3;a._geometryByteLength=r;h=c.createVertexBuffer({context:e,typedArray:h,usage:u.STATIC_DRAW});p=c.createVertexBuffer({context:e,typedArray:p,usage:u.STATIC_DRAW});q=c.createVertexBuffer({context:e,typedArray:q,usage:u.STATIC_DRAW});m=c.createVertexBuffer({context:e,typedArray:m,usage:u.STATIC_DRAW});g=c.createVertexBuffer({context:e,typedArray:g,usage:u.STATIC_DRAW});f=c.createIndexBuffer({context:e,typedArray:f,usage:u.STATIC_DRAW,indexDatatype:2===f.BYTES_PER_ELEMENT?d.UNSIGNED_SHORT:d.UNSIGNED_INT});a._va=new v({context:e,attributes:[{index:F.previousPosition,vertexBuffer:h,componentDatatype:k.FLOAT,componentsPerAttribute:3},{index:F.currentPosition,vertexBuffer:p,componentDatatype:k.FLOAT,componentsPerAttribute:3},{index:F.nextPosition,vertexBuffer:q,componentDatatype:k.FLOAT,componentsPerAttribute:3},{index:F.expandAndWidth,vertexBuffer:m,componentDatatype:k.FLOAT,componentsPerAttribute:2},{index:F.a_batchId,vertexBuffer:g,componentDatatype:k.UNSIGNED_SHORT,componentsPerAttribute:1}],indexBuffer:f});a._positions=void 0;a._widths=void 0;a._counts=void 0;a._ellipsoid=void 0;a._minimumHeight=void 0;a._maximumHeight=void 0;a._rectangle=void 0;a._transferrableBatchIds=void 0;a._packedBuffer=void 0;a._currentPositions=void 0;a._previousPositions=void 0;a._nextPositions=void 0;a._expandAndWidth=void 0;a._vertexBatchIds=void 0;a._indices=void 0;a._readyPromise.resolve()}}}function L(a,b){l(a._uniformMap)||(a._uniformMap={u_modifiedModelView:function(){q.clone(b.uniformState.view,N);q.multiplyByPoint(N,a._center,O);q.setTranslation(N,O,N);return N},u_highlightColor:function(){return a._highlightColor}})}m(w.prototype,{trianglesLength:{get:function(){return this._trianglesLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},readyPromise:{get:function(){return this._readyPromise.promise}}});var K=new r("createVectorTilePolylines"),F={previousPosition:0,currentPosition:1,nextPosition:2,expandAndWidth:3,a_batchId:4},N=new q,O=new a;w.prototype.createFeatures=function(a,b){for(var c=this._batchIds,d=c.length,e=0;e<d;++e){var f=c[e];b[f]=new J(a,f)}};w.prototype.applyDebugSettings=function(a,b){this._highlightColor=a?b:this._constantColor};var Z=new f,aa=f.WHITE;w.prototype.applyStyle=function(a,b){if(l(a))for(var c=this._batchIds,d=c.length,e=0;e<d;++e){var g=b[c[e]];g.color=l(a.color)?a.color.evaluateColor(g,Z):aa;g.show=l(a.show)?a.show.evaluate(g):!0}else for(c=this._batchIds,d=c.length,e=0;e<d;++e)g=b[c[e]],g.show=!0,g.color=f.WHITE};w.prototype.update=function(a){var b=a.context;E(this,b);L(this,b);if(!l(this._sp)){var c=this._batchTable,d=c.getVertexShaderCallback(!1,"a_batchId",void 0)(C),c=c.getFragmentShaderCallback()("uniform vec4 u_highlightColor; \nvoid main()\n{\n    gl_FragColor \x3d u_highlightColor;\n}\n",!1,void 0),d=new D({defines:["VECTOR_TILE",p.isInternetExplorer()?"":"CLIP_POLYLINE"],sources:[B,d]}),c=new D({defines:["VECTOR_TILE"],sources:[c]});this._sp=x.fromCache({context:b,vertexShaderSource:d,fragmentShaderSource:c,attributeLocations:F})}l(this._rs)||(this._rs=z.fromCache({blending:H.ALPHA_BLEND,depthMask:!1,depthTest:{enabled:!0},polygonOffset:{enabled:!0,factor:-5,units:-5}}));this._ready&&(b=a.passes,b.render||b.pick)&&(l(this._command)||(b=this._batchTable.getUniformMapCallback()(this._uniformMap),this._command=new y({owner:this,vertexArray:this._va,renderState:this._rs,shaderProgram:this._sp,uniformMap:b,boundingVolume:this._boundingVolume,pass:A.TRANSLUCENT,pickId:this._batchTable.getPickId()})),a.commandList.push(this._command))};w.prototype.isDestroyed=function(){return!1};w.prototype.destroy=function(){this._va=this._va&&this._va.destroy();this._sp=this._sp&&this._sp.destroy();return e(this)};return w});F("Scene/Vector3DTileContent","../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Ellipsoid ../Core/FeatureDetection ../Core/getMagic ../Core/getStringFromTypedArray ../Core/Math ../Core/Matrix4 ../Core/Rectangle ../Core/RuntimeError ../ThirdParty/when ./Cesium3DTileBatchTable ./Vector3DTilePoints ./Vector3DTilePolygons ./Vector3DTilePolylines".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(e,g,h,k,l){var w,v,G;this._tileset=e;this._tile=g;this._resource=h;this._contentReadyPromise=this._points=this._polylines=this._polygons=void 0;this._readyPromise=c.defer();this._features=this._batchTable=void 0;this.featurePropertiesDirty=!1;e=a(l,0);var x=new Uint8Array(k);g=new DataView(k);e+=C;h=g.getUint32(e,!0);if(1!==h)throw new r("Only Vector tile version 1 is supported.  Version "+h+" is not.");e+=C;h=g.getUint32(e,!0);e+=C;if(0===h)this._readyPromise.resolve(this);else{var H=g.getUint32(e,!0);e+=C;if(0===H)throw new r("Feature table must have a byte length greater than zero");var I=g.getUint32(e,!0);e+=C;var J=g.getUint32(e,!0);e+=C;var F=g.getUint32(e,!0);e+=C;var U=g.getUint32(e,!0);e+=C;var W=g.getUint32(e,!0);e+=C;h=g.getUint32(e,!0);e+=C;g=g.getUint32(e,!0);e+=C;l=p(x,e,H);l=JSON.parse(l);e+=H;H=new Uint8Array(k,e,I);e+=I;var M,R;0<J&&(x=p(x,e,J),M=JSON.parse(x),e+=J,0<F&&(R=new Uint8Array(k,e,F),R=new Uint8Array(R),e+=F));var Y=a(l.POLYGONS_LENGTH,0),x=a(l.POLYLINES_LENGTH,0),J=a(l.POINTS_LENGTH,0),F=Y+x+J;this._batchTable=R=new u(this,F,M,R,D(this));if(0!==F){if(f(l.REGION))I=l.REGION,M=t.unpack(I),F=I[4],I=I[5];else throw new r("REGION is required in the feature table.");var Q=this._tile.computedTransform,S;f(l.RTC_CENTER)?(S=b.unpack(l.RTC_CENTER),q.multiplyByPoint(Q,S,S)):(S=t.center(M),S.height=d.lerp(F,I,.5),S=m.WGS84.cartographicToCartesian(S));var ca,T=a(l.POLYGONS_LENGTH,0),da=a(l.POLYLINES_LENGTH,0),V=a(l.POINTS_LENGTH,0);0<T&&f(l.POLYGON_BATCH_IDS)&&(w=new Uint16Array(H.buffer,H.byteOffset+l.POLYGON_BATCH_IDS.byteOffset,T));0<da&&f(l.POLYLINE_BATCH_IDS)&&(v=new Uint16Array(H.buffer,H.byteOffset+l.POLYLINE_BATCH_IDS.byteOffset,da));0<V&&f(l.POINT_BATCH_IDS)&&(G=new Uint16Array(H.buffer,H.byteOffset+l.POINT_BATCH_IDS.byteOffset,V));ca=f(w)||f(v)||f(G);var ba=0<T&&!f(w)||0<da&&!f(v)||0<V&&!f(G);if(ca&&ba)throw new r("If one group of batch ids is defined, then all batch ids must be defined.");if(!f(w)&&!f(v)&&!f(G)){ba=0;if(!f(w)&&0<T)for(w=new Uint16Array(T),ca=0;ca<T;++ca)w[ca]=ba++;if(!f(v)&&0<da)for(v=new Uint16Array(da),ca=0;ca<da;++ca)v[ca]=ba++;if(!f(G)&&0<V)for(G=new Uint16Array(V),ca=0;ca<V;++ca)G[ca]=ba++}e+=e%4;if(0<Y){T=new Uint32Array(k,e,U/C);e+=U;U=new Uint16Array(k,e,W/B);e+=W;var W=new Uint32Array(H.buffer,H.byteOffset+l.POLYGON_COUNT.byteOffset,Y),da=new Uint32Array(H.buffer,H.byteOffset+l.POLYGON_INDEX_COUNT.byteOffset,Y),X,fa;f(l.POLYGON_MINIMUM_HEIGHTS)&&f(l.POLYGON_MAXIMUM_HEIGHTS)&&(X=new Float32Array(H.buffer,H.byteOffset+l.POLYGON_MINIMUM_HEIGHTS.byteOffset,Y),fa=new Float32Array(H.buffer,H.byteOffset+l.POLYGON_MAXIMUM_HEIGHTS.byteOffset,Y));this._polygons=new A({positions:U,counts:W,indexCounts:da,indices:T,minimumHeight:F,maximumHeight:I,polygonMinimumHeights:X,polygonMaximumHeights:fa,center:S,rectangle:M,boundingVolume:this.tile.boundingVolume.boundingVolume,batchTable:R,batchIds:w,modelMatrix:Q})}if(0<x){X=new Uint16Array(k,e,h/B);e+=h;fa=new Uint32Array(H.buffer,H.byteOffset+l.POLYLINE_COUNT.byteOffset,x);if(f(l.POLYLINE_WIDTHS))h=new Uint16Array(H.buffer,H.byteOffset+l.POLYLINE_WIDTHS.byteOffset,x);else for(h=new Uint16Array(x),l=0;l<x;++l)h[l]=2;this._polylines=new z({positions:X,widths:h,counts:fa,batchIds:v,minimumHeight:F,maximumHeight:I,center:S,rectangle:M,boundingVolume:this.tile.boundingVolume.boundingVolume,batchTable:R})}0<J&&(k=new Uint16Array(k,e,g/B),this._points=new y({positions:k,batchIds:G,minimumHeight:F,maximumHeight:I,rectangle:M,batchTable:R}))}}}function D(a){return function(b,c){f(a._polygons)&&a._polygons.updateCommands(b,c)}}function v(a){var b=a.featuresLength;!f(a._features)&&0<b&&(b=Array(b),f(a._polygons)&&a._polygons.createFeatures(a,b),f(a._polylines)&&a._polylines.createFeatures(a,b),f(a._points)&&a._points.createFeatures(a,b),a._features=b)}if(!e.supportsTypedArrays())return{};k(x.prototype,{featuresLength:{get:function(){return f(this._batchTable)?this._batchTable.featuresLength:0}},pointsLength:{get:function(){return f(this._points)?this._points.pointsLength:0}},trianglesLength:{get:function(){var a=0;f(this._polygons)&&(a+=this._polygons.trianglesLength);f(this._polylines)&&(a+=this._polylines.trianglesLength);return a}},geometryByteLength:{get:function(){var a=0;f(this._polygons)&&(a+=this._polygons.geometryByteLength);f(this._polylines)&&(a+=this._polylines.geometryByteLength);return a}},texturesByteLength:{get:function(){return f(this._points)?this._points.texturesByteLength:0}},batchTableByteLength:{get:function(){return f(this._batchTable)?this._batchTable.memorySizeInBytes:0}},innerContents:{get:function(){}},readyPromise:{get:function(){return this._readyPromise.promise}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){return this._resource.getUrlComponent(!0)}},batchTable:{get:function(){return this._batchTable}}});var B=Uint16Array.BYTES_PER_ELEMENT,C=Uint32Array.BYTES_PER_ELEMENT;x.prototype.hasProperty=function(a,b){return this._batchTable.hasProperty(a,b)};x.prototype.getFeature=function(a){var b=this.featuresLength;if(!f(a)||0>a||a>=b)throw new l("batchId is required and between zero and featuresLength - 1 ("+(b-1)+").");v(this);return this._features[a]};x.prototype.applyDebugSettings=function(a,b){f(this._polygons)&&this._polygons.applyDebugSettings(a,b);f(this._polylines)&&this._polylines.applyDebugSettings(a,b);f(this._points)&&this._points.applyDebugSettings(a,b)};x.prototype.applyStyle=function(a){v(this);f(this._polygons)&&this._polygons.applyStyle(a,this._features);f(this._polylines)&&this._polylines.applyStyle(a,this._features);f(this._points)&&this._points.applyStyle(a,this._features)};x.prototype.update=function(a,b){var d=!0;f(this._polygons)&&(this._polygons.classificationType=this._tileset.classificationType,this._polygons.debugWireframe=this._tileset.debugWireframe,this._polygons.update(b),d=d&&this._polygons._ready);f(this._polylines)&&(this._polylines.update(b),d=d&&this._polylines._ready);f(this._points)&&(this._points.update(b),d=d&&this._points._ready);f(this._batchTable)&&d&&this._batchTable.update(a,b);if(!f(this._contentReadyPromise)){var d=f(this._points)?this._points.readyPromise:void 0,e=f(this._polygons)?this._polygons.readyPromise:void 0,g=f(this._polylines)?this._polylines.readyPromise:void 0,h=this;this._contentReadyPromise=c.all([d,e,g]).then(function(){h._readyPromise.resolve(h)})}};x.prototype.isDestroyed=function(){return!1};x.prototype.destroy=function(){this._polygons=this._polygons&&this._polygons.destroy();this._polylines=this._polylines&&this._polylines.destroy();this._points=this._points&&this._points.destroy();this._batchTable=this._batchTable&&this._batchTable.destroy();return g(this)};return x});F("Scene/Cesium3DTileContentFactory","./Batched3DModel3DTileContent ./Composite3DTileContent ./Geometry3DTileContent ./Instanced3DModel3DTileContent ./PointCloud3DTileContent ./Tileset3DTileContent ./Vector3DTileContent".split(" "),function(b,a,f,k,g,l,m){var e={b3dm:function(a,e,d,f,g){return new b(a,e,d,f,g)},pnts:function(a,b,d,e,f){return new g(a,b,d,e,f)},i3dm:function(a,b,d,e,f){return new k(a,b,d,e,f)},cmpt:function(b,f,d,g,k){return new a(b,f,d,g,k,e)},json:function(a,b,d,e,f){return new l(a,b,d,e,f)},geom:function(a,b,d,e,g){return new f(a,b,d,e,g)},vctr:function(a,b,d,e,f){return new m(a,b,d,e,f)}};return e});F("Scene/Cesium3DTileContentState",["../Core/freezeObject"],function(b){return b({UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5})});F("Scene/Cesium3DTileOptimizationHint",["../Core/freezeObject"],function(b){return b({NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0})});F("Scene/Cesium3DTilesetMostDetailedTraversal",["../Core/Intersect","../Core/ManagedArray","./Cesium3DTileRefine"],function(b,a,f){function k(){}var g=new a,l=0;k.selectTiles=function(a,e){a._selectedTiles.length=0;a._requestedTiles.length=0;a._hasMixedContent=!1;var h=!0,k=a.root;k.updateVisibility(e);if(!k._visible||!k._inRequestVolume)return h;for(g.push(a.root);0<g.length;){l=Math.max(l,g.length);var k=g.pop(),d=k.refine===f.ADD,m=k.refine===f.REPLACE,t=0===k.children.length?!1:k.hasTilesetContent?!k.contentExpired:!0;if(t)for(var r=g,c=e,u=k.children,y=u.length,A=0;A<y;++A){var z=u[A];z.updateVisibility(c);z._visible&&z._inRequestVolume&&r.push(z)}if(d||m&&!t){d=a;t=m=k;if(!t.hasEmptyContent&&!t.hasTilesetContent&&t.contentUnloaded||m.contentExpired)m._priority=0,d._requestedTiles.push(m);d=k;m=e;d._touchedFrame!==m.frameNumber&&(a._cache.touch(d),d._touchedFrame=m.frameNumber);d=a;m=k;m.contentAvailable&&m.contentVisibility(e)!==b.OUTSIDE&&d._selectedTiles.push(m);k.hasEmptyContent||k.hasTilesetContent||k.contentAvailable||(h=!1)}++a.statistics.visited}g.trim(l);return h};return k});F("Scene/Cesium3DTilesetTraversal","../Core/Cartesian3 ../Core/defined ../Core/Intersect ../Core/ManagedArray ../Core/Math ./Cesium3DTileOptimizationHint ./Cesium3DTileRefine".split(" "),function(b,a,f,k,g,l,m){function e(){}function h(a){return a._visible&&a._inRequestVolume}function p(a,b,c){if(b.contentVisibility(c)!==f.OUTSIDE){var d=b.content;d.featurePropertiesDirty?(d.featurePropertiesDirty=!1,b.lastStyleTime=0,a._selectedTilesToStyle.push(b)):b._selectedFrame<c.frameNumber-1&&a._selectedTilesToStyle.push(b);b._selectedFrame=c.frameNumber;a._selectedTiles.push(b)}}function d(b,d,e){if(b._skipLevelOfDetail){var f=d.contentAvailable?d:d._ancestorWithContentAvailable;if(a(f))f._shouldSelect=!0;else for(f=D.stack,f.push(d);0<f.length;){D.stackMaximumLength=Math.max(D.stackMaximumLength,f.length);for(var g=f.pop().children,k=g.length,l=0;l<k;++l){var m=g[l];h(m)&&(m.contentAvailable?(c(b,m,e),q(b,m,e),p(b,m,e)):2>m._depth-d._depth&&f.push(m))}}}else d.contentAvailable&&p(b,d,e)}function q(a,b,c){b._touchedFrame!==c.frameNumber&&(a._cache.touch(b),b._touchedFrame=c.frameNumber)}function t(a,b,c){if(b._requestedFrame!==c.frameNumber&&(!b.hasEmptyContent&&!b.hasTilesetContent&&b.contentUnloaded||b.contentExpired)){var d;a.cullRequestsWhileMoving?(d=c.camera,d=1>a.cullRequestsWhileMovingMultiplier*(0!==d.positionWCDeltaMagnitude?d.positionWCDeltaMagnitude:d.positionWCDeltaMagnitudeLastFrame)/Math.max(2*b.boundingSphere.radius,1)):d=!0;d&&(d=c.camera.timeSinceMoved<a.foveatedTimeDelay,b.priorityDeferred&&d||(b._requestedFrame=c.frameNumber,a._requestedTiles.push(b)))}}function r(b,c,d){c._updatedVisibilityFrame!==b._updatedVisibilityFrame&&(c.updateVisibility(d),c._updatedVisibilityFrame=b._updatedVisibilityFrame);if(h(c)){var e=0<c.children.length;if(c.hasTilesetContent&&e)e=c.children[0],r(b,e,d),c._visible=e._visible;else{var f;f=c.parent;f=!a(f)||f.hasTilesetContent||f.refine!==m.ADD?!1:c.getScreenSpaceError(d,!0)<=b._maximumScreenSpaceError;if(f)c._visible=!1;else if(f=c._optimChildrenWithinParent===l.USE_OPTIMIZATION,c.refine===m.REPLACE&&f&&e){e=!1;f=c.children;for(var g=f.length,k=0;k<g;++k){var p=f[k],q=b,t=p;t._updatedVisibilityFrame!==q._updatedVisibilityFrame&&(t.updateVisibility(d),t._updatedVisibilityFrame=q._updatedVisibilityFrame);e=e||h(p)}e||(++b._statistics.numberOfTilesCulledWithChildrenUnion,c._visible=!1)}}}}function c(a,b,c){r(a,b,c);b.updateExpiration();b._wasMinPriorityChild=!1;b._priorityHolder=b;a._maximumPriority.distance=Math.max(b._priorityHolder._distanceToCamera,a._maximumPriority.distance);a._minimumPriority.distance=Math.min(b._priorityHolder._distanceToCamera,a._minimumPriority.distance);a._maximumPriority.depth=Math.max(b._depth,a._maximumPriority.depth);a._minimumPriority.depth=Math.min(b._depth,a._minimumPriority.depth);a._maximumPriority.foveatedFactor=Math.max(b._priorityHolder._foveatedFactor,a._maximumPriority.foveatedFactor);a._minimumPriority.foveatedFactor=Math.min(b._priorityHolder._foveatedFactor,a._minimumPriority.foveatedFactor);a._maximumPriority.reverseScreenSpaceError=Math.max(b._priorityReverseScreenSpaceError,a._maximumPriority.reverseScreenSpaceError);a._minimumPriority.reverseScreenSpaceError=Math.min(b._priorityReverseScreenSpaceError,a._minimumPriority.reverseScreenSpaceError);b._shouldSelect=!1;b._finalResolution=!0}function u(a,b){return 0===b._distanceToCamera&&0===a._distanceToCamera?b._centerZDepth-a._centerZDepth:b._distanceToCamera-a._distanceToCamera}function y(a,b){return 0===b.children.length?!1:b.hasTilesetContent?!b.contentExpired:b._screenSpaceError>a._maximumScreenSpaceError}function A(b,e,f,g,k){g=z.stack;for(g.push(e);0<g.length;){z.stackMaximumLength=Math.max(z.stackMaximumLength,g.length);var l=e=g.pop(),p=k;l._ancestorWithContent=void 0;l._ancestorWithContentAvailable=void 0;var r=l.parent;a(r)&&(l._ancestorWithContent=r.hasEmptyContent||r.hasTilesetContent||!r.contentUnloaded||r._requestedFrame===p.frameNumber?r:r._ancestorWithContent,l._ancestorWithContentAvailable=r.contentAvailable?r:r._ancestorWithContentAvailable);var l=e,p=f,l=b._skipLevelOfDetail?b.immediatelyLoadDesiredLevelOfDetail?!1:a(l._ancestorWithContent)?0===l._screenSpaceError?l.parent._screenSpaceError>p:l._screenSpaceError>p:!0:!0,p=e.refine===m.ADD,r=e.refine===m.REPLACE,w=e.parent,w=!a(w)||w._refines,v=!1;if(y(b,e)){var E=b,A=e,C=g,B=k,G,D=A.refine===m.REPLACE,v=A.children,H=v.length;for(G=0;G<H;++G)c(E,v[G],B);v.sort(u);var I=!E._skipLevelOfDetail&&D&&!(A.hasEmptyContent||A.hasTilesetContent),J=!0,F=!1,T=-1,da=Number.MAX_VALUE,V;for(G=0;G<H;++G){V=v[G];if(h(V))C.push(V),V._foveatedFactor<da&&(T=G,da=V._foveatedFactor),F=!0;else if(I||E.loadSiblings)V._foveatedFactor<da&&(T=G,da=V._foveatedFactor),t(E,V,B),q(E,V,B);if(I){var ba;if(V._inRequestVolume)if(V.hasEmptyContent||V.hasTilesetContent){ba=E;var X=B,fa=!0,ga=x.stack;for(ga.push(V);0<ga.length;){x.stackMaximumLength=Math.max(x.stackMaximumLength,ga.length);var ka=ga.pop();V=ka.children;var na=V.length,ia=(ka.hasEmptyContent||ka.hasTilesetContent)&&y(ba,ka);ia||ka.contentAvailable||(fa=!1);c(ba,ka,X);h(ka)||(t(ba,ka,X),q(ba,ka,X));if(ia)for(ka=0;ka<na;++ka)ga.push(V[ka])}ba=fa}else ba=V.contentAvailable;else ba=!1;J=J&&ba}}F||(J=!1);if(-1!==T&&!E._skipLevelOfDetail&&D)for(G=v[T],G._wasMinPriorityChild=!0,E=(A._wasMinPriorityChild||A===E.root)&&da<=A._priorityHolder._foveatedFactor?A._priorityHolder:A,E._foveatedFactor=Math.min(G._foveatedFactor,E._foveatedFactor),E._distanceToCamera=Math.min(G._distanceToCamera,E._distanceToCamera),G=0;G<H;++G)V=v[G],V._priorityHolder=E;v=J&&w}w=!v&&w;e.hasEmptyContent||e.hasTilesetContent?(b._emptyTiles.push(e),t(b,e,k),w&&d(b,e,k)):p?(d(b,e,k),t(b,e,k)):r&&(l?(t(b,e,k),w&&d(b,e,k)):w?(d(b,e,k),t(b,e,k)):(l=b,p=e,r=p._ancestorWithContent,!l.immediatelyLoadDesiredLevelOfDetail&&(p._priorityProgressiveResolutionScreenSpaceErrorLeaf||a(r)&&p._screenSpaceError<r._screenSpaceError/l.skipScreenSpaceErrorFactor&&p._depth>r._depth+l.skipLevels)&&t(b,e,k)));l=e;p=k;++b._statistics.visited;l._visitedFrame=p.frameNumber;q(b,e,k);e._refines=v}}var z={stack:new k,stackMaximumLength:0},x={stack:new k,stackMaximumLength:0},D={stack:new k,stackMaximumLength:0},v=new k,B=0,C=new k,I=0;e.selectTiles=function(b,d){b._requestedTiles.length=0;if(!b.debugFreezeFrame){b._selectedTiles.length=0;b._selectedTilesToStyle.length=0;b._emptyTiles.length=0;b._hasMixedContent=!1;var e=b.root;c(b,e,d);if(h(e)&&!(e.getScreenSpaceError(d,!0)<=b._maximumScreenSpaceError)){if(b._skipLevelOfDetail){b.immediatelyLoadDesiredLevelOfDetail?A(b,e,Number.MAX_VALUE,b._maximumScreenSpaceError,d):A(b,e,Math.max(b.baseScreenSpaceError,b.maximumScreenSpaceError),b.maximumScreenSpaceError,d);var f;for(v.push(e);0<v.length||0<C.length;){B=Math.max(B,v.length);I=Math.max(I,C.length);if(0<C.length&&(e=C.peek(),e._stackLength===v.length)){C.pop();e!==f&&(e._finalResolution=!1);p(b,e,d);continue}var g=v.pop();if(a(g)){var k=g.refine===m.ADD,l=g._shouldSelect,e=g.children,q=e.length,r=y(b,g);if(l)if(k)p(b,g,d);else{g._selectionDepth=C.length;0<g._selectionDepth&&(b._hasMixedContent=!0);f=g;if(!r){p(b,g,d);continue}C.push(g);g._stackLength=v.length}if(r)for(g=0;g<q;++g)k=e[g],h(k)&&v.push(k)}}}else A(b,e,b._maximumScreenSpaceError,b._maximumScreenSpaceError,d);z.stack.trim(z.stackMaximumLength);x.stack.trim(x.stackMaximumLength);D.stack.trim(D.stackMaximumLength);v.trim(B);C.trim(I);f=b._requestedTiles;e=f.length;for(q=0;q<e;++q)f[q].updatePriority()}}};return e});F("Scene/Cesium3DTilePass",["../Core/Check","../Core/freezeObject","./Cesium3DTilesetMostDetailedTraversal","./Cesium3DTilesetTraversal"],function(b,a,f,k){b={RENDER:0,PICK:1,SHADOW:2,PRELOAD:3,PRELOAD_FLIGHT:4,REQUEST_RENDER_MODE_DEFER_CHECK:5,MOST_DETAILED_PRELOAD:6,MOST_DETAILED_PICK:7,NUMBER_OF_PASSES:8};var g=Array(b.NUMBER_OF_PASSES);g[b.RENDER]=a({traversal:k,isRender:!0,requestTiles:!0,ignoreCommands:!1});g[b.PICK]=a({traversal:k,isRender:!1,requestTiles:!1,ignoreCommands:!1});g[b.SHADOW]=a({traversal:k,isRender:!1,requestTiles:!0,ignoreCommands:!1});g[b.PRELOAD]=a({traversal:k,isRender:!1,requestTiles:!0,ignoreCommands:!0});g[b.PRELOAD_FLIGHT]=a({traversal:k,isRender:!1,requestTiles:!0,ignoreCommands:!0});g[b.REQUEST_RENDER_MODE_DEFER_CHECK]=a({traversal:k,isRender:!1,requestTiles:!0,ignoreCommands:!0});g[b.MOST_DETAILED_PRELOAD]=a({traversal:f,isRender:!1,requestTiles:!0,ignoreCommands:!0});g[b.MOST_DETAILED_PICK]=a({traversal:f,isRender:!1,requestTiles:!1,ignoreCommands:!1});b.getPassOptions=function(a){return g[a]};return a(b)});F("Scene/Empty3DTileContent",["../Core/defineProperties","../Core/destroyObject"],function(b,a){function f(a,b){this._tileset=a;this._tile=b;this.featurePropertiesDirty=!1}b(f.prototype,{featuresLength:{get:function(){return 0}},pointsLength:{get:function(){return 0}},trianglesLength:{get:function(){return 0}},geometryByteLength:{get:function(){return 0}},texturesByteLength:{get:function(){return 0}},batchTableByteLength:{get:function(){return 0}},innerContents:{get:function(){}},readyPromise:{get:function(){}},tileset:{get:function(){return this._tileset}},tile:{get:function(){return this._tile}},url:{get:function(){}},batchTable:{get:function(){}}});f.prototype.hasProperty=function(a,b){return!1};f.prototype.getFeature=function(a){};f.prototype.applyDebugSettings=function(a,b){};f.prototype.applyStyle=function(a){};f.prototype.update=function(a,b){};f.prototype.isDestroyed=function(){return!1};f.prototype.destroy=function(){return a(this)};return f});F("Scene/TileBoundingRegion","../Core/BoundingSphere ../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/ColorGeometryInstanceAttribute ../Core/defaultValue ../Core/defineProperties ../Core/Ellipsoid ../Core/GeometryInstance ../Core/IntersectionTests ../Core/Matrix4 ../Core/OrientedBoundingBox ../Core/Plane ../Core/Ray ../Core/Rectangle ../Core/RectangleOutlineGeometry ./PerInstanceColorAppearance ./Primitive ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(d){k.typeOf.object("options",d);k.typeOf.object("options.rectangle",d.rectangle);this.rectangle=c.clone(d.rectangle);this.minimumHeight=l(d.minimumHeight,0);this.maximumHeight=l(d.maximumHeight,0);this.southwestCornerCartesian=new a;this.northeastCornerCartesian=new a;this.westNormal=new a;this.southNormal=new a;this.eastNormal=new a;this.northNormal=new a;var f=l(d.ellipsoid,e.WGS84),g=d.rectangle;f.cartographicToCartesian(c.southwest(g),this.southwestCornerCartesian);f.cartographicToCartesian(c.northeast(g),this.northeastCornerCartesian);J.longitude=g.west;J.latitude=.5*(g.south+g.north);J.height=0;var h=f.cartographicToCartesian(J,I),m=a.cross(h,a.UNIT_Z,D);a.normalize(m,this.westNormal);J.longitude=g.east;var m=f.cartographicToCartesian(J,H),r=a.cross(a.UNIT_Z,m,D);a.normalize(r,this.eastNormal);h=a.subtract(h,m,D);m=a.normalize(h,C);r=g.south;if(0<r){J.longitude=.5*(g.west+g.east);J.latitude=r;r=f.cartographicToCartesian(J,G.origin);a.clone(m,G.direction);var u=t.fromPointNormal(this.southwestCornerCartesian,this.westNormal,w);p.rayPlane(G,u,this.southwestCornerCartesian);r=f.geodeticSurfaceNormal(r,v)}else r=f.geodeticSurfaceNormalCartographic(c.southeast(g),v);r=a.cross(r,h,B);a.normalize(r,this.southNormal);r=g.north;0>r?(J.longitude=.5*(g.west+g.east),J.latitude=r,g=f.cartographicToCartesian(J,G.origin),a.negate(m,G.direction),m=t.fromPointNormal(this.northeastCornerCartesian,this.eastNormal,w),p.rayPlane(G,m,this.northeastCornerCartesian),g=f.geodeticSurfaceNormal(g,v)):g=f.geodeticSurfaceNormalCartographic(c.northwest(g),v);g=a.cross(h,g,B);a.normalize(g,this.northNormal);l(d.computeBoundingVolumes,!0)&&(this._orientedBoundingBox=q.fromRectangle(this.rectangle,this.minimumHeight,this.maximumHeight,f),this._boundingSphere=b.fromOrientedBoundingBox(this._orientedBoundingBox))}m(x.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});var D=new a,v=new a,B=new a,C=new a,I=new a,H=new a,J=new f,w=new t(a.UNIT_X,0),G=new r,E=new a,L=new a,K=new a(0,-1,0),F=new a(0,0,-1),N=new a;x.prototype.distanceToCamera=function(b){k.defined("frameState",b);var d=b.camera,e=d.positionWC,f=d.positionCartographic,d=0;if(!c.contains(this.rectangle,f)){var g=this.southwestCornerCartesian,h=this.northeastCornerCartesian,l=this.westNormal,m=this.southNormal,p=this.eastNormal,q=this.northNormal;b.mode!==z.SCENE3D&&(g=b.mapProjection.project(c.southwest(this.rectangle),E),g.z=g.y,g.y=g.x,g.x=0,h=b.mapProjection.project(c.northeast(this.rectangle),L),h.z=h.y,h.y=h.x,h.x=0,l=K,p=a.UNIT_Y,m=F,q=a.UNIT_Z);g=a.subtract(e,g,N);l=a.dot(g,l);m=a.dot(g,m);h=a.subtract(e,h,N);p=a.dot(h,p);q=a.dot(h,q);0<l?d+=l*l:0<p&&(d+=p*p);0<m?d+=m*m:0<q&&(d+=q*q)}b.mode===z.SCENE3D?(b=f.height,e=this.minimumHeight,f=this.maximumHeight):(b=e.x,f=e=0);b>f?(b-=f,d+=b*b):b<e&&(b=e-b,d+=b*b);return Math.sqrt(d)};x.prototype.intersectPlane=function(a){k.defined("plane",a);return this._orientedBoundingBox.intersectPlane(a)};x.prototype.createDebugVolume=function(a){k.defined("color",a);var b=new d.clone(d.IDENTITY),c=new u({rectangle:this.rectangle,height:this.minimumHeight,extrudedHeight:this.maximumHeight});a=new h({geometry:c,id:"outline",modelMatrix:b,attributes:{color:g.fromColor(a)}});return new A({geometryInstances:a,appearance:new y({translucent:!1,flat:!0}),asynchronous:!1})};return x});F("Scene/TileBoundingSphere","../Core/BoundingSphere ../Core/Cartesian3 ../Core/Check ../Core/ColorGeometryInstanceAttribute ../Core/defineProperties ../Core/GeometryInstance ../Core/Matrix4 ../Core/SphereOutlineGeometry ./PerInstanceColorAppearance ./Primitive".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a,d){this._boundingSphere=new b(a,d)}g(d.prototype,{center:{get:function(){return this._boundingSphere.center}},radius:{get:function(){return this._boundingSphere.radius}},boundingVolume:{get:function(){return this._boundingSphere}},boundingSphere:{get:function(){return this._boundingSphere}}});d.prototype.distanceToCamera=function(b){f.defined("frameState",b);var d=this._boundingSphere;return Math.max(0,a.distance(d.center,b.camera.positionWC)-d.radius)};d.prototype.intersectPlane=function(a){f.defined("plane",a);return b.intersectPlane(this._boundingSphere,a)};d.prototype.update=function(b,d){a.clone(b,this._boundingSphere.center);this._boundingSphere.radius=d};d.prototype.createDebugVolume=function(a){f.defined("color",a);var b=new e({radius:this.radius}),d=m.fromTranslation(this.center,new m.clone(m.IDENTITY));a=new l({geometry:b,id:"outline",modelMatrix:d,attributes:{color:k.fromColor(a)}});return new p({geometryInstances:a,appearance:new h({translucent:!1,flat:!0}),asynchronous:!1})};return d});F("Scene/TileOrientedBoundingBox","../Core/BoundingSphere ../Core/BoxOutlineGeometry ../Core/Cartesian3 ../Core/Check ../Core/ColorGeometryInstanceAttribute ../Core/defineProperties ../Core/GeometryInstance ../Core/Matrix3 ../Core/Matrix4 ../Core/OrientedBoundingBox ./PerInstanceColorAppearance ./Primitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(a,c){this._orientedBoundingBox=new p(a,c);this._boundingSphere=b.fromOrientedBoundingBox(this._orientedBoundingBox)}l(t.prototype,{boundingVolume:{get:function(){return this._orientedBoundingBox}},boundingSphere:{get:function(){return this._boundingSphere}}});t.prototype.distanceToCamera=function(a){k.defined("frameState",a);return Math.sqrt(this._orientedBoundingBox.distanceSquaredTo(a.camera.positionWC))};t.prototype.intersectPlane=function(a){k.defined("plane",a);return this._orientedBoundingBox.intersectPlane(a)};t.prototype.update=function(a,c){f.clone(a,this._orientedBoundingBox.center);e.clone(c,this._orientedBoundingBox.halfAxes);b.fromOrientedBoundingBox(this._orientedBoundingBox,this._boundingSphere)};t.prototype.createDebugVolume=function(b){k.defined("color",b);var c=new a({minimum:new f(-1,-1,-1),maximum:new f(1,1,1)}),e=h.fromRotationTranslation(this.boundingVolume.halfAxes,this.boundingVolume.center);b=new m({geometry:c,id:"outline",modelMatrix:e,attributes:{color:g.fromColor(b)}});return new q({geometryInstances:b,appearance:new d({translucent:!1,flat:!0}),asynchronous:!1})};return t});F("Scene/Cesium3DTile","../Core/BoundingSphere ../Core/Cartesian3 ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/CullingVolume ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/Ellipsoid ../Core/getMagic ../Core/Intersect ../Core/JulianDate ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/OrientedBoundingBox ../Core/OrthographicFrustum ../Core/Rectangle ../Core/Request ../Core/RequestScheduler ../Core/RequestState ../Core/RequestType ../Core/Resource ../Core/RuntimeError ../Core/Transforms ../ThirdParty/when ./Cesium3DTileContentFactory ./Cesium3DTileContentState ./Cesium3DTileOptimizationHint ./Cesium3DTilePass ./Cesium3DTileRefine ./Empty3DTileContent ./SceneMode ./TileBoundingRegion ./TileBoundingSphere ./TileOrientedBoundingBox".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,F,N,O,Z,aa,U){function P(a,b,c,d){this._tileset=a;this._header=c;var e=c.content;this.transform=m(c.transform)?y.unpack(c.transform):y.clone(y.IDENTITY);var g=m(d)?d.computedTransform:a.modelMatrix,g=y.multiply(g,this.transform,new y),h=m(d)?d._initialTransform:y.IDENTITY;this._initialTransform=y.multiply(h,this.transform,new y);this.computedTransform=g;this._boundingVolume=this.createBoundingVolume(c.boundingVolume,g);this._boundingVolume2D=void 0;var k;m(e)&&m(e.boundingVolume)&&(k=this.createBoundingVolume(e.boundingVolume,g));this._contentBoundingVolume=k;this._contentBoundingVolume2D=void 0;var l;m(c.viewerRequestVolume)&&(l=this.createBoundingVolume(c.viewerRequestVolume,g));this._viewerRequestVolume=l;this.geometricError=c.geometricError;m(this.geometricError)||(this.geometricError=m(d)?d.geometricError:a._geometricError,P._deprecationWarning("geometricErrorUndefined","Required property geometricError is undefined for this tile. Using parent's geometric error instead."));m(c.refine)?("replace"!==c.refine&&"add"!==c.refine||P._deprecationWarning("lowercase-refine",'This tile uses a lowercase refine "'+c.refine+'". Instead use "'+c.refine.toUpperCase()+'".'),k="REPLACE"===c.refine.toUpperCase()?F.REPLACE:F.ADD):k=m(d)?d.refine:F.REPLACE;this.refine=k;this.children=[];this.parent=d;var p,q,t;b=I.createIfNeeded(b);m(e)?(q=e.uri,m(e.url)&&(P._deprecationWarning("contentUrl",'This tileset JSON uses the "content.url" property which has been deprecated. Use "content.uri" instead.'),q=e.url),e=!1,a=E.UNLOADED,q=b.getDerivedResource({url:q}),t=v.getServerKey(q.getUrlComponent())):(p=new N(a,this),e=!0,a=E.READY);this._content=p;this._contentResource=q;this._contentState=a;this._expiredContent=this._contentReadyPromise=this._contentReadyToProcessPromise=void 0;this._serverKey=t;this.hasEmptyContent=e;this.hasTilesetContent=!1;this.cacheNode=void 0;b=c.expire;var w,u;m(b)&&(w=b.duration,m(b.date)&&(u=r.fromIso8601(b.date)));this.expireDuration=w;this.expireDate=u;this.lastStyleTime=0;this._optimChildrenWithinParent=L.NOT_COMPUTED;this.priorityDeferred=this.clippingPlanesDirty=!1;this._visibilityPlaneMask=this._screenSpaceErrorProgressiveResolution=this._screenSpaceError=this._centerZDepth=this._distanceToCamera=0;this._inRequestVolume=this._visible=!1;this._finalResolution=!0;this._requestedFrame=this._selectedFrame=this._visitedFrame=this._touchedFrame=this._updatedVisibilityFrame=this._selectionDepth=this._stackLength=this._depth=0;this._ancestorWithContentAvailable=this._ancestorWithContent=void 0;this._shouldSelect=this._refines=!1;this._isClipped=!0;this._clippingPlanesState=0;this._debugViewerRequestVolume=this._debugContentBoundingVolume=this._debugBoundingVolume=void 0;this._debugColor=f.fromRandom({alpha:1});this._debugColorizeTiles=!1;this._priority=0;this._priorityHolder=this;this._priorityProgressiveResolutionScreenSpaceErrorLeaf=this._priorityProgressiveResolution=!1;this._foveatedFactor=this._priorityReverseScreenSpaceError=0;this._wasMinPriorityChild=!1;this._loadTimestamp=new r;this._commandsLength=0;this._color=void 0;this._colorDirty=!1;this._request=void 0}function M(a){return function(b){a._contentState=E.FAILED;a._contentReadyPromise.reject(b);a._contentReadyToProcessPromise.reject(b)}}function R(a){return function(){return a._priority}}function Y(a,c){if(c.mode!==O.SCENE3D&&!m(a._boundingVolume2D)){var d=b.projectTo2D(a._boundingVolume.boundingSphere,c.mapProjection,T);a._boundingVolume2D=new aa(d.center,d.radius)}return c.mode!==O.SCENE3D?a._boundingVolume2D:a._boundingVolume}function Q(a,b,d){return Math.max(c.normalize(a,b,d)-c.EPSILON7,0)}P._deprecationWarning=h;e(P.prototype,{tileset:{get:function(){return this._tileset}},content:{get:function(){return this._content}},boundingVolume:{get:function(){return this._boundingVolume}},contentBoundingVolume:{get:function(){return l(this._contentBoundingVolume,this._boundingVolume)}},boundingSphere:{get:function(){return this._boundingVolume.boundingSphere}},extras:{get:function(){return this._header.extras}},color:{get:function(){m(this._color)||(this._color=new f);return f.clone(this._color)},set:function(a){this._color=f.clone(a,this._color);this._colorDirty=!0}},contentAvailable:{get:function(){return this.contentReady&&!this.hasEmptyContent&&!this.hasTilesetContent||m(this._expiredContent)&&!this.contentFailed}},contentReady:{get:function(){return this._contentState===E.READY}},contentUnloaded:{get:function(){return this._contentState===E.UNLOADED}},contentExpired:{get:function(){return this._contentState===E.EXPIRED}},contentFailed:{get:function(){return this._contentState===E.FAILED}},contentReadyToProcessPromise:{get:function(){if(m(this._contentReadyToProcessPromise))return this._contentReadyToProcessPromise.promise}},contentReadyPromise:{get:function(){if(m(this._contentReadyPromise))return this._contentReadyPromise.promise}},commandsLength:{get:function(){return this._commandsLength}}});var S=new a,ca=new r;P.prototype.getScreenSpaceError=function(a,b,d){var e=this._tileset;d=l(d,1);var f=m(this.parent)?this.parent.geometricError:e._geometricError;b=b?f:this.geometricError;if(0===b)return 0;var f=a.camera,g=f.frustum,h=a.context,k=h.drawingBufferWidth;d*=h.drawingBufferHeight;a.mode===O.SCENE2D||g instanceof z?(m(g._offCenterFrustum)&&(g=g._offCenterFrustum),d=b/(Math.max(g.top-g.bottom,g.right-g.left)/Math.max(k,d))):(a=Math.max(this._distanceToCamera,c.EPSILON7),d=b*d/(a*f.frustum.sseDenominator),e.dynamicScreenSpaceError&&(b=e.dynamicScreenSpaceErrorFactor,e=c.fog(a,e._dynamicScreenSpaceErrorComputedDensity)*b,d-=e));return d};P.prototype.updateVisibility=function(b){var d=this.parent,e=this._tileset,f=m(d)?d.computedTransform:e.modelMatrix,d=m(d)?d._visibilityPlaneMask:g.MASK_INDETERMINATE;this.updateTransform(f);this._distanceToCamera=this.distanceToTile(b);this._centerZDepth=this.distanceToTileCenter(b);this._screenSpaceError=this.getScreenSpaceError(b,!1);this._screenSpaceErrorProgressiveResolution=this.getScreenSpaceError(b,!1,e.progressiveResolutionHeightFraction);this._visibilityPlaneMask=this.visibility(b,d);this._visible=this._visibilityPlaneMask!==g.MASK_OUTSIDE;this._inRequestVolume=this.insideViewerRequestVolume(b);f=this.parent;f=!m(f)||e._skipLevelOfDetail&&0!==this._screenSpaceError&&!f.hasTilesetContent?this._screenSpaceError:f._screenSpaceError;this._priorityReverseScreenSpaceError=e.root._screenSpaceError-f;if(0>=e.progressiveResolutionHeightFraction||.5<e.progressiveResolutionHeightFraction)e=!1;else{f=this._screenSpaceErrorProgressiveResolution>e._maximumScreenSpaceError;this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!1;var d=this.parent,h=e._maximumScreenSpaceError,e=this._screenSpaceErrorProgressiveResolution<=h,d=m(d)&&d._screenSpaceErrorProgressiveResolution>h;e&&d&&(f=this._priorityProgressiveResolutionScreenSpaceErrorLeaf=!0);e=f}this._priorityProgressiveResolution=e;e=this._tileset;b=b.camera;f=this.boundingSphere;d=f.radius;h=a.multiplyByScalar(b.directionWC,this._centerZDepth,S);h=a.add(b.positionWC,h,S);h=a.subtract(h,f.center,S);a.magnitude(h)>d?(h=a.normalize(h,S),d=a.multiplyByScalar(h,d,S),f=a.add(f.center,d,S),f=a.subtract(f,b.positionWC,S),f=a.normalize(f,S),this._foveatedFactor=1-Math.abs(a.dot(b.directionWC,f))):this._foveatedFactor=0;f=this.refine===F.REPLACE;d=e._skipLevelOfDetail;f&&!d||!e.foveatedScreenSpaceError||1===e.foveatedConeSize||this._priorityProgressiveResolution&&f&&d||e._pass===K.PRELOAD_FLIGHT||e._pass===K.PRELOAD?e=!1:(b=1-Math.cos(.5*b.frustum.fov),f=e.foveatedConeSize*b,this._foveatedFactor<=f?e=!1:(b=c.clamp((this._foveatedFactor-f)/(b-f),0,1),b=e.foveatedInterpolationCallback(e.foveatedMinimumScreenSpaceErrorRelaxation,e.maximumScreenSpaceError,b),f=0===this._screenSpaceError&&m(this.parent)?.5*this.parent._screenSpaceError:this._screenSpaceError,e=e.maximumScreenSpaceError-b<=f));this.priorityDeferred=e};P.prototype.updateExpiration=function(){if(m(this.expireDate)&&this.contentReady&&!this.hasEmptyContent){var a=r.now(ca);r.lessThan(this.expireDate,a)&&(this._contentState=E.EXPIRED,this._expiredContent=this._content)}};P.prototype.requestContent=function(){var a=this,b=this._tileset;if(this.hasEmptyContent)return!1;var c=this._contentResource.clone(),d=this.contentExpired;d&&c.setQueryParameters({expired:this.expireDate.toString()});var e=new D({throttle:!0,throttleByServer:!0,type:C.TILES3D,priorityFunction:R(this),serverKey:this._serverKey});this._request=e;c.request=e;c=c.fetchArrayBuffer();if(!m(c))return!1;var f=this._contentState;this._contentState=E.LOADING;this._contentReadyToProcessPromise=w.defer();this._contentReadyPromise=w.defer();d&&(this.expireDate=void 0);var g=M(this);c.then(function(c){if(a.isDestroyed())g();else{var d=new Uint8Array(c),d=q(d),e=G[d];b._disableSkipLevelOfDetail=b._disableSkipLevelOfDetail||"vctr"===d||"geom"===d;m(e)?c=e(b,a,a._contentResource,c,0):(c=G.json(b,a,a._contentResource,c,0),a.hasTilesetContent=!0);a._content=c;a._contentState=E.PROCESSING;a._contentReadyToProcessPromise.resolve(c);return c.readyPromise.then(function(b){if(a.isDestroyed())g();else{if(m(a.expireDuration)){var c=r.now(ca);r.addSeconds(c,a.expireDuration,c);m(a.expireDate)?r.lessThan(a.expireDate,c)&&r.clone(c,a.expireDate):a.expireDate=r.clone(c)}a._selectedFrame=0;a.lastStyleTime=0;r.now(a._loadTimestamp);a._contentState=E.READY;a._contentReadyPromise.resolve(b)}})}}).otherwise(function(c){e.state===B.CANCELLED?(a._contentState=f,--b.statistics.numberOfPendingRequests,++b.statistics.numberOfAttemptedRequests):g(c)});return!0};P.prototype.unloadContent=function(){this.hasEmptyContent||this.hasTilesetContent||(this._content=this._content&&this._content.destroy(),this._contentState=E.UNLOADED,this._contentReadyPromise=this._contentReadyToProcessPromise=void 0,this.lastStyleTime=0,this.clippingPlanesDirty=0===this._clippingPlanesState,this._clippingPlanesState=0,this._debugColorizeTiles=!1,this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy(),this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy(),this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy())};var T=new b;P.prototype.visibility=function(a,b){var c=a.cullingVolume,d=Y(this,a),e=this._tileset,f=e.clippingPlanes;return m(f)&&f.enabled&&(e=f.computeIntersectionWithBoundingVolume(d,e.clippingPlanesOriginMatrix),this._isClipped=e!==t.INSIDE,e===t.OUTSIDE)?g.MASK_OUTSIDE:c.computeVisibilityWithPlaneMask(d,b)};P.prototype.contentVisibility=function(a){if(!m(this._contentBoundingVolume)||this._visibilityPlaneMask===g.MASK_INSIDE)return t.INSIDE;var c=a.cullingVolume;if(a.mode!==O.SCENE3D&&!m(this._contentBoundingVolume2D)){var d=b.projectTo2D(this._contentBoundingVolume.boundingSphere,a.mapProjection,T);this._contentBoundingVolume2D=new aa(d.center,d.radius)}a=a.mode!==O.SCENE3D?this._contentBoundingVolume2D:this._contentBoundingVolume;var d=this._tileset,e=d.clippingPlanes;return m(e)&&e.enabled&&(d=e.computeIntersectionWithBoundingVolume(a,d.clippingPlanesOriginMatrix),this._isClipped=d!==t.INSIDE,d===t.OUTSIDE)?t.OUTSIDE:c.computeVisibility(a)};P.prototype.distanceToTile=function(a){return Y(this,a).distanceToCamera(a)};var da=new a;P.prototype.distanceToTileCenter=function(b){var c=Y(this,b).boundingVolume,c=a.subtract(c.center,b.camera.positionWC,da);return a.dot(b.camera.directionWC,c)};P.prototype.insideViewerRequestVolume=function(a){var b=this._viewerRequestVolume;return!m(b)||0===b.distanceToCamera(a)};var V=new u,ba=new a,X=new u,fa=new a,ga=new x,ka=new A,na=new y;P.prototype.createBoundingVolume=function(b,e,f){if(!m(b))throw new H("boundingVolume must be defined");if(m(b.box)){var g=b.box;b=a.fromElements(g[0],g[1],g[2],fa);g=u.fromArray(g,3,X);b=y.multiplyByPoint(e,b,b);e=y.getRotation(e,V);g=u.multiply(e,g,g);m(f)?f.update(b,g):f=new U(b,g);return f}if(m(b.region)){g=b.region;b=this._initialTransform;if(y.equalsEpsilon(e,b,c.EPSILON8))m(f)||(f=x.unpack(g,0,ga),f=new Z({rectangle:f,minimumHeight:g[4],maximumHeight:g[5]}));else{var h=x.unpack(g,0,ga),h=A.fromRectangle(h,g[4],g[5],d.WGS84,ka),g=h.center,h=h.halfAxes;e=y.multiplyTransformation(e,y.inverseTransformation(b,na),na);g=y.multiplyByPoint(e,g,g);e=y.getRotation(e,V);h=u.multiply(e,h,h);m(f)&&f instanceof U?f.update(g,h):f=new U(g,h)}return f}if(m(b.sphere))return g=b.sphere,b=a.fromElements(g[0],g[1],g[2],fa),g=g[3],b=y.multiplyByPoint(e,b,b),e=y.getScale(e,ba),e=a.maximumComponent(e),g*=e,m(f)?f.update(b,g):f=new aa(b,g),f;throw new H("boundingVolume must contain a sphere, region, or box");};P.prototype.updateTransform=function(a){a=l(a,y.IDENTITY);a=y.multiply(a,this.transform,na);if(!y.equals(a,this.computedTransform)){y.clone(a,this.computedTransform);a=this._header;var b=this._header.content;this._boundingVolume=this.createBoundingVolume(a.boundingVolume,this.computedTransform,this._boundingVolume);m(this._contentBoundingVolume)&&(this._contentBoundingVolume=this.createBoundingVolume(b.boundingVolume,this.computedTransform,this._contentBoundingVolume));m(this._viewerRequestVolume)&&(this._viewerRequestVolume=this.createBoundingVolume(a.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume));this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy();this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy();this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy()}};P.prototype.update=function(a,b){var c=b.commandList.length,d=a.clippingPlanes,e=0;m(d)&&this._isClipped&&d.enabled&&(e=d.clippingPlanesState);e!==this._clippingPlanesState&&(this._clippingPlanesState=e,this.clippingPlanesDirty=!0);if(b.passes.render){var d=m(this._header.content)&&m(this._header.content.boundingVolume),e=this.hasEmptyContent||this.hasTilesetContent,g=a.debugShowBoundingVolume||a.debugShowContentBoundingVolume&&!d;g?(e=this._finalResolution?e?f.DARKGRAY:f.WHITE:f.YELLOW,m(this._debugBoundingVolume)||(this._debugBoundingVolume=this._boundingVolume.createDebugVolume(e)),this._debugBoundingVolume.update(b),g=this._debugBoundingVolume.getGeometryInstanceAttributes("outline"),g.color=k.toValue(e,g.color)):!g&&m(this._debugBoundingVolume)&&(this._debugBoundingVolume=this._debugBoundingVolume.destroy());a.debugShowContentBoundingVolume&&d?(m(this._debugContentBoundingVolume)||(this._debugContentBoundingVolume=this._contentBoundingVolume.createDebugVolume(f.BLUE)),this._debugContentBoundingVolume.update(b)):!a.debugShowContentBoundingVolume&&m(this._debugContentBoundingVolume)&&(this._debugContentBoundingVolume=this._debugContentBoundingVolume.destroy());a.debugShowViewerRequestVolume&&m(this._viewerRequestVolume)?(m(this._debugViewerRequestVolume)||(this._debugViewerRequestVolume=this._viewerRequestVolume.createDebugVolume(f.YELLOW)),this._debugViewerRequestVolume.update(b)):!a.debugShowViewerRequestVolume&&m(this._debugViewerRequestVolume)&&(this._debugViewerRequestVolume=this._debugViewerRequestVolume.destroy());d=a.debugColorizeTiles&&!this._debugColorizeTiles||m(a._heatmap.tilePropertyName);e=!a.debugColorizeTiles&&this._debugColorizeTiles;d?(a._heatmap.colorize(this,b),this._debugColorizeTiles=!0,this.color=this._debugColor):e&&(this._debugColorizeTiles=!1,this.color=f.WHITE);this._colorDirty&&(this._colorDirty=!1,this._content.applyDebugSettings(!0,this._color));e&&a.makeStyleDirty()}a:{d=this._content;e=this._expiredContent;if(m(e)){if(!this.contentReady){e.update(a,b);break a}this._expiredContent.destroy();this._expiredContent=void 0}d.update(a,b)}this._commandsLength=b.commandList.length-c;this.clippingPlanesDirty=!1};var ia=[];P.prototype.process=function(a,b){var c=b.commandList;b.commandList=ia;this._content.update(a,b);ia.length=0;b.commandList=c};P.prototype.updatePriority=function(){var a=this.tileset,b=a.preferLeaves,c=a._minimumPriority,d=a._maximumPriority,e=Math.pow(10,8),f=Math.pow(10,9),g=Math.pow(10,10),h=Q(this._depth,c.depth,d.depth),h=b?1-h:h,b=a._skipLevelOfDetail||this.refine!==F.REPLACE?Q(this._priorityReverseScreenSpaceError,c.reverseScreenSpaceError,d.reverseScreenSpaceError):Q(this._priorityHolder._distanceToCamera,c.distance,d.distance),b=parseInt(b*Math.pow(10,4))*Math.pow(10,0),e=this._priorityProgressiveResolution?0:e,c=Q(this._priorityHolder._foveatedFactor,c.foveatedFactor,d.foveatedFactor),c=parseInt(c*Math.pow(10,4))*Math.pow(10,4);this._priority=h+b+e+c+(this.priorityDeferred?f:0)+(a._pass===K.PRELOAD_FLIGHT?0:g)};P.prototype.isDestroyed=function(){return!1};P.prototype.destroy=function(){this._content=this._content&&this._content.destroy();this._expiredContent=this._expiredContent&&!this._expiredContent.isDestroyed()&&this._expiredContent.destroy();this._debugBoundingVolume=this._debugBoundingVolume&&this._debugBoundingVolume.destroy();this._debugContentBoundingVolume=this._debugContentBoundingVolume&&this._debugContentBoundingVolume.destroy();this._debugViewerRequestVolume=this._debugViewerRequestVolume&&this._debugViewerRequestVolume.destroy();return p(this)};return P});F("Scene/Cesium3DTileContent",["../Core/defineProperties","../Core/DeveloperError"],function(b,a){function f(a,b,f,m,e){this.featurePropertiesDirty=!1}b(f.prototype,{featuresLength:{get:function(){a.throwInstantiationError()}},pointsLength:{get:function(){a.throwInstantiationError()}},trianglesLength:{get:function(){a.throwInstantiationError()}},geometryByteLength:{get:function(){a.throwInstantiationError()}},texturesByteLength:{get:function(){a.throwInstantiationError()}},batchTableByteLength:{get:function(){a.throwInstantiationError()}},innerContents:{get:function(){a.throwInstantiationError()}},readyPromise:{get:function(){a.throwInstantiationError()}},tileset:{get:function(){a.throwInstantiationError()}},tile:{get:function(){a.throwInstantiationError()}},url:{get:function(){a.throwInstantiationError()}},batchTable:{get:function(){a.throwInstantiationError()}}});f.prototype.hasProperty=function(b,f){a.throwInstantiationError()};f.prototype.getFeature=function(b){a.throwInstantiationError()};f.prototype.applyDebugSettings=function(b,f){a.throwInstantiationError()};f.prototype.applyStyle=function(b){a.throwInstantiationError()};f.prototype.update=function(b,f){a.throwInstantiationError()};f.prototype.isDestroyed=function(){a.throwInstantiationError()};f.prototype.destroy=function(){a.throwInstantiationError()};return f});F("Scene/Cesium3DTileOptimizations",["../Core/Cartesian3","../Core/Check","./Cesium3DTileOptimizationHint","./TileBoundingRegion","./TileOrientedBoundingBox"],function(b,a,f,k,g){var l={},m=new b;l.checkChildrenWithinParent=function(e){a.typeOf.object("tile",e);var h=e.children,l=h.length,d=e.boundingVolume;if(d instanceof g||d instanceof k){d=d._orientedBoundingBox;e._optimChildrenWithinParent=f.USE_OPTIMIZATION;for(var q=0;q<l;++q){var t=h[q].boundingVolume;if(!(t instanceof g||t instanceof k)){e._optimChildrenWithinParent=f.SKIP_OPTIMIZATION;break}var t=t._orientedBoundingBox,r=b.subtract(t.center,d.center,m),c=b.magnitude(r);b.divideByScalar(r,c,r);if(Math.abs(d.halfAxes[0]*r.x)+Math.abs(d.halfAxes[1]*r.y)+Math.abs(d.halfAxes[2]*r.z)+Math.abs(d.halfAxes[3]*r.x)+Math.abs(d.halfAxes[4]*r.y)+Math.abs(d.halfAxes[5]*r.z)+Math.abs(d.halfAxes[6]*r.x)+Math.abs(d.halfAxes[7]*r.y)+Math.abs(d.halfAxes[8]*r.z)<=Math.abs(t.halfAxes[0]*r.x)+Math.abs(t.halfAxes[1]*r.y)+Math.abs(t.halfAxes[2]*r.z)+Math.abs(t.halfAxes[3]*r.x)+Math.abs(t.halfAxes[4]*r.y)+Math.abs(t.halfAxes[5]*r.z)+Math.abs(t.halfAxes[6]*r.x)+Math.abs(t.halfAxes[7]*r.y)+Math.abs(t.halfAxes[8]*r.z)+c){e._optimChildrenWithinParent=f.SKIP_OPTIMIZATION;break}}}return e._optimChildrenWithinParent===f.USE_OPTIMIZATION};return l});F("Scene/Cesium3DTilePassState",["../Core/Check"],function(b){return function(a){b.typeOf.object("options",a);b.typeOf.number("options.pass",a.pass);this.pass=a.pass;this.commandList=a.commandList;this.camera=a.camera;this.cullingVolume=a.cullingVolume;this.ready=!1}});F("Scene/Cesium3DTilesetCache",["../Core/defined","../Core/DoublyLinkedList"],function(b,a){function f(){this._list=new a;this._sentinel=this._list.add();this._trimTiles=!1}f.prototype.reset=function(){this._list.splice(this._list.tail,this._sentinel)};f.prototype.touch=function(a){a=a.cacheNode;b(a)&&this._list.splice(this._sentinel,a)};f.prototype.add=function(a){b(a.cacheNode)||(a.cacheNode=this._list.add(a))};f.prototype.unloadTile=function(a,f,l){var g=f.cacheNode;b(g)&&(this._list.remove(g),f.cacheNode=void 0,l(a,f))};f.prototype.unloadTiles=function(a,b){var f=this._trimTiles;this._trimTiles=!1;for(var g=1048576*a.maximumMemoryUsage,e=this._sentinel,h=this._list.head;h!==e&&(a.totalMemoryUsageInBytes>g||f);){var k=h.item,h=h.next;this.unloadTile(a,k,b)}};f.prototype.trim=function(){this._trimTiles=!0};return f});F("Scene/Cesium3DTilesetHeatmap","../Core/Color ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/JulianDate ../Core/Math".split(" "),function(b,a,f,k,g,l){function m(a){this.tilePropertyName=a;this._minimum=Number.MAX_VALUE;this._maximum=-Number.MAX_VALUE;this._previousMinimum=Number.MAX_VALUE;this._previousMaximum=-Number.MAX_VALUE;this._referenceMinimum={};this._referenceMaximum={}}function e(a,b){return"_loadTimestamp"===b?g.toDate(a).getTime():a}m.prototype.setReferenceMinimumMaximum=function(a,b,f){this._referenceMinimum[f]=e(a,f);this._referenceMaximum[f]=e(b,f)};var h=[new b(.1,.1,.1,1),new b(.153,.278,.878,1),new b(.827,.231,.49,1),new b(.827,.188,.22,1),new b(1,.592,.259,1),new b(1,.843,0,1)];m.prototype.colorize=function(a,d){if(f(this.tilePropertyName)&&a.contentAvailable&&a._selectedFrame===d.frameNumber){var g;g=this.tilePropertyName;f(g)?(g=e(a[g],g),f(g)?(this._maximum=Math.max(g,this._maximum),this._minimum=Math.min(g,this._minimum)):this.tilePropertyName=void 0):g=void 0;var k=this._previousMinimum,m=this._previousMaximum;if(k!==Number.MAX_VALUE&&m!==-Number.MAX_VALUE){m=m-k+l.EPSILON7;m=l.clamp(g-k,0,m)/m*(h.length-1);k=Math.floor(m);g=m-k;var k=h[k],m=h[Math.ceil(m)],c=b.clone(b.WHITE);c.red=l.lerp(k.red,m.red,g);c.green=l.lerp(k.green,m.green,g);c.blue=l.lerp(k.blue,m.blue,g);a._debugColor=c}}};m.prototype.resetMinimumMaximum=function(){var a=this.tilePropertyName;if(f(a)){var b=this._referenceMinimum[a],a=this._referenceMaximum[a],e=f(b)&&f(a);this._previousMinimum=e?b:this._minimum;this._previousMaximum=e?a:this._maximum;this._minimum=Number.MAX_VALUE;this._maximum=-Number.MAX_VALUE}};return m});F("Scene/Cesium3DTilesetStatistics",["../Core/defined"],function(b){function a(){this.batchTableByteLength=this.texturesByteLength=this.geometryByteLength=this.numberOfTilesCulledWithChildrenUnion=this.numberOfFeaturesStyled=this.numberOfTilesStyled=this.numberOfTrianglesSelected=this.numberOfPointsLoaded=this.numberOfPointsSelected=this.numberOfFeaturesLoaded=this.numberOfFeaturesSelected=this.numberOfLoadedTilesTotal=this.numberOfTilesTotal=this.numberOfTilesWithContentReady=this.numberOfTilesProcessing=this.numberOfPendingRequests=this.numberOfAttemptedRequests=this.numberOfCommands=this.visited=this.selected=0}function f(a,g,l,m){var e=g.innerContents,h=g.pointsLength,k=g.trianglesLength,d=g.featuresLength,q=g.geometryByteLength,t=g.texturesByteLength;g=g.batchTableByteLength;m?(a.numberOfFeaturesLoaded+=l?-d:d,a.numberOfPointsLoaded+=l?-h:h,a.geometryByteLength+=l?-q:q,a.texturesByteLength+=l?-t:t,a.batchTableByteLength+=l?-g:g):(a.numberOfFeaturesSelected+=l?-d:d,a.numberOfPointsSelected+=l?-h:h,a.numberOfTrianglesSelected+=l?-k:k);if(b(e))for(h=e.length,k=0;k<h;++k)f(a,e[k],l,m)}a.prototype.clear=function(){this.numberOfTilesCulledWithChildrenUnion=this.numberOfFeaturesStyled=this.numberOfTilesStyled=this.numberOfTrianglesSelected=this.numberOfPointsSelected=this.numberOfFeaturesSelected=this.numberOfAttemptedRequests=this.numberOfCommands=this.visited=this.selected=0};a.prototype.incrementSelectionCounts=function(a){f(this,a,!1,!1)};a.prototype.incrementLoadCounts=function(a){f(this,a,!1,!0)};a.prototype.decrementLoadCounts=function(a){f(this,a,!0,!0)};a.clone=function(a,b){b.selected=a.selected;b.visited=a.visited;b.numberOfCommands=a.numberOfCommands;b.selected=a.selected;b.numberOfAttemptedRequests=a.numberOfAttemptedRequests;b.numberOfPendingRequests=a.numberOfPendingRequests;b.numberOfTilesProcessing=a.numberOfTilesProcessing;b.numberOfTilesWithContentReady=a.numberOfTilesWithContentReady;b.numberOfTilesTotal=a.numberOfTilesTotal;b.numberOfFeaturesSelected=a.numberOfFeaturesSelected;b.numberOfFeaturesLoaded=a.numberOfFeaturesLoaded;b.numberOfPointsSelected=a.numberOfPointsSelected;b.numberOfPointsLoaded=a.numberOfPointsLoaded;b.numberOfTrianglesSelected=a.numberOfTrianglesSelected;b.numberOfTilesStyled=a.numberOfTilesStyled;b.numberOfFeaturesStyled=a.numberOfFeaturesStyled;b.numberOfTilesCulledWithChildrenUnion=a.numberOfTilesCulledWithChildrenUnion;b.geometryByteLength=a.geometryByteLength;b.texturesByteLength=a.texturesByteLength;b.batchTableByteLength=a.batchTableByteLength};return a});F("Scene/Cesium3DTileStyleEngine",["../Core/defined","../Core/defineProperties"],function(b,a){function f(){this._style=void 0;this._styleDirty=!1;this._lastStyleTime=0}a(f.prototype,{style:{get:function(){return this._style},set:function(a){this._style=a;this._styleDirty=!0}}});f.prototype.makeDirty=function(){this._styleDirty=!0};f.prototype.applyStyle=function(a,f){if(a.ready&&(!b(this._style)||this._style.ready)){var g=this._styleDirty;f.passes.render&&(this._styleDirty=!1);g&&++this._lastStyleTime;for(var k=this._lastStyleTime,e=a._statistics,g=g?a._selectedTiles:a._selectedTilesToStyle,h=g.length,p=0;p<h;++p){var d=g[p];if(d.lastStyleTime!==k){var q=d.content;d.lastStyleTime=k;q.applyStyle(this._style);e.numberOfFeaturesStyled+=q.featuresLength;++e.numberOfTilesStyled}}}};return f});F("Scene/Cesium3DTileset","../Core/ApproximateTerrainHeights ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/DeveloperError ../Core/DoublyLinkedList ../Core/Ellipsoid ../Core/Event ../Core/JulianDate ../Core/ManagedArray ../Core/Math ../Core/Matrix4 ../Core/Resource ../Core/RuntimeError ../Core/Transforms ../Renderer/ClearCommand ../Renderer/Pass ../Renderer/RenderState ../ThirdParty/when ./Axis ./Cesium3DTile ./Cesium3DTileColorBlendMode ./Cesium3DTileContentState ./Cesium3DTileOptimizations ./Cesium3DTilePass ./Cesium3DTilePassState ./Cesium3DTileRefine ./Cesium3DTilesetCache ./Cesium3DTilesetHeatmap ./Cesium3DTilesetMostDetailedTraversal ./Cesium3DTilesetStatistics ./Cesium3DTilesetTraversal ./Cesium3DTileStyleEngine ./ClippingPlaneCollection ./LabelCollection ./PointCloudEyeDomeLighting ./PointCloudShading ./SceneMode ./ShadowMode ./StencilConstants ./TileBoundingRegion ./TileBoundingSphere ./TileOrientedBoundingBox".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,F,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X){function P(d){d=m(d,m.EMPTY_OBJECT);g.defined("options.url",d.url);this._gltfUpAxis=this._extensionsUsed=this._geometricError=this._properties=this._asset=this._root=this._basePath=this._url=void 0;this._cache=new O;this._processingQueue=[];this._selectedTiles=[];this._emptyTiles=[];this._requestedTiles=[];this._selectedTilesToStyle=[];this._loadTimestamp=void 0;this._updatedVisibilityFrame=this._timeSinceLoad=0;this._credits=this._extras=void 0;this._cullWithChildrenBounds=m(d.cullWithChildrenBounds,!0);this._allTilesAdditive=!0;this._hasMixedContent=!1;this._stencilClearCommand=void 0;this._backfaceCommands=new y;this._maximumScreenSpaceError=m(d.maximumScreenSpaceError,16);this._maximumMemoryUsage=m(d.maximumMemoryUsage,512);this._styleEngine=new M;this._modelMatrix=e(d.modelMatrix)?z.clone(d.modelMatrix):z.clone(z.IDENTITY);this._statistics=new U;this._statisticsLast=new U;this._statisticsPerPass=Array(K.NUMBER_OF_PASSES);for(var f=0;f<K.NUMBER_OF_PASSES;++f)this._statisticsPerPass[f]=new U;this._requestedTilesInFlight=[];this._maximumPriority={foveatedFactor:-Number.MAX_VALUE,depth:-Number.MAX_VALUE,distance:-Number.MAX_VALUE,reverseScreenSpaceError:-Number.MAX_VALUE};this._minimumPriority={foveatedFactor:Number.MAX_VALUE,depth:Number.MAX_VALUE,distance:Number.MAX_VALUE,reverseScreenSpaceError:Number.MAX_VALUE};this._heatmap=new Z(d.debugHeatmapTilePropertyName);this.cullRequestsWhileMoving=m(d.cullRequestsWhileMoving,!0);this.cullRequestsWhileMovingMultiplier=m(d.cullRequestsWhileMovingMultiplier,60);this.progressiveResolutionHeightFraction=A.clamp(m(d.progressiveResolutionHeightFraction,.3),0,.5);this.preferLeaves=m(d.preferLeaves,!1);this._initialTilesLoaded=this._tilesLoaded=!1;this._tileDebugLabels=void 0;this._readyPromise=H.defer();this._classificationType=d.classificationType;this._ellipsoid=m(d.ellipsoid,r.WGS84);this._initialClippingPlanesOriginMatrix=z.IDENTITY;this._clippingPlanesOriginMatrix=void 0;this._clippingPlanesOriginMatrixDirty=!0;this._effectType=m(d.effectType,0);this._initAnimation=m(d.initAnimation,!1);1==this._effectType&&(this._initAnimation=!0);this._time=m(d.time,2E3);this._dataType=m(d.dataType,void 0);this.preloadWhenHidden=m(d.preloadWhenHidden,!1);this.preloadFlightDestinations=m(d.preloadFlightDestinations,!0);this._pass=void 0;this.dynamicScreenSpaceError=m(d.dynamicScreenSpaceError,!1);this.foveatedScreenSpaceError=m(d.foveatedScreenSpaceError,!0);this._foveatedConeSize=m(d.foveatedConeSize,.1);this._foveatedMinimumScreenSpaceErrorRelaxation=m(d.foveatedMinimumScreenSpaceErrorRelaxation,0);this.foveatedInterpolationCallback=m(d.foveatedInterpolationCallback,A.lerp);this.foveatedTimeDelay=m(d.foveatedTimeDelay,.2);this.dynamicScreenSpaceErrorDensity=.00278;this.dynamicScreenSpaceErrorFactor=4;this.dynamicScreenSpaceErrorHeightFalloff=.25;this._dynamicScreenSpaceErrorComputedDensity=0;this.shadows=m(d.shadows,T.ENABLED);this.show=m(d.show,!0);this.colorBlendMode=G.HIGHLIGHT;this.colorBlendAmount=.5;this.pointCloudShading=new S(d.pointCloudShading);this._pointCloudEyeDomeLighting=new Q;this.loadProgress=new c;this.allTilesLoaded=new c;this.initialTilesLoaded=new c;this.tileLoad=new c;this.tileUnload=new c;this.tileFailed=new c;this.tileVisible=new c;this._skipLevelOfDetail=this.skipLevelOfDetail=m(d.skipLevelOfDetail,!0);this._disableSkipLevelOfDetail=!1;this.baseScreenSpaceError=m(d.baseScreenSpaceError,1024);this.skipScreenSpaceErrorFactor=m(d.skipScreenSpaceErrorFactor,16);this.skipLevels=m(d.skipLevels,1);this.immediatelyLoadDesiredLevelOfDetail=m(d.immediatelyLoadDesiredLevelOfDetail,!1);this.loadSiblings=m(d.loadSiblings,!1);this._clippingPlanes=void 0;this.clippingPlanes=d.clippingPlanes;this._imageBasedLightingFactor=new a(1,1);a.clone(d.imageBasedLightingFactor,this._imageBasedLightingFactor);this.lightColor=d.lightColor;this.luminanceAtZenith=m(d.luminanceAtZenith,.5);this.sphericalHarmonicCoefficients=d.sphericalHarmonicCoefficients;this.specularEnvironmentMaps=d.specularEnvironmentMaps;this.debugFreezeFrame=m(d.debugFreezeFrame,!1);this.debugColorizeTiles=m(d.debugColorizeTiles,!1);this.debugWireframe=m(d.debugWireframe,!1);this.debugShowBoundingVolume=m(d.debugShowBoundingVolume,!1);this.debugShowContentBoundingVolume=m(d.debugShowContentBoundingVolume,!1);this.debugShowViewerRequestVolume=m(d.debugShowViewerRequestVolume,!1);this._tileDebugLabels=void 0;this.debugPickedTileLabelOnly=!1;this.debugPickPosition=this.debugPickedTile=void 0;this.debugShowGeometricError=m(d.debugShowGeometricError,!1);this.debugShowRenderingStatistics=m(d.debugShowRenderingStatistics,!1);this.debugShowMemoryUsage=m(d.debugShowMemoryUsage,!1);this.debugShowUrl=m(d.debugShowUrl,!1);var h=this,k;H(d.url).then(function(a){var b;k=x.createIfNeeded(a);h._credits=k.credits;"json"===k.extension?b=k.getBaseUri(!0):k.isDataUri&&(b="");h._url=k.url;h._basePath=b;return P.loadJson(k)}).then(function(a){h._root=h.loadTileset(k,a);var c=e(a.asset.gltfUpAxis)?J.fromName(a.asset.gltfUpAxis):J.Y,d=a.asset;h._asset=d;h._properties=a.properties;h._geometricError=a.geometricError;h._extensionsUsed=a.extensionsUsed;h._gltfUpAxis=c;h._extras=a.extras;c=d.extras;if(e(c)&&e(c.cesium)&&e(c.cesium.credits)){c=c.cesium.credits;d=h._credits;e(d)||(d=[],h._credits=d);for(var f=0;f<c.length;++f){var g=c[f];d.push(new l(g.html,g.showOnScreen))}}a=h._root.createBoundingVolume(a.root.boundingVolume,z.IDENTITY).boundingSphere.center;c=h._ellipsoid.cartesianToCartographic(a);e(c)&&c.height>b._defaultMinTerrainHeight&&(h._initialClippingPlanesOriginMatrix=v.eastNorthUpToFixedFrame(a));h._clippingPlanesOriginMatrix=z.clone(h._initialClippingPlanesOriginMatrix);h._readyPromise.resolve(h)}).otherwise(function(a){h._readyPromise.reject(a)})}function ga(a,b){return a._priority-b._priority}function ka(a,b){return function(){a._processingQueue.push(b);--a._statistics.numberOfPendingRequests;++a._statistics.numberOfTilesProcessing}}function na(a,b){return function(c){0<=a._processingQueue.indexOf(b)?--a._statistics.numberOfTilesProcessing:--a._statistics.numberOfPendingRequests;var d=b._contentResource.url;c=e(c.message)?c.message:c.toString();0<a.tileFailed.numberOfListeners?a.tileFailed.raiseEvent({url:d,message:c}):(console.log("A 3D tile failed to load: "+d),console.log("Error: "+c))}}function ia(a,b){return function(){--a._statistics.numberOfTilesProcessing;b.hasTilesetContent||(a._statistics.incrementLoadCounts(b.content),++a._statistics.numberOfTilesWithContentReady,++a._statistics.numberOfLoadedTilesTotal,a._cache.add(b));a.tileLoad.raiseEvent(b)}}function la(a){a/=1048576;return 1>a?a.toLocaleString(void 0,Ea):Math.round(a).toLocaleString()}function ha(a){a=a.boundingVolume.boundingVolume;var b=a.halfAxes,c=a.radius,d=f.clone(a.center,ra);e(b)?(d.x+=.75*(b[0]+b[3]+b[6]),d.y+=.75*(b[1]+b[4]+b[7]),d.z+=.75*(b[2]+b[5]+b[8])):e(c)&&(b=f.normalize(a.center,ra),b=f.multiplyByScalar(b,.75*c,ra),d=f.add(b,a.center,ra));return d}function pa(a,b,c){var d="",e=0;b.debugShowGeometricError&&(d+="\nGeometric error: "+a.geometricError,e++);b.debugShowRenderingStatistics&&(d+="\nCommands: "+a.commandsLength,e++,0<a.content.pointsLength&&(d+="\nPoints: "+a.content.pointsLength,e++),0<a.content.trianglesLength&&(d+="\nTriangles: "+a.content.trianglesLength,e++),d+="\nFeatures: "+a.content.featuresLength,e++);b.debugShowMemoryUsage&&(d+="\nTexture Memory: "+la(a.content.texturesByteLength),d+="\nGeometry Memory: "+la(a.content.geometryByteLength),e+=2);b.debugShowUrl&&(d+="\nUrl: "+a._header.content.uri,e++);a={text:d.substring(1),position:c,font:19-e+"px sans-serif",showBackground:!0,disableDepthTestDistance:Number.POSITIVE_INFINITY};return b._tileDebugLabels.add(a)}function oa(a,b){a.tileUnload.raiseEvent(b);a._statistics.decrementLoadCounts(b.content);--a._statistics.numberOfTilesWithContentReady;b.unloadContent()}function qa(a,b){var c=a._statistics,d=a._statisticsLast,e=c.numberOfPendingRequests,f=c.numberOfTilesProcessing,g=d.numberOfPendingRequests,h=d.numberOfTilesProcessing;U.clone(c,d);(d=e!==g||f!==h)&&b.afterRender.push(function(){a.loadProgress.raiseEvent(e,f)});a._tilesLoaded=0===c.numberOfPendingRequests&&0===c.numberOfTilesProcessing&&0===c.numberOfAttemptedRequests;d&&a._tilesLoaded&&(b.afterRender.push(function(){a.allTilesLoaded.raiseEvent()}),a._initialTilesLoaded||(a._initialTilesLoaded=!0,b.afterRender.push(function(){a.initialTilesLoaded.raiseEvent()})))}h(P.prototype,{asset:{get:function(){if(!this.ready)throw new q("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._asset}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(a){R.setOwner(a,this,"_clippingPlanes")}},properties:{get:function(){if(!this.ready)throw new q("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._properties}},ready:{get:function(){return e(this._root)}},readyPromise:{get:function(){return this._readyPromise.promise}},tilesLoaded:{get:function(){return this._tilesLoaded}},url:{get:function(){return this._url}},basePath:{get:function(){p("Cesium3DTileset.basePath","Cesium3DTileset.basePath has been deprecated. All tiles are relative to the url of the tileset JSON file that contains them. Use the url property instead.");return this._basePath}},style:{get:function(){return this._styleEngine.style},set:function(a){this._styleEngine.style=a}},maximumScreenSpaceError:{get:function(){return this._maximumScreenSpaceError},set:function(a){g.typeOf.number.greaterThanOrEquals("maximumScreenSpaceError",a,0);this._maximumScreenSpaceError=a}},maximumMemoryUsage:{get:function(){return this._maximumMemoryUsage},set:function(a){g.typeOf.number.greaterThanOrEquals("value",a,0);this._maximumMemoryUsage=a}},root:{get:function(){if(!this.ready)throw new q("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._root}},boundingSphere:{get:function(){if(!this.ready)throw new q("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");this._root.updateTransform(this._modelMatrix);return this._root.boundingSphere}},modelMatrix:{get:function(){return this._modelMatrix},set:function(a){this._modelMatrix=z.clone(a,this._modelMatrix)}},timeSinceLoad:{get:function(){return this._timeSinceLoad}},totalMemoryUsageInBytes:{get:function(){var a=this._statistics;return a.texturesByteLength+a.geometryByteLength+a.batchTableByteLength}},clippingPlanesOriginMatrix:{get:function(){if(!e(this._clippingPlanesOriginMatrix))return z.IDENTITY;this._clippingPlanesOriginMatrixDirty&&(z.multiply(this.root.computedTransform,this._initialClippingPlanesOriginMatrix,this._clippingPlanesOriginMatrix),this._clippingPlanesOriginMatrixDirty=!1);return this._clippingPlanesOriginMatrix}},styleEngine:{get:function(){return this._styleEngine}},statistics:{get:function(){return this._statistics}},classificationType:{get:function(){return this._classificationType}},ellipsoid:{get:function(){return this._ellipsoid}},foveatedConeSize:{get:function(){return this._foveatedConeSize},set:function(a){g.typeOf.number.greaterThanOrEquals("foveatedConeSize",a,0);g.typeOf.number.lessThanOrEquals("foveatedConeSize",a,1);this._foveatedConeSize=a}},foveatedMinimumScreenSpaceErrorRelaxation:{get:function(){return this._foveatedMinimumScreenSpaceErrorRelaxation},set:function(a){g.typeOf.number.greaterThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",a,0);g.typeOf.number.lessThanOrEquals("foveatedMinimumScreenSpaceErrorRelaxation",a,this.maximumScreenSpaceError);this._foveatedMinimumScreenSpaceErrorRelaxation=a}},extras:{get:function(){if(!this.ready)throw new q("The tileset is not loaded.  Use Cesium3DTileset.readyPromise or wait for Cesium3DTileset.ready to be true.");return this._extras}},effectType:{get:function(){return this._effectType}},initAnimation:{get:function(){return this._initAnimation}},time:{get:function(){return this._time}},dataType:{get:function(){return this._dataType}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(b){g.typeOf.object("imageBasedLightingFactor",b);g.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",b.x,0);g.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",b.x,1);g.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",b.y,0);g.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",b.y,1);a.clone(b,this._imageBasedLightingFactor)}}});P.loadJson=function(a){return x.createIfNeeded(a).fetchJson()};P.prototype.makeStyleDirty=function(){this._styleEngine.makeDirty()};P.prototype.loadTileset=function(a,b,c){var d=b.asset;if(!e(d))throw new D("Tileset must have an asset property.");if("0.0"!==d.version&&"1.0"!==d.version)throw new D("The tileset must be 3D Tiles version 0.0 or 1.0.");var f=this._statistics,d=d.tilesetVersion;e(d)?(this._basePath+="?v\x3d"+d,a.setQueryParameters({v:d})):delete a.queryParameters.v;b=new w(this,a,b.root,c);e(c)&&(c.children.push(b),b._depth=c._depth+1);c=[];for(c.push(b);0<c.length;){d=c.pop();++f.numberOfTilesTotal;this._allTilesAdditive=this._allTilesAdditive&&d.refine===N.ADD;var g=d._header.children;if(e(g))for(var h=g.length,k=0;k<h;++k){var l=new w(this,a,g[k],d);d.children.push(l);l._depth=d._depth+1;c.push(l)}this._cullWithChildrenBounds&&L.checkChildrenWithinParent(d)}return b};var ua=new f,ta=new k,wa=new z,za=new f,Da=new f,Ba=new f;P.prototype.postPassesUpdate=function(a){if(this.ready){for(var b=this._requestedTilesInFlight,c=0,d=b.length,e=0;e<d;++e){var f=b[e],g=1<=a.frameNumber-f._touchedFrame;f._contentState!==E.LOADING?++c:g?(f._request.cancel(),++c):0<c&&(b[e-c]=f)}b.length-=c;qa(this,a);this._cache.unloadTiles(this,oa)}};P.prototype.prePassesUpdate=function(a){if(this.ready){for(var b=this._processingQueue,c=b.length,d=0,g=0;g<c;++g){var h=b[g];h._contentState!==E.PROCESSING?++d:0<d&&(b[g-d]=h)}b.length-=d;b=this._processingQueue;c=b.length;for(d=0;d<c;++d)b[d].process(this,a);b=this._clippingPlanes;this._clippingPlanesOriginMatrixDirty=!0;e(b)&&b.enabled&&b.update(a);e(this._loadTimestamp)||(this._loadTimestamp=u.clone(a.time));this._timeSinceLoad=Math.max(1E3*u.secondsDifference(a.time,this._loadTimestamp),0);this._skipLevelOfDetail=this.skipLevelOfDetail&&!e(this._classificationType)&&!this._disableSkipLevelOfDetail&&!this._allTilesAdditive;if(this.dynamicScreenSpaceError){var l,m,g=a.camera,h=this._root,p=h.contentBoundingVolume;if(p instanceof V)b=f.normalize(g.positionWC,ua),c=g.directionWC,g=g.positionCartographic.height,l=p.minimumHeight,m=p.maximumHeight;else{var c=z.inverseTransformation(h.computedTransform,wa),b=a.mapProjection.ellipsoid,q=p.boundingVolume,d=z.multiplyByPoint(c,q.center,za);if(f.magnitude(d)>b.minimumRadius)m=k.fromCartesian(d,b,ta),b=f.normalize(g.positionWC,ua),c=g.directionWC,g=g.positionCartographic.height,l=0,m=2*m.height;else{var r=z.multiplyByPoint(c,g.positionWC,Da),b=f.UNIT_Z,c=z.multiplyByPointAsVector(c,g.directionWC,Ba),c=f.normalize(c,c),g=r.z;p instanceof X?(m=h._header.boundingVolume.box[11],l=d.z-m,m=d.z+m):p instanceof ba&&(m=q.radius,l=d.z-m,m=d.z+m)}}l+=(m-l)*this.dynamicScreenSpaceErrorHeightFalloff;l=A.clamp((g-l)/(m-l),0,1);l=(1-Math.abs(f.dot(c,b)))*(1-l);m=this.dynamicScreenSpaceErrorDensity;this._dynamicScreenSpaceErrorComputedDensity=m*l}a.newFrame&&this._cache.reset()}};var ra=new f,Ea={maximumFractionDigits:3},Ga=[];P.prototype.trimLoadedTiles=function(){this._cache.trim()};P.prototype.update=function(a){this.updateForPass(a,a.tilesetPassState)};P.prototype.updateForPass=function(b,c){g.typeOf.object("frameState",b);g.typeOf.object("tilesetPassState",c);var d=c.pass;if(!(d===K.PRELOAD&&(!this.preloadWhenHidden||this.show)||d===K.PRELOAD_FLIGHT&&(!this.preloadFlightDestinations||!this.show&&!this.preloadWhenHidden)||d===K.REQUEST_RENDER_MODE_DEFER_CHECK&&!this.cullRequestsWhileMoving&&0>=this.foveatedTimeDelay)){var f=b.commandList,h=b.camera,k=b.cullingVolume;c.ready=!1;var l=K.getPassOptions(d),p=l.ignoreCommands,q=m(c.commandList,f),r=q.length;b.commandList=q;b.camera=m(c.camera,h);b.cullingVolume=m(c.cullingVolume,k);var t=this._statisticsPerPass[d];if(this.show||p){this._pass=d;if(b.mode===ca.MORPHING)d=!1;else if(this.ready){var w=this._statistics;w.clear();var u=l.isRender;++this._updatedVisibilityFrame;this._heatmap.resetMinimumMaximum();this._minimumPriority.depth=Number.MAX_VALUE;this._maximumPriority.depth=-Number.MAX_VALUE;this._minimumPriority.foveatedFactor=Number.MAX_VALUE;this._maximumPriority.foveatedFactor=-Number.MAX_VALUE;this._minimumPriority.distance=Number.MAX_VALUE;this._maximumPriority.distance=-Number.MAX_VALUE;this._minimumPriority.reverseScreenSpaceError=Number.MAX_VALUE;this._maximumPriority.reverseScreenSpaceError=-Number.MAX_VALUE;d=l.traversal.selectTiles(this,b);if(l.requestTiles){var l=this._requestedTiles,v=l.length;l.sort(ga);for(var y=0;y<v;++y){var z=l[y];if(!z.hasEmptyContent){var E=this._statistics,A=z.contentExpired;if(z.requestContent()){if(A)if(z.hasTilesetContent){var G=z,A=G,D=Ga;for(D.push(G);0<D.length;){for(var G=D.pop(),x=G.children,H=x.length,L=0;L<H;++L)D.push(x[L]);G!==A&&(this._cache.unloadTile(this,G,oa),G.destroy(),--this._statistics.numberOfTilesTotal)}A.children=[]}else E.decrementLoadCounts(z.content),--E.numberOfTilesWithContentReady;++E.numberOfPendingRequests;this._requestedTilesInFlight.push(z);z.contentReadyToProcessPromise.then(ka(this,z));z.contentReadyPromise.then(ia(this,z)).otherwise(na(this,z))}else++E.numberOfAttemptedRequests}}}this._styleEngine.applyStyle(this,b);var l=this._statistics,v=b.commandList,y=v.length,D=this._selectedTiles,G=D.length,x=this._emptyTiles,H=x.length,L=this.tileVisible,J,A=this._skipLevelOfDetail&&this._hasMixedContent&&b.context.stencilBuffer&&0<G;this._backfaceCommands.length=0;A&&(e(this._stencilClearCommand)||(this._stencilClearCommand=new B({stencil:0,pass:C.CESIUM_3D_TILE,renderState:I.fromCache({stencilMask:da.SKIP_LOD_MASK})})),v.push(this._stencilClearCommand));z=v.length;for(E=0;E<G;++E)J=D[E],u&&L.raiseEvent(J),J.update(this,b),l.incrementSelectionCounts(J.content),++l.selected;for(E=0;E<H;++E)J=x[E],J.update(this,b);E=v.length-z;this._backfaceCommands.trim();if(A){A=this._backfaceCommands.values;D=A.length;v.length+=D;for(--E;0<=E;--E)v[z+D+E]=v[z+E];for(E=0;E<D;++E)v[z+E]=A[E]}E=v.length-y;l.numberOfCommands=E;u&&this.pointCloudShading.attenuation&&this.pointCloudShading.eyeDomeLighting&&0<E&&this._pointCloudEyeDomeLighting.update(b,y,this.pointCloudShading);if(u)if(this.debugShowGeometricError||this.debugShowRenderingStatistics||this.debugShowMemoryUsage||this.debugShowUrl){e(this._tileDebugLabels)||(this._tileDebugLabels=new Y);y=this._selectedTiles;z=y.length;E=this._emptyTiles;A=E.length;this._tileDebugLabels.removeAll();if(this.debugPickedTileLabelOnly)e(this.debugPickedTile)&&(l=e(this.debugPickPosition)?this.debugPickPosition:ha(this.debugPickedTile),pa(this.debugPickedTile,this,l).pixelOffset=new a(15,-15));else{for(l=0;l<z;++l)v=y[l],pa(v,this,ha(v));for(l=0;l<A;++l)v=E[l],v.hasTilesetContent&&pa(v,this,ha(v))}this._tileDebugLabels.update(b)}else this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy();U.clone(w,t);if(u&&(t=this._credits,e(t)&&0!==w.selected))for(w=t.length,u=0;u<w;++u)b.creditDisplay.addCredit(t[u])}else d=!1;c.ready=d}p&&(q.length=r);b.commandList=f;b.camera=h;b.cullingVolume=k}};P.prototype.hasExtension=function(a){return e(this._extensionsUsed)?-1<this._extensionsUsed.indexOf(a):!1};P.prototype.isDestroyed=function(){return!1};P.prototype.destroy=function(){this._tileDebugLabels=this._tileDebugLabels&&this._tileDebugLabels.destroy();this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy();if(e(this._root))for(Ga.push(this._root);0<Ga.length;){var a=Ga.pop();a.destroy();for(var a=a.children,b=a.length,c=0;c<b;++c)Ga.push(a[c])}this._root=void 0;return d(this)};return P});F("Scene/ConditionsExpression",["../Core/clone","../Core/defined","../Core/defineProperties","./Expression"],function(b,a,f,k){function g(f,e){this._conditionsExpression=b(f,!0);this._conditions=f.conditions;this._runtimeConditions=void 0;var g=[],m=this._conditions;if(a(m)){for(var d=m.length,q=0;q<d;++q){var t=m[q],r=String(t[1]);g.push(new l(new k(String(t[0]),e),new k(r,e)))}this._runtimeConditions=g}}function l(a,b){this.condition=a;this.expression=b}f(g.prototype,{conditionsExpression:{get:function(){return this._conditionsExpression}}});g.prototype.evaluate=function(b,e){var f=this._runtimeConditions;if(a(f))for(var g=f.length,d=0;d<g;++d){var k=f[d];if(k.condition.evaluate(b))return k.expression.evaluate(b,e)}};g.prototype.evaluateColor=function(b,e){var f=this._runtimeConditions;if(a(f))for(var g=f.length,d=0;d<g;++d){var k=f[d];if(k.condition.evaluate(b))return k.expression.evaluateColor(b,e)}};g.prototype.getShaderFunction=function(b,e,f,g){var d=this._runtimeConditions;if(a(d)&&0!==d.length){for(var h="",k=d.length,l=0;l<k;++l)var c=d[l],m=c.condition.getShaderExpression(e,f),c=c.expression.getShaderExpression(e,f),h=h+("    "+(0===l?"if":"else if")+" ("+m+") \n    { \n        return "+c+"; \n    } \n");return g+" "+b+"() \n{ \n"+h+"    return "+g+"(1.0); \n} \n"}};return g});F("Scene/Cesium3DTileStyle","../Core/clone ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Resource ../ThirdParty/when ./ConditionsExpression ./Expression".split(" "),function(b,a,f,k,g,l,m,e,h){function p(d){this._style={};this._ready=!1;this._pointSizeShaderFunction=this._showShaderFunction=this._colorShaderFunction=this._meta=this._labelVerticalOrigin=this._labelHorizontalOrigin=this._verticalOrigin=this._horizontalOrigin=this._disableDepthTestDistance=this._image=this._anchorLineColor=this._anchorLineEnabled=this._heightOffset=this._distanceDisplayCondition=this._translucencyByDistance=this._scaleByDistance=this._backgroundEnabled=this._backgroundPadding=this._backgroundColor=this._labelText=this._labelStyle=this._font=this._labelOutlineWidth=this._labelOutlineColor=this._labelColor=this._pointOutlineWidth=this._pointOutlineColor=this._pointSize=this._color=this._show=void 0;this._colorShaderTranslucent=this._pointSizeShaderFunctionReady=this._showShaderFunctionReady=this._colorShaderFunctionReady=!1;var e=this;this._readyPromise=("string"===typeof d||d instanceof l?l.createIfNeeded(d).fetchJson(d):m.resolve(d)).then(function(c){var d;d=a(b(c,!0),e._style);e._style=d;e.show=d.show;e.color=d.color;e.pointSize=d.pointSize;e.pointOutlineColor=d.pointOutlineColor;e.pointOutlineWidth=d.pointOutlineWidth;e.labelColor=d.labelColor;e.labelOutlineColor=d.labelOutlineColor;e.labelOutlineWidth=d.labelOutlineWidth;e.labelStyle=d.labelStyle;e.font=d.font;e.labelText=d.labelText;e.backgroundColor=d.backgroundColor;e.backgroundPadding=d.backgroundPadding;e.backgroundEnabled=d.backgroundEnabled;e.scaleByDistance=d.scaleByDistance;e.translucencyByDistance=d.translucencyByDistance;e.distanceDisplayCondition=d.distanceDisplayCondition;e.heightOffset=d.heightOffset;e.anchorLineEnabled=d.anchorLineEnabled;e.anchorLineColor=d.anchorLineColor;e.image=d.image;e.disableDepthTestDistance=d.disableDepthTestDistance;e.horizontalOrigin=d.horizontalOrigin;e.verticalOrigin=d.verticalOrigin;e.labelHorizontalOrigin=d.labelHorizontalOrigin;e.labelVerticalOrigin=d.labelVerticalOrigin;c={};if(f(d.meta)){var g=d.defines;d=a(d.meta,a.EMPTY_OBJECT);for(var k in d)d.hasOwnProperty(k)&&(c[k]=new h(d[k],g))}e._meta=c;e._ready=!0;return e})}function d(b,d){var c=a(b._style,a.EMPTY_OBJECT).defines;if(f(d))return"boolean"===typeof d||"number"===typeof d?new h(String(d)):"string"===typeof d?new h(d,c):f(d.conditions)?new e(d,c):d}function q(a){if(f(a))return f(a.expression)?a.expression:f(a.conditionsExpression)?b(a.conditionsExpression,!0):a}k(p.prototype,{style:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._style}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},show:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._show},set:function(a){this._show=d(this,a);this._style.show=q(this._show);this._showShaderFunctionReady=!1}},color:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._color},set:function(a){this._color=d(this,a);this._style.color=q(this._color);this._colorShaderFunctionReady=!1}},pointSize:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointSize},set:function(a){this._pointSize=d(this,a);this._style.pointSize=q(this._pointSize);this._pointSizeShaderFunctionReady=!1}},pointOutlineColor:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointOutlineColor},set:function(a){this._pointOutlineColor=d(this,a);this._style.pointOutlineColor=q(this._pointOutlineColor)}},pointOutlineWidth:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._pointOutlineWidth},set:function(a){this._pointOutlineWidth=d(this,a);this._style.pointOutlineWidth=q(this._pointOutlineWidth)}},labelColor:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelColor},set:function(a){this._labelColor=d(this,a);this._style.labelColor=q(this._labelColor)}},labelOutlineColor:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelOutlineColor},set:function(a){this._labelOutlineColor=d(this,a);this._style.labelOutlineColor=q(this._labelOutlineColor)}},labelOutlineWidth:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelOutlineWidth},set:function(a){this._labelOutlineWidth=d(this,a);this._style.labelOutlineWidth=q(this._labelOutlineWidth)}},font:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._font},set:function(a){this._font=d(this,a);this._style.font=q(this._font)}},labelStyle:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelStyle},set:function(a){this._labelStyle=d(this,a);this._style.labelStyle=q(this._labelStyle)}},labelText:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelText},set:function(a){this._labelText=d(this,a);this._style.labelText=q(this._labelText)}},backgroundColor:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundColor},set:function(a){this._backgroundColor=d(this,a);this._style.backgroundColor=q(this._backgroundColor)}},backgroundPadding:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundPadding},set:function(a){this._backgroundPadding=d(this,a);this._style.backgroundPadding=q(this._backgroundPadding)}},backgroundEnabled:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._backgroundEnabled},set:function(a){this._backgroundEnabled=d(this,a);this._style.backgroundEnabled=q(this._backgroundEnabled)}},scaleByDistance:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._scaleByDistance},set:function(a){this._scaleByDistance=d(this,a);this._style.scaleByDistance=q(this._scaleByDistance)}},translucencyByDistance:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._translucencyByDistance},set:function(a){this._translucencyByDistance=d(this,a);this._style.translucencyByDistance=q(this._translucencyByDistance)}},distanceDisplayCondition:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._distanceDisplayCondition},set:function(a){this._distanceDisplayCondition=d(this,a);this._style.distanceDisplayCondition=q(this._distanceDisplayCondition)}},heightOffset:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._heightOffset},set:function(a){this._heightOffset=d(this,a);this._style.heightOffset=q(this._heightOffset)}},anchorLineEnabled:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._anchorLineEnabled},set:function(a){this._anchorLineEnabled=d(this,a);this._style.anchorLineEnabled=q(this._anchorLineEnabled)}},anchorLineColor:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._anchorLineColor},set:function(a){this._anchorLineColor=d(this,a);this._style.anchorLineColor=q(this._anchorLineColor)}},image:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._image},set:function(a){this._image=d(this,a);this._style.image=q(this._image)}},disableDepthTestDistance:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._disableDepthTestDistance},set:function(a){this._disableDepthTestDistance=d(this,a);this._style.disableDepthTestDistance=q(this._disableDepthTestDistance)}},horizontalOrigin:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._horizontalOrigin},set:function(a){this._horizontalOrigin=d(this,a);this._style.horizontalOrigin=q(this._horizontalOrigin)}},verticalOrigin:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._verticalOrigin},set:function(a){this._verticalOrigin=d(this,a);this._style.verticalOrigin=q(this._verticalOrigin)}},labelHorizontalOrigin:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelHorizontalOrigin},set:function(a){this._labelHorizontalOrigin=d(this,a);this._style.labelHorizontalOrigin=q(this._labelHorizontalOrigin)}},labelVerticalOrigin:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._labelVerticalOrigin},set:function(a){this._labelVerticalOrigin=d(this,a);this._style.labelVerticalOrigin=q(this._labelVerticalOrigin)}},meta:{get:function(){if(!this._ready)throw new g("The style is not loaded.  Use Cesium3DTileStyle.readyPromise or wait for Cesium3DTileStyle.ready to be true.");return this._meta},set:function(a){this._meta=a}}});p.prototype.getColorShaderFunction=function(a,b,c){if(this._colorShaderFunctionReady)return c.translucent=this._colorShaderTranslucent,this._colorShaderFunction;this._colorShaderFunctionReady=!0;this._colorShaderFunction=f(this.color)?this.color.getShaderFunction(a,b,c,"vec4"):void 0;this._colorShaderTranslucent=c.translucent;return this._colorShaderFunction};p.prototype.getShowShaderFunction=function(a,b,c){if(this._showShaderFunctionReady)return this._showShaderFunction;this._showShaderFunctionReady=!0;return this._showShaderFunction=f(this.show)?this.show.getShaderFunction(a,b,c,"bool"):void 0};p.prototype.getPointSizeShaderFunction=function(a,b,c){if(this._pointSizeShaderFunctionReady)return this._pointSizeShaderFunction;this._pointSizeShaderFunctionReady=!0;return this._pointSizeShaderFunction=f(this.pointSize)?this.pointSize.getShaderFunction(a,b,c,"float"):void 0};return p});F("Scene/CircleEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(b,a,f,k,g){function l(b){b=f(b,1);a.typeOf.number.greaterThan("radius",b,0);this._radius=f(b,1)}k(l.prototype,{radius:{get:function(){return this._radius},set:function(b){a.typeOf.number.greaterThan("value",b,0);this._radius=b}}});l.prototype.emit=function(a){var e=g.randomBetween(0,g.TWO_PI),f=g.randomBetween(0,this._radius);a.position=b.fromElements(f*Math.cos(e),f*Math.sin(e),0,a.position);a.velocity=b.clone(b.UNIT_Z,a.velocity)};return l});F("Scene/computeFlyToLocationForRectangle",["../Core/defined","../Core/Rectangle","../Core/sampleTerrainMostDetailed","./SceneMode","../ThirdParty/when"],function(b,a,f,k,g){function l(f,e){var h=e.terrainProvider,m=e.mapProjection,d=m.ellipsoid,q,t=e.camera.getRectangleCameraCoordinates(f);q=e.mode===k.SCENE3D?d.cartesianToCartographic(t):m.unproject(t);return b(h)?h.readyPromise.then(function(){if(!b(h.availability)||e.mode===k.SCENE2D)return q;var d=[a.center(f),a.southeast(f),a.southwest(f),a.northeast(f),a.northwest(f)];return l._sampleTerrainMostDetailed(h,d).then(function(a){a=a.reduce(function(a,b){return Math.max(b.height,a)},-Number.MAX_VALUE);q.height+=a;return q})}):g.resolve(q)}l._sampleTerrainMostDetailed=f;return l});F("Scene/ConeEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(b,a,f,k,g){function l(a){this._angle=f(a,m)}var m=g.toRadians(30);k(l.prototype,{angle:{get:function(){return this._angle},set:function(b){a.typeOf.number("value",b);this._angle=b}}});l.prototype.emit=function(a){var e=Math.tan(this._angle),f=g.randomBetween(0,g.TWO_PI),e=g.randomBetween(0,e);a.velocity=b.fromElements(e*Math.cos(f),e*Math.sin(f),1,a.velocity);b.normalize(a.velocity,a.velocity);a.position=b.clone(b.ZERO,a.position)};return l});F("Scene/UrlTemplateImageryProvider","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/combine ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/GeographicProjection ../Core/isArray ../Core/Math ../Core/Rectangle ../Core/Resource ../Core/WebMercatorTilingScheme ../ThirdParty/when ./ImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(a){if(!m(a))throw new h("options is required.");if(!y.isPromise(a)&&!m(a.url))throw new h("options is required.");this._errorEvent=new p;this._pickFeaturesTags=this._tags=this._readyPromise=this._hasAlphaChannel=this._credit=this._tileDiscardPolicy=this._rectangle=this._tilingScheme=this._minimumLevel=this._maximumLevel=this._tileHeight=this._tileWidth=this._pickFeaturesResource=this._urlSchemeZeroPadding=this._resource=void 0;this.enablePickFeatures=!0;this.reinitialize(a)}function x(a,b,c,d,e){K=E=!1;var f=a._resource,g=f.getUrlComponent(!0),h=a._tags,k={},g=g.match(J);m(g)&&g.forEach(function(e){e=e.substring(1,e.length-1);m(h[e])&&(k[e]=h[e](a,b,c,d))});return f.getDerivedResource({request:e,templateValues:k})}function D(a,b,c,d,e,f,g){Z=N=K=E=!1;var h=a._pickFeaturesResource,k=h.getUrlComponent(!0),l=a._pickFeaturesTags,p={},k=k.match(J);m(k)&&k.forEach(function(h){h=h.substring(1,h.length-1);m(l[h])&&(p[h]=l[h](a,b,c,d,e,f,g))});return h.getDerivedResource({templateValues:p})}function v(a,b,c){a&&a.urlSchemeZeroPadding&&a.urlSchemeZeroPadding.hasOwnProperty(b)&&(a=a.urlSchemeZeroPadding[b],"string"===typeof a&&(a=a.length,1<a&&(c=c.length>=a?c:Array(a-c.toString().length+1).join("0")+c)));return c}function B(a,b,c,d){E||(a.tilingScheme.tileXYToRectangle(b,c,d,L),L.west=t.toDegrees(L.west),L.south=t.toDegrees(L.south),L.east=t.toDegrees(L.east),L.north=t.toDegrees(L.north),E=!0)}function C(a,b,c,d){K||(a.tilingScheme.tileXYToNativeRectangle(b,c,d,F),K=!0)}function I(a,b,c,d,e,f,g){N||(H(a,b,c,d,e,f),e=U,b=a.tilingScheme.tileXYToNativeRectangle(b,c,d,aa),O.x=a.tileWidth*(e.x-b.west)/b.width|0,O.y=a.tileHeight*(b.north-e.y)/b.height|0,N=!0)}function H(a,b,c,e,f,g,h){Z||(a.tilingScheme.projection instanceof d?(U.x=t.toDegrees(f),U.y=t.toDegrees(g)):(b=W,b.longitude=f,b.latitude=g,a.tilingScheme.projection.project(b,U)),Z=!0)}var J=/{[^}]+}/g,w={x:function(a,b,c,d){return v(a,"{x}",b)},y:function(a,b,c,d){return v(a,"{y}",c)},z:function(a,b,c,d){return v(a,"{z}",d)},s:function(a,b,c,d){return a._subdomains[(b+c+d)%a._subdomains.length]},reverseX:function(a,b,c,d){b=a.tilingScheme.getNumberOfXTilesAtLevel(d)-b-1;return v(a,"{reverseX}",b)},reverseY:function(a,b,c,d){b=a.tilingScheme.getNumberOfYTilesAtLevel(d)-c-1;return v(a,"{reverseY}",b)},reverseZ:function(a,b,c,d){b=a.maximumLevel;d=m(b)&&d<b?b-d-1:d;return v(a,"{reverseZ}",d)},westDegrees:function(a,b,c,d){B(a,b,c,d);return L.west},southDegrees:function(a,b,c,d){B(a,b,c,d);return L.south},eastDegrees:function(a,b,c,d){B(a,b,c,d);return L.east},northDegrees:function(a,b,c,d){B(a,b,c,d);return L.north},westProjected:function(a,b,c,d){C(a,b,c,d);return F.west},southProjected:function(a,b,c,d){C(a,b,c,d);return F.south},eastProjected:function(a,b,c,d){C(a,b,c,d);return F.east},northProjected:function(a,b,c,d){C(a,b,c,d);return F.north},width:function(a,b,c,d){return a.tileWidth},height:function(a,b,c,d){return a.tileHeight}},G=k(w,{i:function(a,b,c,d,e,f,g){I(a,b,c,d,e,f);return O.x},j:function(a,b,c,d,e,f,g){I(a,b,c,d,e,f);return O.y},reverseI:function(a,b,c,d,e,f,g){I(a,b,c,d,e,f);return a.tileWidth-O.x-1},reverseJ:function(a,b,c,d,e,f,g){I(a,b,c,d,e,f);return a.tileHeight-O.y-1},longitudeDegrees:function(a,b,c,d,e,f,g){return t.toDegrees(e)},latitudeDegrees:function(a,b,c,d,e,f,g){return t.toDegrees(f)},longitudeProjected:function(a,b,c,d,e,f,g){H(a,b,c,d,e,f);return U.x},latitudeProjected:function(a,b,c,d,e,f,g){H(a,b,c,d,e,f);return U.y},format:function(a,b,c,d,e,f,g){return g}});e(z.prototype,{url:{get:function(){return this._resource.url}},urlSchemeZeroPadding:{get:function(){return this._urlSchemeZeroPadding}},pickFeaturesUrl:{get:function(){return this._pickFeaturesResource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this.ready)throw new h("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this.ready)throw new h("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this.ready)throw new h("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this.ready)throw new h("minimumLevel must not be called before the imagery provider is ready.");return this._minimumLevel}},tilingScheme:{get:function(){if(!this.ready)throw new h("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this.ready)throw new h("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this.ready)throw new h("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return m(this._resource)}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){if(!this.ready)throw new h("credit must not be called before the imagery provider is ready.");return this._credit}},hasAlphaChannel:{get:function(){if(!this.ready)throw new h("hasAlphaChannel must not be called before the imagery provider is ready.");return this._hasAlphaChannel}}});z.prototype.reinitialize=function(a){var b=this;b._readyPromise=y(a).then(function(a){if(!m(a))throw new h("options is required.");if(!m(a.url))throw new h("options.url is required.");var d=a.customTags,e=k(w,d),d=k(G,d),f=c.createIfNeeded(a.url),p=c.createIfNeeded(a.pickFeaturesUrl);b.enablePickFeatures=l(a.enablePickFeatures,b.enablePickFeatures);b._urlSchemeZeroPadding=l(a.urlSchemeZeroPadding,b.urlSchemeZeroPadding);b._tileDiscardPolicy=a.tileDiscardPolicy;b._getFeatureInfoFormats=a.getFeatureInfoFormats;b._subdomains=a.subdomains;q(b._subdomains)?b._subdomains=b._subdomains.slice():m(b._subdomains)&&0<b._subdomains.length?b._subdomains=b._subdomains.split(""):b._subdomains=["a","b","c"];b._tileWidth=l(a.tileWidth,256);b._tileHeight=l(a.tileHeight,256);b._minimumLevel=l(a.minimumLevel,0);b._maximumLevel=a.maximumLevel;b._tilingScheme=l(a.tilingScheme,new u({ellipsoid:a.ellipsoid}));b._rectangle=l(a.rectangle,b._tilingScheme.rectangle);b._rectangle=r.intersection(b._rectangle,b._tilingScheme.rectangle);b._hasAlphaChannel=l(a.hasAlphaChannel,!0);a=a.credit;"string"===typeof a&&(a=new g(a));b._credit=a;b._resource=f;b._tags=e;b._pickFeaturesResource=p;b._pickFeaturesTags=d;return!0})};z.prototype.getTileCredits=function(a,b,c){if(!this.ready)throw new h("getTileCredits must not be called before the imagery provider is ready.");};z.prototype.requestImage=function(a,b,c,d){if(!this.ready)throw new h("requestImage must not be called before the imagery provider is ready.");return A.loadImage(this,x(this,a,b,c,d))};z.prototype.pickFeatures=function(a,b,c,d,e){function f(a,b){return a.callback(b)}function g(){if(k>=l._getFeatureInfoFormats.length)return y([]);var h=l._getFeatureInfoFormats[k],m=D(l,a,b,c,d,e,h.format);++k;return"json"===h.type?m.fetchJson().then(h.callback).otherwise(g):"xml"===h.type?m.fetchXML().then(h.callback).otherwise(g):"text"===h.type||"html"===h.type?m.fetchText().then(h.callback).otherwise(g):m.fetch({responseType:h.format}).then(f.bind(void 0,h)).otherwise(g)}if(!this.ready)throw new h("pickFeatures must not be called before the imagery provider is ready.");if(this.enablePickFeatures&&m(this._pickFeaturesResource)&&0!==this._getFeatureInfoFormats.length){var k=0,l=this;return g()}};var E=!1,L=new r,K=!1,F=new r,N=!1,O=new b,Z=!1,aa=new r,U=new a,W=new f;return z});F("Scene/createOpenStreetMapImageryProvider","../Core/appendForwardSlash ../Core/Credit ../Core/defaultValue ../Core/DeveloperError ../Core/Rectangle ../Core/Resource ../Core/WebMercatorTilingScheme ./UrlTemplateImageryProvider".split(" "),function(b,a,f,k,g,l,m,e){var h=new a("MapQuest, Open Street Map and contributors, CC-BY-SA");return function(p){p=f(p,{});var d=f(p.url,"https://a.tile.openstreetmap.org/"),d=b(d),d=d+("{z}/{x}/{y}."+f(p.fileExtension,"png")),d=l.createIfNeeded(d),q=new m({ellipsoid:p.ellipsoid}),t=f(p.minimumLevel,0),r=p.maximumLevel,c=f(p.rectangle,q.rectangle),u=q.positionToTileXY(g.southwest(c),t),y=q.positionToTileXY(g.northeast(c),t),u=(Math.abs(y.x-u.x)+1)*(Math.abs(y.y-u.y)+1);if(4<u)throw new k("The rectangle and minimumLevel indicate that there are "+u+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");p=f(p.credit,h);"string"===typeof p&&(p=new a(p));return new e({url:d,credit:p,tilingScheme:q,tileWidth:256,tileHeight:256,minimumLevel:t,maximumLevel:r,rectangle:c})}});F("Scene/createTangentSpaceDebugPrimitive","../Core/ColorGeometryInstanceAttribute ../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Core/GeometryInstance ../Core/GeometryPipeline ../Core/Matrix4 ./PerInstanceColorAppearance ./Primitive".split(" "),function(b,a,f,k,g,l,m,e,h){return function(p){p=a(p,a.EMPTY_OBJECT);var d=[],q=p.geometry;if(!f(q))throw new k("options.geometry is required.");f(q.attributes)&&f(q.primitiveType)||(q=q.constructor.createGeometry(q));var t=q.attributes,r=m.clone(a(p.modelMatrix,m.IDENTITY));p=a(p.length,1E4);f(t.normal)&&d.push(new g({geometry:l.createLineSegmentsForVectors(q,"normal",p),attributes:{color:new b(1,0,0,1)},modelMatrix:r}));f(t.tangent)&&d.push(new g({geometry:l.createLineSegmentsForVectors(q,"tangent",p),attributes:{color:new b(0,1,0,1)},modelMatrix:r}));f(t.bitangent)&&d.push(new g({geometry:l.createLineSegmentsForVectors(q,"bitangent",p),attributes:{color:new b(0,0,1,1)},modelMatrix:r}));if(0<d.length)return new h({asynchronous:!1,geometryInstances:d,appearance:new e({flat:!0,translucent:!1})})}});F("Scene/createTileMapServiceImageryProvider","../Core/Cartesian2 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/DeveloperError ../Core/GeographicProjection ../Core/GeographicTilingScheme ../Core/Rectangle ../Core/Resource ../Core/RuntimeError ../Core/TileProviderError ../Core/WebMercatorTilingScheme ../ThirdParty/when ./UrlTemplateImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){return function(c){function u(g){var h=/tileformat/i,r=/tileset/i,t=/tilesets/i,w=/boundingbox/i,u,y,C,K=[];g=g.childNodes[0].childNodes;for(var F=0;F<g.length;F++)if(h.test(g.item(F).nodeName))u=g.item(F);else if(t.test(g.item(F).nodeName)){C=g.item(F);for(var N=g.item(F).childNodes,O=0;O<N.length;O++)r.test(N.item(O).nodeName)&&K.push(N.item(O))}else w.test(g.item(F).nodeName)&&(y=g.item(F));if(k(C)&&k(y)){r=f(c.fileExtension,u.getAttribute("extension"));h=f(c.tileWidth,parseInt(u.getAttribute("width"),10));u=f(c.tileHeight,parseInt(u.getAttribute("height"),10));t=f(c.minimumLevel,parseInt(K[0].getAttribute("order"),10));K=f(c.maximumLevel,parseInt(K[K.length-1].getAttribute("order"),10));g=C.getAttribute("profile");C=c.tilingScheme;if(!k(C))if("geodetic"===g||"global-geodetic"===g)C=new m({ellipsoid:c.ellipsoid});else if("mercator"===g||"global-mercator"===g)C=new q({ellipsoid:c.ellipsoid});else{y=B.url+"specifies an unsupported profile attribute, "+g+".";D=d.handleError(D,x,x.errorEvent,y,void 0,void 0,void 0,A);D.retry||z.reject(new p(y));return}w=e.clone(c.rectangle);k(w)||(f(c.flipXY,!1)?(w=new b(parseFloat(y.getAttribute("miny")),parseFloat(y.getAttribute("minx"))),y=new b(parseFloat(y.getAttribute("maxy")),parseFloat(y.getAttribute("maxx")))):(w=new b(parseFloat(y.getAttribute("minx")),parseFloat(y.getAttribute("miny"))),y=new b(parseFloat(y.getAttribute("maxx")),parseFloat(y.getAttribute("maxy")))),C.projection instanceof l||"geodetic"===g||"mercator"===g?(w=a.fromDegrees(w.x,w.y),y=a.fromDegrees(y.x,y.y)):(g=C.projection,w=g.unproject(w),y=g.unproject(y)),w=new e(w.longitude,w.latitude,y.longitude,y.latitude));w.west<C.rectangle.west&&(w.west=C.rectangle.west);w.east>C.rectangle.east&&(w.east=C.rectangle.east);w.south<C.rectangle.south&&(w.south=C.rectangle.south);w.north>C.rectangle.north&&(w.north=C.rectangle.north);y=C.positionToTileXY(e.southwest(w),t);g=C.positionToTileXY(e.northeast(w),t);4<(Math.abs(g.x-y.x)+1)*(Math.abs(g.y-y.y)+1)&&(t=0);y=v.getDerivedResource({url:"{z}/{x}/{reverseY}."+r});z.resolve({url:y,tilingScheme:C,rectangle:w,tileWidth:h,tileHeight:u,minimumLevel:t,maximumLevel:K,tileDiscardPolicy:c.tileDiscardPolicy,credit:c.credit})}else y="Unable to find expected tilesets or bbox attributes in "+B.url+".",D=d.handleError(D,x,x.errorEvent,y,void 0,void 0,void 0,A),D.retry||z.reject(new p(y))}function y(a){var b=f(c.fileExtension,"png");a=f(c.tileWidth,256);var d=f(c.tileHeight,256),e=f(c.minimumLevel,0),g=c.maximumLevel,h=k(c.tilingScheme)?c.tilingScheme:new q({ellipsoid:c.ellipsoid}),l=f(c.rectangle,h.rectangle),b=v.getDerivedResource({url:"{z}/{x}/{reverseY}."+b});z.resolve({url:b,tilingScheme:h,rectangle:l,tileWidth:a,tileHeight:d,minimumLevel:e,maximumLevel:g,tileDiscardPolicy:c.tileDiscardPolicy,credit:c.credit})}function A(){B.fetchXML().then(u).otherwise(y)}c=f(c,{});if(!k(c.url))throw new g("options.url is required.");var z=t.defer(),x=new r(z.promise),D,v,B;t(c.url).then(function(a){v=h.createIfNeeded(a);v.appendForwardSlash();B=v.getDerivedResource({url:"tilemapresource.xml"});A()}).otherwise(function(a){z.reject(a)});return x}});F("Scene/GoogleEarthEnterpriseMapsProvider","../Core/buildModuleUrl ../Core/Check ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/GeographicTilingScheme ../Core/Rectangle ../Core/Resource ../Core/RuntimeError ../Core/TileProviderError ../Core/WebMercatorTilingScheme ../ThirdParty/when ./ImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(a){function b(b){var c;try{c=JSON.parse(b)}catch(L){c=JSON.parse(b.replace(/([\[\{,])[\n\r ]*([A-Za-z0-9]+)[\n\r ]*:/g,'$1"$2":'))}var d;for(b=0;b<c.layers.length;b++)if(c.layers[b].id===H._channel){d=c.layers[b];break}if(!g(d))throw c="Could not find layer with channel (id) of "+H._channel+".",J=t.handleError(J,H,H._errorEvent,c,void 0,void 0,void 0,u),new q(c);if(!g(d.version))throw c="Could not find a version in channel (id) "+H._channel+".",J=t.handleError(J,H,H._errorEvent,c,void 0,void 0,void 0,u),new q(c);H._version=d.version;if(g(c.projection)&&"flat"===c.projection)H._tilingScheme=new h({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new p(-Math.PI,-Math.PI,Math.PI,Math.PI),ellipsoid:a.ellipsoid});else{if(g(c.projection)&&"mercator"!==c.projection)throw c="Unsupported projection "+c.projection+".",J=t.handleError(J,H,H._errorEvent,c,void 0,void 0,void 0,u),new q(c);H._tilingScheme=new r({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,ellipsoid:a.ellipsoid})}H._ready=!0;H._readyPromise.resolve(!0);t.handleSuccess(J)}function l(a){a="An error occurred while accessing "+I.url+".";J=t.handleError(J,H,H._errorEvent,a,void 0,void 0,void 0,u);H._readyPromise.reject(new q(a))}function u(){var a=I.fetchText();c(a,b,l)}a=k(a,{});if(!g(a.url))throw new m("options.url is required.");if(!g(a.channel))throw new m("options.channel is required.");var v=a.url,A=k(a.path,"/default_map"),C=d.createIfNeeded(v).getDerivedResource({url:"/"===A[0]?A.substring(1):A});C.appendForwardSlash();this._resource=C;this._url=v;this._path=A;this._tileDiscardPolicy=a.tileDiscardPolicy;this._channel=a.channel;this._requestType="ImageryMaps";this._credit=new f('\x3ca href\x3d"http://www.google.com/enterprise/mapsearth/products/earthenterprise.html"\x3e\x3cimg src\x3d"'+y.logoUrl+'" title\x3d"Google Imagery"/\x3e\x3c/a\x3e');this.defaultGamma=1.9;this._version=this._tilingScheme=void 0;this._tileHeight=this._tileWidth=256;this._maximumLevel=a.maximumLevel;this._errorEvent=new e;this._ready=!1;this._readyPromise=c.defer();var I=C.getDerivedResource({url:"query",queryParameters:{request:"Json",vars:"geeServerDefs",is2d:"t"}}),H=this,J;u()}l(y.prototype,{url:{get:function(){return this._url}},path:{get:function(){return this._path}},proxy:{get:function(){return this._resource.proxy}},channel:{get:function(){return this._channel}},tileWidth:{get:function(){if(!this._ready)throw new m("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new m("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new m("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new m("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new m("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},version:{get:function(){if(!this._ready)throw new m("version must not be called before the imagery provider is ready.");return this._version}},requestType:{get:function(){if(!this._ready)throw new m("requestType must not be called before the imagery provider is ready.");return this._requestType}},rectangle:{get:function(){if(!this._ready)throw new m("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new m("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}});y.prototype.getTileCredits=function(a,b,c){};y.prototype.requestImage=function(a,b,c,d){if(!this._ready)throw new m("requestImage must not be called before the imagery provider is ready.");a=this._resource.getDerivedResource({url:"query",request:d,queryParameters:{request:this._requestType,channel:this._channel,version:this._version,x:a,y:b,z:c+1}});return u.loadImage(this,a)};y.prototype.pickFeatures=function(a,b,c,d,e){};y._logoUrl=void 0;l(y,{logoUrl:{get:function(){g(y._logoUrl)||(y._logoUrl=b("Assets/Images/google_earth_credit.png"));return y._logoUrl},set:function(b){a.defined("value",b);y._logoUrl=b}}});return y});F("Scene/MapboxImageryProvider","../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/MapboxApi ../Core/Resource ./UrlTemplateImageryProvider".split(" "),function(b,a,f,k,g,l,m,e){function h(h){h=a(h,a.EMPTY_OBJECT);var k=h.mapId;if(!f(k))throw new g("options.mapId is required.");var q=h.url;f(q)||(q="https://{s}.tiles.mapbox.com/v4/");this._url=q;var q=m.createIfNeeded(q),c=l.getAccessToken(h.accessToken);this._mapId=k;this._accessToken=c;this._accessTokenErrorCredit=b.clone(l.getErrorCredit(h.accessToken));var u=a(h.format,"png");/\./.test(u)||(u="."+u);this._format=u;u=q.getUrlComponent();p.test(u)||(u+="/");u+=k+"/{z}/{x}/{y}"+this._format;q.url=u;q.setQueryParameters({access_token:c});f(h.credit)?(k=h.credit,"string"===typeof k&&(k=new b(k))):k=d;this._resource=q;this._imageryProvider=new e({url:q,credit:k,ellipsoid:h.ellipsoid,minimumLevel:h.minimumLevel,maximumLevel:h.maximumLevel,rectangle:h.rectangle})}var p=/\/$/,d=new b('\x26copy; \x3ca href\x3d"https://www.mapbox.com/about/maps/"\x3eMapbox\x3c/a\x3e \x26copy; \x3ca href\x3d"http://www.openstreetmap.org/copyright"\x3eOpenStreetMap\x3c/a\x3e \x3cstrong\x3e\x3ca href\x3d"https://www.mapbox.com/map-feedback/"\x3eImprove this map\x3c/a\x3e\x3c/strong\x3e');k(h.prototype,{url:{get:function(){return this._url}},ready:{get:function(){return this._imageryProvider.ready}},readyPromise:{get:function(){return this._imageryProvider.readyPromise}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}});h.prototype.getTileCredits=function(a,b,d){if(f(this._accessTokenErrorCredit))return[this._accessTokenErrorCredit]};h.prototype.requestImage=function(a,b,d,c){return this._imageryProvider.requestImage(a,b,d,c)};h.prototype.pickFeatures=function(a,b,d,c,e){return this._imageryProvider.pickFeatures(a,b,d,c,e)};h._defaultCredit=d;return h});F("Scene/SingleTileImageryProvider","../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/GeographicTilingScheme ../Core/Rectangle ../Core/Resource ../Core/RuntimeError ../Core/TileProviderError ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(k){function c(a){x._image=a;x._tileWidth=a.width;x._tileHeight=a.height;x._ready=!0;x._readyPromise.resolve(!0);d.handleSuccess(x._errorEvent)}function r(a){var b="Failed to load image "+A.url+".";D=d.handleError(D,x,x._errorEvent,b,0,0,0,t,a);x._readyPromise.reject(new p(b))}function t(){A.fetchImage().then(c).otherwise(r)}k=a(k,{});if(!f(k.url))throw new g("options.url is required.");var A=h.createIfNeeded(k.url),z=a(k.rectangle,e.MAX_VALUE);this._tilingScheme=new m({rectangle:z,numberOfLevelZeroTilesX:1,numberOfLevelZeroTilesY:1,ellipsoid:k.ellipsoid});this._resource=A;this._texture=this._image=void 0;this._tileHeight=this._tileWidth=0;this._errorEvent=new l;this._ready=!1;this._readyPromise=q.defer();k=k.credit;"string"===typeof k&&(k=new b(k));this._credit=k;var x=this,D;t()}k(t.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){if(!this._ready)throw new g("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new g("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new g("maximumLevel must not be called before the imagery provider is ready.");return 0}},minimumLevel:{get:function(){if(!this._ready)throw new g("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new g("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new g("tileDiscardPolicy must not be called before the imagery provider is ready.");}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}}});t.prototype.getTileCredits=function(a,b,d){};t.prototype.requestImage=function(a,b,d,e){if(!this._ready)throw new g("requestImage must not be called before the imagery provider is ready.");return this._image};t.prototype.pickFeatures=function(a,b,d,e,f){};return t});F("Scene/GetFeatureInfoFormat",["../Core/Cartographic","../Core/defined","../Core/DeveloperError","../Core/RuntimeError","./ImageryLayerFeatureInfo"],function(b,a,f,k,g){function l(c){var d=[];c=c.features;for(var e=0;e<c.length;++e){var f=c[e],h=new g;h.data=f;h.properties=f.properties;h.configureNameFromProperties(f.properties);h.configureDescriptionFromProperties(f.properties);a(f.geometry)&&"Point"===f.geometry.type&&(h.position=b.fromDegrees(f.geometry.coordinates[0],f.geometry.coordinates[1]));d.push(h)}return d}function m(b){var c=b.documentElement;if("MultiFeatureCollection"===c.localName&&c.namespaceURI===d){c=[];b=b.documentElement.getElementsByTagNameNS(d,"Feature");for(var f=0;f<b.length;++f){for(var l=b[f],m={},p=l.getElementsByTagNameNS(d,"Val"),u=0;u<p.length;++u){var y=p[u];if(y.hasAttribute("ref")){var A=y.getAttribute("ref"),y=y.textContent.trim();m[A]=y}}p=new g;p.data=l;p.properties=m;p.configureNameFromProperties(m);p.configureDescriptionFromProperties(m);c.push(p)}return c}if("FeatureInfoResponse"===c.localName&&c.namespaceURI===q){b=b.documentElement;c=[];f=b.getElementsByTagNameNS("*","FIELDS");if(0<f.length)for(l=0;l<f.length;++l){m=f[l];b={};p=m.attributes;for(u=0;u<p.length;++u)A=p[u],b[A.name]=A.value;c.push(h(m,b))}else for(f=b.getElementsByTagNameNS("*","FeatureInfo"),l=0;l<f.length;++l){m=f[l];b={};p=m.childNodes;for(u=0;u<p.length;++u)A=p[u],A.nodeType===Node.ELEMENT_NODE&&(b[A.localName]=A.textContent);c.push(h(m,b))}return c}if("FeatureCollection"===c.localName&&c.namespaceURI===t){c=[];b=b.documentElement.getElementsByTagNameNS(r,"featureMember");for(f=0;f<b.length;++f)l=b[f],m={},e(l,m),c.push(h(l,m));return c}if("ServiceExceptionReport"===c.localName)throw new k((new XMLSerializer).serializeToString(c));if("msGMLOutput"===c.localName){c=[];b=b.documentElement.childNodes;for(l=0;l<b.length;l++)if(b[l].nodeType===Node.ELEMENT_NODE){f=b[l];break}if(!a(f))throw new k("Unable to find first child of the feature info xml document");b=f.childNodes;for(f=0;f<b.length;++f)l=b[f],l.nodeType===Node.ELEMENT_NODE&&(m={},e(l,m),c.push(h(l,m)));return c}f=(new XMLSerializer).serializeToString(b);c=document.createElement("div");l=document.createElement("pre");l.textContent=f;c.appendChild(l);f=new g;f.data=b;f.description=c.innerHTML;return[f]}function e(a,b){for(var c=!0,d=0;d<a.childNodes.length;++d){var f=a.childNodes[d];f.nodeType===Node.ELEMENT_NODE&&(c=!1);"Point"!==f.localName&&"LineString"!==f.localName&&"Polygon"!==f.localName&&"boundedBy"!==f.localName&&f.hasChildNodes()&&e(f,b)&&(b[f.localName]=f.textContent)}return c}function h(a,b){var c=new g;c.data=a;c.properties=b;c.configureNameFromProperties(b);c.configureDescriptionFromProperties(b);return c}function p(a){if(!c.test(a)&&!u.test(a)){var b,d=y.exec(a);d&&1<d.length&&(b=d[1]);d=new g;d.name=b;d.description=a;d.data=a;return[d]}}var d="http://www.mapinfo.com/mxp",q="http://www.esri.com/wms",t="http://www.opengis.net/wfs",r="http://www.opengis.net/gml",c=/<body>\s*<\/body>/im,u=/<ServiceExceptionReport([\s\S]*)<\/ServiceExceptionReport>/im,y=/<title>([\s\S]*)<\/title>/im;return function(b,c,d){if(!a(b))throw new f("type is required.");this.type=b;if(!a(c))if("json"===b)c="application/json";else if("xml"===b)c="text/xml";else if("html"===b)c="text/html";else if("text"===b)c="text/plain";else throw new f('format is required when type is not "json", "xml", "html", or "text".');this.format=c;if(!a(d))if("json"===b)d=l;else if("xml"===b)d=m;else if("html"===b)d=p;else if("text"===b)d=p;else throw new f('callback is required when type is not "json", "xml", "html", or "text".');this.callback=d}});F("Scene/TimeDynamicImagery","../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/JulianDate ../Core/Request ../Core/RequestType".split(" "),function(b,a,f,k,g,l,m,e){function h(d){d=a(d,a.EMPTY_OBJECT);b.typeOf.object("options.clock",d.clock);b.typeOf.object("options.times",d.times);b.typeOf.func("options.requestImageFunction",d.requestImageFunction);b.typeOf.func("options.reloadFunction",d.reloadFunction);this._tileCache={};this._tilesRequestedForInterval=[];var e=this._clock=d.clock;this._times=d.times;this._requestImageFunction=d.requestImageFunction;this._reloadFunction=d.reloadFunction;this._currentIntervalIndex=-1;e.onTick.addEventListener(this._clockOnTick,this);this._clockOnTick(e)}function p(a){var b=a._times;if(f(b)){var d=a._clock,c=d.currentTime;a=d.multiplier;if(d.canAnimate&&d.shouldAnimate||0===a)if(d=b.indexOf(c),!(0>d)){var e=b.get(d);0<a?(c=l.secondsDifference(e.stop,c),++d):(c=l.secondsDifference(e.start,c),--d);return 0<=d&&5>=c/a?b.get(d):void 0}}}function d(a,b,d){var c=a._times.indexOf(d.start),g=a._tileCache,h=g[c];f(h)||(h=g[c]={});c=b.key;if(f(h[c]))return!0;g=c.split("-");g=3!==g.length?void 0:{x:Number(g[0]),y:Number(g[1]),level:Number(g[2])};b=new m({throttle:!0,throttleByServer:!0,type:e.IMAGERY,priorityFunction:b.priorityFunction});a=a._requestImageFunction(g.x,g.y,g.level,b,d);if(!f(a))return!1;h[c]={promise:a,request:b};return!0}k(h.prototype,{clock:{get:function(){return this._clock},set:function(a){if(!f(a))throw new g("value is required.");this._clock!==a&&(this._clock=a,this._clockOnTick(a),this._reloadFunction())}},times:{get:function(){return this._times},set:function(a){if(!f(a))throw new g("value is required.");this._times!==a&&(this._times=a,this._clockOnTick(this._clock),this._reloadFunction())}},currentInterval:{get:function(){return this._times.get(this._currentIntervalIndex)}}});h.prototype.getFromCache=function(a,b,d,c){a=a+"-"+b+"-"+d;var e;b=this._tileCache[this._currentIntervalIndex];if(f(b)&&f(b[a])){var g=b[a];e=g.promise.otherwise(function(a){c.state=g.request.state;throw a;});delete b[a]}return e};h.prototype.checkApproachingInterval=function(a,b,e,c){e=a+"-"+b+"-"+e;a=this._tilesRequestedForInterval;b=p(this);c={key:e,priorityFunction:c.priorityFunction};f(b)&&d(this,c,b)||a.push(c);512<=a.length&&a.splice(0,256)};h.prototype._clockOnTick=function(a){a=this._times.indexOf(a.currentTime);var b=this._currentIntervalIndex;if(a!==b){var e=this._tileCache[b],c;for(c in e)e.hasOwnProperty(c)&&e[c].request.cancel();delete this._tileCache[b];this._tilesRequestedForInterval=[];this._currentIntervalIndex=a;this._reloadFunction()}else if(c=p(this),f(c))for(a=this._tilesRequestedForInterval,b=!0;b&&0!==a.length;)e=a.pop(),(b=d(this,e,c))||a.push(e)};return h});F("Scene/WebMapServiceImageryProvider","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/freezeObject ../Core/GeographicTilingScheme ../Core/Resource ../Core/WebMercatorProjection ./GetFeatureInfoFormat ./TimeDynamicImagery ./UrlTemplateImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(c){c=b(c,b.EMPTY_OBJECT);if(!a(c.url))throw new k("options.url is required.");if(!a(c.layers))throw new k("options.layers is required.");if(a(c.times)&&!a(c.clock))throw new k("options.times was specified, so options.clock is required.");var f=m.createIfNeeded(c.url),g=f.clone();f.setQueryParameters(q.DefaultParameters,!0);g.setQueryParameters(q.GetFeatureInfoDefaultParameters,!0);a(c.parameters)&&f.setQueryParameters(r(c.parameters));a(c.getFeatureInfoParameters)&&g.setQueryParameters(r(c.getFeatureInfoParameters));var h=this;this._reload=void 0;a(c.times)&&(this._timeDynamicImagery=new p({clock:c.clock,times:c.times,requestImageFunction:function(a,b,c,d,e){return t(h,a,b,c,d,e)},reloadFunction:function(){a(h._reload)&&h._reload()}}));var z={};z.layers=c.layers;z.bbox="{westProjected},{southProjected},{eastProjected},{northProjected}";z.width="{width}";z.height="{height}";1.3<=parseFloat(f.queryParameters.version)?z.crs=b(c.crs,c.tilingScheme&&c.tilingScheme.projection instanceof e?"EPSG:3857":"CRS:84"):z.srs=b(c.srs,c.tilingScheme&&c.tilingScheme.projection instanceof e?"EPSG:3857":"EPSG:4326");f.setQueryParameters(z,!0);g.setQueryParameters(z,!0);g.setQueryParameters({query_layers:c.layers,x:"{i}",y:"{j}",info_format:"{format}"},!0);this._resource=f;this._pickFeaturesResource=g;this._layers=c.layers;this._tileProvider=new d({url:f,pickFeaturesUrl:g,tilingScheme:b(c.tilingScheme,new l({ellipsoid:c.ellipsoid})),rectangle:c.rectangle,tileWidth:c.tileWidth,tileHeight:c.tileHeight,minimumLevel:c.minimumLevel,maximumLevel:c.maximumLevel,subdomains:c.subdomains,tileDiscardPolicy:c.tileDiscardPolicy,credit:c.credit,getFeatureInfoFormats:b(c.getFeatureInfoFormats,q.DefaultGetFeatureInfoFormats),enablePickFeatures:c.enablePickFeatures})}function t(b,d,e,f,g,h){h=a(h)?h.data:void 0;b=b._tileProvider;a(h)&&b._resource.setQueryParameters(h);return b.requestImage(d,e,f,g)}function r(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c.toLowerCase()]=a[c]);return b}f(q.prototype,{url:{get:function(){return this._resource._url}},proxy:{get:function(){return this._resource.proxy}},layers:{get:function(){return this._layers}},tileWidth:{get:function(){return this._tileProvider.tileWidth}},tileHeight:{get:function(){return this._tileProvider.tileHeight}},maximumLevel:{get:function(){return this._tileProvider.maximumLevel}},minimumLevel:{get:function(){return this._tileProvider.minimumLevel}},tilingScheme:{get:function(){return this._tileProvider.tilingScheme}},rectangle:{get:function(){return this._tileProvider.rectangle}},tileDiscardPolicy:{get:function(){return this._tileProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._tileProvider.errorEvent}},ready:{get:function(){return this._tileProvider.ready}},readyPromise:{get:function(){return this._tileProvider.readyPromise}},credit:{get:function(){return this._tileProvider.credit}},hasAlphaChannel:{get:function(){return this._tileProvider.hasAlphaChannel}},enablePickFeatures:{get:function(){return this._tileProvider.enablePickFeatures},set:function(a){this._tileProvider.enablePickFeatures=a}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(a){this._timeDynamicImagery.clock=a}},times:{get:function(){return this._timeDynamicImagery.times},set:function(a){this._timeDynamicImagery.times=a}}});q.prototype.getTileCredits=function(a,b,d){return this._tileProvider.getTileCredits(a,b,d)};q.prototype.requestImage=function(b,d,e,f){var c,g=this._timeDynamicImagery,h;a(g)&&(h=g.currentInterval,c=g.getFromCache(b,d,e,f));a(c)||(c=t(this,b,d,e,f,h));a(c)&&a(g)&&g.checkApproachingInterval(b,d,e,f);return c};q.prototype.pickFeatures=function(b,d,e,f,g){var c=this._timeDynamicImagery,c=a(c)?c.currentInterval:void 0,c=a(c)?c.data:void 0,h=this._tileProvider;a(c)&&h._pickFeaturesResource.setQueryParameters(c);return h.pickFeatures(b,d,e,f,g)};q.DefaultParameters=g({service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"});q.GetFeatureInfoDefaultParameters=g({service:"WMS",version:"1.1.1",request:"GetFeatureInfo"});q.DefaultGetFeatureInfoFormats=g([g(new h("json","application/json")),g(new h("xml","text/xml")),g(new h("text","text/html"))]);return q});F("Scene/WebMapTileServiceImageryProvider","../Core/combine ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/freezeObject ../Core/isArray ../Core/Rectangle ../Core/Resource ../Core/WebMercatorTilingScheme ../ThirdParty/when ./ImageryProvider ./TimeDynamicImagery".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(b){b=f(b,f.EMPTY_OBJECT);if(!k(b.url))throw new l("options.url is required.");if(!k(b.layer))throw new l("options.layer is required.");if(!k(b.style))throw new l("options.style is required.");if(!k(b.tileMatrixSetID))throw new l("options.tileMatrixSetID is required.");if(k(b.times)&&!k(b.clock))throw new l("options.times was specified, so options.clock is required.");var e=d.createIfNeeded(b.url),g=b.style,r=b.tileMatrixSetID;0<=e.url.indexOf("{")?(e.setTemplateValues({style:g,Style:g,TileMatrixSet:r}),this._useKvp=!1):(e.setQueryParameters(A),this._useKvp=!0);this._resource=e;this._layer=b.layer;this._style=g;this._tileMatrixSetID=r;this._tileMatrixLabels=b.tileMatrixLabels;this._format=f(b.format,"image/jpeg");this._tileDiscardPolicy=b.tileDiscardPolicy;this._tilingScheme=k(b.tilingScheme)?b.tilingScheme:new q({ellipsoid:b.ellipsoid});this._tileWidth=f(b.tileWidth,256);this._tileHeight=f(b.tileHeight,256);this._minimumLevel=f(b.minimumLevel,0);this._maximumLevel=b.maximumLevel;this._rectangle=f(b.rectangle,this._tilingScheme.rectangle);this._dimensions=b.dimensions;var u=this;this._reload=void 0;k(b.times)&&(this._timeDynamicImagery=new c({clock:b.clock,times:b.times,requestImageFunction:function(a,b,c,d,e){return y(u,a,b,c,d,e)},reloadFunction:function(){k(u._reload)&&u._reload()}}));this._readyPromise=t.resolve(!0);e=this._tilingScheme.positionToTileXY(p.southwest(this._rectangle),this._minimumLevel);g=this._tilingScheme.positionToTileXY(p.northeast(this._rectangle),this._minimumLevel);e=(Math.abs(g.x-e.x)+1)*(Math.abs(g.y-e.y)+1);if(4<e)throw new l("The imagery provider's rectangle and minimumLevel indicate that there are "+e+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");this._errorEvent=new m;e=b.credit;this._credit="string"===typeof e?new a(e):e;this._subdomains=b.subdomains;h(this._subdomains)?this._subdomains=this._subdomains.slice():k(this._subdomains)&&0<this._subdomains.length?this._subdomains=this._subdomains.split(""):this._subdomains=["a","b","c"]}function y(a,c,d,e,f,g){var h=a._tileMatrixLabels,l=k(h)?h[e]:e.toString(),m=a._subdomains,h=a._dimensions;g=k(g)?g.data:void 0;a._useKvp?(e={},e.tilematrix=l,e.layer=a._layer,e.style=a._style,e.tilerow=d,e.tilecol=c,e.tilematrixset=a._tileMatrixSetID,e.format=a._format,k(h)&&(e=b(e,h)),k(g)&&(e=b(e,g)),f=a._resource.getDerivedResource({queryParameters:e,request:f})):(c={TileMatrix:l,TileRow:d.toString(),TileCol:c.toString(),s:m[(c+d+e)%m.length]},f=a._resource.getDerivedResource({request:f}),f.setTemplateValues(c),k(h)&&f.setTemplateValues(h),k(g)&&f.setTemplateValues(g));return r.loadImage(a,f)}var A=e({service:"WMTS",version:"1.0.0",request:"GetTile"});g(u.prototype,{url:{get:function(){return this._resource.url}},proxy:{get:function(){return this._resource.proxy}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){return this._maximumLevel}},minimumLevel:{get:function(){return this._minimumLevel}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._rectangle}},tileDiscardPolicy:{get:function(){return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},format:{get:function(){return this._format}},ready:{value:!0},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!0}},clock:{get:function(){return this._timeDynamicImagery.clock},set:function(a){this._timeDynamicImagery.clock=a}},times:{get:function(){return this._timeDynamicImagery.times},set:function(a){this._timeDynamicImagery.times=a}},dimensions:{get:function(){return this._dimensions},set:function(a){this._dimensions!==a&&(this._dimensions=a,k(this._reload)&&this._reload())}}});u.prototype.getTileCredits=function(a,b,c){};u.prototype.requestImage=function(a,b,c,d){var e,f=this._timeDynamicImagery,g;k(f)&&(g=f.currentInterval,e=f.getFromCache(a,b,c,d));k(e)||(e=y(this,a,b,c,d,g));k(e)&&k(f)&&f.checkApproachingInterval(a,b,c,d);return e};u.prototype.pickFeatures=function(a,b,c,d,e){};return u});F("Scene/IonImageryProvider","../Core/Check ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/IonResource ../Core/RuntimeError ../ThirdParty/when ./ArcGisMapServerImageryProvider ./BingMapsImageryProvider ./createTileMapServiceImageryProvider ./GoogleEarthEnterpriseMapsProvider ./MapboxImageryProvider ./SingleTileImageryProvider ./UrlTemplateImageryProvider ./WebMapServiceImageryProvider ./WebMapTileServiceImageryProvider".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z){function x(a){return function(b){return new a(b)}}function D(a){a=f(a,f.EMPTY_OBJECT);var c=a.assetId;b.typeOf.number("options.assetId",c);this.defaultMagnificationFilter=this.defaultMinificationFilter=this.defaultGamma=this.defaultSaturation=this.defaultHue=this.defaultContrast=this.defaultBrightness=this.defaultAlpha=void 0;this._ready=!1;this._tileCredits=void 0;this._errorEvent=new m;var d=this,g=e._createEndpointResource(c,a);a=a.assetId.toString()+a.accessToken+a.server;var l=D._endpointCache[a];k(l)||(l=g.fetchJson(),D._endpointCache[a]=l);this._readyPromise=l.then(function(a){if("IMAGERY"!==a.type)return p.reject(new h("Cesium ion asset "+c+" is not an imagery asset."));var b;b=a.externalType;if(k(b)){var f=v[b];if(!k(f))return p.reject(new h("Unrecognized Cesium ion imagery type: "+b));b=f(a.options)}else b=t({url:new e(a,g)});d._tileCredits=e.getCreditsFromEndpoint(a,g);b.errorEvent.addEventListener(function(a){a.provider=d;d._errorEvent.raiseEvent(a)});d._imageryProvider=b;return b.readyPromise.then(function(){return d._ready=!0})})}var v={ARCGIS_MAPSERVER:x(d),BING:x(q),GOOGLE_EARTH:x(r),MAPBOX:x(c),SINGLE_TILE:x(u),TMS:t,URL_TEMPLATE:x(y),WMS:x(A),WMTS:x(z)};g(D.prototype,{ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},rectangle:{get:function(){if(!this._ready)throw new l("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.rectangle}},tileWidth:{get:function(){if(!this._ready)throw new l("tileWidth must not be called before the imagery provider is ready.");return this._imageryProvider.tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new l("tileHeight must not be called before the imagery provider is ready.");return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new l("maximumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new l("minimumLevel must not be called before the imagery provider is ready.");return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){if(!this._ready)throw new l("tilingScheme must not be called before the imagery provider is ready.");return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new l("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},credit:{get:function(){if(!this._ready)throw new l("credit must not be called before the imagery provider is ready.");return this._imageryProvider.credit}},hasAlphaChannel:{get:function(){if(!this._ready)throw new l("hasAlphaChannel must not be called before the imagery provider is ready.");return this._imageryProvider.hasAlphaChannel}}});D.prototype.getTileCredits=function(a,b,c){if(!this._ready)throw new l("getTileCredits must not be called before the imagery provider is ready.");a=this._imageryProvider.getTileCredits(a,b,c);return k(a)?this._tileCredits.concat(a):this._tileCredits};D.prototype.requestImage=function(a,b,c,d){if(!this._ready)throw new l("requestImage must not be called before the imagery provider is ready.");return this._imageryProvider.requestImage(a,b,c,d)};D.prototype.pickFeatures=function(a,b,c,d,e){if(!this._ready)throw new l("pickFeatures must not be called before the imagery provider is ready.");return this._imageryProvider.pickFeatures(a,b,c,d,e)};D._endpointCache={};return D});F("Scene/IonWorldImageryStyle",["../Core/freezeObject"],function(b){return b({AERIAL:2,AERIAL_WITH_LABELS:3,ROAD:4})});F("Scene/createWorldImagery",["./IonImageryProvider","./IonWorldImageryStyle","../Core/defaultValue"],function(b,a,f){return function(k){k=f(k,f.EMPTY_OBJECT);k=f(k.style,a.AERIAL);return new b({assetId:k})}});F("Scene/CreditDisplay","../Core/AssociativeArray ../Core/buildModuleUrl ../Core/Check ../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject".split(" "),function(b,a,f,k,g,l,m,e){function h(a){var b=document.createElement("span");b.textContent=a;b.className="cesium-credit-delimiter";return b}function p(a,b){if(l(b)){var c=document.createElement(b);c._creditId=a._creditId;c.appendChild(a);a=c}return a}function d(a,b,c,d){for(var e=a.childNodes,f=-1,g=0;g<b.length;++g){var k=b[g];if(l(k)){f=g;if(l(c)&&(f*=2,0<g)){var m=f-1;e.length<=m?a.appendChild(h(c)):(m=e[m],"cesium-credit-delimiter"!==m.className&&a.replaceChild(h(c),m))}m=k.element;if(e.length<=f)a.appendChild(p(m,d));else{var q=e[f];q._creditId!==k._id&&a.replaceChild(p(m,d),q)}}}for(++f;f<e.length;)a.removeChild(e[f])}function q(a,b){var c=a+" {",d;for(d in b)b.hasOwnProperty(d)&&(c+=d+": "+b[d]+"; ");return c+" }\n"}function t(){var a;a=""+q(".cesium-credit-lightbox-overlay",{display:"none","z-index":"1",position:"absolute",top:"0",left:"0",width:"100%",height:"100%","background-color":"rgba(80, 80, 80, 0.8)"});a+=q(".cesium-credit-lightbox",{"background-color":"#303336",color:"#ffffff",position:"relative","min-height":"100px",margin:"auto"});a+=q(".cesium-credit-lightbox \x3e ul \x3e li a, .cesium-credit-lightbox \x3e ul \x3e li a:visited",{color:"#ffffff"});a+=q(".cesium-credit-lightbox \x3e ul \x3e li a:hover",{color:"#48b"});a+=q(".cesium-credit-lightbox.cesium-credit-lightbox-expanded",{border:"1px solid #444","border-radius":"5px","max-width":"370px"});a+=q(".cesium-credit-lightbox.cesium-credit-lightbox-mobile",{height:"100%",width:"100%"});a+=q(".cesium-credit-lightbox-title",{padding:"20px 20px 0 20px"});a+=q(".cesium-credit-lightbox-close",{"font-size":"18pt",cursor:"pointer",position:"absolute",top:"0",right:"6px",color:"#ffffff"});a+=q(".cesium-credit-lightbox-close:hover",{color:"#48b"});a+=q(".cesium-credit-lightbox \x3e ul",{margin:"0",padding:"12px 20px 12px 40px","font-size":"13px"});a+=q(".cesium-credit-lightbox \x3e ul \x3e li",{"padding-bottom":"6px"});a+=q(".cesium-credit-lightbox \x3e ul \x3e li *",{padding:"0",margin:"0"});a+=q(".cesium-credit-expand-link",{"padding-left":"5px",cursor:"pointer","text-decoration":"underline",color:"#ffffff"});a+=q(".cesium-credit-expand-link:hover",{color:"#48b"});a+=q(".cesium-credit-text",{color:"#ffffff"});a+=q(".cesium-credit-textContainer *, .cesium-credit-logoContainer *",{display:"inline"});var b=document.head,c=document.createElement("style");c.innerHTML=a;b.insertBefore(c,b.firstChild)}function r(a,c,d){function e(a){m.contains(a.target)||h.hideLightbox()}f.defined("container",a);var h=this;d=g(d,document.body);var l=document.createElement("div");l.className="cesium-credit-lightbox-overlay";d.appendChild(l);var m=document.createElement("div");m.className="cesium-credit-lightbox";l.appendChild(m);l.addEventListener("click",e,!1);var p=document.createElement("div");p.className="cesium-credit-lightbox-title";p.textContent="Data provided by:";m.appendChild(p);p=document.createElement("a");p.onclick=this.hideLightbox.bind(this);p.innerHTML="\x26times;";p.className="cesium-credit-lightbox-close";m.appendChild(p);p=document.createElement("ul");m.appendChild(p);var q=document.createElement("div");q.className="cesium-credit-logoContainer";q.style.display="inline";a.appendChild(q);var u=document.createElement("div");u.className="cesium-credit-textContainer";u.style.display="inline";a.appendChild(u);var y=document.createElement("a");y.className="cesium-credit-expand-link";y.onclick=this.showLightbox.bind(this);y.textContent="Data attribution";a.appendChild(y);t();var w=k.clone(r.cesiumCredit);this._delimiter=g(c," \u2022 ");this._screenContainer=u;this._cesiumCreditContainer=q;this._lastViewportWidth=this._lastViewportHeight=void 0;this._lightboxCredits=m;this._creditList=p;this._lightbox=l;this._hideLightbox=e;this._expandLink=y;this._expanded=!1;this._defaultCredits=[];this._cesiumCredit=w;this._previousCesiumCredit=void 0;this._currentCesiumCredit=w;this._currentFrameCredits={screenCredits:new b,lightboxCredits:new b};this._defaultCredit=void 0;this.viewport=d;this.container=a}function c(){if(!l(u)){var b=a("Assets/Images/ion-credit.png");u=new k('\x3ca href\x3d"https://cesium.com/" target\x3d"_blank"\x3e\x3cimg src\x3d"'+b+'" title\x3d"Cesium ion"/\x3e\x3c/a\x3e',!0)}r._cesiumCreditInitialized||(r._cesiumCredit=u,r._cesiumCreditInitialized=!0);return u}r.prototype.addCredit=function(a){f.defined("credit",a);a._isIon?(l(this._defaultCredit)||(this._defaultCredit=k.clone(c())),this._currentCesiumCredit=this._defaultCredit):a.showOnScreen?this._currentFrameCredits.screenCredits.set(a.id,a):this._currentFrameCredits.lightboxCredits.set(a.id,a)};r.prototype.addDefaultCredit=function(a){f.defined("credit",a);var b=this._defaultCredits,c;a:{c=b.length;for(var d=0;d<c;d++)if(k.equals(b[d],a)){c=!0;break a}c=!1}c||b.push(a)};r.prototype.removeDefaultCredit=function(a){f.defined("credit",a);var b=this._defaultCredits;a=b.indexOf(a);-1!==a&&b.splice(a,1)};r.prototype.showLightbox=function(){this._lightbox.style.display="block";this._expanded=!0};r.prototype.hideLightbox=function(){this._lightbox.style.display="none";this._expanded=!1};r.prototype.update=function(){if(this._expanded){var a=this._lightboxCredits,b=this.viewport.clientWidth,c=this.viewport.clientHeight;b!==this._lastViewportWidth&&(576>b?(a.className="cesium-credit-lightbox cesium-credit-lightbox-mobile",a.style.marginTop="0"):(a.className="cesium-credit-lightbox cesium-credit-lightbox-expanded",a.style.marginTop=Math.floor(.5*(c-a.clientHeight))+"px"),this._lastViewportWidth=b);576<=b&&c!==this._lastViewportHeight&&(a.style.marginTop=Math.floor(.5*(c-a.clientHeight))+"px",this._lastViewportHeight=c)}};r.prototype.beginFrame=function(){var a=this._currentFrameCredits,b=a.screenCredits;b.removeAll();for(var c=this._defaultCredits,d=0;d<c.length;++d){var e=c[d];b.set(e.id,e)}a.lightboxCredits.removeAll();k.equals(r.cesiumCredit,this._cesiumCredit)||(this._cesiumCredit=k.clone(r.cesiumCredit));this._currentCesiumCredit=this._cesiumCredit};r.prototype.endFrame=function(){d(this._screenContainer,this._currentFrameCredits.screenCredits.values,this._delimiter,void 0);var a=this._currentFrameCredits.lightboxCredits.values;this._expandLink.style.display=0<a.length?"inline":"none";d(this._creditList,a,void 0,"li");var a=this._previousCesiumCredit,b=this._currentCesiumCredit;k.equals(b,a)||(l(a)&&this._cesiumCreditContainer.removeChild(a.element),l(b)&&this._cesiumCreditContainer.appendChild(b.element),this._previousCesiumCredit=b)};r.prototype.destroy=function(){this._lightbox.removeEventListener("click",this._hideLightbox,!1);this.container.removeChild(this._cesiumCreditContainer);this.container.removeChild(this._screenContainer);this.container.removeChild(this._expandLink);this.viewport.removeChild(this._lightbox);return e(this)};r.prototype.isDestroyed=function(){return!1};r._cesiumCredit=void 0;r._cesiumCreditInitialized=!1;var u;m(r,{cesiumCredit:{get:function(){c();return r._cesiumCredit},set:function(a){r._cesiumCredit=a;r._cesiumCreditInitialized=!0}}});return r});F("Scene/DebugAppearance",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","./Appearance"],function(b,a,f,k,g){function l(f){f=b(f,b.EMPTY_OBJECT);var e=f.attributeName,h=f.perInstanceAttribute;if(!a(e))throw new k("options.attributeName is required.");a(h)||(h=!1);var l=b(f.glslDatatype,"vec3"),d="v_"+e,m;if("normal"===e||"tangent"===e||"bitangent"===e)m="vec4 getColor() { return vec4(("+d+" + vec3(1.0)) * 0.5, 1.0); }\n";else switch("st"===e&&(l="vec2"),l){case "float":m="vec4 getColor() { return vec4(vec3("+d+"), 1.0); }\n";break;case "vec2":m="vec4 getColor() { return vec4("+d+", 0.0, 1.0); }\n";break;case "vec3":m="vec4 getColor() { return vec4("+d+", 1.0); }\n";break;case "vec4":m="vec4 getColor() { return "+d+"; }\n";break;default:throw new k("options.glslDatatype must be float, vec2, vec3, or vec4.");}h="attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute float batchId;\n"+(h?"":"attribute "+l+" "+e+";\n")+"varying "+l+" "+d+";\nvoid main()\n{\nvec4 p \x3d czm_translateRelativeToEye(position3DHigh, position3DLow);\n"+(h?d+" \x3d czm_batchTable_"+e+"(batchId);\n":d+" \x3d "+e+";\n")+"gl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}";d="varying "+l+" "+d+";\n"+m+"\nvoid main()\n{\ngl_FragColor \x3d getColor();\n}";this.material=void 0;this.translucent=b(f.translucent,!1);this._vertexShaderSource=b(f.vertexShaderSource,h);this._fragmentShaderSource=b(f.fragmentShaderSource,d);this._renderState=g.getDefaultRenderState(!1,!1,f.renderState);this._closed=b(f.closed,!1);this._attributeName=e;this._glslDatatype=l}f(l.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},attributeName:{get:function(){return this._attributeName}},glslDatatype:{get:function(){return this._glslDatatype}}});l.prototype.getFragmentShaderSource=g.prototype.getFragmentShaderSource;l.prototype.isTranslucent=g.prototype.isTranslucent;l.prototype.getRenderState=g.prototype.getRenderState;return l});F("Scene/DebugCameraPrimitive","../Core/Cartesian3 ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/FrustumGeometry ../Core/FrustumOutlineGeometry ../Core/GeometryInstance ../Core/Matrix3 ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Core/PerspectiveFrustum ../Core/PerspectiveOffCenterFrustum ../Core/Quaternion ./PerInstanceColorAppearance ./Primitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(b){b=k(b,k.EMPTY_OBJECT);if(!g(b.camera))throw new m("options.camera is required.");this._camera=b.camera;this._color=k(b.color,a.CYAN);this._updateOnChange=k(b.updateOnChange,!0);this.show=k(b.show,!0);this.id=b.id;this._id=void 0;this._outlinePrimitives=[];this._planesPrimitives=[]}var x=new b,D=new d,v=new u,B=new r,C=new c,I=new q,H=new t,J=new a,w=[1,1E5];z.prototype.update=function(g){if(this.show){var k=this._planesPrimitives,l=this._outlinePrimitives,m,t;if(this._updateOnChange){t=k.length;for(m=0;m<t;++m)l[m]=l[m]&&l[m].destroy(),k[m]=k[m]&&k[m].destroy();k.length=0;l.length=0}if(0===k.length){m=this._camera;var z=m.frustum;t=z instanceof r?B:z instanceof c?C:z instanceof q?I:H;t=z.clone(t);var z=g.frustumSplits,G=z.length-1;0>=G&&(z=w,z[0]=this._camera.frustum.near,z[1]=this._camera.frustum.far,G=1);var F=m.positionWC,aa=m.directionWC,U=m.upWC;m=m.rightWC;m=b.negate(m,x);d.setColumn(D,0,m,D);d.setColumn(D,1,U,D);d.setColumn(D,2,aa,D);aa=u.fromRotationMatrix(D,v);k.length=l.length=G;for(m=0;m<G;++m)t.near=z[m],t.far=z[m+1],k[m]=new A({geometryInstances:new p({geometry:new e({origin:F,orientation:aa,frustum:t,_drawNearPlane:0===m}),attributes:{color:f.fromColor(a.fromAlpha(this._color,.1,J))},id:this.id,pickPrimitive:this}),appearance:new y({translucent:!0,flat:!0}),asynchronous:!1}),l[m]=new A({geometryInstances:new p({geometry:new h({origin:F,orientation:aa,frustum:t,_drawNearPlane:0===m}),attributes:{color:f.fromColor(this._color)},id:this.id,pickPrimitive:this}),appearance:new y({translucent:!1,flat:!0}),asynchronous:!1})}t=k.length;for(m=0;m<t;++m)l[m].update(g),k[m].update(g)}};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){for(var a=this._planesPrimitives.length,b=0;b<a;++b)this._outlinePrimitives[b]=this._outlinePrimitives[b]&&this._outlinePrimitives[b].destroy(),this._planesPrimitives[b]=this._planesPrimitives[b]&&this._planesPrimitives[b].destroy();return l(this)};return z});F("Scene/DebugModelMatrixPrimitive","../Core/ArcType ../Core/Cartesian3 ../Core/Color ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/GeometryInstance ../Core/Matrix4 ../Core/PolylineGeometry ./PolylineColorAppearance ./Primitive".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a){a=k(a,k.EMPTY_OBJECT);this.length=k(a.length,1E7);this._length=void 0;this.width=k(a.width,2);this._width=void 0;this.show=k(a.show,!0);this.modelMatrix=e.clone(k(a.modelMatrix,e.IDENTITY));this._modelMatrix=new e;this.id=a.id;this._primitive=this._id=void 0}q.prototype.update=function(k){if(this.show){if(!g(this._primitive)||!e.equals(this._modelMatrix,this.modelMatrix)||this._length!==this.length||this._width!==this.width||this._id!==this.id){this._modelMatrix=e.clone(this.modelMatrix,this._modelMatrix);this._length=this.length;
this._width=this.width;this._id=this.id;g(this._primitive)&&this._primitive.destroy();0===this.modelMatrix[12]&&0===this.modelMatrix[13]&&0===this.modelMatrix[14]&&(this.modelMatrix[14]=.01);var l=new m({geometry:new h({positions:[a.ZERO,a.UNIT_X],width:this.width,vertexFormat:p.VERTEX_FORMAT,colors:[f.RED,f.RED],arcType:b.NONE}),modelMatrix:e.multiplyByUniformScale(this.modelMatrix,this.length,new e),id:this.id,pickPrimitive:this}),c=new m({geometry:new h({positions:[a.ZERO,a.UNIT_Y],width:this.width,vertexFormat:p.VERTEX_FORMAT,colors:[f.GREEN,f.GREEN],arcType:b.NONE}),modelMatrix:e.multiplyByUniformScale(this.modelMatrix,this.length,new e),id:this.id,pickPrimitive:this}),q=new m({geometry:new h({positions:[a.ZERO,a.UNIT_Z],width:this.width,vertexFormat:p.VERTEX_FORMAT,colors:[f.BLUE,f.BLUE],arcType:b.NONE}),modelMatrix:e.multiplyByUniformScale(this.modelMatrix,this.length,new e),id:this.id,pickPrimitive:this});this._primitive=new d({geometryInstances:[l,c,q],appearance:new p,asynchronous:!1})}this._primitive.update(k)}};q.prototype.isDestroyed=function(){return!1};q.prototype.destroy=function(){this._primitive=this._primitive&&this._primitive.destroy();return l(this)};return q});F("Shaders/DepthPlaneFS",[],function(){return"varying vec4 positionEC;\nvoid main()\n{\nvec3 direction \x3d normalize(positionEC.xyz);\nczm_ray ray \x3d czm_ray(vec3(0.0), direction);\nvec3 ellipsoid_center \x3d czm_view[3].xyz;\nczm_raySegment intersection \x3d czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\nif (!czm_isEmpty(intersection))\n{\ngl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\n}\nelse\n{\ndiscard;\n}\nczm_writeLogDepth();\n}\n"});F("Shaders/DepthPlaneVS",[],function(){return"attribute vec4 position;\nvarying vec4 positionEC;\nvoid main()\n{\npositionEC \x3d czm_modelView * position;\ngl_Position \x3d czm_projection * positionEC;\nczm_vertexLogDepth();\n}\n"});F("Scene/DepthPlane","../Core/BoundingSphere ../Core/Cartesian3 ../Core/ComponentDatatype ../Core/defined ../Core/FeatureDetection ../Core/Geometry ../Core/GeometryAttribute ../Core/PrimitiveType ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Shaders/DepthPlaneFS ../Shaders/DepthPlaneVS ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(){this._mode=this._command=this._va=this._sp=this._rs=void 0;this._useLogDepth=!1}var x=g.supportsTypedArrays()?new Float32Array(12):[],D=new a,v=new a,B=new a,C=new a;z.prototype.update=function(g){this._mode=g.mode;if(g.mode===A.SCENE3D){var z=g.context,I=g.mapProjection.ellipsoid,w=g.useLogDepth;k(this._command)||(this._rs=q.fromCache({cull:{enabled:!0},depthTest:{enabled:!0},colorMask:{red:!1,green:!1,blue:!1,alpha:!1}}),this._command=new p({renderState:this._rs,boundingVolume:new b(a.ZERO,I.maximumRadius),pass:d.OPAQUE,owner:this}));if(!k(this._sp)||this._useLogDepth!==w){this._useLogDepth=w;var G=new r({sources:[y]}),E=new r({sources:[u]});w&&(E.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n"),E.defines.push("LOG_DEPTH"),G.defines.push("LOG_DEPTH"),G.defines.push("DISABLE_GL_POSITION_LOG_DEPTH"));this._sp=t.replaceCache({shaderProgram:this._sp,context:z,vertexShaderSource:G,fragmentShaderSource:E,attributeLocations:{position:0}});this._command.shaderProgram=this._sp}var w=I.radii,L=a.multiplyComponents(I.oneOverRadii,g.camera.positionWC,D),E=a.magnitude(L);g=a.normalize(L,v);G=a.normalize(a.cross(a.UNIT_Z,L,B),B);I=a.normalize(a.cross(g,G,C),C);L=Math.sqrt(a.magnitudeSquared(L)-1);g=a.multiplyByScalar(g,1/E,D);E=L/E;G=a.multiplyByScalar(G,E,v);I=a.multiplyByScalar(I,E,B);E=a.add(g,I,C);a.subtract(E,G,E);a.multiplyComponents(w,E,E);a.pack(E,x,0);E=a.subtract(g,I,C);a.subtract(E,G,E);a.multiplyComponents(w,E,E);a.pack(E,x,3);E=a.add(g,I,C);a.add(E,G,E);a.multiplyComponents(w,E,E);a.pack(E,x,6);g=a.subtract(g,I,C);a.add(g,G,g);a.multiplyComponents(w,g,g);a.pack(g,x,9);k(this._va)?this._va.getAttribute(0).vertexBuffer.copyFromArrayView(x):(w=new l({attributes:{position:new m({componentDatatype:f.FLOAT,componentsPerAttribute:3,values:x})},indices:[0,1,2,2,1,3],primitiveType:e.TRIANGLES}),this._va=c.fromGeometry({context:z,geometry:w,attributeLocations:{position:0},bufferUsage:h.DYNAMIC_DRAW}),this._command.vertexArray=this._va)}};z.prototype.execute=function(a,b){this._mode===A.SCENE3D&&this._command.execute(a,b)};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy();this._va=this._va&&this._va.destroy()};return z});F("Scene/DerivedCommand",["../Core/defaultValue","../Core/defined","../Renderer/DrawCommand","../Renderer/RenderState","../Renderer/ShaderSource"],function(b,a,f,k,g){function l(){}var m=/\bgl_FragDepthEXT\b/,e=/\bdiscard\b/;l.createDepthOnlyDerivedCommand=function(b,d,h,c){a(c)||(c={});var l,p;a(c.depthOnlyCommand)&&(l=c.depthOnlyCommand.shaderProgram,p=c.depthOnlyCommand.renderState);c.depthOnlyCommand=f.shallowClone(d,c.depthOnlyCommand);if(a(l)&&c.shaderProgramId===d.shaderProgram.id)c.depthOnlyCommand.shaderProgram=l,c.depthOnlyCommand.renderState=p;else{l=c.depthOnlyCommand;p=d.shaderProgram;var q=h.shaderCache.getDerivedShaderProgram(p,"depthOnly");if(!a(q)){var q=p._attributeLocations,r=p.fragmentShaderSource,t,D=!1,v=r.sources,B=v.length;for(t=0;t<B;++t)if(m.test(v[t])||e.test(v[t])){D=!0;break}var v=!1,C=r.defines,B=C.length;for(t=0;t<B;++t)if("LOG_DEPTH"===C[t]){v=!0;break}D||v?!D&&v&&(r=new g({defines:["LOG_DEPTH"],sources:["#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\nvoid main() \n{ \n    gl_FragColor \x3d vec4(1.0); \n    czm_writeLogDepth(); \n} \n"]})):r=new g({sources:["void main() \n{ \n    gl_FragColor \x3d vec4(1.0); \n} \n"]});q=h.shaderCache.createDerivedShaderProgram(p,"depthOnly",{vertexShaderSource:p.vertexShaderSource,fragmentShaderSource:r,attributeLocations:q})}l.shaderProgram=q;h=c.depthOnlyCommand;l=d.renderState;b=b._depthOnlyRenderStateCache;p=b[l.id];a(p)||(p=k.getState(l),p.depthMask=!0,p.colorMask={red:!1,green:!1,blue:!1,alpha:!1},p=k.fromCache(p),b[l.id]=p);h.renderState=p;c.shaderProgramId=d.shaderProgram.id}return c};var h=/\s+czm_writeLogDepth\(/,p=/\s+czm_vertexLogDepth\(/,d=/\s*#extension\s+GL_EXT_frag_depth\s*:\s*enable/;l.createLogDepthCommand=function(b,e,k){a(k)||(k={});var c;a(k.command)&&(c=k.command.shaderProgram);k.command=f.shallowClone(b,k.command);if(a(c)&&k.shaderProgramId===b.shaderProgram.id)k.command.shaderProgram=c;else{c=k.command;var l=b.shaderProgram,m=e.shaderCache.getDerivedShaderProgram(l,"logDepth");if(!a(m)){var m=l._attributeLocations,q=l.vertexShaderSource.clone(),r=l.fragmentShaderSource.clone();q.defines=a(q.defines)?q.defines.slice(0):[];q.defines.push("LOG_DEPTH");r.defines=a(r.defines)?r.defines.slice(0):[];r.defines.push("LOG_DEPTH");var t,D=!1,v=q.sources,B=v.length;for(t=0;t<B;++t)if(p.test(v[t])){D=!0;break}if(!D){for(t=0;t<B;++t)v[t]=g.replaceMain(v[t],"czm_log_depth_main");v.push("\n\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_vertexLogDepth(); \n} \n")}var C=!0,D=!1,v=r.sources,B=v.length;for(t=0;t<B;++t)h.test(v[t])&&(D=!0),d.test(v[t])&&(C=!1);var I="";C&&(I+="#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n");if(!D){for(t=0;t<B;t++)v[t]=g.replaceMain(v[t],"czm_log_depth_main");I+="\nvoid main() \n{ \n    czm_log_depth_main(); \n    czm_writeLogDepth(); \n} \n"}v.push(I);m=e.shaderCache.createDerivedShaderProgram(l,"logDepth",{vertexShaderSource:q,fragmentShaderSource:r,attributeLocations:m})}c.shaderProgram=m;k.shaderProgramId=b.shaderProgram.id}return k};l.createPickDerivedCommand=function(b,d,e,c){a(c)||(c={});var h,l;a(c.pickCommand)&&(h=c.pickCommand.shaderProgram,l=c.pickCommand.renderState);c.pickCommand=f.shallowClone(d,c.pickCommand);if(a(h)&&c.shaderProgramId===d.shaderProgram.id)c.pickCommand.shaderProgram=h,c.pickCommand.renderState=l;else{h=c.pickCommand;l=d.shaderProgram;var m=d.pickId,p=e.shaderCache.getDerivedShaderProgram(l,"pick");if(!a(p)){for(var p=l._attributeLocations,q=l.fragmentShaderSource,r=q.sources,t=r.length,m="void main() \n{ \n    czm_non_pick_main(); \n    if (gl_FragColor.a \x3d\x3d 0.0) { \n        discard; \n    } \n    gl_FragColor \x3d "+m+"; \n} \n",B=Array(t+1),C=0;C<t;++C)B[C]=g.replaceMain(r[C],"czm_non_pick_main");B[t]=m;q=new g({sources:B,defines:q.defines});p=e.shaderCache.createDerivedShaderProgram(l,"pick",{vertexShaderSource:l.vertexShaderSource,fragmentShaderSource:q,attributeLocations:p})}h.shaderProgram=p;e=c.pickCommand;h=d.renderState;b=b._pickRenderStateCache;l=b[h.id];a(l)||(l=k.getState(h),l.blending.enabled=!1,l.depthMask=!0,l=k.fromCache(l),b[h.id]=l);e.renderState=l;c.shaderProgramId=d.shaderProgram.id}return c};l.createHdrCommand=function(b,d,e){a(e)||(e={});var c;a(e.command)&&(c=e.command.shaderProgram);e.command=f.shallowClone(b,e.command);if(a(c)&&e.shaderProgramId===b.shaderProgram.id)e.command.shaderProgram=c;else{c=e.command;var g=b.shaderProgram,h=d.shaderCache.getDerivedShaderProgram(g,"HDR");if(!a(h)){var h=g._attributeLocations,k=g.vertexShaderSource.clone(),l=g.fragmentShaderSource.clone();k.defines=a(k.defines)?k.defines.slice(0):[];k.defines.push("HDR");l.defines=a(l.defines)?l.defines.slice(0):[];l.defines.push("HDR");h=d.shaderCache.createDerivedShaderProgram(g,"HDR",{vertexShaderSource:k,fragmentShaderSource:l,attributeLocations:h})}c.shaderProgram=h;e.shaderProgramId=b.shaderProgram.id}return e};return l});F("Scene/DeviceOrientationCameraController","../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/Math ../Core/Matrix3 ../Core/Quaternion".split(" "),function(b,a,f,k,g,l){function m(a){function d(a){var c=a.alpha;b(c)?(e._alpha=k.toRadians(c),e._beta=k.toRadians(a.beta),e._gamma=k.toRadians(a.gamma)):(e._alpha=void 0,e._beta=void 0,e._gamma=void 0)}if(!b(a))throw new f("scene is required.");this._scene=a;this._gamma=this._beta=this._alpha=this._lastGamma=this._lastBeta=this._lastAlpha=void 0;var e=this;window.addEventListener("deviceorientation",d,!1);this._removeListener=function(){window.removeEventListener("deviceorientation",d,!1)}}var e=new l,h=new l,p=new g;m.prototype.update=function(){if(b(this._alpha)){b(this._lastAlpha)||(this._lastAlpha=this._alpha,this._lastBeta=this._beta,this._lastGamma=this._gamma);var a=this._scene.camera,f=-(this._lastAlpha-this._alpha),k=this._lastGamma-this._gamma,m=a.direction,c=a.right,a=a.up,u=l.fromAxisAngle(m,this._lastBeta-this._beta,h),k=l.fromAxisAngle(c,k,e),k=l.multiply(k,u,k),f=l.fromAxisAngle(a,f,h);l.multiply(f,k,k);f=g.fromQuaternion(k,p);g.multiplyByVector(f,c,c);g.multiplyByVector(f,a,a);g.multiplyByVector(f,m,m);this._lastAlpha=this._alpha;this._lastBeta=this._beta;this._lastGamma=this._gamma}};m.prototype.isDestroyed=function(){return!1};m.prototype.destroy=function(){this._removeListener();return a(this)};return m});F("Shaders/EllipsoidFS",[],function(){return"#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\n#extension GL_EXT_frag_depth : enable\n#endif\n#endif\nuniform vec3 u_radii;\nuniform vec3 u_oneOverEllipsoidRadiiSquared;\nvarying vec3 v_positionEC;\nvec4 computeEllipsoidColor(czm_ray ray, float intersection, float side)\n{\nvec3 positionEC \x3d czm_pointAlongRay(ray, intersection);\nvec3 positionMC \x3d (czm_inverseModelView * vec4(positionEC, 1.0)).xyz;\nvec3 geodeticNormal \x3d normalize(czm_geodeticSurfaceNormal(positionMC, vec3(0.0), u_oneOverEllipsoidRadiiSquared));\nvec3 sphericalNormal \x3d normalize(positionMC / u_radii);\nvec3 normalMC \x3d geodeticNormal * side;\nvec3 normalEC \x3d normalize(czm_normal * normalMC);\nvec2 st \x3d czm_ellipsoidWgs84TextureCoordinates(sphericalNormal);\nvec3 positionToEyeEC \x3d -positionEC;\nczm_materialInput materialInput;\nmaterialInput.s \x3d st.s;\nmaterialInput.st \x3d st;\nmaterialInput.str \x3d (positionMC + u_radii) / u_radii;\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.tangentToEyeMatrix \x3d czm_eastNorthUpToEyeCoordinates(positionMC, normalEC);\nmaterialInput.positionToEyeEC \x3d positionToEyeEC;\nczm_material material \x3d czm_getMaterial(materialInput);\n#ifdef ONLY_SUN_LIGHTING\nreturn czm_private_phong(normalize(positionToEyeEC), material);\n#else\nreturn czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\nvoid main()\n{\nfloat maxRadius \x3d max(u_radii.x, max(u_radii.y, u_radii.z)) * 1.5;\nvec3 direction \x3d normalize(v_positionEC);\nvec3 ellipsoidCenter \x3d czm_modelView[3].xyz;\nfloat t1 \x3d -1.0;\nfloat t2 \x3d -1.0;\nfloat b \x3d -2.0 * dot(direction, ellipsoidCenter);\nfloat c \x3d dot(ellipsoidCenter, ellipsoidCenter) - maxRadius * maxRadius;\nfloat discriminant \x3d b * b - 4.0 * c;\nif (discriminant \x3e\x3d 0.0) {\nt1 \x3d (-b - sqrt(discriminant)) * 0.5;\nt2 \x3d (-b + sqrt(discriminant)) * 0.5;\n}\nif (t1 \x3c 0.0 \x26\x26 t2 \x3c 0.0) {\ndiscard;\n}\nfloat t \x3d min(t1, t2);\nif (t \x3c 0.0) {\nt \x3d 0.0;\n}\nczm_ray ray \x3d czm_ray(t * direction, direction);\nvec3 ellipsoid_inverseRadii \x3d vec3(1.0 / u_radii.x, 1.0 / u_radii.y, 1.0 / u_radii.z);\nczm_raySegment intersection \x3d czm_rayEllipsoidIntersectionInterval(ray, ellipsoidCenter, ellipsoid_inverseRadii);\nif (czm_isEmpty(intersection))\n{\ndiscard;\n}\nvec4 outsideFaceColor \x3d (intersection.start !\x3d 0.0) ? computeEllipsoidColor(ray, intersection.start, 1.0) : vec4(0.0);\nvec4 insideFaceColor \x3d (outsideFaceColor.a \x3c 1.0) ? computeEllipsoidColor(ray, intersection.stop, -1.0) : vec4(0.0);\ngl_FragColor \x3d mix(insideFaceColor, outsideFaceColor, outsideFaceColor.a);\ngl_FragColor.a \x3d 1.0 - (1.0 - insideFaceColor.a) * (1.0 - outsideFaceColor.a);\n#ifdef WRITE_DEPTH\n#ifdef GL_EXT_frag_depth\nt \x3d (intersection.start !\x3d 0.0) ? intersection.start : intersection.stop;\nvec3 positionEC \x3d czm_pointAlongRay(ray, t);\nvec4 positionCC \x3d czm_projection * vec4(positionEC, 1.0);\n#ifdef LOG_DEPTH\nczm_writeLogDepth(1.0 + positionCC.w);\n#else\nfloat z \x3d positionCC.z / positionCC.w;\nfloat n \x3d czm_depthRange.near;\nfloat f \x3d czm_depthRange.far;\ngl_FragDepthEXT \x3d (z * (f - n) + f + n) * 0.5;\n#endif\n#endif\n#endif\n}\n"});F("Shaders/EllipsoidVS",[],function(){return"attribute vec3 position;\nuniform vec3 u_radii;\nvarying vec3 v_positionEC;\nvoid main()\n{\nvec4 p \x3d vec4(u_radii * position, 1.0);\nv_positionEC \x3d (czm_modelView * p).xyz;\ngl_Position \x3d czm_modelViewProjection * p;\ngl_Position.z \x3d clamp(gl_Position.z, czm_depthRange.near, czm_depthRange.far);\nczm_vertexLogDepth();\n}\n"});F("Scene/EllipsoidPrimitive","../Core/BoundingSphere ../Core/BoxGeometry ../Core/Cartesian3 ../Core/combine ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/Matrix4 ../Core/VertexFormat ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Shaders/EllipsoidFS ../Shaders/EllipsoidVS ./BlendingState ./CullFace ./Material ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B){function C(a){a=g(a,g.EMPTY_OBJECT);this.center=f.clone(g(a.center,f.ZERO));this._center=new f;this.radii=f.clone(a.radii);this._radii=new f;this._oneOverEllipsoidRadiiSquared=new f;this._boundingSphere=new b;this.modelMatrix=h.clone(g(a.modelMatrix,h.IDENTITY));this._modelMatrix=new h;this._computedModelMatrix=new h;this.show=g(a.show,!0);this.material=g(a.material,v.fromType(v.ColorType));this._translucent=this._material=void 0;this.id=a.id;this._id=void 0;this.debugShowBoundingVolume=g(a.debugShowBoundingVolume,!1);this.onlySunLighting=g(a.onlySunLighting,!1);this._onlySunLighting=!1;this._depthTestEnabled=g(a.depthTestEnabled,!0);this._useLogDepth=!1;this._pickId=this._pickSP=this._va=this._rs=this._sp=void 0;this._colorCommand=new q({owner:g(a._owner,this)});this._pickCommand=new q({owner:g(a._owner,this),pickOnly:!0});var c=this;this._uniforms={u_radii:function(){return c.radii},u_oneOverEllipsoidRadiiSquared:function(){return c._oneOverEllipsoidRadiiSquared}};this._pickUniforms={czm_pickColor:function(){return c._pickId.color}}}var I={position:0};C.prototype.update=function(g){if(this.show&&g.mode===B.SCENE3D&&l(this.center)&&l(this.radii)){if(!l(this.material))throw new e("this.material must be defined.");var m=g.context,q=this.material.isTranslucent(),v=this._translucent!==q;if(!l(this._rs)||v)this._translucent=q,this._rs=r.fromCache({cull:{enabled:!0,face:D.FRONT},depthTest:{enabled:this._depthTestEnabled},depthMask:!q&&m.fragmentDepth,blending:q?x.ALPHA_BLEND:void 0});if(!l(this._va)){var E=m.cache.ellipsoidPrimitive_vertexArray;l(E)||(E=a.createGeometry(a.fromDimensions({dimensions:new f(2,2,2),vertexFormat:p.POSITION_ONLY})),E=y.fromGeometry({context:m,geometry:E,attributeLocations:I,bufferUsage:d.STATIC_DRAW,interleave:!0}),m.cache.ellipsoidPrimitive_vertexArray=E);this._va=E}var C=!1,E=this.radii;f.equals(this._radii,E)||(f.clone(E,this._radii),C=this._oneOverEllipsoidRadiiSquared,C.x=1/(E.x*E.x),C.y=1/(E.y*E.y),C.z=1/(E.z*E.z),C=!0);h.equals(this.modelMatrix,this._modelMatrix)&&f.equals(this.center,this._center)||(h.clone(this.modelMatrix,this._modelMatrix),f.clone(this.center,this._center),h.multiplyByTranslation(this.modelMatrix,this.center,this._computedModelMatrix),C=!0);C&&(f.clone(f.ZERO,this._boundingSphere.center),this._boundingSphere.radius=f.maximumComponent(E),b.transform(this._boundingSphere,this._computedModelMatrix,this._boundingSphere));E=this._material!==this.material;this._material=this.material;this._material.update(m);C=this.onlySunLighting!==this._onlySunLighting;this._onlySunLighting=this.onlySunLighting;var H=g.useLogDepth,F=this._useLogDepth!==H;this._useLogDepth=H;var H=this._colorCommand,N,O;if(E||C||v||F)N=new u({sources:[z]}),O=new u({sources:[this.material.shaderSource,A]}),this.onlySunLighting&&O.defines.push("ONLY_SUN_LIGHTING"),!q&&m.fragmentDepth&&O.defines.push("WRITE_DEPTH"),this._useLogDepth&&(N.defines.push("LOG_DEPTH","DISABLE_GL_POSITION_LOG_DEPTH"),O.defines.push("LOG_DEPTH"),O.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n")),this._sp=c.replaceCache({context:m,shaderProgram:this._sp,vertexShaderSource:N,fragmentShaderSource:O,attributeLocations:I}),H.vertexArray=this._va,H.renderState=this._rs,H.shaderProgram=this._sp,H.uniformMap=k(this._uniforms,this.material._uniforms),H.executeInClosestFrustum=q;v=g.commandList;g=g.passes;g.render&&(H.boundingVolume=this._boundingSphere,H.debugShowBoundingVolume=this.debugShowBoundingVolume,H.modelMatrix=this._computedModelMatrix,H.pass=q?t.TRANSLUCENT:t.OPAQUE,v.push(H));if(g.pick){g=this._pickCommand;l(this._pickId)&&this._id===this.id||(this._id=this.id,this._pickId=this._pickId&&this._pickId.destroy(),this._pickId=m.createPickId({primitive:this,id:this.id}));if(E||C||!l(this._pickSP)||F)N=new u({sources:[z]}),O=new u({sources:[this.material.shaderSource,A],pickColorQualifier:"uniform"}),this.onlySunLighting&&O.defines.push("ONLY_SUN_LIGHTING"),!q&&m.fragmentDepth&&O.defines.push("WRITE_DEPTH"),this._useLogDepth&&(N.defines.push("LOG_DEPTH"),O.defines.push("LOG_DEPTH"),O.sources.push("#ifdef GL_EXT_frag_depth \n#extension GL_EXT_frag_depth : enable \n#endif \n\n")),this._pickSP=c.replaceCache({context:m,shaderProgram:this._pickSP,vertexShaderSource:N,fragmentShaderSource:O,attributeLocations:I}),g.vertexArray=this._va,g.renderState=this._rs,g.shaderProgram=this._pickSP,g.uniformMap=k(k(this._uniforms,this._pickUniforms),this.material._uniforms),g.executeInClosestFrustum=q;g.boundingVolume=this._boundingSphere;g.modelMatrix=this._computedModelMatrix;g.pass=q?t.TRANSLUCENT:t.OPAQUE;v.push(g)}}};C.prototype.isDestroyed=function(){return!1};C.prototype.destroy=function(){this._sp=this._sp&&this._sp.destroy();this._pickSP=this._pickSP&&this._pickSP.destroy();this._pickId=this._pickId&&this._pickId.destroy();return m(this)};return C});F("Shaders/Appearances/EllipsoidSurfaceAppearanceFS",[],function(){return"varying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nczm_materialInput materialInput;\nvec3 normalEC \x3d normalize(czm_normal3D * czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0)));\n#ifdef FACE_FORWARD\nnormalEC \x3d faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n#endif\nmaterialInput.s \x3d v_st.s;\nmaterialInput.st \x3d v_st;\nmaterialInput.str \x3d vec3(v_st, 0.0);\nmaterialInput.normalEC \x3d normalEC;\nmaterialInput.tangentToEyeMatrix \x3d czm_eastNorthUpToEyeCoordinates(v_positionMC, materialInput.normalEC);\nvec3 positionToEyeEC \x3d -v_positionEC;\nmaterialInput.positionToEyeEC \x3d positionToEyeEC;\nczm_material material \x3d czm_getMaterial(materialInput);\n#ifdef FLAT\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n#else\ngl_FragColor \x3d czm_phong(normalize(positionToEyeEC), material);\n#endif\n}\n"});F("Shaders/Appearances/EllipsoidSurfaceAppearanceVS",[],function(){return"attribute vec3 position3DHigh;\nattribute vec3 position3DLow;\nattribute vec2 st;\nattribute float batchId;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec2 v_st;\nvoid main()\n{\nvec4 p \x3d czm_computePosition();\nv_positionMC \x3d position3DHigh + position3DLow;\nv_positionEC \x3d (czm_modelViewRelativeToEye * p).xyz;\nv_st \x3d st;\ngl_Position \x3d czm_modelViewProjectionRelativeToEye * p;\n}\n"});F("Scene/EllipsoidSurfaceAppearance","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/VertexFormat ../Shaders/Appearances/EllipsoidSurfaceAppearanceFS ../Shaders/Appearances/EllipsoidSurfaceAppearanceVS ./Appearance ./Material".split(" "),function(b,a,f,k,g,l,m,e){function h(f){f=b(f,b.EMPTY_OBJECT);var d=b(f.translucent,!0),h=b(f.aboveGround,!1);this.material=a(f.material)?f.material:e.fromType(e.ColorType);this.translucent=b(f.translucent,!0);this._vertexShaderSource=b(f.vertexShaderSource,l);this._fragmentShaderSource=b(f.fragmentShaderSource,g);this._renderState=m.getDefaultRenderState(d,!h,f.renderState);this._closed=!1;this._flat=b(f.flat,!1);this._faceForward=b(f.faceForward,h);this._aboveGround=h}f(h.prototype,{vertexShaderSource:{get:function(){return this._vertexShaderSource}},fragmentShaderSource:{get:function(){return this._fragmentShaderSource}},renderState:{get:function(){return this._renderState}},closed:{get:function(){return this._closed}},vertexFormat:{get:function(){return h.VERTEX_FORMAT}},flat:{get:function(){return this._flat}},faceForward:{get:function(){return this._faceForward}},aboveGround:{get:function(){return this._aboveGround}}});h.VERTEX_FORMAT=k.POSITION_AND_ST;h.prototype.getFragmentShaderSource=m.prototype.getFragmentShaderSource;h.prototype.isTranslucent=m.prototype.isTranslucent;h.prototype.getRenderState=m.prototype.getRenderState;return h});F("Scene/Fog",["../Core/Cartesian3","../Core/defined","../Core/Math","./SceneMode"],function(b,a,f,k){function g(){this.enabled=!0;this.density=2E-4;this.screenSpaceErrorFactor=2;this.minimumBrightness=.03}function l(a){var b=m,d=b.length;if(a<b[0])return q=0;if(a>b[d-1])return q=d-2;if(a>=b[q]){if(q+1<d&&a<b[q+1])return q;if(q+2<d&&a<b[q+2])return++q,q}else if(0<=q-1&&a>=b[q-1])return--q,q;var e;for(e=0;e<d-2&&!(a>=b[e]&&a<b[e+1]);++e);return q=e}for(var m=[359.393,800.749,1275.6501,2151.1192,3141.7763,4777.5198,6281.2493,12364.307,15900.765,49889.0549,78026.8259,99260.7344,120036.3873,151011.0158,156091.1953,203849.3112,274866.9803,319916.3149,493552.0528,628733.5874],e=[2E-5,2E-4,1E-4,7E-5,5E-5,4E-5,3E-5,1.9E-5,1E-5,8.5E-6,6.2E-6,5.8E-6,5.3E-6,5.2E-6,5.1E-6,4.2E-6,4E-6,3.4E-6,2.6E-6,2.2E-6],h=0;h<e.length;++h)e[h]*=1E6;for(var p=e[1],d=e[e.length-1],h=0;h<e.length;++h)e[h]=(e[h]-d)/(p-d);var q=0,t=new b;g.prototype.update=function(g){if(g.fog.enabled=this.enabled){var c=g.camera,h=c.positionCartographic;if(!a(h)||8E5<h.height||g.mode!==k.SCENE3D)g.fog.enabled=!1;else{var q=h.height,h=l(q),q=f.clamp((q-m[h])/(m[h+1]-m[h]),0,1),h=f.lerp(e[h],e[h+1],q),q=1E6*this.density,h=h*(q-q/p*d)*1E-6,q=b.normalize(c.positionWC,t),c=Math.abs(b.dot(c.directionWC,q));g.fog.density=h*(1-c);g.fog.sse=this.screenSpaceErrorFactor;g.fog.minimumBrightness=this.minimumBrightness}}};return g});F("Scene/FrameRateMonitor","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Event ../Core/getTimestamp ../Core/TimeConstants".split(" "),function(b,a,f,k,g,l,m,e){function h(f){function d(){var a=k;document[a._hiddenPropertyName]?a.pause():a.unpause()}if(!a(f)||!a(f.scene))throw new g("options.scene is required.");this._scene=f.scene;this.samplingWindow=b(f.samplingWindow,h.defaultSettings.samplingWindow);this.quietPeriod=b(f.quietPeriod,h.defaultSettings.quietPeriod);this.warmupPeriod=b(f.warmupPeriod,h.defaultSettings.warmupPeriod);this.minimumFrameRateDuringWarmup=b(f.minimumFrameRateDuringWarmup,h.defaultSettings.minimumFrameRateDuringWarmup);this.minimumFrameRateAfterWarmup=b(f.minimumFrameRateAfterWarmup,h.defaultSettings.minimumFrameRateAfterWarmup);this._lowFrameRate=new l;this._nominalFrameRate=new l;this._frameTimes=[];this._needsQuietPeriod=!0;this._warmupPeriodEndTime=this._quietPeriodEndTime=0;this._frameRateIsLow=!1;this._lastFramesPerSecond=void 0;this._pauseCount=0;var k=this;this._preUpdateRemoveListener=this._scene.preUpdate.addEventListener(function(a,b){var c=k;if(!(0<c._pauseCount)){var d=m();if(c._needsQuietPeriod)c._needsQuietPeriod=!1,c._frameTimes.length=0,c._quietPeriodEndTime=d+c.quietPeriod/e.SECONDS_PER_MILLISECOND,c._warmupPeriodEndTime=c._quietPeriodEndTime+(c.warmupPeriod+c.samplingWindow)/e.SECONDS_PER_MILLISECOND;else if(d>=c._quietPeriodEndTime){c._frameTimes.push(d);var f=d-c.samplingWindow/e.SECONDS_PER_MILLISECOND;if(2<=c._frameTimes.length&&c._frameTimes[0]<=f){for(;2<=c._frameTimes.length&&c._frameTimes[1]<f;)c._frameTimes.shift();f=(d-c._frameTimes[0])/(c._frameTimes.length-1);c._lastFramesPerSecond=1E3/f;f>1E3/(d>c._warmupPeriodEndTime?c.minimumFrameRateAfterWarmup:c.minimumFrameRateDuringWarmup)?c._frameRateIsLow||(c._frameRateIsLow=!0,c._needsQuietPeriod=!0,c.lowFrameRate.raiseEvent(c.scene,c._lastFramesPerSecond)):c._frameRateIsLow&&(c._frameRateIsLow=!1,c._needsQuietPeriod=!0,c.nominalFrameRate.raiseEvent(c.scene,c._lastFramesPerSecond))}}}});this._hiddenPropertyName=void 0!==document.hidden?"hidden":void 0!==document.mozHidden?"mozHidden":void 0!==document.msHidden?"msHidden":void 0!==document.webkitHidden?"webkitHidden":void 0;var p=void 0!==document.hidden?"visibilitychange":void 0!==document.mozHidden?"mozvisibilitychange":void 0!==document.msHidden?"msvisibilitychange":void 0!==document.webkitHidden?"webkitvisibilitychange":void 0;this._visibilityChangeRemoveListener=void 0;a(p)&&(document.addEventListener(p,d,!1),this._visibilityChangeRemoveListener=function(){document.removeEventListener(p,d,!1)})}h.defaultSettings={samplingWindow:5,quietPeriod:2,warmupPeriod:5,minimumFrameRateDuringWarmup:4,minimumFrameRateAfterWarmup:8};h.fromScene=function(b){if(!a(b))throw new g("scene is required.");if(!a(b._frameRateMonitor)||b._frameRateMonitor.isDestroyed())b._frameRateMonitor=new h({scene:b});return b._frameRateMonitor};f(h.prototype,{scene:{get:function(){return this._scene}},lowFrameRate:{get:function(){return this._lowFrameRate}},nominalFrameRate:{get:function(){return this._nominalFrameRate}},lastFramesPerSecond:{get:function(){return this._lastFramesPerSecond}}});h.prototype.pause=function(){++this._pauseCount;1===this._pauseCount&&(this._frameTimes.length=0,this._lastFramesPerSecond=void 0)};h.prototype.unpause=function(){--this._pauseCount;0>=this._pauseCount&&(this._pauseCount=0,this._needsQuietPeriod=!0)};h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){this._preUpdateRemoveListener();a(this._visibilityChangeRemoveListener)&&this._visibilityChangeRemoveListener();return k(this)};return h});F("Scene/FrameState",["./SceneMode"],function(b){return function(a,f,k){this.context=a;this.commandList=[];this.shadowMaps=[];this.specularEnvironmentMapsMaximumLOD=this.specularEnvironmentMaps=this.sphericalHarmonicCoefficients=this.environmentMap=this.brdfLutGenerator=void 0;this.mode=b.SCENE3D;this.morphTime=b.getMorphTime(b.SCENE3D);this.frameNumber=0;this.newFrame=!1;this.time=void 0;this.jobScheduler=k;this.maximumScreenSpaceError=this.occluder=this.cullingVolume=this.camera=this.mapProjection=void 0;this.passes={render:!1,pick:!1,depth:!1,postProcess:!1,offscreen:!1};this.creditDisplay=f;this.afterRender=[];this.scene3DOnly=!1;this.fog={enabled:!1,density:void 0,sse:void 0,minimumBrightness:void 0};this.terrainExaggeration=1;this.shadowState={shadowsEnabled:!0,lightShadowsEnabled:!0,shadowMaps:[],lightShadowMaps:[],nearPlane:1,farPlane:5E3,closestObjectSize:1E3,lastDirtyTime:0,outOfView:!0};this.imagerySplitPosition=0;this.frustumSplits=[];this.minimumDisableDepthTestDistance=this.sunColor=this.backgroundColor=void 0;this.invertClassification=!1;this.invertClassificationColor=void 0;this.useLogDepth=!1;this.nightLightMap=void 0;this.nightLightVisible=!1;this.tilesetPassState=void 0}});F("Scene/FrustumCommands",["../Core/defaultValue","../Renderer/Pass"],function(b,a){return function(f,k){this.near=b(f,0);this.far=b(k,0);for(var g=a.NUMBER_OF_PASSES,l=Array(g),m=Array(g),e=0;e<g;++e)l[e]=[],m[e]=0;this.commands=l;this.indices=m}});F("Shaders/GlobeFS",[],function(){return"uniform vec4 u_initialColor;\n#if TEXTURE_UNITS \x3e 0\nuniform sampler2D u_dayTextures[TEXTURE_UNITS];\nuniform vec4 u_dayTextureTranslationAndScale[TEXTURE_UNITS];\nuniform bool u_dayTextureUseWebMercatorT[TEXTURE_UNITS];\n#ifdef APPLY_ALPHA\nuniform float u_dayTextureAlpha[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_SPLIT\nuniform float u_dayTextureSplit[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_BRIGHTNESS\nuniform float u_dayTextureBrightness[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_CONTRAST\nuniform float u_dayTextureContrast[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_HUE\nuniform float u_dayTextureHue[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_SATURATION\nuniform float u_dayTextureSaturation[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_GAMMA\nuniform float u_dayTextureOneOverGamma[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_IMAGERY_CUTOUT\nuniform vec4 u_dayTextureCutoutRectangles[TEXTURE_UNITS];\n#endif\n#ifdef APPLY_COLOR_TO_ALPHA\nuniform vec4 u_colorsToAlpha[TEXTURE_UNITS];\n#endif\nuniform vec4 u_dayTextureTexCoordsRectangle[TEXTURE_UNITS];\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nuniform sampler2D u_waterMask;\nuniform vec4 u_waterMaskTranslationAndScale;\nuniform float u_zoomedOutOceanSpecularIntensity;\n#endif\n#ifdef SHOW_OCEAN_WAVES\nuniform sampler2D u_oceanNormalMap;\n#endif\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nuniform vec2 u_lightingFadeDistance;\n#endif\n#ifdef TILE_LIMIT_RECTANGLE\nuniform vec4 u_cartographicLimitRectangle;\n#endif\n#ifdef GROUND_ATMOSPHERE\nuniform vec2 u_nightFadeDistance;\n#endif\nuniform float u_tansparency;\n#ifdef ENABLE_CLIPPING_PLANES\nuniform sampler2D u_clippingPlanes;\nuniform mat4 u_clippingPlanesMatrix;\nuniform vec4 u_clippingPlanesEdgeStyle;\n#endif\n#if defined(FOG) \x26\x26 (defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)) || defined(GROUND_ATMOSPHERE)\nuniform float u_minimumBrightness;\n#endif\n#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift;\n#endif\n#ifdef HIGHLIGHT_FILL_TILE\nuniform vec4 u_fillHighlightColor;\n#endif\n#ifdef WIND_FIELD\nvarying vec4 v_posWC;\n#endif\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n#ifdef APPLY_MATERIAL\nvarying float v_height;\nvarying float v_slope;\nvarying float v_aspect;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogRayleighColor;\nvarying vec3 v_fogMieColor;\n#endif\n#ifdef GROUND_ATMOSPHERE\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\n#endif\nvec4 sampleAndBlend(\nvec4 previousColor,\nsampler2D textureToSample,\nvec2 tileTextureCoordinates,\nvec4 textureCoordinateRectangle,\nvec4 textureCoordinateTranslationAndScale,\nfloat textureAlpha,\nfloat textureBrightness,\nfloat textureContrast,\nfloat textureHue,\nfloat textureSaturation,\nfloat textureOneOverGamma,\nfloat split,\nvec4 colorToAlpha)\n{\nvec2 alphaMultiplier \x3d step(textureCoordinateRectangle.st, tileTextureCoordinates);\ntextureAlpha \x3d textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nalphaMultiplier \x3d step(vec2(0.0), textureCoordinateRectangle.pq - tileTextureCoordinates);\ntextureAlpha \x3d textureAlpha * alphaMultiplier.x * alphaMultiplier.y;\nvec2 translation \x3d textureCoordinateTranslationAndScale.xy;\nvec2 scale \x3d textureCoordinateTranslationAndScale.zw;\nvec2 textureCoordinates \x3d tileTextureCoordinates * scale + translation;\nvec4 value \x3d texture2D(textureToSample, textureCoordinates);\nvec3 color \x3d value.rgb;\nfloat alpha \x3d value.a;\n#ifdef APPLY_COLOR_TO_ALPHA\nvec3 colorDiff \x3d abs(color.rgb - colorToAlpha.rgb);\ncolorDiff.r \x3d max(max(colorDiff.r, colorDiff.g), colorDiff.b);\nalpha \x3d czm_branchFreeTernary(colorDiff.r \x3c colorToAlpha.a, 0.0, alpha);\n#endif\n#if !defined(APPLY_GAMMA)\nvec4 tempColor \x3d czm_gammaCorrect(vec4(color, alpha));\ncolor \x3d tempColor.rgb;\nalpha \x3d tempColor.a;\n#else\ncolor \x3d pow(color, vec3(textureOneOverGamma));\n#endif\n#ifdef APPLY_SPLIT\nfloat splitPosition \x3d czm_imagerySplitPosition;\nif (split \x3c 0.0 \x26\x26 gl_FragCoord.x \x3e splitPosition) {\nalpha \x3d 0.0;\n}\nelse if (split \x3e 0.0 \x26\x26 gl_FragCoord.x \x3c splitPosition) {\nalpha \x3d 0.0;\n}\n#endif\n#ifdef APPLY_BRIGHTNESS\ncolor \x3d mix(vec3(0.0), color, textureBrightness);\n#endif\n#ifdef APPLY_CONTRAST\ncolor \x3d mix(vec3(0.5), color, textureContrast);\n#endif\n#ifdef APPLY_HUE\ncolor \x3d czm_hue(color, textureHue);\n#endif\n#ifdef APPLY_SATURATION\ncolor \x3d czm_saturation(color, textureSaturation);\n#endif\nfloat sourceAlpha \x3d alpha * textureAlpha;\nfloat outAlpha \x3d mix(previousColor.a, 1.0, sourceAlpha);\noutAlpha +\x3d sign(outAlpha) - 1.0;\nvec3 outColor \x3d mix(previousColor.rgb * previousColor.a, color, sourceAlpha) / outAlpha;\nreturn vec4(outColor, max(outAlpha, 0.0));\n}\nvec3 colorCorrect(vec3 rgb) {\n#ifdef COLOR_CORRECT\nvec3 hsb \x3d czm_RGBToHSB(rgb);\nhsb.x +\x3d u_hsbShift.x;\nhsb.y \x3d clamp(hsb.y + u_hsbShift.y, 0.0, 1.0);\nhsb.z \x3d hsb.z \x3e czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0;\nrgb \x3d czm_HSBToRGB(hsb);\n#endif\nreturn rgb;\n}\nvec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates);\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float specularMapValue, float fade);\nvoid main()\n{\n#ifdef TILE_LIMIT_RECTANGLE\nif (v_textureCoordinates.x \x3c u_cartographicLimitRectangle.x || u_cartographicLimitRectangle.z \x3c v_textureCoordinates.x ||\nv_textureCoordinates.y \x3c u_cartographicLimitRectangle.y || u_cartographicLimitRectangle.w \x3c v_textureCoordinates.y)\n{\ndiscard;\n}\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nfloat clipDistance \x3d clip(gl_FragCoord, u_clippingPlanes, u_clippingPlanesMatrix);\n#endif\nvec4 color \x3d computeDayColor(u_initialColor, clamp(v_textureCoordinates, 0.0, 1.0));\n#ifdef SHOW_TILE_BOUNDARIES\nif (v_textureCoordinates.x \x3c (1.0/256.0) || v_textureCoordinates.x \x3e (255.0/256.0) ||\nv_textureCoordinates.y \x3c (1.0/256.0) || v_textureCoordinates.y \x3e (255.0/256.0))\n{\ncolor \x3d vec4(1.0, 0.0, 0.0, 1.0);\n}\n#endif\n#if defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(HDR)\nvec3 normalMC \x3d czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));\nvec3 normalEC \x3d czm_normal3D * normalMC;\n#endif\n#if defined(ENABLE_DAYNIGHT_SHADING) || defined(GROUND_ATMOSPHERE)\nfloat cameraDist;\nif (czm_sceneMode \x3d\x3d czm_sceneMode2D)\n{\ncameraDist \x3d max(czm_frustumPlanes.x - czm_frustumPlanes.y, czm_frustumPlanes.w - czm_frustumPlanes.z) * 0.5;\n}\nelse if (czm_sceneMode \x3d\x3d czm_sceneModeColumbusView)\n{\ncameraDist \x3d -czm_view[3].z;\n}\nelse\n{\ncameraDist \x3d length(czm_view[3]);\n}\nfloat fadeOutDist \x3d u_lightingFadeDistance.x;\nfloat fadeInDist \x3d u_lightingFadeDistance.y;\nif (czm_sceneMode !\x3d czm_sceneMode3D) {\nvec3 radii \x3d czm_ellipsoidRadii;\nfloat maxRadii \x3d max(radii.x, max(radii.y, radii.z));\nfadeOutDist -\x3d maxRadii;\nfadeInDist -\x3d maxRadii;\n}\nfloat fade \x3d clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#else\nfloat fade \x3d 0.0;\n#endif\n#ifdef SHOW_REFLECTIVE_OCEAN\nvec2 waterMaskTranslation \x3d u_waterMaskTranslationAndScale.xy;\nvec2 waterMaskScale \x3d u_waterMaskTranslationAndScale.zw;\nvec2 waterMaskTextureCoordinates \x3d v_textureCoordinates.xy * waterMaskScale + waterMaskTranslation;\nwaterMaskTextureCoordinates.y \x3d 1.0 - waterMaskTextureCoordinates.y;\nfloat mask \x3d texture2D(u_waterMask, waterMaskTextureCoordinates).r;\nif (mask \x3e 0.0)\n{\nmat3 enuToEye \x3d czm_eastNorthUpToEyeCoordinates(v_positionMC, normalEC);\nvec2 ellipsoidTextureCoordinates \x3d czm_ellipsoidWgs84TextureCoordinates(normalMC);\nvec2 ellipsoidFlippedTextureCoordinates \x3d czm_ellipsoidWgs84TextureCoordinates(normalMC.zyx);\nvec2 textureCoordinates \x3d mix(ellipsoidTextureCoordinates, ellipsoidFlippedTextureCoordinates, czm_morphTime * smoothstep(0.9, 0.95, normalMC.z));\ncolor \x3d computeWaterColor(v_positionEC, textureCoordinates, enuToEye, color, mask, fade);\n}\n#endif\n#ifdef APPLY_MATERIAL\nczm_materialInput materialInput;\nmaterialInput.st \x3d v_textureCoordinates.st;\nmaterialInput.normalEC \x3d normalize(v_normalEC);\nmaterialInput.slope \x3d v_slope;\nmaterialInput.height \x3d v_height;\nmaterialInput.aspect \x3d v_aspect;\nczm_material material \x3d czm_getMaterial(materialInput);\ncolor.xyz \x3d mix(color.xyz, material.diffuse, material.alpha);\n#endif\n#ifdef ENABLE_VERTEX_LIGHTING\nfloat diffuseIntensity \x3d clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalize(v_normalEC)) * 0.9 + 0.3, 0.0, 1.0);\nvec4 finalColor \x3d vec4(color.rgb * diffuseIntensity, color.a);\n#elif defined(ENABLE_DAYNIGHT_SHADING)\nfloat diffuseIntensity \x3d clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalEC) * 3.0 + 0.3, 0.0, 1.0);\ndiffuseIntensity \x3d pow(diffuseIntensity,3.0);\nvec4 finalColor \x3d vec4(color.rgb * diffuseIntensity, color.a);\n#else\nvec4 finalColor \x3d color;\n#endif\n#ifdef ENABLE_CLIPPING_PLANES\nvec4 clippingPlanesEdgeColor \x3d vec4(1.0);\nclippingPlanesEdgeColor.rgb \x3d u_clippingPlanesEdgeStyle.rgb;\nfloat clippingPlanesEdgeWidth \x3d u_clippingPlanesEdgeStyle.a;\nif (clipDistance \x3c clippingPlanesEdgeWidth)\n{\nfinalColor \x3d clippingPlanesEdgeColor;\n}\n#endif\n#ifdef HIGHLIGHT_FILL_TILE\nfinalColor \x3d vec4(mix(finalColor.rgb, u_fillHighlightColor.rgb, u_fillHighlightColor.a), finalColor.a);\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvec3 fogColor \x3d colorCorrect(v_fogMieColor) + finalColor.rgb * colorCorrect(v_fogRayleighColor);\n#ifndef HDR\nconst float fExposure \x3d 2.0;\nfogColor \x3d vec3(1.0) - exp(-fExposure * fogColor);\n#endif\n#endif\n#ifdef FOG\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(ENABLE_DAYNIGHT_SHADING)\nfloat darken \x3d clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), u_minimumBrightness, 1.0);\nfogColor *\x3d darken;\n#endif\n#ifdef HDR\nconst float modifier \x3d 0.15;\nfinalColor \x3d vec4(czm_fog(v_distance, finalColor.rgb, fogColor, modifier), finalColor.a);\n#else\nfinalColor \x3d vec4(czm_fog(v_distance, finalColor.rgb, fogColor), finalColor.a);\n#endif\n#endif\n#ifdef GROUND_ATMOSPHERE\nif (czm_sceneMode !\x3d czm_sceneMode3D)\n{\ngl_FragColor \x3d finalColor;\nreturn;\n}\n#if defined(PER_FRAGMENT_GROUND_ATMOSPHERE) \x26\x26 (defined(ENABLE_DAYNIGHT_SHADING) || defined(ENABLE_VERTEX_LIGHTING))\nfloat mpp \x3d czm_metersPerPixel(vec4(0.0, 0.0, -czm_currentFrustum.x, 1.0));\nvec2 xy \x3d gl_FragCoord.xy / czm_viewport.zw * 2.0 - vec2(1.0);\nxy *\x3d czm_viewport.zw * mpp * 0.5;\nvec3 direction \x3d normalize(vec3(xy, -czm_currentFrustum.x));\nczm_ray ray \x3d czm_ray(vec3(0.0), direction);\nvec3 ellipsoid_center \x3d czm_view[3].xyz;\nczm_raySegment intersection \x3d czm_rayEllipsoidIntersectionInterval(ray, ellipsoid_center, czm_ellipsoidInverseRadii);\nvec3 ellipsoidPosition \x3d czm_pointAlongRay(ray, intersection.start);\nellipsoidPosition \x3d (czm_inverseView * vec4(ellipsoidPosition, 1.0)).xyz;\nAtmosphereColor atmosColor \x3d computeGroundAtmosphereFromSpace(ellipsoidPosition, true);\nvec3 groundAtmosphereColor \x3d colorCorrect(atmosColor.mie) + finalColor.rgb * colorCorrect(atmosColor.rayleigh);\n#ifndef HDR\ngroundAtmosphereColor \x3d vec3(1.0) - exp(-fExposure * groundAtmosphereColor);\n#endif\nfadeInDist \x3d u_nightFadeDistance.x;\nfadeOutDist \x3d u_nightFadeDistance.y;\nfloat sunlitAtmosphereIntensity \x3d clamp((cameraDist - fadeOutDist) / (fadeInDist - fadeOutDist), 0.0, 1.0);\n#ifdef HDR\nsunlitAtmosphereIntensity \x3d max(sunlitAtmosphereIntensity * sunlitAtmosphereIntensity, 0.03);\n#endif\ngroundAtmosphereColor \x3d mix(groundAtmosphereColor, fogColor, sunlitAtmosphereIntensity);\n#else\nvec3 groundAtmosphereColor \x3d fogColor;\n#endif\n#ifdef HDR\ngroundAtmosphereColor \x3d czm_saturation(groundAtmosphereColor, 1.6);\n#endif\nfinalColor \x3d vec4(mix(finalColor.rgb, groundAtmosphereColor, fade), finalColor.a);\n#endif\ngl_FragColor \x3d vec4(finalColor.rgb,u_tansparency);\n#ifdef NIGHT_LIGHT\nvec3 normalMCLight \x3d czm_geodeticSurfaceNormal(v_positionMC, vec3(0.0), vec3(1.0));\nvec2 ellipsoidTextureCoordinatesLight \x3d czm_ellipsoidWgs84TextureCoordinates(normalMCLight);\nvec3 normalECLight \x3d czm_normal3D * normalMCLight;\nfloat diffuseIntensityLight \x3d clamp(czm_getLambertDiffuse(czm_sunDirectionEC, normalECLight) * 3.0 + 0.5, 0.0, 1.0);\nvec4 nightLight \x3d texture2D(czm_nightLightTexture, ellipsoidTextureCoordinatesLight);\ngl_FragColor \x3d vec4(mix(nightLight.rgb,finalColor.rgb,diffuseIntensity), finalColor.a);\n#endif\n#ifdef WIND_FIELD\nvec4 windColor \x3d czm_windColor( v_posWC.xyz );\nif(windColor.w \x3c\x3d 2.0){\ngl_FragColor \x3d vec4(windColor.rgb,u_tansparency);\n}else if( windColor.w \x3e 10.0){\n}\n#endif\n}\n#ifdef SHOW_REFLECTIVE_OCEAN\nfloat waveFade(float edge0, float edge1, float x)\n{\nfloat y \x3d clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\nreturn pow(1.0 - y, 5.0);\n}\nfloat linearFade(float edge0, float edge1, float x)\n{\nreturn clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\nconst float oceanFrequencyLowAltitude \x3d 825000.0;\nconst float oceanAnimationSpeedLowAltitude \x3d 0.004;\nconst float oceanOneOverAmplitudeLowAltitude \x3d 1.0 / 2.0;\nconst float oceanSpecularIntensity \x3d 0.5;\nconst float oceanFrequencyHighAltitude \x3d 125000.0;\nconst float oceanAnimationSpeedHighAltitude \x3d 0.008;\nconst float oceanOneOverAmplitudeHighAltitude \x3d 1.0 / 2.0;\nvec4 computeWaterColor(vec3 positionEyeCoordinates, vec2 textureCoordinates, mat3 enuToEye, vec4 imageryColor, float maskValue, float fade)\n{\nvec3 positionToEyeEC \x3d -positionEyeCoordinates;\nfloat positionToEyeECLength \x3d length(positionToEyeEC);\nvec3 normalizedpositionToEyeEC \x3d normalize(normalize(positionToEyeEC));\nfloat waveIntensity \x3d waveFade(70000.0, 1000000.0, positionToEyeECLength);\n#ifdef SHOW_OCEAN_WAVES\nfloat time \x3d czm_frameNumber * oceanAnimationSpeedHighAltitude;\nvec4 noise \x3d czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyHighAltitude, time, 0.0);\nvec3 normalTangentSpaceHighAltitude \x3d vec3(noise.xy, noise.z * oceanOneOverAmplitudeHighAltitude);\ntime \x3d czm_frameNumber * oceanAnimationSpeedLowAltitude;\nnoise \x3d czm_getWaterNoise(u_oceanNormalMap, textureCoordinates * oceanFrequencyLowAltitude, time, 0.0);\nvec3 normalTangentSpaceLowAltitude \x3d vec3(noise.xy, noise.z * oceanOneOverAmplitudeLowAltitude);\nfloat highAltitudeFade \x3d linearFade(0.0, 60000.0, positionToEyeECLength);\nfloat lowAltitudeFade \x3d 1.0 - linearFade(20000.0, 60000.0, positionToEyeECLength);\nvec3 normalTangentSpace \x3d\n(highAltitudeFade * normalTangentSpaceHighAltitude) +\n(lowAltitudeFade * normalTangentSpaceLowAltitude);\nnormalTangentSpace \x3d normalize(normalTangentSpace);\nnormalTangentSpace.xy *\x3d waveIntensity;\nnormalTangentSpace \x3d normalize(normalTangentSpace);\n#else\nvec3 normalTangentSpace \x3d vec3(0.0, 0.0, 1.0);\n#endif\nvec3 normalEC \x3d enuToEye * normalTangentSpace;\nconst vec3 waveHighlightColor \x3d vec3(0.3, 0.45, 0.6);\nfloat diffuseIntensity \x3d czm_getLambertDiffuse(czm_sunDirectionEC, normalEC) * maskValue;\nvec3 diffuseHighlight \x3d waveHighlightColor * diffuseIntensity * (1.0 - fade);\n#ifdef SHOW_OCEAN_WAVES\nfloat tsPerturbationRatio \x3d normalTangentSpace.z;\nvec3 nonDiffuseHighlight \x3d mix(waveHighlightColor * 5.0 * (1.0 - tsPerturbationRatio), vec3(0.0), diffuseIntensity);\n#else\nvec3 nonDiffuseHighlight \x3d vec3(0.0);\n#endif\nfloat specularIntensity \x3d czm_getSpecular(czm_sunDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0) + 0.25 * czm_getSpecular(czm_moonDirectionEC, normalizedpositionToEyeEC, normalEC, 10.0);\nfloat surfaceReflectance \x3d mix(0.0, mix(u_zoomedOutOceanSpecularIntensity, oceanSpecularIntensity, waveIntensity), maskValue);\nfloat specular \x3d specularIntensity * surfaceReflectance;\n#ifdef HDR\nspecular *\x3d 1.4;\nfloat e \x3d 0.2;\nfloat d \x3d 3.3;\nfloat c \x3d 1.7;\nvec3 color \x3d imageryColor.rgb + (c * (vec3(e) + imageryColor.rgb * d) * (diffuseHighlight + nonDiffuseHighlight + specular));\n#else\nvec3 color \x3d imageryColor.rgb + diffuseHighlight + nonDiffuseHighlight + specular;\n#endif\nreturn vec4(color, imageryColor.a);\n}\n#endif // #ifdef SHOW_REFLECTIVE_OCEAN\n"});F("Shaders/GlobeVS",[],function(){return"#ifdef QUANTIZATION_BITS12\nattribute vec4 compressed0;\nattribute float compressed1;\n#else\nattribute vec4 position3DAndHeight;\nattribute vec4 textureCoordAndEncodedNormals;\n#endif\nuniform vec3 u_center3D;\nuniform mat4 u_modifiedModelView;\nuniform mat4 u_modifiedModelViewProjection;\nuniform vec4 u_tileRectangle;\nuniform vec2 u_southAndNorthLatitude;\nuniform vec2 u_southMercatorYAndOneOverHeight;\nvarying vec3 v_positionMC;\nvarying vec3 v_positionEC;\nvarying vec3 v_textureCoordinates;\nvarying vec3 v_normalMC;\nvarying vec3 v_normalEC;\n#ifdef APPLY_MATERIAL\nvarying float v_slope;\nvarying float v_aspect;\nvarying float v_height;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nvarying float v_distance;\nvarying vec3 v_fogMieColor;\nvarying vec3 v_fogRayleighColor;\n#endif\n#ifdef WIND_FIELD\nvarying vec4 v_posWC;\n#endif\nvec4 getPosition(vec3 position, float height, vec2 textureCoordinates);\nfloat get2DYPositionFraction(vec2 textureCoordinates);\nvec4 getPosition3DMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn u_modifiedModelViewProjection * vec4(position, 1.0);\n}\nfloat get2DMercatorYPositionFraction(vec2 textureCoordinates)\n{\nconst float maxTileWidth \x3d 0.003068;\nfloat positionFraction \x3d textureCoordinates.y;\nfloat southLatitude \x3d u_southAndNorthLatitude.x;\nfloat northLatitude \x3d u_southAndNorthLatitude.y;\nif (northLatitude - southLatitude \x3e maxTileWidth)\n{\nfloat southMercatorY \x3d u_southMercatorYAndOneOverHeight.x;\nfloat oneOverMercatorHeight \x3d u_southMercatorYAndOneOverHeight.y;\nfloat currentLatitude \x3d mix(southLatitude, northLatitude, textureCoordinates.y);\ncurrentLatitude \x3d clamp(currentLatitude, -czm_webMercatorMaxLatitude, czm_webMercatorMaxLatitude);\npositionFraction \x3d czm_latitudeToWebMercatorFraction(currentLatitude, southMercatorY, oneOverMercatorHeight);\n}\nreturn positionFraction;\n}\nfloat get2DGeographicYPositionFraction(vec2 textureCoordinates)\n{\nreturn textureCoordinates.y;\n}\nvec4 getPositionPlanarEarth(vec3 position, float height, vec2 textureCoordinates)\n{\nfloat yPositionFraction \x3d get2DYPositionFraction(textureCoordinates);\nvec4 rtcPosition2D \x3d vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nreturn u_modifiedModelViewProjection * rtcPosition2D;\n}\nvec4 getPosition2DMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn getPositionPlanarEarth(position, 0.0, textureCoordinates);\n}\nvec4 getPositionColumbusViewMode(vec3 position, float height, vec2 textureCoordinates)\n{\nreturn getPositionPlanarEarth(position, height, textureCoordinates);\n}\nvec4 getPositionMorphingMode(vec3 position, float height, vec2 textureCoordinates)\n{\nvec3 position3DWC \x3d position + u_center3D;\nfloat yPositionFraction \x3d get2DYPositionFraction(textureCoordinates);\nvec4 position2DWC \x3d vec4(height, mix(u_tileRectangle.st, u_tileRectangle.pq, vec2(textureCoordinates.x, yPositionFraction)), 1.0);\nvec4 morphPosition \x3d czm_columbusViewMorph(position2DWC, vec4(position3DWC, 1.0), czm_morphTime);\nreturn czm_modelViewProjection * morphPosition;\n}\n#ifdef QUANTIZATION_BITS12\nuniform vec2 u_minMaxHeight;\nuniform mat4 u_scaleAndBias;\n#endif\nvoid main()\n{\n#ifdef QUANTIZATION_BITS12\nvec2 xy \x3d czm_decompressTextureCoordinates(compressed0.x);\nvec2 zh \x3d czm_decompressTextureCoordinates(compressed0.y);\nvec3 position \x3d vec3(xy, zh.x);\nfloat height \x3d zh.y;\nvec2 textureCoordinates \x3d czm_decompressTextureCoordinates(compressed0.z);\nheight \x3d height * (u_minMaxHeight.y - u_minMaxHeight.x) + u_minMaxHeight.x;\nposition \x3d (u_scaleAndBias * vec4(position, 1.0)).xyz;\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)) \x26\x26 defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT \x3d czm_decompressTextureCoordinates(compressed0.w).x;\nfloat encodedNormal \x3d compressed1;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT \x3d czm_decompressTextureCoordinates(compressed0.w).x;\nfloat encodedNormal \x3d 0.0;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL)\nfloat webMercatorT \x3d textureCoordinates.y;\nfloat encodedNormal \x3d compressed0.w;\n#else\nfloat webMercatorT \x3d textureCoordinates.y;\nfloat encodedNormal \x3d 0.0;\n#endif\n#else\nvec3 position \x3d position3DAndHeight.xyz;\nfloat height \x3d position3DAndHeight.w;\nvec2 textureCoordinates \x3d textureCoordAndEncodedNormals.xy;\n#if (defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)) \x26\x26 defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT \x3d textureCoordAndEncodedNormals.z;\nfloat encodedNormal \x3d textureCoordAndEncodedNormals.w;\n#elif defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\nfloat webMercatorT \x3d textureCoordinates.y;\nfloat encodedNormal \x3d textureCoordAndEncodedNormals.z;\n#elif defined(INCLUDE_WEB_MERCATOR_Y)\nfloat webMercatorT \x3d textureCoordAndEncodedNormals.z;\nfloat encodedNormal \x3d 0.0;\n#else\nfloat webMercatorT \x3d textureCoordinates.y;\nfloat encodedNormal \x3d 0.0;\n#endif\n#endif\nvec3 position3DWC \x3d position + u_center3D;\ngl_Position \x3d getPosition(position, height, textureCoordinates);\nv_textureCoordinates \x3d vec3(textureCoordinates, webMercatorT);\n#if defined(ENABLE_VERTEX_LIGHTING) || defined(GENERATE_POSITION_AND_NORMAL) || defined(APPLY_MATERIAL)\nv_positionEC \x3d (u_modifiedModelView * vec4(position, 1.0)).xyz;\nv_positionMC \x3d position3DWC;\nvec3 normalMC \x3d czm_octDecode(encodedNormal);\nv_normalMC \x3d normalMC;\nv_normalEC \x3d czm_normal3D * v_normalMC;\n#elif defined(SHOW_REFLECTIVE_OCEAN) || defined(ENABLE_DAYNIGHT_SHADING) || defined(GENERATE_POSITION) || defined(HDR)\nv_positionEC \x3d (u_modifiedModelView * vec4(position, 1.0)).xyz;\nv_positionMC \x3d position3DWC;\n#endif\n#if defined(FOG) || defined(GROUND_ATMOSPHERE)\nAtmosphereColor atmosFogColor \x3d computeGroundAtmosphereFromSpace(position3DWC, false);\nv_fogMieColor \x3d atmosFogColor.mie;\nv_fogRayleighColor \x3d atmosFogColor.rayleigh;\nv_distance \x3d length((czm_modelView3D * vec4(position3DWC, 1.0)).xyz);\n#endif\n#ifdef APPLY_MATERIAL\nfloat northPoleZ \x3d czm_ellipsoidRadii.z;\nvec3 northPolePositionMC \x3d vec3(0.0, 0.0, northPoleZ);\nvec3 ellipsoidNormal \x3d normalize(v_positionMC);\nvec3 vectorEastMC \x3d normalize(cross(northPolePositionMC - v_positionMC, ellipsoidNormal));\nfloat dotProd \x3d abs(dot(ellipsoidNormal, v_normalMC));\nv_slope \x3d acos(dotProd);\nvec3 normalRejected \x3d ellipsoidNormal * dotProd;\nvec3 normalProjected \x3d v_normalMC - normalRejected;\nvec3 aspectVector \x3d normalize(normalProjected);\nv_aspect \x3d acos(dot(aspectVector, vectorEastMC));\nfloat determ \x3d dot(cross(vectorEastMC, aspectVector), ellipsoidNormal);\nv_aspect \x3d czm_branchFreeTernary(determ \x3c 0.0, 2.0 * czm_pi - v_aspect, v_aspect);\nv_height \x3d height;\n#endif\n#ifdef WIND_FIELD\nv_posWC \x3d vec4(position3DWC.xyz, 1.0);\n#endif\n}\n"});F("Shaders/GroundAtmosphere",[],function(){return"const float fInnerRadius \x3d 6378137.0;\nconst float fOuterRadius \x3d 6378137.0 * 1.025;\nconst float fOuterRadius2 \x3d fOuterRadius * fOuterRadius;\nconst float Kr \x3d 0.0025;\nconst float Km \x3d 0.0015;\nconst float ESun \x3d 15.0;\nconst float fKrESun \x3d Kr * ESun;\nconst float fKmESun \x3d Km * ESun;\nconst float fKr4PI \x3d Kr * 4.0 * czm_pi;\nconst float fKm4PI \x3d Km * 4.0 * czm_pi;\nconst float fScale \x3d 1.0 / (fOuterRadius - fInnerRadius);\nconst float fScaleDepth \x3d 0.25;\nconst float fScaleOverScaleDepth \x3d fScale / fScaleDepth;\nstruct AtmosphereColor\n{\nvec3 mie;\nvec3 rayleigh;\n};\nconst int nSamples \x3d 2;\nconst float fSamples \x3d 2.0;\nfloat scale(float fCos)\n{\nfloat x \x3d 1.0 - fCos;\nreturn fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nAtmosphereColor computeGroundAtmosphereFromSpace(vec3 v3Pos, bool useSunLighting)\n{\nvec3 v3InvWavelength \x3d vec3(1.0 / pow(0.650, 4.0), 1.0 / pow(0.570, 4.0), 1.0 / pow(0.475, 4.0));\nvec3 v3Ray \x3d v3Pos - czm_viewerPositionWC;\nfloat fFar \x3d length(v3Ray);\nv3Ray /\x3d fFar;\nfloat fCameraHeight \x3d length(czm_viewerPositionWC);\nfloat fCameraHeight2 \x3d fCameraHeight * fCameraHeight;\nfloat B \x3d 2.0 * length(czm_viewerPositionWC) * dot(normalize(czm_viewerPositionWC), v3Ray);\nfloat C \x3d fCameraHeight2 - fOuterRadius2;\nfloat fDet \x3d max(0.0, B*B - 4.0 * C);\nfloat fNear \x3d 0.5 * (-B - sqrt(fDet));\nvec3 v3Start \x3d czm_viewerPositionWC + v3Ray * fNear;\nfFar -\x3d fNear;\nfloat fDepth \x3d exp((fInnerRadius - fOuterRadius) / fScaleDepth);\nfloat fLightAngle \x3d czm_branchFreeTernary(useSunLighting, dot(czm_sunDirectionWC, v3Pos) / length(v3Pos), 1.0);\nfloat fCameraAngle \x3d dot(-v3Ray, v3Pos) / length(v3Pos);\nfloat fCameraScale \x3d scale(fCameraAngle);\nfloat fLightScale \x3d scale(fLightAngle);\nfloat fCameraOffset \x3d fDepth*fCameraScale;\nfloat fTemp \x3d (fLightScale + fCameraScale);\nfloat fSampleLength \x3d fFar / fSamples;\nfloat fScaledLength \x3d fSampleLength * fScale;\nvec3 v3SampleRay \x3d v3Ray * fSampleLength;\nvec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\nvec3 v3FrontColor \x3d vec3(0.0);\nvec3 v3Attenuate \x3d vec3(0.0);\nfor(int i\x3d0; i\x3cnSamples; i++)\n{\nfloat fHeight \x3d length(v3SamplePoint);\nfloat fDepth \x3d exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\nfloat fScatter \x3d fDepth*fTemp - fCameraOffset;\nv3Attenuate \x3d exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\nv3FrontColor +\x3d v3Attenuate * (fDepth * fScaledLength);\nv3SamplePoint +\x3d v3SampleRay;\n}\nAtmosphereColor color;\ncolor.mie \x3d v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\ncolor.rayleigh \x3d v3Attenuate;\nreturn color;\n}\n"});F("Scene/GlobeSurfaceShaderSet","../Core/defined ../Core/destroyObject ../Core/TerrainQuantization ../Renderer/ShaderProgram ./getClippingFunction ./SceneMode".split(" "),function(b,a,f,k,g,l){function m(a,b,e,f,g){this.numberOfDayTextures=a;this.flags=b;this.material=e;this.shaderProgram=f;this.clippingShaderState=g}function e(){this.baseFragmentShaderSource=this.baseVertexShaderSource=void 0;this._shadersByTexturesFlags=[];this.material=void 0}function h(a){var b;switch(a){case l.SCENE3D:b="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPosition3DMode(position, height, textureCoordinates); }";break;case l.SCENE2D:case l.COLUMBUS_VIEW:b="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionColumbusViewMode(position, height, textureCoordinates); }";break;case l.MORPHING:b="vec4 getPosition(vec3 position, float height, vec2 textureCoordinates) { return getPositionMorphingMode(position, height, textureCoordinates); }"}return b}e.prototype.getShaderProgram=function(a){var d=a.frameState,e=a.surfaceTile,l=a.numberOfDayTextures,p=a.applyBrightness,c=a.applyContrast,u=a.applyHue,y=a.applySaturation,A=a.applyGamma,z=a.applyAlpha,x=a.applySplit,D=a.showReflectiveOcean,v=a.showOceanWaves,B=a.enableLighting,C=a.showGroundAtmosphere,I=a.perFragmentGroundAtmosphere,H=a.hasVertexNormals,J=a.useWebMercatorProjection,w=a.enableFog,G=a.enableClippingPlanes,E=a.clippingPlanes,L=a.clippedByBoundaries,K=a.hasImageryLayerCutout,F=a.colorCorrect,N=a.highlightFillTile;a=a.colorToAlpha;var O=0,Z="",aa=e.renderedMesh.encoding;aa.quantization===f.BITS12&&(O=1,Z="QUANTIZATION_BITS12");var U=0,W="";b(e.vertexArray)&&b(e.terrainData)&&!e.terrainData._createdByUpsampling||(U=1,W="DISABLE_GL_POSITION_LOG_DEPTH");var M=0,R="";L&&(M=1,R="TILE_LIMIT_RECTANGLE");var Y=0,Q="";K&&(Y=1,Q="APPLY_IMAGERY_CUTOUT");L=d.mode;O=L|p<<2|c<<3|u<<4|y<<5|A<<6|z<<7|D<<8|v<<9|B<<10|C<<11|I<<12|H<<13|J<<14|w<<15|O<<16|x<<17|G<<18|U<<19|M<<20|Y<<21|F<<22|N<<23|a<<24|d.context.uniformState.windField.enable<<25|d.nightLightVisible<<26;U=0;b(E)&&0<E.length&&(U=G?E.clippingPlanesState:0);Y=e.surfaceShader;if(b(Y)&&Y.numberOfDayTextures===l&&Y.flags===O&&Y.material===this.material&&Y.clippingShaderState===U)return Y.shaderProgram;M=this._shadersByTexturesFlags[l];b(M)||(M=this._shadersByTexturesFlags[l]=[]);Y=M[O];if(!b(Y)||Y.material!==this.material||Y.clippingShaderState!==U){var Y=this.baseVertexShaderSource.clone(),S=this.baseFragmentShaderSource.clone();0!==U&&S.sources.unshift(g(E,d.context));Y.defines.push(Z,W);S.defines.push("TEXTURE_UNITS "+l,R,Q);p&&S.defines.push("APPLY_BRIGHTNESS");c&&S.defines.push("APPLY_CONTRAST");u&&S.defines.push("APPLY_HUE");y&&S.defines.push("APPLY_SATURATION");A&&S.defines.push("APPLY_GAMMA");z&&S.defines.push("APPLY_ALPHA");D&&(S.defines.push("SHOW_REFLECTIVE_OCEAN"),Y.defines.push("SHOW_REFLECTIVE_OCEAN"));v&&S.defines.push("SHOW_OCEAN_WAVES");a&&S.defines.push("APPLY_COLOR_TO_ALPHA");B&&(H?(Y.defines.push("ENABLE_VERTEX_LIGHTING"),S.defines.push("ENABLE_VERTEX_LIGHTING")):(Y.defines.push("ENABLE_DAYNIGHT_SHADING"),S.defines.push("ENABLE_DAYNIGHT_SHADING")));C&&(Y.defines.push("GROUND_ATMOSPHERE"),S.defines.push("GROUND_ATMOSPHERE"),I&&S.defines.push("PER_FRAGMENT_GROUND_ATMOSPHERE"));Y.defines.push("INCLUDE_WEB_MERCATOR_Y");S.defines.push("INCLUDE_WEB_MERCATOR_Y");w&&(Y.defines.push("FOG"),S.defines.push("FOG"));x&&S.defines.push("APPLY_SPLIT");G&&S.defines.push("ENABLE_CLIPPING_PLANES");F&&S.defines.push("COLOR_CORRECT");N&&S.defines.push("HIGHLIGHT_FILL_TILE");d.context.uniformState.windField.texWindU&&d.context.uniformState.windField.texWindV&&d.context.uniformState.windField.enable&&(Y.defines.push("WIND_FIELD"),S.defines.push("WIND_FIELD"));d.nightLightVisible&&d.nightLightMap&&S.defines.push("NIGHT_LIGHT");D="    vec4 computeDayColor(vec4 initialColor, vec3 textureCoordinates)\n    {\n        vec4 color \x3d initialColor;\n";K&&(D+="        vec4 cutoutAndColorResult;\n        bool texelUnclipped;\n");for(v=0;v<l;++v)D=K?D+("        cutoutAndColorResult \x3d u_dayTextureCutoutRectangles["+v+"];\n        texelUnclipped \x3d v_textureCoordinates.x \x3c cutoutAndColorResult.x || cutoutAndColorResult.z \x3c v_textureCoordinates.x || v_textureCoordinates.y \x3c cutoutAndColorResult.y || cutoutAndColorResult.w \x3c v_textureCoordinates.y;\n        cutoutAndColorResult \x3d sampleAndBlend(\n"):D+"        color \x3d sampleAndBlend(\n",D+="            color,\n            u_dayTextures["+v+"],\n            u_dayTextureUseWebMercatorT["+v+"] ? textureCoordinates.xz : textureCoordinates.xy,\n            u_dayTextureTexCoordsRectangle["+v+"],\n            u_dayTextureTranslationAndScale["+v+"],\n            "+(z?"u_dayTextureAlpha["+v+"]":"1.0")+",\n            "+(p?"u_dayTextureBrightness["+v+"]":"0.0")+",\n            "+(c?"u_dayTextureContrast["+v+"]":"0.0")+",\n            "+(u?"u_dayTextureHue["+v+"]":"0.0")+",\n            "+(y?"u_dayTextureSaturation["+v+"]":"0.0")+",\n            "+(A?"u_dayTextureOneOverGamma["+v+"]":"0.0")+",\n            "+(x?"u_dayTextureSplit["+v+"]":"0.0")+",\n            "+(a?"u_colorsToAlpha["+v+"]":"vec4(0.0)")+"\n        );\n",K&&(D+="        color \x3d czm_branchFreeTernary(texelUnclipped, cutoutAndColorResult, color);\n");S.sources.push(D+"        return color;\n    }");Y.sources.push(h(L));Y.sources.push(J?"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DMercatorYPositionFraction(textureCoordinates); }":"float get2DYPositionFraction(vec2 textureCoordinates) { return get2DGeographicYPositionFraction(textureCoordinates); }");d=k.fromCache({context:d.context,vertexShaderSource:Y,fragmentShaderSource:S,attributeLocations:aa.getAttributeLocations()});Y=M[O]=new m(l,O,this.material,d,U)}e.surfaceShader=Y;return Y.shaderProgram};e.prototype.destroy=function(){var e,d,f=this._shadersByTexturesFlags,g;for(g in f)if(f.hasOwnProperty(g)){var h=f[g];if(b(h))for(e in h)h.hasOwnProperty(e)&&(d=h[e],b(d)&&d.shaderProgram.destroy())}return a(this)};return e});F("Scene/ImageryState",["../Core/freezeObject"],function(b){return b({UNLOADED:0,TRANSITIONING:1,RECEIVED:2,TEXTURE_LOADED:3,READY:4,FAILED:5,INVALID:6,PLACEHOLDER:7})});F("Scene/TileSelectionResult",[],function(){var b={NONE:0,CULLED:1,RENDERED:2,REFINED:3,RENDERED_AND_KICKED:6,REFINED_AND_KICKED:7,CULLED_BUT_NEEDED:9,wasKicked:function(a){return a>=b.RENDERED_AND_KICKED},originalResult:function(a){return a&3},kick:function(a){return a|4}};return b});F("Scene/QuadtreeTileLoadState",["../Core/freezeObject"],function(b){return b({START:0,LOADING:1,DONE:2,FAILED:3})});F("Scene/TerrainState",["../Core/freezeObject"],function(b){return b({FAILED:0,UNLOADED:1,RECEIVING:2,RECEIVED:3,TRANSFORMING:4,TRANSFORMED:5,READY:6})});F("Scene/GlobeSurfaceTile","../Core/BoundingSphere ../Core/Cartesian3 ../Core/Cartesian4 ../Core/defined ../Core/defineProperties ../Core/IndexDatatype ../Core/IntersectionTests ../Core/OrientedBoundingBox ../Core/PixelFormat ../Core/Request ../Core/RequestState ../Core/RequestType ../Core/TileProviderError ../Core/CesiumTerrainProvider ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/PixelDatatype ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Renderer/VertexArray ./ImageryState ./QuadtreeTileLoadState ./SceneMode ./TerrainState ./TileBoundingRegion ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G){function E(){this.imagery=[];this.waterMaskTexture=void 0;this.waterMaskTranslationAndScale=new f(0,0,1,1);this.tileBoundingRegion=this.boundingVolumeSourceTile=this.orientedBoundingBox=this.vertexArray=this.terrainData=void 0;this.occludeePointInScaledSpace=new a;this.terrainState=J.UNLOADED;this.fill=this.mesh=void 0;this.pickBoundingSphere=new b;this.surfaceShader=void 0;this.isClipped=!0;this.clippedByBoundaries=!1}function L(b,c,d,e,f,g){b.decodePosition(e,f,g);k(c)&&c!==H.SCENE3D&&(b=d.ellipsoid.cartesianToCartographic(g),d.project(b,g),a.fromElements(g.z,g.x,g.y,g));return g}function K(a,b,c,d,e,f,g){if(c=b.parent){b=c.data.terrainData;var h=c.x,l=c.y;c=c.level;k(b)&&(d=b.upsample(d.tilingScheme,h,l,c,e,f,g),k(d)&&(a.terrainState=J.RECEIVING,G(d,function(b){a.terrainData=b;a.terrainState=J.RECEIVED},function(){a.terrainState=J.FAILED})))}else b.state=I.FAILED}function F(a,b,c,e,f){function g(b){a.terrainData=b;a.terrainState=J.RECEIVED;a.request=void 0}function h(){a.request.state===d.CANCELLED?(a.terrainData=void 0,a.terrainState=J.UNLOADED,a.request=void 0):(a.terrainState=J.FAILED,a.request=void 0,b._requestError=t.handleError(b._requestError,b,b.errorEvent,"Failed to obtain terrain tile X: "+c+" Y: "+e+" Level: "+f+".",c,e,f,l))}function l(){var d=new p({throttle:!1,throttleByServer:!0,type:q.TERRAIN});a.request=d;d=b.requestTileGeometry(c,e,f,d);k(d)?(a.terrainState=J.RECEIVING,G(d,g,h)):(a.terrainState=J.UNLOADED,a.request=void 0)}l()}function N(b,c,d,f,g,h){c=b.terrainData.createMesh(d.tilingScheme,f,g,h,c.terrainExaggeration,c.context.uniformState.surfaceTansparency.enable);k(c)&&(b.terrainState=J.TRANSFORMING,G(c,function(c){b.mesh=c;b.orientedBoundingBox=e.clone(c.orientedBoundingBox,b.orientedBoundingBox);b.occludeePointInScaledSpace=a.clone(c.occludeePointInScaledSpace,b.occludeePointInScaledSpace);b.terrainState=J.TRANSFORMED},function(){b.terrainState=J.FAILED}))}function O(a){var b=a.cache.tile_waterMaskData;if(!k(b)){b=z.create({context:a,pixelFormat:h.LUMINANCE,pixelDatatype:y.UNSIGNED_BYTE,source:{arrayBufferView:new Uint8Array([255]),width:1,height:1}});b.referenceCount=1;var c=new A({wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,minificationFilter:D.LINEAR,magnificationFilter:x.LINEAR}),b={allWaterTexture:b,sampler:c,destroy:function(){this.allWaterTexture.destroy()}};a.cache.tile_waterMaskData=b}return b}g(E.prototype,{eligibleForUnloading:{get:function(){for(var a=this.terrainState,b=!(a===J.RECEIVING||a===J.TRANSFORMING),a=this.imagery,c=0,d=a.length;b&&c<d;++c)b=a[c],b=!k(b.loadingImagery)||b.loadingImagery.state!==C.TRANSITIONING;return b}},renderedMesh:{get:function(){if(k(this.vertexArray))return this.mesh;if(k(this.fill))return this.fill.mesh}}});var Z=new a,aa=new a,U=new a,W=new a;E.prototype.pick=function(b,c,d,e,f){var g=this.renderedMesh;if(k(g))for(var h=g.vertices,l=g.indices,g=g.encoding,p=l.length,q=0;q<p;q+=3){var r=l[q+1],t=l[q+2],w=L(g,c,d,h,l[q],Z),r=L(g,c,d,h,r,aa),t=L(g,c,d,h,t,U),w=m.rayTriangle(b,w,r,t,e,W);if(k(w))return a.clone(w,f)}};E.prototype.freeResources=function(){k(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0);this.terrainData=void 0;this.terrainState=J.UNLOADED;this.mesh=void 0;this.fill=this.fill&&this.fill.destroy();for(var a=this.imagery,b=0,c=a.length;b<c;++b)a[b].freeResources();this.imagery.length=0;this.freeVertexArray()};E.prototype.freeVertexArray=function(){E._freeVertexArray(this.vertexArray);this.vertexArray=void 0;E._freeVertexArray(this.wireframeVertexArray);this.wireframeVertexArray=void 0};E.initialize=function(a,b,c){k(a.data)||(a.data=new E);if(a.state===I.START){var d=b.getTileDataAvailable(a.x,a.y,a.level);if(!k(d)&&k(a.parent)){var e=a.parent,f=e.data;k(f)&&k(f.terrainData)&&(d=f.terrainData.isChildAvailable(e.x,e.y,a.x,a.y))}!1===d&&(a.data.terrainState=J.FAILED);d=0;for(e=c.length;d<e;++d)f=c.get(d),f.show&&f._createTileImagerySkeletons(a,b);a.state=I.LOADING}};E.processStateMachine=function(a,b,c,d,e,g){E.initialize(a,c,d);var l=a.data;if(a.state===I.LOADING){var m=a.data,p=a.parent;m.terrainState===J.FAILED&&void 0!==p&&(void 0!==p.data&&void 0!==p.data.terrainData&&!1!==p.data.terrainData.canUpsample||E.processStateMachine(p,b,c,d,!0));m.terrainState===J.FAILED&&K(m,a,b,c,a.x,a.y,a.level);m.terrainState===J.UNLOADED&&F(m,c,a.x,a.y,a.level);m.terrainState===J.RECEIVED&&N(m,b,c,a.x,a.y,a.level);m.terrainState===J.TRANSFORMED&&(m.vertexArray=E._createVertexArrayForMesh(b.context,m.mesh),m.terrainState=J.READY,m.fill=m.fill&&m.fill.destroy(e));if(m.terrainState>=J.RECEIVED&&void 0===m.waterMaskTexture&&c.hasWaterMask)if(void 0!==m.terrainData.waterMask)a:{d=b.context;e=m.terrainData.waterMask;var p=O(d),q=e.length;if(1===q)if(0!==e[0])d=p.allWaterTexture;else break a;else q=Math.sqrt(q),d=z.create({context:d,pixelFormat:h.LUMINANCE,pixelDatatype:y.UNSIGNED_BYTE,source:{width:q,height:q,arrayBufferView:e},sampler:p.sampler,flipY:!1}),d.referenceCount=0;++d.referenceCount;m.waterMaskTexture=d;f.fromElements(0,0,1,1,m.waterMaskTranslationAndScale)}else d=m._findAncestorTileWithTerrainData(a),k(d)&&k(d.data.waterMaskTexture)&&(m.waterMaskTexture=d.data.waterMaskTexture,++m.waterMaskTexture.referenceCount,m._computeWaterMaskTranslationAndScale(a,d,m.waterMaskTranslationAndScale))}if(!g){g=a.renderable;a.renderable=k(l.vertexArray);m=l.terrainState===J.READY;a.upsampledFromParent=k(l.terrainData)&&l.terrainData.wasCreatedByUpsampling();b=l.processImagery(a,c,b);if(m&&b){b=a._loadedCallbacks;c={};for(var r in b)b.hasOwnProperty(r)&&(b[r](a)||(c[r]=b[r]));a._loadedCallbacks=c;a.state=I.DONE}g&&(a.renderable=!0)}};E.prototype.processImagery=function(a,b,c,d){var e=a.upsampledFromParent,f=a.renderable,g=!0,h=a.data.imagery,l,m;l=0;for(m=h.length;l<m;++l){var p=h[l];if(k(p.loadingImagery)){if(p.loadingImagery.state===C.PLACEHOLDER){var q=p.loadingImagery.imageryLayer;if(q.imageryProvider.ready){p.freeResources();h.splice(l,1);q._createTileImagerySkeletons(a,b,l);--l;m=h.length;continue}else e=!1}q=p.processStateMachine(a,c,d);g=g&&q;f=f&&(q||k(p.readyImagery));e=e&&k(p.loadingImagery)&&(p.loadingImagery.state===C.FAILED||p.loadingImagery.state===C.INVALID)}else e=!1}a.upsampledFromParent=e;a.renderable=f;return g};E._createVertexArrayForMesh=function(a,b){var d=c.createVertexBuffer({context:a,typedArray:b.vertices,usage:u.STATIC_DRAW}),d=b.encoding.getAttributes(d),e=b.indices.indexBuffers||{},f=e[a.id];!k(f)||f.isDestroyed()?(f=b.indices,f=c.createIndexBuffer({context:a,typedArray:f,usage:u.STATIC_DRAW,indexDatatype:l.fromSizeInBytes(f.BYTES_PER_ELEMENT)}),f.vertexArrayDestroyable=!1,f.referenceCount=1,e[a.id]=f,b.indices.indexBuffers=e):++f.referenceCount;return new B({context:a,attributes:d,indexBuffer:f})};E._freeVertexArray=function(a){if(k(a)){var b=a.indexBuffer;a.destroy();k(b)&&!b.isDestroyed()&&k(b.referenceCount)&&(--b.referenceCount,0===b.referenceCount&&b.destroy())}};E.prototype._findAncestorTileWithTerrainData=function(a){for(a=a.parent;k(a)&&(!k(a.data)||!k(a.data.terrainData)||a.data.terrainData.wasCreatedByUpsampling());)a=a.parent;return a};E.prototype._computeWaterMaskTranslationAndScale=function(a,b,c){b=b.rectangle;a=a.rectangle;var d=a.width,e=a.height,f=d/b.width,g=e/b.height;c.x=f*(a.west-b.west)/d;c.y=g*(a.south-b.south)/e;c.z=f;c.w=g;return c};return E});F("Shaders/ReprojectWebMercatorFS",[],function(){return"uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor \x3d texture2D(u_texture, v_textureCoordinates);\n}\n"});F("Shaders/ReprojectWebMercatorVS",[],function(){return"attribute vec4 position;\nattribute float webMercatorT;\nuniform vec2 u_textureDimensions;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nv_textureCoordinates \x3d vec2(position.x, webMercatorT);\ngl_Position \x3d czm_viewportOrthographic * (position * vec4(u_textureDimensions, 1.0, 1.0));\n}\n"});F("Scene/Imagery",["../Core/defined","../Core/destroyObject","./ImageryState"],function(b,a,f){function k(a,k,m,e,h){this.imageryLayer=a;this.x=k;this.y=m;this.level=e;this.request=void 0;0!==e&&(this.parent=a.getImageryFromCache(k/2|0,m/2|0,e-1));this.state=f.UNLOADED;this.credits=this.textureWebMercator=this.texture=this.image=this.imageUrl=void 0;this.referenceCount=0;!b(h)&&a.imageryProvider.ready&&(h=a.imageryProvider.tilingScheme.tileXYToRectangle(k,m,e));this.rectangle=h}k.createPlaceholder=function(a){a=new k(a,0,0,0);a.addReference();a.state=f.PLACEHOLDER;return a};k.prototype.addReference=function(){++this.referenceCount};k.prototype.releaseReference=function(){--this.referenceCount;return 0===this.referenceCount?(this.imageryLayer.removeImageryFromCache(this),b(this.parent)&&this.parent.releaseReference(),b(this.image)&&b(this.image.destroy)&&this.image.destroy(),b(this.texture)&&this.texture.destroy(),b(this.textureWebMercator)&&this.texture!==this.textureWebMercator&&this.textureWebMercator.destroy(),a(this),0):this.referenceCount};k.prototype.processStateMachine=function(a,b,k){this.state!==f.UNLOADED||k||(this.state=f.TRANSITIONING,this.imageryLayer._requestImagery(this));this.state===f.RECEIVED&&(this.state=f.TRANSITIONING,this.imageryLayer._createTexture(a.context,this));k=this.state===f.READY&&b&&!this.texture;if(this.state===f.TEXTURE_LOADED||k)this.state=f.TRANSITIONING,this.imageryLayer._reprojectTexture(a,this,b)};return k});F("Scene/ImagerySplitDirection",["../Core/freezeObject"],function(b){return b({LEFT:-1,NONE:0,RIGHT:1})});F("Scene/TileImagery",["../Core/defined","./ImageryState"],function(b,a){function f(a,b,f){this.readyImagery=void 0;this.loadingImagery=a;this.textureCoordinateRectangle=b;this.textureTranslationAndScale=void 0;this.useWebMercatorT=f}f.prototype.freeResources=function(){b(this.readyImagery)&&this.readyImagery.releaseReference();b(this.loadingImagery)&&this.loadingImagery.releaseReference()};f.prototype.processStateMachine=function(f,g,l){var k=this.loadingImagery,e=k.imageryLayer;k.processStateMachine(g,!this.useWebMercatorT,l);if(k.state===a.READY)return b(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=this.loadingImagery,this.loadingImagery=void 0,this.textureTranslationAndScale=e._calculateTextureTranslationAndScale(f,this),!0;for(var h=k.parent,p;b(h)&&(h.state!==a.READY||!this.useWebMercatorT&&!b(h.texture));)h.state!==a.FAILED&&h.state!==a.INVALID&&(p=p||h),h=h.parent;this.readyImagery!==h&&(b(this.readyImagery)&&this.readyImagery.releaseReference(),this.readyImagery=h,b(h)&&(h.addReference(),this.textureTranslationAndScale=e._calculateTextureTranslationAndScale(f,this)));return k.state===a.FAILED||k.state===a.INVALID?b(p)?(p.processStateMachine(g,!this.useWebMercatorT,l),!1):!0:!1};return f});F("Scene/ImageryLayer","../Core/Cartesian2 ../Core/Cartesian4 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/FeatureDetection ../Core/GeographicProjection ../Core/GeographicTilingScheme ../Core/IndexDatatype ../Core/Math ../Core/PixelFormat ../Core/Rectangle ../Core/Request ../Core/RequestState ../Core/RequestType ../Core/TerrainProvider ../Core/TileProviderError ../Core/WebMercatorProjection ../Core/WebMercatorTilingScheme ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/ComputeCommand ../Renderer/ContextLimits ../Renderer/MipmapHint ../Renderer/Sampler ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Renderer/VertexArray ../Shaders/ReprojectWebMercatorFS ../Shaders/ReprojectWebMercatorVS ../ThirdParty/when ./Imagery ./ImagerySplitDirection ./ImageryState ./TileImagery".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G,E,L,K,F,N,O,Z,aa,U,W,M,R){function P(a,b){this._imageryProvider=a;b=f(b,{});this.alpha=f(b.alpha,f(a.defaultAlpha,1));this.brightness=f(b.brightness,f(a.defaultBrightness,P.DEFAULT_BRIGHTNESS));this.contrast=f(b.contrast,f(a.defaultContrast,P.DEFAULT_CONTRAST));this.hue=f(b.hue,f(a.defaultHue,P.DEFAULT_HUE));this.saturation=f(b.saturation,f(a.defaultSaturation,P.DEFAULT_SATURATION));this.gamma=f(b.gamma,f(a.defaultGamma,P.DEFAULT_GAMMA));this.splitDirection=f(b.splitDirection,f(a.defaultSplit,P.DEFAULT_SPLIT));this.minificationFilter=f(b.minificationFilter,f(a.defaultMinificationFilter,P.DEFAULT_MINIFICATION_FILTER));this.magnificationFilter=f(b.magnificationFilter,f(a.defaultMagnificationFilter,P.DEFAULT_MAGNIFICATION_FILTER));this.show=f(b.show,!0);this._minimumTerrainLevel=b.minimumTerrainLevel;this._maximumTerrainLevel=b.maximumTerrainLevel;this._rectangle=f(b.rectangle,r.MAX_VALUE);this._maximumAnisotropy=b.maximumAnisotropy;this._imageryCache={};this._skeletonPlaceholder=new R(U.createPlaceholder(this));this._show=!0;this._layerIndex=-1;this._isBaseLayer=!1;this._requestImageError=void 0;this._reprojectComputeCommands=[];this.cutoutRectangle=b.cutoutRectangle;this.colorToAlpha=b.colorToAlpha;this.colorToAlphaThreshold=f(b.colorToAlphaThreshold,P.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD)}function Q(a,b,c,e){var f=b.cache.imageryLayer_reproject;if(!k(f)){for(var f=b.cache.imageryLayer_reproject={vertexArray:void 0,shaderProgram:void 0,sampler:void 0,destroy:function(){k(this.framebuffer)&&this.framebuffer.destroy();k(this.vertexArray)&&this.vertexArray.destroy();k(this.shaderProgram)&&this.shaderProgram.destroy()}},g=new Float32Array(256),h=0,l=0;64>l;++l){var m=l/63;g[h++]=0;g[h++]=m;g[h++]=1;g[h++]=m}h={position:0,webMercatorT:1};l=A.getRegularGridIndices(2,64);l=v.createIndexBuffer({context:b,typedArray:l,usage:B.STATIC_DRAW,indexDatatype:d.UNSIGNED_SHORT});f.vertexArray=new N({context:b,attributes:[{index:h.position,vertexBuffer:v.createVertexBuffer({context:b,typedArray:g,usage:B.STATIC_DRAW}),componentsPerAttribute:2},{index:h.webMercatorT,vertexBuffer:v.createVertexBuffer({context:b,sizeInBytes:512,usage:B.STREAM_DRAW}),componentsPerAttribute:1}],indexBuffer:l});g=new G({sources:[Z]});f.shaderProgram=w.fromCache({context:b,vertexShaderSource:g,fragmentShaderSource:O,attributeLocations:h});f.sampler=new J({wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,minificationFilter:K.LINEAR,magnificationFilter:L.LINEAR})}c.sampler=f.sampler;var m=c.width,p=c.height;V.textureDimensions.x=m;V.textureDimensions.y=p;V.texture=c;l=Math.sin(e.south);g=.5*Math.log((1+l)/(1-l));l=Math.sin(e.north);h=1/(.5*Math.log((1+l)/(1-l))-g);b=new E({context:b,width:m,height:p,pixelFormat:c.pixelFormat,pixelDatatype:c.pixelDatatype,preMultiplyAlpha:c.preMultiplyAlpha});q.isPowerOfTwo(m)&&q.isPowerOfTwo(p)&&b.generateMipmap(H.NICEST);c=e.south;e=e.north;for(var m=ba,r=p=0;64>r;++r)l=q.lerp(c,e,r/63),l=Math.sin(l),l=(.5*Math.log((1+l)/(1-l))-g)*h,m[p++]=l,m[p++]=l;f.vertexArray.getAttribute(1).vertexBuffer.copyFromArrayView(m);a.shaderProgram=f.shaderProgram;a.outputTexture=b;a.uniformMap=V;a.vertexArray=f.vertexArray}g(P.prototype,{imageryProvider:{get:function(){return this._imageryProvider}},rectangle:{get:function(){return this._rectangle}}});P.DEFAULT_BRIGHTNESS=1;P.DEFAULT_CONTRAST=1;P.DEFAULT_HUE=0;P.DEFAULT_SATURATION=1;P.DEFAULT_GAMMA=1;P.DEFAULT_SPLIT=W.NONE;P.DEFAULT_MINIFICATION_FILTER=K.LINEAR;P.DEFAULT_MAGNIFICATION_FILTER=L.LINEAR;P.DEFAULT_APPLY_COLOR_TO_ALPHA_THRESHOLD=.004;P.prototype.isBaseLayer=function(){return this._isBaseLayer};P.prototype.isDestroyed=function(){return!1};P.prototype.destroy=function(){return l(this)};var S=new r,ca=new r,T=new r,da=new r;P.prototype.getViewableRectangle=function(){var a=this._imageryProvider,b=this._rectangle;return a.readyPromise.then(function(){return r.intersection(a.rectangle,b)})};P.prototype._createTileImagerySkeletons=function(b,c,d){var e=b.data;if(k(this._minimumTerrainLevel)&&b.level<this._minimumTerrainLevel||k(this._maximumTerrainLevel)&&b.level>this._maximumTerrainLevel)return!1;var f=this._imageryProvider;k(d)||(d=e.imagery.length);if(!f.ready)return this._skeletonPlaceholder.loadingImagery.addReference(),e.imagery.splice(d,0,this._skeletonPlaceholder),!0;var g=f.tilingScheme.projection instanceof x&&b.rectangle.north<x.MaximumLatitude&&b.rectangle.south>-x.MaximumLatitude,l=r.intersection(f.rectangle,this._rectangle,S),m=r.intersection(b.rectangle,l,ca);if(!k(m)){if(!this.isBaseLayer())return!1;var p=b.rectangle,m=ca;p.south>=l.north?m.north=m.south=l.north:p.north<=l.south?m.north=m.south=l.south:(m.south=Math.max(p.south,l.south),m.north=Math.min(p.north,l.north));p.west>=l.east?m.west=m.east=l.east:p.east<=l.west?m.west=m.east=l.west:(m.west=Math.max(p.west,l.west),m.east=Math.min(p.east,l.east))}p=0;0<m.south?p=m.south:0>m.north&&(p=m.north);c=1*c.getLevelMaximumGeometricError(b.level);var q=this._imageryProvider,t=q.tilingScheme,p=t.ellipsoid.maximumRadius*t.rectangle.width*(this._imageryProvider.tilingScheme.projection instanceof h?1:Math.cos(p))/(q.tileWidth*t.getNumberOfXTilesAtLevel(0)),p=Math.round(Math.log(p/c)/Math.log(2))|0,p=Math.max(0,p);c=f.maximumLevel;p>c&&(p=c);k(f.minimumLevel)&&(c=f.minimumLevel,p<c&&(p=c));t=f.tilingScheme;f=t.positionToTileXY(r.northwest(m),p);m=t.positionToTileXY(r.southeast(m),p);c=b.rectangle.width/512;var q=b.rectangle.height/512,w=t.tileXYToRectangle(f.x,f.y,p);Math.abs(w.south-b.rectangle.north)<q&&f.y<m.y&&++f.y;Math.abs(w.east-b.rectangle.west)<c&&f.x<m.x&&++f.x;w=t.tileXYToRectangle(m.x,m.y,p);Math.abs(w.north-b.rectangle.south)<q&&m.y>f.y&&--m.y;Math.abs(w.west-b.rectangle.east)<c&&m.x>f.x&&--m.x;b=r.clone(b.rectangle,da);var u=t.tileXYToRectangle(f.x,f.y,p),v=r.intersection(u,l,T);g?(t.rectangleToNativeRectangle(b,b),t.rectangleToNativeRectangle(u,u),t.rectangleToNativeRectangle(v,v),t.rectangleToNativeRectangle(l,l),t=t.tileXYToNativeRectangle.bind(t),c=b.width/512,q=b.height/512):t=t.tileXYToRectangle.bind(t);var y=0,z=1,E;!this.isBaseLayer()&&Math.abs(v.west-b.west)>=c&&(y=Math.min(1,(v.west-b.west)/b.width));!this.isBaseLayer()&&Math.abs(v.north-b.north)>=q&&(z=Math.max(0,(v.north-b.south)/b.height));for(var C=z,A=f.x;A<=m.x;A++)if(w=y,u=t(A,f.y,p),v=r.simpleIntersection(u,l,T),k(v)){y=Math.min(1,(v.east-b.west)/b.width);A===m.x&&(this.isBaseLayer()||Math.abs(v.east-b.east)<c)&&(y=1);for(var z=C,B=f.y;B<=m.y;B++)E=z,u=t(A,B,p),v=r.simpleIntersection(u,l,T),k(v)&&(z=Math.max(0,(v.south-b.south)/b.height),B===m.y&&(this.isBaseLayer()||Math.abs(v.south-b.south)<q)&&(z=0),u=new a(w,z,y,E),v=this.getImageryFromCache(A,B,p),e.imagery.splice(d,0,new R(v,u,g)),++d)}return!0};P.prototype._calculateTextureTranslationAndScale=function(b,c){var d=c.readyImagery.rectangle,e=b.rectangle;if(c.useWebMercatorT)var f=c.readyImagery.imageryLayer.imageryProvider.tilingScheme,d=f.rectangleToNativeRectangle(d,S),e=f.rectangleToNativeRectangle(e,da);var f=e.width,g=e.height,h=f/d.width,k=g/d.height;return new a(h*(e.west-d.west)/f,k*(e.south-d.south)/g,h,k)};P.prototype._requestImagery=function(a){function b(b){if(!k(b))return d();a.image=b;a.state=M.RECEIVED;a.request=void 0;z.handleSuccess(g._requestImageError)}function d(b){a.request.state===u.CANCELLED?(a.state=M.UNLOADED,a.request=void 0):(a.state=M.FAILED,a.request=void 0,g._requestImageError=z.handleError(g._requestImageError,f,f.errorEvent,"Failed to obtain image tile X: "+a.x+" Y: "+a.y+" Level: "+a.level+".",a.x,a.y,a.level,e,b))}function e(){var e=new c({throttle:!1,throttleByServer:!0,type:y.IMAGERY});a.request=e;a.state=M.TRANSITIONING;e=f.requestImage(a.x,a.y,a.level,e);k(e)?(k(f.getTileCredits)&&(a.credits=f.getTileCredits(a.x,a.y,a.level)),aa(e,b,d)):(a.state=M.UNLOADED,a.request=void 0)}var f=this._imageryProvider,g=this;e()};P.prototype._createTextureWebGL=function(a,b){var c=new J({minificationFilter:this.minificationFilter,magnificationFilter:this.magnificationFilter}),d=b.image;return k(d.internalFormat)?new E({context:a,pixelFormat:d.internalFormat,width:d.width,height:d.height,source:{arrayBufferView:d.bufferView},sampler:c}):new E({context:a,source:d,pixelFormat:this._imageryProvider.hasAlphaChannel?t.RGBA:t.RGB,sampler:c})};P.prototype._createTexture=function(a,b){var c=this._imageryProvider,d=b.image;if(k(c.tileDiscardPolicy)){var e=c.tileDiscardPolicy;if(k(e)){if(!e.isReady()){b.state=M.RECEIVED;return}if(e.shouldDiscardImage(d)){b.state=M.INVALID;return}}}if(this.minificationFilter!==K.NEAREST&&this.minificationFilter!==K.LINEAR)throw new m("ImageryLayer minification filter must be NEAREST or LINEAR");d=this._createTextureWebGL(a,b);c.tilingScheme.projection instanceof x?b.textureWebMercator=d:b.texture=d;b.image=void 0;b.state=M.TEXTURE_LOADED};P.prototype._finalizeReprojectTexture=function(a,b){var c=this.minificationFilter,d=this.magnificationFilter;if(c===K.LINEAR&&d===L.LINEAR&&!t.isCompressedFormat(b.pixelFormat)&&q.isPowerOfTwo(b.width)&&q.isPowerOfTwo(b.height)){var c=K.LINEAR_MIPMAP_LINEAR,e=I.maximumTextureFilterAnisotropy,e=Math.min(e,f(this._maximumAnisotropy,e)),g=c+":"+d+":"+e,h=a.cache.imageryLayerMipmapSamplers;k(h)||(h={},a.cache.imageryLayerMipmapSamplers=h);var l=h[g];k(l)||(l=h[g]=new J({wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,minificationFilter:c,magnificationFilter:d,maximumAnisotropy:e}));b.generateMipmap(H.NICEST);b.sampler=l}else e=c+":"+d+":0",g=a.cache.imageryLayerNonMipmapSamplers,k(g)||(g={},a.cache.imageryLayerNonMipmapSamplers=g),h=g[e],k(h)||(h=g[e]=new J({wrapS:F.CLAMP_TO_EDGE,wrapT:F.CLAMP_TO_EDGE,minificationFilter:c,magnificationFilter:d})),b.sampler=h};P.prototype._reprojectTexture=function(a,b,c){var d=b.textureWebMercator||b.texture,e=b.rectangle,g=a.context;if((c=f(c,!0))&&!(this._imageryProvider.tilingScheme.projection instanceof h)&&1E-5<e.width/d.width){var k=this;b.addReference();a=new C({persists:!0,owner:this,preExecute:function(a){Q(a,g,d,b.rectangle)},postExecute:function(a){b.texture=a;k._finalizeReprojectTexture(g,a);b.state=M.READY;b.releaseReference()}});this._reprojectComputeCommands.push(a)}else c&&(b.texture=d),this._finalizeReprojectTexture(g,d),b.state=M.READY};P.prototype.queueReprojectionCommands=function(a){for(var b=this._reprojectComputeCommands,c=b.length,d=0;d<c;++d)a.commandList.push(b[d]);b.length=0};P.prototype.cancelReprojections=function(){this._reprojectComputeCommands.length=0};P.prototype.getImageryFromCache=function(a,b,c,d){var e=JSON.stringify([a,b,c]),f=this._imageryCache[e];k(f)||(f=new U(this,a,b,c,d),this._imageryCache[e]=f);f.addReference();return f};P.prototype.removeImageryFromCache=function(a){a=JSON.stringify([a.x,a.y,a.level]);delete this._imageryCache[a]};var V={u_textureDimensions:function(){return this.textureDimensions},u_texture:function(){return this.texture},textureDimensions:new b,texture:void 0},ba=e.supportsTypedArrays()?new Float32Array(128):void 0;return P});F("Scene/TerrainFillMesh","../Core/AttributeCompression ../Core/binarySearch ../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/defined ../Core/HeightmapTerrainData ../Core/Math ../Core/DeveloperError ../Core/OrientedBoundingBox ../Core/Queue ../Core/Rectangle ../Core/TileEdge ../Core/TerrainEncoding ../Core/TerrainMesh ../Core/WebMercatorProjection ./GlobeSurfaceTile ./TileSelectionResult".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(a){this.tile=a;this.frameLastUpdated=void 0;this.westMeshes=[];this.westTiles=[];this.southMeshes=[];this.southTiles=[];this.eastMeshes=[];this.eastTiles=[];this.northMeshes=[];this.northTiles=[];this.northeastTile=this.northeastMesh=this.northwestTile=this.northwestMesh=this.southeastTile=this.southeastMesh=this.southwestTile=this.southwestMesh=void 0;this.changedThisFrame=!0;this.waterMaskTexture=this.vertexArray=this.mesh=this.enqueuedFrame=this.visitedFrame=void 0;this.waterMaskTranslationAndScale=new l}function v(a,b,f,g,h,k,l,m,q){if(void 0!==g){for(var r=g;r&&(r._lastSelectionResultFrame!==h||x.wasKicked(r._lastSelectionResult)||x.originalResult(r._lastSelectionResult)===x.CULLED);){if(l)return;var t=r.parent;if(k>=c.NORTHWEST&&void 0!==t)switch(k){case c.NORTHWEST:r=r===t.northwestChild?t:void 0;break;case c.NORTHEAST:r=r===t.northeastChild?t:void 0;break;case c.SOUTHWEST:r=r===t.southwestChild?t:void 0;break;case c.SOUTHEAST:r=r===t.southeastChild?t:void 0}else r=t}if(void 0!==r)if(r._lastSelectionResult===x.RENDERED){if(!e(r.data.vertexArray))a:{g=r;l=g.data;if(void 0===l.fill)l.fill=new D(g);else if(l.fill.visitedFrame===h)break a;l.fill.enqueuedFrame!==h&&(l.fill.enqueuedFrame=h,l.fill.changedThisFrame=!1,m.enqueue(g));b:{h=g.data.fill;m=f.data.fill;e(m)?(m.visitedFrame=b.frameNumber,m.changedThisFrame&&(I(a,b,f,q),m.changedThisFrame=!1),a=f.data.fill.mesh):a=f.data.mesh;var w,u;switch(k){case c.WEST:w=h.westMeshes;u=h.westTiles;break;case c.SOUTH:w=h.southMeshes;u=h.southTiles;break;case c.EAST:w=h.eastMeshes;u=h.eastTiles;break;case c.NORTH:w=h.northMeshes;u=h.northTiles;break;case c.NORTHWEST:h.changedThisFrame=h.changedThisFrame||h.northwestMesh!==a;h.northwestMesh=a;h.northwestTile=f;break b;case c.NORTHEAST:h.changedThisFrame=h.changedThisFrame||h.northeastMesh!==a;h.northeastMesh=a;h.northeastTile=f;break b;case c.SOUTHWEST:h.changedThisFrame=h.changedThisFrame||h.southwestMesh!==a;h.southwestMesh=a;h.southwestTile=f;break b;case c.SOUTHEAST:h.changedThisFrame=h.changedThisFrame||h.southeastMesh!==a;h.southeastMesh=a;h.southeastTile=f;break b}if(f.level<=g.level)h.changedThisFrame=h.changedThisFrame||w[0]!==a||1!==w.length,w[0]=a,u[0]=f,w.length=1,u.length=1;else{var y,z;b=f.rectangle;q=g.rectangle;switch(k){case c.WEST:k=(q.north-q.south)*p.EPSILON5;for(y=0;y<u.length&&(q=u[y],q=q.rectangle,!p.greaterThan(b.north,q.south,k));++y);for(z=y;z<u.length&&(q=u[z],q=q.rectangle,!p.greaterThanOrEquals(b.south,q.north,k));++z);break;case c.SOUTH:k=(q.east-q.west)*p.EPSILON5;for(y=0;y<u.length&&(q=u[y],q=q.rectangle,!p.lessThan(b.west,q.east,k));++y);for(z=y;z<u.length&&(q=u[z],q=q.rectangle,!p.lessThanOrEquals(b.east,q.west,k));++z);break;case c.EAST:k=(q.north-q.south)*p.EPSILON5;for(y=0;y<u.length&&(q=u[y],q=q.rectangle,!p.lessThan(b.south,q.north,k));++y);for(z=y;z<u.length&&(q=u[z],q=q.rectangle,!p.lessThanOrEquals(b.north,q.south,k));++z);break;case c.NORTH:k=(q.east-q.west)*p.EPSILON5;for(y=0;y<u.length&&(q=u[y],q=q.rectangle,!p.greaterThan(b.east,q.west,k));++y);for(z=y;z<u.length&&(q=u[z],q=q.rectangle,!p.greaterThanOrEquals(b.west,q.east,k));++z);}1===z-y?(h.changedThisFrame=h.changedThisFrame||w[y]!==a,w[y]=a,u[y]=f):(h.changedThisFrame=!0,w.splice(y,z-y,a),u.splice(y,z-y,f))}}}}else if(x.originalResult(g._lastSelectionResult)!==x.CULLED)switch(k){case c.WEST:v(a,b,f,g.northwestChild,h,k,!0,m,q);v(a,b,f,g.southwestChild,h,k,!0,m,q);break;case c.EAST:v(a,b,f,g.southeastChild,h,k,!0,m,q);v(a,b,f,g.northeastChild,h,k,!0,m,q);break;case c.SOUTH:v(a,b,f,g.southwestChild,h,k,!0,m,q);v(a,b,f,g.southeastChild,h,k,!0,m,q);break;case c.NORTH:v(a,b,f,g.northeastChild,h,k,!0,m,q);v(a,b,f,g.northwestChild,h,k,!0,m,q);break;case c.NORTHWEST:v(a,b,f,g.northwestChild,h,k,!0,m,q);break;case c.NORTHEAST:v(a,b,f,g.northeastChild,h,k,!0,m,q);break;case c.SOUTHWEST:v(a,b,f,g.southwestChild,h,k,!0,m,q);break;case c.SOUTHEAST:v(a,b,f,g.southeastChild,h,k,!0,m,q);break;default:throw new d("Invalid edge");}}}function B(){this.height=0;this.encodedNormal=new k}function C(a,c,d,f,g,h,k,l,m){if(e(g))return g;e(h)&&e(k)?a=.5*(h.height+k.height):e(h)?a=h.height:e(k)?a=k.height:e(l)?a=l.height:(a=a.tile.data.tileBoundingRegion,f=d=0,e(a)&&(d=a.minimumHeight,f=a.maximumHeight),a=.5*(d+f));m.height=a;c=c.geodeticSurfaceNormalCartographic(aa,W);b.octEncode(c,m.encodedNormal);return m}function I(a,d,l,m){z.initialize(l,a.terrainProvider,a._imageryLayers);var p=l.data,r=p.fill,t=l.rectangle,w=l.tilingScheme.ellipsoid,v=E(r,w,0,1,r.northwestTile,r.northwestMesh,r.northTiles,r.northMeshes,r.westTiles,r.westMeshes,da),B=E(r,w,0,0,r.southwestTile,r.southwestMesh,r.westTiles,r.westMeshes,r.southTiles,r.southMeshes,ca),G=E(r,w,1,0,r.southeastTile,r.southeastMesh,r.southTiles,r.southMeshes,r.eastTiles,r.eastMeshes,T),D=E(r,w,1,1,r.northeastTile,r.northeastMesh,r.eastTiles,r.eastMeshes,r.northTiles,r.northMeshes,V),v=C(r,w,0,1,v,B,D,G,da),B=C(r,w,0,0,B,v,G,D,ca),G=C(r,w,1,1,G,B,D,v,T),D=C(r,w,1,1,D,G,v,B,V),x=B.height,L=G.height,I=v.height,F=D.height,J=Math.min(x,L,I,F),L=Math.max(x,L,I,F),O=.5*(J+L),N,x=a.getLevelMaximumGeometricError(l.level);if(t.width>6*Math.acos((w.maximumRadius-x)/w.maximumRadius)&&L-J<=x)t=new h({width:9,height:9,buffer:ba,structure:{heightOffset:L}}),r.mesh=t._createMeshSync(l.tilingScheme,l.x,l.y,l.level,1,d.context.uniformState.surfaceTansparency.enable);else{var x=new u(void 0,void 0,void 0,void 0,!0,!0),P=U;P.longitude=.5*(t.east+t.west);P.latitude=.5*(t.north+t.south);P.height=O;x.center=w.cartographicToCartesian(P,x.center);var I=5,Y;Y=r.westMeshes;N=0;for(F=Y.length;N<F;++N)I+=Y[N].eastIndicesNorthToSouth.length;Y=r.southMeshes;N=0;for(F=Y.length;N<F;++N)I+=Y[N].northIndicesWestToEast.length;Y=r.eastMeshes;N=0;for(F=Y.length;N<F;++N)I+=Y[N].westIndicesSouthToNorth.length;Y=r.northMeshes;N=0;for(F=Y.length;N<F;++N)I+=Y[N].southIndicesEastToWest.length;var Z=S;Z.minimumHeight=J;Z.maximumHeight=L;N=x.getStride();I=new Float32Array(I*N);F=Y=0;Y=H(w,t,x,I,Y,0,1,v.height,v.encodedNormal,1,Z);v=Y=K(r,w,x,I,Y,r.westTiles,r.westMeshes,c.EAST,Z);Y=H(w,t,x,I,Y,0,0,B.height,B.encodedNormal,0,Z);B=Y=K(r,w,x,I,Y,r.southTiles,r.southMeshes,c.NORTH,Z);Y=H(w,t,x,I,Y,1,0,G.height,G.encodedNormal,0,Z);G=Y=K(r,w,x,I,Y,r.eastTiles,r.eastMeshes,c.WEST,Z);Y=H(w,t,x,I,Y,1,1,D.height,D.encodedNormal,1,Z);Y=K(r,w,x,I,Y,r.northTiles,r.northMeshes,c.SOUTH,Z);var J=Z.minimumHeight,L=Z.maximumHeight,D=q.fromRectangle(t,J,L,l.tilingScheme.ellipsoid),Z=A.geodeticLatitudeToMercatorAngle(t.south),W=1/(A.geodeticLatitudeToMercatorAngle(t.north)-Z),Z=(A.geodeticLatitudeToMercatorAngle(P.latitude)-Z)*W;w.geodeticSurfaceNormalCartographic(aa,M);w=b.octEncode(M,R);P=Y;x.encode(I,Y*N,D.center,k.fromElements(.5,.5,Q),O,w,Z);++Y;w=Y;O=3*(w-1);(I.length-w*N)*Float32Array.BYTES_PER_ELEMENT>=O*(256>w?1:2)?(Y=w*N*Float32Array.BYTES_PER_ELEMENT,O=256>w?new Uint8Array(I.buffer,Y,O):new Uint16Array(I.buffer,Y,O)):O=256>w?new Uint8Array(O):new Uint16Array(O);I=new Float32Array(I.buffer,0,w*N);for(N=Y=0;N<w-2;++N)O[Y++]=P,O[Y++]=N,O[Y++]=N+1;O[Y++]=P;O[Y++]=N;O[Y++]=0;w=[];for(N=v;N>=F;--N)w.push(N);F=[];for(N=B;N>=v;--N)F.push(N);v=[];for(N=G;N>=B;--N)v.push(N);B=[];B.push(0);for(N=P-1;N>=G;--N)B.push(N);G=x.center;N=L;P=f.fromOrientedBoundingBox(D);Y=D.center;var Z=a.quadtree._occluders.ellipsoid,W=Z.ellipsoid,X=na;g.fromRadians(t.west,t.south,L,W,X[0]);g.fromRadians(t.east,t.south,L,W,X[1]);g.fromRadians(t.west,t.north,L,W,X[2]);g.fromRadians(t.east,t.north,L,W,X[3]);t=Z.computeHorizonCullingPoint(Y,X,void 0);r.mesh=new y(G,I,O,J,N,P,t,x.getStride(),D,x,d.terrainExaggeration,w,F,v,B)}t=d.context;e(r.vertexArray)&&(e(m)?m.push(r.vertexArray):z._freeVertexArray(r.vertexArray));r.vertexArray=z._createVertexArrayForMesh(t,r.mesh);p.processImagery(l,a.terrainProvider,d,!0);d=r.waterMaskTexture;r.waterMaskTexture=void 0;a.terrainProvider.hasWaterMask&&(a=p._findAncestorTileWithTerrainData(l),e(a)&&e(a.data.waterMaskTexture)&&(r.waterMaskTexture=a.data.waterMaskTexture,++r.waterMaskTexture.referenceCount,p._computeWaterMaskTranslationAndScale(l,a,r.waterMaskTranslationAndScale)));e(d)&&(--d.referenceCount,0===d.referenceCount&&d.destroy())}function H(a,b,c,d,e,f,g,h,k,l,m){var q=aa;q.longitude=p.lerp(b.west,b.east,f);q.latitude=p.lerp(b.south,b.north,g);q.height=h;a=a.cartographicToCartesian(q,W);b=Y;b.x=f;b.y=g;c.encode(d,e*c.getStride(),a,b,h,k,l);m.minimumHeight=Math.min(m.minimumHeight,h);m.maximumHeight=Math.max(m.maximumHeight,h);return e+1}function F(a,b,c,d){var e=a.rectangle,f=b.rectangle;0===b.x&&1===c.x&&a.x===a.tilingScheme.getNumberOfXTilesAtLevel(a.level)-1?(e=r.clone(a.rectangle,X),e.west-=p.TWO_PI,e.east-=p.TWO_PI):0===a.x&&0===c.x&&b.x===b.tilingScheme.getNumberOfXTilesAtLevel(b.level)-1&&(e=r.clone(a.rectangle,X),e.west+=p.TWO_PI,e.east+=p.TWO_PI);var g=e.east-e.west,h=(f.west-e.west)/g;a=e.north-e.south;b=(f.south-e.south)/a;g=(c.x-h)/((f.east-e.west)/g-h);c=(c.y-b)/((f.north-e.south)/a-b);Math.abs(g)<Math.EPSILON5?g=0:Math.abs(g-1)<Math.EPSILON5&&(g=1);Math.abs(c)<Math.EPSILON5?c=0:Math.abs(c-1)<Math.EPSILON5&&(c=1);d.x=g;d.y=c;return d}function w(a,b,c,d,e){c=a.encoding;a=a.vertices;e.height=c.decodeHeight(a,b);c.hasVertexNormals?c.getOctEncodedNormal(a,b,e.encodedNormal):(b=e.encodedNormal,b.x=0,b.y=0)}function G(a,c,d,e,f,h,k,l,m,q){var r=e.encoding;e=e.vertices;var t=F(c,d,r.decodeTextureCoordinates(e,f,Q),Q);c=F(c,d,r.decodeTextureCoordinates(e,h,Y),Y);m=m?(k-t.x)/(c.x-t.x):(l-t.y)/(c.y-t.y);c=r.decodeHeight(e,f);t=r.decodeHeight(e,h);d=d.rectangle;aa.longitude=p.lerp(d.west,d.east,k);aa.latitude=p.lerp(d.south,d.north,l);q.height=aa.height=p.lerp(c,t,m);r.hasVertexNormals?(a=r.getOctEncodedNormal(e,f,fa),h=r.getOctEncodedNormal(e,h,ga),r=b.octDecode(a.x,a.y,W),h=b.octDecode(h.x,h.y,ka),h=g.lerp(r,h,m,W),g.normalize(h,h)):h=a.geodeticSurfaceNormalCartographic(aa,W);b.octEncode(h,q.encodedNormal)}function E(a,d,f,g,h,k,l,m,p,q,r){if(O(a,d,m,l,!1,f,g,r)||O(a,d,q,p,!0,f,g,r))return r;if(N(h,k))return d=0===f?0===g?k.eastIndicesNorthToSouth[0]:k.southIndicesEastToWest[0]:0===g?k.northIndicesWestToEast[0]:k.westIndicesSouthToNorth[0],w(k,d,f,g,r),r;f=0===f?0===g?L(a.westMeshes,a.westTiles,c.EAST,a.southMeshes,a.southTiles,c.NORTH,f,g):L(a.northMeshes,a.northTiles,c.SOUTH,a.westMeshes,a.westTiles,c.EAST,f,g):0===g?L(a.southMeshes,a.southTiles,c.NORTH,a.eastMeshes,a.eastTiles,c.WEST,f,g):L(a.eastMeshes,a.eastTiles,c.WEST,a.northMeshes,a.northTiles,c.SOUTH,f,g);if(e(f))return r.height=f,d=d.geodeticSurfaceNormalCartographic(aa,W),b.octEncode(d,r.encodedNormal),r}function L(a,b,c,d,f,g,h,k){a=P(a,b,!1,c,h,k);d=P(d,f,!0,g,h,k);return e(a)&&e(d)?.5*(a+d):e(a)?a:d}function K(a,b,d,e,f,g,h,k,l){for(b=0;b<g.length;++b){var m=a,q=d,t=e,w=g[b],u=h[b],v=k,y=l,z;v===c.EAST&&0===m.tile.x?(z=r.clone(w.rectangle,X),z.west-=p.TWO_PI,z.east-=p.TWO_PI):v===c.WEST&&0===w.x&&(z=r.clone(w.rectangle,X),z.west+=p.TWO_PI,z.east+=p.TWO_PI);z=m.tile.rectangle;var E=void 0,C=void 0;0<f&&(q.decodeTextureCoordinates(t,f-1,Q),E=Q.x,C=Q.y);var B=void 0,G=void 0;switch(v){case c.WEST:B=u.westIndicesSouthToNorth;G=!1;break;case c.NORTH:B=u.northIndicesWestToEast;G=!0;break;case c.EAST:B=u.eastIndicesNorthToSouth;G=!1;break;case c.SOUTH:B=u.southIndicesEastToWest,G=!0}var m=m.tile,v=u.encoding,u=u.vertices,D=q.getStride(),x=void 0,H=void 0;v.hasWebMercatorT&&(x=A.geodeticLatitudeToMercatorAngle(z.south),H=1/(A.geodeticLatitudeToMercatorAngle(z.north)-x));for(var L=0;L<B.length;++L){var I=B[L],K=v.decodeTextureCoordinates(u,I,Q);F(w,m,K,K);var J=K.x,O=K.y,N=G?J:O;if(!(0>N||1<N||Math.abs(J-E)<p.EPSILON5&&Math.abs(O-C)<p.EPSILON5||(N=Math.abs(O)<p.EPSILON5||Math.abs(O-1)<p.EPSILON5,(Math.abs(J)<p.EPSILON5||Math.abs(J-1)<p.EPSILON5)&&N))){J=v.decodePosition(u,I,W);N=v.decodeHeight(u,I);v.hasVertexNormals?I=v.getOctEncodedNormal(u,I,R):(I=R,I.x=0,I.y=0);var M=O;v.hasWebMercatorT&&(O=p.lerp(z.south,z.north,O),M=(A.geodeticLatitudeToMercatorAngle(O)-x)*H);q.encode(t,f*D,J,K,N,I,M);y.minimumHeight=Math.min(y.minimumHeight,N);y.maximumHeight=Math.max(y.maximumHeight,N);++f}}}return f}function P(a,b,d,f,g,h){var k;d?(k=0,g=a.length,h=1):(k=a.length-1,h=g=-1);for(;k!==g;k+=h){var l=a[k];if(N(b[k],l)){var m;switch(f){case c.WEST:m=l.westIndicesSouthToNorth;break;case c.SOUTH:m=l.southIndicesEastToWest;break;case c.EAST:m=l.eastIndicesNorthToSouth;break;case c.NORTH:m=l.northIndicesWestToEast}var p=m[d?0:m.length-1];if(e(p))return l.encoding.decodeHeight(l.vertices,p)}}}function N(a,b){return e(b)&&(!e(a.data.fill)||!a.data.fill.changedThisFrame)}function O(b,c,d,e,f,g,h,k){var l,m,p=e[f?0:d.length-1],q=d[f?0:d.length-1];if(N(p,q)&&(0===g?0===h?(d=f?q.northIndicesWestToEast:q.eastIndicesNorthToSouth,m=l=f):(d=f?q.eastIndicesNorthToSouth:q.southIndicesEastToWest,l=!f,m=!1):0===h?(d=f?q.westIndicesSouthToNorth:q.northIndicesWestToEast,l=!f,m=!0):(d=f?q.southIndicesEastToWest:q.westIndicesSouthToNorth,l=f,m=!f),0<d.length)){f=f?0:d.length-1;f=d[f];q.encoding.decodeTextureCoordinates(q.vertices,f,Q);e=F(p,b.tile,Q,Q);if(e.x===g&&e.y===h)return w(q,f,g,h,k),!0;f=a(d,l?g:h,function(a,c){q.encoding.decodeTextureCoordinates(q.vertices,a,Q);var d=F(p,b.tile,Q,Q);return m?l?d.x-g:d.y-h:l?g-d.x:h-d.y});if(0>f){if(f=~f,0<f&&f<d.length)return G(c,p,b.tile,q,d[f-1],d[f],g,h,l,k),!0}else return w(q,d[f],g,h,k),!0}return!1}D.prototype.update=function(a,b,c){this.changedThisFrame&&(I(a,b,this.tile,c),this.changedThisFrame=!1)};D.prototype.destroy=function(a){e(this.vertexArray)&&(e(a)?a.push(this.vertexArray):z._freeVertexArray(this.vertexArray,a),this.vertexArray=void 0);e(this.waterMaskTexture)&&(--this.waterMaskTexture.referenceCount,0===this.waterMaskTexture.referenceCount&&this.waterMaskTexture.destroy(),this.waterMaskTexture=void 0)};var Z=new t;D.updateFillTiles=function(a,b,d,f){var g=a._quadtree,h=g._levelZeroTiles,g=g._lastSelectionFrameNumber;Z.clear();for(var k=0;k<b.length;++k)e(b[k].data.vertexArray)&&Z.enqueue(b[k]);for(b=Z.dequeue();void 0!==b;){var l=b.findTileToWest(h),m=b.findTileToSouth(h),k=b.findTileToEast(h),p=b.findTileToNorth(h);v(a,d,b,l,g,c.EAST,!1,Z,f);v(a,d,b,m,g,c.NORTH,!1,Z,f);v(a,d,b,k,g,c.WEST,!1,Z,f);v(a,d,b,p,g,c.SOUTH,!1,Z,f);m=l.findTileToNorth(h);l=l.findTileToSouth(h);p=k.findTileToNorth(h);k=k.findTileToSouth(h);v(a,d,b,m,g,c.SOUTHEAST,!1,Z,f);v(a,d,b,p,g,c.SOUTHWEST,!1,Z,f);v(a,d,b,l,g,c.NORTHEAST,!1,Z,f);v(a,d,b,k,g,c.NORTHWEST,!1,Z,f);b=Z.dequeue()}};var aa=new m,U=new m,W=new g,M=new g,R=new k,Y=new k,Q=new k,S={minimumHeight:0,maximumHeight:0},ca=new B,T=new B,da=new B,V=new B,ba="undefined"!==typeof Uint8Array?new Uint8Array(81):void 0,X=new r,fa=new k,ga=new k,ka=new g,na=[new g,new g,new g,new g];return D});F("Scene/GlobeSurfaceTileProvider","../Core/BoundingSphere ../Core/BoxOutlineGeometry ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/combine ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Event ../Core/GeometryInstance ../Core/GeometryPipeline ../Core/IndexDatatype ../Core/Intersect ../Core/Math ../Core/Matrix4 ../Core/OrientedBoundingBox ../Core/OrthographicFrustum ../Core/PrimitiveType ../Core/Rectangle ../Core/SphereOutlineGeometry ../Core/TerrainMesh ../Core/TerrainQuantization ../Core/Visibility ../Core/WebMercatorProjection ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Pass ../Renderer/RenderState ../Renderer/VertexArray ./BlendingState ./ImageryState ./TileBoundingRegion ./TileSelectionResult ./ClippingPlaneCollection ./DepthFunction ./GlobeSurfaceTile ./ImageryLayer ./PerInstanceColorAppearance ./Primitive ./QuadtreeTileLoadState ./SceneMode ./ShadowMode ./TerrainFillMesh ./TerrainState".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,F,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga){function J(a){if(!d(a))throw new r("options is required.");if(d(a.terrainProvider)){if(!d(a.imageryLayers))throw new r("options.imageryLayers is required.");if(!d(a.surfaceShaderSet))throw new r("options.surfaceShaderSet is required.");}else throw new r("options.terrainProvider is required.");this.lightingFadeOutDistance=65E5;this.lightingFadeInDistance=9E6;this.hasWaterMask=!1;this.oceanNormalMap=void 0;this.zoomedOutOceanSpecularIntensity=.5;this.showGroundAtmosphere=this.enableLighting=!1;this.shadows=X.RECEIVE_ONLY;this.fillHighlightColor=void 0;this.brightnessShift=this.saturationShift=this.hueShift=0;this._quadtree=void 0;this._terrainProvider=a.terrainProvider;this._imageryLayers=a.imageryLayers;this._surfaceShaderSet=a.surfaceShaderSet;this._blendRenderState=this._renderState=void 0;this._errorEvent=new c;this._imageryLayers.layerAdded.addEventListener(J.prototype._onLayerAdded,this);this._imageryLayers.layerRemoved.addEventListener(J.prototype._onLayerRemoved,this);this._imageryLayers.layerMoved.addEventListener(J.prototype._onLayerMoved,this);this._imageryLayers.layerShownOrHidden.addEventListener(J.prototype._onLayerShownOrHidden,this);this._imageryLayersUpdatedEvent=new c;this._layerOrderChanged=!1;this._tilesToRenderByTextureCount=[];this._drawCommands=[];this._uniformMaps=[];this._usedDrawCommands=0;this._vertexArraysToDestroy=[];this._debug={wireframe:!1,boundingSphereTile:void 0};this._firstPassInitialColor=this._baseColor=void 0;this.baseColor=new m(0,0,.5,1);this._clippingPlanes=void 0;this.cartographicLimitRectangle=I.clone(I.MAX_VALUE);this._hasFillTilesThisFrame=this._hasLoadedTilesThisFrame=!1}function na(a,b){var c=a.loadingImagery;d(c)||(c=a.readyImagery);var e=b.loadingImagery;d(e)||(e=b.readyImagery);return c.imageryLayer._layerIndex-e.imageryLayer._layerIndex}function ia(a,b){var c=b.creditDisplay;a._terrainProvider.ready&&d(a._terrainProvider.credit)&&c.addCredit(a._terrainProvider.credit);for(var e=a._imageryLayers,f=0,g=e.length;f<g;++f){var h=e.get(f).imageryProvider;h.ready&&d(h.credit)&&c.addCredit(h.credit)}}function la(a,b){if(b.west<b.east)return b;var c=I.clone(b,ua);0<I.center(a,ta).longitude?c.east=x.PI:c.west=-x.PI;return c}function ha(a,b,c){return function(e){var f,g=-1,h=e.data.imagery,k=h.length,l;for(l=0;l<k;++l)if(f=h[l],f=p(f.readyImagery,f.loadingImagery),f.imageryLayer===b){g=l;break}if(-1!==g){k=g+a;f=h[k];f=d(f)?p(f.readyImagery,f.loadingImagery):void 0;if(!d(f)||f.imageryLayer!==b)return!b._createTileImagerySkeletons(e,c,k);for(l=g;l<k;++l)h[l].freeResources();h.splice(g,a)}return!0}}function pa(a,b){return{u_initialColor:function(){return this.properties.initialColor},u_fillHighlightColor:function(){return this.properties.fillHighlightColor},u_zoomedOutOceanSpecularIntensity:function(){return this.properties.zoomedOutOceanSpecularIntensity},u_oceanNormalMap:function(){return this.properties.oceanNormalMap},u_lightingFadeDistance:function(){return this.properties.lightingFadeDistance},u_nightFadeDistance:function(){return this.properties.nightFadeDistance},u_center3D:function(){return this.properties.center3D},u_tileRectangle:function(){return this.properties.tileRectangle},u_modifiedModelView:function(){var b=a.context.uniformState.view,c=D.multiplyByPoint(b,this.properties.rtc,ya);D.setTranslation(b,c,Ba);return Ba},u_modifiedModelViewProjection:function(){var b=a.context.uniformState.view,c=a.context.uniformState.projection,d=D.multiplyByPoint(b,this.properties.rtc,ya);D.setTranslation(b,d,ra);D.multiply(c,ra,ra);return ra},u_dayTextures:function(){return this.properties.dayTextures},u_dayTextureTranslationAndScale:function(){return this.properties.dayTextureTranslationAndScale},u_dayTextureTexCoordsRectangle:function(){return this.properties.dayTextureTexCoordsRectangle},u_dayTextureUseWebMercatorT:function(){return this.properties.dayTextureUseWebMercatorT},u_dayTextureAlpha:function(){return this.properties.dayTextureAlpha},u_tansparency:function(){return a.context.uniformState.surfaceTansparency.tansparency},u_dayTextureBrightness:function(){return this.properties.dayTextureBrightness},u_dayTextureContrast:function(){return this.properties.dayTextureContrast},u_dayTextureHue:function(){return this.properties.dayTextureHue},u_dayTextureSaturation:function(){return this.properties.dayTextureSaturation},u_dayTextureOneOverGamma:function(){return this.properties.dayTextureOneOverGamma},u_dayIntensity:function(){return this.properties.dayIntensity},u_southAndNorthLatitude:function(){return this.properties.southAndNorthLatitude},u_southMercatorYAndOneOverHeight:function(){return this.properties.southMercatorYAndOneOverHeight},u_waterMask:function(){return this.properties.waterMask},u_waterMaskTranslationAndScale:function(){return this.properties.waterMaskTranslationAndScale},u_minMaxHeight:function(){return this.properties.minMaxHeight},u_scaleAndBias:function(){return this.properties.scaleAndBias},u_dayTextureSplit:function(){return this.properties.dayTextureSplit},u_dayTextureCutoutRectangles:function(){return this.properties.dayTextureCutoutRectangles},u_clippingPlanes:function(){var c=b._clippingPlanes;return d(c)&&d(c.texture)?c.texture:a.context.defaultTexture},u_cartographicLimitRectangle:function(){return this.properties.localizedCartographicLimitRectangle},u_clippingPlanesMatrix:function(){var c=b._clippingPlanes;return d(c)?D.multiply(a.context.uniformState.view,c.modelMatrix,Va):D.IDENTITY},u_clippingPlanesEdgeStyle:function(){var a=this.properties.clippingPlanesEdgeColor;a.alpha=this.properties.clippingPlanesEdgeWidth;return a},u_minimumBrightness:function(){return a.fog.minimumBrightness},u_hsbShift:function(){return this.properties.hsbShift},u_colorsToAlpha:function(){return this.properties.colorsToAlpha},properties:{initialColor:new g(0,0,.5,1),fillHighlightColor:new m(0,0,0,0),zoomedOutOceanSpecularIntensity:.5,oceanNormalMap:void 0,lightingFadeDistance:new f(65E5,9E6),nightFadeDistance:new f(1E7,4E7),hsbShift:new k,center3D:void 0,rtc:new k,modifiedModelView:new D,tileRectangle:new g,dayTextures:[],dayTextureTranslationAndScale:[],dayTextureTexCoordsRectangle:[],dayTextureUseWebMercatorT:[],dayTextureAlpha:[],dayTextureBrightness:[],dayTextureContrast:[],dayTextureHue:[],dayTextureSaturation:[],dayTextureOneOverGamma:[],dayTextureSplit:[],dayTextureCutoutRectangles:[],dayIntensity:0,colorsToAlpha:[],tansparency:1,southAndNorthLatitude:new f,southMercatorYAndOneOverHeight:new f,waterMask:void 0,waterMaskTranslationAndScale:new g,minMaxHeight:new f,scaleAndBias:new D,clippingPlanesEdgeColor:m.clone(m.WHITE),clippingPlanesEdgeWidth:0,localizedCartographicLimitRectangle:new g}}}q(J.prototype,{baseColor:{get:function(){return this._baseColor},set:function(a){if(!d(a))throw new r("value is required.");this._baseColor=a;this._firstPassInitialColor=g.fromColor(a,this._firstPassInitialColor)}},quadtree:{get:function(){return this._quadtree},set:function(a){if(!d(a))throw new r("value is required.");this._quadtree=a}},ready:{get:function(){return this._terrainProvider.ready&&(0===this._imageryLayers.length||this._imageryLayers.get(0).imageryProvider.ready)}},tilingScheme:{get:function(){return this._terrainProvider.tilingScheme}},errorEvent:{get:function(){return this._errorEvent}},imageryLayersUpdatedEvent:{get:function(){return this._imageryLayersUpdatedEvent}},terrainProvider:{get:function(){return this._terrainProvider},set:function(a){if(this._terrainProvider!==a){if(!d(a))throw new r("terrainProvider is required.");this._terrainProvider=a;d(this._quadtree)&&this._quadtree.invalidateAllTiles()}}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(a){Y.setOwner(a,this,"_clippingPlanes")}}});J.prototype.update=function(a){this._imageryLayers._update()};J.prototype.initialize=function(a){this._imageryLayers.queueReprojectionCommands(a);this._layerOrderChanged&&(this._layerOrderChanged=!1,this._quadtree.forEachLoadedTile(function(a){a.data.imagery.sort(na)}));ia(this,a);a=this._vertexArraysToDestroy;for(var b=a.length,c=0;c<b;++c)S._freeVertexArray(a[c]);a.length=0};J.prototype.beginUpdate=function(a){for(var b=this._tilesToRenderByTextureCount,c=0,e=b.length;c<e;++c){var f=b[c];d(f)&&(f.length=0)}b=this._clippingPlanes;d(b)&&b.enabled&&b.update(a);this._usedDrawCommands=0;this._hasFillTilesThisFrame=this._hasLoadedTilesThisFrame=!1};J.prototype.endUpdate=function(a){d(this._renderState)||(this._renderState=Z.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:Q.LESS}}),this._blendRenderState=Z.fromCache({cull:{enabled:!0},depthTest:{enabled:!0,func:Q.LESS_OR_EQUAL},blending:U.ALPHA_BLEND}));this._hasFillTilesThisFrame&&this._hasLoadedTilesThisFrame&&fa.updateFillTiles(this,this._quadtree._tilesToRender,a,this._vertexArraysToDestroy);for(var c=this._tilesToRenderByTextureCount,e=0,f=c.length;e<f;++e){var l=c[e];if(d(l))for(var p=0,q=l.length;p<q;++p){var t=l[p],u=a,z=t.data;d(z.vertexArray)||(void 0===z.fill&&(z.fill=new fa(t)),z.fill.update(this,u));var B=u.creditDisplay,G=z.terrainData;if(d(G)&&d(G.credits))for(var H=G.credits,J=0,F=H.length;J<F;++J)B.addCredit(H[J]);var R=P.maximumTextureImageUnits,M=z.waterMaskTexture,Y=z.waterMaskTranslationAndScale;!d(M)&&d(z.fill)&&(M=z.fill.waterMaskTexture,Y=z.fill.waterMaskTranslationAndScale);var S=this.hasWaterMask&&d(M),W=this.oceanNormalMap,T=S&&d(W),V=this.terrainProvider.ready&&this.terrainProvider.hasVertexNormals,da=u.fog.enabled,ta=this.showGroundAtmosphere,ga=X.castShadows(this.shadows),wa=X.receiveShadows(this.shadows),ia=this.hueShift,ha=this.saturationShift,Fa=this.brightnessShift,ka=!(x.equalsEpsilon(ia,0,x.EPSILON7)&&x.equalsEpsilon(ha,0,x.EPSILON7)&&x.equalsEpsilon(Fa,0,x.EPSILON7)),na=!1;if(ta){var oa=u.mode,za=u.camera,ra;ra=oa===ba.SCENE2D||oa===ba.COLUMBUS_VIEW?za.positionCartographic.height:k.magnitude(za.positionWC);var Da=this.nightFadeOutDistance;oa!==ba.SCENE3D&&(Da-=u.mapProjection.ellipsoid.maximumRadius);na=ra>Da}S&&--R;T&&--R;var Ba=z.renderedMesh,ua=Ba.center,ya=Ba.encoding,sa=Ea,Va=0,Pa=0,pb=0,ab=0,Ab=!1;if(u.mode!==ba.SCENE3D){var qb=u.mapProjection,yc=qb.project(I.southwest(t.rectangle),Aa),vb=qb.project(I.northeast(t.rectangle),Ua);sa.x=yc.x;sa.y=yc.y;sa.z=vb.x;sa.w=vb.y;u.mode!==ba.MORPHING&&(ua=Ca,ua.x=0,ua.y=.5*(sa.z+sa.x),ua.z=.5*(sa.w+sa.y),sa.x-=ua.y,sa.y-=ua.z,sa.z-=ua.y,sa.w-=ua.z);if(u.mode===ba.SCENE2D&&ya.quantization===w.BITS12){var vc=1/(Math.pow(2,12)-1)*.5,ma=(sa.z-sa.x)*vc,Ib=(sa.w-sa.y)*vc;sa.x-=ma;sa.y-=Ib;sa.z+=ma;sa.w+=Ib}qb instanceof E&&(Va=t.rectangle.south,Pa=t.rectangle.north,pb=E.geodeticLatitudeToMercatorAngle(Va),ab=1/(E.geodeticLatitudeToMercatorAngle(Pa)-pb),Ab=!0)}var ib=La;ib.frameState=u;ib.surfaceTile=z;ib.showReflectiveOcean=S;ib.showOceanWaves=T;ib.enableLighting=this.enableLighting;ib.showGroundAtmosphere=ta;ib.perFragmentGroundAtmosphere=na;ib.hasVertexNormals=V;ib.useWebMercatorProjection=Ab;ib.clippedByBoundaries=z.clippedByBoundaries;var zc=z.imagery,Bc=0,Ec=zc.length,nc=this._blendRenderState,gc=this._renderState;u.context.uniformState.surfaceTansparency.enable&&(gc=nc);var hc=this._firstPassInitialColor,Fc=u.context;d(this._debug.boundingSphereTile)||Ma();do{var mb=0,gb,Zb;this._drawCommands.length<=this._usedDrawCommands?(gb=new N,gb.owner=t,gb.cull=!1,gb.boundingVolume=new b,gb.orientedBoundingBox=void 0,Zb=pa(u,this),this._drawCommands.push(gb),this._uniformMaps.push(Zb)):(gb=this._drawCommands[this._usedDrawCommands],Zb=this._uniformMaps[this._usedDrawCommands]);gb.owner=t;++this._usedDrawCommands;if(t===this._debug.boundingSphereTile){var Gc=z.orientedBoundingBox;d(Gc)?xa(Gc,m.RED).update(u):d(Ba)&&d(Ba.boundingSphere3D)&&Ha(Ba.boundingSphere3D,m.RED).update(u)}var Na=Zb.properties;g.clone(hc,Na.initialColor);Na.oceanNormalMap=W;Na.lightingFadeDistance.x=this.lightingFadeOutDistance;Na.lightingFadeDistance.y=this.lightingFadeInDistance;Na.nightFadeDistance.x=this.nightFadeOutDistance;Na.nightFadeDistance.y=this.nightFadeInDistance;Na.zoomedOutOceanSpecularIntensity=this.zoomedOutOceanSpecularIntensity;var Ob=!d(z.vertexArray)&&d(this.fillHighlightColor)&&0<this.fillHighlightColor.alpha;Ob&&m.clone(this.fillHighlightColor,Na.fillHighlightColor);Na.center3D=Ba.center;k.clone(ua,Na.rtc);g.clone(sa,Na.tileRectangle);Na.southAndNorthLatitude.x=Va;Na.southAndNorthLatitude.y=Pa;Na.southMercatorYAndOneOverHeight.x=pb;Na.southMercatorYAndOneOverHeight.y=ab;var lb=Ga,nb=la(t.rectangle,this.cartographicLimitRectangle);k.fromElements(ia,ha,Fa,Na.hsbShift);var Cb=t.rectangle,wb=1/Cb.width,xb=1/Cb.height;lb.x=(nb.west-Cb.west)*wb;lb.y=(nb.south-Cb.south)*xb;lb.z=(nb.east-Cb.west)*wb;lb.w=(nb.north-Cb.south)*xb;g.clone(lb,Na.localizedCartographicLimitRectangle);for(var rb=da&&x.fog(t._distance,u.fog.density)>x.EPSILON3,ka=ka&&(rb||ta),yb=!1,oc=!1,sb=!1,Sb=!1,Pb=!1,$b=!1,Tc=!1,Db=!1,Eb=!1;mb<R&&Bc<Ec;){var eb=zc[Bc],ea=eb.readyImagery;++Bc;if(d(ea)&&0!==ea.imageryLayer.alpha){var Qb=eb.useWebMercatorT?ea.textureWebMercator:ea.texture;if(!d(Qb))throw new r("readyImagery is not actually ready!");var bb=ea.imageryLayer;d(eb.textureTranslationAndScale)||(eb.textureTranslationAndScale=bb._calculateTextureTranslationAndScale(t,eb));Na.dayTextures[mb]=Qb;Na.dayTextureTranslationAndScale[mb]=eb.textureTranslationAndScale;Na.dayTextureTexCoordsRectangle[mb]=eb.textureCoordinateRectangle;Na.dayTextureUseWebMercatorT[mb]=eb.useWebMercatorT;Na.dayTextureAlpha[mb]=bb.alpha;$b=$b||1!==Na.dayTextureAlpha[mb];Na.dayTextureBrightness[mb]=bb.brightness;yb=yb||Na.dayTextureBrightness[mb]!==ca.DEFAULT_BRIGHTNESS;Na.dayTextureContrast[mb]=bb.contrast;oc=oc||Na.dayTextureContrast[mb]!==ca.DEFAULT_CONTRAST;Na.dayTextureHue[mb]=bb.hue;sb=sb||Na.dayTextureHue[mb]!==ca.DEFAULT_HUE;Na.dayTextureSaturation[mb]=bb.saturation;Sb=Sb||Na.dayTextureSaturation[mb]!==ca.DEFAULT_SATURATION;Na.dayTextureOneOverGamma[mb]=1/bb.gamma;Pb=Pb||Na.dayTextureOneOverGamma[mb]!==1/ca.DEFAULT_GAMMA;Na.dayTextureSplit[mb]=bb.splitDirection;var Tc=Tc||0!==Na.dayTextureSplit[mb],cb=Na.dayTextureCutoutRectangles[mb];d(cb)||(cb=Na.dayTextureCutoutRectangles[mb]=new g);g.clone(g.ZERO,cb);if(d(bb.cutoutRectangle)){var Ya=la(Cb,bb.cutoutRectangle),Fb=I.simpleIntersection(Ya,Cb,qa),Db=d(Fb)||Db;cb.x=(Ya.west-Cb.west)*wb;cb.y=(Ya.south-Cb.south)*xb;cb.z=(Ya.east-Cb.west)*wb;cb.w=(Ya.north-Cb.south)*xb}var Ac=Na.colorsToAlpha[mb];d(Ac)||(Ac=Na.colorsToAlpha[mb]=new g);var Xa=d(bb.colorToAlpha)&&0<bb.colorToAlphaThreshold,Eb=Eb||Xa;if(Xa){var pc=bb.colorToAlpha;Ac.x=pc.red;Ac.y=pc.green;Ac.z=pc.blue;Ac.w=bb.colorToAlphaThreshold}else Ac.w=-1;if(d(ea.credits))for(var ic=ea.credits,ob=0,Kb=ic.length;ob<Kb;++ob)B.addCredit(ic[ob]);++mb}}Na.dayTextures.length=mb;Na.waterMask=M;g.clone(Y,Na.waterMaskTranslationAndScale);Na.minMaxHeight.x=ya.minimumHeight;Na.minMaxHeight.y=ya.maximumHeight;D.clone(ya.matrix,Na.scaleAndBias);var Rb=this._clippingPlanes,ub=d(Rb)&&Rb.enabled&&t.isClipped;ub&&(Na.clippingPlanesEdgeColor=m.clone(Rb.edgeColor,Na.clippingPlanesEdgeColor),Na.clippingPlanesEdgeWidth=Rb.edgeWidth);d(this.uniformMap)&&(Zb=h(Zb,this.uniformMap));ib.numberOfDayTextures=mb;ib.applyBrightness=yb;ib.applyContrast=oc;ib.applyHue=sb;ib.applySaturation=Sb;ib.applyGamma=Pb;ib.applyAlpha=$b;ib.applySplit=Tc;ib.enableFog=rb;ib.enableClippingPlanes=ub;ib.clippingPlanes=Rb;ib.hasImageryLayerCutout=Db;ib.colorCorrect=ka;ib.highlightFillTile=Ob;ib.colorToAlpha=Eb;gb.shaderProgram=this._surfaceShaderSet.getShaderProgram(ib);gb.castShadows=ga;gb.receiveShadows=wa;gb.renderState=gc;gb.primitiveType=C.TRIANGLES;gb.vertexArray=z.vertexArray||z.fill.vertexArray;gb.uniformMap=Zb;gb.pass=O.GLOBE;if(this._debug.wireframe){a:{var jc=Fc,jb=t.data,Jb=void 0,Gb=void 0;d(jb.vertexArray)?(Jb=jb.mesh,Gb=jb.vertexArray):d(jb.fill)&&d(jb.fill.vertexArray)&&(Jb=jb.fill.mesh,Gb=jb.fill.vertexArray);if(d(Jb)&&d(Gb)){if(d(jb.wireframeVertexArray)){if(jb.wireframeVertexArray.mesh===Jb)break a;jb.wireframeVertexArray.destroy();jb.wireframeVertexArray=void 0}var kb,Lb=jc,kc=Gb,Vb={indices:Jb.indices,primitiveType:C.TRIANGLES};y.toWireframe(Vb);var Tb=Vb.indices,fb=L.createIndexBuffer({context:Lb,typedArray:Tb,usage:K.STATIC_DRAW,indexDatatype:A.fromSizeInBytes(Tb.BYTES_PER_ELEMENT)});kb=new aa({context:Lb,attributes:kc._attributes,indexBuffer:fb});jb.wireframeVertexArray=kb;jb.wireframeVertexArray.mesh=Jb}}d(z.wireframeVertexArray)&&(gb.vertexArray=z.wireframeVertexArray,gb.primitiveType=C.LINES)}var zb=gb.boundingVolume,Mb=gb.orientedBoundingBox;if(u.mode!==ba.SCENE3D){var $a=z.tileBoundingRegion;b.fromRectangleWithHeights2D(t.rectangle,u.mapProjection,$a.minimumHeight,$a.maximumHeight,zb);k.fromElements(zb.center.z,zb.center.x,zb.center.y,zb.center);u.mode===ba.MORPHING&&b.union(Ba.boundingSphere3D,zb,zb)}else gb.boundingVolume=b.clone(Ba.boundingSphere3D,zb),gb.orientedBoundingBox=v.clone(z.orientedBoundingBox,Mb);gb.dirty=!0;u.commandList.push(gb);gc=nc;hc=Ia}while(Bc<Ec)}}};J.prototype.updateForPick=function(a){for(var b=this._drawCommands,c=0,d=this._usedDrawCommands;c<d;++c)a.commandList.push(b[c])};J.prototype.cancelReprojections=function(){this._imageryLayers.cancelReprojections()};J.prototype.getLevelMaximumGeometricError=function(a){return this._terrainProvider.getLevelMaximumGeometricError(a)};J.prototype.loadTile=function(a,b){var c=b.data,e=!0,f;d(c)&&(e=c.boundingVolumeSourceTile!==b||b._lastSelectionResult===R.CULLED_BUT_NEEDED,f=c.terrainState);S.processStateMachine(b,a,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,e);c=b.data;e&&f!==b.data.terrainState&&this.computeTileVisibility(b,a,this.quadtree.occluders)&&c.boundingVolumeSourceTile===b&&S.processStateMachine(b,a,this.terrainProvider,this._imageryLayers,this._vertexArraysToDestroy,!1)};var oa=new b,qa=new I,ua=new I,ta=new l;J.prototype.computeTileVisibility=function(a,c,e){var f=this.computeDistanceToTile(a,c);a._distance=f;if(c.fog.enabled&&1<=x.fog(f,c.fog.density))return G.NONE;var f=a.data,g=f.tileBoundingRegion;if(void 0===f.boundingVolumeSourceTile)return G.PARTIAL;var h=c.cullingVolume,l=f.orientedBoundingBox;!d(l)&&d(f.renderedMesh)&&(l=f.renderedMesh.boundingSphere3D);f.clippedByBoundaries=!1;var m=la(a.rectangle,this.cartographicLimitRectangle),m=I.simpleIntersection(m,a.rectangle,qa);if(!d(m))return G.NONE;I.equals(m,a.rectangle)||(f.clippedByBoundaries=!0);c.mode!==ba.SCENE3D&&(l=oa,b.fromRectangleWithHeights2D(a.rectangle,c.mapProjection,g.minimumHeight,g.maximumHeight,l),k.fromElements(l.center.z,l.center.x,l.center.y,l.center),c.mode===ba.MORPHING&&d(f.renderedMesh)&&(l=b.union(f.renderedMesh.boundingSphere3D,l,l)));if(!d(l))return z.INTERSECTING;g=this._clippingPlanes;if(d(g)&&g.enabled&&(g=g.computeIntersectionWithBoundingVolume(l),a.isClipped=g!==z.INSIDE,g===z.OUTSIDE))return G.NONE;a=h.computeVisibility(l);if(a===z.OUTSIDE)return G.NONE;h=c.mode===ba.SCENE3D&&c.camera.frustum instanceof B;return c.mode===ba.SCENE3D&&!h&&d(e)?(c=f.occludeePointInScaledSpace,!d(c)||e.ellipsoid.isScaledSpacePointVisible(c)?a:G.NONE):a};J.prototype.canRefine=function(a){return d(a.data.terrainData)?!0:void 0!==this.terrainProvider.getTileDataAvailable(2*a.x,2*a.y,a.level+1)};var wa=[],za=[];J.prototype.canRenderWithoutLosingDetail=function(a,b){var c=a.data;wa.length=this._imageryLayers.length;var e=!1,f=!1,g;d(c)&&(e=c.terrainState===ga.READY,f=!0,g=c.imagery);var h,c=0;for(h=wa.length;c<h;++c)wa[c]=f;if(d(g))for(c=0,h=g.length;c<h;++c){var f=g[c],k=f.loadingImagery,k=!d(k)||k.state===W.FAILED||k.state===W.INVALID,f=(f.loadingImagery||f.readyImagery).imageryLayer._layerIndex;wa[f]=k&&wa[f]}g=this.quadtree._lastSelectionFrameNumber;za.length=0;for(za.push(a.southwestChild,a.southeastChild,a.northwestChild,a.northeastChild);0<za.length;)if(c=za.pop(),h=c._lastSelectionResultFrame===g?c._lastSelectionResult:R.NONE,h===R.RENDERED){if(d(c.data)){if(!e&&c.data.terrainState===ga.READY)return!1;f=c.data.imagery;c=0;for(h=f.length;c<h;++c){var k=f[c],l=k.loadingImagery,l=!d(l)||l.state===W.FAILED||l.state===W.INVALID,k=(k.loadingImagery||k.readyImagery).imageryLayer._layerIndex;if(l&&!wa[k])return!1}}}else h===R.REFINED&&za.push(c.southwestChild,c.southeastChild,c.northwestChild,c.northeastChild);return!0};var Da=new k;J.prototype.computeTileLoadPriority=function(a,b){var c=a.data;if(void 0===c)return 0;var d=c.orientedBoundingBox;if(void 0===d)return 0;var c=b.camera.directionWC,d=k.subtract(d.center,b.camera.positionWC,Da),e=k.magnitude(d);if(e<x.EPSILON5)return 0;k.divideByScalar(d,e,d);return(1-k.dot(d,c))*a._distance};var Ba=new D,ra=new D,Ea=new g,Ga=new g,Ca=new k,ya=new k,Aa=new k,Ua=new k;J.prototype.showTileThisFrame=function(a,b){for(var c=0,e=a.data.imagery,f=0,g=e.length;f<g;++f){var h=e[f];d(h.readyImagery)&&0!==h.readyImagery.imageryLayer.alpha&&++c}e=this._tilesToRenderByTextureCount[c];d(e)||(e=[],this._tilesToRenderByTextureCount[c]=e);e.push(a);d(a.data.vertexArray)?this._hasLoadedTilesThisFrame=!0:this._hasFillTilesThisFrame=!0;e=this._debug;++e.tilesRendered;e.texturesRendered+=c};var sa=[new k,new k,new k,new k];J.prototype.computeDistanceToTile=function(a,b){var c;a:{var e=a.data;void 0===e&&(e=a.data=new S);void 0===e.tileBoundingRegion&&(e.tileBoundingRegion=new M({computeBoundingVolumes:!1,rectangle:a.rectangle,ellipsoid:a.tilingScheme.ellipsoid,minimumHeight:0,maximumHeight:0}));var f=e.terrainData;c=e.mesh;e=e.tileBoundingRegion;if(void 0!==c&&void 0!==c.minimumHeight&&void 0!==c.maximumHeight)e.minimumHeight=c.minimumHeight,e.maximumHeight=c.maximumHeight,c=a;else if(void 0!==f&&void 0!==f._minimumHeight&&void 0!==f._maximumHeight)e.minimumHeight=f._minimumHeight*b.terrainExaggeration,e.maximumHeight=f._maximumHeight*b.terrainExaggeration,c=a;else{e.minimumHeight=Number.NaN;e.maximumHeight=Number.NaN;for(f=a.parent;void 0!==f;){c=f.data;if(void 0!==c){var g=c.mesh;if(void 0!==g&&void 0!==g.minimumHeight&&void 0!==g.maximumHeight){e.minimumHeight=g.minimumHeight;e.maximumHeight=g.maximumHeight;c=f;break a}c=c.terrainData;if(void 0!==c&&void 0!==c._minimumHeight&&void 0!==c._maximumHeight){e.minimumHeight=c._minimumHeight*b.terrainExaggeration;e.maximumHeight=c._maximumHeight*b.terrainExaggeration;c=f;break a}}f=f.parent}c=void 0}}f=a.data;e=f.tileBoundingRegion;if(void 0===c)return 9999999999;if(f.boundingVolumeSourceTile!==c&&(f.boundingVolumeSourceTile=c,c=a.rectangle,d(c)&&c.width<x.PI_OVER_TWO+x.EPSILON5)){f.orientedBoundingBox=v.fromRectangle(a.rectangle,e.minimumHeight,e.maximumHeight,a.tilingScheme.ellipsoid,f.orientedBoundingBox);c=f.orientedBoundingBox.center;var g=a.rectangle,h=e.maximumHeight,l=f.occludeePointInScaledSpace,m=this.quadtree._occluders.ellipsoid,p=m.ellipsoid;k.fromRadians(g.west,g.south,h,p,sa[0]);k.fromRadians(g.east,g.south,h,p,sa[1]);k.fromRadians(g.west,g.north,h,p,sa[2]);k.fromRadians(g.east,g.north,h,p,sa[3]);c=m.computeHorizonCullingPoint(c,sa,l);f.occludeePointInScaledSpace=c}c=e.minimumHeight;g=e.maximumHeight;f.boundingVolumeSourceTile!==a&&(f=b.camera.positionCartographic.height,Math.abs(f-c)>Math.abs(f-g)?(e.minimumHeight=c,e.maximumHeight=c):(e.minimumHeight=g,e.maximumHeight=g));f=e.distanceToCamera(b);e.minimumHeight=c;e.maximumHeight=g;return f};J.prototype.isDestroyed=function(){return!1};J.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy();this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy();return t(this)};J.prototype._onLayerAdded=function(a,b){if(a.show){var c=this._terrainProvider,e=this,f=this._imageryLayersUpdatedEvent;a.imageryProvider._reload=function(){a._imageryCache={};e._quadtree.forEachLoadedTile(function(b){if(!d(b._loadedCallbacks[a._layerIndex])){var e,f=b.data.imagery,g=f.length,h=-1,k=0;for(e=0;e<g;++e){var l=f[e];if(p(l.readyImagery,l.loadingImagery).imageryLayer===a)-1===h&&(h=e),++k;else if(-1!==h)break}-1!==h&&a._createTileImagerySkeletons(b,c,h+k)&&(b._loadedCallbacks[a._layerIndex]=ha(k,a,c),b.state=V.LOADING)}})};this._quadtree.forEachLoadedTile(function(b){a._createTileImagerySkeletons(b,c)&&(b.state=V.LOADING,0===b.level||b._lastSelectionResultFrame===e.quadtree._lastSelectionFrameNumber&&b._lastSelectionResult===R.RENDERED||(b.renderable=!1))});this._layerOrderChanged=!0;f.raiseEvent()}};J.prototype._onLayerRemoved=function(a,b){this._quadtree.forEachLoadedTile(function(b){b=b.data.imagery;for(var c=-1,e=0,f=0,g=b.length;f<g;++f){var h=b[f],k=h.loadingImagery;d(k)||(k=h.readyImagery);if(k.imageryLayer===a)-1===c&&(c=f),h.freeResources(),++e;else if(-1!==c)break}-1!==c&&b.splice(c,e)});d(a.imageryProvider)&&(a.imageryProvider._reload=void 0);this._imageryLayersUpdatedEvent.raiseEvent()};J.prototype._onLayerMoved=function(a,b,c){this._layerOrderChanged=!0;this._imageryLayersUpdatedEvent.raiseEvent()};J.prototype._onLayerShownOrHidden=function(a,b,c){c?this._onLayerAdded(a,b):this._onLayerRemoved(a,b)};var Va=new D,xa,Ha,Ma;(function(){function b(a){return new da({geometryInstances:a,appearance:new T({translucent:!1,flat:!0}),asynchronous:!1})}var c=new u({geometry:a.fromDimensions({dimensions:new k(2,2,2)})}),f=new u({geometry:new H({radius:1})}),g=new D,h,l;xa=function(a,d){if(a===h)return l;Ma();h=a;g=D.fromRotationTranslation(a.halfAxes,a.center,g);c.modelMatrix=g;c.attributes.color=e.fromColor(d);return l=b(c)};Ha=function(a,c){if(a===h)return l;Ma();h=a;g=D.fromTranslation(a.center,g);g=D.multiplyByUniformScale(g,a.radius,g);f.modelMatrix=g;f.attributes.color=e.fromColor(c);return l=b(f)};Ma=function(){d(l)&&(l.destroy(),h=l=void 0)}})();var Ia=new g(0,0,0,0),La={frameState:void 0,surfaceTile:void 0,numberOfDayTextures:void 0,applyBrightness:void 0,applyContrast:void 0,applyHue:void 0,applySaturation:void 0,applyGamma:void 0,applyAlpha:void 0,applySplit:void 0,showReflectiveOcean:void 0,showOceanWaves:void 0,enableLighting:void 0,showGroundAtmosphere:void 0,perFragmentGroundAtmosphere:void 0,hasVertexNormals:void 0,useWebMercatorProjection:void 0,enableFog:void 0,enableClippingPlanes:void 0,clippingPlanes:void 0,clippedByBoundaries:void 0,hasImageryLayerCutout:void 0,colorCorrect:void 0,colorToAlpha:void 0};return J});F("Scene/ImageryLayerCollection","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Event ../Core/Math ../Core/Rectangle ../ThirdParty/when ./ImageryLayer".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(){this._layers=[];this.layerAdded=new l;this.layerRemoved=new l;this.layerMoved=new l;this.layerShownOrHidden=new l}function q(b,d){if(!a(d))throw new g("layer is required.");var c=b.indexOf(d);if(-1===c)throw new g("layer is not in this collection.");return c}function t(a,b,d){var c=a._layers;b=m.clamp(b,0,c.length-1);d=m.clamp(d,0,c.length-1);if(b!==d){var e=c[b];c[b]=c[d];c[d]=e;a._update();a.layerMoved.raiseEvent(e,d,b)}}f(d.prototype,{length:{get:function(){return this._layers.length}}});d.prototype.add=function(b,d){var c=a(d);if(!a(b))throw new g("layer is required.");if(c){if(0>d)throw new g("index must be greater than or equal to zero.");if(d>this._layers.length)throw new g("index must be less than or equal to the number of layers.");}c?this._layers.splice(d,0,b):(d=this._layers.length,this._layers.push(b));this._update();this.layerAdded.raiseEvent(b,d)};d.prototype.addImageryProvider=function(b,d){if(!a(b))throw new g("imageryProvider is required.");var c=new p(b);this.add(c,d);return c};d.prototype.remove=function(a,d){d=b(d,!0);var c=this._layers.indexOf(a);return-1!==c?(this._layers.splice(c,1),this._update(),this.layerRemoved.raiseEvent(a,c),d&&a.destroy(),!0):!1};d.prototype.removeAll=function(a){a=b(a,!0);for(var c=this._layers,d=0,e=c.length;d<e;d++){var f=c[d];this.layerRemoved.raiseEvent(f,d);a&&f.destroy()}this._layers=[]};d.prototype.contains=function(a){return-1!==this.indexOf(a)};d.prototype.indexOf=function(a){return this._layers.indexOf(a)};d.prototype.get=function(b){if(!a(b))throw new g("index is required.","index");return this._layers[b]};d.prototype.raise=function(a){a=q(this._layers,a);t(this,a,a+1)};d.prototype.lower=function(a){a=q(this._layers,a);t(this,a,a-1)};d.prototype.raiseToTop=function(a){var b=q(this._layers,a);b!==this._layers.length-1&&(this._layers.splice(b,1),this._layers.push(a),this._update(),this.layerMoved.raiseEvent(a,this._layers.length-1,b))};d.prototype.lowerToBottom=function(a){var b=q(this._layers,a);0!==b&&(this._layers.splice(b,1),this._layers.splice(0,0,a),this._update(),this.layerMoved.raiseEvent(a,0,b))};var r=new e;d.prototype.pickImageryLayerFeatures=function(b,d){var c=d.globe.pick(b,d);if(a(c)){for(var f=d.globe.ellipsoid.cartesianToCartographic(c),c=d.globe._surface._tilesToRender,g,k=0;!a(g)&&k<c.length;++k){var l=c[k];e.contains(l.rectangle,f)&&(g=l)}if(a(g)){for(var c=g.data.imagery,k=[],p=[],l=c.length-1;0<=l;--l){var q=c[l],t=q.readyImagery;if(a(t)){var u=t.imageryLayer.imageryProvider;if(a(u.pickFeatures)&&e.contains(t.rectangle,f)){var H=r,J=1/1024;H.west=m.lerp(g.rectangle.west,g.rectangle.east,q.textureCoordinateRectangle.x-J);H.east=m.lerp(g.rectangle.west,g.rectangle.east,q.textureCoordinateRectangle.z+J);H.south=m.lerp(g.rectangle.south,g.rectangle.north,q.textureCoordinateRectangle.y-J);H.north=m.lerp(g.rectangle.south,g.rectangle.north,q.textureCoordinateRectangle.w+J);e.contains(H,f)&&(q=u.pickFeatures(t.x,t.y,t.level,f.longitude,f.latitude),a(q)&&(k.push(q),p.push(t.imageryLayer)))}}}if(0!==k.length)return h.all(k,function(b){for(var c=[],d=0;d<b.length;++d){var e=b[d],g=p[d];if(a(e)&&0<e.length)for(var h=0;h<e.length;++h){var k=e[h];k.imageryLayer=g;a(k.position)||(k.position=f);c.push(k)}}return c})}}};d.prototype.queueReprojectionCommands=function(a){for(var b=this._layers,c=0,d=b.length;c<d;++c)b[c].queueReprojectionCommands(a)};d.prototype.cancelReprojections=function(){for(var a=this._layers,b=0,d=a.length;b<d;++b)a[b].cancelReprojections()};d.prototype.isDestroyed=function(){return!1};d.prototype.destroy=function(){this.removeAll(!0);return k(this)};d.prototype._update=function(){var b=!0,d=this._layers,e,f,g,h;g=0;for(h=d.length;g<h;++g)f=d[g],f._layerIndex=g,f.show?(f._isBaseLayer=b,b=!1):f._isBaseLayer=!1,f.show!==f._show&&(a(f._show)&&(a(e)||(e=[]),e.push(f)),f._show=f.show);if(a(e))for(g=0,h=e.length;g<h;++g)f=e[g],this.layerShownOrHidden.raiseEvent(f,f._layerIndex,f.show)};return d});F("Scene/QuadtreeOccluders",["../Core/Cartesian3","../Core/defineProperties","../Core/EllipsoidalOccluder"],function(b,a,f){function k(a){this._ellipsoid=new f(a.ellipsoid,b.ZERO)}a(k.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});return k});F("Scene/QuadtreeTile","../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Rectangle ./QuadtreeTileLoadState ./TileSelectionResult".split(" "),function(b,a,f,k,g,l){function m(a){if(!b(a))throw new f("options is required.");if(b(a.x)){if(!b(a.y))throw new f("options.y is required.");if(0>a.x||0>a.y)throw new f("options.x and options.y must be greater than or equal to zero.");}else throw new f("options.x is required.");if(!b(a.level))throw new f("options.level is required and must be greater than or equal to zero.");if(!b(a.tilingScheme))throw new f("options.tilingScheme is required.");this._tilingScheme=a.tilingScheme;this._x=a.x;this._y=a.y;this._level=a.level;this._parent=a.parent;this._rectangle=this._tilingScheme.tileXYToRectangle(this._x,this._y,this._level);this.replacementNext=this.replacementPrevious=this._northeastChild=this._northwestChild=this._southeastChild=this._southwestChild=void 0;this._loadPriority=this._distance=0;this._customData=[];this._frameUpdated=void 0;this._lastSelectionResult=l.NONE;this._lastSelectionResultFrame=void 0;this._loadedCallbacks={};this.state=g.START;this.upsampledFromParent=this.renderable=!1;this.data=void 0}function e(a){b(a)&&a.freeResources()}m.createLevelZeroTiles=function(a){if(!b(a))throw new f("tilingScheme is required.");for(var e=a.getNumberOfXTilesAtLevel(0),d=a.getNumberOfYTilesAtLevel(0),g=Array(e*d),h=0,k=0;k<d;++k)for(var c=0;c<e;++c)g[h++]=new m({tilingScheme:a,x:c,y:k,level:0});return g};m.prototype._updateCustomData=function(a,e,d){var f=this.customData,g,h,c;if(b(e)&&b(d)){this._customData=f=f.filter(function(a){return-1===d.indexOf(a)});c=this._rectangle;for(g=0;g<e.length;++g)h=e[g],k.contains(c,h.positionCartographic)&&f.push(h);this._frameUpdated=a}else if(a=this._parent,b(a)&&this._frameUpdated!==a._frameUpdated){f.length=0;c=this._rectangle;e=a.customData;for(g=0;g<e.length;++g)h=e[g],k.contains(c,h.positionCartographic)&&f.push(h);this._frameUpdated=a._frameUpdated}};a(m.prototype,{tilingScheme:{get:function(){return this._tilingScheme}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},level:{get:function(){return this._level}},parent:{get:function(){return this._parent}},rectangle:{get:function(){return this._rectangle}},children:{get:function(){return[this.northwestChild,this.northeastChild,this.southwestChild,this.southeastChild]}},southwestChild:{get:function(){b(this._southwestChild)||(this._southwestChild=new m({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y+1,level:this.level+1,parent:this}));return this._southwestChild}},southeastChild:{get:function(){b(this._southeastChild)||(this._southeastChild=new m({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y+1,level:this.level+1,parent:this}));return this._southeastChild}},northwestChild:{get:function(){b(this._northwestChild)||(this._northwestChild=new m({tilingScheme:this.tilingScheme,x:2*this.x,y:2*this.y,level:this.level+1,parent:this}));return this._northwestChild}},northeastChild:{get:function(){b(this._northeastChild)||(this._northeastChild=new m({tilingScheme:this.tilingScheme,x:2*this.x+1,y:2*this.y,level:this.level+1,parent:this}));return this._northeastChild}},customData:{get:function(){return this._customData}},needsLoading:{get:function(){return this.state<g.DONE}},eligibleForUnloading:{get:function(){var a=!0;b(this.data)&&(a=this.data.eligibleForUnloading,b(a)||(a=!0));return a}}});m.prototype.findLevelZeroTile=function(a,b,d){var e=this.tilingScheme.getNumberOfXTilesAtLevel(0);0>b?b+=e:b>=e&&(b-=e);if(!(0>d||d>=this.tilingScheme.getNumberOfYTilesAtLevel(0)))return a.filter(function(a){return a.x===b&&a.y===d})[0]};m.prototype.findTileToWest=function(a){var b=this.parent;if(void 0===b)return this.findLevelZeroTile(a,this.x-1,this.y);if(b.southeastChild===this)return b.southwestChild;if(b.northeastChild===this)return b.northwestChild;a=b.findTileToWest(a);if(void 0!==a)return b.southwestChild===this?a.southeastChild:a.northeastChild};m.prototype.findTileToEast=function(a){var b=this.parent;if(void 0===b)return this.findLevelZeroTile(a,this.x+1,this.y);if(b.southwestChild===this)return b.southeastChild;if(b.northwestChild===this)return b.northeastChild;a=b.findTileToEast(a);if(void 0!==a)return b.southeastChild===this?a.southwestChild:a.northwestChild};m.prototype.findTileToSouth=function(a){var b=this.parent;if(void 0===b)return this.findLevelZeroTile(a,this.x,this.y+1);if(b.northwestChild===this)return b.southwestChild;if(b.northeastChild===this)return b.southeastChild;a=b.findTileToSouth(a);if(void 0!==a)return b.southwestChild===this?a.northwestChild:a.northeastChild};m.prototype.findTileToNorth=function(a){var b=this.parent;if(void 0===b)return this.findLevelZeroTile(a,this.x,this.y-1);if(b.southwestChild===this)return b.northwestChild;if(b.southeastChild===this)return b.northeastChild;a=b.findTileToNorth(a);if(void 0!==a)return b.northwestChild===this?a.southwestChild:a.southeastChild};m.prototype.freeResources=function(){this.state=g.START;this.upsampledFromParent=this.renderable=!1;b(this.data)&&b(this.data.freeResources)&&this.data.freeResources();e(this._southwestChild);this._southwestChild=void 0;e(this._southeastChild);this._southeastChild=void 0;e(this._northwestChild);this._northwestChild=void 0;e(this._northeastChild);this._northeastChild=void 0};return m});F("Scene/TileReplacementQueue",["../Core/defined"],function(b){function a(){this.tail=this.head=void 0;this.count=0;this._lastBeforeStartOfFrame=void 0}function f(a,b){var f=b.replacementPrevious,g=b.replacementNext;b===a._lastBeforeStartOfFrame&&(a._lastBeforeStartOfFrame=g);b===a.head?a.head=g:f.replacementNext=g;b===a.tail?a.tail=f:g.replacementPrevious=f;b.replacementPrevious=void 0;b.replacementNext=void 0;--a.count}a.prototype.markStartOfRenderFrame=function(){this._lastBeforeStartOfFrame=this.head};a.prototype.trimTiles=function(a){for(var g=this.tail,k=!0;k&&b(this._lastBeforeStartOfFrame)&&this.count>a&&b(g);){var k=g!==this._lastBeforeStartOfFrame,m=g.replacementPrevious;g.eligibleForUnloading&&(g.freeResources(),f(this,g));g=m}};a.prototype.markTileRendered=function(a){var g=this.head;g===a?a===this._lastBeforeStartOfFrame&&(this._lastBeforeStartOfFrame=a.replacementNext):(++this.count,b(g)?((b(a.replacementPrevious)||b(a.replacementNext))&&f(this,a),a.replacementPrevious=void 0,a.replacementNext=g,this.head=g.replacementPrevious=a):(a.replacementPrevious=void 0,a.replacementNext=void 0,this.tail=this.head=a))};return a});F("Scene/QuadtreePrimitive","../Core/Cartesian3 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/getTimestamp ../Core/Math ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Core/Ray ../Core/Rectangle ../Core/Visibility ./QuadtreeOccluders ./QuadtreeTile ./QuadtreeTileLoadState ./SceneMode ./TileReplacementQueue ./TileSelectionResult".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){function v(a){if(!k(a)||!k(a.tileProvider))throw new l("options.tileProvider is required.");if(k(a.tileProvider.quadtree))throw new l("A QuadtreeTileProvider can only be used with a single QuadtreePrimitive");this._tileProvider=a.tileProvider;this._tileProvider.quadtree=this;this._debug={enableDebugOutput:!1,maxDepth:0,maxDepthVisited:0,tilesVisited:0,tilesCulled:0,tilesRendered:0,tilesWaitingForChildren:0,lastMaxDepth:-1,lastMaxDepthVisited:-1,lastTilesVisited:-1,lastTilesCulled:-1,lastTilesRendered:-1,lastTilesWaitingForChildren:-1,suspendLodUpdate:!1};var b=this._tileProvider.tilingScheme.ellipsoid;this._tilesToRender=[];this._tileLoadQueueHigh=[];this._tileLoadQueueMedium=[];this._tileLoadQueueLow=[];this._tileReplacementQueue=new x;this._levelZeroTiles=void 0;this._loadQueueTimeSlice=5;this._tilesInvalidated=!1;this._addHeightCallbacks=[];this._removeHeightCallbacks=[];this._tileToUpdateHeights=[];this._lastTileIndex=0;this._updateHeightsTimeSlice=2;this._cameraReferenceFrameOriginCartographic=this._cameraPositionCartographic=void 0;this.maximumScreenSpaceError=f(a.maximumScreenSpaceError,2);this.tileCacheSize=f(a.tileCacheSize,100);this.loadingDescendantLimit=20;this.preloadAncestors=!0;this.preloadSiblings=!1;this._occluders=new u({ellipsoid:b});this._tileLoadProgressEvent=new m;this._lastTileLoadQueueLength=0;this._lastSelectionFrameNumber=void 0;this._maxLevel=0}function B(a){var b=a._debug;b.maxDepth=0;b.maxDepthVisited=0;b.tilesVisited=0;b.tilesCulled=0;b.tilesRendered=0;b.tilesWaitingForChildren=0;a._tileLoadQueueHigh.length=0;a._tileLoadQueueMedium.length=0;a._tileLoadQueueLow.length=0}function C(a,b){var c=a._tileLoadQueueHigh.length+a._tileLoadQueueMedium.length+a._tileLoadQueueLow.length;if(c!==a._lastTileLoadQueueLength||a._tilesInvalidated)b.afterRender.push(m.prototype.raiseEvent.bind(a._tileLoadProgressEvent,c)),a._lastTileLoadQueueLength=c;c=a._debug;c.enableDebugOutput&&!c.suspendLodUpdate&&(c.maxDepth=a._tilesToRender.reduce(function(a,b){return Math.max(a,b.level)},-1),c.tilesRendered=a._tilesToRender.length,c.tilesVisited!==c.lastTilesVisited||c.tilesRendered!==c.lastTilesRendered||c.tilesCulled!==c.lastTilesCulled||c.maxDepth!==c.lastMaxDepth||c.tilesWaitingForChildren!==c.lastTilesWaitingForChildren||c.maxDepthVisited!==c.lastMaxDepthVisited)&&(console.log("Visited "+c.tilesVisited+", Rendered: "+c.tilesRendered+", Culled: "+c.tilesCulled+", Max Depth Rendered: "+c.maxDepth+", Max Depth Visited: "+c.maxDepthVisited+", Waiting for children: "+c.tilesWaitingForChildren),c.lastTilesVisited=c.tilesVisited,c.lastTilesRendered=c.tilesRendered,c.lastTilesCulled=c.tilesCulled,c.lastMaxDepth=c.maxDepth,c.lastTilesWaitingForChildren=c.tilesWaitingForChildren,c.lastMaxDepthVisited=c.maxDepthVisited)}function I(a,b){var c=r.center(a.rectangle,F),d=c.longitude-K.longitude,e=c.latitude-K.latitude,c=r.center(b.rectangle,F),f=c.longitude-K.longitude,c=c.latitude-K.latitude;return d*d+e*e-(f*f+c*c)}function H(a,b,c,d){c.needsLoading&&(void 0!==a.tileProvider.computeTileLoadPriority&&(c._loadPriority=a.tileProvider.computeTileLoadPriority(c,d)),b.push(c))}function J(){this.allAreRenderable=!0;this.anyWereRenderedLastFrame=!1;this.notYetRenderableCount=0}function w(){this.southwest=new J;this.southeast=new J;this.northwest=new J;this.northeast=new J}function G(a,b,e,f,g,l,m){if(e.computeTileVisibility(b,f,g)!==c.NONE){a:{var p=l;e=a._debug;++e.tilesVisited;a._tileReplacementQueue.markTileRendered(b);b._updateCustomData(f.frameNumber);b.level>e.maxDepthVisited&&(e.maxDepthVisited=b.level);a.maxLevel<b.level&&(a.maxLevel=b.level);if(f.mode===z.SCENE2D||f.camera.frustum instanceof d||f.camera.frustum instanceof q){g=f.camera.frustum;k(g._offCenterFrustum)&&(g=g._offCenterFrustum);var t=f.context;l=t.drawingBufferWidth;t=t.drawingBufferHeight;g=a._tileProvider.getLevelMaximumGeometricError(b.level)/(Math.max(g.top-g.bottom,g.right-g.left)/Math.max(l,t));f.fog.enabled&&f.mode!==z.SCENE2D&&(g-=h.fog(b._distance,f.fog.density)*f.fog.sse)}else l=a._tileProvider.getLevelMaximumGeometricError(b.level),g=b._distance,l=l*f.context.drawingBufferHeight/(g*f.camera.frustum.sseDenominator),f.fog.enabled&&(l-=h.fog(g,f.fog.density)*f.fog.sse),g=l;l=g<a.maximumScreenSpaceError;var w=b.southwestChild,u=b.southeastChild,v=b.northwestChild,y=b.northeastChild;g=b._lastSelectionResultFrame===a._lastSelectionFrameNumber?b._lastSelectionResult:D.NONE;t=a.tileProvider;if(l||p){var E=D.originalResult(g)===D.RENDERED,C=D.originalResult(g)===D.CULLED||g===D.NONE,B=b.state===A.DONE;(E=E||C||B)||k(t.canRenderWithoutLosingDetail)&&(E=t.canRenderWithoutLosingDetail(b));if(E){l&&H(a,a._tileLoadQueueMedium,b,f);a._tilesToRender.push(b);m.allAreRenderable=b.renderable;m.anyWereRenderedLastFrame=g===D.RENDERED;m.notYetRenderableCount=b.renderable?0:1;b._lastSelectionResultFrame=f.frameNumber;b._lastSelectionResult=D.RENDERED;m.anyWereRenderedLastFrame||a._tileToUpdateHeights.push(b);b=void 0;break a}p=!0;l&&H(a,a._tileLoadQueueHigh,b,f)}if(t.canRefine(b))if(w.upsampledFromParent&&u.upsampledFromParent&&v.upsampledFromParent&&y.upsampledFromParent)a._tilesToRender.push(b),H(a,a._tileLoadQueueMedium,b,f),a._tileReplacementQueue.markTileRendered(w),a._tileReplacementQueue.markTileRendered(u),a._tileReplacementQueue.markTileRendered(v),a._tileReplacementQueue.markTileRendered(y),m.allAreRenderable=b.renderable,m.anyWereRenderedLastFrame=g===D.RENDERED,m.notYetRenderableCount=b.renderable?0:1,b._lastSelectionResultFrame=f.frameNumber,b._lastSelectionResult=D.RENDERED,m.anyWereRenderedLastFrame||a._tileToUpdateHeights.push(b);else{b._lastSelectionResultFrame=f.frameNumber;b._lastSelectionResult=D.REFINED;C=a._tilesToRender.length;l=a._tileLoadQueueLow.length;var t=a._tileLoadQueueMedium.length,E=a._tileLoadQueueHigh.length,B=a._tileToUpdateHeights.length,x=f.camera.positionCartographic,I=a._tileProvider,L=a._occluders,K=Z[w.level];if(k(K)){var J=K.southwest,F=K.southeast,O=K.northwest,Q=K.northeast;x.longitude<w.rectangle.east?x.latitude<w.rectangle.north?(G(a,w,I,f,L,p,J),G(a,u,I,f,L,p,F),G(a,v,I,f,L,p,O),G(a,y,I,f,L,p,Q)):(G(a,v,I,f,L,p,O),G(a,w,I,f,L,p,J),G(a,y,I,f,L,p,Q),G(a,u,I,f,L,p,F)):x.latitude<w.rectangle.north?(G(a,u,I,f,L,p,F),G(a,w,I,f,L,p,J),G(a,y,I,f,L,p,Q),G(a,v,I,f,L,p,O)):(G(a,y,I,f,L,p,Q),G(a,v,I,f,L,p,O),G(a,u,I,f,L,p,F),G(a,w,I,f,L,p,J));K.combine(m)}if(C!==a._tilesToRender.length){v=m.anyWereRenderedLastFrame;w=m.notYetRenderableCount;u=!1;if(!m.allAreRenderable&&!v){v=a._tilesToRender;for(y=C;y<v.length;++y)for(p=v[y];void 0!==p&&p._lastSelectionResult!==D.KICKED&&p!==b;)p._lastSelectionResult=D.kick(p._lastSelectionResult),p=p.parent;a._tilesToRender.length=C;a._tileToUpdateHeights.length=B;a._tilesToRender.push(b);b._lastSelectionResult=D.RENDERED;g=g===D.RENDERED;!g&&w>a.loadingDescendantLimit&&(a._tileLoadQueueLow.length=l,a._tileLoadQueueMedium.length=t,a._tileLoadQueueHigh.length=E,H(a,a._tileLoadQueueMedium,b,f),m.notYetRenderableCount=b.renderable?0:1,u=!0);m.allAreRenderable=b.renderable;(m.anyWereRenderedLastFrame=g)||a._tileToUpdateHeights.push(b);++e.tilesWaitingForChildren}a.preloadAncestors&&!u&&H(a,a._tileLoadQueueLow,b,f)}}else b._lastSelectionResultFrame=f.frameNumber,b._lastSelectionResult=D.RENDERED,a._tilesToRender.push(b),H(a,a._tileLoadQueueHigh,b,f),m.allAreRenderable=b.renderable,m.anyWereRenderedLastFrame=g===D.RENDERED,m.notYetRenderableCount=b.renderable?0:1;b=void 0}return b}++a._debug.tilesCulled;a._tileReplacementQueue.markTileRendered(b);m.allAreRenderable=!0;m.anyWereRenderedLastFrame=!1;m.notYetRenderableCount=0;m=b.rectangle;k(a._cameraPositionCartographic)&&r.contains(m,a._cameraPositionCartographic)||k(a._cameraReferenceFrameOriginCartographic)&&r.contains(m,a._cameraReferenceFrameOriginCartographic)?(k(b.data)&&k(b.data.vertexArray)||H(a,a._tileLoadQueueMedium,b,f),m=b._lastSelectionResultFrame===a._lastSelectionFrameNumber?b._lastSelectionResult:D.NONE,m!==D.CULLED_BUT_NEEDED&&m!==D.RENDERED&&a._tileToUpdateHeights.push(b),b._lastSelectionResult=D.CULLED_BUT_NEEDED):((a.preloadSiblings||0===b.level)&&H(a,a._tileLoadQueueLow,b,f),b._lastSelectionResult=D.CULLED,a=b.data.pickBoundingSphere,a=f.cullingVolume.computeVisibility(a),a!==c.NONE&&(b._lastSelectionResult=D.CULLED_BUT_NEEDED));b._lastSelectionResultFrame=f.frameNumber}function E(a,b){return a._loadPriority-b._loadPriority}function L(a,b,c,d,f,g){void 0!==c.computeTileLoadPriority&&f.sort(E);for(var h=0,k=f.length;h<k&&(e()<d||!g);++h)g=f[h],a._tileReplacementQueue.markTileRendered(g),c.loadTile(b,g),g=!0;return g}g(v.prototype,{tileProvider:{get:function(){return this._tileProvider}},tileLoadProgressEvent:{get:function(){return this._tileLoadProgressEvent}},maxLevel:{set:function(a){this._maxLevel=a},get:function(){return this._maxLevel}},occluders:{get:function(){return this._occluders}}});v.prototype.invalidateAllTiles=function(){this._tilesInvalidated=!0};v.prototype.forEachLoadedTile=function(a){for(var b=this._tileReplacementQueue.head;k(b);)b.state!==A.START&&a(b),b=b.replacementNext};v.prototype.forEachRenderedTile=function(a){for(var b=this._tilesToRender,c=0,d=b.length;c<d;++c)a(b[c])};v.prototype.updateHeight=function(a,b){var c=this,d={positionOnEllipsoidSurface:void 0,positionCartographic:a,level:-1,callback:b,removeFunc:function(){for(var a=c._addHeightCallbacks,b=a.length,e=0;e<b;++e)if(a[e]===d){a.splice(e,1);break}c._removeHeightCallbacks.push(d)}};c._addHeightCallbacks.push(d);return d.removeFunc};v.prototype.update=function(a){k(this._tileProvider.update)&&this._tileProvider.update(a)};v.prototype.beginFrame=function(a){if(a.passes.render){if(this._tilesInvalidated){var b=this._tileReplacementQueue;b.head=void 0;b.tail=void 0;b.count=0;B(this);b=this._levelZeroTiles;if(k(b))for(var c=0;c<b.length;++c){for(var d=b[c].customData,e=d.length,f=0;f<e;++f){var g=d[f];g.level=0;this._addHeightCallbacks.push(g)}b[c].freeResources()}this._levelZeroTiles=void 0;this._tileProvider.cancelReprojections();this._tilesInvalidated=!1}this._tileProvider.initialize(a);B(this);this._debug.suspendLodUpdate||this._tileReplacementQueue.markStartOfRenderFrame()}};v.prototype.render=function(a){var b=a.passes,c=this._tileProvider;if(b.render){c.beginUpdate(a);a:{var d=this._debug;if(!d.suspendLodUpdate){this._tilesToRender.length=0;var e,f=this._tileProvider;if(!k(this._levelZeroTiles))if(f.ready){this._levelZeroTiles=y.createLevelZeroTiles(f.tilingScheme);var g=this._levelZeroTiles.length;if(O.length<g)for(O=Array(g),e=0;e<g;++e)void 0===O[e]&&(O[e]=new J)}else break a;this._occluders.ellipsoid.cameraPosition=a.camera.positionWC;var h,g=this._levelZeroTiles,l=1<g.length?this._occluders:void 0;K=a.camera.positionCartographic;g.sort(I);var m=this._addHeightCallbacks,q=this._removeHeightCallbacks,r=a.frameNumber,t;if(0<m.length||0<q.length){e=0;for(t=g.length;e<t;++e)h=g[e],h._updateCustomData(r,m,q);m.length=0;q.length=0}e=a.camera;this._cameraPositionCartographic=e.positionCartographic;e=p.getTranslation(e.transform,N);this._cameraReferenceFrameOriginCartographic=this.tileProvider.tilingScheme.ellipsoid.cartesianToCartographic(e,this._cameraReferenceFrameOriginCartographic);e=0;for(t=g.length;e<t;++e)h=g[e],this._tileReplacementQueue.markTileRendered(h),h.renderable?G(this,h,f,a,l,!1,O[e]):(H(this,this._tileLoadQueueHigh,h,a),++d.tilesWaitingForChildren);this._lastSelectionFrameNumber=r}}d=this._tileProvider;f=this._tilesToRender;g=0;for(l=f.length;g<l;++g)d.showTileThisFrame(f[g],a);c.endUpdate(a)}b.pick&&0<this._tilesToRender.length&&c.updateForPick(a)};v.prototype.endFrame=function(c){if(c.passes.render&&c.mode!==z.MORPHING){var d=this._tileLoadQueueHigh,g=this._tileLoadQueueMedium,h=this._tileLoadQueueLow;if(0!==d.length||0!==g.length||0!==h.length){this._tileReplacementQueue.trimTiles(this.tileCacheSize);var l=e()+this._loadQueueTimeSlice,m=this._tileProvider,d=L(this,c,m,l,d,!1),d=L(this,c,m,l,g,d);L(this,c,m,l,h,d)}if(this.tileProvider.ready){g=M;g.length=0;for(var h=this._tileToUpdateHeights,l=this._tileProvider.terrainProvider,m=e()+this._updateHeightsTimeSlice,d=c.mode,p=c.mapProjection,q=this.tileProvider.tilingScheme.ellipsoid,t;0<h.length;){var w=h[0];if(k(w.data)&&k(w.data.mesh)){var u=w.customData,v=u.length,y=!1;for(t=this._lastTileIndex;t<v;++t){var E=u[t];if(w.level>E.level){k(E.positionOnEllipsoidSurface)||(E.positionOnEllipsoidSurface=b.fromRadians(E.positionCartographic.longitude,E.positionCartographic.latitude,0,q));if(d===z.SCENE3D){var A=q.geodeticSurfaceNormal(E.positionOnEllipsoidSurface,aa.direction),B=q.getSurfaceNormalIntersectionWithZAxis(E.positionOnEllipsoidSurface,11500,aa.origin);if(!k(B)){var G;k(w.data.tileBoundingRegion)&&(G=w.data.tileBoundingRegion.minimumHeight);B=Math.min(f(G,0),-11500);A=b.multiplyByScalar(A,Math.abs(B)+1,W);b.subtract(E.positionOnEllipsoidSurface,A,aa.origin)}}else a.clone(E.positionCartographic,U),U.height=-11500,p.project(U,W),b.fromElements(W.z,W.x,W.y,W),b.clone(W,aa.origin),b.clone(b.UNIT_X,aa.direction);A=w.data.pick(aa,d,p,!1,W);k(A)&&(E.callback(A),E.level=w.level)}else if(w.level===E.level){for(var A=w.children,B=A.length,x,H=0;H<B&&(x=A[H],!r.contains(x.rectangle,E.positionCartographic));++H);A=l.getTileDataAvailable(x.x,x.y,x.level);B=w.parent;(k(A)&&!A||k(B)&&k(B.data)&&k(B.data.terrainData)&&!B.data.terrainData.isChildAvailable(B.x,B.y,x.x,x.y))&&E.removeFunc()}if(e()>=m){y=!0;break}}if(y){this._lastTileIndex=t;break}else this._lastTileIndex=0,h.shift()}else t=w._lastSelectionResultFrame===this._lastSelectionFrameNumber?w._lastSelectionResult:D.NONE,t!==D.RENDERED&&t!==D.CULLED_BUT_NEEDED||g.push(w),h.shift(),this._lastTileIndex=0}for(t=0;t<g.length;t++)h.push(g[t])}C(this,c)}};v.prototype.isDestroyed=function(){return!1};v.prototype.destroy=function(){this._tileProvider=this._tileProvider&&this._tileProvider.destroy()};var K,F=new a,N=new b,O=[];w.prototype.combine=function(a){var b=this.southwest,c=this.southeast,d=this.northwest,e=this.northeast;a.allAreRenderable=b.allAreRenderable&&c.allAreRenderable&&d.allAreRenderable&&e.allAreRenderable;a.anyWereRenderedLastFrame=b.anyWereRenderedLastFrame||c.anyWereRenderedLastFrame||d.anyWereRenderedLastFrame||e.anyWereRenderedLastFrame;a.notYetRenderableCount=b.notYetRenderableCount+c.notYetRenderableCount+d.notYetRenderableCount+e.notYetRenderableCount};var Z=Array(30);for(g=0;g<Z.length;++g)Z[g]=new w;var aa=new t,U=new a,W=new b,M=[];return v});F("Scene/Globe","../Core/BoundingSphere ../Core/buildModuleUrl ../Core/Cartesian3 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Ellipsoid ../Core/EllipsoidTerrainProvider ../Core/Event ../Core/IntersectionTests ../Core/Ray ../Core/Rectangle ../Core/Resource ../Renderer/ShaderSource ../Renderer/Texture ../Shaders/GlobeFS ../Shaders/GlobeVS ../Shaders/GroundAtmosphere ../ThirdParty/when ./GlobeSurfaceShaderSet ./GlobeSurfaceTileProvider ./ImageryLayerCollection ./QuadtreePrimitive ./SceneMode ./ShadowMode ./TileSelectionResult".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,J,w,G){function E(b){b=g(b,p.WGS84);var c=new d({ellipsoid:b}),e=new I;this._ellipsoid=b;this._imageryLayerCollection=e;this._surfaceShaderSet=new B;this._material=void 0;this._surface=new H({tileProvider:new C({terrainProvider:c,imageryLayers:e,surfaceShaderSet:this._surfaceShaderSet})});this._terrainProvider=c;this._terrainProviderChanged=new q;L(this);this._oceanNormalMapResourceDirty=this.show=!0;this._oceanNormalMapResource=new u({url:a("Assets/Textures/waterNormalsSmall.jpg")});this._nightLight=!1;this._nightLightMapResourceDirty=!0;this._nightLightMapResouce=new u({url:a("Assets/Textures/nightLight.png")});this.maximumScreenSpaceError=2;this.tileCacheSize=100;this.loadingDescendantLimit=20;this.preloadAncestors=!0;this.preloadSiblings=!1;this.fillHighlightColor=void 0;this.enableLighting=!1;this.showGroundAtmosphere=!0;this.lightingFadeOutDistance=1E7;this.lightingFadeInDistance=2E7;this.nightFadeOutDistance=1E7;this.nightFadeInDistance=5E7;this.showWaterEffect=!0;this.depthTestAgainstTerrain=!1;this.shadows=w.RECEIVE_ONLY;this.atmosphereBrightnessShift=this.atmosphereSaturationShift=this.atmosphereHueShift=0;this._zoomedOutOceanSpecularIntensity=this._oceanNormalMap=void 0}function L(a){var b=[],c=l(a._material)&&(a._material.shaderSource.match(/slope/)||a._material.shaderSource.match("normalEC")),d=[D];!l(a._material)||c&&!a._terrainProvider.requestVertexNormals?a._surface._tileProvider.uniformMap=void 0:(d.push(a._material.shaderSource),b.push("APPLY_MATERIAL"),a._surface._tileProvider.uniformMap=a._material._uniforms);d.push(z);a._surfaceShaderSet.baseVertexShaderSource=new y({sources:[D,x],defines:b});a._surfaceShaderSet.baseFragmentShaderSource=new y({sources:d,defines:b});a._surfaceShaderSet.material=a._material}function K(a){return function(c,d){var e=b.distanceSquaredTo(c.pickBoundingSphere,a),f=b.distanceSquaredTo(d.pickBoundingSphere,a);return e-f}}function F(a,b){return c.contains(a.rectangle,b)?a:void 0}m(E.prototype,{ellipsoid:{get:function(){return this._ellipsoid}},imageryLayers:{get:function(){return this._imageryLayerCollection}},imageryLayersUpdatedEvent:{get:function(){return this._surface.tileProvider.imageryLayersUpdatedEvent}},tilesLoaded:{get:function(){return l(this._surface)?this._surface.tileProvider.ready&&0===this._surface._tileLoadQueueHigh.length&&0===this._surface._tileLoadQueueMedium.length&&0===this._surface._tileLoadQueueLow.length:!0}},baseColor:{get:function(){return this._surface.tileProvider.baseColor},set:function(a){this._surface.tileProvider.baseColor=a}},clippingPlanes:{get:function(){return this._surface.tileProvider.clippingPlanes},set:function(a){this._surface.tileProvider.clippingPlanes=a}},cartographicLimitRectangle:{get:function(){return this._surface.tileProvider.cartographicLimitRectangle},set:function(a){l(a)||(a=c.clone(c.MAX_VALUE));this._surface.tileProvider.cartographicLimitRectangle=a}},oceanNormalMapUrl:{get:function(){return this._oceanNormalMapResource.url},set:function(a){this._oceanNormalMapResource.url=a;this._oceanNormalMapResourceDirty=!0}},terrainProvider:{get:function(){return this._terrainProvider},set:function(a){a!==this._terrainProvider&&(this._terrainProvider=a,this._terrainProviderChanged.raiseEvent(a),l(this._material)&&L(this))}},terrainProviderChanged:{get:function(){return this._terrainProviderChanged}},tileLoadProgressEvent:{get:function(){return this._surface.tileLoadProgressEvent}},nightLight:{get:function(){return this._nightLight},set:function(a){this._nightLight=a}},material:{get:function(){return this._material},set:function(a){this._material!==a&&(this._material=a,L(this))}}});var N=[],O={start:0,stop:0};E.prototype.pickWorldCoordinates=function(a,c,d){if(!l(a))throw new h("ray is required");if(!l(c))throw new h("scene is required");var e=c.mode,g=c.mapProjection;N.length=0;var k=this._surface._tilesToRender,m=k.length,p,q;for(q=0;q<m;++q){p=k[q];var r=p.data;if(l(r)){var w=r.pickBoundingSphere;if(e!==J.SCENE3D)r.pickBoundingSphere=w=b.fromRectangleWithHeights2D(p.rectangle,g,r.tileBoundingRegion.minimumHeight,r.tileBoundingRegion.maximumHeight,w),f.fromElements(w.center.z,w.center.x,w.center.y,w.center);else if(l(r.renderedMesh))b.clone(r.renderedMesh.boundingSphere3D,w);else continue;p=t.raySphere(a,w,O);l(p)&&N.push(r)}}N.sort(K(a.origin));var u,m=N.length;for(q=0;q<m&&(u=N[q].pick(a,c.mode,c.mapProjection,!0,d),!l(u));++q);return u};var Z=new k;E.prototype.pick=function(a,b,c){c=this.pickWorldCoordinates(a,b,c);l(c)&&b.mode!==J.SCENE3D&&(c=f.fromElements(c.y,c.z,c.x,c),a=b.mapProjection.unproject(c,Z),c=b.globe.ellipsoid.cartographicToCartesian(a,c));return c};var aa=new f,U=new f,W=new k,M=new r;E.prototype.getHeight=function(a){if(!l(a))throw new h("cartographic is required");var b=this._surface._levelZeroTiles;if(l(b)){var d,e,k=b.length;for(e=0;e<k&&(d=b[e],!c.contains(d.rectangle,a));++e);if(!(e>=k)){for(;d._lastSelectionResult===G.REFINED;)d=F(d.southwestChild,a)||F(d.southeastChild,a)||F(d.northwestChild,a)||d.northeastChild;if(l(d.data)&&l(d.data.renderedMesh)){b=this._surface._tileProvider.tilingScheme.ellipsoid;a=f.fromRadians(a.longitude,a.latitude,0,b,aa);e=b.geodeticSurfaceNormal(a,M.direction);k=b.getSurfaceNormalIntersectionWithZAxis(a,11500,M.origin);if(!l(k)){var m;l(d.data.tileBoundingRegion)&&(m=d.data.tileBoundingRegion.minimumHeight);m=Math.min(g(m,0),-11500);m=f.multiplyByScalar(e,Math.abs(m)+1,U);f.subtract(a,m,M.origin)}d=d.data.pick(M,void 0,void 0,!1,U);if(l(d))return b.cartesianToCartographic(d,W).height}}}};E.prototype.update=function(a){this.show&&a.passes.render&&this._surface.update(a)};E.prototype.beginFrame=function(a){var b=this._surface,c=b.tileProvider,d=this.terrainProvider;if((d=this.showWaterEffect&&d.ready&&d.hasWaterMask)&&this._oceanNormalMapResourceDirty){this._oceanNormalMapResourceDirty=!1;var e=this._oceanNormalMapResource,f=e.url;if(l(f)){var g=this;v(e.fetchImage(),function(b){f===g._oceanNormalMapResource.url&&(g._oceanNormalMap=g._oceanNormalMap&&g._oceanNormalMap.destroy(),g._oceanNormalMap=new A({context:a.context,source:b}))})}else this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy()}a.nightLightVisible=this.nightLight;var h=a.nightLightMap;!l(h)&&this._nightLightMapResourceDirty&&(this._nightLightMapResourceDirty=!1,g=this,v(g._nightLightMapResouce.fetchImage(),function(b){h=h&&h.destroy();h=new A({context:a.context,source:b});a.nightLightMap=h}));e=a.mode;a.passes.render&&(this._zoomedOutOceanSpecularIntensity=this.showGroundAtmosphere?.4:.5,b.maximumScreenSpaceError=this.maximumScreenSpaceError,b.tileCacheSize=this.tileCacheSize,b.loadingDescendantLimit=this.loadingDescendantLimit,b.preloadAncestors=this.preloadAncestors,b.preloadSiblings=this.preloadSiblings,c.terrainProvider=this.terrainProvider,c.lightingFadeOutDistance=this.lightingFadeOutDistance,c.lightingFadeInDistance=this.lightingFadeInDistance,c.nightFadeOutDistance=this.nightFadeOutDistance,c.nightFadeInDistance=this.nightFadeInDistance,c.zoomedOutOceanSpecularIntensity=e===J.SCENE3D?this._zoomedOutOceanSpecularIntensity:0,c.hasWaterMask=d,c.oceanNormalMap=this._oceanNormalMap,c.enableLighting=this.enableLighting,c.showGroundAtmosphere=this.showGroundAtmosphere,c.shadows=this.shadows,c.hueShift=this.atmosphereHueShift,c.saturationShift=this.atmosphereSaturationShift,c.brightnessShift=this.atmosphereBrightnessShift,c.fillHighlightColor=this.fillHighlightColor,b.beginFrame(a))};E.prototype.render=function(a){this.show&&(l(this._material)&&this._material.update(a.context),this._surface.render(a))};E.prototype.endFrame=function(a){this.show&&a.passes.render&&this._surface.endFrame(a)};E.prototype.isDestroyed=function(){return!1};E.prototype.destroy=function(){this._surfaceShaderSet=this._surfaceShaderSet&&this._surfaceShaderSet.destroy();this._surface=this._surface&&this._surface.destroy();this._oceanNormalMap=this._oceanNormalMap&&this._oceanNormalMap.destroy();return e(this)};return E});F("Shaders/PostProcessStages/DepthViewPacked",[],function(){return"uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nfloat z_window \x3d czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\nz_window \x3d czm_reverseLogDepth(z_window);\nfloat n_range \x3d czm_depthRange.near;\nfloat f_range \x3d czm_depthRange.far;\nfloat z_ndc \x3d (2.0 * z_window - n_range - f_range) / (f_range - n_range);\nfloat scale \x3d pow(z_ndc * 0.5 + 0.5, 8.0);\ngl_FragColor \x3d vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"});F("Shaders/PostProcessStages/PassThrough",[],function(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor \x3d texture2D(colorTexture, v_textureCoordinates);\n}\n"});F("Shaders/PostProcessStages/PassThroughDepth",[],function(){return"uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\ngl_FragColor \x3d czm_packDepth(texture2D(u_depthTexture, v_textureCoordinates).r);\n}\n"});F("Scene/GlobeDepth","../Core/BoundingRectangle ../Core/Color ../Core/defined ../Core/destroyObject ../Core/PixelFormat ../Renderer/ClearCommand ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/ShaderSource ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureWrap ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Shaders/PostProcessStages/DepthViewPacked ../Shaders/PostProcessStages/PassThrough ../Shaders/PostProcessStages/PassThroughDepth ./StencilConstants ./StencilFunction ./StencilOperation".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){function v(){this._updateDepthCommand=this._tempCopyDepthCommand=this._copyDepthCommand=this._copyColorCommand=this._clearColorCommand=this._updateDepthFramebuffer=this._tempCopyDepthFramebuffer=this._copyDepthFramebuffer=this.framebuffer=this._tempCopyDepthTexture=this._tempGlobeDepthTexture=this._globeDepthTexture=this._depthStencilTexture=this._colorTexture=void 0;this._viewport=new b;this._rsUpdate=this._rs=void 0;this._useScissorTest=!1;this._debugGlobeDepthViewportCommand=this._useHdr=this._useLogDepth=this._scissorRectangle=void 0}function B(a,b,c,d){if(!f(a._debugGlobeDepthViewportCommand)||d!==a._useLogDepth){var e=new p({defines:[d?"LOG_DEPTH":""],sources:["uniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window \x3d czm_unpackDepth(texture2D(u_depthTexture, v_textureCoordinates));\n    z_window \x3d czm_reverseLogDepth(z_window); \n    float n_range \x3d czm_depthRange.near;\n    float f_range \x3d czm_depthRange.far;\n    float z_ndc \x3d (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale \x3d pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor \x3d vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});a._debugGlobeDepthViewportCommand=b.createViewportQuadCommand(e,{uniformMap:{u_depthTexture:function(){return a._globeDepthTexture}},owner:a});a._useLogDepth=d}a._debugGlobeDepthViewportCommand.execute(b,c)}function C(a){a._colorTexture=a._colorTexture&&!a._colorTexture.isDestroyed()&&a._colorTexture.destroy();a._depthStencilTexture=a._depthStencilTexture&&!a._depthStencilTexture.isDestroyed()&&a._depthStencilTexture.destroy();a._globeDepthTexture=a._globeDepthTexture&&!a._globeDepthTexture.isDestroyed()&&a._globeDepthTexture.destroy()}function I(a){a.framebuffer=a.framebuffer&&!a.framebuffer.isDestroyed()&&a.framebuffer.destroy();a._copyDepthFramebuffer=a._copyDepthFramebuffer&&!a._copyDepthFramebuffer.isDestroyed()&&a._copyDepthFramebuffer.destroy()}function H(a){a._tempCopyDepthFramebuffer=a._tempCopyDepthFramebuffer&&!a._tempCopyDepthFramebuffer.isDestroyed()&&a._tempCopyDepthFramebuffer.destroy();a._updateDepthFramebuffer=a._updateDepthFramebuffer&&!a._updateDepthFramebuffer.isDestroyed()&&a._updateDepthFramebuffer.destroy();a._tempGlobeDepthTexture=a._tempGlobeDepthTexture&&!a._tempGlobeDepthTexture.isDestroyed()&&a._tempGlobeDepthTexture.destroy()}function J(c,d,e,g,k){c._viewport.width=e;c._viewport.height=g;e=!b.equals(c._viewport,k.viewport);g=e!==c._useScissorTest;c._useScissorTest=e;b.equals(c._scissorRectangle,k.viewport)||(c._scissorRectangle=b.clone(k.viewport,c._scissorRectangle),g=!0);f(c._rs)&&b.equals(c._viewport,c._rs.viewport)&&!g||(c._rs=h.fromCache({viewport:c._viewport,scissorTest:{enabled:c._useScissorTest,rectangle:c._scissorRectangle}}),c._rsUpdate=h.fromCache({viewport:c._viewport,scissorTest:{enabled:c._useScissorTest,rectangle:c._scissorRectangle},stencilTest:{enabled:!0,frontFunction:x.EQUAL,frontOperation:{fail:D.KEEP,zFail:D.KEEP,zPass:D.KEEP},backFunction:x.NEVER,reference:z.CESIUM_3D_TILE_MASK,mask:z.CESIUM_3D_TILE_MASK}}));f(c._copyDepthCommand)||(c._copyDepthCommand=d.createViewportQuadCommand(A,{uniformMap:{u_depthTexture:function(){return c._depthStencilTexture}},owner:c}));c._copyDepthCommand.framebuffer=c._copyDepthFramebuffer;c._copyDepthCommand.renderState=c._rs;f(c._copyColorCommand)||(c._copyColorCommand=d.createViewportQuadCommand(y,{uniformMap:{colorTexture:function(){return c._colorTexture}},owner:c}));c._copyColorCommand.renderState=c._rs;f(c._tempCopyDepthCommand)||(c._tempCopyDepthCommand=d.createViewportQuadCommand(A,{uniformMap:{u_depthTexture:function(){return c._tempCopyDepthTexture}},owner:c}));c._tempCopyDepthCommand.framebuffer=c._tempCopyDepthFramebuffer;c._tempCopyDepthCommand.renderState=c._rs;f(c._updateDepthCommand)||(c._updateDepthCommand=d.createViewportQuadCommand(y,{uniformMap:{colorTexture:function(){return c._tempGlobeDepthTexture}},owner:c}));c._updateDepthCommand.framebuffer=c._updateDepthFramebuffer;c._updateDepthCommand.renderState=c._rsUpdate;f(c._clearColorCommand)||(c._clearColorCommand=new l({color:new a(0,0,0,0),stencil:0,owner:c}));c._clearColorCommand.framebuffer=c.framebuffer}v.prototype.executeDebugGlobeDepth=function(a,b,c){B(this,a,b,c)};v.prototype.update=function(a,b,h,k){var l=h.width;h=h.height;var p=this._colorTexture,p=!f(p)||p.width!==l||p.height!==h||k!==this._useHdr;if(!f(this.framebuffer)||p)C(this),I(this),0>=l?console.info("createTextures:width needs greater than zero"):(this._colorTexture=new q({context:a,width:l,height:h,pixelFormat:g.RGBA,pixelDatatype:k?a.halfFloatingPointTexture?e.HALF_FLOAT:e.FLOAT:e.UNSIGNED_BYTE,sampler:new d({wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})}),this._depthStencilTexture=new q({context:a,width:l,height:h,pixelFormat:g.DEPTH_STENCIL,pixelDatatype:e.UNSIGNED_INT_24_8}),this._globeDepthTexture=new q({context:a,width:l,height:h,pixelFormat:g.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new d({wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})})),this.framebuffer=new m({context:a,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,destroyAttachments:!1}),this._copyDepthFramebuffer=new m({context:a,colorTextures:[this._globeDepthTexture],destroyAttachments:!1});J(this,a,l,h,b);a.uniformState.globeDepthTexture=void 0;this._useHdr=k};v.prototype.executeCopyDepth=function(a,b){f(this._copyDepthCommand)&&(this._copyDepthCommand.execute(a,b),a.uniformState.globeDepthTexture=this._globeDepthTexture)};v.prototype.executeUpdateDepth=function(a,b,h){var k=b.framebuffer.depthStencilTexture;if(h||k!==this._depthStencilTexture){if(f(this._updateDepthCommand)){if(!f(this._updateDepthFramebuffer)||this._updateDepthFramebuffer.depthStencilTexture!==k||this._updateDepthFramebuffer.getColorTexture(0)!==this._globeDepthTexture){h=this._globeDepthTexture.width;var l=this._globeDepthTexture.height;H(this);this._tempGlobeDepthTexture=new q({context:a,width:h,height:l,pixelFormat:g.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new d({wrapS:t.CLAMP_TO_EDGE,wrapT:t.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})});this._tempCopyDepthFramebuffer=new m({context:a,colorTextures:[this._tempGlobeDepthTexture],destroyAttachments:!1});this._updateDepthFramebuffer=new m({context:a,colorTextures:[this._globeDepthTexture],depthStencilTexture:b.framebuffer.depthStencilTexture,destroyAttachments:!1});J(this,a,h,l,b)}this._tempCopyDepthTexture=k;this._tempCopyDepthCommand.execute(a,b);this._updateDepthCommand.execute(a,b)}}else f(this._copyDepthCommand)&&this._copyDepthCommand.execute(a,b)};v.prototype.executeCopyColor=function(a,b){f(this._copyColorCommand)&&this._copyColorCommand.execute(a,b)};v.prototype.clear=function(b,c,d){var e=this._clearColorCommand;f(e)&&(a.clone(d,e.color),e.execute(b,c))};v.prototype.isDestroyed=function(){return!1};v.prototype.destroy=function(){C(this);I(this);H(this);f(this._copyColorCommand)&&(this._copyColorCommand.shaderProgram=this._copyColorCommand.shaderProgram.destroy());f(this._copyDepthCommand)&&(this._copyDepthCommand.shaderProgram=this._copyDepthCommand.shaderProgram.destroy());var a=this._debugGlobeDepthViewportCommand;f(a)&&(a.shaderProgram=a.shaderProgram.destroy());return k(this)};return v});F("Scene/GoogleEarthEnterpriseImageryProvider","../Core/Credit ../Core/decodeGoogleEarthEnterpriseData ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../Core/GeographicTilingScheme ../Core/GoogleEarthEnterpriseMetadata ../Core/loadImageFromTypedArray ../Core/Math ../Core/Rectangle ../Core/Request ../Core/Resource ../Core/RuntimeError ../Core/TileProviderError ../ThirdParty/protobuf-minimal ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(){this._image=new Image}function x(a){a=f(a,f.EMPTY_OBJECT);if(!k(a.url)&&!k(a.metadata))throw new l("options.url or options.metadata is required.");var g;if(k(a.metadata))g=a.metadata;else{var p=r.createIfNeeded(a.url);g=new h(p)}this._metadata=g;this._tileDiscardPolicy=a.tileDiscardPolicy;this._tilingScheme=new e({numberOfLevelZeroTilesX:2,numberOfLevelZeroTilesY:2,rectangle:new q(-d.PI,-d.PI,d.PI,d.PI),ellipsoid:a.ellipsoid});a=a.credit;"string"===typeof a&&(a=new b(a));this._credit=a;this._tileHeight=this._tileWidth=256;this._maximumLevel=23;k(this._tileDiscardPolicy)||(this._tileDiscardPolicy=new z);this._errorEvent=new m;this._ready=!1;var t=this,v;this._readyPromise=g.readyPromise.then(function(a){if(!g.imageryPresent)return a=new c("The server "+g.url+" doesn't have imagery"),v=u.handleError(v,t,t._errorEvent,a.message,void 0,void 0,void 0,a),A.reject(a);u.handleSuccess(v);return t._ready=a}).otherwise(function(a){v=u.handleError(v,t,t._errorEvent,a.message,void 0,void 0,void 0,a);return A.reject(a)})}function D(a,b,c,d,e,f){c=h.tileXYToQuadKey(c,d,e);b=b.imageryVersion;b=k(b)&&0<b?b:1;return a._metadata.resource.getDerivedResource({url:"flatfile?f1-0"+c+"-i."+b.toString(),request:f})}z.prototype.isReady=function(){return!0};z.prototype.shouldDiscardImage=function(a){return a===this._image};g(x.prototype,{url:{get:function(){return this._metadata.url}},proxy:{get:function(){return this._metadata.proxy}},tileWidth:{get:function(){if(!this._ready)throw new l("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new l("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new l("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new l("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new l("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new l("rectangle must not be called before the imagery provider is ready.");return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new l("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){return this._credit}},hasAlphaChannel:{get:function(){return!1}}});x.prototype.getTileCredits=function(a,b,c){if(!this._ready)throw new l("getTileCredits must not be called before the imagery provider is ready.");var d=this._metadata;a=d.getTileInformation(a,b,c);if(k(a)&&(d=d.providers[a.imageryProvider],k(d)))return[d]};x.prototype.requestImage=function(b,d,e,f){if(!this._ready)throw new l("requestImage must not be called before the imagery provider is ready.");var g=this._tileDiscardPolicy._image,m=this._metadata,q=h.tileXYToQuadKey(b,d,e),r=m.getTileInformation(b,d,e);if(!k(r)){if(m.isValid(q)){f=new t({throttle:f.throttle,throttleByServer:f.throttleByServer,type:f.type,priorityFunction:f.priorityFunction});m.populateSubtree(b,d,e,f);return}return g}if(!r.hasImagery())return g;b=D(this,r,b,d,e,f).fetchArrayBuffer();if(k(b))return b.then(function(b){a(m.key,b);b=new Uint8Array(b);var d,e=m.protoImagery;k(e)&&e||(d=b,d=74===d[6]&&70===d[7]&&73===d[8]&&70===d[9]?"image/jpeg":80===d[1]&&78===d[2]&&71===d[3]?"image/png":void 0);if(!k(d)&&(!k(e)||e)){d=y.Reader.create(b);e=d.len;for(b={};d.pos<e;){var f=d.uint32();switch(f>>>3){case 1:b.imageType=d.uint32();break;case 2:b.imageData=d.bytes();break;case 3:b.alphaType=d.uint32();break;case 4:b.imageAlpha=d.bytes();break;case 5:var h=b.copyrightIds;k(h)||(h=b.copyrightIds=[]);if(2===(f&7))for(f=d.uint32()+d.pos;d.pos<f;)h.push(d.uint32());else h.push(d.uint32());break;default:d.skipType(f&7)}}d=b.imageType;if(k(d))switch(d){case 0:b.imageType="image/jpeg";break;case 4:b.imageType="image/png";break;default:throw new c("GoogleEarthEnterpriseImageryProvider: Unsupported image type.");}d=b.alphaType;k(d)&&0!==d&&(console.log("GoogleEarthEnterpriseImageryProvider: External alpha not supported."),delete b.alphaType,delete b.imageAlpha);d=b.imageType;b=b.imageData}return k(d)&&k(b)?p({uint8Array:b,format:d,flipY:!0}):g})};x.prototype.pickFeatures=function(a,b,c,d,e){};return x});F("Scene/GridImageryProvider","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ../Core/GeographicTilingScheme ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m){function e(b){b=a(b,a.EMPTY_OBJECT);this._tilingScheme=f(b.tilingScheme)?b.tilingScheme:new l({ellipsoid:b.ellipsoid});this._cells=a(b.cells,8);this._color=a(b.color,h);this._glowColor=a(b.glowColor,p);this._glowWidth=a(b.glowWidth,6);this._backgroundColor=a(b.backgroundColor,d);this._errorEvent=new g;this._tileWidth=a(b.tileWidth,256);this._tileHeight=a(b.tileHeight,256);this._canvasSize=a(b.canvasSize,256);this._canvas=this._createGridCanvas();this._readyPromise=m.resolve(!0)}var h=new b(1,1,1,.4),p=new b(0,1,0,.05),d=new b(0,.5,0,.2);k(e.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}});e.prototype._drawGrid=function(a){for(var b=this._canvasSize,d=0;d<=this._cells;++d){var c=1+d/this._cells*(b-1);a.moveTo(c,0);a.lineTo(c,b);a.moveTo(0,c);a.lineTo(b,c)}a.stroke()};e.prototype._createGridCanvas=function(){var a=document.createElement("canvas");a.width=this._canvasSize;var b=a.height=this._canvasSize,d=a.getContext("2d"),c=this._backgroundColor.toCssColorString();d.fillStyle=c;d.fillRect(0,0,b,b);c=this._glowColor.toCssColorString();d.strokeStyle=c;d.lineWidth=this._glowWidth;d.strokeRect(0,0,b,b);this._drawGrid(d);d.lineWidth=.5*this._glowWidth;d.strokeRect(0,0,b,b);this._drawGrid(d);c=this._color.toCssColorString();d.strokeStyle=c;d.lineWidth=2;d.strokeRect(0,0,b,b);d.lineWidth=1;this._drawGrid(d);return a};e.prototype.getTileCredits=function(a,b,d){};e.prototype.requestImage=function(a,b,d,c){return this._canvas};e.prototype.pickFeatures=function(a,b,d,c,e){};return e});F("Scene/InvertClassification","../Core/Color ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/PixelFormat ../Renderer/ClearCommand ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/Sampler ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Shaders/PostProcessStages/PassThrough ./BlendingState ./StencilConstants ./StencilFunction ./StencilOperation".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(){this._translucentCommand=this._classifiedCommand=this._unclassifiedCommand=this._rsClassified=this._rsUnclassified=this._fboClassified=this._fbo=this._depthStencilTexture=this._classifiedTexture=this._texture=this._previousFramebuffer=this.previousFramebuffer=void 0;this._clearColorCommand=new l({color:new b(0,0,0,0),owner:this});this._clearCommand=new l({color:new b(0,0,0,0),depth:1,stencil:0});var a=this;this._uniformMap={colorTexture:function(){return a._texture},depthTexture:function(){return a._depthStencilTexture},classifiedTexture:function(){return a._classifiedTexture}}}f(D.prototype,{unclassifiedCommand:{get:function(){return this._unclassifiedCommand}}});D.isTranslucencySupported=function(a){return a.depthTexture&&a.fragmentDepth};var v={depthMask:!1,stencilTest:{enabled:!0,frontFunction:z.EQUAL,frontOperation:{fail:x.KEEP,zFail:x.KEEP,zPass:x.KEEP},backFunction:z.NEVER,reference:0,mask:A.CLASSIFICATION_MASK},blending:y.ALPHA_BLEND},B={depthMask:!1,stencilTest:{enabled:!0,frontFunction:z.NOT_EQUAL,frontOperation:{fail:x.KEEP,zFail:x.KEEP,zPass:x.KEEP},backFunction:z.NEVER,reference:0,mask:A.CLASSIFICATION_MASK},blending:y.ALPHA_BLEND},C={depthMask:!0,depthTest:{enabled:!0},stencilTest:A.setCesium3DTileBit(),stencilMask:A.CESIUM_3D_TILE_MASK,blending:y.ALPHA_BLEND};D.prototype.update=function(b){var f=this._texture,k=!a(f)||this.previousFramebuffer!==this._previousFramebuffer;this._previousFramebuffer=this.previousFramebuffer;var l=b.drawingBufferWidth,y=b.drawingBufferHeight;if((f=!a(f)||f.width!==l||f.height!==y)||k)this._texture=this._texture&&this._texture.destroy(),this._classifiedTexture=this._classifiedTexture&&this._classifiedTexture.destroy(),this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy(),this._texture=new q({context:b,width:l,height:y,pixelFormat:g.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new p({wrapS:c.CLAMP_TO_EDGE,wrapT:c.CLAMP_TO_EDGE,minificationFilter:r.LINEAR,magnificationFilter:t.LINEAR})}),a(this._previousFramebuffer)||(this._classifiedTexture=new q({context:b,width:l,height:y,pixelFormat:g.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new p({wrapS:c.CLAMP_TO_EDGE,wrapT:c.CLAMP_TO_EDGE,minificationFilter:r.LINEAR,magnificationFilter:t.LINEAR})}),this._depthStencilTexture=new q({context:b,width:l,height:y,pixelFormat:g.DEPTH_STENCIL,pixelDatatype:e.UNSIGNED_INT_24_8}));if(!a(this._fbo)||f||k){this._fbo=this._fbo&&this._fbo.destroy();this._fboClassified=this._fboClassified&&this._fboClassified.destroy();var z;a(this._previousFramebuffer)?(l=this._previousFramebuffer.depthStencilTexture,z=this._previousFramebuffer.depthStencilRenderbuffer):l=this._depthStencilTexture;this._fbo=new m({context:b,colorTextures:[this._texture],depthStencilTexture:l,depthStencilRenderbuffer:z,destroyAttachments:!1});a(this._previousFramebuffer)||(this._fboClassified=new m({context:b,colorTextures:[this._classifiedTexture],depthStencilTexture:l,destroyAttachments:!1}))}a(this._rsUnclassified)||(this._rsUnclassified=h.fromCache(v),this._rsClassified=h.fromCache(B),this._rsDefault=h.fromCache(C));if(!a(this._unclassifiedCommand)||k)a(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy()),z=a(this._previousFramebuffer)?"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color \x3d texture2D(colorTexture, v_textureCoordinates);\n    if (color.a \x3d\x3d 0.0)\n    {\n        discard;\n    }\n#ifdef UNCLASSIFIED\n    gl_FragColor \x3d color * czm_invertClassificationColor;\n#else\n    gl_FragColor \x3d color;\n#endif\n}\n":"#extension GL_EXT_frag_depth : enable\nuniform sampler2D colorTexture;\nuniform sampler2D depthTexture;\nuniform sampler2D classifiedTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    vec4 color \x3d texture2D(colorTexture, v_textureCoordinates);\n    if (color.a \x3d\x3d 0.0)\n    {\n        discard;\n    }\n    bool isClassified \x3d all(equal(texture2D(classifiedTexture, v_textureCoordinates), vec4(0.0)));\n#ifdef UNCLASSIFIED\n    vec4 highlightColor \x3d czm_invertClassificationColor;\n    if (isClassified)\n    {\n        discard;\n    }\n#else\n    vec4 highlightColor \x3d vec4(1.0);\n    if (!isClassified)\n    {\n        discard;\n    }\n#endif\n    gl_FragColor \x3d color * highlightColor;\n    gl_FragDepthEXT \x3d texture2D(depthTexture, v_textureCoordinates).r;\n}\n",k=new d({defines:["UNCLASSIFIED"],sources:[z]}),z=new d({sources:[z]}),this._unclassifiedCommand=b.createViewportQuadCommand(k,{renderState:a(this._previousFramebuffer)?this._rsUnclassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),this._classifiedCommand=b.createViewportQuadCommand(z,{renderState:a(this._previousFramebuffer)?this._rsClassified:this._rsDefault,uniformMap:this._uniformMap,owner:this}),a(this._translucentCommand)&&(this._translucentCommand.shaderProgram=this._translucentCommand.shaderProgram&&this._translucentCommand.shaderProgram.destroy()),a(this._previousFramebuffer)||(this._translucentCommand=b.createViewportQuadCommand(u,{renderState:this._rsUnclassified,uniformMap:this._uniformMap,owner:this}))};D.prototype.clear=function(b,c){var d=c.framebuffer;a(this._previousFramebuffer)?(c.framebuffer=this._fbo,this._clearColorCommand.execute(b,c)):(c.framebuffer=this._fbo,this._clearCommand.execute(b,c),c.framebuffer=this._fboClassified,this._clearCommand.execute(b,c));c.framebuffer=d};D.prototype.executeClassified=function(b,c){if(!a(this._previousFramebuffer)){var d=c.framebuffer;c.framebuffer=this._fboClassified;this._translucentCommand.execute(b,c);c.framebuffer=d}this._classifiedCommand.execute(b,c)};D.prototype.executeUnclassified=function(a,b){this._unclassifiedCommand.execute(a,b)};D.prototype.isDestroyed=function(){return!1};D.prototype.destroy=function(){this._fbo=this._fbo&&this._fbo.destroy();this._texture=this._texture&&this._texture.destroy();this._depthStencilTexture=this._depthStencilTexture&&this._depthStencilTexture.destroy();a(this._unclassifiedCommand)&&(this._unclassifiedCommand.shaderProgram=this._unclassifiedCommand.shaderProgram&&this._unclassifiedCommand.shaderProgram.destroy(),this._classifiedCommand.shaderProgram=this._classifiedCommand.shaderProgram&&this._classifiedCommand.shaderProgram.destroy());return k(this)};return D});F("Scene/JobScheduler",["../Core/defined","../Core/defineProperties","../Core/DeveloperError","../Core/getTimestamp","./JobType"],function(b,a,f,k,g){function l(a){this._total=a;this.stolenFromMeThisFrame=this.usedThisFrame=0;this.starvedLastFrame=this.starvedThisFrame=!1}function m(a){if(b(a)&&a.length!==g.NUMBER_OF_JOB_TYPES)throw new f("A budget must be specified for each job type; budgets.length should equal JobType.NUMBER_OF_JOB_TYPES.");var e=Array(g.NUMBER_OF_JOB_TYPES);e[g.TEXTURE]=new l(b(a)?a[g.TEXTURE]:10);e[g.PROGRAM]=new l(b(a)?a[g.PROGRAM]:10);e[g.BUFFER]=new l(b(a)?a[g.BUFFER]:30);a=e.length;var k,d=0;for(k=0;k<a;++k)d+=e[k].total;var m=Array(a);for(k=0;k<a;++k)m[k]=!1;this._totalBudget=d;this._totalUsedThisFrame=0;this._budgets=e;this._executedThisFrame=m}a(l.prototype,{total:{get:function(){return this._total}}});m.getTimestamp=k;a(m.prototype,{totalBudget:{get:function(){return this._totalBudget}}});m.prototype.disableThisFrame=function(){this._totalUsedThisFrame=this._totalBudget};m.prototype.resetBudgets=function(){for(var a=this._budgets,b=a.length,f=0;f<b;++f){var d=a[f];d.starvedLastFrame=d.starvedThisFrame;d.starvedThisFrame=!1;d.usedThisFrame=0;d.stolenFromMeThisFrame=0}this._totalUsedThisFrame=0};m.prototype.execute=function(a,b){var e=this._budgets,d=e[b],f=this._executedThisFrame[b];if(this._totalUsedThisFrame>=this._totalBudget&&f)return d.starvedThisFrame=!0,!1;var g;if(d.usedThisFrame+d.stolenFromMeThisFrame>=d.total){var h=e.length,c;for(c=0;c<h&&(g=e[c],!(g.usedThisFrame+g.stolenFromMeThisFrame<g.total)||g.starvedLastFrame);++c);if(c===h&&f)return!1;f&&(d.starvedThisFrame=!0)}e=m.getTimestamp();a.execute();e=m.getTimestamp()-e;this._totalUsedThisFrame+=e;g?g.stolenFromMeThisFrame+=e:d.usedThisFrame+=e;return this._executedThisFrame[b]=!0};return m});F("Scene/MapboxStyleImageryProvider","../Core/Credit ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/MapboxApi ../Core/Resource ./UrlTemplateImageryProvider".split(" "),function(b,a,f,k,g,l,m,e){function h(h){h=a(h,a.EMPTY_OBJECT);var k=h.styleId;if(!f(k))throw new g("options.styleId is required.");var q=h.url;f(q)||(q="https://api.mapbox.com/styles/v1/");this._url=q;var q=m.createIfNeeded(q),c=l.getAccessToken(h.accessToken);this._styleId=k;this._accessToken=c;this._accessTokenErrorCredit=b.clone(l.getErrorCredit(h.accessToken));this._tilesize=a(h.tilesize,512);this._username=a(h.username,"mapbox");var u=f(h.scaleFactor)?"@2x":"",y=q.getUrlComponent();p.test(y)||(y+="/");y+=this._username+"/"+k+"/tiles/"+this._tilesize+"/{z}/{x}/{y}"+u;q.url=y;q.setQueryParameters({access_token:c});f(h.credit)?(k=h.credit,"string"===typeof k&&(k=new b(k))):k=d;this._resource=q;this._imageryProvider=new e({url:q,credit:k,ellipsoid:h.ellipsoid,minimumLevel:h.minimumLevel,maximumLevel:h.maximumLevel,rectangle:h.rectangle})}var p=/\/$/,d=new b('\x26copy; \x3ca href\x3d"https://www.mapbox.com/about/maps/"\x3eMapbox\x3c/a\x3e \x26copy; \x3ca href\x3d"http://www.openstreetmap.org/copyright"\x3eOpenStreetMap\x3c/a\x3e \x3cstrong\x3e\x3ca href\x3d"https://www.mapbox.com/map-feedback/"\x3eImprove this map\x3c/a\x3e\x3c/strong\x3e');k(h.prototype,{url:{get:function(){return this._url}},ready:{get:function(){return this._imageryProvider.ready}},readyPromise:{get:function(){return this._imageryProvider.readyPromise}},rectangle:{get:function(){return this._imageryProvider.rectangle}},tileWidth:{get:function(){return this._imageryProvider.tileWidth}},tileHeight:{get:function(){return this._imageryProvider.tileHeight}},maximumLevel:{get:function(){return this._imageryProvider.maximumLevel}},minimumLevel:{get:function(){return this._imageryProvider.minimumLevel}},tilingScheme:{get:function(){return this._imageryProvider.tilingScheme}},tileDiscardPolicy:{get:function(){return this._imageryProvider.tileDiscardPolicy}},errorEvent:{get:function(){return this._imageryProvider.errorEvent}},credit:{get:function(){return this._imageryProvider.credit}},proxy:{get:function(){return this._imageryProvider.proxy}},hasAlphaChannel:{get:function(){return this._imageryProvider.hasAlphaChannel}}});h.prototype.getTileCredits=function(a,b,d){if(f(this._accessTokenErrorCredit))return[this._accessTokenErrorCredit]};h.prototype.requestImage=function(a,b,d,c){return this._imageryProvider.requestImage(a,b,d,c)};h.prototype.pickFeatures=function(a,b,d,c,e){return this._imageryProvider.pickFeatures(a,b,d,c,e)};h._defaultCredit=d;return h});F("Scene/Moon","../Core/buildModuleUrl ../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Ellipsoid ../Core/IauOrientationAxes ../Core/Matrix3 ../Core/Matrix4 ../Core/Math ../Core/Simon1994PlanetaryPositions ../Core/Transforms ./EllipsoidPrimitive ./Material".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c){function u(a){a=f(a,f.EMPTY_OBJECT);var g=a.textureUrl;k(g)||(g=b("Assets/Textures/moonSmall.jpg"));this.show=f(a.show,!0);this.textureUrl=g;this._ellipsoid=f(a.ellipsoid,new m(5*d.LUNAR_RADIUS,5*d.LUNAR_RADIUS,5*d.LUNAR_RADIUS));this.onlySunLighting=f(a.onlySunLighting,!0);this._ellipsoidPrimitive=new r({radii:this.ellipsoid.radii,material:c.fromType(c.ImageType),depthTestEnabled:!1,_owner:this});this._ellipsoidPrimitive.material.translucent=!1;this._axes=new e}g(u.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});var y=new h,A=new h,z=new a,x=[];u.prototype.update=function(a){if(this.show){var b=this._ellipsoidPrimitive;b.material.uniforms.image=this.textureUrl;b.onlySunLighting=this.onlySunLighting;var c=a.time;k(t.computeIcrfToFixedMatrix(c,y))||t.computeTemeToPseudoFixedMatrix(c,y);var d=this._axes.evaluate(c,A);h.transpose(d,d);h.multiply(y,d,d);c=q.computeMoonPositionInEarthInertialFrame(c,z);h.multiplyByVector(y,c,c);p.fromRotationTranslation(d,c,b.modelMatrix);d=a.commandList;a.commandList=x;x.length=0;b.update(a);a.commandList=d;return 1===x.length?x[0]:void 0}};u.prototype.isDestroyed=function(){return!1};u.prototype.destroy=function(){this._ellipsoidPrimitive=this._ellipsoidPrimitive&&this._ellipsoidPrimitive.destroy();return l(this)};return u});F("Scene/NeverTileDiscardPolicy",[],function(){function b(a){}b.prototype.isReady=function(){return!0};b.prototype.shouldDiscardImage=function(a){return!1};return b});F("Shaders/AdjustTranslucentFS",[],function(){return"#ifdef MRT\n#extension GL_EXT_draw_buffers : enable\n#endif\nuniform vec4 u_bgColor;\nuniform sampler2D u_depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nif (texture2D(u_depthTexture, v_textureCoordinates).r \x3c 1.0)\n{\n#ifdef MRT\ngl_FragData[0] \x3d u_bgColor;\ngl_FragData[1] \x3d vec4(u_bgColor.a);\n#else\ngl_FragColor \x3d u_bgColor;\n#endif\nreturn;\n}\ndiscard;\n}\n"});F("Shaders/CompositeOITFS",[],function(){return"uniform sampler2D u_opaque;\nuniform sampler2D u_accumulation;\nuniform sampler2D u_revealage;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 opaque \x3d texture2D(u_opaque, v_textureCoordinates);\nvec4 accum \x3d texture2D(u_accumulation, v_textureCoordinates);\nfloat r \x3d texture2D(u_revealage, v_textureCoordinates).r;\n#ifdef MRT\nvec4 transparent \x3d vec4(accum.rgb / clamp(r, 1e-4, 5e4), accum.a);\n#else\nvec4 transparent \x3d vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n#endif\ngl_FragColor \x3d (1.0 - transparent.a) * transparent + transparent.a * opaque;\nif (opaque !\x3d czm_backgroundColor)\n{\ngl_FragColor.a \x3d 1.0;\n}\n}\n"});F("Scene/OIT","../Core/BoundingRectangle ../Core/Color ../Core/defined ../Core/destroyObject ../Core/PixelFormat ../Core/WebGLConstants ../Renderer/ClearCommand ../Renderer/DrawCommand ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/ShaderSource ../Renderer/Texture ../Shaders/AdjustTranslucentFS ../Shaders/CompositeOITFS ./BlendEquation ./BlendFunction".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(c){this._translucentMRTSupport=this._translucentMultipassSupport=!1;var d=c.colorBufferFloat&&c.depthTexture;this._translucentMRTSupport=c.drawBuffers&&d;this._translucentMultipassSupport=!this._translucentMRTSupport&&d;this._adjustAlphaFBO=this._adjustTranslucentFBO=this._alphaFBO=this._translucentFBO=this._accumulationTexture=this._depthStencilTexture=this._opaqueTexture=this._opaqueFBO=void 0;this._opaqueClearCommand=new m({color:new a(0,0,0,0),owner:this});this._translucentMRTClearCommand=new m({color:new a(0,0,0,1),owner:this});this._translucentMultipassClearCommand=new m({color:new a(0,0,0,0),owner:this});this._alphaClearCommand=new m({color:new a(1,1,1,1),owner:this});this._translucentRenderStateCache={};this._alphaRenderStateCache={};this._adjustAlphaCommand=this._adjustTranslucentCommand=this._compositeCommand=void 0;this._viewport=new b;this._rs=void 0;this._useScissorTest=!1;this._scissorRectangle=void 0;this._useHDR=!1}function z(a){a._accumulationTexture=a._accumulationTexture&&!a._accumulationTexture.isDestroyed()&&a._accumulationTexture.destroy();a._revealageTexture=a._revealageTexture&&!a._revealageTexture.isDestroyed()&&a._revealageTexture.destroy()}function x(a){a._translucentFBO=a._translucentFBO&&!a._translucentFBO.isDestroyed()&&a._translucentFBO.destroy();a._alphaFBO=a._alphaFBO&&!a._alphaFBO.isDestroyed()&&a._alphaFBO.destroy();a._adjustTranslucentFBO=a._adjustTranslucentFBO&&!a._adjustTranslucentFBO.isDestroyed()&&a._adjustTranslucentFBO.destroy();a._adjustAlphaFBO=a._adjustAlphaFBO&&!a._adjustAlphaFBO.isDestroyed()&&a._adjustAlphaFBO.destroy()}function D(a,b,c,d){z(a);a._accumulationTexture=new t({context:b,width:c,height:d,pixelFormat:g.RGBA,pixelDatatype:p.FLOAT});var e=new Float32Array(c*d*4);a._revealageTexture=new t({context:b,pixelFormat:g.RGBA,pixelDatatype:p.FLOAT,source:{arrayBufferView:e,width:c,height:d},flipY:!1})}function v(a,b){x(a);var c=l.FRAMEBUFFER_COMPLETE,d=!0;a._translucentMRTSupport&&(a._translucentFBO=new h({context:b,colorTextures:[a._accumulationTexture,a._revealageTexture],depthStencilTexture:a._depthStencilTexture,destroyAttachments:!1}),a._adjustTranslucentFBO=new h({context:b,colorTextures:[a._accumulationTexture,a._revealageTexture],destroyAttachments:!1}),a._translucentFBO.status!==c||a._adjustTranslucentFBO.status!==c)&&(x(a),a._translucentMRTSupport=!1);if(!a._translucentMRTSupport){a._translucentFBO=new h({context:b,colorTextures:[a._accumulationTexture],depthStencilTexture:a._depthStencilTexture,destroyAttachments:!1});a._alphaFBO=new h({context:b,colorTextures:[a._revealageTexture],depthStencilTexture:a._depthStencilTexture,destroyAttachments:!1});a._adjustTranslucentFBO=new h({context:b,colorTextures:[a._accumulationTexture],destroyAttachments:!1});a._adjustAlphaFBO=new h({context:b,colorTextures:[a._revealageTexture],destroyAttachments:!1});var e=a._alphaFBO.status===c,f=a._adjustTranslucentFBO.status===c,g=a._adjustAlphaFBO.status===c;a._translucentFBO.status===c&&e&&f&&g||(z(a),x(a),d=a._translucentMultipassSupport=!1)}return d}function B(a,b,c,e){a=c[e.id];f(a)||(a=d.getState(e),a.depthMask=!1,a.blending=b,a=d.fromCache(a),c[e.id]=a);return a}function C(a,b,c,d){var e=a.shaderCache.getDerivedShaderProgram(b,c);if(!f(e)){var e=b._attributeLocations,g=b.fragmentShaderSource.clone();g.sources=g.sources.map(function(a){a=q.replaceMain(a,"czm_translucent_main");a=a.replace(/gl_FragColor/g,"czm_gl_FragColor");a=a.replace(/\bdiscard\b/g,"czm_discard \x3d true");return a=a.replace(/czm_phong/g,"czm_translucentPhong")});g.sources.splice(0,0,(-1!==d.indexOf("gl_FragData")?"#extension GL_EXT_draw_buffers : enable \n":"")+"vec4 czm_gl_FragColor;\nbool czm_discard \x3d false;\n");g.sources.push("void main()\n{\n    czm_translucent_main();\n    if (czm_discard)\n    {\n        discard;\n    }\n"+d+"}\n");e=a.shaderCache.createDerivedShaderProgram(b,c,{vertexShaderSource:b.vertexShaderSource,fragmentShaderSource:g,attributeLocations:e})}return e}A.prototype.update=function(a,e,g,h){if(this.isSupported()){this._opaqueFBO=g;this._opaqueTexture=g.getColorTexture(0);this._depthStencilTexture=g.depthStencilTexture;g=this._opaqueTexture.width;var k=this._opaqueTexture.height,l=this._accumulationTexture;(l=!f(l)||l.width!==g||l.height!==k||h!==this._useHDR)&&D(this,a,g,k);if(f(this._translucentFBO)&&!l||v(this,a)){this._useHDR=h;var m=this;f(this._compositeCommand)||(h=new q({sources:[c]}),this._translucentMRTSupport&&h.defines.push("MRT"),l={u_opaque:function(){return m._opaqueTexture},u_accumulation:function(){return m._accumulationTexture},u_revealage:function(){return m._revealageTexture}},this._compositeCommand=a.createViewportQuadCommand(h,{uniformMap:l,owner:this}));f(this._adjustTranslucentCommand)||(this._translucentMRTSupport?(h=new q({defines:["MRT"],sources:[r]}),l={u_bgColor:function(){return m._translucentMRTClearCommand.color},u_depthTexture:function(){return m._depthStencilTexture}},this._adjustTranslucentCommand=a.createViewportQuadCommand(h,{uniformMap:l,owner:this})):this._translucentMultipassSupport&&(h=new q({sources:[r]}),l={u_bgColor:function(){return m._translucentMultipassClearCommand.color},u_depthTexture:function(){return m._depthStencilTexture}},this._adjustTranslucentCommand=a.createViewportQuadCommand(h,{uniformMap:l,owner:this}),l={u_bgColor:function(){return m._alphaClearCommand.color},u_depthTexture:function(){return m._depthStencilTexture}},this._adjustAlphaCommand=a.createViewportQuadCommand(h,{uniformMap:l,owner:this})));this._viewport.width=g;this._viewport.height=k;a=!b.equals(this._viewport,e.viewport);g=a!==this._useScissorTest;this._useScissorTest=a;b.equals(this._scissorRectangle,e.viewport)||(this._scissorRectangle=b.clone(e.viewport,this._scissorRectangle),g=!0);f(this._rs)&&b.equals(this._viewport,this._rs.viewport)&&!g||(this._rs=d.fromCache({viewport:this._viewport,scissorTest:{enabled:this._useScissorTest,rectangle:this._scissorRectangle}}));f(this._compositeCommand)&&(this._compositeCommand.renderState=this._rs);this._adjustTranslucentCommand&&(this._adjustTranslucentCommand.renderState=this._rs);f(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.renderState=this._rs)}}};var I={enabled:!0,color:new a(0,0,0,0),equationRgb:u.ADD,equationAlpha:u.ADD,functionSourceRgb:y.ONE,functionDestinationRgb:y.ONE,functionSourceAlpha:y.ZERO,functionDestinationAlpha:y.ONE_MINUS_SOURCE_ALPHA},H={enabled:!0,color:new a(0,0,0,0),equationRgb:u.ADD,equationAlpha:u.ADD,functionSourceRgb:y.ONE,functionDestinationRgb:y.ONE,functionSourceAlpha:y.ONE,functionDestinationAlpha:y.ONE},F={enabled:!0,color:new a(0,0,0,0),equationRgb:u.ADD,equationAlpha:u.ADD,functionSourceRgb:y.ZERO,functionDestinationRgb:y.ONE_MINUS_SOURCE_ALPHA,functionSourceAlpha:y.ZERO,functionDestinationAlpha:y.ONE_MINUS_SOURCE_ALPHA};A.prototype.createDerivedCommands=function(a,b,c){f(c)||(c={});if(this._translucentMRTSupport){var d,g;f(c.translucentCommand)&&(d=c.translucentCommand.shaderProgram,g=c.translucentCommand.renderState);c.translucentCommand=e.shallowClone(a,c.translucentCommand);f(d)&&c.shaderProgramId===a.shaderProgram.id?(c.translucentCommand.shaderProgram=d,c.translucentCommand.renderState=g):(c.translucentCommand.shaderProgram=C(b,a.shaderProgram,"translucentMRT","    vec3 Ci \x3d czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai \x3d czm_gl_FragColor.a;\n    float wzi \x3d czm_alphaWeight(ai);\n    gl_FragData[0] \x3d vec4(Ci * wzi, ai);\n    gl_FragData[1] \x3d vec4(ai * wzi);\n"),c.translucentCommand.renderState=B(b,I,this._translucentRenderStateCache,a.renderState),c.shaderProgramId=a.shaderProgram.id)}else{var h,k,l,m;f(c.translucentCommand)&&(h=c.translucentCommand.shaderProgram,k=c.translucentCommand.renderState,l=c.alphaCommand.shaderProgram,m=c.alphaCommand.renderState);c.translucentCommand=e.shallowClone(a,c.translucentCommand);c.alphaCommand=e.shallowClone(a,c.alphaCommand);f(h)&&c.shaderProgramId===a.shaderProgram.id?(c.translucentCommand.shaderProgram=h,c.translucentCommand.renderState=k,c.alphaCommand.shaderProgram=l,c.alphaCommand.renderState=m):(c.translucentCommand.shaderProgram=C(b,a.shaderProgram,"translucentMultipass","    vec3 Ci \x3d czm_gl_FragColor.rgb * czm_gl_FragColor.a;\n    float ai \x3d czm_gl_FragColor.a;\n    float wzi \x3d czm_alphaWeight(ai);\n    gl_FragColor \x3d vec4(Ci, ai) * wzi;\n"),c.translucentCommand.renderState=B(b,H,this._translucentRenderStateCache,a.renderState),c.alphaCommand.shaderProgram=C(b,a.shaderProgram,"alphaMultipass","    float ai \x3d czm_gl_FragColor.a;\n    gl_FragColor \x3d vec4(ai);\n"),c.alphaCommand.renderState=B(b,F,this._alphaRenderStateCache,a.renderState),c.shaderProgramId=a.shaderProgram.id)}return c};A.prototype.executeCommands=function(a,b,c,d,e){if(this._translucentMRTSupport){var g=a.context,h=a.frameState.useLogDepth,k=a._hdr,l=c.framebuffer,m=d.length,p=a.frameState.shadowState.lightShadowsEnabled;c.framebuffer=this._adjustTranslucentFBO;this._adjustTranslucentCommand.execute(g,c);var q=this._opaqueFBO;c.framebuffer=this._translucentFBO;for(var r,t=0;t<m;++t)r=d[t],r=h?r.derivedCommands&&r.derivedCommands.logDepth.command:r,r=k?r&&r.derivedCommands&&r.derivedCommands.hdr.command:r,f(r)&&(r=p&&r.receiveShadows?r.derivedCommands.oit.shadows.translucentCommand:r.derivedCommands.oit.translucentCommand,b(r,a,g,c,q));f(e)&&(r=e.unclassifiedCommand,r=p&&r.receiveShadows?r.derivedCommands.oit.shadows.translucentCommand:r.derivedCommands.oit.translucentCommand,b(r,a,g,c,q));c.framebuffer=l}else{h=a.context;k=a.frameState.useLogDepth;l=a._hdr;m=c.framebuffer;p=d.length;q=a.frameState.shadowState.lightShadowsEnabled;c.framebuffer=this._adjustTranslucentFBO;this._adjustTranslucentCommand.execute(h,c);c.framebuffer=this._adjustAlphaFBO;this._adjustAlphaCommand.execute(h,c);t=this._opaqueFBO;c.framebuffer=this._translucentFBO;for(g=0;g<p;++g)r=d[g],r=k?r.derivedCommands.logDepth.command:r,r=l?r.derivedCommands.hdr.command:r,r=q&&r.receiveShadows?r.derivedCommands.oit.shadows.translucentCommand:r.derivedCommands.oit.translucentCommand,b(r,a,h,c,t);f(e)&&(r=e.unclassifiedCommand,r=q&&r.receiveShadows?r.derivedCommands.oit.shadows.translucentCommand:r.derivedCommands.oit.translucentCommand,b(r,a,h,c,t));c.framebuffer=this._alphaFBO;for(g=0;g<p;++g)r=d[g],r=k?r.derivedCommands.logDepth.command:r,r=l?r.derivedCommands.hdr.command:r,r=q&&r.receiveShadows?r.derivedCommands.oit.shadows.alphaCommand:r.derivedCommands.oit.alphaCommand,b(r,a,h,c,t);f(e)&&(r=e.unclassifiedCommand,r=q&&r.receiveShadows?r.derivedCommands.oit.shadows.alphaCommand:r.derivedCommands.oit.alphaCommand,b(r,a,h,c,t));c.framebuffer=m}};A.prototype.execute=function(a,b){this._compositeCommand.execute(a,b)};A.prototype.clear=function(b,c,d){var e=c.framebuffer;c.framebuffer=this._opaqueFBO;a.clone(d,this._opaqueClearCommand.color);this._opaqueClearCommand.execute(b,c);c.framebuffer=this._translucentFBO;(this._translucentMRTSupport?this._translucentMRTClearCommand:this._translucentMultipassClearCommand).execute(b,c);this._translucentMultipassSupport&&(c.framebuffer=this._alphaFBO,this._alphaClearCommand.execute(b,c));c.framebuffer=e};A.prototype.isSupported=function(){return this._translucentMRTSupport||this._translucentMultipassSupport};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){z(this);x(this);f(this._compositeCommand)&&(this._compositeCommand.shaderProgram=this._compositeCommand.shaderProgram&&this._compositeCommand.shaderProgram.destroy());f(this._adjustTranslucentCommand)&&(this._adjustTranslucentCommand.shaderProgram=this._adjustTranslucentCommand.shaderProgram&&this._adjustTranslucentCommand.shaderProgram.destroy());f(this._adjustAlphaCommand)&&(this._adjustAlphaCommand.shaderProgram=this._adjustAlphaCommand.shaderProgram&&this._adjustAlphaCommand.shaderProgram.destroy());return k(this)};return A});F("Scene/Particle","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties".split(" "),function(b,a,f,k,g,l,m){function e(d){d=g(d,g.EMPTY_OBJECT);this.mass=g(d.mass,1);this.position=a.clone(g(d.position,a.ZERO));this.velocity=a.clone(g(d.velocity,a.ZERO));this.life=g(d.life,Number.MAX_VALUE);this.image=d.image;this.startColor=k.clone(g(d.startColor,k.WHITE));this.endColor=k.clone(g(d.endColor,k.WHITE));this.startScale=g(d.startScale,1);this.endScale=g(d.endScale,1);this.imageSize=b.clone(g(d.imageSize,h));this._normalizedAge=this._age=0;this._billboard=void 0}var h=new b(1,1);m(e.prototype,{age:{get:function(){return this._age}},normalizedAge:{get:function(){return this._normalizedAge}}});var p=new a;e.prototype.update=function(b,e){a.multiplyByScalar(this.velocity,b,p);a.add(this.position,p,this.position);l(e)&&e(this,b);this._age+=b;this._normalizedAge=this.life===Number.MAX_VALUE?0:this._age/this.life;return this._age<=this.life};return e});F("Scene/ParticleBurst",["../Core/defaultValue","../Core/defineProperties"],function(b,a){function f(a){a=b(a,b.EMPTY_OBJECT);this.time=b(a.time,0);this.minimum=b(a.minimum,0);this.maximum=b(a.maximum,50);this._complete=!1}a(f.prototype,{complete:{get:function(){return this._complete}}});return f});F("Scene/ParticleEmitter",["../Core/DeveloperError"],function(b){function a(a){throw new b("This type should not be instantiated directly.  Instead, use BoxEmitter, CircleEmitter, ConeEmitter or SphereEmitter.");}a.prototype.emit=function(a){b.throwInstantiationError()};return a});F("Scene/ParticleSystem","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Check ../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Event ../Core/JulianDate ../Core/Math ../Core/Matrix4 ../Core/DistanceDisplayCondition ../Core/NearFarScalar ./BillboardCollection ./CircleEmitter ./Particle".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){a=g(a,g.EMPTY_OBJECT);this.show=g(a.show,!0);this.updateCallback=a.updateCallback;this.loop=g(a.loop,!0);this.image=g(a.image,void 0);var c=a.emitter;l(c)||(c=new u(.5));this._emitter=c;this._bursts=a.bursts;this._modelMatrix=q.clone(g(a.modelMatrix,q.IDENTITY));this._emitterModelMatrix=q.clone(g(a.emitterModelMatrix,q.IDENTITY));this._matrixDirty=!0;this._combinedMatrix=new q;this._startColor=k.clone(g(a.color,g(a.startColor,k.WHITE)));this._endColor=k.clone(g(a.color,g(a.endColor,k.WHITE)));this._startScale=g(a.scale,g(a.startScale,1));this._endScale=g(a.scale,g(a.endScale,1));this._emissionRate=g(a.emissionRate,5);this._minimumSpeed=g(a.speed,g(a.minimumSpeed,1));this._maximumSpeed=g(a.speed,g(a.maximumSpeed,1));this._minimumParticleLife=g(a.particleLife,g(a.minimumParticleLife,5));this._maximumParticleLife=g(a.particleLife,g(a.maximumParticleLife,5));this._minimumMass=g(a.mass,g(a.minimumMass,1));this._maximumMass=g(a.mass,g(a.maximumMass,1));this._minimumImageSize=b.clone(g(a.imageSize,g(a.minimumImageSize,x)));this._maximumImageSize=b.clone(g(a.imageSize,g(a.maximumImageSize,x)));this._lifetime=g(a.lifetime,Number.MAX_VALUE);this._realtime=g(a.realtime,!1);this._translucencyByDistance=g(a.translucencyByDistance,void 0);if(l(this._translucencyByDistance)&&this._translucencyByDistance.far<=this._translucencyByDistance.near)throw new DeveloperError("translucencyByDistance.far must be greater than translucencyByDistance.near.");this._scaleByDistance=g(a.scaleByDistance,void 0);if(l(this._scaleByDistance)&&this._scaleByDistance.far<=this._scaleByDistance.near)throw new DeveloperError("scaleByDistance.far must be greater than scaleByDistance.near.");this._distanceDisplayCondition=g(a.distanceDisplayCondition,void 0);if(l(this._distanceDisplayCondition)&&this._distanceDisplayCondition.far<=this._distanceDisplayCondition.near)throw new DeveloperError("distanceDisplayCondition.far must be greater than distanceDisplayCondition.near.");this._billboardCollection=void 0;this._particles=[];this._particlePool=[];this._previousTime=void 0;this._carryOver=this._currentTime=0;this._complete=new h;this._isComplete=!1;this._updateParticlePool=!0;this._particleEstimate=0}function z(a,b){var c=b._billboard;l(c)||(c=b._billboard=a._billboardCollection.add({image:b.image,distanceDisplayCondition:a._distanceDisplayCondition,scaleByDistance:a._scaleByDistance,translucencyByDistance:a._translucencyByDistance}));c.distanceDisplayCondition=a._distanceDisplayCondition;c.scaleByDistance=a._scaleByDistance;c.translucencyByDistance=a._translucencyByDistance;c.width=b.imageSize.x;c.height=b.imageSize.y;c.position=b.position;c.show=!0;var e=d.lerp(b.startColor.red,b.endColor.red,b.normalizedAge),f=d.lerp(b.startColor.green,b.endColor.green,b.normalizedAge),g=d.lerp(b.startColor.blue,b.endColor.blue,b.normalizedAge),h=d.lerp(b.startColor.alpha,b.endColor.alpha,b.normalizedAge);c.color=new k(e,f,g,h);c.scale=d.lerp(b.startScale,b.endScale,b.normalizedAge)}var x=new b(1,1);m(A.prototype,{emitter:{get:function(){return this._emitter},set:function(a){f.defined("value",a);this._emitter=a}},bursts:{get:function(){return this._bursts},set:function(a){this._bursts=a;this._updateParticlePool=!0}},modelMatrix:{get:function(){return this._modelMatrix},set:function(a){f.defined("value",a);this._matrixDirty=this._matrixDirty||!q.equals(this._modelMatrix,a);q.clone(a,this._modelMatrix)}},emitterModelMatrix:{get:function(){return this._emitterModelMatrix},set:function(a){f.defined("value",a);this._matrixDirty=this._matrixDirty||!q.equals(this._emitterModelMatrix,a);q.clone(a,this._emitterModelMatrix)}},startColor:{get:function(){return this._startColor},set:function(a){f.defined("value",a);k.clone(a,this._startColor)}},endColor:{get:function(){return this._endColor},set:function(a){f.defined("value",a);k.clone(a,this._endColor)}},startScale:{get:function(){return this._startScale},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._startScale=a}},endScale:{get:function(){return this._endScale},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._endScale=a}},emissionRate:{get:function(){return this._emissionRate},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._emissionRate=a;this._updateParticlePool=!0}},minimumSpeed:{get:function(){return this._minimumSpeed},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._minimumSpeed=a}},maximumSpeed:{get:function(){return this._maximumSpeed},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._maximumSpeed=a}},minimumParticleLife:{get:function(){return this._minimumParticleLife},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._minimumParticleLife=a}},maximumParticleLife:{get:function(){return this._maximumParticleLife},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._maximumParticleLife=a;this._updateParticlePool=!0}},minimumMass:{get:function(){return this._minimumMass},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._minimumMass=a}},maximumMass:{get:function(){return this._maximumMass},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._maximumMass=a}},minimumImageSize:{get:function(){return this._minimumImageSize},set:function(a){f.typeOf.object("value",a);f.typeOf.number.greaterThanOrEquals("value.x",a.x,0);f.typeOf.number.greaterThanOrEquals("value.y",a.y,0);this._minimumImageSize=a}},maximumImageSize:{get:function(){return this._maximumImageSize},set:function(a){f.typeOf.object("value",a);f.typeOf.number.greaterThanOrEquals("value.x",a.x,0);f.typeOf.number.greaterThanOrEquals("value.y",a.y,0);this._maximumImageSize=a}},lifetime:{get:function(){return this._lifetime},set:function(a){f.typeOf.number.greaterThanOrEquals("value",a,0);this._lifetime=a}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(a){this._distanceDisplayCondition=t.clone(a,this._distanceDisplayCondition)}},scaleByDistance:{get:function(){return this._scaleByDistance},set:function(a){this._scaleByDistance=r.clone(a,this._scaleByDistance)}},translucencyByDistance:{get:function(){return this._translucencyByDistance},set:function(a){this._translucencyByDistance=r.clone(a,this._translucencyByDistance)}},complete:{get:function(){return this._complete}},isComplete:{get:function(){return this._isComplete}}});var D=new a;A.prototype.update=function(b){if(this.show){l(this._billboardCollection)||(this._billboardCollection=new c);if(this._updateParticlePool){var e=this._emissionRate,f=this._maximumParticleLife,g=0,h=this._bursts;if(l(h))for(var m=h.length,r=0;r<m;++r)g+=h[r].maximum;h=this._billboardCollection;m=this.image;e=Math.ceil(e*f+g);f=this._particlePool;g=Math.max(e-this._particles.length-f.length,0);for(r=0;r<g;++r){var t=new y;t._billboard=h.add({image:m,distanceDisplayCondition:this._distanceDisplayCondition,scaleByDistance:this._scaleByDistance,translucencyByDistance:this._translucencyByDistance});f.push(t)}this._particleEstimate=e;this._updateParticlePool=!1}h=0;this._previousTime&&(h=p.secondsDifference(b.time,this._previousTime));0>h&&(h=0);g=this._particles;m=this._emitter;r=this.updateCallback;t=g.length;for(e=0;e<t;++e)if(f=g[e],f.update(h,r))z(this,f);else{var u=f;l(u._billboard)&&(u._billboard.show=!1);this._particlePool.push(f);g[e]=g[t-1];--e;--t}g.length=t;e=h;if(this._isComplete)g=0;else{e=d.mod(e,this._lifetime);f=e*this._emissionRate;e=Math.floor(f);this._carryOver+=f-e;1<this._carryOver&&(e++,--this._carryOver);if(l(this.bursts))for(f=this.bursts.length,g=0;g<f;g++)r=this.bursts[g],t=this._currentTime,l(r)&&!r._complete&&t>r.time&&(e+=d.randomBetween(r.minimum,r.maximum),r._complete=!0);g=e}if(0<g&&l(m))for(this._matrixDirty&&(this._combinedMatrix=q.multiply(this.modelMatrix,this.emitterModelMatrix,this._combinedMatrix),this._matrixDirty=!1,this._realtime&&(this._billboardCollection.modelMatrix=this._combinedMatrix)),m=this._combinedMatrix,e=0;e<g;e++)f=this._particlePool.pop(),l(f)||(f=new y),this._emitter.emit(f),a.add(f.position,f.velocity,D),this._realtime||(q.multiplyByPoint(m,D,D),f.position=q.multiplyByPoint(m,f.position,f.position),a.subtract(D,f.position,f.velocity),a.normalize(f.velocity,f.velocity)),r=f,r.startColor=k.clone(this._startColor,r.startColor),r.endColor=k.clone(this._endColor,r.endColor),r.startScale=this._startScale,r.endScale=this._endScale,r.image=this.image,r.life=d.randomBetween(this._minimumParticleLife,this._maximumParticleLife),r.mass=d.randomBetween(this._minimumMass,this._maximumMass),r.imageSize.x=d.randomBetween(this._minimumImageSize.x,this._maximumImageSize.x),r.imageSize.y=d.randomBetween(this._minimumImageSize.y,this._maximumImageSize.y),r._normalizedAge=0,r._age=0,t=d.randomBetween(this._minimumSpeed,this._maximumSpeed),a.multiplyByScalar(r.velocity,t,r.velocity),this._particles.push(r),z(this,f);this._billboardCollection.update(b);this._previousTime=p.clone(b.time,this._previousTime);this._currentTime+=h;if(this._lifetime!==Number.MAX_VALUE&&this._currentTime>this._lifetime)if(this.loop){if(this._currentTime=d.mod(this._currentTime,this._lifetime),this.bursts)for(h=this.bursts.length,e=0;e<h;e++)this.bursts[e]._complete=!1}else this._isComplete=!0,this._complete.raiseEvent(this);if(0===b.frameNumber%120){b=this._particlePool;h=this._billboardCollection;m=b.length;for(f=e=m-Math.max(this._particleEstimate-this._particles.length-m,0);f<m;++f)h.remove(b[f]._billboard);b.length=e}}};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){this._billboardCollection=this._billboardCollection&&this._billboardCollection.destroy();return e(this)};return A});F("Widgets/getElement",["../Core/DeveloperError"],function(b){return function(a){if("string"===typeof a){var f=document.getElementById(a);if(null===f)throw new b('Element with id "'+a+'" does not exist in the document.');a=f}return a}});F("Scene/PerformanceDisplay","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/getTimestamp ../Widgets/getElement".split(" "),function(b,a,f,k,g,l,m){function e(e){e=b(e,b.EMPTY_OBJECT);e=m(e.container);if(!a(e))throw new g("container is required");this._container=e;e=document.createElement("div");e.className="cesium-performanceDisplay";var f=document.createElement("div");f.className="cesium-performanceDisplay-fps";this._fpsText=document.createTextNode("");f.appendChild(this._fpsText);var d=document.createElement("div");d.className="cesium-performanceDisplay-ms";this._msText=document.createTextNode("");d.appendChild(this._msText);e.appendChild(d);e.appendChild(f);this._container.appendChild(e);this._lastFpsSampleTime=l();this._lastMsSampleTime=l();this._msFrameCount=this._fpsFrameCount=0;this._throttled=!1;f=document.createElement("div");f.className="cesium-performanceDisplay-throttled";this._throttledText=document.createTextNode("");f.appendChild(this._throttledText);e.appendChild(f)}f(e.prototype,{throttled:{get:function(){return this._throttled},set:function(a){this._throttled!==a&&(this._throttledText.nodeValue=a?"(throttled)":"",this._throttled=a)}}});e.prototype.update=function(a){var e=l();a=b(a,!0);this._fpsFrameCount++;var d=e-this._lastFpsSampleTime;if(1E3<d){var f="N/A";a&&(f=1E3*this._fpsFrameCount/d|0);this._fpsText.nodeValue=f+" FPS";this._lastFpsSampleTime=e;this._fpsFrameCount=0}this._msFrameCount++;d=e-this._lastMsSampleTime;200<d&&(f="N/A",a&&(f=(d/this._msFrameCount).toFixed(2)),this._msText.nodeValue=f+" MS",this._lastMsSampleTime=e,this._msFrameCount=0)};e.prototype.destroy=function(){return k(this)};return e});F("Scene/PickDepth","../Core/Cartesian4 ../Core/defined ../Core/destroyObject ../Core/PixelFormat ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/ShaderSource ../Renderer/Texture".split(" "),function(b,a,f,k,g,l,m,e,h){function p(){this._debugPickDepthViewportCommand=this._useLogDepth=this._copyDepthCommand=this._textureToCopy=this._depthTexture=this._framebuffer=void 0}function d(b,c,d,f){if(!a(b._debugPickDepthViewportCommand)||f!==b._useLogDepth){var g=new e({defines:[f?"LOG_DEPTH":""],sources:["uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    float z_window \x3d czm_unpackDepth(texture2D(u_texture, v_textureCoordinates));\n    z_window \x3d czm_reverseLogDepth(z_window); \n    float n_range \x3d czm_depthRange.near;\n    float f_range \x3d czm_depthRange.far;\n    float z_ndc \x3d (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n    float scale \x3d pow(z_ndc * 0.5 + 0.5, 8.0);\n    gl_FragColor \x3d vec4(mix(vec3(0.0), vec3(1.0), scale), 1.0);\n}\n"]});b._debugPickDepthViewportCommand=c.createViewportQuadCommand(g,{uniformMap:{u_texture:function(){return b._depthTexture}},owner:b});b._useLogDepth=f}b._debugPickDepthViewportCommand.execute(c,d)}function q(a){a._depthTexture=a._depthTexture&&!a._depthTexture.isDestroyed()&&a._depthTexture.destroy()}function t(a){a._framebuffer=a._framebuffer&&!a._framebuffer.isDestroyed()&&a._framebuffer.destroy()}function r(b,c,d){a(b._copyDepthCommand)||(b._copyDepthCommand=c.createViewportQuadCommand("uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\n    gl_FragColor \x3d czm_packDepth(texture2D(u_texture, v_textureCoordinates).r);\n}\n",{renderState:m.fromCache(),uniformMap:{u_texture:function(){return b._textureToCopy}},owner:b}));b._textureToCopy=d;b._copyDepthCommand.framebuffer=b._framebuffer}p.prototype.executeDebugPickDepth=function(a,b,c){d(this,a,b,c)};p.prototype.update=function(b,c){var d=c.width,e=c.height,f=this._depthTexture,f=!a(f)||f.width!==d||f.height!==e;if(!a(this._framebuffer)||f)q(this),t(this),this._depthTexture=new h({context:b,width:d,height:e,pixelFormat:k.RGBA,pixelDatatype:l.UNSIGNED_BYTE}),this._framebuffer=new g({context:b,colorTextures:[this._depthTexture],destroyAttachments:!1});r(this,b,c)};var c=new b,u=new b(1,1/255,1/65025,1/16581375);p.prototype.getDepth=function(a,d,e){a=a.readPixels({x:d,y:e,width:1,height:1,framebuffer:this._framebuffer});a=b.unpack(a,0,c);b.divideByScalar(a,255,a);return b.dot(a,u)};p.prototype.executeCopyDepth=function(a,b){this._copyDepthCommand.execute(a,b)};p.prototype.isDestroyed=function(){return!1};p.prototype.destroy=function(){q(this);t(this);this._copyDepthCommand.shaderProgram=a(this._copyDepthCommand.shaderProgram)&&this._copyDepthCommand.shaderProgram.destroy();return f(this)};return p});F("Scene/PickDepthFramebuffer","../Core/BoundingRectangle ../Core/Color ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/PixelFormat ../Renderer/Framebuffer ../Renderer/PassState ../Renderer/PixelDatatype ../Renderer/Renderbuffer ../Renderer/RenderbufferFormat ../Renderer/Texture".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(){this._passState=this._framebuffer=this._depthStencilTexture=void 0}function r(a){a._framebuffer=a._framebuffer&&a._framebuffer.destroy();a._depthStencilTexture=a._depthStencilTexture&&a._depthStencilTexture.destroy()}t.prototype.update=function(a,d,f){var c=f.width;f=f.height;k(this._framebuffer)&&c===this._depthStencilTexture.width&&f===this._depthStencilTexture.height||(r(this),this._depthStencilTexture=new q({context:a,width:a.drawingBufferWidth,height:a.drawingBufferHeight,pixelFormat:l.DEPTH_STENCIL,pixelDatatype:h.UNSIGNED_INT_24_8}),this._framebuffer=new m({context:a,depthStencilTexture:this._depthStencilTexture,destroyAttachments:!1}),a=new e(a),a.blendingEnabled=!1,a.scissorTest={enabled:!0,rectangle:new b},a.viewport=new b,this._passState=a);a=this._passState;a.framebuffer=this._framebuffer;a.viewport.width=c;a.viewport.height=f;a.scissorTest.rectangle.x=d.x;a.scissorTest.rectangle.y=f-d.y;a.scissorTest.rectangle.width=1;a.scissorTest.rectangle.height=1;return a};t.prototype.isDestroyed=function(){return!1};t.prototype.destroy=function(){r(this);return g(this)};return t});F("Scene/PickFramebuffer","../Core/BoundingRectangle ../Core/Color ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Renderer/Framebuffer ../Renderer/PassState ../Renderer/Renderbuffer ../Renderer/RenderbufferFormat ../Renderer/Texture".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a){var d=new m(a);d.blendingEnabled=!1;d.scissorTest={enabled:!0,rectangle:new b};d.viewport=new b;this._context=a;this._fb=void 0;this._passState=d;this._height=this._width=0}d.prototype.begin=function(a,d){var c=this._context,f=d.width,g=d.height;b.clone(a,this._passState.scissorTest.rectangle);k(this._fb)&&this._width===f&&this._height===g||(this._width=f,this._height=g,this._fb=this._fb&&this._fb.destroy(),this._fb=new l({context:c,colorTextures:[new p({context:c,width:f,height:g})],depthStencilRenderbuffer:new e({context:c,width:f,height:g,format:h.DEPTH_STENCIL})}),this._passState.framebuffer=this._fb);this._passState.viewport.width=f;this._passState.viewport.height=g;return this._passState};var q=new a;d.prototype.end=function(b){var d=f(b.width,1),c=f(b.height,1),e=this._context;b=e.readPixels({x:b.x,y:b.y,width:d,height:c,framebuffer:this._fb});for(var g=Math.max(d,c),g=g*g,h=Math.floor(.5*d),c=Math.floor(.5*c),l=0,m=0,p=0,t=-1,B=0;B<g;++B){if(-h<=l&&l<=h&&-c<=m&&m<=c){var C=4*((c-m)*d+l+h);q.red=a.byteToFloat(b[C]);q.green=a.byteToFloat(b[C+1]);q.blue=a.byteToFloat(b[C+2]);q.alpha=a.byteToFloat(b[C+3]);C=e.getObjectByPickColor(q);if(k(C))return C}if(l===m||0>l&&-l===m||0<l&&l===1-m)C=p,p=-t,t=C;l+=p;m+=t}};d.prototype.isDestroyed=function(){return!1};d.prototype.destroy=function(){this._fb=this._fb&&this._fb.destroy();return g(this)};return d});F("Scene/PostProcessStageSampleMode",[],function(){return{NEAREST:0,LINEAR:1}});F("Scene/PostProcessStage","../Core/BoundingRectangle ../Core/Check ../Core/Color ../Core/combine ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/Math ../Core/PixelFormat ../Core/Resource ../Renderer/PassState ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/Sampler ../Renderer/ShaderSource ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../ThirdParty/when ./PostProcessStageSampleMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C){function I(d){d=l(d,l.EMPTY_OBJECT);var e=d.fragmentShader,h=l(d.textureScale,1),k=l(d.pixelFormat,q.RGBA);a.typeOf.string("options.fragmentShader",e);a.typeOf.number.greaterThan("options.textureScale",h,0);a.typeOf.number.lessThanOrEquals("options.textureScale",h,1);if(!q.isColorFormat(k))throw new p("options.pixelFormat must be a color format.");this._fragmentShader=e;this._uniforms=d.uniforms;this._textureScale=h;this._forcePowerOfTwo=l(d.forcePowerOfTwo,!1);this._sampleMode=l(d.sampleMode,C.NEAREST);this._pixelFormat=k;this._pixelDatatype=l(d.pixelDatatype,c.UNSIGNED_BYTE);this._clearColor=l(d.clearColor,f.BLACK);this._idTexture=this._depthTexture=this._colorTexture=this._command=this._uniformMap=void 0;this._actualUniforms={};this._dirtyUniforms=[];this._texturesToRelease=[];this._texturesToCreate=[];this._texturePromise=void 0;e=new r;e.scissorTest={enabled:!0,rectangle:m(d.scissorRectangle)?b.clone(d.scissorRectangle):new b};this._passState=e;this._ready=!1;d=d.name;m(d)||(d=g());this._name=d;this._combinedSelectedShadow=this._combinedSelected=this._parentSelectedShadow=this._parentSelected=this._selectedShadow=this._selected=this._selectedIdTexture=this._useLogDepth=this._logDepthChanged=void 0;this._parentSelectedLength=this._selectedLength=0;this._selectedDirty=!0;this._index=this._textureCache=void 0;this._enabled=this.enabled=!0;this._disableTexture=void 0}function H(a,b,c){var d=b[c];("string"===typeof d||d instanceof HTMLCanvasElement||d instanceof HTMLImageElement||d instanceof HTMLVideoElement||d instanceof ImageData)&&a._dirtyUniforms.push(c);return{get:function(){return b[c]},set:function(d){var e=b[c];b[c]=d;var f=a._actualUniforms,g=f[c];m(g)&&g!==e&&g instanceof z&&!m(a._textureCache.getStageByName(c))&&(a._texturesToRelease.push(g),delete f[c],delete f[c+"Dimensions"]);e instanceof z&&a._texturesToRelease.push(e);"string"===typeof d||d instanceof HTMLCanvasElement||d instanceof HTMLImageElement||d instanceof HTMLVideoElement||d instanceof ImageData?a._dirtyUniforms.push(c):f[c]=d}}}function F(a,b){return function(){var c=a._actualUniforms[b];return"function"===typeof c?c():c}}function w(a,b){return function(){var c=a[b]();if(m(c))return c.dimensions}}function G(a){if(!m(a._uniformMap)){var b={},c={},d=a._uniforms,f=a._actualUniforms,g;for(g in d)if(d.hasOwnProperty(g)){"function"!==typeof d[g]?(b[g]=F(a,g),c[g]=H(a,d,g)):(b[g]=d[g],c[g]=d[g]);f[g]=d[g];var h=b[g]();if("string"===typeof h||h instanceof z||h instanceof HTMLImageElement||h instanceof HTMLCanvasElement||h instanceof HTMLVideoElement)b[g+"Dimensions"]=w(b,g)}a._uniforms={};e(a._uniforms,c);a._uniformMap=k(b,{colorTexture:function(){return a._colorTexture},colorTextureDimensions:function(){return a._colorTexture.dimensions},disableTexture:function(){return a._disableTexture},depthTexture:function(){return a._depthTexture},depthTextureDimensions:function(){return a._depthTexture.dimensions},czm_idTexture:function(){return a._idTexture},czm_selectedIdTexture:function(){return a._selectedIdTexture},czm_selectedIdTextureStep:function(){return 1/a._selectedIdTexture.width}})}}function E(a,b){return function(c){a._texturesToCreate.push({name:b,source:c})}}function L(a,b){return function(){return a._textureCache.getOutputTexture(b)}}function K(a,b){var c,d,e=a._texturesToRelease,f=e.length;for(c=0;c<f;++c)d=(d=e[c])&&d.destroy();e.length=0;e=a._texturesToCreate;f=e.length;for(c=0;c<f;++c){var g=e[c];d=g.name;a._actualUniforms[d]=new z({context:b,source:g.source})}e.length=0;e=a._dirtyUniforms;if(0===e.length&&!m(a._texturePromise))a._ready=!0;else if(0!==e.length&&!m(a._texturePromise)){var f=e.length,g=a._uniforms,h=[];for(c=0;c<f;++c){d=e[c];var k=g[d],l=a._textureCache.getStageByName(k);m(l)?a._actualUniforms[d]=L(a,k):"string"===typeof k?(k=new t({url:k}),h.push(k.fetchImage().then(E(a,d)))):a._texturesToCreate.push({name:d,source:k})}e.length=0;0<h.length?(a._ready=!1,a._texturePromise=B.all(h).then(function(){a._ready=!0;a._texturePromise=void 0})):a._ready=!0}}function P(a){m(a._command)&&(a._command.shaderProgram=a._command.shaderProgram&&a._command.shaderProgram.destroy(),a._command=void 0);a._selectedIdTexture=a._selectedIdTexture&&a._selectedIdTexture.destroy();var b=a._textureCache;if(m(b)){var c=a._uniforms,d=a._actualUniforms,e;for(e in d)d.hasOwnProperty(e)&&d[e]instanceof z&&(m(b.getStageByName(c[e]))||d[e].destroy(),a._dirtyUniforms.push(e))}}e(I.prototype,{ready:{get:function(){return this._ready}},name:{get:function(){return this._name}},fragmentShader:{get:function(){return this._fragmentShader}},uniforms:{get:function(){return this._uniforms}},textureScale:{get:function(){return this._textureScale}},forcePowerOfTwo:{get:function(){return this._forcePowerOfTwo}},sampleMode:{get:function(){return this._sampleMode}},pixelFormat:{get:function(){return this._pixelFormat}},pixelDatatype:{get:function(){return this._pixelDatatype}},clearColor:{get:function(){return this._clearColor}},scissorRectangle:{get:function(){return this._passState.scissorTest.rectangle}},outputTexture:{get:function(){if(m(this._textureCache)){var a=this._textureCache.getFramebuffer(this._name);if(m(a))return a.getColorTexture(0)}}},selected:{get:function(){return this._selected},set:function(a){this._selected=a}},parentSelected:{get:function(){return this._parentSelected},set:function(a){this._parentSelected=a}}});var N=/uniform\s+sampler2D\s+depthTexture/g;I.prototype._isSupported=function(a){return!N.test(this._fragmentShader)||a.depthTexture};I.prototype.update=function(a,d){this.enabled===this._enabled||this.enabled||P(this);if(this._enabled=this.enabled){this._logDepthChanged=d!==this._useLogDepth;this._useLogDepth=d;var e;a:{e=m(this._selected)?this._selected.length:0;var g=m(this._parentSelected)?this._parentSelected:0,h=this._selected!==this._selectedShadow||e!==this._selectedLength,h=h||this._parentSelected!==this._parentSelectedShadow||g!==this._parentSelectedLength;m(this._selected)&&m(this._parentSelected)?this._combinedSelected=this._selected.concat(this._parentSelected):m(this._parentSelected)?this._combinedSelected=this._parentSelected:this._combinedSelected=this._selected;if(!h&&m(this._combinedSelected)){if(!m(this._combinedSelectedShadow)){e=!0;break a}e=this._combinedSelected.length;for(g=0;g<e;++g)if(this._combinedSelected[g]!==this._combinedSelectedShadow[g]){e=!0;break a}}e=h}this._selectedDirty=e;this._selectedShadow=this._selected;this._parentSelectedShadow=this._parentSelected;this._combinedSelectedShadow=this._combinedSelected;this._selectedLength=m(this._selected)?this._selected.length:0;this._parentSelectedLength=m(this._parentSelected)?this._parentSelected.length:0;if(this._selectedDirty&&(this._selectedIdTexture=this._selectedIdTexture&&this._selectedIdTexture.destroy(),this._selectedIdTexture=void 0,e=this._combinedSelected,m(e))){for(var k,g=0,l=e.length,h=0;h<l;++h)k=e[h],m(k.pickIds)?g+=k.pickIds.length:m(k.pickId)&&++g;if(0===l||0===g)e=new Uint8Array(4),e[0]=255,e[1]=255,e[2]=255,e[3]=255,this._selectedIdTexture=new z({context:a,pixelFormat:q.RGBA,pixelDatatype:c.UNSIGNED_BYTE,source:{arrayBufferView:e,width:1,height:1},sampler:new y({wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,minificationFilter:D.NEAREST,magnificationFilter:x.NEAREST})});else{for(var p=0,r=new Uint8Array(4*g),h=0;h<l;++h)if(k=e[h],m(k.pickIds))for(var t=k.pickIds,w=t.length,E=0;E<w;++E)k=t[E].color,r[p]=f.floatToByte(k.red),r[p+1]=f.floatToByte(k.green),r[p+2]=f.floatToByte(k.blue),r[p+3]=f.floatToByte(k.alpha),p+=4;else m(k.pickId)&&(k=k.pickId.color,r[p]=f.floatToByte(k.red),r[p+1]=f.floatToByte(k.green),r[p+2]=f.floatToByte(k.blue),r[p+3]=f.floatToByte(k.alpha),p+=4);this._selectedIdTexture=new z({context:a,pixelFormat:q.RGBA,pixelDatatype:c.UNSIGNED_BYTE,source:{arrayBufferView:r,width:g,height:1},sampler:new y({wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,minificationFilter:D.NEAREST,magnificationFilter:x.NEAREST})})}}G(this);K(this,a);if(!m(this._command)||this._logDepthChanged||this._selectedDirty)e=this._fragmentShader,m(this._selectedIdTexture)&&(h=this._selectedIdTexture.width,e=e.replace(/varying\s+vec2\s+v_textureCoordinates;/g,""),e="#define CZM_SELECTED_FEATURE \nuniform sampler2D czm_idTexture; \nuniform sampler2D czm_selectedIdTexture; \nuniform float czm_selectedIdTextureStep; \nvarying vec2 v_textureCoordinates; \nbool czm_selected(vec2 offset) \n{ \n    bool selected \x3d false;\n    vec4 id \x3d texture2D(czm_idTexture, v_textureCoordinates + offset); \n    for (int i \x3d 0; i \x3c "+h+"; ++i) \n    { \n        vec4 selectedId \x3d texture2D(czm_selectedIdTexture, vec2(float(i) * czm_selectedIdTextureStep, 0.5)); \n        if (all(equal(id, selectedId))) \n        { \n            return true; \n        } \n    } \n    return false; \n} \n\nbool czm_selected() \n{ \n    return czm_selected(vec2(0.0)); \n} \n\n"+e),e=new A({defines:[this._useLogDepth?"LOG_DEPTH":""],sources:[e]}),this._command=a.createViewportQuadCommand(e,{uniformMap:this._uniformMap,owner:this});this._sampleMode===C.LINEAR?(e=D.LINEAR,h=x.LINEAR):(e=D.NEAREST,h=x.NEAREST);g=this._sampler;m(g)&&g.minificationFilter===e&&g.magnificationFilter===h||(this._sampler=new y({wrapS:v.CLAMP_TO_EDGE,wrapT:v.CLAMP_TO_EDGE,minificationFilter:e,magnificationFilter:h}));this._selectedDirty=!1;if(this._ready&&(e=this._textureCache.getFramebuffer(this._name),this._command.framebuffer=e,m(e))){e=e.getColorTexture(0);var B;if(e.width!==a.drawingBufferWidth||e.height!==a.drawingBufferHeight)B=this._renderState,m(B)&&e.width===B.viewport.width&&e.height===B.viewport.height||(this._renderState=u.fromCache({viewport:new b(0,0,e.width,e.height)}));this._command.renderState=B}}};I.prototype.execute=function(a,b,c,d){m(this._command)&&m(this._command.framebuffer)&&this._ready&&this._enabled&&(this._colorTexture=b,this._depthTexture=c,this._idTexture=d,y.equals(this._colorTexture.sampler,this._sampler)||(this._colorTexture.sampler=this._sampler),b=0<this.scissorRectangle.width&&0<this.scissorRectangle.height?this._passState:void 0,m(b)&&(b.context=a),this._command.execute(a,b))};I.prototype.isDestroyed=function(){return!1};I.prototype.destroy=function(){P(this);return h(this)};return I});F("Shaders/PostProcessStages/AcesTonemapping",[],function(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor \x3d texture2D(colorTexture, v_textureCoordinates);\nvec3 color \x3d fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\ncolor /\x3d texture2D(autoExposure, vec2(0.5)).r;\n#endif\nfloat g \x3d 0.985;\nfloat a \x3d 0.065;\nfloat b \x3d 0.0001;\nfloat c \x3d 0.433;\nfloat d \x3d 0.238;\ncolor \x3d (color * (color + a) - b) / (color * (g * color + c) + d);\ncolor \x3d clamp(color, 0.0, 1.0);\ncolor \x3d czm_inverseGamma(color);\ngl_FragColor \x3d vec4(color, fragmentColor.a);\n}\n"});F("Shaders/PostProcessStages/AmbientOcclusionGenerate",[],function(){return"uniform sampler2D randomTexture;\nuniform sampler2D depthTexture;\nuniform float intensity;\nuniform float bias;\nuniform float lengthCap;\nuniform float stepSize;\nuniform float frustumLength;\nvarying vec2 v_textureCoordinates;\nvec4 clipToEye(vec2 uv, float depth)\n{\nvec2 xy \x3d vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\nvec4 posEC \x3d czm_inverseProjection * vec4(xy, depth, 1.0);\nposEC \x3d posEC / posEC.w;\nreturn posEC;\n}\nvec3 getNormalXEdge(vec3 posInCamera, float depthU, float depthD, float depthL, float depthR, vec2 pixelSize)\n{\nvec4 posInCameraUp \x3d clipToEye(v_textureCoordinates - vec2(0.0, pixelSize.y), depthU);\nvec4 posInCameraDown \x3d clipToEye(v_textureCoordinates + vec2(0.0, pixelSize.y), depthD);\nvec4 posInCameraLeft \x3d clipToEye(v_textureCoordinates - vec2(pixelSize.x, 0.0), depthL);\nvec4 posInCameraRight \x3d clipToEye(v_textureCoordinates + vec2(pixelSize.x, 0.0), depthR);\nvec3 up \x3d posInCamera.xyz - posInCameraUp.xyz;\nvec3 down \x3d posInCameraDown.xyz - posInCamera.xyz;\nvec3 left \x3d posInCamera.xyz - posInCameraLeft.xyz;\nvec3 right \x3d posInCameraRight.xyz - posInCamera.xyz;\nvec3 DX \x3d length(left) \x3c length(right) ? left : right;\nvec3 DY \x3d length(up) \x3c length(down) ? up : down;\nreturn normalize(cross(DY, DX));\n}\nvoid main(void)\n{\nfloat depth \x3d czm_readDepth(depthTexture, v_textureCoordinates);\nvec4 posInCamera \x3d clipToEye(v_textureCoordinates, depth);\nif (posInCamera.z \x3e frustumLength)\n{\ngl_FragColor \x3d vec4(1.0);\nreturn;\n}\nvec2 pixelSize \x3d 1.0 / czm_viewport.zw;\nfloat depthU \x3d czm_readDepth(depthTexture, v_textureCoordinates- vec2(0.0, pixelSize.y));\nfloat depthD \x3d czm_readDepth(depthTexture, v_textureCoordinates+ vec2(0.0, pixelSize.y));\nfloat depthL \x3d czm_readDepth(depthTexture, v_textureCoordinates- vec2(pixelSize.x, 0.0));\nfloat depthR \x3d czm_readDepth(depthTexture, v_textureCoordinates+ vec2(pixelSize.x, 0.0));\nvec3 normalInCamera \x3d getNormalXEdge(posInCamera.xyz, depthU, depthD, depthL, depthR, pixelSize);\nfloat ao \x3d 0.0;\nvec2 sampleDirection \x3d vec2(1.0, 0.0);\nfloat gapAngle \x3d 90.0 * czm_radiansPerDegree;\nfloat randomVal \x3d texture2D(randomTexture, v_textureCoordinates).x;\nfloat inverseViewportWidth \x3d 1.0 / czm_viewport.z;\nfloat inverseViewportHeight \x3d 1.0 / czm_viewport.w;\nfor (int i \x3d 0; i \x3c 4; i++)\n{\nfloat newGapAngle \x3d gapAngle * (float(i) + randomVal);\nfloat cosVal \x3d cos(newGapAngle);\nfloat sinVal \x3d sin(newGapAngle);\nvec2 rotatedSampleDirection \x3d vec2(cosVal * sampleDirection.x - sinVal * sampleDirection.y, sinVal * sampleDirection.x + cosVal * sampleDirection.y);\nfloat localAO \x3d 0.0;\nfloat localStepSize \x3d stepSize;\nfor (int j \x3d 0; j \x3c 6; j++)\n{\nvec2 directionWithStep \x3d vec2(rotatedSampleDirection.x * localStepSize * inverseViewportWidth, rotatedSampleDirection.y * localStepSize * inverseViewportHeight);\nvec2 newCoords \x3d directionWithStep + v_textureCoordinates;\nif(newCoords.x \x3e 1.0 || newCoords.y \x3e 1.0 || newCoords.x \x3c 0.0 || newCoords.y \x3c 0.0)\n{\nbreak;\n}\nfloat stepDepthInfo \x3d czm_readDepth(depthTexture, newCoords);\nvec4 stepPosInCamera \x3d clipToEye(newCoords, stepDepthInfo);\nvec3 diffVec \x3d stepPosInCamera.xyz - posInCamera.xyz;\nfloat len \x3d length(diffVec);\nif (len \x3e lengthCap)\n{\nbreak;\n}\nfloat dotVal \x3d clamp(dot(normalInCamera, normalize(diffVec)), 0.0, 1.0 );\nfloat weight \x3d len / lengthCap;\nweight \x3d 1.0 - weight * weight;\nif (dotVal \x3c bias)\n{\ndotVal \x3d 0.0;\n}\nlocalAO \x3d max(localAO, dotVal * weight);\nlocalStepSize +\x3d stepSize;\n}\nao +\x3d localAO;\n}\nao /\x3d 4.0;\nao \x3d 1.0 - clamp(ao, 0.0, 1.0);\nao \x3d pow(ao, intensity);\ngl_FragColor \x3d vec4(vec3(ao), 1.0);\n}\n"});F("Shaders/PostProcessStages/AmbientOcclusionModulate",[],function(){return"uniform sampler2D colorTexture;\nuniform sampler2D ambientOcclusionTexture;\nuniform bool ambientOcclusionOnly;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 color \x3d texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 ao \x3d texture2D(ambientOcclusionTexture, v_textureCoordinates).rgb;\ngl_FragColor.rgb \x3d ambientOcclusionOnly ? ao : ao * color;\n}\n"});F("Shaders/PostProcessStages/BlackAndWhite",[],function(){return"uniform sampler2D colorTexture;\nuniform float gradations;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 rgb \x3d texture2D(colorTexture, v_textureCoordinates).rgb;\n#ifdef CZM_SELECTED_FEATURE\nif (czm_selected()) {\ngl_FragColor \x3d vec4(rgb, 1.0);\nreturn;\n}\n#endif\nfloat luminance \x3d czm_luminance(rgb);\nfloat darkness \x3d luminance * gradations;\ndarkness \x3d (darkness - fract(darkness)) / gradations;\ngl_FragColor \x3d vec4(vec3(darkness), 1.0);\n}\n"});F("Shaders/PostProcessStages/BloomComposite",[],function(){return"uniform sampler2D colorTexture;\nuniform sampler2D bloomTexture;\nuniform bool  glowOnly;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec4 bloom \x3d texture2D(bloomTexture, v_textureCoordinates);\nvec4 color \x3d texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor \x3d glowOnly ? bloom : bloom + color;\n}\n"});F("Shaders/PostProcessStages/Brightness",[],function(){return"uniform sampler2D colorTexture;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 rgb \x3d texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 target \x3d vec3(0.0);\ngl_FragColor \x3d vec4(mix(target, rgb, brightness), 1.0);\n}\n"});F("Shaders/PostProcessStages/ContrastBias",[],function(){return"uniform sampler2D colorTexture;\nuniform float contrast;\nuniform float brightness;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec3 sceneColor \x3d texture2D(colorTexture, v_textureCoordinates).xyz;\nsceneColor \x3d czm_RGBToHSB(sceneColor);\nsceneColor.z +\x3d brightness;\nsceneColor \x3d czm_HSBToRGB(sceneColor);\nfloat factor \x3d (259.0 * (contrast + 255.0)) / (255.0 * (259.0 - contrast));\nsceneColor \x3d factor * (sceneColor - vec3(0.5)) + vec3(0.5);\ngl_FragColor \x3d vec4(sceneColor, 1.0);\n}\n"});F("Shaders/PostProcessStages/DepthOfField",[],function(){return"uniform sampler2D colorTexture;\nuniform sampler2D blurTexture;\nuniform sampler2D depthTexture;\nuniform float focalDistance;\nvarying vec2 v_textureCoordinates;\nvec4 toEye(vec2 uv, float depth)\n{\nvec2 xy \x3d vec2((uv.x * 2.0 - 1.0), ((1.0 - uv.y) * 2.0 - 1.0));\nvec4 posInCamera \x3d czm_inverseProjection * vec4(xy, depth, 1.0);\nposInCamera \x3d posInCamera / posInCamera.w;\nreturn posInCamera;\n}\nfloat computeDepthBlur(float depth)\n{\nfloat f;\nif (depth \x3c focalDistance)\n{\nf \x3d (focalDistance - depth) / (focalDistance - czm_currentFrustum.x);\n}\nelse\n{\nf \x3d (depth - focalDistance) / (czm_currentFrustum.y - focalDistance);\nf \x3d pow(f, 0.1);\n}\nf *\x3d f;\nf \x3d clamp(f, 0.0, 1.0);\nreturn pow(f, 0.5);\n}\nvoid main(void)\n{\nfloat depth \x3d czm_readDepth(depthTexture, v_textureCoordinates);\nvec4 posInCamera \x3d toEye(v_textureCoordinates, depth);\nfloat d \x3d computeDepthBlur(-posInCamera.z);\ngl_FragColor \x3d mix(texture2D(colorTexture, v_textureCoordinates), texture2D(blurTexture, v_textureCoordinates), d);\n}\n"});F("Shaders/PostProcessStages/DepthView",[],function(){return"uniform sampler2D depthTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nfloat depth \x3d czm_readDepth(depthTexture, v_textureCoordinates);\ngl_FragColor \x3d vec4(vec3(depth), 1.0);\n}\n"});F("Shaders/PostProcessStages/EdgeDetection",[],function(){return"uniform sampler2D depthTexture;\nuniform float length;\nuniform vec4 color;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nfloat directions[3];\ndirections[0] \x3d -1.0;\ndirections[1] \x3d 0.0;\ndirections[2] \x3d 1.0;\nfloat scalars[3];\nscalars[0] \x3d 3.0;\nscalars[1] \x3d 10.0;\nscalars[2] \x3d 3.0;\nfloat padx \x3d 1.0 / czm_viewport.z;\nfloat pady \x3d 1.0 / czm_viewport.w;\n#ifdef CZM_SELECTED_FEATURE\nbool selected \x3d false;\nfor (int i \x3d 0; i \x3c 3; ++i)\n{\nfloat dir \x3d directions[i];\nselected \x3d selected || czm_selected(vec2(-padx, dir * pady));\nselected \x3d selected || czm_selected(vec2(padx, dir * pady));\nselected \x3d selected || czm_selected(vec2(dir * padx, -pady));\nselected \x3d selected || czm_selected(vec2(dir * padx, pady));\nif (selected)\n{\nbreak;\n}\n}\nif (!selected)\n{\ngl_FragColor \x3d vec4(color.rgb, 0.0);\nreturn;\n}\n#endif\nfloat horizEdge \x3d 0.0;\nfloat vertEdge \x3d 0.0;\nfor (int i \x3d 0; i \x3c 3; ++i)\n{\nfloat dir \x3d directions[i];\nfloat scale \x3d scalars[i];\nhorizEdge -\x3d texture2D(depthTexture, v_textureCoordinates + vec2(-padx, dir * pady)).x * scale;\nhorizEdge +\x3d texture2D(depthTexture, v_textureCoordinates + vec2(padx, dir * pady)).x * scale;\nvertEdge -\x3d texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, -pady)).x * scale;\nvertEdge +\x3d texture2D(depthTexture, v_textureCoordinates + vec2(dir * padx, pady)).x * scale;\n}\nfloat len \x3d sqrt(horizEdge * horizEdge + vertEdge * vertEdge);\ngl_FragColor \x3d vec4(color.rgb, len \x3e length ? color.a : 0.0);\n}\n"});F("Shaders/PostProcessStages/FilmicTonemapping",[],function(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor \x3d texture2D(colorTexture, v_textureCoordinates);\nvec3 color \x3d fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure \x3d texture2D(autoExposure, vec2(0.5)).r;\ncolor /\x3d exposure;\n#endif\nconst float A \x3d 0.22;\nconst float B \x3d 0.30;\nconst float C \x3d 0.10;\nconst float D \x3d 0.20;\nconst float E \x3d 0.01;\nconst float F \x3d 0.30;\nconst float white \x3d 11.2;\nvec3 c \x3d ((color * (A * color + C * B) + D * E) / (color * ( A * color + B) + D * F)) - E / F;\nfloat w \x3d ((white * (A * white + C * B) + D * E) / (white * ( A * white + B) + D * F)) - E / F;\nc \x3d czm_inverseGamma(c / w);\ngl_FragColor \x3d vec4(c, fragmentColor.a);\n}\n"});F("Shaders/PostProcessStages/FXAA",[],function(){return"varying vec2 v_textureCoordinates;\nuniform sampler2D colorTexture;\nuniform sampler2D disableTexture;\nconst float fxaaQualitySubpix \x3d 0.5;\nconst float fxaaQualityEdgeThreshold \x3d 0.125;\nconst float fxaaQualityEdgeThresholdMin \x3d 0.0833;\nvoid main()\n{\nvec2 fxaaQualityRcpFrame \x3d vec2(1.0) / czm_viewport.zw;\nvec4 disableColor \x3d texture2D(disableTexture, v_textureCoordinates);\nvec4 color;\nfloat alpha;\nif(disableColor.a \x3e 0.01)\n{\ncolor \x3d texture2D(colorTexture, v_textureCoordinates);\nalpha \x3d 1.0;\n}\nelse\n{\ncolor \x3d FxaaPixelShader(\nv_textureCoordinates,\ncolorTexture,\nfxaaQualityRcpFrame,\nfxaaQualitySubpix,\nfxaaQualityEdgeThreshold,\nfxaaQualityEdgeThresholdMin);\nalpha \x3d texture2D(colorTexture, v_textureCoordinates).a;\n}\ngl_FragColor \x3d vec4(color.rgb, alpha);\n}\n"});F("Shaders/PostProcessStages/GaussianBlur1D",[],function(){return"#define SAMPLES 8\nuniform float delta;\nuniform float sigma;\nuniform float direction;\nuniform sampler2D colorTexture;\n#ifdef USE_STEP_SIZE\nuniform float stepSize;\n#else\nuniform vec2 step;\n#endif\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec2 st \x3d v_textureCoordinates;\nvec2 dir \x3d vec2(1.0 - direction, direction);\n#ifdef USE_STEP_SIZE\nvec2 step \x3d vec2(stepSize / czm_viewport.zw);\n#else\nvec2 step \x3d step;\n#endif\nvec3 g;\ng.x \x3d 1.0 / (sqrt(czm_twoPi) * sigma);\ng.y \x3d exp((-0.5 * delta * delta) / (sigma * sigma));\ng.z \x3d g.y * g.y;\nvec4 result \x3d texture2D(colorTexture, st) * g.x;\nfor (int i \x3d 1; i \x3c SAMPLES; ++i)\n{\ng.xy *\x3d g.yz;\nvec2 offset \x3d float(i) * dir * step;\nresult +\x3d texture2D(colorTexture, st - offset) * g.x;\nresult +\x3d texture2D(colorTexture, st + offset) * g.x;\n}\ngl_FragColor \x3d result;\n}\n"});F("Shaders/PostProcessStages/LensFlare",[],function(){return"uniform sampler2D colorTexture;\nuniform sampler2D dirtTexture;\nuniform sampler2D starTexture;\nuniform vec2 dirtTextureDimensions;\nuniform float distortion;\nuniform float ghostDispersal;\nuniform float haloWidth;\nuniform float earthRadius;\nuniform float intensity;\nvarying vec2 v_textureCoordinates;\n#define DISTANCE_TO_SPACE 6500000.0\nvec4 getNDCFromWC(vec3 WC, float earthRadius)\n{\nvec4 positionEC \x3d czm_view * vec4(WC, 1.0);\npositionEC \x3d vec4(positionEC.x + earthRadius , positionEC.y, positionEC.z, 1.0);\nvec4 positionWC \x3d czm_eyeToWindowCoordinates(positionEC);\nreturn czm_viewportOrthographic * vec4(positionWC.xy, -positionWC.z, 1.0);\n}\nfloat isInEarth(vec2 texcoord, vec2 sceneSize)\n{\nvec2 NDC \x3d texcoord * 2.0 - 1.0;\nvec4 earthPosSC \x3d getNDCFromWC(vec3(0.0), 0.0);\nvec4 earthPosSCEdge \x3d getNDCFromWC(vec3(0.0), earthRadius * 1.5);\nNDC.xy -\x3d earthPosSC.xy;\nfloat X \x3d abs(NDC.x) * sceneSize.x;\nfloat Y \x3d abs(NDC.y) * sceneSize.y;\nreturn clamp(0.0, 1.0, max(sqrt(X * X + Y * Y) / max(abs(earthPosSCEdge.x * sceneSize.x), 1.0) - 0.8 , 0.0));\n}\nvec4 textureDistorted(sampler2D tex, vec2 texcoord, vec2 direction, vec3 distortion, bool isSpace)\n{\nvec2 sceneSize \x3d czm_viewport.zw;\nvec3 color;\nif(isSpace)\n{\ncolor.r \x3d isInEarth(texcoord + direction * distortion.r, sceneSize) * texture2D(tex, texcoord + direction * distortion.r).r;\ncolor.g \x3d isInEarth(texcoord + direction * distortion.g, sceneSize) * texture2D(tex, texcoord + direction * distortion.g).g;\ncolor.b \x3d isInEarth(texcoord  + direction * distortion.b, sceneSize) * texture2D(tex, texcoord + direction * distortion.b).b;\n}\nelse\n{\ncolor.r \x3d texture2D(tex, texcoord + direction * distortion.r).r;\ncolor.g \x3d texture2D(tex, texcoord + direction * distortion.g).g;\ncolor.b \x3d texture2D(tex, texcoord + direction * distortion.b).b;\n}\nreturn vec4(clamp(color, 0.0, 1.0), 0.0);\n}\nvoid main(void)\n{\nvec4 originalColor \x3d texture2D(colorTexture, v_textureCoordinates);\nvec3 rgb \x3d originalColor.rgb;\nbool isSpace \x3d length(czm_viewerPositionWC.xyz) \x3e DISTANCE_TO_SPACE;\nvec4 sunPos \x3d czm_morphTime \x3d\x3d 1.0 ? vec4(czm_sunPositionWC, 1.0) : vec4(czm_sunPositionColumbusView.zxy, 1.0);\nvec4 sunPositionEC \x3d czm_view * sunPos;\nvec4 sunPositionWC \x3d czm_eyeToWindowCoordinates(sunPositionEC);\nsunPos \x3d czm_viewportOrthographic * vec4(sunPositionWC.xy, -sunPositionWC.z, 1.0);\nif(!isSpace || !((sunPos.x \x3e\x3d -1.1 \x26\x26 sunPos.x \x3c\x3d 1.1) \x26\x26 (sunPos.y \x3e\x3d -1.1 \x26\x26 sunPos.y \x3c\x3d 1.1)))\n{\ngl_FragColor \x3d originalColor;\nreturn;\n}\nvec2 texcoord \x3d -v_textureCoordinates + vec2(1.0);\nvec2 texelSize \x3d 1.0 / czm_viewport.zw;\nvec3 distortionVec \x3d vec3(-texelSize.x * distortion, 0.0, texelSize.x * distortion);\nvec2 ghostVec \x3d (vec2(0.5) - texcoord) * ghostDispersal;\nvec3 direction \x3d normalize(vec3(ghostVec, 0.0));\nvec4 result \x3d vec4(0.0);\nvec4 ghost \x3d vec4(0.0);\nfor (int i \x3d 0; i \x3c 4; ++i)\n{\nvec2 offset \x3d fract(texcoord + ghostVec * float(i));\nghost +\x3d textureDistorted(colorTexture, offset, direction.xy, distortionVec, isSpace);\n}\nresult +\x3d ghost;\nvec2 haloVec \x3d normalize(ghostVec) * haloWidth;\nfloat weightForHalo \x3d length(vec2(0.5) - fract(texcoord + haloVec)) / length(vec2(0.5));\nweightForHalo \x3d pow(1.0 - weightForHalo, 5.0);\nresult +\x3d textureDistorted(colorTexture, texcoord + haloVec, direction.xy, distortionVec, isSpace) * weightForHalo * 1.5;\nvec2 dirtTexCoords \x3d (v_textureCoordinates * czm_viewport.zw) / dirtTextureDimensions;\nif (dirtTexCoords.x \x3e 1.0)\n{\ndirtTexCoords.x \x3d mod(floor(dirtTexCoords.x), 2.0) \x3d\x3d 1.0 ? 1.0 - fract(dirtTexCoords.x) :  fract(dirtTexCoords.x);\n}\nif (dirtTexCoords.y \x3e 1.0)\n{\ndirtTexCoords.y \x3d mod(floor(dirtTexCoords.y), 2.0) \x3d\x3d 1.0 ? 1.0 - fract(dirtTexCoords.y) :  fract(dirtTexCoords.y);\n}\nresult +\x3d texture2D(dirtTexture, dirtTexCoords);\nfloat camrot \x3d czm_view[0].z + czm_view[1].y;\nfloat cosValue \x3d cos(camrot);\nfloat sinValue \x3d sin(camrot);\nmat3 rotation \x3d mat3(\ncosValue, -sinValue, 0.0,\nsinValue, cosValue, 0.0,\n0.0, 0.0, 1.0\n);\nvec3 st1 \x3d vec3(v_textureCoordinates * 2.0 - vec2(1.0), 1.0);\nvec3 st2 \x3d vec3((rotation * st1).xy, 1.0);\nvec3 st3 \x3d st2 * 0.5 + vec3(0.5);\nvec2 lensStarTexcoord \x3d st3.xy;\nfloat weightForLensFlare \x3d length(vec3(sunPos.xy, 0.0));\nfloat oneMinusWeightForLensFlare \x3d max(1.0 - weightForLensFlare, 0.0);\nif (!isSpace)\n{\nresult *\x3d oneMinusWeightForLensFlare * intensity * 0.2;\n}\nelse\n{\nresult *\x3d oneMinusWeightForLensFlare * intensity;\nresult *\x3d texture2D(starTexture, lensStarTexcoord) * pow(weightForLensFlare, 1.0) * max((1.0 - length(vec3(st1.xy, 0.0))), 0.0) * 2.0;\n}\nresult +\x3d texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor \x3d result;\n}\n"});F("Shaders/PostProcessStages/ModifiedReinhardTonemapping",[],function(){return"uniform sampler2D colorTexture;\nuniform vec3 white;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor \x3d texture2D(colorTexture, v_textureCoordinates);\nvec3 color \x3d fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure \x3d texture2D(autoExposure, vec2(0.5)).r;\ncolor /\x3d exposure;\n#endif\ncolor \x3d (color * (1.0 + color / white)) / (1.0 + color);\ncolor \x3d czm_inverseGamma(color);\ngl_FragColor \x3d vec4(color, fragmentColor.a);\n}\n"});F("Shaders/PostProcessStages/NightVision",[],function(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\nfloat rand(vec2 co)\n{\nreturn fract(sin(dot(co.xy ,vec2(12.9898, 78.233))) * 43758.5453);\n}\nvoid main(void)\n{\nfloat noiseValue \x3d rand(v_textureCoordinates + sin(czm_frameNumber)) * 0.1;\nvec3 rgb \x3d texture2D(colorTexture, v_textureCoordinates).rgb;\nvec3 green \x3d vec3(0.0, 1.0, 0.0);\ngl_FragColor \x3d vec4((noiseValue + rgb) * green, 1.0);\n}\n"});F("Shaders/PostProcessStages/ReinhardTonemapping",[],function(){return"uniform sampler2D colorTexture;\nvarying vec2 v_textureCoordinates;\n#ifdef AUTO_EXPOSURE\nuniform sampler2D autoExposure;\n#endif\nvoid main()\n{\nvec4 fragmentColor \x3d texture2D(colorTexture, v_textureCoordinates);\nvec3 color \x3d fragmentColor.rgb;\n#ifdef AUTO_EXPOSURE\nfloat exposure \x3d texture2D(autoExposure, vec2(0.5)).r;\ncolor /\x3d exposure;\n#endif\ncolor \x3d color / (1.0 + color);\ncolor \x3d czm_inverseGamma(color);\ngl_FragColor \x3d vec4(color, fragmentColor.a);\n}\n"});F("Shaders/PostProcessStages/Silhouette",[],function(){return"uniform sampler2D colorTexture;\nuniform sampler2D silhouetteTexture;\nvarying vec2 v_textureCoordinates;\nvoid main(void)\n{\nvec4 silhouetteColor \x3d texture2D(silhouetteTexture, v_textureCoordinates);\nvec4 color \x3d texture2D(colorTexture, v_textureCoordinates);\ngl_FragColor \x3d mix(color, silhouetteColor, silhouetteColor.a);\n}\n"});F("ThirdParty/Shaders/FXAA3_11",[],function(){return"#if (FXAA_QUALITY_PRESET \x3d\x3d 10)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 3.0\n#define FXAA_QUALITY_P2 12.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 11)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 3.0\n#define FXAA_QUALITY_P3 12.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 12)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 4.0\n#define FXAA_QUALITY_P4 12.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 13)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 4.0\n#define FXAA_QUALITY_P5 12.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 14)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 4.0\n#define FXAA_QUALITY_P6 12.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 15)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 12.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 20)\n#define FXAA_QUALITY_PS 3\n#define FXAA_QUALITY_P0 1.5\n#define FXAA_QUALITY_P1 2.0\n#define FXAA_QUALITY_P2 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 21)\n#define FXAA_QUALITY_PS 4\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 22)\n#define FXAA_QUALITY_PS 5\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 23)\n#define FXAA_QUALITY_PS 6\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 24)\n#define FXAA_QUALITY_PS 7\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 3.0\n#define FXAA_QUALITY_P6 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 25)\n#define FXAA_QUALITY_PS 8\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 4.0\n#define FXAA_QUALITY_P7 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 26)\n#define FXAA_QUALITY_PS 9\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 4.0\n#define FXAA_QUALITY_P8 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 27)\n#define FXAA_QUALITY_PS 10\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 4.0\n#define FXAA_QUALITY_P9 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 28)\n#define FXAA_QUALITY_PS 11\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 4.0\n#define FXAA_QUALITY_P10 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 29)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.5\n#define FXAA_QUALITY_P2 2.0\n#define FXAA_QUALITY_P3 2.0\n#define FXAA_QUALITY_P4 2.0\n#define FXAA_QUALITY_P5 2.0\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#if (FXAA_QUALITY_PRESET \x3d\x3d 39)\n#define FXAA_QUALITY_PS 12\n#define FXAA_QUALITY_P0 1.0\n#define FXAA_QUALITY_P1 1.0\n#define FXAA_QUALITY_P2 1.0\n#define FXAA_QUALITY_P3 1.0\n#define FXAA_QUALITY_P4 1.0\n#define FXAA_QUALITY_P5 1.5\n#define FXAA_QUALITY_P6 2.0\n#define FXAA_QUALITY_P7 2.0\n#define FXAA_QUALITY_P8 2.0\n#define FXAA_QUALITY_P9 2.0\n#define FXAA_QUALITY_P10 4.0\n#define FXAA_QUALITY_P11 8.0\n#endif\n#define FxaaBool bool\n#define FxaaFloat float\n#define FxaaFloat2 vec2\n#define FxaaFloat3 vec3\n#define FxaaFloat4 vec4\n#define FxaaHalf float\n#define FxaaHalf2 vec2\n#define FxaaHalf3 vec3\n#define FxaaHalf4 vec4\n#define FxaaInt2 vec2\n#define FxaaTex sampler2D\n#define FxaaSat(x) clamp(x, 0.0, 1.0)\n#define FxaaTexTop(t, p) texture2D(t, p)\n#define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r))\nFxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\nFxaaFloat4 FxaaPixelShader(\nFxaaFloat2 pos,\nFxaaTex tex,\nFxaaFloat2 fxaaQualityRcpFrame,\nFxaaFloat fxaaQualitySubpix,\nFxaaFloat fxaaQualityEdgeThreshold,\nFxaaFloat fxaaQualityEdgeThresholdMin\n) {\nFxaaFloat2 posM;\nposM.x \x3d pos.x;\nposM.y \x3d pos.y;\nFxaaFloat4 rgbyM \x3d FxaaTexTop(tex, posM);\n#define lumaM rgbyM.y\nFxaaFloat lumaS \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaE \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaN \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaW \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\nFxaaFloat maxSM \x3d max(lumaS, lumaM);\nFxaaFloat minSM \x3d min(lumaS, lumaM);\nFxaaFloat maxESM \x3d max(lumaE, maxSM);\nFxaaFloat minESM \x3d min(lumaE, minSM);\nFxaaFloat maxWN \x3d max(lumaN, lumaW);\nFxaaFloat minWN \x3d min(lumaN, lumaW);\nFxaaFloat rangeMax \x3d max(maxWN, maxESM);\nFxaaFloat rangeMin \x3d min(minWN, minESM);\nFxaaFloat rangeMaxScaled \x3d rangeMax * fxaaQualityEdgeThreshold;\nFxaaFloat range \x3d rangeMax - rangeMin;\nFxaaFloat rangeMaxClamped \x3d max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\nFxaaBool earlyExit \x3d range \x3c rangeMaxClamped;\nif(earlyExit)\nreturn rgbyM;\nFxaaFloat lumaNW \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSE \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNE \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaSW \x3d FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\nFxaaFloat lumaNS \x3d lumaN + lumaS;\nFxaaFloat lumaWE \x3d lumaW + lumaE;\nFxaaFloat subpixRcpRange \x3d 1.0/range;\nFxaaFloat subpixNSWE \x3d lumaNS + lumaWE;\nFxaaFloat edgeHorz1 \x3d (-2.0 * lumaM) + lumaNS;\nFxaaFloat edgeVert1 \x3d (-2.0 * lumaM) + lumaWE;\nFxaaFloat lumaNESE \x3d lumaNE + lumaSE;\nFxaaFloat lumaNWNE \x3d lumaNW + lumaNE;\nFxaaFloat edgeHorz2 \x3d (-2.0 * lumaE) + lumaNESE;\nFxaaFloat edgeVert2 \x3d (-2.0 * lumaN) + lumaNWNE;\nFxaaFloat lumaNWSW \x3d lumaNW + lumaSW;\nFxaaFloat lumaSWSE \x3d lumaSW + lumaSE;\nFxaaFloat edgeHorz4 \x3d (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\nFxaaFloat edgeVert4 \x3d (abs(edgeVert1) * 2.0) + abs(edgeVert2);\nFxaaFloat edgeHorz3 \x3d (-2.0 * lumaW) + lumaNWSW;\nFxaaFloat edgeVert3 \x3d (-2.0 * lumaS) + lumaSWSE;\nFxaaFloat edgeHorz \x3d abs(edgeHorz3) + edgeHorz4;\nFxaaFloat edgeVert \x3d abs(edgeVert3) + edgeVert4;\nFxaaFloat subpixNWSWNESE \x3d lumaNWSW + lumaNESE;\nFxaaFloat lengthSign \x3d fxaaQualityRcpFrame.x;\nFxaaBool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\nFxaaFloat subpixA \x3d subpixNSWE * 2.0 + subpixNWSWNESE;\nif(!horzSpan) lumaN \x3d lumaW;\nif(!horzSpan) lumaS \x3d lumaE;\nif(horzSpan) lengthSign \x3d fxaaQualityRcpFrame.y;\nFxaaFloat subpixB \x3d (subpixA * (1.0/12.0)) - lumaM;\nFxaaFloat gradientN \x3d lumaN - lumaM;\nFxaaFloat gradientS \x3d lumaS - lumaM;\nFxaaFloat lumaNN \x3d lumaN + lumaM;\nFxaaFloat lumaSS \x3d lumaS + lumaM;\nFxaaBool pairN \x3d abs(gradientN) \x3e\x3d abs(gradientS);\nFxaaFloat gradient \x3d max(abs(gradientN), abs(gradientS));\nif(pairN) lengthSign \x3d -lengthSign;\nFxaaFloat subpixC \x3d FxaaSat(abs(subpixB) * subpixRcpRange);\nFxaaFloat2 posB;\nposB.x \x3d posM.x;\nposB.y \x3d posM.y;\nFxaaFloat2 offNP;\noffNP.x \x3d (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\noffNP.y \x3d ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\nif(!horzSpan) posB.x +\x3d lengthSign * 0.5;\nif( horzSpan) posB.y +\x3d lengthSign * 0.5;\nFxaaFloat2 posN;\nposN.x \x3d posB.x - offNP.x * FXAA_QUALITY_P0;\nposN.y \x3d posB.y - offNP.y * FXAA_QUALITY_P0;\nFxaaFloat2 posP;\nposP.x \x3d posB.x + offNP.x * FXAA_QUALITY_P0;\nposP.y \x3d posB.y + offNP.y * FXAA_QUALITY_P0;\nFxaaFloat subpixD \x3d ((-2.0)*subpixC) + 3.0;\nFxaaFloat lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN));\nFxaaFloat subpixE \x3d subpixC * subpixC;\nFxaaFloat lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP));\nif(!pairN) lumaNN \x3d lumaSS;\nFxaaFloat gradientScaled \x3d gradient * 1.0/4.0;\nFxaaFloat lumaMM \x3d lumaM - lumaNN * 0.5;\nFxaaFloat subpixF \x3d subpixD * subpixE;\nFxaaBool lumaMLTZero \x3d lumaMM \x3c 0.0;\nlumaEndN -\x3d lumaNN * 0.5;\nlumaEndP -\x3d lumaNN * 0.5;\nFxaaBool doneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\nFxaaBool doneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P1;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P1;\nFxaaBool doneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P1;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P1;\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P2;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P2;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P2;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P2;\n#if (FXAA_QUALITY_PS \x3e 3)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P3;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P3;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P3;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P3;\n#if (FXAA_QUALITY_PS \x3e 4)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P4;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P4;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P4;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P4;\n#if (FXAA_QUALITY_PS \x3e 5)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P5;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P5;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P5;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P5;\n#if (FXAA_QUALITY_PS \x3e 6)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P6;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P6;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P6;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P6;\n#if (FXAA_QUALITY_PS \x3e 7)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P7;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P7;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P7;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P7;\n#if (FXAA_QUALITY_PS \x3e 8)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P8;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P8;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P8;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P8;\n#if (FXAA_QUALITY_PS \x3e 9)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P9;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P9;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P9;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P9;\n#if (FXAA_QUALITY_PS \x3e 10)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P10;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P10;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P10;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P10;\n#if (FXAA_QUALITY_PS \x3e 11)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P11;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P11;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P11;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P11;\n#if (FXAA_QUALITY_PS \x3e 12)\nif(doneNP) {\nif(!doneN) lumaEndN \x3d FxaaLuma(FxaaTexTop(tex, posN.xy));\nif(!doneP) lumaEndP \x3d FxaaLuma(FxaaTexTop(tex, posP.xy));\nif(!doneN) lumaEndN \x3d lumaEndN - lumaNN * 0.5;\nif(!doneP) lumaEndP \x3d lumaEndP - lumaNN * 0.5;\ndoneN \x3d abs(lumaEndN) \x3e\x3d gradientScaled;\ndoneP \x3d abs(lumaEndP) \x3e\x3d gradientScaled;\nif(!doneN) posN.x -\x3d offNP.x * FXAA_QUALITY_P12;\nif(!doneN) posN.y -\x3d offNP.y * FXAA_QUALITY_P12;\ndoneNP \x3d (!doneN) || (!doneP);\nif(!doneP) posP.x +\x3d offNP.x * FXAA_QUALITY_P12;\nif(!doneP) posP.y +\x3d offNP.y * FXAA_QUALITY_P12;\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\n#endif\n}\nFxaaFloat dstN \x3d posM.x - posN.x;\nFxaaFloat dstP \x3d posP.x - posM.x;\nif(!horzSpan) dstN \x3d posM.y - posN.y;\nif(!horzSpan) dstP \x3d posP.y - posM.y;\nFxaaBool goodSpanN \x3d (lumaEndN \x3c 0.0) !\x3d lumaMLTZero;\nFxaaFloat spanLength \x3d (dstP + dstN);\nFxaaBool goodSpanP \x3d (lumaEndP \x3c 0.0) !\x3d lumaMLTZero;\nFxaaFloat spanLengthRcp \x3d 1.0/spanLength;\nFxaaBool directionN \x3d dstN \x3c dstP;\nFxaaFloat dst \x3d min(dstN, dstP);\nFxaaBool goodSpan \x3d directionN ? goodSpanN : goodSpanP;\nFxaaFloat subpixG \x3d subpixF * subpixF;\nFxaaFloat pixelOffset \x3d (dst * (-spanLengthRcp)) + 0.5;\nFxaaFloat subpixH \x3d subpixG * fxaaQualitySubpix;\nFxaaFloat pixelOffsetGood \x3d goodSpan ? pixelOffset : 0.0;\nFxaaFloat pixelOffsetSubpix \x3d max(pixelOffsetGood, subpixH);\nif(!horzSpan) posM.x +\x3d pixelOffsetSubpix * lengthSign;\nif( horzSpan) posM.y +\x3d pixelOffsetSubpix * lengthSign;\nreturn FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\n}\n"});F("Scene/PostProcessStageComposite","../Core/Check ../Core/createGuid ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject".split(" "),function(b,a,f,k,g,l){function m(e){e=f(e,f.EMPTY_OBJECT);b.defined("options.stages",e.stages);b.typeOf.number.greaterThan("options.stages.length",e.stages.length,0);this._stages=e.stages;this._inputPreviousStageTexture=f(e.inputPreviousStageTexture,!0);var g=e.name;k(g)||(g=a());this._name=g;this._uniforms=e.uniforms;this._combinedSelectedShadow=this._combinedSelected=this._parentSelectedShadow=this._parentSelected=this._selectedShadow=this._selected=this._index=this._textureCache=void 0;this._parentSelectedLength=this._selectedLength=0;this._selectedDirty=!0}g(m.prototype,{ready:{get:function(){for(var a=this._stages,b=a.length,f=0;f<b;++f)if(!a[f].ready)return!1;return!0}},name:{get:function(){return this._name}},enabled:{get:function(){return this._stages[0].enabled},set:function(a){for(var b=this._stages,e=b.length,d=0;d<e;++d)b[d].enabled=a}},uniforms:{get:function(){return this._uniforms}},inputPreviousStageTexture:{get:function(){return this._inputPreviousStageTexture}},length:{get:function(){return this._stages.length}},selected:{get:function(){return this._selected},set:function(a){this._selected=a}},parentSelected:{get:function(){return this._parentSelected},set:function(a){this._parentSelected=a}}});m.prototype._isSupported=function(a){for(var b=this._stages,e=b.length,d=0;d<e;++d)if(!b[d]._isSupported(a))return!1;return!0};m.prototype.get=function(a){b.typeOf.number.greaterThanOrEquals("index",a,0);b.typeOf.number.lessThan("index",a,this.length);return this._stages[a]};m.prototype.update=function(a,b){var e;a:{e=k(this._selected)?this._selected.length:0;var d=k(this._parentSelected)?this._parentSelected:0,f=this._selected!==this._selectedShadow||e!==this._selectedLength,f=f||this._parentSelected!==this._parentSelectedShadow||d!==this._parentSelectedLength;k(this._selected)&&k(this._parentSelected)?this._combinedSelected=this._selected.concat(this._parentSelected):k(this._parentSelected)?this._combinedSelected=this._parentSelected:this._combinedSelected=this._selected;if(!f&&k(this._combinedSelected)){if(!k(this._combinedSelectedShadow)){e=!0;break a}e=this._combinedSelected.length;for(d=0;d<e;++d)if(this._combinedSelected[d]!==this._combinedSelectedShadow[d]){e=!0;break a}}e=f}this._selectedDirty=e;this._selectedShadow=this._selected;this._parentSelectedShadow=this._parentSelected;this._combinedSelectedShadow=this._combinedSelected;this._selectedLength=k(this._selected)?this._selected.length:0;this._parentSelectedLength=k(this._parentSelected)?this._parentSelected.length:0;e=this._stages;f=e.length;for(d=0;d<f;++d){var g=e[d];this._selectedDirty&&(g.parentSelected=this._combinedSelected);g.update(a,b)}};m.prototype.isDestroyed=function(){return!1};m.prototype.destroy=function(){for(var a=this._stages,b=a.length,f=0;f<b;++f)a[f].destroy();return l(this)};return m});F("Scene/PostProcessStageLibrary","../Core/buildModuleUrl ../Core/createGuid ../Core/Color ../Core/defined ../Core/defineProperties ../Core/deprecationWarning ../Core/destroyObject ../Core/Ellipsoid ../Shaders/PostProcessStages/AcesTonemapping ../Shaders/PostProcessStages/AmbientOcclusionGenerate ../Shaders/PostProcessStages/AmbientOcclusionModulate ../Shaders/PostProcessStages/BlackAndWhite ../Shaders/PostProcessStages/BloomComposite ../Shaders/PostProcessStages/Brightness ../Shaders/PostProcessStages/ContrastBias ../Shaders/PostProcessStages/DepthOfField ../Shaders/PostProcessStages/DepthView ../Shaders/PostProcessStages/EdgeDetection ../Shaders/PostProcessStages/FilmicTonemapping ../Shaders/PostProcessStages/FXAA ../Shaders/PostProcessStages/GaussianBlur1D ../Shaders/PostProcessStages/LensFlare ../Shaders/PostProcessStages/ModifiedReinhardTonemapping ../Shaders/PostProcessStages/NightVision ../Shaders/PostProcessStages/ReinhardTonemapping ../Shaders/PostProcessStages/Silhouette ../ThirdParty/Shaders/FXAA3_11 ./AutoExposure ./PostProcessStage ./PostProcessStageComposite ./PostProcessStageSampleMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,I,H,F,w,G,E,L){function K(a){var b="#define USE_STEP_SIZE\n"+D,c=new G({name:a+"_x_direction",fragmentShader:b,uniforms:{delta:1,sigma:2,stepSize:1,direction:0},sampleMode:L.LINEAR}),d=new G({name:a+"_y_direction",fragmentShader:b,uniforms:{delta:1,sigma:2,stepSize:1,direction:1},sampleMode:L.LINEAR}),b={};g(b,{delta:{get:function(){return c.uniforms.delta},set:function(a){c.uniforms.delta=d.uniforms.delta=a}},sigma:{get:function(){return c.uniforms.sigma},set:function(a){c.uniforms.sigma=d.uniforms.sigma=a}},stepSize:{get:function(){return c.uniforms.stepSize},set:function(a){c.uniforms.stepSize=d.uniforms.stepSize=a}}});return new E({name:a,stages:[c,d],uniforms:b})}var J={createBlurStage:function(){return K("czm_blur")},createDepthOfFieldStage:function(){var a=K("czm_depth_of_field_blur"),b=new G({name:"czm_depth_of_field_composite",fragmentShader:u,uniforms:{focalDistance:5,blurTexture:a.name}}),c={};g(c,{focalDistance:{get:function(){return b.uniforms.focalDistance},set:function(a){b.uniforms.focalDistance=a}},delta:{get:function(){return a.uniforms.delta},set:function(b){a.uniforms.delta=b}},sigma:{get:function(){return a.uniforms.sigma},set:function(b){a.uniforms.sigma=b}},stepSize:{get:function(){return a.uniforms.stepSize},set:function(b){a.uniforms.stepSize=b}}});return new E({name:"czm_depth_of_field",stages:[a,b],inputPreviousStageTexture:!1,uniforms:c})},isDepthOfFieldSupported:function(a){return a.context.depthTexture},createEdgeDetectionStage:function(){var b=a();return new G({name:"czm_edge_detection_"+b,fragmentShader:A,uniforms:{length:.25,color:f.clone(f.BLACK)}})},isEdgeDetectionSupported:function(a){return a.context.depthTexture},createSilhouetteStage:function(a){var b;if(k(a)){b=new E({name:"czm_edge_detection_multiple",stages:a,inputPreviousStageTexture:!1});for(var c={},d="",e="",f=0;f<a.length;++f)d+="uniform sampler2D edgeTexture"+f+"; \n",e+="        vec4 edge"+f+" \x3d texture2D(edgeTexture"+f+", v_textureCoordinates); \n        if (edge"+f+".a \x3e 0.0) \n        { \n            color \x3d edge"+f+"; \n            break; \n        } \n",c["edgeTexture"+f]=a[f].name;a=new G({name:"czm_edge_detection_combine",fragmentShader:d+"varying vec2 v_textureCoordinates; \nvoid main() { \n    vec4 color \x3d vec4(0.0); \n    for (int i \x3d 0; i \x3c "+a.length+"; i++) \n    { \n"+e+"    } \n    gl_FragColor \x3d color; \n} \n",uniforms:c});b=new E({name:"czm_edge_detection_composite",stages:[b,a]})}else b=J.createEdgeDetectionStage();a=new G({name:"czm_silhouette_color_edges",fragmentShader:H,uniforms:{silhouetteTexture:b.name}});return new E({name:"czm_silhouette",stages:[b,a],inputPreviousStageTexture:!1,uniforms:b.uniforms})},isSilhouetteSupported:function(a){return a.context.depthTexture},createBloomStage:function(){var a=new G({name:"czm_bloom_contrast_bias",fragmentShader:c,uniforms:{contrast:128,brightness:-.3}}),b=K("czm_bloom_blur"),d=new E({name:"czm_bloom_contrast_bias_blur",stages:[a,b]}),e=new G({name:"czm_bloom_generate_composite",fragmentShader:t,uniforms:{glowOnly:!1,bloomTexture:d.name}}),f={};g(f,{glowOnly:{get:function(){return e.uniforms.glowOnly},set:function(a){e.uniforms.glowOnly=a}},contrast:{get:function(){return a.uniforms.contrast},set:function(b){a.uniforms.contrast=b}},brightness:{get:function(){return a.uniforms.brightness},set:function(b){a.uniforms.brightness=b}},delta:{get:function(){return b.uniforms.delta},set:function(a){b.uniforms.delta=a}},sigma:{get:function(){return b.uniforms.sigma},set:function(a){b.uniforms.sigma=a}},stepSize:{get:function(){return b.uniforms.stepSize},set:function(a){b.uniforms.stepSize=a}}});return new E({name:"czm_bloom",stages:[d,e],inputPreviousStageTexture:!1,uniforms:f})},createAmbientOcclusionStage:function(){var a=new G({name:"czm_ambient_occlusion_generate",fragmentShader:p,uniforms:{intensity:3,bias:.1,lengthCap:.26,stepSize:1.95,frustumLength:1E3,randomTexture:void 0}}),b=K("czm_ambient_occlusion_blur");b.uniforms.stepSize=.86;var c=new E({name:"czm_ambient_occlusion_generate_blur",stages:[a,b]}),e=new G({name:"czm_ambient_occlusion_composite",fragmentShader:d,uniforms:{ambientOcclusionOnly:!1,ambientOcclusionTexture:c.name}}),f={};g(f,{intensity:{get:function(){return a.uniforms.intensity},set:function(b){a.uniforms.intensity=b}},bias:{get:function(){return a.uniforms.bias},set:function(b){a.uniforms.bias=b}},lengthCap:{get:function(){return a.uniforms.lengthCap},set:function(b){a.uniforms.lengthCap=b}},stepSize:{get:function(){return a.uniforms.stepSize},set:function(b){a.uniforms.stepSize=b}},frustumLength:{get:function(){return a.uniforms.frustumLength},set:function(b){a.uniforms.frustumLength=b}},randomTexture:{get:function(){return a.uniforms.randomTexture},set:function(b){a.uniforms.randomTexture=b}},delta:{get:function(){return b.uniforms.delta},set:function(a){b.uniforms.delta=a}},sigma:{get:function(){return b.uniforms.sigma},set:function(a){b.uniforms.sigma=a}},blurStepSize:{get:function(){return b.uniforms.stepSize},set:function(a){b.uniforms.stepSize=a}},ambientOcclusionOnly:{get:function(){return e.uniforms.ambientOcclusionOnly},set:function(a){e.uniforms.ambientOcclusionOnly=a}}});return new E({name:"czm_ambient_occlusion",stages:[c,e],inputPreviousStageTexture:!1,uniforms:f})},isAmbientOcclusionSupported:function(a){return a.context.depthTexture}},N="#define FXAA_QUALITY_PRESET 39 \n"+F+"\n"+x;J.createFXAAStage=function(){return new G({name:"czm_FXAA",fragmentShader:N,sampleMode:L.LINEAR})};J.createAcesTonemappingStage=function(a){return new G({name:"czm_aces",fragmentShader:(a?"#define AUTO_EXPOSURE\n":"")+h,uniforms:{autoExposure:void 0}})};J.createFilmicTonemappingStage=function(a){return new G({name:"czm_filmic",fragmentShader:(a?"#define AUTO_EXPOSURE\n":"")+z,uniforms:{autoExposure:void 0}})};J.createReinhardTonemappingStage=function(a){return new G({name:"czm_reinhard",fragmentShader:(a?"#define AUTO_EXPOSURE\n":"")+I,uniforms:{autoExposure:void 0}})};J.createModifiedReinhardTonemappingStage=function(a){return new G({name:"czm_modified_reinhard",fragmentShader:(a?"#define AUTO_EXPOSURE\n":"")+B,uniforms:{white:f.WHITE,autoExposure:void 0}})};J.createAutoExposureStage=function(){return new w};J.createBlackAndWhiteStage=function(){return new G({name:"czm_black_and_white",fragmentShader:q,uniforms:{gradations:5}})};J.createBrightnessStage=function(){return new G({name:"czm_brightness",fragmentShader:r,uniforms:{brightness:.5}})};J.createNightVisionStage=function(){return new G({name:"czm_night_vision",fragmentShader:C})};J.createDepthViewStage=function(){return new G({name:"czm_depth_view",fragmentShader:y})};J.createLensFlareStage=function(){return new G({name:"czm_lens_flare",fragmentShader:v,uniforms:{dirtTexture:b("Assets/Textures/LensFlare/DirtMask.jpg"),starTexture:b("Assets/Textures/LensFlare/StarBurst.jpg"),intensity:2,distortion:10,ghostDispersal:.4,haloWidth:.4,earthRadius:e.WGS84.maximumRadius}})};return J});F("Scene/PostProcessStageTextureCache","../Core/Color ../Core/defined ../Core/Math ../Core/destroyObject ../Renderer/ClearCommand ../Renderer/Framebuffer ../Renderer/Texture".split(" "),function(b,a,f,k,g,l,m){function e(a){this._collection=a;this._framebuffers=[];this._stageNameToFramebuffer={};this._height=this._width=void 0;this._updateDependencies=!1}function h(b){for(;a(b.length);)b=b.get(b.length-1);return b.name}function p(b,d,c,e,f){if(!e.enabled||!e._isSupported(d))return f;d=c[e.name]={};a(f)&&(f=b.getStageByName(f),d[h(f)]=!0);f=e.uniforms;if(a(f)){c=Object.getOwnPropertyNames(f);for(var g=c.length,k=0;k<g;++k){var l=f[c[k]];"string"===typeof l&&(l=b.getStageByName(l),a(l)&&(d[h(l)]=!0))}}return e.name}function d(b,e,c,f,g){if(a(f.enabled)&&!f.enabled||a(f._isSupported)&&!f._isSupported(e))return g;for(var k=g,l=!a(f.inputPreviousStageTexture)||f.inputPreviousStageTexture,m=g,q=f.length,r=0;r<q;++r)m=f.get(r),m=a(m.length)?d(b,e,c,m,g):p(b,e,c,m,g),l&&(g=m);if(l)for(b=1;b<q;++b)e=h(f.get(b)),a(c[e])||(c[e]={}),c[e][k]=!0;else for(b=1;b<q;++b)for(e=h(f.get(b)),k=c[e],e=0;e<b;++e)k[h(f.get(e))]=!0;return m}function q(a){a=a._framebuffers;for(var b=a.length,c=0;c<b;++c){var d=a[c];d.buffer=d.buffer&&d.buffer.destroy();d.buffer=void 0}}e.prototype.updateDependencies=function(){this._updateDependencies=!0};e.prototype.update=function(e){var h=this._collection,c=this._updateDependencies,k=a(h.ambientOcclusion)&&h.ambientOcclusion.enabled&&h.ambientOcclusion._isSupported(e),t=a(h.bloom)&&h.bloom.enabled&&h.bloom._isSupported(e),A=a(h._tonemapping)&&h._tonemapping.enabled&&h._tonemapping._isSupported(e),z=a(h.fxaa)&&h.fxaa.enabled&&h.fxaa._isSupported(e),h=!a(h._activeStages)||0<h._activeStages.length||k||t||A||z;if(c||!h&&0<this._framebuffers.length)q(this),this._framebuffers.length=0,this._stageNameToFramebuffer={},this._height=this._width=void 0;if(c||h){if(0===this._framebuffers.length){k=this._collection;h={};if(a(k.ambientOcclusion)){var t=k.bloom,A=k._tonemapping,z=k.fxaa,x=d(k,e,h,k.ambientOcclusion,void 0),x=d(k,e,h,t,x),x=p(k,e,h,A,x),x=d(k,e,h,k,x);p(k,e,h,z,x)}else d(k,e,h,k,void 0);for(var D in h)if(h.hasOwnProperty(D)){k=this._stageNameToFramebuffer;t=D;var A=D,z=h[D],v=this._collection.getStageByName(A),x=v._textureScale,B=v._forcePowerOfTwo,C=v._pixelFormat,I=v._pixelDatatype,v=v._clearColor,H,F=void 0,w=this._framebuffers,G=w.length;for(H=0;H<G;++H)if(F=w[H],x===F.textureScale&&B===F.forcePowerOfTwo&&C===F.pixelFormat&&I===F.pixelDatatype&&b.equals(v,F.clearColor)){for(var E=F.stages,L=E.length,K=!1,P=0;P<L;++P)if(z[E[P]]){K=!0;break}if(!K)break}a(F)&&H<G?F.stages.push(A):(F={textureScale:x,forcePowerOfTwo:B,pixelFormat:C,pixelDatatype:I,clearColor:v,stages:[A],buffer:void 0,clear:void 0},w.push(F));A=F;k[t]=A}}D=e.drawingBufferWidth;h=e.drawingBufferHeight;k=this._width!==D||this._height!==h;if(c||k)for(this._width=D,this._height=h,this._updateDependencies=!1,q(this),c=this._width,D=this._height,h=this._framebuffers,k=h.length,t=0;t<k;++t)A=h[t],x=A.textureScale,z=Math.ceil(c*x),x=Math.ceil(D*x),B=Math.min(z,x),A.forcePowerOfTwo&&(f.isPowerOfTwo(B)||(B=f.nextPowerOfTwo(B)),x=z=B),A.buffer=new l({context:e,colorTextures:[new m({context:e,width:z,height:x,pixelFormat:A.pixelFormat,pixelDatatype:A.pixelDatatype})]}),A.clear=new g({color:A.clearColor,framebuffer:A.buffer})}};e.prototype.clear=function(a){for(var b=this._framebuffers,c=0;c<b.length;++c)b[c].clear.execute(a)};e.prototype.getStageByName=function(a){return this._collection.getStageByName(a)};e.prototype.getOutputTexture=function(a){return this._collection.getOutputTexture(a)};e.prototype.getFramebuffer=function(b){b=this._stageNameToFramebuffer[b];if(a(b))return b.buffer};e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){q(this);return k(this)};return e});F("Scene/Tonemapper",["../Core/freezeObject"],function(b){var a={REINHARD:0,MODIFIED_REINHARD:1,FILMIC:2,ACES:3,validate:function(b){return b===a.REINHARD||b===a.MODIFIED_REINHARD||b===a.FILMIC||b===a.ACES}};return b(a)});F("Scene/PostProcessStageCollection","../Core/arraySlice ../Core/Check ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/PixelFormat ../Renderer/PixelDatatype ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ../Shaders/PostProcessStages/PassThrough ./PostProcessStageLibrary ./PostProcessStageTextureCache ./Tonemapper".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A){function z(){var a=u.createFXAAStage(),b=u.createAmbientOcclusionStage(),c=u.createBloomStage();this._autoExposureEnabled=!1;this._autoExposure=u.createAutoExposureStage();this._tonemapper=this._tonemapping=void 0;this.tonemapper=A.ACES;var d=this._tonemapping;b.enabled=!1;c.enabled=!1;d.enabled=!1;var e=new y(this),f={},g=B;for(g.push(a,b,c,d);0<g.length;){d=g.pop();f[d.name]=d;d._textureCache=e;var h=d.length;if(k(h))for(var l=0;l<h;++l)g.push(d.get(l))}this._stages=[];this._activeStages=[];this._previousActiveStages=[];this._randomTexture=void 0;var m=this;b.uniforms.randomTexture=function(){return m._randomTexture};this._ao=b;this._bloom=c;this._fxaa=a;this._fxaaEnabled=this._tonemappingEnabled=this._bloomEnabled=this._aoEnabled=this._lastLength=void 0;this._textureCacheDirty=this._stagesRemoved=!1;this._stageNames=f;this._textureCache=e}function x(a){if(a._stagesRemoved){a._stagesRemoved=!1;for(var b=[],c=a._stages,d=c.length,e=0,f=0;e<d;++e){var g=c[e];g&&(g._index=f++,b.push(g))}a._stages=b}}function D(a){for(;k(a.length);)a=a.get(a.length-1);return a.outputTexture}function v(a,b,c,d,e){if(k(a.execute))a.execute(b,c,d,e);else{var f=a.length,g;if(a.inputPreviousStageTexture)for(v(a.get(0),b,c,d,e),g=1;g<f;++g)v(a.get(g),b,D(a.get(g-1)),d,e);else for(g=0;g<f;++g)v(a.get(g),b,c,d,e)}}var B=[];g(z.prototype,{ready:{get:function(){for(var a=!1,b=this._stages,c=b.length-1;0<=c;--c)var d=b[c],a=a||d.ready&&d.enabled;var b=this._fxaa,c=this._ao,d=this._bloom,e=this._tonemapping;return a=(a=(a=(a=a||b.ready&&b.enabled)||c.ready&&c.enabled)||d.ready&&d.enabled)||e.ready&&e.enabled}},fxaa:{get:function(){return this._fxaa}},ambientOcclusion:{get:function(){return this._ao}},bloom:{get:function(){return this._bloom}},length:{get:function(){x(this);return this._stages.length}},outputTexture:{get:function(){var a=this._fxaa;if(a.enabled&&a.ready)return this.getOutputTexture(a.name);for(var a=this._stages,b=a.length-1;0<=b;--b){var c=a[b];if(k(c)&&c.ready&&c.enabled)return this.getOutputTexture(c.name)}a=this._tonemapping;if(a.enabled&&a.ready)return this.getOutputTexture(a.name);a=this._bloom;if(a.enabled&&a.ready)return this.getOutputTexture(a.name);a=this._ao;if(a.enabled&&a.ready)return this.getOutputTexture(a.name)}},hasSelected:{get:function(){for(var a=b(this._stages);0<a.length;){var c=a.pop();if(k(c)){if(k(c.selected))return!0;var d=c.length;if(k(d))for(var e=0;e<d;++e)a.push(c.get(e))}}return!1}},tonemapper:{get:function(){return this._tonemapper},set:function(a){if(this._tonemapper!==a){if(!A.validate(a))throw new m("tonemapper was set to an invalid value.");k(this._tonemapping)&&(delete this._stageNames[this._tonemapping.name],this._tonemapping.destroy());var b=this._autoExposureEnabled,c;switch(a){case A.REINHARD:c=u.createReinhardTonemappingStage(b);break;case A.MODIFIED_REINHARD:c=u.createModifiedReinhardTonemappingStage(b);break;case A.FILMIC:c=u.createFilmicTonemappingStage(b);break;default:c=u.createAcesTonemappingStage(b)}if(b){var d=this._autoExposure;c.uniforms.autoExposure=function(){return d.outputTexture}}this._tonemapper=a;this._tonemapping=c;k(this._stageNames)&&(this._stageNames[c.name]=c,c._textureCache=this._textureCache);this._textureCacheDirty=!0}}}});z.prototype.add=function(b){a.typeOf.object("stage",b);var c=this._stageNames,d=B;for(d.push(b);0<d.length;){var e=d.pop();if(k(c[e.name]))throw new m(e.name+" has already been added to the collection or does not have a unique name.");c[e.name]=e;e._textureCache=this._textureCache;var f=e.length;if(k(f))for(var g=0;g<f;++g)d.push(e.get(g))}c=this._stages;b._index=c.length;c.push(b);this._textureCacheDirty=!0;return b};z.prototype.remove=function(a){if(!this.contains(a))return!1;var b=this._stageNames,c=B;for(c.push(a);0<c.length;){var d=c.pop();delete b[d.name];var e=d.length;if(k(e))for(var f=0;f<e;++f)c.push(d.get(f))}this._stages[a._index]=void 0;this._textureCacheDirty=this._stagesRemoved=!0;a._index=void 0;a._textureCache=void 0;a.destroy();return!0};z.prototype.contains=function(a){return k(a)&&k(a._index)&&a._textureCache===this._textureCache};z.prototype.get=function(b){x(this);var c=this._stages,d=c.length;a.typeOf.number.greaterThanOrEquals("stages length",d,0);a.typeOf.number.greaterThanOrEquals("index",b,0);a.typeOf.number.lessThan("index",b,d);return c[b]};z.prototype.removeAll=function(){for(var a=this._stages,b=a.length,c=0;c<b;++c)this.remove(a[c]);a.length=0};z.prototype.getStageByName=function(a){return this._stageNames[a]};z.prototype.update=function(a,b,c){x(this);var f=this._activeStages,g=this._activeStages=this._previousActiveStages;this._previousActiveStages=f;var l=this._stages,m=g.length=l.length,u,v,y=0;for(u=0;u<m;++u)v=l[u],v.ready&&v.enabled&&v._isSupported(a)&&(g[y++]=v);g.length=y;m=y!==f.length;if(!m)for(u=0;u<y;++u)if(g[u]!==f[u]){m=!0;break}f=this._ao;g=this._bloom;v=this._autoExposure;var z=this._tonemapping,A=this._fxaa;z.enabled=c;u=f.enabled&&f._isSupported(a);c=g.enabled&&g._isSupported(a);var B=z.enabled&&z._isSupported(a),C=A.enabled&&A._isSupported(a);if(m||this._textureCacheDirty||y!==this._lastLength||u!==this._aoEnabled||c!==this._bloomEnabled||B!==this._tonemappingEnabled||C!==this._fxaaEnabled)this._textureCache.updateDependencies(),this._lastLength=y,this._aoEnabled=u,this._bloomEnabled=c,this._tonemappingEnabled=B,this._fxaaEnabled=C,this._textureCacheDirty=!1;k(this._randomTexture)&&!u&&(this._randomTexture.destroy(),this._randomTexture=void 0);if(!k(this._randomTexture)&&u){m=196608;y=new Uint8Array(m);for(u=0;u<m;u+=3)y[u]=Math.floor(255*Math.random());this._randomTexture=new d({context:a,pixelFormat:e.RGB,pixelDatatype:h.UNSIGNED_BYTE,source:{arrayBufferView:y,width:256,height:256},sampler:new p({wrapS:r.REPEAT,wrapT:r.REPEAT,minificationFilter:t.NEAREST,magnificationFilter:q.NEAREST})})}this._textureCache.update(a);A.update(a,b);f.update(a,b);g.update(a,b);z.update(a,b);this._autoExposureEnabled&&v.update(a,b);m=l.length;for(u=0;u<m;++u)l[u].update(a,b)};z.prototype.clear=function(a){this._textureCache.clear(a);this._autoExposureEnabled&&this._autoExposure.clear(a)};z.prototype.getOutputTexture=function(a){a=this.getStageByName(a);if(k(a))return D(a)};z.prototype.execute=function(a,b,c,d){var e=this._activeStages,f=e.length,g=this._fxaa,h=this._ao,k=this._bloom,l=this._autoExposure,m=this._tonemapping,p=h.enabled&&h._isSupported(a),q=k.enabled&&k._isSupported(a),r=this._autoExposureEnabled,t=m.enabled&&m._isSupported(a),u=g.enabled&&g._isSupported(a);if(u||p||q||t||0!==f){p&&h.ready&&(v(h,a,b,c,d),b=D(h));q&&k.ready&&(v(k,a,b,c,d),b=D(k));r&&l.ready&&v(l,a,b,c,d);t&&m.ready&&(v(m,a,b,c,d),b=D(m));h=b;if(0<f){v(e[0],a,b,c,d);for(h=1;h<f;++h)v(e[h],a,D(e[h-1]),c,d);h=D(e[f-1])}u&&g.ready&&v(g,a,h,c,d)}};z.prototype.copy=function(a,b){if(!k(this._copyColorCommand)){var d=this;this._copyColorCommand=a.createViewportQuadCommand(c,{uniformMap:{colorTexture:function(){return d.outputTexture}},owner:this})}this._copyColorCommand.framebuffer=b;this._copyColorCommand.execute(a)};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){this._fxaa.destroy();this._ao.destroy();this._bloom.destroy();this._autoExposure.destroy();this._tonemapping.destroy();this.removeAll();this._textureCache=this._textureCache&&this._textureCache.destroy();return l(this)};return z});F("Scene/QuadtreeTileProvider",["../Core/defineProperties","../Core/DeveloperError"],function(b,a){function f(){a.throwInstantiationError()}f.computeDefaultLevelZeroMaximumGeometricError=function(a){return 2*a.ellipsoid.maximumRadius*Math.PI*.25/(65*a.getNumberOfXTilesAtLevel(0))};b(f.prototype,{quadtree:{get:a.throwInstantiationError,set:a.throwInstantiationError},ready:{get:a.throwInstantiationError},tilingScheme:{get:a.throwInstantiationError},errorEvent:{get:a.throwInstantiationError}});f.prototype.update=a.throwInstantiationError;f.prototype.beginUpdate=a.throwInstantiationError;f.prototype.endUpdate=a.throwInstantiationError;f.prototype.getLevelMaximumGeometricError=a.throwInstantiationError;f.prototype.loadTile=a.throwInstantiationError;f.prototype.computeTileVisibility=a.throwInstantiationError;f.prototype.showTileThisFrame=a.throwInstantiationError;f.prototype.computeDistanceToTile=a.throwInstantiationError;f.prototype.isDestroyed=a.throwInstantiationError;f.prototype.destroy=a.throwInstantiationError;return f});F("Scene/SceneTransitioner","../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/defined ../Core/destroyObject ../Core/EasingFunction ../Core/Math ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Core/PerspectiveFrustum ../Core/Ray ../Core/ScreenSpaceEventHandler ../Core/ScreenSpaceEventType ../Core/Transforms ./Camera ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(a){f.typeOf.object("scene",a);this._scene=a;this._currentTweens=[];this._morphHandler=void 0;this._morphCancelled=!1;this._completeMorph=void 0;this._morphToOrthographic=!1}function z(a,b){if(a._scene.completeMorphOnUserInput){a._morphHandler=new t(a._scene.canvas,!1);var c=function(){a._morphCancelled=!0;a._scene.camera.cancelFlight();b(a)};a._completeMorph=c;a._morphHandler.setInputAction(c,r.LEFT_DOWN);a._morphHandler.setInputAction(c,r.MIDDLE_DOWN);a._morphHandler.setInputAction(c,r.RIGHT_DOWN);a._morphHandler.setInputAction(c,r.WHEEL)}}function x(a){for(var b=a._currentTweens,c=0;c<b.length;++c)b[c].cancelTween();a._currentTweens.length=0;a._morphHandler=a._morphHandler&&a._morphHandler.destroy()}function D(a,b){var d=a._scene,f=d.camera,g=T,h=g.position,k=g.direction,l=g.up,d=d.mapProjection.unproject(f.position,V);b.cartographicToCartesian(d,h);h=b.scaleToGeodeticSurface(h,ba);h=c.eastNorthUpToFixedFrame(h,b,X);e.multiplyByPointAsVector(h,f.direction,k);e.multiplyByPointAsVector(h,f.up,l);return g}function v(a,c,d,f){c*=.5;var g=a._scene,h=g.camera,k=b.clone(h.position,fa),m=b.clone(h.direction,ga),p=b.clone(h.up,ka),q=e.multiplyByPoint(u.TRANSFORM_2D_INVERSE,d.position,na),r=e.multiplyByPointAsVector(u.TRANSFORM_2D_INVERSE,d.direction,ia),t=e.multiplyByPointAsVector(u.TRANSFORM_2D_INVERSE,d.up,la);d=g.tweens.add({duration:c,easingFunction:l.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(a){b.lerp(k,q,a.time,h.position);b.lerp(m,r,a.time,h.direction);b.lerp(p,t,a.time,h.up);b.cross(h.direction,h.up,h.right);b.normalize(h.right,h.right)},complete:function(){E(a,g,0,1,c,f)}});a._currentTweens.push(d)}function B(a,c,d){c/=3;var e=a._scene,f=e.camera,g;0<c?(g=T,b.fromDegrees(0,0,5*d.maximumRadius,d,g.position),b.negate(g.position,g.direction),b.normalize(g.direction,g.direction),b.clone(b.UNIT_Z,g.up)):(f.position.z=f.frustum.right-f.frustum.left,g=D(a,d));var h;a._morphToOrthographic?(h=ha,h.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,h.width=f.frustum.right-f.frustum.left):(h=da,h.aspectRatio=e.drawingBufferWidth/e.drawingBufferHeight,h.fov=m.toRadians(60));g.frustum=h;var k=L(g);z(a,k);var l;l=a._morphToOrthographic?function(){v(a,c,g,k)}:function(){F(a,c,g,function(){v(a,c,g,k)})};0<c?(e._mode=y.SCENE2D,f.flyTo({duration:c,destination:b.fromDegrees(0,0,5*d.maximumRadius,d,ua),complete:function(){e._mode=y.MORPHING;l()}})):l()}function C(a,b,c,d,e){var f=a._scene,g=f.camera;if(!(g.frustum instanceof h)){var k=g.frustum.fov,p=.5*m.RADIANS_PER_DEGREE,q=c.position.z*Math.tan(.5*k);g.frustum.far=q/Math.tan(.5*p)+1E7;b=f.tweens.add({duration:b,easingFunction:l.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(a){g.frustum.fov=m.lerp(k,p,a.time);d(g,q/Math.tan(.5*g.frustum.fov))},complete:function(){g.frustum=c.frustum.clone();e(a)}});a._currentTweens.push(b)}}function I(a,c){function d(a,b){a.position.z=b}c*=.5;var f=a._scene,g=f.camera,h=b.clone(g.position,za),m=b.clone(g.direction,Da),p=b.clone(g.up,Ba),q=b.negate(b.UNIT_Z,Ea),r=b.clone(b.UNIT_Y,Ga),t=ra;if(0<c)b.clone(b.ZERO,ra),t.z=5*f.mapProjection.ellipsoid.maximumRadius;else{b.clone(h,ra);var w=ya;e.multiplyByPoint(u.TRANSFORM_2D,h,w.origin);e.multiplyByPointAsVector(u.TRANSFORM_2D,m,w.direction);var v=f.globe;k(v)&&(w=v.pickWorldCoordinates(w,f,Aa),k(w)&&(e.multiplyByPoint(u.TRANSFORM_2D_INVERSE,w,t),t.z+=b.distance(h,t)))}w=Ca;w.right=.5*t.z;w.left=-w.right;w.top=f.drawingBufferHeight/f.drawingBufferWidth*w.right;w.bottom=-w.top;var y=Ua;y.position=t;y.direction=q;y.up=r;y.frustum=w;var E=K(y);z(a,E);f=f.tweens.add({duration:c,easingFunction:l.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(a){b.lerp(h,t,a.time,g.position);b.lerp(m,q,a.time,g.direction);b.lerp(p,r,a.time,g.up);b.cross(g.direction,g.up,g.right);b.normalize(g.right,g.right);g._adjustOrthographicFrustum(!0)},complete:function(){C(a,c,y,d,E)}});a._currentTweens.push(f)}function H(a,d,f){function g(a,b){a.position.x=b}d*=.5;var h=a._scene,l=h.camera,m=Va;if(0<d)b.clone(b.ZERO,m.position),m.position.z=5*f.maximumRadius,b.negate(b.UNIT_Z,m.direction),b.clone(b.UNIT_Y,m.up);else{f.cartesianToCartographic(l.positionWC,sa);h.mapProjection.project(sa,m.position);b.negate(b.UNIT_Z,m.direction);b.clone(b.UNIT_Y,m.up);var p=Ma;b.clone(m.position2D,p.origin);var q=b.clone(l.directionWC,p.direction),l=f.scaleToGeodeticSurface(l.positionWC,La);f=c.eastNorthUpToFixedFrame(l,f,Ia);e.inverseTransformation(f,f);e.multiplyByPointAsVector(f,q,q);e.multiplyByPointAsVector(u.TRANSFORM_2D,q,q);q=h.globe;k(q)&&(p=q.pickWorldCoordinates(p,h,Ha),k(p)&&(q=b.distance(m.position2D,p),p.x+=q,b.clone(p,m.position2D)))}e.multiplyByPoint(u.TRANSFORM_2D,m.position,m.position2D);e.multiplyByPointAsVector(u.TRANSFORM_2D,m.direction,m.direction2D);e.multiplyByPointAsVector(u.TRANSFORM_2D,m.up,m.up2D);p=m.frustum;p.right=.5*m.position.z;p.left=-p.right;p.top=h.drawingBufferHeight/h.drawingBufferWidth*p.right;p.bottom=-p.top;h=xa;e.multiplyByPoint(u.TRANSFORM_2D_INVERSE,m.position2D,h.position);b.clone(m.direction,h.direction);b.clone(m.up,h.up);h.frustum=p;var r=K(h);z(a,r);G(a,d,m,function(){C(a,d,m,g,r)})}function F(a,b,c,d){var e=a._scene,f=e.camera,g=f.frustum.right-f.frustum.left;f.frustum=c.frustum.clone();var h=f.frustum.fov,k=.5*m.RADIANS_PER_DEGREE,p=g*Math.tan(.5*h);f.frustum.far=p/Math.tan(.5*k)+1E7;f.frustum.fov=k;b=e.tweens.add({duration:b,easingFunction:l.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(a){f.frustum.fov=m.lerp(k,h,a.time);f.position.z=p/Math.tan(.5*f.frustum.fov)},complete:function(){d(a)}});a._currentTweens.push(b)}function w(a,c,d,e){function f(){h.frustum=d.frustum.clone();var f=b.clone(h.position,pa),q=b.clone(h.direction,oa),r=b.clone(h.up,qa);f.z=k.z;var t=g.tweens.add({duration:c,easingFunction:l.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(a){b.lerp(f,k,a.time,h.position);b.lerp(q,m,a.time,h.direction);b.lerp(r,p,a.time,h.up);b.cross(h.direction,h.up,h.right);b.normalize(h.right,h.right)},complete:function(){e(a)}});a._currentTweens.push(t)}c*=.5;var g=a._scene,h=g.camera,k=b.clone(d.position,ua),m=b.clone(d.direction,ta),p=b.clone(d.up,wa);g._mode=y.MORPHING;a._morphToOrthographic?f():F(a,0,d,f)}function G(a,c,d,e){var f=a._scene,g=f.camera,h=b.clone(g.position,pa),k=b.clone(g.direction,oa),m=b.clone(g.up,qa),p=b.clone(d.position2D,ua),q=b.clone(d.direction2D,ta),r=b.clone(d.up2D,wa);d=f.tweens.add({duration:c,easingFunction:l.QUARTIC_OUT,startObject:{time:0},stopObject:{time:1},update:function(a){b.lerp(h,p,a.time,g.position);b.lerp(k,q,a.time,g.direction);b.lerp(m,r,a.time,g.up);b.cross(g.direction,g.up,g.right);b.normalize(g.right,g.right);g._adjustOrthographicFrustum(!0)},complete:function(){E(a,f,1,0,c,e)}});a._currentTweens.push(d)}function E(a,b,c,d,e,f){c={object:b,property:"morphTime",startValue:c,stopValue:d,duration:e,easingFunction:l.QUARTIC_OUT};k(f)&&(c.complete=function(){f(a)});b=b.tweens.addProperty(c);a._currentTweens.push(b)}function L(a){return function(c){var d=c._scene;d._mode=y.SCENE3D;d.morphTime=y.getMorphTime(y.SCENE3D);x(c);var e=d.camera;if(c._previousMode!==y.MORPHING||c._morphCancelled)c._morphCancelled=!1,b.clone(a.position,e.position),b.clone(a.direction,e.direction),b.clone(a.up,e.up),b.cross(e.direction,e.up,e.right),b.normalize(e.right,e.right),e.frustum=a.frustum.clone();e=e.frustum;d.frameState.useLogDepth&&(e.near=.1,e.far=1E10);e=k(c._completeMorph);c._completeMorph=void 0;d.camera.update(d.mode);c._scene.morphComplete.raiseEvent(c,c._previousMode,y.SCENE3D,e)}}function K(a){return function(c){var d=c._scene;d._mode=y.SCENE2D;d.morphTime=y.getMorphTime(y.SCENE2D);x(c);var e=d.camera;b.clone(a.position,e.position);e.position.z=2*d.mapProjection.ellipsoid.maximumRadius;b.clone(a.direction,e.direction);b.clone(a.up,e.up);b.cross(e.direction,e.up,e.right);b.normalize(e.right,e.right);e.frustum=a.frustum.clone();e=k(c._completeMorph);c._completeMorph=void 0;d.camera.update(d.mode);c._scene.morphComplete.raiseEvent(c,c._previousMode,y.SCENE2D,e)}}function P(a){return function(c){var d=c._scene;d._mode=y.COLUMBUS_VIEW;d.morphTime=y.getMorphTime(y.COLUMBUS_VIEW);x(c);var e=d.camera;if(c._previousModeMode!==y.MORPHING||c._morphCancelled)c._morphCancelled=!1,b.clone(a.position,e.position),b.clone(a.direction,e.direction),b.clone(a.up,e.up),b.cross(e.direction,e.up,e.right),b.normalize(e.right,e.right);e=e.frustum;d.frameState.useLogDepth&&(e.near=.1,e.far=1E10);e=k(c._completeMorph);c._completeMorph=void 0;d.camera.update(d.mode);c._scene.morphComplete.raiseEvent(c,c._previousMode,y.COLUMBUS_VIEW,e)}}A.prototype.completeMorph=function(){k(this._completeMorph)&&this._completeMorph()};A.prototype.morphTo2D=function(a,b){k(this._completeMorph)&&this._completeMorph();var c=this._scene;this._previousMode=c.mode;this._morphToOrthographic=c.camera.frustum instanceof h;this._previousMode!==y.SCENE2D&&this._previousMode!==y.MORPHING&&(this._scene.morphStart.raiseEvent(this,this._previousMode,y.SCENE2D,!0),c._mode=y.MORPHING,c.camera._setTransform(e.IDENTITY),this._previousMode===y.COLUMBUS_VIEW?I(this,a):H(this,a,b),0===a&&k(this._completeMorph)&&this._completeMorph())};var N=new b,O=new b,Z=new b,aa=new b,U=new b,W=new b,M=new b,R=new a,Y=new e,Q=new d,S=new h,ca={position:void 0,direction:void 0,up:void 0,position2D:void 0,direction2D:void 0,up2D:void 0,frustum:void 0};A.prototype.morphToColumbusView=function(a,d){k(this._completeMorph)&&this._completeMorph();var f=this._scene;this._previousMode=f.mode;if(this._previousMode!==y.COLUMBUS_VIEW&&this._previousMode!==y.MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,y.COLUMBUS_VIEW,!0);f.camera._setTransform(e.IDENTITY);var g=N;if(0<a)g.x=0,g.y=-1,g.z=1,g=b.multiplyByScalar(b.normalize(g,g),5*d.maximumRadius,g),b.negate(b.normalize(g,O),O),b.cross(b.UNIT_X,O,Z);else{var h=f.camera;this._previousMode===y.SCENE2D?(b.clone(h.position,g),g.z=h.frustum.right-h.frustum.left,b.negate(b.UNIT_Z,O),b.clone(b.UNIT_Y,Z)):(b.clone(h.positionWC,g),b.clone(h.directionWC,O),b.clone(h.upWC,Z),h=d.scaleToGeodeticSurface(g,M),h=c.eastNorthUpToFixedFrame(h,d,Y),e.inverseTransformation(h,h),f.mapProjection.project(d.cartesianToCartographic(g,R),g),e.multiplyByPointAsVector(h,O,O),e.multiplyByPointAsVector(h,Z,Z))}this._morphToOrthographic?(h=S,h.width=f.camera.frustum.right-f.camera.frustum.left,h.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight):(h=Q,h.aspectRatio=f.drawingBufferWidth/f.drawingBufferHeight,h.fov=m.toRadians(60));ca.position=g;ca.direction=O;ca.up=Z;ca.frustum=h;h=P(ca);z(this,h);this._previousMode===y.SCENE2D?w(this,a,ca,h):(ca.position2D=e.multiplyByPoint(u.TRANSFORM_2D,g,aa),ca.direction2D=e.multiplyByPointAsVector(u.TRANSFORM_2D,O,U),ca.up2D=e.multiplyByPointAsVector(u.TRANSFORM_2D,Z,W),f._mode=y.MORPHING,G(this,a,ca,h));0===a&&k(this._completeMorph)&&this._completeMorph()}};var T={position:new b,direction:new b,up:new b,frustum:void 0},da=new d;A.prototype.morphTo3D=function(a,c){k(this._completeMorph)&&this._completeMorph();var d=this._scene;this._previousMode=d.mode;if(this._previousMode!==y.SCENE3D&&this._previousMode!==y.MORPHING){this._scene.morphStart.raiseEvent(this,this._previousMode,y.SCENE3D,!0);d._mode=y.MORPHING;d.camera._setTransform(e.IDENTITY);if(this._previousMode===y.SCENE2D)B(this,a,c);else{var f;0<a?(f=T,b.fromDegrees(0,0,5*c.maximumRadius,c,f.position),b.negate(f.position,f.direction),b.normalize(f.direction,f.direction),b.clone(b.UNIT_Z,f.up)):f=D(this,c);var g;g=d.camera;g.frustum instanceof h?g=g.frustum.clone():(g=da,g.aspectRatio=d.drawingBufferWidth/d.drawingBufferHeight,g.fov=m.toRadians(60));f.frustum=g;d=L(f);z(this,d);v(this,a,f,d)}0===a&&k(this._completeMorph)&&this._completeMorph()}};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){x(this);return g(this)};var V=new a,ba=new b,X=new e,fa=new b,ga=new b,ka=new b,na=new b,ia=new b,la=new b,ha=new h,pa=new b,oa=new b,qa=new b,ua=new b,ta=new b,wa=new b,za=new b,Da=new b,Ba=new b,ra=new b,Ea=new b,Ga=new b,Ca=new p,ya=new q,Aa=new b,Ua={position:void 0,direction:void 0,up:void 0,frustum:void 0},sa=new a,Va={position:new b,direction:new b,up:new b,position2D:new b,direction2D:new b,up2D:new b,frustum:new p},xa={position:new b,direction:new b,up:new b,frustum:void 0},Ha=new b,Ma=new q,Ia=new e,La=new b;return A});F("Scene/TweenCollection","../Core/clone ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/EasingFunction ../Core/getTimestamp ../Core/TimeConstants ../ThirdParty/Tween".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a,d,e,c,f,g,h,k,l,m){this._tweens=a;this._tweenjs=d;this._startObject=b(e);this._stopObject=b(c);this._duration=f;this._delay=g;this._easingFunction=h;this._update=k;this._complete=l;this.cancel=m;this.needsStart=!0}function d(){this._tweens=[]}k(p.prototype,{startObject:{get:function(){return this._startObject}},stopObject:{get:function(){return this._stopObject}},duration:{get:function(){return this._duration}},delay:{get:function(){return this._delay}},easingFunction:{get:function(){return this._easingFunction}},update:{get:function(){return this._update}},complete:{get:function(){return this._complete}},tweenjs:{get:function(){return this._tweenjs}}});p.prototype.cancelTween=function(){this._tweens.remove(this)};k(d.prototype,{length:{get:function(){return this._tweens.length}}});d.prototype.add=function(d){d=a(d,a.EMPTY_OBJECT);if(!f(d.startObject)||!f(d.stopObject))throw new g("options.startObject and options.stopObject are required.");if(!f(d.duration)||0>d.duration)throw new g("options.duration is required and must be positive.");if(0===d.duration)return f(d.complete)&&d.complete(),new p(this);var k=d.duration/e.SECONDS_PER_MILLISECOND,m=a(d.delay,0),c=m/e.SECONDS_PER_MILLISECOND,q=a(d.easingFunction,l.LINEAR_NONE),y=d.startObject,A=new h.Tween(y);A.to(b(d.stopObject),k);A.delay(c);A.easing(q);if(f(d.update))A.onUpdate(function(){d.update(y)});A.onComplete(a(d.complete,null));A.repeat(a(d._repeat,0));k=new p(this,A,d.startObject,d.stopObject,d.duration,m,q,d.update,d.complete,d.cancel);this._tweens.push(k);return k};d.prototype.addProperty=function(b){b=a(b,a.EMPTY_OBJECT);var d=b.object,e=b.property,c=b.startValue,h=b.stopValue;if(!f(d)||!f(b.property))throw new g("options.object and options.property are required.");if(!f(d[e]))throw new g("options.object must have the specified property.");if(!f(c)||!f(h))throw new g("options.startValue and options.stopValue are required.");return this.add({startObject:{value:c},stopObject:{value:h},duration:a(b.duration,3),delay:b.delay,easingFunction:b.easingFunction,update:function(a){d[e]=a.value},complete:b.complete,cancel:b.cancel,_repeat:b._repeat})};d.prototype.addAlpha=function(b){b=a(b,a.EMPTY_OBJECT);var d=b.material;if(!f(d))throw new g("options.material is required.");var e=[],c;for(c in d.uniforms)d.uniforms.hasOwnProperty(c)&&f(d.uniforms[c])&&f(d.uniforms[c].alpha)&&e.push(c);if(0===e.length)throw new g("material has no properties with alpha components.");return this.add({startObject:{alpha:a(b.startValue,0)},stopObject:{alpha:a(b.stopValue,1)},duration:a(b.duration,3),delay:b.delay,easingFunction:b.easingFunction,update:function(a){for(var b=e.length,c=0;c<b;++c)d.uniforms[e[c]].alpha=a.alpha},complete:b.complete,cancel:b.cancel})};d.prototype.addOffsetIncrement=function(b){b=a(b,a.EMPTY_OBJECT);var d=b.material;if(!f(d))throw new g("material is required.");if(!f(d.uniforms.offset))throw new g("material.uniforms must have an offset property.");d=d.uniforms;return this.addProperty({object:d,property:"offset",startValue:d.offset,stopValue:d.offset+1,duration:b.duration,delay:b.delay,easingFunction:b.easingFunction,update:b.update,cancel:b.cancel,_repeat:Infinity})};d.prototype.remove=function(a){if(!f(a))return!1;var b=this._tweens.indexOf(a);return-1!==b?(a.tweenjs.stop(),f(a.cancel)&&a.cancel(),this._tweens.splice(b,1),!0):!1};d.prototype.removeAll=function(){for(var a=this._tweens,b=0;b<a.length;++b){var d=a[b];d.tweenjs.stop();f(d.cancel)&&d.cancel()}a.length=0};d.prototype.contains=function(a){return f(a)&&-1!==this._tweens.indexOf(a)};d.prototype.get=function(a){if(!f(a))throw new g("index is required.");return this._tweens[a]};d.prototype.update=function(a){var b=this._tweens,d=0;for(a=f(a)?a/e.SECONDS_PER_MILLISECOND:m();d<b.length;){var c=b[d],g=c.tweenjs;c.needsStart?(c.needsStart=!1,g.start(a)):g.update(a)?d++:(g.stop(),b.splice(d,1))}};return d});F("Scene/ScreenSpaceCameraController","../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/Ellipsoid ../Core/HeadingPitchRoll ../Core/IntersectionTests ../Core/isArray ../Core/KeyboardEventModifier ../Core/Math ../Core/Matrix3 ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/Plane ../Core/Quaternion ../Core/Ray ../Core/Transforms ../Core/BoundingSphere ../Core/Intersect ../Core/EasingFunction ../Core/EllipsoidalOccluder ../Core/EllipsoidTerrainProvider ../Core/BoundingRectangle ../Core/ApproximateTerrainHeights ../Core/Rectangle ../Core/FeatureDetection ./CameraEventAggregator ./CameraEventType ./MapMode2D ./SceneMode ./SceneTransforms ./TweenCollection".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,F,H,J,w,G,E,L,K,P,N,O,Z){function I(c){if(!l(c))throw new e("scene is required.");this.enableLook=this.enableTilt=this.enableRotate=this.enableZoom=this.enableTranslate=this.enableInputs=!0;this.inertiaTranslate=this.inertiaSpin=.9;this.inertiaZoom=.8;this.maximumMovementRatio=.1;this.bounceAnimationTime=3;this.minimumZoomDistance=1;this.maximumZoomDistance=Number.POSITIVE_INFINITY;this.translateEventTypes=K.LEFT_DRAG;this.zoomEventTypes=[K.RIGHT_DRAG,K.WHEEL,K.PINCH];this.rotateEventTypes=K.LEFT_DRAG;this.tiltEventTypes=[K.MIDDLE_DRAG,K.PINCH,{eventType:K.LEFT_DRAG,modifier:t.CTRL},{eventType:K.RIGHT_DRAG,modifier:t.CTRL}];this.lookEventTypes={eventType:K.LEFT_DRAG,modifier:t.SHIFT};this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight=15E4;this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight=15E3;this._minimumTrackBallHeight=this.minimumTrackBallHeight=75E5;this.enableCollisionDetection=!0;this._scene=c;this._ellipsoid=this._globe=void 0;this._aggregator=new L(c.canvas);this._lastInertiaTiltMovement=this._lastInertiaTranslateMovement=this._lastInertiaZoomMovement=this._lastInertiaSpinMovement=void 0;this._tweens=new Z;this._horizontalRotationAxis=this._tween=void 0;this._tiltCenterMousePosition=new b(-1,-1);this._tiltCenter=new a;this._rotateMousePosition=new b(-1,-1);this._rotateStartPosition=new a;this._strafeStartPosition=new a;this._zoomMouseStart=new b(-1,-1);this._zoomWorldPosition=new a;this._rotatingZoom=this._zoomingOnVector=this._strafing=this._rotating=this._looking=this._tiltCVOffMap=this._useZoomWorldPosition=!1;this._maxCoord=c.mapProjection.project(new k(Math.PI,r.PI_OVER_TWO));this._zoomFactor=5;this._rotateRateRangeAdjustment=this._rotateFactor=void 0;this._maximumRotateRate=1.77;this._minimumRotateRate=2E-4;this._minimumZoomRate=20;this._maximumZoomRate=5906376272E3;this._lastTileMouseDown=!1;this._lastTileCenter=new a;this._curTileCenter=void 0;this._lastMovement={startPosition:void 0,endPosition:void 0};this._lastRightDragPosition=void 0;this._middleMousePosition=new b;this._lastZoomMousePosition=void 0;this._doingZoomMiddleMouse=!1;this._lastRotateAngle=void 0;this._isButtonMouseRight=!1;this._lastTileMousePosition=new b;this._doingFly=!1;this.enableWheelToZoom=!0}function U(){for(var a=document.getElementsByTagName("script"),b=0,c=a.length;b<c;++b){var d=a[b].getAttribute("src"),d=qa.exec(d);if(null!==d)return d[1]}}function W(a,c){if(E.isWindows()||E.isLinux()){a.zomPosition=b.clone(c);var d=document.getElementById("FREE_MAP_MIDDLE_MOUSE_ICON_3D");if(d){d.style.visibility="visible";d.style.top=c.y-29+"px";d.style.left=c.x-29+"px";var e=document.getElementById("FREE_MAP_DIV_3D");e&&(e.style.cursor="default")}else if(d=document.createElement("div"),d.setAttribute("id","FREE_MAP_MIDDLE_MOUSE_ICON_3D"),d.style.position="absolute",e="url("+U()+"Assets/Images/center.png)",d.style.backgroundImage=e,d.style.pointerEvents="none",d.style.width="58px",d.style.height="58px",d.style.top=c.y-29+"px",d.style.left=c.x-29+"px",d.style.transform="scale(0.7, 0.7)",d.style.visibility="visible",e=document.getElementById("FREE_MAP_DIV_3D"))e.appendChild(d),e.style.cursor="default";a.clock&&(clearTimeout(a.clock),a.clock=void 0);a.clock=setTimeout(function(){d.style.visibility="hidden";a.clock=void 0},200)}}function M(c,d,e,f,g,h){if(l(e)){var k=c._aggregator;q(e)||(ua[0]=e,e=ua);var m=k.isButtonDown(K.RIGHT_DRAG)&&k.isButtonDown(K.LEFT_DRAG);c._isButtonMouseRight=!1;c._doingZoomMiddleMouse=!1;k.isButtonDown(K.RIGHT_DRAG)||(c._lastRightDragPosition=void 0,c._lastMovement.startPosition=void 0,c._lastMovement.endPosition=void 0);for(var p=e.length,t=0;t<p;++t){var w=e[t],u=l(w.eventType)?w.eventType:w,w=w.modifier,v=k.isMoving(u,w)&&k.getMovement(u,w),y=k.getStartMousePosition(u,w);u===K.MIDDLE_DRAG&&k.isButtonDown(K.MIDDLE_DRAG);if(!m&&u===K.RIGHT_DRAG&&!l(w)&&k.isButtonDown(K.RIGHT_DRAG)){c._isButtonMouseRight=!0;var z=c._scene,A=z.camera,B=A.pickEllipsoid(y);if(!l(B)&&!l(c._lastRightDragPosition))continue;!l(c._rightDownFlag)&&v&&(c._rightDownFlag=!0);if((!l(c._lastRightDragPosition)||c._lastMovement.startPosition&&!b.equals(c._lastMovement.startPosition,y))&&v){l(c._lastRightDragPosition)||(c._lastRightDragPosition=wa.clone());c._lastRotateAngle=void 0;A=A.getPickRay(y,Da);A=z.globe.pick(A,z);if(!l(A)){B.clone();c._lastRightDragPosition=void 0;continue}a.clone(A,c._lastRightDragPosition)}if(c._lastRightDragPosition&&1>a.magnitude(c._lastRightDragPosition)){c._lastRightDragPosition=void 0;continue}if(!l(c._lastRightDragPosition))continue;if(c._lastRightDragPosition)if(z=O.wgs84ToWindowCoordinates(z,c._lastRightDragPosition)){if(A=c,E.isWindows()||E.isLinux())if(A.zomPosition=b.clone(z),A=document.getElementById("FREE_MAP_MOUSE_ICON_3D")){if(A.style.visibility="visible",B="url("+U()+"Assets/Images/center.png)",A.style.backgroundImage=B,A.style.pointerEvents="none",A.style.width="58px",A.style.height="58px",A.style.top=z.y-29+"px",A.style.left=z.x-29+"px",A.style.transform="scale(0.7, 0.7)",z=document.getElementById("FREE_MAP_DIV_3D"))z.style.cursor="default"}else if(A=document.createElement("div"),A.setAttribute("id","FREE_MAP_MOUSE_ICON_3D"),A.style.position="absolute",B="url("+U()+"Assets/Images/center.png)",A.style.backgroundImage=B,A.style.pointerEvents="none",A.style.width="58px",A.style.height="58px",A.style.top=z.y-29+"px",A.style.left=z.x-29+"px",A.style.transform="scale(0.7, 0.7)",A.style.visibility="visible",z=document.getElementById("FREE_MAP_DIV_3D"))z.appendChild(A),z.style.cursor="default"}else{c._lastRightDragPosition=void 0;continue}l(c._lastMovement.startPosition)&&l(c._lastMovement.endPosition)||(c._lastMovement.startPosition=new b,c._lastMovement.endPosition=new b,b.clone(y,c._lastMovement.startPosition),b.clone(y,c._lastMovement.endPosition));b.clone(y,c._lastMovement.startPosition);v?b.clone(v.endPosition,c._lastMovement.endPosition):(v=ta,b.clone(c._lastMovement.endPosition,v.endPosition));b.clone(c._lastMovement.startPosition,v.startPosition);b.equals(v.endPosition,v.startPosition)||(z=c._lastMovement.endPosition.y-c._lastMovement.startPosition.y,v.endPosition.x=c._lastMovement.startPosition.x+1*(c._lastMovement.endPosition.x-c._lastMovement.startPosition.x)/25,v.endPosition.y=c._lastMovement.startPosition.y+1*z/25)}if((u===K.WHEEL||u===K.PINCH)&&v){if(u===K.WHEEL&&!1===c.enableWheelToZoom)return;l(c._middleMousePosition)||b.clone(b.ZERO,c._middleMousePosition);B=b.equals(y,c._middleMousePosition);B||(b.clone(y,c._middleMousePosition),c._lastZoomMousePosition=void 0);l(c._lastZoomMousePosition)||(c._lastZoomMousePosition=za,a.clone(a.ZERO,c._lastZoomMousePosition));var z=c._scene,A=z.camera,C=z.canvas;if(!B)B=A.pickEllipsoid(y),l(B)?(A=A.getPickRay(c._middleMousePosition,Da),A=z.globe.pick(A,z),l(A)&&a.clone(A,c._lastZoomMousePosition),W(c,c._middleMousePosition)):(B=C.clientWidth/2,C=C.clientHeight/2,A=A.getPickRay({x:B,y:C},Da),A=z.globe.pick(A,z),l(A)&&a.clone(A,c._lastZoomMousePosition),W(c,{x:B,y:C}));else if(l(c._lastZoomMousePosition))if(z=O.wgs84ToWindowCoordinates(z,c._lastZoomMousePosition))W(c,z);else continue;c._doingZoomMiddleMouse=!0}if(c.enableInputs&&d)if(v)m||u!==K.RIGHT_DRAG&&u!==K.WHEEL?u===K.PINCH?"_lastInertiaZoomMovement"==h?ha(c,y,v,u):"_lastInertiaTiltMovement"==h&&pa(c,y,v,!0):!0===m?pa(c,y,v,!0):f(c,y,v):f(c,y,v,u);else if(1>g)a:{v=k;A=w;B=g;w=f;y=c;C=h;z=y[C];l(z)||(z=y[C]={startPosition:new b,endPosition:new b,motion:new b,active:!1});var C=v.getButtonPressTime(u,A),G=v.getButtonReleaseTime(u,A),D=C&&G&&(G.getTime()-C.getTime())/1E3,x=new Date,x=G&&(x.getTime()-G.getTime())/1E3;if(C&&G&&.4>D){B=0>x?0:Math.exp(-(25*(1-B))*x);if(z.active)z.startPosition=b.clone(z.endPosition,z.startPosition),z.endPosition=b.multiplyByScalar(z.motion,B,z.endPosition),z.endPosition=b.add(z.startPosition,z.endPosition,z.endPosition),z.motion=b.clone(b.ZERO,z.motion);else{C=v.getLastMovement(u,A);if(!l(C)||b.equalsEpsilon(C.startPosition,C.endPosition,r.EPSILON14))break a;z.motion.x=.5*(C.endPosition.x-C.startPosition.x);z.motion.y=.5*(C.endPosition.y-C.startPosition.y);z.startPosition=b.clone(C.startPosition,z.startPosition);z.endPosition=b.multiplyByScalar(z.motion,B,z.endPosition);z.endPosition=b.add(z.startPosition,z.endPosition,z.endPosition);z.active=!0}isNaN(z.endPosition.x)||isNaN(z.endPosition.y)||.5>b.distance(z.startPosition,z.endPosition)?z.active=!1:v.isButtonDown(u,A)||(v=v.getStartMousePosition(u,A),u===K.RIGHT_DRAG||u===K.WHEEL||u===K.PINCH?w(y,v,z,u):w(y,v,z))}else z.active=!1}}z=c._scene;A=z.camera;A._adjustHeightForTerrain();if(!k.isButtonDown(K.MIDDLE_DRAG)&&!k.isButtonDown(K.RIGHT_DRAG)){if(c=document.getElementById("FREE_MAP_MOUSE_ICON_3D"))c.style.visibility="hidden";document.getElementById("FREE_MAP_DIV_3D")}}}function R(b,d,e,f,m){var p=b._ellipsoid,q=b._scene,t=q.camera,w,v=b.maximumZoomDistance;if(1>Math.abs(m-v)||m>=v)return!0;var y=e.endPosition.y-e.startPosition.y;if(0<=y||!l(b._lastRightDragPosition)&&!l(b._lastZoomMousePosition))return!0;var A=Ba;d===K.RIGHT_DRAG&&(A=a.clone(b._lastRightDragPosition,A));if(d===K.WHEEL||d===K.PINCH)A=a.clone(b._lastZoomMousePosition,A);if(!l(A)||1>a.magnitudeSquared(A))return!0;var E=D.eastNorthUpToFixedFrame(A,p,Hc),p=b._rotateFactor;m=b._rotateRateRangeAdjustment;b._globe=void 0;b._ellipsoid=h.UNIT_SPHERE;b._rotateFactor=1;b._rotateRateRangeAdjustment=1;q=new u;u.inverseTransformation(E,q);w=new a;a.clone(t.positionWC,w);var B=new a;a.clone(t.upWC,B);y=new a;a.clone(t.directionWC,y);a.clone(t.direction,fd);a.clone(t.up,Wc);a.clone(t.right,Cc);var C=new a,G=new a,x=new a,H=new a;new k;u.multiplyByPoint(q,w,C);u.multiplyByPointAsVector(q,y,x);u.multiplyByPointAsVector(q,B,G);a.cross(x,G,H);g(void 0,!1);var I=g(I,!1),q=b._scene,t=q.camera;w=q.canvas;var y=a.magnitude(t.position),F=b._rotateFactor*(y-b._rotateRateRangeAdjustment);F>b._maximumRotateRate&&(F=b._maximumRotateRate);F<b._minimumRotateRate&&(F=b._minimumRotateRate);y=e.startPosition.y-e.endPosition.y;10<y&&(y=10);-10>y&&(y=-10);e=y/w.clientHeight;e=Math.min(e,b.maximumMovementRatio);e=F*e*Math.PI;ra=a.clone(t.up,ra);Ea=a.clone(A,Ea);a.normalize(Ea,Ea);w=a.dot(ra,Ea);w=r.clamp(w,-1,1);y=Math.acos(w);y=r.toDegrees(y);w=2;if(d===K.WHEEL||d===K.PINCH)w=9;if(Math.abs(y-90)<w)return t.zoomIn(f),!1;90<y&&(e*=-1);d=new a;a.clone(t.positionWC,d);d=a.angleBetween(d,B);B=k.fromCartesian(A).height;y=k.fromCartesian(t.positionWC).height;B=Math.abs(B-y);y=a.distance(A,t.positionWC);B=r.toDegrees(Math.acos(B/y));B=Math.abs(B-90)<w?!1:!0;d<=Math.PI/2&&!1===B&&0>e&&(e=0);d>=Math.PI/2&&!1===B&&0<e&&(e=0);I||(z.fromAxisAngle(H,-e,Aa),c.fromQuaternion(Aa,Ua),c.multiplyByVector(Ua,C,C),c.multiplyByVector(Ua,x,x),c.multiplyByVector(Ua,G,G),a.cross(x,G,H),a.cross(H,x,G));u.multiplyByPoint(E,C,C);var L=a.clone(t.positionWC,L),L=a.subtract(t.positionWC,A,L),I=a.magnitude(L);if(0>=I)return!0;a.subtract(C,a.multiplyByScalar(t.direction,.03*I,new a),C);I=k.fromCartesian(C);I.height>=v&&(I.height=v,C=a.fromRadians(I.longitude,I.latitude,I.height));u.multiplyByPointAsVector(E,x,x);u.multiplyByPointAsVector(E,G,G);a.cross(x,G,H);a.cross(H,x,G);if(q.mode!==N.SCENE3D)return!0;a.clone(A,Ga);a.normalize(Ga,Ga);a.clone(t.positionWC,Ca);a.normalize(Ca,Ca);v=a.dot(Ga,Ca);A=a.angleBetween(t.positionWC,A);0<v&&1>v&&.5<r.toDegrees(A)&&5E6<t.positionCartographic.height?(d=r.acosClamped(v),v=a.cross(Ga,Ca,ya),A=Math.abs(d)>r.toRadians(20)?.75*t.positionCartographic.height:t.positionCartographic.height-f,t.rotate(v,f/A*-d),t.zoomIn(f)):(t.position=C,t.direction=x,t.up=G,t.right=H);b._rotateFactor=p;b._rotateRateRangeAdjustment=m;return!0}function Y(c,d,e,f,g,h,m,p){if(l(d)){var q=c._scene;m=q.camera;var t=q.mode;if(m){var w=e.endPosition.y-e.startPosition.y;if(0!=w){var v=q.canvas,z=Ma;z.x=v.clientWidth/2;z.y=v.clientHeight/2;v=m.pickEllipsoid(z);if(!l(v)&&(p===K.WHEEL||p===K.PINCH)&&l(c._lastRightDragPosition)){var A;if(p===K.WHEEL||p===K.PINCH)A=c._lastZoomMousePosition.clone();if(Za=A){h=k.fromCartesian(Za);m.positionCartographic&&(h.height=m.positionCartographic.height+g);Za=a.fromRadians(h.longitude,h.latitude,h.height);h={destination:Za,orientation:{heading:m.heading,pitch:-Math.PI/2,roll:0},duration:1.5};0>w&&m.flyTo(h);return}}v=1;l(h)&&(v=r.clamp(Math.abs(h),.25,1));h=c.minimumZoomDistance*v;v=c.maximumZoomDistance;f=r.clamp(f*(g-h),c._minimumZoomRate,c._maximumZoomRate);z=e.endPosition.y-e.startPosition.y;!E.isWindows()&&!E.isLinux()&&1>Math.abs(z)&&(z=0);E.isWindows()||E.isLinux()||(z*=2);z/=c._scene.canvas.clientHeight;z=Math.min(z,c.maximumMovementRatio);f*=z;if(!(0<f&&1>Math.abs(g-h)))if(0>f&&1>Math.abs(g-v)){if(l(c._lastRightDragPosition)||l(c._lastZoomMousePosition)){p===K.RIGHT_DRAG&&(A=c._lastRightDragPosition.clone());if(p===K.WHEEL||p===K.PINCH)A=c._lastZoomMousePosition.clone();Za=A;h=k.fromCartesian(Za);m.positionCartographic&&(h.height=m.positionCartographic.height);if(Za=a.fromRadians(h.longitude,h.latitude,h.height))h={destination:Za,orientation:{},duration:.6},m.flyTo(h)}}else if(g-f<h?f=g-h-1:g-f>v&&(f=g-v),!((E.isWindows()||E.isLinux()||p===K.WHEEL)&&0>w&&R(c,p,e,f,g)))if(g=cc.orientation,g.heading=m.heading,g.pitch=m.pitch,g.roll=m.roll,m.frustum instanceof y)0<Math.abs(f)&&(m.zoomIn(f),m._adjustOrthographicFrustum());else{g=b.equals(d,c._zoomMouseStart);var w=c._zoomingOnVector,v=c._rotatingZoom,B;g||(c._zoomMouseStart=b.clone(d,c._zoomMouseStart),l(c._globe)&&(B=t!==N.SCENE2D?V(c,d,Va):m.getPickRay(d,sa).origin),l(B)?(c._useZoomWorldPosition=!0,c._zoomWorldPosition=a.clone(B,c._zoomWorldPosition)):c._useZoomWorldPosition=!1,w=c._zoomingOnVector=!1,v=c._rotatingZoom=!1);if(c._useZoomWorldPosition){e=t===N.COLUMBUS_VIEW;2E6>m.positionCartographic.height&&(v=!0);if(!g||v){if(t===N.SCENE2D){var C=c._zoomWorldPosition;B=m.position;if(!a.equals(C,B)&&m.positionCartographic.height<2*c._maxCoord.x){h=m.position.x;var G=a.subtract(C,B,Ha);a.normalize(G,G);C=a.distance(C,B)*f/(.5*m.getMagnitude());m.move(G,.5*C);if(0>m.position.x&&0<h||0<m.position.x&&0>h)B=m.getPickRay(d,sa).origin,B=a.fromElements(B.y,B.z,B.x),c._zoomWorldPosition=a.clone(B,c._zoomWorldPosition)}}else if(t===N.SCENE3D)if(B=a.normalize(m.position,Qa),3E3>m.positionCartographic.height&&.6>Math.abs(a.dot(m.direction,B)))e=!0;else{d=q.canvas;v=Ma;v.x=d.clientWidth/2;v.y=d.clientHeight/2;d=V(c,v,Ia);if(l(d)&&1E6>m.positionCartographic.height){t=Sa;a.clone(m.position,t);p===K.RIGHT_DRAG&&(G=c._lastRightDragPosition.clone());if(p===K.WHEEL||p===K.PINCH)G=c._lastZoomMousePosition.clone();C=va;C=a.normalize(G,C);if(0>a.dot(C,B)){if(l(c._lastRightDragPosition)||l(c._lastZoomMousePosition)){p===K.RIGHT_DRAG&&(A=c._lastRightDragPosition.clone());if(p===K.WHEEL||p===K.PINCH)A=c._lastZoomMousePosition.clone();if(Za=A)C=Q(c,Za),C||(h=k.fromCartesian(Za),m.positionCartographic&&(h.height=m.positionCartographic.height),Za=a.fromRadians(h.longitude,h.latitude,h.height),h={destination:Za,orientation:{heading:m.heading,pitch:m.pitch,roll:0},duration:.5},m.flyTo(h))}return}C=Pa;d=Ka;a.clone(m.direction,d);a.add(t,a.multiplyByScalar(d,10,db),C);w=Wa;g=Ra;a.subtract(G,t,w);a.normalize(w,g);e=a.dot(B,g);if(0<=e){c._zoomMouseStart.x=-1;if(l(c._lastRightDragPosition)||l(c._lastZoomMousePosition)){p===K.RIGHT_DRAG&&(A=c._lastRightDragPosition.clone());if(p===K.WHEEL||p===K.PINCH)A=c._lastZoomMousePosition.clone();if(Za=A)C=Q(c,Za),C||(h=k.fromCartesian(Za),m.positionCartographic&&(h.height=m.positionCartographic.height),Za=a.fromRadians(h.longitude,h.latitude,h.height),h={destination:Za,orientation:{heading:m.heading,pitch:m.pitch,roll:0},duration:.5},m.flyTo(h))}return}A=Math.acos(-e);p=a.magnitude(t);G=a.magnitude(G);p-=f;w=a.magnitude(w);w=Math.asin(r.clamp(w/G*Math.sin(A),-1,1));G=Math.asin(r.clamp(p/G*Math.sin(A),-1,1));A=w-G+A;G=Oa;a.normalize(t,G);w=Ta;w=a.cross(g,G,w);w=a.normalize(w,w);a.normalize(a.cross(G,w,db),d);a.multiplyByScalar(a.normalize(C,db),a.magnitude(C)-f,C);a.normalize(t,t);a.multiplyByScalar(t,p,t);f=Nb;a.multiplyByScalar(a.add(a.multiplyByScalar(G,Math.cos(A)-1,tb),a.multiplyByScalar(d,Math.sin(A),Jc),db),p,f);a.add(t,f,t);a.normalize(C,G);a.normalize(a.cross(G,w,db),d);f=hb;a.multiplyByScalar(a.add(a.multiplyByScalar(G,Math.cos(A)-1,tb),a.multiplyByScalar(d,Math.sin(A),Jc),db),a.magnitude(C),f);a.add(C,f,C);a.subtract(C,t,db);if(!l(db)||0==a.magnitude(db)||Number.isNaN(db.x)||Number.isNaN(db.y)||Number.isNaN(db.z))return;a.normalize(db,m.direction);a.clone(m.direction,m.direction);a.cross(m.direction,m.up,m.right);a.cross(m.right,m.direction,m.up);p=sc;p.origin=t.clone();p.direction=a.normalize(t,db);if(q=q.globe.pick(p,q))if(q=a.distance(q,t),1>Math.abs(q-h))return;a.clone(t,m.position);m.setView(cc);l(c._lastRightDragPosition)&&(A=c._lastRightDragPosition,Za=A.clone())&&(C=Q(c,Za),C||(h=k.fromCartesian(Za),m.positionCartographic&&(h.height=m.positionCartographic.height),h.height<c.minimumZoomDistance&&(h.height=c.minimumZoomDistance),Za=a.fromRadians(h.longitude,h.latitude,h.height),h={destination:Za,orientation:{heading:m.heading,pitch:-Math.PI/2,roll:0},endTransform:u.IDENTITY,duration:1},m.flyTo(h)));return}if(l(d)){G=a.normalize(d,La);p===K.RIGHT_DRAG&&(C=a.normalize(c._lastRightDragPosition,Fa));if(p===K.WHEEL||p===K.PINCH)C=a.normalize(c._lastZoomMousePosition,Fa);h=a.dot(C,G);if(0<h&&1>h&&(h=r.acosClamped(h),G=a.cross(C,G,Ja),C=Math.abs(h)>r.toRadians(20)?.75*m.positionCartographic.height:m.positionCartographic.height-f,d=f/C,r.toDegrees(h),l(c._lastRightDragPosition)||l(c._lastZoomMousePosition))){if(p===K.RIGHT_DRAG&&!l(c._lastRightDragPosition)||(p===K.WHEEL||p===K.PINCH)&&!l(c._lastZoomMousePosition))return;p===K.RIGHT_DRAG&&(A=c._lastRightDragPosition.clone());if(p===K.WHEEL||p===K.PINCH)A=c._lastZoomMousePosition.clone();Za=A;(C=Q(c,Za))?a.equals(a.ZERO,G)||m.rotate(G,h*d):(h=k.fromCartesian(Za),m.positionCartographic&&(h.height=m.positionCartographic.height-f),Za=a.fromRadians(h.longitude,h.latitude,h.height),h={destination:Za,orientation:{heading:m.heading,roll:0},duration:2},m.flyTo(h))}}else e=!0}c._rotatingZoom=!e}if(!g&&e||w){if(!l(c._lastRightDragPosition)&&!l(c._lastZoomMousePosition)||p===K.RIGHT_DRAG&&!l(c._lastRightDragPosition)||(p===K.WHEEL||p===K.PINCH)&&!l(c._lastZoomMousePosition))return;p===K.RIGHT_DRAG&&(A=c._lastRightDragPosition.clone());if(p===K.WHEEL||p===K.PINCH)A=c._lastZoomMousePosition.clone();Za=A;q=O.wgs84ToWindowCoordinates(q,Za,xa);p=m.getPickRay(q,sa);q=p.direction;t===N.COLUMBUS_VIEW&&a.fromElements(q.y,q.z,q.x,q);m.move(q,f);c._zoomingOnVector=!0}else{p=sc;p.origin=m.position.clone();p.direction=m.direction.clone();q=q.globe.pick(p,q);if(!q)return;c=a.distance(q,m.position);c<f?m.zoomIn(c-1):m.zoomIn(f)}m.setView(cc)}else(l(c._lastRightDragPosition)||c._doingZoomMiddleMouse)&&m.zoomIn(f)}}}}}function Q(b,c){var d=b._scene.camera;if(d.frustum instanceof y)return!1;a.clone(d.position,tc);a.clone(d.direction,wc);a.clone(d.up,Xb);a.clone(c,ja.center);var d=d.frustum.computeCullingVolume(tc,wc,Xb).computeVisibility(ja)!==B.OUTSIDE?!0:!1,e=(new F(dc,tc)).isPointVisible(c);return d&&e?!0:!1}function S(c,d,e,f,g,h){var k=1;l(h)&&(k=r.clamp(Math.abs(h),.25,1));h=c.minimumZoomDistance*k;k=c.maximumZoomDistance;f=r.clamp(f*(g-h),c._minimumZoomRate,c._maximumZoomRate);e=(e.endPosition.y-e.startPosition.y)/c._scene.canvas.clientHeight;e=Math.min(e,c.maximumMovementRatio);e*=f;if(!(0<e&&1>Math.abs(g-h)||0>e&&1>Math.abs(g-k)))if(g-e<h?e=g-h-1:g-e>k&&(e=g-k),k=c._scene,g=k.camera,h=k.mode,f=cc.orientation,f.heading=g.heading,f.pitch=g.pitch,f.roll=g.roll,g.frustum instanceof y)0<Math.abs(e)&&(g.zoomIn(e),g._adjustOrthographicFrustum());else{f=b.equals(d,c._zoomMouseStart);var m=c._zoomingOnVector,p=c._rotatingZoom,q;f||(c._zoomMouseStart=b.clone(d,c._zoomMouseStart),l(c._globe)&&(h===N.SCENE2D?(q=g.getPickRay(d,sa).origin,q=a.fromElements(q.y,q.z,q.x)):q=V(c,d,Va)),l(q)?(c._useZoomWorldPosition=!0,c._zoomWorldPosition=a.clone(q,c._zoomWorldPosition)):c._useZoomWorldPosition=!1,m=c._zoomingOnVector=!1,p=c._rotatingZoom=!1);if(c._useZoomWorldPosition){var t=h===N.COLUMBUS_VIEW;2E6>g.positionCartographic.height&&(p=!0);if(!f||p){if(h===N.SCENE2D){var w=c._zoomWorldPosition,u=g.position;!a.equals(w,u)&&g.positionCartographic.height<2*c._maxCoord.x&&(q=g.position.x,p=a.subtract(w,u,Ha),a.normalize(p,p),w=a.distance(w,u)*e/(.5*g.getMagnitude()),g.move(p,.5*w),0>g.position.x&&0<q||0<g.position.x&&0>q)&&(q=g.getPickRay(d,sa).origin,q=a.fromElements(q.y,q.z,q.x),c._zoomWorldPosition=a.clone(q,c._zoomWorldPosition))}else if(h===N.SCENE3D)if(q=a.normalize(g.position,Qa),3E3>g.positionCartographic.height&&.6>Math.abs(a.dot(g.direction,q)))t=!0;else{p=k.canvas;w=Ma;w.x=p.clientWidth/2;w.y=p.clientHeight/2;p=V(c,w,Ia);if(l(p)&&1E6>g.positionCartographic.height){d=Sa;a.clone(g.position,d);p=c._zoomWorldPosition;h=va;h=a.normalize(p,h);if(0>a.dot(h,q))return;h=Pa;k=Ka;a.clone(g.direction,k);a.add(d,a.multiplyByScalar(k,1E3,db),h);m=Wa;f=Ra;a.subtract(p,d,m);a.normalize(m,f);t=a.dot(q,f);if(0<=t){c._zoomMouseStart.x=-1;return}t=Math.acos(-t);c=a.magnitude(d);q=a.magnitude(p);c-=e;m=a.magnitude(m);m=Math.asin(r.clamp(m/q*Math.sin(t),-1,1));q=Math.asin(r.clamp(c/q*Math.sin(t),-1,1));m=m-q+t;t=Oa;a.normalize(d,t);q=Ta;q=a.cross(f,t,q);q=a.normalize(q,q);a.normalize(a.cross(t,q,db),k);a.multiplyByScalar(a.normalize(h,db),a.magnitude(h)-e,h);a.normalize(d,d);a.multiplyByScalar(d,c,d);e=Nb;a.multiplyByScalar(a.add(a.multiplyByScalar(t,Math.cos(m)-1,tb),a.multiplyByScalar(k,Math.sin(m),Jc),db),c,e);a.add(d,e,d);a.normalize(h,t);a.normalize(a.cross(t,q,db),k);e=hb;a.multiplyByScalar(a.add(a.multiplyByScalar(t,Math.cos(m)-1,tb),a.multiplyByScalar(k,Math.sin(m),Jc),db),a.magnitude(h),e);a.add(h,e,h);a.clone(d,g.position);a.normalize(a.subtract(h,d,db),g.direction);a.clone(g.direction,g.direction);a.cross(g.direction,g.up,g.right);a.cross(g.right,g.direction,g.up);g.setView(cc);return}l(p)?(p=a.normalize(p,La),w=a.normalize(c._zoomWorldPosition,Fa),q=a.dot(w,p),0<q&&1>q&&(q=r.acosClamped(q),p=a.cross(w,p,Ja),w=Math.abs(q)>r.toRadians(20)?.75*g.positionCartographic.height:g.positionCartographic.height-e,g.rotate(p,e/w*q))):t=!0}c._rotatingZoom=!t}!f&&t||m?(k=O.wgs84ToWindowCoordinates(k,c._zoomWorldPosition,xa),d=(h!==N.COLUMBUS_VIEW&&b.equals(d,c._zoomMouseStart)&&l(k)?g.getPickRay(k,sa):g.getPickRay(d,sa)).direction,h!==N.COLUMBUS_VIEW&&h!==N.SCENE2D||a.fromElements(d.y,d.z,d.x,d),g.move(d,e),c._zoomingOnVector=!0):g.zoomIn(e);g.setView(cc)}else g.zoomIn(e)}}function ca(b,c,d){b=b._scene.camera;c=b.getPickRay(d.startPosition,uc).origin;d=b.getPickRay(d.endPosition,ec).origin;c=a.fromElements(c.y,c.z,c.x,c);d=a.fromElements(d.y,d.z,d.x,d);d=a.subtract(c,d,pb);c=a.magnitude(d);0<c&&(a.normalize(d,d),b.move(d,c))}function T(a,b,c){l(c.distance)&&(c=c.distance);S(a,b,c,a._zoomFactor,a._scene.camera.getMagnitude())}function da(a,c,d){if(l(d.angleAndHeight)){var e=d.angleAndHeight;d=a._rotateFactor*a._rotateRateRangeAdjustment;d>a._maximumRotateRate&&(d=a._maximumRotateRate);d<a._minimumRotateRate&&(d=a._minimumRotateRate);var f=a._scene;c=f.camera;e=(e.endPosition.x-e.startPosition.x)/f.canvas.clientWidth;e=Math.min(e,a.maximumMovementRatio);c.twistRight(d*e*Math.PI*4)}else{c=a._scene;a=c.camera;c=c.canvas;var e=c.clientWidth,g=c.clientHeight,f=Dc;f.x=2/e*d.startPosition.x-1;f.y=2/g*(g-d.startPosition.y)-1;f=b.normalize(f,f);c=fc;c.x=2/e*d.endPosition.x-1;c.y=2/g*(g-d.endPosition.y)-1;c=b.normalize(c,c);d=r.acosClamped(f.x);0>f.y&&(d=r.TWO_PI-d);e=r.acosClamped(c.x);0>c.y&&(e=r.TWO_PI-e);a.twistRight(e-d)}}function V(b,c,e){var f=b._scene,g=b._globe;b=f.camera;if(l(g)){var h,k;f.pickPositionSupported&&(h=f.pickPositionWorldCoordinates(c,Vc));var m=b.getPickRay(c,xd);c=g.pickWorldCoordinates(m,f,xc);1==f.undergroundMode&&l(f.underEllipsoid)&&(f=d.rayEllipsoid(m,f.underEllipsoid),l(f)&&(f=f.start,l(f)&&0<f&&(k=x.getPoint(m,f))));f=l(h)?a.distance(h,b.positionWC):Number.POSITIVE_INFINITY;m=l(c)?a.distance(c,b.positionWC):Number.POSITIVE_INFINITY;b=l(k)?a.distance(k,b.positionWC):Number.POSITIVE_INFINITY;return m>f?b>f?a.clone(h,e):a.clone(k,e):b>m?a.clone(c,e):a.clone(k,e)}}function ba(c,e,f){a.equals(e,c._translateMousePosition)||(c._looking=!1);a.equals(e,c._strafeMousePosition)||(c._strafing=!1);if(c._looking)oa(c,e,f);else if(c._strafing)ga(c,e,f);else{var g=c._scene.camera,h=b.clone(f.startPosition,Mc),k=b.clone(f.endPosition,Yb);g.getPickRay(h,Kc);var m=a.clone(a.ZERO,Pc),p=a.UNIT_X,q;g.position.z<c._minimumPickingTerrainHeight&&(q=V(c,h,Oc),l(q)&&(m.x=q.x));m.x>g.position.z&&l(q)?(a.clone(q,c._strafeStartPosition),c._strafing=!0,ga(c,e,f),c._strafeMousePosition=b.clone(e,c._strafeMousePosition)):(m=A.fromPointNormal(m,p,bd),h=g.getPickRay(h,Kc),h=d.rayPlane(h,m,Oc),k=g.getPickRay(k,Lc),k=d.rayPlane(k,m,ed),l(h)&&l(k)?(c=a.subtract(h,k,Rc),e=c.x,c.x=c.y,c.y=c.z,c.z=e,e=a.magnitude(c),e>r.EPSILON6&&(a.normalize(c,c),g.move(c,e))):(c._looking=!0,oa(c,e,f),b.clone(e,c._translateMousePosition)))}}function X(e,f,g){l(g.angleAndHeight)&&(g=g.angleAndHeight);b.equals(f,e._tiltCenterMousePosition)||(e._tiltCVOffMap=!1,e._looking=!1);if(e._looking)oa(e,f,g);else{var k=e._scene.camera,m=e._maxCoord,m=0>Math.abs(k.position.x)-m.x&&0>Math.abs(k.position.y)-m.y;if(e._tiltCVOffMap||!m||k.position.z>e._minimumPickingTerrainHeight){e._tiltCVOffMap=!0;var p=e._scene,k=p.camera,q=p.canvas,m=Sc;m.x=q.clientWidth/2;m.y=q.clientHeight/2;var t=k.getPickRay(m,ab),m=a.UNIT_X,q=t.origin,t=t.direction,w,v=a.dot(m,t);Math.abs(v)>r.EPSILON6&&(w=-a.dot(m,q)/v);!l(w)||0>=w?(e._looking=!0,oa(e,f,g),b.clone(f,e._tiltCenterMousePosition)):(w=a.multiplyByScalar(t,w,Ab),a.add(q,w,w),q=p.mapProjection,p=q.ellipsoid,a.fromElements(w.y,w.z,w.x,w),q=q.unproject(w,ib),p.cartographicToCartesian(q,w),p=D.eastNorthUpToFixedFrame(w,p,yc),w=e._globe,q=e._ellipsoid,e._globe=void 0,e._ellipsoid=h.UNIT_SPHERE,e._rotateFactor=1,e._rotateRateRangeAdjustment=1,m=u.clone(k.transform,zc),k._setTransform(p),na(e,f,g,a.UNIT_Z),k._setTransform(m),e._globe=w,e._ellipsoid=q,f=q.maximumRadius,e._rotateFactor=1/f,e._rotateRateRangeAdjustment=f)}else a:{k=g;m=e._scene;g=m.camera;w=a.UNIT_X;if(b.equals(f,e._tiltCenterMousePosition))p=a.clone(e._tiltCenter,Ab);else{g.position.z<e._minimumPickingTerrainHeight&&(p=V(e,f,Ab));if(!l(p)){t=g.getPickRay(f,ab);v=t.origin;p=t.direction;t=a.dot(w,p);Math.abs(t)>r.EPSILON6&&(q=-a.dot(w,v)/t);if(!l(q)||0>=q){e._looking=!0;oa(e,f,k);b.clone(f,e._tiltCenterMousePosition);break a}p=a.multiplyByScalar(p,q,Ab);a.add(v,p,p)}b.clone(f,e._tiltCenterMousePosition);a.clone(p,e._tiltCenter)}q=Sc;q.x=m.canvas.clientWidth/2;q.y=e._tiltCenterMousePosition.y;t=g.getPickRay(q,ab);q=a.clone(a.ZERO,vc);q.x=p.x;w=A.fromPointNormal(q,w,ma);w=d.rayPlane(t,w,qb);m=g._projection;t=m.ellipsoid;a.fromElements(p.y,p.z,p.x,p);v=m.unproject(p,ib);t.cartographicToCartesian(v,p);q=D.eastNorthUpToFixedFrame(p,t,yc);l(w)?(a.fromElements(w.y,w.z,w.x,w),v=m.unproject(w,ib),t.cartographicToCartesian(v,w),w=D.eastNorthUpToFixedFrame(w,t,vb)):w=q;m=e._globe;t=e._ellipsoid;e._globe=void 0;e._ellipsoid=h.UNIT_SPHERE;e._rotateFactor=1;e._rotateRateRangeAdjustment=1;v=a.UNIT_Z;p=u.clone(g.transform,zc);g._setTransform(q);q=a.cross(a.UNIT_Z,a.normalize(g.position,Ib),Ib);q=a.dot(g.right,q);na(e,f,k,v,!1,!0);g._setTransform(w);0>q?(k.startPosition.y>k.endPosition.y&&(v=void 0),q=g.constrainedAxis,g.constrainedAxis=void 0,na(e,f,k,v,!0,!1),g.constrainedAxis=q):na(e,f,k,v,!0,!1);l(g.constrainedAxis)&&(f=a.cross(g.direction,g.constrainedAxis,nc),a.equalsEpsilon(f,a.ZERO,r.EPSILON6)||(0>a.dot(f,g.right)&&a.negate(f,f),a.cross(f,g.direction,g.up),a.cross(g.direction,g.up,g.right),a.normalize(g.up,g.up),a.normalize(g.right,g.right)));g._setTransform(p);e._globe=m;e._ellipsoid=t;f=t.maximumRadius;e._rotateFactor=1/f;e._rotateRateRangeAdjustment=f;e=a.clone(g.positionWC,Ib);g._adjustHeightForTerrain();a.equals(g.positionWC,e)||(g._setTransform(w),g.worldToCameraCoordinatesPoint(e,e),f=a.magnitudeSquared(e),a.magnitudeSquared(g.position)>f&&(a.normalize(g.position,g.position),a.multiplyByScalar(g.position,Math.sqrt(f),g.position)),f=a.angleBetween(e,g.position),e=a.cross(e,g.position,e),a.normalize(e,e),e=z.fromAxisAngle(e,f,Bc),e=c.fromQuaternion(e,Ec),c.multiplyByVector(e,g.direction,g.direction),c.multiplyByVector(e,g.up,g.up),a.cross(g.direction,g.up,g.right),a.cross(g.right,g.direction,g.up),g._setTransform(p))}}}function fa(b,c,d){l(d.distance)&&(d=d.distance);var e=b._scene,f=e.camera,e=e.canvas,g=gc;g.x=e.clientWidth/2;g.y=e.clientHeight/2;var e=f.getPickRay(g,hc),h;f.position.z<b._minimumPickingTerrainHeight&&(h=V(b,g,Fc));l(h)?f=a.distance(e.origin,h):(f=a.UNIT_X,h=e.direction,f=-a.dot(f,e.origin)/a.dot(f,h));S(b,c,d,b._zoomFactor,f)}function ga(b,c,d){var e=b._scene;c=e.camera;var f=V(b,d.startPosition,Gc);if(l(f)){c.getPickRay(d.endPosition,mb);var g=a.clone(c.direction,Zb);e.mode===N.COLUMBUS_VIEW&&a.fromElements(g.z,g.x,g.y,g);A.fromPointNormal(f,g,gb);d=V(b,d.endPosition,Na);l(d)&&(g=a.subtract(f,d,g),e.mode===N.COLUMBUS_VIEW&&a.fromElements(g.y,g.z,g.x,g),a.add(c.position,g,Na),d=ia(b,Na,0),9E3<=d||(b=k.fromCartesian(Na).height,0<d&&b<d?(a.normalize(Na,Na),a.negate(Na,Na),d=new x(c.position,Na),e=e.globe.pick(d,e),l(e)&&k.fromCartesian(e).height+.5<b&&a.add(c.position,g,c.position)):a.add(c.position,g,c.position)))}}function ka(c,d,e){var f=c._scene,k=f.camera;if(u.equals(k.transform,u.IDENTITY)){var m,p=c._ellipsoid.geodeticSurfaceNormal(k.position,wb),q=c._ellipsoid.cartesianToCartographic(k.positionWC,lb).height,r=c._globe,t;if(l(r)&&q<c._minimumPickingTerrainHeight){var w=k.getPickRay(e.startPosition);t=r.pick(w,f);if(l(t)&&(w=k.pickEllipsoid(d),!l(w)&&(f=f.pick(d),!l(f))))return;l(t)&&(w=k.getPickRay(e.startPosition,xd),f=c._ellipsoid.geodeticSurfaceNormal(t),(f=.05>Math.abs(a.dot(w.direction,f)))&&!c._looking&&(c._rotating=!1,c._strafing=!0))}b.equals(d,c._rotateMousePosition)?c._looking?oa(c,d,e,p):c._rotating?k.pickEllipsoid(e.startPosition)?la(c,d,e,m):k.direction&&(m=k.direction.clone(),g(void 0,!1),g(void 0,!1),t=c._scene,d=t.camera,k=t.canvas,t=d.constrainedAxis,l(m)&&(d.constrainedAxis=m),m=a.magnitude(d.position),m=c._rotateFactor*(m-c._rotateRateRangeAdjustment),m>c._maximumRotateRate&&(m=c._maximumRotateRate),m<c._minimumRotateRate&&(m=c._minimumRotateRate),p=(e.startPosition.x-e.endPosition.x)/k.clientWidth,e=(e.startPosition.y-e.endPosition.y)/k.clientHeight,p=Math.min(p,c.maximumMovementRatio),e=Math.min(e,c.maximumMovementRatio),d.rotateRight(m*p*Math.PI*2+m*e*Math.PI),d.constrainedAxis=t):c._strafing?(a.clone(t,c._strafeStartPosition),ga(c,d,e)):(k=a.magnitude(c._rotateStartPosition),m=nb,m.x=m.y=m.z=k,m=h.fromCartesian3(m,Cb),xb=d.clone(),V(c,xb,rb)&&la(c,d,e,m)):(c._looking=!1,c._rotating=!1,c._strafing=!1,l(r)&&q<c._minimumPickingTerrainHeight?l(t)?a.magnitude(k.position)<a.magnitude(t)?(a.clone(t,c._strafeStartPosition),c._strafing=!0,ga(c,d,e)):(k=a.magnitude(t),m=nb,m.x=m.y=m.z=k,m=h.fromCartesian3(m,Cb),la(c,d,e,m),a.clone(t,c._rotateStartPosition)):(c._looking=!0,oa(c,d,e,p)):l(k.pickEllipsoid(e.startPosition,c._ellipsoid,Ob))?(la(c,d,e,c._ellipsoid),a.clone(Ob,c._rotateStartPosition)):q>c._minimumTrackBallHeight?(c._rotating=!0,na(c,d,e)):(c._looking=!0,oa(c,d,e,p)),b.clone(d,c._rotateMousePosition))}else na(c,d,e)}function na(b,c,d,e,f,h){f=g(f,!1);h=g(h,!1);var k=b._scene;c=k.camera;var m=k.canvas,k=c.constrainedAxis;l(e)&&(c.constrainedAxis=e);e=a.magnitude(c.position);e=b._rotateFactor*(e-b._rotateRateRangeAdjustment);e>b._maximumRotateRate&&(e=b._maximumRotateRate);e<b._minimumRotateRate&&(e=b._minimumRotateRate);var p=(d.startPosition.x-d.endPosition.x)/m.clientWidth;d=(d.startPosition.y-d.endPosition.y)/m.clientHeight;p=Math.min(p,b.maximumMovementRatio);d=Math.min(d,b.maximumMovementRatio);b=e*p*Math.PI*2;d=e*d*Math.PI;f||c.rotateRight(b);h||c.rotateUp(d);c.constrainedAxis=k}function ia(a,b,c){a=a._scene;var d=a.camera,e=a.globe;if(!l(e)||a.globe.terrainProvider instanceof H)return-1;b=l(b)?k.fromCartesian(b):k.fromCartesian(d.positionWC);a=b.height;if(9002<=a)return-1;var d=e._surface._tilesToRender,f=Math.max(d.length,4),g=e._surface._tileLoadQueueHigh,h=e._surface._tileLoadQueueLow,e=e._surface._tileLoadQueueMedium,m=g.length,p=h.length,q=e.length,r=0,t;for(t=0;t<m;++t){var w=g[t],u=w._distance;if(!(u>a)&&(u=w.data.mesh,w=w.rectangle,l(u)&&(w=G.contains(w,b),r=Math.max(r,u.maximumHeight),w)))return r}for(t=0;t<q;++t)if(w=e[t],u=w._distance,!(u>a)&&(u=w.data.mesh,w=w.rectangle,l(u)&&(w=G.contains(w,b),r=Math.max(r,u.maximumHeight),w)))return r;for(t=0;t<p;++t)if(w=h[t],u=w._distance,!(u>a)&&(u=w.data.mesh,w=w.rectangle,l(u)&&(w=G.contains(w,b),r=Math.max(r,u.maximumHeight),w)))return r;for(t=0;t<f;++t)if(w=d[t],l(w)&&(u=w.data.mesh,w=w.rectangle,l(u)&&(w=G.contains(w,b),r=Math.max(r,u.maximumHeight),w)))return r;r=Math.min(r,9E3);1===c&&0>=r&&(r=9E3);0===c&&(r=9E3);return r}function la(d,e,f,g){var h=d._scene;g=h.camera;var m=b.clone(f.startPosition,Tc),p=b.clone(f.endPosition,Db),m=V(d,m,yb),p=V(d,p,oc);if(l(m)&&l(p)){if(cb.x=m.x,cb.y=m.y,cb.z=m.z,Ya.x=p.x,Ya.y=p.y,Ya.z=p.z,m=g.worldToCameraCoordinates(m,m),p=g.worldToCameraCoordinates(p,p),l(m)&&l(p)&&!isNaN(a.magnitude(m))&&!isNaN(a.magnitude(p))&&0!=a.magnitude(m)&&0!=a.magnitude(p))if(l(g.constrainedAxis)){d=g.constrainedAxis;var q=a.mostOrthogonalAxis(d,sb);a.cross(q,d,q);a.normalize(q,q);f=a.cross(d,q,Sb);h=a.magnitude(m);e=a.dot(d,m);var h=Math.acos(e/h),t=a.multiplyByScalar(d,e,Pb);a.subtract(m,t,t);a.normalize(t,t);e=a.magnitude(p);var w=a.dot(d,p);e=Math.acos(w/e);w=a.multiplyByScalar(d,w,$b);a.subtract(p,w,w);a.normalize(w,w);var u=Math.acos(a.dot(t,q));0>a.dot(t,f)&&(u=r.TWO_PI-u);q=Math.acos(a.dot(w,q));0>a.dot(w,f)&&(q=r.TWO_PI-q);f=u-q;q=a.equalsEpsilon(d,g.position,r.EPSILON2)?g.right:a.cross(d,g.position,sb);q=a.cross(d,q,sb);m=a.dot(q,a.subtract(m,d,Sb));p=a.dot(q,a.subtract(p,d,Sb));m=0<m&&0<p?e-h:0<m&&0>=p?0<a.dot(g.position,d)?-h-e:h+e:h-e;g.rotateRight(f);g.rotateUp(m)}else a.normalize(m,m),a.normalize(p,p),e=a.dot(m,p),m=a.cross(m,p,sb),1>e&&!a.equalsEpsilon(m,a.ZERO,r.EPSILON14)&&(p=Math.acos(e),e=z.fromAxisAngle(m,-p,ea),e=c.fromQuaternion(e,Qb),c.multiplyByVector(e,g.position,bb),f=ia(d,bb,0),e=k.fromCartesian(g.position).height,0<f&&9E3>f?(a.clone(bb,eb),a.normalize(eb,eb),a.negate(eb,eb),f=new x(bb,eb),h=h.globe.pick(f,h),l(h)?(k.fromCartesian(h).height>e&&(f=k.fromCartesian(h).height+.5,d=d._ellipsoid.cartesianToCartographic(g.position,Eb),d=a.fromRadians(d.longitude,d.latitude,f),a.clone(d,g.position)),g.rotate(m,p)):(m=a.distance(cb,Ya),a.subtract(Ya,cb,Ya),l(Ya)&&0<a.magnitude(Ya)&&(a.normalize(Ya,Ya),g.move(Ya,-m)))):g.rotate(m,p))}else d._rotating=!0,na(d,e,f)}function ha(b,c,d,e){l(d.distance)&&(d=d.distance);if(e!==K.WHEEL||!1!==b.enableWheelToZoom){var f=b._ellipsoid,g=b._scene,h=g.camera;if((l(b._lastRightDragPosition)||l(b._lastZoomMousePosition))&&!(e===K.RIGHT_DRAG&&!l(b._lastRightDragPosition)||l(b._lastRightDragPosition)&&1>a.magnitude(b._lastRightDragPosition)||!(e!==K.WHEEL&&e!==K.PINCH||l(b._lastZoomMousePosition))||(e===K.WHEEL||e===K.PINCH)&&l(b._lastZoomMousePosition)&&1>a.magnitude(b._lastZoomMousePosition))){var k=gc;k.x=c.x;k.y=c.y;if((e===K.WHEEL||e===K.PINCH)&&l(b._lastZoomMousePosition)){var m=O.wgs84ToWindowCoordinates(g,b._lastZoomMousePosition);if(m)k.x=c.x,k.y=c.y;else{bc=b._lastZoomMousePosition.clone();h.flyTo({destination:bc,duration:.01});return}}h.getPickRay(k,hc);m=h.pickEllipsoid(k);if(l(m)||l(b._lastRightDragPosition)||!b._isButtonMouseRight){var p,m=f.cartesianToCartographic(h.position,mc).height;l(b._lastRightDragPosition)?p=V(b,k,Fc):m<b._minimumPickingTerrainHeight&&(p=V(b,k,Fc));l(p)?(f=a.distance(h.position,p),l(b._lastRightDragPosition)&&(m=a.distance(h.position,b._lastRightDragPosition),f=Math.min(m,f))):f=m;c=a.normalize(h.position,qc);l(b._lastRightDragPosition)?(m=O.wgs84ToWindowCoordinates(g,b._lastRightDragPosition),Y(b,m,d,b._zoomFactor,f,a.dot(c,h.direction),p,e)):Y(b,k,d,b._zoomFactor,f,a.dot(c,h.direction),p,e)}}}}function pa(e,f,m,p){var q=e._scene.camera;if(u.equals(q.transform,u.IDENTITY))if(l(m.angleAndHeight)&&(m=m.angleAndHeight),b.equals(f,e._tiltCenterMousePosition)||(e._tiltOnEllipsoid=!1,e._looking=!1),e._looking){var t=e._ellipsoid.geodeticSurfaceNormal(q.position,Bb);oa(e,f,m,t)}else{e._ellipsoid.cartesianToCartographic(q.position,Ge);var q=e._scene,w=q.camera,v=e._ellipsoid,y=V(e,f,kd);e._isPickEarth=!0;l(y)?a.equals(e._lastTileMousePosition,f)||(e._lastTileMousePosition=f.clone(),l(e._curTileCenter)||(e._curTileCenter=new a),w=w.pickEllipsoid(f,v,ld),l(w)?(a.clone(y,e._lastTileCenter),a.clone(y,e._curTileCenter)):(f=q.pick(f),l(f)?(a.clone(y,e._lastTileCenter),a.clone(y,e._curTileCenter)):a.clone(e._lastTileCenter,e._curTileCenter))):(a.clone(e._lastTileCenter,e._curTileCenter),a.equals(e._lastTileMousePosition,f)||(e._lastTileMousePosition=f.clone()),e._isPickEarth=!0);if(l(e._curTileCenter)&&(f=O.wgs84ToWindowCoordinates(q,e._curTileCenter),q=Q(e,e._curTileCenter),l(f)&&q&&(E.isWindows()||E.isLinux())))if(e.zomPosition=b.clone(f),q=document.getElementById("FREE_MAP_MOUSE_ICON_3D")){if(q.style.visibility="visible",q.style.top=f.y-16+"px",q.style.left=f.x-16+"px",y="url("+U()+"Assets/Images/tilt.png)",q.style.backgroundImage=y,q.style.pointerEvents="none",q.style.width="32px",q.style.height="32px",q.style.top=f.y-16+"px",q.style.left=f.x-16+"px",q.style.transform="scale(1.0, 1.0)",f=document.getElementById("FREE_MAP_DIV_3D"))f.style.cursor="none"}else if(q=document.createElement("div"),q.setAttribute("id","FREE_MAP_MOUSE_ICON_3D"),q.style.position="absolute",y="url("+U()+"Assets/Images/tilt.png)",q.style.backgroundImage=y,q.style.pointerEvents="none",q.style.width="32px",q.style.height="32px",q.style.top=f.y-16+"px",q.style.left=f.x-16+"px",q.style.cursor="none",q.style.visibility="visible",f=document.getElementById("FREE_MAP_DIV_3D"))f.appendChild(q),f.style.cursor="none";var A=m,B=e._ellipsoid,C=e._scene;m=C.camera;if(e._isPickEarth&&l(e._curTileCenter)&&!(1>a.magnitudeSquared(e._curTileCenter))){f=D.eastNorthUpToFixedFrame(e._curTileCenter,B,Hc);q=e._rotateFactor;y=e._rotateRateRangeAdjustment;e._globe=void 0;e._ellipsoid=h.UNIT_SPHERE;e._rotateFactor=1;e._rotateRateRangeAdjustment=1;C=new u;u.inverseTransformation(f,C);var G=new a;a.clone(m.positionWC,G);var H=new a;a.clone(m.upWC,H);var I=new a;a.clone(m.directionWC,I);a.clone(m.direction,fd);a.clone(m.up,Wc);a.clone(m.right,Cc);var w=new a,v=new a,F=new a,K=new a;new k;u.multiplyByPoint(C,G,w);u.multiplyByPointAsVector(C,I,F);u.multiplyByPointAsVector(C,H,v);a.cross(F,v,K);var L=g(L,!1),t=g(t,!1),C=e._scene;m=C.camera;I=C.canvas;G=a.magnitude(m.position);G=e._rotateFactor*(G-e._rotateRateRangeAdjustment);G>e._maximumRotateRate&&(G=e._maximumRotateRate);G<e._minimumRotateRate&&(G=e._minimumRotateRate);var J=A.startPosition.x-A.endPosition.x,P=A.startPosition.y-A.endPosition.y;p&&(E.isWindows()||E.isLinux()?(J*=.7,P*=.7):(J*=.3,P*=.5));20<J&&(J=20);-20>J&&(J=-20);20<P&&(P=20);-20>P&&(P=-20);p=J/I.clientWidth;P/=I.clientHeight;p=Math.min(p,e.maximumMovementRatio);P=Math.min(P,e.maximumMovementRatio);I=G*p*Math.PI*2;G=G*P*Math.PI;p=new a;a.clone(m.positionWC,p);H=a.angleBetween(p,H);a.normalize(p,p);a.negate(p,p);var P=new x(m.positionWC,p),J=k.fromCartesian(e._curTileCenter).height,M=k.fromCartesian(m.positionWC).height,J=Math.abs(J-M),M=a.distance(e._curTileCenter,m.positionWC),J=r.toDegrees(Math.acos(J/M));ia(e,m.positionWC,0);C.globe.getHeight(m.positionCartographic);k.fromCartesian(m.positionWC);J=3>Math.abs(J-90)?!1:!0;H<=Math.PI/2&&!1===J&&0>G&&(G=0);H>=Math.PI/2&&!1===J&&0<G&&(G=0);J=V(e,A.endPosition,qd);J||(B=d.rayEllipsoid(P,B))&&(J=x.getPoint(P,B.start));J&&(B=a.distance(m.position,J),1>=B&&0>G&&H<Math.PI/2&&(t=!0),1>=B&&0<G&&H>Math.PI/2&&(t=!0),L||(B=I,L=new z,z.fromAxisAngle(a.UNIT_Z,B,L),B=new c,c.fromQuaternion(L,B),c.multiplyByVector(B,w,w),c.multiplyByVector(B,F,F),c.multiplyByVector(B,v,v),a.cross(F,v,K),a.cross(K,F,v)),t||(B=G,L=new z,z.fromAxisAngle(K,-B,L),B=new c,c.fromQuaternion(L,B),c.multiplyByVector(B,w,w),c.multiplyByVector(B,F,F),c.multiplyByVector(B,v,v),a.cross(F,v,K),a.cross(K,F,v)),u.multiplyByPoint(f,w,w),L=k.fromCartesian(w),t=C.globe.getHeight(L),B=ia(e,w,1),G=k.fromCartesian(w).height,9E3<=B||(a.clone(w,p),a.normalize(p,p),a.negate(p,p),new x(w,p),J=V(e,A.endPosition,gd),l(J)&&(B=k.fromCartesian(J).height,k.fromCartesian(J).height>G&&(B+=.2,A=e._ellipsoid.cartesianToCartographic(m.position,Eb),A=a.fromRadians(A.longitude,A.latitude,B),a.clone(A,w))),L.height+.1<t||(u.multiplyByPointAsVector(f,F,F),u.multiplyByPointAsVector(f,v,v),a.cross(F,v,K),a.cross(K,F,v),C.mode===N.SCENE3D&&(m.position=w,m.direction=F,m.up=v,m.right=K,e._rotateFactor=q,e._rotateRateRangeAdjustment=y))))}}}function oa(b,c,d,e){var f=b._scene.camera;c=f.pickEllipsoid(c);if(l(c)){var h=Qc;h.x=d.startPosition.x;h.y=0;var k=Xc;k.x=d.endPosition.x;k.y=0;var m=f.getPickRay(h,cd),p=f.getPickRay(k,Yc);c=0;f.frustum instanceof y?(m=m.origin,p=p.origin,a.add(f.direction,m,m),a.add(f.direction,p,p),a.subtract(m,f.position,m),a.subtract(p,f.position,p),a.normalize(m,m),a.normalize(p,p)):(m=m.direction,p=p.direction);p=a.dot(m,p);1>p&&(c=Math.acos(p));c=d.startPosition.x>d.endPosition.x?-c:c;b=b._horizontalRotationAxis;l(e)?f.look(e,-c):l(b)?f.look(b,-c):f.lookLeft(c);h.x=0;h.y=d.startPosition.y;k.x=0;k.y=d.endPosition.y;m=f.getPickRay(h,cd);p=f.getPickRay(k,Yc);c=0;f.frustum instanceof y?(m=m.origin,p=p.origin,a.add(f.direction,m,m),a.add(f.direction,p,p),a.subtract(m,f.position,m),a.subtract(p,f.position,p),a.normalize(m,m),a.normalize(p,p)):(m=m.direction,p=p.direction);p=a.dot(m,p);1>p&&(c=Math.acos(p));c=d.startPosition.y>d.endPosition.y?-c:c;e=g(e,b);l(e)?(d=f.direction,b=a.negate(e,Bd),h=a.equalsEpsilon(d,e,r.EPSILON2),k=a.equalsEpsilon(d,b,r.EPSILON2),h||k?(h&&0>c||k&&0<c)&&f.look(f.right,-c):(p=a.dot(d,e),h=r.acosClamped(p),0<c&&c>h&&(c=h-r.EPSILON4),p=a.dot(d,b),h=r.acosClamped(p),0>c&&-c>h&&(c=-h+r.EPSILON4),e=a.cross(e,d,md),f.look(e,c))):f.lookUp(c)}}var qa=/((?:.*\/)|^)cesium[\w-]*\.js(?:\W|$)/i,ua=[],ta={startPosition:new b,endPosition:new b};new a;new a;var wa=new a,za=new a;new b;var Da=new x;new x;new a;var Ba=new a;new a;var ra=new a,Ea=new a;new u;new u;var Ga=new a,Ca=new a,ya=new a,Aa=new z,Ua=new c,sa=new x,Va=new a,xa=new b,Ha=new a,Ma=new b,Ia=new a,La=new a,Fa=new a,Ja=new a,Qa=new a,va=new a,Sa=new a,Oa=new a,Ta=new a,Ka=new a,Wa=new a,Ra=new a,Nb=new a,hb=new a,Pa=new a,db=new a,tb=new a,Jc=new a,cc={orientation:new p};new v(a.ZERO,1);var sc=new x;new a;var Za=new a,tc=new a,wc=new a,Xb=new a,dc=new h(6378137,6378137,6356752.314245179),ja=new v(a.ZERO,1),uc=new x,ec=new x,pb=new a,Dc=new b,fc=new b,xd=new x,Vc=new a,xc=new a,Kc=new x,Lc=new x,Oc=new a,ed=new a,Rc=new a,Pc=new a,bd=new A(a.UNIT_X,0),Mc=new b,Yb=new b,Sc=new b,ab=new x,Ab=new a,qb=new a,yc=new u,vb=new u,vc=new a,ma=new A(a.UNIT_X,0),Ib=new a,ib=new k,zc=new u,Bc=new z,Ec=new c,nc=new a,gc=new b,hc=new x,Fc=new a,mb=new x,gb=new A(a.UNIT_X,0);new a;var Zb=new a,Gc=new a,Na=new a;new a;var Ob=new a,lb=new k,nb=new a,Cb=new h,wb=new a,xb=new b,rb=new a,yb=f.clone(f.UNIT_W),oc=f.clone(f.UNIT_W),sb=new a,Sb=new a,Pb=new a,$b=new a,Tc=new b,Db=new b;new k;var Eb=new k,eb=new a,ea=new z,Qb=new c,bb=new a,cb=new a,Ya=new a,Fb={startPosition:new b(0,0),endPosition:new b(0,26.17993877991494)},Ac=new x;I.prototype.touchZoom=function(b){var c=this._scene,d=c.camera;if(c.mode===N.SCENE2D)T(this,b,Fb);else if(c.mode===N.COLUMBUS_VIEW)fa(this,b,Fb);else{var e=d.pickEllipsoid(b);l(e)&&(d=d.getPickRay(b,Ac),c=c.globe.pick(d,c),l(c)&&(this._lastZoomMousePosition=a.clone(c,this._lastZoomMousePosition),ha(this,b,Fb,K.WHEEL)))}};var Xa=new f(1,0,0,1),pc=new f(0,1,0,1),ic=new f,ob=new f,Kb=new a,Rb=new a,ub=new a,jc=new a,jb=new a,Jb=new a,Gb=new a,kb=new a,Lb=new a,kc=new a,Vb=new a,Tb=new a,fb=new a,zb=new a,Mb=new a,$a={startPosition:new b(0,0),endPosition:new b(0,26.17993877991494)},lc=new b;I.prototype.zoom=function(b,d){d=void 0===d?!0:d;var e=this._scene,f=e.camera,g=e.canvas,k=b;l(b)||(k=lc,k.x=g.clientWidth/2,k.y=g.clientHeight/2);this._doingZoomMiddleMouse=!0;$a.endPosition.y=d?Math.abs($a.endPosition.y):-Math.abs($a.endPosition.y);if(e.mode===N.SCENE2D)T(this,k,$a);else if(e.mode===N.COLUMBUS_VIEW)fa(this,k,$a);else if(g=f.pickEllipsoid(k),l(g))f=f.getPickRay(k,Ac),e=e.globe.pick(f,e),l(void 0)?ha(this,k,$a,K.WHEEL):l(e)&&(this._lastZoomMousePosition=a.clone(e,this._lastZoomMousePosition),ha(this,k,$a,K.WHEEL));else{var k=this._scene.camera,g=k.position.clone(),f=h.WGS84.cartesianToCartographic(g),m=D.eastNorthUpToFixedFrame(g);u.multiplyByVector(m,Xa,ic);u.multiplyByVector(m,pc,ob);Kb.x=ic.x;Kb.y=ic.y;Kb.z=ic.z;a.subtract(Kb,g,Rb);a.normalize(Rb,Rb);ub.x=ob.x;ub.y=ob.y;ub.z=ob.z;a.subtract(ub,g,jc);a.normalize(jc,jc);a.clone(g,jb);a.normalize(jb,jb);m=a.magnitude(g);g=h.WGS84.cartesianToCartographic(g);g.height=0;g=h.WGS84.cartographicToCartesian(g);g=a.magnitude(g);m<=g+10&&(m=g+10);var p=Math.acos(g/m);kc.x=-Rb.x;kc.y=-Rb.y;kc.z=-Rb.z;m=z.fromAxisAngle(kc,p);m=c.fromQuaternion(m);c.multiplyByVector(m,jb,Lb);a.normalize(Lb,Lb);m=z.fromAxisAngle(Rb,p);m=c.fromQuaternion(m);c.multiplyByVector(m,jb,Jb);a.normalize(Jb,Jb);Vb.x=-jc.x;Vb.y=-jc.y;Vb.z=-jc.z;m=z.fromAxisAngle(Vb,p);m=c.fromQuaternion(m);c.multiplyByVector(m,jb,Gb);a.normalize(Gb,Gb);m=z.fromAxisAngle(jc,p);m=c.fromQuaternion(m);c.multiplyByVector(m,jb,kb);a.normalize(kb,kb);a.multiplyByScalar(Lb,g,Tb);a.multiplyByScalar(Jb,g,fb);a.multiplyByScalar(Gb,g,Mb);a.multiplyByScalar(kb,g,zb);g=h.WGS84.cartesianToCartographic(Tb);g.longitude=r.toDegrees(g.longitude);g.latitude=r.toDegrees(g.latitude);m=h.WGS84.cartesianToCartographic(fb);m.longitude=r.toDegrees(m.longitude);m.latitude=r.toDegrees(m.latitude);p=h.WGS84.cartesianToCartographic(Mb);p.longitude=r.toDegrees(p.longitude);p.latitude=r.toDegrees(p.latitude);var q=h.WGS84.cartesianToCartographic(zb);q.longitude=r.toDegrees(q.longitude);q.latitude=r.toDegrees(q.latitude);var g=g.latitude,m=m.latitude,t=p.longitude;0>t&&(t+=360);var w=q.longitude;0>w&&(w+=360);var p=m<g?m:g,v=g>m?g:m,q=t<w?t:w,t=w>t?w:t,w=r.toDegrees(f.longitude);0>w&&(w+=360);f=r.toDegrees(f.latitude);if(w<q||w>t)w=q,q=t,t=w+360;if(f<p||f>v)q=0,t=360;f=new a;a.clone(k.positionWC,f);p=a.angleBetween(f,k.up);k=[(q+t)/2,p<=Math.PI/2?g:m];k=a.fromDegrees(k[0],k[1]);e=O.wgs84ToWindowCoordinates(e,k);l(e)&&(this._lastZoomMousePosition=a.clone(k,this._lastZoomMousePosition),ha(this,e,$a,K.WHEEL))}};var qc=new a,mc=new k,bc=new a;new a;new b;new x;var kd=new a;new a;var Hc=new u;new u;new u;new z;new c;var Ge=new k,Bb=new a,ld=new a;new a;new a;new a;new a;new x;new x;new x;new x;new a;new a;new a;new a;new k;new x;new a;var Wc=new a,Cc=new a,fd=new a;new k;new x;var qd=new a,gd=new a;new k;var Qc=new b,Xc=new b,cd=new x,Yc=new x,Bd=new a,md=new a;I.prototype.update=function(){u.equals(this._scene.camera.transform,u.IDENTITY)?(this._globe=this._scene.globe,this._ellipsoid=l(this._globe)?this._globe.ellipsoid:this._scene.mapProjection.ellipsoid):(this._globe=void 0,this._ellipsoid=h.UNIT_SPHERE);this._minimumCollisionTerrainHeight=this.minimumCollisionTerrainHeight*this._scene.terrainExaggeration;this._minimumPickingTerrainHeight=this.minimumPickingTerrainHeight*this._scene.terrainExaggeration;this._minimumTrackBallHeight=this.minimumTrackBallHeight*this._scene.terrainExaggeration;var b=this._ellipsoid.maximumRadius;this._rotateFactor=1/b;this._rotateRateRangeAdjustment=b;b=this._scene.mode;if(b===N.SCENE2D)b=this._scene.mapMode2D===P.ROTATE,u.equals(u.IDENTITY,this._scene.camera.transform)?(M(this,this.enableTranslate,this.translateEventTypes,ca,this.inertiaTranslate,"_lastInertiaTranslateMovement"),M(this,this.enableZoom,this.zoomEventTypes,T,this.inertiaZoom,"_lastInertiaZoomMovement"),b&&M(this,this.enableRotate,this.tiltEventTypes,da,this.inertiaSpin,"_lastInertiaTiltMovement")):(M(this,this.enableZoom,this.zoomEventTypes,T,this.inertiaZoom,"_lastInertiaZoomMovement"),b&&M(this,this.enableRotate,this.translateEventTypes,da,this.inertiaSpin,"_lastInertiaSpinMovement"));else if(b===N.COLUMBUS_VIEW){this._horizontalRotationAxis=a.UNIT_Z;var c=this._scene.camera;u.equals(u.IDENTITY,c.transform)?(b=this._tweens,this._aggregator.anyButtonDown&&b.removeAll(),M(this,this.enableTilt,this.tiltEventTypes,X,this.inertiaSpin,"_lastInertiaTiltMovement"),M(this,this.enableTranslate,this.translateEventTypes,ba,this.inertiaTranslate,"_lastInertiaTranslateMovement"),M(this,this.enableZoom,this.zoomEventTypes,fa,this.inertiaZoom,"_lastInertiaZoomMovement"),M(this,this.enableLook,this.lookEventTypes,oa),this._aggregator.anyButtonDown||l(this._lastInertiaZoomMovement)&&this._lastInertiaZoomMovement.active||l(this._lastInertiaTranslateMovement)&&this._lastInertiaTranslateMovement.active||b.contains(this._tween)||(c=c.createCorrectPositionTween(this.bounceAnimationTime),l(c)&&(this._tween=b.add(c))),b.update()):(M(this,this.enableRotate,this.rotateEventTypes,na,this.inertiaSpin,"_lastInertiaSpinMovement"),M(this,this.enableZoom,this.zoomEventTypes,ha,this.inertiaZoom,"_lastInertiaZoomMovement"))}else b===N.SCENE3D&&(this._horizontalRotationAxis=void 0,M(this,this.enableRotate,this.rotateEventTypes,ka,this.inertiaSpin,"_lastInertiaSpinMovement"),M(this,this.enableZoom,this.zoomEventTypes,ha,this.inertiaZoom,"_lastInertiaZoomMovement"),M(this,this.enableTilt,this.tiltEventTypes,pa,this.inertiaSpin,"_lastInertiaTiltMovement"),M(this,this.enableLook,this.lookEventTypes,oa));this._aggregator.reset()};I.prototype.isDestroyed=function(){return!1};I.prototype.destroy=function(){this._tweens.removeAll();this._aggregator=this._aggregator&&this._aggregator.destroy();return m(this)};return I});F("Scene/ShadowMapShader",["../Core/defined","../Renderer/ShaderSource"],function(b,a){function f(){}f.getShadowCastShaderKeyword=function(a,b,f,m){return"castShadow "+a+" "+b+" "+f+" "+m};f.createShadowCastVertexShader=function(f,g,l){var k=f.defines.slice(0),e=f.sources.slice(0);k.push("SHADOW_MAP");l&&k.push("GENERATE_POSITION");f=a.findPositionVarying(f);f=b(f);if(g&&!f){g=e.length;for(f=0;f<g;++f)e[f]=a.replaceMain(e[f],"czm_shadow_cast_main");e.push("varying vec3 v_positionEC; \nvoid main() \n{ \n    czm_shadow_cast_main(); \n    v_positionEC \x3d (czm_inverseProjection * gl_Position).xyz; \n}")}return new a({defines:k,sources:e})};f.createShadowCastFragmentShader=function(f,g,l,m){var e=f.defines.slice(0),h=f.sources.slice(0);f=a.findPositionVarying(f);var k=b(f);k||(f="v_positionEC");for(var d=h.length,q=0;q<d;++q)h[q]=a.replaceMain(h[q],"czm_shadow_cast_main");d="";g&&(k||(d+="varying vec3 v_positionEC; \n"),d+="uniform vec4 shadowMap_lightPositionEC; \n");d=m?d+"void main() \n{ \n":d+"void main() \n{ \n    czm_shadow_cast_main(); \n    if (gl_FragColor.a \x3d\x3d 0.0) \n    { \n       discard; \n    } \n";h.push((g?d+("    float distance \x3d length("+f+"); \n    if (distance \x3e\x3d shadowMap_lightPositionEC.w) \n    { \n        discard; \n    } \n    distance /\x3d shadowMap_lightPositionEC.w; // radius \n    gl_FragColor \x3d czm_packDepth(distance); \n"):l?d+"    gl_FragColor \x3d vec4(1.0); \n":d+"    gl_FragColor \x3d czm_packDepth(gl_FragCoord.z); \n")+"} \n");return new a({defines:e,sources:h})};f.getShadowReceiveShaderKeyword=function(a,b,f,m){return"receiveShadow "+a._usesDepthTexture+a._polygonOffsetSupported+a._isPointLight+a._isSpotLight+(1<a._numberOfCascades)+a.debugCascadeColors+a.softShadows+b+f+m};f.createShadowReceiveVertexShader=function(b,f,l){var g=b.defines.slice(0);b=b.sources.slice(0);g.push("SHADOW_MAP");f&&(l?g.push("GENERATE_POSITION_AND_NORMAL"):g.push("GENERATE_POSITION"));return new a({defines:g,sources:b})};f.createShadowReceiveFragmentShader=function(f,g,l,m,e){var h=a.findNormalVarying(f);e=!m&&b(h)||m&&e;var k=a.findPositionVarying(f),d=b(k),q=g._usesDepthTexture,t=g._polygonOffsetSupported,r=g._isPointLight,c=g._isSpotLight,u=1<g._numberOfCascades,y=g.debugCascadeColors,A=g.softShadows;g=r?g._pointBias:m?g._terrainBias:g._primitiveBias;var z=f.defines.slice(0);f=f.sources.slice(0);for(var x=f.length,D=0;D<x;++D)f[D]=a.replaceMain(f[D],"czm_shadow_receive_main");r?z.push("USE_CUBE_MAP_SHADOW"):q&&z.push("USE_SHADOW_DEPTH_TEXTURE");A&&!r&&z.push("USE_SOFT_SHADOWS");u&&l&&m&&(e?z.push("ENABLE_VERTEX_LIGHTING"):z.push("ENABLE_DAYNIGHT_SHADING"));l&&g.normalShading&&e&&(z.push("USE_NORMAL_SHADING"),0<g.normalShadingSmooth&&z.push("USE_NORMAL_SHADING_SMOOTH"));l="";l=(r?l+"uniform samplerCube shadowMap_textureCube; \n":l+"uniform sampler2D shadowMap_texture; \n")+("uniform mat4 shadowMap_matrix; \nuniform vec3 shadowMap_lightDirectionEC; \nuniform vec4 shadowMap_lightPositionEC; \nuniform vec4 shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness; \nuniform vec4 shadowMap_texelSizeDepthBiasAndNormalShadingSmooth; \n#ifdef LOG_DEPTH \nvarying vec3 v_logPositionEC; \n#endif \nvec4 getPositionEC() \n{ \n"+(d?"    return vec4("+k+", 1.0); \n":"#ifndef LOG_DEPTH \n    return czm_windowToEyeCoordinates(gl_FragCoord); \n#else \n    return vec4(v_logPositionEC, 1.0); \n#endif \n")+"} \nvec3 getNormalEC() \n{ \n"+(e?"    return normalize("+h+"); \n":"    return vec3(1.0); \n")+"} \nvoid applyNormalOffset(inout vec4 positionEC, vec3 normalEC, float nDotL) \n{ \n"+(g.normalOffset&&e?"    float normalOffset \x3d shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.x; \n    float normalOffsetScale \x3d 1.0 - nDotL; \n    vec3 offset \x3d normalOffset * normalOffsetScale * normalEC; \n    positionEC.xyz +\x3d offset; \n":"")+"} \n");l+="void main() \n{ \n    czm_shadow_receive_main(); \n    vec4 positionEC \x3d getPositionEC(); \n    vec3 normalEC \x3d getNormalEC(); \n    float depth \x3d -positionEC.z; \n    czm_shadowParameters shadowParameters; \n    shadowParameters.texelStepSize \x3d shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.xy; \n    shadowParameters.depthBias \x3d shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.z; \n    shadowParameters.normalShadingSmooth \x3d shadowMap_texelSizeDepthBiasAndNormalShadingSmooth.w; \n    shadowParameters.darkness \x3d shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.w; \n";m?l+="    shadowParameters.depthBias *\x3d max(depth * 0.01, 1.0); \n":t||(l+="    shadowParameters.depthBias *\x3d mix(1.0, 100.0, depth * 0.0015); \n");f.push((r?l+"    vec3 directionEC \x3d positionEC.xyz - shadowMap_lightPositionEC.xyz; \n    float distance \x3d length(directionEC); \n    directionEC \x3d normalize(directionEC); \n    float radius \x3d shadowMap_lightPositionEC.w; \n    // Stop early if the fragment is beyond the point light radius \n    if (distance \x3e radius) \n    { \n        return; \n    } \n    vec3 directionWC  \x3d czm_inverseViewRotation * directionEC; \n    shadowParameters.depth \x3d distance / radius; \n    shadowParameters.nDotL \x3d clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    shadowParameters.texCoords \x3d directionWC; \n    float visibility \x3d czm_shadowVisibility(shadowMap_textureCube, shadowParameters); \n":c?l+"    vec3 directionEC \x3d normalize(positionEC.xyz - shadowMap_lightPositionEC.xyz); \n    float nDotL \x3d clamp(dot(normalEC, -directionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition \x3d shadowMap_matrix * positionEC; \n    // Spot light uses a perspective projection, so perform the perspective divide \n    shadowPosition /\x3d shadowPosition.w; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords \x3d shadowPosition.xy; \n    shadowParameters.depth \x3d shadowPosition.z; \n    shadowParameters.nDotL \x3d nDotL; \n    float visibility \x3d czm_shadowVisibility(shadowMap_texture, shadowParameters); \n":u?l+("    float maxDepth \x3d shadowMap_cascadeSplits[1].w; \n    // Stop early if the eye depth exceeds the last cascade \n    if (depth \x3e maxDepth) \n    { \n        return; \n    } \n    // Get the cascade based on the eye-space depth \n    vec4 weights \x3d czm_cascadeWeights(depth); \n    // Apply normal offset \n    float nDotL \x3d clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    // Transform position into the cascade \n    vec4 shadowPosition \x3d czm_cascadeMatrix(weights) * positionEC; \n    // Get visibility \n    shadowParameters.texCoords \x3d shadowPosition.xy; \n    shadowParameters.depth \x3d shadowPosition.z; \n    shadowParameters.nDotL \x3d nDotL; \n    float visibility \x3d czm_shadowVisibility(shadowMap_texture, shadowParameters); \n    // Fade out shadows that are far away \n    float shadowMapMaximumDistance \x3d shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness.z; \n    float fade \x3d max((depth - shadowMapMaximumDistance * 0.8) / (shadowMapMaximumDistance * 0.2), 0.0); \n    visibility \x3d mix(visibility, 1.0, fade); \n"+(y?"    // Draw cascade colors for debugging \n    gl_FragColor *\x3d czm_cascadeColor(weights); \n":"")):l+"    float nDotL \x3d clamp(dot(normalEC, shadowMap_lightDirectionEC), 0.0, 1.0); \n    applyNormalOffset(positionEC, normalEC, nDotL); \n    vec4 shadowPosition \x3d shadowMap_matrix * positionEC; \n    // Stop early if the fragment is not in the shadow bounds \n    if (any(lessThan(shadowPosition.xyz, vec3(0.0))) || any(greaterThan(shadowPosition.xyz, vec3(1.0)))) \n    { \n        return; \n    } \n    shadowParameters.texCoords \x3d shadowPosition.xy; \n    shadowParameters.depth \x3d shadowPosition.z; \n    shadowParameters.nDotL \x3d nDotL; \n    float visibility \x3d czm_shadowVisibility(shadowMap_texture, shadowParameters); \n")+"    gl_FragColor.rgb *\x3d visibility; \n} \n");return new a({defines:z,sources:f})};return f});F("Scene/ShadowMap","../Core/BoundingRectangle ../Core/BoundingSphere ../Core/BoxOutlineGeometry ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/Cartographic ../Core/clone ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/combine ../Core/CullingVolume ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/FeatureDetection ../Core/GeometryInstance ../Core/Intersect ../Core/Math ../Core/Matrix4 ../Core/OrthographicOffCenterFrustum ../Core/PerspectiveFrustum ../Core/PixelFormat ../Core/Quaternion ../Core/SphereOutlineGeometry ../Core/WebGLConstants ../Renderer/ClearCommand ../Renderer/ContextLimits ../Renderer/CubeMap ../Renderer/DrawCommand ../Renderer/Framebuffer ../Renderer/Pass ../Renderer/PassState ../Renderer/PixelDatatype ../Renderer/Renderbuffer ../Renderer/RenderbufferFormat ../Renderer/RenderState ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap ./Camera ./CullFace ./DebugCameraPrimitive ./PerInstanceColorAppearance ./Primitive ./ShadowMapShader".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,F,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X){function I(b){b=t(b,t.EMPTY_OBJECT);var c=b.context;if(!r(c))throw new y("context is required.");if(!r(b.lightCamera))throw new y("lightCamera is required.");if(r(b.numberOfCascades)&&1!==b.numberOfCascades&&4!==b.numberOfCascades)throw new y("Only one or four cascades are supported.");this._enabled=t(b.enabled,!0);this._softShadows=t(b.softShadows,!1);this._normalOffset=t(b.normalOffset,!0);this.dirty=!0;this.fromLightSource=t(b.fromLightSource,!0);this._darkness=this.darkness=t(b.darkness,.3);this.maximumDistance=t(b.maximumDistance,5E3);this._outOfViewPrevious=this._outOfView=!1;var d=this._needsUpdate=!0;if(A.isInternetExplorer()||A.isEdge()||(A.isChrome()||A.isFirefox())&&A.isWindows()&&!c.depthTexture)d=!1;this._polygonOffsetSupported=d;this._terrainBias={polygonOffset:d,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.5,normalShading:!0,normalShadingSmooth:.3,depthBias:1E-4};this._primitiveBias={polygonOffset:d,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:.1,normalShading:!0,normalShadingSmooth:.05,depthBias:2E-5};this._pointBias={polygonOffset:!1,polygonOffsetFactor:1.1,polygonOffsetUnits:4,normalOffset:this._normalOffset,normalOffsetScale:0,normalShading:!0,normalShadingSmooth:.1,depthBias:5E-4};this._colorAttachment=this._depthAttachment=void 0;this._shadowMapMatrix=new v;this._shadowMapTexture=void 0;this._lightDirectionEC=new g;this._lightPositionEC=new l;this._distance=0;this._lightCamera=b.lightCamera;this._shadowMapCamera=new qa;this._sceneCamera=this._shadowMapCullingVolume=void 0;this._boundingSphere=new a;this._isPointLight=t(b.isPointLight,!1);this._pointLightRadius=t(b.pointLightRadius,100);this._numberOfCascades=(this._cascadesEnabled=this._isPointLight?!1:t(b.cascadesEnabled,!0))?t(b.numberOfCascades,4):0;this._fitNearFar=!0;this._maximumCascadeDistances=[25,150,700,Number.MAX_VALUE];this._textureSize=new k;this._isSpotLight=!1;this._cascadesEnabled?this._shadowMapCamera.frustum=new B:r(this._lightCamera.frustum.fov)&&(this._isSpotLight=!0);this._cascadeSplits=[new l,new l];this._cascadeMatrices=[new v,new v,new v,new v];this._cascadeDistances=new l;d=this._isPointLight?6:this._cascadesEnabled?this._numberOfCascades:1;this._passes=Array(d);for(var e=0;e<d;++e)this._passes[e]=new ga(c);this._debugCascadeColors=this._debugFreezeFrame=this.debugFreezeFrame=this.debugShow=!1;this._debugCameraFrustum=this._debugLightFrustum=void 0;this._debugCascadeFrustums=Array(this._numberOfCascades);this._debugShadowViewCommand=void 0;this._usesDepthTexture=c.depthTexture;this._isPointLight&&(this._usesDepthTexture=!1);this._pointRenderState=this._terrainRenderState=this._primitiveRenderState=void 0;na(this);this._clearCommand=new G({depth:1,color:new h});this._clearPassState=new O(c);this.size=this._size=t(b.size,2048)}function ga(a){this.camera=new qa;this.passState=new O(a);this.textureOffsets=this.framebuffer=void 0;this.commandList=[];this.cullingVolume=void 0}function ka(a,b){return W.fromCache({cull:{enabled:!0,face:T.BACK},depthTest:{enabled:!0},colorMask:{red:a,green:a,blue:a,alpha:a},depthMask:!0,polygonOffset:{enabled:b.polygonOffset,factor:b.polygonOffsetFactor,units:b.polygonOffsetUnits}})}function na(a){var b=!a._usesDepthTexture;a._primitiveRenderState=ka(b,a._primitiveBias);a._terrainRenderState=ka(b,a._terrainBias);a._pointRenderState=ka(b,a._pointBias)}function ia(a){for(var b=a._passes.length,c=0;c<b;++c){var d=a._passes[c],e=d.framebuffer;r(e)&&!e.isDestroyed()&&e.destroy();d.framebuffer=void 0}a._depthAttachment=a._depthAttachment&&a._depthAttachment.destroy();a._colorAttachment=a._colorAttachment&&a._colorAttachment.destroy()}function la(){return new M({wrapS:S.CLAMP_TO_EDGE,wrapT:S.CLAMP_TO_EDGE,minificationFilter:Q.NEAREST,magnificationFilter:Y.NEAREST})}function ha(a,b){if(a._isPointLight){for(var c=new aa({context:b,width:a._textureSize.x,height:a._textureSize.y,format:U.DEPTH_COMPONENT16}),d=new L({context:b,width:a._textureSize.x,height:a._textureSize.y,pixelFormat:F.RGBA,pixelDatatype:Z.UNSIGNED_BYTE,sampler:la()}),e=[d.negativeX,d.negativeY,d.negativeZ,d.positiveX,d.positiveY,d.positiveZ],f=0;6>f;++f){var g=new P({context:b,depthRenderbuffer:c,colorTextures:[e[f]],destroyAttachments:!1}),h=a._passes[f];h.framebuffer=g;h.passState.framebuffer=g}a._shadowMapTexture=d;a._depthAttachment=c;a._colorAttachment=d}else if(a._usesDepthTexture){c=new R({context:b,width:a._textureSize.x,height:a._textureSize.y,pixelFormat:F.DEPTH_STENCIL,pixelDatatype:Z.UNSIGNED_INT_24_8,sampler:la()});d=new P({context:b,depthStencilTexture:c,destroyAttachments:!1});e=a._passes.length;for(f=0;f<e;++f)g=a._passes[f],g.framebuffer=d,g.passState.framebuffer=d;a._shadowMapTexture=c;a._depthAttachment=c}else{c=new aa({context:b,width:a._textureSize.x,height:a._textureSize.y,format:U.DEPTH_COMPONENT16});d=new R({context:b,width:a._textureSize.x,height:a._textureSize.y,pixelFormat:F.RGBA,pixelDatatype:Z.UNSIGNED_BYTE,sampler:la()});e=new P({context:b,depthRenderbuffer:c,colorTextures:[d],destroyAttachments:!1});f=a._passes.length;for(g=0;g<f;++g)h=a._passes[g],h.framebuffer=e,h.passState.framebuffer=e;a._shadowMapTexture=d;a._depthAttachment=c;a._colorAttachment=d}}function pa(a,b,c){c=t(c,0);if(a._isPointLight||0===c)a._clearCommand.framebuffer=a._passes[c].framebuffer,a._clearCommand.execute(b,a._clearPassState)}function oa(a,b){var c=b.createViewportQuadCommand(a._isPointLight?"uniform samplerCube shadowMap_textureCube; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n    vec2 uv \x3d v_textureCoordinates; \n    vec3 dir; \n \n    if (uv.y \x3c 0.5) \n    { \n        if (uv.x \x3c 0.333) \n        { \n            dir.x \x3d -1.0; \n            dir.y \x3d uv.x * 6.0 - 1.0; \n            dir.z \x3d uv.y * 4.0 - 1.0; \n        } \n        else if (uv.x \x3c 0.666) \n        { \n            dir.y \x3d -1.0; \n            dir.x \x3d uv.x * 6.0 - 3.0; \n            dir.z \x3d uv.y * 4.0 - 1.0; \n        } \n        else \n        { \n            dir.z \x3d -1.0; \n            dir.x \x3d uv.x * 6.0 - 5.0; \n            dir.y \x3d uv.y * 4.0 - 1.0; \n        } \n    } \n    else \n    { \n        if (uv.x \x3c 0.333) \n        { \n            dir.x \x3d 1.0; \n            dir.y \x3d uv.x * 6.0 - 1.0; \n            dir.z \x3d uv.y * 4.0 - 3.0; \n        } \n        else if (uv.x \x3c 0.666) \n        { \n            dir.y \x3d 1.0; \n            dir.x \x3d uv.x * 6.0 - 3.0; \n            dir.z \x3d uv.y * 4.0 - 3.0; \n        } \n        else \n        { \n            dir.z \x3d 1.0; \n            dir.x \x3d uv.x * 6.0 - 5.0; \n            dir.y \x3d uv.y * 4.0 - 3.0; \n        } \n    } \n \n    float shadow \x3d czm_unpackDepth(textureCube(shadowMap_textureCube, dir)); \n    gl_FragColor \x3d vec4(vec3(shadow), 1.0); \n} \n":"uniform sampler2D shadowMap_texture; \nvarying vec2 v_textureCoordinates; \nvoid main() \n{ \n"+(a._usesDepthTexture?"    float shadow \x3d texture2D(shadowMap_texture, v_textureCoordinates).r; \n":"    float shadow \x3d czm_unpackDepth(texture2D(shadowMap_texture, v_textureCoordinates)); \n")+"    gl_FragColor \x3d vec4(vec3(shadow), 1.0); \n} \n",{uniformMap:{shadowMap_texture:function(){return a._shadowMapTexture},shadowMap_textureCube:function(){return a._shadowMapTexture}}});c.pass=N.OVERLAY;return c}function qa(){this.viewMatrix=new v;this.inverseViewMatrix=new v;this.frustum=void 0;this.positionCartographic=new m;this.positionWC=new g;this.directionWC=g.clone(g.UNIT_Z);this.upWC=g.clone(g.UNIT_Y);this.rightWC=g.clone(g.UNIT_X);this.viewProjectionMatrix=new v}function ua(a,b,c){var e=a._isPointLight?a._pointBias:c?a._terrainBias:a._primitiveBias;c={shadowMap_texture:function(){return a._shadowMapTexture},shadowMap_textureCube:function(){return a._shadowMapTexture},shadowMap_matrix:function(){return a._shadowMapMatrix},shadowMap_cascadeSplits:function(){return a._cascadeSplits},shadowMap_cascadeMatrices:function(){return a._cascadeMatrices},shadowMap_lightDirectionEC:function(){return a._lightDirectionEC},shadowMap_lightPositionEC:function(){return a._lightPositionEC},shadowMap_cascadeDistances:function(){return a._cascadeDistances},shadowMap_texelSizeDepthBiasAndNormalShadingSmooth:function(){var b=Sa;b.x=1/a._textureSize.x;b.y=1/a._textureSize.y;return l.fromElements(b.x,b.y,e.depthBias,e.normalShadingSmooth,this.combinedUniforms1)},shadowMap_normalOffsetScaleDistanceMaxDistanceAndDarkness:function(){return l.fromElements(e.normalOffsetScale,a._distance,a.maximumDistance,a._darkness,this.combinedUniforms2)},combinedUniforms1:new l,combinedUniforms2:new l};return d(b,c,!1)}I.MAXIMUM_DISTANCE=2E4;I.prototype.debugCreateRenderStates=function(){na(this)};c(I.prototype,{enabled:{get:function(){return this._enabled},set:function(a){this.dirty=this._enabled!==a;this._enabled=a}},normalOffset:{get:function(){return this._normalOffset},set:function(a){this.dirty=this._normalOffset!==a;this._normalOffset=a;this._terrainBias.normalOffset=a;this._primitiveBias.normalOffset=a;this._pointBias.normalOffset=a}},softShadows:{get:function(){return this._softShadows},set:function(a){this.dirty=this._softShadows!==a;this._softShadows=a}},size:{get:function(){return this._size},set:function(a){var c=a;this._size=c;a=this._passes;var d=a.length,e=this._textureSize;this._isPointLight?(c=E.maximumCubeMapSize>=c?c:E.maximumCubeMapSize,e.x=c,e.y=c,c=new b(0,0,c,c),a[0].passState.viewport=c,a[1].passState.viewport=c,a[2].passState.viewport=c,a[3].passState.viewport=c,a[4].passState.viewport=c,a[5].passState.viewport=c):1===d?(c=E.maximumTextureSize>=c?c:E.maximumTextureSize,e.x=c,e.y=c,a[0].passState.viewport=new b(0,0,c,c)):4===d&&(c=E.maximumTextureSize>=2*c?c:E.maximumTextureSize/2,e.x=2*c,e.y=2*c,a[0].passState.viewport=new b(0,0,c,c),a[1].passState.viewport=new b(c,0,c,c),a[2].passState.viewport=new b(0,c,c,c),a[3].passState.viewport=new b(c,c,c,c));this._clearPassState.viewport=new b(0,0,e.x,e.y);for(c=0;c<d;++c){var f=a[c],g=f.passState.viewport;f.textureOffsets=new v(g.width/e.x,0,0,g.x/e.x,0,g.height/e.y,0,g.y/e.y,0,0,1,0,0,0,0,1)}}},outOfView:{get:function(){return this._outOfView}},shadowMapCullingVolume:{get:function(){return this._shadowMapCullingVolume}},passes:{get:function(){return this._passes}},isPointLight:{get:function(){return this._isPointLight}},debugCascadeColors:{get:function(){return this._debugCascadeColors},set:function(a){this.dirty=this._debugCascadeColors!==a;this._debugCascadeColors=a}}});var ta=new b,wa=Array(8);wa[0]=new l(-1,-1,-1,1);wa[1]=new l(1,-1,-1,1);wa[2]=new l(1,1,-1,1);wa[3]=new l(-1,1,-1,1);wa[4]=new l(-1,-1,1,1);wa[5]=new l(1,-1,1,1);wa[6]=new l(1,1,1,1);wa[7]=new l(-1,1,1,1);var za=new v,Da=Array(8);for(c=0;8>c;++c)Da[c]=new l;var Ba=[h.RED,h.GREEN,h.BLUE,h.MAGENTA],ra=new g;qa.prototype.clone=function(a){v.clone(a.viewMatrix,this.viewMatrix);v.clone(a.inverseViewMatrix,this.inverseViewMatrix);this.frustum=a.frustum.clone(this.frustum);m.clone(a.positionCartographic,this.positionCartographic);g.clone(a.positionWC,this.positionWC);g.clone(a.directionWC,this.directionWC);g.clone(a.upWC,this.upWC);g.clone(a.rightWC,this.rightWC)};var Ea=new v(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);qa.prototype.getViewProjection=function(){v.multiply(this.frustum.projectionMatrix,this.viewMatrix,this.viewProjectionMatrix);v.multiply(Ea,this.viewProjectionMatrix,this.viewProjectionMatrix);return this.viewProjectionMatrix};var Ga=Array(5),Ca=new C,ya=Array(4),Aa=new g,Ua=new g,sa=new v,Va=new g,xa=new g,Ha=new g,Ma=[new g(-1,0,0),new g(0,-1,0),new g(0,0,-1),new g(1,0,0),new g(0,1,0),new g(0,0,1)],Ia=[new g(0,-1,0),new g(0,0,-1),new g(0,-1,0),new g(0,-1,0),new g(0,0,1),new g(0,-1,0)],La=[new g(0,0,1),new g(1,0,0),new g(-1,0,0),new g(0,0,-1),new g(1,0,0),new g(1,0,0)],Fa=new g,Ja=new g,Qa=new a,va=Qa.center;I.prototype.update=function(c){var d=c.camera,e=this._lightCamera,k=this._sceneCamera,m=this._shadowMapCamera;this._cascadesEnabled?g.clone(e.directionWC,m.directionWC):this._isPointLight?g.clone(e.positionWC,m.positionWC):m.clone(e);e=this._lightDirectionEC;v.multiplyByPointAsVector(d.viewMatrix,m.directionWC,e);g.normalize(e,e);g.negate(e,e);v.multiplyByPoint(d.viewMatrix,m.positionWC,this._lightPositionEC);this._lightPositionEC.w=this._pointLightRadius;this._fitNearFar?(m=Math.min(c.shadowState.nearPlane,this.maximumDistance),e=Math.min(c.shadowState.farPlane,this.maximumDistance+1)):(m=d.frustum.near,e=this.maximumDistance);this._sceneCamera=ca.clone(d,k);d.frustum.clone(this._sceneCamera.frustum);this._sceneCamera.frustum.near=m;this._sceneCamera.frustum.far=e;this._distance=e-m;k=this._sceneCamera;d=this._shadowMapCamera;this._cascadesEnabled?k.frustum.near>=this.maximumDistance?(this._outOfView=!0,this._needsUpdate=!1):(k=c.mapProjection.ellipsoid.geodeticSurfaceNormal(k.positionWC,Fa),d=g.negate(d.directionWC,Ja),d=g.dot(k,d),k=D.clamp(d/.1,0,1),this._darkness=D.lerp(1,this.darkness,k),0>d?(this._outOfView=!0,this._needsUpdate=!1):(this._needsUpdate=!0,this._outOfView=!1)):(this._isPointLight?(Qa.center=d.positionWC,Qa.radius=this._pointLightRadius):(k=d.frustum.far/2,d=g.add(d.positionWC,g.multiplyByScalar(d.directionWC,k,va),va),Qa.center=d,Qa.radius=k),this._outOfView=c.cullingVolume.computeVisibility(Qa)===x.OUTSIDE,this._needsUpdate=!this._outOfView&&!this._boundingSphere.equals(Qa),a.clone(Qa,this._boundingSphere));!this._outOfViewPrevious&&this._outOfView&&(this._needsUpdate=!0);this._outOfViewPrevious=this._outOfView;if(this._needsUpdate){d=c.context;r(this._passes[0].framebuffer)&&this._shadowMapTexture.width===this._textureSize.x||(ia(this),ha(this,d),this._usesDepthTexture&&this._passes[0].framebuffer.status!==w.FRAMEBUFFER_COMPLETE&&(this._usesDepthTexture=!1,na(this),ia(this),ha(this,d)),pa(this,d));if(this._isPointLight)for(d=new C,d.fov=D.PI_OVER_TWO,d.near=1,d.far=this._pointLightRadius,d.aspectRatio=1,k=0;6>k;++k)m=this._passes[k].camera,m.positionWC=this._shadowMapCamera.positionWC,m.positionCartographic=c.mapProjection.ellipsoid.cartesianToCartographic(m.positionWC,m.positionCartographic),m.directionWC=Ma[k],m.upWC=Ia[k],m.rightWC=La[k],v.computeView(m.positionWC,m.directionWC,m.upWC,m.rightWC,m.viewMatrix),v.inverse(m.viewMatrix,m.inverseViewMatrix),m.frustum=d;if(this._cascadesEnabled){var d=this._shadowMapCamera,m=this._sceneCamera,k=v.multiply(m.frustum.projectionMatrix,m.viewMatrix,za),t=v.inverse(k,za),k=d.directionWC,m=m.directionWC,e=g.cross(k,m,Va),m=g.cross(e,k,xa);g.normalize(m,m);g.normalize(e,e);for(var u=g.fromElements(0,0,0,Ha),u=v.computeView(u,k,m,e,sa),y=v.multiply(u,t,za),t=g.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Aa),A=g.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Ua),E=0;8>E;++E){var B=l.clone(wa[E],Da[E]);v.multiplyByVector(y,B,B);g.divideByScalar(B,B.w,B);g.minimumByComponent(B,t,t);g.maximumByComponent(B,A,A)}A.z+=1E3;t.z-=10;Ha.x=-(.5*(t.x+A.x));Ha.y=-(.5*(t.y+A.y));Ha.z=-A.z;y=v.fromTranslation(Ha,za);u=v.multiply(y,u,u);y=.5*(A.x-t.x);E=.5*(A.y-t.y);t=A.z-t.z;A=d.frustum;A.left=-y;A.right=y;A.bottom=-E;A.top=E;A.near=.01;A.far=t;v.clone(u,d.viewMatrix);v.inverse(u,d.inverseViewMatrix);v.getTranslation(d.inverseViewMatrix,d.positionWC);c.mapProjection.ellipsoid.cartesianToCartographic(d.positionWC,d.positionCartographic);g.clone(k,d.directionWC);g.clone(m,d.upWC);g.clone(e,d.rightWC);if(1<this._numberOfCascades){d=this._shadowMapCamera;k=this._sceneCamera;u=k.frustum.near;e=k.frustum.far;m=this._numberOfCascades;t=e-u;A=e/u;y=.9;E=!1;200>c.shadowState.closestObjectSize&&(E=!0,y=.9);Ga[0]=u;Ga[m]=e;for(e=0;e<m;++e)B=(e+1)/m,B=D.lerp(u+t*B,u*Math.pow(A,B),y),Ga[e+1]=B,ya[e]=B-Ga[e];if(E){for(e=0;e<m;++e)ya[e]=Math.min(ya[e],this._maximumCascadeDistances[e]);u=Ga[0];for(e=0;e<m-1;++e)u+=ya[e],Ga[e+1]=u}l.unpack(Ga,0,this._cascadeSplits[0]);l.unpack(Ga,1,this._cascadeSplits[1]);l.unpack(ya,0,this._cascadeDistances);for(var e=d.frustum,u=e.left,t=e.right,A=e.bottom,y=e.top,E=e.near,B=e.far,G=d.positionWC,I=d.directionWC,F=d.upWC,K=k.frustum.clone(Ca),L=d.getViewProjection(),e=0;e<m;++e){K.near=Ga[e];K.far=Ga[e+1];for(var N=v.multiply(K.projectionMatrix,k.viewMatrix,za),N=v.inverse(N,za),Q=v.multiply(L,N,za),N=g.fromElements(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Aa),P=g.fromElements(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,Ua),O=0;8>O;++O){var M=l.clone(wa[O],Da[O]);v.multiplyByVector(Q,M,M);g.divideByScalar(M,M.w,M);g.minimumByComponent(M,N,N);g.maximumByComponent(M,P,P)}N.x=Math.max(N.x,0);N.y=Math.max(N.y,0);N.z=0;P.x=Math.min(P.x,1);P.y=Math.min(P.y,1);P.z=Math.min(P.z,1);Q=this._passes[e];O=Q.camera;O.clone(d);M=O.frustum;M.left=u+N.x*(t-u);M.right=u+P.x*(t-u);M.bottom=A+N.y*(y-A);M.top=A+P.y*(y-A);M.near=E+N.z*(B-E);M.far=E+P.z*(B-E);Q.cullingVolume=O.frustum.computeCullingVolume(G,I,F);N=this._cascadeMatrices[e];v.multiply(O.getViewProjection(),k.inverseViewMatrix,N);v.multiply(Q.textureOffsets,N,N)}}}this._isPointLight?this._shadowMapCullingVolume=q.fromBoundingSphere(this._boundingSphere):(d=this._shadowMapCamera,this._shadowMapCullingVolume=d.frustum.computeCullingVolume(d.positionWC,d.directionWC,d.upWC),1===this._passes.length&&this._passes[0].camera.clone(d))}1===this._passes.length&&(d=this._sceneCamera.inverseViewMatrix,v.multiply(this._shadowMapCamera.getViewProjection(),d,this._shadowMapMatrix));if(this.debugShow){d=c.context;k=c.context.drawingBufferWidth;m=.3*Math.min(k,c.context.drawingBufferHeight);ta.x=k-m;ta.y=0;ta.width=m;ta.height=m;k=this._debugShadowViewCommand;r(k)||(this._debugShadowViewCommand=k=oa(this,d));r(k.renderState)&&b.equals(k.renderState.viewport,ta)||(k.renderState=W.fromCache({viewport:b.clone(ta)}));c.commandList.push(this._debugShadowViewCommand);d=this.debugFreezeFrame&&!this._debugFreezeFrame;if(this._debugFreezeFrame=this.debugFreezeFrame)d&&(this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy(),this._debugCameraFrustum=new da({camera:this._sceneCamera,color:h.CYAN,updateOnChange:!1})),this._debugCameraFrustum.update(c);if(this._cascadesEnabled){if(this.debugFreezeFrame)for(d&&(this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),this._debugLightFrustum=new da({camera:this._shadowMapCamera,color:h.YELLOW,updateOnChange:!1})),this._debugLightFrustum.update(c),k=0;k<this._numberOfCascades;++k)d&&(this._debugCascadeFrustums[k]=this._debugCascadeFrustums[k]&&this._debugCascadeFrustums[k].destroy(),this._debugCascadeFrustums[k]=new da({camera:this._passes[k].camera,color:Ba[k],updateOnChange:!1})),this._debugCascadeFrustums[k].update(c)}else{if(this._isPointLight){if(!r(this._debugLightFrustum)||this._needsUpdate)d=this._shadowMapCamera.positionWC,k=H.IDENTITY,m=2*this._pointLightRadius,m=g.fromElements(m,m,m,ra),d=v.fromTranslationQuaternionRotationScale(d,k,m,za),this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy(),m=h.YELLOW,k=new z({geometry:new f({minimum:new g(-.5,-.5,-.5),maximum:new g(.5,.5,.5)}),attributes:{color:p.fromColor(m)}}),m=new z({geometry:new J({radius:.5}),attributes:{color:p.fromColor(m)}}),this._debugLightFrustum=new ba({geometryInstances:[k,m],appearance:new V({translucent:!1,flat:!0}),asynchronous:!1,modelMatrix:d})}else if(!r(this._debugLightFrustum)||this._needsUpdate)this._debugLightFrustum=new da({camera:this._shadowMapCamera,color:h.YELLOW,updateOnChange:!1});this._debugLightFrustum.update(c)}}};I.prototype.updatePass=function(a,b){pa(this,a,b)};var Sa=new k;I.createReceiveDerivedCommand=function(a,b,c,d,e){r(e)||(e={});var f=0<a.length,g=b.shaderProgram,h=g.vertexShaderSource,k=g.fragmentShaderSource,l=b.pass===N.GLOBE,m=!1;l&&(m=b.owner.data.renderedMesh.encoding.hasVertexNormals);if(b.receiveShadows&&f){var p,q;r(e.receiveCommand)&&(p=e.receiveCommand.shaderProgram,q=e.receiveCommand.uniformMap);e.receiveCommand=K.shallowClone(b,e.receiveCommand);e.castShadows=!1;e.receiveShadows=!0;var f=e.receiveShaderCastShadows!==b.castShadows,t=e.receiveShaderProgramId!==b.shaderProgram.id;if(!r(p)||t||c||f)c=X.getShadowReceiveShaderKeyword(a[0],b.castShadows,l,m),p=d.shaderCache.getDerivedShaderProgram(g,c),r(p)||(h=X.createShadowReceiveVertexShader(h,l,m),k=X.createShadowReceiveFragmentShader(k,a[0],b.castShadows,l,m),p=d.shaderCache.createDerivedShaderProgram(g,c,{vertexShaderSource:h,fragmentShaderSource:k,attributeLocations:g._attributeLocations})),q=ua(a[0],b.uniformMap,l);e.receiveCommand.shaderProgram=p;e.receiveCommand.uniformMap=q;e.receiveShaderProgramId=b.shaderProgram.id;e.receiveShaderCastShadows=b.castShadows}return e};I.createCastDerivedCommand=function(a,b,c,d,f){r(f)||(f={});if(b.castShadows){var g=f.castCommands;r(g)||(g=f.castCommands=[]);var h=f.castShaderProgramId,k=a.length;g.length=k;for(var l=0;l<k;++l){var m=g,p=l,q=a[l],t=c,w=b,u=d,v=h,y=g[l],z=void 0,A=void 0,E=void 0;r(y)&&(z=y.shaderProgram,A=y.renderState,E=y.uniformMap);y=K.shallowClone(w,y);y.castShadows=!0;y.receiveShadows=!1;if(!r(z)||v!==w.shaderProgram.id||t){var A=w.shaderProgram,t=w.pass===N.GLOBE,B=w.pass!==N.TRANSLUCENT,v=q._isPointLight,C=q._usesDepthTexture,E=X.getShadowCastShaderKeyword(v,t,C,B),z=u.shaderCache.getDerivedShaderProgram(A,E);if(!r(z))var G=A.fragmentShaderSource,z=X.createShadowCastVertexShader(A.vertexShaderSource,v,t),B=X.createShadowCastFragmentShader(G,v,C,B),z=u.shaderCache.createDerivedShaderProgram(A,E,{vertexShaderSource:z,fragmentShaderSource:B,attributeLocations:A._attributeLocations});A=q._primitiveRenderState;v?A=q._pointRenderState:t&&(A=q._terrainRenderState);w.renderState.cull.enabled||(A=e(A,!1),A.cull=e(A.cull,!1),A.cull.enabled=!1,A=W.fromCache(A));E=ua(q,w.uniformMap,t)}y.shaderProgram=z;y.renderState=A;y.uniformMap=E;m[p]=y}f.castShaderProgramId=b.shaderProgram.id}return f};I.prototype.isDestroyed=function(){return!1};I.prototype.destroy=function(){ia(this);this._debugLightFrustum=this._debugLightFrustum&&this._debugLightFrustum.destroy();this._debugCameraFrustum=this._debugCameraFrustum&&this._debugCameraFrustum.destroy();this._debugShadowViewCommand=this._debugShadowViewCommand&&this._debugShadowViewCommand.shaderProgram&&this._debugShadowViewCommand.shaderProgram.destroy();for(var a=0;a<this._numberOfCascades;++a)this._debugCascadeFrustums[a]=this._debugCascadeFrustums[a]&&this._debugCascadeFrustums[a].destroy();return u(this)};return I});F("Shaders/PostProcessStages/AdditiveBlend",[],function(){return"uniform sampler2D colorTexture;\nuniform sampler2D colorTexture2;\nuniform vec2 center;\nuniform float radius;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 color0 \x3d texture2D(colorTexture, v_textureCoordinates);\nvec4 color1 \x3d texture2D(colorTexture2, v_textureCoordinates);\nfloat x \x3d length(gl_FragCoord.xy - center) / radius;\nfloat t \x3d smoothstep(0.5, 0.8, x);\ngl_FragColor \x3d mix(color0 + color1, color1, t);\n}\n"});F("Shaders/PostProcessStages/BrightPass",[],function(){return"uniform sampler2D colorTexture;\nuniform float avgLuminance;\nuniform float threshold;\nuniform float offset;\nvarying vec2 v_textureCoordinates;\nfloat key(float avg)\n{\nfloat guess \x3d 1.5 - (1.5 / (avg * 0.1 + 1.0));\nreturn max(0.0, guess) + 0.1;\n}\nvoid main()\n{\nvec4 color \x3d texture2D(colorTexture, v_textureCoordinates);\nvec3 xyz \x3d czm_RGBToXYZ(color.rgb);\nfloat luminance \x3d xyz.r;\nfloat scaledLum \x3d key(avgLuminance) * luminance / avgLuminance;\nfloat brightLum \x3d max(scaledLum - threshold, 0.0);\nfloat brightness \x3d brightLum / (offset + brightLum);\nxyz.r \x3d brightness;\ngl_FragColor \x3d vec4(czm_XYZToRGB(xyz), 1.0);\n}\n"});F("Scene/SceneFramebuffer","../Core/Color ../Core/defined ../Core/destroyObject ../Core/PixelFormat ../Core/combine ../Renderer/ClearCommand ../Renderer/Framebuffer ../Renderer/PixelDatatype ../Renderer/Renderbuffer ../Renderer/RenderbufferFormat ../Renderer/RenderState ../Renderer/Sampler ../Renderer/Texture ../Renderer/TextureMagnificationFilter ../Renderer/TextureMinificationFilter ../Renderer/TextureWrap".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u){function y(){this._disableFbo=this._idFramebuffer=this._framebuffer=this._depthStencilRenderbuffer=this._depthStencilTexture=this._idTexture=this._colorTexture=void 0;this._disableFboChanged=!0;this._disableDepthTexture=this._disableDepthStencilTexture=this._disableTexture=void 0;this._disableCommandArr=[];this._lastFrameBuffer=void 0;this._disableClearCommand=new l({color:new b(0,0,0,0),depth:1,owner:this});this._fxaa=void 0;this._idClearColor=new b(0,0,0,0);this._useHdr=void 0;this._clearCommand=new l({color:new b(0,0,0,0),depth:1,owner:this})}function A(a){a._framebuffer=a._framebuffer&&a._framebuffer.destroy();a._idFramebuffer=a._idFramebuffer&&a._idFramebuffer.destroy();a._colorTexture=a._colorTexture&&a._colorTexture.destroy();a._idTexture=a._idTexture&&a._idTexture.destroy();a._depthStencilTexture=a._depthStencilTexture&&a._depthStencilTexture.destroy();a._depthStencilRenderbuffer=a._depthStencilRenderbuffer&&a._depthStencilRenderbuffer.destroy();a._depthStencilIdTexture=a._depthStencilIdTexture&&a._depthStencilIdTexture.destroy();a._depthStencilIdRenderbuffer=a._depthStencilIdRenderbuffer&&a._depthStencilIdRenderbuffer.destroy();a._disableFbo=a._disableFbo&&a._disableFbo.destroy();a._disableTexture=a._disableTexture&&a._disableTexture.destroy();a._disableFbo=void 0;a._disableTexture=void 0;a._framebuffer=void 0;a._idFramebuffer=void 0;a._colorTexture=void 0;a._idTexture=void 0;a._depthStencilTexture=void 0;a._depthStencilRenderbuffer=void 0;a._depthStencilIdTexture=void 0;a._depthStencilIdRenderbuffer=void 0}y.prototype.update=function(b,d,f){var g=d.width;d=d.height;var l=this._colorTexture;a(l)&&l.width===g&&l.height===d&&f===this._useHdr||(A(this),this._useHdr=f,this._colorTexture=new t({context:b,width:g,height:d,pixelFormat:k.RGBA,pixelDatatype:f?b.halfFloatingPointTexture?e.HALF_FLOAT:e.FLOAT:e.UNSIGNED_BYTE,sampler:new q({wrapS:u.CLAMP_TO_EDGE,wrapT:u.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})}),this._disableTexture=this._disableTexture&&this._disableTexture.destroy(),this._disableTexture=new t({context:b,width:g,height:d,pixelFormat:k.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new q({wrapS:u.CLAMP_TO_EDGE,wrapT:u.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})}),this._disableFboChanged=!0,this._idTexture=new t({context:b,width:g,height:d,pixelFormat:k.RGBA,pixelDatatype:e.UNSIGNED_BYTE,sampler:new q({wrapS:u.CLAMP_TO_EDGE,wrapT:u.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})}),b.depthTexture?(this._depthStencilTexture=new t({context:b,width:g,height:d,pixelFormat:k.DEPTH_STENCIL,pixelDatatype:e.UNSIGNED_INT_24_8,sampler:new q({wrapS:u.CLAMP_TO_EDGE,wrapT:u.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})}),this._depthStencilIdTexture=new t({context:b,width:g,height:d,pixelFormat:k.DEPTH_STENCIL,pixelDatatype:e.UNSIGNED_INT_24_8,sampler:new q({wrapS:u.CLAMP_TO_EDGE,wrapT:u.CLAMP_TO_EDGE,minificationFilter:c.NEAREST,magnificationFilter:r.NEAREST})})):(this._depthStencilRenderbuffer=new h({context:b,width:g,height:d,format:p.DEPTH_STENCIL}),this._depthStencilIdRenderbuffer=new h({context:b,width:g,height:d,format:p.DEPTH_STENCIL})),this._framebuffer=new m({context:b,colorTextures:[this._colorTexture],depthStencilTexture:this._depthStencilTexture,depthStencilRenderbuffer:this._depthStencilRenderbuffer,destroyAttachments:!1}),this._fxaa&&(this._fxaa._disableTexture=this._disableTexture),this._idFramebuffer=new m({context:b,colorTextures:[this._idTexture],depthStencilTexture:this._depthStencilIdTexture,depthStencilRenderbuffer:this._depthStencilIdRenderbuffer,destroyAttachments:!1}))};y.prototype.clear=function(a,c,d){var e=c.framebuffer;c.framebuffer=this._framebuffer;b.clone(d,this._clearCommand.color);this._clearCommand.execute(a,c);c.framebuffer=this._idFramebuffer;b.clone(this._idClearColor,this._clearCommand.color);this._clearCommand.execute(a,c);c.framebuffer=e};y.prototype.getFramebuffer=function(){return this._framebuffer};y.prototype.getIdFramebuffer=function(){return this._idFramebuffer};y.prototype.isDestroyed=function(){return!1};y.prototype.destroy=function(){A(this);return f(this)};y.prototype.getDisableFramebuffer=function(){return this._disableFbo};y.prototype.addCommand=function(a){this._disableCommandArr.push(a)};y.prototype.updateDepthStencilTex=function(b,c,d){this._disableDepthStencilTexture=c.depthStencilTexture;this._disableDepthTexture=c.depthTexture;if(!a(this._disableFbo)||this._disableFboChanged){this._disableFbo=this._disableFbo&&this._disableFbo.destroy();a(this._disableDepthStencilTexture)?this._disableFbo=new m({context:b,colorTextures:[this._disableTexture],depthStencilTexture:this._disableDepthStencilTexture,destroyAttachments:!1}):a(this._disableDepthTexture)?this._disableFbo=new m({context:b,colorTextures:[this._disableTexture],depthTexture:this._disableDepthTexture,destroyAttachments:!1}):this._disableFbo=void 0;for(c=0;c<this._disableCommandArr.length;c++)this._disableCommandArr[c].framebuffer=this._disableFbo;this._disableFboChanged=!1}this._disableCommandArr=[];c=d.framebuffer;d.framebuffer=this._disableFbo;this._disableClearCommand.execute(b,d);d.framebuffer=c};return y});F("Scene/SunPostProcess","../Core/BoundingRectangle ../Core/Cartesian2 ../Core/Cartesian4 ../Core/defined ../Core/destroyObject ../Core/Math ../Core/Matrix4 ../Core/Transforms ../Shaders/PostProcessStages/AdditiveBlend ../Shaders/PostProcessStages/BrightPass ../Shaders/PostProcessStages/GaussianBlur1D ../Shaders/PostProcessStages/PassThrough ./PostProcessStage ./PostProcessStageComposite ./PostProcessStageSampleMode ./PostProcessStageTextureCache ./SceneFramebuffer".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(){this._sceneFramebuffer=new y;var b=Array(6);b[0]=new t({fragmentShader:q,textureScale:.125,forcePowerOfTwo:!0,sampleMode:c.LINEAR});var e=b[1]=new t({fragmentShader:p,uniforms:{avgLuminance:.5,threshold:.25,offset:.1},textureScale:.125,forcePowerOfTwo:!0}),f=this;this._delta=1;this._sigma=2;this._blurStep=new a;b[2]=new t({fragmentShader:d,uniforms:{step:function(){f._blurStep.x=f._blurStep.y=1/e.outputTexture.width;return f._blurStep},delta:function(){return f._delta},sigma:function(){return f._sigma},direction:0},textureScale:.125,forcePowerOfTwo:!0});b[3]=new t({fragmentShader:d,uniforms:{step:function(){f._blurStep.x=f._blurStep.y=1/e.outputTexture.width;return f._blurStep},delta:function(){return f._delta},sigma:function(){return f._sigma},direction:1},textureScale:.125,forcePowerOfTwo:!0});b[4]=new t({fragmentShader:q,sampleMode:c.LINEAR});this._uCenter=new a;this._uRadius=void 0;b[5]=new t({fragmentShader:h,uniforms:{center:function(){return f._uCenter},radius:function(){return f._uRadius},colorTexture2:function(){return f._sceneFramebuffer.getFramebuffer().getColorTexture(0)}}});this._stages=new r({stages:b});for(var g=new u(this),k=b.length,l=0;l<k;++l)b[l]._textureCache=g;this._textureCache=g;this.length=b.length}A.prototype.get=function(a){return this._stages.get(a)};A.prototype.getStageByName=function(a){for(var b=this._stages.length,c=0;c<b;++c){var d=this._stages.get(c);if(d.name===a)return d}};var z=new f,x=new a,D=new a,v=new m;A.prototype.clear=function(a,b,c){this._sceneFramebuffer.clear(a,b,c);this._textureCache.clear(a)};A.prototype.update=function(c){var d=c.context,f=c.viewport;c=this._sceneFramebuffer;c.update(d,f);c=c.getFramebuffer();this._textureCache.update(d);this._stages.update(d,!1);var g=d.uniformState,h=g.sunPositionWC,k=g.view,p=g.viewProjection,q=g.projection,g=m.computeViewportTransformation(f,0,1,v),k=m.multiplyByPoint(k,h,z),f=e.pointToGLWindowCoordinates(p,g,h,x);k.x+=l.SOLAR_RADIUS;g=e.pointToGLWindowCoordinates(q,g,k,k);g=60*a.magnitude(a.subtract(g,f,g));D.x=g;D.y=g;this._uCenter=a.clone(f,this._uCenter);this._uRadius=.15*Math.max(D.x,D.y);var q=d.drawingBufferWidth,k=d.drawingBufferHeight,d=this._stages,r=d.get(0),t=r.outputTexture.width,u=r.outputTexture.height,f=new b;f.width=t;f.height=u;g=m.computeViewportTransformation(f,0,1,v);f=e.pointToGLWindowCoordinates(p,g,h,x);D.x*=t/q;D.y*=u/k;h=r.scissorRectangle;h.x=Math.max(f.x-.5*D.x,0);h.y=Math.max(f.y-.5*D.y,0);h.width=Math.min(D.x,q);h.height=Math.min(D.y,k);for(p=1;4>p;++p)b.clone(h,d.get(p).scissorRectangle);return c};A.prototype.execute=function(a){var b=this._sceneFramebuffer.getFramebuffer().getColorTexture(0),c=this._stages,d=c.length;c.get(0).execute(a,b);for(b=1;b<d;++b)c.get(b).execute(a,c.get(b-1).outputTexture)};A.prototype.copy=function(a,b){if(!k(this._copyColorCommand)){var c=this;this._copyColorCommand=a.createViewportQuadCommand(q,{uniformMap:{colorTexture:function(){return c._stages.get(c._stages.length-1).outputTexture}},owner:this})}this._copyColorCommand.framebuffer=b;this._copyColorCommand.execute(a)};A.prototype.isDestroyed=function(){return!1};A.prototype.destroy=function(){this._textureCache.destroy();this._stages.destroy();return g(this)};return A});F("Scene/View","../Core/BoundingRectangle ../Core/Cartesian3 ../Core/CullingVolume ../Core/defined ../Core/getTimestamp ../Core/Interval ../Core/Math ../Core/Matrix4 ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Renderer/ClearCommand ../Renderer/Pass ../Renderer/PassState ./Camera ./FrustumCommands ./GlobeDepth ./OIT ./PickDepthFramebuffer ./PickFramebuffer ./SceneFramebuffer ./SceneMode ./ShadowMap".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v){function B(a,c,d){var e=a.context,f=[],g=c.frustum.near,h=c.frustum.far,k=a.logarithmicDepthBuffer?a.logarithmicDepthFarToNearRatio:a.farToNearRatio;F(g,h,k,Math.ceil(Math.log(h/g)/Math.log(k)),a.logarithmicDepthBuffer,f,!1,void 0);var l;e.depthTexture&&(l=new u);var m;a._useOIT&&e.depthTexture&&(m=new y(e));a=new t(e);a.viewport=b.clone(d);this.camera=c;this._cameraClone=r.clone(c);this._cameraStartFired=!1;this._cameraMovedTime=void 0;this.viewport=d;this.passState=a;this.pickFramebuffer=new z(e);this.pickDepthFramebuffer=new A;this.sceneFramebuffer=new x;this.globeDepth=l;this.oit=m;this.pickDepths=[];this.debugGlobeDepths=[];this.frustumCommandsList=f;this.debugFrustumStatistics=void 0;this.updateFrustums=!1}function C(a,b){return Math.max(Math.max(Math.max(Math.abs(a.x),Math.abs(b.x)),Math.max(Math.abs(a.y),Math.abs(b.y))),Math.max(Math.abs(a.z),Math.abs(b.z)))}function F(a,b,d,e,f,g,h,l){g.length=e;for(var m=0;m<e;++m){var p,q;h?(p=Math.min(b-l,a+m*l),q=Math.min(b,p+l)):(p=Math.max(a,Math.pow(d,m)*a),q=d*p,f||(q=Math.min(b,q)));var r=g[m];k(r)?(r.near=p,r.far=q):g[m]=new c(p,q)}}var H=new a,J=new a;B.prototype.checkForCameraUpdates=function(b){var c=this.camera,d=this._cameraClone,f=m.EPSILON15,h=1/Math.max(1,C(c.position,d.position));a.multiplyByScalar(c.position,h,H);a.multiplyByScalar(d.position,h,J);if(!(a.equalsEpsilon(H,J,f)&&a.equalsEpsilon(c.direction,d.direction,f)&&a.equalsEpsilon(c.up,d.up,f)&&a.equalsEpsilon(c.right,d.right,f)&&e.equalsEpsilon(c.transform,d.transform,f)&&c.frustum.equalsEpsilon(d.frustum,f)))return this._cameraStartFired||(c.moveStart.raiseEvent(),this._cameraStartFired=!0),this._cameraMovedTime=g(),r.clone(c,d),!0;this._cameraStartFired&&g()-this._cameraMovedTime>b.cameraEventWaitTime&&(c.moveEnd.raiseEvent(),this._cameraStartFired=!1);return!1};var w=new f,G=new l;B.prototype.createPotentiallyVisibleSet=function(a){var b=a.frameState,c=b.camera,e=c.directionWC,f=c.positionWC,g=a._computeCommandList,h=a._overlayCommandList,l=b.commandList;a.debugShowFrustums&&(this.debugFrustumStatistics={totalCommands:0,commandsInFrustums:{}});for(var p=this.frustumCommandsList,r=p.length,t=q.NUMBER_OF_PASSES,u=0;u<r;++u)for(var y=0;y<t;++y)p[u].indices[y]=0;g.length=0;h.length=0;for(var t=Number.MAX_VALUE,u=-Number.MAX_VALUE,y=!1,z=b.shadowState.shadowsEnabled,A=Number.MAX_VALUE,E=-Number.MAX_VALUE,B=Number.MAX_VALUE,C=b.mode===D.SCENE3D?b.occluder:void 0,x=b.cullingVolume,H=w.planes,I=0;5>I;++I)H[I]=x.planes[I];x=w;H=l.length;for(I=0;I<H;++I){var J=l[I],ga=J.pass;if(ga===q.COMPUTE)g.push(J);else if(ga===q.OVERLAY)h.push(J);else{var ka=J.boundingVolume;if(k(ka)){if(!a.isVisible(J,x,C))continue;G=ka.computePlaneDistances(f,e,G);t=Math.min(t,G.start);u=Math.max(u,G.stop);z&&J.receiveShadows&&G.start<v.MAXIMUM_DISTANCE&&!(ga===q.GLOBE&&-100>G.start&&100<G.stop)&&(ka=G.stop-G.start,ga!==q.GLOBE&&100>G.start&&(B=Math.min(B,ka)),A=Math.min(A,G.start),E=Math.max(E,G.stop))}else G.start=c.frustum.near,G.stop=c.frustum.far,y=!(J instanceof d);ga=a;ka=G;ga.debugShowFrustums&&(J.debugOverlappingFrustums=0);for(var na=this.frustumCommandsList,ia=na.length,la=0;la<ia;++la){var ha=na[la];if(!(ka.start>ha.far)){if(ka.stop<ha.near)break;var pa=J.pass,oa=ha.indices[pa]++;ha.commands[pa][oa]=J;ga.debugShowFrustums&&(J.debugOverlappingFrustums|=1<<la);if(J.executeInClosestFrustum)break}}ga.debugShowFrustums&&(ka=this.debugFrustumStatistics.commandsInFrustums,ka[J.debugOverlappingFrustums]=k(ka[J.debugOverlappingFrustums])?ka[J.debugOverlappingFrustums]+1:1,++this.debugFrustumStatistics.totalCommands);ga.updateDerivedCommands(J)}}y?(t=c.frustum.near,u=c.frustum.far):(t=Math.min(Math.max(t,c.frustum.near),c.frustum.far),u=Math.max(Math.min(u,c.frustum.far),t),z&&(A=Math.min(Math.max(A,c.frustum.near),c.frustum.far),E=Math.max(Math.min(E,c.frustum.far),A)));z&&(b.shadowState.nearPlane=A,b.shadowState.farPlane=E,b.shadowState.closestObjectSize=B);e=a.mode===D.SCENE2D;g=(f=b.useLogDepth)?a.logarithmicDepthFarToNearRatio:a.farToNearRatio;e?(u=Math.min(u,c.position.z+a.nearToFarDistance2D),t=Math.min(t,u),c=Math.ceil(Math.max(1,u-t)/a.nearToFarDistance2D)):c=Math.ceil(Math.log(u/t)/Math.log(g));if(this.updateFrustums||t!==Number.MAX_VALUE&&(c!==r||0!==p.length&&(t<p[0].near||u>p[r-1].far&&(f||!m.equalsEpsilon(u,p[r-1].far,m.EPSILON8)))))this.updateFrustums=!1,F(t,u,g,c,f,p,e,a.nearToFarDistance2D),this.createPotentiallyVisibleSet(a);a=b.frustumSplits;a.length=c+1;for(b=0;b<c;++b)a[b]=p[b].near,b===c-1&&(a[b+1]=p[b].far)};B.prototype.destroy=function(){this.pickFramebuffer=this.pickFramebuffer&&this.pickFramebuffer.destroy();this.pickDepthFramebuffer=this.pickDepthFramebuffer&&this.pickDepthFramebuffer.destroy();this.sceneFramebuffer=this.sceneFramebuffer&&this.sceneFramebuffer.destroy();this.globeDepth=this.globeDepth&&this.globeDepth.destroy();this.oit=this.oit&&this.oit.destroy();var a,b,c=this.pickDepths,d=this.debugGlobeDepths;b=c.length;for(a=0;a<b;++a)c[a].destroy();b=d.length;for(a=0;a<b;++a)d[a].destroy()};return B});F("Scene/Scene","../Core/ApproximateTerrainHeights ../Core/BoundingRectangle ../Core/BoundingSphere ../Core/BoxGeometry ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartographic ../Core/Check ../Core/Color ../Core/ColorGeometryInstanceAttribute ../Core/createGuid ../Core/CullingVolume ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/DeveloperError ../Core/EllipsoidGeometry ../Core/Event ../Core/GeographicProjection ../Core/GeometryInstance ../Core/GeometryPipeline ../Core/Intersect ../Core/JulianDate ../Core/Math ../Core/Matrix4 ../Core/mergeSort ../Core/Occluder ../Core/OrthographicFrustum ../Core/OrthographicOffCenterFrustum ../Core/PerspectiveFrustum ../Core/PerspectiveOffCenterFrustum ../Core/PixelFormat ../Core/Ray ../Core/RequestScheduler ../Core/ShowGeometryInstanceAttribute ../Core/TaskProcessor ../Core/Transforms ../Renderer/ClearCommand ../Renderer/ComputeEngine ../Renderer/Context ../Renderer/ContextLimits ../Renderer/DrawCommand ../Renderer/Framebuffer ../Renderer/Pass ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/Texture ../ThirdParty/when ./BrdfLutGenerator ./Camera ./Cesium3DTileFeature ./Cesium3DTilePass ./Cesium3DTilePassState ./Cesium3DTileset ./CreditDisplay ./DebugCameraPrimitive ./DepthPlane ./DerivedCommand ./DeviceOrientationCameraController ./Fog ./FrameState ./GlobeDepth ./InvertClassification ./JobScheduler ./MapMode2D ./OctahedralProjectedCubeMap ./PerformanceDisplay ./PerInstanceColorAppearance ./PickDepth ./PostProcessStageCollection ./Primitive ./PrimitiveCollection ./SceneMode ./SceneTransforms ./SceneTransitioner ./ScreenSpaceCameraController ./ShadowMap ./StencilConstants ./SunPostProcess ./TweenCollection ./View".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,F,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga,ka,na,ia,la,ha,pa,oa,qa,ua,ta,wa,za,Da,Ba,ra,Ea,Ga,Ca,ya,Aa,Ua,sa,Va,xa,Ha,Ma,Ia,La,Fa,Ja,Qa,va){function I(a,b,c){this.ray=a;this.width=b;this.tilesets=c;this.ready=!1;this.deferred=fa.defer();this.promise=this.deferred.promise}function Oa(b){b=t(b,t.EMPTY_OBJECT);var c=b.canvas,e=b.contextOptions,f=b.creditContainer,g=b.creditViewport;if(!r(c))throw new y("options and options.canvas are required.");var k=r(f),e=new R(c,e);k||(f=document.createElement("div"),f.style.position="absolute",f.style.bottom="0",f.style["text-shadow"]="0 0 2px #000000",f.style.color="#ffffff",f.style["font-size"]="10px",f.style["padding-right"]="5px",c.parentNode.appendChild(f));r(g)||(g=c.parentNode);this._id=d();this._jobScheduler=new ra;this._frameState=new za(e,new pa(f," \u2022 ",g),this._jobScheduler);this._frameState.scene3DOnly=t(b.scene3DOnly,!1);this._removeCreditContainer=!k;this._creditContainer=f;this._canvas=c;this._context=e;this._computeEngine=new M(e);this._globe=void 0;this._primitives=new Va;this._groundPrimitives=new Va;this._mostDetailedRayPicks=[];this._logDepthBuffer=e.fragmentDepth;this._logDepthBufferDirty=!0;this._tweens=new Qa;this._shaderFrameCount=0;this._sunPostProcess=void 0;this._computeCommandList=[];this._overlayCommandList=[];this._useOIT=t(b.orderIndependentTranslucency,!0);this._executeOITFunction=void 0;this._depthPlane=new qa;this._clearColorCommand=new W({color:new h,stencil:0,owner:this});this._depthClearCommand=new W({depth:1,owner:this});this._stencilClearCommand=new W({stencil:0});this._classificationStencilClearCommand=new W({stencil:0,renderState:da.fromCache({stencilMask:Fa.CLASSIFICATION_MASK})});this._depthOnlyRenderStateCache={};this._pickRenderStateCache={};this._transitioner=new Ma(this);this._preUpdate=new z;this._postUpdate=new z;this._renderError=new z;this._preRender=new z;this._postRender=new z;this._pickPositionCache={};this._pickPositionCacheDirty=!1;this._minimumDisableDepthTestDistance=0;this.rethrowRenderErrors=!1;this.completeMorphOnUserInput=!0;this.morphStart=new z;this.morphComplete=new z;this.sun=this.skyStar=this.constellation=this.flatClound=this.clound=this.skyAtmosphere=this.skyBox=void 0;this.sunBloom=!0;this.moon=this._sunBloom=void 0;this.backgroundColor=h.clone(h.BLACK);this._mode=xa.SCENE3D;this._mapProjection=r(b.mapProjection)?b.mapProjection:new x;this.morphTime=1;this.farToNearRatio=1E3;this.logarithmicDepthFarToNearRatio=1E9;this.nearToFarDistance2D=175E4;this.debugCommandFilter=void 0;this.debugShowGlobeDepth=this.debugShowFramesPerSecond=this.debugShowFrustums=this.debugShowCommands=!1;this.debugShowDepthFrustum=1;this._debugShowFrustumPlanes=this.debugShowFrustumPlanes=!1;this._debugFrustumPlanes=void 0;this.useDepthPicking=!0;this.pickTranslucentDepth=!1;this.cameraEventWaitTime=500;this.fog=new wa;this._sunCamera=new ka(this);this.shadowMap=new La({context:e,lightCamera:this._sunCamera,enabled:t(b.shadows,!1)});this.invertClassification=!1;this.invertClassificationColor=h.clone(h.WHITE);this._actualInvertClassificationColor=h.clone(this._invertClassificationColor);this._invertClassification=new Ba;this.eyeSeparation=this.focalLength=void 0;this.postProcessStages=new Ua;this._brdfLutGenerator=new ga;this._terrainExaggeration=t(b.terrainExaggeration,1);this._debugVolume=this._performanceDisplay=void 0;this._screenSpaceCameraController=new Ia(this);this._mapMode2D=t(b.mapMode2D,Ea.INFINITE_SCROLL);this._environmentState={skyBoxCommand:void 0,skyAtmosphereCommand:void 0,sunDrawCommand:void 0,sunComputeCommand:void 0,moonCommand:void 0,cloundCommand:void 0,flatCloundCommand:void 0,isSunVisible:!1,isMoonVisible:!1,isReadyForAtmosphere:!1,isSkyAtmosphereVisible:!1,clearGlobeDepth:!1,useDepthPlane:!1,renderTranslucentDepthForPick:!1,originalFramebuffer:void 0,useGlobeDepthFramebuffer:!1,useOIT:!1,useInvertClassification:!1,usePostProcess:!1,usePostProcessSelected:!1,useWebVR:!1};this._useWebVR=!1;this._aspectRatioVR=this._cameraVR=void 0;this.requestRenderMode=t(b.requestRenderMode,!1);this._renderRequested=!0;this.maximumRenderTimeChange=t(b.maximumRenderTimeChange,0);this._frameRateMonitor=this._lastRenderTime=void 0;this._removeRequestListenerCallback=O.requestCompletedEvent.addEventListener(Ib(this));this._removeTaskProcessorListenerCallback=aa.taskCompletedEvent.addEventListener(Ib(this));this._removeGlobeCallbacks=[];b=new a(0,0,e.drawingBufferWidth,e.drawingBufferHeight);c=new ka(this);this._logDepthBuffer&&(c.frustum.near=.1,c.frustum.far=1E10);f=new a(0,0,1,1);g=new ka(this);g.frustum=new G({width:.1,aspectRatio:1,near:.1});this._pickOffscreenView=new va(this,g,f);this.preloadFlightCamera=new ka(this);this.preloadFlightCullingVolume=void 0;this.pickOffscreenDefaultWidth=.1;this._view=this._defaultView=new va(this,c,b);this._hdrDirty=this._hdr=void 0;this.highDynamicRange=!0;this.gamma=2.2;this._sunColor=new l(1.8,1.85,2);this._specularEnvironmentMapAtlas=this.specularEnvironmentMaps=this.sphericalHarmonicCoefficients=void 0;b=C.now();c=this._frameState;c.frameNumber=0;c.time=C.clone(b,c.time);Wa(this);this.initializeFrame()}function Ta(a,b,c){var d=a._frameState,e=a._context,f=a._view.oit,g=d.shadowState.lightShadowMaps,d=d.shadowState.lightShadowsEnabled,h=b.derivedCommands;r(b.pickId)&&(h.picking=ua.createPickDerivedCommand(a,b,e,h.picking));b.pickOnly||(h.depth=ua.createDepthOnlyDerivedCommand(a,b,e,h.depth));h.originalCommand=b;a._hdr&&(h.hdr=ua.createHdrCommand(b,e,h.hdr),b=h.hdr.command,h=b.derivedCommands);d&&b.receiveShadows&&(h.shadows=La.createReceiveDerivedCommand(g,b,c,e,h.shadows));b.pass===ca.TRANSLUCENT&&r(f)&&f.isSupported()&&(d&&b.receiveShadows?(h.oit=r(h.oit)?h.oit:{},h.oit.shadows=f.createDerivedCommands(h.shadows.receiveCommand,e,h.oit.shadows)):h.oit=f.createDerivedCommands(b,e,h.oit))}function Ka(a){a.render=!1;a.pick=!1;a.depth=!1;a.postProcess=!1;a.offscreen=!1}function Wa(a){var b=a.camera,c=a._frameState;c.commandList.length=0;c.shadowMaps.length=0;c.brdfLutGenerator=a._brdfLutGenerator;c.environmentMap=a.skyBox&&a.skyBox._cubeMap;c.mode=a._mode;c.morphTime=a.morphTime;c.mapProjection=a.mapProjection;c.camera=b;c.cullingVolume=b.frustum.computeCullingVolume(b.positionWC,b.directionWC,b.upWC);b=a.globe;a._mode===xa.SCENE3D&&r(b)&&b.show?(Fc.radius=b.ellipsoid.minimumRadius,b=mb=w.fromBoundingSphere(Fc,a.camera.positionWC,mb)):b=void 0;c.occluder=b;c.terrainExaggeration=a._terrainExaggeration;c.minimumDisableDepthTestDistance=a._minimumDisableDepthTestDistance;c.invertClassification=a.invertClassification;c.useLogDepth=a._logDepthBuffer&&!(a.camera.frustum instanceof G||a.camera.frustum instanceof E);c.sunColor=a._sunColor;r(a._specularEnvironmentMapAtlas)&&a._specularEnvironmentMapAtlas.ready?(c.specularEnvironmentMaps=a._specularEnvironmentMapAtlas.texture,c.specularEnvironmentMapsMaximumLOD=a._specularEnvironmentMapAtlas.maximumMipmapLevel):(c.specularEnvironmentMaps=void 0,c.specularEnvironmentMapsMaximumLOD=void 0);c.sphericalHarmonicCoefficients=a.sphericalHarmonicCoefficients;a._actualInvertClassificationColor=h.clone(a.invertClassificationColor,a._actualInvertClassificationColor);Ba.isTranslucencySupported(a._context)||(a._actualInvertClassificationColor.alpha=1);c.invertClassificationColor=a._actualInvertClassificationColor;r(a.globe)?c.maximumScreenSpaceError=a.globe.maximumScreenSpaceError:c.maximumScreenSpaceError=2;Ka(c.passes);c.tilesetPassState=void 0}function Ra(a){var b={};a=a.vertexAttributes;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c].index);return b}function Pa(a,b,c){var d=b.context;c=t(c,a.shaderProgram);var e=c.fragmentShaderSource.clone(),f=[];e.sources=e.sources.map(function(a){a=ba.replaceMain(a,"czm_Debug_main");for(var b=/gl_FragData\[(\d+)\]/g,c;null!==(c=b.exec(a));)-1===f.indexOf(c[1])&&f.push(c[1]);return a});var g=f.length,k="void main() \n{ \n    czm_Debug_main(); \n",l;if(b.debugShowCommands){r(a._debugColor)||(a._debugColor=h.fromRandom());var m=a._debugColor;if(0<g)for(l=0;l<g;++l)k+="    gl_FragData["+f[l]+"].rgb *\x3d vec3("+m.red+", "+m.green+", "+m.blue+"); \n";else k+="    gl_FragColor.rgb *\x3d vec3("+m.red+", "+m.green+", "+m.blue+"); \n"}if(b.debugShowFrustums)if(b=a.debugOverlappingFrustums&1?"1.0":"0.0",m=a.debugOverlappingFrustums&2?"1.0":"0.0",a=a.debugOverlappingFrustums&4?"1.0":"0.0",0<g)for(l=0;l<g;++l)k+="    gl_FragData["+f[l]+"].rgb *\x3d vec3("+b+", "+m+", "+a+"); \n";else k+="    gl_FragColor.rgb *\x3d vec3("+b+", "+m+", "+a+"); \n";e.sources.push(k+"}");a=Ra(c);return V.fromCache({context:d,vertexShaderSource:c.vertexShaderSource,fragmentShaderSource:e,attributeLocations:a})}function hb(a,b,c,d,e){var f=b._frameState;if(!r(b.debugCommandFilter)||b.debugCommandFilter(a))if(a instanceof W)a.execute(c,d);else{if(a.debugShowBoundingVolume&&r(a.boundingVolume)){var g,h=b._frameState,m=h.context;g=a.boundingVolume;r(b._debugVolume)&&b._debugVolume.destroy();var q=l.clone(g.center);if(h.mode!==xa.SCENE3D)var q=H.multiplyByPoint(Zb,q,q),t=h.mapProjection,q=t.unproject(q),q=t.ellipsoid.cartographicToCartesian(q);r(g.radius)?(g=g.radius,g=v.toWireframe(A.createGeometry(new A({radii:new l(g,g,g),vertexFormat:ya.FLAT_VERTEX_FORMAT}))),b._debugVolume=new sa({geometryInstances:new D({geometry:g,modelMatrix:H.fromTranslation(q),attributes:{color:new p(1,0,0,1)}}),appearance:new ya({flat:!0,translucent:!1}),asynchronous:!1})):(t=g.halfAxes,g=v.toWireframe(k.createGeometry(k.fromDimensions({dimensions:new l(2,2,2),vertexFormat:ya.FLAT_VERTEX_FORMAT}))),b._debugVolume=new sa({geometryInstances:new D({geometry:g,modelMatrix:H.fromRotationTranslation(t,q,new H),attributes:{color:new p(1,0,0,1)}}),appearance:new ya({flat:!0,translucent:!1}),asynchronous:!1}));q=h.commandList;g=h.commandList=[];b._debugVolume.update(h);g=g[0];h.useLogDepth&&(g=ua.createLogDepthCommand(g,m).command);var w;r(e)&&(w=d.framebuffer,d.framebuffer=e);g.execute(m,d);r(w)&&(d.framebuffer=w);h.commandList=q}f.useLogDepth&&r(a.derivedCommands)&&r(a.derivedCommands.logDepth)&&(a=a.derivedCommands.logDepth.command);e=f.passes;!e.pick&&b._hdr&&r(a.derivedCommands)&&r(a.derivedCommands.hdr)&&(a=a.derivedCommands.hdr.command);if(e.pick||e.depth){if(e.pick&&!e.depth&&r(a.derivedCommands)&&r(a.derivedCommands.picking)){a=a.derivedCommands.picking.pickCommand;a.execute(c,d);return}if(r(a.derivedCommands)&&r(a.derivedCommands.depth)){a=a.derivedCommands.depth.depthOnlyCommand;a.execute(c,d);return}}b.debugShowCommands||b.debugShowFrustums?(c=Q.shallowClone(a),c.shaderProgram=Pa(a,b),c.execute(b.context,d),c.shaderProgram.destroy()):f.shadowState.lightShadowsEnabled&&a.receiveShadows&&r(a.derivedCommands.shadows)?a.derivedCommands.shadows.receiveCommand.execute(c,d):a.execute(c,d)}}function Hb(a,b,c,d){b=b._frameState;var e=a.derivedCommands;r(e)&&(b.useLogDepth&&r(e.logDepth)&&(a=e.logDepth.command),e=a.derivedCommands,r(e.picking)?(a=e.picking.pickCommand,a.execute(c,d)):r(e.depth)&&(a=e.depth.depthOnlyCommand,a.execute(c,d)))}function db(a,b,c){return b.boundingVolume.distanceSquaredTo(c)-a.boundingVolume.distanceSquaredTo(c)}function tb(a,b,c){return a.boundingVolume.distanceSquaredTo(c)-b.boundingVolume.distanceSquaredTo(c)+F.EPSILON12}function pb(a,b,c,d,e){var f=a.context;J(d,db,a.camera.positionWC);r(e)&&b(e.unclassifiedCommand,a,f,c);e=d.length;for(var g=0;g<e;++g)b(d[g],a,f,c)}function cc(a,b,c,d,e){var f=a.context;J(d,tb,a.camera.positionWC);r(e)&&b(e.unclassifiedCommand,a,f,c);e=d.length;for(var g=0;g<e;++g)b(d[g],a,f,c)}function sc(a,b){var c=a._view.debugGlobeDepths,d=c[b];!r(d)&&a.context.depthTexture&&(d=new Da,c[b]=d);return d}function Za(a,b){var c=a._view.pickDepths,d=c[b];r(d)||(d=new Aa,c[b]=d);return d}function tc(a,b){var c=a.camera,d=a.context,e=d.uniformState;e.updateCamera(c);var f;f=r(c.frustum.fov)?c.frustum.clone(Gc):r(c.frustum.infiniteProjectionMatrix)?c.frustum.clone(Na):r(c.frustum.width)?c.frustum.clone(Ob):c.frustum.clone(lb);f.near=c.frustum.near;f.far=c.frustum.far;e.updateFrustum(f);e.updatePass(ca.ENVIRONMENT);var g=a._frameState.passes,h=g.pick,k=a._environmentState,l=a._view,m=k.renderTranslucentDepthForPick,p=k.useWebVR;if(!h){var q=k.skyBoxCommand;r(q)&&hb(q,a,d,b);if(a.mode===xa.SCENE3D&&a.constellation&&a.constellation.show){var q=c.frustum.near,t=c.frustum.far;f.near=q;f.far=10*a.constellation.skyRadius;e.updateFrustum(f);k.skyStarCommand&&!h&&hb(k.skyStarCommand,a,d,b);k.constellationCommand&&!h&&hb(k.constellationCommand,a,d,b);f.near=q;f.far=t;e.updateFrustum(f)}k.isSunVisible&&(k.sunDrawCommand.execute(d,b),a.sunBloom&&!p&&(p=k.useGlobeDepthFramebuffer?l.globeDepth.framebuffer:k.usePostProcess?l.sceneFramebuffer.getFramebuffer():k.originalFramebuffer,a._sunPostProcess.execute(d),a._sunPostProcess.copy(d,p),b.framebuffer=p));k.isMoonVisible&&k.moonCommand.execute(d,b);k.isSkyAtmosphereVisible&&hb(k.skyAtmosphereCommand,a,d,b)}k.useOIT?(r(a._executeOITFunction)||(a._executeOITFunction=function(a,b,c,d,e){l.oit.executeCommands(a,b,c,d,e)}),g=a._executeOITFunction):g=g.render?pb:cc;for(var p=k.clearGlobeDepth,q=k.useDepthPlane,t=a._depthClearCommand,w=a._stencilClearCommand,u=a._classificationStencilClearCommand,v=a._depthPlane,y=k.usePostProcessSelected,z=c.position.z,A,B=l.frustumCommandsList,E=B.length,C=0;C<E;++C){var G=E-C-1,D=B[G];a.mode===xa.SCENE2D?(c.position.z=z-D.near+1,f.far=Math.max(1,D.far-D.near),f.near=1,e.update(a.frameState)):(f.near=0!==G?D.near*a.opaqueFrustumNearOffset:D.near,f.far=D.far);e.updateFrustum(f);var x=a.debugShowGlobeDepth?sc(a,G):l.globeDepth,H;a.debugShowGlobeDepth&&r(x)&&k.useGlobeDepthFramebuffer&&(x.update(d,b,l.viewport),x.clear(d,b,a._clearColorCommand.color),H=b.framebuffer,b.framebuffer=x.framebuffer);t.execute(d,b);d.stencilBuffer&&w.execute(d,b);e.updatePass(ca.GLOBE);var F=D.commands[ca.GLOBE],I=D.indices[ca.GLOBE];for(A=0;A<I;++A)hb(F[A],a,d,b);r(x)&&k.useGlobeDepthFramebuffer&&x.executeCopyDepth(d,b);a.debugShowGlobeDepth&&r(x)&&k.useGlobeDepthFramebuffer&&(b.framebuffer=H);e.updatePass(ca.TERRAIN_CLASSIFICATION);F=D.commands[ca.TERRAIN_CLASSIFICATION];I=D.indices[ca.TERRAIN_CLASSIFICATION];for(A=0;A<I;++A)hb(F[A],a,d,b);p&&(t.execute(d,b),q&&v.execute(d,b));if(!k.useInvertClassification||h){e.updatePass(ca.CESIUM_3D_TILE);F=D.commands[ca.CESIUM_3D_TILE];I=D.indices[ca.CESIUM_3D_TILE];for(A=0;A<I;++A)hb(F[A],a,d,b);if(0<I)for(r(x)&&k.useGlobeDepthFramebuffer&&x.executeUpdateDepth(d,b,p),e.updatePass(ca.CESIUM_3D_TILE_CLASSIFICATION),F=D.commands[ca.CESIUM_3D_TILE_CLASSIFICATION],I=D.indices[ca.CESIUM_3D_TILE_CLASSIFICATION],A=0;A<I;++A)hb(F[A],a,d,b)}else{a._invertClassification.clear(d,b);var K=b.framebuffer;b.framebuffer=a._invertClassification._fbo;e.updatePass(ca.CESIUM_3D_TILE);F=D.commands[ca.CESIUM_3D_TILE];I=D.indices[ca.CESIUM_3D_TILE];for(A=0;A<I;++A)hb(F[A],a,d,b);r(x)&&k.useGlobeDepthFramebuffer&&x.executeUpdateDepth(d,b,p);e.updatePass(ca.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW);F=D.commands[ca.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW];I=D.indices[ca.CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW];for(A=0;A<I;++A)hb(F[A],a,d,b);b.framebuffer=K;a._invertClassification.executeClassified(d,b);1===a.frameState.invertClassificationColor.alpha&&a._invertClassification.executeUnclassified(d,b);0<I&&d.stencilBuffer&&u.execute(d,b);e.updatePass(ca.CESIUM_3D_TILE_CLASSIFICATION);F=D.commands[ca.CESIUM_3D_TILE_CLASSIFICATION];I=D.indices[ca.CESIUM_3D_TILE_CLASSIFICATION];for(A=0;A<I;++A)hb(F[A],a,d,b)}0<I&&d.stencilBuffer&&w.execute(d,b);e.updatePass(ca.OPAQUE);F=D.commands[ca.OPAQUE];I=D.indices[ca.OPAQUE];for(A=0;A<I;++A)hb(F[A],a,d,b);0!==G&&a.mode!==xa.SCENE2D&&(f.near=D.near,e.updateFrustum(f));var L;!h&&k.useInvertClassification&&1>a.frameState.invertClassificationColor.alpha&&(L=a._invertClassification);e.updatePass(ca.TRANSLUCENT);F=D.commands[ca.TRANSLUCENT];F.length=D.indices[ca.TRANSLUCENT];g(a,hb,b,F,L);d.depthTexture&&a.useDepthPicking&&(k.useGlobeDepthFramebuffer||m)&&(A=m?b.framebuffer.depthStencilTexture:x.framebuffer.depthStencilTexture,F=Za(a,G),F.update(d,A),F.executeCopyDepth(d,b));if(!h&&y){x=b.framebuffer;b.framebuffer=l.sceneFramebuffer.getIdFramebuffer();f.near=0!==G?D.near*a.opaqueFrustumNearOffset:D.near;f.far=D.far;e.updateFrustum(f);e.updatePass(ca.GLOBE);F=D.commands[ca.GLOBE];I=D.indices[ca.GLOBE];for(A=0;A<I;++A)Hb(F[A],a,d,b);p&&(t.framebuffer=b.framebuffer,t.execute(d,b),t.framebuffer=void 0);p&&q&&v.execute(d,b);e.updatePass(ca.CESIUM_3D_TILE);F=D.commands[ca.CESIUM_3D_TILE];I=D.indices[ca.CESIUM_3D_TILE];for(A=0;A<I;++A)Hb(F[A],a,d,b);e.updatePass(ca.OPAQUE);F=D.commands[ca.OPAQUE];I=D.indices[ca.OPAQUE];for(A=0;A<I;++A)Hb(F[A],a,d,b);e.updatePass(ca.TRANSLUCENT);F=D.commands[ca.TRANSLUCENT];I=D.indices[ca.TRANSLUCENT];for(A=0;A<I;++A)Hb(F[A],a,d,b);b.framebuffer=x}}k.cloundCommand&&!h&&hb(k.cloundCommand,a,d,b);k.flatCloundCommand&&!h&&hb(k.flatCloundCommand,a,d,b)}function wc(a){a.context.uniformState.updatePass(ca.COMPUTE);var b=a._environmentState.sunComputeCommand;r(b)&&b.execute(a._computeEngine);for(var b=a._computeCommandList,c=b.length,d=0;d<c;++d)b[d].execute(a._computeEngine)}function Xb(a){var b=a.frameState,c=b.shadowState.shadowMaps,d=c.length;if(b.shadowState.shadowsEnabled)for(var b=a.context,e=b.uniformState,f=0;f<d;++f){var g=c[f];if(!g.outOfView){var h,k=g.passes,l=k.length;for(h=0;h<l;++h)k[h].commandList.length=0;h=a;for(var k=a.frameState.commandList,m=g.shadowMapCullingVolume,p=g.isPointLight,q=g.passes,r=q.length,t=k.length,w=0;w<t;++w){var u=k[w];h.updateDerivedCommands(u);if(u.castShadows&&(u.pass===ca.GLOBE||u.pass===ca.CESIUM_3D_TILE||u.pass===ca.OPAQUE||u.pass===ca.TRANSLUCENT)&&h.isVisible(u,m))if(p)for(var v=0;v<r;++v)q[v].commandList.push(u);else if(1===r)q[0].commandList.push(u);else for(var v=!1,y=r-1;0<=y;--y)if(h.isVisible(u,q[y].cullingVolume))q[y].commandList.push(u),v=!0;else if(v)break}for(h=0;h<l;++h)for(k=g.passes[h],e.updateCamera(k.camera),g.updatePass(b,h),m=k.commandList.length,p=0;p<m;++p)q=k.commandList[p],e.updatePass(q.pass),hb(q.derivedCommands.shadows.castCommands[f],a,b,k.passState)}}}function dc(b,c,d){var e=b._frameState.mode;if(b._environmentState.useWebVR){var f=b._view,e=f.camera,g=b._environmentState.renderTranslucentDepthForPick;ad(b,c,d);g||ec(b);f.createPotentiallyVisibleSet(b);g||(wc(b),Xb(b));d=c.viewport;d.x=0;d.y=0;d.width*=.5;f=ka.clone(e,b._cameraVR);f.frustum=e.frustum;var h=e.frustum.near,k=h*t(b.focalLength,5),m=t(b.eyeSeparation,k/30),g=l.multiplyByScalar(f.right,.5*m,nb);e.frustum.aspectRatio=d.width/d.height;h=.5*m*h/k;l.add(f.position,g,e.position);e.frustum.xOffset=h;tc(b,c);d.x=d.width;l.subtract(f.position,g,e.position);e.frustum.xOffset=-h;tc(b,c);ka.clone(f,e)}else if(e!==xa.SCENE2D||b._mapMode2D===Ea.ROTATE)ja(!0,b,c,d);else{ad(b,c,d);e=b.context;d=b.frameState;f=b.camera;g=c.viewport;h=a.clone(g,Sb);c.viewport=h;k=wb;b.mapProjection.project(Cb,k);var m=l.clone(f.position,xb),p=H.clone(f.transform,yb),q=f.frustum.clone();f._setTransform(H.IDENTITY);var r=H.computeViewportTransformation(h,0,1,rb),w=f.frustum.projectionMatrix,u=f.positionWC.y,v=l.fromElements(F.sign(u)*k.x-u,0,-f.positionWC.x,oc),r=U.pointToGLWindowCoordinates(w,r,v,sb);r.x=Math.floor(r.x);w=h.x;v=h.width;if(0===u||r.x<=w||r.x>=w+v)ja(!0,b,c);else{if(1>Math.abs(w+.5*v-r.x))h.width=r.x-h.x,f.position.x*=F.sign(f.position.x),f.frustum.right=0,d.cullingVolume=f.frustum.computeCullingVolume(f.positionWC,f.directionWC,f.upWC),e.uniformState.update(d),ja(!0,b,c),h.x=r.x,f.position.x=-f.position.x,f.frustum.right=-f.frustum.left,f.frustum.left=0;else if(r.x>w+.5*v){h.width=r.x-w;var y=f.frustum.right;f.frustum.right=k.x-u;d.cullingVolume=f.frustum.computeCullingVolume(f.positionWC,f.directionWC,f.upWC);e.uniformState.update(d);ja(!0,b,c);h.x=r.x;h.width=w+v-r.x;f.position.x=-f.position.x;f.frustum.left=-f.frustum.right;f.frustum.right=y-2*f.frustum.right}else h.x=r.x,h.width=w+v-r.x,v=f.frustum.left,f.frustum.left=-k.x-u,d.cullingVolume=f.frustum.computeCullingVolume(f.positionWC,f.directionWC,f.upWC),e.uniformState.update(d),ja(!0,b,c),h.x=w,h.width=r.x-w,f.position.x=-f.position.x,f.frustum.right=-f.frustum.left,f.frustum.left=v-2*f.frustum.left;d.cullingVolume=f.frustum.computeCullingVolume(f.positionWC,f.directionWC,f.upWC);e.uniformState.update(d);ja(!1,b,c)}f._setTransform(p);l.clone(m,f.position);f.frustum=q.clone();c.viewport=g}}function ja(a,b,c,d){var e=b._view,f=b._environmentState.renderTranslucentDepthForPick;a||f||(b.frameState.commandList.length=0);f||ec(b);e.createPotentiallyVisibleSet(b);a&&(r(d)&&ad(b,c,d),f||(wc(b),Xb(b)));tc(b,c)}function uc(a){var b=a._frameState,c=a._view,d=a._environmentState,e=b.passes.offscreen,f=a.skyAtmosphere,g=a.globe;!b.passes.render||a._mode!==xa.SCENE2D&&c.camera.frustum instanceof G?(d.skyAtmosphereCommand=void 0,d.skyBoxCommand=void 0,d.sunDrawCommand=void 0,d.sunComputeCommand=void 0,d.moonCommand=void 0,d.cloundCommand=void 0,d.flatCloundCommand=void 0,d.skyStarCommand=void 0,d.constellationCommand=void 0):(r(f)&&r(g)&&(f.setDynamicAtmosphereColor(g.enableLighting),d.isReadyForAtmosphere=d.isReadyForAtmosphere||0<g._surface._tilesToRender.length),d.skyAtmosphereCommand=r(f)?f.update(b):void 0,d.skyBoxCommand=r(a.skyBox)?a.skyBox.update(b,a._hdr):void 0,c=r(a.sun)?a.sun.update(b,c.passState,a._hdr):void 0,d.sunDrawCommand=r(c)?c.drawCommand:void 0,d.sunComputeCommand=r(c)?c.computeCommand:void 0,d.moonCommand=r(a.moon)?a.moon.update(b):void 0,d.cloundCommand=r(a.clound)?a.clound.update(b):void 0,d.flatCloundCommand=r(a.flatClound)?a.flatClound.update(b):void 0,d.skyStarCommand=r(a.skyStar)?a.skyStar.update(b):void 0,d.constellationCommand=r(a.constellation)?a.constellation.update(b):void 0);g=d.clearGlobeDepth=r(g)&&(!g.depthTestAgainstTerrain||a.mode===xa.SCENE2D);(d.useDepthPlane=g&&a.mode===xa.SCENE3D)&&a._depthPlane.update(b);d.renderTranslucentDepthForPick=!1;d.useWebVR=a._useWebVR&&a.mode!==xa.SCENE2D&&!e;e=b.mode===xa.SCENE3D?b.occluder:void 0;g=b.cullingVolume;c=gb.planes;for(f=0;5>f;++f)c[f]=g.planes[f];g=gb;d.isSkyAtmosphereVisible=r(d.skyAtmosphereCommand)&&d.isReadyForAtmosphere;d.isSunVisible=a.isVisible(d.sunDrawCommand,g,e);d.isMoonVisible=a.isVisible(d.moonCommand,g,e);d=a.specularEnvironmentMaps;e=a._specularEnvironmentMapAtlas;!r(d)||r(e)&&e.url===d?!r(d)&&r(e)&&(e.destroy(),a._specularEnvironmentMapAtlas=void 0):(e&&e.destroy(),a._specularEnvironmentMapAtlas=new Ga(d));r(a._specularEnvironmentMapAtlas)&&a._specularEnvironmentMapAtlas.update(b)}function ec(a){var b=a._frameState;a._groundPrimitives.update(b);a._primitives.update(b);var c=a._frameState;a.debugShowFrustumPlanes!==a._debugShowFrustumPlanes&&(a._debugFrustumPlanes=a.debugShowFrustumPlanes?new oa({camera:a.camera,updateOnChange:!1}):a._debugFrustumPlanes&&a._debugFrustumPlanes.destroy(),a._debugShowFrustumPlanes=a.debugShowFrustumPlanes);r(a._debugFrustumPlanes)&&a._debugFrustumPlanes.update(c);var c=a._frameState,d=c.shadowMaps,e=d.length,f=0<e&&!c.passes.pick&&a.mode===xa.SCENE3D;f!==c.shadowState.shadowsEnabled&&(++c.shadowState.lastDirtyTime,c.shadowState.shadowsEnabled=f);c.shadowState.lightShadowsEnabled=!1;if(f){for(f=0;f<e;++f)if(d[f]!==c.shadowState.shadowMaps[f]){++c.shadowState.lastDirtyTime;break}c.shadowState.shadowMaps.length=0;for(f=c.shadowState.lightShadowMaps.length=0;f<e;++f){var g=d[f];g.update(c);c.shadowState.shadowMaps.push(g);g.fromLightSource&&(c.shadowState.lightShadowMaps.push(g),c.shadowState.lightShadowsEnabled=!0);g.dirty&&(++c.shadowState.lastDirtyTime,g.dirty=!1)}}a._globe&&a._globe.render(b)}function ad(a,b,c){var d=a._context,e=a._frameState,f=a._environmentState,g=a._view,k=a._frameState.passes.pick,l=f.useWebVR;f.originalFramebuffer=b.framebuffer;r(a.sun)&&a.sunBloom!==a._sunBloom?(a.sunBloom&&!l?a._sunPostProcess=new Ja:r(a._sunPostProcess)&&(a._sunPostProcess=a._sunPostProcess.destroy()),a._sunBloom=a.sunBloom):!r(a.sun)&&r(a._sunPostProcess)&&(a._sunPostProcess=a._sunPostProcess.destroy(),a._sunBloom=!1);var m=a._clearColorCommand;h.clone(c,m.color);m.execute(d,b);var p=f.useGlobeDepthFramebuffer=r(g.globeDepth);p&&(g.globeDepth.update(d,b,g.viewport,a._hdr),g.globeDepth.clear(d,b,c));var q=g.oit,t=f.useOIT=!k&&r(q)&&q.isSupported();t&&(q.update(d,b,g.globeDepth.framebuffer,a._hdr),q.clear(d,b,c),f.useOIT=q.isSupported());var w=a.postProcessStages,u=f.usePostProcess=!k&&(a._hdr||0<w.length||w.ambientOcclusion.enabled||w.fxaa.enabled||w.bloom.enabled);f.usePostProcessSelected=!1;u&&(g.sceneFramebuffer._fxaa=w.fxaa,g.sceneFramebuffer.update(d,g.viewport,a._hdr),g.sceneFramebuffer.clear(d,b,c),w.update(d,e.useLogDepth,a._hdr),w.clear(d),u=f.usePostProcess=w.ready,f.usePostProcessSelected=u&&w.hasSelected);f.isSunVisible&&a.sunBloom&&!l?(b.framebuffer=a._sunPostProcess.update(b),a._sunPostProcess.clear(d,b,c)):p?b.framebuffer=g.globeDepth.framebuffer:u&&(b.framebuffer=g.sceneFramebuffer.getFramebuffer());u&&g.globeDepth&&g.globeDepth.framebuffer&&g.sceneFramebuffer.updateDepthStencilTex(d,g.globeDepth.framebuffer,b);r(b.framebuffer)&&m.execute(d,b);if(f.useInvertClassification=!k&&r(b.framebuffer)&&a.invertClassification){var v;1===a.frameState.invertClassificationColor.alpha&&f.useGlobeDepthFramebuffer&&(v=g.globeDepth.framebuffer);r(v)||d.depthTexture?(a._invertClassification.previousFramebuffer=v,a._invertClassification.update(d),a._invertClassification.clear(d,b),1>a.frameState.invertClassificationColor.alpha&&t&&(a=a._invertClassification.unclassifiedCommand,b=a.derivedCommands,b.oit=q.createDerivedCommands(a,d,b.oit))):f.useInvertClassification=!1}}function Dc(a,b){var c=a._context,d=a._frameState,e=a._environmentState,f=a._view,g=e.useOIT,h=e.useGlobeDepthFramebuffer,k=e.usePostProcess,e=e.originalFramebuffer,l=h?f.globeDepth.framebuffer:void 0,m=f.sceneFramebuffer.getFramebuffer(),p=f.sceneFramebuffer.getIdFramebuffer();g&&(b.framebuffer=k?m:e,f.oit.execute(c,b));if(k){var q=m;h&&!g&&(q=l);var r=a.postProcessStages,q=q.getColorTexture(0),p=p.getColorTexture(0),l=t(l,m).depthStencilTexture;r.execute(c,q,l,p);r.copy(c,e)}g||k||!h||(b.framebuffer=e,f.globeDepth.executeCopyColor(c,b));d=d.useLogDepth;a.debugShowGlobeDepth&&h&&sc(a,a.debugShowDepthFrustum-1).executeDebugGlobeDepth(c,b,d);a.debugShowPickDepth&&h&&Za(a,a.debugShowDepthFrustum-1).executeDebugPickDepth(c,b,d)}function fc(a){a._jobScheduler.resetBudgets();var b=a._frameState;a.primitives.prePassesUpdate(b);r(a.globe)&&a.globe.update(b);a._pickPositionCacheDirty=!0;b.creditDisplay.update()}function xd(a){a.primitives.postPassesUpdate(a._frameState);O.update()}function Vc(b){var c=b._frameState,d=b.context,e=d.uniformState,f=b._defaultView;b._view=f;Wa(b);c.passes.render=!0;c.passes.postProcess=b.postProcessStages.hasSelected;c.tilesetPassState=Bc;var g=t(b.backgroundColor,h.BLACK);b._hdr&&(g=h.clone(g,Pb),g.red=Math.pow(g.red,b.gamma),g.green=Math.pow(g.green,b.gamma),g.blue=Math.pow(g.blue,b.gamma));c.backgroundColor=g;c.creditDisplay.beginFrame();b.fog.update(c);e.update(c);var k=b.shadowMap;r(k)&&k.enabled&&(l.negate(e.sunDirectionWC,b._sunCamera.direction),c.shadowMaps.push(k));b._computeCommandList.length=0;b._overlayCommandList.length=0;e=f.viewport;e.x=0;e.y=0;e.width=d.drawingBufferWidth;e.height=d.drawingBufferHeight;f=f.passState;f.framebuffer=void 0;f.blendingEnabled=void 0;f.scissorTest=void 0;f.viewport=a.clone(e,f.viewport);r(b.globe)&&b.globe.beginFrame(c);uc(b);dc(b,f,g);Dc(b,f);f.framebuffer=void 0;b.context.uniformState.updatePass(ca.OVERLAY);for(var g=b.context,e=b._overlayCommandList,k=e.length,m=0;m<k;++m)e[m].execute(g,f);r(b.globe)&&(b.globe.endFrame(c),b.globe.tilesLoaded||(b._renderRequested=!0));c.creditDisplay.endFrame();d.endFrame()}function xc(a,b){try{b(a)}catch(jb){if(a._renderError.raiseEvent(a,jb),a.rethrowRenderErrors)throw jb;}}function Kc(a,b,c,d,e){var f=a.camera.frustum;if(f instanceof G||f instanceof E){d=a.camera;f=d.frustum;r(f._offCenterFrustum)&&(f=f._offCenterFrustum);var g=2*(b.x-e.x)/e.width-1,g=.5*g*(f.right-f.left),h=2*(e.height-b.y-e.y)/e.height-1,h=.5*h*(f.top-f.bottom);c=H.clone(d.transform,eb);d._setTransform(H.IDENTITY);b=l.clone(d.position,Tc);l.multiplyByScalar(d.right,g,Db);l.add(Db,b,b);l.multiplyByScalar(d.up,h,Db);l.add(Db,b,b);d._setTransform(c);a.mode===xa.SCENE2D&&l.fromElements(b.z,b.x,b.y,b);e=f.getPixelDimensions(e.width,e.height,1,Eb);a=$b;a.right=.5*e.x;a.left=-a.right;a.top=.5*e.y;a.bottom=-a.top;a.near=f.near;a.far=f.far;return a.computeCullingVolume(b,d.directionWC,d.upWC)}a=a.camera;var f=a.frustum,g=f.near,k=Math.tan(.5*f.fovy),h=(2*(b.x-e.x)/e.width-1)*g*f.aspectRatio*k;b=(2*(e.height-b.y-e.y)/e.height-1)*g*k;k=f.getPixelDimensions(e.width,e.height,1,Eb);e=k.x*c*.5;d=k.y*d*.5;c=ea;c.top=b+d;c.bottom=b-d;c.right=h+e;c.left=h-e;c.near=g;c.far=f.far;return c.computeCullingVolume(a.positionWC,a.directionWC,a.upWC)}function Lc(a,b){var c,d,e=[],f=[],g=[],h=[];r(a)||(a=Number.MAX_VALUE);for(d=b();r(d);){c=d.object;var k=d.exclude;if(r(d.position)&&!r(c)){e.push(d);break}if(!r(c)||!r(c.primitive))break;if(!k&&(e.push(d),0>=--a))break;var k=c.primitive,l=!1;"function"===typeof k.getGeometryInstanceAttributes&&r(c.id)&&(d=k.getGeometryInstanceAttributes(c.id),r(d)&&r(d.show)&&(l=!0,d.show=Z.toValue(!1,d.show),g.push(d)));c instanceof na&&(l=!0,c.show=!1,h.push(c));l||(k.show=!1,f.push(k));d=b()}for(c=0;c<f.length;++c)f[c].show=!0;for(c=0;c<g.length;++c)d=g[c],d.show=Z.toValue(!0,d.show);for(c=0;c<h.length;++c)h[c].show=!0;return e}function Oc(a){var b=a._frameState;nc.camera=b.camera;nc.cullingVolume=b.cullingVolume;a.primitives.updateForPass(b,nc)}function ed(a){var b=a._frameState;b.camera.hasCurrentFlight()&&(gc.camera=a.preloadFlightCamera,gc.cullingVolume=a.preloadFlightCullingVolume,a.primitives.updateForPass(b,gc))}function Rc(a){a.primitives.updateForPass(a._frameState,hc)}function Pc(a,b,c,d){var e=b.direction,f=l.mostOrthogonalAxis(e,Xa),f=l.cross(e,f,Xa),g=l.cross(e,f,pc);d.position=b.origin;d.direction=e;d.up=g;d.right=f;d.frustum.width=t(c,a.pickOffscreenDefaultWidth);return d.frustum.computeCullingVolume(d.positionWC,d.directionWC,d.upWC)}function bd(a){for(var b=a._mostDetailedRayPicks,c=0;c<b.length;++c){var d=a,e=b[c],f=d._frameState,g=e.tilesets,h=d._pickOffscreenView.camera,k=Pc(d,e.ray,e.width,h),l=ib;l.camera=h;l.cullingVolume=k;for(var h=!0,k=g.length,m=0;m<k;++m){var p=g[m];p.show&&d.primitives.contains(p)&&(p.updateForPass(f,l),h=h&&l.ready)}h&&e.deferred.resolve();h&&b.splice(c--,1)}}function Mc(a,b,c){for(var d=a.length,e=0;e<d;++e){var f=a.get(e);f.show&&(f instanceof ha?r(b)&&-1!==b.indexOf(f)||c.push(f):f instanceof Va&&Mc(f,b,c))}}function Yb(a,b,c,d,e){var f=[];Mc(a.primitives,c,f);if(0===f.length)return fa.resolve(e());b=new I(b,d,f);a._mostDetailedRayPicks.push(b);return b.promise.then(function(){return e()})}function Sc(b,c,d,e,f,g,h){return Lc(d,function(){var d=b._context,k=d.uniformState,l=b._frameState,m=b._pickOffscreenView;b._view=m;Pc(b,c,f,m.camera);cb=a.clone(m.viewport,cb);var p=m.pickFramebuffer.begin(cb,m.viewport);b._jobScheduler.disableThisFrame();Wa(b);l.invertClassification=!1;l.passes.pick=!0;l.passes.offscreen=!0;l.tilesetPassState=h?zc:Ec;k.update(l);uc(b,m);dc(b,p,Ya);Dc(b,p);var q,k=m.pickFramebuffer.end(d);if(b._context.depthTexture)for(var t=m.frustumCommandsList.length,p=0;p<t;++p)if(l=Za(b,p).getDepth(d,0,0),0<l&&1>l){q=m.frustumCommandsList[p];m=q.near*(0!==p?b.opaqueFrustumNearOffset:1);q=N.getPoint(c,m+l*(q.far-m));break}b._view=b._defaultView;d.endFrame();r(k)||r(q)?(d=q,(q=!r(q)&&g)||(q=r(k)&&r(e)&&0!==e.length?-1<e.indexOf(k)||-1<e.indexOf(k.primitive)||-1<e.indexOf(k.id):!1),d={object:k,position:d,exclude:q}):d=void 0;return d})}function ab(a,b,c,d,e,f){a=Sc(a,b,1,c,d,e,f);if(0<a.length)return a[0]}function Ab(a,b){var c=fa.defer();b.then(function(b){var d=a.postRender.addEventListener(function(){c.resolve(b);d()})});return c.promise}function qb(a,c){var d=a.globe,e=r(d)?d.ellipsoid:a.mapProjection.ellipsoid,d=b._defaultMaxTerrainHeight,f=e.geodeticSurfaceNormalCartographic(c,ob),g=m.toCartesian(c,e,ic),e=Kb;e.origin=g;e.direction=f;g=new N;N.getPoint(e,d,g.origin);l.negate(f,g.direction);return g}function yc(a,b){var c=a.globe,c=r(c)?c.ellipsoid:a.mapProjection.ellipsoid,c=m.fromCartesian(b,c,Rb);return qb(a,c)}function vb(a,b){var c=a.globe,c=r(c)?c.ellipsoid:a.mapProjection.ellipsoid;return m.fromCartesian(b,c,Rb).height}function vc(a,b,c,d){var e=qb(a,b);return Yb(a,e,c,d,function(){var b=ab(a,e,c,d,!0,!0);if(r(b))return vb(a,b.position)})}function ma(a,b,c,d,e){var f=yc(a,b);return Yb(a,f,c,d,function(){var b=ab(a,f,c,d,!0,!0);if(r(b))return l.clone(b.position,e)})}var Ib=function(a){return function(){a.frameState.afterRender.push(function(){a.requestRender()})}};c(Oa.prototype,{canvas:{get:function(){return this._canvas}},drawingBufferHeight:{get:function(){return this._context.drawingBufferHeight}},drawingBufferWidth:{get:function(){return this._context.drawingBufferWidth}},maximumAliasedLineWidth:{get:function(){return Y.maximumAliasedLineWidth}},maximumCubeMapSize:{get:function(){return Y.maximumCubeMapSize}},pickPositionSupported:{get:function(){return this._context.depthTexture}},sampleHeightSupported:{get:function(){return this._context.depthTexture}},clampToHeightSupported:{get:function(){return this._context.depthTexture}},invertClassificationSupported:{get:function(){return this._context.depthTexture}},globe:{get:function(){return this._globe},set:function(a){this._globe=this._globe&&this._globe.destroy();this._globe=a;for(var b=0;b<this._removeGlobeCallbacks.length;++b)this._removeGlobeCallbacks[b]();this._removeGlobeCallbacks.length=0;b=[];r(a)&&(b.push(a.imageryLayersUpdatedEvent.addEventListener(Ib(this))),b.push(a.terrainProviderChanged.addEventListener(Ib(this))));this._removeGlobeCallbacks=b}},primitives:{get:function(){return this._primitives}},groundPrimitives:{get:function(){return this._groundPrimitives}},camera:{get:function(){return this._view.camera},set:function(a){this._view.camera=a}},screenSpaceCameraController:{get:function(){return this._screenSpaceCameraController}},mapProjection:{get:function(){return this._mapProjection}},frameState:{get:function(){return this._frameState}},tweens:{get:function(){return this._tweens}},imageryLayers:{get:function(){if(r(this.globe))return this.globe.imageryLayers}},terrainProvider:{get:function(){if(r(this.globe))return this.globe.terrainProvider},set:function(a){r(this.globe)&&(this.globe.terrainProvider=a)}},terrainProviderChanged:{get:function(){if(r(this.globe))return this.globe.terrainProviderChanged}},preUpdate:{get:function(){return this._preUpdate}},postUpdate:{get:function(){return this._postUpdate}},renderError:{get:function(){return this._renderError}},preRender:{get:function(){return this._preRender}},postRender:{get:function(){return this._postRender}},lastRenderTime:{get:function(){return this._lastRenderTime}},context:{get:function(){return this._context}},debugFrustumStatistics:{get:function(){return this._view.debugFrustumStatistics}},scene3DOnly:{get:function(){return this._frameState.scene3DOnly}},orderIndependentTranslucency:{get:function(){return this._useOIT}},id:{get:function(){return this._id}},mode:{get:function(){return this._mode},set:function(a){if(this.scene3DOnly&&a!==xa.SCENE3D)throw new y("Only SceneMode.SCENE3D is valid when scene3DOnly is true.");if(a===xa.SCENE2D)this.morphTo2D(0);else if(a===xa.SCENE3D)this.morphTo3D(0);else if(a===xa.COLUMBUS_VIEW)this.morphToColumbusView(0);else throw new y("value must be a valid SceneMode enumeration.");this._mode=a}},frustumCommandsList:{get:function(){return this._view.frustumCommandsList}},numberOfFrustums:{get:function(){return this._view.frustumCommandsList.length}},terrainExaggeration:{get:function(){return this._terrainExaggeration}},useWebVR:{get:function(){return this._useWebVR},set:function(a){if(this.camera.frustum instanceof G)throw new y("VR is unsupported with an orthographic projection.");(this._useWebVR=a)?(this._frameState.creditDisplay.container.style.visibility="hidden",this._cameraVR=new ka(this),r(this._deviceOrientationCameraController)||(this._deviceOrientationCameraController=new ta(this)),this._aspectRatioVR=this.camera.frustum.aspectRatio):(this._frameState.creditDisplay.container.style.visibility="visible",this._cameraVR=void 0,this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy(),this.camera.frustum.aspectRatio=this._aspectRatioVR,this.camera.frustum.xOffset=0)}},mapMode2D:{get:function(){return this._mapMode2D}},imagerySplitPosition:{get:function(){return this._frameState.imagerySplitPosition},set:function(a){this._frameState.imagerySplitPosition=a}},minimumDisableDepthTestDistance:{get:function(){return this._minimumDisableDepthTestDistance},set:function(a){if(!r(a)||0>a)throw new y("minimumDisableDepthTestDistance must be greater than or equal to 0.0.");this._minimumDisableDepthTestDistance=a}},logarithmicDepthBuffer:{get:function(){return this._logDepthBuffer},set:function(a){a=this._context.fragmentDepth&&a;this._logDepthBuffer!==a&&(this._logDepthBuffer=a,this._logDepthBufferDirty=!0,this._defaultView.updateFrustums=!0)}},gamma:{get:function(){return this._context.uniformState.gamma},set:function(a){this._context.uniformState.gamma=a}},highDynamicRange:{get:function(){return this._hdr},set:function(a){var b=this._context;a=a&&b.depthTexture&&(b.colorBufferFloat||b.colorBufferHalfFloat);this._hdrDirty=a!==this._hdr;this._hdr=a}},highDynamicRangeSupported:{get:function(){var a=this._context;return a.depthTexture&&(a.colorBufferFloat||a.colorBufferHalfFloat)}},sunColor:{get:function(){return this._sunColor},set:function(a){this._sunColor=a}},opaqueFrustumNearOffset:{get:function(){return this._frameState.useLogDepth?.9:.9999}}});Oa.prototype.getCompressedTextureFormatSupported=function(a){var b=this.context;return("WEBGL_compressed_texture_s3tc"===a||"s3tc"===a)&&b.s3tc||("WEBGL_compressed_texture_pvrtc"===a||"pvrtc"===a)&&b.pvrtc||("WEBGL_compressed_texture_etc1"===a||"etc1"===a)&&b.etc1};Oa.prototype.updateDerivedCommands=function(a){if((void 0==a.name||"FeDrawCommand"!=a.name)&&r(a.derivedCommands)){var b=this._frameState,c=this._context,d=!1,e=b.shadowState.lastDirtyTime;a.lastDirtyTime!==e&&(a.lastDirtyTime=e,d=a.dirty=!0);var f=b.useLogDepth,g=this._hdr,e=a.derivedCommands,h=r(e.logDepth),k=r(e.hdr),l=r(e.originalCommand),m=f&&!h,f=(!f||!g)&&!l;a.dirty=a.dirty||m||g&&!k||f;if(a.dirty){a.dirty=!1;g=b.shadowState.shadowMaps;b.shadowState.shadowsEnabled&&a.castShadows&&(e.shadows=La.createCastDerivedCommand(g,a,d,c,e.shadows));if(h||m)e.logDepth=ua.createLogDepthCommand(a,c,e.logDepth),Ta(this,e.logDepth.command,d);(l||f)&&Ta(this,a,d)}}};var ib=new la({pass:ia.MOST_DETAILED_PRELOAD}),zc=new la({pass:ia.MOST_DETAILED_PICK}),Bc=new la({pass:ia.RENDER}),Ec=new la({pass:ia.PICK}),nc=new la({pass:ia.PRELOAD}),gc=new la({pass:ia.PRELOAD_FLIGHT}),hc=new la({pass:ia.REQUEST_RENDER_MODE_DEFER_CHECK}),Fc=new f,mb,gb=new q;Oa.prototype.isVisible=function(a,b,c){return r(a)&&(!r(a.boundingVolume)||!a.cull||b.computeVisibility(a.boundingVolume)!==B.OUTSIDE&&(!r(c)||!a.occlude||!a.boundingVolume.isOccluded(c)))};var Zb=new H(0,0,1,0,1,0,0,0,0,1,0,0,0,0,0,1),Zb=H.inverseTransformation(Zb,Zb),Gc=new L,Na=new K,Ob=new G,lb=new E,nb=new l,Cb=new m(Math.PI,F.PI_OVER_TWO),wb=new l,xb=new l,rb=new H,yb=new H,oc=new l,sb=new l,Sb=new a;Oa.prototype.initializeFrame=function(){120===this._shaderFrameCount++&&(this._shaderFrameCount=0,this._context.shaderCache.destroyReleasedShaderPrograms(),this._context.textureCache.destroyReleasedTextures());this._tweens.update();this._screenSpaceCameraController.update();r(this._deviceOrientationCameraController)&&this._deviceOrientationCameraController.update();this.camera.update(this._mode);this.camera._updateCameraChanged()};var Pb=new h;Oa.prototype.render=function(a){this._preUpdate.raiseEvent(this,a);var b=this._frameState;b.newFrame=!1;r(a)||(a=C.now());var c=this._view.checkForCameraUpdates(this),c=!this.requestRenderMode||this._renderRequested||c||this._logDepthBufferDirty||this._hdrDirty||this.mode===xa.MORPHING;if(!c&&r(this.maximumRenderTimeChange)&&r(this._lastRenderTime))var d=Math.abs(C.secondsDifference(this._lastRenderTime,a)),c=c||d>this.maximumRenderTimeChange;if(c){this._lastRenderTime=C.clone(a,this._lastRenderTime);this._hdrDirty=this._logDepthBufferDirty=this._renderRequested=!1;var d=F.incrementWrap(b.frameNumber,15E6,1),e=this._frameState;e.frameNumber=d;e.time=C.clone(a,e.time);b.newFrame=!0}xc(this,fc);xc(this,bd);xc(this,Oc);xc(this,ed);c||xc(this,Rc);this._postUpdate.raiseEvent(this,a);c&&(this._preRender.raiseEvent(this,a),xc(this,Vc));b=c;this.debugShowFramesPerSecond?(r(this._performanceDisplay)||(d=document.createElement("div"),d.className="cesium-performanceDisplay-defaultContainer",this._canvas.parentNode.appendChild(d),this._performanceDisplay=new Ca({container:d}),this._performanceContainer=d),this._performanceDisplay.throttled=this.requestRenderMode,this._performanceDisplay.update(b)):r(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer));xc(this,xd);b=this._frameState.afterRender;d=0;for(e=b.length;d<e;++d)b[d](),this.requestRender();b.length=0;c&&this._postRender.raiseEvent(this,a)};Oa.prototype.forceRender=function(a){this._renderRequested=!0;this.render(a)};Oa.prototype.requestRender=function(){this._renderRequested=!0};Oa.prototype.clampLineWidth=function(a){return Math.max(Y.minimumAliasedLineWidth,Math.min(a,Y.maximumAliasedLineWidth))};var $b=new E,Tc=new l,Db=new l,Eb=new g,eb=new H,ea=new K,Qb=3,bb=3,cb=new a(0,0,Qb,bb),Ya=new h(0,0,0,0),Fb=new g;Oa.prototype.pick=function(b,c,d){if(!r(b))throw new y("windowPosition is undefined.");Qb=t(c,3);bb=t(d,Qb);c=this._context;d=c.uniformState;var e=this._frameState,f=this._defaultView;this._view=f;var g=f.viewport;g.x=0;g.y=0;g.width=c.drawingBufferWidth;g.height=c.drawingBufferHeight;var h=f.passState;h.viewport=a.clone(g,h.viewport);b=Ha.transformWindowToDrawingBuffer(this,b,Fb);this._jobScheduler.disableThisFrame();Wa(this);e.cullingVolume=Kc(this,b,Qb,bb,g);e.invertClassification=!1;e.passes.pick=!0;e.tilesetPassState=Ec;d.update(e);uc(this);cb.x=b.x-.5*(Qb-1);cb.y=this.drawingBufferHeight-b.y-.5*(bb-1);cb.width=Qb;cb.height=bb;h=f.pickFramebuffer.begin(cb,f.viewport);dc(this,h,Ya);Dc(this,h);b=f.pickFramebuffer.end(cb);c.endFrame();return b};Oa.prototype.pickPositionWorldCoordinates=function(b,c){if(this.useDepthPicking){if(!r(b))throw new y("windowPosition is undefined.");if(!this._context.depthTexture)throw new y("Picking from the depth buffer is not supported. Check pickPositionSupported.");var d=b.toString();if(this._pickPositionCacheDirty)this._pickPositionCache={},this._pickPositionCacheDirty=!1;else if(this._pickPositionCache.hasOwnProperty(d))return l.clone(this._pickPositionCache[d],c);var e=this._frameState,f=this._context,g=f.uniformState,h=this._defaultView;this._view=h;var k=Ha.transformWindowToDrawingBuffer(this,b,Fb);if(this.pickTranslucentDepth){var m=this._context,p=this._frameState,q=this._environmentState,t=this._defaultView;this._view=t;var w=t.viewport;w.x=0;w.y=0;w.width=m.drawingBufferWidth;w.height=m.drawingBufferHeight;var u=t.passState;u.viewport=a.clone(w,u.viewport);Ka(p.passes);p.passes.pick=!0;p.passes.depth=!0;p.cullingVolume=Kc(this,k,1,1,w);p.tilesetPassState=Ec;uc(this);q.renderTranslucentDepthForPick=!0;u=t.pickDepthFramebuffer.update(m,k,w);dc(this,u,Ya);Dc(this,u);m.endFrame()}else Wa(this,e.frameNumber,e.time),g.update(e),uc(this);k.y=this.drawingBufferHeight-k.y;m=this.camera;p=r(m.frustum.fov)?m.frustum.clone(Gc):r(m.frustum.infiniteProjectionMatrix)?m.frustum.clone(Na):r(m.frustum.width)?m.frustum.clone(Ob):m.frustum.clone(lb);t=h.frustumCommandsList;w=t.length;for(h=0;h<w;++h)if(q=Za(this,h).getDepth(f,k.x,k.y),0<q&&1>q){var f=t[h],v;this.mode===xa.SCENE2D?(v=m.position.z,m.position.z=v-f.near+1,p.far=Math.max(1,f.far-f.near),p.near=1,g.update(e)):(p.near=f.near*(0!==h?this.opaqueFrustumNearOffset:1),p.far=f.far);g.updateFrustum(p);c=Ha.drawingBufferToWgs84Coordinates(this,k,q,c);this.mode===xa.SCENE2D&&(m.position.z=v,g.update(e));this._pickPositionCache[d]=l.clone(c);return c}this._pickPositionCache[d]=void 0}};var Ac=new m;Oa.prototype.pickPosition=function(a,b){b=this.pickPositionWorldCoordinates(a,b);if(r(b)&&this.mode!==xa.SCENE3D){l.fromElements(b.y,b.z,b.x,b);var c=this.mapProjection,d=c.ellipsoid,c=c.unproject(b,Ac);d.cartographicToCartesian(c,b)}return b};Oa.prototype.drillPick=function(a,b,c,d){var e=this;return Lc(b,function(){var b=e.pick(a,c,d);if(r(b))return{object:b,position:void 0,exclude:!1}}).map(function(a){return a.object})};var Xa=new l,pc=new l;Oa.prototype.pickFromRay=function(a,b,c){e.defined("ray",a);if(this._mode!==xa.SCENE3D)throw new y("Ray intersections are only supported in 3D mode.");return ab(this,a,b,c,!1,!1)};Oa.prototype.drillPickFromRay=function(a,b,c,d){e.defined("ray",a);if(this._mode!==xa.SCENE3D)throw new y("Ray intersections are only supported in 3D mode.");return Sc(this,a,b,c,d,!1,!1)};Oa.prototype.pickFromRayMostDetailed=function(a,b,c){e.defined("ray",a);if(this._mode!==xa.SCENE3D)throw new y("Ray intersections are only supported in 3D mode.");var d=this;a=N.clone(a);b=r(b)?b.slice():b;return Ab(this,Yb(this,a,b,c,function(){return ab(d,a,b,c,!1,!0)}))};Oa.prototype.drillPickFromRayMostDetailed=function(a,b,c,d){e.defined("ray",a);if(this._mode!==xa.SCENE3D)throw new y("Ray intersections are only supported in 3D mode.");var f=this;a=N.clone(a);c=r(c)?c.slice():c;return Ab(this,Yb(this,a,c,d,function(){return Sc(f,a,b,c,d,!1,!0)}))};var ic=new l,ob=new l,Kb=new N,Rb=new m;Oa.prototype.sampleHeight=function(a,b,c){e.defined("position",a);if(this._mode!==xa.SCENE3D)throw new y("sampleHeight is only supported in 3D mode.");if(!this.sampleHeightSupported)throw new y("sampleHeight requires depth texture support. Check sampleHeightSupported.");a=qb(this,a);b=ab(this,a,b,c,!0,!1);if(r(b))return vb(this,b.position)};Oa.prototype.clampToHeight=function(a,b,c,d){e.defined("cartesian",a);if(this._mode!==xa.SCENE3D)throw new y("sampleHeight is only supported in 3D mode.");if(!this.clampToHeightSupported)throw new y("clampToHeight requires depth texture support. Check clampToHeightSupported.");a=yc(this,a);b=ab(this,a,b,c,!0,!1);if(r(b))return l.clone(b.position,d)};Oa.prototype.sampleHeightMostDetailed=function(a,b,c){e.defined("positions",a);if(this._mode!==xa.SCENE3D)throw new y("sampleHeightMostDetailed is only supported in 3D mode.");if(!this.sampleHeightSupported)throw new y("sampleHeightMostDetailed requires depth texture support. Check sampleHeightSupported.");b=r(b)?b.slice():b;for(var d=a.length,f=Array(d),g=0;g<d;++g)f[g]=vc(this,a[g],b,c);return Ab(this,fa.all(f).then(function(b){for(var c=b.length,d=0;d<c;++d)a[d].height=b[d];return a}))};Oa.prototype.clampToHeightMostDetailed=function(a,b,c){e.defined("cartesians",a);if(this._mode!==xa.SCENE3D)throw new y("clampToHeightMostDetailed is only supported in 3D mode.");if(!this.clampToHeightSupported)throw new y("clampToHeightMostDetailed requires depth texture support. Check clampToHeightSupported.");b=r(b)?b.slice():b;for(var d=a.length,f=Array(d),g=0;g<d;++g)f[g]=ma(this,a[g],b,c,a[g]);return Ab(this,fa.all(f).then(function(b){for(var c=b.length,d=0;d<c;++d)a[d]=b[d];return a}))};Oa.prototype.cartesianToCanvasCoordinates=function(a,b){return Ha.wgs84ToWindowCoordinates(this,a,b)};Oa.prototype.completeMorph=function(){this._transitioner.completeMorph()};Oa.prototype.morphTo2D=function(a){var b;b=this.globe;b=r(b)?b.ellipsoid:this.mapProjection.ellipsoid;a=t(a,2);this._transitioner.morphTo2D(a,b)};Oa.prototype.morphToColumbusView=function(a){var b;b=this.globe;b=r(b)?b.ellipsoid:this.mapProjection.ellipsoid;a=t(a,2);this._transitioner.morphToColumbusView(a,b)};Oa.prototype.morphTo3D=function(a){var b;b=this.globe;b=r(b)?b.ellipsoid:this.mapProjection.ellipsoid;a=t(a,2);this._transitioner.morphTo3D(a,b)};Oa.prototype.isDestroyed=function(){return!1};Oa.prototype.destroy=function(){this._tweens.removeAll();this._computeEngine=this._computeEngine&&this._computeEngine.destroy();this._screenSpaceCameraController=this._screenSpaceCameraController&&this._screenSpaceCameraController.destroy();this._deviceOrientationCameraController=this._deviceOrientationCameraController&&!this._deviceOrientationCameraController.isDestroyed()&&this._deviceOrientationCameraController.destroy();this._primitives=this._primitives&&this._primitives.destroy();this._groundPrimitives=this._groundPrimitives&&this._groundPrimitives.destroy();this._globe=this._globe&&this._globe.destroy();this.skyBox=this.skyBox&&this.skyBox.destroy();this.skyAtmosphere=this.skyAtmosphere&&this.skyAtmosphere.destroy();this._debugSphere=this._debugSphere&&this._debugSphere.destroy();this.sun=this.sun&&this.sun.destroy();this._sunPostProcess=this._sunPostProcess&&this._sunPostProcess.destroy();this._depthPlane=this._depthPlane&&this._depthPlane.destroy();this._transitioner=this._transitioner&&this._transitioner.destroy();this._debugFrustumPlanes=this._debugFrustumPlanes&&this._debugFrustumPlanes.destroy();this._brdfLutGenerator=this._brdfLutGenerator&&this._brdfLutGenerator.destroy();this._defaultView=this._defaultView&&this._defaultView.destroy();this._pickOffscreenView=this._pickOffscreenView&&this._pickOffscreenView.destroy();this._view=void 0;this._removeCreditContainer&&this._canvas.parentNode.removeChild(this._creditContainer);this.postProcessStages=this.postProcessStages&&this.postProcessStages.destroy();this._context=this._context&&this._context.destroy();this._frameState.creditDisplay=this._frameState.creditDisplay&&this._frameState.creditDisplay.destroy();r(this._performanceDisplay)&&(this._performanceDisplay=this._performanceDisplay&&this._performanceDisplay.destroy(),this._performanceContainer.parentNode.removeChild(this._performanceContainer));this._removeRequestListenerCallback();this._removeTaskProcessorListenerCallback();for(var a=0;a<this._removeGlobeCallbacks.length;++a)this._removeGlobeCallbacks[a]();this._removeGlobeCallbacks.length=0;return u(this)};return Oa});F("Shaders/SkyAtmosphereFS",[],function(){return"#ifdef COLOR_CORRECT\nuniform vec3 u_hsbShift;\n#endif\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor;\nconst float g \x3d -0.95;\nconst float g2 \x3d g * g;\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nvarying vec3 v_positionEC;\nvoid main (void)\n{\nfloat cosAngle \x3d dot(czm_sunDirectionWC, normalize(v_toCamera)) / length(v_toCamera);\nfloat rayleighPhase \x3d 0.75 * (1.0 + cosAngle * cosAngle);\nfloat miePhase \x3d 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + cosAngle * cosAngle) / pow(1.0 + g2 - 2.0 * g * cosAngle, 1.5);\nvec3 rgb \x3d rayleighPhase * v_rayleighColor + miePhase * v_mieColor;\n#ifndef HDR\nconst float exposure \x3d 1.1;\nrgb \x3d vec3(1.0) - exp(-exposure * rgb);\n#endif\n#ifdef COLOR_CORRECT\nvec3 hsb \x3d czm_RGBToHSB(rgb);\nhsb.x +\x3d u_hsbShift.x;\nhsb.y \x3d clamp(hsb.y + u_hsbShift.y, 0.0, 1.0);\nhsb.z \x3d hsb.z \x3e czm_epsilon7 ? hsb.z + u_hsbShift.z : 0.0;\nrgb \x3d czm_HSBToRGB(hsb);\n#endif\nfloat atmosphereAlpha \x3d clamp((u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.x) / (u_cameraAndRadiiAndDynamicAtmosphereColor.y - u_cameraAndRadiiAndDynamicAtmosphereColor.z), 0.0, 1.0);\nfloat nightAlpha \x3d (u_cameraAndRadiiAndDynamicAtmosphereColor.w \x3e 0.0) ? clamp(dot(normalize(czm_viewerPositionWC), normalize(czm_sunPositionWC)), 0.0, 1.0) : 1.0;\natmosphereAlpha *\x3d pow(nightAlpha, 0.5);\ngl_FragColor \x3d vec4(rgb, mix(rgb.b, 1.0, atmosphereAlpha) * smoothstep(0.0, 1.0, czm_morphTime));\n}\n"});F("Shaders/SkyAtmosphereVS",[],function(){return"attribute vec4 position;\nuniform vec4 u_cameraAndRadiiAndDynamicAtmosphereColor;\nconst float Kr \x3d 0.0025;\nconst float Kr4PI \x3d Kr * 4.0 * czm_pi;\nconst float Km \x3d 0.0015;\nconst float Km4PI \x3d Km * 4.0 * czm_pi;\nconst float ESun \x3d 15.0;\nconst float KmESun \x3d Km * ESun;\nconst float KrESun \x3d Kr * ESun;\nconst vec3 InvWavelength \x3d vec3(\n5.60204474633241,\n9.473284437923038,\n19.643802610477206);\nconst float rayleighScaleDepth \x3d 0.25;\nconst int nSamples \x3d 2;\nconst float fSamples \x3d 2.0;\nvarying vec3 v_rayleighColor;\nvarying vec3 v_mieColor;\nvarying vec3 v_toCamera;\nfloat scale(float cosAngle)\n{\nfloat x \x3d 1.0 - cosAngle;\nreturn rayleighScaleDepth  * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\n}\nvoid main(void)\n{\nfloat cameraHeight \x3d u_cameraAndRadiiAndDynamicAtmosphereColor.x;\nfloat outerRadius \x3d u_cameraAndRadiiAndDynamicAtmosphereColor.y;\nfloat innerRadius \x3d u_cameraAndRadiiAndDynamicAtmosphereColor.z;\nvec3 positionV3 \x3d position.xyz;\nvec3 ray \x3d positionV3 - czm_viewerPositionWC;\nfloat far \x3d length(ray);\nray /\x3d far;\nfloat atmosphereScale \x3d 1.0 / (outerRadius - innerRadius);\n#ifdef SKY_FROM_SPACE\nfloat B \x3d 2.0 * dot(czm_viewerPositionWC, ray);\nfloat C \x3d cameraHeight * cameraHeight - outerRadius * outerRadius;\nfloat det \x3d max(0.0, B*B - 4.0 * C);\nfloat near \x3d 0.5 * (-B - sqrt(det));\nvec3 start \x3d czm_viewerPositionWC + ray * near;\nfar -\x3d near;\nfloat startAngle \x3d dot(ray, start) / outerRadius;\nfloat startDepth \x3d exp(-1.0 / rayleighScaleDepth );\nfloat startOffset \x3d startDepth*scale(startAngle);\n#else // SKY_FROM_ATMOSPHERE\nvec3 start \x3d czm_viewerPositionWC;\nfloat height \x3d length(start);\nfloat depth \x3d exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - cameraHeight));\nfloat startAngle \x3d dot(ray, start) / height;\nfloat startOffset \x3d depth*scale(startAngle);\n#endif\nfloat sampleLength \x3d far / fSamples;\nfloat scaledLength \x3d sampleLength * atmosphereScale;\nvec3 sampleRay \x3d ray * sampleLength;\nvec3 samplePoint \x3d start + sampleRay * 0.5;\nvec3 frontColor \x3d vec3(0.0, 0.0, 0.0);\nvec3 lightDir \x3d (u_cameraAndRadiiAndDynamicAtmosphereColor.w \x3e 0.0) ? czm_sunPositionWC - czm_viewerPositionWC : czm_viewerPositionWC;\nlightDir \x3d normalize(lightDir);\nfor(int i\x3d0; i\x3cnSamples; i++)\n{\nfloat height \x3d length(samplePoint);\nfloat depth \x3d exp((atmosphereScale / rayleighScaleDepth ) * (innerRadius - height));\nfloat fLightAngle \x3d dot(lightDir, samplePoint) / height;\nfloat fCameraAngle \x3d dot(ray, samplePoint) / height;\nfloat fScatter \x3d (startOffset + depth*(scale(fLightAngle) - scale(fCameraAngle)));\nvec3 attenuate \x3d exp(-fScatter * (InvWavelength * Kr4PI + Km4PI));\nfrontColor +\x3d attenuate * (depth * scaledLength);\nsamplePoint +\x3d sampleRay;\n}\nv_mieColor \x3d frontColor * KmESun;\nv_rayleighColor \x3d frontColor * (InvWavelength * KrESun);\nv_toCamera \x3d czm_viewerPositionWC - positionV3;\ngl_Position \x3d czm_modelViewProjection * position;\n}\n"});F("Scene/SkyAtmosphere","../Core/Cartesian3 ../Core/Cartesian4 ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Ellipsoid ../Core/EllipsoidGeometry ../Core/GeometryPipeline ../Core/Math ../Core/VertexFormat ../Renderer/BufferUsage ../Renderer/DrawCommand ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Shaders/SkyAtmosphereFS ../Shaders/SkyAtmosphereVS ./BlendingState ./CullFace ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v){function B(c){c=f(c,m.WGS84);this.show=!0;this._ellipsoid=c;this._command=new t({owner:this});this._spSkyFromAtmosphereColorCorrect=this._spSkyFromSpaceColorCorrect=this._spSkyFromAtmosphere=this._spSkyFromSpace=void 0;this.brightnessShift=this.saturationShift=this.hueShift=0;this._hueSaturationBrightness=new b;var d=new a;d.w=0;d.y=b.maximumComponent(b.multiplyByScalar(c.radii,1.025,new b));d.z=c.maximumRadius;this._cameraAndRadiiAndDynamicAtmosphereColor=d;var e=this;this._command.uniformMap={u_cameraAndRadiiAndDynamicAtmosphereColor:function(){return e._cameraAndRadiiAndDynamicAtmosphereColor},u_hsbShift:function(){e._hueSaturationBrightness.x=e.hueShift;e._hueSaturationBrightness.y=e.saturationShift;e._hueSaturationBrightness.z=e.brightnessShift;return e._hueSaturationBrightness}}}g(B.prototype,{ellipsoid:{get:function(){return this._ellipsoid}}});B.prototype.setDynamicAtmosphereColor=function(a){this._cameraAndRadiiAndDynamicAtmosphereColor.w=a?1:0};B.prototype.update=function(a){if(this.show){var f=a.mode;if((f===v.SCENE3D||f===v.MORPHING)&&a.passes.render){f=this._command;if(!k(f.vertexArray)){var g=a.context,l=e.createGeometry(new e({radii:b.multiplyByScalar(this._ellipsoid.radii,1.025,new b),slicePartitions:256,stackPartitions:256,vertexFormat:d.POSITION_ONLY}));f.vertexArray=y.fromGeometry({context:g,geometry:l,attributeLocations:h.createAttributeLocations(l),bufferUsage:q.STATIC_DRAW});f.renderState=r.fromCache({cull:{enabled:!0,face:D.FRONT},blending:x.ALPHA_BLEND,depthMask:!1});l=new u({defines:["SKY_FROM_SPACE"],sources:[z]});this._spSkyFromSpace=c.fromCache({context:g,vertexShaderSource:l,fragmentShaderSource:A});l=new u({defines:["SKY_FROM_ATMOSPHERE"],sources:[z]});this._spSkyFromAtmosphere=c.fromCache({context:g,vertexShaderSource:l,fragmentShaderSource:A})}if((g=!(p.equalsEpsilon(this.hueShift,0,p.EPSILON7)&&p.equalsEpsilon(this.saturationShift,0,p.EPSILON7)&&p.equalsEpsilon(this.brightnessShift,0,p.EPSILON7)))&&(!k(this._spSkyFromSpaceColorCorrect)||!k(this._spSkyFromAtmosphereColorCorrect))){var l=a.context,m=new u({defines:["SKY_FROM_SPACE"],sources:[z]}),t=new u({defines:["COLOR_CORRECT"],sources:[A]});this._spSkyFromSpaceColorCorrect=c.fromCache({context:l,vertexShaderSource:m,fragmentShaderSource:t});m=new u({defines:["SKY_FROM_ATMOSPHERE"],sources:[z]});this._spSkyFromAtmosphereColorCorrect=c.fromCache({context:l,vertexShaderSource:m,fragmentShaderSource:t})}a=b.magnitude(a.camera.positionWC);this._cameraAndRadiiAndDynamicAtmosphereColor.x=a;f.shaderProgram=a>this._cameraAndRadiiAndDynamicAtmosphereColor.y?g?this._spSkyFromSpaceColorCorrect:this._spSkyFromSpace:g?this._spSkyFromAtmosphereColorCorrect:this._spSkyFromAtmosphere;return f}}};B.prototype.isDestroyed=function(){return!1};B.prototype.destroy=function(){var a=this._command;a.vertexArray=a.vertexArray&&a.vertexArray.destroy();this._spSkyFromSpace=this._spSkyFromSpace&&this._spSkyFromSpace.destroy();this._spSkyFromAtmosphere=this._spSkyFromAtmosphere&&this._spSkyFromAtmosphere.destroy();this._spSkyFromSpaceColorCorrect=this._spSkyFromSpaceColorCorrect&&this._spSkyFromSpaceColorCorrect.destroy();this._spSkyFromAtmosphereColorCorrect=this._spSkyFromAtmosphereColorCorrect&&this._spSkyFromAtmosphereColorCorrect.destroy();return l(this)};return B});F("Shaders/SkyBoxFS",[],function(){return"uniform samplerCube u_cubeMap;\nvarying vec3 v_texCoord;\nvoid main()\n{\nvec4 color \x3d textureCube(u_cubeMap, normalize(v_texCoord));\ngl_FragColor \x3d vec4(czm_gammaCorrect(color).rgb, czm_morphTime);\n}\n"});F("Shaders/SkyBoxVS",[],function(){return"attribute vec3 position;\nvarying vec3 v_texCoord;\nvoid main()\n{\nvec3 p \x3d czm_viewRotation * (czm_temeToPseudoFixed * (czm_entireFrustum.y * position));\ngl_Position \x3d czm_projection * vec4(p, 1.0);\nv_texCoord \x3d position.xyz;\n}\n"});F("Scene/SkyBox","../Core/BoxGeometry ../Core/Cartesian3 ../Core/defaultValue ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Core/GeometryPipeline ../Core/Matrix4 ../Core/VertexFormat ../Renderer/BufferUsage ../Renderer/CubeMap ../Renderer/DrawCommand ../Renderer/loadCubeMap ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/ShaderSource ../Renderer/VertexArray ../Shaders/SkyBoxFS ../Shaders/SkyBoxVS ./BlendingState ./SceneMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D){function v(a){this.sources=a.sources;this._sources=void 0;this.show=f(a.show,!0);this._command=new q({modelMatrix:e.clone(e.IDENTITY),owner:this});this._useHdr=this._attributeLocations=this._cubeMap=void 0}v.prototype.update=function(e,f){var g=this;if(this.show&&(e.mode===D.SCENE3D||e.mode===D.MORPHING)&&e.passes.render){var q=e.context;if(this._sources!==this.sources){var v=this._sources=this.sources;if(!(k(v.positiveX)&&k(v.negativeX)&&k(v.positiveY)&&k(v.negativeY)&&k(v.positiveZ)&&k(v.negativeZ)))throw new l("this.sources is required and must have positiveX, negativeX, positiveY, negativeY, positiveZ, and negativeZ properties.");if(typeof v.positiveX!==typeof v.negativeX||typeof v.positiveX!==typeof v.positiveY||typeof v.positiveX!==typeof v.negativeY||typeof v.positiveX!==typeof v.positiveZ||typeof v.positiveX!==typeof v.negativeZ)throw new l("this.sources properties must all be the same type.");"string"===typeof v.positiveX?t(q,this._sources).then(function(a){g._cubeMap=g._cubeMap&&g._cubeMap.destroy();g._cubeMap=a}):(this._cubeMap=this._cubeMap&&this._cubeMap.destroy(),this._cubeMap=new d({context:q,source:v}))}v=this._command;if(!k(v.vertexArray)){v.uniformMap={u_cubeMap:function(){return g._cubeMap}};var w=b.createGeometry(b.fromDimensions({dimensions:new a(2,2,2),vertexFormat:h.POSITION_ONLY})),B=this._attributeLocations=m.createAttributeLocations(w);v.vertexArray=y.fromGeometry({context:q,geometry:w,attributeLocations:B,bufferUsage:p.STATIC_DRAW});v.renderState=r.fromCache({blending:x.ALPHA_BLEND})}k(v.shaderProgram)&&this._useHdr===f||(w=new u({defines:[f?"HDR":""],sources:[A]}),v.shaderProgram=c.fromCache({context:q,vertexShaderSource:z,fragmentShaderSource:w,attributeLocations:this._attributeLocations}),this._useHdr=f);if(k(this._cubeMap))return v}};v.prototype.isDestroyed=function(){return!1};v.prototype.destroy=function(){var a=this._command;a.vertexArray=a.vertexArray&&a.vertexArray.destroy();a.shaderProgram=a.shaderProgram&&a.shaderProgram.destroy();this._cubeMap=this._cubeMap&&this._cubeMap.destroy();return g(this)};return v});F("Scene/SphereEmitter",["../Core/Cartesian3","../Core/Check","../Core/defaultValue","../Core/defineProperties","../Core/Math"],function(b,a,f,k,g){function l(b){b=f(b,1);a.typeOf.number.greaterThan("radius",b,0);this._radius=f(b,1)}k(l.prototype,{radius:{get:function(){return this._radius},set:function(b){a.typeOf.number.greaterThan("value",b,0);this._radius=b}}});l.prototype.emit=function(a){var e=g.randomBetween(0,g.TWO_PI),f=g.randomBetween(0,g.PI),k=g.randomBetween(0,this._radius);a.position=b.fromElements(k*Math.cos(e)*Math.sin(f),k*Math.sin(e)*Math.sin(f),k*Math.cos(f),a.position);a.velocity=b.normalize(a.position,a.velocity)};return l});F("Scene/StyleExpression",["../Core/DeveloperError"],function(b){function a(){}a.prototype.evaluate=function(a,k){b.throwInstantiationError()};a.prototype.evaluateColor=function(a,k){b.throwInstantiationError()};a.prototype.getShaderFunction=function(a,k,g,l){b.throwInstantiationError()};return a});F("Shaders/SunFS",[],function(){return"uniform sampler2D u_texture;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 color \x3d texture2D(u_texture, v_textureCoordinates);\ngl_FragColor \x3d czm_gammaCorrect(color);\n}\n"});F("Shaders/SunTextureFS",[],function(){return"uniform float u_radiusTS;\nvarying vec2 v_textureCoordinates;\nvec2 rotate(vec2 p, vec2 direction)\n{\nreturn vec2(p.x * direction.x - p.y * direction.y, p.x * direction.y + p.y * direction.x);\n}\nvec4 addBurst(vec2 position, vec2 direction, float lengthScalar)\n{\nvec2 rotatedPosition \x3d rotate(position, direction) * vec2(25.0, 0.75);\nfloat radius \x3d length(rotatedPosition) * lengthScalar;\nfloat burst \x3d 1.0 - smoothstep(0.0, 0.55, radius);\nreturn vec4(burst);\n}\nvoid main()\n{\nfloat lengthScalar \x3d 2.0 / sqrt(2.0);\nvec2 position \x3d v_textureCoordinates - vec2(0.5);\nfloat radius \x3d length(position) * lengthScalar;\nfloat surface \x3d step(radius, u_radiusTS);\nvec4 color \x3d vec4(vec2(1.0), surface + 0.2, surface);\nfloat glow \x3d 1.0 - smoothstep(0.0, 0.55, radius);\ncolor.ba +\x3d mix(vec2(0.0), vec2(1.0), glow) * 0.75;\nvec4 burst \x3d vec4(0.0);\ncolor +\x3d clamp(burst, vec4(0.0), vec4(1.0)) * 0.15;\ngl_FragColor \x3d clamp(color, vec4(0.0), vec4(1.0));\n}\n"});F("Shaders/SunVS",[],function(){return"attribute vec2 direction;\nuniform float u_size;\nvarying vec2 v_textureCoordinates;\nvoid main()\n{\nvec4 position;\nif (czm_morphTime \x3d\x3d 1.0)\n{\nposition \x3d vec4(czm_sunPositionWC, 1.0);\n}\nelse\n{\nposition \x3d vec4(czm_sunPositionColumbusView.zxy, 1.0);\n}\nvec4 positionEC \x3d czm_view * position;\nvec4 positionWC \x3d czm_eyeToWindowCoordinates(positionEC);\nvec2 halfSize \x3d vec2(u_size * 0.5);\nhalfSize *\x3d ((direction * 2.0) - 1.0);\ngl_Position \x3d czm_viewportOrthographic * vec4(positionWC.xy + halfSize, -positionWC.z, 1.0);\nv_textureCoordinates \x3d direction;\n}\n"});F("Scene/Sun","../Core/BoundingSphere ../Core/Cartesian2 ../Core/Cartesian3 ../Core/Cartesian4 ../Core/ComponentDatatype ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/IndexDatatype ../Core/Math ../Core/Matrix4 ../Core/PixelFormat ../Core/PrimitiveType ../Renderer/Buffer ../Renderer/BufferUsage ../Renderer/ComputeCommand ../Renderer/DrawCommand ../Renderer/PixelDatatype ../Renderer/RenderState ../Renderer/ShaderProgram ../Renderer/Texture ../Renderer/VertexArray ../Shaders/SunFS ../Shaders/SunTextureFS ../Shaders/SunVS ./BlendingState ./SceneMode ./SceneTransforms".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,F,H,J,w){function G(){this.show=!0;this._drawCommand=new y({primitiveType:t.TRIANGLES,boundingVolume:new b,owner:this});this._commands={drawCommand:this._drawCommand,computeCommand:void 0};this._boundingVolume=new b;this._boundingVolume2D=new b;this._size=this._radiusTS=this._drawingBufferHeight=this._drawingBufferWidth=this._texture=void 0;this.glowFactor=1;this._glowFactorDirty=!1;this._useHdr=void 0;var a=this;this._uniformMap={u_texture:function(){return a._texture},u_size:function(){return a._size}}}m(G.prototype,{glowFactor:{get:function(){return this._glowFactor},set:function(a){this._glowFactor=a=Math.max(a,0);this._glowFactorDirty=!0}}});var E=new a,I=new a,K=new k,P=new k;G.prototype.update=function(e,k,m){if(this.show){var t=e.mode;if(t!==J.SCENE2D&&t!==J.MORPHING&&e.passes.render){var y=e.context,G=k.viewport.width,L=k.viewport.height;if(!l(this._texture)||G!==this._drawingBufferWidth||L!==this._drawingBufferHeight||this._glowFactorDirty||m!==this._useHdr){this._texture=this._texture&&this._texture.destroy();this._drawingBufferWidth=G;this._drawingBufferHeight=L;this._glowFactorDirty=!1;this._useHdr=m;G=Math.max(G,L);G=Math.pow(2,Math.ceil(Math.log(G)/Math.log(2))-2);G=Math.max(1,G);this._texture=new D({context:y,width:G,height:G,pixelFormat:q.RGBA,pixelDatatype:m?y.halfFloatingPointTexture?A.HALF_FLOAT:A.FLOAT:A.UNSIGNED_BYTE});this._glowLengthTS=5*this._glowFactor;this._radiusTS=.3;var N=this;this._commands.computeCommand=new u({fragmentShaderSource:C,outputTexture:this._texture,uniformMap:{u_radiusTS:function(){return N._radiusTS}},persists:!1,owner:this,postExecute:function(){N._commands.computeCommand=void 0}})}m=this._drawCommand;if(!l(m.vertexArray)){G={direction:0};L=new Uint8Array(8);L[0]=0;L[1]=0;L[2]=255;L[3]=0;L[4]=255;L[5]=255;L[6]=0;L[7]=255;var L=r.createVertexBuffer({context:y,typedArray:L,usage:c.STATIC_DRAW}),L=[{index:G.direction,vertexBuffer:L,componentsPerAttribute:2,normalize:!0,componentDatatype:g.UNSIGNED_BYTE}],O=r.createIndexBuffer({context:y,typedArray:new Uint16Array([0,1,2,0,2,3]),usage:c.STATIC_DRAW,indexDatatype:h.UNSIGNED_SHORT});m.vertexArray=new v({context:y,attributes:L,indexBuffer:O});m.shaderProgram=x.fromCache({context:y,vertexShaderSource:F,fragmentShaderSource:B,attributeLocations:G});m.renderState=z.fromCache({blending:H.ALPHA_BLEND});m.uniformMap=this._uniformMap}var G=y.uniformState.sunPositionWC,L=y.uniformState.sunPositionColumbusView,O=this._boundingVolume,Q=this._boundingVolume2D;f.clone(G,O.center);Q.center.x=L.z;Q.center.y=L.x;Q.center.z=L.y;O.radius=p.SOLAR_RADIUS+p.SOLAR_RADIUS*this._glowLengthTS;Q.radius=O.radius;t===J.SCENE3D?b.clone(O,m.boundingVolume):t===J.COLUMBUS_VIEW&&b.clone(Q,m.boundingVolume);t=w.computeActualWgs84Position(e,G,P);e=f.magnitude(f.subtract(t,e.camera.position,P));y=y.uniformState.projection;K.x=0;K.y=0;K.z=-e;K.w=1;e=d.multiplyByVector(y,K,P);e=w.clipToGLWindowCoordinates(k.viewport,e,E);K.x=p.SOLAR_RADIUS;y=d.multiplyByVector(y,K,P);k=w.clipToGLWindowCoordinates(k.viewport,y,I);this._size=Math.ceil(a.magnitude(a.subtract(k,e,P)));this._size=2*this._size*(1+2*this._glowLengthTS);return this._commands}}};G.prototype.isDestroyed=function(){return!1};G.prototype.destroy=function(){var a=this._drawCommand;a.vertexArray=a.vertexArray&&a.vertexArray.destroy();a.shaderProgram=a.shaderProgram&&a.shaderProgram.destroy();this._texture=this._texture&&this._texture.destroy();return e(this)};return G});F("Scene/TileBoundingVolume",["../Core/DeveloperError"],function(b){function a(){}a.prototype.boundingVolume=void 0;a.prototype.boundingSphere=void 0;a.prototype.distanceToCamera=function(a){b.throwInstantiationError()};a.prototype.intersectPlane=function(a){b.throwInstantiationError()};a.prototype.createDebugVolume=function(a){b.throwInstantiationError()};return a});F("Scene/TileCoordinatesImageryProvider","../Core/Color ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/Event ../Core/GeographicTilingScheme ../ThirdParty/when".split(" "),function(b,a,f,k,g,l,m){function e(e){e=a(e,a.EMPTY_OBJECT);this._tilingScheme=f(e.tilingScheme)?e.tilingScheme:new l({ellipsoid:e.ellipsoid});this._color=a(e.color,b.YELLOW);this._errorEvent=new g;this._tileWidth=a(e.tileWidth,256);this._tileHeight=a(e.tileHeight,256);this._readyPromise=m.resolve(!0)}k(e.prototype,{proxy:{get:function(){}},tileWidth:{get:function(){return this._tileWidth}},tileHeight:{get:function(){return this._tileHeight}},maximumLevel:{get:function(){}},minimumLevel:{get:function(){}},tilingScheme:{get:function(){return this._tilingScheme}},rectangle:{get:function(){return this._tilingScheme.rectangle}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return!0}},readyPromise:{get:function(){return this._readyPromise}},credit:{get:function(){}},hasAlphaChannel:{get:function(){return!0}}});e.prototype.getTileCredits=function(a,b,d){};e.prototype.requestImage=function(a,b,d,e){e=document.createElement("canvas");e.width=256;e.height=256;var f=e.getContext("2d"),g=this._color.toCssColorString();f.strokeStyle=g;f.lineWidth=2;f.strokeRect(1,1,255,255);a="L"+d+"X"+a+"Y"+b;f.font="bold 25px Arial";f.textAlign="center";f.fillStyle="black";f.fillText(a,127,127);f.fillStyle=g;f.fillText(a,124,124);return e};e.prototype.pickFeatures=function(a,b,d,e,f){};return e});F("Scene/TileDiscardPolicy",["../Core/DeveloperError"],function(b){function a(a){b.throwInstantiationError()}a.prototype.isReady=b.throwInstantiationError;a.prototype.shouldDiscardImage=b.throwInstantiationError;return a});F("Scene/TileState",["../Core/freezeObject"],function(b){return b({START:0,LOADING:1,READY:2,UPSAMPLED_ONLY:3})});F("Scene/TimeDynamicPointCloud","../Core/arrayFill ../Core/Check ../Core/combine ../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/Event ../Core/getTimestamp ../Core/JulianDate ../Core/Math ../Core/Matrix4 ../Core/Resource ../ThirdParty/when ./ClippingPlaneCollection ./PointCloud ./PointCloudEyeDomeLighting ./PointCloudShading ./SceneMode ./ShadowMode".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x){function D(c){c=k(c,k.EMPTY_OBJECT);a.typeOf.object("options.clock",c.clock);a.typeOf.object("options.intervals",c.intervals);this.show=k(c.show,!0);this.modelMatrix=q.clone(k(c.modelMatrix,q.IDENTITY));this.shadows=k(c.shadows,x.ENABLED);this.maximumMemoryUsage=k(c.maximumMemoryUsage,256);this.shading=new A(c.shading);this.style=c.style;this.frameFailed=new e;this.frameChanged=new e;this._clock=c.clock;this._intervals=c.intervals;this._clippingPlanes=void 0;this.clippingPlanes=c.clippingPlanes;this._pointCloudEyeDomeLighting=new y;this._loadTimestamp=void 0;this._clippingPlanesState=0;this._styleDirty=!1;this._pickId=void 0;this._totalMemoryUsageInBytes=0;this._frames=[];this._lastRenderedFrame=this._nextInterval=this._previousInterval=void 0;this._clockMultiplier=0;this._readyPromise=r.defer();this._runningIndex=this._runningLength=this._runningSum=0;this._runningSamples=b(Array(5),0);this._runningAverage=0}function v(a){return"uniform vec4 czm_pickColor;\n"+a}function B(a){return function(b){return f(b,{czm_pickColor:function(){return a._pickId.color}})}}function C(){return"czm_pickColor"}function F(a){a=a._clock;var b=a.multiplier;return a.canAnimate&&a.shouldAnimate?b:0}function H(a,b){var c=a._intervals,d=a._clock,e=F(a);if(0!==e){var f=a._getAverageLoadTime(),d=p.addSeconds(d.currentTime,f*e,W),d=c.indexOf(d),f=a._intervals.indexOf(b.start);d===f&&(0<=e?++d:--d);return c.get(d)}}function J(a){var b=a._intervals;a=b.indexOf(a._clock.currentTime);return b.get(a)}function w(a,b,c){var d=F(a);b=a._intervals.indexOf(b.start);a=a._intervals.indexOf(c.start);return 0<=d?b>=a:b<=a}function G(a,b){return function(c){c=g(c.message)?c.message:c.toString();0<a.frameFailed.numberOfListeners?a.frameFailed.raiseEvent({uri:b,message:c}):(console.log("A frame failed to load: "+b),console.log("Error: "+c))}}function E(a,b,c){var d=a._intervals.indexOf(b.start),e=a._frames,f=e[d];if(!g(f)){var k=b.data.transform,k=g(k)?q.fromArray(k):void 0;b=b.data.uri;f={pointCloud:void 0,transform:k,timestamp:h(),sequential:!0,ready:!1,touchedFrameNumber:c.frameNumber};e[d]=f;t.fetchArrayBuffer({url:b}).then(function(b){f.pointCloud=new u({arrayBuffer:b,cull:!0,fragmentShaderLoaded:v,uniformMapLoaded:B(a),pickIdLoaded:C});return f.pointCloud.readyPromise}).otherwise(G(a,b))}return f}function L(a,b,c,e){var f=k(a.shading,R),h=b.pointCloud,l=k(b.transform,q.IDENTITY);h.modelMatrix=q.multiplyTransformation(a.modelMatrix,l,M);h.style=a.style;h.time=c.timeSinceLoad;h.shadows=a.shadows;h.clippingPlanes=a._clippingPlanes;h.isClipped=c.isClipped;h.attenuation=f.attenuation;h.backFaceCulling=f.backFaceCulling;h.normalShading=f.normalShading;c=a.shading;c=g(c)&&g(c.baseResolution)?c.baseResolution:g(h.boundingSphere)?d.cbrt(h.boundingSphere.volume()/h.pointsLength):0;h.geometricError=c;h.geometricErrorScale=f.geometricErrorScale;a=a.shading;a=g(a)&&g(a.maximumAttenuation)?a.maximumAttenuation:10;h.maximumAttenuation=a;h.update(e);b.touchedFrameNumber=e.frameNumber}function K(a,b,c,d){b=E(a,b,d);b.touchedFrameNumber<d.frameNumber-1&&(b.sequential=!1);var e=b.pointCloud;if(g(e)&&!b.ready){var f=d.commandList,k=f.length;L(a,b,c,d);e.ready&&(b.ready=!0,a._totalMemoryUsageInBytes+=e.geometryByteLength,f.length=k,b.sequential&&(c=(h()-b.timestamp)/1E3,a._runningSum+=c,a._runningSum-=a._runningSamples[a._runningIndex],a._runningSamples[a._runningIndex]=c,a._runningLength=Math.min(a._runningLength+1,a._runningSamples.length),a._runningIndex=(a._runningIndex+1)%a._runningSamples.length,a._runningAverage=a._runningSum/a._runningLength))}b.touchedFrameNumber=d.frameNumber}function P(a){return function(b){return b.touchedFrameNumber<a.frameNumber}}function N(a,b){for(var c=a._frames,d=c.length,e=0;e<d;++e){var f=c[e];if(g(f)&&(!g(b)||b(f))){var h=f.pointCloud;f.ready&&(a._totalMemoryUsageInBytes-=h.geometryByteLength);g(h)&&h.destroy();f===a._lastRenderedFrame&&(a._lastRenderedFrame=void 0);c[e]=void 0}}}function O(a,b){var c=a._intervals.indexOf(b.start),c=a._frames[c];if(g(c)&&c.ready)return c}function Z(a,b,c,d,e){if(g(c)){if(c.ready)return!0;K(a,b,d,e);return c.ready}return!1}function aa(a,b,c,d,e){var f,g,h,k=a._intervals,l=a._frames;f=a._intervals.indexOf(c.start);c=a._intervals.indexOf(b.start);if(f>=c)for(;f>=c;--f){if(g=k.get(f),h=l[f],Z(a,g,h,d,e))return g}else for(;f<=c;++f)if(g=k.get(f),h=l[f],Z(a,g,h,d,e))return g;return b}function U(a,b,c){a=a._frames;for(var d=a.length,e=0;e<d;++e){var f=a[e];g(f)&&g(f.pointCloud)&&(f.pointCloud.clippingPlanesDirty=b,f.pointCloud.styleDirty=c)}}l(D.prototype,{clippingPlanes:{get:function(){return this._clippingPlanes},set:function(a){c.setOwner(a,this,"_clippingPlanes")}},totalMemoryUsageInBytes:{get:function(){return this._totalMemoryUsageInBytes}},boundingSphere:{get:function(){if(g(this._lastRenderedFrame))return this._lastRenderedFrame.pointCloud.boundingSphere}},readyPromise:{get:function(){return this._readyPromise.promise}}});D.prototype.makeStyleDirty=function(){this._styleDirty=!0};D.prototype._getAverageLoadTime=function(){return 0===this._runningLength?.05:this._runningAverage};var W=new p,M=new q,R=new A,Y={timeSinceLoad:0,isClipped:!1,clippingPlanesDirty:!1};D.prototype.update=function(a){if(a.mode!==z.MORPHING&&this.show){g(this._pickId)||(this._pickId=a.context.createPickId({primitive:this}));g(this._loadTimestamp)||(this._loadTimestamp=p.clone(a.time));var b=Math.max(1E3*p.secondsDifference(a.time,this._loadTimestamp),0),c=this._clippingPlanes,d=0,e=!1,f=g(c)&&c.enabled;f&&(c.update(a),d=c.clippingPlanesState);this._clippingPlanesState!==d&&(this._clippingPlanesState=d,e=!0);c=this._styleDirty;this._styleDirty=!1;(e||c)&&U(this,e,c);Y.timeSinceLoad=b;Y.isClipped=f;var b=this.shading,e=this._pointCloudEyeDomeLighting,c=a.commandList,f=c.length,d=this._previousInterval,h=this._nextInterval,k=J(this);if(g(k)){var l=!1,m=F(this),q=0===m;m!==this._clockMultiplier&&(l=!0,this._clockMultiplier=m);if(!g(d)||q)d=k;if(!g(h)||l||w(this,k,h))h=H(this,k);d=aa(this,d,k,Y,a);k=O(this,d);g(k)||(K(this,d,Y,a),k=this._lastRenderedFrame);g(k)&&L(this,k,Y,a);g(h)&&K(this,h,Y,a);var r=this;g(k)&&!g(this._lastRenderedFrame)&&a.afterRender.push(function(){r._readyPromise.resolve(r)});g(k)&&k!==this._lastRenderedFrame&&0<r.frameChanged.numberOfListeners&&a.afterRender.push(function(){r.frameChanged.raiseEvent(r)});this._previousInterval=d;this._nextInterval=h;this._lastRenderedFrame=k;this._totalMemoryUsageInBytes>1048576*this.maximumMemoryUsage&&N(this,P(a));c=c.length-f;g(b)&&b.attenuation&&b.eyeDomeLighting&&0<c&&e.update(a,f,b)}}};D.prototype.isDestroyed=function(){return!1};D.prototype.destroy=function(){N(this);this._clippingPlanes=this._clippingPlanes&&this._clippingPlanes.destroy();this._pickId=this._pickId&&this._pickId.destroy();return m(this)};return D});F("Shaders/ViewportQuadFS",[],function(){return"varying vec2 v_textureCoordinates;\nvoid main()\n{\nczm_materialInput materialInput;\nmaterialInput.s \x3d v_textureCoordinates.s;\nmaterialInput.st \x3d v_textureCoordinates;\nmaterialInput.str \x3d vec3(v_textureCoordinates, 0.0);\nmaterialInput.normalEC \x3d vec3(0.0, 0.0, -1.0);\nczm_material material \x3d czm_getMaterial(materialInput);\ngl_FragColor \x3d vec4(material.diffuse + material.emission, material.alpha);\n}\n"});F("Scene/ViewportQuad","../Core/BoundingRectangle ../Core/Color ../Core/defined ../Core/destroyObject ../Core/DeveloperError ../Renderer/Pass ../Renderer/RenderState ../Renderer/ShaderSource ../Shaders/ViewportQuadFS ./BlendingState ./Material".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(e,g){this.show=!0;f(e)||(e=new b);this.rectangle=b.clone(e);f(g)||(g=d.fromType(d.ColorType,{color:new a(1,1,1,1)}));this.material=g;this._rs=this._overlayCommand=this._material=void 0}q.prototype.update=function(a){if(this.show){if(!f(this.material))throw new g("this.material must be defined.");if(!f(this.rectangle))throw new g("this.rectangle must be defined.");var d=this._rs;f(d)&&b.equals(d.viewport,this.rectangle)||(this._rs=m.fromCache({blending:p.ALPHA_BLEND,viewport:this.rectangle}));if(a.passes.render){d=a.context;if(this._material!==this.material||!f(this._overlayCommand)){this._material=this.material;f(this._overlayCommand)&&this._overlayCommand.shaderProgram.destroy();var c=new e({sources:[this._material.shaderSource,h]});this._overlayCommand=d.createViewportQuadCommand(c,{renderState:this._rs,uniformMap:this._material._uniforms,owner:this});this._overlayCommand.pass=l.OVERLAY}this._material.update(d);this._overlayCommand.uniformMap=this._material._uniforms;a.commandList.push(this._overlayCommand)}}};q.prototype.isDestroyed=function(){return!1};q.prototype.destroy=function(){f(this._overlayCommand)&&(this._overlayCommand.shaderProgram=this._overlayCommand.shaderProgram&&this._overlayCommand.shaderProgram.destroy());return k(this)};return q});(function(){(function(b){var a=this||(0,eval)("this"),f=a.document,k=a.navigator,g=a.jQuery,l=a.JSON;g||"undefined"===typeof jQuery||(g=jQuery);(function(b){"function"===typeof F&&F.amd?F("ThirdParty/knockout-3.5.0",["exports","require"],b):"object"===typeof exports&&"object"===typeof module?b(module.exports||exports):b(a.ko={})})(function(m,e){function h(a,b){return null===a||typeof a in u?a===b:!1}function p(a,d){var e;return function(){e||(e=c.a.setTimeout(function(){e=b;a()},d))}}function d(a,b){var d;return function(){clearTimeout(d);d=c.a.setTimeout(a,b)}}function q(a,b){b&&"change"!==b?"beforeChange"===b?this.oc(a):this.bb(a,b):this.pc(a)}function t(a,b){null!==b&&b.s&&b.s()}function r(a,b){var c=this.pd,d=c[D];d.qa||(this.Pb&&this.kb[b]?(c.tc(b,a,this.kb[b]),this.kb[b]=null,--this.Pb):d.F[b]||c.tc(b,a,d.G?{da:a}:c.Zc(a)),a.Ka&&a.fd())}var c="undefined"!==typeof m?m:{};c.b=function(a,b){for(var d=a.split("."),e=c,f=0;f<d.length-1;f++)e=e[d[f]];e[d[d.length-1]]=b};c.J=function(a,b,c){a[b]=c};c.version="3.5.0";c.b("version",c.version);c.options={deferUpdates:!1,useOnlyNativeEvents:!1,foreachHidesDestroyed:!1};c.a=function(){function d(a,b){for(var c in a)p.call(a,c)&&b(c,a[c])}function e(a,b){if(b)for(var c in b)p.call(b,c)&&(a[c]=b[c]);return a}function h(a,b){a.__proto__=b;return a}function m(a,b,d,e){var f=a[b].match(z)||[];c.a.C(d.match(z),function(a){c.a.Oa(f,a,e)});a[b]=f.join(" ")}$jscomp.initSymbol();var p=Object.prototype.hasOwnProperty,q={__proto__:[]}instanceof Array,r="function"===typeof Symbol,t={},u={};t[k&&/Firefox\/2/i.test(k.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"];t.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" ");d(t,function(a,b){if(b.length)for(var c=0,d=b.length;c<d;c++)u[b[c]]=a});var v={propertychange:!0},y=f&&function(){for(var a=3,c=f.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="\x3c!--[if gt IE "+ ++a+"]\x3e\x3ci\x3e\x3c/i\x3e\x3c![endif]--\x3e",d[0];);return 4<a?a:b}(),z=/\S+/g,A;return{Ic:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],C:function(a,b,c){for(var d=0,e=a.length;d<e;d++)b.call(c,a[d],d,a)},A:"function"==typeof Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,b)}:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},Lb:function(a,c,d){for(var e=0,f=a.length;e<f;e++)if(c.call(d,a[e],e,a))return a[e];return b},hb:function(a,b){var d=c.a.A(a,b);0<d?a.splice(d,1):0===d&&a.shift()},vc:function(a){var b=[];a&&c.a.C(a,function(a){0>c.a.A(b,a)&&b.push(a)});return b},Mb:function(a,b,c){var d=[];if(a)for(var e=0,f=a.length;e<f;e++)d.push(b.call(c,a[e],e));return d},fb:function(a,b,c){var d=[];if(a)for(var e=0,f=a.length;e<f;e++)b.call(c,a[e],e)&&d.push(a[e]);return d},gb:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;c<d;c++)a.push(b[c]);return a},Oa:function(a,b,d){var e=c.a.A(c.a.$b(a),b);0>e?d&&a.push(b):d||a.splice(e,1)},Ba:q,extend:e,setPrototypeOf:h,zb:q?h:e,O:d,Ha:function(a,b,c){if(!a)return a;var d={},e;for(e in a)p.call(a,e)&&(d[e]=b.call(c,a[e],e,a));return d},Sb:function(a){for(;a.firstChild;)c.removeNode(a.firstChild)},Xb:function(a){a=c.a.la(a);for(var b=(a[0]&&a[0].ownerDocument||f).createElement("div"),d=0,e=a.length;d<e;d++)b.appendChild(c.na(a[d]));return b},Ca:function(a,b){for(var d=0,e=a.length,f=[];d<e;d++){var g=a[d].cloneNode(!0);f.push(b?c.na(g):g)}return f},ua:function(a,b){c.a.Sb(a);if(b)for(var d=0,e=b.length;d<e;d++)a.appendChild(b[d])},Wc:function(a,b){var d=a.nodeType?[a]:a;if(0<d.length){for(var e=d[0],f=e.parentNode,g=0,h=b.length;g<h;g++)f.insertBefore(b[g],e);g=0;for(h=d.length;g<h;g++)c.removeNode(d[g])}},Ua:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.splice(0,1);for(;1<a.length&&a[a.length-1].parentNode!==b;)a.length--;if(1<a.length){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)a.push(c),c=c.nextSibling;a.push(d)}}return a},Yc:function(a,b){7>y?a.setAttribute("selected",b):a.selected=b},Cb:function(a){return null===a||a===b?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Td:function(a,b){a=a||"";return b.length>a.length?!1:a.substring(0,b.length)===b},ud:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(1!==a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(b.compareDocumentPosition(a)&16);for(;a&&a!=b;)a=a.parentNode;return!!a},Rb:function(a){return c.a.ud(a,a.ownerDocument.documentElement)},jd:function(a){return!!c.a.Lb(a,c.a.Rb)},P:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},zc:function(a){return c.onError?function(){try{return a.apply(this,arguments)}catch(Y){throw c.onError&&c.onError(Y),Y;}}:a},setTimeout:function(a,b){return setTimeout(c.a.zc(a),b)},Fc:function(a){setTimeout(function(){c.onError&&c.onError(a);throw a;},0)},H:function(a,b,d){var e=c.a.zc(d);d=v[b];if(c.options.useOnlyNativeEvents||d||!g)if(d||"function"!=typeof a.addEventListener)if("undefined"!=typeof a.attachEvent){var f=function(b){e.call(a,b)},h="on"+b;a.attachEvent(h,f);c.a.I.za(a,function(){a.detachEvent(h,f)})}else throw Error("Browser doesn't support addEventListener or attachEvent");else a.addEventListener(b,e,!1);else A||(A="function"==typeof g(a).on?"on":"bind"),g(a)[A](b,e)},Fb:function(b,d){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var e;"input"===c.a.P(b)&&b.type&&"click"==d.toLowerCase()?(e=b.type,e="checkbox"==e||"radio"==e):e=!1;if(c.options.useOnlyNativeEvents||!g||e)if("function"==typeof f.createEvent)if("function"==typeof b.dispatchEvent)e=f.createEvent(u[d]||"HTMLEvents"),e.initEvent(d,!0,!0,a,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(e);else throw Error("The supplied element doesn't support dispatchEvent");else if(e&&b.click)b.click();else if("undefined"!=typeof b.fireEvent)b.fireEvent("on"+d);else throw Error("Browser doesn't support triggering events");else g(b).trigger(d)},c:function(a){return c.N(a)?a():a},$b:function(a){return c.N(a)?a.w():a},Eb:function(a,b,d){var e;b&&("object"===typeof a.classList?(e=a.classList[d?"add":"remove"],c.a.C(b.match(z),function(b){e.call(a.classList,b)})):"string"===typeof a.className.baseVal?m(a.className,"baseVal",b,d):m(a,"className",b,d))},Ab:function(a,d){var e=c.a.c(d);if(null===e||e===b)e="";var f=c.h.firstChild(a);!f||3!=f.nodeType||c.h.nextSibling(f)?c.h.ua(a,[a.ownerDocument.createTextNode(e)]):f.data=e;c.a.zd(a)},Xc:function(a,b){a.name=b;if(7>=y)try{var c=a.name.replace(/[&<>'"]/g,function(a){return"\x26#"+a.charCodeAt(0)+";"});a.mergeAttributes(f.createElement("\x3cinput name\x3d'"+c+"'/\x3e"),!1)}catch(S){}},zd:function(a){9<=y&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},vd:function(a){if(y){var b=a.style.width;a.style.width=0;a.style.width=b}},Od:function(a,b){a=c.a.c(a);b=c.a.c(b);for(var d=[],e=a;e<=b;e++)d.push(e);return d},la:function(a){for(var b=[],c=0,d=a.length;c<d;c++)b.push(a[c]);return b},Da:function(a){$jscomp.initSymbol();return r?Symbol(a):a},Xd:6===y,Yd:7===y,W:y,Kc:function(a,b){for(var d=c.a.la(a.getElementsByTagName("input")).concat(c.a.la(a.getElementsByTagName("textarea"))),e="string"==typeof b?function(a){return a.name===b}:function(a){return b.test(a.name)},f=[],g=d.length-1;0<=g;g--)e(d[g])&&f.push(d[g]);return f},Md:function(a){return"string"==typeof a&&(a=c.a.Cb(a))?l&&l.parse?l.parse(a):(new Function("return "+a))():null},fc:function(a,b,d){if(!l||!l.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE \x3c 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return l.stringify(c.a.c(a),b,d)},Nd:function(a,b,e){e=e||{};var g=e.params||{},h=e.includeFields||this.Ic,k=a;if("object"==typeof a&&"form"===c.a.P(a))for(var k=a.action,l=h.length-1;0<=l;l--)for(var m=c.a.Kc(a,h[l]),p=m.length-1;0<=p;p--)g[m[p].name]=m[p].value;b=c.a.c(b);var q=f.createElement("form");q.style.display="none";q.action=k;q.method="post";for(var r in b)a=f.createElement("input"),a.type="hidden",a.name=r,a.value=c.a.fc(c.a.c(b[r])),q.appendChild(a);d(g,function(a,b){var c=f.createElement("input");c.type="hidden";c.name=a;c.value=b;q.appendChild(c)});f.body.appendChild(q);e.submitter?e.submitter(q):q.submit();setTimeout(function(){q.parentNode.removeChild(q)},0)}}}();c.b("utils",c.a);c.b("utils.arrayForEach",c.a.C);c.b("utils.arrayFirst",c.a.Lb);c.b("utils.arrayFilter",c.a.fb);c.b("utils.arrayGetDistinctValues",c.a.vc);c.b("utils.arrayIndexOf",c.a.A);c.b("utils.arrayMap",c.a.Mb);c.b("utils.arrayPushAll",c.a.gb);c.b("utils.arrayRemoveItem",c.a.hb);c.b("utils.cloneNodes",c.a.Ca);c.b("utils.createSymbolOrString",c.a.Da);c.b("utils.extend",c.a.extend);c.b("utils.fieldsIncludedWithJsonPost",c.a.Ic);c.b("utils.getFormFields",c.a.Kc);c.b("utils.objectMap",c.a.Ha);c.b("utils.peekObservable",c.a.$b);c.b("utils.postJson",c.a.Nd);c.b("utils.parseJson",c.a.Md);c.b("utils.registerEventHandler",c.a.H);c.b("utils.stringifyJson",c.a.fc);c.b("utils.range",c.a.Od);c.b("utils.toggleDomNodeCssClass",c.a.Eb);c.b("utils.triggerEvent",c.a.Fb);c.b("utils.unwrapObservable",c.a.c);c.b("utils.objectForEach",c.a.O);c.b("utils.addOrRemoveItem",c.a.Oa);c.b("utils.setTextContent",c.a.Ab);c.b("unwrap",c.a.c);Function.prototype.bind||(Function.prototype.bind=function(a){var b=this;if(1===arguments.length)return function(){return b.apply(a,arguments)};var c=Array.prototype.slice.call(arguments,1);return function(){var d=c.slice(0);d.push.apply(d,arguments);return b.apply(a,d)}});c.a.g=new function(){var a=0,d="__ko__"+(new Date).getTime(),e={},f,g;c.a.W?(f=function(c,f){var g=c[d];if(!g||"null"===g||!e[g]){if(!f)return b;g=c[d]="ko"+a++;e[g]={}}return e[g]},g=function(a){var b=a[d];return b?(delete e[b],a[d]=null,!0):!1}):(f=function(a,b){var c=a[d];!c&&b&&(c=a[d]={});return c},g=function(a){return a[d]?(delete a[d],!0):!1});return{get:function(a,b){var c=f(a,!1);return c&&c[b]},set:function(a,c,d){(a=f(a,d!==b))&&(a[c]=d)},Tb:function(a,b,c){a=f(a,!0);return a[b]||(a[b]=c)},clear:g,Z:function(){return a++ +d}}};c.b("utils.domData",c.a.g);c.b("utils.domData.clear",c.a.g.clear);c.a.I=new function(){function a(a,d){var e=c.a.g.get(a,f);e===b&&d&&(e=[],c.a.g.set(a,f,e));return e}function d(b){var d=a(b,!1);if(d)for(var d=d.slice(0),f=0;f<d.length;f++)d[f](b);c.a.g.clear(b);c.a.I.cleanExternalData(b);k[b.nodeType]&&e(b.childNodes,!0)}function e(a,b){for(var e=[],f,g=0;g<a.length;g++)if(!b||8===a[g].nodeType)if(d(e[e.length]=f=a[g]),a[g]!==f)for(;g--&&-1==c.a.A(e,a[g]););}var f=c.a.g.Z(),h={1:!0,8:!0,9:!0},k={1:!0,9:!0};return{za:function(b,c){if("function"!=typeof c)throw Error("Callback must be a function");a(b,!0).push(c)},xb:function(d,e){var g=a(d,!1);g&&(c.a.hb(g,e),0==g.length&&c.a.g.set(d,f,b))},na:function(a){h[a.nodeType]&&(d(a),k[a.nodeType]&&e(a.getElementsByTagName("*")));return a},removeNode:function(a){c.na(a);a.parentNode&&a.parentNode.removeChild(a)},cleanExternalData:function(a){g&&"function"==typeof g.cleanData&&g.cleanData([a])}}};c.na=c.a.I.na;c.removeNode=c.a.I.removeNode;c.b("cleanNode",c.na);c.b("removeNode",c.removeNode);c.b("utils.domNodeDisposal",c.a.I);c.b("utils.domNodeDisposal.addDisposeCallback",c.a.I.za);c.b("utils.domNodeDisposal.removeDisposeCallback",c.a.I.xb);(function(){var d=[0,"",""],e=[1,"\x3ctable\x3e","\x3c/table\x3e"],h=[3,"\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e","\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"],k=[1,"\x3cselect multiple\x3d'multiple'\x3e","\x3c/select\x3e"],l={thead:e,tbody:e,tfoot:e,tr:[2,"\x3ctable\x3e\x3ctbody\x3e","\x3c/tbody\x3e\x3c/table\x3e"],td:h,th:h,option:k,optgroup:k},m=8>=c.a.W;c.a.ta=function(b,e){var h;if(g)if(g.parseHTML)h=g.parseHTML(b,e)||[];else{if((h=g.clean([b],e))&&h[0]){for(var k=h[0];k.parentNode&&11!==k.parentNode.nodeType;)k=k.parentNode;k.parentNode&&k.parentNode.removeChild(k)}}else{(h=e)||(h=f);var k=h.parentWindow||h.defaultView||a,p=c.a.Cb(b).toLowerCase(),q=h.createElement("div"),r;r=(p=p.match(/^(?:\x3c!--.*?--\x3e\s*?)*?<([a-z]+)[\s>]/))&&l[p[1]]||d;p=r[0];r="ignored\x3cdiv\x3e"+r[1]+b+r[2]+"\x3c/div\x3e";for("function"==typeof k.innerShiv?q.appendChild(k.innerShiv(r)):(m&&h.body.appendChild(q),q.innerHTML=r,m&&q.parentNode.removeChild(q));p--;)q=q.lastChild;h=c.a.la(q.lastChild.childNodes)}return h};c.a.Ld=function(a,b){var d=c.a.ta(a,b);return d.length&&d[0].parentElement||c.a.Xb(d)};c.a.dc=function(a,d){c.a.Sb(a);d=c.a.c(d);if(null!==d&&d!==b)if("string"!=typeof d&&(d=d.toString()),g)g(a).html(d);else for(var e=c.a.ta(d,a.ownerDocument),f=0;f<e.length;f++)a.appendChild(e[f])}})();c.b("utils.parseHtmlFragment",c.a.ta);c.b("utils.setHtml",c.a.dc);c.aa=function(){function a(b,d){if(b)if(8==b.nodeType){var e=c.aa.Tc(b.nodeValue);null!=e&&d.push({sd:b,Jd:e})}else if(1==b.nodeType)for(var e=0,f=b.childNodes,g=f.length;e<g;e++)a(f[e],d)}var d={};return{Wb:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);d[b]=a;return"\x3c!--[ko_memo:"+b+"]--\x3e"},ad:function(a,c){var e=d[a];if(e===b)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return e.apply(null,c||[]),!0}finally{delete d[a]}},bd:function(b,d){var e=[];a(b,e);for(var f=0,g=e.length;f<g;f++){var h=e[f].sd,k=[h];d&&c.a.gb(k,d);c.aa.ad(e[f].Jd,k);h.nodeValue="";h.parentNode&&h.parentNode.removeChild(h)}},Tc:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}();c.b("memoization",c.aa);c.b("memoization.memoize",c.aa.Wb);c.b("memoization.unmemoize",c.aa.ad);c.b("memoization.parseMemoText",c.aa.Tc);c.b("memoization.unmemoizeDomNodeAndDescendants",c.aa.bd);c.ma=function(){function b(){if(h)for(var a=h,b=0,d;l<h;)if(d=g[l++]){if(l>a){if(5E3<=++b){l=h;c.a.Fc(Error("'Too much recursion' after processing "+b+" task groups."));break}a=h}try{d()}catch(U){c.a.Fc(U)}}}function d(){b();l=h=g.length=0}var e,g=[],h=0,k=1,l=0;a.MutationObserver?e=function(a){var b=f.createElement("div");(new MutationObserver(a)).observe(b,{attributes:!0});return function(){b.classList.toggle("foo")}}(d):e=f&&"onreadystatechange"in f.createElement("script")?function(a){var b=f.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=null;f.documentElement.removeChild(b);b=null;a()};f.documentElement.appendChild(b)}:function(a){setTimeout(a,0)};return{scheduler:e,yb:function(a){h||c.ma.scheduler(d);g[h++]=a;return k++},cancel:function(a){a-=k-h;a>=l&&a<h&&(g[a]=null)},resetForTesting:function(){var a=h-l;l=h=g.length=0;return a},Rd:b}}();c.b("tasks",c.ma);c.b("tasks.schedule",c.ma.yb);c.b("tasks.runEarly",c.ma.Rd);c.Ta={throttle:function(a,b){a.throttleEvaluation=b;var d=null;return c.$({read:a,write:function(e){clearTimeout(d);d=c.a.setTimeout(function(){a(e)},b)}})},rateLimit:function(a,b){var c,e,f;"number"==typeof b?c=b:(c=b.timeout,e=b.method);a.Hb=!1;f="function"==typeof e?e:"notifyWhenChangesStop"==e?d:p;a.tb(function(a){return f(a,c,b)})},deferred:function(a,d){if(!0!==d)throw Error("The 'deferred' extender only accepts the value 'true', because it is not supported to turn deferral off once enabled.");a.Hb||(a.Hb=!0,a.tb(function(d){var e,f=!1;return function(){if(!f){c.ma.cancel(e);e=c.ma.yb(d);try{f=!0,a.notifySubscribers(b,"dirty")}finally{f=!1}}}}))},notify:function(a,b){a.equalityComparer="always"==b?null:h}};var u={undefined:1,"boolean":1,number:1,string:1};c.b("extenders",c.Ta);c.gc=function(a,b,d){this.da=a;this.kc=b;this.lc=d;this.Ib=!1;this.ab=this.Jb=null;c.J(this,"dispose",this.s);c.J(this,"disposeWhenNodeIsRemoved",this.l)};c.gc.prototype.s=function(){this.Ib||(this.ab&&c.a.I.xb(this.Jb,this.ab),this.Ib=!0,this.lc(),this.da=this.kc=this.lc=this.Jb=this.ab=null)};c.gc.prototype.l=function(a){this.Jb=a;c.a.I.za(a,this.ab=this.s.bind(this))};c.R=function(){c.a.zb(this,y);y.ob(this)};var y={ob:function(a){a.S={change:[]};a.rc=1},subscribe:function(a,b,d){var e=this;d=d||"change";var f=new c.gc(e,b?a.bind(b):a,function(){c.a.hb(e.S[d],f);e.cb&&e.cb(d)});e.Qa&&e.Qa(d);e.S[d]||(e.S[d]=[]);e.S[d].push(f);return f},notifySubscribers:function(a,b){b=b||"change";"change"===b&&this.Gb();if(this.Wa(b)){var d="change"===b&&this.dd||this.S[b].slice(0);try{c.v.wc();for(var e=0,f;f=d[e];++e)f.Ib||f.kc(a)}finally{c.v.end()}}},mb:function(){return this.rc},Cd:function(a){return this.mb()!==a},Gb:function(){++this.rc},tb:function(a){var b=this,d=c.N(b),e,f,g,h,k;b.bb||(b.bb=b.notifySubscribers,b.notifySubscribers=q);var l=a(function(){b.Ka=!1;d&&h===b&&(h=b.mc?b.mc():b());var a=f||k&&b.qb(g,h);k=f=e=!1;a&&b.bb(g=h)});b.pc=function(a,c){c&&b.Ka||(k=!c);b.dd=b.S.change.slice(0);b.Ka=e=!0;h=a;l()};b.oc=function(a){e||(g=a,b.bb(a,"beforeChange"))};b.qc=function(){k=!0};b.fd=function(){b.qb(g,b.w(!0))&&(f=!0)}},Wa:function(a){return this.S[a]&&this.S[a].length},Ad:function(a){if(a)return this.S[a]&&this.S[a].length||0;var b=0;c.a.O(this.S,function(a,c){"dirty"!==a&&(b+=c.length)});return b},qb:function(a,b){return!this.equalityComparer||!this.equalityComparer(a,b)},toString:function(){return"[object Object]"},extend:function(a){var b=this;a&&c.a.O(a,function(a,d){var e=c.Ta[a];"function"==typeof e&&(b=e(b,d)||b)});return b}};c.J(y,"init",y.ob);c.J(y,"subscribe",y.subscribe);c.J(y,"extend",y.extend);c.J(y,"getSubscriptionsCount",y.Ad);c.a.Ba&&c.a.setPrototypeOf(y,Function.prototype);c.R.fn=y;c.Pc=function(a){return null!=a&&"function"==typeof a.subscribe&&"function"==typeof a.notifySubscribers};c.b("subscribable",c.R);c.b("isSubscribable",c.Pc);c.U=c.v=function(){function a(a){d.push(e);e=a}function b(){e=d.pop()}var d=[],e,f=0;return{wc:a,end:b,ac:function(a){if(e){if(!c.Pc(a))throw Error("Only subscribable things can act as dependencies");e.nd.call(e.od,a,a.ed||(a.ed=++f))}},K:function(c,d,e){try{return a(),c.apply(d,e||[])}finally{b()}},pa:function(){if(e)return e.o.pa()},Va:function(){if(e)return e.o.Va()},rb:function(){if(e)return e.rb},o:function(){if(e)return e.o}}}();c.b("computedContext",c.U);c.b("computedContext.getDependenciesCount",c.U.pa);c.b("computedContext.getDependencies",c.U.Va);c.b("computedContext.isInitial",c.U.rb);c.b("computedContext.registerDependency",c.U.ac);c.b("ignoreDependencies",c.Wd=c.v.K);var A=c.a.Da("_latestValue");c.sa=function(a){function b(){if(0<arguments.length)return b.qb(b[A],arguments[0])&&(b.xa(),b[A]=arguments[0],b.wa()),this;c.v.ac(b);return b[A]}b[A]=a;c.a.Ba||c.a.extend(b,c.R.fn);c.R.fn.ob(b);c.a.zb(b,z);c.options.deferUpdates&&c.Ta.deferred(b,!0);return b};var z={equalityComparer:h,w:function(){return this[A]},wa:function(){this.notifySubscribers(this[A],"spectate");this.notifySubscribers(this[A])},xa:function(){this.notifySubscribers(this[A],"beforeChange")}};c.a.Ba&&c.a.setPrototypeOf(z,c.R.fn);var x=c.sa.Na="__ko_proto__";z[x]=c.sa;c.N=function(a){if((a="function"==typeof a&&a[x])&&a!==z[x]&&a!==c.o.fn[x])throw Error("Invalid object that looks like an observable; possibly from another Knockout instance");return!!a};c.Ya=function(a){return"function"==typeof a&&(a[x]===z[x]||a[x]===c.o.fn[x]&&a.Mc)};c.b("observable",c.sa);c.b("isObservable",c.N);c.b("isWriteableObservable",c.Ya);c.b("isWritableObservable",c.Ya);c.b("observable.fn",z);c.J(z,"peek",z.w);c.J(z,"valueHasMutated",z.wa);c.J(z,"valueWillMutate",z.xa);c.Ia=function(a){a=a||[];if("object"!=typeof a||!("length"in a))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");a=c.sa(a);c.a.zb(a,c.Ia.fn);return a.extend({trackArrayChanges:!0})};c.Ia.fn={remove:function(a){for(var b=this.w(),d=[],e="function"!=typeof a||c.N(a)?function(b){return b===a}:a,f=0;f<b.length;f++){var g=b[f];if(e(g)){0===d.length&&this.xa();if(b[f]!==g)throw Error("Array modified during remove; cannot remove item");d.push(g);b.splice(f,1);f--}}d.length&&this.wa();return d},removeAll:function(a){if(a===b){var d=this.w(),e=d.slice(0);this.xa();d.splice(0,d.length);this.wa();return e}return a?this.remove(function(b){return 0<=c.a.A(a,b)}):[]},destroy:function(a){var b=this.w(),d="function"!=typeof a||c.N(a)?function(b){return b===a}:a;this.xa();for(var e=b.length-1;0<=e;e--){var f=b[e];d(f)&&(f._destroy=!0)}this.wa()},destroyAll:function(a){return a===b?this.destroy(function(){return!0}):a?this.destroy(function(b){return 0<=c.a.A(a,b)}):[]},indexOf:function(a){var b=this();return c.a.A(b,a)},replace:function(a,b){var c=this.indexOf(a);0<=c&&(this.xa(),this.w()[c]=b,this.wa())},sorted:function(a){var b=this().slice(0);return a?b.sort(a):b.sort()},reversed:function(){return this().slice(0).reverse()}};c.a.Ba&&c.a.setPrototypeOf(c.Ia.fn,c.sa.fn);c.a.C("pop push reverse shift sort splice unshift".split(" "),function(a){c.Ia.fn[a]=function(){var b=this.w();this.xa();this.yc(b,a,arguments);var c=b[a].apply(b,arguments);this.wa();return c===b?this:c}});c.a.C(["slice"],function(a){c.Ia.fn[a]=function(){var b=this();return b[a].apply(b,arguments)}});c.Oc=function(a){return c.N(a)&&"function"==typeof a.remove&&"function"==typeof a.push};c.b("observableArray",c.Ia);c.b("isObservableArray",c.Oc);c.Ta.trackArrayChanges=function(a,d){function e(){function b(){if(k){var b=[].concat(a.w()||[]);if(a.Wa("arrayChange")){var d;if(!g||1<k)g=c.a.Ob(l,b,a.Nb);d=g}l=b;g=null;k=0;d&&d.length&&a.notifySubscribers(d,"arrayChange")}}f?b():(f=!0,m=a.notifySubscribers,a.notifySubscribers=function(a,b){b&&"change"!==b||++k;return m.apply(this,arguments)},l=[].concat(a.w()||[]),g=null,h=a.subscribe(b))}a.Nb={};d&&"object"==typeof d&&c.a.extend(a.Nb,d);a.Nb.sparse=!0;if(!a.yc){var f=!1,g=null,h,k=0,l,m,p=a.Qa,q=a.cb;a.Qa=function(b){p&&p.call(a,b);"arrayChange"===b&&e()};a.cb=function(c){q&&q.call(a,c);"arrayChange"!==c||a.Wa("arrayChange")||(m&&(a.notifySubscribers=m,m=b),h&&h.s(),h=null,f=!1,l=b)};a.yc=function(a,b,d){function e(a,b,c){return h[h.length]={status:a,value:b,index:c}}if(f&&!k){var h=[],l=a.length,m=d.length,p=0;switch(b){case "push":p=l;case "unshift":for(b=0;b<m;b++)e("added",d[b],p+b);break;case "pop":p=l-1;case "shift":l&&e("deleted",a[p],p);break;case "splice":b=Math.min(Math.max(0,0>d[0]?l+d[0]:d[0]),l);for(var l=1===m?l:Math.min(b+(d[1]||0),l),m=b+m-2,p=Math.max(l,m),q=[],r=[],t=2;b<p;++b,++t)b<l&&r.push(e("deleted",a[b],b)),b<m&&q.push(e("added",d[t],b));c.a.Jc(r,q);break;default:return}g=h}}}};var D=c.a.Da("_state");c.o=c.$=function(a,d,e){function f(){if(0<arguments.length){if("function"===typeof g)g.apply(h.lb,arguments);else throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return this}h.qa||c.v.ac(f);(h.ka||h.G&&f.Xa())&&f.ha();return h.X}"object"===typeof a?e=a:(e=e||{},a&&(e.read=a));if("function"!=typeof e.read)throw Error("Pass a function that returns the value of the ko.computed");var g=e.write,h={X:b,ra:!0,ka:!0,pb:!1,hc:!1,qa:!1,vb:!1,G:!1,Vc:e.read,lb:d||e.owner,l:e.disposeWhenNodeIsRemoved||e.l||null,Sa:e.disposeWhen||e.Sa,Qb:null,F:{},V:0,Hc:null};f[D]=h;f.Mc="function"===typeof g;c.a.Ba||c.a.extend(f,c.R.fn);c.R.fn.ob(f);c.a.zb(f,v);e.pure?(h.vb=!0,h.G=!0,c.a.extend(f,B)):e.deferEvaluation&&c.a.extend(f,C);c.options.deferUpdates&&c.Ta.deferred(f,!0);h.l&&(h.hc=!0,h.l.nodeType||(h.l=null));h.G||e.deferEvaluation||f.ha();h.l&&f.ja()&&c.a.I.za(h.l,h.Qb=function(){f.s()});return f};var v={equalityComparer:h,pa:function(){return this[D].V},Va:function(){var a=[];c.a.O(this[D].F,function(b,c){a[c.La]=c.da});return a},Ub:function(a){if(!this[D].V)return!1;var b=this.Va();return-1!==c.a.A(b,a)?!0:!!c.a.Lb(b,function(b){return b.Ub&&b.Ub(a)})},tc:function(a,b,c){if(this[D].vb&&b===this)throw Error("A 'pure' computed must not be called recursively");this[D].F[a]=c;c.La=this[D].V++;c.Ma=b.mb()},Xa:function(){var a,b,c=this[D].F;for(a in c)if(Object.prototype.hasOwnProperty.call(c,a)&&(b=c[a],this.Ja&&b.da.Ka||b.da.Cd(b.Ma)))return!0},Id:function(){this.Ja&&!this[D].pb&&this.Ja(!1)},ja:function(){var a=this[D];return a.ka||0<a.V},Qd:function(){this.Ka?this[D].ka&&(this[D].ra=!0):this.Gc()},Zc:function(a){if(a.Hb){var b=a.subscribe(this.Id,this,"dirty"),c=a.subscribe(this.Qd,this);return{da:a,s:function(){b.s();c.s()}}}return a.subscribe(this.Gc,this)},Gc:function(){var a=this,b=a.throttleEvaluation;b&&0<=b?(clearTimeout(this[D].Hc),this[D].Hc=c.a.setTimeout(function(){a.ha(!0)},b)):a.Ja?a.Ja(!0):a.ha(!0)},ha:function(a){var b=this[D],d=b.Sa,e=!1;if(!b.pb&&!b.qa){if(b.l&&!c.a.Rb(b.l)||d&&d()){if(!b.hc){this.s();return}}else b.hc=!1;b.pb=!0;try{e=this.yd(a)}finally{b.pb=!1}return e}},yd:function(a){var d=this[D],e,f=d.vb?b:!d.V;e={pd:this,kb:d.F,Pb:d.V};c.v.wc({od:e,nd:r,o:this,rb:f});d.F={};d.V=0;var g=this.xd(d,e);d.V?e=this.qb(d.X,g):(this.s(),e=!0);e&&(d.G?this.Gb():this.notifySubscribers(d.X,"beforeChange"),d.X=g,this.notifySubscribers(d.X,"spectate"),!d.G&&a&&this.notifySubscribers(d.X),this.qc&&this.qc());f&&this.notifySubscribers(d.X,"awake");return e},xd:function(a,b){try{var d=a.Vc;return a.lb?d.call(a.lb):d()}finally{c.v.end(),b.Pb&&!a.G&&c.a.O(b.kb,t),a.ra=a.ka=!1}},w:function(a){var b=this[D];(b.ka&&(a||!b.V)||b.G&&this.Xa())&&this.ha();return b.X},tb:function(a){c.R.fn.tb.call(this,a);this.mc=function(){this[D].G||(this[D].ra?this.ha():this[D].ka=!1);return this[D].X};this.Ja=function(a){this.oc(this[D].X);this[D].ka=!0;a&&(this[D].ra=!0);this.pc(this,!a)}},s:function(){var a=this[D];!a.G&&a.F&&c.a.O(a.F,function(a,b){b.s&&b.s()});a.l&&a.Qb&&c.a.I.xb(a.l,a.Qb);a.F=b;a.V=0;a.qa=!0;a.ra=!1;a.ka=!1;a.G=!1;a.l=b;a.Sa=b;a.Vc=b;this.Mc||(a.lb=b)}},B={Qa:function(a){var b=this,d=b[D];if(!d.qa&&d.G&&"change"==a){d.G=!1;if(d.ra||b.Xa())d.F=null,d.V=0,b.ha()&&b.Gb();else{var e=[];c.a.O(d.F,function(a,b){e[b.La]=a});c.a.C(e,function(a,c){var e=d.F[a],f=b.Zc(e.da);f.La=c;f.Ma=e.Ma;d.F[a]=f});b.Xa()&&b.ha()&&b.Gb()}d.qa||b.notifySubscribers(d.X,"awake")}},cb:function(a){var d=this[D];d.qa||"change"!=a||this.Wa("change")||(c.a.O(d.F,function(a,b){b.s&&(d.F[a]={da:b.da,La:b.La,Ma:b.Ma},b.s())}),d.G=!0,this.notifySubscribers(b,"asleep"))},mb:function(){var a=this[D];a.G&&(a.ra||this.Xa())&&this.ha();return c.R.fn.mb.call(this)}},C={Qa:function(a){"change"!=a&&"beforeChange"!=a||this.w()}};c.a.Ba&&c.a.setPrototypeOf(v,c.R.fn);var F=c.sa.Na;v[F]=c.o;c.Nc=function(a){return"function"==typeof a&&a[F]===v[F]};c.Ed=function(a){return c.Nc(a)&&a[D]&&a[D].vb};c.b("computed",c.o);c.b("dependentObservable",c.o);c.b("isComputed",c.Nc);c.b("isPureComputed",c.Ed);c.b("computed.fn",v);c.J(v,"peek",v.w);c.J(v,"dispose",v.s);c.J(v,"isActive",v.ja);c.J(v,"getDependenciesCount",v.pa);c.J(v,"getDependencies",v.Va);c.wb=function(a,b){if("function"===typeof a)return c.o(a,b,{pure:!0});a=c.a.extend({},a);a.pure=!0;return c.o(a,b)};c.b("pureComputed",c.wb);(function(){function a(c,f,g){g=g||new e;c=f(c);if("object"!=typeof c||null===c||c===
b||c instanceof RegExp||c instanceof Date||c instanceof String||c instanceof Number||c instanceof Boolean)return c;var h=c instanceof Array?[]:{};g.save(c,h);d(c,function(d){var e=f(c[d]);switch(typeof e){case "boolean":case "number":case "string":case "function":h[d]=e;break;case "object":case "undefined":var k=g.get(e);h[d]=k!==b?k:a(e,f,g)}});return h}function d(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function e(){this.keys=[];this.values=[]}c.$c=function(b){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return a(b,function(a){for(var b=0;c.N(a)&&10>b;b++)a=a();return a})};c.toJSON=function(a,b,d){a=c.$c(a);return c.a.fc(a,b,d)};e.prototype={constructor:e,save:function(a,b){var d=c.a.A(this.keys,a);0<=d?this.values[d]=b:(this.keys.push(a),this.values.push(b))},get:function(a){a=c.a.A(this.keys,a);return 0<=a?this.values[a]:b}}})();c.b("toJS",c.$c);c.b("toJSON",c.toJSON);c.Vd=function(a,b,d){function e(b){var e=c.wb(a,d).extend({Ga:"always"}),f=e.subscribe(function(a){a&&(f.s(),b(a))});e.notifySubscribers(e.w());return f}return"function"!==typeof Promise||b?e(b.bind(d)):new Promise(e)};c.b("when",c.Vd);(function(){c.u={L:function(a){switch(c.a.P(a)){case "option":return!0===a.__ko__hasDomDataOptionValue__?c.a.g.get(a,c.f.options.Yb):7>=c.a.W?a.getAttributeNode("value")&&a.getAttributeNode("value").specified?a.value:a.text:a.value;case "select":return 0<=a.selectedIndex?c.u.L(a.options[a.selectedIndex]):b;default:return a.value}},ya:function(a,d,e){switch(c.a.P(a)){case "option":"string"===typeof d?(c.a.g.set(a,c.f.options.Yb,b),"__ko__hasDomDataOptionValue__"in a&&delete a.__ko__hasDomDataOptionValue__,a.value=d):(c.a.g.set(a,c.f.options.Yb,d),a.__ko__hasDomDataOptionValue__=!0,a.value="number"===typeof d?d:"");break;case "select":if(""===d||null===d)d=b;for(var f=-1,g=0,h=a.options.length,k;g<h;++g)if(k=c.u.L(a.options[g]),k==d||""===k&&d===b){f=g;break}if(e||0<=f||d===b&&1<a.size)a.selectedIndex=f,6===c.a.W&&c.a.setTimeout(function(){a.selectedIndex=f},0);break;default:if(null===d||d===b)d="";a.value=d}}}})();c.b("selectExtensions",c.u);c.b("selectExtensions.readValue",c.u.L);c.b("selectExtensions.writeValue",c.u.ya);c.m=function(){function a(a){a=c.a.Cb(a);123===a.charCodeAt(0)&&(a=a.slice(1,-1));a+="\n,";var b=[],d=a.match(e),h,k=[],l=0;if(1<d.length){for(var m=0,p;p=d[m];++m){var q=p.charCodeAt(0);if(44===q){if(0>=l){b.push(h&&k.length?{key:h,value:k.join("")}:{unknown:h||k.join("")});h=l=0;k=[];continue}}else if(58===q){if(!l&&!h&&1===k.length){h=k.pop();continue}}else if(47===q&&1<p.length&&(47===p.charCodeAt(1)||42===p.charCodeAt(1)))continue;else 47===q&&m&&1<p.length?(q=d[m-1].match(f))&&!g[q[0]]&&(a=a.substr(a.indexOf(p)+1),d=a.match(e),m=-1,p="/"):40===q||123===q||91===q?++l:41===q||125===q||93===q?--l:h||k.length||34!==q&&39!==q||(p=p.slice(1,-1));k.push(p)}if(0<l)throw Error("Unbalanced parentheses, braces, or brackets");}return b}var b=["true","false","null","undefined"],d=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,e=RegExp("\"(?:\\\\.|[^\"])*\"|'(?:\\\\.|[^'])*'|`(?:\\\\.|[^`])*`|/\\*(?:[^*]|\\*+[^*/])*\\*+/|//.*\n|/(?:\\\\.|[^/])+/w*|[^\\s:,/][^,\"'`{}()/:[\\]]*[^\\s,\"'`{}()/:[\\]]|[^\\s]","g"),f=/[\])"'A-Za-z0-9_$]+$/,g={"in":1,"return":1,"typeof":1},h={};return{Ra:[],va:h,Zb:a,ub:function(e,f){function g(a,e){var f;if(!p){var q=c.getBindingHandler(a);if(q&&q.preprocess&&!(e=q.preprocess(e,a,g)))return;if(q=h[a])f=e,0<=c.a.A(b,f)?f=!1:(q=f.match(d),f=null===q?!1:q[1]?"Object("+q[1]+")"+q[2]:f),q=f;q&&l.push("'"+("string"==typeof h[a]?h[a]:a)+"':function(_z){"+f+"\x3d_z}")}m&&(e="function(){return "+e+" }");k.push("'"+a+"':"+e)}f=f||{};var k=[],l=[],m=f.valueAccessors,p=f.bindingParams,q="string"===typeof e?a(e):e;c.a.C(q,function(a){g(a.key||a.unknown,a.value)});l.length&&g("_ko_property_writers","{"+l.join(",")+" }");return k.join(",")},Hd:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},$a:function(a,b,d,e,f){if(a&&c.N(a))!c.Ya(a)||f&&a.w()===e||a(e);else if((a=b.get("_ko_property_writers"))&&a[d])a[d](e)}}}();c.b("expressionRewriting",c.m);c.b("expressionRewriting.bindingRewriteValidators",c.m.Ra);c.b("expressionRewriting.parseObjectLiteral",c.m.Zb);c.b("expressionRewriting.preProcessBindings",c.m.ub);c.b("expressionRewriting._twoWayBindings",c.m.va);c.b("jsonExpressionRewriting",c.m);c.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",c.m.ub);(function(){function a(a){return 8==a.nodeType&&h.test(g?a.text:a.nodeValue)}function b(a){return 8==a.nodeType&&k.test(g?a.text:a.nodeValue)}function d(d,e){for(var f=d,g=1,h=[];f=f.nextSibling;){if(b(f)&&(c.a.g.set(f,m,!0),g--,0===g))return h;h.push(f);a(f)&&g++}if(!e)throw Error("Cannot find closing comment tag to match: "+d.nodeValue);return null}function e(a,b){var c=d(a,b);return c?0<c.length?c[c.length-1].nextSibling:a.nextSibling:null}var g=f&&"\x3c!--test--\x3e"===f.createComment("test").text,h=g?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,k=g?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,l={ul:!0,ol:!0},m="__ko_matchedEndComment__";c.h={ea:{},childNodes:function(b){return a(b)?d(b):b.childNodes},Ea:function(b){if(a(b)){b=c.h.childNodes(b);for(var d=0,e=b.length;d<e;d++)c.removeNode(b[d])}else c.a.Sb(b)},ua:function(b,d){if(a(b)){c.h.Ea(b);for(var e=b.nextSibling,f=0,g=d.length;f<g;f++)e.parentNode.insertBefore(d[f],e)}else c.a.ua(b,d)},Uc:function(b,c){a(b)?b.parentNode.insertBefore(c,b.nextSibling):b.firstChild?b.insertBefore(c,b.firstChild):b.appendChild(c)},Vb:function(b,d,e){e?a(b)?b.parentNode.insertBefore(d,e.nextSibling):e.nextSibling?b.insertBefore(d,e.nextSibling):b.appendChild(d):c.h.Uc(b,d)},firstChild:function(c){if(a(c))return!c.nextSibling||b(c.nextSibling)?null:c.nextSibling;if(c.firstChild&&b(c.firstChild))throw Error("Found invalid end comment, as the first child of "+c);return c.firstChild},nextSibling:function(d){a(d)&&(d=e(d));if(d.nextSibling&&b(d.nextSibling)){var f=d.nextSibling;if(b(f)&&!c.a.g.get(f,m))throw Error("Found end comment without a matching opening comment, as child of "+d);return null}return d.nextSibling},Bd:a,Ud:function(a){return(a=(g?a.text:a.nodeValue).match(h))?a[1]:null},Rc:function(d){if(l[c.a.P(d)]){var f=d.firstChild;if(f){do if(1===f.nodeType){var g;g=f.firstChild;var h=null;if(g){do if(h)h.push(g);else if(a(g)){var k=e(g,!0);k?g=k:h=[g]}else b(g)&&(h=[g]);while(g=g.nextSibling)}if(g=h)for(h=f.nextSibling,k=0;k<g.length;k++)h?d.insertBefore(g[k],h):d.appendChild(g[k])}while(f=f.nextSibling)}}}}})();c.b("virtualElements",c.h);c.b("virtualElements.allowedBindings",c.h.ea);c.b("virtualElements.emptyNode",c.h.Ea);c.b("virtualElements.insertAfter",c.h.Vb);c.b("virtualElements.prepend",c.h.Uc);c.b("virtualElements.setDomNodeChildren",c.h.ua);(function(){c.ga=function(){this.md={}};c.a.extend(c.ga.prototype,{nodeHasBindings:function(a){switch(a.nodeType){case 1:return null!=a.getAttribute("data-bind")||c.i.getComponentNameForNode(a);case 8:return c.h.Bd(a);default:return!1}},getBindings:function(a,b){var d=this.getBindingsString(a,b),d=d?this.parseBindingsString(d,b,a):null;return c.i.sc(d,a,b,!1)},getBindingAccessors:function(a,b){var d=this.getBindingsString(a,b),d=d?this.parseBindingsString(d,b,a,{valueAccessors:!0}):null;return c.i.sc(d,a,b,!0)},getBindingsString:function(a){switch(a.nodeType){case 1:return a.getAttribute("data-bind");case 8:return c.h.Ud(a);default:return null}},parseBindingsString:function(a,b,d,e){try{var f=this.md,g=a+(e&&e.valueAccessors||""),h;if(!(h=f[g])){var k,l="with($context){with($data||{}){return{"+c.m.ub(a,e)+"}}}";k=new Function("$context","$element",l);h=f[g]=k}return h(b,d)}catch(aa){throw aa.message="Unable to parse bindings.\nBindings value: "+a+"\nMessage: "+aa.message,aa;}}});c.ga.instance=new c.ga})();c.b("bindingProvider",c.ga);(function(){function d(a){var b=(a=c.a.g.get(a,D))&&a.M;b&&(a.M=null,b.Sc())}function e(a,b,e){this.node=a;this.xc=b;this.ib=[];this.T=!1;b.M||c.a.I.za(a,d);e&&e.M&&(e.M.ib.push(a),this.Kb=e)}function h(a){return function(){return a}}function k(a){return a()}function l(a){return c.a.Ha(c.v.K(a),function(b,c){return function(){return a()[c]}})}function m(a,b,d){return"function"===typeof a?l(a.bind(null,b,d)):c.a.Ha(a,h)}function p(a,b){return l(this.getBindings.bind(this,a,b))}function q(a,b){var d=c.h.firstChild(b);if(d){var e,f=c.ga.instance,g=f.preprocessNode;if(g){for(;e=d;)d=c.h.nextSibling(e),g.call(f,e);d=c.h.firstChild(b)}for(;e=d;)d=c.h.nextSibling(e),r(a,e)}c.j.Ga(b,c.j.T)}function r(a,b){var d=a,e=1===b.nodeType;e&&c.h.Rc(b);if(e||c.ga.instance.nodeHasBindings(b))d=u(b,null,a).bindingContextForDescendants;d&&!B[c.a.P(b)]&&q(d,b)}function t(a){var b=[],d={},e=[];c.a.O(a,function fa(f){if(!d[f]){var g=c.getBindingHandler(f);g&&(g.after&&(e.push(f),c.a.C(g.after,function(b){if(a[b]){if(-1!==c.a.A(e,b))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+e.join(", "));fa(b)}}),e.length--),b.push({key:f,Lc:g}));d[f]=!0}});return b}function u(a,d,e){var f=c.a.g.Tb(a,D,{}),g=f.gd;if(!d){if(g)throw Error("You cannot apply bindings multiple times to the same element.");f.gd=!0}g||(f.context=e);var h;if(d&&"function"!==typeof d)h=d;else{var l=c.ga.instance,m=l.getBindingAccessors||p,q=c.$(function(){if(h=d?d(e,a):m.call(l,a,e)){if(e[y])e[y]();if(e[A])e[A]()}return h},null,{l:a});h&&q.ja()||(q=null)}var r=e,u;if(h){var w=function(){return c.a.Ha(q?q():h,k)},v=q?function(a){return function(){return(0,q()[a])()}}:function(a){return h[a]};w.get=function(a){return h[a]&&v(a)()};w.has=function(a){return a in h};c.j.T in h&&c.j.subscribe(a,c.j.T,function(){var b=(0,h[c.j.T])();if(b){var d=c.h.childNodes(a);d.length&&b(d,c.Dc(d[0]))}});c.j.oa in h&&(r=c.j.Bb(a,e),c.j.subscribe(a,c.j.oa,function(){var b=(0,h[c.j.oa])();b&&c.h.firstChild(a)&&b(a)}));f=t(h);c.a.C(f,function(d){var e=d.Lc.init,f=d.Lc.update,g=d.key;if(8===a.nodeType&&!c.h.ea[g])throw Error("The binding '"+g+"' cannot be used with virtual elements");try{"function"==typeof e&&c.v.K(function(){var c=e(a,v(g),w,r.$data,r);if(c&&c.controlsDescendantBindings){if(u!==b)throw Error("Multiple bindings ("+u+" and "+g+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");u=g}}),"function"==typeof f&&c.$(function(){f(a,v(g),w,r.$data,r)},null,{l:a})}catch(wa){throw wa.message='Unable to process binding "'+g+": "+h[g]+'"\nMessage: '+wa.message,wa;}})}f=u===b;return{shouldBindDescendants:f,bindingContextForDescendants:f&&r}}function v(a,d){return a&&a instanceof c.fa?a:new c.fa(a,b,b,d)}var y=c.a.Da("_subscribable"),z=c.a.Da("_ancestorBindingInfo"),A=c.a.Da("_dataDependency");c.f={};var B={script:!0,textarea:!0,template:!0};c.getBindingHandler=function(a){return c.f[a]};var C={};c.fa=function(a,d,e,f,g){function h(){var a=p?m():m,b=c.a.c(a);d?(c.a.extend(k,d),z in d&&(k[z]=d[z])):(k.$parents=[],k.$root=b,k.ko=c);k[y]=q;l?b=k.$data:(k.$rawData=a,k.$data=b);e&&(k[e]=b);f&&f(k,d,b);if(d&&d[y]&&!c.U.o().Ub(d[y]))d[y]();r&&(k[A]=r);return k.$data}var k=this,l=a===C,m=l?b:a,p="function"==typeof m&&!c.N(m),q,r=g&&g.dataDependency;g&&g.exportDependencies?h():(q=c.wb(h),q.w(),q.ja()?q.equalityComparer=null:k[y]=b)};c.fa.prototype.createChildContext=function(a,b,d,e){!e&&b&&"object"==typeof b&&(e=b,b=e.as,d=e.extend);if(b&&e&&e.noChildContext){var f="function"==typeof a&&!c.N(a);return new c.fa(C,this,null,function(c){d&&d(c);c[b]=f?a():a},e)}return new c.fa(a,this,b,function(a,b){a.$parentContext=b;a.$parent=b.$data;a.$parents=(b.$parents||[]).slice(0);a.$parents.unshift(a.$parent);d&&d(a)},e)};c.fa.prototype.extend=function(a,b){return new c.fa(C,this,null,function(b){c.a.extend(b,"function"==typeof a?a(b):a)},b)};var D=c.a.g.Z();e.prototype.Sc=function(){this.Kb&&this.Kb.M&&this.Kb.M.rd(this.node)};e.prototype.rd=function(a){c.a.hb(this.ib,a);!this.ib.length&&this.T&&this.Bc()};e.prototype.Bc=function(){this.T=!0;this.xc.M&&!this.ib.length&&(this.xc.M=null,c.a.I.xb(this.node,d),c.j.Ga(this.node,c.j.oa),this.Sc())};c.j={T:"childrenComplete",oa:"descendantsComplete",subscribe:function(a,b,d,e){a=c.a.g.Tb(a,D,{});a.Fa||(a.Fa=new c.R);return a.Fa.subscribe(d,e,b)},Ga:function(a,d){var e=c.a.g.get(a,D);if(e&&(e.Fa&&e.Fa.notifySubscribers(a,d),d==c.j.T))if(e.M)e.M.Bc();else if(e.M===b&&e.Fa&&e.Fa.Wa(c.j.oa))throw Error("descendantsComplete event not supported for bindings on this node");},Bb:function(a,b){var d=c.a.g.Tb(a,D,{});d.M||(d.M=new e(a,d,b[z]));return b[z]==d?b:b.extend(function(a){a[z]=d})}};c.Sd=function(a){return(a=c.a.g.get(a,D))&&a.context};c.eb=function(a,b,d){1===a.nodeType&&c.h.Rc(a);return u(a,b,v(d))};c.kd=function(a,b,d){d=v(d);return c.eb(a,m(b,d,a),d)};c.Pa=function(a,b){1!==b.nodeType&&8!==b.nodeType||q(v(a),b)};c.uc=function(b,c,d){!g&&a.jQuery&&(g=a.jQuery);if(2>arguments.length){if(c=f.body,!c)throw Error("ko.applyBindings: could not find document.body; has the document been loaded?");}else if(!c||1!==c.nodeType&&8!==c.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");r(v(b,d),c)};c.Cc=function(a){return!a||1!==a.nodeType&&8!==a.nodeType?b:c.Sd(a)};c.Dc=function(a){return(a=c.Cc(a))?a.$data:b};c.b("bindingHandlers",c.f);c.b("bindingEvent",c.j);c.b("bindingEvent.subscribe",c.j.subscribe);c.b("bindingEvent.startPossiblyAsyncContentBinding",c.j.Bb);c.b("applyBindings",c.uc);c.b("applyBindingsToDescendants",c.Pa);c.b("applyBindingAccessorsToNode",c.eb);c.b("applyBindingsToNode",c.kd);c.b("contextFor",c.Cc);c.b("dataFor",c.Dc)})();(function(a){function b(b,e){var h=Object.prototype.hasOwnProperty.call(f,b)?f[b]:a,k;h?h.subscribe(e):(h=f[b]=new c.R,h.subscribe(e),d(b,function(a,d){var e=!(!d||!d.synchronous);g[b]={definition:a,Fd:e};delete f[b];k||e?h.notifySubscribers(a):c.ma.yb(function(){h.notifySubscribers(a)})}),k=!0)}function d(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a,c)}):b(null,null)})}function e(b,d,f,g){g||(g=c.i.loaders.slice(0));var h=g.shift();if(h){var k=h[b];if(k){var l=!1;if(k.apply(h,d.concat(function(a){l?f(null):null!==a?f(a):e(b,d,f,g)}))!==a&&(l=!0,!h.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.");}else e(b,d,f,g)}else f(null)}var f={},g={};c.i={get:function(d,e){var f=Object.prototype.hasOwnProperty.call(g,d)?g[d]:a;f?f.Fd?c.v.K(function(){e(f.definition)}):c.ma.yb(function(){e(f.definition)}):b(d,e)},Ac:function(a){delete g[a]},nc:e};c.i.loaders=[];c.b("components",c.i);c.b("components.get",c.i.get);c.b("components.clearCachedDefinition",c.i.Ac)})();(function(){function b(a,b,d,e){function f(){0===--h&&e(g)}var g={},h=2,l=d.template;d=d.viewModel;l?k(b,l,function(b){c.i.nc("loadTemplate",[a,b],function(a){g.template=a;f()})}):f();d?k(b,d,function(b){c.i.nc("loadViewModel",[a,b],function(a){g[p]=a;f()})}):f()}function d(a,b,c){if("function"===typeof b)c(function(a){return new b(a)});else if("function"===typeof b[p])c(b[p]);else if("instance"in b){var e=b.instance;c(function(){return e})}else"viewModel"in b?d(a,b.viewModel,c):a("Unknown viewModel value: "+b)}function g(a){switch(c.a.P(a)){case "script":return c.a.ta(a.text);case "textarea":return c.a.ta(a.value);case "template":if(h(a.content))return c.a.Ca(a.content.childNodes)}return c.a.Ca(a.childNodes)}function h(b){return a.DocumentFragment?b instanceof DocumentFragment:b&&11===b.nodeType}function k(b,c,d){"string"===typeof c.require?e||a.require?(e||a.require)([c.require],d):b("Uses require, but no AMD loader is present"):d(c)}function l(a){return function(b){throw Error("Component '"+a+"': "+b);}}var m={};c.i.register=function(a,b){if(!b)throw Error("Invalid configuration for "+a);if(c.i.sb(a))throw Error("Component "+a+" is already registered");m[a]=b};c.i.sb=function(a){return Object.prototype.hasOwnProperty.call(m,a)};c.i.unregister=function(a){delete m[a];c.i.Ac(a)};c.i.Ec={getConfig:function(a,b){b(c.i.sb(a)?m[a]:null)},loadComponent:function(a,c,d){var e=l(a);k(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,d,e){b=l(b);if("string"===typeof d)e(c.a.ta(d));else if(d instanceof Array)e(d);else if(h(d))e(c.a.la(d.childNodes));else if(d.element)if(d=d.element,a.HTMLElement?d instanceof HTMLElement:d&&d.tagName&&1===d.nodeType)e(g(d));else if("string"===typeof d){var k=f.getElementById(d);k?e(g(k)):b("Cannot find element with ID "+d)}else b("Unknown element type: "+d);else b("Unknown template value: "+d)},loadViewModel:function(a,b,c){d(l(a),b,c)}};var p="createViewModel";c.b("components.register",c.i.register);c.b("components.isRegistered",c.i.sb);c.b("components.unregister",c.i.unregister);c.b("components.defaultLoader",c.i.Ec);c.i.loaders.push(c.i.Ec);c.i.cd=m})();(function(){function a(a,d){var e=a.getAttribute("params");if(e){var e=b.parseBindingsString(e,d,a,{valueAccessors:!0,bindingParams:!0}),e=c.a.Ha(e,function(b){return c.o(b,null,{l:a})}),f=c.a.Ha(e,function(b){var d=b.w();return b.ja()?c.o({read:function(){return c.a.c(b())},write:c.Ya(d)&&function(a){b()(a)},l:a}):d});Object.prototype.hasOwnProperty.call(f,"$raw")||(f.$raw=e);return f}return{$raw:{}}}c.i.getComponentNameForNode=function(a){var b=c.a.P(a);if(c.i.sb(b)&&(-1!=b.indexOf("-")||"[object HTMLUnknownElement]"==""+a||8>=c.a.W&&a.tagName===b))return b};c.i.sc=function(b,d,e,f){if(1===d.nodeType){var g=c.i.getComponentNameForNode(d);if(g){b=b||{};if(b.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var h={name:g,params:a(d,e)};b.component=f?function(){return h}:h}}return b};var b=new c.ga;9>c.a.W&&(c.i.register=function(a){return function(b){return a.apply(this,arguments)}}(c.i.register),f.createDocumentFragment=function(a){return function(){var b=a(),d=c.i.cd,e;for(e in d);return b}}(f.createDocumentFragment))})();(function(){function a(a,b,d){b=b.template;if(!b)throw Error("Component '"+a+"' has no template");a=c.a.Ca(b);c.h.ua(d,a)}function b(a,b,c){var d=a.createViewModel;return d?d.call(a,b,c):b}var d=0;c.f.component={init:function(e,f,g,h,k){function l(){var a=m&&m.dispose;"function"===typeof a&&a.call(m);q&&q.s();p=m=q=null}var m,p,q,r=c.a.la(c.h.childNodes(e));c.h.Ea(e);c.a.I.za(e,l);c.o(function(){var g=c.a.c(f()),h,t;"string"===typeof g?h=g:(h=c.a.c(g.name),t=c.a.c(g.params));if(!h)throw Error("No component name specified");var u=c.j.Bb(e,k),w=p=++d;c.i.get(h,function(d){if(p===w){l();if(!d)throw Error("Unknown component '"+h+"'");a(h,d,e);var f=b(d,t,{element:e,templateNodes:r});d=u.createChildContext(f,{extend:function(a){a.$component=f;a.$componentTemplateNodes=r}});f&&f.koDescendantsComplete&&(q=c.j.subscribe(e,c.j.oa,f.koDescendantsComplete,f));m=f;c.Pa(d,e)}})},null,{l:e});return{controlsDescendantBindings:!0}}};c.h.ea.component=!0})();var H={"class":"className","for":"htmlFor"};c.f.attr={update:function(a,d){var e=c.a.c(d())||{};c.a.O(e,function(d,e){e=c.a.c(e);var f=d.indexOf(":"),f="lookupNamespaceURI"in a&&0<f&&a.lookupNamespaceURI(d.substr(0,f)),g=!1===e||null===e||e===b;g?f?a.removeAttributeNS(f,d):a.removeAttribute(d):e=e.toString();8>=c.a.W&&d in H?(d=H[d],g?a.removeAttribute(d):a[d]=e):g||(f?a.setAttributeNS(f,d,e):a.setAttribute(d,e));"name"===d&&c.a.Xc(a,g?"":e)})}};(function(){c.f.checked={after:["value","attr"],init:function(a,d,e){function f(){var f=a.checked,g=h();if(!c.U.rb()&&(f||!l&&!c.U.pa())){var m=c.v.K(d);if(p){var r=q?m.w():m,u=t;t=g;u!==g?f&&(c.a.Oa(r,g,!0),c.a.Oa(r,u,!1)):c.a.Oa(r,g,f);q&&c.Ya(m)&&m(r)}else k&&(g===b?g=f:f||(g=b)),c.m.$a(m,e,"checked",g,!0)}}function g(){var e=c.a.c(d()),f=h();p?(a.checked=0<=c.a.A(e,f),t=f):a.checked=k&&f===b?!!e:h()===e}var h=c.wb(function(){if(e.has("checkedValue"))return c.a.c(e.get("checkedValue"));if(r)return e.has("value")?c.a.c(e.get("value")):a.value}),k="checkbox"==a.type,l="radio"==a.type;if(k||l){var m=d(),p=k&&c.a.c(m)instanceof Array,q=!(p&&m.push&&m.splice),r=l||p,t=p?h():b;l&&!a.name&&c.f.uniqueName.init(a,function(){return!0});c.o(f,null,{l:a});c.a.H(a,"click",f);c.o(g,null,{l:a});m=b}}};c.m.va.checked=!0;c.f.checkedValue={update:function(a,b){a.value=c.a.c(b())}}})();c.f["class"]={update:function(a,b){var d=c.a.Cb(c.a.c(b()));c.a.Eb(a,a.__ko__cssValue,!1);a.__ko__cssValue=d;c.a.Eb(a,d,!0)}};c.f.css={update:function(a,b){var d=c.a.c(b());null!==d&&"object"==typeof d?c.a.O(d,function(b,d){d=c.a.c(d);c.a.Eb(a,b,d)}):c.f["class"].update(a,b)}};c.f.enable={update:function(a,b){var d=c.a.c(b());d&&a.disabled?a.removeAttribute("disabled"):d||a.disabled||(a.disabled=!0)}};c.f.disable={update:function(a,b){c.f.enable.update(a,function(){return!c.a.c(b())})}};c.f.event={init:function(a,b,d,e,f){var g=b()||{};c.a.O(g,function(g){"string"==typeof g&&c.a.H(a,g,function(a){var h,k=b()[g];if(k){try{var l=c.a.la(arguments);e=f.$data;l.unshift(e);h=k.apply(e,l)}finally{!0!==h&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}!1===d.get(g+"Bubble")&&(a.cancelBubble=!0,a.stopPropagation&&a.stopPropagation())}})})}};c.f.foreach={Qc:function(a){return function(){var b=a(),d=c.a.$b(b);if(!d||"number"==typeof d.length)return{foreach:b,templateEngine:c.ba.Na};c.a.c(b);return{foreach:d.data,as:d.as,noChildContext:d.noChildContext,includeDestroyed:d.includeDestroyed,afterAdd:d.afterAdd,beforeRemove:d.beforeRemove,afterRender:d.afterRender,beforeMove:d.beforeMove,afterMove:d.afterMove,templateEngine:c.ba.Na}}},init:function(a,b){return c.f.template.init(a,c.f.foreach.Qc(b))},update:function(a,b,d,e,f){return c.f.template.update(a,c.f.foreach.Qc(b),d,e,f)}};c.m.Ra.foreach=!1;c.h.ea.foreach=!0;c.f.hasfocus={init:function(a,b,d){function e(e){a.__ko_hasfocusUpdating=!0;var f=a.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(aa){g=f.body}e=g===a}f=b();c.m.$a(f,d,"hasfocus",e,!0);a.__ko_hasfocusLastValue=e;a.__ko_hasfocusUpdating=!1}var f=e.bind(null,!0),g=e.bind(null,!1);c.a.H(a,"focus",f);c.a.H(a,"focusin",f);c.a.H(a,"blur",g);c.a.H(a,"focusout",g);a.__ko_hasfocusLastValue=!1},update:function(a,b){var d=!!c.a.c(b());a.__ko_hasfocusUpdating||a.__ko_hasfocusLastValue===d||(d?a.focus():a.blur(),!d&&a.__ko_hasfocusLastValue&&a.ownerDocument.body.focus(),c.v.K(c.a.Fb,null,[a,d?"focusin":"focusout"]))}};c.m.va.hasfocus=!0;c.f.hasFocus=c.f.hasfocus;c.m.va.hasFocus="hasfocus";c.f.html={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){c.a.dc(a,b())}};(function(){function a(a,b,d){c.f[a]={init:function(a,e,f,g,h){var k,l,m={},p,q,r;if(b){g=f.get("as");var t=f.get("noChildContext");r=!(g&&t);m={as:g,noChildContext:t,exportDependencies:r}}q=(p="render"==f.get("completeOn"))||f.has(c.j.oa);c.o(function(){var f=c.a.c(e()),g=!d!==!f,t=!l,u;if(r||g!==k){q&&(h=c.j.Bb(a,h));if(g){if(!b||r)m.dataDependency=c.U.o();u=b?h.createChildContext("function"==typeof f?f:e,m):c.U.pa()?h.extend(null,m):h}t&&c.U.pa()&&(l=c.a.Ca(c.h.childNodes(a),!0));g?(t||c.h.ua(a,c.a.Ca(l)),c.Pa(u,a)):(c.h.Ea(a),p||c.j.Ga(a,c.j.T));k=g}},null,{l:a});return{controlsDescendantBindings:!0}}};c.m.Ra[a]=!1;c.h.ea[a]=!0}a("if");a("ifnot",!1,!0);a("with",!0)})();c.f.let={init:function(a,b,d,e,f){b=f.extend(b);c.Pa(b,a);return{controlsDescendantBindings:!0}}};c.h.ea.let=!0;var J={};c.f.options={init:function(a){if("select"!==c.a.P(a))throw Error("options binding applies only to SELECT elements");for(;0<a.length;)a.remove(0);return{controlsDescendantBindings:!0}},update:function(a,d,e){function f(){return c.a.fb(a.options,function(a){return a.selected})}function g(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function h(b,d){if(u&&p)c.u.ya(a,c.a.c(e.get("value")),!0);else if(t.length){var f=0<=c.a.A(t,c.u.L(d[0]));c.a.Yc(d[0],f);u&&!f&&c.v.K(c.a.Fb,null,[a,"change"])}}var k=a.multiple,l=0!=a.length&&k?a.scrollTop:null,m=c.a.c(d()),p=e.get("valueAllowUnset")&&e.has("value"),q=e.get("optionsIncludeDestroyed");d={};var r,t=[];p||(k?t=c.a.Mb(f(),c.u.L):0<=a.selectedIndex&&t.push(c.u.L(a.options[a.selectedIndex])));m&&("undefined"==typeof m.length&&(m=[m]),r=c.a.fb(m,function(a){return q||a===b||null===a||!c.a.c(a._destroy)}),e.has("optionsCaption")&&(m=c.a.c(e.get("optionsCaption")),null!==m&&m!==b&&r.unshift(J)));var u=!1;d.beforeRemove=function(b){a.removeChild(b)};m=h;e.has("optionsAfterRender")&&"function"==typeof e.get("optionsAfterRender")&&(m=function(a,d){h(0,d);c.v.K(e.get("optionsAfterRender"),null,[d[0],a!==J?a:b])});c.a.cc(a,r,function(d,f,h){h.length&&(t=!p&&h[0].selected?[c.u.L(h[0])]:[],u=!0);f=a.ownerDocument.createElement("option");d===J?(c.a.Ab(f,e.get("optionsCaption")),c.u.ya(f,b)):(h=g(d,e.get("optionsValue"),d),c.u.ya(f,c.a.c(h)),d=g(d,e.get("optionsText"),h),c.a.Ab(f,d));return[f]},d,m);c.v.K(function(){if(p)c.u.ya(a,c.a.c(e.get("value")),!0);else{var b;k?b=t.length&&f().length<t.length:b=t.length&&0<=a.selectedIndex?c.u.L(a.options[a.selectedIndex])!==t[0]:t.length||0<=a.selectedIndex;b&&c.a.Fb(a,"change")}});c.a.vd(a);l&&20<Math.abs(l-a.scrollTop)&&(a.scrollTop=l)}};c.f.options.Yb=c.a.g.Z();c.f.selectedOptions={after:["options","foreach"],init:function(a,b,d){c.a.H(a,"change",function(){var e=b(),f=[];c.a.C(a.getElementsByTagName("option"),function(a){a.selected&&f.push(c.u.L(a))});c.m.$a(e,d,"selectedOptions",f)})},update:function(a,b){if("select"!=c.a.P(a))throw Error("values binding applies only to SELECT elements");var d=c.a.c(b()),e=a.scrollTop;d&&"number"==typeof d.length&&c.a.C(a.getElementsByTagName("option"),function(a){var b=0<=c.a.A(d,c.u.L(a));a.selected!=b&&c.a.Yc(a,b)});a.scrollTop=e}};c.m.va.selectedOptions=!0;c.f.style={update:function(a,d){var e=c.a.c(d()||{});c.a.O(e,function(d,e){e=c.a.c(e);if(null===e||e===b||!1===e)e="";if(g)g(a).css(d,e);else if(/^--/.test(d))a.style.setProperty(d,e);else{d=d.replace(/-(\w)/g,function(a,b){return b.toUpperCase()});var f=a.style[d];a.style[d]=e;e===f||a.style[d]!=f||isNaN(e)||(a.style[d]=e+"px")}})}};c.f.submit={init:function(a,b,d,e,f){if("function"!=typeof b())throw Error("The value for a submit binding must be a function");c.a.H(a,"submit",function(c){var d,e=b();try{d=e.call(f.$data,a)}finally{!0!==d&&(c.preventDefault?c.preventDefault():c.returnValue=!1)}})}};c.f.text={init:function(){return{controlsDescendantBindings:!0}},update:function(a,b){c.a.Ab(a,b())}};c.h.ea.text=!0;(function(){if(a&&a.navigator){var d=function(a){if(a)return parseFloat(a[1])},e=a.navigator.userAgent,f,g,h,k,l;(f=a.opera&&a.opera.version&&parseInt(a.opera.version()))||(l=d(e.match(/Edge\/([^ ]+)$/)))||d(e.match(/Chrome\/([^ ]+)/))||(g=d(e.match(/Version\/([^ ]+) Safari/)))||(h=d(e.match(/Firefox\/([^ ]+)/)))||(k=c.a.W||d(e.match(/MSIE ([^ ]+)/)))||(k=d(e.match(/rv:([^ )]+)/)))}if(8<=k&&10>k)var m=c.a.g.Z(),p=c.a.g.Z(),q=function(a){var b=this.activeElement;(b=b&&c.a.g.get(b,p))&&b(a)},r=function(a,b){var d=a.ownerDocument;c.a.g.get(d,m)||(c.a.g.set(d,m,!0),c.a.H(d,"selectionchange",q));c.a.g.set(a,p,b)};c.f.textInput={init:function(a,d,e){function m(b,d){c.a.H(a,b,d)}function p(){var e=c.a.c(d());if(null===e||e===b)e="";v!==b&&e===v?c.a.setTimeout(p,4):a.value!==e&&(z=!0,a.value=e,z=!1,u=a.value)}function q(){w||(v=a.value,w=c.a.setTimeout(t,4))}function t(){clearTimeout(w);v=w=b;var f=a.value;u!==f&&(u=f,c.m.$a(d(),e,"textInput",f))}var u=a.value,w,v,y=9==c.a.W?q:t,z=!1;k&&m("keypress",t);11>k&&m("propertychange",function(a){z||"value"!==a.propertyName||y(a)});8==k&&(m("keyup",t),m("keydown",t));r&&(r(a,y),m("dragend",q));(!k||9<=k)&&m("input",y);5>g&&"textarea"===c.a.P(a)?(m("keydown",q),m("paste",q),m("cut",q)):11>f?m("keydown",q):4>h?(m("DOMAutoComplete",t),m("dragdrop",t),m("drop",t)):l&&"number"===a.type&&m("keydown",q);m("change",t);m("blur",t);c.o(p,null,{l:a})}};c.m.va.textInput=!0;c.f.textinput={preprocess:function(a,b,c){c("textInput",a)}}})();c.f.uniqueName={init:function(a,b){if(b()){var d="ko_unique_"+ ++c.f.uniqueName.qd;c.a.Xc(a,d)}}};c.f.uniqueName.qd=0;c.f.using={init:function(a,b,d,e,f){var g;d.has("as")&&(g={as:d.get("as"),noChildContext:d.get("noChildContext")});b=f.createChildContext(b,g);c.Pa(b,a);return{controlsDescendantBindings:!0}}};c.h.ea.using=!0;c.f.value={after:["options","foreach"],init:function(a,d,e){var f=c.a.P(a),g="input"==f;if(!g||"checkbox"!=a.type&&"radio"!=a.type){var h=["change"],k=e.get("valueUpdate"),l=!1,m=null;k&&("string"==typeof k&&(k=[k]),c.a.gb(h,k),h=c.a.vc(h));var p=function(){m=null;l=!1;var b=d(),f=c.u.L(a);c.m.$a(b,e,"value",f)};!c.a.W||!g||"text"!=a.type||"off"==a.autocomplete||a.form&&"off"==a.form.autocomplete||-1!=c.a.A(h,"propertychange")||(c.a.H(a,"propertychange",function(){l=!0}),c.a.H(a,"focus",function(){l=!1}),c.a.H(a,"blur",function(){l&&p()}));c.a.C(h,function(b){var d=p;c.a.Td(b,"after")&&(d=function(){m=c.u.L(a);c.a.setTimeout(p,0)},b=b.substring(5));c.a.H(a,b,d)});var q;q=g&&"file"==a.type?function(){var e=c.a.c(d());null===e||e===b||""===e?a.value="":c.v.K(p)}:function(){var g=c.a.c(d()),h=c.u.L(a);if(null!==m&&g===m)c.a.setTimeout(q,0);else if(g!==h||h===b)"select"===f?(h=e.get("valueAllowUnset"),c.u.ya(a,g,h),h||g===c.u.L(a)||c.v.K(p)):c.u.ya(a,g)};c.o(q,null,{l:a})}else c.eb(a,{checkedValue:d})},update:function(){}};c.m.va.value=!0;c.f.visible={update:function(a,b){var d=c.a.c(b()),e="none"!=a.style.display;d&&!e?a.style.display="":!d&&e&&(a.style.display="none")}};c.f.hidden={update:function(a,b){c.f.visible.update(a,function(){return!c.a.c(b())})}};(function(a){c.f[a]={init:function(b,d,e,f,g){return c.f.event.init.call(this,b,function(){var b={};b[a]=d();return b},e,f,g)}}})("click");c.ca=function(){};c.ca.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource");};c.ca.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock");};c.ca.prototype.makeTemplateSource=function(a,b){if("string"==typeof a){b=b||f;var d=b.getElementById(a);if(!d)throw Error("Cannot find template with ID "+a);return new c.B.D(d)}if(1==a.nodeType||8==a.nodeType)return new c.B.ia(a);throw Error("Unknown template type: "+a);};c.ca.prototype.renderTemplate=function(a,b,c,d){a=this.makeTemplateSource(a,d);return this.renderTemplateSource(a,b,c,d)};c.ca.prototype.isTemplateRewritten=function(a,b){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,b).data("isRewritten")};c.ca.prototype.rewriteTemplate=function(a,b,c){a=this.makeTemplateSource(a,c);b=b(a.text());a.text(b);a.data("isRewritten",!0)};c.b("templateEngine",c.ca);c.ic=function(){function a(a,b,d,e){a=c.m.Zb(a);for(var f=c.m.Ra,g=0;g<a.length;g++){var h=a[g].key;if(Object.prototype.hasOwnProperty.call(f,h)){var k=f[h];if("function"===typeof k){if(h=k(a[g].value))throw Error(h);}else if(!k)throw Error("This template engine does not support the '"+h+"' binding within its templates");}}d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+c.m.ub(a,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')";return e.createJavaScriptEvaluatorBlock(d)+b}var b=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,d=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{wd:function(a,b,d){b.isTemplateRewritten(a,d)||b.rewriteTemplate(a,function(a){return c.ic.Kd(a,b)},d)},Kd:function(c,e){return c.replace(b,function(b,c,d,f,g){return a(g,c,d,e)}).replace(d,function(b,c){return a(c,"\x3c!-- ko --\x3e","#comment",e)})},ld:function(a,b){return c.aa.Wb(function(d,e){var f=d.nextSibling;f&&f.nodeName.toLowerCase()===b&&c.eb(f,a,e)})}}}();c.b("__tr_ambtns",c.ic.ld);(function(){c.B={};c.B.D=function(a){if(this.D=a){var b=c.a.P(a);this.Db="script"===b?1:"textarea"===b?2:"template"==b&&a.content&&11===a.content.nodeType?3:4}};c.B.D.prototype.text=function(){var a=1===this.Db?"text":2===this.Db?"value":"innerHTML";if(0==arguments.length)return this.D[a];var b=arguments[0];"innerHTML"===a?c.a.dc(this.D,b):this.D[a]=b};var a=c.a.g.Z()+"_";c.B.D.prototype.data=function(b){if(1===arguments.length)return c.a.g.get(this.D,a+b);c.a.g.set(this.D,a+b,arguments[1])};var d=c.a.g.Z();c.B.D.prototype.nodes=function(){var a=this.D;if(0==arguments.length){var e=c.a.g.get(a,d)||{},f=e.jb||(3===this.Db?a.content:4===this.Db?a:b);if(!f||e.hd)if(e=this.text())f=c.a.Ld(e,a.ownerDocument),this.text(""),c.a.g.set(a,d,{jb:f,hd:!0});return f}c.a.g.set(a,d,{jb:arguments[0]})};c.B.ia=function(a){this.D=a};c.B.ia.prototype=new c.B.D;c.B.ia.prototype.constructor=c.B.ia;c.B.ia.prototype.text=function(){if(0==arguments.length){var a=c.a.g.get(this.D,d)||{};a.jc===b&&a.jb&&(a.jc=a.jb.innerHTML);return a.jc}c.a.g.set(this.D,d,{jc:arguments[0]})};c.b("templateSources",c.B);c.b("templateSources.domElement",c.B.D);c.b("templateSources.anonymousTemplate",c.B.ia)})();(function(){function a(a,b,d){var e;for(b=c.h.nextSibling(b);a&&(e=a)!==b;)a=c.h.nextSibling(e),d(e,a)}function d(b,d){if(b.length){var e=b[0],f=b[b.length-1],g=e.parentNode,h=c.ga.instance,k=h.preprocessNode;if(k){a(e,f,function(a,b){var c=a.previousSibling,d=k.call(h,a);d&&(a===e&&(e=d[0]||b),a===f&&(f=d[d.length-1]||c))});b.length=0;if(!e)return;e===f?b.push(e):(b.push(e,f),c.a.Ua(b,g))}a(e,f,function(a){1!==a.nodeType&&8!==a.nodeType||c.uc(d,a)});a(e,f,function(a){1!==a.nodeType&&8!==a.nodeType||c.aa.bd(a,[d])});c.a.Ua(b,g)}}function e(a){return a.nodeType?a:0<a.length?a[0]:null}function f(a,b,f,g,k){k=k||{};var l=(a&&e(a)||f||{}).ownerDocument,m=k.templateEngine||h;c.ic.wd(f,m,l);f=m.renderTemplate(f,g,k,l);if("number"!=typeof f.length||0<f.length&&"number"!=typeof f[0].nodeType)throw Error("Template engine must return an array of DOM nodes");l=!1;switch(b){case "replaceChildren":c.h.ua(a,f);l=!0;break;case "replaceNode":c.a.Wc(a,f);l=!0;break;case "ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+b);}l&&(d(f,g),k.afterRender&&c.v.K(k.afterRender,null,[f,g[k.as||"$data"]]),"replaceChildren"==b&&c.j.Ga(a,c.j.T));return f}function g(a,b,d){return c.N(a)?a():"function"===typeof a?a(b,d):a}var h;c.ec=function(a){if(a!=b&&!(a instanceof c.ca))throw Error("templateEngine must inherit from ko.templateEngine");h=a};c.bc=function(a,d,k,l,m){k=k||{};if((k.templateEngine||h)==b)throw Error("Set a template engine before calling renderTemplate");m=m||"replaceChildren";if(l){var p=e(l);return c.$(function(){var b=d&&d instanceof c.fa?d:new c.fa(d,null,null,null,{exportDependencies:!0}),h=g(a,b.$data,b),b=f(l,m,h,b,k);"replaceNode"==m&&(l=b,p=e(l))},null,{Sa:function(){return!p||!c.a.Rb(p)},l:p&&"replaceNode"==m?p.parentNode:p})}return c.aa.Wb(function(b){c.bc(a,d,k,b,"replaceNode")})};c.Pd=function(a,e,h,k,l){function m(a,b){c.v.K(c.a.cc,null,[k,a,q,h,p,b]);c.j.Ga(k,c.j.T)}function p(a,b){d(b,r);h.afterRender&&h.afterRender(b,a);r=null}function q(b,c){r=l.createChildContext(b,{as:t,noChildContext:h.noChildContext,extend:function(a){a.$index=c;t&&(a[t+"Index"]=c)}});var d=g(a,b,r);return f(k,"ignoreTargetNode",d,r,h)}var r,t=h.as,u=!1===h.includeDestroyed||c.options.foreachHidesDestroyed&&!h.includeDestroyed;if(u||h.beforeRemove||!c.Oc(e))return c.$(function(){var a=c.a.c(e)||[];"undefined"==typeof a.length&&(a=[a]);u&&(a=c.a.fb(a,function(a){return a===b||null===a||!c.a.c(a._destroy)}));m(a)},null,{l:k});m(e.w());var w=e.subscribe(function(a){m(e(),a)},null,"arrayChange");w.l(k);return w};var k=c.a.g.Z(),l=c.a.g.Z();c.f.template={init:function(a,b){var d=c.a.c(b());if("string"==typeof d||d.name)c.h.Ea(a);else if("nodes"in d){d=d.nodes||[];if(c.N(d))throw Error('The "nodes" option must be a plain, non-observable array.');var e=d[0]&&d[0].parentNode;e&&c.a.g.get(e,l)||(e=c.a.Xb(d),c.a.g.set(e,l,!0));(new c.B.ia(a)).nodes(e)}else if(d=c.h.childNodes(a),0<d.length)e=c.a.Xb(d),(new c.B.ia(a)).nodes(e);else throw Error("Anonymous template defined, but no template content was provided");return{controlsDescendantBindings:!0}},update:function(a,d,e,f,g){var h=d();d=c.a.c(h);e=!0;f=null;"string"==typeof d?d={}:(h=d.name,"if"in d&&(e=c.a.c(d["if"])),e&&"ifnot"in d&&(e=!c.a.c(d.ifnot)));"foreach"in d?f=c.Pd(h||a,e&&d.foreach||[],d,a,g):e?(e=g,"data"in d&&(e=g.createChildContext(d.data,{as:d.as,noChildContext:d.noChildContext,exportDependencies:!0})),f=c.bc(h||a,e,d,a)):c.h.Ea(a);g=f;(d=c.a.g.get(a,k))&&"function"==typeof d.s&&d.s();c.a.g.set(a,k,!g||g.ja&&!g.ja()?b:g)}};c.m.Ra.template=function(a){a=c.m.Zb(a);return 1==a.length&&a[0].unknown||c.m.Hd(a,"name")?null:"This template engine does not support anonymous templates nested within its templates"};c.h.ea.template=!0})();c.b("setTemplateEngine",c.ec);c.b("renderTemplate",c.bc);c.a.Jc=function(a,b,c){if(a.length&&b.length){var d,e,f,g,h;for(d=e=0;(!c||d<c)&&(g=a[e]);++e){for(f=0;h=b[f];++f)if(g.value===h.value){g.moved=h.index;h.moved=g.index;b.splice(f,1);d=f=0;break}d+=f}}};c.a.Ob=function(){function a(a,b,d,e,f){var g=Math.min,h=Math.max,k=[],l,m=a.length,p,q=b.length,r=q-m||1,t=m+q+1,u,w,v;for(l=0;l<=m;l++)for(w=u,k.push(u=[]),v=g(q,l+r),p=h(0,l-1);p<=v;p++)u[p]=p?l?a[l-1]===b[p-1]?w[p-1]:g(w[p]||t,u[p-1]||t)+1:p+1:l+1;g=[];h=[];r=[];l=m;for(p=q;l||p;)q=k[l][p]-1,p&&q===k[l][p-1]?h.push(g[g.length]={status:d,value:b[--p],index:p}):l&&q===k[l-1][p]?r.push(g[g.length]={status:e,value:a[--l],index:l}):(--p,--l,f.sparse||g.push({status:"retained",value:b[p]}));c.a.Jc(r,h,!f.dontLimitMoves&&10*m);return g.reverse()}return function(b,c,d){d="boolean"===typeof d?{dontLimitMoves:d}:d||{};b=b||[];c=c||[];return b.length<c.length?a(b,c,"added","deleted",d):a(c,b,"deleted","added",d)}}();c.b("utils.compareArrays",c.a.Ob);(function(){function a(a,d,e,f,g){var h=[],k=c.$(function(){var b=d(e,g,c.a.Ua(h,a))||[];0<h.length&&(c.a.Wc(h,b),f&&c.v.K(f,null,[e,b,g]));h.length=0;c.a.gb(h,b)},null,{l:a,Sa:function(){return!c.a.jd(h)}});return{Y:h,$:k.ja()?k:b}}var d=c.a.g.Z(),e=c.a.g.Z();c.a.cc=function(f,g,h,k,l,m){function p(a){E={Aa:a,nb:c.sa(y++)};w.push(E);u||D.push(E)}function q(a){E=t[a];y!==E.nb.w()&&C.push(E);E.nb(y++);c.a.Ua(E.Y,f);w.push(E)}function r(a,b){if(a)for(var d=0,e=b.length;d<e;d++)c.a.C(b[d].Y,function(c){a(c,d,b[d].Aa)})}g=g||[];"undefined"==typeof g.length&&(g=[g]);k=k||{};var t=c.a.g.get(f,d),u=!t,w=[],v=0,y=0,z=[],A=[],B=[],C=[],D=[],E,x=0;if(u)c.a.C(g,p);else{if(!m||t&&t._countWaitingForRemove){var G=c.a.Mb(t,function(a){return a.Aa});m=c.a.Ob(G,g,{dontLimitMoves:k.dontLimitMoves,sparse:!0})}for(var G=0,H,F,I;H=m[G];G++)switch(F=H.moved,I=H.index,H.status){case "deleted":for(;v<I;)q(v++);F===b&&(E=t[v],E.$&&(E.$.s(),E.$=b),c.a.Ua(E.Y,f).length&&(k.beforeRemove&&(w.push(E),x++,E.Aa===e?E=null:B.push(E)),E&&z.push.apply(z,E.Y)));v++;break;case "added":for(;y<I;)q(v++);F!==b?(A.push(w.length),q(F)):p(H.value)}for(;y<g.length;)q(v++);w._countWaitingForRemove=x}c.a.g.set(f,d,w);r(k.beforeMove,C);c.a.C(z,k.beforeRemove?c.na:c.removeNode);var J,K,L;try{L=f.ownerDocument.activeElement}catch(oa){}if(A.length)for(;(G=A.shift())!=b;){E=w[G];for(J=b;G;)if((K=w[--G].Y)&&K.length){J=K[K.length-1];break}for(g=0;v=E.Y[g];J=v,g++)c.h.Vb(f,v,J)}G=0;for(A=c.h.firstChild(f);E=w[G];G++){E.Y||c.a.extend(E,a(f,h,E.Aa,l,E.nb));for(g=0;v=E.Y[g];A=v.nextSibling,J=v,g++)v!==A&&c.h.Vb(f,v,J);!E.Dd&&l&&(l(E.Aa,E.Y,E.nb),E.Dd=!0,J=E.Y[E.Y.length-1])}L&&f.ownerDocument.activeElement!=L&&L.focus();r(k.beforeRemove,B);for(G=0;G<B.length;++G)B[G].Aa=e;r(k.afterMove,C);r(k.afterAdd,D)}})();c.b("utils.setDomNodeChildrenFromArrayMapping",c.a.cc);c.ba=function(){this.allowTemplateRewriting=!1};c.ba.prototype=new c.ca;c.ba.prototype.constructor=c.ba;c.ba.prototype.renderTemplateSource=function(a,b,d,e){if(b=(9>c.a.W?0:a.nodes)?a.nodes():null)return c.a.la(b.cloneNode(!0).childNodes);a=a.text();return c.a.ta(a,e)};c.ba.Na=new c.ba;c.ec(c.ba.Na);c.b("nativeTemplateEngine",c.ba);(function(){c.Za=function(){var a=this.Gd=function(){if(!g||!g.tmpl)return 0;try{if(0<=g.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(E){}return 1}();this.renderTemplateSource=function(b,c,d,e){e=e||f;d=d||{};if(2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var h=b.data("precompiled");h||(h=b.text()||"",h=g.template(null,"{{ko_with $item.koBindingContext}}"+h+"{{/ko_with}}"),b.data("precompiled",h));b=[c.$data];c=g.extend({koBindingContext:c},d.templateOptions);c=g.tmpl(h,b,c);c.appendTo(e.createElement("div"));g.fragments={};return c};this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"};this.addTemplate=function(a,b){f.write("\x3cscript type\x3d'text/html' id\x3d'"+a+"'\x3e"+b+"\x3c/script\x3e")};0<a&&(g.tmpl.tag.ko_code={open:"__.push($1 || '');"},g.tmpl.tag.ko_with={open:"with($1) {",close:"} "})};c.Za.prototype=new c.ca;c.Za.prototype.constructor=c.Za;var a=new c.Za;0<a.Gd&&c.ec(a);c.b("jqueryTmplTemplateEngine",c.Za)})()})})()})();F("ThirdParty/knockout-es5",[],function(){function b(b,e){if(!b)throw Error("When calling ko.track, you must pass an object as the first parameter.");var d=this,f=a(b,!0);e=e||Object.getOwnPropertyNames(b);e.forEach(function(a){if("__knockoutObservables"!==a&&"__knockoutSubscribable"!==a&&!(a in f)){var e=b[a],c=e instanceof Array,e=d.isObservable(e)?e:c?d.observableArray(e):d.observable(e);Object.defineProperty(b,a,{configurable:!0,enumerable:!0,get:e,set:d.isWriteableObservable(e)?e:void 0});f[a]=e;c&&k(d,e)}});return b}function a(a,b){var d=a.__knockoutObservables;!d&&b&&(d={},Object.defineProperty(a,"__knockoutObservables",{value:d}));return d}function f(a,e,d){var f={owner:a,deferEvaluation:!0};if("function"===typeof d)f.read=d;else{if("value"in d)throw Error('For ko.defineProperty, you must not specify a "value" for the property. You must provide a "get" function.');if("function"!==typeof d.get)throw Error('For ko.defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".');f.read=d.get;f.write=d.set}a[e]=this.computed(f);b.call(this,a,[e]);return a}function k(a,b){var d=null;a.computed(function(){d&&(d.dispose(),d=null);var e=b();if(e instanceof Array){var f=e.__knockoutSubscribable;if(!f){f=new a.subscribable;Object.defineProperty(e,"__knockoutSubscribable",{value:f});var h={};g(e,f,h);l(a,e,f,h)}d=f.subscribe(b)}})}function g(a,b,d){"pop push reverse shift sort splice unshift".split(" ").forEach(function(e){var f=a[e];a[e]=function(){var a=f.apply(this,arguments);!0!==d.pause&&b.notifySubscribers(this);return a}})}function l(a,b,d,e){["remove","removeAll","destroy","destroyAll","replace"].forEach(function(f){Object.defineProperty(b,f,{enumerable:!1,value:function(){var g;e.pause=!0;try{g=a.observableArray.fn[f].apply(a.observableArray(b),arguments)}finally{e.pause=!1}d.notifySubscribers(b);return g}})})}function m(b,e){if(!b)return null;var d=a(b,!1);return d&&d[e]||null}function e(a,b){var d=m(a,b);d&&d.valueHasMutated()}return{attachToKo:function(a){a.track=b;a.getObservable=m;a.valueHasMutated=e;a.defineProperty=f}}});F("Widgets/SvgPathBindingHandler",[],function(){return{register:function(b){b.bindingHandlers.cesiumSvgPath={init:function(a,f){var k=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");k.setAttribute("class","cesium-svgPath-svg");var g=document.createElementNS("http://www.w3.org/2000/svg","path");k.appendChild(g);b.virtualElements.setDomNodeChildren(a,[k]);b.computed({read:function(){var a=b.unwrap(f());g.setAttribute("d",b.unwrap(a.path));var m=b.unwrap(a.width),e=b.unwrap(a.height);k.setAttribute("width",m);k.setAttribute("height",e);k.setAttribute("viewBox","0 0 "+m+" "+e);a.css&&k.setAttribute("class","cesium-svgPath-svg "+b.unwrap(a.css))},disposeWhenNodeIsRemoved:a});return{controlsDescendantBindings:!0}}};b.virtualElements.allowedBindings.cesiumSvgPath=!0}}});F("ThirdParty/knockout",["./knockout-3.5.0","./knockout-es5","../Widgets/SvgPathBindingHandler"],function(b,a,f){a.attachToKo(b);f.register(b);return b});(function(){var b=function(){var a={defaultNoDataValue:-3.4027999387901484E38,decode:function(b,f){var e;f=f||{};var g=f.inputOffset||0,k=f.encodedMaskData||null===f.encodedMaskData,d={},l=new Uint8Array(b,g,10);d.fileIdentifierString=String.fromCharCode.apply(null,l);if("CntZImage"!==d.fileIdentifierString.trim())throw"Unexpected file identifier string: "+d.fileIdentifierString;g+=10;l=new DataView(b,g,24);d.fileVersion=l.getInt32(0,!0);d.imageType=l.getInt32(4,!0);d.height=l.getUint32(8,!0);d.width=l.getUint32(12,!0);d.maxZError=l.getFloat64(16,!0);g+=24;if(!k)if(l=new DataView(b,g,16),d.mask={},d.mask.numBlocksY=l.getUint32(0,!0),d.mask.numBlocksX=l.getUint32(4,!0),d.mask.numBytes=l.getUint32(8,!0),d.mask.maxValue=l.getFloat32(12,!0),g+=16,0<d.mask.numBytes){var k=new Uint8Array(Math.ceil(d.width*d.height/8)),l=new DataView(b,g,d.mask.numBytes),m=l.getInt16(0,!0),r=2,c=0;do{if(0<m)for(;m--;)k[c++]=l.getUint8(r++);else for(var u=l.getUint8(r++),m=-m;m--;)k[c++]=u;m=l.getInt16(r,!0);r+=2}while(r<d.mask.numBytes);if(-32768!==m||c<k.length)throw"Unexpected end of mask RLE encoding";d.mask.bitset=k;g+=d.mask.numBytes}else 0===(d.mask.numBytes|d.mask.numBlocksY|d.mask.maxValue)&&(d.mask.bitset=new Uint8Array(Math.ceil(d.width*d.height/8)));l=new DataView(b,g,16);d.pixels={};d.pixels.numBlocksY=l.getUint32(0,!0);d.pixels.numBlocksX=l.getUint32(4,!0);d.pixels.numBytes=l.getUint32(8,!0);d.pixels.maxValue=l.getFloat32(12,!0);g+=16;k=d.pixels.numBlocksX;l=d.pixels.numBlocksY;k+=0<d.width%k?1:0;m=l+(0<d.height%l?1:0);d.pixels.blocks=Array(k*m);for(c=r=0;c<m;c++)for(u=0;u<k;u++){var y=0,l=new DataView(b,g,Math.min(10,b.byteLength-g)),A={};d.pixels.blocks[r++]=A;var z=l.getUint8(0);y++;A.encoding=z&63;if(3<A.encoding)throw"Invalid block encoding ("+A.encoding+")";if(2===A.encoding)g++;else{if(0!==z&&2!==z){z>>=6;A.offsetType=z;if(2===z)A.offset=l.getInt8(1),y++;else if(1===z)A.offset=l.getInt16(1,!0),y+=2;else if(0===z)A.offset=l.getFloat32(1,!0),y+=4;else throw"Invalid block offset type";if(1===A.encoding)if(z=l.getUint8(y),y++,A.bitsPerPixel=z&63,z>>=6,A.numValidPixelsType=z,2===z)A.numValidPixels=l.getUint8(y),y++;else if(1===z)A.numValidPixels=l.getUint16(y,!0),y+=2;else if(0===z)A.numValidPixels=l.getUint32(y,!0),y+=4;else throw"Invalid valid pixel count type";}g+=y;if(3!==A.encoding)if(0===A.encoding){z=(d.pixels.numBytes-1)/4;if(z!==Math.floor(z))throw"uncompressed block has invalid length";l=new ArrayBuffer(4*z);y=new Uint8Array(l);y.set(new Uint8Array(b,g,4*z));l=new Float32Array(l);A.rawData=l;g+=4*z}else 1===A.encoding&&(z=Math.ceil(A.numValidPixels*A.bitsPerPixel/8),l=new ArrayBuffer(4*Math.ceil(z/4)),y=new Uint8Array(l),y.set(new Uint8Array(b,g,z)),A.stuffedData=new Uint32Array(l),g+=z)}}d.eofOffset=g;var g=null!==f.noDataValue?f.noDataValue:a.defaultNoDataValue,m=f.encodedMaskData,x=f.returnMask,r=0,c=d.pixels.numBlocksX,u=d.pixels.numBlocksY,A=Math.floor(d.width/c),y=Math.floor(d.height/u),z=2*d.maxZError,l=Number.MAX_VALUE,D,m=m||(d.mask?d.mask.bitset:null),v,k=new (f.pixelType||Float32Array)(d.width*d.height);x&&m&&(v=new Uint8Array(d.width*d.height));for(var x=new Float32Array(A*y),B,C,F=0;F<=u;F++){var H=F!==u?y:d.height%u;if(0!==H)for(var J=0;J<=c;J++){var w=J!==c?A:d.width%c;if(0!==w){var G=F*d.width*y+J*A,E=d.width-w,L=d.pixels.blocks[r],K,P;if(2>L.encoding){if(0===L.encoding)K=L.rawData;else{K=L.stuffedData;P=L.bitsPerPixel;D=L.numValidPixels;B=L.offset;C=z;var N=x,O=d.pixels.maxValue,Z=(1<<P)-1,aa=0,U,W=0,M,R=void 0,Y=Math.ceil((O-B)/C);K[K.length-1]<<=8*(4*K.length-Math.ceil(P*D/8));for(U=0;U<D;U++)0===W&&(R=K[aa++],W=32),W>=P?(M=R>>>W-P&Z,W-=P):(W=P-W,M=(R&Z)<<W&Z,R=K[aa++],W=32-W,M+=R>>>W),N[U]=M<Y?B+M*C:O;K=x}P=0}else e=2===L.encoding?0:L.offset;var Q;if(m)for(C=0;C<H;C++){G&7&&(Q=m[G>>3],Q<<=G&7);for(B=0;B<w;B++)G&7||(Q=m[G>>3]),Q&128?(v&&(v[G]=1),D=2>L.encoding?K[P++]:e,l=l>D?D:l,k[G++]=D):(v&&(v[G]=0),k[G++]=g),Q<<=1;G+=E}else if(2>L.encoding)for(C=0;C<H;C++){for(B=0;B<w;B++)D=K[P++],l=l>D?D:l,k[G++]=D;G+=E}else for(l=l>e?e:l,C=0;C<H;C++){for(B=0;B<w;B++)k[G++]=e;G+=E}if(1===L.encoding&&P!==L.numValidPixels)throw"Block and Mask do not match";r++}}}e=v;v={width:d.width,height:d.height,pixelData:k,minValue:l,maxValue:d.pixels.maxValue,noDataValue:g};e&&(v.maskData=e);f.returnEncodedMask&&d.mask&&(v.encodedMaskData=d.mask.bitset?d.mask.bitset:null);if(f.returnFileInfo&&(v.fileInfo={fileIdentifierString:d.fileIdentifierString,fileVersion:d.fileVersion,imageType:d.imageType,height:d.height,width:d.width,maxZError:d.maxZError,eofOffset:d.eofOffset,mask:d.mask?{numBlocksX:d.mask.numBlocksX,numBlocksY:d.mask.numBlocksY,numBytes:d.mask.numBytes,maxValue:d.mask.maxValue}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,numBytes:d.pixels.numBytes,maxValue:d.pixels.maxValue,noDataValue:d.noDataValue}},f.computeUsedBitDepths)){e=v.fileInfo;Q=d.pixels.numBlocksX*d.pixels.numBlocksY;K={};for(P=0;P<Q;P++)g=d.pixels.blocks[P],0===g.encoding?K.float32=!0:1===g.encoding?K[g.bitsPerPixel]=!0:K[0]=!0;d=Object.keys(K);e.bitDepths=d}return v}};return a}(),a=function(){var a={unstuff:function(a,b,f,d,g,k,l,c){var e=(1<<f)-1,h=0,m,p=0,q,r;a[a.length-1]<<=8*(4*a.length-Math.ceil(f*d/8));if(g)for(m=0;m<d;m++)0===p&&(r=a[h++],p=32),p>=f?(q=r>>>p-f&e,p-=f):(p=f-p,q=(r&e)<<p&e,r=a[h++],p=32-p,q+=r>>>p),b[m]=g[q];else for(g=Math.ceil((c-k)/l),m=0;m<d;m++)0===p&&(r=a[h++],p=32),p>=f?(q=r>>>p-f&e,p-=f):(p=f-p,q=(r&e)<<p&e,r=a[h++],p=32-p,q+=r>>>p),b[m]=q<g?k+q*l:c},unstuffLUT:function(a,b,f,d,g,k){var e=(1<<b)-1,c=0,h,l;l=0;var m,p,q=[];a[a.length-1]<<=8*(4*a.length-Math.ceil(b*f/8));var t=Math.ceil((k-d)/g);for(h=0;h<f;h++)0===l&&(p=a[c++],l=32),l>=b?(m=p>>>l-b&e,l-=b):(l=b-l,m=(p&e)<<l&e,p=a[c++],l=32-l,m+=p>>>l),q[h]=m<t?d+m*g:k;q.unshift(d);return q},unstuff2:function(a,b,f,d,g,k,l,c){var e=(1<<f)-1,h=0,m,p=0,q=0,r,t,B;if(g)for(m=0;m<d;m++)0===p&&(t=a[h++],p=32,q=0),p>=f?(r=t>>>q&e,p-=f,q+=f):(B=f-p,r=t>>>q&e,t=a[h++],p=32-B,r|=(t&(1<<B)-1)<<f-B,q=B),b[m]=g[r];else for(g=Math.ceil((c-k)/l),m=0;m<d;m++)0===p&&(t=a[h++],p=32,q=0),p>=f?(r=t>>>q&e,p-=f,q+=f):(B=f-p,r=t>>>q&e,t=a[h++],p=32-B,r|=(t&(1<<B)-1)<<f-B,q=B),b[m]=r<g?k+r*l:c;return b},unstuffLUT2:function(a,b,f,d,g,k){var e=(1<<b)-1,c=0,h,l,m=0,p,q=0,t,v=[],B=Math.ceil((k-d)/g);for(h=0;h<f;h++)0===m&&(t=a[c++],m=32,q=0),m>=b?(p=t>>>q&e,m-=b,q+=b):(l=b-m,p=t>>>q&e,t=a[c++],m=32-l,p|=(t&(1<<l)-1)<<b-l,q=l),v[h]=p<B?d+p*g:k;v.unshift(d);return v},originalUnstuff:function(a,b,f,d){var e=(1<<f)-1,g=0,h,c=0,k,l;a[a.length-1]<<=8*(4*a.length-Math.ceil(f*d/8));for(h=0;h<d;h++)0===c&&(l=a[g++],c=32),c>=f?(k=l>>>c-f&e,c-=f):(c=f-c,k=(l&e)<<c&e,l=a[g++],c=32-c,k+=l>>>c),b[h]=k;return b},originalUnstuff2:function(a,b,f,d){var e=(1<<f)-1,g=0,h,c=0,k=0,l,m,p;for(h=0;h<d;h++)0===c&&(m=a[g++],c=32,k=0),c>=f?(l=m>>>k&e,c-=f,k+=f):(p=f-c,l=m>>>k&e,m=a[g++],c=32-p,l|=(m&(1<<p)-1)<<f-p,k=p),b[h]=l;return b}},b={HUFFMAN_LUT_BITS_MAX:12,computeChecksumFletcher32:function(a){for(var b=65535,e=65535,d=a.length,f=Math.floor(d/2),g=0;f;){var k=359<=f?359:f,f=f-k;do b+=a[g++]<<8,e+=b+=a[g++];while(--k);b=(b&65535)+(b>>>16);e=(e&65535)+(e>>>16)}d&1&&(e+=b+=a[g]<<8);return((e&65535)+(e>>>16)<<16|(b&65535)+(b>>>16))>>>0},readHeaderInfo:function(a,b){var e=b.ptr,d=new Uint8Array(a,e,6),f={};f.fileIdentifierString=String.fromCharCode.apply(null,d);if(0!==f.fileIdentifierString.lastIndexOf("Lerc2",0))throw"Unexpected file identifier string (expect Lerc2 ): "+f.fileIdentifierString;var e=e+6,d=new DataView(a,e,8),g=d.getInt32(0,!0);f.fileVersion=g;e+=4;3<=g&&(f.checksum=d.getUint32(4,!0),e+=4);d=new DataView(a,e,12);f.height=d.getUint32(0,!0);f.width=d.getUint32(4,!0);e+=8;4<=g?(f.numDims=d.getUint32(8,!0),e+=4):f.numDims=1;d=new DataView(a,e,40);f.numValidPixel=d.getUint32(0,!0);f.microBlockSize=d.getInt32(4,!0);f.blobSize=d.getInt32(8,!0);f.imageType=d.getInt32(12,!0);f.maxZError=d.getFloat64(16,!0);f.zMin=d.getFloat64(24,!0);f.zMax=d.getFloat64(32,!0);e+=40;b.headerInfo=f;b.ptr=e;if(3<=g&&(e=this.computeChecksumFletcher32(new Uint8Array(a,e-(4<=g?52:48),f.blobSize-14)),e!==f.checksum))throw"Checksum failed.";return!0},checkMinMaxRanges:function(a,b){var e=b.headerInfo,d=this.getDataTypeArray(e.imageType),f=e.numDims*this.getDataTypeSize(e.imageType),g=this.readSubArray(a,b.ptr,d,f),d=this.readSubArray(a,b.ptr+f,d,f);b.ptr+=2*f;for(var h=!0,f=0;f<e.numDims;f++)if(g[f]!==d[f]){h=!1;break}e.minValues=g;e.maxValues=d;return h},readSubArray:function(a,b,f,d){if(f===Uint8Array)a=new Uint8Array(a,b,d);else{var e=new ArrayBuffer(d);(new Uint8Array(e)).set(new Uint8Array(a,b,d));a=new f(e)}return a},readMask:function(a,b){var e=b.ptr,d=b.headerInfo,f=d.width*d.height,g=d.numValidPixel,h=new DataView(a,e,4),d={};d.numBytes=h.getUint32(0,!0);e+=4;if((0===g||f===g)&&0!==d.numBytes)throw"invalid mask";if(0===g)g=new Uint8Array(Math.ceil(f/8)),d.bitset=g,h=new Uint8Array(f),b.pixels.resultMask=h,e+=d.numBytes;else if(0<d.numBytes){var g=new Uint8Array(Math.ceil(f/8)),h=new DataView(a,e,d.numBytes),c=h.getInt16(0,!0),k=2,l=0,m;do{if(0<c)for(;c--;)g[l++]=h.getUint8(k++);else for(m=h.getUint8(k++),c=-c;c--;)g[l++]=m;c=h.getInt16(k,!0);k+=2}while(k<d.numBytes);if(-32768!==c||l<g.length)throw"Unexpected end of mask RLE encoding";h=new Uint8Array(f);for(k=0;k<f;k++)k&7?(c=g[k>>3],c<<=k&7):c=g[k>>3],c&128&&(h[k]=1);b.pixels.resultMask=h;d.bitset=g;e+=d.numBytes}b.ptr=e;b.mask=d;return!0},readDataOneSweep:function(a,f,g){var d=f.ptr,e=f.headerInfo,h=e.numDims,k=e.width*e.height,e=e.numValidPixel*b.getDataTypeSize(e.imageType)*h,c=f.pixels.resultMask;if(g===Uint8Array)a=new Uint8Array(a,d,e);else{var l=new ArrayBuffer(e);(new Uint8Array(l)).set(new Uint8Array(a,d,e));a=new g(l)}if(a.length===k*h)f.pixels.resultPixels=a;else{f.pixels.resultPixels=new g(k*h);g=0;var m,p;if(1<h)for(m=0;m<h;m++)for(p=m*k,l=0;l<k;l++)c[l]&&(f.pixels.resultPixels[p+l]=a[g++]);else for(l=0;l<k;l++)c[l]&&(f.pixels.resultPixels[l]=a[g++])}f.ptr=d+e;return!0},readHuffmanTree:function(a,g){var e=this.HUFFMAN_LUT_BITS_MAX,d=new DataView(a,g.ptr,16);g.ptr+=16;if(2>d.getInt32(0,!0))throw"unsupported Huffman version";var h=d.getInt32(4,!0),k=d.getInt32(8,!0),d=d.getInt32(12,!0);if(k>=d)return!1;var l=new Uint32Array(d-k);b.decodeBits(a,g,l);var c=[],m,y,A;for(m=k;m<d;m++)y=m-(m<h?0:h),c[y]={first:l[m-k],second:null};m=a.byteLength-g.ptr;l=new ArrayBuffer(4*Math.ceil(m/4));(new Uint8Array(l)).set(new Uint8Array(a,g.ptr,m));var l=new Uint32Array(l),z=0,x,D=0;x=l[0];for(m=k;m<d;m++)y=m-(m<h?0:h),A=c[y].first,0<A&&(c[y].second=x<<z>>>32-A,32-z>=A?(z+=A,32===z&&(z=0,D++,x=l[D])):(z+=A-32,D++,x=l[D],c[y].second|=x>>>32-z));x=0;var v=new f;for(m=0;m<c.length;m++)void 0!==c[m]&&(x=Math.max(x,c[m].first));e=x>=e?e:x;30<=x&&console.log("WARning, large NUM LUT BITS IS "+x);var B=[],C,F;for(m=k;m<d;m++)if(y=m-(m<h?0:h),A=c[y].first,0<A)if(k=[A,y],A<=e)for(y=c[y].second<<e-A,C=1<<e-A,A=0;A<C;A++)B[y|A]=k;else for(y=c[y].second,C=v,--A;0<=A;A--)(F=y>>>A&1)?(C.right||(C.right=new f),C=C.right):(C.left||(C.left=new f),C=C.left),0!==A||C.val||(C.val=k[1]);return{decodeLut:B,numBitsLUTQick:e,numBitsLUT:x,tree:v,stuffedData:l,srcPtr:D,bitPos:z}},readHuffman:function(a,b,f){var d=b.headerInfo,e=d.numDims,g=b.headerInfo.height,h=b.headerInfo.width,c=h*g,k=this.readHuffmanTree(a,b);a=k.decodeLut;var l=k.tree,m=k.stuffedData,p=k.srcPtr,x=k.bitPos,D=k.numBitsLUTQick,k=k.numBitsLUT,v=0===b.headerInfo.imageType?128:0,B,C,F=b.pixels.resultMask,H,J,w,G,E,L,K=0;0<x&&(p++,x=0);var P=m[p],N=1===b.encodeMode,O=new f(c*e),Z=O,aa;for(aa=0;aa<d.numDims;aa++){1<e&&(Z=new f(O.buffer,c*aa,c),K=0);if(b.headerInfo.numValidPixel===h*g)for(w=E=0;w<g;w++)for(G=0;G<h;G++,E++){C=0;B=H=P<<x>>>32-D;32-x<D&&(B=H|=m[p+1]>>>64-x-D);if(a[B])C=a[B][1],x+=a[B][0];else for(H=P<<x>>>32-k,32-x<k&&(H|=m[p+1]>>>64-x-k),B=l,L=0;L<k;L++)if(B=(J=H>>>k-L-1&1)?B.right:B.left,!B.left&&!B.right){C=B.val;x=x+L+1;break}32<=x&&(x-=32,p++,P=m[p]);C-=v;N?(C=0<G?C+K:0<w?C+Z[E-h]:C+K,C&=255,K=Z[E]=C):Z[E]=C}else for(w=E=0;w<g;w++)for(G=0;G<h;G++,E++)if(F[E]){C=0;B=H=P<<x>>>32-D;32-x<D&&(B=H|=m[p+1]>>>64-x-D);if(a[B])C=a[B][1],x+=a[B][0];else for(H=P<<x>>>32-k,32-x<k&&(H|=m[p+1]>>>64-x-k),B=l,L=0;L<k;L++)if(B=(J=H>>>k-L-1&1)?B.right:B.left,!B.left&&!B.right){C=B.val;x=x+L+1;break}32<=x&&(x-=32,p++,P=m[p]);C-=v;N?(C=0<G&&F[E-1]?C+K:0<w&&F[E-h]?C+Z[E-h]:C+K,C&=255,K=Z[E]=C):Z[E]=C}b.ptr=b.ptr+4*(p+1)+(0<x?4:0)}b.pixels.resultPixels=O},decodeBits:function(b,f,g,d,k){var e=f.headerInfo,h=e.fileVersion,c=0,l=new DataView(b,f.ptr,5<=b.byteLength-f.ptr?5:b.byteLength-f.ptr),m=l.getUint8(0);c++;var p=m>>6,p=0===p?4:3-p,q=0<(m&32)?!0:!1,m=m&31;if(1===p)p=l.getUint8(c),c++;else if(2===p)p=l.getUint16(c,!0),c+=2;else if(4===p)p=l.getUint32(c,!0),c+=4;else throw"Invalid valid pixel count type";var x=2*e.maxZError,D,v;k=1<e.numDims?e.maxValues[k]:e.zMax;if(q){f.counter.lut++;q=l.getUint8(c);c++;e=Math.ceil((q-1)*m/8);D=Math.ceil(e/4);D=new ArrayBuffer(4*D);v=new Uint8Array(D);f.ptr+=c;v.set(new Uint8Array(b,f.ptr,e));c=new Uint32Array(D);f.ptr+=e;for(l=0;q-1>>>l;)l++;e=Math.ceil(p*l/8);D=Math.ceil(e/4);D=new ArrayBuffer(4*D);v=new Uint8Array(D);v.set(new Uint8Array(b,f.ptr,e));b=new Uint32Array(D);f.ptr+=e;f=3<=h?a.unstuffLUT2(c,m,q-1,d,x,k):a.unstuffLUT(c,m,q-1,d,x,k);3<=h?a.unstuff2(b,g,l,p,f):a.unstuff(b,g,l,p,f)}else f.counter.bitstuffer++,l=m,f.ptr+=c,0<l&&(e=Math.ceil(p*l/8),D=Math.ceil(e/4),D=new ArrayBuffer(4*D),v=new Uint8Array(D),v.set(new Uint8Array(b,f.ptr,e)),b=new Uint32Array(D),f.ptr+=e,3<=h?null===d?a.originalUnstuff2(b,g,l,p):a.unstuff2(b,g,l,p,!1,d,x,k):null===d?a.originalUnstuff(b,g,l,p):a.unstuff(b,g,l,p,!1,d,x,k))},readTiles:function(a,f,g){var d=f.headerInfo,e=d.width,h=d.height,k=d.microBlockSize,c=d.imageType,l=b.getDataTypeSize(c),m=Math.ceil(e/k),p=Math.ceil(h/k);f.pixels.numBlocksY=p;f.pixels.numBlocksX=m;f.pixels.ptr=0;for(var z,x,D,v,B,C,F,H,J,w,G,E=new g(k*k),L=h%k||k,K=e%k||k,P=d.numDims,N,O=f.pixels.resultMask,Z=f.pixels.resultPixels,d=0;d<p;d++)for(v=d!==p-1?k:L,D=0;D<m;D++)for(B=D!==m-1?k:K,w=d*e*k+D*k,G=e-B,N=0;N<P;N++){1<P&&(Z=new g(f.pixels.resultPixels.buffer,e*h*N*l,e*h));C=a.byteLength-f.ptr;z=new DataView(a,f.ptr,Math.min(10,C));x={};C=0;F=z.getUint8(0);C++;H=F>>6&255;J=F>>2&15;if(J!==(D*k>>3&15))throw"integrity issue";F&=3;if(3<F)throw f.ptr+=C,"Invalid block encoding ("+F+")";if(2===F)f.counter.constant++,f.ptr+=C;else if(0===F){f.counter.uncompressed++;f.ptr+=C;C=v*B*l;z=a.byteLength-f.ptr;C=C<z?C:z;z=new ArrayBuffer(0===C%l?C:C+l-C%l);x=new Uint8Array(z);x.set(new Uint8Array(a,f.ptr,C));H=new g(z);C=0;if(O)for(z=0;z<v;z++){for(x=0;x<B;x++)O[w]&&(Z[w]=H[C++]),w++;w+=G}else for(z=0;z<v;z++){for(x=0;x<B;x++)Z[w++]=H[C++];w+=G}f.ptr+=C*l}else if(H=b.getDataTypeUsed(c,H),J=b.getOnePixel(x,C,H,z),C+=b.getDataTypeSize(H),3===F)if(f.ptr+=C,f.counter.constantoffset++,O)for(z=0;z<v;z++){for(x=0;x<B;x++)O[w]&&(Z[w]=J),w++;w+=G}else for(z=0;z<v;z++){for(x=0;x<B;x++)Z[w++]=J;w+=G}else if(f.ptr+=C,b.decodeBits(a,f,E,J,N),C=0,O)for(z=0;z<v;z++){for(x=0;x<B;x++)O[w]&&(Z[w]=E[C++]),w++;w+=G}else for(z=0;z<v;z++){for(x=0;x<B;x++)Z[w++]=E[C++];w+=G}}},formatFileInfo:function(a){return{fileIdentifierString:a.headerInfo.fileIdentifierString,fileVersion:a.headerInfo.fileVersion,imageType:a.headerInfo.imageType,height:a.headerInfo.height,width:a.headerInfo.width,numValidPixel:a.headerInfo.numValidPixel,microBlockSize:a.headerInfo.microBlockSize,blobSize:a.headerInfo.blobSize,maxZError:a.headerInfo.maxZError,pixelType:b.getPixelType(a.headerInfo.imageType),eofOffset:a.eofOffset,mask:a.mask?{numBytes:a.mask.numBytes}:null,pixels:{numBlocksX:a.pixels.numBlocksX,numBlocksY:a.pixels.numBlocksY,maxValue:a.headerInfo.zMax,minValue:a.headerInfo.zMin,noDataValue:a.noDataValue}}},constructConstantSurface:function(a){var b=a.headerInfo.zMax,e=a.headerInfo.numDims,d=a.headerInfo.height*a.headerInfo.width,f=d*e,g,k,c=a.pixels.resultMask;if(c)if(1<e)for(f=0;f<e;f++)for(k=f*d,g=0;g<d;g++)c[g]&&(a.pixels.resultPixels[k+g]=b);else for(g=0;g<d;g++)c[g]&&(a.pixels.resultPixels[g]=b);else if(a.pixels.resultPixels.fill)a.pixels.resultPixels.fill(b);else for(g=0;g<f;g++)a.pixels.resultPixels[g]=b},getDataTypeArray:function(a){switch(a){case 0:a=Int8Array;break;case 1:a=Uint8Array;break;case 2:a=Int16Array;break;case 3:a=Uint16Array;break;case 4:a=Int32Array;break;case 5:a=Uint32Array;break;case 6:a=Float32Array;break;case 7:a=Float64Array;break;default:a=Float32Array}return a},getPixelType:function(a){switch(a){case 0:a="S8";break;case 1:a="U8";break;case 2:a="S16";break;case 3:a="U16";break;case 4:a="S32";break;case 5:a="U32";break;case 6:a="F32";break;case 7:a="F64";break;default:a="F32"}return a},isValidPixelValue:function(a,b){if(null===b)return!1;var e;switch(a){case 0:e=-128<=b&&127>=b;break;case 1:e=0<=b&&255>=b;break;case 2:e=-32768<=b&&32767>=b;break;case 3:e=0<=b&&65536>=b;break;case 4:e=-2147483648<=b&&2147483647>=b;break;case 5:e=0<=b&&4294967296>=b;break;case 6:e=-3.4027999387901484E38<=b&&3.4027999387901484E38>=b;break;case 7:e=4.9E-324<=b&&1.7976931348623157E308>=b;break;default:e=!1}return e},getDataTypeSize:function(a){switch(a){case 0:case 1:a=1;break;case 2:case 3:a=2;break;case 4:case 5:case 6:a=4;break;case 7:a=8}return a},getDataTypeUsed:function(a,b){var e;switch(a){case 2:case 4:e=a-b;break;case 3:case 5:e=a-2*b;break;case 6:e=0===b?a:1===b?2:1;break;case 7:e=0===b?a:a-2*b+1;break;default:e=a}return e},getOnePixel:function(a,b,f,d){switch(f){case 0:a=d.getInt8(b);break;case 1:a=d.getUint8(b);break;case 2:a=d.getInt16(b,!0);break;case 3:a=d.getUint16(b,!0);break;case 4:a=d.getInt32(b,!0);break;case 5:a=d.getUInt32(b,!0);break;case 6:a=d.getFloat32(b,!0);break;case 7:a=d.getFloat64(b,!0);break;default:throw"the decoder does not understand this pixel type";}return a}},f=function(a,b,f){this.val=a;this.left=b;this.right=f};return{decode:function(a,f){f=f||{};var e=f.noDataValue,d,g={};g.ptr=f.inputOffset||0;g.pixels={};if(b.readHeaderInfo(a,g)){d=g.headerInfo;var h=d.fileVersion,k=b.getDataTypeArray(d.imageType);b.readMask(a,g);d.numValidPixel===d.width*d.height||g.pixels.resultMask||(g.pixels.resultMask=f.maskData);var c=d.width*d.height;g.pixels.resultPixels=new k(c*d.numDims);g.counter={onesweep:0,uncompressed:0,lut:0,bitstuffer:0,constant:0,constantoffset:0};if(0!==d.numValidPixel)if(d.zMax===d.zMin)b.constructConstantSurface(g);else if(4<=h&&b.checkMinMaxRanges(a,g))b.constructConstantSurface(g);else{var l=new DataView(a,g.ptr,2),m=l.getUint8(0);g.ptr++;if(m)b.readDataOneSweep(a,g,k);else if(1<h&&1>=d.imageType&&1E-5>Math.abs(d.maxZError-.5)){l=l.getUint8(1);g.ptr++;g.encodeMode=l;if(2<l||4>h&&1<l)throw"Invalid Huffman flag "+l;l?b.readHuffman(a,g,k):b.readTiles(a,g,k)}else b.readTiles(a,g,k)}g.eofOffset=g.ptr;f.inputOffset?(h=g.headerInfo.blobSize+f.inputOffset-g.ptr,1<=Math.abs(h)&&(g.eofOffset=f.inputOffset+g.headerInfo.blobSize)):(h=g.headerInfo.blobSize-g.ptr,1<=Math.abs(h)&&(g.eofOffset=g.headerInfo.blobSize));h={width:d.width,height:d.height,pixelData:g.pixels.resultPixels,minValue:d.zMin,maxValue:d.zMax,validPixelCount:d.numValidPixel,dimCount:d.numDims,dimStats:{minValues:d.minValues,maxValues:d.maxValues},maskData:g.pixels.resultMask};if(g.pixels.resultMask&&b.isValidPixelValue(d.imageType,e)){k=g.pixels.resultMask;for(d=0;d<c;d++)k[d]||(h.pixelData[d]=e);h.noDataValue=e}g.noDataValue=e;f.returnFileInfo&&(h.fileInfo=b.formatFileInfo(g));return h}},getBandCount:function(a){for(var e=0,f=0,d={ptr:0,pixels:{}};f<a.byteLength-58;)b.readHeaderInfo(a,d),f+=d.headerInfo.blobSize,e++,d.ptr=f;return e}}}(),f=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a);(new Uint32Array(a))[0]=1;return 1===b[0]}(),k={decode:function(g,k){if(!f)throw"Big endian system is not supported.";k=k||{};var l=k.inputOffset||0,e=new Uint8Array(g,l,10),e=String.fromCharCode.apply(null,e),h,p;if("CntZImage"===e.trim())h=b,p=1;else if("Lerc2"===e.substring(0,5))h=a,p=2;else throw"Unexpected file identifier string: "+e;for(var d=0,q=g.byteLength-10,t,e=[],r,c={width:0,height:0,pixels:[],pixelType:k.pixelType,mask:null,statistics:[]};l<q;){var u=h.decode(g,{inputOffset:l,encodedMaskData:t,maskData:r,returnMask:0===d?!0:!1,returnEncodedMask:0===d?!0:!1,returnFileInfo:!0,pixelType:k.pixelType||null,noDataValue:k.noDataValue||null}),l=u.fileInfo.eofOffset;0===d&&(t=u.encodedMaskData,r=u.maskData,c.width=u.width,c.height=u.height,c.dimCount=u.dimCount||1,c.pixelType=u.pixelType||u.fileInfo.pixelType,c.mask=u.maskData);1<p&&u.fileInfo.mask&&0<u.fileInfo.mask.numBytes&&e.push(u.maskData);d++;c.pixels.push(u.pixelData);c.statistics.push({minValue:u.minValue,maxValue:u.maxValue,noDataValue:u.noDataValue,dimStats:u.dimStats})}if(1<p&&1<e.length){p=c.width*c.height;c.bandMasks=e;r=new Uint8Array(p);r.set(e[0]);for(t=1;t<e.length;t++)for(l=e[t],h=0;h<p;h++)r[h]&=l[h];c.maskData=r}return c}};"function"===typeof F&&F.amd?F("ThirdParty/LercDecode",[],function(){return k}):"undefined"!==typeof module&&module.exports?module.exports=k:this.Lerc=k})();(function(b,a){"function"===typeof F&&F.amd?F("ThirdParty/NoSleep",[],a):"object"===typeof exports?exports.NoSleep=a():b.NoSleep=a()})(this,function(){return function(b){function a(k){if(f[k])return f[k].exports;var g=f[k]={i:k,l:!1,exports:{}};b[k].call(g.exports,g,g.exports,a);g.l=!0;return g.exports}var f={};a.m=b;a.c=f;a.d=function(b,f,l){a.o(b,f)||Object.defineProperty(b,f,{configurable:!1,enumerable:!0,get:l})};a.n=function(b){var f=b&&b.__esModule?function(){return b["default"]}:function(){return b};a.d(f,"a",f);return f};a.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};a.p="";return a(a.s=0)}([function(b,a,f){var k=function(){function a(a,b){for(var e=0;e<b.length;e++){var d=b[e];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,f,g){f&&a(b.prototype,f);g&&a(b,g);return b}}(),g=f(1),l="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream;a=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");l?this.noSleepTimer=null:(this.noSleepVideo=document.createElement("video"),this.noSleepVideo.setAttribute("playsinline",""),this.noSleepVideo.setAttribute("src",g),this.noSleepVideo.addEventListener("timeupdate",function(a){.5<this.noSleepVideo.currentTime&&(this.noSleepVideo.currentTime=Math.random())}.bind(this)))}k(a,[{key:"enable",value:function(){l?(this.disable(),this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15E3)):this.noSleepVideo.play()}},{key:"disable",value:function(){l?this.noSleepTimer&&(window.clearInterval(this.noSleepTimer),this.noSleepTimer=null):this.noSleepVideo.pause()}}]);return a}();b.exports=a},function(b,a,f){b.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA\x3d"}])});F("Widgets/ClockViewModel","../Core/Clock ../Core/defined ../Core/defineProperties ../Core/destroyObject ../Core/EventHelper ../Core/JulianDate ../ThirdParty/knockout".split(" "),function(b,a,f,k,g,l,m){function e(e){a(e)||(e=new b);this._clock=e;this._eventHelper=new g;this._eventHelper.add(e.onTick,this.synchronize,this);this.systemTime=m.observable(l.now());this.systemTime.equalityComparer=l.equals;this.startTime=m.observable(e.startTime);this.startTime.equalityComparer=l.equals;this.startTime.subscribe(function(a){e.startTime=a;this.synchronize()},this);this.stopTime=m.observable(e.stopTime);this.stopTime.equalityComparer=l.equals;this.stopTime.subscribe(function(a){e.stopTime=a;this.synchronize()},this);this.currentTime=m.observable(e.currentTime);this.currentTime.equalityComparer=l.equals;this.currentTime.subscribe(function(a){e.currentTime=a;this.synchronize()},this);this.multiplier=m.observable(e.multiplier);this.multiplier.subscribe(function(a){e.multiplier=a;this.synchronize()},this);this.clockStep=m.observable(e.clockStep);this.clockStep.subscribe(function(a){e.clockStep=a;this.synchronize()},this);this.clockRange=m.observable(e.clockRange);this.clockRange.subscribe(function(a){e.clockRange=a;this.synchronize()},this);this.canAnimate=m.observable(e.canAnimate);this.canAnimate.subscribe(function(a){e.canAnimate=a;this.synchronize()},this);this.shouldAnimate=m.observable(e.shouldAnimate);this.shouldAnimate.subscribe(function(a){e.shouldAnimate=a;this.synchronize()},this);m.track(this,"systemTime startTime stopTime currentTime multiplier clockStep clockRange canAnimate shouldAnimate".split(" "))}f(e.prototype,{clock:{get:function(){return this._clock}}});e.prototype.synchronize=function(){var a=this._clock;this.systemTime=l.now();this.startTime=a.startTime;this.stopTime=a.stopTime;this.currentTime=a.currentTime;this.multiplier=a.multiplier;this.clockStep=a.clockStep;this.clockRange=a.clockRange;this.canAnimate=a.canAnimate;this.shouldAnimate=a.shouldAnimate};e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){this._eventHelper.removeAll();k(this)};return e});F("Widgets/Command",["../Core/DeveloperError"],function(b){return function(){this.afterExecute=this.beforeExecute=this.canExecute=void 0;b.throwInstantiationError()}});F("Widgets/createCommand","../Core/defaultValue ../Core/defined ../Core/defineProperties ../Core/DeveloperError ../Core/Event ../ThirdParty/knockout".split(" "),function(b,a,f,k,g,l){return function(m,e){function h(){if(!h.canExecute)throw new k("Cannot execute command, canExecute is false.");var a={args:arguments,cancel:!1},b;p.raiseEvent(a);a.cancel||(b=m.apply(null,arguments),d.raiseEvent(b));return b}if(!a(m))throw new k("func is required.");e=b(e,!0);var p=new g,d=new g;h.canExecute=e;l.track(h,["canExecute"]);f(h,{beforeExecute:{value:p},afterExecute:{value:d}});return h}});F("Widgets/InspectorShared",["../Core/defined","../Core/Check"],function(b,a){return{createCheckbox:function(f,k,g){a.typeOf.string("labelText",f);a.typeOf.string("checkedBinding",k);var l=document.createElement("div"),m=document.createElement("label"),e=document.createElement("input");e.type="checkbox";k="checked: "+k;b(g)&&(k+=", enable: "+g);e.setAttribute("data-bind",k);m.appendChild(e);m.appendChild(document.createTextNode(f));l.appendChild(m);return l},createSection:function(b,k,g,l){a.defined("panel",b);a.typeOf.string("headerText",k);a.typeOf.string("sectionVisibleBinding",g);a.typeOf.string("toggleSectionVisibilityBinding",l);var f=document.createElement("div");f.className="cesium-cesiumInspector-section";f.setAttribute("data-bind",'css: { "cesium-cesiumInspector-section-collapsed": !'+g+" }");b.appendChild(f);b=document.createElement("h3");b.className="cesium-cesiumInspector-sectionHeader";b.appendChild(document.createTextNode(k));b.setAttribute("data-bind","click: "+l);f.appendChild(b);k=document.createElement("div");k.className="cesium-cesiumInspector-sectionContent";f.appendChild(k);return k}}});F("Widgets/subscribeAndEvaluate",["../ThirdParty/knockout"],function(b){return function(a,f,k,g,l){k.call(g,a[f]);return b.getObservable(a,f).subscribe(k,g,l)}});F("Widgets/ToggleButtonViewModel",["../Core/defaultValue","../Core/defined","../Core/defineProperties","../Core/DeveloperError","../ThirdParty/knockout"],function(b,a,f,k,g){function l(f,e){if(!a(f))throw new k("command is required.");this._command=f;e=b(e,b.EMPTY_OBJECT);this.toggled=b(e.toggled,!1);this.tooltip=b(e.tooltip,"");g.track(this,["toggled","tooltip"])}f(l.prototype,{command:{get:function(){return this._command}}});return l});F("FeDataSources/conicalRadar/ConicalRadarGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._headingPitchRoll=this._modelMatrix=this._outlineColor=this._color=this._offset=this._openingAngle=this._backScannerRadius=this._frontScannerRadius=this._material=this._height=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}g(r.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:t("show"),material:q("material"),height:t("height"),frontScannerRadius:t("frontScannerRadius"),backScannerRadius:t("backScannerRadius"),openingAngle:t("openingAngle"),color:t("color"),offset:t("offset"),outlineColor:t("outlineColor"),modelMatrix:t("modelMatrix"),headingPitchRoll:t("headingPitchRoll")});r.prototype.clone=function(b){a(b)||(b=new r);b.show=this.show;b.material=this.material;b.height=this.height;b.frontScannerRadius=this.frontScannerRadius;b.backScannerRadius=this.backScannerRadius;b.openingAngle=this.openingAngle;b.offset=this.offset;b.color=this.color;b.outlineColor=this.outlineColor;b.modelMatrix=this.modelMatrix;b.headingPitchRoll=this.headingPitchRoll;return b};r.prototype.merge=function(c){if(!a(c))throw new l("source is required.");this.show=b(this.show,c.show);this.material=b(this.material,c.material);this.height=b(this.height,c.height);this.frontScannerRadius=b(this.frontScannerRadius,c.frontScannerRadius);this.backScannerRadius=b(this.backScannerRadius,c.backScannerRadius);this.openingAngle=b(this.openingAngle,c.openingAngle);this.color=b(this.color,c.color);this.offset=b(this.offset,c.offset);this.outlineColor=b(this.outlineColor,c.outlineColor);this.modelMatrix=b(this.modelMatrix,c.modelMatrix);this.headingPitchRoll=b(this.headingPitchRoll,c.headingPitchRoll)};return r});F("FeDataSources/conicSensor/RectangularSensorGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._scanDir=this._scanPlaneRate=this._scanPlaneMode=this._scanPlaneColor=this._showScanPlane=this._gaze=this._showThroughEllipsoid=this._intersectionWidth=this._intersectionColor=this._showIntersection=this._showDomeLines=this._showDomeSurfaces=this._material=this._showLateralSurfaces=this._showSectorSegmentLines=this._showSectorLines=this._lineColor=this._yHalfAngle=this._xHalfAngle=this._radius=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}g(r.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:t("show"),radius:t("radius"),xHalfAngle:t("xHalfAngle"),yHalfAngle:t("yHalfAngle"),lineColor:t("lineColor"),showSectorLines:t("showSectorLines"),showSectorSegmentLines:t("showSectorSegmentLines"),showLateralSurfaces:t("showLateralSurfaces"),material:q("material"),showDomeSurfaces:t("showDomeSurfaces"),showDomeLines:t("showDomeLines "),showIntersection:t("showIntersection"),intersectionColor:t("intersectionColor"),intersectionWidth:t("intersectionWidth"),showThroughEllipsoid:t("showThroughEllipsoid"),gaze:t("gaze"),showScanPlane:t("showScanPlane"),scanPlaneColor:t("scanPlaneColor"),scanPlaneMode:t("scanPlaneMode"),scanPlaneRate:t("scanPlaneRate"),scanDir:t("scanDir")});r.prototype.clone=function(b){a(b)||(b=new r);b.show=this.show;b.radius=this.radius;b.xHalfAngle=this.xHalfAngle;b.yHalfAngle=this.yHalfAngle;b.lineColor=this.lineColor;b.showSectorLines=this.showSectorLines;b.showSectorSegmentLines=this.showSectorSegmentLines;b.showLateralSurfaces=this.showLateralSurfaces;b.material=this.material;b.showDomeSurfaces=this.showDomeSurfaces;b.showDomeLines=this.showDomeLines;b.showIntersection=this.showIntersection;b.intersectionColor=this.intersectionColor;b.intersectionWidth=this.intersectionWidth;b.showThroughEllipsoid=this.showThroughEllipsoid;b.gaze=this.gaze;b.showScanPlane=this.showScanPlane;b.scanPlaneColor=this.scanPlaneColor;b.scanPlaneMode=this.scanPlaneMode;b.scanPlaneRate=this.scanPlaneRate;b.scanDir=this.scanDir;return b};r.prototype.merge=function(c){if(!a(c))throw new l("source is required.");this.show=b(this.show,c.show);this.radius=b(this.radius,c.radius);this.xHalfAngle=b(this.xHalfAngle,c.xHalfAngle);this.yHalfAngle=b(this.yHalfAngle,c.yHalfAngle);this.lineColor=b(this.lineColor,c.lineColor);this.showSectorLines=b(this.showSectorLines,c.showSectorLines);this.showSectorSegmentLines=b(this.showSectorSegmentLines,c.showSectorSegmentLines);this.showLateralSurfaces=b(this.showLateralSurfaces,c.showLateralSurfaces);this.material=b(this.material,c.material);this.showDomeSurfaces=b(this.showDomeSurfaces,c.showDomeSurfaces);this.showDomeLines=b(this.showDomeLines,c.showDomeLines);this.showIntersection=b(this.showIntersection,c.showIntersection);this.intersectionColor=b(this.intersectionColor,c.intersectionColor);this.intersectionWidth=b(this.intersectionWidth,c.intersectionWidth);this.showThroughEllipsoid=b(this.showThroughEllipsoid,c.showThroughEllipsoid);this.gaze=b(this.gaze,c.gaze);this.showScanPlane=b(this.showScanPlane,c.showScanPlane);this.scanPlaneColor=b(this.scanPlaneColor,c.scanPlaneColor);this.scanPlaneMode=b(this.scanPlaneMode,c.scanPlaneMode);this.scanPlaneRate=b(this.scanPlaneRate,c.scanPlaneRate);this.scanDir=b(this.scanDir,c.scanDir)};return r});F("FeDataSources/ParabolaRadar/ParabolaRadarGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._headingPitchRoll=this._modelMatrix=this._outlineColor=this._scanningRate=this.offset=this._alphaFactor=this._color=this._scannerColor=this._verticalLineCount=this._horizontalLineCount=this._parabolaRadius=this._material=this._parabolaHeight=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}g(r.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:t("show"),material:q("material"),parabolaHeight:t("parabolaHeight"),parabolaRadius:t("parabolaRadius"),horizontalLineCount:t("horizontalLineCount"),verticalLineCount:t("verticalLineCount"),scannerColor:t("scannerColor"),offset:t("offset"),color:t("color"),alphaFactor:t("alphaFactor"),scanningRate:t("scanningRate"),outlineColor:t("outlineColor"),modelMatrix:t("modelMatrix"),headingPitchRoll:t("headingPitchRoll")});r.prototype.clone=function(b){a(b)||(b=new r);b.show=this.show;b.material=this.material;b.parabolaHeight=this.parabolaHeight;b.parabolaRadius=this.parabolaRadius;b.horizontalLineCount=this.horizontalLineCount;b.verticalLineCount=this.verticalLineCount;b.scannerColor=this.scannerColor;b.color=this.color;b.alphaFactor=this.alphaFactor;b.scanningRate=this.scanningRate;b.offset=this.offset;b.outlineColor=this.outlineColor;b.modelMatrix=this.modelMatrix;b.headingPitchRoll=this.headingPitchRoll;return b};r.prototype.merge=function(c){if(!a(c))throw new l("source is required.");this.show=b(this.show,c.show);this.material=b(this.material,c.material);this.parabolaHeight=b(this.parabolaHeight,c.parabolaHeight);this.parabolaRadius=b(this.parabolaRadius,c.parabolaRadius);this.horizontalLineCount=b(this.horizontalLineCount,c.horizontalLineCount);this.verticalLineCount=b(this.verticalLineCount,c.verticalLineCount);this.scannerColor=b(this.scannerColor,c.scannerColor);this.color=b(this.color,c.color);this.alphaFactor=b(this.alphaFactor,c.alphaFactor);this.offset=b(this.offset,c.offset);this.scanningRate=b(this.scanningRate,c.scanningRate);this.outlineColor=b(this.outlineColor,c.outlineColor);this.modelMatrix=b(this.modelMatrix,c.modelMatrix);this.headingPitchRoll=b(this.headingPitchRoll,c.headingPitchRoll)};return r});F("FeDataSources/Ribbon/RibbonGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/defineProperties ../../Core/DeveloperError ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m){function e(a){this._minAlpha=this._maxAlpha=this._offset=this._deleteNum=this._fadeSpeed=this._width=this._rotation=this._maxVerticeNum=this._color=this._positions=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}k(e.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:m("show"),positions:m("positions"),color:m("color"),maxVerticeNum:m("maxVerticeNum"),rotation:m("rotation"),width:m("width"),fadeSpeed:m("fadeSpeed"),deleteNum:m("deleteNum"),offset:m("offset"),maxAlpha:m("maxAlpha"),minAlpha:m("minAlpha")});e.prototype.clone=function(b){a(b)||(b=new e);b.show=this.show;b.positions=this.positions;b.color=this.color;b.maxVerticeNum=this.maxVerticeNum;b.rotation=this.rotation;b.width=this.width;b.fadeSpeed=this.fadeSpeed;b.offset=this.offset;b.maxAlpha=this.maxAlpha;b.minAlpha=this.minAlpha;return b};e.prototype.merge=function(e){if(!a(e))throw new g("source is required.");this.show=b(this.show,e.show);this.positions=b(this.positions,e.positions);this.color=b(this.color,e.color);this.maxVerticeNum=b(this.maxVerticeNum,e.maxVerticeNum);this.rotation=b(this.rotation,e.rotation);this.width=b(this.width,e.width);this.fadeSpeed=b(this.fadeSpeed,e.fadeSpeed);this.deleteNum=b(this.deleteNum,e.deleteNum);this.offset=b(this.offset,e.offset);this.maxAlpha=b(this.maxAlpha,e.maxAlpha);this.minAlpha=b(this.minAlpha,e.minAlpha)};return e});F("FeDataSources/RingconeScanner/RingconeGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._headingPitchRoll=this._modelMatrix=this._outlineColor=this._offset=this._color=this._aftExclusionAngle=this._forwordExclusionAngle=this._maxElevationAngle=this._minElevationAngle=this._maxElevationAngle=this._height=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}g(r.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:t("show"),height:t("height"),material:q("material"),maxElevationAngle:t("maxElevationAngle"),minElevationAngle:t("minElevationAngle"),forwordExclusionAngle:t("forwordExclusionAngle"),aftExclusionAngle:t("aftExclusionAngle"),maxEllipsoidRadii:t("maxEllipsoidRadii"),color:t("color"),offset:t("offset"),outlineColor:t("outlineColor"),modelMatrix:t("modelMatrix"),headingPitchRoll:t("headingPitchRoll")});r.prototype.clone=function(b){a(b)||(b=new r);b.show=this.show;b.material=this.material;b.height=this.height;b.maxElevationAngle=this.maxElevationAngle;b.minElevationAngle=this.minElevationAngle;b.forwordExclusionAngle=this.forwordExclusionAngle;b.aftExclusionAngle=this.aftExclusionAngle;b.maxEllipsoidRadii=this.maxEllipsoidRadii;b.color=this.color;b.offset=this.offset;b.outlineColor=this.outlineColor;b.modelMatrix=this.modelMatrix;b.headingPitchRoll=this.headingPitchRoll;return b};r.prototype.merge=function(c){if(!a(c))throw new l("source is required.");this.show=b(this.show,c.show);this.material=b(this.material,c.material);this.height=b(this.height,c.height);this.maxElevationAngle=b(this.maxElevationAngle,c.maxElevationAngle);this.minElevationAngle=b(this.minElevationAngle,c.minElevationAngle);this.aftExclusionAngle=b(this.aftExclusionAngle,c.aftExclusionAngle);this.forwordExclusionAngle=b(this.forwordExclusionAngle,c.forwordExclusionAngle);this.maxEllipsoidRadii=b(this.maxEllipsoidRadii,c.maxEllipsoidRadii);this.color=b(this.color,c.color);this.offset=b(this.offset,c.offset);this.outlineColor=b(this.outlineColor,c.outlineColor);this.modelMatrix=b(this.modelMatrix,c.modelMatrix);this.headingPitchRoll=b(this.headingPitchRoll,c.headingPitchRoll)};return r});F("FeDataSources/RingRadar/RingRadarGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._headingPitchRoll=this._modelMatrix=this._outlineColor=this._scanningRate=this._scannerColor=this._offset=this._color=this._planeSurfaceLineCount=this._sphericalSurfaceLineCount=this._bottomRadius=this._sphericalRadius=this._material=this._radarHeight=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}g(r.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:t("show"),material:q("material"),radarHeight:t("radarHeight"),sphericalRadius:t("sphericalRadius"),bottomRadius:t("bottomRadius"),sphericalSurfaceLineCount:t("sphericalSurfaceLineCount"),planeSurfaceLineCount:t("planeSurfaceLineCount"),scanningRate:t("scanningRate"),scannerColor:t("scannerColor"),color:t("color"),offset:t("offset"),outlineColor:t("outlineColor"),modelMatrix:t("modelMatrix"),headingPitchRoll:t("headingPitchRoll")});r.prototype.clone=function(b){a(b)||(b=new r);b.show=this.show;b.material=this.material;b.radarHeight=this.radarHeight;b.sphericalRadius=this.sphericalRadius;b.bottomRadius=this.bottomRadius;b.sphericalSurfaceLineCount=this.sphericalSurfaceLineCount;b.planeSurfaceLineCount=this.planeSurfaceLineCount;b.scannerColor=this.scannerColor;b.scanningRate=this.scanningRate;b.color=this.color;b.offset=this.offset;b.outlineColor=this.outlineColor;b.modelMatrix=this.modelMatrix;b.headingPitchRoll=this.headingPitchRoll;return b};r.prototype.merge=function(c){if(!a(c))throw new l("source is required.");this.show=b(this.show,c.show);this.material=b(this.material,c.material);this.radarHeight=b(this.radarHeight,c.radarHeight);this.sphericalRadius=b(this.sphericalRadius,c.sphericalRadius);this.bottomRadius=b(this.bottomRadius,c.bottomRadius);this.sphericalSurfaceLineCount=b(this.sphericalSurfaceLineCount,c.sphericalSurfaceLineCount);this.planeSurfaceLineCount=b(this.planeSurfaceLineCount,c.planeSurfaceLineCount);this.scannerColor=b(this.scannerColor,c.scannerColor);this.scanningRate=b(this.scanningRate,c.scanningRate);this.color=b(this.color,c.color);this.offset=b(this.offset,c.offset);this.outlineColor=b(this.outlineColor,c.outlineColor);this.modelMatrix=b(this.modelMatrix,c.modelMatrix);this.headingPitchRoll=b(this.headingPitchRoll,c.headingPitchRoll)};return r});F("FeDataSources/SquareconeScanner/SquareconeGraphics","../../Core/defaultValue ../../Core/defined ../../Core/Event ../../Core/AssociativeArray ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Cartesian3 ../../Core/Quaternion ../../Core/Matrix3 ../../Core/Matrix4 ../../Core/destroyObject ../../DataSources/createMaterialPropertyDescriptor ../../DataSources/createPropertyDescriptor".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t){function r(a){this._headingPitchRoll=this._modelMatrix=this._outlineColor=this._offset=this._color=this._maxEllipsoidRadii=this._rectangleHeight=this._verticalAngle=this._horizontalAngle=this._material=this._height=this._show=void 0;this._definitionChanged=new f;this.merge(b(a,b.EMPTY_OBJECT))}g(r.prototype,{definitionChanged:{get:function(){return this._definitionChanged}},show:t("show"),material:q("material"),height:t("height"),horizontalAngle:t("horizontalAngle"),verticalAngle:t("verticalAngle"),rectangleHeight:t("rectangleHeight"),maxEllipsoidRadii:t("maxEllipsoidRadii"),color:t("color"),offset:t("offset"),outlineColor:t("outlineColor"),modelMatrix:t("modelMatrix"),headingPitchRoll:t("headingPitchRoll")});r.prototype.clone=function(b){a(b)||(b=new r);b.show=this.show;b.material=this.material;b.height=this.height;b.horizontalAngle=this.horizontalAngle;b.verticalAngle=this.verticalAngle;b.rectangleHeight=this.rectangleHeight;b.maxEllipsoidRadii=this.maxEllipsoidRadii;b.color=this.color;b.offset=this.offset;b.outlineColor=this.outlineColor;b.modelMatrix=this.modelMatrix;b.headingPitchRoll=this.headingPitchRoll;return b};r.prototype.merge=function(c){if(!a(c))throw new l("source is required.");this.show=b(this.show,c.show);this.material=b(this.material,c.material);this.height=b(this.height,c.height);this.horizontalAngle=b(this.horizontalAngle,c.horizontalAngle);this.verticalAngle=b(this.verticalAngle,c.verticalAngle);this.rectangleHeight=b(this.rectangleHeight,c.rectangleHeight);this.maxEllipsoidRadii=b(this.maxEllipsoidRadii,c.maxEllipsoidRadii);this.color=b(this.color,c.color);this.offset=b(this.offset,c.offset);this.outlineColor=b(this.outlineColor,c.outlineColor);this.modelMatrix=b(this.modelMatrix,c.modelMatrix);this.headingPitchRoll=b(this.headingPitchRoll,c.headingPitchRoll)};return r});F("Widgets/Animation/Animation","../../Core/Color ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../getElement ../subscribeAndEvaluate".split(" "),function(b,a,f,k,g,l,m){function e(a){return b.fromCssColorString(window.getComputedStyle(a).getPropertyValue("color"))}function h(a){var b=document.createElementNS("http://www.w3.org/2000/svg",a.tagName),c;for(c in a)if(a.hasOwnProperty(c)&&"tagName"!==c)if("children"===c){var d,e=a.children.length;for(d=0;d<e;++d)b.appendChild(h(a.children[d]))}else 0===c.indexOf("xlink:")?b.setAttributeNS("http://www.w3.org/1999/xlink",c.substring(6),a[c]):"textContent"===c?b.textContent=a[c]:b.setAttribute(c,a[c]);return b}function p(a,b,c){var d=document.createElementNS("http://www.w3.org/2000/svg","text");d.setAttribute("x",a);d.setAttribute("y",b);d.setAttribute("class","cesium-animation-svgText");a=document.createElementNS("http://www.w3.org/2000/svg","tspan");a.textContent=c;d.appendChild(a);return d}function d(a,b){var c=b.alpha,d=1-c;C.red=a.red*d+b.red*c;C.green=a.green*d+b.green*c;C.blue=a.blue*d+b.blue*c;return C.toCssColorString()}function q(a,b,c){return h({tagName:"g","class":"cesium-animation-rectButton",transform:"translate("+a+","+b+")",children:[{tagName:"rect","class":"cesium-animation-buttonGlow",width:32,height:32,rx:2,ry:2},{tagName:"rect","class":"cesium-animation-buttonMain",width:32,height:32,rx:4,ry:4},{tagName:"use","class":"cesium-animation-buttonPath","xlink:href":c},{tagName:"title",textContent:""}]})}function t(a,b){this._viewModel=b;this.svgElement=a;this._toggled=this._enabled=void 0;var c=this;this._clickFunction=function(){var a=c._viewModel.command;a.canExecute&&a()};a.addEventListener("click",this._clickFunction,!0);this._subscriptions=[m(b,"toggled",this.setToggled,this),m(b,"tooltip",this.setTooltip,this),m(b.command,"canExecute",this.setEnabled,this)]}function r(b,d){function e(a){var b=D,d=b._viewModel,e=d.shuttleRingDragging;if(!e||c===b)if("mousedown"===a.type||e&&"mousemove"===a.type||"touchstart"===a.type&&1===a.touches.length||e&&"touchmove"===a.type&&1===a.touches.length){var f=b._centerX,g=b._centerY,h=b._svgNode.getBoundingClientRect(),k,l;"touchstart"===a.type||"touchmove"===a.type?(k=a.touches[0].clientX,l=a.touches[0].clientY):(k=a.clientX,l=a.clientY);if(e||!(k>h.right||k<h.left||l<h.top||l>h.bottom)){var m=b._shuttleRingPointer.getBoundingClientRect(),f=180*Math.atan2(l-g-h.top,k-f-h.left)/Math.PI+90;180<f&&(f-=360);g=d.shuttleRingAngle;e||k<m.right&&k>m.left&&l>m.top&&l<m.bottom?(c=b,d.shuttleRingDragging=!0,d.shuttleRingAngle=f):f<g?d.slower():f>g&&d.faster();a.preventDefault()}}else b===c&&(c=void 0),d.shuttleRingDragging=!1}if(!a(b))throw new g("container is required.");if(!a(d))throw new g("viewModel is required.");b=l(b);this._viewModel=d;this._container=b;this._centerY=this._centerX=0;this._lastWidth=this._lastHeight=this._topG=this._svgNode=this._defsElement=void 0;var f=document.createElement("style");f.textContent=".cesium-animation-rectButton .cesium-animation-buttonGlow { filter: url(#animation_blurred); }.cesium-animation-rectButton .cesium-animation-buttonMain { fill: url(#animation_buttonNormal); }.cesium-animation-buttonToggled .cesium-animation-buttonMain { fill: url(#animation_buttonToggled); }.cesium-animation-rectButton:hover .cesium-animation-buttonMain { fill: url(#animation_buttonHovered); }.cesium-animation-buttonDisabled .cesium-animation-buttonMain { fill: url(#animation_buttonDisabled); }.cesium-animation-shuttleRingG .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshGradient); }.cesium-animation-shuttleRingG:hover .cesium-animation-shuttleRingSwoosh { fill: url(#animation_shuttleRingSwooshHovered); }.cesium-animation-shuttleRingPointer { fill: url(#animation_shuttleRingPointerGradient); }.cesium-animation-shuttleRingPausePointer { fill: url(#animation_shuttleRingPointerPaused); }.cesium-animation-knobOuter { fill: url(#animation_knobOuter); }.cesium-animation-knobInner { fill: url(#animation_knobInner); }";document.head.insertBefore(f,document.head.childNodes[0]);f=document.createElement("div");f.className="cesium-animation-theme";f.innerHTML='\x3cdiv class\x3d"cesium-animation-themeNormal"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themeHover"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themeSelect"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themeDisabled"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themeKnob"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themePointer"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themeSwoosh"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-animation-themeSwooshHover"\x3e\x3c/div\x3e';this._theme=f;this._themeNormal=f.childNodes[0];this._themeHover=f.childNodes[1];this._themeSelect=f.childNodes[2];this._themeDisabled=f.childNodes[3];this._themeKnob=f.childNodes[4];this._themePointer=f.childNodes[5];this._themeSwoosh=f.childNodes[6];this._themeSwooshHover=f.childNodes[7];var k=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");this._svgNode=k;k.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink");var r=document.createElementNS("http://www.w3.org/2000/svg","g");this._topG=r;this._realtimeSVG=new t(h({tagName:"g","class":"cesium-animation-rectButton",transform:"translate(3,4)",children:[{tagName:"use","class":"cesium-animation-buttonGlow","xlink:href":"#animation_pathWingButton"},{tagName:"use","class":"cesium-animation-buttonMain","xlink:href":"#animation_pathWingButton"},{tagName:"use","class":"cesium-animation-buttonPath","xlink:href":"#animation_pathClock"},{tagName:"title",textContent:""}]}),d.playRealtimeViewModel);this._playReverseSVG=new t(q(44,99,"#animation_pathPlayReverse"),d.playReverseViewModel);this._playForwardSVG=new t(q(124,99,"#animation_pathPlay"),d.playForwardViewModel);this._pauseSVG=new t(q(84,99,"#animation_pathPause"),d.pauseViewModel);var u=document.createElementNS("http://www.w3.org/2000/svg","g");u.appendChild(this._realtimeSVG.svgElement);u.appendChild(this._playReverseSVG.svgElement);u.appendChild(this._playForwardSVG.svgElement);u.appendChild(this._pauseSVG.svgElement);var v=h({tagName:"circle","class":"cesium-animation-shuttleRingBack",cx:100,cy:100,r:99});this._shuttleRingBackPanel=v;var y=h({tagName:"g","class":"cesium-animation-shuttleRingSwoosh",children:[{tagName:"use",transform:"translate(100,97) scale(-1,1)","xlink:href":"#animation_pathSwooshFX"},{tagName:"use",transform:"translate(100,97)","xlink:href":"#animation_pathSwooshFX"},{tagName:"line",x1:100,y1:8,x2:100,y2:22}]});this._shuttleRingSwooshG=y;this._shuttleRingPointer=h({tagName:"use","class":"cesium-animation-shuttleRingPointer","xlink:href":"#animation_pathPointer"});var z=h({tagName:"g",transform:"translate(100,100)"});this._knobOuter=h({tagName:"circle","class":"cesium-animation-knobOuter",cx:0,cy:0,r:71});var A=h({tagName:"circle","class":"cesium-animation-knobInner",cx:0,cy:0,r:61});this._knobDate=p(0,-24,"");this._knobTime=p(0,-7,"");this._knobStatus=p(0,-41,"");var B=h({tagName:"circle","class":"cesium-animation-blank",cx:0,cy:0,r:61}),C=document.createElementNS("http://www.w3.org/2000/svg","g");C.setAttribute("class","cesium-animation-shuttleRingG");b.appendChild(f);r.appendChild(C);r.appendChild(z);r.appendChild(u);C.appendChild(v);C.appendChild(y);C.appendChild(this._shuttleRingPointer);z.appendChild(this._knobOuter);z.appendChild(A);z.appendChild(this._knobDate);z.appendChild(this._knobTime);z.appendChild(this._knobStatus);z.appendChild(B);k.appendChild(r);b.appendChild(k);var D=this;this._mouseCallback=e;v.addEventListener("mousedown",e,!0);v.addEventListener("touchstart",e,!0);y.addEventListener("mousedown",e,!0);y.addEventListener("touchstart",e,!0);document.addEventListener("mousemove",e,!0);document.addEventListener("touchmove",e,!0);document.addEventListener("mouseup",e,!0);document.addEventListener("touchend",e,!0);document.addEventListener("touchcancel",e,!0);this._shuttleRingPointer.addEventListener("mousedown",e,!0);this._shuttleRingPointer.addEventListener("touchstart",e,!0);this._knobOuter.addEventListener("mousedown",e,!0);this._knobOuter.addEventListener("touchstart",e,!0);var x=this._knobTime.childNodes[0],F=this._knobDate.childNodes[0],H=this._knobStatus.childNodes[0],I;this._subscriptions=[m(d.pauseViewModel,"toggled",function(a){I!==a&&((I=a)?D._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPausePointer"):D._shuttleRingPointer.setAttribute("class","cesium-animation-shuttleRingPointer"))}),m(d,"shuttleRingAngle",function(a){var b=D._knobOuter;D._shuttleRingPointer.setAttribute("transform","translate(100,100) rotate("+a+")");b.setAttribute("transform","rotate("+a+")")}),m(d,"dateLabel",function(a){F.textContent!==a&&(F.textContent=a)}),m(d,"timeLabel",function(a){x.textContent!==a&&(x.textContent=a)}),m(d,"multiplierLabel",function(a){H.textContent!==a&&(H.textContent=a)})];this.applyThemeChanges();this.resize()}var c,u=b.fromCssColorString("rgba(247,250,255,0.384)"),y=b.fromCssColorString("rgba(143,191,255,0.216)"),A=b.fromCssColorString("rgba(153,197,255,0.098)"),z=b.fromCssColorString("rgba(255,255,255,0.086)"),x=b.fromCssColorString("rgba(255,255,255,0.267)"),D=b.fromCssColorString("rgba(255,255,255,0)"),v=b.fromCssColorString("rgba(66,67,68,0.3)"),B=b.fromCssColorString("rgba(0,0,0,0.5)"),C=new b;t.prototype.destroy=function(){this.svgElement.removeEventListener("click",this._clickFunction,!0);for(var a=this._subscriptions,b=0,c=a.length;b<c;b++)a[b].dispose();k(this)};t.prototype.isDestroyed=function(){return!1};t.prototype.setEnabled=function(a){this._enabled!==a&&((this._enabled=a)?this._toggled?this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"):this.svgElement.setAttribute("class","cesium-animation-rectButton"):this.svgElement.setAttribute("class","cesium-animation-buttonDisabled"))};t.prototype.setToggled=function(a){this._toggled!==a&&(this._toggled=a,this._enabled&&(a?this.svgElement.setAttribute("class","cesium-animation-rectButton cesium-animation-buttonToggled"):this.svgElement.setAttribute("class","cesium-animation-rectButton")))};t.prototype.setTooltip=function(a){this.svgElement.getElementsByTagName("title")[0].textContent=a};f(r.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){a(this._observer)&&(this._observer.disconnect(),this._observer=void 0);var b=this._mouseCallback;this._shuttleRingBackPanel.removeEventListener("mousedown",b,!0);this._shuttleRingBackPanel.removeEventListener("touchstart",b,!0);this._shuttleRingSwooshG.removeEventListener("mousedown",b,!0);this._shuttleRingSwooshG.removeEventListener("touchstart",b,!0);document.removeEventListener("mousemove",b,!0);document.removeEventListener("touchmove",b,!0);document.removeEventListener("mouseup",b,!0);document.removeEventListener("touchend",b,!0);document.removeEventListener("touchcancel",b,!0);this._shuttleRingPointer.removeEventListener("mousedown",b,!0);this._shuttleRingPointer.removeEventListener("touchstart",b,!0);this._knobOuter.removeEventListener("mousedown",b,!0);this._knobOuter.removeEventListener("touchstart",b,!0);this._container.removeChild(this._svgNode);this._container.removeChild(this._theme);this._realtimeSVG.destroy();this._playReverseSVG.destroy();this._playForwardSVG.destroy();this._pauseSVG.destroy();for(var b=this._subscriptions,c=0,d=b.length;c<d;c++)b[c].dispose();return k(this)};r.prototype.resize=function(){var a=this._container.clientWidth,b=this._container.clientHeight;if(a!==this._lastWidth||b!==this._lastHeight){var c=this._svgNode,d=a,e=b;0===a&&0===b?(d=200,e=132):0===a?(e=b,d=b/132*200):0===b&&(d=a,e=a/200*132);var f=d/200,g=e/132;c.style.cssText="width: "+d+"px; height: "+e+"px; position: absolute; bottom: 0; left: 0; overflow: hidden;";c.setAttribute("width",d);c.setAttribute("height",e);c.setAttribute("viewBox","0 0 "+d+" "+e);this._topG.setAttribute("transform","scale("+f+","+g+")");this._centerX=Math.max(1,100*f);this._centerY=Math.max(1,100*g);this._lastHeight=a;this._lastWidth=b}};r.prototype.applyThemeChanges=function(){if(document.body.contains(this._container)){var b=e(this._themeNormal),c=e(this._themeHover),f=e(this._themeSelect),g=e(this._themeDisabled),k=e(this._themeKnob),l=e(this._themePointer),m=e(this._themeSwoosh),p=e(this._themeSwooshHover),b=h({tagName:"defs",children:[{id:"animation_buttonNormal",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":d(b,u)},{tagName:"stop",offset:"12%","stop-color":d(b,y)},{tagName:"stop",offset:"46%","stop-color":d(b,A)},{tagName:"stop",offset:"81%","stop-color":d(b,z)}]},{id:"animation_buttonHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":d(c,u)},{tagName:"stop",offset:"12%","stop-color":d(c,y)},{tagName:"stop",offset:"46%","stop-color":d(c,A)},{tagName:"stop",offset:"81%","stop-color":d(c,z)}]},{id:"animation_buttonToggled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":d(f,u)},{tagName:"stop",offset:"12%","stop-color":d(f,y)},{tagName:"stop",offset:"46%","stop-color":d(f,A)},{tagName:"stop",offset:"81%","stop-color":d(f,z)}]},{id:"animation_buttonDisabled",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-color":d(g,x)},{tagName:"stop",offset:"75%","stop-color":d(g,D)}]},{id:"animation_blurred",tagName:"filter",width:"200%",height:"200%",x:"-50%",y:"-50%",children:[{tagName:"feGaussianBlur",stdDeviation:4,"in":"SourceGraphic"}]},{id:"animation_shuttleRingSwooshGradient",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":m.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":m.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":m.toCssColorString()}]},{id:"animation_shuttleRingSwooshHovered",tagName:"linearGradient",x1:"50%",y1:"0%",x2:"50%",y2:"100%",children:[{tagName:"stop",offset:"0%","stop-opacity":.2,"stop-color":p.toCssColorString()},{tagName:"stop",offset:"85%","stop-opacity":.85,"stop-color":p.toCssColorString()},{tagName:"stop",offset:"95%","stop-opacity":.05,"stop-color":p.toCssColorString()}]},{id:"animation_shuttleRingPointerGradient",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":l.toCssColorString()},{tagName:"stop",offset:"40%","stop-color":l.toCssColorString()},{tagName:"stop",offset:"60%","stop-color":d(l,B)},{tagName:"stop",offset:"100%","stop-color":d(l,B)}]},{id:"animation_shuttleRingPointerPaused",tagName:"linearGradient",x1:"0%",y1:"50%",x2:"100%",y2:"50%",children:[{tagName:"stop",offset:"0%","stop-color":"#CCC"},{tagName:"stop",offset:"40%","stop-color":"#CCC"},{tagName:"stop",offset:"60%","stop-color":"#555"},{tagName:"stop",offset:"100%","stop-color":"#555"}]},{id:"animation_knobOuter",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":d(k,u)},{tagName:"stop",offset:"60%","stop-color":d(k,v)},{tagName:"stop",offset:"85%","stop-color":d(k,y)}]},{id:"animation_knobInner",tagName:"linearGradient",x1:"20%",y1:"0%",x2:"90%",y2:"100%",children:[{tagName:"stop",offset:"5%","stop-color":d(k,v)},{tagName:"stop",offset:"60%","stop-color":d(k,u)},{tagName:"stop",offset:"85%","stop-color":d(k,z)}]},{id:"animation_pathReset",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.316,5.318,9.833,13.682,9.833,5.5,5.5,5.5,5.5,25.5,9.833,25.5,9.833,17.318,24.316,25.682z"},{id:"animation_pathPause",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M13,5.5,7.5,5.5,7.5,25.5,13,25.5zM24.5,5.5,19,5.5,19,25.5,24.5,25.5z"},{id:"animation_pathPlay",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},{id:"animation_pathPlayReverse",tagName:"path",transform:"translate(16,16) scale(-0.85,0.85) translate(-16,-16)",d:"M6.684,25.682L24.316,15.5L6.684,5.318V25.682z"},{id:"animation_pathLoop",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-16)",d:"M24.249,15.499c-0.009,4.832-3.918,8.741-8.75,8.75c-2.515,0-4.768-1.064-6.365-2.763l2.068-1.442l-7.901-3.703l0.744,8.694l2.193-1.529c2.244,2.594,5.562,4.242,9.26,4.242c6.767,0,12.249-5.482,12.249-12.249H24.249zM15.499,6.75c2.516,0,4.769,1.065,6.367,2.764l-2.068,1.443l7.901,3.701l-0.746-8.693l-2.192,1.529c-2.245-2.594-5.562-4.245-9.262-4.245C8.734,3.25,3.25,8.734,3.249,15.499H6.75C6.758,10.668,10.668,6.758,15.499,6.75z"},{id:"animation_pathClock",tagName:"path",transform:"translate(16,16) scale(0.85) translate(-16,-15.5)",d:"M15.5,2.374C8.251,2.375,2.376,8.251,2.374,15.5C2.376,22.748,8.251,28.623,15.5,28.627c7.249-0.004,13.124-5.879,13.125-13.127C28.624,8.251,22.749,2.375,15.5,2.374zM15.5,25.623C9.909,25.615,5.385,21.09,5.375,15.5C5.385,9.909,9.909,5.384,15.5,5.374c5.59,0.01,10.115,4.535,10.124,10.125C25.615,21.09,21.091,25.615,15.5,25.623zM8.625,15.5c-0.001-0.552-0.448-0.999-1.001-1c-0.553,0-1,0.448-1,1c0,0.553,0.449,1,1,1C8.176,16.5,8.624,16.053,8.625,15.5zM8.179,18.572c-0.478,0.277-0.642,0.889-0.365,1.367c0.275,0.479,0.889,0.641,1.365,0.365c0.479-0.275,0.643-0.887,0.367-1.367C9.27,18.461,8.658,18.297,8.179,18.572zM9.18,10.696c-0.479-0.276-1.09-0.112-1.366,0.366s-0.111,1.09,0.365,1.366c0.479,0.276,1.09,0.113,1.367-0.366C9.821,11.584,9.657,10.973,9.18,10.696zM22.822,12.428c0.478-0.275,0.643-0.888,0.366-1.366c-0.275-0.478-0.89-0.642-1.366-0.366c-0.479,0.278-0.642,0.89-0.366,1.367C21.732,12.54,22.344,12.705,22.822,12.428zM12.062,21.455c-0.478-0.275-1.089-0.111-1.366,0.367c-0.275,0.479-0.111,1.09,0.366,1.365c0.478,0.277,1.091,0.111,1.365-0.365C12.704,22.344,12.54,21.732,12.062,21.455zM12.062,9.545c0.479-0.276,0.642-0.888,0.366-1.366c-0.276-0.478-0.888-0.642-1.366-0.366s-0.642,0.888-0.366,1.366C10.973,9.658,11.584,9.822,12.062,9.545zM22.823,18.572c-0.48-0.275-1.092-0.111-1.367,0.365c-0.275,0.479-0.112,1.092,0.367,1.367c0.477,0.275,1.089,0.113,1.365-0.365C23.464,19.461,23.3,18.848,22.823,18.572zM19.938,7.813c-0.477-0.276-1.091-0.111-1.365,0.366c-0.275,0.48-0.111,1.091,0.366,1.367s1.089,0.112,1.366-0.366C20.581,8.702,20.418,8.089,19.938,7.813zM23.378,14.5c-0.554,0.002-1.001,0.45-1.001,1c0.001,0.552,0.448,1,1.001,1c0.551,0,1-0.447,1-1C24.378,14.949,23.929,14.5,23.378,14.5zM15.501,6.624c-0.552,0-1,0.448-1,1l-0.466,7.343l-3.004,1.96c-0.478,0.277-0.642,0.889-0.365,1.365c0.275,0.479,0.889,0.643,1.365,0.367l3.305-1.676C15.39,16.99,15.444,17,15.501,17c0.828,0,1.5-0.671,1.5-1.5l-0.5-7.876C16.501,7.072,16.053,6.624,15.501,6.624zM15.501,22.377c-0.552,0-1,0.447-1,1s0.448,1,1,1s1-0.447,1-1S16.053,22.377,15.501,22.377zM18.939,21.455c-0.479,0.277-0.643,0.889-0.366,1.367c0.275,0.477,0.888,0.643,1.366,0.365c0.478-0.275,0.642-0.889,0.366-1.365C20.028,21.344,19.417,21.18,18.939,21.455z"},{id:"animation_pathWingButton",tagName:"path",d:"m 4.5,0.5 c -2.216,0 -4,1.784 -4,4 l 0,24 c 0,2.216 1.784,4 4,4 l 13.71875,0 C 22.478584,27.272785 27.273681,22.511272 32.5,18.25 l 0,-13.75 c 0,-2.216 -1.784,-4 -4,-4 l -24,0 z"},{id:"animation_pathPointer",tagName:"path",d:"M-15,-65,-15,-55,15,-55,15,-65,0,-95z"},{id:"animation_pathSwooshFX",tagName:"path",d:"m 85,0 c 0,16.617 -4.813944,35.356 -13.131081,48.4508 h 6.099803 c 8.317138,-13.0948 13.13322,-28.5955 13.13322,-45.2124 0,-46.94483 -38.402714,-85.00262 -85.7743869,-85.00262 -1.0218522,0 -2.0373001,0.0241 -3.0506131,0.0589 45.958443,1.59437 82.723058,35.77285 82.723058,81.70532 z"}]});a(this._defsElement)?this._svgNode.replaceChild(b,this._defsElement):this._svgNode.appendChild(b);this._defsElement=b}else if(!a(this._observer)){var q=this;q._observer=new MutationObserver(function(){document.body.contains(q._container)&&(q._observer.disconnect(),q._observer=void 0,q.applyThemeChanges())});q._observer.observe(document,{childList:!0,subtree:!0})}};return r});F("Widgets/Animation/AnimationViewModel","../../Core/binarySearch ../../Core/ClockRange ../../Core/ClockStep ../../Core/defined ../../Core/defineProperties ../../Core/DeveloperError ../../Core/JulianDate ../../ThirdParty/knockout ../../ThirdParty/sprintf ../createCommand ../ToggleButtonViewModel".split(" "),function(b,a,f,k,g,l,m,e,h,p,d){function q(a,b){return a-b}function t(a,c){var d=b(c,a,q);return 0>d?~d:d}function r(a,b,c){if(c.clockStep===f.SYSTEM_CLOCK)return 15;if(1>=Math.abs(a))return 15*a;c=b[b.length-1];a>c?a=c:a<-c&&(a=-c);if(0<a)return b=Math.log(c),(Math.log(a)-0)/((b-0)/90)+15;b=Math.log(-b[0]);return-((Math.log(Math.abs(a))-0)/((b-0)/90)+15)}function c(b){if(!k(b))throw new l("clockViewModel is required.");var g=this;this._clockViewModel=b;this._allShuttleRingTicks=[];this._dateFormatter=c.defaultDateFormatter;this._timeFormatter=c.defaultTimeFormatter;this.snapToTicks=this.shuttleRingDragging=!1;e.track(this,["_allShuttleRingTicks","_dateFormatter","_timeFormatter","shuttleRingDragging","snapToTicks"]);this._sortedFilteredPositiveTicks=[];this.setShuttleRingTicks(c.defaultTicks);this.timeLabel=void 0;e.defineProperty(this,"timeLabel",function(){return g._timeFormatter(g._clockViewModel.currentTime,g)});this.dateLabel=void 0;e.defineProperty(this,"dateLabel",function(){return g._dateFormatter(g._clockViewModel.currentTime,g)});this.multiplierLabel=void 0;e.defineProperty(this,"multiplierLabel",function(){var a=g._clockViewModel;if(a.clockStep===f.SYSTEM_CLOCK)return"Today";a=a.multiplier;return 0===a%1?a.toFixed(0)+"x":a.toFixed(3).replace(/0{0,3}$/,"")+"x"});this.shuttleRingAngle=void 0;e.defineProperty(this,"shuttleRingAngle",{get:function(){return r(b.multiplier,g._allShuttleRingTicks,b)},set:function(a){a=Math.max(Math.min(a,105),-105);var b=g._allShuttleRingTicks,c=g._clockViewModel;c.clockStep=f.SYSTEM_CLOCK_MULTIPLIER;if(105===Math.abs(a))c.multiplier=0<a?b[b.length-1]:b[0];else{if(15>=Math.abs(a))a/=15;else{var d;0<a?(d=Math.log(b[b.length-1]),a=Math.exp(0+(d-0)/90*(a-15))):(d=Math.log(-b[0]),a=-Math.exp(0+(d-0)/90*(Math.abs(a)-15)))}g.snapToTicks?a=b[t(a,b)]:0!==a&&(b=Math.abs(a),100<b?(b=b.toFixed(0).length-2,b=Math.pow(10,b),a=Math.round(a/b)*b|0):15<b?a=Math.round(a):1<b?a=+a.toFixed(1):0<b&&(a=+a.toFixed(2)));c.multiplier=a}}});this._canAnimate=void 0;e.defineProperty(this,"_canAnimate",function(){var b=g._clockViewModel,c=b.clockRange;if(g.shuttleRingDragging||c===a.UNBOUNDED)return!0;var d=b.multiplier,e=b.currentTime,f=b.startTime;c===a.LOOP_STOP?d=m.greaterThan(e,f)||e.equals(f)&&0<d:(c=b.stopTime,d=m.greaterThan(e,f)&&m.lessThan(e,c)||e.equals(f)&&0<d||e.equals(c)&&0>d);d||(b.shouldAnimate=!1);return d});this._isSystemTimeAvailable=void 0;e.defineProperty(this,"_isSystemTimeAvailable",function(){var b=g._clockViewModel;if(b.clockRange===a.UNBOUNDED)return!0;var c=b.systemTime;return m.greaterThanOrEquals(c,b.startTime)&&m.lessThanOrEquals(c,b.stopTime)});this._isAnimating=void 0;e.defineProperty(this,"_isAnimating",function(){return g._clockViewModel.shouldAnimate&&(g._canAnimate||g.shuttleRingDragging)});var h=p(function(){var a=g._clockViewModel;a.shouldAnimate?a.shouldAnimate=!1:g._canAnimate&&(a.shouldAnimate=!0)});this._pauseViewModel=new d(h,{toggled:e.computed(function(){return!g._isAnimating}),tooltip:"Pause"});h=p(function(){var a=g._clockViewModel,b=a.multiplier;0<b&&(a.multiplier=-b);a.shouldAnimate=!0});this._playReverseViewModel=new d(h,{toggled:e.computed(function(){return g._isAnimating&&0>b.multiplier}),tooltip:"Play Reverse"});h=p(function(){var a=g._clockViewModel,b=a.multiplier;0>b&&(a.multiplier=-b);a.shouldAnimate=!0});this._playForwardViewModel=new d(h,{toggled:e.computed(function(){return g._isAnimating&&0<b.multiplier&&b.clockStep!==f.SYSTEM_CLOCK}),tooltip:"Play Forward"});h=p(function(){g._clockViewModel.clockStep=f.SYSTEM_CLOCK},e.getObservable(this,"_isSystemTimeAvailable"));this._playRealtimeViewModel=new d(h,{toggled:e.computed(function(){return b.clockStep===f.SYSTEM_CLOCK}),tooltip:e.computed(function(){return g._isSystemTimeAvailable?"Today (real-time)":"Current time not in range"})});this._slower=p(function(){var a=g._clockViewModel,b=g._allShuttleRingTicks,c=t(a.multiplier,b)-1;0<=c&&(a.multiplier=b[c])});this._faster=p(function(){var a=g._clockViewModel,b=g._allShuttleRingTicks,c=t(a.multiplier,b)+1;c<b.length&&(a.multiplier=b[c])})}var u="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");c.defaultDateFormatter=function(a,b){var c=m.toGregorianDate(a);return u[c.month-1]+" "+c.day+" "+c.year};c.defaultTicks=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800];c.defaultTimeFormatter=function(a,b){var c=m.toGregorianDate(a),d=Math.round(c.millisecond);return 1>Math.abs(b._clockViewModel.multiplier)?h("%02d:%02d:%02d.%03d",c.hour,c.minute,c.second,d):h("%02d:%02d:%02d UTC",c.hour,c.minute,c.second)};c.prototype.getShuttleRingTicks=function(){return this._sortedFilteredPositiveTicks.slice(0)};c.prototype.setShuttleRingTicks=function(a){if(!k(a))throw new l("positiveTicks is required.");var b,c,d,e={},f=this._sortedFilteredPositiveTicks;b=f.length=0;for(c=a.length;b<c;++b)d=a[b],e.hasOwnProperty(d)||(e[d]=!0,f.push(d));f.sort(q);a=[];c=f.length;for(b=c-1;0<=b;--b)d=f[b],0!==d&&a.push(-d);Array.prototype.push.apply(a,f);this._allShuttleRingTicks=a};g(c.prototype,{slower:{get:function(){return this._slower}},faster:{get:function(){return this._faster}},clockViewModel:{get:function(){return this._clockViewModel}},pauseViewModel:{get:function(){return this._pauseViewModel}},playReverseViewModel:{get:function(){return this._playReverseViewModel}},playForwardViewModel:{get:function(){return this._playForwardViewModel}},playRealtimeViewModel:{get:function(){return this._playRealtimeViewModel}},dateFormatter:{get:function(){return this._dateFormatter},set:function(a){if("function"!==typeof a)throw new l("dateFormatter must be a function");this._dateFormatter=a}},timeFormatter:{get:function(){return this._timeFormatter},set:function(a){if("function"!==typeof a)throw new l("timeFormatter must be a function");this._timeFormatter=a}}});c._maxShuttleRingAngle=105;c._realtimeShuttleRingAngle=15;return c});F("Widgets/BaseLayerPicker/BaseLayerPickerViewModel","../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/DeveloperError ../../Core/EllipsoidTerrainProvider ../../Core/isArray ../../ThirdParty/knockout ../createCommand".split(" "),function(b,a,f,k,g,l,m,e){function h(f){f=b(f,b.EMPTY_OBJECT);var d=f.globe,h=b(f.imageryProviderViewModels,[]),p=b(f.terrainProviderViewModels,[]);if(!a(d))throw new k("globe is required");this._globe=d;this.imageryProviderViewModels=h.slice(0);this.terrainProviderViewModels=p.slice(0);this.dropDownVisible=!1;m.track(this,["imageryProviderViewModels","terrainProviderViewModels","dropDownVisible"]);var r=m.getObservable(this,"imageryProviderViewModels");this._imageryProviders=m.pureComputed(function(){var b=r(),c={},d;for(d=0;d<b.length;d++){var e=b[d],f=e.category;a(c[f])?c[f].push(e):c[f]=[e]}b=Object.keys(c);e=[];for(d=0;d<b.length;d++)f=b[d],e.push({name:f,providers:c[f]});return e});var c=m.getObservable(this,"terrainProviderViewModels");this._terrainProviders=m.pureComputed(function(){var b=c(),d={},e;for(e=0;e<b.length;e++){var f=b[e],g=f.category;a(d[g])?d[g].push(f):d[g]=[f]}b=Object.keys(d);f=[];for(e=0;e<b.length;e++)g=b[e],f.push({name:g,providers:d[g]});return f});this.buttonTooltip=void 0;m.defineProperty(this,"buttonTooltip",function(){var b=this.selectedImagery,c=this.selectedTerrain,b=a(b)?b.name:void 0,c=a(c)?c.name:void 0;return a(b)&&a(c)?b+"\n"+c:a(b)?b:c});this.buttonImageUrl=void 0;m.defineProperty(this,"buttonImageUrl",function(){var b=this.selectedImagery;if(a(b))return b.iconUrl});this.selectedImagery=void 0;var u=m.observable();this._currentImageryProviders=[];m.defineProperty(this,"selectedImagery",{get:function(){return u()},set:function(b){if(u()!==b){var c,d=this._currentImageryProviders,e=d.length,f=this._globe.imageryLayers,g=!1;for(c=0;c<e;c++)for(var h=f.length,k=0;k<h;k++){var m=f.get(k);if(m.imageryProvider===d[c]){f.remove(m);g=!0;break}}if(a(b))if(d=b.creationCommand(),l(d)){for(c=d.length-1;0<=c;c--)f.addImageryProvider(d[c],0);this._currentImageryProviders=d.slice(0)}else this._currentImageryProviders=[d],g||(c=f.get(0),a(c)&&f.remove(c)),f.addImageryProvider(d,0);u(b)}this.dropDownVisible=!1}});this.selectedTerrain=void 0;var y=m.observable();m.defineProperty(this,"selectedTerrain",{get:function(){return y()},set:function(b){if(y()!==b){var c;a(b)&&(c=b.creationCommand());this._globe.depthTestAgainstTerrain=!(c instanceof g);this._globe.terrainProvider=c;y(b)}this.dropDownVisible=!1}});var A=this;this._toggleDropDown=e(function(){A.dropDownVisible=!A.dropDownVisible});this.selectedImagery=b(f.selectedImageryProviderViewModel,h[0]);this.selectedTerrain=b(f.selectedTerrainProviderViewModel,p[0])}f(h.prototype,{toggleDropDown:{get:function(){return this._toggleDropDown}},globe:{get:function(){return this._globe}}});return h});F("Widgets/BaseLayerPicker/BaseLayerPicker","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/FeatureDetection ../../ThirdParty/knockout ../getElement ./BaseLayerPickerViewModel".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d){if(!b(a))throw new k("container is required.");a=m(a);var f=new e(d),h=document.createElement("button");h.type="button";h.className="cesium-button cesium-toolbar-button";h.setAttribute("data-bind","attr: { title: buttonTooltip },click: toggleDropDown");a.appendChild(h);var p=document.createElement("img");p.setAttribute("draggable","false");p.className="cesium-baseLayerPicker-selected";p.setAttribute("data-bind","attr: { src: buttonImageUrl }, visible: !!buttonImageUrl");h.appendChild(p);var c=document.createElement("div");c.className="cesium-baseLayerPicker-dropDown";c.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-dropDown-visible" : dropDownVisible }');a.appendChild(c);p=document.createElement("div");p.className="cesium-baseLayerPicker-sectionTitle";p.setAttribute("data-bind","visible: imageryProviderViewModels.length \x3e 0");p.innerHTML="Imagery";c.appendChild(p);var u=document.createElement("div");u.className="cesium-baseLayerPicker-section";u.setAttribute("data-bind","foreach: _imageryProviders");c.appendChild(u);p=document.createElement("div");p.className="cesium-baseLayerPicker-category";u.appendChild(p);u=document.createElement("div");u.className="cesium-baseLayerPicker-categoryTitle";u.setAttribute("data-bind","text: name");p.appendChild(u);u=document.createElement("div");u.className="cesium-baseLayerPicker-choices";u.setAttribute("data-bind","foreach: providers");p.appendChild(u);p=document.createElement("div");p.className="cesium-baseLayerPicker-item";p.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data \x3d\x3d\x3d $parents[1].selectedImagery },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedImagery \x3d $data; }');u.appendChild(p);u=document.createElement("img");u.className="cesium-baseLayerPicker-itemIcon";u.setAttribute("data-bind","attr: { src: iconUrl }");u.setAttribute("draggable","false");p.appendChild(u);u=document.createElement("div");u.className="cesium-baseLayerPicker-itemLabel";u.setAttribute("data-bind","text: name");p.appendChild(u);p=document.createElement("div");p.className="cesium-baseLayerPicker-sectionTitle";p.setAttribute("data-bind","visible: terrainProviderViewModels.length \x3e 0");p.innerHTML="Terrain";c.appendChild(p);u=document.createElement("div");u.className="cesium-baseLayerPicker-section";u.setAttribute("data-bind","foreach: _terrainProviders");c.appendChild(u);p=document.createElement("div");p.className="cesium-baseLayerPicker-category";u.appendChild(p);u=document.createElement("div");u.className="cesium-baseLayerPicker-categoryTitle";u.setAttribute("data-bind","text: name");p.appendChild(u);u=document.createElement("div");u.className="cesium-baseLayerPicker-choices";u.setAttribute("data-bind","foreach: providers");p.appendChild(u);p=document.createElement("div");p.className="cesium-baseLayerPicker-item";p.setAttribute("data-bind",'css: { "cesium-baseLayerPicker-selectedItem" : $data \x3d\x3d\x3d $parents[1].selectedTerrain },attr: { title: tooltip },visible: creationCommand.canExecute,click: function($data) { $parents[1].selectedTerrain \x3d $data; }');u.appendChild(p);u=document.createElement("img");u.className="cesium-baseLayerPicker-itemIcon";u.setAttribute("data-bind","attr: { src: iconUrl }");u.setAttribute("draggable","false");p.appendChild(u);u=document.createElement("div");u.className="cesium-baseLayerPicker-itemLabel";u.setAttribute("data-bind","text: name");p.appendChild(u);l.applyBindings(f,h);l.applyBindings(f,c);this._viewModel=f;this._container=a;this._element=h;this._dropPanel=c;this._closeDropDown=function(a){h.contains(a.target)||c.contains(a.target)||(f.dropDownVisible=!1)};g.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}a(h.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){g.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0));l.cleanNode(this._element);l.cleanNode(this._dropPanel);this._container.removeChild(this._element);this._container.removeChild(this._dropPanel);return f(this)};return h});F("Widgets/BaseLayerPicker/ProviderViewModel","../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/DeveloperError ../../ThirdParty/knockout ../createCommand".split(" "),function(b,a,f,k,g,l){function m(e){if(!a(e.name))throw new k("options.name is required.");if(!a(e.tooltip))throw new k("options.tooltip is required.");if(!a(e.iconUrl))throw new k("options.iconUrl is required.");if("function"!==typeof e.creationFunction)throw new k("options.creationFunction is required.");var f=e.creationFunction;a(f.canExecute)||(f=l(f));this._creationCommand=f;this.name=e.name;this.tooltip=e.tooltip;this.iconUrl=e.iconUrl;this._category=b(e.category,"");g.track(this,["name","tooltip","iconUrl"])}f(m.prototype,{creationCommand:{get:function(){return this._creationCommand}},category:{get:function(){return this._category}}});return m});F("Widgets/BaseLayerPicker/createDefaultImageryProviderViewModels","../../Core/buildModuleUrl ../../Scene/ArcGisMapServerImageryProvider ../../Scene/IonWorldImageryStyle ../../Scene/createOpenStreetMapImageryProvider ../../Scene/createTileMapServiceImageryProvider ../../Scene/createWorldImagery ../../Scene/IonImageryProvider ../../Scene/MapboxStyleImageryProvider ../BaseLayerPicker/ProviderViewModel".split(" "),function(b,a,f,k,g,l,m,e,h){return function(){var p=[];p.push(new h({name:"Bing Maps Aerial",iconUrl:b("Widgets/Images/ImageryProviders/bingAerial.png"),tooltip:"Bing Maps aerial imagery, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return l({style:f.AERIAL})}}));p.push(new h({name:"Bing Maps Aerial with Labels",iconUrl:b("Widgets/Images/ImageryProviders/bingAerialLabels.png"),tooltip:"Bing Maps aerial imagery with labels, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return l({style:f.AERIAL_WITH_LABELS})}}));p.push(new h({name:"Bing Maps Roads",iconUrl:b("Widgets/Images/ImageryProviders/bingRoads.png"),tooltip:"Bing Maps standard road maps, provided by Cesium ion",category:"Cesium ion",creationFunction:function(){return l({style:f.ROAD})}}));p.push(new h({name:"Mapbox Satellite",tooltip:"Mapbox satellite imagery https://www.mapbox.com/maps/",iconUrl:b("Widgets/Images/ImageryProviders/mapboxSatellite.png"),category:"Other",creationFunction:function(){return new e({styleId:"satellite-v9"})}}));p.push(new h({name:"Mapbox Streets",tooltip:"Mapbox streets imagery https://www.mapbox.com/maps/",iconUrl:b("Widgets/Images/ImageryProviders/mapboxTerrain.png"),category:"Other",creationFunction:function(){return new e({styleId:"satellite-streets-v11"})}}));p.push(new h({name:"Mapbox Streets Classic",tooltip:"Mapbox streets basic imagery https://www.mapbox.com/maps/",iconUrl:b("Widgets/Images/ImageryProviders/mapboxStreets.png"),category:"Other",creationFunction:function(){return new e({styleId:"streets-v11"})}}));p.push(new h({name:"ESRI World Imagery",iconUrl:b("Widgets/Images/ImageryProviders/esriWorldImagery.png"),tooltip:"World Imagery provides one meter or better satellite and aerial imagery in many parts of the world and lower resolution satellite imagery worldwide.  The map includes NASA Blue Marble: Next Generation 500m resolution imagery at small scales (above 1:1,000,000), i-cubed 15m eSAT imagery at medium-to-large scales (down to 1:70,000) for the world, and USGS 15m Landsat imagery for Antarctica. The map features 0.3m resolution imagery in the continental United States and 0.6m resolution imagery in parts of Western Europe from DigitalGlobe. In other parts of the world, 1 meter resolution imagery is available from GeoEye IKONOS, i-cubed Nationwide Prime, Getmapping, AeroGRID, IGN Spain, and IGP Portugal.  Additionally, imagery at different resolutions has been contributed by the GIS User Community.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",enablePickFeatures:!1})}}));p.push(new h({name:"ESRI World Street Map",iconUrl:b("Widgets/Images/ImageryProviders/esriWorldStreetMap.png"),tooltip:"This worldwide street map presents highway-level data for the world. Street-level data includes the United States; much of Canada; Japan; most countries in Europe; Australia and New Zealand; India; parts of South America including Argentina, Brazil, Chile, Colombia, and Venezuela; Ghana; and parts of southern Africa including Botswana, Lesotho, Namibia, South Africa, and Swaziland.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer",enablePickFeatures:!1})}}));p.push(new h({name:"ESRI National Geographic",iconUrl:b("Widgets/Images/ImageryProviders/esriNationalGeographic.png"),tooltip:"This web map contains the National Geographic World Map service. This map service is designed to be used as a general reference map for informational and educational purposes as well as a basemap by GIS professionals and other users for creating web maps and web mapping applications.\nhttp://www.esri.com",category:"Other",creationFunction:function(){return new a({url:"https://services.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/",enablePickFeatures:!1})}}));p.push(new h({name:"Open\u00adStreet\u00adMap",iconUrl:b("Widgets/Images/ImageryProviders/openStreetMap.png"),tooltip:"OpenStreetMap (OSM) is a collaborative project to create a free editable map of the world.\nhttp://www.openstreetmap.org",category:"Other",creationFunction:function(){return k({url:"https://a.tile.openstreetmap.org/"})}}));p.push(new h({name:"Stamen Watercolor",iconUrl:b("Widgets/Images/ImageryProviders/stamenWatercolor.png"),tooltip:"Reminiscent of hand drawn maps, Stamen watercolor maps apply raster effect area washes and organic edges over a paper texture to add warm pop to any map.\nhttp://maps.stamen.com",category:"Other",creationFunction:function(){return k({url:"https://stamen-tiles.a.ssl.fastly.net/watercolor/",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}}));p.push(new h({name:"Stamen Toner",iconUrl:b("Widgets/Images/ImageryProviders/stamenToner.png"),tooltip:"A high contrast black and white map.\nhttp://maps.stamen.com",category:"Other",creationFunction:function(){return k({url:"https://stamen-tiles.a.ssl.fastly.net/toner/",credit:"Map tiles by Stamen Design, under CC BY 3.0. Data by OpenStreetMap, under CC BY SA."})}}));p.push(new h({name:"Sentinel-2",iconUrl:b("Widgets/Images/ImageryProviders/sentinel-2.png"),tooltip:"Sentinel-2 cloudless by EOX IT Services GmbH (Contains modified Copernicus Sentinel data 2016 and 2017).",category:"Cesium ion",creationFunction:function(){return new m({assetId:3954})}}));p.push(new h({name:"Blue Marble",iconUrl:b("Widgets/Images/ImageryProviders/blueMarble.png"),tooltip:"Blue Marble Next Generation July, 2004 imagery from NASA.",category:"Cesium ion",creationFunction:function(){return new m({assetId:3845})}}));p.push(new h({name:"Earth at night",iconUrl:b("Widgets/Images/ImageryProviders/earthAtNight.png"),tooltip:"The Earth at night, also known as The Black Marble, is a 500 meter resolution global composite imagery layer released by NASA.",category:"Cesium ion",creationFunction:function(){return new m({assetId:3812})}}));p.push(new h({name:"Natural Earth\u00a0II",iconUrl:b("Widgets/Images/ImageryProviders/naturalEarthII.png"),tooltip:"Natural Earth II, darkened for contrast.\nhttp://www.naturalearthdata.com/",category:"Cesium ion",creationFunction:function(){return g({url:b("Assets/Textures/NaturalEarthII")})}}));return p}});F("Widgets/BaseLayerPicker/createDefaultTerrainProviderViewModels",["../../Core/buildModuleUrl","../../Core/createWorldTerrain","../../Core/EllipsoidTerrainProvider","../BaseLayerPicker/ProviderViewModel"],function(b,a,f,k){return function(){var g=[];g.push(new k({name:"WGS84 Ellipsoid",iconUrl:b("Widgets/Images/TerrainProviders/Ellipsoid.png"),tooltip:"WGS84 standard ellipsoid, also known as EPSG:4326",category:"Cesium ion",creationFunction:function(){return new f}}));g.push(new k({name:"Cesium World Terrain",iconUrl:b("Widgets/Images/TerrainProviders/CesiumWorldTerrain.png"),tooltip:"High-resolution global terrain tileset curated from several datasources and hosted by Cesium ion",category:"Cesium ion",creationFunction:function(){return a({requestWaterMask:!0,requestVertexNormals:!0})}}));return g}});F("Widgets/Cesium3DTilesInspector/Cesium3DTilesInspectorViewModel","../../Core/Check ../../Core/Color ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/ScreenSpaceEventHandler ../../Core/ScreenSpaceEventType ../../Scene/Cesium3DTileColorBlendMode ../../Scene/Cesium3DTileFeature ../../Scene/Cesium3DTilePass ../../Scene/Cesium3DTileset ../../Scene/Cesium3DTileStyle ../../Scene/PerformanceDisplay ../../ThirdParty/knockout".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r){function c(a){return function(b){b=a._scene.pick(b.position);f(b)&&b.primitive instanceof d&&(a.tileset=b.primitive);a.pickActive=!1}}function u(a,b){b?a._eventHandler.setInputAction(function(b){b=a._scene.pick(b.endPosition);f(b)&&b.primitive instanceof d&&(a.tileset=b.primitive)},m.MOUSE_MOVE):(a._eventHandler.removeInputAction(m.MOUSE_MOVE),a.picking=a.picking)}function y(a){a/=1048576;return 1>a?a.toLocaleString(void 0,D):Math.round(a).toLocaleString()}function A(a,b){if(!f(a))return"";var c=b?a._statisticsPerPass[p.PICK]:a._statisticsPerPass[p.RENDER],d;d='\x3cul class\x3d"cesium-cesiumInspector-statistics"\x3e'+("\x3cli\x3e\x3cstrong\x3eVisited: \x3c/strong\x3e"+c.visited.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eSelected: \x3c/strong\x3e"+c.selected.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eCommands: \x3c/strong\x3e"+c.numberOfCommands.toLocaleString()+"\x3c/li\x3e");d+="\x3c/ul\x3e";b||(d=d+'\x3cul class\x3d"cesium-cesiumInspector-statistics"\x3e'+("\x3cli\x3e\x3cstrong\x3eRequests: \x3c/strong\x3e"+c.numberOfPendingRequests.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eAttempted: \x3c/strong\x3e"+c.numberOfAttemptedRequests.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eProcessing: \x3c/strong\x3e"+c.numberOfTilesProcessing.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eContent Ready: \x3c/strong\x3e"+c.numberOfTilesWithContentReady.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eTotal: \x3c/strong\x3e"+c.numberOfTilesTotal.toLocaleString()+"\x3c/li\x3e"),d=d+'\x3c/ul\x3e\x3cul class\x3d"cesium-cesiumInspector-statistics"\x3e'+("\x3cli\x3e\x3cstrong\x3eFeatures Selected: \x3c/strong\x3e"+c.numberOfFeaturesSelected.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eFeatures Loaded: \x3c/strong\x3e"+c.numberOfFeaturesLoaded.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3ePoints Selected: \x3c/strong\x3e"+c.numberOfPointsSelected.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3ePoints Loaded: \x3c/strong\x3e"+c.numberOfPointsLoaded.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eTriangles Selected: \x3c/strong\x3e"+c.numberOfTrianglesSelected.toLocaleString()+"\x3c/li\x3e"),d=d+'\x3c/ul\x3e\x3cul class\x3d"cesium-cesiumInspector-statistics"\x3e'+("\x3cli\x3e\x3cstrong\x3eTiles styled: \x3c/strong\x3e"+c.numberOfTilesStyled.toLocaleString()+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eFeatures styled: \x3c/strong\x3e"+c.numberOfFeaturesStyled.toLocaleString()+"\x3c/li\x3e"),d=d+'\x3c/ul\x3e\x3cul class\x3d"cesium-cesiumInspector-statistics"\x3e'+("\x3cli\x3e\x3cstrong\x3eChildren Union Culled: \x3c/strong\x3e"+c.numberOfTilesCulledWithChildrenUnion.toLocaleString()+"\x3c/li\x3e"),d=d+'\x3c/ul\x3e\x3cul class\x3d"cesium-cesiumInspector-statistics"\x3e'+("\x3cli\x3e\x3cstrong\x3eGeometry Memory (MB): \x3c/strong\x3e"+y(c.geometryByteLength)+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eTexture Memory (MB): \x3c/strong\x3e"+y(c.texturesByteLength)+"\x3c/li\x3e\x3cli\x3e\x3cstrong\x3eBatch Table Memory (MB): \x3c/strong\x3e"+y(c.batchTableByteLength)+"\x3c/li\x3e"),d+="\x3c/ul\x3e");return d}function z(a,d){b.typeOf.object("scene",a);b.typeOf.object("performanceContainer",d);var g=this,k=a.canvas;this._eventHandler=new l(k);this._scene=a;this._performanceContainer=d;this._canvas=k;this._performanceDisplay=new t({container:d});this._editorError=this._pickStatisticsText=this._statisticsText="";this.performance=!1;this.inspectorVisible=this.showPickStatistics=this.showStatistics=!0;this.optimizationVisible=this.tileDebugLabelsVisible=this.styleVisible=this.loggingVisible=this.updateVisible=this.displayVisible=this.tilesetVisible=!1;this.styleString="{}";this._tile=this._feature=this._tileset=void 0;r.track(this,"performance inspectorVisible _statisticsText _pickStatisticsText _editorError showPickStatistics showStatistics tilesetVisible displayVisible updateVisible loggingVisible styleVisible optimizationVisible tileDebugLabelsVisible styleString _feature _tile".split(" "));this._properties=r.observable({});this.properties=[];r.defineProperty(this,"properties",function(){var a=[],b=g._properties(),c;for(c in b)b.hasOwnProperty(c)&&a.push(c);return a});var p=r.observable();r.defineProperty(this,"dynamicScreenSpaceError",{get:function(){return p()},set:function(a){p(a);f(g._tileset)&&(g._tileset.dynamicScreenSpaceError=a)}});this.dynamicScreenSpaceError=!1;var q=r.observable();r.defineProperty(this,"colorBlendMode",{get:function(){return q()},set:function(a){q(a);f(g._tileset)&&(g._tileset.colorBlendMode=a,g._scene.requestRender())}});this.colorBlendMode=e.HIGHLIGHT;var v=r.observable();r.defineProperty(this,"picking",{get:function(){return v()},set:function(b){v(b);b?g._eventHandler.setInputAction(function(b){var c=a.pick(b.endPosition);c instanceof h?(g.feature=c,g.tile=c.content.tile):f(c)&&f(c.content)?(g.feature=void 0,g.tile=c.content.tile):(g.feature=void 0,g.tile=void 0);f(g._tileset)&&(x&&f(c)&&f(c.content)?(a.pickPositionSupported&&(b=a.pickPosition(b.endPosition),f(b)&&(g._tileset.debugPickPosition=b)),g._tileset.debugPickedTile=c.content.tile):g._tileset.debugPickedTile=void 0,g._scene.requestRender())},m.MOUSE_MOVE):(g.feature=void 0,g.tile=void 0,g._eventHandler.removeInputAction(m.MOUSE_MOVE))}});this.picking=!0;var y=r.observable();r.defineProperty(this,"colorize",{get:function(){return y()},set:function(a){y(a);f(g._tileset)&&(g._tileset.debugColorizeTiles=a,g._scene.requestRender())}});this.colorize=!1;var z=r.observable();r.defineProperty(this,"wireframe",{get:function(){return z()},set:function(a){z(a);f(g._tileset)&&(g._tileset.debugWireframe=a,g._scene.requestRender())}});this.wireframe=!1;var A=r.observable();r.defineProperty(this,"showBoundingVolumes",{get:function(){return A()},set:function(a){A(a);f(g._tileset)&&(g._tileset.debugShowBoundingVolume=a,g._scene.requestRender())}});this.showBoundingVolumes=!1;var B=r.observable();r.defineProperty(this,"showContentBoundingVolumes",{get:function(){return B()},set:function(a){B(a);f(g._tileset)&&(g._tileset.debugShowContentBoundingVolume=a,g._scene.requestRender())}});this.showContentBoundingVolumes=!1;var C=r.observable();r.defineProperty(this,"showRequestVolumes",{get:function(){return C()},set:function(a){C(a);f(g._tileset)&&(g._tileset.debugShowViewerRequestVolume=a,g._scene.requestRender())}});this.showRequestVolumes=!1;var D=r.observable();r.defineProperty(this,"freezeFrame",{get:function(){return D()},set:function(a){D(a);f(g._tileset)&&(g._tileset.debugFreezeFrame=a,g._scene.debugShowFrustumPlanes=a,g._scene.requestRender())}});this.freezeFrame=!1;var x=r.observable();r.defineProperty(this,"showOnlyPickedTileDebugLabel",{get:function(){return x()},set:function(a){x(a);f(g._tileset)&&(g._tileset.debugPickedTileLabelOnly=a,g._scene.requestRender())}});this.showOnlyPickedTileDebugLabel=!1;var F=r.observable();r.defineProperty(this,"showGeometricError",{get:function(){return F()},set:function(a){F(a);f(g._tileset)&&(g._tileset.debugShowGeometricError=a,g._scene.requestRender())}});this.showGeometricError=!1;var H=r.observable();r.defineProperty(this,"showRenderingStatistics",{get:function(){return H()},set:function(a){H(a);f(g._tileset)&&(g._tileset.debugShowRenderingStatistics=a,g._scene.requestRender())}});this.showRenderingStatistics=!1;var I=r.observable();r.defineProperty(this,"showMemoryUsage",{get:function(){return I()},set:function(a){I(a);f(g._tileset)&&(g._tileset.debugShowMemoryUsage=a,g._scene.requestRender())}});this.showMemoryUsage=!1;var J=r.observable();r.defineProperty(this,"showUrl",{get:function(){return J()},set:function(a){J(a);f(g._tileset)&&(g._tileset.debugShowUrl=a,g._scene.requestRender())}});this.showUrl=!1;var S=r.observable();r.defineProperty(this,"maximumScreenSpaceError",{get:function(){return S()},set:function(a){a=Number(a);isNaN(a)||(S(a),f(g._tileset)&&(g._tileset.maximumScreenSpaceError=a))}});this.maximumScreenSpaceError=16;var ca=r.observable();r.defineProperty(this,"dynamicScreenSpaceErrorDensity",{get:function(){return ca()},set:function(a){a=Number(a);isNaN(a)||(ca(a),f(g._tileset)&&(g._tileset.dynamicScreenSpaceErrorDensity=a))}});this.dynamicScreenSpaceErrorDensity=.00278;this.dynamicScreenSpaceErrorDensitySliderValue=void 0;r.defineProperty(this,"dynamicScreenSpaceErrorDensitySliderValue",{get:function(){return Math.pow(ca(),1/6)},set:function(a){ca(Math.pow(a,6))}});var T=r.observable();r.defineProperty(this,"dynamicScreenSpaceErrorFactor",{get:function(){return T()},set:function(a){a=Number(a);isNaN(a)||(T(a),f(g._tileset)&&(g._tileset.dynamicScreenSpaceErrorFactor=a))}});this.dynamicScreenSpaceErrorFactor=4;var da=c(this),V=r.observable();r.defineProperty(this,"pickActive",{get:function(){return V()},set:function(a){V(a);a?g._eventHandler.setInputAction(da,m.LEFT_CLICK):g._eventHandler.removeInputAction(m.LEFT_CLICK)}});var ba=r.observable();r.defineProperty(this,"pointCloudShading",{get:function(){return ba()},set:function(a){ba(a);f(g._tileset)&&(g._tileset.pointCloudShading.attenuation=a)}});this.pointCloudShading=!1;var X=r.observable();r.defineProperty(this,"geometricErrorScale",{get:function(){return X()},set:function(a){a=Number(a);isNaN(a)||(X(a),f(g._tileset)&&(g._tileset.pointCloudShading.geometricErrorScale=a))}});this.geometricErrorScale=1;var fa=r.observable();r.defineProperty(this,"maximumAttenuation",{get:function(){return fa()},set:function(a){a=Number(a);isNaN(a)||(fa(a),f(g._tileset)&&(g._tileset.pointCloudShading.maximumAttenuation=0===a?void 0:a))}});this.maximumAttenuation=0;var ga=r.observable();r.defineProperty(this,"baseResolution",{get:function(){return ga()},set:function(a){a=Number(a);isNaN(a)||(ga(a),f(g._tileset)&&(g._tileset.pointCloudShading.baseResolution=0===a?void 0:a))}});this.baseResolution=0;var ka=r.observable();r.defineProperty(this,"eyeDomeLighting",{get:function(){return ka()},set:function(a){ka(a);f(g._tileset)&&(g._tileset.pointCloudShading.eyeDomeLighting=a)}});this.eyeDomeLighting=!1;var na=r.observable();r.defineProperty(this,"eyeDomeLightingStrength",{get:function(){return na()},set:function(a){a=Number(a);isNaN(a)||(na(a),f(g._tileset)&&(g._tileset.pointCloudShading.eyeDomeLightingStrength=a))}});this.eyeDomeLightingStrength=1;var ia=r.observable();r.defineProperty(this,"eyeDomeLightingRadius",{get:function(){return ia()},set:function(a){a=Number(a);isNaN(a)||(ia(a),f(g._tileset)&&(g._tileset.pointCloudShading.eyeDomeLightingRadius=a))}});this.eyeDomeLightingRadius=1;this.pickActive=!1;var la=r.observable();r.defineProperty(this,"skipLevelOfDetail",{get:function(){return la()},set:function(a){la(a);f(g._tileset)&&(g._tileset.skipLevelOfDetail=a)}});this.skipLevelOfDetail=!0;var ha=r.observable();r.defineProperty(this,"skipScreenSpaceErrorFactor",{get:function(){return ha()},set:function(a){a=Number(a);isNaN(a)||(ha(a),f(g._tileset)&&(g._tileset.skipScreenSpaceErrorFactor=a))}});this.skipScreenSpaceErrorFactor=16;var pa=r.observable();r.defineProperty(this,"baseScreenSpaceError",{get:function(){return pa()},set:function(a){a=Number(a);isNaN(a)||(pa(a),f(g._tileset)&&(g._tileset.baseScreenSpaceError=a))}});this.baseScreenSpaceError=1024;var oa=r.observable();r.defineProperty(this,"skipLevels",{get:function(){return oa()},set:function(a){a=Number(a);isNaN(a)||(oa(a),f(g._tileset)&&(g._tileset.skipLevels=a))}});this.skipLevels=1;var qa=r.observable();r.defineProperty(this,"immediatelyLoadDesiredLevelOfDetail",{get:function(){return qa()},set:function(a){qa(a);f(g._tileset)&&(g._tileset.immediatelyLoadDesiredLevelOfDetail=a)}});this.immediatelyLoadDesiredLevelOfDetail=!1;var ua=r.observable();r.defineProperty(this,"loadSiblings",{get:function(){return ua()},set:function(a){ua(a);f(g._tileset)&&(g._tileset.loadSiblings=a)}});this.loadSiblings=!1;this._style=void 0;this._shouldStyle=!1;this._definedProperties="properties dynamicScreenSpaceError colorBlendMode picking colorize wireframe showBoundingVolumes showContentBoundingVolumes showRequestVolumes freezeFrame maximumScreenSpaceError dynamicScreenSpaceErrorDensity baseScreenSpaceError skipScreenSpaceErrorFactor skipLevelOfDetail skipLevels immediatelyLoadDesiredLevelOfDetail loadSiblings dynamicScreenSpaceErrorDensitySliderValue dynamicScreenSpaceErrorFactor pickActive showOnlyPickedTileDebugLabel showGeometricError showRenderingStatistics showMemoryUsage showUrl pointCloudShading geometricErrorScale maximumAttenuation baseResolution eyeDomeLighting eyeDomeLightingStrength eyeDomeLightingRadius".split(" ");this._removePostRenderEvent=a.postRender.addEventListener(function(){g._update()});f(this._tileset)||u(this,!0)}function x(a){if(0<a.featuresLength)return!0;a=a.innerContents;if(f(a)){for(var b=a.length,c=0;c<b;++c)if(!x(a[c]))return!1;return!0}return!1}var D={maximumFractionDigits:3},v=[{text:"Highlight",value:e.HIGHLIGHT},{text:"Replace",value:e.REPLACE},{text:"Mix",value:e.MIX}],B=new a(1,1,0,.4),C=new a,F=new a;k(z.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},statisticsText:{get:function(){return this._statisticsText}},pickStatisticsText:{get:function(){return this._pickStatisticsText}},colorBlendModes:{get:function(){return v}},editorError:{get:function(){return this._editorError}},tileset:{get:function(){return this._tileset},set:function(a){this._tileset=a;this._style=void 0;this.styleString="{}";this.tile=this.feature=void 0;if(f(a)){var b=this;a.readyPromise.then(function(a){b.isDestroyed()||b._properties(a.properties)});for(var c="colorize wireframe showBoundingVolumes showContentBoundingVolumes showRequestVolumes freezeFrame showOnlyPickedTileDebugLabel showGeometricError showRenderingStatistics showMemoryUsage showUrl".split(" "),d=c.length,e=0;e<d;++e){var g=c[e];this[g]=this[g]}this.maximumScreenSpaceError=a.maximumScreenSpaceError;this.dynamicScreenSpaceError=a.dynamicScreenSpaceError;this.dynamicScreenSpaceErrorDensity=a.dynamicScreenSpaceErrorDensity;this.dynamicScreenSpaceErrorFactor=a.dynamicScreenSpaceErrorFactor;this.colorBlendMode=a.colorBlendMode;this.skipLevelOfDetail=a.skipLevelOfDetail;this.skipScreenSpaceErrorFactor=a.skipScreenSpaceErrorFactor;this.baseScreenSpaceError=a.baseScreenSpaceError;this.skipLevels=a.skipLevels;this.immediatelyLoadDesiredLevelOfDetail=a.immediatelyLoadDesiredLevelOfDetail;this.loadSiblings=a.loadSiblings;c=a.pointCloudShading;this.pointCloudShading=c.attenuation;this.geometricErrorScale=c.geometricErrorScale;this.maximumAttenuation=c.maximumAttenuation?c.maximumAttenuation:0;this.baseResolution=c.baseResolution?c.baseResolution:0;this.eyeDomeLighting=c.eyeDomeLighting;this.eyeDomeLightingStrength=c.eyeDomeLightingStrength;this.eyeDomeLightingRadius=c.eyeDomeLightingRadius;this._scene.requestRender()}else this._properties({});this._statisticsText=A(a,!1);this._pickStatisticsText=A(a,!0);u(this,!1)}},feature:{get:function(){return this._feature},set:function(b){if(this._feature!==b){var c=this._feature;f(c)&&!c.content.isDestroyed()&&(!this.colorize&&f(this._style)?c.color=f(this._style.color)?this._style.color.evaluateColor(c,C):a.WHITE:c.color=F,this._scene.requestRender());f(b)&&(a.clone(b.color,F),b.color=B,this._scene.requestRender());this._feature=b}}},tile:{get:function(){return this._tile},set:function(b){if(this._tile!==b){var c=this._tile;!f(c)||c.isDestroyed()||x(c.content)||(c.color=F,this._scene.requestRender());f(b)&&!x(b.content)&&(a.clone(b.color,F),b.color=B,this._scene.requestRender());this._tile=b}}}});z.prototype.togglePickTileset=function(){this.pickActive=!this.pickActive};z.prototype.toggleInspector=function(){this.inspectorVisible=!this.inspectorVisible};z.prototype.toggleTileset=function(){this.tilesetVisible=!this.tilesetVisible};z.prototype.toggleDisplay=function(){this.displayVisible=!this.displayVisible};z.prototype.toggleUpdate=function(){this.updateVisible=!this.updateVisible};z.prototype.toggleLogging=function(){this.loggingVisible=!this.loggingVisible};z.prototype.toggleStyle=function(){this.styleVisible=!this.styleVisible};z.prototype.toggleTileDebugLabels=function(){this.tileDebugLabelsVisible=!this.tileDebugLabelsVisible};z.prototype.toggleOptimization=function(){this.optimizationVisible=!this.optimizationVisible};z.prototype.trimTilesCache=function(){f(this._tileset)&&this._tileset.trimLoadedTiles()};z.prototype.compileStyle=function(){var a=this._tileset;if(f(a)&&this.styleString!==JSON.stringify(a.style)){this._editorError="";try{0===this.styleString.length&&(this.styleString="{}"),this._style=new q(JSON.parse(this.styleString)),this._shouldStyle=!0,this._scene.requestRender()}catch(J){this._editorError=J.toString()}this.feature=this._feature;this.tile=this._tile}};z.prototype.styleEditorKeyPress=function(a,b){if(9===b.keyCode){b.preventDefault();var c=b.target,d=c.selectionStart,e=c.selectionEnd,f=e,g=c.value.slice(d,e).split("\n"),h=g.length,k;if(b.shiftKey)for(k=0;k<h;++k)" "===g[k][0]&&(" "===g[k][1]?(g[k]=g[k].substr(2),f-=2):(g[k]=g[k].substr(1),--f));else for(k=0;k<h;++k)g[k]="  "+g[k],f+=2;g=g.join("\n");c.value=c.value.slice(0,d)+g+c.value.slice(e);c.selectionStart=d!==e?d:f;c.selectionEnd=f}else!b.ctrlKey||10!==b.keyCode&&13!==b.keyCode||this.compileStyle();return!0};z.prototype._update=function(){var a=this._tileset;this.performance&&this._performanceDisplay.update();if(f(a)){if(a.isDestroyed()){this.tileset=this.feature=this.tile=void 0;return}var b=a.style;this._style!==a.style&&(this._shouldStyle?(a.style=this._style,this._shouldStyle=!1):(this._style=b,this.styleString=JSON.stringify(b.style,null,"  ")))}this.showStatistics&&(this._statisticsText=A(a,!1),this._pickStatisticsText=A(a,!0))};z.prototype.isDestroyed=function(){return!1};z.prototype.destroy=function(){this._eventHandler.destroy();this._removePostRenderEvent();var a=this;this._definedProperties.forEach(function(b){r.getObservable(a,b).dispose()});return g(this)};z.getStatistics=A;return z});F("Widgets/Cesium3DTilesInspector/Cesium3DTilesInspector","../../Core/Check ../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../ThirdParty/knockout ../getElement ../InspectorShared ./Cesium3DTilesInspectorViewModel".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a,f){b.defined("container",a);b.typeOf.object("scene",f);a=m(a);var c=document.createElement("div"),g=document.createElement("div");g.setAttribute("data-bind","visible: performance");var k=new h(f,g);this._viewModel=k;this._container=a;this._element=c;var p=document.createElement("div");p.textContent="3D Tiles Inspector";p.className="cesium-cesiumInspector-button";p.setAttribute("data-bind","click: toggleInspector");c.appendChild(p);c.className="cesium-cesiumInspector cesium-3DTilesInspector";c.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : inspectorVisible, "cesium-cesiumInspector-hidden" : !inspectorVisible}');a.appendChild(c);var r=document.createElement("div");this._panel=r;r.className="cesium-cesiumInspector-dropDown";c.appendChild(r);var t=e.createSection,p=e.createCheckbox,D=t(r,"Tileset","tilesetVisible","toggleTileset"),v=t(r,"Display","displayVisible","toggleDisplay"),B=t(r,"Update","updateVisible","toggleUpdate"),C=t(r,"Logging","loggingVisible","toggleLogging"),F=t(r,"Tile Debug Labels","tileDebugLabelsVisible","toggleTileDebugLabels"),H=t(r,"Style","styleVisible","toggleStyle"),r=t(r,"Optimization","optimizationVisible","toggleOptimization"),t=document.createElement("div");t.className="field-group";var J=document.createElement("label");J.className="field-label";J.appendChild(document.createTextNode("Properties: "));var w=document.createElement("div");w.setAttribute("data-bind","text: properties");t.appendChild(J);t.appendChild(w);D.appendChild(t);D.appendChild(q("togglePickTileset","Pick Tileset","pickActive"));D.appendChild(q("trimTilesCache","Trim Tiles Cache"));D.appendChild(p("Enable Picking","picking"));v.appendChild(p("Colorize","colorize"));v.appendChild(p("Wireframe","wireframe"));v.appendChild(p("Bounding Volumes","showBoundingVolumes"));v.appendChild(p("Content Volumes","showContentBoundingVolumes"));v.appendChild(p("Request Volumes","showRequestVolumes"));v.appendChild(p("Point Cloud Shading","pointCloudShading"));D=document.createElement("div");D.setAttribute("data-bind","visible: pointCloudShading");D.appendChild(d("geometricErrorScale",0,2,.01,"Geometric Error Scale"));D.appendChild(d("maximumAttenuation",0,32,1,"Maximum Attenuation"));D.appendChild(d("baseResolution",0,1,.01,"Base Resolution"));D.appendChild(p("Eye Dome Lighting (EDL)","eyeDomeLighting"));v.appendChild(D);v=document.createElement("div");v.setAttribute("data-bind","visible: eyeDomeLighting");v.appendChild(d("eyeDomeLightingStrength",0,2,.1,"EDL Strength"));v.appendChild(d("eyeDomeLightingRadius",0,4,.1,"EDL Radius"));D.appendChild(v);B.appendChild(p("Freeze Frame","freezeFrame"));B.appendChild(p("Dynamic Screen Space Error","dynamicScreenSpaceError"));v=document.createElement("div");v.appendChild(d("maximumScreenSpaceError",0,128,1,"Maximum Screen Space Error"));B.appendChild(v);v=document.createElement("div");v.setAttribute("data-bind","visible: dynamicScreenSpaceError");v.appendChild(d("dynamicScreenSpaceErrorDensitySliderValue",0,1,.005,"Screen Space Error Density","dynamicScreenSpaceErrorDensity"));v.appendChild(d("dynamicScreenSpaceErrorFactor",1,10,.1,"Screen Space Error Factor"));B.appendChild(v);C.appendChild(p("Performance","performance"));C.appendChild(g);C.appendChild(p("Statistics","showStatistics"));g=document.createElement("div");g.className="cesium-3dTilesInspector-statistics";g.setAttribute("data-bind","html: statisticsText, visible: showStatistics");C.appendChild(g);C.appendChild(p("Pick Statistics","showPickStatistics"));g=document.createElement("div");g.className="cesium-3dTilesInspector-statistics";g.setAttribute("data-bind","html: pickStatisticsText, visible: showPickStatistics");C.appendChild(g);C=document.createElement("div");H.appendChild(C);C.appendChild(document.createTextNode("Color Blend Mode: "));H=document.createElement("select");H.setAttribute("data-bind",'options: colorBlendModes, optionsText: "text", optionsValue: "value", value: colorBlendMode');C.appendChild(H);H=document.createElement("textarea");H.setAttribute("data-bind","textInput: styleString, event: { keydown: styleEditorKeyPress }");C.className="cesium-cesiumInspector-styleEditor";C.appendChild(H);H=q("compileStyle","Compile (Ctrl+Enter)");C.appendChild(H);H=document.createElement("div");H.className="cesium-cesiumInspector-error";H.setAttribute("data-bind","text: editorError");C.appendChild(H);F.appendChild(p("Show Picked Only","showOnlyPickedTileDebugLabel"));F.appendChild(p("Geometric Error","showGeometricError"));F.appendChild(p("Rendering Statistics","showRenderingStatistics"));F.appendChild(p("Memory Usage (MB)","showMemoryUsage"));F.appendChild(p("Url","showUrl"));r.appendChild(p("Skip Tile LODs","skipLevelOfDetail"));F=document.createElement("div");F.appendChild(d("skipScreenSpaceErrorFactor",1,50,1,"Skip SSE Factor"));r.appendChild(F);F=document.createElement("div");F.appendChild(d("baseScreenSpaceError",0,4096,1,"SSE before skipping LOD"));r.appendChild(F);F=document.createElement("div");F.appendChild(d("skipLevels",0,10,1,"Min. levels to skip"));r.appendChild(F);r.appendChild(p("Load only tiles that meet the max SSE.","immediatelyLoadDesiredLevelOfDetail"));r.appendChild(p("Load siblings of visible tiles","loadSiblings"));l.applyBindings(k,c)}function d(b,d,c,e,f,g){g=a(g,b);var h=document.createElement("input");h.setAttribute("data-bind","value: "+g);h.type="number";g=document.createElement("input");g.type="range";g.min=d;g.max=c;g.step=e;g.setAttribute("data-bind",'valueUpdate: "input", value: '+b);b=document.createElement("div");b.appendChild(g);d=document.createElement("div");d.className="cesium-cesiumInspector-slider";d.appendChild(document.createTextNode(f));d.appendChild(h);d.appendChild(b);return d}function q(a,b,c){var d=document.createElement("button");d.type="button";d.textContent=b;d.className="cesium-cesiumInspector-pickButton";a="click: "+a;f(c)&&(a+=', css: {"cesium-cesiumInspector-pickButtonHighlight" : '+c+"}");d.setAttribute("data-bind",a);return d}k(p.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});p.prototype.isDestroyed=function(){return!1};p.prototype.destroy=function(){l.cleanNode(this._element);this._container.removeChild(this._element);this.viewModel.destroy();return g(this)};return p});F("Widgets/CesiumInspector/CesiumInspectorViewModel","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/Rectangle ../../Core/ScreenSpaceEventHandler ../../Core/ScreenSpaceEventType ../../Scene/DebugModelMatrixPrimitive ../../Scene/PerformanceDisplay ../../Scene/TileCoordinatesImageryProvider ../../ThirdParty/knockout ../createCommand".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(a,b,d){b=Math.min(d,b);return b=Math.max(b,a)}function r(a,f){function c(a){a=u._scene.pick({x:a.position.x,y:a.position.y});b(a)&&(u.primitive=b(a.collection)?a.collection:a.primitive);u._scene.requestRender();u.pickPrimitiveActive=!1}function r(a){var c,d=v.ellipsoid;a=u._scene.camera.pickEllipsoid({x:a.position.x,y:a.position.y},d);if(b(a)){d=d.cartesianToCartographic(a);a=v._surface.tileProvider._tilesToRenderByTextureCount;for(var e=0;!c&&e<a.length;++e){var f=a[e];if(b(f))for(var h=0;!c&&h<f.length;++h){var k=f[h];g.contains(k.rectangle,d)&&(c=k)}}}u.tile=c;u.pickTileActive=!1}if(!b(a))throw new k("scene is required");if(!b(f))throw new k("performanceContainer is required");var u=this,x=a.canvas,D=new l(x);this._eventHandler=D;this._scene=a;this._canvas=x;this._performanceDisplay=this._modelMatrixPrimitive=this._tile=this._primitive=void 0;this._performanceContainer=f;var v=this._scene.globe;v.depthTestAgainstTerrain=!0;this.performance=this.frustumPlanes=this.frustums=!1;this.shaderCacheText="";this.pickDepth=this.globeDepth=this.wireframe=this.filterTile=this.tileBoundingSphere=this.filterPrimitive=this.primitiveReferenceFrame=this.primitiveBoundingSphere=!1;this._numberOfFrustums=this.depthFrustum=1;this.frustumStatisticText=this.tileCoordinates=this.suspendUpdates=!1;this.tileText="";this.pickTileActive=this.pickPrimitiveActive=this.hasPickedTile=this.hasPickedPrimitive=!1;this.generalVisible=this.dropDownVisible=!0;this.terrainVisible=this.primitivesVisible=!1;this.depthFrustumText="";d.track(this,"frustums frustumPlanes performance shaderCacheText primitiveBoundingSphere primitiveReferenceFrame filterPrimitive tileBoundingSphere filterTile wireframe globeDepth pickDepth depthFrustum suspendUpdates tileCoordinates frustumStatisticText tileText hasPickedPrimitive hasPickedTile pickPrimitiveActive pickTileActive dropDownVisible generalVisible primitivesVisible terrainVisible depthFrustumText".split(" "));this._toggleDropDown=q(function(){u.dropDownVisible=!u.dropDownVisible});this._toggleGeneral=q(function(){u.generalVisible=!u.generalVisible});this._togglePrimitives=q(function(){u.primitivesVisible=!u.primitivesVisible});this._toggleTerrain=q(function(){u.terrainVisible=!u.terrainVisible});this._frustumsSubscription=d.getObservable(this,"frustums").subscribe(function(a){u._scene.debugShowFrustums=a;u._scene.requestRender()});this._frustumPlanesSubscription=d.getObservable(this,"frustumPlanes").subscribe(function(a){u._scene.debugShowFrustumPlanes=a;u._scene.requestRender()});this._performanceSubscription=d.getObservable(this,"performance").subscribe(function(a){a?u._performanceDisplay=new h({container:u._performanceContainer}):u._performanceContainer.innerHTML=""});this._showPrimitiveBoundingSphere=q(function(){u._primitive.debugShowBoundingVolume=u.primitiveBoundingSphere;u._scene.requestRender();return!0});this._primitiveBoundingSphereSubscription=d.getObservable(this,"primitiveBoundingSphere").subscribe(function(){u._showPrimitiveBoundingSphere()});this._showPrimitiveReferenceFrame=q(function(){u.primitiveReferenceFrame?(u._modelMatrixPrimitive=new e({modelMatrix:u._primitive.modelMatrix}),u._scene.primitives.add(u._modelMatrixPrimitive)):b(u._modelMatrixPrimitive)&&(u._scene.primitives.remove(u._modelMatrixPrimitive),u._modelMatrixPrimitive=void 0);u._scene.requestRender();return!0});this._primitiveReferenceFrameSubscription=d.getObservable(this,"primitiveReferenceFrame").subscribe(function(){u._showPrimitiveReferenceFrame()});this._doFilterPrimitive=q(function(){u._scene.debugCommandFilter=u.filterPrimitive?function(a){return b(u._modelMatrixPrimitive)&&a.owner===u._modelMatrixPrimitive._primitive?!0:b(u._primitive)?a.owner===u._primitive||a.owner===u._primitive._billboardCollection||a.owner.primitive===u._primitive:!1}:void 0;return!0});this._filterPrimitiveSubscription=d.getObservable(this,"filterPrimitive").subscribe(function(){u._doFilterPrimitive();u._scene.requestRender()});this._wireframeSubscription=d.getObservable(this,"wireframe").subscribe(function(a){v._surface.tileProvider._debug.wireframe=a;u._scene.requestRender()});this._globeDepthSubscription=d.getObservable(this,"globeDepth").subscribe(function(a){u._scene.debugShowGlobeDepth=a;u._scene.requestRender()});this._pickDepthSubscription=d.getObservable(this,"pickDepth").subscribe(function(a){u._scene.debugShowPickDepth=a;u._scene.requestRender()});this._depthFrustumSubscription=d.getObservable(this,"depthFrustum").subscribe(function(a){u._scene.debugShowDepthFrustum=a;u._scene.requestRender()});this._incrementDepthFrustum=q(function(){u.depthFrustum=t(1,u._numberOfFrustums,u.depthFrustum+1);u._scene.requestRender();return!0});this._decrementDepthFrustum=q(function(){u.depthFrustum=t(1,u._numberOfFrustums,u.depthFrustum-1);u._scene.requestRender();return!0});this._suspendUpdatesSubscription=d.getObservable(this,"suspendUpdates").subscribe(function(a){v._surface._debug.suspendLodUpdate=a;a||(u.filterTile=!1)});var B;this._showTileCoordinates=q(function(){u.tileCoordinates&&!b(B)?B=a.imageryLayers.addImageryProvider(new p({tilingScheme:a.terrainProvider.tilingScheme})):!u.tileCoordinates&&b(B)&&(a.imageryLayers.remove(B),B=void 0);return!0});this._tileCoordinatesSubscription=d.getObservable(this,"tileCoordinates").subscribe(function(){u._showTileCoordinates();u._scene.requestRender()});this._tileBoundingSphereSubscription=d.getObservable(this,"tileBoundingSphere").subscribe(function(){u._showTileBoundingSphere();u._scene.requestRender()});this._showTileBoundingSphere=q(function(){v._surface.tileProvider._debug.boundingSphereTile=u.tileBoundingSphere?u._tile:void 0;u._scene.requestRender();return!0});this._doFilterTile=q(function(){u.filterTile?(u.suspendUpdates=!0,v._surface._tilesToRender=[],b(u._tile)&&u._tile.renderable&&v._surface._tilesToRender.push(u._tile)):u.suspendUpdates=!1;return!0});this._filterTileSubscription=d.getObservable(this,"filterTile").subscribe(function(){u.doFilterTile();u._scene.requestRender()});this._pickPrimitive=q(function(){u.pickPrimitiveActive=!u.pickPrimitiveActive});this._pickPrimitiveActiveSubscription=d.getObservable(this,"pickPrimitiveActive").subscribe(function(a){a?D.setInputAction(c,m.LEFT_CLICK):D.removeInputAction(m.LEFT_CLICK)});this._pickTile=q(function(){u.pickTileActive=!u.pickTileActive});this._pickTileActiveSubscription=d.getObservable(this,"pickTileActive").subscribe(function(a){a?D.setInputAction(r,m.LEFT_CLICK):D.removeInputAction(m.LEFT_CLICK)});this._removePostRenderEvent=a.postRender.addEventListener(function(){u._update()})}a(r.prototype,{scene:{get:function(){return this._scene}},performanceContainer:{get:function(){return this._performanceContainer}},toggleDropDown:{get:function(){return this._toggleDropDown}},showPrimitiveBoundingSphere:{get:function(){return this._showPrimitiveBoundingSphere}},showPrimitiveReferenceFrame:{get:function(){return this._showPrimitiveReferenceFrame}},doFilterPrimitive:{get:function(){return this._doFilterPrimitive}},incrementDepthFrustum:{get:function(){return this._incrementDepthFrustum}},decrementDepthFrustum:{get:function(){return this._decrementDepthFrustum}},showTileCoordinates:{get:function(){return this._showTileCoordinates}},showTileBoundingSphere:{get:function(){return this._showTileBoundingSphere}},doFilterTile:{get:function(){return this._doFilterTile}},toggleGeneral:{get:function(){return this._toggleGeneral}},togglePrimitives:{get:function(){return this._togglePrimitives}},toggleTerrain:{get:function(){return this._toggleTerrain}},pickPrimitive:{get:function(){return this._pickPrimitive}},pickTile:{get:function(){return this._pickTile}},selectParent:{get:function(){var a=this;return q(function(){a.tile=a.tile.parent})}},selectNW:{get:function(){var a=this;return q(function(){a.tile=a.tile.northwestChild})}},selectNE:{get:function(){var a=this;return q(function(){a.tile=a.tile.northeastChild})}},selectSW:{get:function(){var a=this;return q(function(){a.tile=a.tile.southwestChild})}},selectSE:{get:function(){var a=this;return q(function(){a.tile=a.tile.southeastChild})}},primitive:{get:function(){return this._primitive},set:function(a){var c=this._primitive;a!==c&&(this.hasPickedPrimitive=!0,b(c)&&(c.debugShowBoundingVolume=!1),this._scene.debugCommandFilter=void 0,b(this._modelMatrixPrimitive)&&(this._scene.primitives.remove(this._modelMatrixPrimitive),this._modelMatrixPrimitive=void 0),this._primitive=a,a.show=!1,setTimeout(function(){a.show=!0},50),this.showPrimitiveBoundingSphere(),this.showPrimitiveReferenceFrame(),this.doFilterPrimitive())}},tile:{get:function(){return this._tile},set:function(a){if(b(a)){this.hasPickedTile=!0;if(a!==this._tile){this.tileText="L: "+a.level+" X: "+a.x+" Y: "+a.y;this.tileText+="\x3cbr\x3eSW corner: "+a.rectangle.west+", "+a.rectangle.south;this.tileText+="\x3cbr\x3eNE corner: "+a.rectangle.east+", "+a.rectangle.north;var c=a.data;b(c)&&b(c.tileBoundingRegion)?this.tileText+="\x3cbr\x3eMin: "+c.tileBoundingRegion.minimumHeight+" Max: "+c.tileBoundingRegion.maximumHeight:this.tileText+="\x3cbr\x3e(Tile is not loaded)"}this._tile=a;this.showTileBoundingSphere();this.doFilterTile()}else this.hasPickedTile=!1,this._tile=void 0}}});r.prototype._update=function(){if(this.frustums){var a=this._scene.debugFrustumStatistics,d;if(b(a)){d="Command Statistics";var e=a.commandsInFrustums,f;for(f in e)if(e.hasOwnProperty(f)){var g=parseInt(f,10);if(7===g)g="1, 2 and 3";else{for(var h=[],k=2;0<=k;k--){var l=Math.pow(2,k);g>=l&&(h.push(k+1),g-=l)}g=h.reverse().join(" and ")}d+="\x3cbr\x3e\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+e[f]+" in frustum "+g}d+="\x3cbr\x3eTotal: "+a.totalCommands}this.frustumStatisticText=d}this._numberOfFrustums=a=this._scene.numberOfFrustums;this.depthFrustum=t(1,a,this.depthFrustum);this.depthFrustumText=this.depthFrustum+" of "+a;this.performance&&this._performanceDisplay.update();this.primitiveReferenceFrame&&(this._modelMatrixPrimitive.modelMatrix=this._primitive.modelMatrix);this.shaderCacheText="Cached shaders: "+this._scene.context.shaderCache.numberOfShaders};r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){this._eventHandler.destroy();this._removePostRenderEvent();this._frustumsSubscription.dispose();this._frustumPlanesSubscription.dispose();this._performanceSubscription.dispose();this._primitiveBoundingSphereSubscription.dispose();this._primitiveReferenceFrameSubscription.dispose();this._filterPrimitiveSubscription.dispose();this._wireframeSubscription.dispose();this._globeDepthSubscription.dispose();this._pickDepthSubscription.dispose();this._depthFrustumSubscription.dispose();this._suspendUpdatesSubscription.dispose();this._tileCoordinatesSubscription.dispose();this._tileBoundingSphereSubscription.dispose();this._filterTileSubscription.dispose();this._pickPrimitiveActiveSubscription.dispose();this._pickTileActiveSubscription.dispose();return f(this)};return r});F("Widgets/CesiumInspector/CesiumInspector","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../ThirdParty/knockout ../getElement ../InspectorShared ./CesiumInspectorViewModel".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d){if(!b(a))throw new k("container is required.");if(!b(d))throw new k("scene is required.");a=l(a);var f=document.createElement("div"),h=new e(d,f);this._viewModel=h;this._container=a;var p=document.createElement("div");this._element=p;var c=document.createElement("div");c.textContent="Cesium Inspector";c.className="cesium-cesiumInspector-button";c.setAttribute("data-bind","click: toggleDropDown");p.appendChild(c);p.className="cesium-cesiumInspector";p.setAttribute("data-bind",'css: { "cesium-cesiumInspector-visible" : dropDownVisible, "cesium-cesiumInspector-hidden" : !dropDownVisible }');a.appendChild(this._element);this._panel=c=document.createElement("div");c.className="cesium-cesiumInspector-dropDown";p.appendChild(c);var u=m.createSection,p=m.createCheckbox,y=u(c,"General","generalVisible","toggleGeneral"),A=p("Show Frustums","frustums"),z=document.createElement("div");z.className="cesium-cesiumInspector-frustumStatistics";z.setAttribute("data-bind","visible: frustums, html: frustumStatisticText");A.appendChild(z);y.appendChild(A);y.appendChild(p("Show Frustum Planes","frustumPlanes"));y.appendChild(p("Performance Display","performance"));f.className="cesium-cesiumInspector-performanceDisplay";y.appendChild(f);f=document.createElement("div");f.className="cesium-cesiumInspector-shaderCache";f.setAttribute("data-bind","html: shaderCacheText");y.appendChild(f);f=document.createElement("div");y.appendChild(f);y=document.createElement("span");y.setAttribute("data-bind",'html: "\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;Frustum:"');f.appendChild(y);y=document.createElement("span");y.setAttribute("data-bind","text: depthFrustumText");f.appendChild(y);y=document.createElement("input");y.type="button";y.value="-";y.className="cesium-cesiumInspector-pickButton";y.setAttribute("data-bind","click: decrementDepthFrustum");f.appendChild(y);y=document.createElement("input");y.type="button";y.value="+";y.className="cesium-cesiumInspector-pickButton";y.setAttribute("data-bind","click: incrementDepthFrustum");f.appendChild(y);f=u(c,"Primitives","primitivesVisible","togglePrimitives");y=document.createElement("div");y.className="cesium-cesiumInspector-pickSection";f.appendChild(y);A=document.createElement("input");A.type="button";A.value="Pick a primitive";A.className="cesium-cesiumInspector-pickButton";A.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickPrimitiveActive}, click: pickPrimitive');f=document.createElement("div");f.className="cesium-cesiumInspector-center";f.appendChild(A);y.appendChild(f);y.appendChild(p("Show bounding sphere","primitiveBoundingSphere","hasPickedPrimitive"));y.appendChild(p("Show reference frame","primitiveReferenceFrame","hasPickedPrimitive"));this._primitiveOnly=p("Show only selected","filterPrimitive","hasPickedPrimitive");y.appendChild(this._primitiveOnly);c=u(c,"Terrain","terrainVisible","toggleTerrain");u=document.createElement("div");u.className="cesium-cesiumInspector-pickSection";c.appendChild(u);y=document.createElement("input");y.type="button";y.value="Pick a tile";y.className="cesium-cesiumInspector-pickButton";y.setAttribute("data-bind",'css: {"cesium-cesiumInspector-pickButtonHighlight" : pickTileActive}, click: pickTile');f=document.createElement("div");f.appendChild(y);f.className="cesium-cesiumInspector-center";u.appendChild(f);f=document.createElement("div");u.appendChild(f);var x=document.createElement("input");x.type="button";x.value="Parent";x.className="cesium-cesiumInspector-pickButton";x.setAttribute("data-bind","click: selectParent");var D=document.createElement("input");D.type="button";D.value="NW";D.className="cesium-cesiumInspector-pickButton";D.setAttribute("data-bind","click: selectNW");var v=document.createElement("input");v.type="button";v.value="NE";v.className="cesium-cesiumInspector-pickButton";v.setAttribute("data-bind","click: selectNE");A=document.createElement("input");A.type="button";A.value="SW";A.className="cesium-cesiumInspector-pickButton";A.setAttribute("data-bind","click: selectSW");y=document.createElement("input");y.type="button";y.value="SE";y.className="cesium-cesiumInspector-pickButton";y.setAttribute("data-bind","click: selectSE");z=document.createElement("div");z.className="cesium-cesiumInspector-tileText";f.className="cesium-cesiumInspector-frustumStatistics";f.appendChild(z);f.setAttribute("data-bind","visible: hasPickedTile");z.setAttribute("data-bind","html: tileText");z=document.createElement("div");z.className="cesium-cesiumInspector-relativeText";z.textContent="Select relative:";f.appendChild(z);var z=document.createElement("table"),B=document.createElement("tr"),C=document.createElement("tr"),F=document.createElement("td");F.appendChild(x);x=document.createElement("td");x.appendChild(D);D=document.createElement("td");D.appendChild(v);B.appendChild(F);B.appendChild(x);B.appendChild(D);v=document.createElement("td");D=document.createElement("td");D.appendChild(A);A=document.createElement("td");A.appendChild(y);C.appendChild(v);C.appendChild(D);C.appendChild(A);z.appendChild(B);z.appendChild(C);f.appendChild(z);u.appendChild(p("Show bounding volume","tileBoundingSphere","hasPickedTile"));u.appendChild(p("Show only selected","filterTile","hasPickedTile"));c.appendChild(p("Wireframe","wireframe"));c.appendChild(p("Suspend LOD update","suspendUpdates"));c.appendChild(p("Show tile coordinates","tileCoordinates"));g.applyBindings(h,this._element)}a(h.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){g.cleanNode(this._element);this._container.removeChild(this._element);this.viewModel.destroy();return f(this)};return h});F("Widgets/CesiumWidget/CesiumWidget","../../Core/buildModuleUrl ../../Core/Cartesian3 ../../Core/Clock ../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/Ellipsoid ../../Core/FeatureDetection ../../Core/formatError ../../Core/requestAnimationFrame ../../Core/ScreenSpaceEventHandler ../../Scene/createWorldImagery ../../Scene/Globe ../../Scene/Moon ../../Scene/Scene ../../Scene/SceneMode ../../Scene/ShadowMode ../../Scene/SkyAtmosphere ../../Scene/SkyBox ../../Scene/Sun ../../FeSceneEx/FeClound ../../FeSceneEx/FeFlatClound ../../FeSceneEx/FeSkyStar ../../FeSceneEx/FeConstellation ../getElement".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,x,D,v,B,C,F,H,J){function w(a){return b("Assets/Textures/SkyBox/tycho2t3_80_"+a+".jpg")}function G(a){function b(d){if(!a.isDestroyed())if(a._useDefaultRenderLoop)try{var e=a._targetFrameRate;if(g(e)){var e=1E3/e,f=d-c;f>e&&(a.resize(),a.render(),c=d-f%e)}else a.resize(),a.render();q(b)}catch(W){a._useDefaultRenderLoop=!1,a._renderLoopRunning=!1,a._showRenderLoopErrors&&a.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,W)}else a._renderLoopRunning=!1}a._renderLoopRunning=!0;var c=0;q(b)}function E(a){var b=a._canvas,c=b.clientWidth,d=b.clientHeight,e=a._resolutionScale;a._supportsImageRenderingPixelated||(e*=k(window.devicePixelRatio,1));a._canvasWidth=c;a._canvasHeight=d;c*=e;d*=e;b.width=c;b.height=d;a._canRender=0!==c&&0!==d}function I(a){var b=a._canvas,c=b.width,b=b.height;0!==c&&0!==b&&(a=a._scene.camera.frustum,g(a.aspectRatio)?a.aspectRatio=c/b:(a.top=b/c*a.right,a.bottom=-a.top))}function K(b,d){if(!g(b))throw new e("container is required.");b=J(b);d=k(d,{});var l=document.createElement("div");l.className="cesium-widget";b.appendChild(l);var m=document.createElement("canvas"),q=p.supportsImageRenderingPixelated();if(this._supportsImageRenderingPixelated=q)m.style.imageRendering=p.imageRenderingValue();m.oncontextmenu=function(){return!1};m.onselectstart=function(){return!1};l.appendChild(m);q=document.createElement("div");q.className="cesium-widget-credits";var G=g(d.creditContainer)?J(d.creditContainer):l;G.appendChild(q);var H=g(d.creditViewport)?J(d.creditViewport):l,K=k(d.showRenderLoopErrors,!0);this._element=l;this._container=b;this._canvas=m;this._canvasHeight=this._canvasWidth=0;this._creditViewport=H;this._creditContainer=G;this._innerCreditContainer=q;this._renderLoopRunning=this._canRender=!1;this._showRenderLoopErrors=K;this._resolutionScale=1;this._forceResize=!1;this._clock=g(d.clock)?d.clock:new f;E(this);try{var L=new y({canvas:m,contextOptions:d.contextOptions,creditContainer:q,creditViewport:H,mapProjection:d.mapProjection,orderIndependentTranslucency:d.orderIndependentTranslucency,scene3DOnly:k(d.scene3DOnly,!1),terrainExaggeration:d.terrainExaggeration,shadows:d.shadows,mapMode2D:d.mapMode2D,requestRenderMode:d.requestRenderMode,maximumRenderTimeChange:d.maximumRenderTimeChange});this._scene=L;L.camera.constrainedAxis=a.UNIT_Z;I(this);var N=k(L.mapProjection.ellipsoid,h.WGS84),P=d.globe;g(P)||(P=new c(N));!1!==P&&(L.globe=P,L.globe.shadows=k(d.terrainShadows,z.RECEIVE_ONLY));var S=d.skyBox;g(S)||(S=new D({sources:{positiveX:w("px"),negativeX:w("mx"),positiveY:w("py"),negativeY:w("my"),positiveZ:w("pz"),negativeZ:w("mz")}}));!1!==S&&(L.skyBox=S,L.sun=new v,L.moon=new u);var ca=d.clound;g(ca)||(ca=new B({scene:L}));g(ca)&&(L.clound=ca);var T=d.flatClound;g(T)||(T=new C({scene:L}));g(T)&&(L.flatClound=T);var da=d.skyStar;g(da)||(da=new F({scene:L}));g(da)&&(L.skyStar=da);var V=d.skyAtmosphere;g(V)||(V=new x(N));!1!==V&&(L.skyAtmosphere=V);var ba=!1===d.globe?!1:d.imageryProvider;g(ba)||(ba=r());!1!==ba&&L.imageryLayers.addImageryProvider(ba);g(d.terrainProvider)&&!1!==d.globe&&(L.terrainProvider=d.terrainProvider);this._screenSpaceEventHandler=new t(m,!1);g(d.sceneMode)&&(d.sceneMode===A.SCENE2D&&this._scene.morphTo2D(0),d.sceneMode===A.COLUMBUS_VIEW&&this._scene.morphToColumbusView(0));this._useDefaultRenderLoop=void 0;this.useDefaultRenderLoop=k(d.useDefaultRenderLoop,!0);this._targetFrameRate=void 0;this.targetFrameRate=d.targetFrameRate;var X=this;L.renderError.addEventListener(function(a,b){X._useDefaultRenderLoop=!1;X._renderLoopRunning=!1;X._showRenderLoopErrors&&X.showErrorPanel("An error occurred while rendering.  Rendering has stopped.",void 0,b)})}catch(fa){throw K&&this.showErrorPanel("Error constructing CesiumWidget.",'Visit \x3ca href\x3d"http://get.webgl.org"\x3ehttp://get.webgl.org\x3c/a\x3e to verify that your web browser and hardware support WebGL.  Consider trying a different web browser or updating your video drivers.  Detailed error information is below:',fa),fa;}}l(K.prototype,{container:{get:function(){return this._container}},canvas:{get:function(){return this._canvas}},creditContainer:{get:function(){return this._creditContainer}},creditViewport:{get:function(){return this._creditViewport}},scene:{get:function(){return this._scene}},imageryLayers:{get:function(){return this._scene.imageryLayers}},terrainProvider:{get:function(){return this._scene.terrainProvider},set:function(a){this._scene.terrainProvider=a}},camera:{get:function(){return this._scene.camera}},clock:{get:function(){return this._clock}},screenSpaceEventHandler:{get:function(){return this._screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._targetFrameRate},set:function(a){if(0>=a)throw new e("targetFrameRate must be greater than 0, or undefined.");this._targetFrameRate=a}},useDefaultRenderLoop:{get:function(){return this._useDefaultRenderLoop},set:function(a){this._useDefaultRenderLoop!==a&&(this._useDefaultRenderLoop=a)&&!this._renderLoopRunning&&G(this)}},resolutionScale:{get:function(){return this._resolutionScale},set:function(a){if(0>=a)throw new e("resolutionScale must be greater than 0.");this._resolutionScale=a;this._forceResize=!0}}});K.prototype.showErrorPanel=function(a,b,c){function e(){m.style.maxHeight=Math.max(Math.round(.9*f.clientHeight-100),30)+"px"}var f=this._element,h=document.createElement("div");h.className="cesium-widget-errorPanel";var k=document.createElement("div");k.className="cesium-widget-errorPanel-content";h.appendChild(k);var l=document.createElement("div");l.className="cesium-widget-errorPanel-header";l.appendChild(document.createTextNode(a));k.appendChild(l);var m=document.createElement("div");m.className="cesium-widget-errorPanel-scroll";k.appendChild(m);e();g(window.addEventListener)&&window.addEventListener("resize",e,!1);g(b)&&(l=document.createElement("div"),l.className="cesium-widget-errorPanel-message",l.innerHTML="\x3cp\x3e"+b+"\x3c/p\x3e",m.appendChild(l));l="(no error details available)";g(c)&&(l=d(c));c=document.createElement("div");c.className="cesium-widget-errorPanel-message";c.appendChild(document.createTextNode(l));m.appendChild(c);c=document.createElement("div");c.className="cesium-widget-errorPanel-buttonPanel";k.appendChild(c);k=document.createElement("button");k.setAttribute("type","button");k.className="cesium-button";k.appendChild(document.createTextNode("OK"));k.onclick=function(){g(e)&&g(window.removeEventListener)&&window.removeEventListener("resize",e,!1);f.removeChild(h)};c.appendChild(k);f.appendChild(h);"undefined"!==typeof console&&console.error(a+"\n"+b+"\n"+l)};K.prototype.isDestroyed=function(){return!1};K.prototype.destroy=function(){this._scene=this._scene&&this._scene.destroy();this._container.removeChild(this._element);this._creditContainer.removeChild(this._innerCreditContainer);m(this)};K.prototype.resize=function(){var a=this._canvas,b=a.clientWidth,a=a.clientHeight;if(this._forceResize||this._canvasWidth!==b||this._canvasHeight!==a)this._forceResize=!1,E(this),I(this),this._scene.requestRender()};K.prototype.render=function(){if(this._canRender){this._scene.initializeFrame();var a=this._clock.tick();this._scene.render(a)}else this._clock.tick()};return K});F("Widgets/FullscreenButton/FullscreenButtonViewModel","../../Core/defaultValue ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/Fullscreen ../../ThirdParty/knockout ../createCommand ../getElement".split(" "),function(b,a,f,k,g,l,m,e){function h(a){var d=this,f=l.observable(g.fullscreen),h=l.observable(g.enabled);this.isFullscreen=void 0;l.defineProperty(this,"isFullscreen",{get:function(){return f()}});this.isFullscreenEnabled=void 0;l.defineProperty(this,"isFullscreenEnabled",{get:function(){return h()},set:function(a){h(a&&g.enabled)}});this.tooltip=void 0;l.defineProperty(this,"tooltip",function(){return this.isFullscreenEnabled?f()?"Exit full screen":"Full screen":"Full screen unavailable"});this._command=m(function(){g.fullscreen?g.exitFullscreen():g.requestFullscreen(d._fullscreenElement)},l.getObservable(this,"isFullscreenEnabled"));this._fullscreenElement=b(e(a),document.body);this._callback=function(){f(g.fullscreen)};document.addEventListener(g.changeEventName,this._callback)}a(h.prototype,{fullscreenElement:{get:function(){return this._fullscreenElement},set:function(a){if(!(a instanceof Element))throw new k("value must be a valid Element.");this._fullscreenElement=a}},command:{get:function(){return this._command}}});h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){document.removeEventListener(g.changeEventName,this._callback);f(this)};return h});F("Widgets/FullscreenButton/FullscreenButton","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../ThirdParty/knockout ../getElement ./FullscreenButtonViewModel".split(" "),function(b,a,f,k,g,l,m){function e(a,e){if(!b(a))throw new k("container is required.");a=l(a);var d=new m(e);d._exitFullScreenPath="M 104.34375 17.5625 L 83.5 38.4375 L 83.40625 18.21875 L 76.125 25.5 L 76.09375 51.78125 L 102.3125 51.8125 L 102.3125 51.78125 L 109.625 44.5 L 89.1875 44.40625 L 110.1875 23.40625 L 104.34375 17.5625 z M 23.75 17.59375 L 17.90625 23.4375 L 38.90625 44.4375 L 18.5 44.53125 L 25.78125 51.8125 L 52 51.78125 L 51.96875 25.53125 L 44.6875 18.25 L 44.625 38.46875 L 23.75 17.59375 z M 25.6875 76.03125 L 18.375 83.3125 L 38.78125 83.40625 L 17.8125 104.40625 L 23.625 110.25 L 44.5 89.375 L 44.59375 109.59375 L 51.875 102.3125 L 51.875 76.0625 L 25.6875 76.03125 z M 102.375 76.15625 L 76.15625 76.1875 L 76.1875 102.4375 L 83.46875 109.71875 L 83.5625 89.53125 L 104.40625 110.375 L 110.25 104.53125 L 89.25 83.53125 L 109.6875 83.46875 L 102.375 76.15625 z";d._enterFullScreenPath="M 83.96875 17.5625 L 83.96875 17.59375 L 76.65625 24.875 L 97.09375 24.96875 L 76.09375 45.96875 L 81.9375 51.8125 L 102.78125 30.9375 L 102.875 51.15625 L 110.15625 43.875 L 110.1875 17.59375 L 83.96875 17.5625 z M 44.125 17.59375 L 17.90625 17.625 L 17.9375 43.90625 L 25.21875 51.1875 L 25.3125 30.96875 L 46.15625 51.8125 L 52 45.96875 L 31 25 L 51.4375 24.90625 L 44.125 17.59375 z M 46.0625 76.03125 L 25.1875 96.875 L 25.09375 76.65625 L 17.8125 83.9375 L 17.8125 110.21875 L 44 110.25 L 51.3125 102.9375 L 30.90625 102.84375 L 51.875 81.875 L 46.0625 76.03125 z M 82 76.15625 L 76.15625 82 L 97.15625 103 L 76.71875 103.0625 L 84.03125 110.375 L 110.25 110.34375 L 110.21875 84.0625 L 102.9375 76.8125 L 102.84375 97 L 82 76.15625 z";var f=document.createElement("button");f.type="button";f.className="cesium-button cesium-fullscreenButton";f.setAttribute("data-bind","attr: { title: tooltip },click: command,enable: isFullscreenEnabled,cesiumSvgPath: { path: isFullscreen ? _exitFullScreenPath : _enterFullScreenPath, width: 128, height: 128 }");a.appendChild(f);g.applyBindings(d,f);this._container=a;this._viewModel=d;this._element=f}a(e.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){this._viewModel.destroy();g.cleanNode(this._element);this._container.removeChild(this._element);return f(this)};return e});F("Widgets/Geocoder/GeocoderViewModel","../../Core/IonGeocoderService ../../Core/CartographicGeocoderService ../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Event ../../Core/GeocodeType ../../Core/Math ../../Core/Matrix4 ../../Core/Rectangle ../../Core/sampleTerrainMostDetailed ../../Scene/computeFlyToLocationForRectangle ../../ThirdParty/knockout ../../ThirdParty/when ../createCommand ../getElement".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y){function A(c){if(!k(c)||!k(c.scene))throw new l("options.scene is required.");k(c.geocoderServices)?this._geocoderServices=c.geocoderServices:this._geocoderServices=[new a,new b({scene:c.scene})];this._viewContainer=c.container;this._scene=c.scene;this._flightDuration=c.flightDuration;this._searchText="";this._isSearchInProgress=!1;this._geocodePromise=void 0;this._complete=new m;this._suggestions=[];this._selectedSuggestion=void 0;this._showSuggestions=!0;this._handleArrowDown=x;this._handleArrowUp=z;var d=this;this._suggestionsVisible=r.pureComputed(function(){var a=0<r.getObservable(d,"_suggestions")().length,b=r.getObservable(d,"_showSuggestions")();return a&&b});this._searchCommand=u(function(a){a=f(a,e.SEARCH);d._focusTextbox=!1;if(k(d._selectedSuggestion))return d.activateSuggestion(d._selectedSuggestion),!1;d.hideSuggestions();d.isSearchInProgress?(d._isSearchInProgress=!1,k(d._geocodePromise)&&(d._geocodePromise.cancel=!0,d._geocodePromise=void 0)):B(d,d._geocoderServices,a)});this.deselectSuggestion=function(){d._selectedSuggestion=void 0};this.handleKeyDown=function(a,b){var c="ArrowUp"===b.key||"Up"===b.key||38===b.keyCode;("ArrowDown"===b.key||"Down"===b.key||40===b.keyCode||c)&&b.preventDefault();return!0};this.handleKeyUp=function(a,b){var c="ArrowDown"===b.key||"Down"===b.key||40===b.keyCode,e="Enter"===b.key||13===b.keyCode;"ArrowUp"===b.key||"Up"===b.key||38===b.keyCode?z(d):c?x(d):e&&d._searchCommand();return!0};this.activateSuggestion=function(a){d.hideSuggestions();d._searchText=a.displayName;a=a.destination;r.getObservable(d,"_suggestions").removeAll();d.destinationFound(d,a)};this.hideSuggestions=function(){d._showSuggestions=!1;d._selectedSuggestion=void 0};this.showSuggestions=function(){d._showSuggestions=!0};this.handleMouseover=function(a,b){a!==d._selectedSuggestion&&(d._selectedSuggestion=a)};this.keepExpanded=!1;this.autoComplete=f(c.autocomplete,!0);this.destinationFound=f(c.destinationFound,A.flyToDestination);this._focusTextbox=!1;r.track(this,"_searchText _isSearchInProgress keepExpanded _suggestions _selectedSuggestion _showSuggestions _focusTextbox".split(" "));c=r.getObservable(this,"_searchText");c.extend({rateLimit:{timeout:500}});this._suggestionSubscription=c.subscribe(function(){A._updateSearchSuggestions(d)});this.isSearchInProgress=void 0;r.defineProperty(this,"isSearchInProgress",{get:function(){return this._isSearchInProgress}});this.searchText=void 0;r.defineProperty(this,"searchText",{get:function(){return this.isSearchInProgress?"Searching...":this._searchText},set:function(a){if("string"!==typeof a)throw new l("value must be a valid string.");this._searchText=a}});this.flightDuration=void 0;r.defineProperty(this,"flightDuration",{get:function(){return this._flightDuration},set:function(a){if(k(a)&&0>a)throw new l("value must be positive.");this._flightDuration=a}})}function z(a){if(0!==a._suggestions.length){var b;b=a._suggestions.indexOf(a._selectedSuggestion);-1===b||0===b?a._selectedSuggestion=void 0:(--b,a._selectedSuggestion=a._suggestions[b],A._adjustSuggestionsScroll(a,b))}}function x(a){if(0!==a._suggestions.length){var b=a._suggestions.length,b=(a._suggestions.indexOf(a._selectedSuggestion)+1)%b;a._selectedSuggestion=a._suggestions[b];A._adjustSuggestionsScroll(a,b)}}function D(a,b){var d=k(b)?b.availability:void 0;return k(d)?q(b,[a]).then(function(b){a=b[0];a.height+=1E3;return a}):(a.height+=1E3,c.resolve(a))}function v(a,b,c,d){return a.then(function(a){return k(a)&&"fulfilled"===a.state&&0<a.value.length?a:b.geocode(c,d).then(function(a){return{state:"fulfilled",value:a}}).otherwise(function(a){return{state:"rejected",reason:a}})})}function B(a,b,d){var e=a._searchText;if(/^\s*$/.test(e))a.showSuggestions();else{a._isSearchInProgress=!0;for(var f=c.resolve(),g=0;g<b.length;g++)f=v(f,b[g],e,d);a._geocodePromise=f;f.then(function(b){if(!f.cancel){a._isSearchInProgress=!1;var c=b.value;"fulfilled"===b.state&&k(c)&&0<c.length?(a._searchText=c[0].displayName,a.destinationFound(a,c[0].destination)):a._searchText=e+" (not found)"}})}}g(A.prototype,{complete:{get:function(){return this._complete}},scene:{get:function(){return this._scene}},search:{get:function(){return this._searchCommand}},selectedSuggestion:{get:function(){return this._selectedSuggestion}},suggestions:{get:function(){return this._suggestions}}});A.prototype.destroy=function(){this._suggestionSubscription.dispose()};A.flyToDestination=function(a,b){var c=a._scene,e=c.mapProjection.ellipsoid,f=c.camera,g=c.terrainProvider,l=b,m;b instanceof d?h.equalsEpsilon(b.south,b.north,h.EPSILON7)&&h.equalsEpsilon(b.east,b.west,h.EPSILON7)?b=d.center(b):m=t(b,c):b=e.cartesianToCartographic(b);k(m)||(m=D(b,g));m.then(function(a){l=e.cartographicToCartesian(a)}).always(function(){f.flyTo({destination:l,complete:function(){a._complete.raiseEvent()},duration:a._flightDuration,endTransform:p.IDENTITY})})};A._updateSearchSuggestions=function(a){if(a.autoComplete){var b=a._searchText;r.getObservable(a,"_suggestions").removeAll();if(!/^\s*$/.test(b)){var d=c.resolve([]);a._geocoderServices.forEach(function(a){d=d.then(function(c){return 5<=c.length?c:a.geocode(b,e.AUTOCOMPLETE).then(function(a){return c=c.concat(a)})})});d.then(function(b){for(var c=a._suggestions,d=0;d<b.length;d++)c.push(b[d])})}}};A._adjustSuggestionsScroll=function(a,b){var c=y(a._viewContainer),d=c.getElementsByClassName("search-results")[0],c=c.getElementsByTagName("li")[b];if(0===b)d.scrollTop=0;else{var e=c.offsetTop;e+c.clientHeight>d.clientHeight?d.scrollTop=e+c.clientHeight:e<d.scrollTop&&(d.scrollTop=e)}};return A});F("Widgets/Geocoder/Geocoder","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/FeatureDetection ../../ThirdParty/knockout ../getElement ./GeocoderViewModel".split(" "),function(b,a,f,k,g,l,m,e){function h(a){if(!b(a)||!b(a.container))throw new k("options.container is required.");if(!b(a.scene))throw new k("options.scene is required.");var d=m(a.container),f=new e(a);f._startSearchPath="M29.772,26.433l-7.126-7.126c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127L29.772,26.433zM7.203,13.885c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486c-0.007,3.58-2.905,6.476-6.484,6.484C10.106,20.361,7.209,17.465,7.203,13.885z";f._stopSearchPath="M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z";a=document.createElement("form");a.setAttribute("data-bind","submit: search");var h=document.createElement("input");h.type="search";h.className="cesium-geocoder-input";h.setAttribute("placeholder","Enter an address or landmark...");h.setAttribute("data-bind",'textInput: searchText,disable: isSearchInProgress,event: { keyup: handleKeyUp, keydown: handleKeyDown, mouseover: deselectSuggestion },css: { "cesium-geocoder-input-wide" : keepExpanded || searchText.length \x3e 0 },hasFocus: _focusTextbox');this._onTextBoxFocus=function(){setTimeout(function(){h.select()},0)};h.addEventListener("focus",this._onTextBoxFocus,!1);a.appendChild(h);this._textBox=h;var p=document.createElement("span");p.className="cesium-geocoder-searchButton";p.setAttribute("data-bind","click: search,cesiumSvgPath: { path: isSearchInProgress ? _stopSearchPath : _startSearchPath, width: 32, height: 32 }");a.appendChild(p);d.appendChild(a);p=document.createElement("div");p.className="search-results";p.setAttribute("data-bind","visible: _suggestionsVisible");var c=document.createElement("ul");c.setAttribute("data-bind","foreach: _suggestions");var u=document.createElement("li");c.appendChild(u);u.setAttribute("data-bind","text: $data.displayName, click: $parent.activateSuggestion, event: { mouseover: $parent.handleMouseover}, css: { active: $data \x3d\x3d\x3d $parent._selectedSuggestion }");p.appendChild(c);d.appendChild(p);l.applyBindings(f,a);l.applyBindings(f,p);this._container=d;this._searchSuggestionsContainer=p;this._viewModel=f;this._form=a;this._onInputBegin=function(a){d.contains(a.target)||(f._focusTextbox=!1,f.hideSuggestions())};this._onInputEnd=function(a){d.contains(a.target)&&(f._focusTextbox=!0,f.showSuggestions())};g.supportsPointerEvents()?(document.addEventListener("pointerdown",this._onInputBegin,!0),document.addEventListener("pointerup",this._onInputEnd,!0),document.addEventListener("pointercancel",this._onInputEnd,!0)):(document.addEventListener("mousedown",this._onInputBegin,!0),document.addEventListener("mouseup",this._onInputEnd,!0),document.addEventListener("touchstart",this._onInputBegin,!0),document.addEventListener("touchend",this._onInputEnd,!0),document.addEventListener("touchcancel",this._onInputEnd,!0))}a(h.prototype,{container:{get:function(){return this._container}},searchSuggestionsContainer:{get:function(){return this._searchSuggestionsContainer}},viewModel:{get:function(){return this._viewModel}}});h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){g.supportsPointerEvents()?(document.removeEventListener("pointerdown",this._onInputBegin,!0),document.removeEventListener("pointerup",this._onInputEnd,!0)):(document.removeEventListener("mousedown",this._onInputBegin,!0),document.removeEventListener("mouseup",this._onInputEnd,!0),document.removeEventListener("touchstart",this._onInputBegin,!0),document.removeEventListener("touchend",this._onInputEnd,!0));this._viewModel.destroy();l.cleanNode(this._form);l.cleanNode(this._searchSuggestionsContainer);this._container.removeChild(this._form);this._container.removeChild(this._searchSuggestionsContainer);this._textBox.removeEventListener("focus",this._onTextBoxFocus,!1);return f(this)};return h});F("Widgets/HomeButton/HomeButtonViewModel",["../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../../ThirdParty/knockout","../createCommand"],function(b,a,f,k,g){function l(a,e){if(!b(a))throw new f("scene is required.");this._scene=a;this._duration=e;var h=this;this._command=g(function(){h._scene.camera.flyHome(h._duration)});this.tooltip="View Home";k.track(this,["tooltip"])}a(l.prototype,{scene:{get:function(){return this._scene}},command:{get:function(){return this._command}},duration:{get:function(){return this._duration},set:function(a){if(b(a)&&0>a)throw new f("value must be positive.");this._duration=a}}});return l});F("Widgets/HomeButton/HomeButton","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../ThirdParty/knockout ../getElement ./HomeButtonViewModel".split(" "),function(b,a,f,k,g,l,m){function e(a,e,d){if(!b(a))throw new k("container is required.");a=l(a);e=new m(e,d);e._svgPath="M14,4l-10,8.75h20l-4.25-3.7188v-4.6562h-2.812v2.1875l-2.938-2.5625zm-7.0938,9.906v10.094h14.094v-10.094h-14.094zm2.1876,2.313h3.3122v4.25h-3.3122v-4.25zm5.8442,1.281h3.406v6.438h-3.406v-6.438z";d=document.createElement("button");d.type="button";d.className="cesium-button cesium-toolbar-button cesium-home-button";d.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 28, height: 28 }");a.appendChild(d);g.applyBindings(e,d);this._container=a;this._viewModel=e;this._element=d}a(e.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){g.cleanNode(this._element);this._container.removeChild(this._element);return f(this)};return e});F("Widgets/InfoBox/InfoBoxViewModel",["../../Core/defined","../../Core/defineProperties","../../Core/Event","../../ThirdParty/knockout"],function(b,a,f,k){function g(){this._cameraClicked=new f;this._closeClicked=new f;this.maxHeight=500;this.showInfo=this.isCameraTracking=this.enableCamera=!1;this.description=this.titleText="";k.track(this,"showInfo titleText description maxHeight enableCamera isCameraTracking".split(" "));this._loadingIndicatorHtml='\x3cdiv class\x3d"cesium-infoBox-loadingContainer"\x3e\x3cspan class\x3d"cesium-infoBox-loading"\x3e\x3c/span\x3e\x3c/div\x3e';this.cameraIconPath=void 0;k.defineProperty(this,"cameraIconPath",{get:function(){return!this.enableCamera||this.isCameraTracking?"M 27.34375 1.65625 L 5.28125 27.9375 L 8.09375 30.3125 L 30.15625 4.03125 L 27.34375 1.65625 z M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4724893 20.232036 9.5676108 20.7379 9.75 21.21875 L 21.65625 7.03125 L 13.84375 7.03125 z M 28.21875 7.71875 L 14.53125 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 9.8371439 29.456025 8.4902779 28.21875 7.71875 z":"M 13.84375 7.03125 C 11.412798 7.03125 9.46875 8.975298 9.46875 11.40625 L 9.46875 11.59375 L 2.53125 7.21875 L 2.53125 24.0625 L 9.46875 19.6875 C 9.4853444 22.104033 11.423165 24.0625 13.84375 24.0625 L 25.875 24.0625 C 28.305952 24.0625 30.28125 22.087202 30.28125 19.65625 L 30.28125 11.40625 C 30.28125 8.975298 28.305952 7.03125 25.875 7.03125 L 13.84375 7.03125 z"}});k.defineProperty(this,"_bodyless",{get:function(){return!b(this.description)||0===this.description.length}})}g.prototype.maxHeightOffset=function(a){return this.maxHeight-a+"px"};a(g.prototype,{cameraClicked:{get:function(){return this._cameraClicked}},closeClicked:{get:function(){return this._closeClicked}}});return g});F("Widgets/InfoBox/InfoBox","../../Core/buildModuleUrl ../../Core/Check ../../Core/Color ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../ThirdParty/knockout ../getElement ../subscribeAndEvaluate ./InfoBoxViewModel".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(d){a.defined("container",d);d=e(d);var g=document.createElement("div");g.className="cesium-infoBox";g.setAttribute("data-bind",'css: { "cesium-infoBox-visible" : showInfo, "cesium-infoBox-bodyless" : _bodyless }');d.appendChild(g);var l=document.createElement("div");l.className="cesium-infoBox-title";l.setAttribute("data-bind","text: titleText");g.appendChild(l);l=document.createElement("button");l.type="button";l.className="cesium-button cesium-infoBox-camera";l.setAttribute("data-bind",'attr: { title: "Focus camera on object" },click: function () { cameraClicked.raiseEvent(this); },enable: enableCamera,cesiumSvgPath: { path: cameraIconPath, width: 32, height: 32 }');g.appendChild(l);l=document.createElement("button");l.type="button";l.className="cesium-infoBox-close";l.setAttribute("data-bind","click: function () { closeClicked.raiseEvent(this); }");l.innerHTML="\x26times;";g.appendChild(l);var c=document.createElement("iframe");c.className="cesium-infoBox-iframe";c.setAttribute("sandbox","allow-same-origin allow-popups allow-forms");c.setAttribute("data-bind","style : { maxHeight : maxHeightOffset(40) }");c.setAttribute("allowfullscreen",!0);g.appendChild(c);var q=new p;m.applyBindings(q,g);this._container=d;this._element=g;this._frame=c;this._viewModel=q;this._descriptionSubscription=void 0;var y=this;c.addEventListener("load",function(){var a=c.contentDocument,d=a.createElement("link");d.href=b("Widgets/InfoBox/InfoBoxDescription.css");d.rel="stylesheet";d.type="text/css";var e=a.createElement("div");e.className="cesium-infoBox-description";a.head.appendChild(d);a.body.appendChild(e);y._descriptionSubscription=h(q,"description",function(a){c.style.height="5px";e.innerHTML=a;a=null;var b=e.firstElementChild;if(null!==b&&1===e.childNodes.length&&(b=window.getComputedStyle(b),null!==b)){var d=f.fromCssColorString(b["background-color"]);k(d)&&0!==d.alpha&&(a=b["background-color"])}g.style["background-color"]=a;a=e.getBoundingClientRect().height;c.style.height=a+"px"})});c.setAttribute("src","about:blank")}g(d.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}},frame:{get:function(){return this._frame}}});d.prototype.isDestroyed=function(){return!1};d.prototype.destroy=function(){var a=this._container;m.cleanNode(this._element);a.removeChild(this._element);k(this._descriptionSubscription)&&this._descriptionSubscription.dispose();return l(this)};return d});F("Widgets/NavigationHelpButton/NavigationHelpButtonViewModel",["../../Core/defineProperties","../../ThirdParty/knockout","../createCommand"],function(b,a,f){function k(){this.showInstructions=!1;var b=this;this._command=f(function(){b.showInstructions=!b.showInstructions});this._showClick=f(function(){b._touch=!1});this._showTouch=f(function(){b._touch=!0});this._touch=!1;this.tooltip="Navigation Instructions";a.track(this,["tooltip","showInstructions","_touch"])}b(k.prototype,{command:{get:function(){return this._command}},showClick:{get:function(){return this._showClick}},showTouch:{get:function(){return this._showTouch}}});return k});F("Widgets/NavigationHelpButton/NavigationHelpButton","../../Core/buildModuleUrl ../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/FeatureDetection ../../ThirdParty/knockout ../getElement ./NavigationHelpButtonViewModel".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(d){if(!f(d)||!f(d.container))throw new l("options.container is required.");var g=h(d.container),k=new p;d=a(d.instructionsInitiallyVisible,!1);k.showInstructions=d;k._svgPath="M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z M17.328,24.371h-2.707v-2.596h2.707V24.371zM17.328,19.003v0.858h-2.707v-1.057c0-3.19,3.63-3.696,3.63-5.963c0-1.034-0.924-1.826-2.134-1.826c-1.254,0-2.354,0.924-2.354,0.924l-1.541-1.915c0,0,1.519-1.584,4.137-1.584c2.487,0,4.796,1.54,4.796,4.136C21.156,16.208,17.328,16.627,17.328,19.003z";var c=document.createElement("span");c.className="cesium-navigationHelpButton-wrapper";g.appendChild(c);d=document.createElement("button");d.type="button";d.className="cesium-button cesium-toolbar-button cesium-navigation-help-button";d.setAttribute("data-bind","attr: { title: tooltip },click: command,cesiumSvgPath: { path: _svgPath, width: 32, height: 32 }");c.appendChild(d);d=document.createElement("div");d.className="cesium-navigation-help";d.setAttribute("data-bind",'css: { "cesium-navigation-help-visible" : showInstructions}');c.appendChild(d);var q=document.createElement("button");q.type="button";q.className="cesium-navigation-button cesium-navigation-button-left";q.setAttribute("data-bind",'click: showClick, css: {"cesium-navigation-button-selected": !_touch, "cesium-navigation-button-unselected": _touch}');var y=document.createElement("img");y.src=b("Widgets/Images/NavigationHelp/Mouse.svg");y.className="cesium-navigation-button-icon";y.style.width="25px";y.style.height="25px";q.appendChild(y);q.appendChild(document.createTextNode("Mouse"));y=document.createElement("button");y.type="button";y.className="cesium-navigation-button cesium-navigation-button-right";y.setAttribute("data-bind",'click: showTouch, css: {"cesium-navigation-button-selected": _touch, "cesium-navigation-button-unselected": !_touch}');var A=document.createElement("img");A.src=b("Widgets/Images/NavigationHelp/Touch.svg");A.className="cesium-navigation-button-icon";A.style.width="25px";A.style.height="25px";y.appendChild(A);y.appendChild(document.createTextNode("Touch"));d.appendChild(q);d.appendChild(y);q=document.createElement("div");q.className="cesium-click-navigation-help cesium-navigation-help-instructions";q.setAttribute("data-bind",'css: { "cesium-click-navigation-help-visible" : !_touch}');q.innerHTML='            \x3ctable\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/MouseLeft.svg")+'" width\x3d"48" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-pan"\x3ePan view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eLeft click + drag\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/MouseRight.svg")+'" width\x3d"48" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-zoom"\x3eZoom view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eRight click + drag, or\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eMouse wheel scroll\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/MouseMiddle.svg")+'" width\x3d"48" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-rotate"\x3eRotate view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eMiddle click + drag, or\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eCTRL + Left/Right click + drag\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e            \x3c/table\x3e';d.appendChild(q);q=document.createElement("div");q.className="cesium-touch-navigation-help cesium-navigation-help-instructions";q.setAttribute("data-bind",'css: { "cesium-touch-navigation-help-visible" : _touch}');q.innerHTML='            \x3ctable\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/TouchDrag.svg")+'" width\x3d"70" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-pan"\x3ePan view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eOne finger drag\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/TouchZoom.svg")+'" width\x3d"70" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-zoom"\x3eZoom view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eTwo finger pinch\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/TouchTilt.svg")+'" width\x3d"70" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-rotate"\x3eTilt view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eTwo finger drag, same direction\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e                \x3ctr\x3e                    \x3ctd\x3e\x3cimg src\x3d"'+b("Widgets/Images/NavigationHelp/TouchRotate.svg")+'" width\x3d"70" height\x3d"48" /\x3e\x3c/td\x3e                    \x3ctd\x3e                        \x3cdiv class\x3d"cesium-navigation-help-tilt"\x3eRotate view\x3c/div\x3e                        \x3cdiv class\x3d"cesium-navigation-help-details"\x3eTwo finger drag, opposite direction\x3c/div\x3e                    \x3c/td\x3e                \x3c/tr\x3e            \x3c/table\x3e';d.appendChild(q);e.applyBindings(k,c);this._container=g;this._viewModel=k;this._wrapper=c;this._closeInstructions=function(a){c.contains(a.target)||(k.showInstructions=!1)};m.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeInstructions,!0):(document.addEventListener("mousedown",this._closeInstructions,!0),document.addEventListener("touchstart",this._closeInstructions,!0))}k(d.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});d.prototype.isDestroyed=function(){return!1};d.prototype.destroy=function(){m.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeInstructions,!0):(document.removeEventListener("mousedown",this._closeInstructions,!0),document.removeEventListener("touchstart",this._closeInstructions,!0));e.cleanNode(this._wrapper);this._container.removeChild(this._wrapper);return g(this)};return d});F("Widgets/PerformanceWatchdog/PerformanceWatchdogViewModel","../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Scene/FrameRateMonitor ../../ThirdParty/knockout ../createCommand".split(" "),function(b,a,f,k,g,l,m,e){function h(f){if(!a(f)||!a(f.scene))throw new g("options.scene is required.");this._scene=f.scene;this.lowFrameRateMessage=b(f.lowFrameRateMessage,"This application appears to be performing poorly on your system.  Please try using a different web browser or updating your video drivers.");this.showingLowFrameRateMessage=this.lowFrameRateMessageDismissed=!1;m.track(this,["lowFrameRateMessage","lowFrameRateMessageDismissed","showingLowFrameRateMessage"]);var d=this;this._dismissMessage=e(function(){d.showingLowFrameRateMessage=!1;d.lowFrameRateMessageDismissed=!0});f=l.fromScene(f.scene);this._unsubscribeLowFrameRate=f.lowFrameRate.addEventListener(function(){d.lowFrameRateMessageDismissed||(d.showingLowFrameRateMessage=!0)});this._unsubscribeNominalFrameRate=f.nominalFrameRate.addEventListener(function(){d.showingLowFrameRateMessage=!1})}f(h.prototype,{scene:{get:function(){return this._scene}},dismissMessage:{get:function(){return this._dismissMessage}}});h.prototype.destroy=function(){this._unsubscribeLowFrameRate();this._unsubscribeNominalFrameRate();return k(this)};return h});F("Widgets/PerformanceWatchdog/PerformanceWatchdog","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../ThirdParty/knockout ../getElement ./PerformanceWatchdogViewModel".split(" "),function(b,a,f,k,g,l,m){function e(a){if(!b(a)||!b(a.container))throw new k("options.container is required.");if(!b(a.scene))throw new k("options.scene is required.");var e=l(a.container);a=new m(a);var d=document.createElement("div");d.className="cesium-performance-watchdog-message-area";d.setAttribute("data-bind","visible: showingLowFrameRateMessage");var f=document.createElement("button");f.setAttribute("type","button");f.className="cesium-performance-watchdog-message-dismiss";f.innerHTML="\x26times;";f.setAttribute("data-bind","click: dismissMessage");d.appendChild(f);f=document.createElement("div");f.className="cesium-performance-watchdog-message";f.setAttribute("data-bind","html: lowFrameRateMessage");d.appendChild(f);e.appendChild(d);g.applyBindings(a,d);this._container=e;this._viewModel=a;this._element=d}a(e.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){this._viewModel.destroy();g.cleanNode(this._element);this._container.removeChild(this._element);return f(this)};return e});F("Widgets/ProjectionPicker/ProjectionPickerViewModel","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/EventHelper ../../Core/OrthographicFrustum ../../Scene/SceneMode ../../ThirdParty/knockout ../createCommand".split(" "),function(b,a,f,k,g,l,m,e,h){function p(a){if(!b(a))throw new k("scene is required.");this._scene=a;this._orthographic=a.camera.frustum instanceof l;this.dropDownVisible=this._flightInProgress=!1;this.tooltipPerspective="Perspective Projection";this.tooltipOrthographic="Orthographic Projection";this.selectedTooltip=void 0;this.sceneMode=a.mode;e.track(this,"_orthographic _flightInProgress sceneMode dropDownVisible tooltipPerspective tooltipOrthographic".split(" "));var d=this;e.defineProperty(this,"selectedTooltip",function(){return d._orthographic?d.tooltipOrthographic:d.tooltipPerspective});this._toggleDropDown=h(function(){d.sceneMode===m.SCENE2D||d._flightInProgress||(d.dropDownVisible=!d.dropDownVisible)});this._eventHelper=new g;this._eventHelper.add(a.morphComplete,function(a,b,c,e){d.sceneMode=c;d._orthographic=c===m.SCENE2D||d._scene.camera.frustum instanceof l});this._eventHelper.add(a.preRender,function(){d._flightInProgress=b(a.camera._currentFlight)});this._switchToPerspective=h(function(){d.sceneMode!==m.SCENE2D&&(d._scene.camera.switchToPerspectiveFrustum(),d._orthographic=!1,d.dropDownVisible=!1)});this._switchToOrthographic=h(function(){d.sceneMode!==m.SCENE2D&&(d._scene.camera.switchToOrthographicFrustum(),d._orthographic=!0,d.dropDownVisible=!1)});this._sceneMode=m}a(p.prototype,{scene:{get:function(){return this._scene}},toggleDropDown:{get:function(){return this._toggleDropDown}},switchToPerspective:{get:function(){return this._switchToPerspective}},switchToOrthographic:{get:function(){return this._switchToOrthographic}},isOrthographicProjection:{get:function(){return this._orthographic}}});p.prototype.isDestroyed=function(){return!1};p.prototype.destroy=function(){this._eventHelper.removeAll();f(this)};return p});F("Widgets/ProjectionPicker/ProjectionPicker","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/FeatureDetection ../../ThirdParty/knockout ../getElement ./ProjectionPickerViewModel".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d){if(!b(a))throw new k("container is required.");if(!b(d))throw new k("scene is required.");a=m(a);var f=new e(d);f._perspectivePath="M 28.15625,10.4375 9.125,13.21875 13.75,43.25 41.75,55.09375 50.8125,37 54.5,11.9375 z m 0.125,3 19.976451,0.394265 L 43.03125,16.875 22.6875,14.28125 z M 50.971746,15.705477 47.90625,36.03125 42.53125,46 44.84375,19.3125 z M 12.625,16.03125 l 29.15625,3.6875 -2.65625,31 L 16.4375,41.125 z";f._orthographicPath="m 31.560594,6.5254438 -20.75,12.4687502 0.1875,24.5625 22.28125,11.8125 19.5,-12 0.65625,-0.375 0,-0.75 0.0312,-23.21875 z m 0.0625,3.125 16.65625,9.5000002 -16.125,10.28125 -17.34375,-9.71875 z m 18.96875,11.1875002 0.15625,20.65625 -17.46875,10.59375 0.15625,-20.28125 z m -37.0625,1.25 17.21875,9.625 -0.15625,19.21875 -16.9375,-9 z";var h=document.createElement("span");h.className="cesium-projectionPicker-wrapper cesium-toolbar-button";a.appendChild(h);var p=document.createElement("button");p.type="button";p.className="cesium-button cesium-toolbar-button";p.setAttribute("data-bind",'css: { "cesium-projectionPicker-buttonPerspective": !_orthographic,       "cesium-projectionPicker-buttonOrthographic": _orthographic,       "cesium-button-disabled" : sceneMode \x3d\x3d\x3d _sceneMode.SCENE2D || _flightInProgress,        "cesium-projectionPicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown');p.innerHTML='\x3c!-- ko cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64, css: "cesium-projectionPicker-iconPerspective" } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64, css: "cesium-projectionPicker-iconOrthographic" } --\x3e\x3c!-- /ko --\x3e';h.appendChild(p);p=document.createElement("button");p.type="button";p.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon";p.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible \x26\x26 _orthographic),       "cesium-projectionPicker-none" : !_orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible },attr: { title: tooltipPerspective },click: switchToPerspective,cesiumSvgPath: { path: _perspectivePath, width: 64, height: 64 }');h.appendChild(p);p=document.createElement("button");p.type="button";p.className="cesium-button cesium-toolbar-button cesium-projectionPicker-dropDown-icon";p.setAttribute("data-bind",'css: { "cesium-projectionPicker-visible" : (dropDownVisible \x26\x26 !_orthographic),       "cesium-projectionPicker-none" : _orthographic,       "cesium-projectionPicker-hidden" : !dropDownVisible},attr: { title: tooltipOrthographic },click: switchToOrthographic,cesiumSvgPath: { path: _orthographicPath, width: 64, height: 64 }');h.appendChild(p);l.applyBindings(f,h);this._viewModel=f;this._container=a;this._wrapper=h;this._closeDropDown=function(a){h.contains(a.target)||(f.dropDownVisible=!1)};g.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}a(h.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){this._viewModel.destroy();g.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0));l.cleanNode(this._wrapper);this._container.removeChild(this._wrapper);return f(this)};return h});F("Widgets/SceneModePicker/SceneModePickerViewModel","../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/EventHelper ../../Scene/SceneMode ../../ThirdParty/knockout ../createCommand".split(" "),function(b,a,f,k,g,l,m,e,h){function p(d,f){if(!a(d))throw new g("scene is required.");this._scene=d;var k=this;this._eventHelper=new l;this._eventHelper.add(d.morphStart,function(a,b,d,e){k.sceneMode=d;k.dropDownVisible=!1});this._duration=b(f,2);this.sceneMode=d.mode;this.dropDownVisible=!1;this.tooltip2D="2D";this.tooltip3D="3D";this.tooltipColumbusView="Columbus View";e.track(this,["sceneMode","dropDownVisible","tooltip2D","tooltip3D","tooltipColumbusView"]);this.selectedTooltip=void 0;e.defineProperty(this,"selectedTooltip",function(){var a=k.sceneMode;return a===m.SCENE2D?k.tooltip2D:a===m.SCENE3D?k.tooltip3D:k.tooltipColumbusView});this._toggleDropDown=h(function(){k.dropDownVisible=!k.dropDownVisible});this._morphTo2D=h(function(){d.morphTo2D(k._duration)});this._morphTo3D=h(function(){d.morphTo3D(k._duration)});this._morphToColumbusView=h(function(){d.morphToColumbusView(k._duration)});this._sceneMode=m}f(p.prototype,{scene:{get:function(){return this._scene}},duration:{get:function(){return this._duration},set:function(a){if(0>a)throw new g("duration value must be positive.");this._duration=a}},toggleDropDown:{get:function(){return this._toggleDropDown}},morphTo2D:{get:function(){return this._morphTo2D}},morphTo3D:{get:function(){return this._morphTo3D}},morphToColumbusView:{get:function(){return this._morphToColumbusView}}});p.prototype.isDestroyed=function(){return!1};p.prototype.destroy=function(){this._eventHelper.removeAll();k(this)};return p});F("Widgets/SceneModePicker/SceneModePicker","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/FeatureDetection ../../ThirdParty/knockout ../getElement ./SceneModePickerViewModel".split(" "),function(b,a,f,k,g,l,m,e){function h(a,d,f){if(!b(a))throw new k("container is required.");if(!b(d))throw new k("scene is required.");a=m(a);var h=new e(d,f);h._globePath="m 32.401392,4.9330437 c -7.087603,0 -14.096095,2.884602 -19.10793,7.8946843 -5.0118352,5.010083 -7.9296167,11.987468 -7.9296167,19.072999 0,7.085531 2.9177815,14.097848 7.9296167,19.107931 4.837653,4.835961 11.541408,7.631372 18.374354,7.82482 0.05712,0.01231 0.454119,0.139729 0.454119,0.139729 l 0.03493,-0.104797 c 0.08246,7.84e-4 0.162033,0.03493 0.244525,0.03493 0.08304,0 0.161515,-0.03414 0.244526,-0.03493 l 0.03493,0.104797 c 0,0 0.309474,-0.129487 0.349323,-0.139729 6.867765,-0.168094 13.582903,-2.965206 18.444218,-7.82482 2.558195,-2.5573 4.551081,-5.638134 5.903547,-8.977584 1.297191,-3.202966 2.02607,-6.661489 2.02607,-10.130347 0,-6.237309 -2.366261,-12.31219 -6.322734,-17.116794 -0.0034,-0.02316 0.0049,-0.04488 0,-0.06986 -0.01733,-0.08745 -0.104529,-0.278855 -0.104797,-0.279458 -5.31e-4,-0.0012 -0.522988,-0.628147 -0.523984,-0.62878         -3.47e-4,-2.2e-4 -0.133444,-0.03532 -0.244525,-0.06987 C 51.944299,13.447603 51.751076,13.104317 51.474391,12.827728 46.462556,7.8176457 39.488996,4.9330437 32.401392,4.9330437 z m -2.130866,3.5281554 0.104797,9.6762289 c -4.111695,-0.08361 -7.109829,-0.423664 -9.257041,-0.943171 1.198093,-2.269271 2.524531,-4.124404 3.91241,-5.414496 2.167498,-2.0147811 3.950145,-2.8540169 5.239834,-3.3185619 z m 2.794579,0 c 1.280302,0.4754953 3.022186,1.3285948 5.065173,3.2486979 1.424667,1.338973 2.788862,3.303645 3.982275,5.728886 -2.29082,0.403367 -5.381258,0.621049 -8.942651,0.698645 L 33.065105,8.4611991 z m 5.728886,0.2445256 c 4.004072,1.1230822 7.793098,3.1481363 10.724195,6.0782083 0.03468,0.03466 0.07033,0.06991 0.104797,0.104797 -0.45375,0.313891 -0.923054,0.663002 -1.956205,1.082899 -0.647388,0.263114 -1.906242,0.477396 -2.829511,0.733577 -1.382296,-2.988132         -3.027146,-5.368585 -4.785716,-7.0213781 -0.422866,-0.397432 -0.835818,-0.6453247 -1.25756,-0.9781032 z m -15.33525,0.7685092 c -0.106753,0.09503 -0.207753,0.145402 -0.31439,0.244526 -1.684973,1.5662541 -3.298068,3.8232211 -4.680919,6.5672591 -0.343797,-0.14942 -1.035052,-0.273198 -1.292493,-0.419186 -0.956528,-0.542427 -1.362964,-1.022024 -1.537018,-1.292493 -0.0241,-0.03745 -0.01868,-0.0401 -0.03493,-0.06986 2.250095,-2.163342 4.948824,-3.869984 7.859752,-5.0302421 z m -9.641296,7.0912431 c 0.464973,0.571618 0.937729,1.169056 1.956205,1.746612 0.349907,0.198425 1.107143,0.335404 1.537018,0.523983 -1.20166,3.172984 -1.998037,7.051901 -2.165798,11.772162 C 14.256557,30.361384 12.934823,30.161483 12.280427,29.90959 10.644437,29.279855 9.6888882,28.674891 9.1714586,28.267775 8.6540289,27.860658 8.6474751,27.778724 8.6474751,27.778724 l -0.069864,0.03493 C 9.3100294,23.691285         11.163248,19.798527 13.817445,16.565477 z m 37.552149,0.523984 c 2.548924,3.289983 4.265057,7.202594 4.890513,11.318043 -0.650428,0.410896 -1.756876,1.001936 -3.563088,1.606882 -1.171552,0.392383 -3.163859,0.759153 -4.960377,1.117832 -0.04367,-4.752703 -0.784809,-8.591423 -1.88634,-11.807094 0.917574,-0.263678 2.170552,-0.486495 2.864443,-0.76851 1.274693,-0.518066 2.003942,-1.001558 2.654849,-1.467153 z m -31.439008,2.619917 c 2.487341,0.672766 5.775813,1.137775 10.479669,1.222628 l 0.104797,10.689263 0,0.03493 0,0.733577 c -5.435005,-0.09059 -9.512219,-0.519044 -12.610536,-1.117831 0.106127,-4.776683 0.879334,-8.55791 2.02607,-11.562569 z m 23.264866,0.31439 c 1.073459,3.067541 1.833795,6.821314 1.816476,11.702298 -3.054474,0.423245 -7.062018,0.648559 -11.702298,0.698644 l 0,-0.838373 -0.104796,-10.654331 c 4.082416,-0.0864 7.404468,-0.403886 9.990618,-0.908238 z         M 8.2632205,30.922625 c 0.7558676,0.510548 1.5529563,1.013339 3.0041715,1.57195 0.937518,0.360875 2.612202,0.647642 3.91241,0.978102 0.112814,3.85566 0.703989,7.107756 1.606883,9.920754 -1.147172,-0.324262 -2.644553,-0.640648 -3.423359,-0.978102 -1.516688,-0.657177 -2.386627,-1.287332 -2.864443,-1.71168 -0.477816,-0.424347 -0.489051,-0.489051 -0.489051,-0.489051 L 9.8002387,40.319395 C 8.791691,37.621767 8.1584238,34.769583 8.1584238,31.900727 c 0,-0.330153 0.090589,-0.648169 0.1047967,-0.978102 z m 48.2763445,0.419186 c 0.0047,0.188973 0.06986,0.36991 0.06986,0.558916 0,2.938869 -0.620228,5.873558 -1.676747,8.628261 -0.07435,0.07583 -0.06552,0.07411 -0.454119,0.349323 -0.606965,0.429857 -1.631665,1.042044 -3.318562,1.676747 -1.208528,0.454713 -3.204964,0.850894 -5.135038,1.25756 0.84593,-2.765726 1.41808,-6.005357 1.606883,-9.815957 2.232369,-0.413371 4.483758,-0.840201         5.938479,-1.327425 1.410632,-0.472457 2.153108,-0.89469 2.96924,-1.327425 z m -38.530252,2.864443 c 3.208141,0.56697 7.372279,0.898588 12.575603,0.978103 l 0.174662,9.885821 c -4.392517,-0.06139 -8.106722,-0.320566 -10.863925,-0.803441 -1.051954,-2.664695 -1.692909,-6.043794 -1.88634,-10.060483 z m 26.793022,0.31439 c -0.246298,3.923551 -0.877762,7.263679 -1.816476,9.885822 -2.561957,0.361954 -5.766249,0.560708 -9.431703,0.62878 l -0.174661,-9.815957 c 4.491734,-0.04969 8.334769,-0.293032 11.42284,-0.698645 z M 12.035901,44.860585 c 0.09977,0.04523 0.105535,0.09465 0.209594,0.139729 1.337656,0.579602 3.441099,1.058072 5.589157,1.537018 1.545042,3.399208 3.548524,5.969402 5.589157,7.789888 -3.034411,-1.215537 -5.871615,-3.007978 -8.174142,-5.309699 -1.245911,-1.245475 -2.271794,-2.662961 -3.213766,-4.156936 z m 40.69605,0 c -0.941972,1.493975 -1.967855,2.911461         -3.213765,4.156936 -2.74253,2.741571 -6.244106,4.696717 -9.955686,5.868615 0.261347,-0.241079 0.507495,-0.394491 0.768509,-0.663713 1.674841,-1.727516 3.320792,-4.181056 4.645987,-7.265904 2.962447,-0.503021 5.408965,-1.122293 7.161107,-1.781544 0.284034,-0.106865 0.337297,-0.207323 0.593848,-0.31439 z m -31.404076,2.305527 c 2.645807,0.376448 5.701178,0.649995 9.466635,0.698645 l 0.139729,7.789888 c -1.38739,-0.480844 -3.316218,-1.29837 -5.659022,-3.388427 -1.388822,-1.238993 -2.743668,-3.0113 -3.947342,-5.100106 z m 20.365491,0.104797 c -1.04872,2.041937 -2.174337,3.779068 -3.353494,4.995309 -1.853177,1.911459 -3.425515,2.82679 -4.611055,3.353494 l -0.139729,-7.789887 c 3.13091,-0.05714 5.728238,-0.278725 8.104278,-0.558916 z";h._flatMapPath="m 2.9825053,17.550598 0,1.368113 0,26.267766 0,1.368113 1.36811,0 54.9981397,0 1.36811,0 0,-1.368113 0,-26.267766 0,-1.368113 -1.36811,0 -54.9981397,0 -1.36811,0 z m 2.73623,2.736226 10.3292497,0 0,10.466063 -10.3292497,0 0,-10.466063 z m 13.0654697,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 11.69737,0 0,10.466063 -11.69737,0 0,-10.466063 z m 14.43359,0 10.32926,0 0,10.466063 -10.32926,0 0,-10.466063 z m -41.9326497,13.202288 10.3292497,0 0,10.329252 -10.3292497,0 0,-10.329252 z m 13.0654697,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 11.69737,0 0,10.329252 -11.69737,0 0,-10.329252 z m 14.43359,0 10.32926,0 0,10.329252 -10.32926,0 0,-10.329252 z";h._columbusViewPath="m 14.723969,17.675598 -0.340489,0.817175 -11.1680536,26.183638 -0.817175,1.872692 2.076986,0 54.7506996,0 2.07698,0 -0.81717,-1.872692 -11.16805,-26.183638 -0.34049,-0.817175 -0.91933,0 -32.414586,0 -0.919322,0 z m 1.838643,2.723916 6.196908,0 -2.928209,10.418977 -7.729111,0 4.460412,-10.418977 z m 9.02297,0 4.903049,0 0,10.418977 -7.831258,0 2.928209,-10.418977 z m 7.626964,0 5.584031,0 2.62176,10.418977 -8.205791,0 0,-10.418977 z m 8.410081,0 5.51593,0 4.46042,10.418977 -7.38863,0 -2.58772,-10.418977 z m -30.678091,13.142892 8.103649,0 -2.89416,10.282782 -9.6018026,0 4.3923136,-10.282782 z m 10.929711,0 8.614384,0 0,10.282782 -11.508544,0 2.89416,-10.282782 z m 11.338299,0 8.852721,0 2.58772,10.282782 -11.440441,0 0,-10.282782 z m 11.678781,0 7.86531,0 4.39231,10.282782 -9.6699,0 -2.58772,-10.282782 z";var p=document.createElement("span");p.className="cesium-sceneModePicker-wrapper cesium-toolbar-button";a.appendChild(p);d=document.createElement("button");d.type="button";d.className="cesium-button cesium-toolbar-button";d.setAttribute("data-bind",'css: { "cesium-sceneModePicker-button2D": sceneMode \x3d\x3d\x3d _sceneMode.SCENE2D,       "cesium-sceneModePicker-button3D": sceneMode \x3d\x3d\x3d _sceneMode.SCENE3D,       "cesium-sceneModePicker-buttonColumbusView": sceneMode \x3d\x3d\x3d _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-selected": dropDownVisible },attr: { title: selectedTooltip },click: toggleDropDown');d.innerHTML='\x3c!-- ko cesiumSvgPath: { path: _globePath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon3D" } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-icon2D" } --\x3e\x3c!-- /ko --\x3e\x3c!-- ko cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64, css: "cesium-sceneModePicker-slide-svg cesium-sceneModePicker-iconColumbusView" } --\x3e\x3c!-- /ko --\x3e';p.appendChild(d);d=document.createElement("button");d.type="button";d.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon";d.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible \x26\x26 (sceneMode !\x3d\x3d _sceneMode.SCENE3D)) || (!dropDownVisible \x26\x26 (sceneMode \x3d\x3d\x3d _sceneMode.SCENE3D)),       "cesium-sceneModePicker-none" : sceneMode \x3d\x3d\x3d _sceneMode.SCENE3D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip3D },click: morphTo3D,cesiumSvgPath: { path: _globePath, width: 64, height: 64 }');p.appendChild(d);d=document.createElement("button");d.type="button";d.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon";d.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible \x26\x26 (sceneMode !\x3d\x3d _sceneMode.SCENE2D)),       "cesium-sceneModePicker-none" : sceneMode \x3d\x3d\x3d _sceneMode.SCENE2D,       "cesium-sceneModePicker-hidden" : !dropDownVisible },attr: { title: tooltip2D },click: morphTo2D,cesiumSvgPath: { path: _flatMapPath, width: 64, height: 64 }');p.appendChild(d);d=document.createElement("button");d.type="button";d.className="cesium-button cesium-toolbar-button cesium-sceneModePicker-dropDown-icon";d.setAttribute("data-bind",'css: { "cesium-sceneModePicker-visible" : (dropDownVisible \x26\x26 (sceneMode !\x3d\x3d _sceneMode.COLUMBUS_VIEW)) || (!dropDownVisible \x26\x26 (sceneMode \x3d\x3d\x3d _sceneMode.COLUMBUS_VIEW)),       "cesium-sceneModePicker-none" : sceneMode \x3d\x3d\x3d _sceneMode.COLUMBUS_VIEW,       "cesium-sceneModePicker-hidden" : !dropDownVisible},attr: { title: tooltipColumbusView },click: morphToColumbusView,cesiumSvgPath: { path: _columbusViewPath, width: 64, height: 64 }');p.appendChild(d);l.applyBindings(h,p);this._viewModel=h;this._container=a;this._wrapper=p;this._closeDropDown=function(a){p.contains(a.target)||(h.dropDownVisible=!1)};g.supportsPointerEvents()?document.addEventListener("pointerdown",this._closeDropDown,!0):(document.addEventListener("mousedown",this._closeDropDown,!0),document.addEventListener("touchstart",this._closeDropDown,!0))}a(h.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){this._viewModel.destroy();g.supportsPointerEvents()?document.removeEventListener("pointerdown",this._closeDropDown,!0):(document.removeEventListener("mousedown",this._closeDropDown,!0),document.removeEventListener("touchstart",this._closeDropDown,!0));l.cleanNode(this._wrapper);this._container.removeChild(this._wrapper);return f(this)};return h});F("Widgets/SelectionIndicator/SelectionIndicatorViewModel","../../Core/Cartesian2 ../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/DeveloperError ../../Core/EasingFunction ../../Scene/SceneTransforms ../../ThirdParty/knockout".split(" "),function(b,a,f,k,g,l,m,e){function h(b,h,k){if(!f(b))throw new g("scene is required.");if(!f(h))throw new g("selectionIndicatorElement is required.");if(!f(k))throw new g("container is required.");this._scene=b;this._screenPositionY=this._screenPositionX="-1000px";this._tweens=b.tweens;this._container=a(k,document.body);this._selectionIndicatorElement=h;this._scale=1;this.position=void 0;this.showSelection=!1;e.track(this,["position","_screenPositionX","_screenPositionY","_scale","showSelection"]);this.isVisible=void 0;e.defineProperty(this,"isVisible",{get:function(){return this.showSelection&&f(this.position)}});e.defineProperty(this,"_transform",{get:function(){return"scale("+this._scale+")"}});this.computeScreenSpacePosition=function(a,c){return m.wgs84ToWindowCoordinates(b,a,c)}}var p=new b;h.prototype.update=function(){if(this.showSelection&&f(this.position)){var a=this.computeScreenSpacePosition(this.position,p);if(f(a)){var b=this._container,e=b.parentNode.clientHeight,g=this._selectionIndicatorElement.clientWidth,c=.5*g;a.x=Math.min(Math.max(a.x,-g),b.parentNode.clientWidth+g)-c;a.y=Math.min(Math.max(a.y,-g),e+g)-c;this._screenPositionX=Math.floor(a.x+.25)+"px";this._screenPositionY=Math.floor(a.y+.25)+"px"}else this._screenPositionY=this._screenPositionX="-1000px"}};h.prototype.animateAppear=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:2,stopValue:1,duration:.8,easingFunction:l.EXPONENTIAL_OUT})};h.prototype.animateDepart=function(){this._tweens.addProperty({object:this,property:"_scale",startValue:this._scale,stopValue:1.5,duration:.8,easingFunction:l.EXPONENTIAL_OUT})};k(h.prototype,{container:{get:function(){return this._container}},selectionIndicatorElement:{get:function(){return this._selectionIndicatorElement}},scene:{get:function(){return this._scene}}});return h});F("Widgets/SelectionIndicator/SelectionIndicator","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../ThirdParty/knockout ../getElement ./SelectionIndicatorViewModel".split(" "),function(b,a,f,k,g,l,m){function e(a,e){if(!b(a))throw new k("container is required.");this._container=a=l(a);var d=document.createElement("div");d.className="cesium-selection-wrapper";d.setAttribute("data-bind",'style: { "top" : _screenPositionY, "left" : _screenPositionX },css: { "cesium-selection-wrapper-visible" : isVisible }');a.appendChild(d);this._element=d;var f=document.createElementNS("http://www.w3.org/2000/svg","svg:svg");f.setAttribute("width",160);f.setAttribute("height",160);f.setAttribute("viewBox","0 0 160 160");var h=document.createElementNS("http://www.w3.org/2000/svg","g");h.setAttribute("transform","translate(80,80)");f.appendChild(h);var p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("data-bind","attr: { transform: _transform }");p.setAttribute("d","M -34 -34 L -34 -11.25 L -30 -15.25 L -30 -30 L -15.25 -30 L -11.25 -34 L -34 -34 z M 11.25 -34 L 15.25 -30 L 30 -30 L 30 -15.25 L 34 -11.25 L 34 -34 L 11.25 -34 z M -34 11.25 L -34 34 L -11.25 34 L -15.25 30 L -30 30 L -30 15.25 L -34 11.25 z M 34 11.25 L 30 15.25 L 30 30 L 15.25 30 L 11.25 34 L 34 34 L 34 11.25 z");h.appendChild(p);d.appendChild(f);this._viewModel=new m(e,this._element,this._container);g.applyBindings(this._viewModel,this._element)}a(e.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){var a=this._container;g.cleanNode(this._element);a.removeChild(this._element);return f(this)};return e});F("Widgets/Timeline/TimelineHighlightRange",["../../Core/defaultValue","../../Core/JulianDate"],function(b,a){function f(a,f,l){this._color=a;this._height=f;this._base=b(l,0)}f.prototype.getHeight=function(){return this._height};f.prototype.getBase=function(){return this._base};f.prototype.getStartTime=function(){return this._start};f.prototype.getStopTime=function(){return this._stop};f.prototype.setRange=function(a,b){this._start=a;this._stop=b};f.prototype.render=function(b){var f="";if(this._start&&this._stop&&this._color){var k=a.secondsDifference(this._start,b.epochJulian),k=Math.round(b.timeBarWidth*b.getAlpha(k)),m=a.secondsDifference(this._stop,b.epochJulian),m=Math.round(b.timeBarWidth*b.getAlpha(m))-k;0>k&&(m+=k,k=0);k+m>b.timeBarWidth&&(m=b.timeBarWidth-k);0<m&&(f='\x3cspan class\x3d"cesium-timeline-highlight" style\x3d"left: '+k.toString()+"px; width: "+m.toString()+"px; bottom: "+this._base.toString()+"px; height: "+this._height+"px; background-color: "+this._color+';"\x3e\x3c/span\x3e')}return f};return f});F("Widgets/Timeline/TimelineTrack",["../../Core/Color","../../Core/defined","../../Core/JulianDate"],function(b,a,f){function k(a,f,k,e){this.interval=a;this.height=f;this.color=k||new b(.5,.5,.5,1);this.backgroundColor=e||new b(0,0,0,0)}k.prototype.render=function(b,k){var g=this.interval.start,e=this.interval.stop,h=k.startJulian,l=f.addSeconds(k.startJulian,k.duration,new f);if(f.lessThan(g,h)&&f.greaterThan(e,l))b.fillStyle=this.color.toCssColorString(),b.fillRect(0,k.y,k.timeBarWidth,this.height);else if(f.lessThanOrEquals(g,l)&&f.greaterThanOrEquals(e,h)){for(var d,q,h=0;h<k.timeBarWidth;++h)l=f.addSeconds(k.startJulian,h/k.timeBarWidth*k.duration,new f),!a(d)&&f.greaterThanOrEquals(l,g)?d=h:!a(q)&&f.greaterThanOrEquals(l,e)&&(q=h);b.fillStyle=this.backgroundColor.toCssColorString();b.fillRect(0,k.y,k.timeBarWidth,this.height);a(d)&&(a(q)||(q=k.timeBarWidth),b.fillStyle=this.color.toCssColorString(),b.fillRect(d,k.y,Math.max(q-d,1),this.height))}};return k});F("Widgets/Timeline/Timeline","../../Core/ClockRange ../../Core/defined ../../Core/destroyObject ../../Core/DeveloperError ../../Core/JulianDate ../getElement ./TimelineHighlightRange ./TimelineTrack".split(" "),function(b,a,f,k,g,l,m,e){function h(b,e){if(!a(b))throw new k("container is required.");if(!a(e))throw new k("clock is required.");this.container=b=l(b);var f=document.createElement("div");f.className="cesium-timeline-main";b.appendChild(f);this._topDiv=f;this._timeBarSecondsSpan=this._startJulian=this._scrubElement=this._lastXPos=this._epochJulian=this._endJulian=void 0;this._clock=e;this._scrubJulian=e.currentTime;this._mainTicSpan=-1;this._mouseMode=z.none;this._touchMode=F.none;this._touchState={centerX:0,spanX:0};this._timelineDrag=this._mouseX=0;this._lastWidth=this._lastHeight=this._timelineDragLocation=void 0;this._topDiv.innerHTML='\x3cdiv class\x3d"cesium-timeline-bar"\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-timeline-trackContainer"\x3e\x3ccanvas class\x3d"cesium-timeline-tracks" width\x3d"10" height\x3d"1"\x3e\x3c/canvas\x3e\x3c/div\x3e\x3cdiv class\x3d"cesium-timeline-needle"\x3e\x3c/div\x3e\x3cspan class\x3d"cesium-timeline-ruler"\x3e\x3c/span\x3e';this._timeBarEle=this._topDiv.childNodes[0];this._trackContainer=this._topDiv.childNodes[1];this._trackListEle=this._topDiv.childNodes[1].childNodes[0];this._needleEle=this._topDiv.childNodes[2];this._rulerEle=this._topDiv.childNodes[3];this._context=this._trackListEle.getContext("2d");this._trackList=[];this._highlightRanges=[];this.zoomTo(e.startTime,e.stopTime);this._onMouseDown=d(this);this._onMouseUp=q(this);this._onMouseMove=t(this);this._onMouseWheel=r(this);this._onTouchStart=c(this);this._onTouchMove=y(this);this._onTouchEnd=u(this);f=this._timeBarEle;document.addEventListener("mouseup",this._onMouseUp,!1);document.addEventListener("mousemove",this._onMouseMove,!1);f.addEventListener("mousedown",this._onMouseDown,!1);f.addEventListener("DOMMouseScroll",this._onMouseWheel,!1);f.addEventListener("mousewheel",this._onMouseWheel,!1);f.addEventListener("touchstart",this._onTouchStart,!1);f.addEventListener("touchmove",this._onTouchMove,!1);f.addEventListener("touchend",this._onTouchEnd,!1);f.addEventListener("touchcancel",this._onTouchEnd,!1);this._topDiv.oncontextmenu=function(){return!1};e.onTick.addEventListener(this.updateFromClock,this);this.updateFromClock()}function p(a){return 10>a?"0"+a.toString():a.toString()}function d(a){return function(b){a._mouseMode!==z.touchOnly&&(0===b.button?(a._mouseMode=z.scrub,a._scrubElement&&(a._scrubElement.style.backgroundPosition="-16px 0"),a._onMouseMove(b)):(a._mouseX=b.clientX,a._mouseMode=2===b.button?z.zoom:z.slide));b.preventDefault()}}function q(a){return function(b){a._mouseMode=z.none;a._scrubElement&&(a._scrubElement.style.backgroundPosition="0 0");a._timelineDrag=0;a._timelineDragLocation=void 0}}function t(a){return function(b){var c;a._mouseMode===z.scrub?(b.preventDefault(),b=b.clientX-a._topDiv.getBoundingClientRect().left,0>b?(a._timelineDragLocation=0,a._timelineDrag=-.01*a._timeBarSecondsSpan):b>a._topDiv.clientWidth?(a._timelineDragLocation=a._topDiv.clientWidth,a._timelineDrag=.01*a._timeBarSecondsSpan):(a._timelineDragLocation=void 0,a._setTimeBarTime(b,b*a._timeBarSecondsSpan/a._topDiv.clientWidth))):a._mouseMode===z.slide?(c=a._mouseX-b.clientX,a._mouseX=b.clientX,0!==c&&(b=c*a._timeBarSecondsSpan/a._topDiv.clientWidth,a.zoomTo(g.addSeconds(a._startJulian,b,new g),g.addSeconds(a._endJulian,b,new g)))):a._mouseMode===z.zoom&&(c=a._mouseX-b.clientX,a._mouseX=b.clientX,0!==c&&a.zoomFrom(Math.pow(1.01,c)))}}function r(a){return function(b){b=b.wheelDeltaY||b.wheelDelta||-b.detail;A=Math.max(Math.min(Math.abs(b),A),1);b/=A;a.zoomFrom(Math.pow(1.05,-b))}}function c(a){return function(b){var c=b.touches.length,d,e=a._topDiv.getBoundingClientRect().left;b.preventDefault();a._mouseMode=z.touchOnly;1===c?(d=g.secondsDifference(a._scrubJulian,a._startJulian),d=Math.round(d*a._topDiv.clientWidth/a._timeBarSecondsSpan+e),50>Math.abs(b.touches[0].clientX-d)?(a._touchMode=F.scrub,a._scrubElement&&(a._scrubElement.style.backgroundPosition=1===c?"-16px 0":"0 0")):(a._touchMode=F.singleTap,a._touchState.centerX=b.touches[0].clientX-e)):2===c?(a._touchMode=F.slideZoom,a._touchState.centerX=.5*(b.touches[0].clientX+b.touches[1].clientX)-e,a._touchState.spanX=Math.abs(b.touches[0].clientX-b.touches[1].clientX)):a._touchMode=F.ignore}}function u(a){return function(b){var c=b.touches.length,d=a._topDiv.getBoundingClientRect().left;a._touchMode===F.singleTap?(a._touchMode=F.scrub,a._onTouchMove(b)):a._touchMode===F.scrub&&a._onTouchMove(b);a._mouseMode=z.touchOnly;1!==c?a._touchMode=0<c?F.ignore:F.none:a._touchMode===F.slideZoom&&(a._touchState.centerX=b.touches[0].clientX-d);a._scrubElement&&(a._scrubElement.style.backgroundPosition="0 0")}}function y(b){return function(c){var d,e,f,h=1,k=b._topDiv.getBoundingClientRect().left;b._touchMode===F.singleTap&&(b._touchMode=F.slideZoom);b._mouseMode=z.touchOnly;b._touchMode===F.scrub?(c.preventDefault(),1===c.changedTouches.length&&(d=c.changedTouches[0].clientX-k,0<=d&&d<=b._topDiv.clientWidth&&b._setTimeBarTime(d,d*b._timeBarSecondsSpan/b._topDiv.clientWidth))):b._touchMode===F.slideZoom&&(e=c.touches.length,2===e?(d=.5*(c.touches[0].clientX+c.touches[1].clientX)-k,f=Math.abs(c.touches[0].clientX-c.touches[1].clientX)):1===e&&(d=c.touches[0].clientX-k,f=0),a(d)&&(0<f&&0<b._touchState.spanX?(h=b._touchState.spanX/f,c=g.addSeconds(b._startJulian,(b._touchState.centerX*b._timeBarSecondsSpan-d*b._timeBarSecondsSpan*h)/b._topDiv.clientWidth,new g)):(c=b._touchState.centerX-d,c=g.addSeconds(b._startJulian,c*b._timeBarSecondsSpan/b._topDiv.clientWidth,new g)),b.zoomTo(c,g.addSeconds(c,b._timeBarSecondsSpan*h,new g)),b._touchState.centerX=d,b._touchState.spanX=f))}}var A=1E12,z={none:0,scrub:1,slide:2,zoom:3,touchOnly:4},F={none:0,scrub:1,slideZoom:2,singleTap:3,ignore:4},D=[.001,.002,.005,.01,.02,.05,.1,.25,.5,1,2,5,10,15,30,60,120,300,600,900,1800,3600,7200,14400,21600,43200,86400,172800,345600,604800,1296E3,2592E3,5184E3,7776E3,15552E3,31536E3,63072E3,126144E3,15768E4,31536E4,63072E4,126144E4,15768E5,31536E5,63072E5,126144E5,15768E6,31536E6],v="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ");h.prototype.addEventListener=function(a,b,c){this._topDiv.addEventListener(a,b,c)};h.prototype.removeEventListener=function(a,b,c){this._topDiv.removeEventListener(a,b,c)};h.prototype.isDestroyed=function(){return!1};h.prototype.destroy=function(){this._clock.onTick.removeEventListener(this.updateFromClock,this);document.removeEventListener("mouseup",this._onMouseUp,!1);document.removeEventListener("mousemove",this._onMouseMove,!1);var a=this._timeBarEle;a.removeEventListener("mousedown",this._onMouseDown,!1);a.removeEventListener("DOMMouseScroll",this._onMouseWheel,!1);a.removeEventListener("mousewheel",this._onMouseWheel,!1);a.removeEventListener("touchstart",this._onTouchStart,!1);a.removeEventListener("touchmove",this._onTouchMove,!1);a.removeEventListener("touchend",this._onTouchEnd,!1);a.removeEventListener("touchcancel",this._onTouchEnd,!1);this.container.removeChild(this._topDiv);f(this)};h.prototype.addHighlightRange=function(a,b,c){a=new m(a,b,c);this._highlightRanges.push(a);this.resize();return a};h.prototype.addTrack=function(a,b,c,d){a=new e(a,b,c,d);this._trackList.push(a);this._lastHeight=void 0;this.resize();return a};h.prototype.zoomTo=function(c,d){if(!a(c))throw new k("startTime is required.");if(!a(d))throw new k("stopTime is required");if(g.lessThanOrEquals(d,c))throw new k("Start time must come before end time.");this._startJulian=c;this._endJulian=d;this._timeBarSecondsSpan=g.secondsDifference(d,c);if(this._clock&&this._clock.clockRange!==b.UNBOUNDED){var e=this._clock.startTime,f=this._clock.stopTime,h=g.secondsDifference(f,e),l=g.secondsDifference(e,this._startJulian),m=g.secondsDifference(f,this._endJulian);this._timeBarSecondsSpan>=h?(this._timeBarSecondsSpan=h,this._startJulian=this._clock.startTime,this._endJulian=this._clock.stopTime):0<l?(this._endJulian=g.addSeconds(this._endJulian,l,new g),this._startJulian=e,this._timeBarSecondsSpan=g.secondsDifference(this._endJulian,this._startJulian)):0>m&&(this._startJulian=g.addSeconds(this._startJulian,m,new g),this._endJulian=f,this._timeBarSecondsSpan=g.secondsDifference(this._endJulian,this._startJulian))}this._makeTics();e=document.createEvent("Event");e.initEvent("setzoom",!0,!0);e.startJulian=this._startJulian;e.endJulian=this._endJulian;e.epochJulian=this._epochJulian;e.totalSpan=this._timeBarSecondsSpan;e.mainTicSpan=this._mainTicSpan;this._topDiv.dispatchEvent(e)};h.prototype.zoomFrom=function(a){var b=g.secondsDifference(this._scrubJulian,this._startJulian),b=1<a||0>b||b>this._timeBarSecondsSpan?.5*this._timeBarSecondsSpan:b+(b-.5*this._timeBarSecondsSpan),c=this._timeBarSecondsSpan-b;this.zoomTo(g.addSeconds(this._startJulian,b-b*a,new g),g.addSeconds(this._endJulian,c*a-c,new g))};h.prototype.makeLabel=function(a){a=g.toGregorianDate(a);var b=a.millisecond,c=" UTC";if(0<b&&3600>this._timeBarSecondsSpan){for(c=Math.floor(b).toString();3>c.length;)c="0"+c;c="."+c}return v[a.month-1]+" "+a.day+" "+a.year+" "+p(a.hour)+":"+p(a.minute)+":"+p(a.second)+c};h.prototype.smallestTicInPixels=7;h.prototype._makeTics=function(){function a(a){return(a-t)/l}function b(a,b){return a-b*Math.round(a/b)}var c=this._timeBarEle,d=g.secondsDifference(this._scrubJulian,this._startJulian),e=Math.round(d*this._topDiv.clientWidth/this._timeBarSecondsSpan),d=e-8,f,h=this;this._needleEle.style.left=e.toString()+"px";var k="";f=0;var l=this._timeBarSecondsSpan;.01>l?(this._timeBarSecondsSpan=l=.01,this._endJulian=g.addSeconds(this._startJulian,.01,new g)):31536E6<l&&(this._timeBarSecondsSpan=l=31536E6,this._endJulian=g.addSeconds(this._startJulian,31536E6,new g));e=this._timeBarEle.clientWidth;10>e&&(e=10);var m=this._startJulian,p=Math.min(l/e*1E-5,.4),q,r=g.toGregorianDate(m);q=31536E4<l?g.fromDate(new Date(Date.UTC(100*Math.floor(r.year/100),0))):31536E3<l?g.fromDate(new Date(Date.UTC(10*Math.floor(r.year/10),0))):86400<l?g.fromDate(new Date(Date.UTC(r.year,0))):g.fromDate(new Date(Date.UTC(r.year,r.month,r.day)));var t=g.secondsDifference(this._startJulian,g.addSeconds(q,p,new g)),p=t+l;this._epochJulian=q;this._rulerEle.innerHTML=this.makeLabel(g.addSeconds(this._endJulian,-.01,new g));r=this._rulerEle.offsetWidth+20;30>r&&(r=180);var u=f;f-=1E-10;var v={startTime:t,startJulian:m,epochJulian:q,duration:l,timeBarWidth:e,getAlpha:a};this._highlightRanges.forEach(function(a){k+=a.render(v)});var y=0,z=0,A=0,F=r/e;1<F&&(F=1);var F=F*this._timeBarSecondsSpan,x=-1,S=-1,ca,T=D.length;for(ca=0;ca<T;++ca){var da=D[ca];++x;y=da;if(da>F&&da>f)break;0>S&&da/this._timeBarSecondsSpan*e>=this.smallestTicInPixels&&(S=x)}if(0<x){for(;0<x;)if(--x,1E-5>Math.abs(b(y,D[x]))){D[x]>=f&&(z=D[x]);break}if(0<=S)for(;S<x;){if(1E-5>Math.abs(b(z,D[S]))&&D[S]>=f){A=D[S];break}++S}}f=u;1E-10<f&&1E-5>A&&1E-10<Math.abs(f-y)&&(A=f,f<=y+1E-10&&(z=0));u=-999999;if(3<=A/this._timeBarSecondsSpan*e)for(f=Math.floor(t/A)*A;f<=p;f=Math.ceil(f/A+.5)*A)k+='\x3cspan class\x3d"cesium-timeline-ticTiny" style\x3d"left: '+Math.round(e*a(f)).toString()+'px;"\x3e\x3c/span\x3e';if(3<=z/this._timeBarSecondsSpan*e)for(f=Math.floor(t/z)*z;f<=p;f=Math.ceil(f/z+.5)*z)k+='\x3cspan class\x3d"cesium-timeline-ticSub" style\x3d"left: '+Math.round(e*a(f)).toString()+'px;"\x3e\x3c/span\x3e';if(2<=y/this._timeBarSecondsSpan*e)for(this._mainTicSpan=y,p+=y,f=Math.floor(t/y)*y,q=g.computeTaiMinusUtc(q);f<=p;)A=g.addSeconds(m,f-t,new g),2.1<y&&(z=g.computeTaiMinusUtc(A),.1<Math.abs(z-q)&&(f+=z-q,A=g.addSeconds(m,f-t,new g))),z=Math.round(e*a(f)),F=this.makeLabel(A),this._rulerEle.innerHTML=F,A=this._rulerEle.offsetWidth,10>A&&(A=r),x=z-(A/2-1),x>u?(u=x+A+5,k+='\x3cspan class\x3d"cesium-timeline-ticMain" style\x3d"left: '+z.toString()+'px;"\x3e\x3c/span\x3e\x3cspan class\x3d"cesium-timeline-ticLabel" style\x3d"left: '+x.toString()+'px;"\x3e'+F+"\x3c/span\x3e"):k+='\x3cspan class\x3d"cesium-timeline-ticSub" style\x3d"left: '+z.toString()+'px;"\x3e\x3c/span\x3e',f=Math.ceil(f/y+.5)*y;else this._mainTicSpan=-1;k+='\x3cspan class\x3d"cesium-timeline-icon16" style\x3d"left:'+d+'px;bottom:0;background-position: 0 0;"\x3e\x3c/span\x3e';c.innerHTML=k;this._scrubElement=c.lastChild;this._context.clearRect(0,0,this._trackListEle.width,this._trackListEle.height);v.y=0;this._trackList.forEach(function(a){a.render(h._context,v);v.y+=a.height})};h.prototype.updateFromClock=function(){this._scrubJulian=this._clock.currentTime;var b=this._scrubElement;if(a(this._scrubElement)){var c=g.secondsDifference(this._scrubJulian,this._startJulian),c=Math.round(c*this._topDiv.clientWidth/this._timeBarSecondsSpan);this._lastXPos!==c&&(this._lastXPos=c,b.style.left=c-8+"px",this._needleEle.style.left=c+"px")}a(this._timelineDragLocation)&&(this._setTimeBarTime(this._timelineDragLocation,this._timelineDragLocation*this._timeBarSecondsSpan/this._topDiv.clientWidth),this.zoomTo(g.addSeconds(this._startJulian,this._timelineDrag,new g),g.addSeconds(this._endJulian,this._timelineDrag,new g)))};h.prototype._setTimeBarTime=function(a,b){a=Math.round(a);this._scrubJulian=g.addSeconds(this._startJulian,b,new g);this._scrubElement&&(this._scrubElement.style.left=(a-8).toString()+"px",this._needleEle.style.left=a.toString()+"px");var c=document.createEvent("Event");c.initEvent("settime",!0,!0);c.clientX=a;c.timeSeconds=b;c.timeJulian=this._scrubJulian;c.clock=this._clock;this._topDiv.dispatchEvent(c)};h.prototype.resize=function(){var a=this.container.clientWidth,b=this.container.clientHeight;if(a!==this._lastWidth||b!==this._lastHeight){this._trackContainer.style.height=b+"px";var c=1;this._trackList.forEach(function(a){c+=a.height});this._trackListEle.style.height=c.toString()+"px";this._trackListEle.width=this._trackListEle.clientWidth;this._trackListEle.height=c;this._makeTics();this._lastXPos=void 0;this._lastWidth=a;this._lastHeight=b}};return h});F("Widgets/VRButton/VRButtonViewModel","../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/EventHelper ../../Core/Fullscreen ../../Core/OrthographicFrustum ../../ThirdParty/knockout ../../ThirdParty/NoSleep ../createCommand ../getElement".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q){function t(){var b=window.screen;a(b)&&(a(b.unlockOrientation)?b.unlockOrientation():a(b.mozUnlockOrientation)?b.mozUnlockOrientation():a(b.msUnlockOrientation)?b.msUnlockOrientation():a(b.orientation&&b.orientation.unlock)&&b.orientation.unlock())}function r(c,f){if(!a(c))throw new g("scene is required.");var k=this,r=h.observable(m.enabled),u=h.observable(!1);this.isVRMode=void 0;h.defineProperty(this,"isVRMode",{get:function(){return u()}});this.isVREnabled=void 0;h.defineProperty(this,"isVREnabled",{get:function(){return r()},set:function(a){r(a&&m.enabled)}});this.tooltip=void 0;h.defineProperty(this,"tooltip",function(){return r()?u()?"Exit VR mode":"Enter VR mode":"VR mode is unavailable"});var F=h.observable(!1);this._isOrthographic=void 0;h.defineProperty(this,"_isOrthographic",{get:function(){return F()}});this._eventHelper=new l;this._eventHelper.add(c.preRender,function(){F(c.camera.frustum instanceof e)});this._locked=!1;this._noSleep=new p;this._command=d(function(){if(!F())if(u())c.useWebVR=!1,k._locked&&(t(),k._locked=!1),k._noSleep.disable(),m.exitFullscreen(),u(!1);else{m.fullscreen||m.requestFullscreen(k._vrElement);k._noSleep.enable();if(!k._locked){var b=!1,d=window.screen;a(d)&&(a(d.lockOrientation)?b=d.lockOrientation("landscape"):a(d.mozLockOrientation)?b=d.mozLockOrientation("landscape"):a(d.msLockOrientation)?b=d.msLockOrientation("landscape"):a(d.orientation&&d.orientation.lock)&&(b=d.orientation.lock("landscape")));k._locked=b}c.useWebVR=!0;u(!0)}},h.getObservable(this,"isVREnabled"));this._vrElement=b(q(f),document.body);this._callback=function(){!m.fullscreen&&u()&&(c.useWebVR=!1,k._locked&&(t(),k._locked=!1),k._noSleep.disable(),u(!1))};document.addEventListener(m.changeEventName,this._callback)}f(r.prototype,{vrElement:{get:function(){return this._vrElement},set:function(a){if(!(a instanceof Element))throw new g("value must be a valid Element.");this._vrElement=a}},command:{get:function(){return this._command}}});r.prototype.isDestroyed=function(){return!1};r.prototype.destroy=function(){this._eventHelper.removeAll();document.removeEventListener(m.changeEventName,this._callback);k(this)};return r});F("Widgets/VRButton/VRButton","../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../ThirdParty/knockout ../getElement ./VRButtonViewModel".split(" "),function(b,a,f,k,g,l,m){function e(a,e,d){if(!b(a))throw new k("container is required.");if(!b(e))throw new k("scene is required.");a=l(a);e=new m(e,d);e._exitVRPath="M 25.770585,2.4552065 C 15.72282,13.962707 10.699956,19.704407 8.1768352,22.580207 c -1.261561,1.4379 -1.902282,2.1427 -2.21875,2.5 -0.141624,0.1599 -0.208984,0.2355 -0.25,0.2813 l 0.6875,0.75 c 10e-5,-10e-5 0.679191,0.727 0.6875,0.7187 0.01662,-0.016 0.02451,-0.024 0.03125,-0.031 0.01348,-0.014 0.04013,-0.038 0.0625,-0.062 0.04474,-0.05 0.120921,-0.1315 0.28125,-0.3126 0.320657,-0.3619 0.956139,-1.0921 2.2187499,-2.5312 2.5252219,-2.8781 7.5454589,-8.6169 17.5937499,-20.1250005 l -1.5,-1.3125 z m -20.5624998,3.9063 c -1.304375,0 -2.34375,1.0391 -2.34375,2.3437 l 0,10.8125005 c 0,1.3043 1.039375,2.375 2.34375,2.375 l 2.25,0 c 1.9518039,-2.2246 7.4710958,-8.5584 13.5624998,-15.5312005 l -15.8124998,0 z m 21.1249998,0 c -1.855467,2.1245 -2.114296,2.4005 -3.59375,4.0936995 1.767282,0.1815 3.15625,1.685301 3.15625,3.500001 0,1.9349 -1.56511,3.5 -3.5,3.5 -1.658043,0 -3.043426,-1.1411 -3.40625,-2.6875 -1.089617,1.2461 -2.647139,2.9988 -3.46875,3.9375 0.191501,-0.062 0.388502,-0.094 0.59375,-0.094 1.373338,0 2.50006,1.4614 2.5625,3.2812 l 8.3125,0 c 1.304375,0 2.34375,-1.0707 2.34375,-2.375 l 0,-10.8125005 c 0,-1.3046 -1.039375,-2.3437 -2.34375,-2.3437 l -0.65625,0 z M 9.5518351,10.423906 c 1.9348899,0 3.4999999,1.596401 3.4999999,3.531301 0,1.9349 -1.56511,3.5 -3.4999999,3.5 -1.9348899,0 -3.4999999,-1.5651 -3.4999999,-3.5 0,-1.9349 1.56511,-3.531301 3.4999999,-3.531301 z m 4.2187499,10.312601 c -0.206517,0.2356 -0.844218,0.9428 -1.03125,1.1562 l 0.8125,0 c 0.01392,-0.4081 0.107026,-0.7968 0.21875,-1.1562 z";e._enterVRPath="M 5.3125 6.375 C 4.008126 6.375 2.96875 7.4141499 2.96875 8.71875 L 2.96875 19.5 C 2.96875 20.8043 4.008126 21.875 5.3125 21.875 L 13.65625 21.875 C 13.71832 20.0547 14.845166 18.59375 16.21875 18.59375 C 17.592088 18.59375 18.71881 20.0552 18.78125 21.875 L 27.09375 21.875 C 28.398125 21.875 29.4375 20.8043 29.4375 19.5 L 29.4375 8.71875 C 29.4375 7.4141499 28.398125 6.375 27.09375 6.375 L 5.3125 6.375 z M 9.625 10.4375 C 11.55989 10.4375 13.125 12.03385 13.125 13.96875 C 13.125 15.90365 11.55989 17.46875 9.625 17.46875 C 7.69011 17.46875 6.125 15.90365 6.125 13.96875 C 6.125 12.03385 7.69011 10.4375 9.625 10.4375 z M 22.46875 10.4375 C 24.40364 10.4375 25.96875 12.03385 25.96875 13.96875 C 25.96875 15.90365 24.40364 17.46875 22.46875 17.46875 C 20.53386 17.46875 18.96875 15.90365 18.96875 13.96875 C 18.96875 12.03385 20.53386 10.4375 22.46875 10.4375 z";d=document.createElement("button");d.type="button";d.className="cesium-button cesium-vrButton";d.setAttribute("data-bind",'css: { "cesium-button-disabled" : _isOrthographic }, attr: { title: tooltip },click: command,enable: isVREnabled,cesiumSvgPath: { path: isVRMode ? _exitVRPath : _enterVRPath, width: 32, height: 32 }');a.appendChild(d);g.applyBindings(e,d);this._container=a;this._viewModel=e;this._element=d}a(e.prototype,{container:{get:function(){return this._container}},viewModel:{get:function(){return this._viewModel}}});e.prototype.isDestroyed=function(){return!1};e.prototype.destroy=function(){this._viewModel.destroy();g.cleanNode(this._element);this._container.removeChild(this._element);return f(this)};return e});F("Widgets/Viewer/Viewer","../../Core/BoundingSphere ../../Core/Cartesian3 ../../Core/Cartographic ../../Core/Clock ../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/destroyObject ../../Core/DeveloperError ../../Core/Event ../../Core/EventHelper ../../Core/HeadingPitchRange ../../Core/isArray ../../Core/Matrix4 ../../Core/Rectangle ../../Core/ScreenSpaceEventType ../../DataSources/BoundingSphereState ../../DataSources/ConstantPositionProperty ../../DataSources/DataSourceCollection ../../DataSources/DataSourceDisplay ../../DataSources/Entity ../../DataSources/EntityView ../../DataSources/Property ../../Scene/Cesium3DTileset ../../Scene/computeFlyToLocationForRectangle ../../Scene/ImageryLayer ../../Scene/SceneMode ../../Scene/TimeDynamicPointCloud ../../ThirdParty/knockout ../../ThirdParty/when ../Animation/Animation ../Animation/AnimationViewModel ../BaseLayerPicker/BaseLayerPicker ../BaseLayerPicker/createDefaultImageryProviderViewModels ../BaseLayerPicker/createDefaultTerrainProviderViewModels ../CesiumWidget/CesiumWidget ../ClockViewModel ../FullscreenButton/FullscreenButton ../Geocoder/Geocoder ../getElement ../HomeButton/HomeButton ../InfoBox/InfoBox ../NavigationHelpButton/NavigationHelpButton ../ProjectionPicker/ProjectionPicker ../SceneModePicker/SceneModePicker ../SelectionIndicator/SelectionIndicator ../subscribeAndEvaluate ../Timeline/Timeline ../VRButton/VRButton".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,F,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba){function x(a){var b=a.clock;b.currentTime=a.timeJulian;b.shouldAnimate=!1}function fa(a,b){var c=a.scene.pick(b.position);if(l(c)&&(c=g(c.id,c.primitive.id),c instanceof D))return c;if(l(a.scene.globe))return ka(a,b.position)}function ga(a,b,c){l(c)&&(c=c.clock,l(c)&&(c.getValue(b),l(a)&&(a.updateFromClock(),a.zoomTo(c.startTime,c.stopTime))))}function ka(a,b){var c=a.scene,d=c.camera.getPickRay(b),c=c.imageryLayers.pickImageryLayerFeatures(d,c);if(l(c)){var e=new D({id:"Loading...",description:"Loading feature information..."});E(c,function(b){if(a.selectedEntity===e)if(l(b)&&0!==b.length){var c=b[0];b=new D({id:c.name,description:c.description});l(c.position)&&(c=a.scene.globe.ellipsoid.cartographicToCartesian(c.position,ua),b.position=new A(c));a.selectedEntity=b}else a.selectedEntity=na()},function(){a.selectedEntity===e&&(a.selectedEntity=na())});return e}}function na(){return new D({id:"None",description:"No features found."})}function ia(a,b){if(!l(a))throw new h("container is required.");a=M(a);b=g(b,g.EMPTY_OBJECT);var c=(!l(b.globe)||!1!==b.globe)&&(!l(b.baseLayerPicker)||!1!==b.baseLayerPicker);if(!c&&l(b.selectedImageryProviderViewModel))throw new h("options.selectedImageryProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.imageryProvider instead or set options.baseLayerPicker to true.");if(!c&&l(b.selectedTerrainProviderViewModel))throw new h("options.selectedTerrainProviderViewModel is not available when not using the BaseLayerPicker widget. Either specify options.terrainProvider instead or set options.baseLayerPicker to true.");var e=this,f=document.createElement("div");f.className="cesium-viewer";a.appendChild(f);var m=document.createElement("div");m.className="cesium-viewer-cesiumWidgetContainer";f.appendChild(m);var q=document.createElement("div");q.className="cesium-viewer-bottom";f.appendChild(q);var r=g(b.scene3DOnly,!1),v,w,y=!1;l(b.clockViewModel)?(w=b.clockViewModel,v=w.clock):(v=new k,w=new aa(v),y=!0);l(b.shouldAnimate)&&(v.shouldAnimate=b.shouldAnimate);var m=new Z(m,{imageryProvider:c||l(b.imageryProvider)?!1:void 0,clock:v,skyBox:b.skyBox,skyAtmosphere:b.skyAtmosphere,sceneMode:b.sceneMode,mapProjection:b.mapProjection,globe:b.globe,orderIndependentTranslucency:b.orderIndependentTranslucency,contextOptions:b.contextOptions,useDefaultRenderLoop:b.useDefaultRenderLoop,targetFrameRate:b.targetFrameRate,showRenderLoopErrors:b.showRenderLoopErrors,creditContainer:l(b.creditContainer)?b.creditContainer:q,creditViewport:b.creditViewport,scene3DOnly:r,terrainExaggeration:b.terrainExaggeration,shadows:b.shadows,terrainShadows:b.terrainShadows,mapMode2D:b.mapMode2D,requestRenderMode:b.requestRenderMode,maximumRenderTimeChange:b.maximumRenderTimeChange}),A=b.dataSources,D=!1;l(A)||(A=new z,D=!0);var C=m.scene,E=new F({scene:C,dataSourceCollection:A}),H=new d;H.add(v.onTick,ia.prototype._onTick,this);H.add(C.morphStart,ia.prototype._clearTrackedObject,this);var I;l(b.selectionIndicator)&&!1===b.selectionIndicator||(I=document.createElement("div"),I.className="cesium-viewer-selectionIndicatorContainer",f.appendChild(I),I=new T(I,C));var J;if(!l(b.infoBox)||!1!==b.infoBox){J=document.createElement("div");J.className="cesium-viewer-infoBoxContainer";f.appendChild(J);J=new Y(J);var X=J.viewModel;H.add(X.cameraClicked,ia.prototype._onInfoBoxCameraClicked,this);H.add(X.closeClicked,ia.prototype._onInfoBoxClockClicked,this)}X=document.createElement("div");X.className="cesium-viewer-toolbar";f.appendChild(X);var ga;if(!l(b.geocoder)||!1!==b.geocoder){var ha=document.createElement("div");ha.className="cesium-viewer-geocoderContainer";X.appendChild(ha);var ta;l(b.geocoder)&&"boolean"!==typeof b.geocoder&&(ta=t(b.geocoder)?b.geocoder:[b.geocoder]);ga=new W({container:ha,geocoderServices:ta,scene:C});H.add(ga.viewModel.search.beforeExecute,ia.prototype._clearObjects,this)}var ka;l(b.homeButton)&&!1===b.homeButton||(ka=new R(X,C),l(ga)&&H.add(ka.viewModel.command.afterExecute,function(){var a=ga.viewModel;a.searchText="";a.isSearchInProgress&&a.search()}),H.add(ka.viewModel.command.beforeExecute,ia.prototype._clearTrackedObject,this));if(!0===b.sceneModePicker&&r)throw new h("options.sceneModePicker is not available when options.scene3DOnly is set to true.");var la;r||l(b.sceneModePicker)&&!1===b.sceneModePicker||(la=new ca(X,C));var wa;b.projectionPicker&&(wa=new S(X,C));var na,oa;c&&(na=g(b.imageryProviderViewModels,N()),oa=g(b.terrainProviderViewModels,O()),na=new P(X,{globe:C.globe,imageryProviderViewModels:na,selectedImageryProviderViewModel:b.selectedImageryProviderViewModel,terrainProviderViewModels:oa,selectedTerrainProviderViewModel:b.selectedTerrainProviderViewModel}),oa=X.getElementsByClassName("cesium-baseLayerPicker-dropDown")[0]);l(b.imageryProvider)&&!1!==b.imageryProvider&&(c&&(na.viewModel.selectedImagery=void 0),C.imageryLayers.removeAll(),C.imageryLayers.addImageryProvider(b.imageryProvider));l(b.terrainProvider)&&(c&&(na.viewModel.selectedTerrain=void 0),C.terrainProvider=b.terrainProvider);var pa;if(!l(b.navigationHelpButton)||!1!==b.navigationHelpButton){pa=!0;try{if(l(window.localStorage)){var qa=window.localStorage.getItem("cesium-hasSeenNavHelp");l(qa)&&qa?pa=!1:window.localStorage.setItem("cesium-hasSeenNavHelp","true")}}catch(tc){}pa=new Q({container:X,instructionsInitiallyVisible:g(b.navigationInstructionsInitiallyVisible,pa)})}var ua;l(b.animation)&&!1===b.animation||(ua=document.createElement("div"),ua.className="cesium-viewer-animationContainer",f.appendChild(ua),ua=new L(ua,new K(w)));var Pa;l(b.timeline)&&!1===b.timeline||(qa=document.createElement("div"),qa.className="cesium-viewer-timelineContainer",f.appendChild(qa),Pa=new V(qa,v),Pa.addEventListener("settime",x,!1),Pa.zoomTo(v.startTime,v.stopTime));var Hb,db,tb;l(b.fullscreenButton)&&!1===b.fullscreenButton||(tb=document.createElement("div"),tb.className="cesium-viewer-fullscreenContainer",f.appendChild(tb),Hb=new U(tb,b.fullscreenElement),db=da(Hb.viewModel,"isFullscreenEnabled",function(a){tb.style.display=a?"block":"none";l(Pa)&&(Pa.container.style.right=tb.clientWidth+"px",Pa.resize())}));var pb,cc,sc;if(b.vrButton){var Za=document.createElement("div");Za.className="cesium-viewer-vrContainer";f.appendChild(Za);pb=new ba(Za,C,b.fullScreenElement);cc=da(pb.viewModel,"isVREnabled",function(a){Za.style.display=a?"block":"none";l(Hb)&&(Za.style.right=tb.clientWidth+"px");l(Pa)&&(Pa.container.style.right=Za.clientWidth+"px",Pa.resize())});sc=da(pb.viewModel,"isVRMode",function(a){var b=e._geocoder,c=e._homeButton,d=e._sceneModePicker,f=e._projectionPicker,g=e._baseLayerPicker,h=e._animation,k=e._timeline,m=e._fullscreenButton,p=e._infoBox,q=e._selectionIndicator,r=a?"hidden":"visible";l(b)&&(b.container.style.visibility=r);l(c)&&(c.container.style.visibility=r);l(d)&&(d.container.style.visibility=r);l(f)&&(f.container.style.visibility=r);l(g)&&(g.container.style.visibility=r);l(h)&&(h.container.style.visibility=r);l(k)&&(k.container.style.visibility=r);l(m)&&m.viewModel.isFullscreenEnabled&&(m.container.style.visibility=r);l(p)&&(p.container.style.visibility=r);l(q)&&(q.container.style.visibility=r);e._container&&(a=a||!l(m)?0:m.container.clientWidth,e._vrButton.container.style.right=a+"px",e.forceResize())})}this._baseLayerPickerDropDown=oa;this._fullscreenSubscription=db;this._vrSubscription=cc;this._vrModeSubscription=sc;this._dataSourceChangedListeners={};this._automaticallyTrackDataSourceClocks=g(b.automaticallyTrackDataSourceClocks,!0);this._container=a;this._bottomContainer=q;this._element=f;this._cesiumWidget=m;this._selectionIndicator=I;this._infoBox=J;this._dataSourceCollection=A;this._destroyDataSourceCollection=D;this._dataSourceDisplay=E;this._clockViewModel=w;this._destroyClockViewModel=y;this._toolbar=X;this._homeButton=ka;this._sceneModePicker=la;this._projectionPicker=wa;this._baseLayerPicker=na;this._navigationHelpButton=pa;this._animation=ua;this._timeline=Pa;this._fullscreenButton=Hb;this._vrButton=pb;this._geocoder=ga;this._eventHelper=H;this._lastHeight=this._lastWidth=0;this._allowDataSourcesToSuspendAnimation=!0;this._entityView=void 0;this._enableInfoOrSelection=l(J)||l(I);this._trackedEntity=this._clockTrackedDataSource=void 0;this._needTrackedEntityUpdate=!1;this._clockTrackedDataSource=this._selectedEntity=void 0;this._zoomIsFlight=this._forceResize=!1;this._zoomOptions=this._zoomPromise=this._zoomTarget=void 0;this._selectedEntityChanged=new p;this._trackedEntityChanged=new p;G.track(this,["_trackedEntity","_selectedEntity","_clockTrackedDataSource"]);H.add(A.dataSourceAdded,ia.prototype._onDataSourceAdded,this);H.add(A.dataSourceRemoved,ia.prototype._onDataSourceRemoved,this);H.add(C.postUpdate,ia.prototype.resize,this);H.add(C.postRender,ia.prototype._postRender,this);f=A.length;for(q=0;q<f;q++)this._dataSourceAdded(A,A.get(q));this._dataSourceAdded(void 0,E.defaultDataSource);H.add(A.dataSourceAdded,ia.prototype._dataSourceAdded,this);H.add(A.dataSourceRemoved,ia.prototype._dataSourceRemoved,this);m.screenSpaceEventHandler.setInputAction(function(a){e.selectedEntity=fa(e,a)},u.LEFT_CLICK);m.screenSpaceEventHandler.setInputAction(function(a){a=fa(e,a);l(a)?B.getValueOrUndefined(a.position,e.clock.currentTime)?e.trackedEntity=a:e.zoomTo(a):l(e.trackedEntity)&&(e.trackedEntity=void 0)},u.LEFT_DOUBLE_CLICK)}function la(a,b,c,d){if(!l(b))throw new h("zoomTarget is required.");pa(a);var e=E.defer();a._zoomPromise=e;a._zoomIsFlight=d;a._zoomOptions=c;E(b,function(b){if(a._zoomPromise===e)if(b instanceof H)b.getViewableRectangle().then(function(b){return I(b,a.scene)}).then(function(b){a._zoomPromise===e&&(a._zoomTarget=b)});else if(b instanceof C)a._zoomTarget=b;else if(b instanceof w)a._zoomTarget=b;else if(b.isLoading&&l(b.loadingEvent))var c=b.loadingEvent.addEventListener(function(){c();a._zoomPromise===e&&(a._zoomTarget=b.entities.values.slice(0))});else t(b)?a._zoomTarget=b.slice(0):(b=g(b.values,b),l(b.entities)&&(b=b.entities.values),t(b)?a._zoomTarget=b.slice(0):a._zoomTarget=[b])});a.scene.requestRender();return e.promise}function ha(a){a._zoomPromise=void 0;a._zoomTarget=void 0;a._zoomOptions=void 0}function pa(a){var b=a._zoomPromise;l(b)&&(ha(a),b.resolve(!1))}function oa(a){var c=a._zoomTarget;if(l(c)&&a.scene.mode!==J.MORPHING){var d=a.scene,e=d.camera,h=a._zoomPromise,k=g(a._zoomOptions,{}),m;if(c instanceof C)return c.readyPromise.then(function(){var b=c.boundingSphere;l(k.offset)||(k.offset=new q(0,-.5,b.radius));m={offset:k.offset,duration:k.duration,maximumHeight:k.maximumHeight,complete:function(){h.resolve(!0)},cancel:function(){h.resolve(!1)}};a._zoomIsFlight?e.flyToBoundingSphere(c.boundingSphere,m):(e.viewBoundingSphere(b,k.offset),e.lookAtTransform(r.IDENTITY),h.resolve(!0));ha(a)});if(c instanceof w)return c.readyPromise.then(function(){var b=c.boundingSphere;l(k.offset)||(k.offset=new q(0,-.5,b.radius));m={offset:k.offset,duration:k.duration,maximumHeight:k.maximumHeight,complete:function(){h.resolve(!0)},cancel:function(){h.resolve(!1)}};a._zoomIsFlight?e.flyToBoundingSphere(b,m):(e.viewBoundingSphere(b,k.offset),e.lookAtTransform(r.IDENTITY),h.resolve(!0));ha(a)});if(c instanceof f)m={destination:d.mapProjection.ellipsoid.cartographicToCartesian(c),duration:k.duration,maximumHeight:k.maximumHeight,complete:function(){h.resolve(!0)},cancel:function(){h.resolve(!1)}},a._zoomIsFlight?e.flyTo(m):(e.setView(m),h.resolve(!0)),ha(a);else{for(var d=[],p=0,t=c.length;p<t;p++){var u=a._dataSourceDisplay.getBoundingSphere(c[p],!1,qa);if(u===y.PENDING)return;u!==y.FAILED&&d.push(b.clone(qa))}0===d.length?pa(a):(a.trackedEntity=void 0,d=b.fromBoundingSpheres(d),a._zoomIsFlight?(ha(a),e.flyToBoundingSphere(d,{duration:k.duration,maximumHeight:k.maximumHeight,complete:function(){h.resolve(!0)},cancel:function(){h.resolve(!1)},offset:k.offset})):(e.viewBoundingSphere(d,k.offset),e.lookAtTransform(r.IDENTITY),ha(a),h.resolve(!0)))}}}var qa=new b,ua=new a;m(ia.prototype,{container:{get:function(){return this._container}},bottomContainer:{get:function(){return this._bottomContainer}},cesiumWidget:{get:function(){return this._cesiumWidget}},selectionIndicator:{get:function(){return this._selectionIndicator}},infoBox:{get:function(){return this._infoBox}},geocoder:{get:function(){return this._geocoder}},homeButton:{get:function(){return this._homeButton}},sceneModePicker:{get:function(){return this._sceneModePicker}},projectionPicker:{get:function(){return this._projectionPicker}},baseLayerPicker:{get:function(){return this._baseLayerPicker}},navigationHelpButton:{get:function(){return this._navigationHelpButton}},animation:{get:function(){return this._animation}},timeline:{get:function(){return this._timeline}},fullscreenButton:{get:function(){return this._fullscreenButton}},vrButton:{get:function(){return this._vrButton}},dataSourceDisplay:{get:function(){return this._dataSourceDisplay}},entities:{get:function(){return this._dataSourceDisplay.defaultDataSource.entities}},dataSources:{get:function(){return this._dataSourceCollection}},canvas:{get:function(){return this._cesiumWidget.canvas}},scene:{get:function(){return this._cesiumWidget.scene}},shadows:{get:function(){return this.scene.shadowMap.enabled},set:function(a){this.scene.shadowMap.enabled=a}},terrainShadows:{get:function(){return this.scene.globe.shadows},set:function(a){this.scene.globe.shadows=a}},shadowMap:{get:function(){return this.scene.shadowMap}},imageryLayers:{get:function(){return this.scene.imageryLayers}},terrainProvider:{get:function(){return this.scene.terrainProvider},set:function(a){this.scene.terrainProvider=a}},camera:{get:function(){return this.scene.camera}},postProcessStages:{get:function(){return this.scene.postProcessStages}},clock:{get:function(){return this._clockViewModel.clock}},clockViewModel:{get:function(){return this._clockViewModel}},screenSpaceEventHandler:{get:function(){return this._cesiumWidget.screenSpaceEventHandler}},targetFrameRate:{get:function(){return this._cesiumWidget.targetFrameRate},set:function(a){this._cesiumWidget.targetFrameRate=a}},useDefaultRenderLoop:{get:function(){return this._cesiumWidget.useDefaultRenderLoop},set:function(a){this._cesiumWidget.useDefaultRenderLoop=a}},resolutionScale:{get:function(){return this._cesiumWidget.resolutionScale},set:function(a){this._cesiumWidget.resolutionScale=a;this._forceResize=!0}},allowDataSourcesToSuspendAnimation:{get:function(){return this._allowDataSourcesToSuspendAnimation},set:function(a){this._allowDataSourcesToSuspendAnimation=a}},trackedEntity:{get:function(){return this._trackedEntity},set:function(a){if(this._trackedEntity!==a){this._trackedEntity=a;pa(this);var b=this.scene,c=b.mode;if(l(a)&&l(a.position))this._needTrackedEntityUpdate=!0;else{this._needTrackedEntityUpdate=!1;if(c===J.COLUMBUS_VIEW||c===J.SCENE2D)b.screenSpaceCameraController.enableTranslate=!0;if(c===J.COLUMBUS_VIEW||c===J.SCENE3D)b.screenSpaceCameraController.enableTilt=!0;this._entityView=void 0;this.camera.lookAtTransform(r.IDENTITY)}this._trackedEntityChanged.raiseEvent(a);this.scene.requestRender()}}},selectedEntity:{get:function(){return this._selectedEntity},set:function(a){if(this._selectedEntity!==a){this._selectedEntity=a;var b=l(this._selectionIndicator)?this._selectionIndicator.viewModel:void 0;l(a)?l(b)&&b.animateAppear():l(b)&&b.animateDepart();this._selectedEntityChanged.raiseEvent(a)}}},selectedEntityChanged:{get:function(){return this._selectedEntityChanged}},trackedEntityChanged:{get:function(){return this._trackedEntityChanged}},clockTrackedDataSource:{get:function(){return this._clockTrackedDataSource},set:function(a){this._clockTrackedDataSource!==a&&(this._clockTrackedDataSource=a,ga(this._timeline,this.clock,a))}}});ia.prototype.extend=function(a,b){if(!l(a))throw new h("mixin is required.");a(this,b)};ia.prototype.resize=function(){var a=this._cesiumWidget,b=this._container,c=b.clientWidth,b=b.clientHeight,d=l(this._animation),e=l(this._timeline);if(this._forceResize||c!==this._lastWidth||b!==this._lastHeight){a.resize();this._forceResize=!1;var a=b-125,f=this._baseLayerPickerDropDown;l(f)&&(f.style.maxHeight=a+"px");l(this._geocoder)&&(this._geocoder.searchSuggestionsContainer.style.maxHeight=a+"px");l(this._infoBox)&&(this._infoBox.viewModel.maxHeight=a);var a=this._timeline,g,h=g=f=0;if(d&&"hidden"!==window.getComputedStyle(this._animation.container).visibility){d=this._lastWidth;g=this._animation.container;if(900<c)f=169,900>=d&&(g.style.width="169px",g.style.height="112px",this._animation.resize());else if(600<=c){if(f=136,600>d||900<d)g.style.width="136px",g.style.height="90px",this._animation.resize()}else if(f=106,600<d||0===d)g.style.width="106px",g.style.height="70px",this._animation.resize();g=f+5}if(e&&"hidden"!==window.getComputedStyle(this._timeline.container).visibility){var e=this._fullscreenButton,d=this._vrButton,h=a.container,k=h.style,h=h.clientHeight+3;k.left=f+"px";f=0;l(e)&&(f+=e.container.clientWidth);l(d)&&(f+=d.container.clientWidth);k.right=f+"px";a.resize()}this._bottomContainer.style.left=g+"px";this._bottomContainer.style.bottom=h+"px";this._lastWidth=c;this._lastHeight=b}};ia.prototype.forceResize=function(){this._lastWidth=0;this.resize()};ia.prototype.render=function(){this._cesiumWidget.render()};ia.prototype.isDestroyed=function(){return!1};ia.prototype.destroy=function(){var a;this.screenSpaceEventHandler.removeInputAction(u.LEFT_CLICK);this.screenSpaceEventHandler.removeInputAction(u.LEFT_DOUBLE_CLICK);var b=this.dataSources,c=b.length;for(a=0;a<c;a++)this._dataSourceRemoved(b,b.get(a));this._dataSourceRemoved(void 0,this._dataSourceDisplay.defaultDataSource);this._container.removeChild(this._element);this._element.removeChild(this._toolbar);this._eventHelper.removeAll();l(this._geocoder)&&(this._geocoder=this._geocoder.destroy());l(this._homeButton)&&(this._homeButton=this._homeButton.destroy());l(this._sceneModePicker)&&(this._sceneModePicker=this._sceneModePicker.destroy());l(this._projectionPicker)&&(this._projectionPicker=this._projectionPicker.destroy());l(this._baseLayerPicker)&&(this._baseLayerPicker=this._baseLayerPicker.destroy());l(this._animation)&&(this._element.removeChild(this._animation.container),this._animation=this._animation.destroy());l(this._timeline)&&(this._timeline.removeEventListener("settime",x,!1),this._element.removeChild(this._timeline.container),this._timeline=this._timeline.destroy());l(this._fullscreenButton)&&(this._fullscreenSubscription.dispose(),this._element.removeChild(this._fullscreenButton.container),this._fullscreenButton=this._fullscreenButton.destroy());l(this._vrButton)&&(this._vrSubscription.dispose(),this._vrModeSubscription.dispose(),this._element.removeChild(this._vrButton.container),this._vrButton=this._vrButton.destroy());l(this._infoBox)&&(this._element.removeChild(this._infoBox.container),this._infoBox=this._infoBox.destroy());l(this._selectionIndicator)&&(this._element.removeChild(this._selectionIndicator.container),this._selectionIndicator=this._selectionIndicator.destroy());this._destroyClockViewModel&&(this._clockViewModel=this._clockViewModel.destroy());this._dataSourceDisplay=this._dataSourceDisplay.destroy();this._cesiumWidget=this._cesiumWidget.destroy();this._destroyDataSourceCollection&&(this._dataSourceCollection=this._dataSourceCollection.destroy());return e(this)};ia.prototype._dataSourceAdded=function(a,b){b.entities.collectionChanged.addEventListener(ia.prototype._onEntityCollectionChanged,this)};ia.prototype._dataSourceRemoved=function(a,b){var c=b.entities;c.collectionChanged.removeEventListener(ia.prototype._onEntityCollectionChanged,this);l(this.trackedEntity)&&c.getById(this.trackedEntity.id)===this.trackedEntity&&(this.trackedEntity=void 0);l(this.selectedEntity)&&c.getById(this.selectedEntity.id)===this.selectedEntity&&(this.selectedEntity=void 0)};ia.prototype._onTick=function(b){b=b.currentTime;var c=this._dataSourceDisplay.update(b);this._allowDataSourcesToSuspendAnimation&&(this._clockViewModel.canAnimate=c);c=this._entityView;l(c)&&this._dataSourceDisplay.getBoundingSphere(this._trackedEntity,!1,qa)===y.DONE&&c.update(b,qa);var d,c=!1,e=this.selectedEntity,f=l(e)&&this._enableInfoOrSelection;f&&e.isShowing&&e.isAvailable(b)&&(this._dataSourceDisplay.getBoundingSphere(e,!0,qa)!==y.FAILED?d=qa.center:l(e.position)&&(d=e.position.getValue(b,d)),c=l(d));var h=l(this._selectionIndicator)?this._selectionIndicator.viewModel:void 0;l(h)&&(h.position=a.clone(d,h.position),h.showSelection=f&&c,h.update());d=l(this._infoBox)?this._infoBox.viewModel:void 0;l(d)&&(d.showInfo=f,d.enableCamera=c,d.isCameraTracking=this.trackedEntity===this.selectedEntity,f?(d.titleText=g(e.name,e.id),d.description=B.getValueOrDefault(e.description,b,"")):(d.titleText="",d.description=""))};ia.prototype._onEntityCollectionChanged=function(a,b,c){a=c.length;for(b=0;b<a;b++){var d=c[b];this.trackedEntity===d&&(this.trackedEntity=void 0);this.selectedEntity===d&&(this.selectedEntity=void 0)}};ia.prototype._onInfoBoxCameraClicked=function(a){a.isCameraTracking&&this.trackedEntity===this.selectedEntity?this.trackedEntity=void 0:l(this.selectedEntity.position)?this.trackedEntity=this.selectedEntity:this.zoomTo(this.selectedEntity)};ia.prototype._clearTrackedObject=function(){this.trackedEntity=void 0};ia.prototype._onInfoBoxClockClicked=function(a){this.selectedEntity=void 0};ia.prototype._clearObjects=function(){this.selectedEntity=this.trackedEntity=void 0};ia.prototype._onDataSourceChanged=function(a){this.clockTrackedDataSource===a&&ga(this.timeline,this.clock,a)};ia.prototype._onDataSourceAdded=function(a,b){this._automaticallyTrackDataSourceClocks&&(this.clockTrackedDataSource=b);var c=b.entities.id,d=this._eventHelper.add(b.changedEvent,ia.prototype._onDataSourceChanged,this);this._dataSourceChangedListeners[c]=d};ia.prototype._onDataSourceRemoved=function(a,b){var c=this.clockTrackedDataSource===b,d=b.entities.id;this._dataSourceChangedListeners[d]();this._dataSourceChangedListeners[d]=void 0;c&&(c=a.length,this.clockTrackedDataSource=this._automaticallyTrackDataSourceClocks&&0<c?a.get(c-1):void 0)};ia.prototype.zoomTo=function(a,b){return la(this,a,{offset:b},!1)};ia.prototype.flyTo=function(a,b){return la(this,a,b,!0)};ia.prototype._postRender=function(){oa(this);if(this._needTrackedEntityUpdate){var a=this._trackedEntity,b=this.clock.currentTime,c=B.getValueOrUndefined(a.position,b);if(l(c)){var c=this.scene,d=this._dataSourceDisplay.getBoundingSphere(a,!1,qa);if(d!==y.PENDING){var e=c.mode;if(e===J.COLUMBUS_VIEW||e===J.SCENE2D)c.screenSpaceCameraController.enableTranslate=!1;if(e===J.COLUMBUS_VIEW||e===J.SCENE3D)c.screenSpaceCameraController.enableTilt=!1;d=d!==y.FAILED?qa:void 0;this._entityView=new v(a,c,c.mapProjection.ellipsoid);this._entityView.update(b,d);this._needTrackedEntityUpdate=!1}}}};return ia});F("Widgets/Viewer/viewerCesium3DTilesInspectorMixin",["../../Core/Check","../../Core/defineProperties","../Cesium3DTilesInspector/Cesium3DTilesInspector"],function(b,a,f){return function(k){b.typeOf.object("viewer",k);var g=document.createElement("div");g.className="cesium-viewer-cesium3DTilesInspectorContainer";k.container.appendChild(g);var l=new f(g,k.scene);a(k,{cesium3DTilesInspector:{get:function(){return l}}})}});F("Widgets/Viewer/viewerCesiumInspectorMixin",["../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../CesiumInspector/CesiumInspector"],function(b,a,f,k){return function(g){if(!b(g))throw new f("viewer is required.");var l=document.createElement("div");l.className="cesium-viewer-cesiumInspectorContainer";g.container.appendChild(l);var m=new k(l,g.scene);a(g,{cesiumInspector:{get:function(){return m}}})}});F("Widgets/Viewer/viewerDragDropMixin","../../Core/defaultValue ../../Core/defined ../../Core/defineProperties ../../Core/DeveloperError ../../Core/Event ../../Core/wrapFunction ../../DataSources/CzmlDataSource ../../DataSources/GeoJsonDataSource ../../DataSources/KmlDataSource ../getElement".split(" "),function(b,a,f,k,g,l,m,e,h,p){function d(a){a.stopPropagation();a.preventDefault()}function q(b,c){a(b)&&(b.removeEventListener("drop",c,!1),b.removeEventListener("dragenter",d,!1),b.removeEventListener("dragover",d,!1),b.removeEventListener("dragexit",d,!1))}function t(a,b){a.addEventListener("drop",b,!1);a.addEventListener("dragenter",d,!1);a.addEventListener("dragover",d,!1);a.addEventListener("dragexit",d,!1)}function r(b,c,d,f){var g=b.scene;return function(k){var l=c.name;try{var p;if(/\.czml$/i.test(l))p=m.load(JSON.parse(k.target.result),{sourceUri:l});else if(/\.geojson$/i.test(l)||/\.json$/i.test(l)||/\.topojson$/i.test(l))p=e.load(JSON.parse(k.target.result),{sourceUri:l,clampToGround:f});else if(/\.(kml|kmz)$/i.test(l))p=h.load(c,{sourceUri:l,proxy:d,camera:g.camera,canvas:g.canvas,clampToGround:f});else{b.dropError.raiseEvent(b,l,"Unrecognized file: "+l);return}a(p)&&b.dataSources.add(p).then(function(a){b.flyToOnDrop&&b.flyTo(a)}).otherwise(function(a){b.dropError.raiseEvent(b,l,a)})}catch(C){b.dropError.raiseEvent(b,l,C)}}}function c(a,b){return function(c){a.dropError.raiseEvent(a,b.name,c.target.error)}}return function(e,h){function m(a){d(a);v&&(e.entities.removeAll(),e.dataSources.removeAll());a=a.dataTransfer.files;for(var b=a.length,f=0;f<b;f++){var g=a[f],h=new FileReader;h.onload=r(e,g,F,C);h.onerror=c(e,g);h.readAsText(g)}}if(!a(e))throw new k("viewer is required.");if(e.hasOwnProperty("dropTarget"))throw new k("dropTarget is already defined by another mixin.");if(e.hasOwnProperty("dropEnabled"))throw new k("dropEnabled is already defined by another mixin.");if(e.hasOwnProperty("dropError"))throw new k("dropError is already defined by another mixin.");if(e.hasOwnProperty("clearOnDrop"))throw new k("clearOnDrop is already defined by another mixin.");if(e.hasOwnProperty("flyToOnDrop"))throw new k("flyToOnDrop is already defined by another mixin.");h=b(h,b.EMPTY_OBJECT);var u=!0,y=b(h.flyToOnDrop,!0),D=new g,v=b(h.clearOnDrop,!0),B=b(h.dropTarget,e.container),C=b(h.clampToGround,!0),F=h.proxy,B=p(B);f(e,{dropTarget:{get:function(){return B},set:function(b){if(!a(b))throw new k("value is required.");q(B,m);B=b;t(B,m)}},dropEnabled:{get:function(){return u},set:function(a){a!==u&&(a?t(B,m):q(B,m),u=a)}},dropError:{get:function(){return D}},clearOnDrop:{get:function(){return v},set:function(a){v=a}},flyToOnDrop:{get:function(){return y},set:function(a){y=a}},proxy:{get:function(){return F},set:function(a){F=a}},clampToGround:{get:function(){return C},set:function(a){C=a}}});t(B,m);e.destroy=l(e,e.destroy,function(){e.dropEnabled=!1});e._handleDrop=m}});F("Widgets/Viewer/viewerPerformanceWatchdogMixin",["../../Core/defaultValue","../../Core/defined","../../Core/defineProperties","../../Core/DeveloperError","../PerformanceWatchdog/PerformanceWatchdog"],function(b,a,f,k,g){return function(l,m){if(!a(l))throw new k("viewer is required.");m=b(m,b.EMPTY_OBJECT);var e=new g({scene:l.scene,container:l.bottomContainer,lowFrameRateMessage:m.lowFrameRateMessage});f(l,{performanceWatchdog:{get:function(){return e}}})}});F("Workers/createTaskProcessorWorker",["../ThirdParty/when","../Core/defaultValue","../Core/defined","../Core/formatError"],function(b,a,f,k){function g(a,f,e){var g;try{return g=a(f,e)}catch(p){return b.reject(p)}}return function(l){var m;return function(e){var h=e.data,p=[],d={id:h.id,result:void 0,error:void 0};return b(g(l,h.parameters,p)).then(function(a){d.result=a}).otherwise(function(a){d.error=a instanceof Error?{name:a.name,message:a.message,stack:a.stack}:a}).always(function(){f(m)||(m=a(self.webkitPostMessage,self.postMessage));h.canTransferArrayBuffer||(p.length=0);try{m(d,p)}catch(q){d.result=void 0,d.error="postMessage failed with error: "+k(q)+"\n  with responseMessage: "+JSON.stringify(d),m(d)}})}}});F("Cesium","./Core/appendForwardSlash ./Core/ApproximateTerrainHeights ./Core/ArcGISTiledElevationTerrainProvider ./Core/ArcType ./Core/arrayFill ./Core/arrayRemoveDuplicates ./Core/arraySlice ./Core/AssociativeArray ./Core/AttributeCompression ./Core/AxisAlignedBoundingBox ./Core/barycentricCoordinates ./Core/binarySearch ./Core/BingMapsApi ./Core/BingMapsGeocoderService ./Core/BoundingRectangle ./Core/BoundingSphere ./Core/BoxGeometry ./Core/BoxOutlineGeometry ./Core/buildModuleUrl ./Core/cancelAnimationFrame ./Core/Cartesian2 ./Core/Cartesian3 ./Core/Cartesian4 ./Core/Cartographic ./Core/CartographicGeocoderService ./Core/CatmullRomSpline ./Core/CesiumTerrainProvider ./Core/Check ./Core/CircleGeometry ./Core/CircleOutlineGeometry ./Core/Clock ./Core/ClockRange ./Core/ClockStep ./Core/clone ./Core/Color ./Core/ColorGeometryInstanceAttribute ./Core/combine ./Core/ComponentDatatype ./Core/CompressedTextureBuffer ./Core/CoplanarPolygonGeometry ./Core/CoplanarPolygonGeometryLibrary ./Core/CoplanarPolygonOutlineGeometry ./Core/CornerType ./Core/CorridorGeometry ./Core/CorridorGeometryLibrary ./Core/CorridorOutlineGeometry ./Core/createGuid ./Core/createWorldTerrain ./Core/Credit ./Core/CubicRealPolynomial ./Core/CullingVolume ./Core/CylinderGeometry ./Core/CylinderGeometryLibrary ./Core/CylinderOutlineGeometry ./Core/decodeGoogleEarthEnterpriseData ./Core/DefaultProxy ./Core/defaultValue ./Core/defined ./Core/defineProperties ./Core/deprecationWarning ./Core/destroyObject ./Core/DeveloperError ./Core/DistanceDisplayCondition ./Core/DistanceDisplayConditionGeometryInstanceAttribute ./Core/DoublyLinkedList ./Core/EarthOrientationParameters ./Core/EarthOrientationParametersSample ./Core/EasingFunction ./Core/EllipseGeometry ./Core/EllipseGeometryLibrary ./Core/EllipseOutlineGeometry ./Core/Ellipsoid ./Core/EllipsoidalOccluder ./Core/EllipsoidGeodesic ./Core/EllipsoidGeometry ./Core/EllipsoidOutlineGeometry ./Core/EllipsoidRhumbLine ./Core/EllipsoidTangentPlane ./Core/EllipsoidTerrainProvider ./Core/EncodedCartesian3 ./Core/Event ./Core/EventHelper ./Core/ExtrapolationType ./Core/FeatureDetection ./Core/formatError ./Core/freezeObject ./Core/FrustumGeometry ./Core/FrustumOutlineGeometry ./Core/Fullscreen ./Core/GeocoderService ./Core/GeocodeType ./Core/GeographicProjection ./Core/GeographicTilingScheme ./Core/Geometry ./Core/GeometryAttribute ./Core/GeometryAttributes ./Core/GeometryInstance ./Core/GeometryInstanceAttribute ./Core/GeometryOffsetAttribute ./Core/GeometryPipeline ./Core/GeometryType ./Core/getAbsoluteUri ./Core/getBaseUri ./Core/getExtensionFromUri ./Core/getFilenameFromUri ./Core/getImagePixels ./Core/getMagic ./Core/getStringFromTypedArray ./Core/getTimestamp ./Core/GoogleEarthEnterpriseMetadata ./Core/GoogleEarthEnterpriseTerrainData ./Core/GoogleEarthEnterpriseTerrainProvider ./Core/GoogleEarthEnterpriseTileInformation ./Core/GregorianDate ./Core/GroundPolylineGeometry ./Core/HeadingPitchRange ./Core/HeadingPitchRoll ./Core/Heap ./Core/HeightmapEncoding ./Core/HeightmapTerrainData ./Core/HeightmapTessellator ./Core/HermitePolynomialApproximation ./Core/HermiteSpline ./Core/Iau2000Orientation ./Core/Iau2006XysData ./Core/Iau2006XysSample ./Core/IauOrientationAxes ./Core/IauOrientationParameters ./Core/IndexDatatype ./Core/InterpolationAlgorithm ./Core/Intersect ./Core/Intersections2D ./Core/IntersectionTests ./Core/Interval ./Core/Ion ./Core/IonGeocoderService ./Core/IonResource ./Core/isArray ./Core/isBitSet ./Core/isBlobUri ./Core/isCrossOriginUrl ./Core/isDataUri ./Core/isLeapYear ./Core/Iso8601 ./Core/JulianDate ./Core/KeyboardEventModifier ./Core/LagrangePolynomialApproximation ./Core/LeapSecond ./Core/LinearApproximation ./Core/LinearSpline ./Core/loadAndExecuteScript ./Core/loadCRN ./Core/loadImageFromTypedArray ./Core/loadKTX ./Core/ManagedArray ./Core/MapboxApi ./Core/MapProjection ./Core/Math ./Core/Matrix2 ./Core/Matrix3 ./Core/Matrix4 ./Core/mergeSort ./Core/NearFarScalar ./Core/objectToQuery ./Core/Occluder ./Core/OffsetGeometryInstanceAttribute ./Core/oneTimeWarning ./Core/OpenCageGeocoderService ./Core/OrientedBoundingBox ./Core/OrthographicFrustum ./Core/OrthographicOffCenterFrustum ./Core/Packable ./Core/PackableForInterpolation ./Core/parseResponseHeaders ./Core/PeliasGeocoderService ./Core/PerspectiveFrustum ./Core/PerspectiveOffCenterFrustum ./Core/PinBuilder ./Core/PixelFormat ./Core/Plane ./Core/PlaneGeometry ./Core/PlaneOutlineGeometry ./Core/pointInsideTriangle ./Core/PolygonGeometry ./Core/PolygonGeometryLibrary ./Core/PolygonHierarchy ./Core/PolygonOutlineGeometry ./Core/PolygonPipeline ./Core/PolylineGeometry ./Core/PolylinePipeline ./Core/PolylineVolumeGeometry ./Core/PolylineVolumeGeometryLibrary ./Core/PolylineVolumeOutlineGeometry ./Core/PrimitiveType ./Core/QuadraticRealPolynomial ./Core/QuantizedMeshTerrainData ./Core/QuarticRealPolynomial ./Core/Quaternion ./Core/QuaternionSpline ./Core/queryToObject ./Core/Queue ./Core/Ray ./Core/Rectangle ./Core/RectangleCollisionChecker ./Core/RectangleGeometry ./Core/RectangleGeometryLibrary ./Core/RectangleOutlineGeometry ./Core/ReferenceFrame ./Core/Request ./Core/requestAnimationFrame ./Core/RequestErrorEvent ./Core/RequestScheduler ./Core/RequestState ./Core/RequestType ./Core/Resource ./Core/RuntimeError ./Core/sampleTerrain ./Core/sampleTerrainMostDetailed ./Core/scaleToGeodeticSurface ./Core/ScreenSpaceEventHandler ./Core/ScreenSpaceEventType ./Core/ShowGeometryInstanceAttribute ./Core/Simon1994PlanetaryPositions ./Core/SimplePolylineGeometry ./Core/SphereGeometry ./Core/SphereOutlineGeometry ./Core/Spherical ./Core/Spline ./Core/subdivideArray ./Core/TaskProcessor ./Core/TerrainData ./Core/TerrainEncoding ./Core/TerrainMesh ./Core/TerrainProvider ./Core/TerrainQuantization ./Core/TileAvailability ./Core/TileEdge ./Core/TileProviderError ./Core/TilingScheme ./Core/TimeConstants ./Core/TimeInterval ./Core/TimeIntervalCollection ./Core/TimeStandard ./Core/Tipsify ./Core/Transforms ./Core/TranslationRotationScale ./Core/TridiagonalSystemSolver ./Core/TrustedServers ./Core/VertexFormat ./Core/VideoSynchronizer ./Core/Visibility ./Core/VRTheWorldTerrainProvider ./Core/WallGeometry ./Core/WallGeometryLibrary ./Core/WallOutlineGeometry ./Core/WebGLConstants ./Core/webGLConstantToGlslType ./Core/WebMercatorProjection ./Core/WebMercatorTilingScheme ./Core/WeightSpline ./Core/WindingOrder ./Core/wrapFunction ./Core/writeTextToCanvas ./DataSources/BillboardGraphics ./DataSources/BillboardVisualizer ./DataSources/BoundingSphereState ./DataSources/BoxGeometryUpdater ./DataSources/BoxGraphics ./DataSources/CallbackProperty ./DataSources/CheckerboardMaterialProperty ./DataSources/ColorMaterialProperty ./DataSources/CompositeEntityCollection ./DataSources/CompositeMaterialProperty ./DataSources/CompositePositionProperty ./DataSources/CompositeProperty ./DataSources/ConstantPositionProperty ./DataSources/ConstantProperty ./DataSources/CorridorGeometryUpdater ./DataSources/CorridorGraphics ./DataSources/createMaterialPropertyDescriptor ./DataSources/createPropertyDescriptor ./DataSources/createRawPropertyDescriptor ./DataSources/CustomDataSource ./DataSources/CylinderGeometryUpdater ./DataSources/CylinderGraphics ./DataSources/CzmlDataSource ./DataSources/DataSource ./DataSources/DataSourceClock ./DataSources/DataSourceCollection ./DataSources/DataSourceDisplay ./DataSources/DynamicGeometryBatch ./DataSources/DynamicGeometryUpdater ./DataSources/EllipseGeometryUpdater ./DataSources/EllipseGraphics ./DataSources/EllipsoidGeometryUpdater ./DataSources/EllipsoidGraphics ./DataSources/Entity ./DataSources/EntityCluster ./DataSources/EntityCollection ./DataSources/EntityView ./DataSources/exportKml ./DataSources/GeoJsonDataSource ./DataSources/GeometryUpdater ./DataSources/GeometryVisualizer ./DataSources/GridMaterialProperty ./DataSources/GroundGeometryUpdater ./DataSources/heightReferenceOnEntityPropertyChanged ./DataSources/ImageMaterialProperty ./DataSources/KmlCamera ./DataSources/KmlDataSource ./DataSources/KmlLookAt ./DataSources/KmlTour ./DataSources/KmlTourFlyTo ./DataSources/KmlTourWait ./DataSources/LabelGraphics ./DataSources/LabelVisualizer ./DataSources/MaterialProperty ./DataSources/ModelGraphics ./DataSources/ModelVisualizer ./DataSources/NodeTransformationProperty ./DataSources/PathGraphics ./DataSources/PathVisualizer ./DataSources/PlaneGeometryUpdater ./DataSources/PlaneGraphics ./DataSources/PointGraphics ./DataSources/PointVisualizer ./DataSources/PolygonGeometryUpdater ./DataSources/PolygonGraphics ./DataSources/PolylineArrowMaterialProperty ./DataSources/PolylineDashMaterialProperty ./DataSources/PolylineGeometryUpdater ./DataSources/PolylineGlowMaterialProperty ./DataSources/PolylineGraphics ./DataSources/PolylineOutlineMaterialProperty ./DataSources/PolylineVisualizer ./DataSources/PolylineVolumeGeometryUpdater ./DataSources/PolylineVolumeGraphics ./DataSources/PositionProperty ./DataSources/PositionPropertyArray ./DataSources/Property ./DataSources/PropertyArray ./DataSources/PropertyBag ./DataSources/RectangleGeometryUpdater ./DataSources/RectangleGraphics ./DataSources/ReferenceProperty ./DataSources/Rotation ./DataSources/SampledPositionProperty ./DataSources/SampledProperty ./DataSources/ScaledPositionProperty ./DataSources/StaticGeometryColorBatch ./DataSources/StaticGeometryPerMaterialBatch ./DataSources/StaticGroundGeometryColorBatch ./DataSources/StaticGroundGeometryPerMaterialBatch ./DataSources/StaticGroundPolylinePerMaterialBatch ./DataSources/StaticOutlineGeometryBatch ./DataSources/StripeMaterialProperty ./DataSources/StripeOrientation ./DataSources/TerrainOffsetProperty ./DataSources/TimeIntervalCollectionPositionProperty ./DataSources/TimeIntervalCollectionProperty ./DataSources/VelocityOrientationProperty ./DataSources/VelocityVectorProperty ./DataSources/Visualizer ./DataSources/WallGeometryUpdater ./DataSources/WallGraphics ./FeDataSources/ElliposidFadeMaterialProperty ./FeDataSources/PolylineArrowLinkMaterialProperty ./FeSceneEx/FeAutoTransForm ./FeSceneEx/FeClound ./FeSceneEx/FeConstellation ./FeSceneEx/FeDrawCommand ./FeSceneEx/FeFlatClound ./FeSceneEx/FeFlyLine ./FeSceneEx/FeGeometry ./FeSceneEx/FeGeometryCreator ./FeSceneEx/FeLodPlaceMark ./FeSceneEx/FeLodVecLine ./FeSceneEx/FeOctreeTriangleSelector ./FeSceneEx/FePlaceMarkGroup ./FeSceneEx/FePlaceMarkGroupManager ./FeSceneEx/FePrecipitation ./FeSceneEx/FeRadarAppearance ./FeSceneEx/FeRadarEffect ./FeSceneEx/FeSatelliteManager ./FeSceneEx/FeScanRadarPrimitive ./FeSceneEx/FeSkyStar ./FeSceneEx/FeVecLineGroup ./FeSceneEx/FeVecLineGroupManager ./FeSceneEx/FeWindPrimitive ./FeShadersEx/BillboardCollectionDisableFxaaFS ./FeShadersEx/FeCloundFS ./FeShadersEx/FeConstellationFS ./FeShadersEx/FeConstellationVS ./FeShadersEx/FeFlatCloundFS ./FeShadersEx/FeFlatCloundVS ./FeShadersEx/FeFlyLineFS ./FeShadersEx/FeFlyLineVS ./FeShadersEx/FePrecipitationFS ./FeShadersEx/FePrecipitationVS ./FeShadersEx/FeRadarAppearanceFS ./FeShadersEx/FeRadarAppearanceVS ./FeShadersEx/FeScanRadarFS ./FeShadersEx/FeScanRadarVS ./FeShadersEx/FeStarConstellationFS ./FeShadersEx/FeStarConstellationVS ./FeShadersEx/FeWindFS ./FeShadersEx/FeWindVS ./Renderer/AutomaticUniforms ./Renderer/Buffer ./Renderer/BufferUsage ./Renderer/ClearCommand ./Renderer/ComputeCommand ./Renderer/ComputeEngine ./Renderer/Context ./Renderer/ContextLimits ./Renderer/createUniform ./Renderer/createUniformArray ./Renderer/CubeMap ./Renderer/CubeMapFace ./Renderer/DrawCommand ./Renderer/Framebuffer ./Renderer/freezeRenderState ./Renderer/loadCubeMap ./Renderer/MipmapHint ./Renderer/modernizeShader ./Renderer/Pass ./Renderer/PassState ./Renderer/PixelDatatype ./Renderer/Renderbuffer ./Renderer/RenderbufferFormat ./Renderer/RenderState ./Renderer/Sampler ./Renderer/ShaderCache ./Renderer/ShaderProgram ./Renderer/ShaderSource ./Renderer/Texture ./Renderer/TextureCache ./Renderer/TextureMagnificationFilter ./Renderer/TextureMinificationFilter ./Renderer/TextureWrap ./Renderer/UniformState ./Renderer/VertexArray ./Renderer/VertexArrayFacade ./Scene/Appearance ./Scene/ArcGisMapServerImageryProvider ./Scene/AttributeType ./Scene/AutoExposure ./Scene/Axis ./Scene/Batched3DModel3DTileContent ./Scene/BatchTable ./Scene/Billboard ./Scene/BillboardCollection ./Scene/BingMapsImageryProvider ./Scene/BingMapsStyle ./Scene/BlendEquation ./Scene/BlendFunction ./Scene/BlendingState ./Scene/BlendOption ./Scene/BoxEmitter ./Scene/BrdfLutGenerator ./Scene/Camera ./Scene/CameraEventAggregator ./Scene/CameraEventType ./Scene/CameraFlightPath ./Scene/Cesium3DTile ./Scene/Cesium3DTileBatchTable ./Scene/Cesium3DTileColorBlendMode ./Scene/Cesium3DTileContent ./Scene/Cesium3DTileContentFactory ./Scene/Cesium3DTileContentState ./Scene/Cesium3DTileFeature ./Scene/Cesium3DTileFeatureTable ./Scene/Cesium3DTileOptimizationHint ./Scene/Cesium3DTileOptimizations ./Scene/Cesium3DTilePass ./Scene/Cesium3DTilePassState ./Scene/Cesium3DTilePointFeature ./Scene/Cesium3DTileRefine ./Scene/Cesium3DTileset ./Scene/Cesium3DTilesetCache ./Scene/Cesium3DTilesetHeatmap ./Scene/Cesium3DTilesetMostDetailedTraversal ./Scene/Cesium3DTilesetStatistics ./Scene/Cesium3DTilesetTraversal ./Scene/Cesium3DTileStyle ./Scene/Cesium3DTileStyleEngine ./Scene/CircleEmitter ./Scene/ClassificationModel ./Scene/ClassificationPrimitive ./Scene/ClassificationType ./Scene/ClippingPlane ./Scene/ClippingPlaneCollection ./Scene/ColorBlendMode ./Scene/Composite3DTileContent ./Scene/computeFlyToLocationForRectangle ./Scene/ConditionsExpression ./Scene/ConeEmitter ./Scene/createBillboardPointCallback ./Scene/createOpenStreetMapImageryProvider ./Scene/createTangentSpaceDebugPrimitive ./Scene/createTileMapServiceImageryProvider ./Scene/createWorldImagery ./Scene/CreditDisplay ./Scene/CullFace ./Scene/DebugAppearance ./Scene/DebugCameraPrimitive ./Scene/DebugModelMatrixPrimitive ./Scene/DepthFunction ./Scene/DepthPlane ./Scene/DerivedCommand ./Scene/DeviceOrientationCameraController ./Scene/DiscardEmptyTileImagePolicy ./Scene/DiscardMissingTileImagePolicy ./Scene/DracoLoader ./Scene/EllipsoidPrimitive ./Scene/EllipsoidSurfaceAppearance ./Scene/Empty3DTileContent ./Scene/Expression ./Scene/ExpressionNodeType ./Scene/Fog ./Scene/FrameRateMonitor ./Scene/FrameState ./Scene/FrustumCommands ./Scene/Geometry3DTileContent ./Scene/getBinaryAccessor ./Scene/getClipAndStyleCode ./Scene/getClippingFunction ./Scene/GetFeatureInfoFormat ./Scene/Globe ./Scene/GlobeDepth ./Scene/GlobeSurfaceShaderSet ./Scene/GlobeSurfaceTile ./Scene/GlobeSurfaceTileProvider ./Scene/GoogleEarthEnterpriseImageryProvider ./Scene/GoogleEarthEnterpriseMapsProvider ./Scene/GridImageryProvider ./Scene/GroundPolylinePrimitive ./Scene/GroundPrimitive ./Scene/HeightReference ./Scene/HorizontalOrigin ./Scene/Imagery ./Scene/ImageryLayer ./Scene/ImageryLayerCollection ./Scene/ImageryLayerFeatureInfo ./Scene/ImageryProvider ./Scene/ImagerySplitDirection ./Scene/ImageryState ./Scene/Instanced3DModel3DTileContent ./Scene/InvertClassification ./Scene/IonImageryProvider ./Scene/IonWorldImageryStyle ./Scene/JobScheduler ./Scene/JobType ./Scene/Label ./Scene/LabelCollection ./Scene/LabelStyle ./Scene/MapboxImageryProvider ./Scene/MapboxStyleImageryProvider ./Scene/MapMode2D ./Scene/Material ./Scene/MaterialAppearance ./Scene/Model ./Scene/ModelAnimation ./Scene/ModelAnimationCache ./Scene/ModelAnimationCollection ./Scene/ModelAnimationLoop ./Scene/ModelAnimationState ./Scene/ModelInstance ./Scene/ModelInstanceCollection ./Scene/ModelLoadResources ./Scene/ModelMaterial ./Scene/ModelMesh ./Scene/ModelNode ./Scene/ModelUtility ./Scene/Moon ./Scene/NeverTileDiscardPolicy ./Scene/OctahedralProjectedCubeMap ./Scene/OIT ./Scene/OrderedGroundPrimitiveCollection ./Scene/Particle ./Scene/ParticleBurst ./Scene/ParticleEmitter ./Scene/ParticleSystem ./Scene/PerformanceDisplay ./Scene/PerInstanceColorAppearance ./Scene/PickDepth ./Scene/PickDepthFramebuffer ./Scene/PickFramebuffer ./Scene/PointCloud ./Scene/PointCloud3DTileContent ./Scene/PointCloudEyeDomeLighting ./Scene/PointCloudShading ./Scene/PointPrimitive ./Scene/PointPrimitiveCollection ./Scene/Polyline ./Scene/PolylineCollection ./Scene/PolylineColorAppearance ./Scene/PolylineMaterialAppearance ./Scene/PostProcessStage ./Scene/PostProcessStageCollection ./Scene/PostProcessStageComposite ./Scene/PostProcessStageLibrary ./Scene/PostProcessStageSampleMode ./Scene/PostProcessStageTextureCache ./Scene/Primitive ./Scene/PrimitiveCollection ./Scene/PrimitivePipeline ./Scene/PrimitiveState ./Scene/processModelMaterialsCommon ./Scene/processPbrMaterials ./Scene/QuadtreeOccluders ./Scene/QuadtreePrimitive ./Scene/QuadtreeTile ./Scene/QuadtreeTileLoadState ./Scene/QuadtreeTileProvider ./Scene/Scene ./Scene/SceneFramebuffer ./Scene/SceneMode ./Scene/SceneTransforms ./Scene/SceneTransitioner ./Scene/ScreenSpaceCameraController ./Scene/ShadowMap ./Scene/ShadowMapShader ./Scene/ShadowMode ./Scene/ShadowVolumeAppearance ./Scene/SingleTileImageryProvider ./Scene/SkyAtmosphere ./Scene/SkyBox ./Scene/SphereEmitter ./Scene/StencilConstants ./Scene/StencilFunction ./Scene/StencilOperation ./Scene/StyleExpression ./Scene/Sun ./Scene/SunPostProcess ./Scene/TerrainFillMesh ./Scene/TerrainState ./Scene/TextureAtlas ./Scene/TileBoundingRegion ./Scene/TileBoundingSphere ./Scene/TileBoundingVolume ./Scene/TileCoordinatesImageryProvider ./Scene/TileDiscardPolicy ./Scene/TileImagery ./Scene/TileOrientedBoundingBox ./Scene/TileReplacementQueue ./Scene/TileSelectionResult ./Scene/Tileset3DTileContent ./Scene/TileState ./Scene/TimeDynamicImagery ./Scene/TimeDynamicPointCloud ./Scene/Tonemapper ./Scene/TweenCollection ./Scene/UrlTemplateImageryProvider ./Scene/Vector3DTileBatch ./Scene/Vector3DTileContent ./Scene/Vector3DTileGeometry ./Scene/Vector3DTilePoints ./Scene/Vector3DTilePolygons ./Scene/Vector3DTilePolylines ./Scene/Vector3DTilePrimitive ./Scene/VerticalOrigin ./Scene/View ./Scene/ViewportQuad ./Scene/WebMapServiceImageryProvider ./Scene/WebMapTileServiceImageryProvider ./Shaders/AdjustTranslucentFS ./Shaders/BillboardCollectionFS ./Shaders/BillboardCollectionVS ./Shaders/BrdfLutGeneratorFS ./Shaders/CompositeOITFS ./Shaders/DepthPlaneFS ./Shaders/DepthPlaneVS ./Shaders/EllipsoidFS ./Shaders/EllipsoidVS ./Shaders/GlobeFS ./Shaders/GlobeVS ./Shaders/GroundAtmosphere ./Shaders/OctahedralProjectionAtlasFS ./Shaders/OctahedralProjectionFS ./Shaders/OctahedralProjectionVS ./Shaders/PointPrimitiveCollectionFS ./Shaders/PointPrimitiveCollectionVS ./Shaders/PolylineCommon ./Shaders/PolylineFS ./Shaders/PolylineShadowVolumeFS ./Shaders/PolylineShadowVolumeMorphFS ./Shaders/PolylineShadowVolumeMorphVS ./Shaders/PolylineShadowVolumeVS ./Shaders/PolylineVS ./Shaders/ReprojectWebMercatorFS ./Shaders/ReprojectWebMercatorVS ./Shaders/ShadowVolumeAppearanceFS ./Shaders/ShadowVolumeAppearanceVS ./Shaders/ShadowVolumeFS ./Shaders/SkyAtmosphereFS ./Shaders/SkyAtmosphereVS ./Shaders/SkyBoxFS ./Shaders/SkyBoxVS ./Shaders/SunFS ./Shaders/SunTextureFS ./Shaders/SunVS ./Shaders/Vector3DTilePolylinesVS ./Shaders/VectorTileVS ./Shaders/ViewportQuadFS ./Shaders/ViewportQuadVS ./ThirdParty/Autolinker ./ThirdParty/earcut-2.1.1 ./ThirdParty/jsep ./ThirdParty/kdbush ./ThirdParty/knockout-3.5.0 ./ThirdParty/knockout-es5 ./ThirdParty/knockout ./ThirdParty/LercDecode ./ThirdParty/measureText ./ThirdParty/mersenne-twister ./ThirdParty/NoSleep ./ThirdParty/protobuf-minimal ./ThirdParty/purify ./ThirdParty/quickselect ./ThirdParty/rbush ./ThirdParty/sprintf ./ThirdParty/topojson ./ThirdParty/Tween ./ThirdParty/Uri ./ThirdParty/when ./ThirdParty/zip ./Widgets/ClockViewModel ./Widgets/Command ./Widgets/createCommand ./Widgets/getElement ./Widgets/InspectorShared ./Widgets/subscribeAndEvaluate ./Widgets/SvgPathBindingHandler ./Widgets/ToggleButtonViewModel ./FeDataSources/conicalRadar/ConicalRadarFramework ./FeDataSources/conicalRadar/ConicalRadarGraphics ./FeDataSources/conicalRadar/ConicalRadarPrimitive ./FeDataSources/conicalRadar/ConicalRadarVisualizer ./FeDataSources/conicSensor/RectangularSensorGraphics ./FeDataSources/conicSensor/RectangularSensorPrimitive ./FeDataSources/conicSensor/RectangularSensorVisualizer ./FeDataSources/ParabolaRadar/ParabolaRadarFramework ./FeDataSources/ParabolaRadar/ParabolaRadarGraphics ./FeDataSources/ParabolaRadar/ParabolaRadarPrimitive ./FeDataSources/ParabolaRadar/ParabolaRadarVisualizer ./FeDataSources/Ribbon/RibbonGraphics ./FeDataSources/Ribbon/RibbonPrimitive ./FeDataSources/Ribbon/RibbonVisualizer ./FeDataSources/RingconeScanner/RingconeFramework ./FeDataSources/RingconeScanner/RingconeGraphics ./FeDataSources/RingconeScanner/RingconePrimitive ./FeDataSources/RingconeScanner/RingconeVisualizer ./FeDataSources/RingRadar/RingRadarFramework ./FeDataSources/RingRadar/RingRadarGraphics ./FeDataSources/RingRadar/RingRadarPrimitive ./FeDataSources/RingRadar/RingRadarVisualizer ./FeDataSources/SquareconeScanner/SquareconeFramework ./FeDataSources/SquareconeScanner/SquareconeGraphics ./FeDataSources/SquareconeScanner/SquareconePrimitive ./FeDataSources/SquareconeScanner/SquareconeVisualizer ./FeShadersEx/Materials/ConicalRadarFS ./FeShadersEx/Materials/ConicalRadarVS ./FeShadersEx/Materials/ElliposidFadeMaterial ./FeShadersEx/Materials/ParabolaRadarFS ./FeShadersEx/Materials/ParabolaRadarVS ./FeShadersEx/Materials/polylineLinkMaterial ./FeShadersEx/Materials/RectangularSensor ./FeShadersEx/Materials/RectangularSensorFS ./FeShadersEx/Materials/RectangularSensorScanPlaneFS ./FeShadersEx/Materials/RectangularSensorVS ./FeShadersEx/Materials/RibbonPrimitiveFS ./FeShadersEx/Materials/RibbonPrimitiveVS ./FeShadersEx/Materials/RingconeScannerFS ./FeShadersEx/Materials/RingconeScannerVS ./FeShadersEx/Materials/RingRadarFS ./FeShadersEx/Materials/RingRadarVS ./FeShadersEx/Materials/SquareconeScannerFS ./FeShadersEx/Materials/SquareconeScannerVS ./Shaders/Appearances/AllMaterialAppearanceFS ./Shaders/Appearances/AllMaterialAppearanceVS ./Shaders/Appearances/BasicMaterialAppearanceFS ./Shaders/Appearances/BasicMaterialAppearanceVS ./Shaders/Appearances/EllipsoidSurfaceAppearanceFS ./Shaders/Appearances/EllipsoidSurfaceAppearanceVS ./Shaders/Appearances/PerInstanceColorAppearanceFS ./Shaders/Appearances/PerInstanceColorAppearanceVS ./Shaders/Appearances/PerInstanceFlatColorAppearanceFS ./Shaders/Appearances/PerInstanceFlatColorAppearanceVS ./Shaders/Appearances/PolylineColorAppearanceVS ./Shaders/Appearances/PolylineMaterialAppearanceVS ./Shaders/Appearances/TexturedMaterialAppearanceFS ./Shaders/Appearances/TexturedMaterialAppearanceVS ./Shaders/Builtin/CzmBuiltins ./Shaders/Materials/AspectRampMaterial ./Shaders/Materials/BumpMapMaterial ./Shaders/Materials/CheckerboardMaterial ./Shaders/Materials/DotMaterial ./Shaders/Materials/ElevationContourMaterial ./Shaders/Materials/ElevationRampMaterial ./Shaders/Materials/FadeMaterial ./Shaders/Materials/GridMaterial ./Shaders/Materials/NormalMapMaterial ./Shaders/Materials/PolylineArrowMaterial ./Shaders/Materials/PolylineDashMaterial ./Shaders/Materials/PolylineGlowMaterial ./Shaders/Materials/PolylineOutlineMaterial ./Shaders/Materials/RimLightingMaterial ./Shaders/Materials/SlopeRampMaterial ./Shaders/Materials/StripeMaterial ./Shaders/Materials/Water ./Shaders/PostProcessStages/AcesTonemapping ./Shaders/PostProcessStages/AdditiveBlend ./Shaders/PostProcessStages/AmbientOcclusionGenerate ./Shaders/PostProcessStages/AmbientOcclusionModulate ./Shaders/PostProcessStages/BlackAndWhite ./Shaders/PostProcessStages/BloomComposite ./Shaders/PostProcessStages/Brightness ./Shaders/PostProcessStages/BrightPass ./Shaders/PostProcessStages/ContrastBias ./Shaders/PostProcessStages/DepthOfField ./Shaders/PostProcessStages/DepthView ./Shaders/PostProcessStages/DepthViewPacked ./Shaders/PostProcessStages/EdgeDetection ./Shaders/PostProcessStages/FilmicTonemapping ./Shaders/PostProcessStages/FXAA ./Shaders/PostProcessStages/GaussianBlur1D ./Shaders/PostProcessStages/LensFlare ./Shaders/PostProcessStages/ModifiedReinhardTonemapping ./Shaders/PostProcessStages/NightVision ./Shaders/PostProcessStages/PassThrough ./Shaders/PostProcessStages/PassThroughDepth ./Shaders/PostProcessStages/PointCloudEyeDomeLighting ./Shaders/PostProcessStages/ReinhardTonemapping ./Shaders/PostProcessStages/Silhouette ./ThirdParty/GltfPipeline/addBuffer ./ThirdParty/GltfPipeline/addDefaults ./ThirdParty/GltfPipeline/addExtensionsRequired ./ThirdParty/GltfPipeline/addExtensionsUsed ./ThirdParty/GltfPipeline/addPipelineExtras ./ThirdParty/GltfPipeline/addToArray ./ThirdParty/GltfPipeline/findAccessorMinMax ./ThirdParty/GltfPipeline/ForEach ./ThirdParty/GltfPipeline/getAccessorByteStride ./ThirdParty/GltfPipeline/getComponentReader ./ThirdParty/GltfPipeline/hasExtension ./ThirdParty/GltfPipeline/moveTechniqueRenderStates ./ThirdParty/GltfPipeline/moveTechniquesToExtension ./ThirdParty/GltfPipeline/numberOfComponentsForType ./ThirdParty/GltfPipeline/parseGlb ./ThirdParty/GltfPipeline/readAccessorPacked ./ThirdParty/GltfPipeline/removeExtensionsRequired ./ThirdParty/GltfPipeline/removeExtensionsUsed ./ThirdParty/GltfPipeline/removePipelineExtras ./ThirdParty/GltfPipeline/removeUnusedElements ./ThirdParty/GltfPipeline/updateAccessorComponentTypes ./ThirdParty/GltfPipeline/updateVersion ./ThirdParty/Shaders/FXAA3_11 ./Widgets/Animation/Animation ./Widgets/Animation/AnimationViewModel ./Widgets/BaseLayerPicker/BaseLayerPicker ./Widgets/BaseLayerPicker/BaseLayerPickerViewModel ./Widgets/BaseLayerPicker/createDefaultImageryProviderViewModels ./Widgets/BaseLayerPicker/createDefaultTerrainProviderViewModels ./Widgets/BaseLayerPicker/ProviderViewModel ./Widgets/Cesium3DTilesInspector/Cesium3DTilesInspector ./Widgets/Cesium3DTilesInspector/Cesium3DTilesInspectorViewModel ./Widgets/CesiumInspector/CesiumInspector ./Widgets/CesiumInspector/CesiumInspectorViewModel ./Widgets/CesiumWidget/CesiumWidget ./Widgets/FullscreenButton/FullscreenButton ./Widgets/FullscreenButton/FullscreenButtonViewModel ./Widgets/Geocoder/Geocoder ./Widgets/Geocoder/GeocoderViewModel ./Widgets/HomeButton/HomeButton ./Widgets/HomeButton/HomeButtonViewModel ./Widgets/InfoBox/InfoBox ./Widgets/InfoBox/InfoBoxViewModel ./Widgets/NavigationHelpButton/NavigationHelpButton ./Widgets/NavigationHelpButton/NavigationHelpButtonViewModel ./Widgets/PerformanceWatchdog/PerformanceWatchdog ./Widgets/PerformanceWatchdog/PerformanceWatchdogViewModel ./Widgets/ProjectionPicker/ProjectionPicker ./Widgets/ProjectionPicker/ProjectionPickerViewModel ./Widgets/SceneModePicker/SceneModePicker ./Widgets/SceneModePicker/SceneModePickerViewModel ./Widgets/SelectionIndicator/SelectionIndicator ./Widgets/SelectionIndicator/SelectionIndicatorViewModel ./Widgets/Timeline/Timeline ./Widgets/Timeline/TimelineHighlightRange ./Widgets/Timeline/TimelineTrack ./Widgets/Viewer/Viewer ./Widgets/Viewer/viewerCesium3DTilesInspectorMixin ./Widgets/Viewer/viewerCesiumInspectorMixin ./Widgets/Viewer/viewerDragDropMixin ./Widgets/Viewer/viewerPerformanceWatchdogMixin ./Widgets/VRButton/VRButton ./Widgets/VRButton/VRButtonViewModel ./Shaders/Builtin/Constants/degreesPerRadian ./Shaders/Builtin/Constants/depthRange ./Shaders/Builtin/Constants/ellipsoidInverseRadii ./Shaders/Builtin/Constants/ellipsoidRadii ./Shaders/Builtin/Constants/epsilon1 ./Shaders/Builtin/Constants/epsilon2 ./Shaders/Builtin/Constants/epsilon3 ./Shaders/Builtin/Constants/epsilon4 ./Shaders/Builtin/Constants/epsilon5 ./Shaders/Builtin/Constants/epsilon6 ./Shaders/Builtin/Constants/epsilon7 ./Shaders/Builtin/Constants/infinity ./Shaders/Builtin/Constants/oneOverPi ./Shaders/Builtin/Constants/oneOverTwoPi ./Shaders/Builtin/Constants/passCesium3DTile ./Shaders/Builtin/Constants/passCesium3DTileClassification ./Shaders/Builtin/Constants/passCesium3DTileClassificationIgnoreShow ./Shaders/Builtin/Constants/passClassification ./Shaders/Builtin/Constants/passCompute ./Shaders/Builtin/Constants/passEnvironment ./Shaders/Builtin/Constants/passGlobe ./Shaders/Builtin/Constants/passOpaque ./Shaders/Builtin/Constants/passOverlay ./Shaders/Builtin/Constants/passTerrainClassification ./Shaders/Builtin/Constants/passTranslucent ./Shaders/Builtin/Constants/pi ./Shaders/Builtin/Constants/piOverFour ./Shaders/Builtin/Constants/piOverSix ./Shaders/Builtin/Constants/piOverThree ./Shaders/Builtin/Constants/piOverTwo ./Shaders/Builtin/Constants/radiansPerDegree ./Shaders/Builtin/Constants/sceneMode2D ./Shaders/Builtin/Constants/sceneMode3D ./Shaders/Builtin/Constants/sceneModeColumbusView ./Shaders/Builtin/Constants/sceneModeMorphing ./Shaders/Builtin/Constants/solarRadius ./Shaders/Builtin/Constants/threePiOver2 ./Shaders/Builtin/Constants/twoPi ./Shaders/Builtin/Constants/webMercatorMaxLatitude ./Shaders/Builtin/Functions/alphaWeight ./Shaders/Builtin/Functions/antialias ./Shaders/Builtin/Functions/approximateSphericalCoordinates ./Shaders/Builtin/Functions/branchFreeTernary ./Shaders/Builtin/Functions/cascadeColor ./Shaders/Builtin/Functions/cascadeDistance ./Shaders/Builtin/Functions/cascadeMatrix ./Shaders/Builtin/Functions/cascadeWeights ./Shaders/Builtin/Functions/columbusViewMorph ./Shaders/Builtin/Functions/computePosition ./Shaders/Builtin/Functions/cosineAndSine ./Shaders/Builtin/Functions/decompressTextureCoordinates ./Shaders/Builtin/Functions/depthClampFarPlane ./Shaders/Builtin/Functions/eastNorthUpToEyeCoordinates ./Shaders/Builtin/Functions/ellipsoidContainsPoint ./Shaders/Builtin/Functions/ellipsoidWgs84TextureCoordinates ./Shaders/Builtin/Functions/equalsEpsilon ./Shaders/Builtin/Functions/eyeOffset ./Shaders/Builtin/Functions/eyeToWindowCoordinates ./Shaders/Builtin/Functions/fastApproximateAtan ./Shaders/Builtin/Functions/fog ./Shaders/Builtin/Functions/gammaCorrect ./Shaders/Builtin/Functions/geodeticSurfaceNormal ./Shaders/Builtin/Functions/getDefaultMaterial ./Shaders/Builtin/Functions/getLambertDiffuse ./Shaders/Builtin/Functions/getSpecular ./Shaders/Builtin/Functions/getWaterNoise ./Shaders/Builtin/Functions/getWgs84EllipsoidEC ./Shaders/Builtin/Functions/HSBToRGB ./Shaders/Builtin/Functions/HSLToRGB ./Shaders/Builtin/Functions/hue ./Shaders/Builtin/Functions/inverseGamma ./Shaders/Builtin/Functions/isEmpty ./Shaders/Builtin/Functions/isFull ./Shaders/Builtin/Functions/latitudeToWebMercatorFraction ./Shaders/Builtin/Functions/lineDistance ./Shaders/Builtin/Functions/luminance ./Shaders/Builtin/Functions/metersPerPixel ./Shaders/Builtin/Functions/modelToWindowCoordinates ./Shaders/Builtin/Functions/multiplyWithColorBalance ./Shaders/Builtin/Functions/nearFarScalar ./Shaders/Builtin/Functions/octDecode ./Shaders/Builtin/Functions/packDepth ./Shaders/Builtin/Functions/phong ./Shaders/Builtin/Functions/planeDistance ./Shaders/Builtin/Functions/pointAlongRay ./Shaders/Builtin/Functions/rayEllipsoidIntersectionInterval ./Shaders/Builtin/Functions/readDepth ./Shaders/Builtin/Functions/reverseLogDepth ./Shaders/Builtin/Functions/RGBToHSB ./Shaders/Builtin/Functions/RGBToHSL ./Shaders/Builtin/Functions/RGBToXYZ ./Shaders/Builtin/Functions/sampleOctahedralProjection ./Shaders/Builtin/Functions/saturation ./Shaders/Builtin/Functions/shadowDepthCompare ./Shaders/Builtin/Functions/shadowVisibility ./Shaders/Builtin/Functions/signNotZero ./Shaders/Builtin/Functions/sphericalHarmonics ./Shaders/Builtin/Functions/tangentToEyeSpaceMatrix ./Shaders/Builtin/Functions/transformPlane ./Shaders/Builtin/Functions/translateRelativeToEye ./Shaders/Builtin/Functions/translucentPhong ./Shaders/Builtin/Functions/transpose ./Shaders/Builtin/Functions/unpackDepth ./Shaders/Builtin/Functions/unpackFloat ./Shaders/Builtin/Functions/vertexLogDepth ./Shaders/Builtin/Functions/windColor ./Shaders/Builtin/Functions/windowToEyeCoordinates ./Shaders/Builtin/Functions/writeDepthClampedToFarPlane ./Shaders/Builtin/Functions/writeLogDepth ./Shaders/Builtin/Functions/xyzToLonLatHeight ./Shaders/Builtin/Functions/XYZToRGB ./Shaders/Builtin/Structs/depthRangeStruct ./Shaders/Builtin/Structs/ellipsoid ./Shaders/Builtin/Structs/material ./Shaders/Builtin/Structs/materialInput ./Shaders/Builtin/Structs/ray ./Shaders/Builtin/Structs/raySegment ./Shaders/Builtin/Structs/shadowParameters ./Workers/createTaskProcessorWorker".split(" "),function(b,a,f,k,g,l,m,e,h,p,d,q,t,r,c,u,y,A,z,F,D,v,B,C,I,H,J,w,G,E,L,K,P,N,O,Z,aa,U,W,M,R,Y,Q,S,ca,T,da,V,ba,X,fa,ga,ka,na,ia,la,ha,pa,oa,qa,ua,ta,wa,za,Da,Ba,ra,Ea,Ga,Ca,ya,Aa,Pa,sa,Va,xa,Ha,Ma,Ia,La,Fa,Ja,Qa,va,Sa,Oa,Ta,Ka,Wa,Ra,pb,hb,Hb,db,tb,Jc,cc,sc,Za,tc,wc,Xb,dc,ja,uc,ec,ad,Dc,fc,xd,Vc,xc,Kc,Lc,Oc,ed,Rc,Pc,bd,Mc,Yb,Sc,ab,Ab,qb,yc,vb,vc,ma,Ib,ib,zc,Bc,Ec,nc,gc,hc,Fc,mb,gb,Zb,Gc,Na,Ob,lb,nb,Cb,wb,xb,rb,yb,oc,sb,Sb,Pb,$b,Tc,Db,Eb,eb,ea,Qb,bb,cb,Ya,Fb,Ac,Xa,pc,ic,ob,Kb,Rb,ub,jc,jb,Jb,Gb,kb,Lb,kc,Vb,Tb,fb,zb,Mb,$a,lc,qc,mc,bc,kd,Hc,Ge,Bb,ld,Wc,Cc,fd,qd,gd,Qc,Xc,cd,Yc,Bd,md,af,$d,Nd,Cd,Fd,hd,oe,yd,pe,ac,Uc,id,Zc,Dd,zd,rd,sd,nd,dd,He,Od,bf,ae,od,qe,be,ce,Gd,Mf,Nf,Of,Pf,Qf,Rf,Sf,Tf,Uf,Vf,Wf,Xf,Yf,Zf,$f,ag,bg,cg,dg,eg,fg,gg,hg,ig,jg,kg,lg,mg,Hd,Id,Jd,Kd,Pd,Qd,cf,df,ef,ff,re,gf,hf,Ie,td,ud,vd,wd,se,te,ue,ve,Je,ng,Rd,Sd,og,pg,de,ee,Ke,fe,ge,Le,Me,Ne,Td,Oe,he,we,xe,qg,rg,sg,jf,tg,kf,lf,ug,mf,nf,vg,of,pf,wg,qf,ye,Ud,Ld,Vd,rf,sf,tf,Wd,ie,Xd,Pe,uf,Qe,Re,vf,Se,je,ze,ke,xg,Te,wf,xf,le,me,Ic,rc,jd,yg,Ue,zg,yf,Ae,Ub,gh,Ag,hh,Bg,Cg,Ve,zf,ih,jh,Wb,Be,Md,Yd,Dg,Eg,Fg,Gg,Hg,Ig,Jg,Kg,Lg,Mg,Ng,Af,Bf,We,Ce,Xe,ne,Og,Pg,Cf,Ye,Qg,Rg,De,Sg,Tg,Ug,Vg,Ee,Wg,Xg,Yg,Zg,$g,ah,bh,ch,Df,dh,Fe,Ef,Ff,Gf,Hf,If,Jf,Kf,Zd,$c,Ed,Ze,eh,fh,Ad,pd,Nc,kh,lh,mh,nh,oh,$e,ph,qh,Lf,rh,sh,th,uh,vh,wh,xh,yh,zh,Ah,Bh,Ch,Dh,Eh,Fh,Gh,Hh,Ih,Jh,Kh,Lh,Mh,Nh,Oh,Ph,Qh,Rh,Sh,Th,Uh,Vh,Wh,Xh,Yh,Zh,$h,ai,bi,ci,di,ei,fi,gi,hi,ii,ji,ki,li,mi,ni,oi,pi,qi,ri,si,ti,ui,vi,wi,xi,yi,zi,Ai,Bi,Ci,Di,Ei,Fi,Gi,Hi,Ii,Ji,Ki,Li,Mi,Ni,Oi,Pi,Qi,Ri,Si,Ti,Ui,Vi,Wi,Xi,Yi,Zi,$i,aj,bj,cj,dj,ej,fj,gj,hj,ij,jj,kj,lj,mj,nj,oj,pj,qj,rj,sj,tj,uj,vj,wj,xj,yj,zj,Aj,Bj,Cj,Dj,Ej,Fj,Gj,Hj,Ij,Jj,Kj,Lj,Mj,Nj,Oj,Pj,Qj,Rj,Sj,Tj,Uj,Vj,Wj,Xj,Yj,Zj,ak,bk,ck,dk,ek,fk,gk,hk,ik,jk,kk,lk,mk,nk,ok,pk,qk,rk,sk,tk,uk,vk,wk,xk,yk,zk,Ak,Bk,Ck,Dk,Ek,Fk,Gk,Hk,Ik,Jk,Kk,Lk,Mk,Nk,Ok,Pk,Qk,Rk,Sk,Tk,Uk,Vk,Wk,Xk,Yk,Zk,$k,al,bl,cl,dl,el,fl,gl,hl,il,jl,kl,ll,ml,nl,ol,pl,ql,rl,sl,tl,ul,vl,wl,xl,yl,zl,Al,Bl,Cl,Dl,El,Fl,Gl,Hl,Il,Jl,Kl,Ll,Ml,Nl,Ol,Pl,Ql,Rl,Sl,Tl,Ul,Vl,Wl,Xl,Yl,Zl,$l,am,bm,cm,dm,em,fm,gm,hm,im,jm,km,lm,mm,nm,om,pm,qm,rm,sm,tm,um,vm,wm,xm,ym,zm,Am,Bm,Cm,Dm,Em,Fm,Gm,Hm,Im,Jm,Km,Lm,Mm,Nm,Om,Pm,Qm,Rm,Sm,Tm,Um,Vm,Wm,Xm,Ym,Zm,$m,an,bn,cn,dn,en,fn,gn,hn,jn,kn,ln,mn,nn,on,pn,qn,rn,sn,tn,un,vn,wn,xn,yn,zn,An,Bn,Cn,Dn,En,Fn,Gn,Hn,In,Jn,Kn,Ln,Mn,Nn,On,Pn,Qn,Rn,Sn,Tn,Un,Vn,Wn,Xn,Yn,Zn,$n,ao,bo,co,eo,fo,go,ho,io,jo,ko,lo,mo,no,oo,po,qo,ro,so,to,uo,vo,wo,xo,yo,zo,Ao,Bo,Co,Do,Eo,Fo,Go,Ho,Io,Jo,Ko,Lo,Mo,No,Oo,Po,Qo,Ro,So,To,Uo,Vo,Wo,Xo,Yo,Zo,$o,ap,bp,cp,dp,ep,fp,gp,hp,ip,jp,kp,lp,mp,np,op,pp,qp,rp,sp,tp,up,vp,wp,xp,yp,zp,Ap,Bp,Cp,Dp,Ep,Fp,Gp,Hp,Ip,Jp,Kp,Lp,Mp,Np,Op,Pp,Qp,Rp,Sp,Tp,Up,Vp,Wp,Xp,Yp,Zp,$p,aq,bq,cq,dq,eq,fq,gq,hq,iq,jq,kq,lq,mq,nq,oq,pq,qq,rq,sq,tq,uq,vq,wq,xq,yq,zq,Aq,Bq,Cq,Dq,Eq,Fq,Gq,Hq,Iq,Jq,Kq,Lq,Mq,Nq,Oq,Pq,Qq,Rq,Sq,Tq,Uq,Vq,Wq,Xq,Yq,Zq,$q,ar,br,cr,dr,er,fr,gr,hr,ir,jr,kr,lr,mr,nr,or,pr,qr,rr,sr,tr,ur,vr,wr,xr,yr,zr,Ar,Br,Cr,Dr,Er,Fr,Gr,Hr,Ir,Jr,Kr,Lr,Mr,Nr,Or,Pr,Qr,Rr,Sr,Tr,Ur,Vr,Wr,Xr,Yr,Zr,$r,as,bs,cs,ds,es,fs,gs,hs,is,js,ks,ls,ms,ns,os,ps,qs,rs,ss,ts,us,vs,ws){var x={VERSION:"1.59",_shaders:{}};x.appendForwardSlash=b;x.ApproximateTerrainHeights=a;x.ArcGISTiledElevationTerrainProvider=f;x.ArcType=k;x.arrayFill=g;x.arrayRemoveDuplicates=l;x.arraySlice=m;x.AssociativeArray=e;x.AttributeCompression=h;x.AxisAlignedBoundingBox=p;x.barycentricCoordinates=d;x.binarySearch=q;x.BingMapsApi=t;x.BingMapsGeocoderService=r;x.BoundingRectangle=c;x.BoundingSphere=u;x.BoxGeometry=y;x.BoxOutlineGeometry=A;x.buildModuleUrl=z;x.cancelAnimationFrame=F;x.Cartesian2=D;x.Cartesian3=v;x.Cartesian4=B;x.Cartographic=C;x.CartographicGeocoderService=I;x.CatmullRomSpline=H;x.CesiumTerrainProvider=J;x.Check=w;x.CircleGeometry=G;x.CircleOutlineGeometry=E;x.Clock=L;x.ClockRange=K;x.ClockStep=P;x.clone=N;x.Color=O;x.ColorGeometryInstanceAttribute=Z;x.combine=aa;x.ComponentDatatype=U;x.CompressedTextureBuffer=W;x.CoplanarPolygonGeometry=M;x.CoplanarPolygonGeometryLibrary=R;x.CoplanarPolygonOutlineGeometry=Y;x.CornerType=Q;x.CorridorGeometry=S;x.CorridorGeometryLibrary=ca;x.CorridorOutlineGeometry=T;x.createGuid=da;x.createWorldTerrain=V;x.Credit=ba;x.CubicRealPolynomial=X;x.CullingVolume=fa;x.CylinderGeometry=ga;x.CylinderGeometryLibrary=ka;x.CylinderOutlineGeometry=na;x.decodeGoogleEarthEnterpriseData=ia;x.DefaultProxy=la;x.defaultValue=ha;x.defined=pa;x.defineProperties=oa;x.deprecationWarning=qa;x.destroyObject=ua;x.DeveloperError=ta;x.DistanceDisplayCondition=wa;x.DistanceDisplayConditionGeometryInstanceAttribute=za;x.DoublyLinkedList=Da;x.EarthOrientationParameters=Ba;x.EarthOrientationParametersSample=ra;x.EasingFunction=Ea;x.EllipseGeometry=Ga;x.EllipseGeometryLibrary=Ca;x.EllipseOutlineGeometry=ya;x.Ellipsoid=Aa;x.EllipsoidalOccluder=Pa;x.EllipsoidGeodesic=sa;x.EllipsoidGeometry=Va;x.EllipsoidOutlineGeometry=xa;x.EllipsoidRhumbLine=Ha;x.EllipsoidTangentPlane=Ma;x.EllipsoidTerrainProvider=Ia;x.EncodedCartesian3=La;x.Event=Fa;x.EventHelper=Ja;x.ExtrapolationType=Qa;x.FeatureDetection=va;x.formatError=Sa;x.freezeObject=Oa;x.FrustumGeometry=Ta;x.FrustumOutlineGeometry=Ka;x.Fullscreen=Wa;x.GeocoderService=Ra;x.GeocodeType=pb;x.GeographicProjection=hb;x.GeographicTilingScheme=Hb;x.Geometry=db;x.GeometryAttribute=tb;x.GeometryAttributes=Jc;x.GeometryInstance=cc;x.GeometryInstanceAttribute=sc;x.GeometryOffsetAttribute=Za;x.GeometryPipeline=tc;x.GeometryType=wc;x.getAbsoluteUri=Xb;x.getBaseUri=dc;x.getExtensionFromUri=ja;x.getFilenameFromUri=uc;x.getImagePixels=ec;x.getMagic=ad;x.getStringFromTypedArray=Dc;x.getTimestamp=fc;x.GoogleEarthEnterpriseMetadata=xd;x.GoogleEarthEnterpriseTerrainData=Vc;x.GoogleEarthEnterpriseTerrainProvider=xc;x.GoogleEarthEnterpriseTileInformation=Kc;x.GregorianDate=Lc;x.GroundPolylineGeometry=Oc;x.HeadingPitchRange=ed;x.HeadingPitchRoll=Rc;x.Heap=Pc;x.HeightmapEncoding=bd;x.HeightmapTerrainData=Mc;x.HeightmapTessellator=Yb;x.HermitePolynomialApproximation=Sc;x.HermiteSpline=ab;x.Iau2000Orientation=Ab;x.Iau2006XysData=qb;x.Iau2006XysSample=yc;x.IauOrientationAxes=vb;x.IauOrientationParameters=vc;x.IndexDatatype=ma;x.InterpolationAlgorithm=Ib;x.Intersect=ib;x.Intersections2D=zc;x.IntersectionTests=Bc;x.Interval=Ec;x.Ion=nc;x.IonGeocoderService=gc;x.IonResource=hc;x.isArray=Fc;x.isBitSet=mb;x.isBlobUri=gb;x.isCrossOriginUrl=Zb;x.isDataUri=Gc;x.isLeapYear=Na;x.Iso8601=Ob;x.JulianDate=lb;x.KeyboardEventModifier=nb;x.LagrangePolynomialApproximation=Cb;x.LeapSecond=wb;x.LinearApproximation=xb;x.LinearSpline=rb;x.loadAndExecuteScript=yb;x.loadCRN=oc;x.loadImageFromTypedArray=sb;x.loadKTX=Sb;x.ManagedArray=Pb;x.MapboxApi=$b;x.MapProjection=Tc;x.Math=Db;x.Matrix2=Eb;x.Matrix3=eb;x.Matrix4=ea;x.mergeSort=Qb;x.NearFarScalar=bb;x.objectToQuery=cb;x.Occluder=Ya;x.OffsetGeometryInstanceAttribute=Fb;x.oneTimeWarning=Ac;x.OpenCageGeocoderService=Xa;x.OrientedBoundingBox=pc;x.OrthographicFrustum=ic;x.OrthographicOffCenterFrustum=ob;x.Packable=Kb;x.PackableForInterpolation=Rb;x.parseResponseHeaders=ub;x.PeliasGeocoderService=jc;x.PerspectiveFrustum=jb;x.PerspectiveOffCenterFrustum=Jb;x.PinBuilder=Gb;x.PixelFormat=kb;x.Plane=Lb;x.PlaneGeometry=kc;x.PlaneOutlineGeometry=Vb;x.pointInsideTriangle=Tb;x.PolygonGeometry=fb;x.PolygonGeometryLibrary=zb;x.PolygonHierarchy=Mb;x.PolygonOutlineGeometry=$a;x.PolygonPipeline=lc;x.PolylineGeometry=qc;x.PolylinePipeline=mc;x.PolylineVolumeGeometry=bc;x.PolylineVolumeGeometryLibrary=kd;x.PolylineVolumeOutlineGeometry=Hc;x.PrimitiveType=Ge;x.QuadraticRealPolynomial=Bb;x.QuantizedMeshTerrainData=ld;x.QuarticRealPolynomial=Wc;x.Quaternion=Cc;x.QuaternionSpline=fd;x.queryToObject=qd;x.Queue=gd;x.Ray=Qc;x.Rectangle=Xc;x.RectangleCollisionChecker=cd;x.RectangleGeometry=Yc;x.RectangleGeometryLibrary=Bd;x.RectangleOutlineGeometry=md;x.ReferenceFrame=af;x.Request=$d;x.requestAnimationFrame=Nd;x.RequestErrorEvent=Cd;x.RequestScheduler=Fd;x.RequestState=hd;x.RequestType=oe;x.Resource=yd;x.RuntimeError=pe;x.sampleTerrain=ac;x.sampleTerrainMostDetailed=Uc;x.scaleToGeodeticSurface=id;x.ScreenSpaceEventHandler=Zc;x.ScreenSpaceEventType=Dd;x.ShowGeometryInstanceAttribute=zd;x.Simon1994PlanetaryPositions=rd;x.SimplePolylineGeometry=sd;x.SphereGeometry=nd;x.SphereOutlineGeometry=dd;x.Spherical=He;x.Spline=Od;x.subdivideArray=bf;x.TaskProcessor=ae;x.TerrainData=od;x.TerrainEncoding=qe;x.TerrainMesh=be;x.TerrainProvider=ce;x.TerrainQuantization=Gd;x.TileAvailability=Mf;x.TileEdge=Nf;x.TileProviderError=Of;x.TilingScheme=Pf;x.TimeConstants=Qf;x.TimeInterval=Rf;x.TimeIntervalCollection=Sf;x.TimeStandard=Tf;x.Tipsify=Uf;x.Transforms=Vf;x.TranslationRotationScale=Wf;x.TridiagonalSystemSolver=Xf;x.TrustedServers=Yf;x.VertexFormat=Zf;x.VideoSynchronizer=$f;x.Visibility=ag;x.VRTheWorldTerrainProvider=bg;x.WallGeometry=cg;x.WallGeometryLibrary=dg;x.WallOutlineGeometry=eg;x.WebGLConstants=fg;x.webGLConstantToGlslType=gg;x.WebMercatorProjection=hg;x.WebMercatorTilingScheme=ig;x.WeightSpline=jg;x.WindingOrder=kg;x.wrapFunction=lg;x.writeTextToCanvas=mg;x.BillboardGraphics=Hd;x.BillboardVisualizer=Id;x.BoundingSphereState=Jd;x.BoxGeometryUpdater=Kd;x.BoxGraphics=Pd;x.CallbackProperty=Qd;x.CheckerboardMaterialProperty=cf;x.ColorMaterialProperty=df;x.CompositeEntityCollection=ef;x.CompositeMaterialProperty=ff;x.CompositePositionProperty=re;x.CompositeProperty=gf;x.ConstantPositionProperty=hf;x.ConstantProperty=Ie;x.CorridorGeometryUpdater=td;x.CorridorGraphics=ud;x.createMaterialPropertyDescriptor=vd;x.createPropertyDescriptor=wd;x.createRawPropertyDescriptor=se;x.CustomDataSource=te;x.CylinderGeometryUpdater=ue;x.CylinderGraphics=ve;x.CzmlDataSource=Je;x.DataSource=ng;x.DataSourceClock=Rd;x.DataSourceCollection=Sd;x.DataSourceDisplay=og;x.DynamicGeometryBatch=pg;x.DynamicGeometryUpdater=de;x.EllipseGeometryUpdater=ee;x.EllipseGraphics=Ke;x.EllipsoidGeometryUpdater=fe;x.EllipsoidGraphics=ge;x.Entity=Le;x.EntityCluster=Me;x.EntityCollection=Ne;x.EntityView=Td;x.exportKml=Oe;x.GeoJsonDataSource=he;x.GeometryUpdater=we;x.GeometryVisualizer=xe;x.GridMaterialProperty=qg;x.GroundGeometryUpdater=rg;x.heightReferenceOnEntityPropertyChanged=sg;x.ImageMaterialProperty=jf;x.KmlCamera=tg;x.KmlDataSource=kf;x.KmlLookAt=lf;x.KmlTour=ug;x.KmlTourFlyTo=mf;x.KmlTourWait=nf;x.LabelGraphics=vg;x.LabelVisualizer=of;x.MaterialProperty=pf;x.ModelGraphics=wg;x.ModelVisualizer=qf;x.NodeTransformationProperty=ye;x.PathGraphics=Ud;x.PathVisualizer=Ld;x.PlaneGeometryUpdater=Vd;x.PlaneGraphics=rf;x.PointGraphics=sf;x.PointVisualizer=tf;x.PolygonGeometryUpdater=Wd;x.PolygonGraphics=ie;x.PolylineArrowMaterialProperty=Xd;x.PolylineDashMaterialProperty=Pe;x.PolylineGeometryUpdater=uf;x.PolylineGlowMaterialProperty=Qe;x.PolylineGraphics=Re;x.PolylineOutlineMaterialProperty=vf;x.PolylineVisualizer=Se;x.PolylineVolumeGeometryUpdater=je;x.PolylineVolumeGraphics=ze;x.PositionProperty=ke;x.PositionPropertyArray=xg;x.Property=Te;x.PropertyArray=wf;x.PropertyBag=xf;x.RectangleGeometryUpdater=le;x.RectangleGraphics=me;x.ReferenceProperty=Ic;x.Rotation=rc;x.SampledPositionProperty=jd;x.SampledProperty=yg;x.ScaledPositionProperty=Ue;x.StaticGeometryColorBatch=zg;x.StaticGeometryPerMaterialBatch=yf;x.StaticGroundGeometryColorBatch=Ae;x.StaticGroundGeometryPerMaterialBatch=Ub;x.StaticGroundPolylinePerMaterialBatch=gh;x.StaticOutlineGeometryBatch=Ag;x.StripeMaterialProperty=hh;x.StripeOrientation=Bg;x.TerrainOffsetProperty=Cg;x.TimeIntervalCollectionPositionProperty=Ve;x.TimeIntervalCollectionProperty=zf;x.VelocityOrientationProperty=ih;x.VelocityVectorProperty=jh;x.Visualizer=Wb;x.WallGeometryUpdater=Be;x.WallGraphics=Md;x.ElliposidFadeMaterialProperty=Yd;x.PolylineArrowLinkMaterialProperty=Dg;x.FeAutoTransForm=Eg;x.FeClound=Fg;x.FeConstellation=Gg;x.FeDrawCommand=Hg;x.FeFlatClound=Ig;x.FeFlyLine=Jg;x.FeGeometry=Kg;x.FeGeometryCreator=Lg;x.FeLodPlaceMark=Mg;x.FeLodVecLine=Ng;x.FeOctreeTriangleSelector=Af;x.FePlaceMarkGroup=Bf;x.FePlaceMarkGroupManager=We;x.FePrecipitation=Ce;x.FeRadarAppearance=Xe;x.FeRadarEffect=ne;x.FeSatelliteManager=Og;x.FeScanRadarPrimitive=Pg;x.FeSkyStar=Cf;x.FeVecLineGroup=Ye;x.FeVecLineGroupManager=Qg;x.FeWindPrimitive=Rg;x.BillboardCollectionDisableFxaaFS=De;x.FeCloundFS=Sg;x.FeConstellationFS=Tg;x.FeConstellationVS=Ug;x.FeFlatCloundFS=Vg;x.FeFlatCloundVS=Ee;x.FeFlyLineFS=Wg;x.FeFlyLineVS=Xg;x.FePrecipitationFS=Yg;x.FePrecipitationVS=Zg;x.FeRadarAppearanceFS=$g;x.FeRadarAppearanceVS=ah;x.FeScanRadarFS=bh;x.FeScanRadarVS=ch;x.FeStarConstellationFS=Df;x.FeStarConstellationVS=dh;x.FeWindFS=Fe;x.FeWindVS=Ef;x.AutomaticUniforms=Ff;x.Buffer=Gf;x.BufferUsage=Hf;x.ClearCommand=If;x.ComputeCommand=Jf;x.ComputeEngine=Kf;x.Context=Zd;x.ContextLimits=$c;x.createUniform=Ed;x.createUniformArray=Ze;x.CubeMap=eh;x.CubeMapFace=fh;x.DrawCommand=Ad;x.Framebuffer=pd;x.freezeRenderState=Nc;x.loadCubeMap=kh;x.MipmapHint=lh;x.modernizeShader=mh;x.Pass=nh;x.PassState=oh;x.PixelDatatype=$e;x.Renderbuffer=ph;x.RenderbufferFormat=qh;x.RenderState=Lf;x.Sampler=rh;x.ShaderCache=sh;x.ShaderProgram=th;x.ShaderSource=uh;x.Texture=vh;x.TextureCache=wh;x.TextureMagnificationFilter=xh;x.TextureMinificationFilter=yh;x.TextureWrap=zh;x.UniformState=Ah;x.VertexArray=Bh;x.VertexArrayFacade=Ch;x.Appearance=Dh;x.ArcGisMapServerImageryProvider=Eh;x.AttributeType=Fh;x.AutoExposure=Gh;x.Axis=Hh;x.Batched3DModel3DTileContent=Ih;x.BatchTable=Jh;x.Billboard=Kh;x.BillboardCollection=Lh;x.BingMapsImageryProvider=Mh;x.BingMapsStyle=Nh;x.BlendEquation=Oh;x.BlendFunction=Ph;x.BlendingState=Qh;x.BlendOption=Rh;x.BoxEmitter=Sh;x.BrdfLutGenerator=Th;x.Camera=Uh;x.CameraEventAggregator=Vh;x.CameraEventType=Wh;x.CameraFlightPath=Xh;x.Cesium3DTile=Yh;x.Cesium3DTileBatchTable=Zh;x.Cesium3DTileColorBlendMode=$h;x.Cesium3DTileContent=ai;x.Cesium3DTileContentFactory=bi;x.Cesium3DTileContentState=ci;x.Cesium3DTileFeature=di;x.Cesium3DTileFeatureTable=ei;x.Cesium3DTileOptimizationHint=fi;x.Cesium3DTileOptimizations=gi;x.Cesium3DTilePass=hi;x.Cesium3DTilePassState=ii;x.Cesium3DTilePointFeature=ji;x.Cesium3DTileRefine=ki;x.Cesium3DTileset=li;x.Cesium3DTilesetCache=mi;x.Cesium3DTilesetHeatmap=ni;x.Cesium3DTilesetMostDetailedTraversal=oi;x.Cesium3DTilesetStatistics=pi;x.Cesium3DTilesetTraversal=qi;x.Cesium3DTileStyle=ri;x.Cesium3DTileStyleEngine=si;x.CircleEmitter=ti;x.ClassificationModel=ui;x.ClassificationPrimitive=vi;x.ClassificationType=wi;x.ClippingPlane=xi;x.ClippingPlaneCollection=yi;x.ColorBlendMode=zi;x.Composite3DTileContent=Ai;x.computeFlyToLocationForRectangle=Bi;x.ConditionsExpression=Ci;x.ConeEmitter=Di;x.createBillboardPointCallback=Ei;x.createOpenStreetMapImageryProvider=Fi;x.createTangentSpaceDebugPrimitive=Gi;x.createTileMapServiceImageryProvider=Hi;x.createWorldImagery=Ii;x.CreditDisplay=Ji;x.CullFace=Ki;x.DebugAppearance=Li;x.DebugCameraPrimitive=Mi;x.DebugModelMatrixPrimitive=Ni;x.DepthFunction=Oi;x.DepthPlane=Pi;x.DerivedCommand=Qi;x.DeviceOrientationCameraController=Ri;x.DiscardEmptyTileImagePolicy=Si;x.DiscardMissingTileImagePolicy=Ti;x.DracoLoader=Ui;x.EllipsoidPrimitive=Vi;x.EllipsoidSurfaceAppearance=Wi;x.Empty3DTileContent=Xi;x.Expression=Yi;x.ExpressionNodeType=Zi;x.Fog=$i;x.FrameRateMonitor=aj;x.FrameState=bj;x.FrustumCommands=cj;x.Geometry3DTileContent=dj;x.getBinaryAccessor=ej;x.getClipAndStyleCode=fj;x.getClippingFunction=gj;x.GetFeatureInfoFormat=hj;x.Globe=ij;x.GlobeDepth=jj;x.GlobeSurfaceShaderSet=kj;x.GlobeSurfaceTile=lj;x.GlobeSurfaceTileProvider=mj;x.GoogleEarthEnterpriseImageryProvider=nj;x.GoogleEarthEnterpriseMapsProvider=oj;x.GridImageryProvider=pj;x.GroundPolylinePrimitive=qj;x.GroundPrimitive=rj;x.HeightReference=sj;x.HorizontalOrigin=tj;x.Imagery=uj;x.ImageryLayer=vj;x.ImageryLayerCollection=wj;x.ImageryLayerFeatureInfo=xj;x.ImageryProvider=yj;x.ImagerySplitDirection=zj;x.ImageryState=Aj;x.Instanced3DModel3DTileContent=Bj;x.InvertClassification=Cj;x.IonImageryProvider=Dj;x.IonWorldImageryStyle=Ej;x.JobScheduler=Fj;x.JobType=Gj;x.Label=Hj;x.LabelCollection=Ij;x.LabelStyle=Jj;x.MapboxImageryProvider=Kj;x.MapboxStyleImageryProvider=Lj;x.MapMode2D=Mj;x.Material=Nj;x.MaterialAppearance=Oj;x.Model=Pj;x.ModelAnimation=Qj;x.ModelAnimationCache=Rj;x.ModelAnimationCollection=Sj;x.ModelAnimationLoop=Tj;x.ModelAnimationState=Uj;x.ModelInstance=Vj;x.ModelInstanceCollection=Wj;x.ModelLoadResources=Xj;x.ModelMaterial=Yj;x.ModelMesh=Zj;x.ModelNode=ak;x.ModelUtility=bk;x.Moon=ck;x.NeverTileDiscardPolicy=dk;x.OctahedralProjectedCubeMap=ek;x.OIT=fk;x.OrderedGroundPrimitiveCollection=gk;x.Particle=hk;x.ParticleBurst=ik;x.ParticleEmitter=jk;x.ParticleSystem=kk;x.PerformanceDisplay=lk;x.PerInstanceColorAppearance=mk;x.PickDepth=nk;x.PickDepthFramebuffer=ok;x.PickFramebuffer=pk;x.PointCloud=qk;x.PointCloud3DTileContent=rk;x.PointCloudEyeDomeLighting=sk;x.PointCloudShading=tk;x.PointPrimitive=uk;x.PointPrimitiveCollection=vk;x.Polyline=wk;x.PolylineCollection=xk;x.PolylineColorAppearance=yk;x.PolylineMaterialAppearance=zk;x.PostProcessStage=Ak;x.PostProcessStageCollection=Bk;x.PostProcessStageComposite=Ck;x.PostProcessStageLibrary=Dk;x.PostProcessStageSampleMode=Ek;x.PostProcessStageTextureCache=Fk;x.Primitive=Gk;x.PrimitiveCollection=Hk;x.PrimitivePipeline=Ik;x.PrimitiveState=Jk;x.processModelMaterialsCommon=Kk;x.processPbrMaterials=Lk;x.QuadtreeOccluders=Mk;x.QuadtreePrimitive=Nk;x.QuadtreeTile=Ok;x.QuadtreeTileLoadState=Pk;x.QuadtreeTileProvider=Qk;x.Scene=Rk;x.SceneFramebuffer=Sk;x.SceneMode=Tk;x.SceneTransforms=Uk;x.SceneTransitioner=Vk;x.ScreenSpaceCameraController=Wk;x.ShadowMap=Xk;x.ShadowMapShader=Yk;x.ShadowMode=Zk;x.ShadowVolumeAppearance=$k;x.SingleTileImageryProvider=al;x.SkyAtmosphere=bl;x.SkyBox=cl;x.SphereEmitter=dl;x.StencilConstants=el;x.StencilFunction=fl;x.StencilOperation=gl;x.StyleExpression=hl;x.Sun=il;x.SunPostProcess=jl;x.TerrainFillMesh=kl;x.TerrainState=ll;x.TextureAtlas=ml;x.TileBoundingRegion=nl;x.TileBoundingSphere=ol;x.TileBoundingVolume=pl;x.TileCoordinatesImageryProvider=ql;x.TileDiscardPolicy=rl;x.TileImagery=sl;x.TileOrientedBoundingBox=tl;x.TileReplacementQueue=ul;x.TileSelectionResult=vl;x.Tileset3DTileContent=wl;x.TileState=xl;x.TimeDynamicImagery=yl;x.TimeDynamicPointCloud=zl;x.Tonemapper=Al;x.TweenCollection=Bl;x.UrlTemplateImageryProvider=Cl;x.Vector3DTileBatch=Dl;x.Vector3DTileContent=El;x.Vector3DTileGeometry=Fl;x.Vector3DTilePoints=Gl;x.Vector3DTilePolygons=Hl;x.Vector3DTilePolylines=Il;x.Vector3DTilePrimitive=Jl;x.VerticalOrigin=Kl;x.View=Ll;x.ViewportQuad=Ml;x.WebMapServiceImageryProvider=Nl;x.WebMapTileServiceImageryProvider=Ol;x._shaders.AdjustTranslucentFS=Pl;x._shaders.BillboardCollectionFS=Ql;x._shaders.BillboardCollectionVS=Rl;x._shaders.BrdfLutGeneratorFS=Sl;x._shaders.CompositeOITFS=Tl;x._shaders.DepthPlaneFS=Ul;x._shaders.DepthPlaneVS=Vl;x._shaders.EllipsoidFS=Wl;x._shaders.EllipsoidVS=Xl;x._shaders.GlobeFS=Yl;x._shaders.GlobeVS=Zl;x._shaders.GroundAtmosphere=$l;x._shaders.OctahedralProjectionAtlasFS=am;x._shaders.OctahedralProjectionFS=bm;x._shaders.OctahedralProjectionVS=cm;x._shaders.PointPrimitiveCollectionFS=dm;x._shaders.PointPrimitiveCollectionVS=em;x._shaders.PolylineCommon=fm;x._shaders.PolylineFS=gm;x._shaders.PolylineShadowVolumeFS=hm;x._shaders.PolylineShadowVolumeMorphFS=im;x._shaders.PolylineShadowVolumeMorphVS=jm;x._shaders.PolylineShadowVolumeVS=km;x._shaders.PolylineVS=lm;x._shaders.ReprojectWebMercatorFS=mm;x._shaders.ReprojectWebMercatorVS=nm;x._shaders.ShadowVolumeAppearanceFS=om;x._shaders.ShadowVolumeAppearanceVS=pm;x._shaders.ShadowVolumeFS=qm;x._shaders.SkyAtmosphereFS=rm;x._shaders.SkyAtmosphereVS=sm;x._shaders.SkyBoxFS=tm;x._shaders.SkyBoxVS=um;x._shaders.SunFS=vm;x._shaders.SunTextureFS=wm;x._shaders.SunVS=xm;x._shaders.Vector3DTilePolylinesVS=ym;x._shaders.VectorTileVS=zm;x._shaders.ViewportQuadFS=Am;x._shaders.ViewportQuadVS=Bm;x.Autolinker=Cm;x["earcut-2.1.1"]=Dm;x.jsep=Em;x.kdbush=Fm;x["knockout-3.5.0"]=Gm;x["knockout-es5"]=Hm;x.knockout=Im;x.LercDecode=Jm;x.measureText=Km;x["mersenne-twister"]=Lm;x.NoSleep=Mm;x["protobuf-minimal"]=Nm;x.purify=Om;x.quickselect=Pm;x.rbush=Qm;x.sprintf=Rm;x.topojson=Sm;x.Tween=Tm;x.Uri=Um;x.when=Vm;x.zip=Wm;x.ClockViewModel=Xm;x.Command=Ym;x.createCommand=Zm;x.getElement=$m;x.InspectorShared=an;x.subscribeAndEvaluate=bn;x.SvgPathBindingHandler=cn;x.ToggleButtonViewModel=dn;x.ConicalRadarFramework=en;x.ConicalRadarGraphics=fn;x.ConicalRadarPrimitive=gn;x.ConicalRadarVisualizer=hn;x.RectangularSensorGraphics=jn;x.RectangularSensorPrimitive=kn;x.RectangularSensorVisualizer=ln;x.ParabolaRadarFramework=mn;x.ParabolaRadarGraphics=nn;x.ParabolaRadarPrimitive=on;x.ParabolaRadarVisualizer=pn;x.RibbonGraphics=qn;x.RibbonPrimitive=rn;x.RibbonVisualizer=sn;x.RingconeFramework=tn;x.RingconeGraphics=un;x.RingconePrimitive=vn;x.RingconeVisualizer=wn;x.RingRadarFramework=xn;x.RingRadarGraphics=yn;x.RingRadarPrimitive=zn;x.RingRadarVisualizer=An;x.SquareconeFramework=Bn;x.SquareconeGraphics=Cn;x.SquareconePrimitive=Dn;x.SquareconeVisualizer=En;x.ConicalRadarFS=Fn;x.ConicalRadarVS=Gn;x.ElliposidFadeMaterial=Hn;x.ParabolaRadarFS=In;x.ParabolaRadarVS=Jn;x.polylineLinkMaterial=Kn;x.RectangularSensor=Ln;x.RectangularSensorFS=Mn;x.RectangularSensorScanPlaneFS=Nn;x.RectangularSensorVS=On;x.RibbonPrimitiveFS=Pn;x.RibbonPrimitiveVS=Qn;x.RingconeScannerFS=Rn;x.RingconeScannerVS=Sn;x.RingRadarFS=Tn;x.RingRadarVS=Un;x.SquareconeScannerFS=Vn;x.SquareconeScannerVS=Wn;x._shaders.AllMaterialAppearanceFS=Xn;x._shaders.AllMaterialAppearanceVS=Yn;x._shaders.BasicMaterialAppearanceFS=Zn;x._shaders.BasicMaterialAppearanceVS=$n;x._shaders.EllipsoidSurfaceAppearanceFS=ao;x._shaders.EllipsoidSurfaceAppearanceVS=bo;x._shaders.PerInstanceColorAppearanceFS=co;x._shaders.PerInstanceColorAppearanceVS=eo;x._shaders.PerInstanceFlatColorAppearanceFS=fo;x._shaders.PerInstanceFlatColorAppearanceVS=go;x._shaders.PolylineColorAppearanceVS=ho;x._shaders.PolylineMaterialAppearanceVS=io;x._shaders.TexturedMaterialAppearanceFS=jo;x._shaders.TexturedMaterialAppearanceVS=ko;x._shaders.CzmBuiltins=lo;x._shaders.AspectRampMaterial=mo;x._shaders.BumpMapMaterial=no;x._shaders.CheckerboardMaterial=oo;x._shaders.DotMaterial=po;x._shaders.ElevationContourMaterial=qo;x._shaders.ElevationRampMaterial=ro;x._shaders.FadeMaterial=so;x._shaders.GridMaterial=to;x._shaders.NormalMapMaterial=uo;x._shaders.PolylineArrowMaterial=vo;x._shaders.PolylineDashMaterial=wo;x._shaders.PolylineGlowMaterial=xo;x._shaders.PolylineOutlineMaterial=yo;x._shaders.RimLightingMaterial=zo;x._shaders.SlopeRampMaterial=Ao;x._shaders.StripeMaterial=Bo;x._shaders.Water=Co;x._shaders.AcesTonemapping=Do;x._shaders.AdditiveBlend=Eo;x._shaders.AmbientOcclusionGenerate=Fo;x._shaders.AmbientOcclusionModulate=Go;x._shaders.BlackAndWhite=Ho;x._shaders.BloomComposite=Io;x._shaders.Brightness=Jo;x._shaders.BrightPass=Ko;x._shaders.ContrastBias=Lo;x._shaders.DepthOfField=Mo;x._shaders.DepthView=No;x._shaders.DepthViewPacked=Oo;x._shaders.EdgeDetection=Po;x._shaders.FilmicTonemapping=Qo;x._shaders.FXAA=Ro;x._shaders.GaussianBlur1D=So;x._shaders.LensFlare=To;x._shaders.ModifiedReinhardTonemapping=Uo;x._shaders.NightVision=Vo;x._shaders.PassThrough=Wo;x._shaders.PassThroughDepth=Xo;x._shaders.PointCloudEyeDomeLighting=Yo;x._shaders.ReinhardTonemapping=Zo;x._shaders.Silhouette=$o;x.addBuffer=ap;x.addDefaults=bp;x.addExtensionsRequired=cp;x.addExtensionsUsed=dp;x.addPipelineExtras=ep;x.addToArray=fp;x.findAccessorMinMax=gp;x.ForEach=hp;x.getAccessorByteStride=ip;x.getComponentReader=jp;x.hasExtension=kp;x.moveTechniqueRenderStates=lp;x.moveTechniquesToExtension=mp;x.numberOfComponentsForType=np;x.parseGlb=op;x.readAccessorPacked=pp;x.removeExtensionsRequired=qp;x.removeExtensionsUsed=rp;x.removePipelineExtras=sp;x.removeUnusedElements=tp;x.updateAccessorComponentTypes=up;x.updateVersion=vp;x.FXAA3_11=wp;x.Animation=xp;x.AnimationViewModel=yp;x.BaseLayerPicker=zp;x.BaseLayerPickerViewModel=Ap;x.createDefaultImageryProviderViewModels=Bp;x.createDefaultTerrainProviderViewModels=Cp;x.ProviderViewModel=Dp;x.Cesium3DTilesInspector=Ep;x.Cesium3DTilesInspectorViewModel=Fp;x.CesiumInspector=Gp;x.CesiumInspectorViewModel=Hp;x.CesiumWidget=Ip;x.FullscreenButton=Jp;x.FullscreenButtonViewModel=Kp;x.Geocoder=Lp;x.GeocoderViewModel=Mp;x.HomeButton=Np;x.HomeButtonViewModel=Op;x.InfoBox=Pp;x.InfoBoxViewModel=Qp;x.NavigationHelpButton=Rp;x.NavigationHelpButtonViewModel=Sp;x.PerformanceWatchdog=Tp;x.PerformanceWatchdogViewModel=Up;x.ProjectionPicker=Vp;x.ProjectionPickerViewModel=Wp;x.SceneModePicker=Xp;x.SceneModePickerViewModel=Yp;x.SelectionIndicator=Zp;x.SelectionIndicatorViewModel=$p;x.Timeline=aq;x.TimelineHighlightRange=bq;x.TimelineTrack=cq;x.Viewer=dq;x.viewerCesium3DTilesInspectorMixin=eq;x.viewerCesiumInspectorMixin=fq;x.viewerDragDropMixin=gq;x.viewerPerformanceWatchdogMixin=hq;x.VRButton=iq;x.VRButtonViewModel=jq;x._shaders.degreesPerRadian=kq;x._shaders.depthRange=lq;x._shaders.ellipsoidInverseRadii=mq;x._shaders.ellipsoidRadii=nq;x._shaders.epsilon1=oq;x._shaders.epsilon2=pq;x._shaders.epsilon3=qq;x._shaders.epsilon4=rq;x._shaders.epsilon5=sq;x._shaders.epsilon6=tq;x._shaders.epsilon7=uq;x._shaders.infinity=vq;x._shaders.oneOverPi=wq;x._shaders.oneOverTwoPi=xq;x._shaders.passCesium3DTile=yq;x._shaders.passCesium3DTileClassification=zq;x._shaders.passCesium3DTileClassificationIgnoreShow=Aq;x._shaders.passClassification=Bq;x._shaders.passCompute=Cq;x._shaders.passEnvironment=Dq;x._shaders.passGlobe=Eq;x._shaders.passOpaque=Fq;x._shaders.passOverlay=Gq;x._shaders.passTerrainClassification=Hq;x._shaders.passTranslucent=Iq;x._shaders.pi=Jq;x._shaders.piOverFour=Kq;x._shaders.piOverSix=Lq;x._shaders.piOverThree=Mq;x._shaders.piOverTwo=Nq;x._shaders.radiansPerDegree=Oq;x._shaders.sceneMode2D=Pq;x._shaders.sceneMode3D=Qq;x._shaders.sceneModeColumbusView=Rq;x._shaders.sceneModeMorphing=Sq;x._shaders.solarRadius=Tq;x._shaders.threePiOver2=Uq;x._shaders.twoPi=Vq;x._shaders.webMercatorMaxLatitude=Wq;x._shaders.alphaWeight=Xq;x._shaders.antialias=Yq;x._shaders.approximateSphericalCoordinates=Zq;x._shaders.branchFreeTernary=$q;x._shaders.cascadeColor=ar;x._shaders.cascadeDistance=br;x._shaders.cascadeMatrix=cr;x._shaders.cascadeWeights=dr;x._shaders.columbusViewMorph=er;x._shaders.computePosition=fr;x._shaders.cosineAndSine=gr;x._shaders.decompressTextureCoordinates=hr;x._shaders.depthClampFarPlane=ir;x._shaders.eastNorthUpToEyeCoordinates=jr;x._shaders.ellipsoidContainsPoint=kr;x._shaders.ellipsoidWgs84TextureCoordinates=lr;x._shaders.equalsEpsilon=mr;x._shaders.eyeOffset=nr;x._shaders.eyeToWindowCoordinates=or;x._shaders.fastApproximateAtan=pr;x._shaders.fog=qr;x._shaders.gammaCorrect=rr;x._shaders.geodeticSurfaceNormal=sr;x._shaders.getDefaultMaterial=tr;x._shaders.getLambertDiffuse=ur;x._shaders.getSpecular=vr;x._shaders.getWaterNoise=wr;x._shaders.getWgs84EllipsoidEC=xr;x._shaders.HSBToRGB=yr;x._shaders.HSLToRGB=zr;x._shaders.hue=Ar;x._shaders.inverseGamma=Br;x._shaders.isEmpty=Cr;x._shaders.isFull=Dr;x._shaders.latitudeToWebMercatorFraction=Er;x._shaders.lineDistance=Fr;x._shaders.luminance=Gr;x._shaders.metersPerPixel=Hr;x._shaders.modelToWindowCoordinates=Ir;x._shaders.multiplyWithColorBalance=Jr;x._shaders.nearFarScalar=Kr;x._shaders.octDecode=Lr;x._shaders.packDepth=Mr;x._shaders.phong=Nr;x._shaders.planeDistance=Or;x._shaders.pointAlongRay=Pr;x._shaders.rayEllipsoidIntersectionInterval=Qr;x._shaders.readDepth=Rr;x._shaders.reverseLogDepth=Sr;x._shaders.RGBToHSB=Tr;x._shaders.RGBToHSL=Ur;x._shaders.RGBToXYZ=Vr;x._shaders.sampleOctahedralProjection=Wr;x._shaders.saturation=Xr;x._shaders.shadowDepthCompare=Yr;x._shaders.shadowVisibility=Zr;x._shaders.signNotZero=$r;x._shaders.sphericalHarmonics=as;x._shaders.tangentToEyeSpaceMatrix=bs;x._shaders.transformPlane=cs;x._shaders.translateRelativeToEye=ds;x._shaders.translucentPhong=es;x._shaders.transpose=fs;x._shaders.unpackDepth=gs;x._shaders.unpackFloat=hs;x._shaders.vertexLogDepth=is;x._shaders.windColor=js;x._shaders.windowToEyeCoordinates=ks;x._shaders.writeDepthClampedToFarPlane=ls;x._shaders.writeLogDepth=ms;x._shaders.xyzToLonLatHeight=ns;x._shaders.XYZToRGB=os;x._shaders.depthRangeStruct=ps;x._shaders.ellipsoid=qs;x._shaders.material=rs;x._shaders.materialInput=ss;x._shaders.ray=ts;x._shaders.raySegment=us;x._shaders.shadowParameters=vs;x.createTaskProcessorWorker=ws;return x});pb(["Cesium"],function(b){"undefined"!==typeof window?window.Cesium=b:"undefined"!==typeof self?self.Cesium=b:"undefined"!==typeof module?module.exports=b:console.log("Unable to load Cesium.")},void 0,!0)})();